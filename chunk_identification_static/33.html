<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>33</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    33
                    <a href="32.html">prev</a>
                    <a href="34.html">next</a>
                    <a href="33_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_cb1f0e730bde28a18e672c263c1236eb9c4df4fa_Aria/src/main/java/com/arialyy/aria/core/common/AbsFileer.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;cb1f0e730bde28a18e672c263c1236eb9c4df4fa:Aria/src/main/java/com/arialyy/aria/core/common/AbsFileer.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;cb1f0e730bde28a18e672c263c1236eb9c4df4fa^1:Aria/src/main/java/com/arialyy/aria/core/common/AbsFileer.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;cb1f0e730bde28a18e672c263c1236eb9c4df4fa^2:Aria/src/main/java/com/arialyy/aria/core/common/AbsFileer.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;e362621c3899fe60df42df4433560ff4649f9a1e:Aria/src/main/java/com/arialyy/aria/core/common/AbsFileer.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj]], subset: [[bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16 package com.arialyy.aria.core.common;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  18 import android.content.Context;                                                                          </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  19 import com.arialyy.aria.core.AriaManager;                                                                </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="">  20 import com.arialyy.aria.core.download.DownloadEntity;                                                    </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  21 import com.arialyy.aria.core.inf.AbsNormalEntity;                                                        </span>
<span class="4195608340199028072" onmouseenter="enter('4195608340199028072');" onmouseout="out('4195608340199028072');" style="">  22 import com.arialyy.aria.core.inf.AbsTaskEntity;                                                          </span>
<span class="-2820121753251967085" onmouseenter="enter('-2820121753251967085');" onmouseout="out('-2820121753251967085');" style="">  23 import com.arialyy.aria.core.inf.IDownloadListener;                                                      </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  24 import com.arialyy.aria.core.inf.IEventListener;                                                         </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="">  25 import com.arialyy.aria.orm.DbEntity;                                                                    </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  26 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  27 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="4945295635398100121" onmouseenter="enter('4945295635398100121');" onmouseout="out('4945295635398100121');" style="">  28 import com.arialyy.aria.util.DbHelper;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  29 import java.io.File;                                                                                     </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  30 import java.util.ArrayList;                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  31 import java.util.HashMap;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  32 import java.util.HashSet;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  33 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  34 import java.util.Map;                                                                                    </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  35 import java.util.Properties;                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  36 import java.util.Set;                                                                                    </span>
<span class="-3789567581486736748" onmouseenter="enter('-3789567581486736748');" onmouseout="out('-3789567581486736748');" style="">  37 import java.util.Timer;                                                                                  </span>
<span class="-2321797189340986544" onmouseenter="enter('-2321797189340986544');" onmouseout="out('-2321797189340986544');" style="">  38 import java.util.TimerTask;                                                                              </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  39 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  40 import java.util.concurrent.Executors;                                                                   </span>
<span  style="">  41                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  42 /**                                                                                                      </span>
<span class="6972081778092176351" onmouseenter="enter('6972081778092176351');" onmouseout="out('6972081778092176351');" style="">  43  * Created by AriaL on 2017/7/1.                                                                         </span>
<span class="-3350964092441836737" onmouseenter="enter('-3350964092441836737');" onmouseout="out('-3350964092441836737');" style="">  44  * 任务处理器                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  45  */                                                                                                      </span>
<span class="-4202835391474719331" onmouseenter="enter('-4202835391474719331');" onmouseout="out('-4202835391474719331');" style=""><abbr title="  46 public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_ENTITY extends AbsTaskEntity&lt;ENTITY&gt;&gt;">  46 public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_ENTITY extends AbsTaskEntity&lt;ENTITY&gt;🔵</abbr></span>
<span class="-1728503718485911871" onmouseenter="enter('-1728503718485911871');" onmouseout="out('-1728503718485911871');" style="">  47     implements Runnable, IUtil {                                                                         </span>
<span class="8962793429617957612" onmouseenter="enter('8962793429617957612');" onmouseout="out('8962793429617957612');" style="">  48   private static final String STATE = &quot;_state_&quot;;                                                         </span>
<span class="4155209368239822413" onmouseenter="enter('4155209368239822413');" onmouseout="out('4155209368239822413');" style="">  49   private static final String RECORD = &quot;_record_&quot;;                                                       </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50   /**                                                                                                    </span>
<span class="-1980722710912279499" onmouseenter="enter('-1980722710912279499');" onmouseout="out('-1980722710912279499');" style="">  51    * 小于1m的文件不启用多线程                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52    */                                                                                                    </span>
<span class="-5660290514964746700" onmouseenter="enter('-5660290514964746700');" onmouseout="out('-5660290514964746700');" style="">  53   protected static final long SUB_LEN = 1024 * 1024;                                                     </span>
<span  style="">  54                                                                                                          </span>
<span class="7185037452507187216" onmouseenter="enter('7185037452507187216');" onmouseout="out('7185037452507187216');" style="">  55   private final String TAG = &quot;AbsFileer&quot;;                                                                </span>
<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="">  56   protected IEventListener mListener;                                                                    </span>
<span class="-1948152884108661875" onmouseenter="enter('-1948152884108661875');" onmouseout="out('-1948152884108661875');" style="">  57   protected TASK_ENTITY mTaskEntity;                                                                     </span>
<span class="8904454574412257163" onmouseenter="enter('8904454574412257163');" onmouseout="out('8904454574412257163');" style="">  58   protected ENTITY mEntity;                                                                              </span>
<span class="-8914417138860252644" onmouseenter="enter('-8914417138860252644');" onmouseout="out('-8914417138860252644');" style="">  59   protected Context mContext;                                                                            </span>
<span class="3740841846621187936" onmouseenter="enter('3740841846621187936');" onmouseout="out('3740841846621187936');" style="">  60   protected File mTempFile; //文件                                                                         </span>
<span class="-5211593385781091233" onmouseenter="enter('-5211593385781091233');" onmouseout="out('-5211593385781091233');" style="">  61   protected StateConstance mConstance;                                                                   </span>
<span class="1058453114158093994" onmouseenter="enter('1058453114158093994');" onmouseout="out('1058453114158093994');" style="">  62   private ExecutorService mFixedThreadPool;                                                              </span>
<span class="-7729852228955968495" onmouseenter="enter('-7729852228955968495');" onmouseout="out('-7729852228955968495');" style="">  63   //总线程数                                                                                                 </span>
<span class="8506024364762319503" onmouseenter="enter('8506024364762319503');" onmouseout="out('8506024364762319503');" style="">  64   protected int mTotalThreadNum;                                                                         </span>
<span class="1064880922655578719" onmouseenter="enter('1064880922655578719');" onmouseout="out('1064880922655578719');" style="">  65   //启动线程数                                                                                                </span>
<span class="5843971981435686054" onmouseenter="enter('5843971981435686054');" onmouseout="out('5843971981435686054');" style="">  66   private int mStartThreadNum;                                                                           </span>
<span class="6869677327514827795" onmouseenter="enter('6869677327514827795');" onmouseout="out('6869677327514827795');" style="">  67   //已完成的线程数                                                                                              </span>
<span class="8146256445432145550" onmouseenter="enter('8146256445432145550');" onmouseout="out('8146256445432145550');" style="">  68   private int mCompleteThreadNum;                                                                        </span>
<span class="-3545799492252297873" onmouseenter="enter('-3545799492252297873');" onmouseout="out('-3545799492252297873');" style="">  69   private Map&lt;Integer, AbsThreadTask&gt; mTask = new HashMap&lt;&gt;();                                           </span>
<span  style="">  70                                                                                                          </span>
<span class="2545797703164998155" onmouseenter="enter('2545797703164998155');" onmouseout="out('2545797703164998155');" style="">  71   private Timer mTimer;                                                                                  </span>
<span class="-6913167534336436900" onmouseenter="enter('-6913167534336436900');" onmouseout="out('-6913167534336436900');" style="">  72   @Deprecated private File mConfigFile;                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  73   /**                                                                                                    </span>
<span class="7539908978715582123" onmouseenter="enter('7539908978715582123');" onmouseout="out('7539908978715582123');" style="">  74    * 进度刷新间隔                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  75    */                                                                                                    </span>
<span class="3897731617107507824" onmouseenter="enter('3897731617107507824');" onmouseout="out('3897731617107507824');" style="">  76   private long mUpdateInterval = 1000;                                                                   </span>
<span class="-5884447509953456722" onmouseenter="enter('-5884447509953456722');" onmouseout="out('-5884447509953456722');" style="">  77   private TaskRecord mRecord;                                                                            </span>
<span  style="">  78                                                                                                          </span>
<span class="2891934549353689856" onmouseenter="enter('2891934549353689856');" onmouseout="out('2891934549353689856');" style="">  79   protected AbsFileer(IEventListener listener, TASK_ENTITY taskEntity) {                                 </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  80     mListener = listener;                                                                                </span>
<span class="8662994215762856538" onmouseenter="enter('8662994215762856538');" onmouseout="out('8662994215762856538');" style="">  81     mTaskEntity = taskEntity;                                                                            </span>
<span class="-4840298181735982119" onmouseenter="enter('-4840298181735982119');" onmouseout="out('-4840298181735982119');" style="">  82     mEntity = mTaskEntity.getEntity();                                                                   </span>
<span class="1002707508041764251" onmouseenter="enter('1002707508041764251');" onmouseout="out('1002707508041764251');" style="">  83     mContext = AriaManager.APP;                                                                          </span>
<span class="-3948532274682189145" onmouseenter="enter('-3948532274682189145');" onmouseout="out('-3948532274682189145');" style="">  84     mConstance = new StateConstance();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85   }                                                                                                      </span>
<span  style="">  86                                                                                                          </span>
<span class="-8210434580109369245" onmouseenter="enter('-8210434580109369245');" onmouseout="out('-8210434580109369245');" style="">  87   public void setNewTask(boolean newTask) {                                                              </span>
<span class="7261549057242337382" onmouseenter="enter('7261549057242337382');" onmouseout="out('7261549057242337382');" style="">  88     mTaskEntity.setNewTask(newTask);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89   }                                                                                                      </span>
<span  style="">  90                                                                                                          </span>
<span class="2509123758179905267" onmouseenter="enter('2509123758179905267');" onmouseout="out('2509123758179905267');" style="">  91   @Override public void setMaxSpeed(double maxSpeed) {                                                   </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style="">  92     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style="">  93       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="">  94       if (task != null) {                                                                                </span>
<span class="8974054037700404915" onmouseenter="enter('8974054037700404915');" onmouseout="out('8974054037700404915');" style="">  95         task.setMaxSpeed(maxSpeed);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98   }                                                                                                      </span>
<span  style="">  99                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 100   @Override public void run() {                                                                          </span>
<span class="2383691993380925204" onmouseenter="enter('2383691993380925204');" onmouseout="out('2383691993380925204');" style=""> 101     if (mConstance.isRunning) {                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 102       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103     }                                                                                                    </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 104     startFlow();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105   }                                                                                                      </span>
<span  style=""> 106                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 107   /**                                                                                                    </span>
<span class="-8036989040377605484" onmouseenter="enter('-8036989040377605484');" onmouseout="out('-8036989040377605484');" style=""> 108    * 开始流程                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 109    */                                                                                                    </span>
<span class="2659446283962947526" onmouseenter="enter('2659446283962947526');" onmouseout="out('2659446283962947526');" style=""> 110   private void startFlow() {                                                                             </span>
<span class="619404821214964502" onmouseenter="enter('619404821214964502');" onmouseout="out('619404821214964502');" style=""> 111     mConstance.resetState();                                                                             </span>
<span class="1290437685045115531" onmouseenter="enter('1290437685045115531');" onmouseout="out('1290437685045115531');" style=""> 112     checkTask();                                                                                         </span>
<span class="6200019808906550914" onmouseenter="enter('6200019808906550914');" onmouseout="out('6200019808906550914');" style=""> 113     mConstance.TASK_RECORD = mRecord;                                                                    </span>
<span class="4780862748684536259" onmouseenter="enter('4780862748684536259');" onmouseout="out('4780862748684536259');" style=""> 114     if (mListener instanceof IDownloadListener) {                                                        </span>
<span class="937780446443407951" onmouseenter="enter('937780446443407951');" onmouseout="out('937780446443407951');" style=""> 115       ((IDownloadListener) mListener).onPostPre(mEntity.getFileSize());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116     }                                                                                                    </span>
<span class="8755928574405213439" onmouseenter="enter('8755928574405213439');" onmouseout="out('8755928574405213439');" style=""> 117     if (!mTaskEntity.isSupportBP()) {                                                                    </span>
<span class="-7445970306128807043" onmouseenter="enter('-7445970306128807043');" onmouseout="out('-7445970306128807043');" style=""> 118       mTotalThreadNum = 1;                                                                               </span>
<span class="-1191691332114182414" onmouseenter="enter('-1191691332114182414');" onmouseout="out('-1191691332114182414');" style=""> 119       mStartThreadNum = 1;                                                                               </span>
<span class="-6182854007095635032" onmouseenter="enter('-6182854007095635032');" onmouseout="out('-6182854007095635032');" style=""> 120       handleNoSupportBP();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 121     } else {                                                                                             </span>
<span class="-2662097366456595872" onmouseenter="enter('-2662097366456595872');" onmouseout="out('-2662097366456595872');" style=""> 122       mTotalThreadNum =                                                                                  </span>
<span class="2293773823409558899" onmouseenter="enter('2293773823409558899');" onmouseout="out('2293773823409558899');" style=""> 123           mTaskEntity.isNewTask() ? (mStartThreadNum = setNewTaskThreadNum()) : mTotalThreadNum;         </span>
<span class="304482857231090385" onmouseenter="enter('304482857231090385');" onmouseout="out('304482857231090385');" style=""> 124       handleBreakpoint();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125     }                                                                                                    </span>
<span class="-5070363508518577757" onmouseenter="enter('-5070363508518577757');" onmouseout="out('-5070363508518577757');" style=""> 126     mConstance.START_THREAD_NUM = mTotalThreadNum;                                                       </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 127     /*                                                                                                   </span>
<span class="-7459715513064469337" onmouseenter="enter('-7459715513064469337');" onmouseout="out('-7459715513064469337');" style=""> 128      * mTaskEntity.getEntity().getFileSize() != mTempFile.length()为兼容以前老版本代码                             </span>
<span class="-5520474084619660394" onmouseenter="enter('-5520474084619660394');" onmouseout="out('-5520474084619660394');" style=""> 129      * 动态长度条件：                                                                                           </span>
<span class="6678836087239710153" onmouseenter="enter('6678836087239710153');" onmouseout="out('6678836087239710153');" style=""> 130      * 1、总线程数为1，并且是新任务                                                                                   </span>
<span class="-8594380126502433751" onmouseenter="enter('-8594380126502433751');" onmouseout="out('-8594380126502433751');" style=""> 131      * 2、总线程数为1，不是新任务，但是长度不是文件全长度                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 132      */                                                                                                  </span>
<span class="-763935913933084661" onmouseenter="enter('-763935913933084661');" onmouseout="out('-763935913933084661');" style=""> 133     if (mTotalThreadNum == 1 &amp;&amp; (mTaskEntity.isNewTask()                                                 </span>
<span class="-3606193574981639369" onmouseenter="enter('-3606193574981639369');" onmouseout="out('-3606193574981639369');" style=""> 134         || mTaskEntity.getEntity().getFileSize() != mTempFile.length())) {                               </span>
<span class="9204016926254181097" onmouseenter="enter('9204016926254181097');" onmouseout="out('9204016926254181097');" style=""> 135       mConstance.isOpenDynamicFile = true;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136     }                                                                                                    </span>
<span class="-7724548171203838725" onmouseenter="enter('-7724548171203838725');" onmouseout="out('-7724548171203838725');" style=""> 137     startTimer();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138   }                                                                                                      </span>
<span  style=""> 139                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 140   /**                                                                                                    </span>
<span class="-5386582613838574396" onmouseenter="enter('-5386582613838574396');" onmouseout="out('-5386582613838574396');" style=""> 141    * 设置新任务的最大线程数                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 142    */                                                                                                    </span>
<span class="-6137859098551091137" onmouseenter="enter('-6137859098551091137');" onmouseout="out('-6137859098551091137');" style=""> 143   protected abstract int setNewTaskThreadNum();                                                          </span>
<span  style=""> 144                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 145   /**                                                                                                    </span>
<span class="4041581137177203435" onmouseenter="enter('4041581137177203435');" onmouseout="out('4041581137177203435');" style=""> 146    * 启动进度获取定时器                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 147    */                                                                                                    </span>
<span class="-8560002621884285761" onmouseenter="enter('-8560002621884285761');" onmouseout="out('-8560002621884285761');" style=""> 148   private void startTimer() {                                                                            </span>
<span class="9064905857115753880" onmouseenter="enter('9064905857115753880');" onmouseout="out('9064905857115753880');" style=""> 149     mTimer = new Timer(true);                                                                            </span>
<span class="1767883212426599488" onmouseenter="enter('1767883212426599488');" onmouseout="out('1767883212426599488');" style=""> 150     mTimer.schedule(new TimerTask() {                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 151       @Override public void run() {                                                                      </span>
<span class="5257678828672457716" onmouseenter="enter('5257678828672457716');" onmouseout="out('5257678828672457716');" style=""> 152         if (mConstance.isComplete()                                                                      </span>
<span class="334343515162691172" onmouseenter="enter('334343515162691172');" onmouseout="out('334343515162691172');" style=""> 153             || mConstance.isStop()                                                                       </span>
<span class="3923616872544648792" onmouseenter="enter('3923616872544648792');" onmouseout="out('3923616872544648792');" style=""> 154             || mConstance.isCancel()                                                                     </span>
<span class="-6728476664925849707" onmouseenter="enter('-6728476664925849707');" onmouseout="out('-6728476664925849707');" style=""> 155             || !mConstance.isRunning) {                                                                  </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 156           closeTimer();                                                                                  </span>
<span class="5358021077686010059" onmouseenter="enter('5358021077686010059');" onmouseout="out('5358021077686010059');" style=""> 157         } else if (mConstance.CURRENT_LOCATION &gt;= 0) {                                                   </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style=""> 158           mListener.onProgress(mConstance.CURRENT_LOCATION);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160       }                                                                                                  </span>
<span class="-3821686044197757132" onmouseenter="enter('-3821686044197757132');" onmouseout="out('-3821686044197757132');" style=""> 161     }, 0, mUpdateInterval);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162   }                                                                                                      </span>
<span  style=""> 163                                                                                                          </span>
<span class="6987763365729675608" onmouseenter="enter('6987763365729675608');" onmouseout="out('6987763365729675608');" style=""> 164   protected void closeTimer() {                                                                          </span>
<span class="-4343220603110256261" onmouseenter="enter('-4343220603110256261');" onmouseout="out('-4343220603110256261');" style=""> 165     if (mTimer != null) {                                                                                </span>
<span class="6506490333649261220" onmouseenter="enter('6506490333649261220');" onmouseout="out('6506490333649261220');" style=""> 166       mTimer.purge();                                                                                    </span>
<span class="3936422701741233911" onmouseenter="enter('3936422701741233911');" onmouseout="out('3936422701741233911');" style=""> 167       mTimer.cancel();                                                                                   </span>
<span class="-3760473013259053076" onmouseenter="enter('-3760473013259053076');" onmouseout="out('-3760473013259053076');" style=""> 168       mTimer = null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170   }                                                                                                      </span>
<span  style=""> 171                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 172   /**                                                                                                    </span>
<span class="3310122691908792895" onmouseenter="enter('3310122691908792895');" onmouseout="out('3310122691908792895');" style=""> 173    * 设置定时器更新间隔                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 174    *                                                                                                     </span>
<span class="5926421498368036592" onmouseenter="enter('5926421498368036592');" onmouseout="out('5926421498368036592');" style=""> 175    * @param interval 单位毫秒，不能小于0                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 176    */                                                                                                    </span>
<span class="-6143371944494222779" onmouseenter="enter('-6143371944494222779');" onmouseout="out('-6143371944494222779');" style=""> 177   protected void setUpdateInterval(long interval) {                                                      </span>
<span class="-1051498944097002766" onmouseenter="enter('-1051498944097002766');" onmouseout="out('-1051498944097002766');" style=""> 178     if (interval &lt; 0) {                                                                                  </span>
<span class="3000915396455271078" onmouseenter="enter('3000915396455271078');" onmouseout="out('3000915396455271078');" style=""> 179       ALog.w(TAG, &quot;更新间隔不能小于0，默认为1000毫秒&quot;);                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 180       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181     }                                                                                                    </span>
<span class="-3431322530378656562" onmouseenter="enter('-3431322530378656562');" onmouseout="out('-3431322530378656562');" style=""> 182     mUpdateInterval = interval;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183   }                                                                                                      </span>
<span  style=""> 184                                                                                                          </span>
<span class="-4506592131726080634" onmouseenter="enter('-4506592131726080634');" onmouseout="out('-4506592131726080634');" style=""> 185   @Override public long getFileSize() {                                                                  </span>
<span class="-7902485770489300682" onmouseenter="enter('-7902485770489300682');" onmouseout="out('-7902485770489300682');" style=""> 186     return mEntity.getFileSize();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187   }                                                                                                      </span>
<span  style=""> 188                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 189   /**                                                                                                    </span>
<span class="-7288086523564906780" onmouseenter="enter('-7288086523564906780');" onmouseout="out('-7288086523564906780');" style=""> 190    * 获取当前任务位置                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 191    */                                                                                                    </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style=""> 192   @Override public long getCurrentLocation() {                                                           </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style=""> 193     return mConstance.CURRENT_LOCATION;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194   }                                                                                                      </span>
<span  style=""> 195                                                                                                          </span>
<span class="-2237798856776801835" onmouseenter="enter('-2237798856776801835');" onmouseout="out('-2237798856776801835');" style=""> 196   @Override public boolean isRunning() {                                                                 </span>
<span class="-9220268812159037756" onmouseenter="enter('-9220268812159037756');" onmouseout="out('-9220268812159037756');" style=""> 197     return mConstance.isRunning;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198   }                                                                                                      </span>
<span  style=""> 199                                                                                                          </span>
<span class="305234216015554819" onmouseenter="enter('305234216015554819');" onmouseout="out('305234216015554819');" style=""> 200   @Override public void cancel() {                                                                       </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 201     closeTimer();                                                                                        </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 202     mConstance.isRunning = false;                                                                        </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style=""> 203     mConstance.isCancel = true;                                                                          </span>
<span class="-1828001720390047641" onmouseenter="enter('-1828001720390047641');" onmouseout="out('-1828001720390047641');" style=""> 204     if (mFixedThreadPool != null) {                                                                      </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style=""> 205       mFixedThreadPool.shutdown();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206     }                                                                                                    </span>
<span class="-612803506725482722" onmouseenter="enter('-612803506725482722');" onmouseout="out('-612803506725482722');" style=""> 207     for (int i = 0; i &lt; mStartThreadNum; i++) {                                                          </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 208       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 209       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style=""> 210         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213   }                                                                                                      </span>
<span  style=""> 214                                                                                                          </span>
<span class="6276273225669041403" onmouseenter="enter('6276273225669041403');" onmouseout="out('6276273225669041403');" style=""> 215   @Override public void stop() {                                                                         </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 216     closeTimer();                                                                                        </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 217     mConstance.isRunning = false;                                                                        </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style=""> 218     mConstance.isStop = true;                                                                            </span>
<span class="8402005296375476854" onmouseenter="enter('8402005296375476854');" onmouseout="out('8402005296375476854');" style=""> 219     if (mConstance.isComplete()) return;                                                                 </span>
<span class="-1828001720390047641" onmouseenter="enter('-1828001720390047641');" onmouseout="out('-1828001720390047641');" style=""> 220     if (mFixedThreadPool != null) {                                                                      </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style=""> 221       mFixedThreadPool.shutdown();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222     }                                                                                                    </span>
<span class="-612803506725482722" onmouseenter="enter('-612803506725482722');" onmouseout="out('-612803506725482722');" style=""> 223     for (int i = 0; i &lt; mStartThreadNum; i++) {                                                          </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 224       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 225       if (task != null) {                                                                                </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style=""> 226         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229   }                                                                                                      </span>
<span  style=""> 230                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 231   /**                                                                                                    </span>
<span class="-7218687507933415946" onmouseenter="enter('-7218687507933415946');" onmouseout="out('-7218687507933415946');" style=""> 232    * 直接调用的时候会自动启动线程执行                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 233    */                                                                                                    </span>
<span class="2908281040877937362" onmouseenter="enter('2908281040877937362');" onmouseout="out('2908281040877937362');" style=""> 234   @Override public void start() {                                                                        </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style=""> 235     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236   }                                                                                                      </span>
<span  style=""> 237                                                                                                          </span>
<span class="-1531467598256645714" onmouseenter="enter('-1531467598256645714');" onmouseout="out('-1531467598256645714');" style=""> 238   @Override public void resume() {                                                                       </span>
<span class="-6183578153083367222" onmouseenter="enter('-6183578153083367222');" onmouseout="out('-6183578153083367222');" style=""> 239     start();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240   }                                                                                                      </span>
<span  style=""> 241                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 242   /**                                                                                                    </span>
<span class="-5594313128981442446" onmouseenter="enter('-5594313128981442446');" onmouseout="out('-5594313128981442446');" style=""> 243    * 检查任务、检查线程数                                                                                          </span>
<span class="5765812458735380113" onmouseenter="enter('5765812458735380113');" onmouseout="out('5765812458735380113');" style=""> 244    * 新任务条件：                                                                                              </span>
<span class="-3418470207445181215" onmouseenter="enter('-3418470207445181215');" onmouseout="out('-3418470207445181215');" style=""> 245    * 1、文件不存在                                                                                             </span>
<span class="1471172295356331660" onmouseenter="enter('1471172295356331660');" onmouseout="out('1471172295356331660');" style=""> 246    * 2、任务记录文件缺失或不匹配                                                                                      </span>
<span class="4400956412852543180" onmouseenter="enter('4400956412852543180');" onmouseout="out('4400956412852543180');" style=""> 247    * 3、数据库记录不存在                                                                                          </span>
<span class="1878350678984943375" onmouseenter="enter('1878350678984943375');" onmouseout="out('1878350678984943375');" style=""> 248    * 4、不支持断点，则是新任务                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 249    */                                                                                                    </span>
<span class="-8432905628195545001" onmouseenter="enter('-8432905628195545001');" onmouseout="out('-8432905628195545001');" style=""> 250   private void checkTask() {                                                                             </span>
<span class="-5297450492380711808" onmouseenter="enter('-5297450492380711808');" onmouseout="out('-5297450492380711808');" style=""> 251     mConfigFile = new File(CommonUtil.getFileConfigPath(false, mEntity.getFileName()));                  </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style=""> 252     if (mConfigFile.exists()) {                                                                          </span>
<span class="7932310618145443523" onmouseenter="enter('7932310618145443523');" onmouseout="out('7932310618145443523');" style=""> 253       convertDb();                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 254     } else {                                                                                             </span>
<span class="-5238664810335263343" onmouseenter="enter('-5238664810335263343');" onmouseout="out('-5238664810335263343');" style=""> 255       mRecord = DbHelper.getTaskRecord(mTaskEntity.getKey());                                            </span>
<span class="-3299415613061807412" onmouseenter="enter('-3299415613061807412');" onmouseout="out('-3299415613061807412');" style=""> 256       if (mRecord == null) {                                                                             </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 257         initRecord();                                                                                    </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 258         mTaskEntity.setNewTask(true);                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 259       } else {                                                                                           </span>
<span class="-7168613097949101282" onmouseenter="enter('-7168613097949101282');" onmouseout="out('-7168613097949101282');" style=""> 260         if (mRecord.threadRecords == null || mRecord.threadRecords.isEmpty()) {                          </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 261           initRecord();                                                                                  </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 262           mTaskEntity.setNewTask(true);                                                                  </span>
<span class="-4489756692986098869" onmouseenter="enter('-4489756692986098869');" onmouseout="out('-4489756692986098869');" style=""> 263         } else if (mTempFile.length() == 0) {                                                            </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style=""> 264           mRecord.deleteData();                                                                          </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 265           initRecord();                                                                                  </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 266           mTaskEntity.setNewTask(true);                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 267         } else {                                                                                         </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style=""> 268           for (ThreadRecord tr : mRecord.threadRecords) {                                                </span>
<span class="-6249885869558348483" onmouseenter="enter('-6249885869558348483');" onmouseout="out('-6249885869558348483');" style=""> 269             if (tr.isComplete) {                                                                         </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style=""> 270               mCompleteThreadNum++;                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 271             } else {                                                                                     </span>
<span class="-4361198270326326802" onmouseenter="enter('-4361198270326326802');" onmouseout="out('-4361198270326326802');" style=""> 272               mStartThreadNum++;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274           }                                                                                              </span>
<span class="-4812553014330515673" onmouseenter="enter('-4812553014330515673');" onmouseout="out('-4812553014330515673');" style=""> 275           mTotalThreadNum = mRecord.threadRecords.size();                                                </span>
<span class="-561823525574412259" onmouseenter="enter('-561823525574412259');" onmouseout="out('-561823525574412259');" style=""> 276           mTaskEntity.setNewTask(false);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280   }                                                                                                      </span>
<span  style=""> 281                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 282   /**                                                                                                    </span>
<span class="1070716404183585489" onmouseenter="enter('1070716404183585489');" onmouseout="out('1070716404183585489');" style=""> 283    * convertDb 为兼容性代码                                                                                    </span>
<span class="3982968248834793214" onmouseenter="enter('3982968248834793214');" onmouseout="out('3982968248834793214');" style=""> 284    * 从3.4.1开始，线程配置信息将存储在数据库中。                                                                            </span>
<span class="-6928102974415786303" onmouseenter="enter('-6928102974415786303');" onmouseout="out('-6928102974415786303');" style=""> 285    * 将配置文件的内容复制到数据库中，并将配置文件删除                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 286    */                                                                                                    </span>
<span class="14298455509427519" onmouseenter="enter('14298455509427519');" onmouseout="out('14298455509427519');" style=""> 287   private void convertDb() {                                                                             </span>
<span class="-4598298306615401010" onmouseenter="enter('-4598298306615401010');" onmouseout="out('-4598298306615401010');" style=""> 288     List&lt;RecordWrapper&gt; records =                                                                        </span>
<span class="-4738968014729726274" onmouseenter="enter('-4738968014729726274');" onmouseout="out('-4738968014729726274');" style=""> 289         DbEntity.findRelationData(RecordWrapper.class, &quot;TaskRecord.filePath=?&quot;,                          </span>
<span class="96831814087260276" onmouseenter="enter('96831814087260276');" onmouseout="out('96831814087260276');" style=""> 290             mTaskEntity.getKey());                                                                       </span>
<span class="-376648440877788579" onmouseenter="enter('-376648440877788579');" onmouseout="out('-376648440877788579');" style=""> 291     if (records == null || records.size() == 0) {                                                        </span>
<span class="7274393295178915569" onmouseenter="enter('7274393295178915569');" onmouseout="out('7274393295178915569');" style=""> 292       Properties pro = CommonUtil.loadConfig(mConfigFile);                                               </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style=""> 293       if (pro.isEmpty()) {                                                                               </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 294         mTaskEntity.setNewTask(true);                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 295         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296       }                                                                                                  </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 297       initRecord();                                                                                      </span>
<span class="-4092719147494026286" onmouseenter="enter('-4092719147494026286');" onmouseout="out('-4092719147494026286');" style=""> 298       Set&lt;Object&gt; keys = pro.keySet();                                                                   </span>
<span class="7117164647387083506" onmouseenter="enter('7117164647387083506');" onmouseout="out('7117164647387083506');" style=""> 299       // 老版本记录是5s存一次，但是5s中内，如果线程执行完成，record记录是没有的，只有state记录...                                           </span>
<span class="8442347856216504710" onmouseenter="enter('8442347856216504710');" onmouseout="out('8442347856216504710');" style=""> 300       // 第一步应该是record 和 state去重取正确的线程数                                                                   </span>
<span class="3880560860847601414" onmouseenter="enter('3880560860847601414');" onmouseout="out('3880560860847601414');" style=""> 301       Set&lt;Integer&gt; set = new HashSet&lt;&gt;();                                                                </span>
<span class="-5644624400733519290" onmouseenter="enter('-5644624400733519290');" onmouseout="out('-5644624400733519290');" style=""> 302       for (Object key : keys) {                                                                          </span>
<span class="-90111359741489740" onmouseenter="enter('-90111359741489740');" onmouseout="out('-90111359741489740');" style=""> 303         String str = String.valueOf(key);                                                                </span>
<span class="5431713397557299419" onmouseenter="enter('5431713397557299419');" onmouseout="out('5431713397557299419');" style=""> 304         int i = Integer.parseInt(str.substring(str.length() - 1, str.length()));                         </span>
<span class="5139166377005733880" onmouseenter="enter('5139166377005733880');" onmouseout="out('5139166377005733880');" style=""> 305         set.add(i);                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306       }                                                                                                  </span>
<span class="1773727540275693887" onmouseenter="enter('1773727540275693887');" onmouseout="out('1773727540275693887');" style=""> 307       int threadNum = set.size();                                                                        </span>
<span class="1658307869252768908" onmouseenter="enter('1658307869252768908');" onmouseout="out('1658307869252768908');" style=""> 308       if (threadNum == 0) {                                                                              </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 309         mTaskEntity.setNewTask(true);                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 310         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311       }                                                                                                  </span>
<span class="8980547023143351106" onmouseenter="enter('8980547023143351106');" onmouseout="out('8980547023143351106');" style=""> 312       mRecord.threadNum = threadNum;                                                                     </span>
<span class="1082026445239340300" onmouseenter="enter('1082026445239340300');" onmouseout="out('1082026445239340300');" style=""> 313       mTotalThreadNum = threadNum;                                                                       </span>
<span  style=""> 314                                                                                                          </span>
<span class="92058997093189211" onmouseenter="enter('92058997093189211');" onmouseout="out('92058997093189211');" style=""> 315       for (int i = 0; i &lt; threadNum; i++) {                                                              </span>
<span class="1846142719149590893" onmouseenter="enter('1846142719149590893');" onmouseout="out('1846142719149590893');" style=""> 316         ThreadRecord tRecord = new ThreadRecord();                                                       </span>
<span class="-543854586085341709" onmouseenter="enter('-543854586085341709');" onmouseout="out('-543854586085341709');" style=""> 317         tRecord.key = mRecord.filePath;                                                                  </span>
<span class="-1285896534897014429" onmouseenter="enter('-1285896534897014429');" onmouseout="out('-1285896534897014429');" style=""> 318         Object state = pro.getProperty(mTempFile.getName() + STATE + i);                                 </span>
<span class="7744986855104654034" onmouseenter="enter('7744986855104654034');" onmouseout="out('7744986855104654034');" style=""> 319         Object record = pro.getProperty(mTempFile.getName() + RECORD + i);                               </span>
<span class="-1417732743646819816" onmouseenter="enter('-1417732743646819816');" onmouseout="out('-1417732743646819816');" style=""> 320         if (state != null &amp;&amp; Integer.parseInt(String.valueOf(state)) == 1) {                             </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style=""> 321           mCompleteThreadNum++;                                                                          </span>
<span class="-5900743039323389312" onmouseenter="enter('-5900743039323389312');" onmouseout="out('-5900743039323389312');" style=""> 322           tRecord.isComplete = true;                                                                     </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 323           continue;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324         }                                                                                                </span>
<span class="-4361198270326326802" onmouseenter="enter('-4361198270326326802');" onmouseout="out('-4361198270326326802');" style=""> 325         mStartThreadNum++;                                                                               </span>
<span class="2652986304939921073" onmouseenter="enter('2652986304939921073');" onmouseout="out('2652986304939921073');" style=""> 326         if (record != null) {                                                                            </span>
<span class="-5505735994889378269" onmouseenter="enter('-5505735994889378269');" onmouseout="out('-5505735994889378269');" style=""> 327           Long temp = Long.parseLong(String.valueOf(record));                                            </span>
<span class="6949017848225026676" onmouseenter="enter('6949017848225026676');" onmouseout="out('6949017848225026676');" style=""> 328           tRecord.startLocation = temp &gt; 0 ? temp : 0;                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 329         } else {                                                                                         </span>
<span class="-2463924567028920967" onmouseenter="enter('-2463924567028920967');" onmouseout="out('-2463924567028920967');" style=""> 330           tRecord.startLocation = 0;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331         }                                                                                                </span>
<span class="8450336720909475026" onmouseenter="enter('8450336720909475026');" onmouseout="out('8450336720909475026');" style=""> 332         mRecord.threadRecords.add(tRecord);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333       }                                                                                                  </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style=""> 334       mConfigFile.delete();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336   }                                                                                                      </span>
<span  style=""> 337                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 338   /**                                                                                                    </span>
<span class="-671827589422898020" onmouseenter="enter('-671827589422898020');" onmouseout="out('-671827589422898020');" style=""> 339    * 初始化记录                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 340    */                                                                                                    </span>
<span class="7657423209226081953" onmouseenter="enter('7657423209226081953');" onmouseout="out('7657423209226081953');" style=""> 341   private void initRecord() {                                                                            </span>
<span class="1363226846886967285" onmouseenter="enter('1363226846886967285');" onmouseout="out('1363226846886967285');" style=""> 342     mRecord = new TaskRecord();                                                                          </span>
<span class="-5083582960729315317" onmouseenter="enter('-5083582960729315317');" onmouseout="out('-5083582960729315317');" style=""> 343     mRecord.fileName = mEntity.getFileName();                                                            </span>
<span class="3577925922319021061" onmouseenter="enter('3577925922319021061');" onmouseout="out('3577925922319021061');" style=""> 344     mRecord.filePath = mTaskEntity.getKey();                                                             </span>
<span class="-4117247167556656758" onmouseenter="enter('-4117247167556656758');" onmouseout="out('-4117247167556656758');" style=""> 345     mRecord.threadRecords = new ArrayList&lt;&gt;();                                                           </span>
<span class="8089432194042683150" onmouseenter="enter('8089432194042683150');" onmouseout="out('8089432194042683150');" style=""> 346     mRecord.isGroupRecord = mTaskEntity.getEntity().isGroupChild();                                      </span>
<span class="8800687954183002826" onmouseenter="enter('8800687954183002826');" onmouseout="out('8800687954183002826');" style=""> 347     if (mRecord.isGroupRecord) {                                                                         </span>
<span class="-817579183662015631" onmouseenter="enter('-817579183662015631');" onmouseout="out('-817579183662015631');" style=""> 348       if (mTaskEntity.getEntity() instanceof DownloadEntity) {                                           </span>
<span class="-7647901316480546218" onmouseenter="enter('-7647901316480546218');" onmouseout="out('-7647901316480546218');" style=""> 349         mRecord.dGroupName = ((DownloadEntity) mTaskEntity.getEntity()).getGroupName();                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 350       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352   }                                                                                                      </span>
<span  style=""> 353                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 354   /**                                                                                                    </span>
<span class="-8991940256279851469" onmouseenter="enter('-8991940256279851469');" onmouseout="out('-8991940256279851469');" style=""> 355    * 保存任务记录                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 356    */                                                                                                    </span>
<span class="1188287987342183098" onmouseenter="enter('1188287987342183098');" onmouseout="out('1188287987342183098');" style=""> 357   private void saveRecord() {                                                                            </span>
<span class="-6872584921755914518" onmouseenter="enter('-6872584921755914518');" onmouseout="out('-6872584921755914518');" style=""> 358     mRecord.threadNum = mRecord.threadRecords.size();                                                    </span>
<span class="-3343791891312496302" onmouseenter="enter('-3343791891312496302');" onmouseout="out('-3343791891312496302');" style=""> 359     mRecord.save();                                                                                      </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style=""> 360     for (ThreadRecord tr : mRecord.threadRecords) {                                                      </span>
<span class="1550150863078778036" onmouseenter="enter('1550150863078778036');" onmouseout="out('1550150863078778036');" style=""> 361       tr.save();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363   }                                                                                                      </span>
<span  style=""> 364                                                                                                          </span>
<span class="1066955891247002122" onmouseenter="enter('1066955891247002122');" onmouseout="out('1066955891247002122');" style=""> 365   public TaskRecord getRecord() {                                                                        </span>
<span class="-7223580788630505532" onmouseenter="enter('-7223580788630505532');" onmouseout="out('-7223580788630505532');" style=""> 366     return mRecord;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367   }                                                                                                      </span>
<span  style=""> 368                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 369   /**                                                                                                    </span>
<span class="7661061719912178382" onmouseenter="enter('7661061719912178382');" onmouseout="out('7661061719912178382');" style=""> 370    * 恢复记录地址                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 371    *                                                                                                     </span>
<span class="-1706428464808283045" onmouseenter="enter('-1706428464808283045');" onmouseout="out('-1706428464808283045');" style=""> 372    * @return {@code true}任务已完成                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 373    */                                                                                                    </span>
<span class="423019558917313706" onmouseenter="enter('423019558917313706');" onmouseout="out('423019558917313706');" style=""> 374   private boolean resumeRecordLocation(int i, long startL, long endL) {                                  </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style=""> 375     mConstance.CURRENT_LOCATION += endL - startL;                                                        </span>
<span class="-3554759638611896536" onmouseenter="enter('-3554759638611896536');" onmouseout="out('-3554759638611896536');" style=""> 376     ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__已完成&quot;, mTaskEntity.getEntity().getFileName(), i));           </span>
<span class="3932130165010443212" onmouseenter="enter('3932130165010443212');" onmouseout="out('3932130165010443212');" style=""> 377     mConstance.COMPLETE_THREAD_NUM = mCompleteThreadNum;                                                 </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style=""> 378     mConstance.STOP_NUM++;                                                                               </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style=""> 379     mConstance.CANCEL_NUM++;                                                                             </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style=""> 380     if (mConstance.isComplete()) {                                                                       </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style=""> 381       mRecord.deleteData();                                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 382       mListener.onComplete();                                                                            </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 383       mConstance.isRunning = false;                                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 384       return true;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385     }                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 386     return false;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387   }                                                                                                      </span>
<span  style=""> 388                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 389   /**                                                                                                    </span>
<span class="8881300510663389339" onmouseenter="enter('8881300510663389339');" onmouseout="out('8881300510663389339');" style=""> 390    * 启动断点任务时，创建单线程任务                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 391    *                                                                                                     </span>
<span class="4311889051397531831" onmouseenter="enter('4311889051397531831');" onmouseout="out('4311889051397531831');" style=""> 392    * @param i 线程id                                                                                       </span>
<span class="1230174220176038900" onmouseenter="enter('1230174220176038900');" onmouseout="out('1230174220176038900');" style=""> 393    * @param startL 该任务起始位置                                                                               </span>
<span class="1858994332528537357" onmouseenter="enter('1858994332528537357');" onmouseout="out('1858994332528537357');" style=""> 394    * @param endL 该任务结束位置                                                                                 </span>
<span class="4908980689327331914" onmouseenter="enter('4908980689327331914');" onmouseout="out('4908980689327331914');" style=""> 395    * @param fileLength 该任务需要处理的文件长度                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 396    */                                                                                                    </span>
<span class="8417307416647678377" onmouseenter="enter('8417307416647678377');" onmouseout="out('8417307416647678377');" style=""> 397   private AbsThreadTask createSingThreadTask(int i, long startL, long endL, long fileLength,             </span>
<span class="-2934306509623024164" onmouseenter="enter('-2934306509623024164');" onmouseout="out('-2934306509623024164');" style=""> 398       ThreadRecord record) {                                                                             </span>
<span class="-7768173698086340418" onmouseenter="enter('-7768173698086340418');" onmouseout="out('-7768173698086340418');" style=""> 399     SubThreadConfig&lt;TASK_ENTITY&gt; config = new SubThreadConfig&lt;&gt;();                                       </span>
<span class="-8558948078866873984" onmouseenter="enter('-8558948078866873984');" onmouseout="out('-8558948078866873984');" style=""> 400     config.FILE_SIZE = fileLength;                                                                       </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style=""> 401     config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                     </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style=""> 402     config.TEMP_FILE = mTempFile;                                                                        </span>
<span class="-8589974584258899309" onmouseenter="enter('-8589974584258899309');" onmouseout="out('-8589974584258899309');" style=""> 403     config.THREAD_ID = i;                                                                                </span>
<span class="-423990566973150114" onmouseenter="enter('-423990566973150114');" onmouseout="out('-423990566973150114');" style=""> 404     config.START_LOCATION = startL;                                                                      </span>
<span class="7030036366591044852" onmouseenter="enter('7030036366591044852');" onmouseout="out('7030036366591044852');" style=""> 405     config.END_LOCATION = endL;                                                                          </span>
<span class="4558959233585694596" onmouseenter="enter('4558959233585694596');" onmouseout="out('4558959233585694596');" style=""> 406     config.SUPPORT_BP = mTaskEntity.isSupportBP();                                                       </span>
<span class="-6844563562976749056" onmouseenter="enter('-6844563562976749056');" onmouseout="out('-6844563562976749056');" style=""> 407     config.TASK_ENTITY = mTaskEntity;                                                                    </span>
<span class="-4817448612298280426" onmouseenter="enter('-4817448612298280426');" onmouseout="out('-4817448612298280426');" style=""> 408     config.THREAD_RECORD = record;                                                                       </span>
<span class="-3921818352268167442" onmouseenter="enter('-3921818352268167442');" onmouseout="out('-3921818352268167442');" style=""> 409     return selectThreadTask(config);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410   }                                                                                                      </span>
<span  style=""> 411                                                                                                          </span>
<span class="6532423587840407518" onmouseenter="enter('6532423587840407518');" onmouseout="out('6532423587840407518');" style=""> 412   private void handleBreakpoint() {                                                                      </span>
<span class="-4822982872266026601" onmouseenter="enter('-4822982872266026601');" onmouseout="out('-4822982872266026601');" style=""> 413     long fileLength = mEntity.getFileSize();                                                             </span>
<span class="-23207299311678828" onmouseenter="enter('-23207299311678828');" onmouseout="out('-23207299311678828');" style=""> 414     long blockSize = fileLength / mTotalThreadNum;                                                       </span>
<span class="7144011642124032136" onmouseenter="enter('7144011642124032136');" onmouseout="out('7144011642124032136');" style=""> 415     int[] threadId = new int[mTotalThreadNum];                                                           </span>
<span class="794844889575716346" onmouseenter="enter('794844889575716346');" onmouseout="out('794844889575716346');" style=""> 416     int rl = 0;                                                                                          </span>
<span  style=""> 417                                                                                                          </span>
<span class="575574520788079541" onmouseenter="enter('575574520788079541');" onmouseout="out('575574520788079541');" style=""> 418     mRecord.fileLength = fileLength;                                                                     </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 419     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="5272717944804854313" onmouseenter="enter('5272717944804854313');" onmouseout="out('5272717944804854313');" style=""> 420       threadId[i] = -1;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421     }                                                                                                    </span>
<span class="3996378219805798096" onmouseenter="enter('3996378219805798096');" onmouseout="out('3996378219805798096');" style=""> 422     if (mTaskEntity.isNewTask() &amp;&amp; !handleNewTask()) {                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 423       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424     }                                                                                                    </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 425     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style=""> 426       long startL = i * blockSize, endL = (i + 1) * blockSize;                                           </span>
<span class="5090177735693834127" onmouseenter="enter('5090177735693834127');" onmouseout="out('5090177735693834127');" style=""> 427       ThreadRecord tr;                                                                                   </span>
<span class="-7836453111996726628" onmouseenter="enter('-7836453111996726628');" onmouseout="out('-7836453111996726628');" style=""> 428       boolean isNewTr = false;  // 是否是新的线程记录                                                             </span>
<span class="-6597548071328599593" onmouseenter="enter('-6597548071328599593');" onmouseout="out('-6597548071328599593');" style=""> 429       if (mTaskEntity.isNewTask()) {                                                                     </span>
<span class="-1372101013715036968" onmouseenter="enter('-1372101013715036968');" onmouseout="out('-1372101013715036968');" style=""> 430         tr = new ThreadRecord();                                                                         </span>
<span class="3917749081996930633" onmouseenter="enter('3917749081996930633');" onmouseout="out('3917749081996930633');" style=""> 431         tr.key = mRecord.filePath;                                                                       </span>
<span class="-7575886392361997801" onmouseenter="enter('-7575886392361997801');" onmouseout="out('-7575886392361997801');" style=""> 432         tr.threadId = i;                                                                                 </span>
<span class="3085824084899250864" onmouseenter="enter('3085824084899250864');" onmouseout="out('3085824084899250864');" style=""> 433         isNewTr = true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 434       } else {                                                                                           </span>
<span class="-548726359565759652" onmouseenter="enter('-548726359565759652');" onmouseout="out('-548726359565759652');" style=""> 435         tr = mRecord.threadRecords.get(i);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436       }                                                                                                  </span>
<span class="-973014210831854259" onmouseenter="enter('-973014210831854259');" onmouseout="out('-973014210831854259');" style=""> 437       if (tr.isComplete) {//该线程已经完成                                                                      </span>
<span class="5189294880655919692" onmouseenter="enter('5189294880655919692');" onmouseout="out('5189294880655919692');" style=""> 438         if (resumeRecordLocation(i, startL, endL)) return;                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 439         continue;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440       }                                                                                                  </span>
<span  style=""> 441                                                                                                          </span>
<span class="1183688269285295822" onmouseenter="enter('1183688269285295822');" onmouseout="out('1183688269285295822');" style=""> 442       //如果有记录，则恢复任务                                                                                      </span>
<span class="8289251945837025497" onmouseenter="enter('8289251945837025497');" onmouseout="out('8289251945837025497');" style=""> 443       if (tr.startLocation &gt;= 0) {                                                                       </span>
<span class="-7166560389597808593" onmouseenter="enter('-7166560389597808593');" onmouseout="out('-7166560389597808593');" style=""> 444         Long r = tr.startLocation;                                                                       </span>
<span class="-7915611879357930899" onmouseenter="enter('-7915611879357930899');" onmouseout="out('-7915611879357930899');" style=""> 445         //记录的位置需要在线程区间中                                                                                  </span>
<span class="-1441157907339638000" onmouseenter="enter('-1441157907339638000');" onmouseout="out('-1441157907339638000');" style=""> 446         if (startL &lt; r &amp;&amp; r &lt; (i == (mTotalThreadNum - 1) ? fileLength : endL)) {                        </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style=""> 447           mConstance.CURRENT_LOCATION += r - startL;                                                     </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style=""> 448           startL = r;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449         }                                                                                                </span>
<span class="5845990765500507783" onmouseenter="enter('5845990765500507783');" onmouseout="out('5845990765500507783');" style=""> 450         ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__恢复任务&quot;, mEntity.getFileName(), i));                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451       }                                                                                                  </span>
<span class="7194952027883197425" onmouseenter="enter('7194952027883197425');" onmouseout="out('7194952027883197425');" style=""> 452       //最后一个线程的结束位置即为文件的总长度                                                                              </span>
<span class="-5942950699866528890" onmouseenter="enter('-5942950699866528890');" onmouseout="out('-5942950699866528890');" style=""> 453       if (i == (mTotalThreadNum - 1)) {                                                                  </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style=""> 454         endL = fileLength;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 455       }                                                                                                  </span>
<span class="8496166720772172680" onmouseenter="enter('8496166720772172680');" onmouseout="out('8496166720772172680');" style=""> 456       // 更新记录                                                                                            </span>
<span class="635736622332337160" onmouseenter="enter('635736622332337160');" onmouseout="out('635736622332337160');" style=""> 457       tr.startLocation = startL;                                                                         </span>
<span class="-8820011367691672414" onmouseenter="enter('-8820011367691672414');" onmouseout="out('-8820011367691672414');" style=""> 458       tr.endLocation = endL;                                                                             </span>
<span class="-5584934139293502444" onmouseenter="enter('-5584934139293502444');" onmouseout="out('-5584934139293502444');" style=""> 459       if (isNewTr) {                                                                                     </span>
<span class="7750338393456465672" onmouseenter="enter('7750338393456465672');" onmouseout="out('7750338393456465672');" style=""> 460         mRecord.threadRecords.add(tr);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461       }                                                                                                  </span>
<span class="6319026600890011419" onmouseenter="enter('6319026600890011419');" onmouseout="out('6319026600890011419');" style=""> 462       AbsThreadTask task = createSingThreadTask(i, startL, endL, fileLength, tr);                        </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style=""> 463       if (task == null) return;                                                                          </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style=""> 464       mTask.put(i, task);                                                                                </span>
<span class="2496245772724592303" onmouseenter="enter('2496245772724592303');" onmouseout="out('2496245772724592303');" style=""> 465       threadId[rl] = i;                                                                                  </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style=""> 466       rl++;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 467     }                                                                                                    </span>
<span class="290274778352054232" onmouseenter="enter('290274778352054232');" onmouseout="out('290274778352054232');" style=""> 468     if (mConstance.CURRENT_LOCATION != 0                                                                 </span>
<span class="8899125546582658120" onmouseenter="enter('8899125546582658120');" onmouseout="out('8899125546582658120');" style=""> 469         &amp;&amp; mConstance.CURRENT_LOCATION != mEntity.getCurrentProgress()) {                                </span>
<span class="-107308688072847772" onmouseenter="enter('-107308688072847772');" onmouseout="out('-107308688072847772');" style=""> 470       ALog.d(TAG, &quot;进度修正&quot;);                                                                               </span>
<span class="480370803854164555" onmouseenter="enter('480370803854164555');" onmouseout="out('480370803854164555');" style=""> 471       mEntity.setCurrentProgress(mConstance.CURRENT_LOCATION);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472     }                                                                                                    </span>
<span class="-4447853798640415053" onmouseenter="enter('-4447853798640415053');" onmouseout="out('-4447853798640415053');" style=""> 473     saveRecord();                                                                                        </span>
<span class="5367791124370950090" onmouseenter="enter('5367791124370950090');" onmouseout="out('5367791124370950090');" style=""> 474     startThreadTask(threadId);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475   }                                                                                                      </span>
<span  style=""> 476                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 477   /**                                                                                                    </span>
<span class="3352756078121499684" onmouseenter="enter('3352756078121499684');" onmouseout="out('3352756078121499684');" style=""> 478    * 启动单线程任务                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 479    */                                                                                                    </span>
<span class="-4163844434134623471" onmouseenter="enter('-4163844434134623471');" onmouseout="out('-4163844434134623471');" style=""> 480   private void startThreadTask(int[] recordL) {                                                          </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style=""> 481     if (mConstance.CURRENT_LOCATION &gt; 0) {                                                               </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style=""> 482       mListener.onResume(mConstance.CURRENT_LOCATION);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 483     } else {                                                                                             </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style=""> 484       mListener.onStart(mConstance.CURRENT_LOCATION);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485     }                                                                                                    </span>
<span class="-3724057379342966503" onmouseenter="enter('-3724057379342966503');" onmouseout="out('-3724057379342966503');" style=""> 486     mFixedThreadPool = Executors.newFixedThreadPool(recordL.length);                                     </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style=""> 487     for (int l : recordL) {                                                                              </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style=""> 488       if (l == -1) continue;                                                                             </span>
<span class="-85915337091278441" onmouseenter="enter('-85915337091278441');" onmouseout="out('-85915337091278441');" style=""> 489       Runnable task = mTask.get(l);                                                                      </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 490       if (task != null) {                                                                                </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 491         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494   }                                                                                                      </span>
<span  style=""> 495                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 496   /**                                                                                                    </span>
<span class="4764351819472741633" onmouseenter="enter('4764351819472741633');" onmouseout="out('4764351819472741633');" style=""> 497    * 重试线程任务，只有线程创建成功才能重试                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 498    */                                                                                                    </span>
<span class="-5467219194911799226" onmouseenter="enter('-5467219194911799226');" onmouseout="out('-5467219194911799226');" style=""> 499   public void retryThreadTask() {                                                                        </span>
<span class="5365338227073743" onmouseenter="enter('5365338227073743');" onmouseout="out('5365338227073743');" style=""> 500     if (mTask == null || mTask.size() == 0) {                                                            </span>
<span class="-4385520730156955316" onmouseenter="enter('-4385520730156955316');" onmouseout="out('-4385520730156955316');" style=""> 501       ALog.w(TAG, &quot;没有线程任务&quot;);                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 502       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 503     }                                                                                                    </span>
<span class="-9197459414244668337" onmouseenter="enter('-9197459414244668337');" onmouseout="out('-9197459414244668337');" style=""> 504     Set&lt;Integer&gt; keys = mTask.keySet();                                                                  </span>
<span class="4969357970824756675" onmouseenter="enter('4969357970824756675');" onmouseout="out('4969357970824756675');" style=""> 505     for (Integer key : keys) {                                                                           </span>
<span class="-8581528427459564550" onmouseenter="enter('-8581528427459564550');" onmouseout="out('-8581528427459564550');" style=""> 506       AbsThreadTask task = mTask.get(key);                                                               </span>
<span class="-6295419555080725627" onmouseenter="enter('-6295419555080725627');" onmouseout="out('-6295419555080725627');" style=""> 507       if (task != null &amp;&amp; !task.isThreadComplete()) {                                                    </span>
<span class="5627547129301802684" onmouseenter="enter('5627547129301802684');" onmouseout="out('5627547129301802684');" style=""> 508         task.getConfig().START_LOCATION = task.getCurrentLocation();                                     </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 509 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="2850733480082561720" onmouseenter="enter('2850733480082561720');" onmouseout="out('2850733480082561720');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 510         mConstance.isStop = false;                                                                       </span>
<span class="-6084373575236396497" onmouseenter="enter('-6084373575236396497');" onmouseout="out('-6084373575236396497');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 511         mConstance.isCancel = false;                                                                     </span>
<span class="7884789031988873835" onmouseenter="enter('7884789031988873835');" onmouseout="out('7884789031988873835');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 512         mConstance.isRunning = true;                                                                     </span>
<span class="7735765379424984851" onmouseenter="enter('7735765379424984851');" onmouseout="out('7735765379424984851');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 513         ALog.d(TAG, String.format(&quot;任务【%s】开始重试，线程__%s__【开始位置：%s，结束位置：%s】&quot;, mEntity.getFileName(),         </span>
<span class="-669110355825383115" onmouseenter="enter('-669110355825383115');" onmouseout="out('-669110355825383115');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 514             key, task.getConfig().START_LOCATION, task.getConfig().END_LOCATION));                       </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 515 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="7735765379424984851" onmouseenter="enter('7735765379424984851');" onmouseout="out('7735765379424984851');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516         ALog.d(TAG, String.format(&quot;任务【%s】开始重试，线程__%s__【开始位置：%s，结束位置：%s】&quot;, mEntity.getFileName(),         </span>
<span class="-669110355825383115" onmouseenter="enter('-669110355825383115');" onmouseout="out('-669110355825383115');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 517             key, task.getConfig().START_LOCATION, task.getConfig().END_LOCATION));                       </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 518         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 519       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 521   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 522                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 523   /**                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 524 =======                                                                                                  </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525         ALog.d(TAG,                                                                                      </span>
<span class="-3294550289328777330" onmouseenter="enter('-3294550289328777330');" onmouseout="out('-3294550289328777330');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526             String.format(&quot;任务【%s】开始重试，线程__%s__【开始位置：%s，结束位置：%s】&quot;, mEntity.getFileName(), key,            </span>
<span class="-1022518935466510561" onmouseenter="enter('-1022518935466510561');" onmouseout="out('-1022518935466510561');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527                 task.getConfig().START_LOCATION, task.getConfig().END_LOCATION));                        </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 528 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 529         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 531     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532   }                                                                                                      </span>
<span  style=""> 533                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 534   /**                                                                                                    </span>
<span class="3489882028140634260" onmouseenter="enter('3489882028140634260');" onmouseout="out('3489882028140634260');" style=""> 535    * 处理新任务                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 536    *                                                                                                     </span>
<span class="8941769692798326625" onmouseenter="enter('8941769692798326625');" onmouseout="out('8941769692798326625');" style=""> 537    * @return {@code true}创建新任务失败                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 538    */                                                                                                    </span>
<span class="3897453149098456479" onmouseenter="enter('3897453149098456479');" onmouseout="out('3897453149098456479');" style=""> 539   protected abstract boolean handleNewTask();                                                            </span>
<span  style=""> 540                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 541   /**                                                                                                    </span>
<span class="-4404408971562231280" onmouseenter="enter('-4404408971562231280');" onmouseout="out('-4404408971562231280');" style=""> 542    * 处理不支持断点的任务                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 543    */                                                                                                    </span>
<span class="-8792279366871913220" onmouseenter="enter('-8792279366871913220');" onmouseout="out('-8792279366871913220');" style=""> 544   private void handleNoSupportBP() {                                                                     </span>
<span class="-7768173698086340418" onmouseenter="enter('-7768173698086340418');" onmouseout="out('-7768173698086340418');" style=""> 545     SubThreadConfig&lt;TASK_ENTITY&gt; config = new SubThreadConfig&lt;&gt;();                                       </span>
<span class="-8916543478630030690" onmouseenter="enter('-8916543478630030690');" onmouseout="out('-8916543478630030690');" style=""> 546     config.FILE_SIZE = mEntity.getFileSize();                                                            </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style=""> 547     config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                     </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style=""> 548     config.TEMP_FILE = mTempFile;                                                                        </span>
<span class="-5899809357890352135" onmouseenter="enter('-5899809357890352135');" onmouseout="out('-5899809357890352135');" style=""> 549     config.THREAD_ID = 0;                                                                                </span>
<span class="7958711547477559333" onmouseenter="enter('7958711547477559333');" onmouseout="out('7958711547477559333');" style=""> 550     config.START_LOCATION = 0;                                                                           </span>
<span class="911498546153633759" onmouseenter="enter('911498546153633759');" onmouseout="out('911498546153633759');" style=""> 551     config.END_LOCATION = config.FILE_SIZE;                                                              </span>
<span class="4558959233585694596" onmouseenter="enter('4558959233585694596');" onmouseout="out('4558959233585694596');" style=""> 552     config.SUPPORT_BP = mTaskEntity.isSupportBP();                                                       </span>
<span class="-6844563562976749056" onmouseenter="enter('-6844563562976749056');" onmouseout="out('-6844563562976749056');" style=""> 553     config.TASK_ENTITY = mTaskEntity;                                                                    </span>
<span class="-5296271627358693026" onmouseenter="enter('-5296271627358693026');" onmouseout="out('-5296271627358693026');" style=""> 554     AbsThreadTask task = selectThreadTask(config);                                                       </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style=""> 555     if (task == null) return;                                                                            </span>
<span class="8048363116921461760" onmouseenter="enter('8048363116921461760');" onmouseout="out('8048363116921461760');" style=""> 556     mTask.put(0, task);                                                                                  </span>
<span class="4151941088630277800" onmouseenter="enter('4151941088630277800');" onmouseout="out('4151941088630277800');" style=""> 557     mFixedThreadPool = Executors.newFixedThreadPool(1);                                                  </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 558     mFixedThreadPool.execute(task);                                                                      </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style=""> 559     mListener.onStart(0);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 560   }                                                                                                      </span>
<span  style=""> 561                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 562   /**                                                                                                    </span>
<span class="5502854491504205724" onmouseenter="enter('5502854491504205724');" onmouseout="out('5502854491504205724');" style=""> 563    * 选择单任务线程的类型                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 564    */                                                                                                    </span>
<span class="-158713741323683937" onmouseenter="enter('-158713741323683937');" onmouseout="out('-158713741323683937');" style=""> 565   protected abstract AbsThreadTask selectThreadTask(SubThreadConfig&lt;TASK_ENTITY&gt; config);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 566 }                                                                                                        </span>







</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16 package com.arialyy.aria.core.common;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  18 import android.content.Context;                                                                          </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  19 import com.arialyy.aria.core.AriaManager;                                                                </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="">  20 import com.arialyy.aria.core.download.DownloadEntity;                                                    </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  21 import com.arialyy.aria.core.inf.AbsNormalEntity;                                                        </span>
<span class="4195608340199028072" onmouseenter="enter('4195608340199028072');" onmouseout="out('4195608340199028072');" style="">  22 import com.arialyy.aria.core.inf.AbsTaskEntity;                                                          </span>
<span class="-2820121753251967085" onmouseenter="enter('-2820121753251967085');" onmouseout="out('-2820121753251967085');" style="">  23 import com.arialyy.aria.core.inf.IDownloadListener;                                                      </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  24 import com.arialyy.aria.core.inf.IEventListener;                                                         </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="">  25 import com.arialyy.aria.orm.DbEntity;                                                                    </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  26 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  27 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="4945295635398100121" onmouseenter="enter('4945295635398100121');" onmouseout="out('4945295635398100121');" style="">  28 import com.arialyy.aria.util.DbHelper;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  29 import java.io.File;                                                                                     </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  30 import java.util.ArrayList;                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  31 import java.util.HashMap;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  32 import java.util.HashSet;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  33 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  34 import java.util.Map;                                                                                    </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  35 import java.util.Properties;                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  36 import java.util.Set;                                                                                    </span>
<span class="-3789567581486736748" onmouseenter="enter('-3789567581486736748');" onmouseout="out('-3789567581486736748');" style="">  37 import java.util.Timer;                                                                                  </span>
<span class="-2321797189340986544" onmouseenter="enter('-2321797189340986544');" onmouseout="out('-2321797189340986544');" style="">  38 import java.util.TimerTask;                                                                              </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  39 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  40 import java.util.concurrent.Executors;                                                                   </span>
<span  style="">  41                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  42 /**                                                                                                      </span>
<span class="6972081778092176351" onmouseenter="enter('6972081778092176351');" onmouseout="out('6972081778092176351');" style="">  43  * Created by AriaL on 2017/7/1.                                                                         </span>
<span class="-3350964092441836737" onmouseenter="enter('-3350964092441836737');" onmouseout="out('-3350964092441836737');" style="">  44  * 任务处理器                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  45  */                                                                                                      </span>
<span class="-4202835391474719331" onmouseenter="enter('-4202835391474719331');" onmouseout="out('-4202835391474719331');" style=""><abbr title="  46 public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_ENTITY extends AbsTaskEntity&lt;ENTITY&gt;&gt;">  46 public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_ENTITY extends AbsTaskEntity&lt;ENTITY&gt;🔵</abbr></span>
<span class="-1728503718485911871" onmouseenter="enter('-1728503718485911871');" onmouseout="out('-1728503718485911871');" style="">  47     implements Runnable, IUtil {                                                                         </span>
<span class="8962793429617957612" onmouseenter="enter('8962793429617957612');" onmouseout="out('8962793429617957612');" style="">  48   private static final String STATE = &quot;_state_&quot;;                                                         </span>
<span class="4155209368239822413" onmouseenter="enter('4155209368239822413');" onmouseout="out('4155209368239822413');" style="">  49   private static final String RECORD = &quot;_record_&quot;;                                                       </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50   /**                                                                                                    </span>
<span class="-1980722710912279499" onmouseenter="enter('-1980722710912279499');" onmouseout="out('-1980722710912279499');" style="">  51    * 小于1m的文件不启用多线程                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52    */                                                                                                    </span>
<span class="-5660290514964746700" onmouseenter="enter('-5660290514964746700');" onmouseout="out('-5660290514964746700');" style="">  53   protected static final long SUB_LEN = 1024 * 1024;                                                     </span>
<span  style="">  54                                                                                                          </span>
<span class="7185037452507187216" onmouseenter="enter('7185037452507187216');" onmouseout="out('7185037452507187216');" style="">  55   private final String TAG = &quot;AbsFileer&quot;;                                                                </span>
<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="">  56   protected IEventListener mListener;                                                                    </span>
<span class="-1948152884108661875" onmouseenter="enter('-1948152884108661875');" onmouseout="out('-1948152884108661875');" style="">  57   protected TASK_ENTITY mTaskEntity;                                                                     </span>
<span class="8904454574412257163" onmouseenter="enter('8904454574412257163');" onmouseout="out('8904454574412257163');" style="">  58   protected ENTITY mEntity;                                                                              </span>
<span class="-8914417138860252644" onmouseenter="enter('-8914417138860252644');" onmouseout="out('-8914417138860252644');" style="">  59   protected Context mContext;                                                                            </span>
<span class="3740841846621187936" onmouseenter="enter('3740841846621187936');" onmouseout="out('3740841846621187936');" style="">  60   protected File mTempFile; //文件                                                                         </span>
<span class="-5211593385781091233" onmouseenter="enter('-5211593385781091233');" onmouseout="out('-5211593385781091233');" style="">  61   protected StateConstance mConstance;                                                                   </span>
<span class="1058453114158093994" onmouseenter="enter('1058453114158093994');" onmouseout="out('1058453114158093994');" style="">  62   private ExecutorService mFixedThreadPool;                                                              </span>
<span class="-7729852228955968495" onmouseenter="enter('-7729852228955968495');" onmouseout="out('-7729852228955968495');" style="">  63   //总线程数                                                                                                 </span>
<span class="8506024364762319503" onmouseenter="enter('8506024364762319503');" onmouseout="out('8506024364762319503');" style="">  64   protected int mTotalThreadNum;                                                                         </span>
<span class="1064880922655578719" onmouseenter="enter('1064880922655578719');" onmouseout="out('1064880922655578719');" style="">  65   //启动线程数                                                                                                </span>
<span class="5843971981435686054" onmouseenter="enter('5843971981435686054');" onmouseout="out('5843971981435686054');" style="">  66   private int mStartThreadNum;                                                                           </span>
<span class="6869677327514827795" onmouseenter="enter('6869677327514827795');" onmouseout="out('6869677327514827795');" style="">  67   //已完成的线程数                                                                                              </span>
<span class="8146256445432145550" onmouseenter="enter('8146256445432145550');" onmouseout="out('8146256445432145550');" style="">  68   private int mCompleteThreadNum;                                                                        </span>
<span class="-3545799492252297873" onmouseenter="enter('-3545799492252297873');" onmouseout="out('-3545799492252297873');" style="">  69   private Map&lt;Integer, AbsThreadTask&gt; mTask = new HashMap&lt;&gt;();                                           </span>
<span  style="">  70                                                                                                          </span>
<span class="2545797703164998155" onmouseenter="enter('2545797703164998155');" onmouseout="out('2545797703164998155');" style="">  71   private Timer mTimer;                                                                                  </span>
<span class="-6913167534336436900" onmouseenter="enter('-6913167534336436900');" onmouseout="out('-6913167534336436900');" style="">  72   @Deprecated private File mConfigFile;                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  73   /**                                                                                                    </span>
<span class="7539908978715582123" onmouseenter="enter('7539908978715582123');" onmouseout="out('7539908978715582123');" style="">  74    * 进度刷新间隔                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  75    */                                                                                                    </span>
<span class="3897731617107507824" onmouseenter="enter('3897731617107507824');" onmouseout="out('3897731617107507824');" style="">  76   private long mUpdateInterval = 1000;                                                                   </span>
<span class="-5884447509953456722" onmouseenter="enter('-5884447509953456722');" onmouseout="out('-5884447509953456722');" style="">  77   private TaskRecord mRecord;                                                                            </span>
<span  style="">  78                                                                                                          </span>
<span class="2891934549353689856" onmouseenter="enter('2891934549353689856');" onmouseout="out('2891934549353689856');" style="">  79   protected AbsFileer(IEventListener listener, TASK_ENTITY taskEntity) {                                 </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  80     mListener = listener;                                                                                </span>
<span class="8662994215762856538" onmouseenter="enter('8662994215762856538');" onmouseout="out('8662994215762856538');" style="">  81     mTaskEntity = taskEntity;                                                                            </span>
<span class="-4840298181735982119" onmouseenter="enter('-4840298181735982119');" onmouseout="out('-4840298181735982119');" style="">  82     mEntity = mTaskEntity.getEntity();                                                                   </span>
<span class="1002707508041764251" onmouseenter="enter('1002707508041764251');" onmouseout="out('1002707508041764251');" style="">  83     mContext = AriaManager.APP;                                                                          </span>
<span class="-3948532274682189145" onmouseenter="enter('-3948532274682189145');" onmouseout="out('-3948532274682189145');" style="">  84     mConstance = new StateConstance();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85   }                                                                                                      </span>
<span  style="">  86                                                                                                          </span>
<span class="-8210434580109369245" onmouseenter="enter('-8210434580109369245');" onmouseout="out('-8210434580109369245');" style="">  87   public void setNewTask(boolean newTask) {                                                              </span>
<span class="7261549057242337382" onmouseenter="enter('7261549057242337382');" onmouseout="out('7261549057242337382');" style="">  88     mTaskEntity.setNewTask(newTask);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89   }                                                                                                      </span>
<span  style="">  90                                                                                                          </span>
<span class="2509123758179905267" onmouseenter="enter('2509123758179905267');" onmouseout="out('2509123758179905267');" style="">  91   @Override public void setMaxSpeed(double maxSpeed) {                                                   </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style="">  92     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style="">  93       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="">  94       if (task != null) {                                                                                </span>
<span class="8974054037700404915" onmouseenter="enter('8974054037700404915');" onmouseout="out('8974054037700404915');" style="">  95         task.setMaxSpeed(maxSpeed);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98   }                                                                                                      </span>
<span  style="">  99                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 100   @Override public void run() {                                                                          </span>
<span class="2383691993380925204" onmouseenter="enter('2383691993380925204');" onmouseout="out('2383691993380925204');" style=""> 101     if (mConstance.isRunning) {                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 102       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103     }                                                                                                    </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 104     startFlow();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105   }                                                                                                      </span>
<span  style=""> 106                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 107   /**                                                                                                    </span>
<span class="-8036989040377605484" onmouseenter="enter('-8036989040377605484');" onmouseout="out('-8036989040377605484');" style=""> 108    * 开始流程                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 109    */                                                                                                    </span>
<span class="2659446283962947526" onmouseenter="enter('2659446283962947526');" onmouseout="out('2659446283962947526');" style=""> 110   private void startFlow() {                                                                             </span>
<span class="619404821214964502" onmouseenter="enter('619404821214964502');" onmouseout="out('619404821214964502');" style=""> 111     mConstance.resetState();                                                                             </span>
<span class="1290437685045115531" onmouseenter="enter('1290437685045115531');" onmouseout="out('1290437685045115531');" style=""> 112     checkTask();                                                                                         </span>
<span class="6200019808906550914" onmouseenter="enter('6200019808906550914');" onmouseout="out('6200019808906550914');" style=""> 113     mConstance.TASK_RECORD = mRecord;                                                                    </span>
<span class="4780862748684536259" onmouseenter="enter('4780862748684536259');" onmouseout="out('4780862748684536259');" style=""> 114     if (mListener instanceof IDownloadListener) {                                                        </span>
<span class="937780446443407951" onmouseenter="enter('937780446443407951');" onmouseout="out('937780446443407951');" style=""> 115       ((IDownloadListener) mListener).onPostPre(mEntity.getFileSize());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116     }                                                                                                    </span>
<span class="8755928574405213439" onmouseenter="enter('8755928574405213439');" onmouseout="out('8755928574405213439');" style=""> 117     if (!mTaskEntity.isSupportBP()) {                                                                    </span>
<span class="-7445970306128807043" onmouseenter="enter('-7445970306128807043');" onmouseout="out('-7445970306128807043');" style=""> 118       mTotalThreadNum = 1;                                                                               </span>
<span class="-1191691332114182414" onmouseenter="enter('-1191691332114182414');" onmouseout="out('-1191691332114182414');" style=""> 119       mStartThreadNum = 1;                                                                               </span>
<span class="-6182854007095635032" onmouseenter="enter('-6182854007095635032');" onmouseout="out('-6182854007095635032');" style=""> 120       handleNoSupportBP();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 121     } else {                                                                                             </span>
<span class="-2662097366456595872" onmouseenter="enter('-2662097366456595872');" onmouseout="out('-2662097366456595872');" style=""> 122       mTotalThreadNum =                                                                                  </span>
<span class="2293773823409558899" onmouseenter="enter('2293773823409558899');" onmouseout="out('2293773823409558899');" style=""> 123           mTaskEntity.isNewTask() ? (mStartThreadNum = setNewTaskThreadNum()) : mTotalThreadNum;         </span>
<span class="304482857231090385" onmouseenter="enter('304482857231090385');" onmouseout="out('304482857231090385');" style=""> 124       handleBreakpoint();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125     }                                                                                                    </span>
<span class="-5070363508518577757" onmouseenter="enter('-5070363508518577757');" onmouseout="out('-5070363508518577757');" style=""> 126     mConstance.START_THREAD_NUM = mTotalThreadNum;                                                       </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 127     /*                                                                                                   </span>
<span class="-7459715513064469337" onmouseenter="enter('-7459715513064469337');" onmouseout="out('-7459715513064469337');" style=""> 128      * mTaskEntity.getEntity().getFileSize() != mTempFile.length()为兼容以前老版本代码                             </span>
<span class="-5520474084619660394" onmouseenter="enter('-5520474084619660394');" onmouseout="out('-5520474084619660394');" style=""> 129      * 动态长度条件：                                                                                           </span>
<span class="6678836087239710153" onmouseenter="enter('6678836087239710153');" onmouseout="out('6678836087239710153');" style=""> 130      * 1、总线程数为1，并且是新任务                                                                                   </span>
<span class="-8594380126502433751" onmouseenter="enter('-8594380126502433751');" onmouseout="out('-8594380126502433751');" style=""> 131      * 2、总线程数为1，不是新任务，但是长度不是文件全长度                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 132      */                                                                                                  </span>
<span class="-763935913933084661" onmouseenter="enter('-763935913933084661');" onmouseout="out('-763935913933084661');" style=""> 133     if (mTotalThreadNum == 1 &amp;&amp; (mTaskEntity.isNewTask()                                                 </span>
<span class="-3606193574981639369" onmouseenter="enter('-3606193574981639369');" onmouseout="out('-3606193574981639369');" style=""> 134         || mTaskEntity.getEntity().getFileSize() != mTempFile.length())) {                               </span>
<span class="9204016926254181097" onmouseenter="enter('9204016926254181097');" onmouseout="out('9204016926254181097');" style=""> 135       mConstance.isOpenDynamicFile = true;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136     }                                                                                                    </span>
<span class="-7724548171203838725" onmouseenter="enter('-7724548171203838725');" onmouseout="out('-7724548171203838725');" style=""> 137     startTimer();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138   }                                                                                                      </span>
<span  style=""> 139                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 140   /**                                                                                                    </span>
<span class="-5386582613838574396" onmouseenter="enter('-5386582613838574396');" onmouseout="out('-5386582613838574396');" style=""> 141    * 设置新任务的最大线程数                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 142    */                                                                                                    </span>
<span class="-6137859098551091137" onmouseenter="enter('-6137859098551091137');" onmouseout="out('-6137859098551091137');" style=""> 143   protected abstract int setNewTaskThreadNum();                                                          </span>
<span  style=""> 144                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 145   /**                                                                                                    </span>
<span class="4041581137177203435" onmouseenter="enter('4041581137177203435');" onmouseout="out('4041581137177203435');" style=""> 146    * 启动进度获取定时器                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 147    */                                                                                                    </span>
<span class="-8560002621884285761" onmouseenter="enter('-8560002621884285761');" onmouseout="out('-8560002621884285761');" style=""> 148   private void startTimer() {                                                                            </span>
<span class="9064905857115753880" onmouseenter="enter('9064905857115753880');" onmouseout="out('9064905857115753880');" style=""> 149     mTimer = new Timer(true);                                                                            </span>
<span class="1767883212426599488" onmouseenter="enter('1767883212426599488');" onmouseout="out('1767883212426599488');" style=""> 150     mTimer.schedule(new TimerTask() {                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 151       @Override public void run() {                                                                      </span>
<span class="5257678828672457716" onmouseenter="enter('5257678828672457716');" onmouseout="out('5257678828672457716');" style=""> 152         if (mConstance.isComplete()                                                                      </span>
<span class="334343515162691172" onmouseenter="enter('334343515162691172');" onmouseout="out('334343515162691172');" style=""> 153             || mConstance.isStop()                                                                       </span>
<span class="3923616872544648792" onmouseenter="enter('3923616872544648792');" onmouseout="out('3923616872544648792');" style=""> 154             || mConstance.isCancel()                                                                     </span>
<span class="-6728476664925849707" onmouseenter="enter('-6728476664925849707');" onmouseout="out('-6728476664925849707');" style=""> 155             || !mConstance.isRunning) {                                                                  </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 156           closeTimer();                                                                                  </span>
<span class="5358021077686010059" onmouseenter="enter('5358021077686010059');" onmouseout="out('5358021077686010059');" style=""> 157         } else if (mConstance.CURRENT_LOCATION &gt;= 0) {                                                   </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style=""> 158           mListener.onProgress(mConstance.CURRENT_LOCATION);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160       }                                                                                                  </span>
<span class="-3821686044197757132" onmouseenter="enter('-3821686044197757132');" onmouseout="out('-3821686044197757132');" style=""> 161     }, 0, mUpdateInterval);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162   }                                                                                                      </span>
<span  style=""> 163                                                                                                          </span>
<span class="6987763365729675608" onmouseenter="enter('6987763365729675608');" onmouseout="out('6987763365729675608');" style=""> 164   protected void closeTimer() {                                                                          </span>
<span class="-4343220603110256261" onmouseenter="enter('-4343220603110256261');" onmouseout="out('-4343220603110256261');" style=""> 165     if (mTimer != null) {                                                                                </span>
<span class="6506490333649261220" onmouseenter="enter('6506490333649261220');" onmouseout="out('6506490333649261220');" style=""> 166       mTimer.purge();                                                                                    </span>
<span class="3936422701741233911" onmouseenter="enter('3936422701741233911');" onmouseout="out('3936422701741233911');" style=""> 167       mTimer.cancel();                                                                                   </span>
<span class="-3760473013259053076" onmouseenter="enter('-3760473013259053076');" onmouseout="out('-3760473013259053076');" style=""> 168       mTimer = null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170   }                                                                                                      </span>
<span  style=""> 171                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 172   /**                                                                                                    </span>
<span class="3310122691908792895" onmouseenter="enter('3310122691908792895');" onmouseout="out('3310122691908792895');" style=""> 173    * 设置定时器更新间隔                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 174    *                                                                                                     </span>
<span class="5926421498368036592" onmouseenter="enter('5926421498368036592');" onmouseout="out('5926421498368036592');" style=""> 175    * @param interval 单位毫秒，不能小于0                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 176    */                                                                                                    </span>
<span class="-6143371944494222779" onmouseenter="enter('-6143371944494222779');" onmouseout="out('-6143371944494222779');" style=""> 177   protected void setUpdateInterval(long interval) {                                                      </span>
<span class="-1051498944097002766" onmouseenter="enter('-1051498944097002766');" onmouseout="out('-1051498944097002766');" style=""> 178     if (interval &lt; 0) {                                                                                  </span>
<span class="3000915396455271078" onmouseenter="enter('3000915396455271078');" onmouseout="out('3000915396455271078');" style=""> 179       ALog.w(TAG, &quot;更新间隔不能小于0，默认为1000毫秒&quot;);                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 180       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181     }                                                                                                    </span>
<span class="-3431322530378656562" onmouseenter="enter('-3431322530378656562');" onmouseout="out('-3431322530378656562');" style=""> 182     mUpdateInterval = interval;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183   }                                                                                                      </span>
<span  style=""> 184                                                                                                          </span>
<span class="-4506592131726080634" onmouseenter="enter('-4506592131726080634');" onmouseout="out('-4506592131726080634');" style=""> 185   @Override public long getFileSize() {                                                                  </span>
<span class="-7902485770489300682" onmouseenter="enter('-7902485770489300682');" onmouseout="out('-7902485770489300682');" style=""> 186     return mEntity.getFileSize();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187   }                                                                                                      </span>
<span  style=""> 188                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 189   /**                                                                                                    </span>
<span class="-7288086523564906780" onmouseenter="enter('-7288086523564906780');" onmouseout="out('-7288086523564906780');" style=""> 190    * 获取当前任务位置                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 191    */                                                                                                    </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style=""> 192   @Override public long getCurrentLocation() {                                                           </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style=""> 193     return mConstance.CURRENT_LOCATION;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194   }                                                                                                      </span>
<span  style=""> 195                                                                                                          </span>
<span class="-2237798856776801835" onmouseenter="enter('-2237798856776801835');" onmouseout="out('-2237798856776801835');" style=""> 196   @Override public boolean isRunning() {                                                                 </span>
<span class="-9220268812159037756" onmouseenter="enter('-9220268812159037756');" onmouseout="out('-9220268812159037756');" style=""> 197     return mConstance.isRunning;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198   }                                                                                                      </span>
<span  style=""> 199                                                                                                          </span>
<span class="305234216015554819" onmouseenter="enter('305234216015554819');" onmouseout="out('305234216015554819');" style=""> 200   @Override public void cancel() {                                                                       </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 201     closeTimer();                                                                                        </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 202     mConstance.isRunning = false;                                                                        </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style=""> 203     mConstance.isCancel = true;                                                                          </span>
<span class="-1828001720390047641" onmouseenter="enter('-1828001720390047641');" onmouseout="out('-1828001720390047641');" style=""> 204     if (mFixedThreadPool != null) {                                                                      </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style=""> 205       mFixedThreadPool.shutdown();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206     }                                                                                                    </span>
<span class="-612803506725482722" onmouseenter="enter('-612803506725482722');" onmouseout="out('-612803506725482722');" style=""> 207     for (int i = 0; i &lt; mStartThreadNum; i++) {                                                          </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 208       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 209       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style=""> 210         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213   }                                                                                                      </span>
<span  style=""> 214                                                                                                          </span>
<span class="6276273225669041403" onmouseenter="enter('6276273225669041403');" onmouseout="out('6276273225669041403');" style=""> 215   @Override public void stop() {                                                                         </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 216     closeTimer();                                                                                        </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 217     mConstance.isRunning = false;                                                                        </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style=""> 218     mConstance.isStop = true;                                                                            </span>
<span class="8402005296375476854" onmouseenter="enter('8402005296375476854');" onmouseout="out('8402005296375476854');" style=""> 219     if (mConstance.isComplete()) return;                                                                 </span>
<span class="-1828001720390047641" onmouseenter="enter('-1828001720390047641');" onmouseout="out('-1828001720390047641');" style=""> 220     if (mFixedThreadPool != null) {                                                                      </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style=""> 221       mFixedThreadPool.shutdown();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222     }                                                                                                    </span>
<span class="-612803506725482722" onmouseenter="enter('-612803506725482722');" onmouseout="out('-612803506725482722');" style=""> 223     for (int i = 0; i &lt; mStartThreadNum; i++) {                                                          </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 224       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 225       if (task != null) {                                                                                </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style=""> 226         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229   }                                                                                                      </span>
<span  style=""> 230                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 231   /**                                                                                                    </span>
<span class="-7218687507933415946" onmouseenter="enter('-7218687507933415946');" onmouseout="out('-7218687507933415946');" style=""> 232    * 直接调用的时候会自动启动线程执行                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 233    */                                                                                                    </span>
<span class="2908281040877937362" onmouseenter="enter('2908281040877937362');" onmouseout="out('2908281040877937362');" style=""> 234   @Override public void start() {                                                                        </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style=""> 235     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236   }                                                                                                      </span>
<span  style=""> 237                                                                                                          </span>
<span class="-1531467598256645714" onmouseenter="enter('-1531467598256645714');" onmouseout="out('-1531467598256645714');" style=""> 238   @Override public void resume() {                                                                       </span>
<span class="-6183578153083367222" onmouseenter="enter('-6183578153083367222');" onmouseout="out('-6183578153083367222');" style=""> 239     start();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240   }                                                                                                      </span>
<span  style=""> 241                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 242   /**                                                                                                    </span>
<span class="-5594313128981442446" onmouseenter="enter('-5594313128981442446');" onmouseout="out('-5594313128981442446');" style=""> 243    * 检查任务、检查线程数                                                                                          </span>
<span class="5765812458735380113" onmouseenter="enter('5765812458735380113');" onmouseout="out('5765812458735380113');" style=""> 244    * 新任务条件：                                                                                              </span>
<span class="-3418470207445181215" onmouseenter="enter('-3418470207445181215');" onmouseout="out('-3418470207445181215');" style=""> 245    * 1、文件不存在                                                                                             </span>
<span class="1471172295356331660" onmouseenter="enter('1471172295356331660');" onmouseout="out('1471172295356331660');" style=""> 246    * 2、任务记录文件缺失或不匹配                                                                                      </span>
<span class="4400956412852543180" onmouseenter="enter('4400956412852543180');" onmouseout="out('4400956412852543180');" style=""> 247    * 3、数据库记录不存在                                                                                          </span>
<span class="1878350678984943375" onmouseenter="enter('1878350678984943375');" onmouseout="out('1878350678984943375');" style=""> 248    * 4、不支持断点，则是新任务                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 249    */                                                                                                    </span>
<span class="-8432905628195545001" onmouseenter="enter('-8432905628195545001');" onmouseout="out('-8432905628195545001');" style=""> 250   private void checkTask() {                                                                             </span>
<span class="-5297450492380711808" onmouseenter="enter('-5297450492380711808');" onmouseout="out('-5297450492380711808');" style=""> 251     mConfigFile = new File(CommonUtil.getFileConfigPath(false, mEntity.getFileName()));                  </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style=""> 252     if (mConfigFile.exists()) {                                                                          </span>
<span class="7932310618145443523" onmouseenter="enter('7932310618145443523');" onmouseout="out('7932310618145443523');" style=""> 253       convertDb();                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 254     } else {                                                                                             </span>
<span class="-5238664810335263343" onmouseenter="enter('-5238664810335263343');" onmouseout="out('-5238664810335263343');" style=""> 255       mRecord = DbHelper.getTaskRecord(mTaskEntity.getKey());                                            </span>
<span class="-3299415613061807412" onmouseenter="enter('-3299415613061807412');" onmouseout="out('-3299415613061807412');" style=""> 256       if (mRecord == null) {                                                                             </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 257         initRecord();                                                                                    </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 258         mTaskEntity.setNewTask(true);                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 259       } else {                                                                                           </span>
<span class="-7168613097949101282" onmouseenter="enter('-7168613097949101282');" onmouseout="out('-7168613097949101282');" style=""> 260         if (mRecord.threadRecords == null || mRecord.threadRecords.isEmpty()) {                          </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 261           initRecord();                                                                                  </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 262           mTaskEntity.setNewTask(true);                                                                  </span>
<span class="-4489756692986098869" onmouseenter="enter('-4489756692986098869');" onmouseout="out('-4489756692986098869');" style=""> 263         } else if (mTempFile.length() == 0) {                                                            </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style=""> 264           mRecord.deleteData();                                                                          </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 265           initRecord();                                                                                  </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 266           mTaskEntity.setNewTask(true);                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 267         } else {                                                                                         </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style=""> 268           for (ThreadRecord tr : mRecord.threadRecords) {                                                </span>
<span class="-6249885869558348483" onmouseenter="enter('-6249885869558348483');" onmouseout="out('-6249885869558348483');" style=""> 269             if (tr.isComplete) {                                                                         </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style=""> 270               mCompleteThreadNum++;                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 271             } else {                                                                                     </span>
<span class="-4361198270326326802" onmouseenter="enter('-4361198270326326802');" onmouseout="out('-4361198270326326802');" style=""> 272               mStartThreadNum++;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274           }                                                                                              </span>
<span class="-4812553014330515673" onmouseenter="enter('-4812553014330515673');" onmouseout="out('-4812553014330515673');" style=""> 275           mTotalThreadNum = mRecord.threadRecords.size();                                                </span>
<span class="-561823525574412259" onmouseenter="enter('-561823525574412259');" onmouseout="out('-561823525574412259');" style=""> 276           mTaskEntity.setNewTask(false);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280   }                                                                                                      </span>
<span  style=""> 281                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 282   /**                                                                                                    </span>
<span class="1070716404183585489" onmouseenter="enter('1070716404183585489');" onmouseout="out('1070716404183585489');" style=""> 283    * convertDb 为兼容性代码                                                                                    </span>
<span class="3982968248834793214" onmouseenter="enter('3982968248834793214');" onmouseout="out('3982968248834793214');" style=""> 284    * 从3.4.1开始，线程配置信息将存储在数据库中。                                                                            </span>
<span class="-6928102974415786303" onmouseenter="enter('-6928102974415786303');" onmouseout="out('-6928102974415786303');" style=""> 285    * 将配置文件的内容复制到数据库中，并将配置文件删除                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 286    */                                                                                                    </span>
<span class="14298455509427519" onmouseenter="enter('14298455509427519');" onmouseout="out('14298455509427519');" style=""> 287   private void convertDb() {                                                                             </span>
<span class="-4598298306615401010" onmouseenter="enter('-4598298306615401010');" onmouseout="out('-4598298306615401010');" style=""> 288     List&lt;RecordWrapper&gt; records =                                                                        </span>
<span class="-4738968014729726274" onmouseenter="enter('-4738968014729726274');" onmouseout="out('-4738968014729726274');" style=""> 289         DbEntity.findRelationData(RecordWrapper.class, &quot;TaskRecord.filePath=?&quot;,                          </span>
<span class="96831814087260276" onmouseenter="enter('96831814087260276');" onmouseout="out('96831814087260276');" style=""> 290             mTaskEntity.getKey());                                                                       </span>
<span class="-376648440877788579" onmouseenter="enter('-376648440877788579');" onmouseout="out('-376648440877788579');" style=""> 291     if (records == null || records.size() == 0) {                                                        </span>
<span class="7274393295178915569" onmouseenter="enter('7274393295178915569');" onmouseout="out('7274393295178915569');" style=""> 292       Properties pro = CommonUtil.loadConfig(mConfigFile);                                               </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style=""> 293       if (pro.isEmpty()) {                                                                               </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 294         mTaskEntity.setNewTask(true);                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 295         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296       }                                                                                                  </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 297       initRecord();                                                                                      </span>
<span class="-4092719147494026286" onmouseenter="enter('-4092719147494026286');" onmouseout="out('-4092719147494026286');" style=""> 298       Set&lt;Object&gt; keys = pro.keySet();                                                                   </span>
<span class="7117164647387083506" onmouseenter="enter('7117164647387083506');" onmouseout="out('7117164647387083506');" style=""> 299       // 老版本记录是5s存一次，但是5s中内，如果线程执行完成，record记录是没有的，只有state记录...                                           </span>
<span class="8442347856216504710" onmouseenter="enter('8442347856216504710');" onmouseout="out('8442347856216504710');" style=""> 300       // 第一步应该是record 和 state去重取正确的线程数                                                                   </span>
<span class="3880560860847601414" onmouseenter="enter('3880560860847601414');" onmouseout="out('3880560860847601414');" style=""> 301       Set&lt;Integer&gt; set = new HashSet&lt;&gt;();                                                                </span>
<span class="-5644624400733519290" onmouseenter="enter('-5644624400733519290');" onmouseout="out('-5644624400733519290');" style=""> 302       for (Object key : keys) {                                                                          </span>
<span class="-90111359741489740" onmouseenter="enter('-90111359741489740');" onmouseout="out('-90111359741489740');" style=""> 303         String str = String.valueOf(key);                                                                </span>
<span class="5431713397557299419" onmouseenter="enter('5431713397557299419');" onmouseout="out('5431713397557299419');" style=""> 304         int i = Integer.parseInt(str.substring(str.length() - 1, str.length()));                         </span>
<span class="5139166377005733880" onmouseenter="enter('5139166377005733880');" onmouseout="out('5139166377005733880');" style=""> 305         set.add(i);                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306       }                                                                                                  </span>
<span class="1773727540275693887" onmouseenter="enter('1773727540275693887');" onmouseout="out('1773727540275693887');" style=""> 307       int threadNum = set.size();                                                                        </span>
<span class="1658307869252768908" onmouseenter="enter('1658307869252768908');" onmouseout="out('1658307869252768908');" style=""> 308       if (threadNum == 0) {                                                                              </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 309         mTaskEntity.setNewTask(true);                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 310         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311       }                                                                                                  </span>
<span class="8980547023143351106" onmouseenter="enter('8980547023143351106');" onmouseout="out('8980547023143351106');" style=""> 312       mRecord.threadNum = threadNum;                                                                     </span>
<span class="1082026445239340300" onmouseenter="enter('1082026445239340300');" onmouseout="out('1082026445239340300');" style=""> 313       mTotalThreadNum = threadNum;                                                                       </span>
<span  style=""> 314                                                                                                          </span>
<span class="92058997093189211" onmouseenter="enter('92058997093189211');" onmouseout="out('92058997093189211');" style=""> 315       for (int i = 0; i &lt; threadNum; i++) {                                                              </span>
<span class="1846142719149590893" onmouseenter="enter('1846142719149590893');" onmouseout="out('1846142719149590893');" style=""> 316         ThreadRecord tRecord = new ThreadRecord();                                                       </span>
<span class="-543854586085341709" onmouseenter="enter('-543854586085341709');" onmouseout="out('-543854586085341709');" style=""> 317         tRecord.key = mRecord.filePath;                                                                  </span>
<span class="-1285896534897014429" onmouseenter="enter('-1285896534897014429');" onmouseout="out('-1285896534897014429');" style=""> 318         Object state = pro.getProperty(mTempFile.getName() + STATE + i);                                 </span>
<span class="7744986855104654034" onmouseenter="enter('7744986855104654034');" onmouseout="out('7744986855104654034');" style=""> 319         Object record = pro.getProperty(mTempFile.getName() + RECORD + i);                               </span>
<span class="-1417732743646819816" onmouseenter="enter('-1417732743646819816');" onmouseout="out('-1417732743646819816');" style=""> 320         if (state != null &amp;&amp; Integer.parseInt(String.valueOf(state)) == 1) {                             </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style=""> 321           mCompleteThreadNum++;                                                                          </span>
<span class="-5900743039323389312" onmouseenter="enter('-5900743039323389312');" onmouseout="out('-5900743039323389312');" style=""> 322           tRecord.isComplete = true;                                                                     </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 323           continue;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324         }                                                                                                </span>
<span class="-4361198270326326802" onmouseenter="enter('-4361198270326326802');" onmouseout="out('-4361198270326326802');" style=""> 325         mStartThreadNum++;                                                                               </span>
<span class="2652986304939921073" onmouseenter="enter('2652986304939921073');" onmouseout="out('2652986304939921073');" style=""> 326         if (record != null) {                                                                            </span>
<span class="-5505735994889378269" onmouseenter="enter('-5505735994889378269');" onmouseout="out('-5505735994889378269');" style=""> 327           Long temp = Long.parseLong(String.valueOf(record));                                            </span>
<span class="6949017848225026676" onmouseenter="enter('6949017848225026676');" onmouseout="out('6949017848225026676');" style=""> 328           tRecord.startLocation = temp &gt; 0 ? temp : 0;                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 329         } else {                                                                                         </span>
<span class="-2463924567028920967" onmouseenter="enter('-2463924567028920967');" onmouseout="out('-2463924567028920967');" style=""> 330           tRecord.startLocation = 0;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331         }                                                                                                </span>
<span class="8450336720909475026" onmouseenter="enter('8450336720909475026');" onmouseout="out('8450336720909475026');" style=""> 332         mRecord.threadRecords.add(tRecord);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333       }                                                                                                  </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style=""> 334       mConfigFile.delete();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336   }                                                                                                      </span>
<span  style=""> 337                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 338   /**                                                                                                    </span>
<span class="-671827589422898020" onmouseenter="enter('-671827589422898020');" onmouseout="out('-671827589422898020');" style=""> 339    * 初始化记录                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 340    */                                                                                                    </span>
<span class="7657423209226081953" onmouseenter="enter('7657423209226081953');" onmouseout="out('7657423209226081953');" style=""> 341   private void initRecord() {                                                                            </span>
<span class="1363226846886967285" onmouseenter="enter('1363226846886967285');" onmouseout="out('1363226846886967285');" style=""> 342     mRecord = new TaskRecord();                                                                          </span>
<span class="-5083582960729315317" onmouseenter="enter('-5083582960729315317');" onmouseout="out('-5083582960729315317');" style=""> 343     mRecord.fileName = mEntity.getFileName();                                                            </span>
<span class="3577925922319021061" onmouseenter="enter('3577925922319021061');" onmouseout="out('3577925922319021061');" style=""> 344     mRecord.filePath = mTaskEntity.getKey();                                                             </span>
<span class="-4117247167556656758" onmouseenter="enter('-4117247167556656758');" onmouseout="out('-4117247167556656758');" style=""> 345     mRecord.threadRecords = new ArrayList&lt;&gt;();                                                           </span>
<span class="8089432194042683150" onmouseenter="enter('8089432194042683150');" onmouseout="out('8089432194042683150');" style=""> 346     mRecord.isGroupRecord = mTaskEntity.getEntity().isGroupChild();                                      </span>
<span class="8800687954183002826" onmouseenter="enter('8800687954183002826');" onmouseout="out('8800687954183002826');" style=""> 347     if (mRecord.isGroupRecord) {                                                                         </span>
<span class="-817579183662015631" onmouseenter="enter('-817579183662015631');" onmouseout="out('-817579183662015631');" style=""> 348       if (mTaskEntity.getEntity() instanceof DownloadEntity) {                                           </span>
<span class="-7647901316480546218" onmouseenter="enter('-7647901316480546218');" onmouseout="out('-7647901316480546218');" style=""> 349         mRecord.dGroupName = ((DownloadEntity) mTaskEntity.getEntity()).getGroupName();                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 350       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352   }                                                                                                      </span>
<span  style=""> 353                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 354   /**                                                                                                    </span>
<span class="-8991940256279851469" onmouseenter="enter('-8991940256279851469');" onmouseout="out('-8991940256279851469');" style=""> 355    * 保存任务记录                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 356    */                                                                                                    </span>
<span class="1188287987342183098" onmouseenter="enter('1188287987342183098');" onmouseout="out('1188287987342183098');" style=""> 357   private void saveRecord() {                                                                            </span>
<span class="-6872584921755914518" onmouseenter="enter('-6872584921755914518');" onmouseout="out('-6872584921755914518');" style=""> 358     mRecord.threadNum = mRecord.threadRecords.size();                                                    </span>
<span class="-3343791891312496302" onmouseenter="enter('-3343791891312496302');" onmouseout="out('-3343791891312496302');" style=""> 359     mRecord.save();                                                                                      </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style=""> 360     for (ThreadRecord tr : mRecord.threadRecords) {                                                      </span>
<span class="1550150863078778036" onmouseenter="enter('1550150863078778036');" onmouseout="out('1550150863078778036');" style=""> 361       tr.save();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363   }                                                                                                      </span>
<span  style=""> 364                                                                                                          </span>
<span class="1066955891247002122" onmouseenter="enter('1066955891247002122');" onmouseout="out('1066955891247002122');" style=""> 365   public TaskRecord getRecord() {                                                                        </span>
<span class="-7223580788630505532" onmouseenter="enter('-7223580788630505532');" onmouseout="out('-7223580788630505532');" style=""> 366     return mRecord;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367   }                                                                                                      </span>
<span  style=""> 368                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 369   /**                                                                                                    </span>
<span class="7661061719912178382" onmouseenter="enter('7661061719912178382');" onmouseout="out('7661061719912178382');" style=""> 370    * 恢复记录地址                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 371    *                                                                                                     </span>
<span class="-1706428464808283045" onmouseenter="enter('-1706428464808283045');" onmouseout="out('-1706428464808283045');" style=""> 372    * @return {@code true}任务已完成                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 373    */                                                                                                    </span>
<span class="423019558917313706" onmouseenter="enter('423019558917313706');" onmouseout="out('423019558917313706');" style=""> 374   private boolean resumeRecordLocation(int i, long startL, long endL) {                                  </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style=""> 375     mConstance.CURRENT_LOCATION += endL - startL;                                                        </span>
<span class="-3554759638611896536" onmouseenter="enter('-3554759638611896536');" onmouseout="out('-3554759638611896536');" style=""> 376     ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__已完成&quot;, mTaskEntity.getEntity().getFileName(), i));           </span>
<span class="3932130165010443212" onmouseenter="enter('3932130165010443212');" onmouseout="out('3932130165010443212');" style=""> 377     mConstance.COMPLETE_THREAD_NUM = mCompleteThreadNum;                                                 </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style=""> 378     mConstance.STOP_NUM++;                                                                               </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style=""> 379     mConstance.CANCEL_NUM++;                                                                             </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style=""> 380     if (mConstance.isComplete()) {                                                                       </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style=""> 381       mRecord.deleteData();                                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 382       mListener.onComplete();                                                                            </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 383       mConstance.isRunning = false;                                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 384       return true;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385     }                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 386     return false;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387   }                                                                                                      </span>
<span  style=""> 388                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 389   /**                                                                                                    </span>
<span class="8881300510663389339" onmouseenter="enter('8881300510663389339');" onmouseout="out('8881300510663389339');" style=""> 390    * 启动断点任务时，创建单线程任务                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 391    *                                                                                                     </span>
<span class="4311889051397531831" onmouseenter="enter('4311889051397531831');" onmouseout="out('4311889051397531831');" style=""> 392    * @param i 线程id                                                                                       </span>
<span class="1230174220176038900" onmouseenter="enter('1230174220176038900');" onmouseout="out('1230174220176038900');" style=""> 393    * @param startL 该任务起始位置                                                                               </span>
<span class="1858994332528537357" onmouseenter="enter('1858994332528537357');" onmouseout="out('1858994332528537357');" style=""> 394    * @param endL 该任务结束位置                                                                                 </span>
<span class="4908980689327331914" onmouseenter="enter('4908980689327331914');" onmouseout="out('4908980689327331914');" style=""> 395    * @param fileLength 该任务需要处理的文件长度                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 396    */                                                                                                    </span>
<span class="8417307416647678377" onmouseenter="enter('8417307416647678377');" onmouseout="out('8417307416647678377');" style=""> 397   private AbsThreadTask createSingThreadTask(int i, long startL, long endL, long fileLength,             </span>
<span class="-2934306509623024164" onmouseenter="enter('-2934306509623024164');" onmouseout="out('-2934306509623024164');" style=""> 398       ThreadRecord record) {                                                                             </span>
<span class="-7768173698086340418" onmouseenter="enter('-7768173698086340418');" onmouseout="out('-7768173698086340418');" style=""> 399     SubThreadConfig&lt;TASK_ENTITY&gt; config = new SubThreadConfig&lt;&gt;();                                       </span>
<span class="-8558948078866873984" onmouseenter="enter('-8558948078866873984');" onmouseout="out('-8558948078866873984');" style=""> 400     config.FILE_SIZE = fileLength;                                                                       </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style=""> 401     config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                     </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style=""> 402     config.TEMP_FILE = mTempFile;                                                                        </span>
<span class="-8589974584258899309" onmouseenter="enter('-8589974584258899309');" onmouseout="out('-8589974584258899309');" style=""> 403     config.THREAD_ID = i;                                                                                </span>
<span class="-423990566973150114" onmouseenter="enter('-423990566973150114');" onmouseout="out('-423990566973150114');" style=""> 404     config.START_LOCATION = startL;                                                                      </span>
<span class="7030036366591044852" onmouseenter="enter('7030036366591044852');" onmouseout="out('7030036366591044852');" style=""> 405     config.END_LOCATION = endL;                                                                          </span>
<span class="4558959233585694596" onmouseenter="enter('4558959233585694596');" onmouseout="out('4558959233585694596');" style=""> 406     config.SUPPORT_BP = mTaskEntity.isSupportBP();                                                       </span>
<span class="-6844563562976749056" onmouseenter="enter('-6844563562976749056');" onmouseout="out('-6844563562976749056');" style=""> 407     config.TASK_ENTITY = mTaskEntity;                                                                    </span>
<span class="-4817448612298280426" onmouseenter="enter('-4817448612298280426');" onmouseout="out('-4817448612298280426');" style=""> 408     config.THREAD_RECORD = record;                                                                       </span>
<span class="-3921818352268167442" onmouseenter="enter('-3921818352268167442');" onmouseout="out('-3921818352268167442');" style=""> 409     return selectThreadTask(config);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410   }                                                                                                      </span>
<span  style=""> 411                                                                                                          </span>
<span class="6532423587840407518" onmouseenter="enter('6532423587840407518');" onmouseout="out('6532423587840407518');" style=""> 412   private void handleBreakpoint() {                                                                      </span>
<span class="-4822982872266026601" onmouseenter="enter('-4822982872266026601');" onmouseout="out('-4822982872266026601');" style=""> 413     long fileLength = mEntity.getFileSize();                                                             </span>
<span class="-23207299311678828" onmouseenter="enter('-23207299311678828');" onmouseout="out('-23207299311678828');" style=""> 414     long blockSize = fileLength / mTotalThreadNum;                                                       </span>
<span class="7144011642124032136" onmouseenter="enter('7144011642124032136');" onmouseout="out('7144011642124032136');" style=""> 415     int[] threadId = new int[mTotalThreadNum];                                                           </span>
<span class="794844889575716346" onmouseenter="enter('794844889575716346');" onmouseout="out('794844889575716346');" style=""> 416     int rl = 0;                                                                                          </span>
<span  style=""> 417                                                                                                          </span>
<span class="575574520788079541" onmouseenter="enter('575574520788079541');" onmouseout="out('575574520788079541');" style=""> 418     mRecord.fileLength = fileLength;                                                                     </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 419     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="5272717944804854313" onmouseenter="enter('5272717944804854313');" onmouseout="out('5272717944804854313');" style=""> 420       threadId[i] = -1;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421     }                                                                                                    </span>
<span class="3996378219805798096" onmouseenter="enter('3996378219805798096');" onmouseout="out('3996378219805798096');" style=""> 422     if (mTaskEntity.isNewTask() &amp;&amp; !handleNewTask()) {                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 423       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424     }                                                                                                    </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 425     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style=""> 426       long startL = i * blockSize, endL = (i + 1) * blockSize;                                           </span>
<span class="5090177735693834127" onmouseenter="enter('5090177735693834127');" onmouseout="out('5090177735693834127');" style=""> 427       ThreadRecord tr;                                                                                   </span>
<span class="-7836453111996726628" onmouseenter="enter('-7836453111996726628');" onmouseout="out('-7836453111996726628');" style=""> 428       boolean isNewTr = false;  // 是否是新的线程记录                                                             </span>
<span class="-6597548071328599593" onmouseenter="enter('-6597548071328599593');" onmouseout="out('-6597548071328599593');" style=""> 429       if (mTaskEntity.isNewTask()) {                                                                     </span>
<span class="-1372101013715036968" onmouseenter="enter('-1372101013715036968');" onmouseout="out('-1372101013715036968');" style=""> 430         tr = new ThreadRecord();                                                                         </span>
<span class="3917749081996930633" onmouseenter="enter('3917749081996930633');" onmouseout="out('3917749081996930633');" style=""> 431         tr.key = mRecord.filePath;                                                                       </span>
<span class="-7575886392361997801" onmouseenter="enter('-7575886392361997801');" onmouseout="out('-7575886392361997801');" style=""> 432         tr.threadId = i;                                                                                 </span>
<span class="3085824084899250864" onmouseenter="enter('3085824084899250864');" onmouseout="out('3085824084899250864');" style=""> 433         isNewTr = true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 434       } else {                                                                                           </span>
<span class="-548726359565759652" onmouseenter="enter('-548726359565759652');" onmouseout="out('-548726359565759652');" style=""> 435         tr = mRecord.threadRecords.get(i);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436       }                                                                                                  </span>
<span class="-973014210831854259" onmouseenter="enter('-973014210831854259');" onmouseout="out('-973014210831854259');" style=""> 437       if (tr.isComplete) {//该线程已经完成                                                                      </span>
<span class="5189294880655919692" onmouseenter="enter('5189294880655919692');" onmouseout="out('5189294880655919692');" style=""> 438         if (resumeRecordLocation(i, startL, endL)) return;                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 439         continue;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440       }                                                                                                  </span>
<span  style=""> 441                                                                                                          </span>
<span class="1183688269285295822" onmouseenter="enter('1183688269285295822');" onmouseout="out('1183688269285295822');" style=""> 442       //如果有记录，则恢复任务                                                                                      </span>
<span class="8289251945837025497" onmouseenter="enter('8289251945837025497');" onmouseout="out('8289251945837025497');" style=""> 443       if (tr.startLocation &gt;= 0) {                                                                       </span>
<span class="-7166560389597808593" onmouseenter="enter('-7166560389597808593');" onmouseout="out('-7166560389597808593');" style=""> 444         Long r = tr.startLocation;                                                                       </span>
<span class="-7915611879357930899" onmouseenter="enter('-7915611879357930899');" onmouseout="out('-7915611879357930899');" style=""> 445         //记录的位置需要在线程区间中                                                                                  </span>
<span class="-1441157907339638000" onmouseenter="enter('-1441157907339638000');" onmouseout="out('-1441157907339638000');" style=""> 446         if (startL &lt; r &amp;&amp; r &lt; (i == (mTotalThreadNum - 1) ? fileLength : endL)) {                        </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style=""> 447           mConstance.CURRENT_LOCATION += r - startL;                                                     </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style=""> 448           startL = r;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449         }                                                                                                </span>
<span class="5845990765500507783" onmouseenter="enter('5845990765500507783');" onmouseout="out('5845990765500507783');" style=""> 450         ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__恢复任务&quot;, mEntity.getFileName(), i));                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451       }                                                                                                  </span>
<span class="7194952027883197425" onmouseenter="enter('7194952027883197425');" onmouseout="out('7194952027883197425');" style=""> 452       //最后一个线程的结束位置即为文件的总长度                                                                              </span>
<span class="-5942950699866528890" onmouseenter="enter('-5942950699866528890');" onmouseout="out('-5942950699866528890');" style=""> 453       if (i == (mTotalThreadNum - 1)) {                                                                  </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style=""> 454         endL = fileLength;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 455       }                                                                                                  </span>
<span class="8496166720772172680" onmouseenter="enter('8496166720772172680');" onmouseout="out('8496166720772172680');" style=""> 456       // 更新记录                                                                                            </span>
<span class="635736622332337160" onmouseenter="enter('635736622332337160');" onmouseout="out('635736622332337160');" style=""> 457       tr.startLocation = startL;                                                                         </span>
<span class="-8820011367691672414" onmouseenter="enter('-8820011367691672414');" onmouseout="out('-8820011367691672414');" style=""> 458       tr.endLocation = endL;                                                                             </span>
<span class="-5584934139293502444" onmouseenter="enter('-5584934139293502444');" onmouseout="out('-5584934139293502444');" style=""> 459       if (isNewTr) {                                                                                     </span>
<span class="7750338393456465672" onmouseenter="enter('7750338393456465672');" onmouseout="out('7750338393456465672');" style=""> 460         mRecord.threadRecords.add(tr);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461       }                                                                                                  </span>
<span class="6319026600890011419" onmouseenter="enter('6319026600890011419');" onmouseout="out('6319026600890011419');" style=""> 462       AbsThreadTask task = createSingThreadTask(i, startL, endL, fileLength, tr);                        </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style=""> 463       if (task == null) return;                                                                          </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style=""> 464       mTask.put(i, task);                                                                                </span>
<span class="2496245772724592303" onmouseenter="enter('2496245772724592303');" onmouseout="out('2496245772724592303');" style=""> 465       threadId[rl] = i;                                                                                  </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style=""> 466       rl++;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 467     }                                                                                                    </span>
<span class="290274778352054232" onmouseenter="enter('290274778352054232');" onmouseout="out('290274778352054232');" style=""> 468     if (mConstance.CURRENT_LOCATION != 0                                                                 </span>
<span class="8899125546582658120" onmouseenter="enter('8899125546582658120');" onmouseout="out('8899125546582658120');" style=""> 469         &amp;&amp; mConstance.CURRENT_LOCATION != mEntity.getCurrentProgress()) {                                </span>
<span class="-107308688072847772" onmouseenter="enter('-107308688072847772');" onmouseout="out('-107308688072847772');" style=""> 470       ALog.d(TAG, &quot;进度修正&quot;);                                                                               </span>
<span class="480370803854164555" onmouseenter="enter('480370803854164555');" onmouseout="out('480370803854164555');" style=""> 471       mEntity.setCurrentProgress(mConstance.CURRENT_LOCATION);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472     }                                                                                                    </span>
<span class="-4447853798640415053" onmouseenter="enter('-4447853798640415053');" onmouseout="out('-4447853798640415053');" style=""> 473     saveRecord();                                                                                        </span>
<span class="5367791124370950090" onmouseenter="enter('5367791124370950090');" onmouseout="out('5367791124370950090');" style=""> 474     startThreadTask(threadId);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475   }                                                                                                      </span>
<span  style=""> 476                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 477   /**                                                                                                    </span>
<span class="3352756078121499684" onmouseenter="enter('3352756078121499684');" onmouseout="out('3352756078121499684');" style=""> 478    * 启动单线程任务                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 479    */                                                                                                    </span>
<span class="-4163844434134623471" onmouseenter="enter('-4163844434134623471');" onmouseout="out('-4163844434134623471');" style=""> 480   private void startThreadTask(int[] recordL) {                                                          </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style=""> 481     if (mConstance.CURRENT_LOCATION &gt; 0) {                                                               </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style=""> 482       mListener.onResume(mConstance.CURRENT_LOCATION);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 483     } else {                                                                                             </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style=""> 484       mListener.onStart(mConstance.CURRENT_LOCATION);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485     }                                                                                                    </span>
<span class="-3724057379342966503" onmouseenter="enter('-3724057379342966503');" onmouseout="out('-3724057379342966503');" style=""> 486     mFixedThreadPool = Executors.newFixedThreadPool(recordL.length);                                     </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style=""> 487     for (int l : recordL) {                                                                              </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style=""> 488       if (l == -1) continue;                                                                             </span>
<span class="-85915337091278441" onmouseenter="enter('-85915337091278441');" onmouseout="out('-85915337091278441');" style=""> 489       Runnable task = mTask.get(l);                                                                      </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 490       if (task != null) {                                                                                </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 491         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494   }                                                                                                      </span>
<span  style=""> 495                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 496   /**                                                                                                    </span>
<span class="4764351819472741633" onmouseenter="enter('4764351819472741633');" onmouseout="out('4764351819472741633');" style=""> 497    * 重试线程任务，只有线程创建成功才能重试                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 498    */                                                                                                    </span>
<span class="-5467219194911799226" onmouseenter="enter('-5467219194911799226');" onmouseout="out('-5467219194911799226');" style=""> 499   public void retryThreadTask() {                                                                        </span>
<span class="5365338227073743" onmouseenter="enter('5365338227073743');" onmouseout="out('5365338227073743');" style=""> 500     if (mTask == null || mTask.size() == 0) {                                                            </span>
<span class="-4385520730156955316" onmouseenter="enter('-4385520730156955316');" onmouseout="out('-4385520730156955316');" style=""> 501       ALog.w(TAG, &quot;没有线程任务&quot;);                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 502       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 503     }                                                                                                    </span>
<span class="-9197459414244668337" onmouseenter="enter('-9197459414244668337');" onmouseout="out('-9197459414244668337');" style=""> 504     Set&lt;Integer&gt; keys = mTask.keySet();                                                                  </span>
<span class="4969357970824756675" onmouseenter="enter('4969357970824756675');" onmouseout="out('4969357970824756675');" style=""> 505     for (Integer key : keys) {                                                                           </span>
<span class="-8581528427459564550" onmouseenter="enter('-8581528427459564550');" onmouseout="out('-8581528427459564550');" style=""> 506       AbsThreadTask task = mTask.get(key);                                                               </span>
<span class="-6295419555080725627" onmouseenter="enter('-6295419555080725627');" onmouseout="out('-6295419555080725627');" style=""> 507       if (task != null &amp;&amp; !task.isThreadComplete()) {                                                    </span>
<span class="5627547129301802684" onmouseenter="enter('5627547129301802684');" onmouseout="out('5627547129301802684');" style=""> 508         task.getConfig().START_LOCATION = task.getCurrentLocation();                                     </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 509 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="2850733480082561720" onmouseenter="enter('2850733480082561720');" onmouseout="out('2850733480082561720');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 510         mConstance.isStop = false;                                                                       </span>
<span class="-6084373575236396497" onmouseenter="enter('-6084373575236396497');" onmouseout="out('-6084373575236396497');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 511         mConstance.isCancel = false;                                                                     </span>
<span class="7884789031988873835" onmouseenter="enter('7884789031988873835');" onmouseout="out('7884789031988873835');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 512         mConstance.isRunning = true;                                                                     </span>
<span class="7735765379424984851" onmouseenter="enter('7735765379424984851');" onmouseout="out('7735765379424984851');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 513         ALog.d(TAG, String.format(&quot;任务【%s】开始重试，线程__%s__【开始位置：%s，结束位置：%s】&quot;, mEntity.getFileName(),         </span>
<span class="-669110355825383115" onmouseenter="enter('-669110355825383115');" onmouseout="out('-669110355825383115');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 514             key, task.getConfig().START_LOCATION, task.getConfig().END_LOCATION));                       </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 515 ||||||| BASE                                                                                             </span>
<span class="7735765379424984851" onmouseenter="enter('7735765379424984851');" onmouseout="out('7735765379424984851');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516         ALog.d(TAG, String.format(&quot;任务【%s】开始重试，线程__%s__【开始位置：%s，结束位置：%s】&quot;, mEntity.getFileName(),         </span>
<span class="-669110355825383115" onmouseenter="enter('-669110355825383115');" onmouseout="out('-669110355825383115');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 517             key, task.getConfig().START_LOCATION, task.getConfig().END_LOCATION));                       </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 518         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 519       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 521 =======                                                                                                  </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522         ALog.d(TAG,                                                                                      </span>
<span class="-3294550289328777330" onmouseenter="enter('-3294550289328777330');" onmouseout="out('-3294550289328777330');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523             String.format(&quot;任务【%s】开始重试，线程__%s__【开始位置：%s，结束位置：%s】&quot;, mEntity.getFileName(), key,            </span>
<span class="-1022518935466510561" onmouseenter="enter('-1022518935466510561');" onmouseout="out('-1022518935466510561');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524                 task.getConfig().START_LOCATION, task.getConfig().END_LOCATION));                        </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 525 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 526         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 527       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529   }                                                                                                      </span>
<span  style=""> 530                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 531   /**                                                                                                    </span>
<span class="3489882028140634260" onmouseenter="enter('3489882028140634260');" onmouseout="out('3489882028140634260');" style=""> 532    * 处理新任务                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 533    *                                                                                                     </span>
<span class="8941769692798326625" onmouseenter="enter('8941769692798326625');" onmouseout="out('8941769692798326625');" style=""> 534    * @return {@code true}创建新任务失败                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 535    */                                                                                                    </span>
<span class="3897453149098456479" onmouseenter="enter('3897453149098456479');" onmouseout="out('3897453149098456479');" style=""> 536   protected abstract boolean handleNewTask();                                                            </span>
<span  style=""> 537                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 538   /**                                                                                                    </span>
<span class="-4404408971562231280" onmouseenter="enter('-4404408971562231280');" onmouseout="out('-4404408971562231280');" style=""> 539    * 处理不支持断点的任务                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 540    */                                                                                                    </span>
<span class="-8792279366871913220" onmouseenter="enter('-8792279366871913220');" onmouseout="out('-8792279366871913220');" style=""> 541   private void handleNoSupportBP() {                                                                     </span>
<span class="-7768173698086340418" onmouseenter="enter('-7768173698086340418');" onmouseout="out('-7768173698086340418');" style=""> 542     SubThreadConfig&lt;TASK_ENTITY&gt; config = new SubThreadConfig&lt;&gt;();                                       </span>
<span class="-8916543478630030690" onmouseenter="enter('-8916543478630030690');" onmouseout="out('-8916543478630030690');" style=""> 543     config.FILE_SIZE = mEntity.getFileSize();                                                            </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style=""> 544     config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                     </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style=""> 545     config.TEMP_FILE = mTempFile;                                                                        </span>
<span class="-5899809357890352135" onmouseenter="enter('-5899809357890352135');" onmouseout="out('-5899809357890352135');" style=""> 546     config.THREAD_ID = 0;                                                                                </span>
<span class="7958711547477559333" onmouseenter="enter('7958711547477559333');" onmouseout="out('7958711547477559333');" style=""> 547     config.START_LOCATION = 0;                                                                           </span>
<span class="911498546153633759" onmouseenter="enter('911498546153633759');" onmouseout="out('911498546153633759');" style=""> 548     config.END_LOCATION = config.FILE_SIZE;                                                              </span>
<span class="4558959233585694596" onmouseenter="enter('4558959233585694596');" onmouseout="out('4558959233585694596');" style=""> 549     config.SUPPORT_BP = mTaskEntity.isSupportBP();                                                       </span>
<span class="-6844563562976749056" onmouseenter="enter('-6844563562976749056');" onmouseout="out('-6844563562976749056');" style=""> 550     config.TASK_ENTITY = mTaskEntity;                                                                    </span>
<span class="-5296271627358693026" onmouseenter="enter('-5296271627358693026');" onmouseout="out('-5296271627358693026');" style=""> 551     AbsThreadTask task = selectThreadTask(config);                                                       </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style=""> 552     if (task == null) return;                                                                            </span>
<span class="8048363116921461760" onmouseenter="enter('8048363116921461760');" onmouseout="out('8048363116921461760');" style=""> 553     mTask.put(0, task);                                                                                  </span>
<span class="4151941088630277800" onmouseenter="enter('4151941088630277800');" onmouseout="out('4151941088630277800');" style=""> 554     mFixedThreadPool = Executors.newFixedThreadPool(1);                                                  </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 555     mFixedThreadPool.execute(task);                                                                      </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style=""> 556     mListener.onStart(0);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 557   }                                                                                                      </span>
<span  style=""> 558                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 559   /**                                                                                                    </span>
<span class="5502854491504205724" onmouseenter="enter('5502854491504205724');" onmouseout="out('5502854491504205724');" style=""> 560    * 选择单任务线程的类型                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 561    */                                                                                                    </span>
<span class="-158713741323683937" onmouseenter="enter('-158713741323683937');" onmouseout="out('-158713741323683937');" style=""> 562   protected abstract AbsThreadTask selectThreadTask(SubThreadConfig&lt;TASK_ENTITY&gt; config);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 563 }                                                                                                        </span>










</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16 package com.arialyy.aria.core.common;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  18 import android.content.Context;                                                                          </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  19 import com.arialyy.aria.core.AriaManager;                                                                </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="">  20 import com.arialyy.aria.core.download.DownloadEntity;                                                    </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  21 import com.arialyy.aria.core.inf.AbsNormalEntity;                                                        </span>
<span class="4195608340199028072" onmouseenter="enter('4195608340199028072');" onmouseout="out('4195608340199028072');" style="">  22 import com.arialyy.aria.core.inf.AbsTaskEntity;                                                          </span>
<span class="-2820121753251967085" onmouseenter="enter('-2820121753251967085');" onmouseout="out('-2820121753251967085');" style="">  23 import com.arialyy.aria.core.inf.IDownloadListener;                                                      </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  24 import com.arialyy.aria.core.inf.IEventListener;                                                         </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="">  25 import com.arialyy.aria.orm.DbEntity;                                                                    </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  26 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  27 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="4945295635398100121" onmouseenter="enter('4945295635398100121');" onmouseout="out('4945295635398100121');" style="">  28 import com.arialyy.aria.util.DbHelper;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  29 import java.io.File;                                                                                     </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  30 import java.util.ArrayList;                                                                              </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  31 import java.util.HashMap;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  32 import java.util.HashSet;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  33 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  34 import java.util.Map;                                                                                    </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  35 import java.util.Properties;                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  36 import java.util.Set;                                                                                    </span>
<span class="-3789567581486736748" onmouseenter="enter('-3789567581486736748');" onmouseout="out('-3789567581486736748');" style="">  37 import java.util.Timer;                                                                                  </span>
<span class="-2321797189340986544" onmouseenter="enter('-2321797189340986544');" onmouseout="out('-2321797189340986544');" style="">  38 import java.util.TimerTask;                                                                              </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  39 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  40 import java.util.concurrent.Executors;                                                                   </span>
<span  style="">  41                                                                                                          </span>
<span  style="">  42                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  43 /**                                                                                                      </span>
<span class="6972081778092176351" onmouseenter="enter('6972081778092176351');" onmouseout="out('6972081778092176351');" style="">  44  * Created by AriaL on 2017/7/1.                                                                         </span>
<span class="-3350964092441836737" onmouseenter="enter('-3350964092441836737');" onmouseout="out('-3350964092441836737');" style="">  45  * 任务处理器                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  46  */                                                                                                      </span>
<span class="-5011307702339011994" onmouseenter="enter('-5011307702339011994');" onmouseout="out('-5011307702339011994');" style=""><abbr title="  47 public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_ENTITY extends AbsTaskEntity&lt;ENTITY&gt;&gt; implements Runnable , IUtil {">  47 public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_ENTITY extends AbsTaskEntity&lt;ENTITY&gt;🔵</abbr></span>
<span class="8962793429617957612" onmouseenter="enter('8962793429617957612');" onmouseout="out('8962793429617957612');" style="">  48   private static final String STATE = &quot;_state_&quot;;                                                         </span>
<span  style="">  49                                                                                                          </span>
<span class="4155209368239822413" onmouseenter="enter('4155209368239822413');" onmouseout="out('4155209368239822413');" style="">  50   private static final String RECORD = &quot;_record_&quot;;                                                       </span>
<span  style="">  51                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  52   /**                                                                                                    </span>
<span class="-1980722710912279499" onmouseenter="enter('-1980722710912279499');" onmouseout="out('-1980722710912279499');" style="">  53    * 小于1m的文件不启用多线程                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  54    */                                                                                                    </span>
<span class="-5660290514964746700" onmouseenter="enter('-5660290514964746700');" onmouseout="out('-5660290514964746700');" style="">  55   protected static final long SUB_LEN = 1024 * 1024;                                                     </span>
<span  style="">  56                                                                                                          </span>
<span class="7185037452507187216" onmouseenter="enter('7185037452507187216');" onmouseout="out('7185037452507187216');" style="">  57   private final String TAG = &quot;AbsFileer&quot;;                                                                </span>
<span  style="">  58                                                                                                          </span>
<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="">  59   protected IEventListener mListener;                                                                    </span>
<span  style="">  60                                                                                                          </span>
<span class="-1948152884108661875" onmouseenter="enter('-1948152884108661875');" onmouseout="out('-1948152884108661875');" style="">  61   protected TASK_ENTITY mTaskEntity;                                                                     </span>
<span  style="">  62                                                                                                          </span>
<span class="8904454574412257163" onmouseenter="enter('8904454574412257163');" onmouseout="out('8904454574412257163');" style="">  63   protected ENTITY mEntity;                                                                              </span>
<span  style="">  64                                                                                                          </span>
<span class="-8914417138860252644" onmouseenter="enter('-8914417138860252644');" onmouseout="out('-8914417138860252644');" style="">  65   protected Context mContext;                                                                            </span>
<span  style="">  66                                                                                                          </span>
<span class="1387987755988337068" onmouseenter="enter('1387987755988337068');" onmouseout="out('1387987755988337068');" style="">  67   //文件                                                                                                   </span>
<span class="3740841846621187936" onmouseenter="enter('3740841846621187936');" onmouseout="out('3740841846621187936');" style="">  68   protected File mTempFile; //文件                                                                         </span>
<span  style="">  69                                                                                                          </span>
<span class="-5211593385781091233" onmouseenter="enter('-5211593385781091233');" onmouseout="out('-5211593385781091233');" style="">  70   protected StateConstance mConstance;                                                                   </span>
<span  style="">  71                                                                                                          </span>
<span class="1058453114158093994" onmouseenter="enter('1058453114158093994');" onmouseout="out('1058453114158093994');" style="">  72   private ExecutorService mFixedThreadPool;                                                              </span>
<span  style="">  73                                                                                                          </span>
<span class="-7729852228955968495" onmouseenter="enter('-7729852228955968495');" onmouseout="out('-7729852228955968495');" style="">  74   //总线程数                                                                                                 </span>
<span class="-7729852228955968495" onmouseenter="enter('-7729852228955968495');" onmouseout="out('-7729852228955968495');" style="">  75   //总线程数                                                                                                 </span>
<span class="8506024364762319503" onmouseenter="enter('8506024364762319503');" onmouseout="out('8506024364762319503');" style="">  76   protected int mTotalThreadNum;                                                                         </span>
<span  style="">  77                                                                                                          </span>
<span class="1064880922655578719" onmouseenter="enter('1064880922655578719');" onmouseout="out('1064880922655578719');" style="">  78   //启动线程数                                                                                                </span>
<span class="1064880922655578719" onmouseenter="enter('1064880922655578719');" onmouseout="out('1064880922655578719');" style="">  79   //启动线程数                                                                                                </span>
<span class="5843971981435686054" onmouseenter="enter('5843971981435686054');" onmouseout="out('5843971981435686054');" style="">  80   private int mStartThreadNum;                                                                           </span>
<span  style="">  81                                                                                                          </span>
<span class="6869677327514827795" onmouseenter="enter('6869677327514827795');" onmouseout="out('6869677327514827795');" style="">  82   //已完成的线程数                                                                                              </span>
<span class="6869677327514827795" onmouseenter="enter('6869677327514827795');" onmouseout="out('6869677327514827795');" style="">  83   //已完成的线程数                                                                                              </span>
<span class="8146256445432145550" onmouseenter="enter('8146256445432145550');" onmouseout="out('8146256445432145550');" style="">  84   private int mCompleteThreadNum;                                                                        </span>
<span  style="">  85                                                                                                          </span>
<span class="-3545799492252297873" onmouseenter="enter('-3545799492252297873');" onmouseout="out('-3545799492252297873');" style="">  86   private Map&lt;Integer, AbsThreadTask&gt; mTask = new HashMap&lt;&gt;();                                           </span>
<span  style="">  87                                                                                                          </span>
<span class="2545797703164998155" onmouseenter="enter('2545797703164998155');" onmouseout="out('2545797703164998155');" style="">  88   private Timer mTimer;                                                                                  </span>
<span  style="">  89                                                                                                          </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="">  90   @Deprecated                                                                                            </span>
<span class="-2075436351753291325" onmouseenter="enter('-2075436351753291325');" onmouseout="out('-2075436351753291325');" style="">  91   private File mConfigFile;                                                                              </span>
<span  style="">  92                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  93   /**                                                                                                    </span>
<span class="7539908978715582123" onmouseenter="enter('7539908978715582123');" onmouseout="out('7539908978715582123');" style="">  94    * 进度刷新间隔                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  95    */                                                                                                    </span>
<span class="3897731617107507824" onmouseenter="enter('3897731617107507824');" onmouseout="out('3897731617107507824');" style="">  96   private long mUpdateInterval = 1000;                                                                   </span>
<span  style="">  97                                                                                                          </span>
<span class="-5884447509953456722" onmouseenter="enter('-5884447509953456722');" onmouseout="out('-5884447509953456722');" style="">  98   private TaskRecord mRecord;                                                                            </span>
<span  style="">  99                                                                                                          </span>
<span class="2891934549353689856" onmouseenter="enter('2891934549353689856');" onmouseout="out('2891934549353689856');" style=""> 100   protected AbsFileer(IEventListener listener, TASK_ENTITY taskEntity) {                                 </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style=""> 101     mListener = listener;                                                                                </span>
<span class="8662994215762856538" onmouseenter="enter('8662994215762856538');" onmouseout="out('8662994215762856538');" style=""> 102     mTaskEntity = taskEntity;                                                                            </span>
<span class="-4840298181735982119" onmouseenter="enter('-4840298181735982119');" onmouseout="out('-4840298181735982119');" style=""> 103     mEntity = mTaskEntity.getEntity();                                                                   </span>
<span class="1002707508041764251" onmouseenter="enter('1002707508041764251');" onmouseout="out('1002707508041764251');" style=""> 104     mContext = AriaManager.APP;                                                                          </span>
<span class="-3948532274682189145" onmouseenter="enter('-3948532274682189145');" onmouseout="out('-3948532274682189145');" style=""> 105     mConstance = new StateConstance();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106   }                                                                                                      </span>
<span  style=""> 107                                                                                                          </span>
<span class="-8210434580109369245" onmouseenter="enter('-8210434580109369245');" onmouseout="out('-8210434580109369245');" style=""> 108   public void setNewTask(boolean newTask) {                                                              </span>
<span class="7261549057242337382" onmouseenter="enter('7261549057242337382');" onmouseout="out('7261549057242337382');" style=""> 109     mTaskEntity.setNewTask(newTask);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110   }                                                                                                      </span>
<span  style=""> 111                                                                                                          </span>
<span class="2509123758179905267" onmouseenter="enter('2509123758179905267');" onmouseout="out('2509123758179905267');" style=""> 112   @Override public void setMaxSpeed(double maxSpeed) {                                                   </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 113     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 114       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 115       if (task != null) {                                                                                </span>
<span class="8974054037700404915" onmouseenter="enter('8974054037700404915');" onmouseout="out('8974054037700404915');" style=""> 116         task.setMaxSpeed(maxSpeed);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119   }                                                                                                      </span>
<span  style=""> 120                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 121   @Override public void run() {                                                                          </span>
<span class="2383691993380925204" onmouseenter="enter('2383691993380925204');" onmouseout="out('2383691993380925204');" style=""> 122     if (mConstance.isRunning) {                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 123       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124     }                                                                                                    </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 125     startFlow();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126   }                                                                                                      </span>
<span  style=""> 127                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 128   /**                                                                                                    </span>
<span class="-8036989040377605484" onmouseenter="enter('-8036989040377605484');" onmouseout="out('-8036989040377605484');" style=""> 129    * 开始流程                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 130    */                                                                                                    </span>
<span class="2659446283962947526" onmouseenter="enter('2659446283962947526');" onmouseout="out('2659446283962947526');" style=""> 131   private void startFlow() {                                                                             </span>
<span class="619404821214964502" onmouseenter="enter('619404821214964502');" onmouseout="out('619404821214964502');" style=""> 132     mConstance.resetState();                                                                             </span>
<span class="1290437685045115531" onmouseenter="enter('1290437685045115531');" onmouseout="out('1290437685045115531');" style=""> 133     checkTask();                                                                                         </span>
<span class="6200019808906550914" onmouseenter="enter('6200019808906550914');" onmouseout="out('6200019808906550914');" style=""> 134     mConstance.TASK_RECORD = mRecord;                                                                    </span>
<span class="4780862748684536259" onmouseenter="enter('4780862748684536259');" onmouseout="out('4780862748684536259');" style=""> 135     if (mListener instanceof IDownloadListener) {                                                        </span>
<span class="937780446443407951" onmouseenter="enter('937780446443407951');" onmouseout="out('937780446443407951');" style=""> 136       ((IDownloadListener) mListener).onPostPre(mEntity.getFileSize());                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137     }                                                                                                    </span>
<span class="8755928574405213439" onmouseenter="enter('8755928574405213439');" onmouseout="out('8755928574405213439');" style=""> 138     if (!mTaskEntity.isSupportBP()) {                                                                    </span>
<span class="-7445970306128807043" onmouseenter="enter('-7445970306128807043');" onmouseout="out('-7445970306128807043');" style=""> 139       mTotalThreadNum = 1;                                                                               </span>
<span class="-1191691332114182414" onmouseenter="enter('-1191691332114182414');" onmouseout="out('-1191691332114182414');" style=""> 140       mStartThreadNum = 1;                                                                               </span>
<span class="-6182854007095635032" onmouseenter="enter('-6182854007095635032');" onmouseout="out('-6182854007095635032');" style=""> 141       handleNoSupportBP();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 142     } else {                                                                                             </span>
<span class="-2662097366456595872" onmouseenter="enter('-2662097366456595872');" onmouseout="out('-2662097366456595872');" style=""> 143       mTotalThreadNum =                                                                                  </span>
<span class="2293773823409558899" onmouseenter="enter('2293773823409558899');" onmouseout="out('2293773823409558899');" style=""> 144           mTaskEntity.isNewTask() ? (mStartThreadNum = setNewTaskThreadNum()) : mTotalThreadNum;         </span>
<span class="304482857231090385" onmouseenter="enter('304482857231090385');" onmouseout="out('304482857231090385');" style=""> 145       handleBreakpoint();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146     }                                                                                                    </span>
<span class="-5070363508518577757" onmouseenter="enter('-5070363508518577757');" onmouseout="out('-5070363508518577757');" style=""> 147     mConstance.START_THREAD_NUM = mTotalThreadNum;                                                       </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 148     /*                                                                                                   </span>
<span class="-7459715513064469337" onmouseenter="enter('-7459715513064469337');" onmouseout="out('-7459715513064469337');" style=""> 149      * mTaskEntity.getEntity().getFileSize() != mTempFile.length()为兼容以前老版本代码                             </span>
<span class="-5520474084619660394" onmouseenter="enter('-5520474084619660394');" onmouseout="out('-5520474084619660394');" style=""> 150      * 动态长度条件：                                                                                           </span>
<span class="6678836087239710153" onmouseenter="enter('6678836087239710153');" onmouseout="out('6678836087239710153');" style=""> 151      * 1、总线程数为1，并且是新任务                                                                                   </span>
<span class="-8594380126502433751" onmouseenter="enter('-8594380126502433751');" onmouseout="out('-8594380126502433751');" style=""> 152      * 2、总线程数为1，不是新任务，但是长度不是文件全长度                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 153      */                                                                                                  </span>
<span class="-763935913933084661" onmouseenter="enter('-763935913933084661');" onmouseout="out('-763935913933084661');" style=""> 154     if (mTotalThreadNum == 1 &amp;&amp; (mTaskEntity.isNewTask()                                                 </span>
<span class="-3606193574981639369" onmouseenter="enter('-3606193574981639369');" onmouseout="out('-3606193574981639369');" style=""> 155         || mTaskEntity.getEntity().getFileSize() != mTempFile.length())) {                               </span>
<span class="9204016926254181097" onmouseenter="enter('9204016926254181097');" onmouseout="out('9204016926254181097');" style=""> 156       mConstance.isOpenDynamicFile = true;                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157     }                                                                                                    </span>
<span class="-7724548171203838725" onmouseenter="enter('-7724548171203838725');" onmouseout="out('-7724548171203838725');" style=""> 158     startTimer();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159   }                                                                                                      </span>
<span  style=""> 160                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 161   /**                                                                                                    </span>
<span class="-5386582613838574396" onmouseenter="enter('-5386582613838574396');" onmouseout="out('-5386582613838574396');" style=""> 162    * 设置新任务的最大线程数                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 163    */                                                                                                    </span>
<span class="-6137859098551091137" onmouseenter="enter('-6137859098551091137');" onmouseout="out('-6137859098551091137');" style=""> 164   protected abstract int setNewTaskThreadNum();                                                          </span>
<span  style=""> 165                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 166   /**                                                                                                    </span>
<span class="4041581137177203435" onmouseenter="enter('4041581137177203435');" onmouseout="out('4041581137177203435');" style=""> 167    * 启动进度获取定时器                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 168    */                                                                                                    </span>
<span class="-8560002621884285761" onmouseenter="enter('-8560002621884285761');" onmouseout="out('-8560002621884285761');" style=""> 169   private void startTimer() {                                                                            </span>
<span class="9064905857115753880" onmouseenter="enter('9064905857115753880');" onmouseout="out('9064905857115753880');" style=""> 170     mTimer = new Timer(true);                                                                            </span>
<span class="1767883212426599488" onmouseenter="enter('1767883212426599488');" onmouseout="out('1767883212426599488');" style=""> 171     mTimer.schedule(new TimerTask() {                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 172       @Override public void run() {                                                                      </span>
<span class="5257678828672457716" onmouseenter="enter('5257678828672457716');" onmouseout="out('5257678828672457716');" style=""> 173         if (mConstance.isComplete()                                                                      </span>
<span class="334343515162691172" onmouseenter="enter('334343515162691172');" onmouseout="out('334343515162691172');" style=""> 174             || mConstance.isStop()                                                                       </span>
<span class="3923616872544648792" onmouseenter="enter('3923616872544648792');" onmouseout="out('3923616872544648792');" style=""> 175             || mConstance.isCancel()                                                                     </span>
<span class="-6728476664925849707" onmouseenter="enter('-6728476664925849707');" onmouseout="out('-6728476664925849707');" style=""> 176             || !mConstance.isRunning) {                                                                  </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 177           closeTimer();                                                                                  </span>
<span class="5358021077686010059" onmouseenter="enter('5358021077686010059');" onmouseout="out('5358021077686010059');" style=""> 178         } else if (mConstance.CURRENT_LOCATION &gt;= 0) {                                                   </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style=""> 179           mListener.onProgress(mConstance.CURRENT_LOCATION);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181       }                                                                                                  </span>
<span class="-3821686044197757132" onmouseenter="enter('-3821686044197757132');" onmouseout="out('-3821686044197757132');" style=""> 182     }, 0, mUpdateInterval);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183   }                                                                                                      </span>
<span  style=""> 184                                                                                                          </span>
<span class="6987763365729675608" onmouseenter="enter('6987763365729675608');" onmouseout="out('6987763365729675608');" style=""> 185   protected void closeTimer() {                                                                          </span>
<span class="-4343220603110256261" onmouseenter="enter('-4343220603110256261');" onmouseout="out('-4343220603110256261');" style=""> 186     if (mTimer != null) {                                                                                </span>
<span class="6506490333649261220" onmouseenter="enter('6506490333649261220');" onmouseout="out('6506490333649261220');" style=""> 187       mTimer.purge();                                                                                    </span>
<span class="3936422701741233911" onmouseenter="enter('3936422701741233911');" onmouseout="out('3936422701741233911');" style=""> 188       mTimer.cancel();                                                                                   </span>
<span class="-3760473013259053076" onmouseenter="enter('-3760473013259053076');" onmouseout="out('-3760473013259053076');" style=""> 189       mTimer = null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191   }                                                                                                      </span>
<span  style=""> 192                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 193   /**                                                                                                    </span>
<span class="3310122691908792895" onmouseenter="enter('3310122691908792895');" onmouseout="out('3310122691908792895');" style=""> 194    * 设置定时器更新间隔                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 195    *                                                                                                     </span>
<span class="5926421498368036592" onmouseenter="enter('5926421498368036592');" onmouseout="out('5926421498368036592');" style=""> 196    * @param interval 单位毫秒，不能小于0                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 197    */                                                                                                    </span>
<span class="-6143371944494222779" onmouseenter="enter('-6143371944494222779');" onmouseout="out('-6143371944494222779');" style=""> 198   protected void setUpdateInterval(long interval) {                                                      </span>
<span class="-1051498944097002766" onmouseenter="enter('-1051498944097002766');" onmouseout="out('-1051498944097002766');" style=""> 199     if (interval &lt; 0) {                                                                                  </span>
<span class="3000915396455271078" onmouseenter="enter('3000915396455271078');" onmouseout="out('3000915396455271078');" style=""> 200       ALog.w(TAG, &quot;更新间隔不能小于0，默认为1000毫秒&quot;);                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 201       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202     }                                                                                                    </span>
<span class="-3431322530378656562" onmouseenter="enter('-3431322530378656562');" onmouseout="out('-3431322530378656562');" style=""> 203     mUpdateInterval = interval;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204   }                                                                                                      </span>
<span  style=""> 205                                                                                                          </span>
<span class="-4506592131726080634" onmouseenter="enter('-4506592131726080634');" onmouseout="out('-4506592131726080634');" style=""> 206   @Override public long getFileSize() {                                                                  </span>
<span class="-7902485770489300682" onmouseenter="enter('-7902485770489300682');" onmouseout="out('-7902485770489300682');" style=""> 207     return mEntity.getFileSize();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208   }                                                                                                      </span>
<span  style=""> 209                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 210   /**                                                                                                    </span>
<span class="-7288086523564906780" onmouseenter="enter('-7288086523564906780');" onmouseout="out('-7288086523564906780');" style=""> 211    * 获取当前任务位置                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 212    */                                                                                                    </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style=""> 213   @Override public long getCurrentLocation() {                                                           </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style=""> 214     return mConstance.CURRENT_LOCATION;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215   }                                                                                                      </span>
<span  style=""> 216                                                                                                          </span>
<span class="-2237798856776801835" onmouseenter="enter('-2237798856776801835');" onmouseout="out('-2237798856776801835');" style=""> 217   @Override public boolean isRunning() {                                                                 </span>
<span class="-9220268812159037756" onmouseenter="enter('-9220268812159037756');" onmouseout="out('-9220268812159037756');" style=""> 218     return mConstance.isRunning;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219   }                                                                                                      </span>
<span  style=""> 220                                                                                                          </span>
<span class="305234216015554819" onmouseenter="enter('305234216015554819');" onmouseout="out('305234216015554819');" style=""> 221   @Override public void cancel() {                                                                       </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 222     closeTimer();                                                                                        </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 223     mConstance.isRunning = false;                                                                        </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style=""> 224     mConstance.isCancel = true;                                                                          </span>
<span class="-1828001720390047641" onmouseenter="enter('-1828001720390047641');" onmouseout="out('-1828001720390047641');" style=""> 225     if (mFixedThreadPool != null) {                                                                      </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style=""> 226       mFixedThreadPool.shutdown();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span class="-612803506725482722" onmouseenter="enter('-612803506725482722');" onmouseout="out('-612803506725482722');" style=""> 228     for (int i = 0; i &lt; mStartThreadNum; i++) {                                                          </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 229       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 230       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style=""> 231         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234   }                                                                                                      </span>
<span  style=""> 235                                                                                                          </span>
<span class="6276273225669041403" onmouseenter="enter('6276273225669041403');" onmouseout="out('6276273225669041403');" style=""> 236   @Override public void stop() {                                                                         </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 237     closeTimer();                                                                                        </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 238     mConstance.isRunning = false;                                                                        </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style=""> 239     mConstance.isStop = true;                                                                            </span>
<span class="8402005296375476854" onmouseenter="enter('8402005296375476854');" onmouseout="out('8402005296375476854');" style=""> 240     if (mConstance.isComplete()) return;                                                                 </span>
<span class="-1828001720390047641" onmouseenter="enter('-1828001720390047641');" onmouseout="out('-1828001720390047641');" style=""> 241     if (mFixedThreadPool != null) {                                                                      </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style=""> 242       mFixedThreadPool.shutdown();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243     }                                                                                                    </span>
<span class="-612803506725482722" onmouseenter="enter('-612803506725482722');" onmouseout="out('-612803506725482722');" style=""> 244     for (int i = 0; i &lt; mStartThreadNum; i++) {                                                          </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 245       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 246       if (task != null) {                                                                                </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style=""> 247         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250   }                                                                                                      </span>
<span  style=""> 251                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 252   /**                                                                                                    </span>
<span class="-7218687507933415946" onmouseenter="enter('-7218687507933415946');" onmouseout="out('-7218687507933415946');" style=""> 253    * 直接调用的时候会自动启动线程执行                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 254    */                                                                                                    </span>
<span class="2908281040877937362" onmouseenter="enter('2908281040877937362');" onmouseout="out('2908281040877937362');" style=""> 255   @Override public void start() {                                                                        </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style=""> 256     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257   }                                                                                                      </span>
<span  style=""> 258                                                                                                          </span>
<span class="-1531467598256645714" onmouseenter="enter('-1531467598256645714');" onmouseout="out('-1531467598256645714');" style=""> 259   @Override public void resume() {                                                                       </span>
<span class="-6183578153083367222" onmouseenter="enter('-6183578153083367222');" onmouseout="out('-6183578153083367222');" style=""> 260     start();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261   }                                                                                                      </span>
<span  style=""> 262                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 263   /**                                                                                                    </span>
<span class="-5594313128981442446" onmouseenter="enter('-5594313128981442446');" onmouseout="out('-5594313128981442446');" style=""> 264    * 检查任务、检查线程数                                                                                          </span>
<span class="5765812458735380113" onmouseenter="enter('5765812458735380113');" onmouseout="out('5765812458735380113');" style=""> 265    * 新任务条件：                                                                                              </span>
<span class="-3418470207445181215" onmouseenter="enter('-3418470207445181215');" onmouseout="out('-3418470207445181215');" style=""> 266    * 1、文件不存在                                                                                             </span>
<span class="1471172295356331660" onmouseenter="enter('1471172295356331660');" onmouseout="out('1471172295356331660');" style=""> 267    * 2、任务记录文件缺失或不匹配                                                                                      </span>
<span class="4400956412852543180" onmouseenter="enter('4400956412852543180');" onmouseout="out('4400956412852543180');" style=""> 268    * 3、数据库记录不存在                                                                                          </span>
<span class="1878350678984943375" onmouseenter="enter('1878350678984943375');" onmouseout="out('1878350678984943375');" style=""> 269    * 4、不支持断点，则是新任务                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 270    */                                                                                                    </span>
<span class="-8432905628195545001" onmouseenter="enter('-8432905628195545001');" onmouseout="out('-8432905628195545001');" style=""> 271   private void checkTask() {                                                                             </span>
<span class="-5297450492380711808" onmouseenter="enter('-5297450492380711808');" onmouseout="out('-5297450492380711808');" style=""> 272     mConfigFile = new File(CommonUtil.getFileConfigPath(false, mEntity.getFileName()));                  </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style=""> 273     if (mConfigFile.exists()) {                                                                          </span>
<span class="7932310618145443523" onmouseenter="enter('7932310618145443523');" onmouseout="out('7932310618145443523');" style=""> 274       convertDb();                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 275     } else {                                                                                             </span>
<span class="-5238664810335263343" onmouseenter="enter('-5238664810335263343');" onmouseout="out('-5238664810335263343');" style=""> 276       mRecord = DbHelper.getTaskRecord(mTaskEntity.getKey());                                            </span>
<span class="-3299415613061807412" onmouseenter="enter('-3299415613061807412');" onmouseout="out('-3299415613061807412');" style=""> 277       if (mRecord == null) {                                                                             </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 278         initRecord();                                                                                    </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 279         mTaskEntity.setNewTask(true);                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 280       } else {                                                                                           </span>
<span class="-7168613097949101282" onmouseenter="enter('-7168613097949101282');" onmouseout="out('-7168613097949101282');" style=""> 281         if (mRecord.threadRecords == null || mRecord.threadRecords.isEmpty()) {                          </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 282           initRecord();                                                                                  </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 283           mTaskEntity.setNewTask(true);                                                                  </span>
<span class="-4489756692986098869" onmouseenter="enter('-4489756692986098869');" onmouseout="out('-4489756692986098869');" style=""> 284         } else if (mTempFile.length() == 0) {                                                            </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style=""> 285           mRecord.deleteData();                                                                          </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 286           initRecord();                                                                                  </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 287           mTaskEntity.setNewTask(true);                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 288         } else {                                                                                         </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style=""> 289           for (ThreadRecord tr : mRecord.threadRecords) {                                                </span>
<span class="-6249885869558348483" onmouseenter="enter('-6249885869558348483');" onmouseout="out('-6249885869558348483');" style=""> 290             if (tr.isComplete) {                                                                         </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style=""> 291               mCompleteThreadNum++;                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 292             } else {                                                                                     </span>
<span class="-4361198270326326802" onmouseenter="enter('-4361198270326326802');" onmouseout="out('-4361198270326326802');" style=""> 293               mStartThreadNum++;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295           }                                                                                              </span>
<span class="-4812553014330515673" onmouseenter="enter('-4812553014330515673');" onmouseout="out('-4812553014330515673');" style=""> 296           mTotalThreadNum = mRecord.threadRecords.size();                                                </span>
<span class="-561823525574412259" onmouseenter="enter('-561823525574412259');" onmouseout="out('-561823525574412259');" style=""> 297           mTaskEntity.setNewTask(false);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301   }                                                                                                      </span>
<span  style=""> 302                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 303   /**                                                                                                    </span>
<span class="1070716404183585489" onmouseenter="enter('1070716404183585489');" onmouseout="out('1070716404183585489');" style=""> 304    * convertDb 为兼容性代码                                                                                    </span>
<span class="3982968248834793214" onmouseenter="enter('3982968248834793214');" onmouseout="out('3982968248834793214');" style=""> 305    * 从3.4.1开始，线程配置信息将存储在数据库中。                                                                            </span>
<span class="-6928102974415786303" onmouseenter="enter('-6928102974415786303');" onmouseout="out('-6928102974415786303');" style=""> 306    * 将配置文件的内容复制到数据库中，并将配置文件删除                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 307    */                                                                                                    </span>
<span class="14298455509427519" onmouseenter="enter('14298455509427519');" onmouseout="out('14298455509427519');" style=""> 308   private void convertDb() {                                                                             </span>
<span class="-4598298306615401010" onmouseenter="enter('-4598298306615401010');" onmouseout="out('-4598298306615401010');" style=""> 309     List&lt;RecordWrapper&gt; records =                                                                        </span>
<span class="-4738968014729726274" onmouseenter="enter('-4738968014729726274');" onmouseout="out('-4738968014729726274');" style=""> 310         DbEntity.findRelationData(RecordWrapper.class, &quot;TaskRecord.filePath=?&quot;,                          </span>
<span class="96831814087260276" onmouseenter="enter('96831814087260276');" onmouseout="out('96831814087260276');" style=""> 311             mTaskEntity.getKey());                                                                       </span>
<span class="-376648440877788579" onmouseenter="enter('-376648440877788579');" onmouseout="out('-376648440877788579');" style=""> 312     if (records == null || records.size() == 0) {                                                        </span>
<span class="7274393295178915569" onmouseenter="enter('7274393295178915569');" onmouseout="out('7274393295178915569');" style=""> 313       Properties pro = CommonUtil.loadConfig(mConfigFile);                                               </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style=""> 314       if (pro.isEmpty()) {                                                                               </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 315         mTaskEntity.setNewTask(true);                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 316         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317       }                                                                                                  </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 318       initRecord();                                                                                      </span>
<span class="-4092719147494026286" onmouseenter="enter('-4092719147494026286');" onmouseout="out('-4092719147494026286');" style=""> 319       Set&lt;Object&gt; keys = pro.keySet();                                                                   </span>
<span class="7117164647387083506" onmouseenter="enter('7117164647387083506');" onmouseout="out('7117164647387083506');" style=""> 320       // 老版本记录是5s存一次，但是5s中内，如果线程执行完成，record记录是没有的，只有state记录...                                           </span>
<span class="8442347856216504710" onmouseenter="enter('8442347856216504710');" onmouseout="out('8442347856216504710');" style=""> 321       // 第一步应该是record 和 state去重取正确的线程数                                                                   </span>
<span class="3880560860847601414" onmouseenter="enter('3880560860847601414');" onmouseout="out('3880560860847601414');" style=""> 322       Set&lt;Integer&gt; set = new HashSet&lt;&gt;();                                                                </span>
<span class="-5644624400733519290" onmouseenter="enter('-5644624400733519290');" onmouseout="out('-5644624400733519290');" style=""> 323       for (Object key : keys) {                                                                          </span>
<span class="-90111359741489740" onmouseenter="enter('-90111359741489740');" onmouseout="out('-90111359741489740');" style=""> 324         String str = String.valueOf(key);                                                                </span>
<span class="5431713397557299419" onmouseenter="enter('5431713397557299419');" onmouseout="out('5431713397557299419');" style=""> 325         int i = Integer.parseInt(str.substring(str.length() - 1, str.length()));                         </span>
<span class="5139166377005733880" onmouseenter="enter('5139166377005733880');" onmouseout="out('5139166377005733880');" style=""> 326         set.add(i);                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327       }                                                                                                  </span>
<span class="1773727540275693887" onmouseenter="enter('1773727540275693887');" onmouseout="out('1773727540275693887');" style=""> 328       int threadNum = set.size();                                                                        </span>
<span class="1658307869252768908" onmouseenter="enter('1658307869252768908');" onmouseout="out('1658307869252768908');" style=""> 329       if (threadNum == 0) {                                                                              </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 330         mTaskEntity.setNewTask(true);                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 331         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332       }                                                                                                  </span>
<span class="8980547023143351106" onmouseenter="enter('8980547023143351106');" onmouseout="out('8980547023143351106');" style=""> 333       mRecord.threadNum = threadNum;                                                                     </span>
<span class="1082026445239340300" onmouseenter="enter('1082026445239340300');" onmouseout="out('1082026445239340300');" style=""> 334       mTotalThreadNum = threadNum;                                                                       </span>
<span  style=""> 335                                                                                                          </span>
<span class="92058997093189211" onmouseenter="enter('92058997093189211');" onmouseout="out('92058997093189211');" style=""> 336       for (int i = 0; i &lt; threadNum; i++) {                                                              </span>
<span class="1846142719149590893" onmouseenter="enter('1846142719149590893');" onmouseout="out('1846142719149590893');" style=""> 337         ThreadRecord tRecord = new ThreadRecord();                                                       </span>
<span class="-543854586085341709" onmouseenter="enter('-543854586085341709');" onmouseout="out('-543854586085341709');" style=""> 338         tRecord.key = mRecord.filePath;                                                                  </span>
<span class="-1285896534897014429" onmouseenter="enter('-1285896534897014429');" onmouseout="out('-1285896534897014429');" style=""> 339         Object state = pro.getProperty(mTempFile.getName() + STATE + i);                                 </span>
<span class="7744986855104654034" onmouseenter="enter('7744986855104654034');" onmouseout="out('7744986855104654034');" style=""> 340         Object record = pro.getProperty(mTempFile.getName() + RECORD + i);                               </span>
<span class="-1417732743646819816" onmouseenter="enter('-1417732743646819816');" onmouseout="out('-1417732743646819816');" style=""> 341         if (state != null &amp;&amp; Integer.parseInt(String.valueOf(state)) == 1) {                             </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style=""> 342           mCompleteThreadNum++;                                                                          </span>
<span class="-5900743039323389312" onmouseenter="enter('-5900743039323389312');" onmouseout="out('-5900743039323389312');" style=""> 343           tRecord.isComplete = true;                                                                     </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 344           continue;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345         }                                                                                                </span>
<span class="-4361198270326326802" onmouseenter="enter('-4361198270326326802');" onmouseout="out('-4361198270326326802');" style=""> 346         mStartThreadNum++;                                                                               </span>
<span class="2652986304939921073" onmouseenter="enter('2652986304939921073');" onmouseout="out('2652986304939921073');" style=""> 347         if (record != null) {                                                                            </span>
<span class="-5505735994889378269" onmouseenter="enter('-5505735994889378269');" onmouseout="out('-5505735994889378269');" style=""> 348           Long temp = Long.parseLong(String.valueOf(record));                                            </span>
<span class="6949017848225026676" onmouseenter="enter('6949017848225026676');" onmouseout="out('6949017848225026676');" style=""> 349           tRecord.startLocation = temp &gt; 0 ? temp : 0;                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 350         } else {                                                                                         </span>
<span class="-2463924567028920967" onmouseenter="enter('-2463924567028920967');" onmouseout="out('-2463924567028920967');" style=""> 351           tRecord.startLocation = 0;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352         }                                                                                                </span>
<span class="8450336720909475026" onmouseenter="enter('8450336720909475026');" onmouseout="out('8450336720909475026');" style=""> 353         mRecord.threadRecords.add(tRecord);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354       }                                                                                                  </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style=""> 355       mConfigFile.delete();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357   }                                                                                                      </span>
<span  style=""> 358                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 359   /**                                                                                                    </span>
<span class="-671827589422898020" onmouseenter="enter('-671827589422898020');" onmouseout="out('-671827589422898020');" style=""> 360    * 初始化记录                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 361    */                                                                                                    </span>
<span class="7657423209226081953" onmouseenter="enter('7657423209226081953');" onmouseout="out('7657423209226081953');" style=""> 362   private void initRecord() {                                                                            </span>
<span class="1363226846886967285" onmouseenter="enter('1363226846886967285');" onmouseout="out('1363226846886967285');" style=""> 363     mRecord = new TaskRecord();                                                                          </span>
<span class="-5083582960729315317" onmouseenter="enter('-5083582960729315317');" onmouseout="out('-5083582960729315317');" style=""> 364     mRecord.fileName = mEntity.getFileName();                                                            </span>
<span class="3577925922319021061" onmouseenter="enter('3577925922319021061');" onmouseout="out('3577925922319021061');" style=""> 365     mRecord.filePath = mTaskEntity.getKey();                                                             </span>
<span class="-4117247167556656758" onmouseenter="enter('-4117247167556656758');" onmouseout="out('-4117247167556656758');" style=""> 366     mRecord.threadRecords = new ArrayList&lt;&gt;();                                                           </span>
<span class="8089432194042683150" onmouseenter="enter('8089432194042683150');" onmouseout="out('8089432194042683150');" style=""> 367     mRecord.isGroupRecord = mTaskEntity.getEntity().isGroupChild();                                      </span>
<span class="8800687954183002826" onmouseenter="enter('8800687954183002826');" onmouseout="out('8800687954183002826');" style=""> 368     if (mRecord.isGroupRecord) {                                                                         </span>
<span class="-817579183662015631" onmouseenter="enter('-817579183662015631');" onmouseout="out('-817579183662015631');" style=""> 369       if (mTaskEntity.getEntity() instanceof DownloadEntity) {                                           </span>
<span class="-7647901316480546218" onmouseenter="enter('-7647901316480546218');" onmouseout="out('-7647901316480546218');" style=""> 370         mRecord.dGroupName = ((DownloadEntity) mTaskEntity.getEntity()).getGroupName();                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373   }                                                                                                      </span>
<span  style=""> 374                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 375   /**                                                                                                    </span>
<span class="-8991940256279851469" onmouseenter="enter('-8991940256279851469');" onmouseout="out('-8991940256279851469');" style=""> 376    * 保存任务记录                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 377    */                                                                                                    </span>
<span class="1188287987342183098" onmouseenter="enter('1188287987342183098');" onmouseout="out('1188287987342183098');" style=""> 378   private void saveRecord() {                                                                            </span>
<span class="-6872584921755914518" onmouseenter="enter('-6872584921755914518');" onmouseout="out('-6872584921755914518');" style=""> 379     mRecord.threadNum = mRecord.threadRecords.size();                                                    </span>
<span class="-3343791891312496302" onmouseenter="enter('-3343791891312496302');" onmouseout="out('-3343791891312496302');" style=""> 380     mRecord.save();                                                                                      </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style=""> 381     for (ThreadRecord tr : mRecord.threadRecords) {                                                      </span>
<span class="1550150863078778036" onmouseenter="enter('1550150863078778036');" onmouseout="out('1550150863078778036');" style=""> 382       tr.save();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 384   }                                                                                                      </span>
<span  style=""> 385                                                                                                          </span>
<span class="1066955891247002122" onmouseenter="enter('1066955891247002122');" onmouseout="out('1066955891247002122');" style=""> 386   public TaskRecord getRecord() {                                                                        </span>
<span class="-7223580788630505532" onmouseenter="enter('-7223580788630505532');" onmouseout="out('-7223580788630505532');" style=""> 387     return mRecord;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388   }                                                                                                      </span>
<span  style=""> 389                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 390   /**                                                                                                    </span>
<span class="7661061719912178382" onmouseenter="enter('7661061719912178382');" onmouseout="out('7661061719912178382');" style=""> 391    * 恢复记录地址                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 392    *                                                                                                     </span>
<span class="-1706428464808283045" onmouseenter="enter('-1706428464808283045');" onmouseout="out('-1706428464808283045');" style=""> 393    * @return {@code true}任务已完成                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 394    */                                                                                                    </span>
<span class="423019558917313706" onmouseenter="enter('423019558917313706');" onmouseout="out('423019558917313706');" style=""> 395   private boolean resumeRecordLocation(int i, long startL, long endL) {                                  </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style=""> 396     mConstance.CURRENT_LOCATION += endL - startL;                                                        </span>
<span class="-3554759638611896536" onmouseenter="enter('-3554759638611896536');" onmouseout="out('-3554759638611896536');" style=""> 397     ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__已完成&quot;, mTaskEntity.getEntity().getFileName(), i));           </span>
<span class="3932130165010443212" onmouseenter="enter('3932130165010443212');" onmouseout="out('3932130165010443212');" style=""> 398     mConstance.COMPLETE_THREAD_NUM = mCompleteThreadNum;                                                 </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style=""> 399     mConstance.STOP_NUM++;                                                                               </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style=""> 400     mConstance.CANCEL_NUM++;                                                                             </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style=""> 401     if (mConstance.isComplete()) {                                                                       </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style=""> 402       mRecord.deleteData();                                                                              </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 403       mListener.onComplete();                                                                            </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 404       mConstance.isRunning = false;                                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 405       return true;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 406     }                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 407     return false;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408   }                                                                                                      </span>
<span  style=""> 409                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 410   /**                                                                                                    </span>
<span class="8881300510663389339" onmouseenter="enter('8881300510663389339');" onmouseout="out('8881300510663389339');" style=""> 411    * 启动断点任务时，创建单线程任务                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 412    *                                                                                                     </span>
<span class="4311889051397531831" onmouseenter="enter('4311889051397531831');" onmouseout="out('4311889051397531831');" style=""> 413    * @param i 线程id                                                                                       </span>
<span class="1230174220176038900" onmouseenter="enter('1230174220176038900');" onmouseout="out('1230174220176038900');" style=""> 414    * @param startL 该任务起始位置                                                                               </span>
<span class="1858994332528537357" onmouseenter="enter('1858994332528537357');" onmouseout="out('1858994332528537357');" style=""> 415    * @param endL 该任务结束位置                                                                                 </span>
<span class="4908980689327331914" onmouseenter="enter('4908980689327331914');" onmouseout="out('4908980689327331914');" style=""> 416    * @param fileLength 该任务需要处理的文件长度                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 417    */                                                                                                    </span>
<span class="8417307416647678377" onmouseenter="enter('8417307416647678377');" onmouseout="out('8417307416647678377');" style=""> 418   private AbsThreadTask createSingThreadTask(int i, long startL, long endL, long fileLength,             </span>
<span class="-2934306509623024164" onmouseenter="enter('-2934306509623024164');" onmouseout="out('-2934306509623024164');" style=""> 419       ThreadRecord record) {                                                                             </span>
<span class="-7768173698086340418" onmouseenter="enter('-7768173698086340418');" onmouseout="out('-7768173698086340418');" style=""> 420     SubThreadConfig&lt;TASK_ENTITY&gt; config = new SubThreadConfig&lt;&gt;();                                       </span>
<span class="-8558948078866873984" onmouseenter="enter('-8558948078866873984');" onmouseout="out('-8558948078866873984');" style=""> 421     config.FILE_SIZE = fileLength;                                                                       </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style=""> 422     config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                     </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style=""> 423     config.TEMP_FILE = mTempFile;                                                                        </span>
<span class="-8589974584258899309" onmouseenter="enter('-8589974584258899309');" onmouseout="out('-8589974584258899309');" style=""> 424     config.THREAD_ID = i;                                                                                </span>
<span class="-423990566973150114" onmouseenter="enter('-423990566973150114');" onmouseout="out('-423990566973150114');" style=""> 425     config.START_LOCATION = startL;                                                                      </span>
<span class="7030036366591044852" onmouseenter="enter('7030036366591044852');" onmouseout="out('7030036366591044852');" style=""> 426     config.END_LOCATION = endL;                                                                          </span>
<span class="4558959233585694596" onmouseenter="enter('4558959233585694596');" onmouseout="out('4558959233585694596');" style=""> 427     config.SUPPORT_BP = mTaskEntity.isSupportBP();                                                       </span>
<span class="-6844563562976749056" onmouseenter="enter('-6844563562976749056');" onmouseout="out('-6844563562976749056');" style=""> 428     config.TASK_ENTITY = mTaskEntity;                                                                    </span>
<span class="-4817448612298280426" onmouseenter="enter('-4817448612298280426');" onmouseout="out('-4817448612298280426');" style=""> 429     config.THREAD_RECORD = record;                                                                       </span>
<span class="-3921818352268167442" onmouseenter="enter('-3921818352268167442');" onmouseout="out('-3921818352268167442');" style=""> 430     return selectThreadTask(config);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 431   }                                                                                                      </span>
<span  style=""> 432                                                                                                          </span>
<span class="6532423587840407518" onmouseenter="enter('6532423587840407518');" onmouseout="out('6532423587840407518');" style=""> 433   private void handleBreakpoint() {                                                                      </span>
<span class="-4822982872266026601" onmouseenter="enter('-4822982872266026601');" onmouseout="out('-4822982872266026601');" style=""> 434     long fileLength = mEntity.getFileSize();                                                             </span>
<span class="-23207299311678828" onmouseenter="enter('-23207299311678828');" onmouseout="out('-23207299311678828');" style=""> 435     long blockSize = fileLength / mTotalThreadNum;                                                       </span>
<span class="7144011642124032136" onmouseenter="enter('7144011642124032136');" onmouseout="out('7144011642124032136');" style=""> 436     int[] threadId = new int[mTotalThreadNum];                                                           </span>
<span class="794844889575716346" onmouseenter="enter('794844889575716346');" onmouseout="out('794844889575716346');" style=""> 437     int rl = 0;                                                                                          </span>
<span class="575574520788079541" onmouseenter="enter('575574520788079541');" onmouseout="out('575574520788079541');" style=""> 438     mRecord.fileLength = fileLength;                                                                     </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 439     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="5272717944804854313" onmouseenter="enter('5272717944804854313');" onmouseout="out('5272717944804854313');" style=""> 440       threadId[i] = -1;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 441     }                                                                                                    </span>
<span class="6670174274790168103" onmouseenter="enter('6670174274790168103');" onmouseout="out('6670174274790168103');" style=""> 442     if (mTaskEntity.isNewTask() &amp;&amp; (!handleNewTask())) {                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 443       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444     }                                                                                                    </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 445     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="7621964356592003253" onmouseenter="enter('7621964356592003253');" onmouseout="out('7621964356592003253');" style=""> 446       long startL = i * blockSize;                                                                       </span>
<span class="6763390455321275778" onmouseenter="enter('6763390455321275778');" onmouseout="out('6763390455321275778');" style=""> 447       long endL = (i + 1) * blockSize;                                                                   </span>
<span class="5090177735693834127" onmouseenter="enter('5090177735693834127');" onmouseout="out('5090177735693834127');" style=""> 448       ThreadRecord tr;                                                                                   </span>
<span class="4956183975294103330" onmouseenter="enter('4956183975294103330');" onmouseout="out('4956183975294103330');" style=""> 449       boolean isNewTr = false;// 是否是新的线程记录                                                               </span>
<span  style=""> 450                                                                                                          </span>
<span class="-6597548071328599593" onmouseenter="enter('-6597548071328599593');" onmouseout="out('-6597548071328599593');" style=""> 451       if (mTaskEntity.isNewTask()) {                                                                     </span>
<span class="-1372101013715036968" onmouseenter="enter('-1372101013715036968');" onmouseout="out('-1372101013715036968');" style=""> 452         tr = new ThreadRecord();                                                                         </span>
<span class="3917749081996930633" onmouseenter="enter('3917749081996930633');" onmouseout="out('3917749081996930633');" style=""> 453         tr.key = mRecord.filePath;                                                                       </span>
<span class="-7575886392361997801" onmouseenter="enter('-7575886392361997801');" onmouseout="out('-7575886392361997801');" style=""> 454         tr.threadId = i;                                                                                 </span>
<span class="3085824084899250864" onmouseenter="enter('3085824084899250864');" onmouseout="out('3085824084899250864');" style=""> 455         isNewTr = true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 456       } else {                                                                                           </span>
<span class="-548726359565759652" onmouseenter="enter('-548726359565759652');" onmouseout="out('-548726359565759652');" style=""> 457         tr = mRecord.threadRecords.get(i);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 458       }                                                                                                  </span>
<span class="-6249885869558348483" onmouseenter="enter('-6249885869558348483');" onmouseout="out('-6249885869558348483');" style=""> 459       if (tr.isComplete) {                                                                               </span>
<span class="9046228737548453894" onmouseenter="enter('9046228737548453894');" onmouseout="out('9046228737548453894');" style=""> 460         // 该线程已经完成                                                                                       </span>
<span class="-7997394652241777246" onmouseenter="enter('-7997394652241777246');" onmouseout="out('-7997394652241777246');" style=""> 461         if (resumeRecordLocation(i, startL, endL)) {                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 462           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463         }                                                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 464         continue;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 465       }                                                                                                  </span>
<span class="5594768044350640082" onmouseenter="enter('5594768044350640082');" onmouseout="out('5594768044350640082');" style=""> 466       // 如果有记录，则恢复任务                                                                                     </span>
<span class="8289251945837025497" onmouseenter="enter('8289251945837025497');" onmouseout="out('8289251945837025497');" style=""> 467       if (tr.startLocation &gt;= 0) {                                                                       </span>
<span class="-7166560389597808593" onmouseenter="enter('-7166560389597808593');" onmouseout="out('-7166560389597808593');" style=""> 468         Long r = tr.startLocation;                                                                       </span>
<span class="5222885953677564090" onmouseenter="enter('5222885953677564090');" onmouseout="out('5222885953677564090');" style=""> 469         // 记录的位置需要在线程区间中                                                                                 </span>
<span class="9073494224917091429" onmouseenter="enter('9073494224917091429');" onmouseout="out('9073494224917091429');" style=""> 470         if ((startL &lt; r) &amp;&amp; (r &lt; (i == (mTotalThreadNum - 1) ? fileLength : endL))) {                    </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style=""> 471           mConstance.CURRENT_LOCATION += r - startL;                                                     </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style=""> 472           startL = r;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473         }                                                                                                </span>
<span class="5845990765500507783" onmouseenter="enter('5845990765500507783');" onmouseout="out('5845990765500507783');" style=""> 474         ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__恢复任务&quot;, mEntity.getFileName(), i));                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475       }                                                                                                  </span>
<span class="5085885912555397185" onmouseenter="enter('5085885912555397185');" onmouseout="out('5085885912555397185');" style=""> 476       // 最后一个线程的结束位置即为文件的总长度                                                                             </span>
<span class="-5942950699866528890" onmouseenter="enter('-5942950699866528890');" onmouseout="out('-5942950699866528890');" style=""> 477       if (i == (mTotalThreadNum - 1)) {                                                                  </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style=""> 478         endL = fileLength;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 479       }                                                                                                  </span>
<span class="8496166720772172680" onmouseenter="enter('8496166720772172680');" onmouseout="out('8496166720772172680');" style=""> 480       // 更新记录                                                                                            </span>
<span class="635736622332337160" onmouseenter="enter('635736622332337160');" onmouseout="out('635736622332337160');" style=""> 481       tr.startLocation = startL;                                                                         </span>
<span class="-8820011367691672414" onmouseenter="enter('-8820011367691672414');" onmouseout="out('-8820011367691672414');" style=""> 482       tr.endLocation = endL;                                                                             </span>
<span class="-5584934139293502444" onmouseenter="enter('-5584934139293502444');" onmouseout="out('-5584934139293502444');" style=""> 483       if (isNewTr) {                                                                                     </span>
<span class="7750338393456465672" onmouseenter="enter('7750338393456465672');" onmouseout="out('7750338393456465672');" style=""> 484         mRecord.threadRecords.add(tr);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485       }                                                                                                  </span>
<span class="6319026600890011419" onmouseenter="enter('6319026600890011419');" onmouseout="out('6319026600890011419');" style=""> 486       AbsThreadTask task = createSingThreadTask(i, startL, endL, fileLength, tr);                        </span>
<span class="8675873169750913162" onmouseenter="enter('8675873169750913162');" onmouseout="out('8675873169750913162');" style=""> 487       if (task == null) {                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 488         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 489       }                                                                                                  </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style=""> 490       mTask.put(i, task);                                                                                </span>
<span class="2496245772724592303" onmouseenter="enter('2496245772724592303');" onmouseout="out('2496245772724592303');" style=""> 491       threadId[rl] = i;                                                                                  </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style=""> 492       rl++;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 493     }                                                                                                    </span>
<span class="4405626423241501542" onmouseenter="enter('4405626423241501542');" onmouseout="out('4405626423241501542');" style=""><abbr title=" 494     if ((mConstance.CURRENT_LOCATION != 0) &amp;&amp; (mConstance.CURRENT_LOCATION != mEntity.getCurrentProgress())) {"> 494     if ((mConstance.CURRENT_LOCATION != 0) &amp;&amp; (mConstance.CURRENT_LOCATION != mEntity.getCurrentProgress(🔵</abbr></span>
<span class="-107308688072847772" onmouseenter="enter('-107308688072847772');" onmouseout="out('-107308688072847772');" style=""> 495       ALog.d(TAG, &quot;进度修正&quot;);                                                                               </span>
<span class="480370803854164555" onmouseenter="enter('480370803854164555');" onmouseout="out('480370803854164555');" style=""> 496       mEntity.setCurrentProgress(mConstance.CURRENT_LOCATION);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 497     }                                                                                                    </span>
<span class="-4447853798640415053" onmouseenter="enter('-4447853798640415053');" onmouseout="out('-4447853798640415053');" style=""> 498     saveRecord();                                                                                        </span>
<span class="5367791124370950090" onmouseenter="enter('5367791124370950090');" onmouseout="out('5367791124370950090');" style=""> 499     startThreadTask(threadId);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500   }                                                                                                      </span>
<span  style=""> 501                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 502   /**                                                                                                    </span>
<span class="3352756078121499684" onmouseenter="enter('3352756078121499684');" onmouseout="out('3352756078121499684');" style=""> 503    * 启动单线程任务                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 504    */                                                                                                    </span>
<span class="-4163844434134623471" onmouseenter="enter('-4163844434134623471');" onmouseout="out('-4163844434134623471');" style=""> 505   private void startThreadTask(int[] recordL) {                                                          </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style=""> 506     if (mConstance.CURRENT_LOCATION &gt; 0) {                                                               </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style=""> 507       mListener.onResume(mConstance.CURRENT_LOCATION);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 508     } else {                                                                                             </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style=""> 509       mListener.onStart(mConstance.CURRENT_LOCATION);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510     }                                                                                                    </span>
<span class="-3724057379342966503" onmouseenter="enter('-3724057379342966503');" onmouseout="out('-3724057379342966503');" style=""> 511     mFixedThreadPool = Executors.newFixedThreadPool(recordL.length);                                     </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style=""> 512     for (int l : recordL) {                                                                              </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style=""> 513       if (l == -1) continue;                                                                             </span>
<span class="-85915337091278441" onmouseenter="enter('-85915337091278441');" onmouseout="out('-85915337091278441');" style=""> 514       Runnable task = mTask.get(l);                                                                      </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 515       if (task != null) {                                                                                </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 516         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 517       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 519   }                                                                                                      </span>
<span  style=""> 520                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 521   /**                                                                                                    </span>
<span class="4764351819472741633" onmouseenter="enter('4764351819472741633');" onmouseout="out('4764351819472741633');" style=""> 522    * 重试线程任务，只有线程创建成功才能重试                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 523    */                                                                                                    </span>
<span class="-5467219194911799226" onmouseenter="enter('-5467219194911799226');" onmouseout="out('-5467219194911799226');" style=""> 524   public void retryThreadTask() {                                                                        </span>
<span class="5919738881870881869" onmouseenter="enter('5919738881870881869');" onmouseout="out('5919738881870881869');" style=""> 525     if ((mTask == null) || (mTask.size() == 0)) {                                                        </span>
<span class="-4385520730156955316" onmouseenter="enter('-4385520730156955316');" onmouseout="out('-4385520730156955316');" style=""> 526       ALog.w(TAG, &quot;没有线程任务&quot;);                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 527       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528     }                                                                                                    </span>
<span class="-9197459414244668337" onmouseenter="enter('-9197459414244668337');" onmouseout="out('-9197459414244668337');" style=""> 529     Set&lt;Integer&gt; keys = mTask.keySet();                                                                  </span>
<span class="4969357970824756675" onmouseenter="enter('4969357970824756675');" onmouseout="out('4969357970824756675');" style=""> 530     for (Integer key : keys) {                                                                           </span>
<span class="-8581528427459564550" onmouseenter="enter('-8581528427459564550');" onmouseout="out('-8581528427459564550');" style=""> 531       AbsThreadTask task = mTask.get(key);                                                               </span>
<span class="100484542374086661" onmouseenter="enter('100484542374086661');" onmouseout="out('100484542374086661');" style=""> 532       if ((task != null) &amp;&amp; (!task.isThreadComplete())) {                                                </span>
<span class="5627547129301802684" onmouseenter="enter('5627547129301802684');" onmouseout="out('5627547129301802684');" style=""> 533         task.getConfig().START_LOCATION = task.getCurrentLocation();                                     </span>
<span class="2850733480082561720" onmouseenter="enter('2850733480082561720');" onmouseout="out('2850733480082561720');" style=""> 534         mConstance.isStop = false;                                                                       </span>
<span class="-6084373575236396497" onmouseenter="enter('-6084373575236396497');" onmouseout="out('-6084373575236396497');" style=""> 535         mConstance.isCancel = false;                                                                     </span>
<span class="7884789031988873835" onmouseenter="enter('7884789031988873835');" onmouseout="out('7884789031988873835');" style=""> 536         mConstance.isRunning = true;                                                                     </span>
<span class="8232167261345676816" onmouseenter="enter('8232167261345676816');" onmouseout="out('8232167261345676816');" style=""><abbr title=" 537         ALog.d(TAG, String.format(&quot;任务【%s】开始重试，线程__%s__【开始位置：%s，结束位置：%s】&quot;, mEntity.getFileName(), key, task.getConfig().START_LOCATION, task.getConfig().END_LOCATION));"> 537         ALog.d(TAG, String.format(&quot;任务【%s】开始重试，线程__%s__【开始位置：%s，结束位置：%s】&quot;, mEntity.getFileName(), key, tas🔵</abbr></span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 538         mFixedThreadPool.execute(task);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 539       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 540     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541   }                                                                                                      </span>
<span  style=""> 542                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 543   /**                                                                                                    </span>
<span class="3489882028140634260" onmouseenter="enter('3489882028140634260');" onmouseout="out('3489882028140634260');" style=""> 544    * 处理新任务                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 545    *                                                                                                     </span>
<span class="8941769692798326625" onmouseenter="enter('8941769692798326625');" onmouseout="out('8941769692798326625');" style=""> 546    * @return {@code true}创建新任务失败                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 547    */                                                                                                    </span>
<span class="3897453149098456479" onmouseenter="enter('3897453149098456479');" onmouseout="out('3897453149098456479');" style=""> 548   protected abstract boolean handleNewTask();                                                            </span>
<span  style=""> 549                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 550   /**                                                                                                    </span>
<span class="-4404408971562231280" onmouseenter="enter('-4404408971562231280');" onmouseout="out('-4404408971562231280');" style=""> 551    * 处理不支持断点的任务                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 552    */                                                                                                    </span>
<span class="-8792279366871913220" onmouseenter="enter('-8792279366871913220');" onmouseout="out('-8792279366871913220');" style=""> 553   private void handleNoSupportBP() {                                                                     </span>
<span class="-7768173698086340418" onmouseenter="enter('-7768173698086340418');" onmouseout="out('-7768173698086340418');" style=""> 554     SubThreadConfig&lt;TASK_ENTITY&gt; config = new SubThreadConfig&lt;&gt;();                                       </span>
<span class="-8916543478630030690" onmouseenter="enter('-8916543478630030690');" onmouseout="out('-8916543478630030690');" style=""> 555     config.FILE_SIZE = mEntity.getFileSize();                                                            </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style=""> 556     config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                     </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style=""> 557     config.TEMP_FILE = mTempFile;                                                                        </span>
<span class="-5899809357890352135" onmouseenter="enter('-5899809357890352135');" onmouseout="out('-5899809357890352135');" style=""> 558     config.THREAD_ID = 0;                                                                                </span>
<span class="7958711547477559333" onmouseenter="enter('7958711547477559333');" onmouseout="out('7958711547477559333');" style=""> 559     config.START_LOCATION = 0;                                                                           </span>
<span class="911498546153633759" onmouseenter="enter('911498546153633759');" onmouseout="out('911498546153633759');" style=""> 560     config.END_LOCATION = config.FILE_SIZE;                                                              </span>
<span class="4558959233585694596" onmouseenter="enter('4558959233585694596');" onmouseout="out('4558959233585694596');" style=""> 561     config.SUPPORT_BP = mTaskEntity.isSupportBP();                                                       </span>
<span class="-6844563562976749056" onmouseenter="enter('-6844563562976749056');" onmouseout="out('-6844563562976749056');" style=""> 562     config.TASK_ENTITY = mTaskEntity;                                                                    </span>
<span class="-5296271627358693026" onmouseenter="enter('-5296271627358693026');" onmouseout="out('-5296271627358693026');" style=""> 563     AbsThreadTask task = selectThreadTask(config);                                                       </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style=""> 564     if (task == null) return;                                                                            </span>
<span class="8048363116921461760" onmouseenter="enter('8048363116921461760');" onmouseout="out('8048363116921461760');" style=""> 565     mTask.put(0, task);                                                                                  </span>
<span class="4151941088630277800" onmouseenter="enter('4151941088630277800');" onmouseout="out('4151941088630277800');" style=""> 566     mFixedThreadPool = Executors.newFixedThreadPool(1);                                                  </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 567     mFixedThreadPool.execute(task);                                                                      </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style=""> 568     mListener.onStart(0);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569   }                                                                                                      </span>
<span  style=""> 570                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 571   /**                                                                                                    </span>
<span class="5502854491504205724" onmouseenter="enter('5502854491504205724');" onmouseout="out('5502854491504205724');" style=""> 572    * 选择单任务线程的类型                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 573    */                                                                                                    </span>
<span class="-158713741323683937" onmouseenter="enter('-158713741323683937');" onmouseout="out('-158713741323683937');" style=""> 574   protected abstract AbsThreadTask selectThreadTask(SubThreadConfig&lt;TASK_ENTITY&gt; config);                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 575 }                                                                                                        </span></pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16  package com.arialyy.aria.core.common;                                                                             </span>
<span  style="">  17                                                                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  18  import android.content.Context;                                                                                   </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  19  import com.arialyy.aria.core.AriaManager;                                                                         </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="">  20  import com.arialyy.aria.core.download.DownloadEntity;                                                             </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  21  import com.arialyy.aria.core.inf.AbsNormalEntity;                                                                 </span>
<span class="4195608340199028072" onmouseenter="enter('4195608340199028072');" onmouseout="out('4195608340199028072');" style="">  22  import com.arialyy.aria.core.inf.AbsTaskEntity;                                                                   </span>
<span class="-2820121753251967085" onmouseenter="enter('-2820121753251967085');" onmouseout="out('-2820121753251967085');" style="">  23  import com.arialyy.aria.core.inf.IDownloadListener;                                                               </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  24  import com.arialyy.aria.core.inf.IEventListener;                                                                  </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="">  25  import com.arialyy.aria.orm.DbEntity;                                                                             </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  26  import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  27  import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="4945295635398100121" onmouseenter="enter('4945295635398100121');" onmouseout="out('4945295635398100121');" style="">  28  import com.arialyy.aria.util.DbHelper;                                                                            </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  29  import java.io.File;                                                                                              </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  30  import java.util.ArrayList;                                                                                       </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  31  import java.util.HashMap;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  32  import java.util.HashSet;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  33  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  34  import java.util.Map;                                                                                             </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  35  import java.util.Properties;                                                                                      </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  36  import java.util.Set;                                                                                             </span>
<span class="-3789567581486736748" onmouseenter="enter('-3789567581486736748');" onmouseout="out('-3789567581486736748');" style="">  37  import java.util.Timer;                                                                                           </span>
<span class="-2321797189340986544" onmouseenter="enter('-2321797189340986544');" onmouseout="out('-2321797189340986544');" style="">  38  import java.util.TimerTask;                                                                                       </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  39  import java.util.concurrent.ExecutorService;                                                                      </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  40  import java.util.concurrent.Executors;                                                                            </span>
<span  style="">  41                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  42  /**                                                                                                               </span>
<span class="6972081778092176351" onmouseenter="enter('6972081778092176351');" onmouseout="out('6972081778092176351');" style="">  43   * Created by AriaL on 2017/7/1.                                                                                  </span>
<span class="-3350964092441836737" onmouseenter="enter('-3350964092441836737');" onmouseout="out('-3350964092441836737');" style="">  44   * 任务处理器                                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  45   */                                                                                                               </span>
<span class="-4202835391474719331" onmouseenter="enter('-4202835391474719331');" onmouseout="out('-4202835391474719331');" style="">  46  public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_ENTITY extends AbsTaskEntity&lt;ENTITY&gt;&gt;        </span>
<span class="-1728503718485911871" onmouseenter="enter('-1728503718485911871');" onmouseout="out('-1728503718485911871');" style="">  47      implements Runnable, IUtil {                                                                                  </span>
<span class="8962793429617957612" onmouseenter="enter('8962793429617957612');" onmouseout="out('8962793429617957612');" style="">  48    private static final String STATE = &quot;_state_&quot;;                                                                  </span>
<span class="4155209368239822413" onmouseenter="enter('4155209368239822413');" onmouseout="out('4155209368239822413');" style="">  49    private static final String RECORD = &quot;_record_&quot;;                                                                </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50    /**                                                                                                             </span>
<span class="-1980722710912279499" onmouseenter="enter('-1980722710912279499');" onmouseout="out('-1980722710912279499');" style="">  51     * 小于1m的文件不启用多线程                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52     */                                                                                                             </span>
<span class="-5660290514964746700" onmouseenter="enter('-5660290514964746700');" onmouseout="out('-5660290514964746700');" style="">  53    protected static final long SUB_LEN = 1024 * 1024;                                                              </span>
<span  style="">  54                                                                                                                    </span>
<span class="7185037452507187216" onmouseenter="enter('7185037452507187216');" onmouseout="out('7185037452507187216');" style="">  55    private final String TAG = &quot;AbsFileer&quot;;                                                                         </span>
<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="">  56    protected IEventListener mListener;                                                                             </span>
<span class="-1948152884108661875" onmouseenter="enter('-1948152884108661875');" onmouseout="out('-1948152884108661875');" style="">  57    protected TASK_ENTITY mTaskEntity;                                                                              </span>
<span class="8904454574412257163" onmouseenter="enter('8904454574412257163');" onmouseout="out('8904454574412257163');" style="">  58    protected ENTITY mEntity;                                                                                       </span>
<span class="-8914417138860252644" onmouseenter="enter('-8914417138860252644');" onmouseout="out('-8914417138860252644');" style="">  59    protected Context mContext;                                                                                     </span>
<span class="3740841846621187936" onmouseenter="enter('3740841846621187936');" onmouseout="out('3740841846621187936');" style="">  60    protected File mTempFile; //文件                                                                                  </span>
<span class="-5211593385781091233" onmouseenter="enter('-5211593385781091233');" onmouseout="out('-5211593385781091233');" style="">  61    protected StateConstance mConstance;                                                                            </span>
<span class="1058453114158093994" onmouseenter="enter('1058453114158093994');" onmouseout="out('1058453114158093994');" style="">  62    private ExecutorService mFixedThreadPool;                                                                       </span>
<span class="-7729852228955968495" onmouseenter="enter('-7729852228955968495');" onmouseout="out('-7729852228955968495');" style="">  63    //总线程数                                                                                                          </span>
<span class="8506024364762319503" onmouseenter="enter('8506024364762319503');" onmouseout="out('8506024364762319503');" style="">  64    protected int mTotalThreadNum;                                                                                  </span>
<span class="1064880922655578719" onmouseenter="enter('1064880922655578719');" onmouseout="out('1064880922655578719');" style="">  65    //启动线程数                                                                                                         </span>
<span class="5843971981435686054" onmouseenter="enter('5843971981435686054');" onmouseout="out('5843971981435686054');" style="">  66    private int mStartThreadNum;                                                                                    </span>
<span class="6869677327514827795" onmouseenter="enter('6869677327514827795');" onmouseout="out('6869677327514827795');" style="">  67    //已完成的线程数                                                                                                       </span>
<span class="8146256445432145550" onmouseenter="enter('8146256445432145550');" onmouseout="out('8146256445432145550');" style="">  68    private int mCompleteThreadNum;                                                                                 </span>
<span class="-3545799492252297873" onmouseenter="enter('-3545799492252297873');" onmouseout="out('-3545799492252297873');" style="">  69    private Map&lt;Integer, AbsThreadTask&gt; mTask = new HashMap&lt;&gt;();                                                    </span>
<span  style="">  70                                                                                                                    </span>
<span class="2545797703164998155" onmouseenter="enter('2545797703164998155');" onmouseout="out('2545797703164998155');" style="">  71    private Timer mTimer;                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="">  72    @Deprecated                                                                                                     </span>
<span class="-2075436351753291325" onmouseenter="enter('-2075436351753291325');" onmouseout="out('-2075436351753291325');" style="">  73    private File mConfigFile;                                                                                       </span>

<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  74    /**                                                                                                             </span>
<span class="7539908978715582123" onmouseenter="enter('7539908978715582123');" onmouseout="out('7539908978715582123');" style="">  75     * 进度刷新间隔                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  76     */                                                                                                             </span>
<span class="3897731617107507824" onmouseenter="enter('3897731617107507824');" onmouseout="out('3897731617107507824');" style="">  77    private long mUpdateInterval = 1000;                                                                            </span>
<span class="-5884447509953456722" onmouseenter="enter('-5884447509953456722');" onmouseout="out('-5884447509953456722');" style="">  78    private TaskRecord mRecord;                                                                                     </span>
<span  style="">  79                                                                                                                    </span>
<span class="2891934549353689856" onmouseenter="enter('2891934549353689856');" onmouseout="out('2891934549353689856');" style="">  80    protected AbsFileer(IEventListener listener, TASK_ENTITY taskEntity) {                                          </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  81      mListener = listener;                                                                                         </span>
<span class="8662994215762856538" onmouseenter="enter('8662994215762856538');" onmouseout="out('8662994215762856538');" style="">  82      mTaskEntity = taskEntity;                                                                                     </span>
<span class="-4840298181735982119" onmouseenter="enter('-4840298181735982119');" onmouseout="out('-4840298181735982119');" style="">  83      mEntity = mTaskEntity.getEntity();                                                                            </span>
<span class="1002707508041764251" onmouseenter="enter('1002707508041764251');" onmouseout="out('1002707508041764251');" style="">  84      mContext = AriaManager.APP;                                                                                   </span>
<span class="-3948532274682189145" onmouseenter="enter('-3948532274682189145');" onmouseout="out('-3948532274682189145');" style="">  85      mConstance = new StateConstance();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86    }                                                                                                               </span>
<span  style="">  87                                                                                                                    </span>
<span class="-8210434580109369245" onmouseenter="enter('-8210434580109369245');" onmouseout="out('-8210434580109369245');" style="">  88    public void setNewTask(boolean newTask) {                                                                       </span>
<span class="7261549057242337382" onmouseenter="enter('7261549057242337382');" onmouseout="out('7261549057242337382');" style="">  89      mTaskEntity.setNewTask(newTask);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90    }                                                                                                               </span>
<span  style="">  91                                                                                                                    </span>
<span class="2509123758179905267" onmouseenter="enter('2509123758179905267');" onmouseout="out('2509123758179905267');" style="">  92    @Override public void setMaxSpeed(double maxSpeed) {                                                            </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style="">  93      for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                                   </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style="">  94        AbsThreadTask task = mTask.get(i);                                                                          </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="">  95        if (task != null) {                                                                                         </span>
<span class="8974054037700404915" onmouseenter="enter('8974054037700404915');" onmouseout="out('8974054037700404915');" style="">  96          task.setMaxSpeed(maxSpeed);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99    }                                                                                                               </span>
<span  style=""> 100                                                                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 101    @Override public void run() {                                                                                   </span>
<span class="2383691993380925204" onmouseenter="enter('2383691993380925204');" onmouseout="out('2383691993380925204');" style=""> 102      if (mConstance.isRunning) {                                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 103        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104      }                                                                                                             </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 105      startFlow();                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106    }                                                                                                               </span>
<span  style=""> 107                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 108    /**                                                                                                             </span>
<span class="-8036989040377605484" onmouseenter="enter('-8036989040377605484');" onmouseout="out('-8036989040377605484');" style=""> 109     * 开始流程                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 110     */                                                                                                             </span>
<span class="2659446283962947526" onmouseenter="enter('2659446283962947526');" onmouseout="out('2659446283962947526');" style=""> 111    private void startFlow() {                                                                                      </span>
<span class="619404821214964502" onmouseenter="enter('619404821214964502');" onmouseout="out('619404821214964502');" style=""> 112      mConstance.resetState();                                                                                      </span>
<span class="1290437685045115531" onmouseenter="enter('1290437685045115531');" onmouseout="out('1290437685045115531');" style=""> 113      checkTask();                                                                                                  </span>
<span class="6200019808906550914" onmouseenter="enter('6200019808906550914');" onmouseout="out('6200019808906550914');" style=""> 114      mConstance.TASK_RECORD = mRecord;                                                                             </span>
<span class="4780862748684536259" onmouseenter="enter('4780862748684536259');" onmouseout="out('4780862748684536259');" style=""> 115      if (mListener instanceof IDownloadListener) {                                                                 </span>
<span class="937780446443407951" onmouseenter="enter('937780446443407951');" onmouseout="out('937780446443407951');" style=""> 116        ((IDownloadListener) mListener).onPostPre(mEntity.getFileSize());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117      }                                                                                                             </span>
<span class="8755928574405213439" onmouseenter="enter('8755928574405213439');" onmouseout="out('8755928574405213439');" style=""> 118      if (!mTaskEntity.isSupportBP()) {                                                                             </span>
<span class="-7445970306128807043" onmouseenter="enter('-7445970306128807043');" onmouseout="out('-7445970306128807043');" style=""> 119        mTotalThreadNum = 1;                                                                                        </span>
<span class="-1191691332114182414" onmouseenter="enter('-1191691332114182414');" onmouseout="out('-1191691332114182414');" style=""> 120        mStartThreadNum = 1;                                                                                        </span>
<span class="-6182854007095635032" onmouseenter="enter('-6182854007095635032');" onmouseout="out('-6182854007095635032');" style=""> 121        handleNoSupportBP();                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 122      } else {                                                                                                      </span>
<span class="-2662097366456595872" onmouseenter="enter('-2662097366456595872');" onmouseout="out('-2662097366456595872');" style=""> 123        mTotalThreadNum =                                                                                           </span>
<span class="2293773823409558899" onmouseenter="enter('2293773823409558899');" onmouseout="out('2293773823409558899');" style=""> 124            mTaskEntity.isNewTask() ? (mStartThreadNum = setNewTaskThreadNum()) : mTotalThreadNum;                  </span>
<span class="304482857231090385" onmouseenter="enter('304482857231090385');" onmouseout="out('304482857231090385');" style=""> 125        handleBreakpoint();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126      }                                                                                                             </span>
<span class="-5070363508518577757" onmouseenter="enter('-5070363508518577757');" onmouseout="out('-5070363508518577757');" style=""> 127      mConstance.START_THREAD_NUM = mTotalThreadNum;                                                                </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 128      /*                                                                                                            </span>
<span class="-7459715513064469337" onmouseenter="enter('-7459715513064469337');" onmouseout="out('-7459715513064469337');" style=""> 129       * mTaskEntity.getEntity().getFileSize() != mTempFile.length()为兼容以前老版本代码                                      </span>
<span class="-5520474084619660394" onmouseenter="enter('-5520474084619660394');" onmouseout="out('-5520474084619660394');" style=""> 130       * 动态长度条件：                                                                                                    </span>
<span class="6678836087239710153" onmouseenter="enter('6678836087239710153');" onmouseout="out('6678836087239710153');" style=""> 131       * 1、总线程数为1，并且是新任务                                                                                            </span>
<span class="-8594380126502433751" onmouseenter="enter('-8594380126502433751');" onmouseout="out('-8594380126502433751');" style=""> 132       * 2、总线程数为1，不是新任务，但是长度不是文件全长度                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 133       */                                                                                                           </span>
<span class="-763935913933084661" onmouseenter="enter('-763935913933084661');" onmouseout="out('-763935913933084661');" style=""> 134      if (mTotalThreadNum == 1 &amp;&amp; (mTaskEntity.isNewTask()                                                          </span>
<span class="-3606193574981639369" onmouseenter="enter('-3606193574981639369');" onmouseout="out('-3606193574981639369');" style=""> 135          || mTaskEntity.getEntity().getFileSize() != mTempFile.length())) {                                        </span>
<span class="9204016926254181097" onmouseenter="enter('9204016926254181097');" onmouseout="out('9204016926254181097');" style=""> 136        mConstance.isOpenDynamicFile = true;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137      }                                                                                                             </span>
<span class="-7724548171203838725" onmouseenter="enter('-7724548171203838725');" onmouseout="out('-7724548171203838725');" style=""> 138      startTimer();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139    }                                                                                                               </span>
<span  style=""> 140                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 141    /**                                                                                                             </span>
<span class="-5386582613838574396" onmouseenter="enter('-5386582613838574396');" onmouseout="out('-5386582613838574396');" style=""> 142     * 设置新任务的最大线程数                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 143     */                                                                                                             </span>
<span class="-6137859098551091137" onmouseenter="enter('-6137859098551091137');" onmouseout="out('-6137859098551091137');" style=""> 144    protected abstract int setNewTaskThreadNum();                                                                   </span>
<span  style=""> 145                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 146    /**                                                                                                             </span>
<span class="4041581137177203435" onmouseenter="enter('4041581137177203435');" onmouseout="out('4041581137177203435');" style=""> 147     * 启动进度获取定时器                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 148     */                                                                                                             </span>
<span class="-8560002621884285761" onmouseenter="enter('-8560002621884285761');" onmouseout="out('-8560002621884285761');" style=""> 149    private void startTimer() {                                                                                     </span>
<span class="9064905857115753880" onmouseenter="enter('9064905857115753880');" onmouseout="out('9064905857115753880');" style=""> 150      mTimer = new Timer(true);                                                                                     </span>
<span class="1767883212426599488" onmouseenter="enter('1767883212426599488');" onmouseout="out('1767883212426599488');" style=""> 151      mTimer.schedule(new TimerTask() {                                                                             </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 152        @Override public void run() {                                                                               </span>
<span class="5257678828672457716" onmouseenter="enter('5257678828672457716');" onmouseout="out('5257678828672457716');" style=""> 153          if (mConstance.isComplete()                                                                               </span>
<span class="334343515162691172" onmouseenter="enter('334343515162691172');" onmouseout="out('334343515162691172');" style=""> 154              || mConstance.isStop()                                                                                </span>
<span class="3923616872544648792" onmouseenter="enter('3923616872544648792');" onmouseout="out('3923616872544648792');" style=""> 155              || mConstance.isCancel()                                                                              </span>
<span class="-6728476664925849707" onmouseenter="enter('-6728476664925849707');" onmouseout="out('-6728476664925849707');" style=""> 156              || !mConstance.isRunning) {                                                                           </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 157            closeTimer();                                                                                           </span>
<span class="5358021077686010059" onmouseenter="enter('5358021077686010059');" onmouseout="out('5358021077686010059');" style=""> 158          } else if (mConstance.CURRENT_LOCATION &gt;= 0) {                                                            </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style=""> 159            mListener.onProgress(mConstance.CURRENT_LOCATION);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161        }                                                                                                           </span>
<span class="-3821686044197757132" onmouseenter="enter('-3821686044197757132');" onmouseout="out('-3821686044197757132');" style=""> 162      }, 0, mUpdateInterval);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163    }                                                                                                               </span>
<span  style=""> 164                                                                                                                    </span>
<span class="6987763365729675608" onmouseenter="enter('6987763365729675608');" onmouseout="out('6987763365729675608');" style=""> 165    protected void closeTimer() {                                                                                   </span>
<span class="-4343220603110256261" onmouseenter="enter('-4343220603110256261');" onmouseout="out('-4343220603110256261');" style=""> 166      if (mTimer != null) {                                                                                         </span>
<span class="6506490333649261220" onmouseenter="enter('6506490333649261220');" onmouseout="out('6506490333649261220');" style=""> 167        mTimer.purge();                                                                                             </span>
<span class="3936422701741233911" onmouseenter="enter('3936422701741233911');" onmouseout="out('3936422701741233911');" style=""> 168        mTimer.cancel();                                                                                            </span>
<span class="-3760473013259053076" onmouseenter="enter('-3760473013259053076');" onmouseout="out('-3760473013259053076');" style=""> 169        mTimer = null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171    }                                                                                                               </span>
<span  style=""> 172                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 173    /**                                                                                                             </span>
<span class="3310122691908792895" onmouseenter="enter('3310122691908792895');" onmouseout="out('3310122691908792895');" style=""> 174     * 设置定时器更新间隔                                                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 175     *                                                                                                              </span>
<span class="5926421498368036592" onmouseenter="enter('5926421498368036592');" onmouseout="out('5926421498368036592');" style=""> 176     * @param interval 单位毫秒，不能小于0                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 177     */                                                                                                             </span>
<span class="-6143371944494222779" onmouseenter="enter('-6143371944494222779');" onmouseout="out('-6143371944494222779');" style=""> 178    protected void setUpdateInterval(long interval) {                                                               </span>
<span class="-1051498944097002766" onmouseenter="enter('-1051498944097002766');" onmouseout="out('-1051498944097002766');" style=""> 179      if (interval &lt; 0) {                                                                                           </span>
<span class="3000915396455271078" onmouseenter="enter('3000915396455271078');" onmouseout="out('3000915396455271078');" style=""> 180        ALog.w(TAG, &quot;更新间隔不能小于0，默认为1000毫秒&quot;);                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 181        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182      }                                                                                                             </span>
<span class="-3431322530378656562" onmouseenter="enter('-3431322530378656562');" onmouseout="out('-3431322530378656562');" style=""> 183      mUpdateInterval = interval;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184    }                                                                                                               </span>
<span  style=""> 185                                                                                                                    </span>
<span class="-4506592131726080634" onmouseenter="enter('-4506592131726080634');" onmouseout="out('-4506592131726080634');" style=""> 186    @Override public long getFileSize() {                                                                           </span>
<span class="-7902485770489300682" onmouseenter="enter('-7902485770489300682');" onmouseout="out('-7902485770489300682');" style=""> 187      return mEntity.getFileSize();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188    }                                                                                                               </span>
<span  style=""> 189                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 190    /**                                                                                                             </span>
<span class="-7288086523564906780" onmouseenter="enter('-7288086523564906780');" onmouseout="out('-7288086523564906780');" style=""> 191     * 获取当前任务位置                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 192     */                                                                                                             </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style=""> 193    @Override public long getCurrentLocation() {                                                                    </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style=""> 194      return mConstance.CURRENT_LOCATION;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195    }                                                                                                               </span>
<span  style=""> 196                                                                                                                    </span>
<span class="-2237798856776801835" onmouseenter="enter('-2237798856776801835');" onmouseout="out('-2237798856776801835');" style=""> 197    @Override public boolean isRunning() {                                                                          </span>
<span class="-9220268812159037756" onmouseenter="enter('-9220268812159037756');" onmouseout="out('-9220268812159037756');" style=""> 198      return mConstance.isRunning;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199    }                                                                                                               </span>
<span  style=""> 200                                                                                                                    </span>
<span class="305234216015554819" onmouseenter="enter('305234216015554819');" onmouseout="out('305234216015554819');" style=""> 201    @Override public void cancel() {                                                                                </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 202      closeTimer();                                                                                                 </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 203      mConstance.isRunning = false;                                                                                 </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style=""> 204      mConstance.isCancel = true;                                                                                   </span>
<span class="-1828001720390047641" onmouseenter="enter('-1828001720390047641');" onmouseout="out('-1828001720390047641');" style=""> 205      if (mFixedThreadPool != null) {                                                                               </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style=""> 206        mFixedThreadPool.shutdown();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207      }                                                                                                             </span>
<span class="-612803506725482722" onmouseenter="enter('-612803506725482722');" onmouseout="out('-612803506725482722');" style=""> 208      for (int i = 0; i &lt; mStartThreadNum; i++) {                                                                   </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 209        AbsThreadTask task = mTask.get(i);                                                                          </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 210        if (task != null) {                                                                                         </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style=""> 211          task.cancel();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214    }                                                                                                               </span>
<span  style=""> 215                                                                                                                    </span>
<span class="6276273225669041403" onmouseenter="enter('6276273225669041403');" onmouseout="out('6276273225669041403');" style=""> 216    @Override public void stop() {                                                                                  </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 217      closeTimer();                                                                                                 </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 218      mConstance.isRunning = false;                                                                                 </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style=""> 219      mConstance.isStop = true;                                                                                     </span>
<span class="8402005296375476854" onmouseenter="enter('8402005296375476854');" onmouseout="out('8402005296375476854');" style=""> 220      if (mConstance.isComplete()) return;                                                                          </span>
<span class="-1828001720390047641" onmouseenter="enter('-1828001720390047641');" onmouseout="out('-1828001720390047641');" style=""> 221      if (mFixedThreadPool != null) {                                                                               </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style=""> 222        mFixedThreadPool.shutdown();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223      }                                                                                                             </span>
<span class="-612803506725482722" onmouseenter="enter('-612803506725482722');" onmouseout="out('-612803506725482722');" style=""> 224      for (int i = 0; i &lt; mStartThreadNum; i++) {                                                                   </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 225        AbsThreadTask task = mTask.get(i);                                                                          </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 226        if (task != null) {                                                                                         </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style=""> 227          task.stop();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230    }                                                                                                               </span>
<span  style=""> 231                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 232    /**                                                                                                             </span>
<span class="-7218687507933415946" onmouseenter="enter('-7218687507933415946');" onmouseout="out('-7218687507933415946');" style=""> 233     * 直接调用的时候会自动启动线程执行                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 234     */                                                                                                             </span>
<span class="2908281040877937362" onmouseenter="enter('2908281040877937362');" onmouseout="out('2908281040877937362');" style=""> 235    @Override public void start() {                                                                                 </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style=""> 236      new Thread(this).start();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237    }                                                                                                               </span>
<span  style=""> 238                                                                                                                    </span>
<span class="-1531467598256645714" onmouseenter="enter('-1531467598256645714');" onmouseout="out('-1531467598256645714');" style=""> 239    @Override public void resume() {                                                                                </span>
<span class="-6183578153083367222" onmouseenter="enter('-6183578153083367222');" onmouseout="out('-6183578153083367222');" style=""> 240      start();                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241    }                                                                                                               </span>
<span  style=""> 242                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 243    /**                                                                                                             </span>
<span class="-5594313128981442446" onmouseenter="enter('-5594313128981442446');" onmouseout="out('-5594313128981442446');" style=""> 244     * 检查任务、检查线程数                                                                                                   </span>
<span class="5765812458735380113" onmouseenter="enter('5765812458735380113');" onmouseout="out('5765812458735380113');" style=""> 245     * 新任务条件：                                                                                                       </span>
<span class="-3418470207445181215" onmouseenter="enter('-3418470207445181215');" onmouseout="out('-3418470207445181215');" style=""> 246     * 1、文件不存在                                                                                                      </span>
<span class="1471172295356331660" onmouseenter="enter('1471172295356331660');" onmouseout="out('1471172295356331660');" style=""> 247     * 2、任务记录文件缺失或不匹配                                                                                               </span>
<span class="4400956412852543180" onmouseenter="enter('4400956412852543180');" onmouseout="out('4400956412852543180');" style=""> 248     * 3、数据库记录不存在                                                                                                   </span>
<span class="1878350678984943375" onmouseenter="enter('1878350678984943375');" onmouseout="out('1878350678984943375');" style=""> 249     * 4、不支持断点，则是新任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 250     */                                                                                                             </span>
<span class="-8432905628195545001" onmouseenter="enter('-8432905628195545001');" onmouseout="out('-8432905628195545001');" style=""> 251    private void checkTask() {                                                                                      </span>
<span class="-5297450492380711808" onmouseenter="enter('-5297450492380711808');" onmouseout="out('-5297450492380711808');" style=""> 252      mConfigFile = new File(CommonUtil.getFileConfigPath(false, mEntity.getFileName()));                           </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style=""> 253      if (mConfigFile.exists()) {                                                                                   </span>
<span class="7932310618145443523" onmouseenter="enter('7932310618145443523');" onmouseout="out('7932310618145443523');" style=""> 254        convertDb();                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 255      } else {                                                                                                      </span>
<span class="-5238664810335263343" onmouseenter="enter('-5238664810335263343');" onmouseout="out('-5238664810335263343');" style=""> 256        mRecord = DbHelper.getTaskRecord(mTaskEntity.getKey());                                                     </span>
<span class="-3299415613061807412" onmouseenter="enter('-3299415613061807412');" onmouseout="out('-3299415613061807412');" style=""> 257        if (mRecord == null) {                                                                                      </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 258          initRecord();                                                                                             </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 259          mTaskEntity.setNewTask(true);                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 260        } else {                                                                                                    </span>
<span class="-7168613097949101282" onmouseenter="enter('-7168613097949101282');" onmouseout="out('-7168613097949101282');" style=""> 261          if (mRecord.threadRecords == null || mRecord.threadRecords.isEmpty()) {                                   </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 262            initRecord();                                                                                           </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 263            mTaskEntity.setNewTask(true);                                                                           </span>
<span class="-4489756692986098869" onmouseenter="enter('-4489756692986098869');" onmouseout="out('-4489756692986098869');" style=""> 264          } else if (mTempFile.length() == 0) {                                                                     </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style=""> 265            mRecord.deleteData();                                                                                   </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 266            initRecord();                                                                                           </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 267            mTaskEntity.setNewTask(true);                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 268          } else {                                                                                                  </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style=""> 269            for (ThreadRecord tr : mRecord.threadRecords) {                                                         </span>
<span class="-6249885869558348483" onmouseenter="enter('-6249885869558348483');" onmouseout="out('-6249885869558348483');" style=""> 270              if (tr.isComplete) {                                                                                  </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style=""> 271                mCompleteThreadNum++;                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 272              } else {                                                                                              </span>
<span class="-4361198270326326802" onmouseenter="enter('-4361198270326326802');" onmouseout="out('-4361198270326326802');" style=""> 273                mStartThreadNum++;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275            }                                                                                                       </span>
<span class="-4812553014330515673" onmouseenter="enter('-4812553014330515673');" onmouseout="out('-4812553014330515673');" style=""> 276            mTotalThreadNum = mRecord.threadRecords.size();                                                         </span>
<span class="-561823525574412259" onmouseenter="enter('-561823525574412259');" onmouseout="out('-561823525574412259');" style=""> 277            mTaskEntity.setNewTask(false);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281    }                                                                                                               </span>
<span  style=""> 282                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 283    /**                                                                                                             </span>
<span class="1070716404183585489" onmouseenter="enter('1070716404183585489');" onmouseout="out('1070716404183585489');" style=""> 284     * convertDb 为兼容性代码                                                                                             </span>
<span class="3982968248834793214" onmouseenter="enter('3982968248834793214');" onmouseout="out('3982968248834793214');" style=""> 285     * 从3.4.1开始，线程配置信息将存储在数据库中。                                                                                     </span>
<span class="-6928102974415786303" onmouseenter="enter('-6928102974415786303');" onmouseout="out('-6928102974415786303');" style=""> 286     * 将配置文件的内容复制到数据库中，并将配置文件删除                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 287     */                                                                                                             </span>
<span class="14298455509427519" onmouseenter="enter('14298455509427519');" onmouseout="out('14298455509427519');" style=""> 288    private void convertDb() {                                                                                      </span>
<span class="-4598298306615401010" onmouseenter="enter('-4598298306615401010');" onmouseout="out('-4598298306615401010');" style=""> 289      List&lt;RecordWrapper&gt; records =                                                                                 </span>
<span class="-4738968014729726274" onmouseenter="enter('-4738968014729726274');" onmouseout="out('-4738968014729726274');" style=""> 290          DbEntity.findRelationData(RecordWrapper.class, &quot;TaskRecord.filePath=?&quot;,                                   </span>
<span class="96831814087260276" onmouseenter="enter('96831814087260276');" onmouseout="out('96831814087260276');" style=""> 291              mTaskEntity.getKey());                                                                                </span>
<span class="-376648440877788579" onmouseenter="enter('-376648440877788579');" onmouseout="out('-376648440877788579');" style=""> 292      if (records == null || records.size() == 0) {                                                                 </span>
<span class="7274393295178915569" onmouseenter="enter('7274393295178915569');" onmouseout="out('7274393295178915569');" style=""> 293        Properties pro = CommonUtil.loadConfig(mConfigFile);                                                        </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style=""> 294        if (pro.isEmpty()) {                                                                                        </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 295          mTaskEntity.setNewTask(true);                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 296          return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297        }                                                                                                           </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 298        initRecord();                                                                                               </span>
<span class="-4092719147494026286" onmouseenter="enter('-4092719147494026286');" onmouseout="out('-4092719147494026286');" style=""> 299        Set&lt;Object&gt; keys = pro.keySet();                                                                            </span>
<span class="7117164647387083506" onmouseenter="enter('7117164647387083506');" onmouseout="out('7117164647387083506');" style=""> 300        // 老版本记录是5s存一次，但是5s中内，如果线程执行完成，record记录是没有的，只有state记录...                                                    </span>
<span class="8442347856216504710" onmouseenter="enter('8442347856216504710');" onmouseout="out('8442347856216504710');" style=""> 301        // 第一步应该是record 和 state去重取正确的线程数                                                                            </span>
<span class="3880560860847601414" onmouseenter="enter('3880560860847601414');" onmouseout="out('3880560860847601414');" style=""> 302        Set&lt;Integer&gt; set = new HashSet&lt;&gt;();                                                                         </span>
<span class="-5644624400733519290" onmouseenter="enter('-5644624400733519290');" onmouseout="out('-5644624400733519290');" style=""> 303        for (Object key : keys) {                                                                                   </span>
<span class="-90111359741489740" onmouseenter="enter('-90111359741489740');" onmouseout="out('-90111359741489740');" style=""> 304          String str = String.valueOf(key);                                                                         </span>
<span class="5431713397557299419" onmouseenter="enter('5431713397557299419');" onmouseout="out('5431713397557299419');" style=""> 305          int i = Integer.parseInt(str.substring(str.length() - 1, str.length()));                                  </span>
<span class="5139166377005733880" onmouseenter="enter('5139166377005733880');" onmouseout="out('5139166377005733880');" style=""> 306          set.add(i);                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307        }                                                                                                           </span>
<span class="1773727540275693887" onmouseenter="enter('1773727540275693887');" onmouseout="out('1773727540275693887');" style=""> 308        int threadNum = set.size();                                                                                 </span>
<span class="1658307869252768908" onmouseenter="enter('1658307869252768908');" onmouseout="out('1658307869252768908');" style=""> 309        if (threadNum == 0) {                                                                                       </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 310          mTaskEntity.setNewTask(true);                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 311          return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312        }                                                                                                           </span>
<span class="8980547023143351106" onmouseenter="enter('8980547023143351106');" onmouseout="out('8980547023143351106');" style=""> 313        mRecord.threadNum = threadNum;                                                                              </span>
<span class="1082026445239340300" onmouseenter="enter('1082026445239340300');" onmouseout="out('1082026445239340300');" style=""> 314        mTotalThreadNum = threadNum;                                                                                </span>
<span  style=""> 315                                                                                                                    </span>
<span class="92058997093189211" onmouseenter="enter('92058997093189211');" onmouseout="out('92058997093189211');" style=""> 316        for (int i = 0; i &lt; threadNum; i++) {                                                                       </span>
<span class="1846142719149590893" onmouseenter="enter('1846142719149590893');" onmouseout="out('1846142719149590893');" style=""> 317          ThreadRecord tRecord = new ThreadRecord();                                                                </span>
<span class="-543854586085341709" onmouseenter="enter('-543854586085341709');" onmouseout="out('-543854586085341709');" style=""> 318          tRecord.key = mRecord.filePath;                                                                           </span>
<span class="-1285896534897014429" onmouseenter="enter('-1285896534897014429');" onmouseout="out('-1285896534897014429');" style=""> 319          Object state = pro.getProperty(mTempFile.getName() + STATE + i);                                          </span>
<span class="7744986855104654034" onmouseenter="enter('7744986855104654034');" onmouseout="out('7744986855104654034');" style=""> 320          Object record = pro.getProperty(mTempFile.getName() + RECORD + i);                                        </span>
<span class="-1417732743646819816" onmouseenter="enter('-1417732743646819816');" onmouseout="out('-1417732743646819816');" style=""> 321          if (state != null &amp;&amp; Integer.parseInt(String.valueOf(state)) == 1) {                                      </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style=""> 322            mCompleteThreadNum++;                                                                                   </span>
<span class="-5900743039323389312" onmouseenter="enter('-5900743039323389312');" onmouseout="out('-5900743039323389312');" style=""> 323            tRecord.isComplete = true;                                                                              </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 324            continue;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325          }                                                                                                         </span>
<span class="-4361198270326326802" onmouseenter="enter('-4361198270326326802');" onmouseout="out('-4361198270326326802');" style=""> 326          mStartThreadNum++;                                                                                        </span>
<span class="2652986304939921073" onmouseenter="enter('2652986304939921073');" onmouseout="out('2652986304939921073');" style=""> 327          if (record != null) {                                                                                     </span>
<span class="-5505735994889378269" onmouseenter="enter('-5505735994889378269');" onmouseout="out('-5505735994889378269');" style=""> 328            Long temp = Long.parseLong(String.valueOf(record));                                                     </span>
<span class="6949017848225026676" onmouseenter="enter('6949017848225026676');" onmouseout="out('6949017848225026676');" style=""> 329            tRecord.startLocation = temp &gt; 0 ? temp : 0;                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 330          } else {                                                                                                  </span>
<span class="-2463924567028920967" onmouseenter="enter('-2463924567028920967');" onmouseout="out('-2463924567028920967');" style=""> 331            tRecord.startLocation = 0;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332          }                                                                                                         </span>
<span class="8450336720909475026" onmouseenter="enter('8450336720909475026');" onmouseout="out('8450336720909475026');" style=""> 333          mRecord.threadRecords.add(tRecord);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334        }                                                                                                           </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style=""> 335        mConfigFile.delete();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337    }                                                                                                               </span>
<span  style=""> 338                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 339    /**                                                                                                             </span>
<span class="-671827589422898020" onmouseenter="enter('-671827589422898020');" onmouseout="out('-671827589422898020');" style=""> 340     * 初始化记录                                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 341     */                                                                                                             </span>
<span class="7657423209226081953" onmouseenter="enter('7657423209226081953');" onmouseout="out('7657423209226081953');" style=""> 342    private void initRecord() {                                                                                     </span>
<span class="1363226846886967285" onmouseenter="enter('1363226846886967285');" onmouseout="out('1363226846886967285');" style=""> 343      mRecord = new TaskRecord();                                                                                   </span>
<span class="-5083582960729315317" onmouseenter="enter('-5083582960729315317');" onmouseout="out('-5083582960729315317');" style=""> 344      mRecord.fileName = mEntity.getFileName();                                                                     </span>
<span class="3577925922319021061" onmouseenter="enter('3577925922319021061');" onmouseout="out('3577925922319021061');" style=""> 345      mRecord.filePath = mTaskEntity.getKey();                                                                      </span>
<span class="-4117247167556656758" onmouseenter="enter('-4117247167556656758');" onmouseout="out('-4117247167556656758');" style=""> 346      mRecord.threadRecords = new ArrayList&lt;&gt;();                                                                    </span>
<span class="8089432194042683150" onmouseenter="enter('8089432194042683150');" onmouseout="out('8089432194042683150');" style=""> 347      mRecord.isGroupRecord = mTaskEntity.getEntity().isGroupChild();                                               </span>
<span class="8800687954183002826" onmouseenter="enter('8800687954183002826');" onmouseout="out('8800687954183002826');" style=""> 348      if (mRecord.isGroupRecord) {                                                                                  </span>
<span class="-817579183662015631" onmouseenter="enter('-817579183662015631');" onmouseout="out('-817579183662015631');" style=""> 349        if (mTaskEntity.getEntity() instanceof DownloadEntity) {                                                    </span>
<span class="-7647901316480546218" onmouseenter="enter('-7647901316480546218');" onmouseout="out('-7647901316480546218');" style=""> 350          mRecord.dGroupName = ((DownloadEntity) mTaskEntity.getEntity()).getGroupName();                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353    }                                                                                                               </span>
<span  style=""> 354                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 355    /**                                                                                                             </span>
<span class="-8991940256279851469" onmouseenter="enter('-8991940256279851469');" onmouseout="out('-8991940256279851469');" style=""> 356     * 保存任务记录                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 357     */                                                                                                             </span>
<span class="1188287987342183098" onmouseenter="enter('1188287987342183098');" onmouseout="out('1188287987342183098');" style=""> 358    private void saveRecord() {                                                                                     </span>

<span class="-3343791891312496302" onmouseenter="enter('-3343791891312496302');" onmouseout="out('-3343791891312496302');" style=""> 359      mRecord.save();                                                                                               </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style=""> 360      for (ThreadRecord tr : mRecord.threadRecords) {                                                               </span>
<span class="1550150863078778036" onmouseenter="enter('1550150863078778036');" onmouseout="out('1550150863078778036');" style=""> 361        tr.save();                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 363    }                                                                                                               </span>
<span  style=""> 364                                                                                                                    </span>
<span class="1066955891247002122" onmouseenter="enter('1066955891247002122');" onmouseout="out('1066955891247002122');" style=""> 365    public TaskRecord getRecord() {                                                                                 </span>
<span class="-7223580788630505532" onmouseenter="enter('-7223580788630505532');" onmouseout="out('-7223580788630505532');" style=""> 366      return mRecord;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367    }                                                                                                               </span>
<span  style=""> 368                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 369    /**                                                                                                             </span>
<span class="7661061719912178382" onmouseenter="enter('7661061719912178382');" onmouseout="out('7661061719912178382');" style=""> 370     * 恢复记录地址                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 371     *                                                                                                              </span>
<span class="-1706428464808283045" onmouseenter="enter('-1706428464808283045');" onmouseout="out('-1706428464808283045');" style=""> 372     * @return {@code true}任务已完成                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 373     */                                                                                                             </span>
<span class="423019558917313706" onmouseenter="enter('423019558917313706');" onmouseout="out('423019558917313706');" style=""> 374    private boolean resumeRecordLocation(int i, long startL, long endL) {                                           </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style=""> 375      mConstance.CURRENT_LOCATION += endL - startL;                                                                 </span>
<span class="-3554759638611896536" onmouseenter="enter('-3554759638611896536');" onmouseout="out('-3554759638611896536');" style=""> 376      ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__已完成&quot;, mTaskEntity.getEntity().getFileName(), i));                    </span>
<span class="3932130165010443212" onmouseenter="enter('3932130165010443212');" onmouseout="out('3932130165010443212');" style=""> 377      mConstance.COMPLETE_THREAD_NUM = mCompleteThreadNum;                                                          </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style=""> 378      mConstance.STOP_NUM++;                                                                                        </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style=""> 379      mConstance.CANCEL_NUM++;                                                                                      </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style=""> 380      if (mConstance.isComplete()) {                                                                                </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style=""> 381        mRecord.deleteData();                                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 382        mListener.onComplete();                                                                                     </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 383        mConstance.isRunning = false;                                                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 384        return true;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385      }                                                                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 386      return false;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387    }                                                                                                               </span>
<span  style=""> 388                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 389    /**                                                                                                             </span>
<span class="8881300510663389339" onmouseenter="enter('8881300510663389339');" onmouseout="out('8881300510663389339');" style=""> 390     * 启动断点任务时，创建单线程任务                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 391     *                                                                                                              </span>
<span class="4311889051397531831" onmouseenter="enter('4311889051397531831');" onmouseout="out('4311889051397531831');" style=""> 392     * @param i 线程id                                                                                                </span>
<span class="1230174220176038900" onmouseenter="enter('1230174220176038900');" onmouseout="out('1230174220176038900');" style=""> 393     * @param startL 该任务起始位置                                                                                        </span>
<span class="1858994332528537357" onmouseenter="enter('1858994332528537357');" onmouseout="out('1858994332528537357');" style=""> 394     * @param endL 该任务结束位置                                                                                          </span>
<span class="4908980689327331914" onmouseenter="enter('4908980689327331914');" onmouseout="out('4908980689327331914');" style=""> 395     * @param fileLength 该任务需要处理的文件长度                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 396     */                                                                                                             </span>
<span class="8417307416647678377" onmouseenter="enter('8417307416647678377');" onmouseout="out('8417307416647678377');" style=""> 397    private AbsThreadTask createSingThreadTask(int i, long startL, long endL, long fileLength,                      </span>
<span class="-2934306509623024164" onmouseenter="enter('-2934306509623024164');" onmouseout="out('-2934306509623024164');" style=""> 398        ThreadRecord record) {                                                                                      </span>
<span class="-7768173698086340418" onmouseenter="enter('-7768173698086340418');" onmouseout="out('-7768173698086340418');" style=""> 399      SubThreadConfig&lt;TASK_ENTITY&gt; config = new SubThreadConfig&lt;&gt;();                                                </span>
<span class="-8558948078866873984" onmouseenter="enter('-8558948078866873984');" onmouseout="out('-8558948078866873984');" style=""> 400      config.FILE_SIZE = fileLength;                                                                                </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style=""> 401      config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                              </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style=""> 402      config.TEMP_FILE = mTempFile;                                                                                 </span>
<span class="-8589974584258899309" onmouseenter="enter('-8589974584258899309');" onmouseout="out('-8589974584258899309');" style=""> 403      config.THREAD_ID = i;                                                                                         </span>
<span class="-423990566973150114" onmouseenter="enter('-423990566973150114');" onmouseout="out('-423990566973150114');" style=""> 404      config.START_LOCATION = startL;                                                                               </span>
<span class="7030036366591044852" onmouseenter="enter('7030036366591044852');" onmouseout="out('7030036366591044852');" style=""> 405      config.END_LOCATION = endL;                                                                                   </span>
<span class="4558959233585694596" onmouseenter="enter('4558959233585694596');" onmouseout="out('4558959233585694596');" style=""> 406      config.SUPPORT_BP = mTaskEntity.isSupportBP();                                                                </span>
<span class="-6844563562976749056" onmouseenter="enter('-6844563562976749056');" onmouseout="out('-6844563562976749056');" style=""> 407      config.TASK_ENTITY = mTaskEntity;                                                                             </span>
<span class="-4817448612298280426" onmouseenter="enter('-4817448612298280426');" onmouseout="out('-4817448612298280426');" style=""> 408      config.THREAD_RECORD = record;                                                                                </span>
<span class="-3921818352268167442" onmouseenter="enter('-3921818352268167442');" onmouseout="out('-3921818352268167442');" style=""> 409      return selectThreadTask(config);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410    }                                                                                                               </span>
<span  style=""> 411                                                                                                                    </span>
<span class="6532423587840407518" onmouseenter="enter('6532423587840407518');" onmouseout="out('6532423587840407518');" style=""> 412    private void handleBreakpoint() {                                                                               </span>
<span class="-4822982872266026601" onmouseenter="enter('-4822982872266026601');" onmouseout="out('-4822982872266026601');" style=""> 413      long fileLength = mEntity.getFileSize();                                                                      </span>
<span class="-23207299311678828" onmouseenter="enter('-23207299311678828');" onmouseout="out('-23207299311678828');" style=""> 414      long blockSize = fileLength / mTotalThreadNum;                                                                </span>
<span class="7144011642124032136" onmouseenter="enter('7144011642124032136');" onmouseout="out('7144011642124032136');" style=""> 415      int[] threadId = new int[mTotalThreadNum];                                                                    </span>
<span class="794844889575716346" onmouseenter="enter('794844889575716346');" onmouseout="out('794844889575716346');" style=""> 416      int rl = 0;                                                                                                   </span>
<span  style=""> 417                                                                                                                    </span>
<span class="575574520788079541" onmouseenter="enter('575574520788079541');" onmouseout="out('575574520788079541');" style=""> 418      mRecord.fileLength = fileLength;                                                                              </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 419      for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                                   </span>
<span class="5272717944804854313" onmouseenter="enter('5272717944804854313');" onmouseout="out('5272717944804854313');" style=""> 420        threadId[i] = -1;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 421      }                                                                                                             </span>
<span class="3996378219805798096" onmouseenter="enter('3996378219805798096');" onmouseout="out('3996378219805798096');" style=""> 422      if (mTaskEntity.isNewTask() &amp;&amp; !handleNewTask()) {                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 423        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 424      }                                                                                                             </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 425      for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                                   </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style=""> 426        long startL = i * blockSize, endL = (i + 1) * blockSize;                                                    </span>
<span class="5090177735693834127" onmouseenter="enter('5090177735693834127');" onmouseout="out('5090177735693834127');" style=""> 427        ThreadRecord tr;                                                                                            </span>
<span class="-7836453111996726628" onmouseenter="enter('-7836453111996726628');" onmouseout="out('-7836453111996726628');" style=""> 428        boolean isNewTr = false;  // 是否是新的线程记录                                                                      </span>
<span class="-6597548071328599593" onmouseenter="enter('-6597548071328599593');" onmouseout="out('-6597548071328599593');" style=""> 429        if (mTaskEntity.isNewTask()) {                                                                              </span>
<span class="-1372101013715036968" onmouseenter="enter('-1372101013715036968');" onmouseout="out('-1372101013715036968');" style=""> 430          tr = new ThreadRecord();                                                                                  </span>
<span class="3917749081996930633" onmouseenter="enter('3917749081996930633');" onmouseout="out('3917749081996930633');" style=""> 431          tr.key = mRecord.filePath;                                                                                </span>
<span class="-7575886392361997801" onmouseenter="enter('-7575886392361997801');" onmouseout="out('-7575886392361997801');" style=""> 432          tr.threadId = i;                                                                                          </span>
<span class="3085824084899250864" onmouseenter="enter('3085824084899250864');" onmouseout="out('3085824084899250864');" style=""> 433          isNewTr = true;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 434        } else {                                                                                                    </span>
<span class="-548726359565759652" onmouseenter="enter('-548726359565759652');" onmouseout="out('-548726359565759652');" style=""> 435          tr = mRecord.threadRecords.get(i);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436        }                                                                                                           </span>
<span class="-973014210831854259" onmouseenter="enter('-973014210831854259');" onmouseout="out('-973014210831854259');" style=""> 437        if (tr.isComplete) {//该线程已经完成                                                                               </span>
<span class="5189294880655919692" onmouseenter="enter('5189294880655919692');" onmouseout="out('5189294880655919692');" style=""> 438          if (resumeRecordLocation(i, startL, endL)) return;                                                        </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 439          continue;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440        }                                                                                                           </span>
<span  style=""> 441                                                                                                                    </span>
<span class="1183688269285295822" onmouseenter="enter('1183688269285295822');" onmouseout="out('1183688269285295822');" style=""> 442        //如果有记录，则恢复任务                                                                                               </span>
<span class="8289251945837025497" onmouseenter="enter('8289251945837025497');" onmouseout="out('8289251945837025497');" style=""> 443        if (tr.startLocation &gt;= 0) {                                                                                </span>
<span class="-7166560389597808593" onmouseenter="enter('-7166560389597808593');" onmouseout="out('-7166560389597808593');" style=""> 444          Long r = tr.startLocation;                                                                                </span>
<span class="-7915611879357930899" onmouseenter="enter('-7915611879357930899');" onmouseout="out('-7915611879357930899');" style=""> 445          //记录的位置需要在线程区间中                                                                                           </span>
<span class="-1441157907339638000" onmouseenter="enter('-1441157907339638000');" onmouseout="out('-1441157907339638000');" style=""> 446          if (startL &lt; r &amp;&amp; r &lt; (i == (mTotalThreadNum - 1) ? fileLength : endL)) {                                 </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style=""> 447            mConstance.CURRENT_LOCATION += r - startL;                                                              </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style=""> 448            startL = r;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449          }                                                                                                         </span>
<span class="5845990765500507783" onmouseenter="enter('5845990765500507783');" onmouseout="out('5845990765500507783');" style=""> 450          ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__恢复任务&quot;, mEntity.getFileName(), i));                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451        }                                                                                                           </span>
<span class="7194952027883197425" onmouseenter="enter('7194952027883197425');" onmouseout="out('7194952027883197425');" style=""> 452        //最后一个线程的结束位置即为文件的总长度                                                                                       </span>
<span class="-5942950699866528890" onmouseenter="enter('-5942950699866528890');" onmouseout="out('-5942950699866528890');" style=""> 453        if (i == (mTotalThreadNum - 1)) {                                                                           </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style=""> 454          endL = fileLength;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 455        }                                                                                                           </span>
<span class="8496166720772172680" onmouseenter="enter('8496166720772172680');" onmouseout="out('8496166720772172680');" style=""> 456        // 更新记录                                                                                                     </span>
<span class="635736622332337160" onmouseenter="enter('635736622332337160');" onmouseout="out('635736622332337160');" style=""> 457        tr.startLocation = startL;                                                                                  </span>
<span class="-8820011367691672414" onmouseenter="enter('-8820011367691672414');" onmouseout="out('-8820011367691672414');" style=""> 458        tr.endLocation = endL;                                                                                      </span>
<span class="-5584934139293502444" onmouseenter="enter('-5584934139293502444');" onmouseout="out('-5584934139293502444');" style=""> 459        if (isNewTr) {                                                                                              </span>
<span class="7750338393456465672" onmouseenter="enter('7750338393456465672');" onmouseout="out('7750338393456465672');" style=""> 460          mRecord.threadRecords.add(tr);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 461        }                                                                                                           </span>
<span class="6319026600890011419" onmouseenter="enter('6319026600890011419');" onmouseout="out('6319026600890011419');" style=""> 462        AbsThreadTask task = createSingThreadTask(i, startL, endL, fileLength, tr);                                 </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style=""> 463        if (task == null) return;                                                                                   </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style=""> 464        mTask.put(i, task);                                                                                         </span>
<span class="2496245772724592303" onmouseenter="enter('2496245772724592303');" onmouseout="out('2496245772724592303');" style=""> 465        threadId[rl] = i;                                                                                           </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style=""> 466        rl++;                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 467      }                                                                                                             </span>





<span class="-4447853798640415053" onmouseenter="enter('-4447853798640415053');" onmouseout="out('-4447853798640415053');" style=""> 468      saveRecord();                                                                                                 </span>
<span class="5367791124370950090" onmouseenter="enter('5367791124370950090');" onmouseout="out('5367791124370950090');" style=""> 469      startThreadTask(threadId);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470    }                                                                                                               </span>
<span  style=""> 471                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 472    /**                                                                                                             </span>
<span class="3352756078121499684" onmouseenter="enter('3352756078121499684');" onmouseout="out('3352756078121499684');" style=""> 473     * 启动单线程任务                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 474     */                                                                                                             </span>
<span class="-4163844434134623471" onmouseenter="enter('-4163844434134623471');" onmouseout="out('-4163844434134623471');" style=""> 475    private void startThreadTask(int[] recordL) {                                                                   </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style=""> 476      if (mConstance.CURRENT_LOCATION &gt; 0) {                                                                        </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style=""> 477        mListener.onResume(mConstance.CURRENT_LOCATION);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 478      } else {                                                                                                      </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style=""> 479        mListener.onStart(mConstance.CURRENT_LOCATION);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 480      }                                                                                                             </span>
<span class="-3724057379342966503" onmouseenter="enter('-3724057379342966503');" onmouseout="out('-3724057379342966503');" style=""> 481      mFixedThreadPool = Executors.newFixedThreadPool(recordL.length);                                              </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style=""> 482      for (int l : recordL) {                                                                                       </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style=""> 483        if (l == -1) continue;                                                                                      </span>
<span class="-85915337091278441" onmouseenter="enter('-85915337091278441');" onmouseout="out('-85915337091278441');" style=""> 484        Runnable task = mTask.get(l);                                                                               </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 485        if (task != null) {                                                                                         </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 486          mFixedThreadPool.execute(task);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 488      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 489    }                                                                                                               </span>
<span  style=""> 490                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 491    /**                                                                                                             </span>
<span class="4764351819472741633" onmouseenter="enter('4764351819472741633');" onmouseout="out('4764351819472741633');" style=""> 492     * 重试线程任务，只有线程创建成功才能重试                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 493     */                                                                                                             </span>
<span class="-7672284813277629720" onmouseenter="enter('-7672284813277629720');" onmouseout="out('-7672284813277629720');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 494 -  public void retryThradTask() {                                                                                  </span>
<span class="-5467219194911799226" onmouseenter="enter('-5467219194911799226');" onmouseout="out('-5467219194911799226');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 495 +  public void retryThreadTask() {                                                                                 </span>
<span class="5365338227073743" onmouseenter="enter('5365338227073743');" onmouseout="out('5365338227073743');" style=""> 496      if (mTask == null || mTask.size() == 0) {                                                                     </span>
<span class="-4385520730156955316" onmouseenter="enter('-4385520730156955316');" onmouseout="out('-4385520730156955316');" style=""> 497        ALog.w(TAG, &quot;没有线程任务&quot;);                                                                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 498        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499      }                                                                                                             </span>
<span class="-9197459414244668337" onmouseenter="enter('-9197459414244668337');" onmouseout="out('-9197459414244668337');" style=""> 500      Set&lt;Integer&gt; keys = mTask.keySet();                                                                           </span>
<span class="4969357970824756675" onmouseenter="enter('4969357970824756675');" onmouseout="out('4969357970824756675');" style=""> 501      for (Integer key : keys) {                                                                                    </span>
<span class="-8581528427459564550" onmouseenter="enter('-8581528427459564550');" onmouseout="out('-8581528427459564550');" style=""> 502        AbsThreadTask task = mTask.get(key);                                                                        </span>
<span class="-6295419555080725627" onmouseenter="enter('-6295419555080725627');" onmouseout="out('-6295419555080725627');" style=""> 503        if (task != null &amp;&amp; !task.isThreadComplete()) {                                                             </span>
<span class="5627547129301802684" onmouseenter="enter('5627547129301802684');" onmouseout="out('5627547129301802684');" style=""> 504          task.getConfig().START_LOCATION = task.getCurrentLocation();                                              </span>
<span class="2850733480082561720" onmouseenter="enter('2850733480082561720');" onmouseout="out('2850733480082561720');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 505 +        mConstance.isStop = false;                                                                                </span>
<span class="-6084373575236396497" onmouseenter="enter('-6084373575236396497');" onmouseout="out('-6084373575236396497');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 506 +        mConstance.isCancel = false;                                                                              </span>
<span class="7884789031988873835" onmouseenter="enter('7884789031988873835');" onmouseout="out('7884789031988873835');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 507 +        mConstance.isRunning = true;                                                                              </span>
<span class="7735765379424984851" onmouseenter="enter('7735765379424984851');" onmouseout="out('7735765379424984851');" style=""> 508          ALog.d(TAG, String.format(&quot;任务【%s】开始重试，线程__%s__【开始位置：%s，结束位置：%s】&quot;, mEntity.getFileName(),                  </span>
<span class="-669110355825383115" onmouseenter="enter('-669110355825383115');" onmouseout="out('-669110355825383115');" style=""> 509              key, task.getConfig().START_LOCATION, task.getConfig().END_LOCATION));                                </span>



<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 510          mFixedThreadPool.execute(task);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 511        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 512      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 513    }                                                                                                               </span>
<span  style=""> 514                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 515    /**                                                                                                             </span>
<span class="3489882028140634260" onmouseenter="enter('3489882028140634260');" onmouseout="out('3489882028140634260');" style=""> 516     * 处理新任务                                                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 517     *                                                                                                              </span>
<span class="8941769692798326625" onmouseenter="enter('8941769692798326625');" onmouseout="out('8941769692798326625');" style=""> 518     * @return {@code true}创建新任务失败                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 519     */                                                                                                             </span>
<span class="3897453149098456479" onmouseenter="enter('3897453149098456479');" onmouseout="out('3897453149098456479');" style=""> 520    protected abstract boolean handleNewTask();                                                                     </span>
<span  style=""> 521                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 522    /**                                                                                                             </span>
<span class="-4404408971562231280" onmouseenter="enter('-4404408971562231280');" onmouseout="out('-4404408971562231280');" style=""> 523     * 处理不支持断点的任务                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 524     */                                                                                                             </span>
<span class="-8792279366871913220" onmouseenter="enter('-8792279366871913220');" onmouseout="out('-8792279366871913220');" style=""> 525    private void handleNoSupportBP() {                                                                              </span>
<span class="-7768173698086340418" onmouseenter="enter('-7768173698086340418');" onmouseout="out('-7768173698086340418');" style=""> 526      SubThreadConfig&lt;TASK_ENTITY&gt; config = new SubThreadConfig&lt;&gt;();                                                </span>
<span class="-8916543478630030690" onmouseenter="enter('-8916543478630030690');" onmouseout="out('-8916543478630030690');" style=""> 527      config.FILE_SIZE = mEntity.getFileSize();                                                                     </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style=""> 528      config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                              </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style=""> 529      config.TEMP_FILE = mTempFile;                                                                                 </span>
<span class="-5899809357890352135" onmouseenter="enter('-5899809357890352135');" onmouseout="out('-5899809357890352135');" style=""> 530      config.THREAD_ID = 0;                                                                                         </span>
<span class="7958711547477559333" onmouseenter="enter('7958711547477559333');" onmouseout="out('7958711547477559333');" style=""> 531      config.START_LOCATION = 0;                                                                                    </span>
<span class="911498546153633759" onmouseenter="enter('911498546153633759');" onmouseout="out('911498546153633759');" style=""> 532      config.END_LOCATION = config.FILE_SIZE;                                                                       </span>
<span class="4558959233585694596" onmouseenter="enter('4558959233585694596');" onmouseout="out('4558959233585694596');" style=""> 533      config.SUPPORT_BP = mTaskEntity.isSupportBP();                                                                </span>
<span class="-6844563562976749056" onmouseenter="enter('-6844563562976749056');" onmouseout="out('-6844563562976749056');" style=""> 534      config.TASK_ENTITY = mTaskEntity;                                                                             </span>
<span class="-5296271627358693026" onmouseenter="enter('-5296271627358693026');" onmouseout="out('-5296271627358693026');" style=""> 535      AbsThreadTask task = selectThreadTask(config);                                                                </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style=""> 536      if (task == null) return;                                                                                     </span>
<span class="8048363116921461760" onmouseenter="enter('8048363116921461760');" onmouseout="out('8048363116921461760');" style=""> 537      mTask.put(0, task);                                                                                           </span>
<span class="4151941088630277800" onmouseenter="enter('4151941088630277800');" onmouseout="out('4151941088630277800');" style=""> 538      mFixedThreadPool = Executors.newFixedThreadPool(1);                                                           </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 539      mFixedThreadPool.execute(task);                                                                               </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style=""> 540      mListener.onStart(0);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541    }                                                                                                               </span>
<span  style=""> 542                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 543    /**                                                                                                             </span>
<span class="5502854491504205724" onmouseenter="enter('5502854491504205724');" onmouseout="out('5502854491504205724');" style=""> 544     * 选择单任务线程的类型                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 545     */                                                                                                             </span>
<span class="-158713741323683937" onmouseenter="enter('-158713741323683937');" onmouseout="out('-158713741323683937');" style=""> 546    protected abstract AbsThreadTask selectThreadTask(SubThreadConfig&lt;TASK_ENTITY&gt; config);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 547  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16  package com.arialyy.aria.core.common;                                                                             </span>
<span  style="">  17                                                                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  18  import android.content.Context;                                                                                   </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  19  import com.arialyy.aria.core.AriaManager;                                                                         </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="">  20  import com.arialyy.aria.core.download.DownloadEntity;                                                             </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  21  import com.arialyy.aria.core.inf.AbsNormalEntity;                                                                 </span>
<span class="4195608340199028072" onmouseenter="enter('4195608340199028072');" onmouseout="out('4195608340199028072');" style="">  22  import com.arialyy.aria.core.inf.AbsTaskEntity;                                                                   </span>
<span class="-2820121753251967085" onmouseenter="enter('-2820121753251967085');" onmouseout="out('-2820121753251967085');" style="">  23  import com.arialyy.aria.core.inf.IDownloadListener;                                                               </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  24  import com.arialyy.aria.core.inf.IEventListener;                                                                  </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="">  25  import com.arialyy.aria.orm.DbEntity;                                                                             </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  26  import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  27  import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="4945295635398100121" onmouseenter="enter('4945295635398100121');" onmouseout="out('4945295635398100121');" style="">  28  import com.arialyy.aria.util.DbHelper;                                                                            </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  29  import java.io.File;                                                                                              </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  30  import java.util.ArrayList;                                                                                       </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  31  import java.util.HashMap;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  32  import java.util.HashSet;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  33  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  34  import java.util.Map;                                                                                             </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  35  import java.util.Properties;                                                                                      </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  36  import java.util.Set;                                                                                             </span>
<span class="-3789567581486736748" onmouseenter="enter('-3789567581486736748');" onmouseout="out('-3789567581486736748');" style="">  37  import java.util.Timer;                                                                                           </span>
<span class="-2321797189340986544" onmouseenter="enter('-2321797189340986544');" onmouseout="out('-2321797189340986544');" style="">  38  import java.util.TimerTask;                                                                                       </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  39  import java.util.concurrent.ExecutorService;                                                                      </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  40  import java.util.concurrent.Executors;                                                                            </span>
<span  style="">  41                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  42  /**                                                                                                               </span>
<span class="6972081778092176351" onmouseenter="enter('6972081778092176351');" onmouseout="out('6972081778092176351');" style="">  43   * Created by AriaL on 2017/7/1.                                                                                  </span>
<span class="-3350964092441836737" onmouseenter="enter('-3350964092441836737');" onmouseout="out('-3350964092441836737');" style="">  44   * 任务处理器                                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  45   */                                                                                                               </span>
<span class="-4202835391474719331" onmouseenter="enter('-4202835391474719331');" onmouseout="out('-4202835391474719331');" style="">  46  public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_ENTITY extends AbsTaskEntity&lt;ENTITY&gt;&gt;        </span>
<span class="-1728503718485911871" onmouseenter="enter('-1728503718485911871');" onmouseout="out('-1728503718485911871');" style="">  47      implements Runnable, IUtil {                                                                                  </span>
<span class="8962793429617957612" onmouseenter="enter('8962793429617957612');" onmouseout="out('8962793429617957612');" style="">  48    private static final String STATE = &quot;_state_&quot;;                                                                  </span>
<span class="4155209368239822413" onmouseenter="enter('4155209368239822413');" onmouseout="out('4155209368239822413');" style="">  49    private static final String RECORD = &quot;_record_&quot;;                                                                </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50    /**                                                                                                             </span>
<span class="-1980722710912279499" onmouseenter="enter('-1980722710912279499');" onmouseout="out('-1980722710912279499');" style="">  51     * 小于1m的文件不启用多线程                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52     */                                                                                                             </span>
<span class="-5660290514964746700" onmouseenter="enter('-5660290514964746700');" onmouseout="out('-5660290514964746700');" style="">  53    protected static final long SUB_LEN = 1024 * 1024;                                                              </span>
<span  style="">  54                                                                                                                    </span>
<span class="7185037452507187216" onmouseenter="enter('7185037452507187216');" onmouseout="out('7185037452507187216');" style="">  55    private final String TAG = &quot;AbsFileer&quot;;                                                                         </span>
<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="">  56    protected IEventListener mListener;                                                                             </span>
<span class="-1948152884108661875" onmouseenter="enter('-1948152884108661875');" onmouseout="out('-1948152884108661875');" style="">  57    protected TASK_ENTITY mTaskEntity;                                                                              </span>
<span class="8904454574412257163" onmouseenter="enter('8904454574412257163');" onmouseout="out('8904454574412257163');" style="">  58    protected ENTITY mEntity;                                                                                       </span>
<span class="-8914417138860252644" onmouseenter="enter('-8914417138860252644');" onmouseout="out('-8914417138860252644');" style="">  59    protected Context mContext;                                                                                     </span>
<span class="3740841846621187936" onmouseenter="enter('3740841846621187936');" onmouseout="out('3740841846621187936');" style="">  60    protected File mTempFile; //文件                                                                                  </span>
<span class="-5211593385781091233" onmouseenter="enter('-5211593385781091233');" onmouseout="out('-5211593385781091233');" style="">  61    protected StateConstance mConstance;                                                                            </span>
<span class="1058453114158093994" onmouseenter="enter('1058453114158093994');" onmouseout="out('1058453114158093994');" style="">  62    private ExecutorService mFixedThreadPool;                                                                       </span>
<span class="-7729852228955968495" onmouseenter="enter('-7729852228955968495');" onmouseout="out('-7729852228955968495');" style="">  63    //总线程数                                                                                                          </span>
<span class="8506024364762319503" onmouseenter="enter('8506024364762319503');" onmouseout="out('8506024364762319503');" style="">  64    protected int mTotalThreadNum;                                                                                  </span>
<span class="1064880922655578719" onmouseenter="enter('1064880922655578719');" onmouseout="out('1064880922655578719');" style="">  65    //启动线程数                                                                                                         </span>
<span class="5843971981435686054" onmouseenter="enter('5843971981435686054');" onmouseout="out('5843971981435686054');" style="">  66    private int mStartThreadNum;                                                                                    </span>
<span class="6869677327514827795" onmouseenter="enter('6869677327514827795');" onmouseout="out('6869677327514827795');" style="">  67    //已完成的线程数                                                                                                       </span>
<span class="8146256445432145550" onmouseenter="enter('8146256445432145550');" onmouseout="out('8146256445432145550');" style="">  68    private int mCompleteThreadNum;                                                                                 </span>
<span class="-3545799492252297873" onmouseenter="enter('-3545799492252297873');" onmouseout="out('-3545799492252297873');" style="">  69    private Map&lt;Integer, AbsThreadTask&gt; mTask = new HashMap&lt;&gt;();                                                    </span>
<span  style="">  70                                                                                                                    </span>
<span class="2545797703164998155" onmouseenter="enter('2545797703164998155');" onmouseout="out('2545797703164998155');" style="">  71    private Timer mTimer;                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  72 -  @Deprecated                                                                                                     </span>
<span class="-2075436351753291325" onmouseenter="enter('-2075436351753291325');" onmouseout="out('-2075436351753291325');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  73 -  private File mConfigFile;                                                                                       </span>
<span class="-6913167534336436900" onmouseenter="enter('-6913167534336436900');" onmouseout="out('-6913167534336436900');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +  @Deprecated private File mConfigFile;                                                                           </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  75    /**                                                                                                             </span>
<span class="7539908978715582123" onmouseenter="enter('7539908978715582123');" onmouseout="out('7539908978715582123');" style="">  76     * 进度刷新间隔                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  77     */                                                                                                             </span>
<span class="3897731617107507824" onmouseenter="enter('3897731617107507824');" onmouseout="out('3897731617107507824');" style="">  78    private long mUpdateInterval = 1000;                                                                            </span>
<span class="-5884447509953456722" onmouseenter="enter('-5884447509953456722');" onmouseout="out('-5884447509953456722');" style="">  79    private TaskRecord mRecord;                                                                                     </span>
<span  style="">  80                                                                                                                    </span>
<span class="2891934549353689856" onmouseenter="enter('2891934549353689856');" onmouseout="out('2891934549353689856');" style="">  81    protected AbsFileer(IEventListener listener, TASK_ENTITY taskEntity) {                                          </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  82      mListener = listener;                                                                                         </span>
<span class="8662994215762856538" onmouseenter="enter('8662994215762856538');" onmouseout="out('8662994215762856538');" style="">  83      mTaskEntity = taskEntity;                                                                                     </span>
<span class="-4840298181735982119" onmouseenter="enter('-4840298181735982119');" onmouseout="out('-4840298181735982119');" style="">  84      mEntity = mTaskEntity.getEntity();                                                                            </span>
<span class="1002707508041764251" onmouseenter="enter('1002707508041764251');" onmouseout="out('1002707508041764251');" style="">  85      mContext = AriaManager.APP;                                                                                   </span>
<span class="-3948532274682189145" onmouseenter="enter('-3948532274682189145');" onmouseout="out('-3948532274682189145');" style="">  86      mConstance = new StateConstance();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87    }                                                                                                               </span>
<span  style="">  88                                                                                                                    </span>
<span class="-8210434580109369245" onmouseenter="enter('-8210434580109369245');" onmouseout="out('-8210434580109369245');" style="">  89    public void setNewTask(boolean newTask) {                                                                       </span>
<span class="7261549057242337382" onmouseenter="enter('7261549057242337382');" onmouseout="out('7261549057242337382');" style="">  90      mTaskEntity.setNewTask(newTask);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91    }                                                                                                               </span>
<span  style="">  92                                                                                                                    </span>
<span class="2509123758179905267" onmouseenter="enter('2509123758179905267');" onmouseout="out('2509123758179905267');" style="">  93    @Override public void setMaxSpeed(double maxSpeed) {                                                            </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style="">  94      for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                                   </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style="">  95        AbsThreadTask task = mTask.get(i);                                                                          </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="">  96        if (task != null) {                                                                                         </span>
<span class="8974054037700404915" onmouseenter="enter('8974054037700404915');" onmouseout="out('8974054037700404915');" style="">  97          task.setMaxSpeed(maxSpeed);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100    }                                                                                                               </span>
<span  style=""> 101                                                                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 102    @Override public void run() {                                                                                   </span>
<span class="2383691993380925204" onmouseenter="enter('2383691993380925204');" onmouseout="out('2383691993380925204');" style=""> 103      if (mConstance.isRunning) {                                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 104        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105      }                                                                                                             </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 106      startFlow();                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107    }                                                                                                               </span>
<span  style=""> 108                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 109    /**                                                                                                             </span>
<span class="-8036989040377605484" onmouseenter="enter('-8036989040377605484');" onmouseout="out('-8036989040377605484');" style=""> 110     * 开始流程                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 111     */                                                                                                             </span>
<span class="2659446283962947526" onmouseenter="enter('2659446283962947526');" onmouseout="out('2659446283962947526');" style=""> 112    private void startFlow() {                                                                                      </span>
<span class="619404821214964502" onmouseenter="enter('619404821214964502');" onmouseout="out('619404821214964502');" style=""> 113      mConstance.resetState();                                                                                      </span>
<span class="1290437685045115531" onmouseenter="enter('1290437685045115531');" onmouseout="out('1290437685045115531');" style=""> 114      checkTask();                                                                                                  </span>
<span class="6200019808906550914" onmouseenter="enter('6200019808906550914');" onmouseout="out('6200019808906550914');" style=""> 115      mConstance.TASK_RECORD = mRecord;                                                                             </span>
<span class="4780862748684536259" onmouseenter="enter('4780862748684536259');" onmouseout="out('4780862748684536259');" style=""> 116      if (mListener instanceof IDownloadListener) {                                                                 </span>
<span class="937780446443407951" onmouseenter="enter('937780446443407951');" onmouseout="out('937780446443407951');" style=""> 117        ((IDownloadListener) mListener).onPostPre(mEntity.getFileSize());                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118      }                                                                                                             </span>
<span class="8755928574405213439" onmouseenter="enter('8755928574405213439');" onmouseout="out('8755928574405213439');" style=""> 119      if (!mTaskEntity.isSupportBP()) {                                                                             </span>
<span class="-7445970306128807043" onmouseenter="enter('-7445970306128807043');" onmouseout="out('-7445970306128807043');" style=""> 120        mTotalThreadNum = 1;                                                                                        </span>
<span class="-1191691332114182414" onmouseenter="enter('-1191691332114182414');" onmouseout="out('-1191691332114182414');" style=""> 121        mStartThreadNum = 1;                                                                                        </span>
<span class="-6182854007095635032" onmouseenter="enter('-6182854007095635032');" onmouseout="out('-6182854007095635032');" style=""> 122        handleNoSupportBP();                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 123      } else {                                                                                                      </span>
<span class="-2662097366456595872" onmouseenter="enter('-2662097366456595872');" onmouseout="out('-2662097366456595872');" style=""> 124        mTotalThreadNum =                                                                                           </span>
<span class="2293773823409558899" onmouseenter="enter('2293773823409558899');" onmouseout="out('2293773823409558899');" style=""> 125            mTaskEntity.isNewTask() ? (mStartThreadNum = setNewTaskThreadNum()) : mTotalThreadNum;                  </span>
<span class="304482857231090385" onmouseenter="enter('304482857231090385');" onmouseout="out('304482857231090385');" style=""> 126        handleBreakpoint();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127      }                                                                                                             </span>
<span class="-5070363508518577757" onmouseenter="enter('-5070363508518577757');" onmouseout="out('-5070363508518577757');" style=""> 128      mConstance.START_THREAD_NUM = mTotalThreadNum;                                                                </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 129      /*                                                                                                            </span>
<span class="-7459715513064469337" onmouseenter="enter('-7459715513064469337');" onmouseout="out('-7459715513064469337');" style=""> 130       * mTaskEntity.getEntity().getFileSize() != mTempFile.length()为兼容以前老版本代码                                      </span>
<span class="-5520474084619660394" onmouseenter="enter('-5520474084619660394');" onmouseout="out('-5520474084619660394');" style=""> 131       * 动态长度条件：                                                                                                    </span>
<span class="6678836087239710153" onmouseenter="enter('6678836087239710153');" onmouseout="out('6678836087239710153');" style=""> 132       * 1、总线程数为1，并且是新任务                                                                                            </span>
<span class="-8594380126502433751" onmouseenter="enter('-8594380126502433751');" onmouseout="out('-8594380126502433751');" style=""> 133       * 2、总线程数为1，不是新任务，但是长度不是文件全长度                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 134       */                                                                                                           </span>
<span class="-763935913933084661" onmouseenter="enter('-763935913933084661');" onmouseout="out('-763935913933084661');" style=""> 135      if (mTotalThreadNum == 1 &amp;&amp; (mTaskEntity.isNewTask()                                                          </span>
<span class="-3606193574981639369" onmouseenter="enter('-3606193574981639369');" onmouseout="out('-3606193574981639369');" style=""> 136          || mTaskEntity.getEntity().getFileSize() != mTempFile.length())) {                                        </span>
<span class="9204016926254181097" onmouseenter="enter('9204016926254181097');" onmouseout="out('9204016926254181097');" style=""> 137        mConstance.isOpenDynamicFile = true;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138      }                                                                                                             </span>
<span class="-7724548171203838725" onmouseenter="enter('-7724548171203838725');" onmouseout="out('-7724548171203838725');" style=""> 139      startTimer();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140    }                                                                                                               </span>
<span  style=""> 141                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 142    /**                                                                                                             </span>
<span class="-5386582613838574396" onmouseenter="enter('-5386582613838574396');" onmouseout="out('-5386582613838574396');" style=""> 143     * 设置新任务的最大线程数                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 144     */                                                                                                             </span>
<span class="-6137859098551091137" onmouseenter="enter('-6137859098551091137');" onmouseout="out('-6137859098551091137');" style=""> 145    protected abstract int setNewTaskThreadNum();                                                                   </span>
<span  style=""> 146                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 147    /**                                                                                                             </span>
<span class="4041581137177203435" onmouseenter="enter('4041581137177203435');" onmouseout="out('4041581137177203435');" style=""> 148     * 启动进度获取定时器                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 149     */                                                                                                             </span>
<span class="-8560002621884285761" onmouseenter="enter('-8560002621884285761');" onmouseout="out('-8560002621884285761');" style=""> 150    private void startTimer() {                                                                                     </span>
<span class="9064905857115753880" onmouseenter="enter('9064905857115753880');" onmouseout="out('9064905857115753880');" style=""> 151      mTimer = new Timer(true);                                                                                     </span>
<span class="1767883212426599488" onmouseenter="enter('1767883212426599488');" onmouseout="out('1767883212426599488');" style=""> 152      mTimer.schedule(new TimerTask() {                                                                             </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 153        @Override public void run() {                                                                               </span>
<span class="5257678828672457716" onmouseenter="enter('5257678828672457716');" onmouseout="out('5257678828672457716');" style=""> 154          if (mConstance.isComplete()                                                                               </span>
<span class="334343515162691172" onmouseenter="enter('334343515162691172');" onmouseout="out('334343515162691172');" style=""> 155              || mConstance.isStop()                                                                                </span>
<span class="3923616872544648792" onmouseenter="enter('3923616872544648792');" onmouseout="out('3923616872544648792');" style=""> 156              || mConstance.isCancel()                                                                              </span>
<span class="-6728476664925849707" onmouseenter="enter('-6728476664925849707');" onmouseout="out('-6728476664925849707');" style=""> 157              || !mConstance.isRunning) {                                                                           </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 158            closeTimer();                                                                                           </span>
<span class="5358021077686010059" onmouseenter="enter('5358021077686010059');" onmouseout="out('5358021077686010059');" style=""> 159          } else if (mConstance.CURRENT_LOCATION &gt;= 0) {                                                            </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style=""> 160            mListener.onProgress(mConstance.CURRENT_LOCATION);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162        }                                                                                                           </span>
<span class="-3821686044197757132" onmouseenter="enter('-3821686044197757132');" onmouseout="out('-3821686044197757132');" style=""> 163      }, 0, mUpdateInterval);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164    }                                                                                                               </span>
<span  style=""> 165                                                                                                                    </span>
<span class="6987763365729675608" onmouseenter="enter('6987763365729675608');" onmouseout="out('6987763365729675608');" style=""> 166    protected void closeTimer() {                                                                                   </span>
<span class="-4343220603110256261" onmouseenter="enter('-4343220603110256261');" onmouseout="out('-4343220603110256261');" style=""> 167      if (mTimer != null) {                                                                                         </span>
<span class="6506490333649261220" onmouseenter="enter('6506490333649261220');" onmouseout="out('6506490333649261220');" style=""> 168        mTimer.purge();                                                                                             </span>
<span class="3936422701741233911" onmouseenter="enter('3936422701741233911');" onmouseout="out('3936422701741233911');" style=""> 169        mTimer.cancel();                                                                                            </span>
<span class="-3760473013259053076" onmouseenter="enter('-3760473013259053076');" onmouseout="out('-3760473013259053076');" style=""> 170        mTimer = null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172    }                                                                                                               </span>
<span  style=""> 173                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 174    /**                                                                                                             </span>
<span class="3310122691908792895" onmouseenter="enter('3310122691908792895');" onmouseout="out('3310122691908792895');" style=""> 175     * 设置定时器更新间隔                                                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 176     *                                                                                                              </span>
<span class="5926421498368036592" onmouseenter="enter('5926421498368036592');" onmouseout="out('5926421498368036592');" style=""> 177     * @param interval 单位毫秒，不能小于0                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 178     */                                                                                                             </span>
<span class="-6143371944494222779" onmouseenter="enter('-6143371944494222779');" onmouseout="out('-6143371944494222779');" style=""> 179    protected void setUpdateInterval(long interval) {                                                               </span>
<span class="-1051498944097002766" onmouseenter="enter('-1051498944097002766');" onmouseout="out('-1051498944097002766');" style=""> 180      if (interval &lt; 0) {                                                                                           </span>
<span class="3000915396455271078" onmouseenter="enter('3000915396455271078');" onmouseout="out('3000915396455271078');" style=""> 181        ALog.w(TAG, &quot;更新间隔不能小于0，默认为1000毫秒&quot;);                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 182        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183      }                                                                                                             </span>
<span class="-3431322530378656562" onmouseenter="enter('-3431322530378656562');" onmouseout="out('-3431322530378656562');" style=""> 184      mUpdateInterval = interval;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185    }                                                                                                               </span>
<span  style=""> 186                                                                                                                    </span>
<span class="-4506592131726080634" onmouseenter="enter('-4506592131726080634');" onmouseout="out('-4506592131726080634');" style=""> 187    @Override public long getFileSize() {                                                                           </span>
<span class="-7902485770489300682" onmouseenter="enter('-7902485770489300682');" onmouseout="out('-7902485770489300682');" style=""> 188      return mEntity.getFileSize();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189    }                                                                                                               </span>
<span  style=""> 190                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 191    /**                                                                                                             </span>
<span class="-7288086523564906780" onmouseenter="enter('-7288086523564906780');" onmouseout="out('-7288086523564906780');" style=""> 192     * 获取当前任务位置                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 193     */                                                                                                             </span>
<span class="42588745782017963" onmouseenter="enter('42588745782017963');" onmouseout="out('42588745782017963');" style=""> 194    @Override public long getCurrentLocation() {                                                                    </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style=""> 195      return mConstance.CURRENT_LOCATION;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196    }                                                                                                               </span>
<span  style=""> 197                                                                                                                    </span>
<span class="-2237798856776801835" onmouseenter="enter('-2237798856776801835');" onmouseout="out('-2237798856776801835');" style=""> 198    @Override public boolean isRunning() {                                                                          </span>
<span class="-9220268812159037756" onmouseenter="enter('-9220268812159037756');" onmouseout="out('-9220268812159037756');" style=""> 199      return mConstance.isRunning;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200    }                                                                                                               </span>
<span  style=""> 201                                                                                                                    </span>
<span class="305234216015554819" onmouseenter="enter('305234216015554819');" onmouseout="out('305234216015554819');" style=""> 202    @Override public void cancel() {                                                                                </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 203      closeTimer();                                                                                                 </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 204      mConstance.isRunning = false;                                                                                 </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style=""> 205      mConstance.isCancel = true;                                                                                   </span>
<span class="-1828001720390047641" onmouseenter="enter('-1828001720390047641');" onmouseout="out('-1828001720390047641');" style=""> 206      if (mFixedThreadPool != null) {                                                                               </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style=""> 207        mFixedThreadPool.shutdown();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208      }                                                                                                             </span>
<span class="-612803506725482722" onmouseenter="enter('-612803506725482722');" onmouseout="out('-612803506725482722');" style=""> 209      for (int i = 0; i &lt; mStartThreadNum; i++) {                                                                   </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 210        AbsThreadTask task = mTask.get(i);                                                                          </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 211        if (task != null) {                                                                                         </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style=""> 212          task.cancel();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215    }                                                                                                               </span>
<span  style=""> 216                                                                                                                    </span>
<span class="6276273225669041403" onmouseenter="enter('6276273225669041403');" onmouseout="out('6276273225669041403');" style=""> 217    @Override public void stop() {                                                                                  </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 218      closeTimer();                                                                                                 </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 219      mConstance.isRunning = false;                                                                                 </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style=""> 220      mConstance.isStop = true;                                                                                     </span>
<span class="8402005296375476854" onmouseenter="enter('8402005296375476854');" onmouseout="out('8402005296375476854');" style=""> 221      if (mConstance.isComplete()) return;                                                                          </span>
<span class="-1828001720390047641" onmouseenter="enter('-1828001720390047641');" onmouseout="out('-1828001720390047641');" style=""> 222      if (mFixedThreadPool != null) {                                                                               </span>
<span class="-1289116596051961467" onmouseenter="enter('-1289116596051961467');" onmouseout="out('-1289116596051961467');" style=""> 223        mFixedThreadPool.shutdown();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224      }                                                                                                             </span>
<span class="-612803506725482722" onmouseenter="enter('-612803506725482722');" onmouseout="out('-612803506725482722');" style=""> 225      for (int i = 0; i &lt; mStartThreadNum; i++) {                                                                   </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 226        AbsThreadTask task = mTask.get(i);                                                                          </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 227        if (task != null) {                                                                                         </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style=""> 228          task.stop();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231    }                                                                                                               </span>
<span  style=""> 232                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 233    /**                                                                                                             </span>
<span class="-7218687507933415946" onmouseenter="enter('-7218687507933415946');" onmouseout="out('-7218687507933415946');" style=""> 234     * 直接调用的时候会自动启动线程执行                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 235     */                                                                                                             </span>
<span class="2908281040877937362" onmouseenter="enter('2908281040877937362');" onmouseout="out('2908281040877937362');" style=""> 236    @Override public void start() {                                                                                 </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style=""> 237      new Thread(this).start();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238    }                                                                                                               </span>
<span  style=""> 239                                                                                                                    </span>
<span class="-1531467598256645714" onmouseenter="enter('-1531467598256645714');" onmouseout="out('-1531467598256645714');" style=""> 240    @Override public void resume() {                                                                                </span>
<span class="-6183578153083367222" onmouseenter="enter('-6183578153083367222');" onmouseout="out('-6183578153083367222');" style=""> 241      start();                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242    }                                                                                                               </span>
<span  style=""> 243                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 244    /**                                                                                                             </span>
<span class="-5594313128981442446" onmouseenter="enter('-5594313128981442446');" onmouseout="out('-5594313128981442446');" style=""> 245     * 检查任务、检查线程数                                                                                                   </span>
<span class="5765812458735380113" onmouseenter="enter('5765812458735380113');" onmouseout="out('5765812458735380113');" style=""> 246     * 新任务条件：                                                                                                       </span>
<span class="-3418470207445181215" onmouseenter="enter('-3418470207445181215');" onmouseout="out('-3418470207445181215');" style=""> 247     * 1、文件不存在                                                                                                      </span>
<span class="1471172295356331660" onmouseenter="enter('1471172295356331660');" onmouseout="out('1471172295356331660');" style=""> 248     * 2、任务记录文件缺失或不匹配                                                                                               </span>
<span class="4400956412852543180" onmouseenter="enter('4400956412852543180');" onmouseout="out('4400956412852543180');" style=""> 249     * 3、数据库记录不存在                                                                                                   </span>
<span class="1878350678984943375" onmouseenter="enter('1878350678984943375');" onmouseout="out('1878350678984943375');" style=""> 250     * 4、不支持断点，则是新任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 251     */                                                                                                             </span>
<span class="-8432905628195545001" onmouseenter="enter('-8432905628195545001');" onmouseout="out('-8432905628195545001');" style=""> 252    private void checkTask() {                                                                                      </span>
<span class="-5297450492380711808" onmouseenter="enter('-5297450492380711808');" onmouseout="out('-5297450492380711808');" style=""> 253      mConfigFile = new File(CommonUtil.getFileConfigPath(false, mEntity.getFileName()));                           </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style=""> 254      if (mConfigFile.exists()) {                                                                                   </span>
<span class="7932310618145443523" onmouseenter="enter('7932310618145443523');" onmouseout="out('7932310618145443523');" style=""> 255        convertDb();                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 256      } else {                                                                                                      </span>
<span class="-5238664810335263343" onmouseenter="enter('-5238664810335263343');" onmouseout="out('-5238664810335263343');" style=""> 257        mRecord = DbHelper.getTaskRecord(mTaskEntity.getKey());                                                     </span>
<span class="-3299415613061807412" onmouseenter="enter('-3299415613061807412');" onmouseout="out('-3299415613061807412');" style=""> 258        if (mRecord == null) {                                                                                      </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 259          initRecord();                                                                                             </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 260          mTaskEntity.setNewTask(true);                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 261        } else {                                                                                                    </span>
<span class="-7168613097949101282" onmouseenter="enter('-7168613097949101282');" onmouseout="out('-7168613097949101282');" style=""> 262          if (mRecord.threadRecords == null || mRecord.threadRecords.isEmpty()) {                                   </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 263            initRecord();                                                                                           </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 264            mTaskEntity.setNewTask(true);                                                                           </span>
<span class="-4489756692986098869" onmouseenter="enter('-4489756692986098869');" onmouseout="out('-4489756692986098869');" style=""> 265          } else if (mTempFile.length() == 0) {                                                                     </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style=""> 266            mRecord.deleteData();                                                                                   </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 267            initRecord();                                                                                           </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 268            mTaskEntity.setNewTask(true);                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 269          } else {                                                                                                  </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style=""> 270            for (ThreadRecord tr : mRecord.threadRecords) {                                                         </span>
<span class="-6249885869558348483" onmouseenter="enter('-6249885869558348483');" onmouseout="out('-6249885869558348483');" style=""> 271              if (tr.isComplete) {                                                                                  </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style=""> 272                mCompleteThreadNum++;                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 273              } else {                                                                                              </span>
<span class="-4361198270326326802" onmouseenter="enter('-4361198270326326802');" onmouseout="out('-4361198270326326802');" style=""> 274                mStartThreadNum++;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276            }                                                                                                       </span>
<span class="-4812553014330515673" onmouseenter="enter('-4812553014330515673');" onmouseout="out('-4812553014330515673');" style=""> 277            mTotalThreadNum = mRecord.threadRecords.size();                                                         </span>
<span class="-561823525574412259" onmouseenter="enter('-561823525574412259');" onmouseout="out('-561823525574412259');" style=""> 278            mTaskEntity.setNewTask(false);                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282    }                                                                                                               </span>
<span  style=""> 283                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 284    /**                                                                                                             </span>
<span class="1070716404183585489" onmouseenter="enter('1070716404183585489');" onmouseout="out('1070716404183585489');" style=""> 285     * convertDb 为兼容性代码                                                                                             </span>
<span class="3982968248834793214" onmouseenter="enter('3982968248834793214');" onmouseout="out('3982968248834793214');" style=""> 286     * 从3.4.1开始，线程配置信息将存储在数据库中。                                                                                     </span>
<span class="-6928102974415786303" onmouseenter="enter('-6928102974415786303');" onmouseout="out('-6928102974415786303');" style=""> 287     * 将配置文件的内容复制到数据库中，并将配置文件删除                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 288     */                                                                                                             </span>
<span class="14298455509427519" onmouseenter="enter('14298455509427519');" onmouseout="out('14298455509427519');" style=""> 289    private void convertDb() {                                                                                      </span>
<span class="-4598298306615401010" onmouseenter="enter('-4598298306615401010');" onmouseout="out('-4598298306615401010');" style=""> 290      List&lt;RecordWrapper&gt; records =                                                                                 </span>
<span class="-4738968014729726274" onmouseenter="enter('-4738968014729726274');" onmouseout="out('-4738968014729726274');" style=""> 291          DbEntity.findRelationData(RecordWrapper.class, &quot;TaskRecord.filePath=?&quot;,                                   </span>
<span class="96831814087260276" onmouseenter="enter('96831814087260276');" onmouseout="out('96831814087260276');" style=""> 292              mTaskEntity.getKey());                                                                                </span>
<span class="-376648440877788579" onmouseenter="enter('-376648440877788579');" onmouseout="out('-376648440877788579');" style=""> 293      if (records == null || records.size() == 0) {                                                                 </span>
<span class="7274393295178915569" onmouseenter="enter('7274393295178915569');" onmouseout="out('7274393295178915569');" style=""> 294        Properties pro = CommonUtil.loadConfig(mConfigFile);                                                        </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style=""> 295        if (pro.isEmpty()) {                                                                                        </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 296          mTaskEntity.setNewTask(true);                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 297          return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298        }                                                                                                           </span>
<span class="2524822158611589997" onmouseenter="enter('2524822158611589997');" onmouseout="out('2524822158611589997');" style=""> 299        initRecord();                                                                                               </span>
<span class="-4092719147494026286" onmouseenter="enter('-4092719147494026286');" onmouseout="out('-4092719147494026286');" style=""> 300        Set&lt;Object&gt; keys = pro.keySet();                                                                            </span>
<span class="7117164647387083506" onmouseenter="enter('7117164647387083506');" onmouseout="out('7117164647387083506');" style=""> 301        // 老版本记录是5s存一次，但是5s中内，如果线程执行完成，record记录是没有的，只有state记录...                                                    </span>
<span class="8442347856216504710" onmouseenter="enter('8442347856216504710');" onmouseout="out('8442347856216504710');" style=""> 302        // 第一步应该是record 和 state去重取正确的线程数                                                                            </span>
<span class="3880560860847601414" onmouseenter="enter('3880560860847601414');" onmouseout="out('3880560860847601414');" style=""> 303        Set&lt;Integer&gt; set = new HashSet&lt;&gt;();                                                                         </span>
<span class="-5644624400733519290" onmouseenter="enter('-5644624400733519290');" onmouseout="out('-5644624400733519290');" style=""> 304        for (Object key : keys) {                                                                                   </span>
<span class="-90111359741489740" onmouseenter="enter('-90111359741489740');" onmouseout="out('-90111359741489740');" style=""> 305          String str = String.valueOf(key);                                                                         </span>
<span class="5431713397557299419" onmouseenter="enter('5431713397557299419');" onmouseout="out('5431713397557299419');" style=""> 306          int i = Integer.parseInt(str.substring(str.length() - 1, str.length()));                                  </span>
<span class="5139166377005733880" onmouseenter="enter('5139166377005733880');" onmouseout="out('5139166377005733880');" style=""> 307          set.add(i);                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308        }                                                                                                           </span>
<span class="1773727540275693887" onmouseenter="enter('1773727540275693887');" onmouseout="out('1773727540275693887');" style=""> 309        int threadNum = set.size();                                                                                 </span>
<span class="1658307869252768908" onmouseenter="enter('1658307869252768908');" onmouseout="out('1658307869252768908');" style=""> 310        if (threadNum == 0) {                                                                                       </span>
<span class="8843815117610319554" onmouseenter="enter('8843815117610319554');" onmouseout="out('8843815117610319554');" style=""> 311          mTaskEntity.setNewTask(true);                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 312          return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313        }                                                                                                           </span>
<span class="8980547023143351106" onmouseenter="enter('8980547023143351106');" onmouseout="out('8980547023143351106');" style=""> 314        mRecord.threadNum = threadNum;                                                                              </span>
<span class="1082026445239340300" onmouseenter="enter('1082026445239340300');" onmouseout="out('1082026445239340300');" style=""> 315        mTotalThreadNum = threadNum;                                                                                </span>
<span  style=""> 316                                                                                                                    </span>
<span class="92058997093189211" onmouseenter="enter('92058997093189211');" onmouseout="out('92058997093189211');" style=""> 317        for (int i = 0; i &lt; threadNum; i++) {                                                                       </span>
<span class="1846142719149590893" onmouseenter="enter('1846142719149590893');" onmouseout="out('1846142719149590893');" style=""> 318          ThreadRecord tRecord = new ThreadRecord();                                                                </span>
<span class="-543854586085341709" onmouseenter="enter('-543854586085341709');" onmouseout="out('-543854586085341709');" style=""> 319          tRecord.key = mRecord.filePath;                                                                           </span>
<span class="-1285896534897014429" onmouseenter="enter('-1285896534897014429');" onmouseout="out('-1285896534897014429');" style=""> 320          Object state = pro.getProperty(mTempFile.getName() + STATE + i);                                          </span>
<span class="7744986855104654034" onmouseenter="enter('7744986855104654034');" onmouseout="out('7744986855104654034');" style=""> 321          Object record = pro.getProperty(mTempFile.getName() + RECORD + i);                                        </span>
<span class="-1417732743646819816" onmouseenter="enter('-1417732743646819816');" onmouseout="out('-1417732743646819816');" style=""> 322          if (state != null &amp;&amp; Integer.parseInt(String.valueOf(state)) == 1) {                                      </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style=""> 323            mCompleteThreadNum++;                                                                                   </span>
<span class="-5900743039323389312" onmouseenter="enter('-5900743039323389312');" onmouseout="out('-5900743039323389312');" style=""> 324            tRecord.isComplete = true;                                                                              </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 325            continue;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326          }                                                                                                         </span>
<span class="-4361198270326326802" onmouseenter="enter('-4361198270326326802');" onmouseout="out('-4361198270326326802');" style=""> 327          mStartThreadNum++;                                                                                        </span>
<span class="2652986304939921073" onmouseenter="enter('2652986304939921073');" onmouseout="out('2652986304939921073');" style=""> 328          if (record != null) {                                                                                     </span>
<span class="-5505735994889378269" onmouseenter="enter('-5505735994889378269');" onmouseout="out('-5505735994889378269');" style=""> 329            Long temp = Long.parseLong(String.valueOf(record));                                                     </span>
<span class="6949017848225026676" onmouseenter="enter('6949017848225026676');" onmouseout="out('6949017848225026676');" style=""> 330            tRecord.startLocation = temp &gt; 0 ? temp : 0;                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 331          } else {                                                                                                  </span>
<span class="-2463924567028920967" onmouseenter="enter('-2463924567028920967');" onmouseout="out('-2463924567028920967');" style=""> 332            tRecord.startLocation = 0;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333          }                                                                                                         </span>
<span class="8450336720909475026" onmouseenter="enter('8450336720909475026');" onmouseout="out('8450336720909475026');" style=""> 334          mRecord.threadRecords.add(tRecord);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335        }                                                                                                           </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style=""> 336        mConfigFile.delete();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338    }                                                                                                               </span>
<span  style=""> 339                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 340    /**                                                                                                             </span>
<span class="-671827589422898020" onmouseenter="enter('-671827589422898020');" onmouseout="out('-671827589422898020');" style=""> 341     * 初始化记录                                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 342     */                                                                                                             </span>
<span class="7657423209226081953" onmouseenter="enter('7657423209226081953');" onmouseout="out('7657423209226081953');" style=""> 343    private void initRecord() {                                                                                     </span>
<span class="1363226846886967285" onmouseenter="enter('1363226846886967285');" onmouseout="out('1363226846886967285');" style=""> 344      mRecord = new TaskRecord();                                                                                   </span>
<span class="-5083582960729315317" onmouseenter="enter('-5083582960729315317');" onmouseout="out('-5083582960729315317');" style=""> 345      mRecord.fileName = mEntity.getFileName();                                                                     </span>
<span class="3577925922319021061" onmouseenter="enter('3577925922319021061');" onmouseout="out('3577925922319021061');" style=""> 346      mRecord.filePath = mTaskEntity.getKey();                                                                      </span>
<span class="-4117247167556656758" onmouseenter="enter('-4117247167556656758');" onmouseout="out('-4117247167556656758');" style=""> 347      mRecord.threadRecords = new ArrayList&lt;&gt;();                                                                    </span>
<span class="8089432194042683150" onmouseenter="enter('8089432194042683150');" onmouseout="out('8089432194042683150');" style=""> 348      mRecord.isGroupRecord = mTaskEntity.getEntity().isGroupChild();                                               </span>
<span class="8800687954183002826" onmouseenter="enter('8800687954183002826');" onmouseout="out('8800687954183002826');" style=""> 349      if (mRecord.isGroupRecord) {                                                                                  </span>
<span class="-817579183662015631" onmouseenter="enter('-817579183662015631');" onmouseout="out('-817579183662015631');" style=""> 350        if (mTaskEntity.getEntity() instanceof DownloadEntity) {                                                    </span>
<span class="-7647901316480546218" onmouseenter="enter('-7647901316480546218');" onmouseout="out('-7647901316480546218');" style=""> 351          mRecord.dGroupName = ((DownloadEntity) mTaskEntity.getEntity()).getGroupName();                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354    }                                                                                                               </span>
<span  style=""> 355                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 356    /**                                                                                                             </span>
<span class="-8991940256279851469" onmouseenter="enter('-8991940256279851469');" onmouseout="out('-8991940256279851469');" style=""> 357     * 保存任务记录                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 358     */                                                                                                             </span>
<span class="1188287987342183098" onmouseenter="enter('1188287987342183098');" onmouseout="out('1188287987342183098');" style=""> 359    private void saveRecord() {                                                                                     </span>
<span class="-6872584921755914518" onmouseenter="enter('-6872584921755914518');" onmouseout="out('-6872584921755914518');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 360 +    mRecord.threadNum = mRecord.threadRecords.size();                                                             </span>
<span class="-3343791891312496302" onmouseenter="enter('-3343791891312496302');" onmouseout="out('-3343791891312496302');" style=""> 361      mRecord.save();                                                                                               </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style=""> 362      for (ThreadRecord tr : mRecord.threadRecords) {                                                               </span>
<span class="1550150863078778036" onmouseenter="enter('1550150863078778036');" onmouseout="out('1550150863078778036');" style=""> 363        tr.save();                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 365    }                                                                                                               </span>
<span  style=""> 366                                                                                                                    </span>
<span class="1066955891247002122" onmouseenter="enter('1066955891247002122');" onmouseout="out('1066955891247002122');" style=""> 367    public TaskRecord getRecord() {                                                                                 </span>
<span class="-7223580788630505532" onmouseenter="enter('-7223580788630505532');" onmouseout="out('-7223580788630505532');" style=""> 368      return mRecord;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369    }                                                                                                               </span>
<span  style=""> 370                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 371    /**                                                                                                             </span>
<span class="7661061719912178382" onmouseenter="enter('7661061719912178382');" onmouseout="out('7661061719912178382');" style=""> 372     * 恢复记录地址                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 373     *                                                                                                              </span>
<span class="-1706428464808283045" onmouseenter="enter('-1706428464808283045');" onmouseout="out('-1706428464808283045');" style=""> 374     * @return {@code true}任务已完成                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 375     */                                                                                                             </span>
<span class="423019558917313706" onmouseenter="enter('423019558917313706');" onmouseout="out('423019558917313706');" style=""> 376    private boolean resumeRecordLocation(int i, long startL, long endL) {                                           </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style=""> 377      mConstance.CURRENT_LOCATION += endL - startL;                                                                 </span>
<span class="-3554759638611896536" onmouseenter="enter('-3554759638611896536');" onmouseout="out('-3554759638611896536');" style=""> 378      ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__已完成&quot;, mTaskEntity.getEntity().getFileName(), i));                    </span>
<span class="3932130165010443212" onmouseenter="enter('3932130165010443212');" onmouseout="out('3932130165010443212');" style=""> 379      mConstance.COMPLETE_THREAD_NUM = mCompleteThreadNum;                                                          </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style=""> 380      mConstance.STOP_NUM++;                                                                                        </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style=""> 381      mConstance.CANCEL_NUM++;                                                                                      </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style=""> 382      if (mConstance.isComplete()) {                                                                                </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style=""> 383        mRecord.deleteData();                                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style=""> 384        mListener.onComplete();                                                                                     </span>
<span class="-4614535207592270663" onmouseenter="enter('-4614535207592270663');" onmouseout="out('-4614535207592270663');" style=""> 385        mConstance.isRunning = false;                                                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 386        return true;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387      }                                                                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 388      return false;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389    }                                                                                                               </span>
<span  style=""> 390                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 391    /**                                                                                                             </span>
<span class="8881300510663389339" onmouseenter="enter('8881300510663389339');" onmouseout="out('8881300510663389339');" style=""> 392     * 启动断点任务时，创建单线程任务                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 393     *                                                                                                              </span>
<span class="4311889051397531831" onmouseenter="enter('4311889051397531831');" onmouseout="out('4311889051397531831');" style=""> 394     * @param i 线程id                                                                                                </span>
<span class="1230174220176038900" onmouseenter="enter('1230174220176038900');" onmouseout="out('1230174220176038900');" style=""> 395     * @param startL 该任务起始位置                                                                                        </span>
<span class="1858994332528537357" onmouseenter="enter('1858994332528537357');" onmouseout="out('1858994332528537357');" style=""> 396     * @param endL 该任务结束位置                                                                                          </span>
<span class="4908980689327331914" onmouseenter="enter('4908980689327331914');" onmouseout="out('4908980689327331914');" style=""> 397     * @param fileLength 该任务需要处理的文件长度                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 398     */                                                                                                             </span>
<span class="8417307416647678377" onmouseenter="enter('8417307416647678377');" onmouseout="out('8417307416647678377');" style=""> 399    private AbsThreadTask createSingThreadTask(int i, long startL, long endL, long fileLength,                      </span>
<span class="-2934306509623024164" onmouseenter="enter('-2934306509623024164');" onmouseout="out('-2934306509623024164');" style=""> 400        ThreadRecord record) {                                                                                      </span>
<span class="-7768173698086340418" onmouseenter="enter('-7768173698086340418');" onmouseout="out('-7768173698086340418');" style=""> 401      SubThreadConfig&lt;TASK_ENTITY&gt; config = new SubThreadConfig&lt;&gt;();                                                </span>
<span class="-8558948078866873984" onmouseenter="enter('-8558948078866873984');" onmouseout="out('-8558948078866873984');" style=""> 402      config.FILE_SIZE = fileLength;                                                                                </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style=""> 403      config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                              </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style=""> 404      config.TEMP_FILE = mTempFile;                                                                                 </span>
<span class="-8589974584258899309" onmouseenter="enter('-8589974584258899309');" onmouseout="out('-8589974584258899309');" style=""> 405      config.THREAD_ID = i;                                                                                         </span>
<span class="-423990566973150114" onmouseenter="enter('-423990566973150114');" onmouseout="out('-423990566973150114');" style=""> 406      config.START_LOCATION = startL;                                                                               </span>
<span class="7030036366591044852" onmouseenter="enter('7030036366591044852');" onmouseout="out('7030036366591044852');" style=""> 407      config.END_LOCATION = endL;                                                                                   </span>
<span class="4558959233585694596" onmouseenter="enter('4558959233585694596');" onmouseout="out('4558959233585694596');" style=""> 408      config.SUPPORT_BP = mTaskEntity.isSupportBP();                                                                </span>
<span class="-6844563562976749056" onmouseenter="enter('-6844563562976749056');" onmouseout="out('-6844563562976749056');" style=""> 409      config.TASK_ENTITY = mTaskEntity;                                                                             </span>
<span class="-4817448612298280426" onmouseenter="enter('-4817448612298280426');" onmouseout="out('-4817448612298280426');" style=""> 410      config.THREAD_RECORD = record;                                                                                </span>
<span class="-3921818352268167442" onmouseenter="enter('-3921818352268167442');" onmouseout="out('-3921818352268167442');" style=""> 411      return selectThreadTask(config);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 412    }                                                                                                               </span>
<span  style=""> 413                                                                                                                    </span>
<span class="6532423587840407518" onmouseenter="enter('6532423587840407518');" onmouseout="out('6532423587840407518');" style=""> 414    private void handleBreakpoint() {                                                                               </span>
<span class="-4822982872266026601" onmouseenter="enter('-4822982872266026601');" onmouseout="out('-4822982872266026601');" style=""> 415      long fileLength = mEntity.getFileSize();                                                                      </span>
<span class="-23207299311678828" onmouseenter="enter('-23207299311678828');" onmouseout="out('-23207299311678828');" style=""> 416      long blockSize = fileLength / mTotalThreadNum;                                                                </span>
<span class="7144011642124032136" onmouseenter="enter('7144011642124032136');" onmouseout="out('7144011642124032136');" style=""> 417      int[] threadId = new int[mTotalThreadNum];                                                                    </span>
<span class="794844889575716346" onmouseenter="enter('794844889575716346');" onmouseout="out('794844889575716346');" style=""> 418      int rl = 0;                                                                                                   </span>
<span  style=""> 419                                                                                                                    </span>
<span class="575574520788079541" onmouseenter="enter('575574520788079541');" onmouseout="out('575574520788079541');" style=""> 420      mRecord.fileLength = fileLength;                                                                              </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 421      for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                                   </span>
<span class="5272717944804854313" onmouseenter="enter('5272717944804854313');" onmouseout="out('5272717944804854313');" style=""> 422        threadId[i] = -1;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423      }                                                                                                             </span>
<span class="3996378219805798096" onmouseenter="enter('3996378219805798096');" onmouseout="out('3996378219805798096');" style=""> 424      if (mTaskEntity.isNewTask() &amp;&amp; !handleNewTask()) {                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 425        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426      }                                                                                                             </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 427      for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                                   </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style=""> 428        long startL = i * blockSize, endL = (i + 1) * blockSize;                                                    </span>
<span class="5090177735693834127" onmouseenter="enter('5090177735693834127');" onmouseout="out('5090177735693834127');" style=""> 429        ThreadRecord tr;                                                                                            </span>
<span class="-7836453111996726628" onmouseenter="enter('-7836453111996726628');" onmouseout="out('-7836453111996726628');" style=""> 430        boolean isNewTr = false;  // 是否是新的线程记录                                                                      </span>
<span class="-6597548071328599593" onmouseenter="enter('-6597548071328599593');" onmouseout="out('-6597548071328599593');" style=""> 431        if (mTaskEntity.isNewTask()) {                                                                              </span>
<span class="-1372101013715036968" onmouseenter="enter('-1372101013715036968');" onmouseout="out('-1372101013715036968');" style=""> 432          tr = new ThreadRecord();                                                                                  </span>
<span class="3917749081996930633" onmouseenter="enter('3917749081996930633');" onmouseout="out('3917749081996930633');" style=""> 433          tr.key = mRecord.filePath;                                                                                </span>
<span class="-7575886392361997801" onmouseenter="enter('-7575886392361997801');" onmouseout="out('-7575886392361997801');" style=""> 434          tr.threadId = i;                                                                                          </span>
<span class="3085824084899250864" onmouseenter="enter('3085824084899250864');" onmouseout="out('3085824084899250864');" style=""> 435          isNewTr = true;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 436        } else {                                                                                                    </span>
<span class="-548726359565759652" onmouseenter="enter('-548726359565759652');" onmouseout="out('-548726359565759652');" style=""> 437          tr = mRecord.threadRecords.get(i);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438        }                                                                                                           </span>
<span class="-973014210831854259" onmouseenter="enter('-973014210831854259');" onmouseout="out('-973014210831854259');" style=""> 439        if (tr.isComplete) {//该线程已经完成                                                                               </span>
<span class="5189294880655919692" onmouseenter="enter('5189294880655919692');" onmouseout="out('5189294880655919692');" style=""> 440          if (resumeRecordLocation(i, startL, endL)) return;                                                        </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 441          continue;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 442        }                                                                                                           </span>
<span  style=""> 443                                                                                                                    </span>
<span class="1183688269285295822" onmouseenter="enter('1183688269285295822');" onmouseout="out('1183688269285295822');" style=""> 444        //如果有记录，则恢复任务                                                                                               </span>
<span class="8289251945837025497" onmouseenter="enter('8289251945837025497');" onmouseout="out('8289251945837025497');" style=""> 445        if (tr.startLocation &gt;= 0) {                                                                                </span>
<span class="-7166560389597808593" onmouseenter="enter('-7166560389597808593');" onmouseout="out('-7166560389597808593');" style=""> 446          Long r = tr.startLocation;                                                                                </span>
<span class="-7915611879357930899" onmouseenter="enter('-7915611879357930899');" onmouseout="out('-7915611879357930899');" style=""> 447          //记录的位置需要在线程区间中                                                                                           </span>
<span class="-1441157907339638000" onmouseenter="enter('-1441157907339638000');" onmouseout="out('-1441157907339638000');" style=""> 448          if (startL &lt; r &amp;&amp; r &lt; (i == (mTotalThreadNum - 1) ? fileLength : endL)) {                                 </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style=""> 449            mConstance.CURRENT_LOCATION += r - startL;                                                              </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style=""> 450            startL = r;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 451          }                                                                                                         </span>
<span class="5845990765500507783" onmouseenter="enter('5845990765500507783');" onmouseout="out('5845990765500507783');" style=""> 452          ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__恢复任务&quot;, mEntity.getFileName(), i));                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 453        }                                                                                                           </span>
<span class="7194952027883197425" onmouseenter="enter('7194952027883197425');" onmouseout="out('7194952027883197425');" style=""> 454        //最后一个线程的结束位置即为文件的总长度                                                                                       </span>
<span class="-5942950699866528890" onmouseenter="enter('-5942950699866528890');" onmouseout="out('-5942950699866528890');" style=""> 455        if (i == (mTotalThreadNum - 1)) {                                                                           </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style=""> 456          endL = fileLength;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 457        }                                                                                                           </span>
<span class="8496166720772172680" onmouseenter="enter('8496166720772172680');" onmouseout="out('8496166720772172680');" style=""> 458        // 更新记录                                                                                                     </span>
<span class="635736622332337160" onmouseenter="enter('635736622332337160');" onmouseout="out('635736622332337160');" style=""> 459        tr.startLocation = startL;                                                                                  </span>
<span class="-8820011367691672414" onmouseenter="enter('-8820011367691672414');" onmouseout="out('-8820011367691672414');" style=""> 460        tr.endLocation = endL;                                                                                      </span>
<span class="-5584934139293502444" onmouseenter="enter('-5584934139293502444');" onmouseout="out('-5584934139293502444');" style=""> 461        if (isNewTr) {                                                                                              </span>
<span class="7750338393456465672" onmouseenter="enter('7750338393456465672');" onmouseout="out('7750338393456465672');" style=""> 462          mRecord.threadRecords.add(tr);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 463        }                                                                                                           </span>
<span class="6319026600890011419" onmouseenter="enter('6319026600890011419');" onmouseout="out('6319026600890011419');" style=""> 464        AbsThreadTask task = createSingThreadTask(i, startL, endL, fileLength, tr);                                 </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style=""> 465        if (task == null) return;                                                                                   </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style=""> 466        mTask.put(i, task);                                                                                         </span>
<span class="2496245772724592303" onmouseenter="enter('2496245772724592303');" onmouseout="out('2496245772724592303');" style=""> 467        threadId[rl] = i;                                                                                           </span>
<span class="406496172865319317" onmouseenter="enter('406496172865319317');" onmouseout="out('406496172865319317');" style=""> 468        rl++;                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469      }                                                                                                             </span>
<span class="290274778352054232" onmouseenter="enter('290274778352054232');" onmouseout="out('290274778352054232');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 470 +    if (mConstance.CURRENT_LOCATION != 0                                                                          </span>
<span class="8899125546582658120" onmouseenter="enter('8899125546582658120');" onmouseout="out('8899125546582658120');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 471 +        &amp;&amp; mConstance.CURRENT_LOCATION != mEntity.getCurrentProgress()) {                                         </span>
<span class="-107308688072847772" onmouseenter="enter('-107308688072847772');" onmouseout="out('-107308688072847772');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 472 +      ALog.d(TAG, &quot;进度修正&quot;);                                                                                        </span>
<span class="480370803854164555" onmouseenter="enter('480370803854164555');" onmouseout="out('480370803854164555');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 473 +      mEntity.setCurrentProgress(mConstance.CURRENT_LOCATION);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 474 +    }                                                                                                             </span>
<span class="-4447853798640415053" onmouseenter="enter('-4447853798640415053');" onmouseout="out('-4447853798640415053');" style=""> 475      saveRecord();                                                                                                 </span>
<span class="5367791124370950090" onmouseenter="enter('5367791124370950090');" onmouseout="out('5367791124370950090');" style=""> 476      startThreadTask(threadId);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 477    }                                                                                                               </span>
<span  style=""> 478                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 479    /**                                                                                                             </span>
<span class="3352756078121499684" onmouseenter="enter('3352756078121499684');" onmouseout="out('3352756078121499684');" style=""> 480     * 启动单线程任务                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 481     */                                                                                                             </span>
<span class="-4163844434134623471" onmouseenter="enter('-4163844434134623471');" onmouseout="out('-4163844434134623471');" style=""> 482    private void startThreadTask(int[] recordL) {                                                                   </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style=""> 483      if (mConstance.CURRENT_LOCATION &gt; 0) {                                                                        </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style=""> 484        mListener.onResume(mConstance.CURRENT_LOCATION);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 485      } else {                                                                                                      </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style=""> 486        mListener.onStart(mConstance.CURRENT_LOCATION);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 487      }                                                                                                             </span>
<span class="-3724057379342966503" onmouseenter="enter('-3724057379342966503');" onmouseout="out('-3724057379342966503');" style=""> 488      mFixedThreadPool = Executors.newFixedThreadPool(recordL.length);                                              </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style=""> 489      for (int l : recordL) {                                                                                       </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style=""> 490        if (l == -1) continue;                                                                                      </span>
<span class="-85915337091278441" onmouseenter="enter('-85915337091278441');" onmouseout="out('-85915337091278441');" style=""> 491        Runnable task = mTask.get(l);                                                                               </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 492        if (task != null) {                                                                                         </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 493          mFixedThreadPool.execute(task);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 494        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 496    }                                                                                                               </span>
<span  style=""> 497                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 498    /**                                                                                                             </span>
<span class="4764351819472741633" onmouseenter="enter('4764351819472741633');" onmouseout="out('4764351819472741633');" style=""> 499     * 重试线程任务，只有线程创建成功才能重试                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 500     */                                                                                                             </span>
<span class="-7672284813277629720" onmouseenter="enter('-7672284813277629720');" onmouseout="out('-7672284813277629720');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 501 -  public void retryThradTask() {                                                                                  </span>
<span class="-5467219194911799226" onmouseenter="enter('-5467219194911799226');" onmouseout="out('-5467219194911799226');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 502 +  public void retryThreadTask() {                                                                                 </span>
<span class="5365338227073743" onmouseenter="enter('5365338227073743');" onmouseout="out('5365338227073743');" style=""> 503      if (mTask == null || mTask.size() == 0) {                                                                     </span>
<span class="-4385520730156955316" onmouseenter="enter('-4385520730156955316');" onmouseout="out('-4385520730156955316');" style=""> 504        ALog.w(TAG, &quot;没有线程任务&quot;);                                                                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 505        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 506      }                                                                                                             </span>
<span class="-9197459414244668337" onmouseenter="enter('-9197459414244668337');" onmouseout="out('-9197459414244668337');" style=""> 507      Set&lt;Integer&gt; keys = mTask.keySet();                                                                           </span>
<span class="4969357970824756675" onmouseenter="enter('4969357970824756675');" onmouseout="out('4969357970824756675');" style=""> 508      for (Integer key : keys) {                                                                                    </span>
<span class="-8581528427459564550" onmouseenter="enter('-8581528427459564550');" onmouseout="out('-8581528427459564550');" style=""> 509        AbsThreadTask task = mTask.get(key);                                                                        </span>
<span class="-6295419555080725627" onmouseenter="enter('-6295419555080725627');" onmouseout="out('-6295419555080725627');" style=""> 510        if (task != null &amp;&amp; !task.isThreadComplete()) {                                                             </span>
<span class="5627547129301802684" onmouseenter="enter('5627547129301802684');" onmouseout="out('5627547129301802684');" style=""> 511          task.getConfig().START_LOCATION = task.getCurrentLocation();                                              </span>



<span class="7735765379424984851" onmouseenter="enter('7735765379424984851');" onmouseout="out('7735765379424984851');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 512 -        ALog.d(TAG, String.format(&quot;任务【%s】开始重试，线程__%s__【开始位置：%s，结束位置：%s】&quot;, mEntity.getFileName(),                  </span>
<span class="-669110355825383115" onmouseenter="enter('-669110355825383115');" onmouseout="out('-669110355825383115');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 513 -            key, task.getConfig().START_LOCATION, task.getConfig().END_LOCATION));                                </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 514 +        ALog.d(TAG,                                                                                               </span>
<span class="-3294550289328777330" onmouseenter="enter('-3294550289328777330');" onmouseout="out('-3294550289328777330');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 515 +            String.format(&quot;任务【%s】开始重试，线程__%s__【开始位置：%s，结束位置：%s】&quot;, mEntity.getFileName(), key,                     </span>
<span class="-1022518935466510561" onmouseenter="enter('-1022518935466510561');" onmouseout="out('-1022518935466510561');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 516 +                task.getConfig().START_LOCATION, task.getConfig().END_LOCATION));                                 </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 517          mFixedThreadPool.execute(task);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 519      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 520    }                                                                                                               </span>
<span  style=""> 521                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 522    /**                                                                                                             </span>
<span class="3489882028140634260" onmouseenter="enter('3489882028140634260');" onmouseout="out('3489882028140634260');" style=""> 523     * 处理新任务                                                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 524     *                                                                                                              </span>
<span class="8941769692798326625" onmouseenter="enter('8941769692798326625');" onmouseout="out('8941769692798326625');" style=""> 525     * @return {@code true}创建新任务失败                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 526     */                                                                                                             </span>
<span class="3897453149098456479" onmouseenter="enter('3897453149098456479');" onmouseout="out('3897453149098456479');" style=""> 527    protected abstract boolean handleNewTask();                                                                     </span>
<span  style=""> 528                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 529    /**                                                                                                             </span>
<span class="-4404408971562231280" onmouseenter="enter('-4404408971562231280');" onmouseout="out('-4404408971562231280');" style=""> 530     * 处理不支持断点的任务                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 531     */                                                                                                             </span>
<span class="-8792279366871913220" onmouseenter="enter('-8792279366871913220');" onmouseout="out('-8792279366871913220');" style=""> 532    private void handleNoSupportBP() {                                                                              </span>
<span class="-7768173698086340418" onmouseenter="enter('-7768173698086340418');" onmouseout="out('-7768173698086340418');" style=""> 533      SubThreadConfig&lt;TASK_ENTITY&gt; config = new SubThreadConfig&lt;&gt;();                                                </span>
<span class="-8916543478630030690" onmouseenter="enter('-8916543478630030690');" onmouseout="out('-8916543478630030690');" style=""> 534      config.FILE_SIZE = mEntity.getFileSize();                                                                     </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style=""> 535      config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                              </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style=""> 536      config.TEMP_FILE = mTempFile;                                                                                 </span>
<span class="-5899809357890352135" onmouseenter="enter('-5899809357890352135');" onmouseout="out('-5899809357890352135');" style=""> 537      config.THREAD_ID = 0;                                                                                         </span>
<span class="7958711547477559333" onmouseenter="enter('7958711547477559333');" onmouseout="out('7958711547477559333');" style=""> 538      config.START_LOCATION = 0;                                                                                    </span>
<span class="911498546153633759" onmouseenter="enter('911498546153633759');" onmouseout="out('911498546153633759');" style=""> 539      config.END_LOCATION = config.FILE_SIZE;                                                                       </span>
<span class="4558959233585694596" onmouseenter="enter('4558959233585694596');" onmouseout="out('4558959233585694596');" style=""> 540      config.SUPPORT_BP = mTaskEntity.isSupportBP();                                                                </span>
<span class="-6844563562976749056" onmouseenter="enter('-6844563562976749056');" onmouseout="out('-6844563562976749056');" style=""> 541      config.TASK_ENTITY = mTaskEntity;                                                                             </span>
<span class="-5296271627358693026" onmouseenter="enter('-5296271627358693026');" onmouseout="out('-5296271627358693026');" style=""> 542      AbsThreadTask task = selectThreadTask(config);                                                                </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style=""> 543      if (task == null) return;                                                                                     </span>
<span class="8048363116921461760" onmouseenter="enter('8048363116921461760');" onmouseout="out('8048363116921461760');" style=""> 544      mTask.put(0, task);                                                                                           </span>
<span class="4151941088630277800" onmouseenter="enter('4151941088630277800');" onmouseout="out('4151941088630277800');" style=""> 545      mFixedThreadPool = Executors.newFixedThreadPool(1);                                                           </span>
<span class="6466431354000713338" onmouseenter="enter('6466431354000713338');" onmouseout="out('6466431354000713338');" style=""> 546      mFixedThreadPool.execute(task);                                                                               </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style=""> 547      mListener.onStart(0);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548    }                                                                                                               </span>
<span  style=""> 549                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 550    /**                                                                                                             </span>
<span class="5502854491504205724" onmouseenter="enter('5502854491504205724');" onmouseout="out('5502854491504205724');" style=""> 551     * 选择单任务线程的类型                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 552     */                                                                                                             </span>
<span class="-158713741323683937" onmouseenter="enter('-158713741323683937');" onmouseout="out('-158713741323683937');" style=""> 553    protected abstract AbsThreadTask selectThreadTask(SubThreadConfig&lt;TASK_ENTITY&gt; config);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 554  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            