<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>319</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    319
                    <a href="318.html">prev</a>
                    <a href="320.html">next</a>
                    <a href="319_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Automattic/simplenote-android_6780311d33539eb86c4007a7d1993f6f1467a837_src/com/automattic/simplenote/models/Tag.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837:src/com/automattic/simplenote/models/Tag.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837^1:src/com/automattic/simplenote/models/Tag.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837^2:src/com/automattic/simplenote/models/Tag.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;20279c862696f156d42fbdab7ae10281f312fb27:src/com/automattic/simplenote/models/Tag.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[sbj]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
   2 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote.models;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 import com.simperium.client.BucketObject;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import com.simperium.client.BucketSchema;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import java.util.Map;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 public class Tag extends BucketObject {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 	public static final String BUCKET_NAME=&quot;tag&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 	protected int tagIndex;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 	protected String name = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 	public static class Schema extends BucketSchema&lt;Tag&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27         public Schema(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28             autoIndex();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31         public String getRemoteName(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32             return Tag.BUCKET_NAME;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 		public Tag build(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 			return new Tag(key, properties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39         public void update(Tag tag, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40             tag.setProperties(properties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44     public static Query&lt;Tag&gt; all(Bucket&lt;Tag&gt; bucket){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45         return bucket.query().order(&quot;index&quot;).orderByKey();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 	public Tag(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 		super(key, properties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52 	public String getName() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53 		String name = (String) properties.get(&quot;name&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54         if (name == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55             name = getSimperiumKey();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57         return name;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60 	public void setName(String name) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 		if (name == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 			name = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64         properties.put(&quot;name&quot;, name);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66 		</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67 	public Integer getIndex() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68         return (Integer) properties.get(&quot;index&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71 	public void setIndex(Integer tagIndex) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72         if (tagIndex == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73             properties.remove(&quot;index&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75             properties.put(&quot;index&quot;, tagIndex);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79     public void renameTo(String name, Bucket&lt;Note&gt; notesBucket){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         String key = name.toLowerCase();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81         if (!getSimperiumKey().equals(key)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82             // create a new tag with the value as the key/name</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83             // TODO: tag already exists?</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84             Tag newTag = ((Bucket&lt;Tag&gt;) getBucket()).newObject(key);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85             newTag.setName(name);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86             newTag.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87             // get all the notes from tag, remove the item</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88             ObjectCursor&lt;Note&gt; notesCursor = findNotes(notesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89             while(notesCursor.moveToNext()){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90                 Note note = notesCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91                 List&lt;String&gt; tags = new ArrayList&lt;String&gt;(note.getTags());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92                 List&lt;String&gt; newTags = new ArrayList&lt;String&gt;(tags.size());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93                 // iterate and do a case insensitive comparison on each tag</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94                 for (String tag : tags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95                     // if it&#x27;s this tag, add the new tag</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96                     if (tag.toLowerCase().equals(getSimperiumKey())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97                         newTags.add(name);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98                     } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99                         newTags.add(tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102                 note.setTags(newTags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103                 note.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105             notesCursor.close();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106             delete();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107         } else if(!getName().equals(name)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108             setName(name);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109             save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113     protected void setProperties(Map&lt;String,Object&gt; properties){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114         this.properties = properties;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117     public ObjectCursor&lt;Note&gt; findNotes(Bucket&lt;Note&gt; notesBucket){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118         return notesBucket.query().where(&quot;tags&quot;, ComparisonType.LIKE, getSimperiumKey()).execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120 }</span>
 121 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122 package com.automattic.simplenote.models;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126 import com.simperium.client.BucketObject;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127 import com.simperium.client.BucketSchema;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129 import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132 import java.util.Map;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133 import java.util.HashMap;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139 public class Tag extends BucketObject {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140 	</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141 	public static final String BUCKET_NAME=&quot;tag&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142 	protected int tagIndex;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143 	protected String name = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145 	public static class Schema extends BucketSchema&lt;Tag&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147         public Schema(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148             autoIndex();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151         public String getRemoteName(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152             return Tag.BUCKET_NAME;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155 		public Tag build(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156 			return new Tag(key, properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159         public void update(Tag tag, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160             tag.setProperties(properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164     public static Query&lt;Tag&gt; all(Bucket&lt;Tag&gt; bucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165         return bucket.query().order(&quot;index&quot;).orderByKey();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168     public Tag(String key){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169         super(key, new HashMap&lt;String,Object&gt;());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172 	public Tag(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173 		super(key, properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176 	public String getName() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177 		String name = (String) properties.get(&quot;name&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178         if (name == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179             name = getSimperiumKey();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181         return name;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183 	</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184 	public void setName(String name) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185 		if (name == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186 			name = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188         properties.put(&quot;name&quot;, name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190 		</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191 	public Integer getIndex() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192         return (Integer) properties.get(&quot;index&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194 	</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195 	public void setIndex(Integer tagIndex) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196         if (tagIndex == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197             properties.remove(&quot;index&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199             properties.put(&quot;index&quot;, tagIndex);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203     public void renameTo(String name, Bucket&lt;Note&gt; notesBucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204         String key = name.toLowerCase();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205         if (!getSimperiumKey().equals(key)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206             // create a new tag with the value as the key/name</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207             // TODO: tag already exists?</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208             Tag newTag = ((Bucket&lt;Tag&gt;) getBucket()).newObject(key);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209             newTag.setName(name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210             newTag.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211             // get all the notes from tag, remove the item</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212             ObjectCursor&lt;Note&gt; notesCursor = findNotes(notesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213             while(notesCursor.moveToNext()){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214                 Note note = notesCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215                 List&lt;String&gt; tags = new ArrayList&lt;String&gt;(note.getTags());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216                 List&lt;String&gt; newTags = new ArrayList&lt;String&gt;(tags.size());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217                 // iterate and do a case insensitive comparison on each tag</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218                 for (String tag : tags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219                     // if it&#x27;s this tag, add the new tag</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220                     if (tag.toLowerCase().equals(getSimperiumKey())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221                         newTags.add(name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222                     } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223                         newTags.add(tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226                 note.setTags(newTags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227                 note.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229             notesCursor.close();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230             delete();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231         } else if(!getName().equals(name)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232             setName(name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233             save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237     protected void setProperties(Map&lt;String,Object&gt; properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238         this.properties = properties;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241     public ObjectCursor&lt;Note&gt; findNotes(Bucket&lt;Note&gt; notesBucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242         return notesBucket.query().where(&quot;tags&quot;, ComparisonType.LIKE, getSimperiumKey()).execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244 }</span>
 245 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote.models;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 import com.simperium.client.BucketObject;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import com.simperium.client.BucketSchema;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import java.util.Map;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 public class Tag extends BucketObject {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 	public static final String BUCKET_NAME=&quot;tag&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 	protected int tagIndex;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 	protected String name = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 	public static class Schema extends BucketSchema&lt;Tag&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27         public Schema(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28             autoIndex();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31         public String getRemoteName(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32             return Tag.BUCKET_NAME;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 		public Tag build(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 			return new Tag(key, properties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39         public void update(Tag tag, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40             tag.setProperties(properties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44     public static Query&lt;Tag&gt; all(Bucket&lt;Tag&gt; bucket){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45         return bucket.query().order(&quot;index&quot;).orderByKey();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 	public Tag(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 		super(key, properties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52 	public String getName() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53 		String name = (String) properties.get(&quot;name&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54         if (name == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55             name = getSimperiumKey();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57         return name;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60 	public void setName(String name) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 		if (name == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 			name = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64         properties.put(&quot;name&quot;, name);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67 	public Integer getIndex() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68         return (Integer) properties.get(&quot;index&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71 	public void setIndex(Integer tagIndex) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72         if (tagIndex == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73             properties.remove(&quot;index&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75             properties.put(&quot;index&quot;, tagIndex);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79     public void renameTo(String name, Bucket&lt;Note&gt; notesBucket){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         String key = name.toLowerCase();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81         if (!getSimperiumKey().equals(key)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82             // create a new tag with the value as the key/name</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83             // TODO: tag already exists?</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84             Tag newTag = ((Bucket&lt;Tag&gt;) getBucket()).newObject(key);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85             newTag.setName(name);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86             newTag.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87             // get all the notes from tag, remove the item</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88             ObjectCursor&lt;Note&gt; notesCursor = findNotes(notesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89             while(notesCursor.moveToNext()){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90                 Note note = notesCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91                 List&lt;String&gt; tags = new ArrayList&lt;String&gt;(note.getTags());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92                 List&lt;String&gt; newTags = new ArrayList&lt;String&gt;(tags.size());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93                 // iterate and do a case insensitive comparison on each tag</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94                 for (String tag : tags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95                     // if it&#x27;s this tag, add the new tag</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96                     if (tag.toLowerCase().equals(getSimperiumKey())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97                         newTags.add(name);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98                     } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99                         newTags.add(tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102                 note.setTags(newTags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103                 note.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105             notesCursor.close();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106             delete();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107         } else if(!getName().equals(name)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108             setName(name);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109             save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113     protected void setProperties(Map&lt;String,Object&gt; properties){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114         this.properties = properties;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117     public ObjectCursor&lt;Note&gt; findNotes(Bucket&lt;Note&gt; notesBucket){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118         return notesBucket.query().where(&quot;tags&quot;, ComparisonType.LIKE, getSimperiumKey()).execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120 }</span>
 121 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122 package com.automattic.simplenote.models;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126 import com.simperium.client.BucketObject;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127 import com.simperium.client.BucketSchema;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129 import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132 import java.util.Map;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133 import java.util.HashMap;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139 public class Tag extends BucketObject {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141 	public static final String BUCKET_NAME=&quot;tag&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142 	protected int tagIndex;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143 	protected String name = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145 	public static class Schema extends BucketSchema&lt;Tag&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147         public Schema(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148             autoIndex();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151         public String getRemoteName(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152             return Tag.BUCKET_NAME;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155 		public Tag build(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156 			return new Tag(key, properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159         public void update(Tag tag, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160             tag.setProperties(properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164     public static Query&lt;Tag&gt; all(Bucket&lt;Tag&gt; bucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165         return bucket.query().order(&quot;index&quot;).orderByKey();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168     public Tag(String key){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169         super(key, new HashMap&lt;String,Object&gt;());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172 	public Tag(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173 		super(key, properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176 	public String getName() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177 		String name = (String) properties.get(&quot;name&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178         if (name == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179             name = getSimperiumKey();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181         return name;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184 	public void setName(String name) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185 		if (name == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186 			name = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188         properties.put(&quot;name&quot;, name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191 	public Integer getIndex() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192         return (Integer) properties.get(&quot;index&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195 	public void setIndex(Integer tagIndex) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196         if (tagIndex == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197             properties.remove(&quot;index&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199             properties.put(&quot;index&quot;, tagIndex);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203     public void renameTo(String name, Bucket&lt;Note&gt; notesBucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204         String key = name.toLowerCase();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205         if (!getSimperiumKey().equals(key)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206             // create a new tag with the value as the key/name</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207             // TODO: tag already exists?</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208             Tag newTag = ((Bucket&lt;Tag&gt;) getBucket()).newObject(key);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209             newTag.setName(name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210             newTag.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211             // get all the notes from tag, remove the item</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212             ObjectCursor&lt;Note&gt; notesCursor = findNotes(notesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213             while(notesCursor.moveToNext()){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214                 Note note = notesCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215                 List&lt;String&gt; tags = new ArrayList&lt;String&gt;(note.getTags());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216                 List&lt;String&gt; newTags = new ArrayList&lt;String&gt;(tags.size());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217                 // iterate and do a case insensitive comparison on each tag</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218                 for (String tag : tags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219                     // if it&#x27;s this tag, add the new tag</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220                     if (tag.toLowerCase().equals(getSimperiumKey())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221                         newTags.add(name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222                     } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223                         newTags.add(tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226                 note.setTags(newTags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227                 note.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229             notesCursor.close();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230             delete();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231         } else if(!getName().equals(name)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232             setName(name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233             save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237     protected void setProperties(Map&lt;String,Object&gt; properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238         this.properties = properties;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241     public ObjectCursor&lt;Note&gt; findNotes(Bucket&lt;Note&gt; notesBucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242         return notesBucket.query().where(&quot;tags&quot;, ComparisonType.LIKE, getSimperiumKey()).execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244 }</span>
 245 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw</abbr></span>
   4 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   5 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   6 package com.automattic.simplenote.models;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   7 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   8 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   9 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  10 import com.simperium.client.BucketObject;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  11 import com.simperium.client.BucketSchema;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  12 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  13 import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  14 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  15 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  16 import java.util.Map;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  17 import java.util.HashMap;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  18 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  19 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  20 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  21 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  22 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23 public class Tag extends BucketObject {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  24 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  25 	public static final String BUCKET_NAME=&quot;tag&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  26 	protected int tagIndex;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  27 	protected String name = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  28 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  29 	public static class Schema extends BucketSchema&lt;Tag&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  30 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  31         public Schema(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  32             autoIndex();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  33         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  34 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  35         public String getRemoteName(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36             return Tag.BUCKET_NAME;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  39 		public Tag build(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  40 			return new Tag(key, properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  41 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  42 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  43         public void update(Tag tag, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  44             tag.setProperties(properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  45         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  46 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  47 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  48     public static Query&lt;Tag&gt; all(Bucket&lt;Tag&gt; bucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  49         return bucket.query().order(&quot;index&quot;).orderByKey();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52     public Tag(String key){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53         super(key, new HashMap&lt;String,Object&gt;());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  55 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  56 	public Tag(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57 		super(key, properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60 	public String getName() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61 		String name = (String) properties.get(&quot;name&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62         if (name == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63             name = getSimperiumKey();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65         return name;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68 	public void setName(String name) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69 		if (name == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  70 			name = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72         properties.put(&quot;name&quot;, name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75 	public Integer getIndex() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76         return (Integer) properties.get(&quot;index&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79 	public void setIndex(Integer tagIndex) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  80         if (tagIndex == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81             properties.remove(&quot;index&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83             properties.put(&quot;index&quot;, tagIndex);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87     public void renameTo(String name, Bucket&lt;Note&gt; notesBucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88         String key = name.toLowerCase();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89         if (!getSimperiumKey().equals(key)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90             // create a new tag with the value as the key/name</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91             // TODO: tag already exists?</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92             Tag newTag = ((Bucket&lt;Tag&gt;) getBucket()).newObject(key);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93             newTag.setName(name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94             newTag.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95             // get all the notes from tag, remove the item</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96             ObjectCursor&lt;Note&gt; notesCursor = findNotes(notesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97             while(notesCursor.moveToNext()){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98                 Note note = notesCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99                 List&lt;String&gt; tags = new ArrayList&lt;String&gt;(note.getTags());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100                 List&lt;String&gt; newTags = new ArrayList&lt;String&gt;(tags.size());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101                 // iterate and do a case insensitive comparison on each tag</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102                 for (String tag : tags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103                     // if it&#x27;s this tag, add the new tag</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104                     if (tag.toLowerCase().equals(getSimperiumKey())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105                         newTags.add(name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106                     } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107                         newTags.add(tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110                 note.setTags(newTags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111                 note.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113             notesCursor.close();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114             delete();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115         } else if(!getName().equals(name)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116             setName(name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117             save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121     protected void setProperties(Map&lt;String,Object&gt; properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122         this.properties = properties;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125     public ObjectCursor&lt;Note&gt; findNotes(Bucket&lt;Note&gt; notesBucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126         return notesBucket.query().where(&quot;tags&quot;, ComparisonType.LIKE, getSimperiumKey()).execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128 }</span>
 129 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   1 -package com.automattic.simplenote.models;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   2 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   3 -import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   4 -import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   5 -import com.simperium.client.BucketObject;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   6 -import com.simperium.client.BucketSchema;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   7 -import com.simperium.client.Query;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   8 -import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   9 -import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  10 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  11 -import java.util.Map;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  12 -import java.util.List;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  13 -import java.util.ArrayList;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  14 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  15 -import android.util.Log;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  16 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  17 -public class Tag extends BucketObject {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  18 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -	public static final String BUCKET_NAME=&quot;tag&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -	protected int tagIndex;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -	protected String name = &quot;&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -	public static class Schema extends BucketSchema&lt;Tag&gt; {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -        public Schema(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  26 -            autoIndex();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  28 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -        public String getRemoteName(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 -            return Tag.BUCKET_NAME;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  31 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -		public Tag build(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -			return new Tag(key, properties);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  35 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  37 -        public void update(Tag tag, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  38 -            tag.setProperties(properties);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  39 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 -    public static Query&lt;Tag&gt; all(Bucket&lt;Tag&gt; bucket){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 -        return bucket.query().order(&quot;index&quot;).orderByKey();</span>




<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -	public Tag(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -		super(key, properties);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  50 -	public String getName() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -		String name = (String) properties.get(&quot;name&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  52 -        if (name == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  53 -            name = getSimperiumKey();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -        return name;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -	public void setName(String name) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -		if (name == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -			name = &quot;&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  61 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  62 -        properties.put(&quot;name&quot;, name);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -	public Integer getIndex() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -        return (Integer) properties.get(&quot;index&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  67 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  68 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  69 -	public void setIndex(Integer tagIndex) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  70 -        if (tagIndex == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  71 -            properties.remove(&quot;index&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  72 -        } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -            properties.put(&quot;index&quot;, tagIndex);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  76 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  77 -    public void renameTo(String name, Bucket&lt;Note&gt; notesBucket){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  78 -        String key = name.toLowerCase();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  79 -        if (!getSimperiumKey().equals(key)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -            // create a new tag with the value as the key/name</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -            // TODO: tag already exists?</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -            Tag newTag = ((Bucket&lt;Tag&gt;) getBucket()).newObject(key);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -            newTag.setName(name);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  84 -            newTag.save();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -            // get all the notes from tag, remove the item</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -            ObjectCursor&lt;Note&gt; notesCursor = findNotes(notesBucket);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -            while(notesCursor.moveToNext()){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -                Note note = notesCursor.getObject();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -                List&lt;String&gt; tags = new ArrayList&lt;String&gt;(note.getTags());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  90 -                List&lt;String&gt; newTags = new ArrayList&lt;String&gt;(tags.size());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -                // iterate and do a case insensitive comparison on each tag</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -                for (String tag : tags) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -                    // if it&#x27;s this tag, add the new tag</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -                    if (tag.toLowerCase().equals(getSimperiumKey())) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  95 -                        newTags.add(name);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  96 -                    } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  97 -                        newTags.add(tag);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  98 -                    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  99 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 100 -                note.setTags(newTags);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 101 -                note.save();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 102 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 103 -            notesCursor.close();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 104 -            delete();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 105 -        } else if(!getName().equals(name)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 106 -            setName(name);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 107 -            save();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 108 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 109 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 110 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 111 -    protected void setProperties(Map&lt;String,Object&gt; properties){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 112 -        this.properties = properties;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 113 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 114 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 115 -    public ObjectCursor&lt;Note&gt; findNotes(Bucket&lt;Note&gt; notesBucket){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -        return notesBucket.query().where(&quot;tags&quot;, ComparisonType.LIKE, getSimperiumKey()).execute();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 118 -}</span></pre></td>
                            <td><pre>   1  package com.automattic.simplenote.models;
   2  
   3  import com.simperium.client.Bucket;
   4  import com.simperium.client.Bucket.ObjectCursor;
   5  import com.simperium.client.BucketObject;
   6  import com.simperium.client.BucketSchema;
   7  import com.simperium.client.Query;
   8  import com.simperium.client.Query.ComparisonType;
   9  import com.simperium.client.Query.SortType;
  10  
  11  import java.util.Map;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  12 +import java.util.HashMap;</span>
  13  import java.util.List;
  14  import java.util.ArrayList;
  15  
  16  import android.util.Log;
  17  
  18  public class Tag extends BucketObject {
  19  
  20  	public static final String BUCKET_NAME=&quot;tag&quot;;
  21  	protected int tagIndex;
  22  	protected String name = &quot;&quot;;
  23  
  24  	public static class Schema extends BucketSchema&lt;Tag&gt; {
  25  
  26          public Schema(){
  27              autoIndex();
  28          }
  29  
  30          public String getRemoteName(){
  31              return Tag.BUCKET_NAME;
  32          }
  33  
  34  		public Tag build(String key, Map&lt;String,Object&gt;properties){
  35  			return new Tag(key, properties);
  36  		}
  37  
  38          public void update(Tag tag, Map&lt;String,Object&gt;properties){
  39              tag.setProperties(properties);
  40          }
  41  	}
  42  
  43      public static Query&lt;Tag&gt; all(Bucket&lt;Tag&gt; bucket){
  44          return bucket.query().order(&quot;index&quot;).orderByKey();
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  47 +    public Tag(String key){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +        super(key, new HashMap&lt;String,Object&gt;());</span>
  49      }
  50  
  51  	public Tag(String key, Map&lt;String,Object&gt;properties){
  52  		super(key, properties);
  53  	}
  54  
  55  	public String getName() {
  56  		String name = (String) properties.get(&quot;name&quot;);
  57          if (name == null) {
  58              name = getSimperiumKey();
  59          }
  60          return name;
  61  	}
  62  
  63  	public void setName(String name) {
  64  		if (name == null) {
  65  			name = &quot;&quot;;
  66  		}
  67          properties.put(&quot;name&quot;, name);
  68  	}
  69  
  70  	public Integer getIndex() {
  71          return (Integer) properties.get(&quot;index&quot;);
  72  	}
  73  
  74  	public void setIndex(Integer tagIndex) {
  75          if (tagIndex == null) {
  76              properties.remove(&quot;index&quot;);
  77          } else {
  78              properties.put(&quot;index&quot;, tagIndex);
  79          }
  80  	}
  81  
  82      public void renameTo(String name, Bucket&lt;Note&gt; notesBucket){
  83          String key = name.toLowerCase();
  84          if (!getSimperiumKey().equals(key)) {
  85              // create a new tag with the value as the key/name
  86              // TODO: tag already exists?
  87              Tag newTag = ((Bucket&lt;Tag&gt;) getBucket()).newObject(key);
  88              newTag.setName(name);
  89              newTag.save();
  90              // get all the notes from tag, remove the item
  91              ObjectCursor&lt;Note&gt; notesCursor = findNotes(notesBucket);
  92              while(notesCursor.moveToNext()){
  93                  Note note = notesCursor.getObject();
  94                  List&lt;String&gt; tags = new ArrayList&lt;String&gt;(note.getTags());
  95                  List&lt;String&gt; newTags = new ArrayList&lt;String&gt;(tags.size());
  96                  // iterate and do a case insensitive comparison on each tag
  97                  for (String tag : tags) {
  98                      // if it&#x27;s this tag, add the new tag
  99                      if (tag.toLowerCase().equals(getSimperiumKey())) {
 100                          newTags.add(name);
 101                      } else {
 102                          newTags.add(tag);
 103                      }
 104                  }
 105                  note.setTags(newTags);
 106                  note.save();
 107              }
 108              notesCursor.close();
 109              delete();
 110          } else if(!getName().equals(name)) {
 111              setName(name);
 112              save();
 113          }
 114      }
 115  
 116      protected void setProperties(Map&lt;String,Object&gt; properties){
 117          this.properties = properties;
 118      }
 119  
 120      public ObjectCursor&lt;Note&gt; findNotes(Bucket&lt;Note&gt; notesBucket){
 121          return notesBucket.query().where(&quot;tags&quot;, ComparisonType.LIKE, getSimperiumKey()).execute();
 122      }
 123  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            