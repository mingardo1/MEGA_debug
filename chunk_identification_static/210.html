<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>210</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    210
                    <a href="209.html">prev</a>
                    <a href="211.html">next</a>
                    <a href="210_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_8a215674f716dcaf861d2fd1d33951ef2d117dfc_core/broadleaf-framework-web/src/main/java/org/broadleafcommerce/core/web/processor/GoogleUniversalAnalyticsProcessor.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;8a215674f716dcaf861d2fd1d33951ef2d117dfc:core/broadleaf-framework-web/src/main/java/org/broadleafcommerce/core/web/processor/GoogleUniversalAnalyticsProcessor.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;8a215674f716dcaf861d2fd1d33951ef2d117dfc^1:core/broadleaf-framework-web/src/main/java/org/broadleafcommerce/core/web/processor/GoogleUniversalAnalyticsProcessor.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;8a215674f716dcaf861d2fd1d33951ef2d117dfc^2:core/broadleaf-framework-web/src/main/java/org/broadleafcommerce/core/web/processor/GoogleUniversalAnalyticsProcessor.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;2f9b07c02068e537453caf19387c86881174dd4a:core/broadleaf-framework-web/src/main/java/org/broadleafcommerce/core/web/processor/GoogleUniversalAnalyticsProcessor.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj], [s]], subset: [[bsj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="6211491254187717485" onmouseenter="enter('6211491254187717485');" onmouseout="out('6211491254187717485');" style="">   3  * BroadleafCommerce Framework Web                                                                       </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-579043521764695224" onmouseenter="enter('-579043521764695224');" onmouseout="out('-579043521764695224');" style="">  18 package org.broadleafcommerce.core.web.processor;                                                        </span>
<span  style="">  19                                                                                                          </span>
<span class="4020017653195254006" onmouseenter="enter('4020017653195254006');" onmouseout="out('4020017653195254006');" style="">  20 import org.apache.commons.collections.MapUtils;                                                          </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  24 import org.broadleafcommerce.common.util.BLCSystemProperty;                                              </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  25 import org.broadleafcommerce.common.web.BroadleafRequestContext;                                         </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  26 import org.broadleafcommerce.core.catalog.domain.Sku;                                                    </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  27 import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                        </span>
<span class="-6302349778747925467" onmouseenter="enter('-6302349778747925467');" onmouseout="out('-6302349778747925467');" style="">  28 import org.broadleafcommerce.core.order.domain.FulfillmentGroup;                                         </span>
<span class="-7855842771160128779" onmouseenter="enter('-7855842771160128779');" onmouseout="out('-7855842771160128779');" style="">  29 import org.broadleafcommerce.core.order.domain.FulfillmentGroupItem;                                     </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  30 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  31 import org.broadleafcommerce.core.order.domain.OrderItem;                                                </span>
<span class="2123683748922877231" onmouseenter="enter('2123683748922877231');" onmouseout="out('2123683748922877231');" style="">  32 import org.broadleafcommerce.core.order.domain.OrderItemAttribute;                                       </span>
<span class="3047856393988054011" onmouseenter="enter('3047856393988054011');" onmouseout="out('3047856393988054011');" style="">  33 import org.broadleafcommerce.core.order.domain.SkuAccessor;                                              </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  34 import org.broadleafcommerce.core.order.service.OrderService;                                            </span>
<span class="205237632867733562" onmouseenter="enter('205237632867733562');" onmouseout="out('205237632867733562');" style="">  35 import org.broadleafcommerce.presentation.condition.ConditionalOnTemplating;                             </span>
<span class="5380655934740542528" onmouseenter="enter('5380655934740542528');" onmouseout="out('5380655934740542528');" style="">  36 import org.broadleafcommerce.presentation.dialect.AbstractBroadleafTagReplacementProcessor;              </span>
<span class="7486567025810647827" onmouseenter="enter('7486567025810647827');" onmouseout="out('7486567025810647827');" style="">  37 import org.broadleafcommerce.presentation.model.BroadleafTemplateContext;                                </span>
<span class="-2001850062613906669" onmouseenter="enter('-2001850062613906669');" onmouseout="out('-2001850062613906669');" style="">  38 import org.broadleafcommerce.presentation.model.BroadleafTemplateElement;                                </span>
<span class="8100767512529469135" onmouseenter="enter('8100767512529469135');" onmouseout="out('8100767512529469135');" style="">  39 import org.broadleafcommerce.presentation.model.BroadleafTemplateModel;                                  </span>
<span class="-6189886993649876021" onmouseenter="enter('-6189886993649876021');" onmouseout="out('-6189886993649876021');" style="">  40 import org.broadleafcommerce.presentation.model.BroadleafTemplateNonVoidElement;                         </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  41 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  42 import org.springframework.stereotype.Component;                                                         </span>
<span  style="">  43                                                                                                          </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  44 import java.util.HashMap;                                                                                </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  45 import java.util.Map;                                                                                    </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  46 import java.util.Map.Entry;                                                                              </span>
<span  style="">  47                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  48 import javax.annotation.Resource;                                                                        </span>
<span class="-2972028083581866805" onmouseenter="enter('-2972028083581866805');" onmouseout="out('-2972028083581866805');" style="">  49 import javax.servlet.http.HttpServletRequest;                                                            </span>
<span  style="">  50                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  51 /**                                                                                                      </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  52  * &lt;p&gt;                                                                                                   </span>
<span class="-143385427104872854" onmouseenter="enter('-143385427104872854');" onmouseout="out('-143385427104872854');" style=""><abbr title="  53  * Takes advantage of the new-stype analytics.js from Google Analytics rather than the deprected ga.js. This also">  53  * Takes advantage of the new-stype analytics.js from Google Analytics rather than the deprected ga.js. TðŸ”µ</abbr></span>
<span class="-8898438840079886526" onmouseenter="enter('-8898438840079886526');" onmouseout="out('-8898438840079886526');" style=""><abbr title="  54  * supports a pre-processed &lt;b&gt;orderNumber&lt;/b&gt; attribute that can be null, suitable for things like the order confirmation">  54  * supports a pre-processed &lt;b&gt;orderNumber&lt;/b&gt; attribute that can be null, suitable for things like the oðŸ”µ</abbr></span>
<span class="-7917044275166249545" onmouseenter="enter('-7917044275166249545');" onmouseout="out('-7917044275166249545');" style="">  55  * page to send e-commerce transactions. Example usage:                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  56  *                                                                                                       </span>
<span class="-661354662451427256" onmouseenter="enter('-661354662451427256');" onmouseout="out('-661354662451427256');" style="">  57  * &lt;pre&gt;                                                                                                 </span>
<span class="-7906919746321802108" onmouseenter="enter('-7906919746321802108');" onmouseout="out('-7906919746321802108');" style="">  58  * &amp;lt;google_universal_analytics ordernumber=&quot;${order?.orderNumber&quot; /&amp;gt;                               </span>
<span class="2390307265644686" onmouseenter="enter('2390307265644686');" onmouseout="out('2390307265644686');" style="">  59  * &lt;/pre&gt;                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  60  *                                                                                                       </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  61  * &lt;p&gt;                                                                                                   </span>
<span class="8606412176857267386" onmouseenter="enter('8606412176857267386');" onmouseout="out('8606412176857267386');" style="">  62  * This processor also supports:                                                                         </span>
<span class="2717555647352622731" onmouseenter="enter('2717555647352622731');" onmouseout="out('2717555647352622731');" style="">  63  * &lt;ul&gt;                                                                                                  </span>
<span class="-8530737739149477803" onmouseenter="enter('-8530737739149477803');" onmouseout="out('-8530737739149477803');" style=""><abbr title="  64  *  &lt;li&gt;Multiple trackers (extensible via {@link #getTrackers()} or by setting the {@code googleAnalytics.masterWebPropertyId}">  64  *  &lt;li&gt;Multiple trackers (extensible via {@link #getTrackers()} or by setting the {@code googleAnalyticsðŸ”µ</abbr></span>
<span class="6265505146874472773" onmouseenter="enter('6265505146874472773');" onmouseout="out('6265505146874472773');" style="">  65  *      and {@code googleAnalytics.webPropertyId})&lt;/li&gt;                                                  </span>
<span class="-6827384770903327510" onmouseenter="enter('-6827384770903327510');" onmouseout="out('-6827384770903327510');" style="">  66  *  &lt;li&gt;Affiliates for e-commerce ({@ googleAnalytics.affiliation property})&lt;/li&gt;                        </span>
<span class="7100814537211017894" onmouseenter="enter('7100814537211017894');" onmouseout="out('7100814537211017894');" style=""><abbr title="  67  *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/2558867?hl=en&amp;utm_id=ad&quot;&gt;Link attribution&lt;/a&gt;">  67  *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/2558867?hl=en&amp;utm_id=ad&quot;&gt;Link attribution&lt;/aðŸ”µ</abbr></span>
<span class="4406549444147281940" onmouseenter="enter('4406549444147281940');" onmouseout="out('4406549444147281940');" style="">  68  *      ({@code googleAnalytics.enableLinkAttribution} system property, default {@code true})&lt;/li&gt;       </span>
<span class="-684988223968504417" onmouseenter="enter('-684988223968504417');" onmouseout="out('-684988223968504417');" style="">  69  *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/3450482&quot;&gt;Display Advertising&lt;/a&gt;            </span>
<span class="7299106057661310467" onmouseenter="enter('7299106057661310467');" onmouseout="out('7299106057661310467');" style="">  70  *      ({@code googleAnalytics.enableDisplayAdvertising} system property, default {@code false})&lt;/li&gt;   </span>
<span class="599475583152278076" onmouseenter="enter('599475583152278076');" onmouseout="out('599475583152278076');" style="">  71  * &lt;/ul&gt;                                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  72  *                                                                                                       </span>
<span class="630288204851723761" onmouseenter="enter('630288204851723761');" onmouseout="out('630288204851723761');" style=""><abbr title="  73  * @param ordernumber the order number to look up for ecommerce tracking, such as on the confirmation page">  73  * @param ordernumber the order number to look up for ecommerce tracking, such as on the confirmation pagðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  74  *                                                                                                       </span>
<span class="2670632328160232809" onmouseenter="enter('2670632328160232809');" onmouseout="out('2670632328160232809');" style="">  75  * @author Phillip Verheyden (phillipuniverse)                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  76  */                                                                                                      </span>
<span class="-7627801935997636319" onmouseenter="enter('-7627801935997636319');" onmouseout="out('-7627801935997636319');" style="">  77 @Component(&quot;blGoogleUniversalAnalyticsProcessor&quot;)                                                        </span>
<span class="7070618034916085721" onmouseenter="enter('7070618034916085721');" onmouseout="out('7070618034916085721');" style="">  78 @ConditionalOnTemplating                                                                                 </span>
<span class="-2399886873569081592" onmouseenter="enter('-2399886873569081592');" onmouseout="out('-2399886873569081592');" style="">  79 public class GoogleUniversalAnalyticsProcessor extends AbstractBroadleafTagReplacementProcessor {        </span>
<span  style="">  80                                                                                                          </span>
<span class="4721694570459087610" onmouseenter="enter('4721694570459087610');" onmouseout="out('4721694570459087610');" style="">  81     private static final Log LOG = LogFactory.getLog(GoogleUniversalAnalyticsProcessor.class);           </span>
<span  style="">  82                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  83     /**                                                                                                  </span>
<span class="5978956812126798070" onmouseenter="enter('5978956812126798070');" onmouseout="out('5978956812126798070');" style=""><abbr title="  84      * Global value, intentionally only retrieved as a file property NOT via the system properties service">  84      * Global value, intentionally only retrieved as a file property NOT via the system properties servicðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  85      */                                                                                                  </span>
<span class="2486332857350127859" onmouseenter="enter('2486332857350127859');" onmouseout="out('2486332857350127859');" style="">  86     @Value(&quot;${googleAnalytics.masterWebPropertyId}&quot;)                                                     </span>
<span class="8766018855843754021" onmouseenter="enter('8766018855843754021');" onmouseout="out('8766018855843754021');" style="">  87     protected String masterWebPropertyId;                                                                </span>
<span  style="">  88                                                                                                          </span>
<span class="-6135682035086935956" onmouseenter="enter('-6135682035086935956');" onmouseout="out('-6135682035086935956');" style="">  89     @Resource(name = &quot;blOrderService&quot;)                                                                   </span>
<span class="4242410752290390693" onmouseenter="enter('4242410752290390693');" onmouseout="out('4242410752290390693');" style="">  90     protected OrderService orderService;                                                                 </span>
<span  style="">  91                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  92     /**                                                                                                  </span>
<span class="-4826553869963905978" onmouseenter="enter('-4826553869963905978');" onmouseout="out('-4826553869963905978');" style=""><abbr title="  93      * This will force the domain to 127.0.0.1 which is useful to determine if the Google Analytics tag is sending">  93      * This will force the domain to 127.0.0.1 which is useful to determine if the Google Analytics tag iðŸ”µ</abbr></span>
<span class="4379972517565340413" onmouseenter="enter('4379972517565340413');" onmouseout="out('4379972517565340413');" style="">  94      * a request to Google                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  95      */                                                                                                  </span>
<span class="4765817096410164031" onmouseenter="enter('4765817096410164031');" onmouseout="out('4765817096410164031');" style="">  96     @Value(&quot;${googleAnalytics.testLocal}&quot;)                                                               </span>
<span class="-1900167704265329937" onmouseenter="enter('-1900167704265329937');" onmouseout="out('-1900167704265329937');" style="">  97     protected boolean testLocal = false;                                                                 </span>
<span  style="">  98                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  99     @Override                                                                                            </span>
<span class="190238665005496725" onmouseenter="enter('190238665005496725');" onmouseout="out('190238665005496725');" style=""> 100     public String getName() {                                                                            </span>
<span class="-8270913471972923893" onmouseenter="enter('-8270913471972923893');" onmouseout="out('-8270913471972923893');" style=""> 101         return &quot;google_universal_analytics&quot;;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102     }                                                                                                    </span>
<span  style=""> 103                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 104     @Override                                                                                            </span>
<span class="9191046360773473694" onmouseenter="enter('9191046360773473694');" onmouseout="out('9191046360773473694');" style=""> 105     public int getPrecedence() {                                                                         </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 106         return 0;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107     }                                                                                                    </span>
<span  style=""> 108                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 109     @Override                                                                                            </span>
<span class="4464809424342535940" onmouseenter="enter('4464809424342535940');" onmouseout="out('4464809424342535940');" style=""><abbr title=" 110     public BroadleafTemplateModel getReplacementModel(String tagName, Map&lt;String, String&gt; tagAttributes, BroadleafTemplateContext context) {"> 110     public BroadleafTemplateModel getReplacementModel(String tagName, Map&lt;String, String&gt; tagAttributes, ðŸ”µ</abbr></span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 111         StringBuffer sb = new StringBuffer();                                                            </span>
<span class="2880528239678716865" onmouseenter="enter('2880528239678716865');" onmouseout="out('2880528239678716865');" style=""> 112         Map&lt;String, String&gt; trackers = getTrackers();                                                    </span>
<span class="1433824051485786916" onmouseenter="enter('1433824051485786916');" onmouseout="out('1433824051485786916');" style=""> 113         if (MapUtils.isNotEmpty(trackers)) {                                                             </span>
<span class="-225159766305017924" onmouseenter="enter('-225159766305017924');" onmouseout="out('-225159766305017924');" style=""> 114             sb.append(&quot;(function(i,s,o,g,r,a,m){i[&#x27;GoogleAnalyticsObject&#x27;]=r;i[r]=i[r]||function(){&quot;);   </span>
<span class="-75534907468996798" onmouseenter="enter('-75534907468996798');" onmouseout="out('-75534907468996798');" style=""> 115             sb.append(&quot;(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),&quot;); </span>
<span class="787448617478028585" onmouseenter="enter('787448617478028585');" onmouseout="out('787448617478028585');" style=""> 116             sb.append(&quot;m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)&quot;);</span>
<span class="3709749594906836963" onmouseenter="enter('3709749594906836963');" onmouseout="out('3709749594906836963');" style=""> 117             sb.append(&quot;})(window,document,&#x27;script&#x27;,&#x27;//www.google-analytics.com/analytics.js&#x27;,&#x27;ga&#x27;);&quot;);   </span>
<span  style=""> 118                                                                                                          </span>
<span class="8350540313808247660" onmouseenter="enter('8350540313808247660');" onmouseout="out('8350540313808247660');" style=""> 119             String orderNumberExpression = tagAttributes.get(&quot;ordernumber&quot;);                             </span>
<span class="-4116557390625637530" onmouseenter="enter('-4116557390625637530');" onmouseout="out('-4116557390625637530');" style=""> 120             String orderNumber = null;                                                                   </span>
<span class="1554006189045169119" onmouseenter="enter('1554006189045169119');" onmouseout="out('1554006189045169119');" style=""> 121             if (orderNumberExpression != null) {                                                         </span>
<span class="-8521652288646315683" onmouseenter="enter('-8521652288646315683');" onmouseout="out('-8521652288646315683');" style=""> 122                 orderNumber = (String) context.parseExpression(orderNumberExpression);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123             }                                                                                            </span>
<span  style=""> 124                                                                                                          </span>
<span class="-3391477864870857752" onmouseenter="enter('-3391477864870857752');" onmouseout="out('-3391477864870857752');" style=""> 125             Order order = null;                                                                          </span>
<span class="3032325866360707625" onmouseenter="enter('3032325866360707625');" onmouseout="out('3032325866360707625');" style=""> 126             if (orderNumber != null) {                                                                   </span>
<span class="8749278739372980865" onmouseenter="enter('8749278739372980865');" onmouseout="out('8749278739372980865');" style=""> 127                 order = orderService.findOrderByOrderNumber(orderNumber);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128             }                                                                                            </span>
<span  style=""> 129                                                                                                          </span>
<span class="6811598938615422064" onmouseenter="enter('6811598938615422064');" onmouseout="out('6811598938615422064');" style=""> 130             for (Entry&lt;String, String&gt; tracker : trackers.entrySet()) {                                  </span>
<span class="-6082993912017886430" onmouseenter="enter('-6082993912017886430');" onmouseout="out('-6082993912017886430');" style=""> 131                 String trackerName = tracker.getKey();                                                   </span>
<span class="-3120827425834628721" onmouseenter="enter('-3120827425834628721');" onmouseout="out('-3120827425834628721');" style=""> 132                 String trackerPrefix = &quot;&quot;;                                                               </span>
<span class="7019647018974662667" onmouseenter="enter('7019647018974662667');" onmouseout="out('7019647018974662667');" style=""> 133                 String id = tracker.getValue();                                                          </span>
<span class="3011142644875223402" onmouseenter="enter('3011142644875223402');" onmouseout="out('3011142644875223402');" style=""> 134                 sb.append(&quot;ga(&#x27;create&#x27;, &#x27;&quot; + id + &quot;&#x27;, &#x27;auto&#x27;, {&quot;);                                       </span>
<span  style=""> 135                                                                                                          </span>
<span class="3839128902332571680" onmouseenter="enter('3839128902332571680');" onmouseout="out('3839128902332571680');" style=""> 136                 if (!&quot;webProperty&quot;.equals(trackerName)) {                                                </span>
<span class="-7426441914050405472" onmouseenter="enter('-7426441914050405472');" onmouseout="out('-7426441914050405472');" style=""> 137                     trackerPrefix = trackerName + &quot;.&quot;;                                                   </span>
<span class="-3973100567386912971" onmouseenter="enter('-3973100567386912971');" onmouseout="out('-3973100567386912971');" style=""> 138                     sb.append(&quot;&#x27;name&#x27;: &#x27;&quot; + trackerName + &quot;&#x27;&quot;);                                          </span>
<span class="3293478056291787725" onmouseenter="enter('3293478056291787725');" onmouseout="out('3293478056291787725');" style=""> 139                     if (testLocal) {                                                                     </span>
<span class="6725018595534739120" onmouseenter="enter('6725018595534739120');" onmouseout="out('6725018595534739120');" style=""> 140                         sb.append(&quot;,&quot;);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142                 }                                                                                        </span>
<span class="3293478056291787725" onmouseenter="enter('3293478056291787725');" onmouseout="out('3293478056291787725');" style=""> 143                 if (testLocal) {                                                                         </span>
<span class="-3353602519532140774" onmouseenter="enter('-3353602519532140774');" onmouseout="out('-3353602519532140774');" style=""> 144                     sb.append(&quot;&#x27;cookieDomain&#x27;: &#x27;none&#x27;&quot;);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145                 }                                                                                        </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 146                 sb.append(&quot;});&quot;);                                                                        </span>
<span  style=""> 147                                                                                                          </span>
<span class="-7418475527567976254" onmouseenter="enter('-7418475527567976254');" onmouseout="out('-7418475527567976254');" style=""> 148                 if (&quot;webProperty&quot;.equals(trackerName)) {                                                 </span>
<span class="4360254575720880810" onmouseenter="enter('4360254575720880810');" onmouseout="out('4360254575720880810');" style=""><abbr title=" 149                     HttpServletRequest request = BroadleafRequestContext.getBroadleafRequestContext().getRequest();"> 149                     HttpServletRequest request = BroadleafRequestContext.getBroadleafRequestContext().getðŸ”µ</abbr></span>
<span class="-5752363771942989481" onmouseenter="enter('-5752363771942989481');" onmouseout="out('-5752363771942989481');" style=""> 150                     if (request != null) {                                                               </span>
<span class="3853533472488230976" onmouseenter="enter('3853533472488230976');" onmouseout="out('3853533472488230976');" style=""><abbr title=" 151                         Map&lt;String, String&gt; setValuesMap = (Map&lt;String, String&gt;) request.getAttribute(&quot;blGAValuesMap&quot;);"> 151                         Map&lt;String, String&gt; setValuesMap = (Map&lt;String, String&gt;) request.getAttribute(&quot;blðŸ”µ</abbr></span>
<span class="-4910410964255568960" onmouseenter="enter('-4910410964255568960');" onmouseout="out('-4910410964255568960');" style=""> 152                         if (setValuesMap != null) {                                                      </span>
<span class="1796428880304861730" onmouseenter="enter('1796428880304861730');" onmouseout="out('1796428880304861730');" style=""> 153                             for (Map.Entry&lt;String, String&gt; entry : setValuesMap.entrySet()) {            </span>
<span class="6095212434965084893" onmouseenter="enter('6095212434965084893');" onmouseout="out('6095212434965084893');" style=""><abbr title=" 154                                 sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;set&#x27;,&quot;).append(entry.getKey()).append(&quot;,&quot;)"> 154                                 sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;set&#x27;,&quot;).append(entry.getKey()).appendðŸ”µ</abbr></span>
<span class="4491228529456646674" onmouseenter="enter('4491228529456646674');" onmouseout="out('4491228529456646674');" style=""> 155                                         .append(entry.getValue()).append(&quot;);&quot;);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159                 }                                                                                        </span>
<span  style=""> 160                                                                                                          </span>
<span class="-4889417558387717970" onmouseenter="enter('-4889417558387717970');" onmouseout="out('-4889417558387717970');" style=""> 161                 sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;send&#x27;, &#x27;pageview&#x27;);&quot;);                               </span>
<span  style=""> 162                                                                                                          </span>
<span class="-1815529951487720795" onmouseenter="enter('-1815529951487720795');" onmouseout="out('-1815529951487720795');" style=""> 163                 if (isIncludeLinkAttribution()) {                                                        </span>
<span class="8560972280490216573" onmouseenter="enter('8560972280490216573');" onmouseout="out('8560972280490216573');" style=""> 164                     sb.append(getLinkAttributionJs(trackerPrefix));                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165                 }                                                                                        </span>
<span class="-7131894736179401387" onmouseenter="enter('-7131894736179401387');" onmouseout="out('-7131894736179401387');" style=""> 166                 if (isIncludeDisplayAdvertising()) {                                                     </span>
<span class="-8416140583577512322" onmouseenter="enter('-8416140583577512322');" onmouseout="out('-8416140583577512322');" style=""> 167                     sb.append(getDisplayAdvertisingJs(trackerPrefix));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168                 }                                                                                        </span>
<span  style=""> 169                                                                                                          </span>
<span class="3398338372153747583" onmouseenter="enter('3398338372153747583');" onmouseout="out('3398338372153747583');" style=""> 170                 if (order != null) {                                                                     </span>
<span class="-6179801228362718003" onmouseenter="enter('-6179801228362718003');" onmouseout="out('-6179801228362718003');" style=""> 171                     sb.append(getTransactionJs(order, trackerPrefix));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173             }                                                                                            </span>
<span  style=""> 174                                                                                                          </span>
<span class="-8412714651221999608" onmouseenter="enter('-8412714651221999608');" onmouseout="out('-8412714651221999608');" style=""> 175             // Add contentNode to the document                                                           </span>
<span class="2586931587804785526" onmouseenter="enter('2586931587804785526');" onmouseout="out('2586931587804785526');" style=""> 176             BroadleafTemplateModel model = context.createModel();                                        </span>
<span class="5956668170328902082" onmouseenter="enter('5956668170328902082');" onmouseout="out('5956668170328902082');" style=""> 177             BroadleafTemplateNonVoidElement scriptTag = context.createNonVoidElement(&quot;script&quot;);          </span>
<span class="-4659749375667028744" onmouseenter="enter('-4659749375667028744');" onmouseout="out('-4659749375667028744');" style=""> 178             BroadleafTemplateElement script = context.createTextElement(sb.toString());                  </span>
<span class="247228039845397848" onmouseenter="enter('247228039845397848');" onmouseout="out('247228039845397848');" style=""> 179             scriptTag.addChild(script);                                                                  </span>
<span class="7450786220544571726" onmouseenter="enter('7450786220544571726');" onmouseout="out('7450786220544571726');" style=""> 180             model.addElement(scriptTag);                                                                 </span>
<span class="1327412617440986435" onmouseenter="enter('1327412617440986435');" onmouseout="out('1327412617440986435');" style=""> 181             return model;                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 182         } else {                                                                                         </span>
<span class="2035563191225573078" onmouseenter="enter('2035563191225573078');" onmouseout="out('2035563191225573078');" style=""><abbr title=" 183             LOG.warn(&quot;No trackers were found, not outputting Google Analytics script. Set the googleAnalytics.webPropertyId&quot;"> 183             LOG.warn(&quot;No trackers were found, not outputting Google Analytics script. Set the googleAnalyðŸ”µ</abbr></span>
<span class="-5815171902766930389" onmouseenter="enter('-5815171902766930389');" onmouseout="out('-5815171902766930389');" style=""><abbr title=" 184                     + &quot; and/or the googleAnalytics.masterWebPropertyId system properties to output Google Analytics&quot;);"> 184                     + &quot; and/or the googleAnalytics.masterWebPropertyId system properties to output GoogleðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 186         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187     }                                                                                                    </span>
<span  style=""> 188                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 189     /**                                                                                                  </span>
<span class="4526085554743721537" onmouseenter="enter('4526085554743721537');" onmouseout="out('4526085554743721537');" style=""> 190      * Grabs a map of trackers keyed by the tracker name with the analytics ID as the value              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 191      */                                                                                                  </span>
<span class="-372605794037605079" onmouseenter="enter('-372605794037605079');" onmouseout="out('-372605794037605079');" style=""> 192     protected Map&lt;String, String&gt; getTrackers() {                                                        </span>
<span class="-307639934143605930" onmouseenter="enter('-307639934143605930');" onmouseout="out('-307639934143605930');" style=""> 193         Map&lt;String, String&gt; trackers = new HashMap&lt;&gt;();                                                  </span>
<span class="-7547677911791595799" onmouseenter="enter('-7547677911791595799');" onmouseout="out('-7547677911791595799');" style=""> 194         if (shouldShowMasterTracker()) {                                                                 </span>
<span class="7613356034540080851" onmouseenter="enter('7613356034540080851');" onmouseout="out('7613356034540080851');" style=""> 195             trackers.put(&quot;master&quot;, getMasterWebPropertyId());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196         }                                                                                                </span>
<span class="7457001157732167405" onmouseenter="enter('7457001157732167405');" onmouseout="out('7457001157732167405');" style=""> 197         if (StringUtils.isNotBlank(getWebPropertyId())) {                                                </span>
<span class="-1680205878775740489" onmouseenter="enter('-1680205878775740489');" onmouseout="out('-1680205878775740489');" style=""> 198             trackers.put(&quot;webProperty&quot;, getWebPropertyId());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199         }                                                                                                </span>
<span  style=""> 200                                                                                                          </span>
<span class="7808054229367271940" onmouseenter="enter('7808054229367271940');" onmouseout="out('7808054229367271940');" style=""> 201         return trackers;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202     }                                                                                                    </span>
<span  style=""> 203                                                                                                          </span>
<span class="7201288543731878163" onmouseenter="enter('7201288543731878163');" onmouseout="out('7201288543731878163');" style=""> 204     protected boolean shouldShowMasterTracker() {                                                        </span>
<span class="5354981909841949210" onmouseenter="enter('5354981909841949210');" onmouseout="out('5354981909841949210');" style=""> 205         String masterWebPropertyId = getMasterWebPropertyId();                                           </span>
<span class="-9816468277340784" onmouseenter="enter('-9816468277340784');" onmouseout="out('-9816468277340784');" style=""><abbr title=" 206         return (StringUtils.isNotBlank(masterWebPropertyId) &amp;&amp; (!&quot;UA-XXXXXXX-X&quot;.equals(masterWebPropertyId)));"> 206         return (StringUtils.isNotBlank(masterWebPropertyId) &amp;&amp; (!&quot;UA-XXXXXXX-X&quot;.equals(masterWebPropertyIðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207     }                                                                                                    </span>
<span  style=""> 208                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 209     /**                                                                                                  </span>
<span class="4669840319029639930" onmouseenter="enter('4669840319029639930');" onmouseout="out('4669840319029639930');" style=""> 210      * Builds the linke attribution Javascript                                                           </span>
<span class="8768361991211291337" onmouseenter="enter('8768361991211291337');" onmouseout="out('8768361991211291337');" style=""> 211      * @param tracker the name of the tracker that is using the link attribution                         </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 212      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 213      */                                                                                                  </span>
<span class="-4727062141745445312" onmouseenter="enter('-4727062141745445312');" onmouseout="out('-4727062141745445312');" style=""> 214     protected String getLinkAttributionJs(String trackerPrefix) {                                        </span>
<span class="4641935953841803222" onmouseenter="enter('4641935953841803222');" onmouseout="out('4641935953841803222');" style=""> 215         return &quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;linkid&#x27;, &#x27;linkid.js&#x27;);&quot;;                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216     }                                                                                                    </span>
<span  style=""> 217                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 218     /**                                                                                                  </span>
<span class="-1766163605340550882" onmouseenter="enter('-1766163605340550882');" onmouseout="out('-1766163605340550882');" style=""> 219      * Builds the display advertising Javascript for the given tracker                                   </span>
<span class="7955661006334297359" onmouseenter="enter('7955661006334297359');" onmouseout="out('7955661006334297359');" style=""> 220      * @param tracker                                                                                    </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 221      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 222      */                                                                                                  </span>
<span class="6227360005040256098" onmouseenter="enter('6227360005040256098');" onmouseout="out('6227360005040256098');" style=""> 223     protected String getDisplayAdvertisingJs(String trackerPrefix) {                                     </span>
<span class="3528222762911871195" onmouseenter="enter('3528222762911871195');" onmouseout="out('3528222762911871195');" style=""> 224         return &quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;displayfeatures&#x27;);&quot;;                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225     }                                                                                                    </span>
<span  style=""> 226                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 227     /**                                                                                                  </span>
<span class="6584247125825541487" onmouseenter="enter('6584247125825541487');" onmouseout="out('6584247125825541487');" style=""><abbr title=" 228      * Builds the transaction analytics for the given tracker name. Invokes {@link #getItemJs(Order, String) for each item"> 228      * Builds the transaction analytics for the given tracker name. Invokes {@link #getItemJs(Order, StriðŸ”µ</abbr></span>
<span class="-1936212608501453784" onmouseenter="enter('-1936212608501453784');" onmouseout="out('-1936212608501453784');" style=""> 229      * in the given &lt;b&gt;order&lt;/b&gt;.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 230      */                                                                                                  </span>
<span class="9179487558003409237" onmouseenter="enter('9179487558003409237');" onmouseout="out('9179487558003409237');" style=""> 231     protected String getTransactionJs(Order order, String trackerPrefix) {                               </span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 232         StringBuffer sb = new StringBuffer();                                                            </span>
<span class="1809594812594725377" onmouseenter="enter('1809594812594725377');" onmouseout="out('1809594812594725377');" style=""> 233         sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;ecommerce&#x27;, &#x27;ecommerce.js&#x27;);&quot;);                   </span>
<span  style=""> 234                                                                                                          </span>
<span class="-5012537295569901065" onmouseenter="enter('-5012537295569901065');" onmouseout="out('-5012537295569901065');" style=""> 235         sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:addTransaction&#x27;, {&quot;);                              </span>
<span class="3802939893371272400" onmouseenter="enter('3802939893371272400');" onmouseout="out('3802939893371272400');" style=""> 236         sb.append(&quot;&#x27;id&#x27;: &#x27;&quot; + order.getOrderNumber() + &quot;&#x27;&quot;);                                             </span>
<span class="-4495351553520504059" onmouseenter="enter('-4495351553520504059');" onmouseout="out('-4495351553520504059');" style=""> 237         if (StringUtils.isNotBlank(getAffiliation())) {                                                  </span>
<span class="2598773061427907348" onmouseenter="enter('2598773061427907348');" onmouseout="out('2598773061427907348');" style=""> 238             sb.append(&quot;,&#x27;affiliation&#x27;: &#x27;&quot; + getAffiliation() + &quot;&#x27;&quot;);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239         }                                                                                                </span>
<span class="-1600458020637022538" onmouseenter="enter('-1600458020637022538');" onmouseout="out('-1600458020637022538');" style=""> 240         sb.append(&quot;,&#x27;revenue&#x27;: &#x27;&quot; + order.getTotal() + &quot;&#x27;&quot;);                                             </span>
<span class="-7105820260454958730" onmouseenter="enter('-7105820260454958730');" onmouseout="out('-7105820260454958730');" style=""> 241         sb.append(&quot;,&#x27;shipping&#x27;:&#x27;&quot; + order.getTotalShipping() + &quot;&#x27;&quot;);                                     </span>
<span class="4743629374093034580" onmouseenter="enter('4743629374093034580');" onmouseout="out('4743629374093034580');" style=""> 242         sb.append(&quot;,&#x27;tax&#x27;: &#x27;&quot; + order.getTotalTax() + &quot;&#x27;&quot;);                                              </span>
<span  style=""> 243                                                                                                          </span>
<span class="3530102425606482988" onmouseenter="enter('3530102425606482988');" onmouseout="out('3530102425606482988');" style=""> 244         if (order.getCurrency() != null) {                                                               </span>
<span class="2532172931589873998" onmouseenter="enter('2532172931589873998');" onmouseout="out('2532172931589873998');" style=""> 245             sb.append(&quot;,&#x27;currency&#x27;: &#x27;&quot; + order.getCurrency().getCurrencyCode() + &quot;&#x27;&quot;);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246         }                                                                                                </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 247         sb.append(&quot;});&quot;);                                                                                </span>
<span  style=""> 248                                                                                                          </span>
<span class="-7953667423558098854" onmouseenter="enter('-7953667423558098854');" onmouseout="out('-7953667423558098854');" style=""> 249         sb.append(getItemJs(order, trackerPrefix));                                                      </span>
<span  style=""> 250                                                                                                          </span>
<span class="2925677874169908961" onmouseenter="enter('2925677874169908961');" onmouseout="out('2925677874169908961');" style=""> 251         sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:send&#x27;);&quot;);                                         </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 252         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253     }                                                                                                    </span>
<span  style=""> 254                                                                                                          </span>
<span class="5980134894234571756" onmouseenter="enter('5980134894234571756');" onmouseout="out('5980134894234571756');" style=""> 255     protected String getItemJs(Order order, String trackerPrefix) {                                      </span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 256         StringBuffer sb = new StringBuffer();                                                            </span>
<span class="1072921294238695944" onmouseenter="enter('1072921294238695944');" onmouseout="out('1072921294238695944');" style=""> 257         for (FulfillmentGroup fulfillmentGroup : order.getFulfillmentGroups()) {                         </span>
<span class="7256397867735119446" onmouseenter="enter('7256397867735119446');" onmouseout="out('7256397867735119446');" style=""><abbr title=" 258             for (FulfillmentGroupItem fulfillmentGroupItem : fulfillmentGroup.getFulfillmentGroupItems()) {"> 258             for (FulfillmentGroupItem fulfillmentGroupItem : fulfillmentGroup.getFulfillmentGroupItems())ðŸ”µ</abbr></span>
<span class="6727205496790990336" onmouseenter="enter('6727205496790990336');" onmouseout="out('6727205496790990336');" style=""> 259                 OrderItem orderItem = fulfillmentGroupItem.getOrderItem();                               </span>
<span  style=""> 260                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 261 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-7078716540017248808" onmouseenter="enter('-7078716540017248808');" onmouseout="out('-7078716540017248808');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 262                 if (SkuAccessor.class.isAssignableFrom(orderItem.getClass())) {                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 263 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-4497171920864475683" onmouseenter="enter('-4497171920864475683');" onmouseout="out('-4497171920864475683');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264                 Sku sku = ((SkuAccessor) orderItem).getSku();                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 266 =======                                                                                                  </span>
<span class="-1726294213977632923" onmouseenter="enter('-1726294213977632923');" onmouseout="out('-1726294213977632923');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267                 if (orderItem instanceof DiscreteOrderItem) {                                            </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 268 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-4497171920864475683" onmouseenter="enter('-4497171920864475683');" onmouseout="out('-4497171920864475683');" style=""> 269                     Sku sku = ((SkuAccessor) orderItem).getSku();                                        </span>
<span  style=""> 270                                                                                                          </span>
<span class="-8613458593272541119" onmouseenter="enter('-8613458593272541119');" onmouseout="out('-8613458593272541119');" style=""> 271                     sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:addItem&#x27;, {&quot;);                         </span>
<span class="3802939893371272400" onmouseenter="enter('3802939893371272400');" onmouseout="out('3802939893371272400');" style=""> 272                     sb.append(&quot;&#x27;id&#x27;: &#x27;&quot; + order.getOrderNumber() + &quot;&#x27;&quot;);                                 </span>
<span class="-887663243915190383" onmouseenter="enter('-887663243915190383');" onmouseout="out('-887663243915190383');" style=""> 273                     sb.append(&quot;,&#x27;name&#x27;: &#x27;&quot; + sku.getName() + &quot;&#x27;&quot;);                                       </span>
<span class="-7742482896330545050" onmouseenter="enter('-7742482896330545050');" onmouseout="out('-7742482896330545050');" style=""> 274                     sb.append(&quot;,&#x27;sku&#x27;: &#x27;&quot; + sku.getId() + &quot;&#x27;&quot;);                                          </span>
<span class="-1605838225351785854" onmouseenter="enter('-1605838225351785854');" onmouseout="out('-1605838225351785854');" style=""> 275                     sb.append(&quot;,&#x27;category&#x27;: &#x27;&quot; + getVariation(orderItem) + &quot;&#x27;&quot;);                         </span>
<span class="-4039856411666157290" onmouseenter="enter('-4039856411666157290');" onmouseout="out('-4039856411666157290');" style=""> 276                     sb.append(&quot;,&#x27;price&#x27;: &#x27;&quot; + orderItem.getAveragePrice() + &quot;&#x27;&quot;);                        </span>
<span class="-6864347081607696224" onmouseenter="enter('-6864347081607696224');" onmouseout="out('-6864347081607696224');" style=""> 277                     sb.append(&quot;,&#x27;quantity&#x27;: &#x27;&quot; + orderItem.getQuantity() + &quot;&#x27;&quot;);                         </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 278                     sb.append(&quot;});&quot;);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 282         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283     }                                                                                                    </span>
<span  style=""> 284                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 285     /**                                                                                                  </span>
<span class="6923647488705566386" onmouseenter="enter('6923647488705566386');" onmouseout="out('6923647488705566386');" style=""> 286      * Returns the product option values separated by a space if they are                                </span>
<span class="1487274611034840884" onmouseenter="enter('1487274611034840884');" onmouseout="out('1487274611034840884');" style=""> 287      * relevant for the item, or the product category if no options are available                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 288      *                                                                                                   </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 289      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 290      */                                                                                                  </span>
<span class="5846271843428503958" onmouseenter="enter('5846271843428503958');" onmouseout="out('5846271843428503958');" style=""> 291     protected String getVariation(OrderItem item) {                                                      </span>
<span class="-1900425779688459231" onmouseenter="enter('-1900425779688459231');" onmouseout="out('-1900425779688459231');" style=""> 292         if (MapUtils.isEmpty(item.getOrderItemAttributes())) {                                           </span>
<span class="-2607232819614252500" onmouseenter="enter('-2607232819614252500');" onmouseout="out('-2607232819614252500');" style=""> 293             return item.getCategory() == null ? &quot;&quot; : item.getCategory().getName();                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294         }                                                                                                </span>
<span  style=""> 295                                                                                                          </span>
<span class="3636026723966887885" onmouseenter="enter('3636026723966887885');" onmouseout="out('3636026723966887885');" style=""> 296         //use product options instead                                                                    </span>
<span class="-3623621045223349277" onmouseenter="enter('-3623621045223349277');" onmouseout="out('-3623621045223349277');" style=""> 297         String result = &quot;&quot;;                                                                              </span>
<span class="-3052053556715064621" onmouseenter="enter('-3052053556715064621');" onmouseout="out('-3052053556715064621');" style=""> 298         for (Map.Entry&lt;String, OrderItemAttribute&gt; entry : item.getOrderItemAttributes().entrySet()) {   </span>
<span class="-7464419131479451077" onmouseenter="enter('-7464419131479451077');" onmouseout="out('-7464419131479451077');" style=""> 299             result += entry.getValue().getValue() + &quot; &quot;;                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300         }                                                                                                </span>
<span  style=""> 301                                                                                                          </span>
<span class="-6864210689922892589" onmouseenter="enter('-6864210689922892589');" onmouseout="out('-6864210689922892589');" style=""> 302         //the result has a space at the end, ensure that is stripped out                                 </span>
<span class="6125747973705988751" onmouseenter="enter('6125747973705988751');" onmouseout="out('6125747973705988751');" style=""> 303         return result.substring(0, result.length() - 1);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304     }                                                                                                    </span>
<span  style=""> 305                                                                                                          </span>
<span class="7688964624751652763" onmouseenter="enter('7688964624751652763');" onmouseout="out('7688964624751652763');" style=""> 306     public String getMasterWebPropertyId() {                                                             </span>
<span class="8804391615898929387" onmouseenter="enter('8804391615898929387');" onmouseout="out('8804391615898929387');" style=""> 307         return masterWebPropertyId;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308     }                                                                                                    </span>
<span  style=""> 309                                                                                                          </span>
<span class="-2978295786667990463" onmouseenter="enter('-2978295786667990463');" onmouseout="out('-2978295786667990463');" style=""> 310     public void setMasterWebPropertyId(String masterWebPropertyId) {                                     </span>
<span class="7918620816210150178" onmouseenter="enter('7918620816210150178');" onmouseout="out('7918620816210150178');" style=""> 311         this.masterWebPropertyId = masterWebPropertyId;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312     }                                                                                                    </span>
<span  style=""> 313                                                                                                          </span>
<span class="6671223003008841723" onmouseenter="enter('6671223003008841723');" onmouseout="out('6671223003008841723');" style=""> 314     public String getAffiliation() {                                                                     </span>
<span class="7807255797153975973" onmouseenter="enter('7807255797153975973');" onmouseout="out('7807255797153975973');" style=""> 315         return BLCSystemProperty.resolveSystemProperty(&quot;googleAnalytics.affiliation&quot;);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316     }                                                                                                    </span>
<span  style=""> 317                                                                                                          </span>
<span class="8203350595237245612" onmouseenter="enter('8203350595237245612');" onmouseout="out('8203350595237245612');" style=""> 318     public String getWebPropertyId() {                                                                   </span>
<span class="850776087520408196" onmouseenter="enter('850776087520408196');" onmouseout="out('850776087520408196');" style=""> 319         return BLCSystemProperty.resolveSystemProperty(&quot;googleAnalytics.webPropertyId&quot;);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320     }                                                                                                    </span>
<span  style=""> 321                                                                                                          </span>
<span class="825053779558488694" onmouseenter="enter('825053779558488694');" onmouseout="out('825053779558488694');" style=""> 322     public boolean isIncludeLinkAttribution() {                                                          </span>
<span class="5065521424805687131" onmouseenter="enter('5065521424805687131');" onmouseout="out('5065521424805687131');" style=""><abbr title=" 323         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableLinkAttribution&quot;, true);"> 323         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableLinkAttribution&quot;, trðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324     }                                                                                                    </span>
<span  style=""> 325                                                                                                          </span>
<span class="4570506314302342970" onmouseenter="enter('4570506314302342970');" onmouseout="out('4570506314302342970');" style=""> 326     public boolean isIncludeDisplayAdvertising() {                                                       </span>
<span class="-1788412357185885205" onmouseenter="enter('-1788412357185885205');" onmouseout="out('-1788412357185885205');" style=""><abbr title=" 327         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableDisplayAdvertising&quot;, false);"> 327         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableDisplayAdvertising&quot;,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328     }                                                                                                    </span>
<span  style=""> 329                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="6211491254187717485" onmouseenter="enter('6211491254187717485');" onmouseout="out('6211491254187717485');" style="">   3  * BroadleafCommerce Framework Web                                                                       </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-579043521764695224" onmouseenter="enter('-579043521764695224');" onmouseout="out('-579043521764695224');" style="">  18 package org.broadleafcommerce.core.web.processor;                                                        </span>
<span  style="">  19                                                                                                          </span>
<span class="4020017653195254006" onmouseenter="enter('4020017653195254006');" onmouseout="out('4020017653195254006');" style="">  20 import org.apache.commons.collections.MapUtils;                                                          </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  24 import org.broadleafcommerce.common.util.BLCSystemProperty;                                              </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  25 import org.broadleafcommerce.common.web.BroadleafRequestContext;                                         </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  26 import org.broadleafcommerce.core.catalog.domain.Sku;                                                    </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  27 import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                        </span>
<span class="-6302349778747925467" onmouseenter="enter('-6302349778747925467');" onmouseout="out('-6302349778747925467');" style="">  28 import org.broadleafcommerce.core.order.domain.FulfillmentGroup;                                         </span>
<span class="-7855842771160128779" onmouseenter="enter('-7855842771160128779');" onmouseout="out('-7855842771160128779');" style="">  29 import org.broadleafcommerce.core.order.domain.FulfillmentGroupItem;                                     </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  30 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  31 import org.broadleafcommerce.core.order.domain.OrderItem;                                                </span>
<span class="2123683748922877231" onmouseenter="enter('2123683748922877231');" onmouseout="out('2123683748922877231');" style="">  32 import org.broadleafcommerce.core.order.domain.OrderItemAttribute;                                       </span>
<span class="3047856393988054011" onmouseenter="enter('3047856393988054011');" onmouseout="out('3047856393988054011');" style="">  33 import org.broadleafcommerce.core.order.domain.SkuAccessor;                                              </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  34 import org.broadleafcommerce.core.order.service.OrderService;                                            </span>
<span class="205237632867733562" onmouseenter="enter('205237632867733562');" onmouseout="out('205237632867733562');" style="">  35 import org.broadleafcommerce.presentation.condition.ConditionalOnTemplating;                             </span>
<span class="5380655934740542528" onmouseenter="enter('5380655934740542528');" onmouseout="out('5380655934740542528');" style="">  36 import org.broadleafcommerce.presentation.dialect.AbstractBroadleafTagReplacementProcessor;              </span>
<span class="7486567025810647827" onmouseenter="enter('7486567025810647827');" onmouseout="out('7486567025810647827');" style="">  37 import org.broadleafcommerce.presentation.model.BroadleafTemplateContext;                                </span>
<span class="-2001850062613906669" onmouseenter="enter('-2001850062613906669');" onmouseout="out('-2001850062613906669');" style="">  38 import org.broadleafcommerce.presentation.model.BroadleafTemplateElement;                                </span>
<span class="8100767512529469135" onmouseenter="enter('8100767512529469135');" onmouseout="out('8100767512529469135');" style="">  39 import org.broadleafcommerce.presentation.model.BroadleafTemplateModel;                                  </span>
<span class="-6189886993649876021" onmouseenter="enter('-6189886993649876021');" onmouseout="out('-6189886993649876021');" style="">  40 import org.broadleafcommerce.presentation.model.BroadleafTemplateNonVoidElement;                         </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  41 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  42 import org.springframework.stereotype.Component;                                                         </span>
<span  style="">  43                                                                                                          </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  44 import java.util.HashMap;                                                                                </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  45 import java.util.Map;                                                                                    </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  46 import java.util.Map.Entry;                                                                              </span>
<span  style="">  47                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  48 import javax.annotation.Resource;                                                                        </span>
<span class="-2972028083581866805" onmouseenter="enter('-2972028083581866805');" onmouseout="out('-2972028083581866805');" style="">  49 import javax.servlet.http.HttpServletRequest;                                                            </span>
<span  style="">  50                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  51 /**                                                                                                      </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  52  * &lt;p&gt;                                                                                                   </span>
<span class="-143385427104872854" onmouseenter="enter('-143385427104872854');" onmouseout="out('-143385427104872854');" style=""><abbr title="  53  * Takes advantage of the new-stype analytics.js from Google Analytics rather than the deprected ga.js. This also">  53  * Takes advantage of the new-stype analytics.js from Google Analytics rather than the deprected ga.js. TðŸ”µ</abbr></span>
<span class="-8898438840079886526" onmouseenter="enter('-8898438840079886526');" onmouseout="out('-8898438840079886526');" style=""><abbr title="  54  * supports a pre-processed &lt;b&gt;orderNumber&lt;/b&gt; attribute that can be null, suitable for things like the order confirmation">  54  * supports a pre-processed &lt;b&gt;orderNumber&lt;/b&gt; attribute that can be null, suitable for things like the oðŸ”µ</abbr></span>
<span class="-7917044275166249545" onmouseenter="enter('-7917044275166249545');" onmouseout="out('-7917044275166249545');" style="">  55  * page to send e-commerce transactions. Example usage:                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  56  *                                                                                                       </span>
<span class="-661354662451427256" onmouseenter="enter('-661354662451427256');" onmouseout="out('-661354662451427256');" style="">  57  * &lt;pre&gt;                                                                                                 </span>
<span class="-7906919746321802108" onmouseenter="enter('-7906919746321802108');" onmouseout="out('-7906919746321802108');" style="">  58  * &amp;lt;google_universal_analytics ordernumber=&quot;${order?.orderNumber&quot; /&amp;gt;                               </span>
<span class="2390307265644686" onmouseenter="enter('2390307265644686');" onmouseout="out('2390307265644686');" style="">  59  * &lt;/pre&gt;                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  60  *                                                                                                       </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  61  * &lt;p&gt;                                                                                                   </span>
<span class="8606412176857267386" onmouseenter="enter('8606412176857267386');" onmouseout="out('8606412176857267386');" style="">  62  * This processor also supports:                                                                         </span>
<span class="2717555647352622731" onmouseenter="enter('2717555647352622731');" onmouseout="out('2717555647352622731');" style="">  63  * &lt;ul&gt;                                                                                                  </span>
<span class="-8530737739149477803" onmouseenter="enter('-8530737739149477803');" onmouseout="out('-8530737739149477803');" style=""><abbr title="  64  *  &lt;li&gt;Multiple trackers (extensible via {@link #getTrackers()} or by setting the {@code googleAnalytics.masterWebPropertyId}">  64  *  &lt;li&gt;Multiple trackers (extensible via {@link #getTrackers()} or by setting the {@code googleAnalyticsðŸ”µ</abbr></span>
<span class="6265505146874472773" onmouseenter="enter('6265505146874472773');" onmouseout="out('6265505146874472773');" style="">  65  *      and {@code googleAnalytics.webPropertyId})&lt;/li&gt;                                                  </span>
<span class="-6827384770903327510" onmouseenter="enter('-6827384770903327510');" onmouseout="out('-6827384770903327510');" style="">  66  *  &lt;li&gt;Affiliates for e-commerce ({@ googleAnalytics.affiliation property})&lt;/li&gt;                        </span>
<span class="7100814537211017894" onmouseenter="enter('7100814537211017894');" onmouseout="out('7100814537211017894');" style=""><abbr title="  67  *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/2558867?hl=en&amp;utm_id=ad&quot;&gt;Link attribution&lt;/a&gt;">  67  *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/2558867?hl=en&amp;utm_id=ad&quot;&gt;Link attribution&lt;/aðŸ”µ</abbr></span>
<span class="4406549444147281940" onmouseenter="enter('4406549444147281940');" onmouseout="out('4406549444147281940');" style="">  68  *      ({@code googleAnalytics.enableLinkAttribution} system property, default {@code true})&lt;/li&gt;       </span>
<span class="-684988223968504417" onmouseenter="enter('-684988223968504417');" onmouseout="out('-684988223968504417');" style="">  69  *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/3450482&quot;&gt;Display Advertising&lt;/a&gt;            </span>
<span class="7299106057661310467" onmouseenter="enter('7299106057661310467');" onmouseout="out('7299106057661310467');" style="">  70  *      ({@code googleAnalytics.enableDisplayAdvertising} system property, default {@code false})&lt;/li&gt;   </span>
<span class="599475583152278076" onmouseenter="enter('599475583152278076');" onmouseout="out('599475583152278076');" style="">  71  * &lt;/ul&gt;                                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  72  *                                                                                                       </span>
<span class="630288204851723761" onmouseenter="enter('630288204851723761');" onmouseout="out('630288204851723761');" style=""><abbr title="  73  * @param ordernumber the order number to look up for ecommerce tracking, such as on the confirmation page">  73  * @param ordernumber the order number to look up for ecommerce tracking, such as on the confirmation pagðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  74  *                                                                                                       </span>
<span class="2670632328160232809" onmouseenter="enter('2670632328160232809');" onmouseout="out('2670632328160232809');" style="">  75  * @author Phillip Verheyden (phillipuniverse)                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  76  */                                                                                                      </span>
<span class="-7627801935997636319" onmouseenter="enter('-7627801935997636319');" onmouseout="out('-7627801935997636319');" style="">  77 @Component(&quot;blGoogleUniversalAnalyticsProcessor&quot;)                                                        </span>
<span class="7070618034916085721" onmouseenter="enter('7070618034916085721');" onmouseout="out('7070618034916085721');" style="">  78 @ConditionalOnTemplating                                                                                 </span>
<span class="-2399886873569081592" onmouseenter="enter('-2399886873569081592');" onmouseout="out('-2399886873569081592');" style="">  79 public class GoogleUniversalAnalyticsProcessor extends AbstractBroadleafTagReplacementProcessor {        </span>
<span  style="">  80                                                                                                          </span>
<span class="4721694570459087610" onmouseenter="enter('4721694570459087610');" onmouseout="out('4721694570459087610');" style="">  81     private static final Log LOG = LogFactory.getLog(GoogleUniversalAnalyticsProcessor.class);           </span>
<span  style="">  82                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  83     /**                                                                                                  </span>
<span class="5978956812126798070" onmouseenter="enter('5978956812126798070');" onmouseout="out('5978956812126798070');" style=""><abbr title="  84      * Global value, intentionally only retrieved as a file property NOT via the system properties service">  84      * Global value, intentionally only retrieved as a file property NOT via the system properties servicðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  85      */                                                                                                  </span>
<span class="2486332857350127859" onmouseenter="enter('2486332857350127859');" onmouseout="out('2486332857350127859');" style="">  86     @Value(&quot;${googleAnalytics.masterWebPropertyId}&quot;)                                                     </span>
<span class="8766018855843754021" onmouseenter="enter('8766018855843754021');" onmouseout="out('8766018855843754021');" style="">  87     protected String masterWebPropertyId;                                                                </span>
<span  style="">  88                                                                                                          </span>
<span class="-6135682035086935956" onmouseenter="enter('-6135682035086935956');" onmouseout="out('-6135682035086935956');" style="">  89     @Resource(name = &quot;blOrderService&quot;)                                                                   </span>
<span class="4242410752290390693" onmouseenter="enter('4242410752290390693');" onmouseout="out('4242410752290390693');" style="">  90     protected OrderService orderService;                                                                 </span>
<span  style="">  91                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  92     /**                                                                                                  </span>
<span class="-4826553869963905978" onmouseenter="enter('-4826553869963905978');" onmouseout="out('-4826553869963905978');" style=""><abbr title="  93      * This will force the domain to 127.0.0.1 which is useful to determine if the Google Analytics tag is sending">  93      * This will force the domain to 127.0.0.1 which is useful to determine if the Google Analytics tag iðŸ”µ</abbr></span>
<span class="4379972517565340413" onmouseenter="enter('4379972517565340413');" onmouseout="out('4379972517565340413');" style="">  94      * a request to Google                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  95      */                                                                                                  </span>
<span class="4765817096410164031" onmouseenter="enter('4765817096410164031');" onmouseout="out('4765817096410164031');" style="">  96     @Value(&quot;${googleAnalytics.testLocal}&quot;)                                                               </span>
<span class="-1900167704265329937" onmouseenter="enter('-1900167704265329937');" onmouseout="out('-1900167704265329937');" style="">  97     protected boolean testLocal = false;                                                                 </span>
<span  style="">  98                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  99     @Override                                                                                            </span>
<span class="190238665005496725" onmouseenter="enter('190238665005496725');" onmouseout="out('190238665005496725');" style=""> 100     public String getName() {                                                                            </span>
<span class="-8270913471972923893" onmouseenter="enter('-8270913471972923893');" onmouseout="out('-8270913471972923893');" style=""> 101         return &quot;google_universal_analytics&quot;;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102     }                                                                                                    </span>
<span  style=""> 103                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 104     @Override                                                                                            </span>
<span class="9191046360773473694" onmouseenter="enter('9191046360773473694');" onmouseout="out('9191046360773473694');" style=""> 105     public int getPrecedence() {                                                                         </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 106         return 0;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107     }                                                                                                    </span>
<span  style=""> 108                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 109     @Override                                                                                            </span>
<span class="4464809424342535940" onmouseenter="enter('4464809424342535940');" onmouseout="out('4464809424342535940');" style=""><abbr title=" 110     public BroadleafTemplateModel getReplacementModel(String tagName, Map&lt;String, String&gt; tagAttributes, BroadleafTemplateContext context) {"> 110     public BroadleafTemplateModel getReplacementModel(String tagName, Map&lt;String, String&gt; tagAttributes, ðŸ”µ</abbr></span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 111         StringBuffer sb = new StringBuffer();                                                            </span>
<span class="2880528239678716865" onmouseenter="enter('2880528239678716865');" onmouseout="out('2880528239678716865');" style=""> 112         Map&lt;String, String&gt; trackers = getTrackers();                                                    </span>
<span class="1433824051485786916" onmouseenter="enter('1433824051485786916');" onmouseout="out('1433824051485786916');" style=""> 113         if (MapUtils.isNotEmpty(trackers)) {                                                             </span>
<span class="-225159766305017924" onmouseenter="enter('-225159766305017924');" onmouseout="out('-225159766305017924');" style=""> 114             sb.append(&quot;(function(i,s,o,g,r,a,m){i[&#x27;GoogleAnalyticsObject&#x27;]=r;i[r]=i[r]||function(){&quot;);   </span>
<span class="-75534907468996798" onmouseenter="enter('-75534907468996798');" onmouseout="out('-75534907468996798');" style=""> 115             sb.append(&quot;(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),&quot;); </span>
<span class="787448617478028585" onmouseenter="enter('787448617478028585');" onmouseout="out('787448617478028585');" style=""> 116             sb.append(&quot;m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)&quot;);</span>
<span class="3709749594906836963" onmouseenter="enter('3709749594906836963');" onmouseout="out('3709749594906836963');" style=""> 117             sb.append(&quot;})(window,document,&#x27;script&#x27;,&#x27;//www.google-analytics.com/analytics.js&#x27;,&#x27;ga&#x27;);&quot;);   </span>
<span  style=""> 118                                                                                                          </span>
<span class="8350540313808247660" onmouseenter="enter('8350540313808247660');" onmouseout="out('8350540313808247660');" style=""> 119             String orderNumberExpression = tagAttributes.get(&quot;ordernumber&quot;);                             </span>
<span class="-4116557390625637530" onmouseenter="enter('-4116557390625637530');" onmouseout="out('-4116557390625637530');" style=""> 120             String orderNumber = null;                                                                   </span>
<span class="1554006189045169119" onmouseenter="enter('1554006189045169119');" onmouseout="out('1554006189045169119');" style=""> 121             if (orderNumberExpression != null) {                                                         </span>
<span class="-8521652288646315683" onmouseenter="enter('-8521652288646315683');" onmouseout="out('-8521652288646315683');" style=""> 122                 orderNumber = (String) context.parseExpression(orderNumberExpression);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123             }                                                                                            </span>
<span  style=""> 124                                                                                                          </span>
<span class="-3391477864870857752" onmouseenter="enter('-3391477864870857752');" onmouseout="out('-3391477864870857752');" style=""> 125             Order order = null;                                                                          </span>
<span class="3032325866360707625" onmouseenter="enter('3032325866360707625');" onmouseout="out('3032325866360707625');" style=""> 126             if (orderNumber != null) {                                                                   </span>
<span class="8749278739372980865" onmouseenter="enter('8749278739372980865');" onmouseout="out('8749278739372980865');" style=""> 127                 order = orderService.findOrderByOrderNumber(orderNumber);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128             }                                                                                            </span>
<span  style=""> 129                                                                                                          </span>
<span class="6811598938615422064" onmouseenter="enter('6811598938615422064');" onmouseout="out('6811598938615422064');" style=""> 130             for (Entry&lt;String, String&gt; tracker : trackers.entrySet()) {                                  </span>
<span class="-6082993912017886430" onmouseenter="enter('-6082993912017886430');" onmouseout="out('-6082993912017886430');" style=""> 131                 String trackerName = tracker.getKey();                                                   </span>
<span class="-3120827425834628721" onmouseenter="enter('-3120827425834628721');" onmouseout="out('-3120827425834628721');" style=""> 132                 String trackerPrefix = &quot;&quot;;                                                               </span>
<span class="7019647018974662667" onmouseenter="enter('7019647018974662667');" onmouseout="out('7019647018974662667');" style=""> 133                 String id = tracker.getValue();                                                          </span>
<span class="3011142644875223402" onmouseenter="enter('3011142644875223402');" onmouseout="out('3011142644875223402');" style=""> 134                 sb.append(&quot;ga(&#x27;create&#x27;, &#x27;&quot; + id + &quot;&#x27;, &#x27;auto&#x27;, {&quot;);                                       </span>
<span  style=""> 135                                                                                                          </span>
<span class="3839128902332571680" onmouseenter="enter('3839128902332571680');" onmouseout="out('3839128902332571680');" style=""> 136                 if (!&quot;webProperty&quot;.equals(trackerName)) {                                                </span>
<span class="-7426441914050405472" onmouseenter="enter('-7426441914050405472');" onmouseout="out('-7426441914050405472');" style=""> 137                     trackerPrefix = trackerName + &quot;.&quot;;                                                   </span>
<span class="-3973100567386912971" onmouseenter="enter('-3973100567386912971');" onmouseout="out('-3973100567386912971');" style=""> 138                     sb.append(&quot;&#x27;name&#x27;: &#x27;&quot; + trackerName + &quot;&#x27;&quot;);                                          </span>
<span class="3293478056291787725" onmouseenter="enter('3293478056291787725');" onmouseout="out('3293478056291787725');" style=""> 139                     if (testLocal) {                                                                     </span>
<span class="6725018595534739120" onmouseenter="enter('6725018595534739120');" onmouseout="out('6725018595534739120');" style=""> 140                         sb.append(&quot;,&quot;);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142                 }                                                                                        </span>
<span class="3293478056291787725" onmouseenter="enter('3293478056291787725');" onmouseout="out('3293478056291787725');" style=""> 143                 if (testLocal) {                                                                         </span>
<span class="-3353602519532140774" onmouseenter="enter('-3353602519532140774');" onmouseout="out('-3353602519532140774');" style=""> 144                     sb.append(&quot;&#x27;cookieDomain&#x27;: &#x27;none&#x27;&quot;);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145                 }                                                                                        </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 146                 sb.append(&quot;});&quot;);                                                                        </span>
<span  style=""> 147                                                                                                          </span>
<span class="-7418475527567976254" onmouseenter="enter('-7418475527567976254');" onmouseout="out('-7418475527567976254');" style=""> 148                 if (&quot;webProperty&quot;.equals(trackerName)) {                                                 </span>
<span class="4360254575720880810" onmouseenter="enter('4360254575720880810');" onmouseout="out('4360254575720880810');" style=""><abbr title=" 149                     HttpServletRequest request = BroadleafRequestContext.getBroadleafRequestContext().getRequest();"> 149                     HttpServletRequest request = BroadleafRequestContext.getBroadleafRequestContext().getðŸ”µ</abbr></span>
<span class="-5752363771942989481" onmouseenter="enter('-5752363771942989481');" onmouseout="out('-5752363771942989481');" style=""> 150                     if (request != null) {                                                               </span>
<span class="3853533472488230976" onmouseenter="enter('3853533472488230976');" onmouseout="out('3853533472488230976');" style=""><abbr title=" 151                         Map&lt;String, String&gt; setValuesMap = (Map&lt;String, String&gt;) request.getAttribute(&quot;blGAValuesMap&quot;);"> 151                         Map&lt;String, String&gt; setValuesMap = (Map&lt;String, String&gt;) request.getAttribute(&quot;blðŸ”µ</abbr></span>
<span class="-4910410964255568960" onmouseenter="enter('-4910410964255568960');" onmouseout="out('-4910410964255568960');" style=""> 152                         if (setValuesMap != null) {                                                      </span>
<span class="1796428880304861730" onmouseenter="enter('1796428880304861730');" onmouseout="out('1796428880304861730');" style=""> 153                             for (Map.Entry&lt;String, String&gt; entry : setValuesMap.entrySet()) {            </span>
<span class="6095212434965084893" onmouseenter="enter('6095212434965084893');" onmouseout="out('6095212434965084893');" style=""><abbr title=" 154                                 sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;set&#x27;,&quot;).append(entry.getKey()).append(&quot;,&quot;)"> 154                                 sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;set&#x27;,&quot;).append(entry.getKey()).appendðŸ”µ</abbr></span>
<span class="4491228529456646674" onmouseenter="enter('4491228529456646674');" onmouseout="out('4491228529456646674');" style=""> 155                                         .append(entry.getValue()).append(&quot;);&quot;);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159                 }                                                                                        </span>
<span  style=""> 160                                                                                                          </span>
<span class="-4889417558387717970" onmouseenter="enter('-4889417558387717970');" onmouseout="out('-4889417558387717970');" style=""> 161                 sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;send&#x27;, &#x27;pageview&#x27;);&quot;);                               </span>
<span  style=""> 162                                                                                                          </span>
<span class="-1815529951487720795" onmouseenter="enter('-1815529951487720795');" onmouseout="out('-1815529951487720795');" style=""> 163                 if (isIncludeLinkAttribution()) {                                                        </span>
<span class="8560972280490216573" onmouseenter="enter('8560972280490216573');" onmouseout="out('8560972280490216573');" style=""> 164                     sb.append(getLinkAttributionJs(trackerPrefix));                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165                 }                                                                                        </span>
<span class="-7131894736179401387" onmouseenter="enter('-7131894736179401387');" onmouseout="out('-7131894736179401387');" style=""> 166                 if (isIncludeDisplayAdvertising()) {                                                     </span>
<span class="-8416140583577512322" onmouseenter="enter('-8416140583577512322');" onmouseout="out('-8416140583577512322');" style=""> 167                     sb.append(getDisplayAdvertisingJs(trackerPrefix));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168                 }                                                                                        </span>
<span  style=""> 169                                                                                                          </span>
<span class="3398338372153747583" onmouseenter="enter('3398338372153747583');" onmouseout="out('3398338372153747583');" style=""> 170                 if (order != null) {                                                                     </span>
<span class="-6179801228362718003" onmouseenter="enter('-6179801228362718003');" onmouseout="out('-6179801228362718003');" style=""> 171                     sb.append(getTransactionJs(order, trackerPrefix));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173             }                                                                                            </span>
<span  style=""> 174                                                                                                          </span>
<span class="-8412714651221999608" onmouseenter="enter('-8412714651221999608');" onmouseout="out('-8412714651221999608');" style=""> 175             // Add contentNode to the document                                                           </span>
<span class="2586931587804785526" onmouseenter="enter('2586931587804785526');" onmouseout="out('2586931587804785526');" style=""> 176             BroadleafTemplateModel model = context.createModel();                                        </span>
<span class="5956668170328902082" onmouseenter="enter('5956668170328902082');" onmouseout="out('5956668170328902082');" style=""> 177             BroadleafTemplateNonVoidElement scriptTag = context.createNonVoidElement(&quot;script&quot;);          </span>
<span class="-4659749375667028744" onmouseenter="enter('-4659749375667028744');" onmouseout="out('-4659749375667028744');" style=""> 178             BroadleafTemplateElement script = context.createTextElement(sb.toString());                  </span>
<span class="247228039845397848" onmouseenter="enter('247228039845397848');" onmouseout="out('247228039845397848');" style=""> 179             scriptTag.addChild(script);                                                                  </span>
<span class="7450786220544571726" onmouseenter="enter('7450786220544571726');" onmouseout="out('7450786220544571726');" style=""> 180             model.addElement(scriptTag);                                                                 </span>
<span class="1327412617440986435" onmouseenter="enter('1327412617440986435');" onmouseout="out('1327412617440986435');" style=""> 181             return model;                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 182         } else {                                                                                         </span>
<span class="2035563191225573078" onmouseenter="enter('2035563191225573078');" onmouseout="out('2035563191225573078');" style=""><abbr title=" 183             LOG.warn(&quot;No trackers were found, not outputting Google Analytics script. Set the googleAnalytics.webPropertyId&quot;"> 183             LOG.warn(&quot;No trackers were found, not outputting Google Analytics script. Set the googleAnalyðŸ”µ</abbr></span>
<span class="-5815171902766930389" onmouseenter="enter('-5815171902766930389');" onmouseout="out('-5815171902766930389');" style=""><abbr title=" 184                     + &quot; and/or the googleAnalytics.masterWebPropertyId system properties to output Google Analytics&quot;);"> 184                     + &quot; and/or the googleAnalytics.masterWebPropertyId system properties to output GoogleðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 186         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187     }                                                                                                    </span>
<span  style=""> 188                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 189     /**                                                                                                  </span>
<span class="4526085554743721537" onmouseenter="enter('4526085554743721537');" onmouseout="out('4526085554743721537');" style=""> 190      * Grabs a map of trackers keyed by the tracker name with the analytics ID as the value              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 191      */                                                                                                  </span>
<span class="-372605794037605079" onmouseenter="enter('-372605794037605079');" onmouseout="out('-372605794037605079');" style=""> 192     protected Map&lt;String, String&gt; getTrackers() {                                                        </span>
<span class="-307639934143605930" onmouseenter="enter('-307639934143605930');" onmouseout="out('-307639934143605930');" style=""> 193         Map&lt;String, String&gt; trackers = new HashMap&lt;&gt;();                                                  </span>
<span class="-7547677911791595799" onmouseenter="enter('-7547677911791595799');" onmouseout="out('-7547677911791595799');" style=""> 194         if (shouldShowMasterTracker()) {                                                                 </span>
<span class="7613356034540080851" onmouseenter="enter('7613356034540080851');" onmouseout="out('7613356034540080851');" style=""> 195             trackers.put(&quot;master&quot;, getMasterWebPropertyId());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196         }                                                                                                </span>
<span class="7457001157732167405" onmouseenter="enter('7457001157732167405');" onmouseout="out('7457001157732167405');" style=""> 197         if (StringUtils.isNotBlank(getWebPropertyId())) {                                                </span>
<span class="-1680205878775740489" onmouseenter="enter('-1680205878775740489');" onmouseout="out('-1680205878775740489');" style=""> 198             trackers.put(&quot;webProperty&quot;, getWebPropertyId());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199         }                                                                                                </span>
<span  style=""> 200                                                                                                          </span>
<span class="7808054229367271940" onmouseenter="enter('7808054229367271940');" onmouseout="out('7808054229367271940');" style=""> 201         return trackers;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202     }                                                                                                    </span>
<span  style=""> 203                                                                                                          </span>
<span class="7201288543731878163" onmouseenter="enter('7201288543731878163');" onmouseout="out('7201288543731878163');" style=""> 204     protected boolean shouldShowMasterTracker() {                                                        </span>
<span class="5354981909841949210" onmouseenter="enter('5354981909841949210');" onmouseout="out('5354981909841949210');" style=""> 205         String masterWebPropertyId = getMasterWebPropertyId();                                           </span>
<span class="-9816468277340784" onmouseenter="enter('-9816468277340784');" onmouseout="out('-9816468277340784');" style=""><abbr title=" 206         return (StringUtils.isNotBlank(masterWebPropertyId) &amp;&amp; (!&quot;UA-XXXXXXX-X&quot;.equals(masterWebPropertyId)));"> 206         return (StringUtils.isNotBlank(masterWebPropertyId) &amp;&amp; (!&quot;UA-XXXXXXX-X&quot;.equals(masterWebPropertyIðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207     }                                                                                                    </span>
<span  style=""> 208                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 209     /**                                                                                                  </span>
<span class="4669840319029639930" onmouseenter="enter('4669840319029639930');" onmouseout="out('4669840319029639930');" style=""> 210      * Builds the linke attribution Javascript                                                           </span>
<span class="8768361991211291337" onmouseenter="enter('8768361991211291337');" onmouseout="out('8768361991211291337');" style=""> 211      * @param tracker the name of the tracker that is using the link attribution                         </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 212      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 213      */                                                                                                  </span>
<span class="-4727062141745445312" onmouseenter="enter('-4727062141745445312');" onmouseout="out('-4727062141745445312');" style=""> 214     protected String getLinkAttributionJs(String trackerPrefix) {                                        </span>
<span class="4641935953841803222" onmouseenter="enter('4641935953841803222');" onmouseout="out('4641935953841803222');" style=""> 215         return &quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;linkid&#x27;, &#x27;linkid.js&#x27;);&quot;;                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216     }                                                                                                    </span>
<span  style=""> 217                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 218     /**                                                                                                  </span>
<span class="-1766163605340550882" onmouseenter="enter('-1766163605340550882');" onmouseout="out('-1766163605340550882');" style=""> 219      * Builds the display advertising Javascript for the given tracker                                   </span>
<span class="7955661006334297359" onmouseenter="enter('7955661006334297359');" onmouseout="out('7955661006334297359');" style=""> 220      * @param tracker                                                                                    </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 221      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 222      */                                                                                                  </span>
<span class="6227360005040256098" onmouseenter="enter('6227360005040256098');" onmouseout="out('6227360005040256098');" style=""> 223     protected String getDisplayAdvertisingJs(String trackerPrefix) {                                     </span>
<span class="3528222762911871195" onmouseenter="enter('3528222762911871195');" onmouseout="out('3528222762911871195');" style=""> 224         return &quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;displayfeatures&#x27;);&quot;;                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225     }                                                                                                    </span>
<span  style=""> 226                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 227     /**                                                                                                  </span>
<span class="6584247125825541487" onmouseenter="enter('6584247125825541487');" onmouseout="out('6584247125825541487');" style=""><abbr title=" 228      * Builds the transaction analytics for the given tracker name. Invokes {@link #getItemJs(Order, String) for each item"> 228      * Builds the transaction analytics for the given tracker name. Invokes {@link #getItemJs(Order, StriðŸ”µ</abbr></span>
<span class="-1936212608501453784" onmouseenter="enter('-1936212608501453784');" onmouseout="out('-1936212608501453784');" style=""> 229      * in the given &lt;b&gt;order&lt;/b&gt;.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 230      */                                                                                                  </span>
<span class="9179487558003409237" onmouseenter="enter('9179487558003409237');" onmouseout="out('9179487558003409237');" style=""> 231     protected String getTransactionJs(Order order, String trackerPrefix) {                               </span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 232         StringBuffer sb = new StringBuffer();                                                            </span>
<span class="1809594812594725377" onmouseenter="enter('1809594812594725377');" onmouseout="out('1809594812594725377');" style=""> 233         sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;ecommerce&#x27;, &#x27;ecommerce.js&#x27;);&quot;);                   </span>
<span  style=""> 234                                                                                                          </span>
<span class="-5012537295569901065" onmouseenter="enter('-5012537295569901065');" onmouseout="out('-5012537295569901065');" style=""> 235         sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:addTransaction&#x27;, {&quot;);                              </span>
<span class="3802939893371272400" onmouseenter="enter('3802939893371272400');" onmouseout="out('3802939893371272400');" style=""> 236         sb.append(&quot;&#x27;id&#x27;: &#x27;&quot; + order.getOrderNumber() + &quot;&#x27;&quot;);                                             </span>
<span class="-4495351553520504059" onmouseenter="enter('-4495351553520504059');" onmouseout="out('-4495351553520504059');" style=""> 237         if (StringUtils.isNotBlank(getAffiliation())) {                                                  </span>
<span class="2598773061427907348" onmouseenter="enter('2598773061427907348');" onmouseout="out('2598773061427907348');" style=""> 238             sb.append(&quot;,&#x27;affiliation&#x27;: &#x27;&quot; + getAffiliation() + &quot;&#x27;&quot;);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239         }                                                                                                </span>
<span class="-1600458020637022538" onmouseenter="enter('-1600458020637022538');" onmouseout="out('-1600458020637022538');" style=""> 240         sb.append(&quot;,&#x27;revenue&#x27;: &#x27;&quot; + order.getTotal() + &quot;&#x27;&quot;);                                             </span>
<span class="-7105820260454958730" onmouseenter="enter('-7105820260454958730');" onmouseout="out('-7105820260454958730');" style=""> 241         sb.append(&quot;,&#x27;shipping&#x27;:&#x27;&quot; + order.getTotalShipping() + &quot;&#x27;&quot;);                                     </span>
<span class="4743629374093034580" onmouseenter="enter('4743629374093034580');" onmouseout="out('4743629374093034580');" style=""> 242         sb.append(&quot;,&#x27;tax&#x27;: &#x27;&quot; + order.getTotalTax() + &quot;&#x27;&quot;);                                              </span>
<span  style=""> 243                                                                                                          </span>
<span class="3530102425606482988" onmouseenter="enter('3530102425606482988');" onmouseout="out('3530102425606482988');" style=""> 244         if (order.getCurrency() != null) {                                                               </span>
<span class="2532172931589873998" onmouseenter="enter('2532172931589873998');" onmouseout="out('2532172931589873998');" style=""> 245             sb.append(&quot;,&#x27;currency&#x27;: &#x27;&quot; + order.getCurrency().getCurrencyCode() + &quot;&#x27;&quot;);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246         }                                                                                                </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 247         sb.append(&quot;});&quot;);                                                                                </span>
<span  style=""> 248                                                                                                          </span>
<span class="-7953667423558098854" onmouseenter="enter('-7953667423558098854');" onmouseout="out('-7953667423558098854');" style=""> 249         sb.append(getItemJs(order, trackerPrefix));                                                      </span>
<span  style=""> 250                                                                                                          </span>
<span class="2925677874169908961" onmouseenter="enter('2925677874169908961');" onmouseout="out('2925677874169908961');" style=""> 251         sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:send&#x27;);&quot;);                                         </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 252         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253     }                                                                                                    </span>
<span  style=""> 254                                                                                                          </span>
<span class="5980134894234571756" onmouseenter="enter('5980134894234571756');" onmouseout="out('5980134894234571756');" style=""> 255     protected String getItemJs(Order order, String trackerPrefix) {                                      </span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 256         StringBuffer sb = new StringBuffer();                                                            </span>
<span class="1072921294238695944" onmouseenter="enter('1072921294238695944');" onmouseout="out('1072921294238695944');" style=""> 257         for (FulfillmentGroup fulfillmentGroup : order.getFulfillmentGroups()) {                         </span>
<span class="7256397867735119446" onmouseenter="enter('7256397867735119446');" onmouseout="out('7256397867735119446');" style=""><abbr title=" 258             for (FulfillmentGroupItem fulfillmentGroupItem : fulfillmentGroup.getFulfillmentGroupItems()) {"> 258             for (FulfillmentGroupItem fulfillmentGroupItem : fulfillmentGroup.getFulfillmentGroupItems())ðŸ”µ</abbr></span>
<span class="6727205496790990336" onmouseenter="enter('6727205496790990336');" onmouseout="out('6727205496790990336');" style=""> 259                 OrderItem orderItem = fulfillmentGroupItem.getOrderItem();                               </span>
<span  style=""> 260                                                                                                          </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 261 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-7078716540017248808" onmouseenter="enter('-7078716540017248808');" onmouseout="out('-7078716540017248808');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 262                 if (SkuAccessor.class.isAssignableFrom(orderItem.getClass())) {                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 263 ||||||| BASE                                                                                             </span>
<span class="-4497171920864475683" onmouseenter="enter('-4497171920864475683');" onmouseout="out('-4497171920864475683');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264                 Sku sku = ((SkuAccessor) orderItem).getSku();                                            </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 265 =======                                                                                                  </span>
<span class="-1726294213977632923" onmouseenter="enter('-1726294213977632923');" onmouseout="out('-1726294213977632923');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266                 if (orderItem instanceof DiscreteOrderItem) {                                            </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 267 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-4497171920864475683" onmouseenter="enter('-4497171920864475683');" onmouseout="out('-4497171920864475683');" style=""> 268                 Sku sku = ((SkuAccessor) orderItem).getSku();                                            </span>
<span  style=""> 269                                                                                                          </span>
<span class="-8613458593272541119" onmouseenter="enter('-8613458593272541119');" onmouseout="out('-8613458593272541119');" style=""> 270                 sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:addItem&#x27;, {&quot;);                             </span>
<span class="3802939893371272400" onmouseenter="enter('3802939893371272400');" onmouseout="out('3802939893371272400');" style=""> 271                 sb.append(&quot;&#x27;id&#x27;: &#x27;&quot; + order.getOrderNumber() + &quot;&#x27;&quot;);                                     </span>
<span class="-887663243915190383" onmouseenter="enter('-887663243915190383');" onmouseout="out('-887663243915190383');" style=""> 272                 sb.append(&quot;,&#x27;name&#x27;: &#x27;&quot; + sku.getName() + &quot;&#x27;&quot;);                                           </span>
<span class="-7742482896330545050" onmouseenter="enter('-7742482896330545050');" onmouseout="out('-7742482896330545050');" style=""> 273                 sb.append(&quot;,&#x27;sku&#x27;: &#x27;&quot; + sku.getId() + &quot;&#x27;&quot;);                                              </span>
<span class="-1605838225351785854" onmouseenter="enter('-1605838225351785854');" onmouseout="out('-1605838225351785854');" style=""> 274                 sb.append(&quot;,&#x27;category&#x27;: &#x27;&quot; + getVariation(orderItem) + &quot;&#x27;&quot;);                             </span>
<span class="-4039856411666157290" onmouseenter="enter('-4039856411666157290');" onmouseout="out('-4039856411666157290');" style=""> 275                 sb.append(&quot;,&#x27;price&#x27;: &#x27;&quot; + orderItem.getAveragePrice() + &quot;&#x27;&quot;);                            </span>
<span class="-6864347081607696224" onmouseenter="enter('-6864347081607696224');" onmouseout="out('-6864347081607696224');" style=""> 276                 sb.append(&quot;,&#x27;quantity&#x27;: &#x27;&quot; + orderItem.getQuantity() + &quot;&#x27;&quot;);                             </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 277                 sb.append(&quot;});&quot;);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 281         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282     }                                                                                                    </span>
<span  style=""> 283                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 284     /**                                                                                                  </span>
<span class="6923647488705566386" onmouseenter="enter('6923647488705566386');" onmouseout="out('6923647488705566386');" style=""> 285      * Returns the product option values separated by a space if they are                                </span>
<span class="1487274611034840884" onmouseenter="enter('1487274611034840884');" onmouseout="out('1487274611034840884');" style=""> 286      * relevant for the item, or the product category if no options are available                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 287      *                                                                                                   </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 288      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 289      */                                                                                                  </span>
<span class="5846271843428503958" onmouseenter="enter('5846271843428503958');" onmouseout="out('5846271843428503958');" style=""> 290     protected String getVariation(OrderItem item) {                                                      </span>
<span class="-1900425779688459231" onmouseenter="enter('-1900425779688459231');" onmouseout="out('-1900425779688459231');" style=""> 291         if (MapUtils.isEmpty(item.getOrderItemAttributes())) {                                           </span>
<span class="-2607232819614252500" onmouseenter="enter('-2607232819614252500');" onmouseout="out('-2607232819614252500');" style=""> 292             return item.getCategory() == null ? &quot;&quot; : item.getCategory().getName();                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293         }                                                                                                </span>
<span  style=""> 294                                                                                                          </span>
<span class="3636026723966887885" onmouseenter="enter('3636026723966887885');" onmouseout="out('3636026723966887885');" style=""> 295         //use product options instead                                                                    </span>
<span class="-3623621045223349277" onmouseenter="enter('-3623621045223349277');" onmouseout="out('-3623621045223349277');" style=""> 296         String result = &quot;&quot;;                                                                              </span>
<span class="-3052053556715064621" onmouseenter="enter('-3052053556715064621');" onmouseout="out('-3052053556715064621');" style=""> 297         for (Map.Entry&lt;String, OrderItemAttribute&gt; entry : item.getOrderItemAttributes().entrySet()) {   </span>
<span class="-7464419131479451077" onmouseenter="enter('-7464419131479451077');" onmouseout="out('-7464419131479451077');" style=""> 298             result += entry.getValue().getValue() + &quot; &quot;;                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299         }                                                                                                </span>
<span  style=""> 300                                                                                                          </span>
<span class="-6864210689922892589" onmouseenter="enter('-6864210689922892589');" onmouseout="out('-6864210689922892589');" style=""> 301         //the result has a space at the end, ensure that is stripped out                                 </span>
<span class="6125747973705988751" onmouseenter="enter('6125747973705988751');" onmouseout="out('6125747973705988751');" style=""> 302         return result.substring(0, result.length() - 1);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303     }                                                                                                    </span>
<span  style=""> 304                                                                                                          </span>
<span class="7688964624751652763" onmouseenter="enter('7688964624751652763');" onmouseout="out('7688964624751652763');" style=""> 305     public String getMasterWebPropertyId() {                                                             </span>
<span class="8804391615898929387" onmouseenter="enter('8804391615898929387');" onmouseout="out('8804391615898929387');" style=""> 306         return masterWebPropertyId;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307     }                                                                                                    </span>
<span  style=""> 308                                                                                                          </span>
<span class="-2978295786667990463" onmouseenter="enter('-2978295786667990463');" onmouseout="out('-2978295786667990463');" style=""> 309     public void setMasterWebPropertyId(String masterWebPropertyId) {                                     </span>
<span class="7918620816210150178" onmouseenter="enter('7918620816210150178');" onmouseout="out('7918620816210150178');" style=""> 310         this.masterWebPropertyId = masterWebPropertyId;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311     }                                                                                                    </span>
<span  style=""> 312                                                                                                          </span>
<span class="6671223003008841723" onmouseenter="enter('6671223003008841723');" onmouseout="out('6671223003008841723');" style=""> 313     public String getAffiliation() {                                                                     </span>
<span class="7807255797153975973" onmouseenter="enter('7807255797153975973');" onmouseout="out('7807255797153975973');" style=""> 314         return BLCSystemProperty.resolveSystemProperty(&quot;googleAnalytics.affiliation&quot;);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315     }                                                                                                    </span>
<span  style=""> 316                                                                                                          </span>
<span class="8203350595237245612" onmouseenter="enter('8203350595237245612');" onmouseout="out('8203350595237245612');" style=""> 317     public String getWebPropertyId() {                                                                   </span>
<span class="850776087520408196" onmouseenter="enter('850776087520408196');" onmouseout="out('850776087520408196');" style=""> 318         return BLCSystemProperty.resolveSystemProperty(&quot;googleAnalytics.webPropertyId&quot;);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319     }                                                                                                    </span>
<span  style=""> 320                                                                                                          </span>
<span class="825053779558488694" onmouseenter="enter('825053779558488694');" onmouseout="out('825053779558488694');" style=""> 321     public boolean isIncludeLinkAttribution() {                                                          </span>
<span class="5065521424805687131" onmouseenter="enter('5065521424805687131');" onmouseout="out('5065521424805687131');" style=""><abbr title=" 322         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableLinkAttribution&quot;, true);"> 322         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableLinkAttribution&quot;, trðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323     }                                                                                                    </span>
<span  style=""> 324                                                                                                          </span>
<span class="4570506314302342970" onmouseenter="enter('4570506314302342970');" onmouseout="out('4570506314302342970');" style=""> 325     public boolean isIncludeDisplayAdvertising() {                                                       </span>
<span class="-1788412357185885205" onmouseenter="enter('-1788412357185885205');" onmouseout="out('-1788412357185885205');" style=""><abbr title=" 326         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableDisplayAdvertising&quot;, false);"> 326         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableDisplayAdvertising&quot;,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327     }                                                                                                    </span>
<span  style=""> 328                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="6211491254187717485" onmouseenter="enter('6211491254187717485');" onmouseout="out('6211491254187717485');" style="">   3  * BroadleafCommerce Framework Web                                                                       </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-579043521764695224" onmouseenter="enter('-579043521764695224');" onmouseout="out('-579043521764695224');" style="">  18 package org.broadleafcommerce.core.web.processor;                                                        </span>
<span  style="">  19                                                                                                          </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  20 import java.util.HashMap;                                                                                </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  21 import java.util.Map.Entry;                                                                              </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  22 import java.util.Map;                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  23 import javax.annotation.Resource;                                                                        </span>
<span class="-2972028083581866805" onmouseenter="enter('-2972028083581866805');" onmouseout="out('-2972028083581866805');" style="">  24 import javax.servlet.http.HttpServletRequest;                                                            </span>
<span class="4020017653195254006" onmouseenter="enter('4020017653195254006');" onmouseout="out('4020017653195254006');" style="">  25 import org.apache.commons.collections.MapUtils;                                                          </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  26 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  27 import org.apache.commons.logging.Log;                                                                   </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  28 import org.apache.commons.logging.LogFactory;                                                            </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  29 import org.broadleafcommerce.common.util.BLCSystemProperty;                                              </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  30 import org.broadleafcommerce.common.web.BroadleafRequestContext;                                         </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  31 import org.broadleafcommerce.core.catalog.domain.Sku;                                                    </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  32 import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                        </span>
<span class="-6302349778747925467" onmouseenter="enter('-6302349778747925467');" onmouseout="out('-6302349778747925467');" style="">  33 import org.broadleafcommerce.core.order.domain.FulfillmentGroup;                                         </span>
<span class="-7855842771160128779" onmouseenter="enter('-7855842771160128779');" onmouseout="out('-7855842771160128779');" style="">  34 import org.broadleafcommerce.core.order.domain.FulfillmentGroupItem;                                     </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  35 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  36 import org.broadleafcommerce.core.order.domain.OrderItem;                                                </span>
<span class="2123683748922877231" onmouseenter="enter('2123683748922877231');" onmouseout="out('2123683748922877231');" style="">  37 import org.broadleafcommerce.core.order.domain.OrderItemAttribute;                                       </span>
<span class="3047856393988054011" onmouseenter="enter('3047856393988054011');" onmouseout="out('3047856393988054011');" style="">  38 import org.broadleafcommerce.core.order.domain.SkuAccessor;                                              </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  39 import org.broadleafcommerce.core.order.service.OrderService;                                            </span>
<span class="205237632867733562" onmouseenter="enter('205237632867733562');" onmouseout="out('205237632867733562');" style="">  40 import org.broadleafcommerce.presentation.condition.ConditionalOnTemplating;                             </span>
<span class="5380655934740542528" onmouseenter="enter('5380655934740542528');" onmouseout="out('5380655934740542528');" style="">  41 import org.broadleafcommerce.presentation.dialect.AbstractBroadleafTagReplacementProcessor;              </span>
<span class="7486567025810647827" onmouseenter="enter('7486567025810647827');" onmouseout="out('7486567025810647827');" style="">  42 import org.broadleafcommerce.presentation.model.BroadleafTemplateContext;                                </span>
<span class="-2001850062613906669" onmouseenter="enter('-2001850062613906669');" onmouseout="out('-2001850062613906669');" style="">  43 import org.broadleafcommerce.presentation.model.BroadleafTemplateElement;                                </span>
<span class="8100767512529469135" onmouseenter="enter('8100767512529469135');" onmouseout="out('8100767512529469135');" style="">  44 import org.broadleafcommerce.presentation.model.BroadleafTemplateModel;                                  </span>
<span class="-6189886993649876021" onmouseenter="enter('-6189886993649876021');" onmouseout="out('-6189886993649876021');" style="">  45 import org.broadleafcommerce.presentation.model.BroadleafTemplateNonVoidElement;                         </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  46 import org.springframework.beans.factory.annotation.Value;                                               </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  47 import org.springframework.stereotype.Component;                                                         </span>
<span  style="">  48                                                                                                          </span>
<span  style="">  49                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50 /**                                                                                                      </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  51  * &lt;p&gt;                                                                                                   </span>
<span class="-143385427104872854" onmouseenter="enter('-143385427104872854');" onmouseout="out('-143385427104872854');" style=""><abbr title="  52  * Takes advantage of the new-stype analytics.js from Google Analytics rather than the deprected ga.js. This also">  52  * Takes advantage of the new-stype analytics.js from Google Analytics rather than the deprected ga.js. TðŸ”µ</abbr></span>
<span class="-8898438840079886526" onmouseenter="enter('-8898438840079886526');" onmouseout="out('-8898438840079886526');" style=""><abbr title="  53  * supports a pre-processed &lt;b&gt;orderNumber&lt;/b&gt; attribute that can be null, suitable for things like the order confirmation">  53  * supports a pre-processed &lt;b&gt;orderNumber&lt;/b&gt; attribute that can be null, suitable for things like the oðŸ”µ</abbr></span>
<span class="-7917044275166249545" onmouseenter="enter('-7917044275166249545');" onmouseout="out('-7917044275166249545');" style="">  54  * page to send e-commerce transactions. Example usage:                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  55  *                                                                                                       </span>
<span class="-661354662451427256" onmouseenter="enter('-661354662451427256');" onmouseout="out('-661354662451427256');" style="">  56  * &lt;pre&gt;                                                                                                 </span>
<span class="-7906919746321802108" onmouseenter="enter('-7906919746321802108');" onmouseout="out('-7906919746321802108');" style="">  57  * &amp;lt;google_universal_analytics ordernumber=&quot;${order?.orderNumber&quot; /&amp;gt;                               </span>
<span class="2390307265644686" onmouseenter="enter('2390307265644686');" onmouseout="out('2390307265644686');" style="">  58  * &lt;/pre&gt;                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  59  *                                                                                                       </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  60  * &lt;p&gt;                                                                                                   </span>
<span class="8606412176857267386" onmouseenter="enter('8606412176857267386');" onmouseout="out('8606412176857267386');" style="">  61  * This processor also supports:                                                                         </span>
<span class="2717555647352622731" onmouseenter="enter('2717555647352622731');" onmouseout="out('2717555647352622731');" style="">  62  * &lt;ul&gt;                                                                                                  </span>
<span class="-8530737739149477803" onmouseenter="enter('-8530737739149477803');" onmouseout="out('-8530737739149477803');" style=""><abbr title="  63  *  &lt;li&gt;Multiple trackers (extensible via {@link #getTrackers()} or by setting the {@code googleAnalytics.masterWebPropertyId}">  63  *  &lt;li&gt;Multiple trackers (extensible via {@link #getTrackers()} or by setting the {@code googleAnalyticsðŸ”µ</abbr></span>
<span class="6265505146874472773" onmouseenter="enter('6265505146874472773');" onmouseout="out('6265505146874472773');" style="">  64  *      and {@code googleAnalytics.webPropertyId})&lt;/li&gt;                                                  </span>
<span class="-6827384770903327510" onmouseenter="enter('-6827384770903327510');" onmouseout="out('-6827384770903327510');" style="">  65  *  &lt;li&gt;Affiliates for e-commerce ({@ googleAnalytics.affiliation property})&lt;/li&gt;                        </span>
<span class="7100814537211017894" onmouseenter="enter('7100814537211017894');" onmouseout="out('7100814537211017894');" style=""><abbr title="  66  *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/2558867?hl=en&amp;utm_id=ad&quot;&gt;Link attribution&lt;/a&gt;">  66  *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/2558867?hl=en&amp;utm_id=ad&quot;&gt;Link attribution&lt;/aðŸ”µ</abbr></span>
<span class="4406549444147281940" onmouseenter="enter('4406549444147281940');" onmouseout="out('4406549444147281940');" style="">  67  *      ({@code googleAnalytics.enableLinkAttribution} system property, default {@code true})&lt;/li&gt;       </span>
<span class="-684988223968504417" onmouseenter="enter('-684988223968504417');" onmouseout="out('-684988223968504417');" style="">  68  *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/3450482&quot;&gt;Display Advertising&lt;/a&gt;            </span>
<span class="7299106057661310467" onmouseenter="enter('7299106057661310467');" onmouseout="out('7299106057661310467');" style="">  69  *      ({@code googleAnalytics.enableDisplayAdvertising} system property, default {@code false})&lt;/li&gt;   </span>
<span class="599475583152278076" onmouseenter="enter('599475583152278076');" onmouseout="out('599475583152278076');" style="">  70  * &lt;/ul&gt;                                                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  71  *                                                                                                       </span>
<span class="630288204851723761" onmouseenter="enter('630288204851723761');" onmouseout="out('630288204851723761');" style=""><abbr title="  72  * @param ordernumber the order number to look up for ecommerce tracking, such as on the confirmation page">  72  * @param ordernumber the order number to look up for ecommerce tracking, such as on the confirmation pagðŸ”µ</abbr></span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  73  *                                                                                                       </span>
<span class="2670632328160232809" onmouseenter="enter('2670632328160232809');" onmouseout="out('2670632328160232809');" style="">  74  * @author Phillip Verheyden (phillipuniverse)                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  75  */                                                                                                      </span>
<span class="-7627801935997636319" onmouseenter="enter('-7627801935997636319');" onmouseout="out('-7627801935997636319');" style="">  76 @Component(&quot;blGoogleUniversalAnalyticsProcessor&quot;)                                                        </span>
<span class="7070618034916085721" onmouseenter="enter('7070618034916085721');" onmouseout="out('7070618034916085721');" style="">  77 @ConditionalOnTemplating                                                                                 </span>
<span class="-2399886873569081592" onmouseenter="enter('-2399886873569081592');" onmouseout="out('-2399886873569081592');" style="">  78 public class GoogleUniversalAnalyticsProcessor extends AbstractBroadleafTagReplacementProcessor {        </span>
<span class="4721694570459087610" onmouseenter="enter('4721694570459087610');" onmouseout="out('4721694570459087610');" style="">  79     private static final Log LOG = LogFactory.getLog(GoogleUniversalAnalyticsProcessor.class);           </span>
<span  style="">  80                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  81     /**                                                                                                  </span>
<span class="5978956812126798070" onmouseenter="enter('5978956812126798070');" onmouseout="out('5978956812126798070');" style=""><abbr title="  82      * Global value, intentionally only retrieved as a file property NOT via the system properties service">  82      * Global value, intentionally only retrieved as a file property NOT via the system properties servicðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  83      */                                                                                                  </span>
<span class="2486332857350127859" onmouseenter="enter('2486332857350127859');" onmouseout="out('2486332857350127859');" style="">  84     @Value(&quot;${googleAnalytics.masterWebPropertyId}&quot;)                                                     </span>
<span class="8766018855843754021" onmouseenter="enter('8766018855843754021');" onmouseout="out('8766018855843754021');" style="">  85     protected String masterWebPropertyId;                                                                </span>
<span  style="">  86                                                                                                          </span>
<span class="-6135682035086935956" onmouseenter="enter('-6135682035086935956');" onmouseout="out('-6135682035086935956');" style="">  87     @Resource(name = &quot;blOrderService&quot;)                                                                   </span>
<span class="4242410752290390693" onmouseenter="enter('4242410752290390693');" onmouseout="out('4242410752290390693');" style="">  88     protected OrderService orderService;                                                                 </span>
<span  style="">  89                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  90     /**                                                                                                  </span>
<span class="-4826553869963905978" onmouseenter="enter('-4826553869963905978');" onmouseout="out('-4826553869963905978');" style=""><abbr title="  91      * This will force the domain to 127.0.0.1 which is useful to determine if the Google Analytics tag is sending">  91      * This will force the domain to 127.0.0.1 which is useful to determine if the Google Analytics tag iðŸ”µ</abbr></span>
<span class="4379972517565340413" onmouseenter="enter('4379972517565340413');" onmouseout="out('4379972517565340413');" style="">  92      * a request to Google                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  93      */                                                                                                  </span>
<span class="4765817096410164031" onmouseenter="enter('4765817096410164031');" onmouseout="out('4765817096410164031');" style="">  94     @Value(&quot;${googleAnalytics.testLocal}&quot;)                                                               </span>
<span class="-1900167704265329937" onmouseenter="enter('-1900167704265329937');" onmouseout="out('-1900167704265329937');" style="">  95     protected boolean testLocal = false;                                                                 </span>
<span  style="">  96                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  97     @Override                                                                                            </span>
<span class="190238665005496725" onmouseenter="enter('190238665005496725');" onmouseout="out('190238665005496725');" style="">  98     public String getName() {                                                                            </span>
<span class="-8270913471972923893" onmouseenter="enter('-8270913471972923893');" onmouseout="out('-8270913471972923893');" style="">  99         return &quot;google_universal_analytics&quot;;                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100     }                                                                                                    </span>
<span  style=""> 101                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 102     @Override                                                                                            </span>
<span class="9191046360773473694" onmouseenter="enter('9191046360773473694');" onmouseout="out('9191046360773473694');" style=""> 103     public int getPrecedence() {                                                                         </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 104         return 0;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105     }                                                                                                    </span>
<span  style=""> 106                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 107     @Override                                                                                            </span>
<span class="4464809424342535940" onmouseenter="enter('4464809424342535940');" onmouseout="out('4464809424342535940');" style=""><abbr title=" 108     public BroadleafTemplateModel getReplacementModel(String tagName, Map&lt;String, String&gt; tagAttributes, BroadleafTemplateContext context) {"> 108     public BroadleafTemplateModel getReplacementModel(String tagName, Map&lt;String, String&gt; tagAttributes, ðŸ”µ</abbr></span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 109         StringBuffer sb = new StringBuffer();                                                            </span>
<span class="2880528239678716865" onmouseenter="enter('2880528239678716865');" onmouseout="out('2880528239678716865');" style=""> 110         Map&lt;String, String&gt; trackers = getTrackers();                                                    </span>
<span class="1433824051485786916" onmouseenter="enter('1433824051485786916');" onmouseout="out('1433824051485786916');" style=""> 111         if (MapUtils.isNotEmpty(trackers)) {                                                             </span>
<span class="-225159766305017924" onmouseenter="enter('-225159766305017924');" onmouseout="out('-225159766305017924');" style=""> 112             sb.append(&quot;(function(i,s,o,g,r,a,m){i[&#x27;GoogleAnalyticsObject&#x27;]=r;i[r]=i[r]||function(){&quot;);   </span>
<span class="-75534907468996798" onmouseenter="enter('-75534907468996798');" onmouseout="out('-75534907468996798');" style=""> 113             sb.append(&quot;(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),&quot;); </span>
<span class="787448617478028585" onmouseenter="enter('787448617478028585');" onmouseout="out('787448617478028585');" style=""> 114             sb.append(&quot;m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)&quot;);</span>
<span class="3709749594906836963" onmouseenter="enter('3709749594906836963');" onmouseout="out('3709749594906836963');" style=""> 115             sb.append(&quot;})(window,document,&#x27;script&#x27;,&#x27;//www.google-analytics.com/analytics.js&#x27;,&#x27;ga&#x27;);&quot;);   </span>
<span  style=""> 116                                                                                                          </span>
<span class="8350540313808247660" onmouseenter="enter('8350540313808247660');" onmouseout="out('8350540313808247660');" style=""> 117             String orderNumberExpression = tagAttributes.get(&quot;ordernumber&quot;);                             </span>
<span class="-4116557390625637530" onmouseenter="enter('-4116557390625637530');" onmouseout="out('-4116557390625637530');" style=""> 118             String orderNumber = null;                                                                   </span>
<span class="1554006189045169119" onmouseenter="enter('1554006189045169119');" onmouseout="out('1554006189045169119');" style=""> 119             if (orderNumberExpression != null) {                                                         </span>
<span class="-8521652288646315683" onmouseenter="enter('-8521652288646315683');" onmouseout="out('-8521652288646315683');" style=""> 120                 orderNumber = (String) context.parseExpression(orderNumberExpression);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121             }                                                                                            </span>
<span  style=""> 122                                                                                                          </span>
<span class="-3391477864870857752" onmouseenter="enter('-3391477864870857752');" onmouseout="out('-3391477864870857752');" style=""> 123             Order order = null;                                                                          </span>
<span class="3032325866360707625" onmouseenter="enter('3032325866360707625');" onmouseout="out('3032325866360707625');" style=""> 124             if (orderNumber != null) {                                                                   </span>
<span class="8749278739372980865" onmouseenter="enter('8749278739372980865');" onmouseout="out('8749278739372980865');" style=""> 125                 order = orderService.findOrderByOrderNumber(orderNumber);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126             }                                                                                            </span>
<span  style=""> 127                                                                                                          </span>
<span class="6811598938615422064" onmouseenter="enter('6811598938615422064');" onmouseout="out('6811598938615422064');" style=""> 128             for (Entry&lt;String, String&gt; tracker : trackers.entrySet()) {                                  </span>
<span class="-6082993912017886430" onmouseenter="enter('-6082993912017886430');" onmouseout="out('-6082993912017886430');" style=""> 129                 String trackerName = tracker.getKey();                                                   </span>
<span class="-3120827425834628721" onmouseenter="enter('-3120827425834628721');" onmouseout="out('-3120827425834628721');" style=""> 130                 String trackerPrefix = &quot;&quot;;                                                               </span>
<span class="7019647018974662667" onmouseenter="enter('7019647018974662667');" onmouseout="out('7019647018974662667');" style=""> 131                 String id = tracker.getValue();                                                          </span>
<span class="3011142644875223402" onmouseenter="enter('3011142644875223402');" onmouseout="out('3011142644875223402');" style=""> 132                 sb.append(&quot;ga(&#x27;create&#x27;, &#x27;&quot; + id + &quot;&#x27;, &#x27;auto&#x27;, {&quot;);                                       </span>
<span  style=""> 133                                                                                                          </span>
<span class="3839128902332571680" onmouseenter="enter('3839128902332571680');" onmouseout="out('3839128902332571680');" style=""> 134                 if (!&quot;webProperty&quot;.equals(trackerName)) {                                                </span>
<span class="-7426441914050405472" onmouseenter="enter('-7426441914050405472');" onmouseout="out('-7426441914050405472');" style=""> 135                     trackerPrefix = trackerName + &quot;.&quot;;                                                   </span>
<span class="-3973100567386912971" onmouseenter="enter('-3973100567386912971');" onmouseout="out('-3973100567386912971');" style=""> 136                     sb.append(&quot;&#x27;name&#x27;: &#x27;&quot; + trackerName + &quot;&#x27;&quot;);                                          </span>
<span class="3293478056291787725" onmouseenter="enter('3293478056291787725');" onmouseout="out('3293478056291787725');" style=""> 137                     if (testLocal) {                                                                     </span>
<span class="6725018595534739120" onmouseenter="enter('6725018595534739120');" onmouseout="out('6725018595534739120');" style=""> 138                         sb.append(&quot;,&quot;);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140                 }                                                                                        </span>
<span class="3293478056291787725" onmouseenter="enter('3293478056291787725');" onmouseout="out('3293478056291787725');" style=""> 141                 if (testLocal) {                                                                         </span>
<span class="-3353602519532140774" onmouseenter="enter('-3353602519532140774');" onmouseout="out('-3353602519532140774');" style=""> 142                     sb.append(&quot;&#x27;cookieDomain&#x27;: &#x27;none&#x27;&quot;);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                 }                                                                                        </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 144                 sb.append(&quot;});&quot;);                                                                        </span>
<span  style=""> 145                                                                                                          </span>
<span class="-7418475527567976254" onmouseenter="enter('-7418475527567976254');" onmouseout="out('-7418475527567976254');" style=""> 146                 if (&quot;webProperty&quot;.equals(trackerName)) {                                                 </span>
<span class="4360254575720880810" onmouseenter="enter('4360254575720880810');" onmouseout="out('4360254575720880810');" style=""><abbr title=" 147                     HttpServletRequest request = BroadleafRequestContext.getBroadleafRequestContext().getRequest();"> 147                     HttpServletRequest request = BroadleafRequestContext.getBroadleafRequestContext().getðŸ”µ</abbr></span>
<span class="-5752363771942989481" onmouseenter="enter('-5752363771942989481');" onmouseout="out('-5752363771942989481');" style=""> 148                     if (request != null) {                                                               </span>
<span class="3853533472488230976" onmouseenter="enter('3853533472488230976');" onmouseout="out('3853533472488230976');" style=""><abbr title=" 149                         Map&lt;String, String&gt; setValuesMap = (Map&lt;String, String&gt;) request.getAttribute(&quot;blGAValuesMap&quot;);"> 149                         Map&lt;String, String&gt; setValuesMap = (Map&lt;String, String&gt;) request.getAttribute(&quot;blðŸ”µ</abbr></span>
<span class="-4910410964255568960" onmouseenter="enter('-4910410964255568960');" onmouseout="out('-4910410964255568960');" style=""> 150                         if (setValuesMap != null) {                                                      </span>
<span class="1796428880304861730" onmouseenter="enter('1796428880304861730');" onmouseout="out('1796428880304861730');" style=""> 151                             for (Map.Entry&lt;String, String&gt; entry : setValuesMap.entrySet()) {            </span>
<span class="6095212434965084893" onmouseenter="enter('6095212434965084893');" onmouseout="out('6095212434965084893');" style=""><abbr title=" 152                                 sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;set&#x27;,&quot;).append(entry.getKey()).append(&quot;,&quot;)"> 152                                 sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;set&#x27;,&quot;).append(entry.getKey()).appendðŸ”µ</abbr></span>
<span class="4491228529456646674" onmouseenter="enter('4491228529456646674');" onmouseout="out('4491228529456646674');" style=""> 153                                         .append(entry.getValue()).append(&quot;);&quot;);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154                             }                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                 }                                                                                        </span>
<span  style=""> 158                                                                                                          </span>
<span class="-4889417558387717970" onmouseenter="enter('-4889417558387717970');" onmouseout="out('-4889417558387717970');" style=""> 159                 sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;send&#x27;, &#x27;pageview&#x27;);&quot;);                               </span>
<span  style=""> 160                                                                                                          </span>
<span class="-1815529951487720795" onmouseenter="enter('-1815529951487720795');" onmouseout="out('-1815529951487720795');" style=""> 161                 if (isIncludeLinkAttribution()) {                                                        </span>
<span class="8560972280490216573" onmouseenter="enter('8560972280490216573');" onmouseout="out('8560972280490216573');" style=""> 162                     sb.append(getLinkAttributionJs(trackerPrefix));                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163                 }                                                                                        </span>
<span class="-7131894736179401387" onmouseenter="enter('-7131894736179401387');" onmouseout="out('-7131894736179401387');" style=""> 164                 if (isIncludeDisplayAdvertising()) {                                                     </span>
<span class="-8416140583577512322" onmouseenter="enter('-8416140583577512322');" onmouseout="out('-8416140583577512322');" style=""> 165                     sb.append(getDisplayAdvertisingJs(trackerPrefix));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166                 }                                                                                        </span>
<span  style=""> 167                                                                                                          </span>
<span class="3398338372153747583" onmouseenter="enter('3398338372153747583');" onmouseout="out('3398338372153747583');" style=""> 168                 if (order != null) {                                                                     </span>
<span class="-6179801228362718003" onmouseenter="enter('-6179801228362718003');" onmouseout="out('-6179801228362718003');" style=""> 169                     sb.append(getTransactionJs(order, trackerPrefix));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171             }                                                                                            </span>
<span  style=""> 172                                                                                                          </span>
<span class="-8412714651221999608" onmouseenter="enter('-8412714651221999608');" onmouseout="out('-8412714651221999608');" style=""> 173             // Add contentNode to the document                                                           </span>
<span class="2586931587804785526" onmouseenter="enter('2586931587804785526');" onmouseout="out('2586931587804785526');" style=""> 174             BroadleafTemplateModel model = context.createModel();                                        </span>
<span class="5956668170328902082" onmouseenter="enter('5956668170328902082');" onmouseout="out('5956668170328902082');" style=""> 175             BroadleafTemplateNonVoidElement scriptTag = context.createNonVoidElement(&quot;script&quot;);          </span>
<span class="-4659749375667028744" onmouseenter="enter('-4659749375667028744');" onmouseout="out('-4659749375667028744');" style=""> 176             BroadleafTemplateElement script = context.createTextElement(sb.toString());                  </span>
<span class="247228039845397848" onmouseenter="enter('247228039845397848');" onmouseout="out('247228039845397848');" style=""> 177             scriptTag.addChild(script);                                                                  </span>
<span class="7450786220544571726" onmouseenter="enter('7450786220544571726');" onmouseout="out('7450786220544571726');" style=""> 178             model.addElement(scriptTag);                                                                 </span>
<span class="1327412617440986435" onmouseenter="enter('1327412617440986435');" onmouseout="out('1327412617440986435');" style=""> 179             return model;                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 180         } else {                                                                                         </span>
<span class="2035563191225573078" onmouseenter="enter('2035563191225573078');" onmouseout="out('2035563191225573078');" style=""><abbr title=" 181             LOG.warn(&quot;No trackers were found, not outputting Google Analytics script. Set the googleAnalytics.webPropertyId&quot;"> 181             LOG.warn(&quot;No trackers were found, not outputting Google Analytics script. Set the googleAnalyðŸ”µ</abbr></span>
<span class="-5815171902766930389" onmouseenter="enter('-5815171902766930389');" onmouseout="out('-5815171902766930389');" style=""><abbr title=" 182                     + &quot; and/or the googleAnalytics.masterWebPropertyId system properties to output Google Analytics&quot;);"> 182                     + &quot; and/or the googleAnalytics.masterWebPropertyId system properties to output GoogleðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183         }                                                                                                </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 184         return null;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185     }                                                                                                    </span>
<span  style=""> 186                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 187     /**                                                                                                  </span>
<span class="4526085554743721537" onmouseenter="enter('4526085554743721537');" onmouseout="out('4526085554743721537');" style=""> 188      * Grabs a map of trackers keyed by the tracker name with the analytics ID as the value              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 189      */                                                                                                  </span>
<span class="-372605794037605079" onmouseenter="enter('-372605794037605079');" onmouseout="out('-372605794037605079');" style=""> 190     protected Map&lt;String, String&gt; getTrackers() {                                                        </span>
<span class="-307639934143605930" onmouseenter="enter('-307639934143605930');" onmouseout="out('-307639934143605930');" style=""> 191         Map&lt;String, String&gt; trackers = new HashMap&lt;&gt;();                                                  </span>
<span class="-7547677911791595799" onmouseenter="enter('-7547677911791595799');" onmouseout="out('-7547677911791595799');" style=""> 192         if (shouldShowMasterTracker()) {                                                                 </span>
<span class="7613356034540080851" onmouseenter="enter('7613356034540080851');" onmouseout="out('7613356034540080851');" style=""> 193             trackers.put(&quot;master&quot;, getMasterWebPropertyId());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194         }                                                                                                </span>
<span class="7457001157732167405" onmouseenter="enter('7457001157732167405');" onmouseout="out('7457001157732167405');" style=""> 195         if (StringUtils.isNotBlank(getWebPropertyId())) {                                                </span>
<span class="-1680205878775740489" onmouseenter="enter('-1680205878775740489');" onmouseout="out('-1680205878775740489');" style=""> 196             trackers.put(&quot;webProperty&quot;, getWebPropertyId());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197         }                                                                                                </span>
<span  style=""> 198                                                                                                          </span>
<span class="7808054229367271940" onmouseenter="enter('7808054229367271940');" onmouseout="out('7808054229367271940');" style=""> 199         return trackers;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200     }                                                                                                    </span>
<span  style=""> 201                                                                                                          </span>
<span class="7201288543731878163" onmouseenter="enter('7201288543731878163');" onmouseout="out('7201288543731878163');" style=""> 202     protected boolean shouldShowMasterTracker() {                                                        </span>
<span class="5354981909841949210" onmouseenter="enter('5354981909841949210');" onmouseout="out('5354981909841949210');" style=""> 203         String masterWebPropertyId = getMasterWebPropertyId();                                           </span>
<span class="-9816468277340784" onmouseenter="enter('-9816468277340784');" onmouseout="out('-9816468277340784');" style=""><abbr title=" 204         return (StringUtils.isNotBlank(masterWebPropertyId) &amp;&amp; (!&quot;UA-XXXXXXX-X&quot;.equals(masterWebPropertyId)));"> 204         return (StringUtils.isNotBlank(masterWebPropertyId) &amp;&amp; (!&quot;UA-XXXXXXX-X&quot;.equals(masterWebPropertyIðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205     }                                                                                                    </span>
<span  style=""> 206                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 207     /**                                                                                                  </span>
<span class="4669840319029639930" onmouseenter="enter('4669840319029639930');" onmouseout="out('4669840319029639930');" style=""> 208      * Builds the linke attribution Javascript                                                           </span>
<span class="8768361991211291337" onmouseenter="enter('8768361991211291337');" onmouseout="out('8768361991211291337');" style=""> 209      * @param tracker the name of the tracker that is using the link attribution                         </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 210      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 211      */                                                                                                  </span>
<span class="-4727062141745445312" onmouseenter="enter('-4727062141745445312');" onmouseout="out('-4727062141745445312');" style=""> 212     protected String getLinkAttributionJs(String trackerPrefix) {                                        </span>
<span class="4641935953841803222" onmouseenter="enter('4641935953841803222');" onmouseout="out('4641935953841803222');" style=""> 213         return &quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;linkid&#x27;, &#x27;linkid.js&#x27;);&quot;;                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214     }                                                                                                    </span>
<span  style=""> 215                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 216     /**                                                                                                  </span>
<span class="-1766163605340550882" onmouseenter="enter('-1766163605340550882');" onmouseout="out('-1766163605340550882');" style=""> 217      * Builds the display advertising Javascript for the given tracker                                   </span>
<span class="7955661006334297359" onmouseenter="enter('7955661006334297359');" onmouseout="out('7955661006334297359');" style=""> 218      * @param tracker                                                                                    </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 219      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 220      */                                                                                                  </span>
<span class="6227360005040256098" onmouseenter="enter('6227360005040256098');" onmouseout="out('6227360005040256098');" style=""> 221     protected String getDisplayAdvertisingJs(String trackerPrefix) {                                     </span>
<span class="3528222762911871195" onmouseenter="enter('3528222762911871195');" onmouseout="out('3528222762911871195');" style=""> 222         return &quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;displayfeatures&#x27;);&quot;;                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223     }                                                                                                    </span>
<span  style=""> 224                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 225     /**                                                                                                  </span>
<span class="6584247125825541487" onmouseenter="enter('6584247125825541487');" onmouseout="out('6584247125825541487');" style=""><abbr title=" 226      * Builds the transaction analytics for the given tracker name. Invokes {@link #getItemJs(Order, String) for each item"> 226      * Builds the transaction analytics for the given tracker name. Invokes {@link #getItemJs(Order, StriðŸ”µ</abbr></span>
<span class="-1936212608501453784" onmouseenter="enter('-1936212608501453784');" onmouseout="out('-1936212608501453784');" style=""> 227      * in the given &lt;b&gt;order&lt;/b&gt;.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 228      */                                                                                                  </span>
<span class="9179487558003409237" onmouseenter="enter('9179487558003409237');" onmouseout="out('9179487558003409237');" style=""> 229     protected String getTransactionJs(Order order, String trackerPrefix) {                               </span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 230         StringBuffer sb = new StringBuffer();                                                            </span>
<span class="1809594812594725377" onmouseenter="enter('1809594812594725377');" onmouseout="out('1809594812594725377');" style=""> 231         sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;ecommerce&#x27;, &#x27;ecommerce.js&#x27;);&quot;);                   </span>
<span  style=""> 232                                                                                                          </span>
<span class="-5012537295569901065" onmouseenter="enter('-5012537295569901065');" onmouseout="out('-5012537295569901065');" style=""> 233         sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:addTransaction&#x27;, {&quot;);                              </span>
<span class="3802939893371272400" onmouseenter="enter('3802939893371272400');" onmouseout="out('3802939893371272400');" style=""> 234         sb.append(&quot;&#x27;id&#x27;: &#x27;&quot; + order.getOrderNumber() + &quot;&#x27;&quot;);                                             </span>
<span class="-4495351553520504059" onmouseenter="enter('-4495351553520504059');" onmouseout="out('-4495351553520504059');" style=""> 235         if (StringUtils.isNotBlank(getAffiliation())) {                                                  </span>
<span class="2598773061427907348" onmouseenter="enter('2598773061427907348');" onmouseout="out('2598773061427907348');" style=""> 236             sb.append(&quot;,&#x27;affiliation&#x27;: &#x27;&quot; + getAffiliation() + &quot;&#x27;&quot;);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237         }                                                                                                </span>
<span class="-1600458020637022538" onmouseenter="enter('-1600458020637022538');" onmouseout="out('-1600458020637022538');" style=""> 238         sb.append(&quot;,&#x27;revenue&#x27;: &#x27;&quot; + order.getTotal() + &quot;&#x27;&quot;);                                             </span>
<span class="-7105820260454958730" onmouseenter="enter('-7105820260454958730');" onmouseout="out('-7105820260454958730');" style=""> 239         sb.append(&quot;,&#x27;shipping&#x27;:&#x27;&quot; + order.getTotalShipping() + &quot;&#x27;&quot;);                                     </span>
<span class="4743629374093034580" onmouseenter="enter('4743629374093034580');" onmouseout="out('4743629374093034580');" style=""> 240         sb.append(&quot;,&#x27;tax&#x27;: &#x27;&quot; + order.getTotalTax() + &quot;&#x27;&quot;);                                              </span>
<span  style=""> 241                                                                                                          </span>
<span class="3530102425606482988" onmouseenter="enter('3530102425606482988');" onmouseout="out('3530102425606482988');" style=""> 242         if (order.getCurrency() != null) {                                                               </span>
<span class="2532172931589873998" onmouseenter="enter('2532172931589873998');" onmouseout="out('2532172931589873998');" style=""> 243             sb.append(&quot;,&#x27;currency&#x27;: &#x27;&quot; + order.getCurrency().getCurrencyCode() + &quot;&#x27;&quot;);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244         }                                                                                                </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 245         sb.append(&quot;});&quot;);                                                                                </span>
<span  style=""> 246                                                                                                          </span>
<span class="-7953667423558098854" onmouseenter="enter('-7953667423558098854');" onmouseout="out('-7953667423558098854');" style=""> 247         sb.append(getItemJs(order, trackerPrefix));                                                      </span>
<span  style=""> 248                                                                                                          </span>
<span class="2925677874169908961" onmouseenter="enter('2925677874169908961');" onmouseout="out('2925677874169908961');" style=""> 249         sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:send&#x27;);&quot;);                                         </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 250         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251     }                                                                                                    </span>
<span  style=""> 252                                                                                                          </span>
<span class="5980134894234571756" onmouseenter="enter('5980134894234571756');" onmouseout="out('5980134894234571756');" style=""> 253     protected String getItemJs(Order order, String trackerPrefix) {                                      </span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 254         StringBuffer sb = new StringBuffer();                                                            </span>
<span class="1072921294238695944" onmouseenter="enter('1072921294238695944');" onmouseout="out('1072921294238695944');" style=""> 255         for (FulfillmentGroup fulfillmentGroup : order.getFulfillmentGroups()) {                         </span>
<span class="7256397867735119446" onmouseenter="enter('7256397867735119446');" onmouseout="out('7256397867735119446');" style=""><abbr title=" 256             for (FulfillmentGroupItem fulfillmentGroupItem : fulfillmentGroup.getFulfillmentGroupItems()) {"> 256             for (FulfillmentGroupItem fulfillmentGroupItem : fulfillmentGroup.getFulfillmentGroupItems())ðŸ”µ</abbr></span>
<span class="6727205496790990336" onmouseenter="enter('6727205496790990336');" onmouseout="out('6727205496790990336');" style=""> 257                 OrderItem orderItem = fulfillmentGroupItem.getOrderItem();                               </span>
<span class="7717622633225589961" onmouseenter="enter('7717622633225589961');" onmouseout="out('7717622633225589961');" style=""> 258                 if (                                                                                     </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 259 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-8154745983362891717" onmouseenter="enter('-8154745983362891717');" onmouseout="out('-8154745983362891717');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 260 SkuAccessor.class.isAssignableFrom(orderItem.getClass())                                                 </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 261 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 262 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 262 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 263 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264                                                                                                          </span>
<span class="-6724727858737155018" onmouseenter="enter('-6724727858737155018');" onmouseout="out('-6724727858737155018');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265 orderItem instanceof DiscreteOrderItem                                                                   </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 266 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-1344992967432647558" onmouseenter="enter('-1344992967432647558');" onmouseout="out('-1344992967432647558');" style=""> 267                 ) {                                                                                      </span>
<span class="-6172013895476531170" onmouseenter="enter('-6172013895476531170');" onmouseout="out('-6172013895476531170');" style=""> 268                     Sku sku = ((SkuAccessor) (orderItem)).getSku();                                      </span>
<span class="7582004005587095303" onmouseenter="enter('7582004005587095303');" onmouseout="out('7582004005587095303');" style=""> 269                     sb.append((&quot;ga(&#x27;&quot; + trackerPrefix) + &quot;ecommerce:addItem&#x27;, {&quot;);                       </span>
<span class="-2865894649025544281" onmouseenter="enter('-2865894649025544281');" onmouseout="out('-2865894649025544281');" style=""> 270                     sb.append((&quot;&#x27;id&#x27;: &#x27;&quot; + order.getOrderNumber()) + &quot;&#x27;&quot;);                               </span>
<span class="4568291095122804898" onmouseenter="enter('4568291095122804898');" onmouseout="out('4568291095122804898');" style=""> 271                     sb.append((&quot;,&#x27;name&#x27;: &#x27;&quot; + sku.getName()) + &quot;&#x27;&quot;);                                     </span>
<span class="-659683989825492011" onmouseenter="enter('-659683989825492011');" onmouseout="out('-659683989825492011');" style=""> 272                     sb.append((&quot;,&#x27;sku&#x27;: &#x27;&quot; + sku.getId()) + &quot;&#x27;&quot;);                                        </span>
<span class="-5794160303885358218" onmouseenter="enter('-5794160303885358218');" onmouseout="out('-5794160303885358218');" style=""> 273                     sb.append((&quot;,&#x27;category&#x27;: &#x27;&quot; + getVariation(orderItem)) + &quot;&#x27;&quot;);                       </span>
<span class="-3008845292389672703" onmouseenter="enter('-3008845292389672703');" onmouseout="out('-3008845292389672703');" style=""> 274                     sb.append((&quot;,&#x27;price&#x27;: &#x27;&quot; + orderItem.getAveragePrice()) + &quot;&#x27;&quot;);                      </span>
<span class="-7237565180330949106" onmouseenter="enter('-7237565180330949106');" onmouseout="out('-7237565180330949106');" style=""> 275                     sb.append((&quot;,&#x27;quantity&#x27;: &#x27;&quot; + orderItem.getQuantity()) + &quot;&#x27;&quot;);                       </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 276                     sb.append(&quot;});&quot;);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 280         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281     }                                                                                                    </span>
<span  style=""> 282                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 283     /**                                                                                                  </span>
<span class="6923647488705566386" onmouseenter="enter('6923647488705566386');" onmouseout="out('6923647488705566386');" style=""> 284      * Returns the product option values separated by a space if they are                                </span>
<span class="1487274611034840884" onmouseenter="enter('1487274611034840884');" onmouseout="out('1487274611034840884');" style=""> 285      * relevant for the item, or the product category if no options are available                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 286      *                                                                                                   </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 287      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 288      */                                                                                                  </span>
<span class="5846271843428503958" onmouseenter="enter('5846271843428503958');" onmouseout="out('5846271843428503958');" style=""> 289     protected String getVariation(OrderItem item) {                                                      </span>
<span class="-1900425779688459231" onmouseenter="enter('-1900425779688459231');" onmouseout="out('-1900425779688459231');" style=""> 290         if (MapUtils.isEmpty(item.getOrderItemAttributes())) {                                           </span>
<span class="-2607232819614252500" onmouseenter="enter('-2607232819614252500');" onmouseout="out('-2607232819614252500');" style=""> 291             return item.getCategory() == null ? &quot;&quot; : item.getCategory().getName();                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292         }                                                                                                </span>
<span  style=""> 293                                                                                                          </span>
<span class="3636026723966887885" onmouseenter="enter('3636026723966887885');" onmouseout="out('3636026723966887885');" style=""> 294         //use product options instead                                                                    </span>
<span class="-3623621045223349277" onmouseenter="enter('-3623621045223349277');" onmouseout="out('-3623621045223349277');" style=""> 295         String result = &quot;&quot;;                                                                              </span>
<span class="-3052053556715064621" onmouseenter="enter('-3052053556715064621');" onmouseout="out('-3052053556715064621');" style=""> 296         for (Map.Entry&lt;String, OrderItemAttribute&gt; entry : item.getOrderItemAttributes().entrySet()) {   </span>
<span class="-7464419131479451077" onmouseenter="enter('-7464419131479451077');" onmouseout="out('-7464419131479451077');" style=""> 297             result += entry.getValue().getValue() + &quot; &quot;;                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298         }                                                                                                </span>
<span  style=""> 299                                                                                                          </span>
<span class="-6864210689922892589" onmouseenter="enter('-6864210689922892589');" onmouseout="out('-6864210689922892589');" style=""> 300         //the result has a space at the end, ensure that is stripped out                                 </span>
<span class="6125747973705988751" onmouseenter="enter('6125747973705988751');" onmouseout="out('6125747973705988751');" style=""> 301         return result.substring(0, result.length() - 1);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302     }                                                                                                    </span>
<span  style=""> 303                                                                                                          </span>
<span class="7688964624751652763" onmouseenter="enter('7688964624751652763');" onmouseout="out('7688964624751652763');" style=""> 304     public String getMasterWebPropertyId() {                                                             </span>
<span class="8804391615898929387" onmouseenter="enter('8804391615898929387');" onmouseout="out('8804391615898929387');" style=""> 305         return masterWebPropertyId;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306     }                                                                                                    </span>
<span  style=""> 307                                                                                                          </span>
<span class="-2978295786667990463" onmouseenter="enter('-2978295786667990463');" onmouseout="out('-2978295786667990463');" style=""> 308     public void setMasterWebPropertyId(String masterWebPropertyId) {                                     </span>
<span class="7918620816210150178" onmouseenter="enter('7918620816210150178');" onmouseout="out('7918620816210150178');" style=""> 309         this.masterWebPropertyId = masterWebPropertyId;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310     }                                                                                                    </span>
<span  style=""> 311                                                                                                          </span>
<span class="6671223003008841723" onmouseenter="enter('6671223003008841723');" onmouseout="out('6671223003008841723');" style=""> 312     public String getAffiliation() {                                                                     </span>
<span class="7807255797153975973" onmouseenter="enter('7807255797153975973');" onmouseout="out('7807255797153975973');" style=""> 313         return BLCSystemProperty.resolveSystemProperty(&quot;googleAnalytics.affiliation&quot;);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314     }                                                                                                    </span>
<span  style=""> 315                                                                                                          </span>
<span class="8203350595237245612" onmouseenter="enter('8203350595237245612');" onmouseout="out('8203350595237245612');" style=""> 316     public String getWebPropertyId() {                                                                   </span>
<span class="850776087520408196" onmouseenter="enter('850776087520408196');" onmouseout="out('850776087520408196');" style=""> 317         return BLCSystemProperty.resolveSystemProperty(&quot;googleAnalytics.webPropertyId&quot;);                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318     }                                                                                                    </span>
<span  style=""> 319                                                                                                          </span>
<span class="825053779558488694" onmouseenter="enter('825053779558488694');" onmouseout="out('825053779558488694');" style=""> 320     public boolean isIncludeLinkAttribution() {                                                          </span>
<span class="5065521424805687131" onmouseenter="enter('5065521424805687131');" onmouseout="out('5065521424805687131');" style=""><abbr title=" 321         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableLinkAttribution&quot;, true);"> 321         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableLinkAttribution&quot;, trðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322     }                                                                                                    </span>
<span  style=""> 323                                                                                                          </span>
<span class="4570506314302342970" onmouseenter="enter('4570506314302342970');" onmouseout="out('4570506314302342970');" style=""> 324     public boolean isIncludeDisplayAdvertising() {                                                       </span>
<span class="-1788412357185885205" onmouseenter="enter('-1788412357185885205');" onmouseout="out('-1788412357185885205');" style=""><abbr title=" 325         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableDisplayAdvertising&quot;, false);"> 325         return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableDisplayAdvertising&quot;,ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327 }                                                                                                        </span>

</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="6211491254187717485" onmouseenter="enter('6211491254187717485');" onmouseout="out('6211491254187717485');" style="">   3   * BroadleafCommerce Framework Web                                                                                </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="-579043521764695224" onmouseenter="enter('-579043521764695224');" onmouseout="out('-579043521764695224');" style="">  18  package org.broadleafcommerce.core.web.processor;                                                                 </span>
<span  style="">  19                                                                                                                    </span>
<span class="4020017653195254006" onmouseenter="enter('4020017653195254006');" onmouseout="out('4020017653195254006');" style="">  20  import org.apache.commons.collections.MapUtils;                                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  24  import org.broadleafcommerce.common.util.BLCSystemProperty;                                                       </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  25  import org.broadleafcommerce.common.web.BroadleafRequestContext;                                                  </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  26  import org.broadleafcommerce.core.catalog.domain.Sku;                                                             </span>

<span class="-6302349778747925467" onmouseenter="enter('-6302349778747925467');" onmouseout="out('-6302349778747925467');" style="">  27  import org.broadleafcommerce.core.order.domain.FulfillmentGroup;                                                  </span>
<span class="-7855842771160128779" onmouseenter="enter('-7855842771160128779');" onmouseout="out('-7855842771160128779');" style="">  28  import org.broadleafcommerce.core.order.domain.FulfillmentGroupItem;                                              </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  29  import org.broadleafcommerce.core.order.domain.Order;                                                             </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  30  import org.broadleafcommerce.core.order.domain.OrderItem;                                                         </span>
<span class="2123683748922877231" onmouseenter="enter('2123683748922877231');" onmouseout="out('2123683748922877231');" style="">  31  import org.broadleafcommerce.core.order.domain.OrderItemAttribute;                                                </span>
<span class="3047856393988054011" onmouseenter="enter('3047856393988054011');" onmouseout="out('3047856393988054011');" style="">  32  import org.broadleafcommerce.core.order.domain.SkuAccessor;                                                       </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  33  import org.broadleafcommerce.core.order.service.OrderService;                                                     </span>
<span class="205237632867733562" onmouseenter="enter('205237632867733562');" onmouseout="out('205237632867733562');" style="">  34  import org.broadleafcommerce.presentation.condition.ConditionalOnTemplating;                                      </span>
<span class="5380655934740542528" onmouseenter="enter('5380655934740542528');" onmouseout="out('5380655934740542528');" style="">  35  import org.broadleafcommerce.presentation.dialect.AbstractBroadleafTagReplacementProcessor;                       </span>
<span class="7486567025810647827" onmouseenter="enter('7486567025810647827');" onmouseout="out('7486567025810647827');" style="">  36  import org.broadleafcommerce.presentation.model.BroadleafTemplateContext;                                         </span>
<span class="-2001850062613906669" onmouseenter="enter('-2001850062613906669');" onmouseout="out('-2001850062613906669');" style="">  37  import org.broadleafcommerce.presentation.model.BroadleafTemplateElement;                                         </span>
<span class="8100767512529469135" onmouseenter="enter('8100767512529469135');" onmouseout="out('8100767512529469135');" style="">  38  import org.broadleafcommerce.presentation.model.BroadleafTemplateModel;                                           </span>
<span class="-6189886993649876021" onmouseenter="enter('-6189886993649876021');" onmouseout="out('-6189886993649876021');" style="">  39  import org.broadleafcommerce.presentation.model.BroadleafTemplateNonVoidElement;                                  </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  40  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  41  import org.springframework.stereotype.Component;                                                                  </span>
<span  style="">  42                                                                                                                    </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  43  import java.util.HashMap;                                                                                         </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  44  import java.util.Map;                                                                                             </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  45  import java.util.Map.Entry;                                                                                       </span>
<span  style="">  46                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  47  import javax.annotation.Resource;                                                                                 </span>
<span class="-2972028083581866805" onmouseenter="enter('-2972028083581866805');" onmouseout="out('-2972028083581866805');" style="">  48  import javax.servlet.http.HttpServletRequest;                                                                     </span>
<span  style="">  49                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50  /**                                                                                                               </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  51   * &lt;p&gt;                                                                                                            </span>
<span class="-143385427104872854" onmouseenter="enter('-143385427104872854');" onmouseout="out('-143385427104872854');" style="">  52   * Takes advantage of the new-stype analytics.js from Google Analytics rather than the deprected ga.js. This also </span>
<span class="-8898438840079886526" onmouseenter="enter('-8898438840079886526');" onmouseout="out('-8898438840079886526');" style=""><abbr title="  53   * supports a pre-processed &lt;b&gt;orderNumber&lt;/b&gt; attribute that can be null, suitable for things like the order confirmation">  53   * supports a pre-processed &lt;b&gt;orderNumber&lt;/b&gt; attribute that can be null, suitable for things like the order confðŸ”µ</abbr></span>
<span class="-7917044275166249545" onmouseenter="enter('-7917044275166249545');" onmouseout="out('-7917044275166249545');" style="">  54   * page to send e-commerce transactions. Example usage:                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  55   *                                                                                                                </span>
<span class="-661354662451427256" onmouseenter="enter('-661354662451427256');" onmouseout="out('-661354662451427256');" style="">  56   * &lt;pre&gt;                                                                                                          </span>
<span class="-7906919746321802108" onmouseenter="enter('-7906919746321802108');" onmouseout="out('-7906919746321802108');" style="">  57   * &amp;lt;google_universal_analytics ordernumber=&quot;${order?.orderNumber&quot; /&amp;gt;                                        </span>
<span class="2390307265644686" onmouseenter="enter('2390307265644686');" onmouseout="out('2390307265644686');" style="">  58   * &lt;/pre&gt;                                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  59   *                                                                                                                </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  60   * &lt;p&gt;                                                                                                            </span>
<span class="8606412176857267386" onmouseenter="enter('8606412176857267386');" onmouseout="out('8606412176857267386');" style="">  61   * This processor also supports:                                                                                  </span>
<span class="2717555647352622731" onmouseenter="enter('2717555647352622731');" onmouseout="out('2717555647352622731');" style="">  62   * &lt;ul&gt;                                                                                                           </span>
<span class="-8530737739149477803" onmouseenter="enter('-8530737739149477803');" onmouseout="out('-8530737739149477803');" style=""><abbr title="  63   *  &lt;li&gt;Multiple trackers (extensible via {@link #getTrackers()} or by setting the {@code googleAnalytics.masterWebPropertyId}">  63   *  &lt;li&gt;Multiple trackers (extensible via {@link #getTrackers()} or by setting the {@code googleAnalytics.masterWeðŸ”µ</abbr></span>
<span class="6265505146874472773" onmouseenter="enter('6265505146874472773');" onmouseout="out('6265505146874472773');" style="">  64   *      and {@code googleAnalytics.webPropertyId})&lt;/li&gt;                                                           </span>
<span class="-6827384770903327510" onmouseenter="enter('-6827384770903327510');" onmouseout="out('-6827384770903327510');" style="">  65   *  &lt;li&gt;Affiliates for e-commerce ({@ googleAnalytics.affiliation property})&lt;/li&gt;                                 </span>
<span class="7100814537211017894" onmouseenter="enter('7100814537211017894');" onmouseout="out('7100814537211017894');" style="">  66   *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/2558867?hl=en&amp;utm_id=ad&quot;&gt;Link attribution&lt;/a&gt;        </span>
<span class="4406549444147281940" onmouseenter="enter('4406549444147281940');" onmouseout="out('4406549444147281940');" style="">  67   *      ({@code googleAnalytics.enableLinkAttribution} system property, default {@code true})&lt;/li&gt;                </span>
<span class="-684988223968504417" onmouseenter="enter('-684988223968504417');" onmouseout="out('-684988223968504417');" style="">  68   *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/3450482&quot;&gt;Display Advertising&lt;/a&gt;                     </span>
<span class="7299106057661310467" onmouseenter="enter('7299106057661310467');" onmouseout="out('7299106057661310467');" style="">  69   *      ({@code googleAnalytics.enableDisplayAdvertising} system property, default {@code false})&lt;/li&gt;            </span>
<span class="599475583152278076" onmouseenter="enter('599475583152278076');" onmouseout="out('599475583152278076');" style="">  70   * &lt;/ul&gt;                                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  71   *                                                                                                                </span>
<span class="630288204851723761" onmouseenter="enter('630288204851723761');" onmouseout="out('630288204851723761');" style="">  72   * @param ordernumber the order number to look up for ecommerce tracking, such as on the confirmation page        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  73   *                                                                                                                </span>
<span class="2670632328160232809" onmouseenter="enter('2670632328160232809');" onmouseout="out('2670632328160232809');" style="">  74   * @author Phillip Verheyden (phillipuniverse)                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  75   */                                                                                                               </span>
<span class="-7627801935997636319" onmouseenter="enter('-7627801935997636319');" onmouseout="out('-7627801935997636319');" style="">  76  @Component(&quot;blGoogleUniversalAnalyticsProcessor&quot;)                                                                 </span>
<span class="7070618034916085721" onmouseenter="enter('7070618034916085721');" onmouseout="out('7070618034916085721');" style="">  77  @ConditionalOnTemplating                                                                                          </span>
<span class="-2399886873569081592" onmouseenter="enter('-2399886873569081592');" onmouseout="out('-2399886873569081592');" style="">  78  public class GoogleUniversalAnalyticsProcessor extends AbstractBroadleafTagReplacementProcessor {                 </span>
<span  style="">  79                                                                                                                    </span>
<span class="4721694570459087610" onmouseenter="enter('4721694570459087610');" onmouseout="out('4721694570459087610');" style="">  80      private static final Log LOG = LogFactory.getLog(GoogleUniversalAnalyticsProcessor.class);                    </span>
<span  style="">  81                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  82      /**                                                                                                           </span>
<span class="5978956812126798070" onmouseenter="enter('5978956812126798070');" onmouseout="out('5978956812126798070');" style="">  83       * Global value, intentionally only retrieved as a file property NOT via the system properties service        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  84       */                                                                                                           </span>
<span class="2486332857350127859" onmouseenter="enter('2486332857350127859');" onmouseout="out('2486332857350127859');" style="">  85      @Value(&quot;${googleAnalytics.masterWebPropertyId}&quot;)                                                              </span>
<span class="8766018855843754021" onmouseenter="enter('8766018855843754021');" onmouseout="out('8766018855843754021');" style="">  86      protected String masterWebPropertyId;                                                                         </span>
<span  style="">  87                                                                                                                    </span>
<span class="-6135682035086935956" onmouseenter="enter('-6135682035086935956');" onmouseout="out('-6135682035086935956');" style="">  88      @Resource(name = &quot;blOrderService&quot;)                                                                            </span>
<span class="4242410752290390693" onmouseenter="enter('4242410752290390693');" onmouseout="out('4242410752290390693');" style="">  89      protected OrderService orderService;                                                                          </span>
<span  style="">  90                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  91      /**                                                                                                           </span>
<span class="-4826553869963905978" onmouseenter="enter('-4826553869963905978');" onmouseout="out('-4826553869963905978');" style="">  92       * This will force the domain to 127.0.0.1 which is useful to determine if the Google Analytics tag is sending</span>
<span class="4379972517565340413" onmouseenter="enter('4379972517565340413');" onmouseout="out('4379972517565340413');" style="">  93       * a request to Google                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  94       */                                                                                                           </span>
<span class="4765817096410164031" onmouseenter="enter('4765817096410164031');" onmouseout="out('4765817096410164031');" style="">  95      @Value(&quot;${googleAnalytics.testLocal}&quot;)                                                                        </span>
<span class="-1900167704265329937" onmouseenter="enter('-1900167704265329937');" onmouseout="out('-1900167704265329937');" style="">  96      protected boolean testLocal = false;                                                                          </span>
<span  style="">  97                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  98      @Override                                                                                                     </span>
<span class="190238665005496725" onmouseenter="enter('190238665005496725');" onmouseout="out('190238665005496725');" style="">  99      public String getName() {                                                                                     </span>
<span class="-8270913471972923893" onmouseenter="enter('-8270913471972923893');" onmouseout="out('-8270913471972923893');" style=""> 100          return &quot;google_universal_analytics&quot;;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101      }                                                                                                             </span>
<span  style=""> 102                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 103      @Override                                                                                                     </span>
<span class="9191046360773473694" onmouseenter="enter('9191046360773473694');" onmouseout="out('9191046360773473694');" style=""> 104      public int getPrecedence() {                                                                                  </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 105          return 0;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106      }                                                                                                             </span>
<span  style=""> 107                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 108      @Override                                                                                                     </span>
<span class="4464809424342535940" onmouseenter="enter('4464809424342535940');" onmouseout="out('4464809424342535940');" style=""><abbr title=" 109      public BroadleafTemplateModel getReplacementModel(String tagName, Map&lt;String, String&gt; tagAttributes, BroadleafTemplateContext context) {"> 109      public BroadleafTemplateModel getReplacementModel(String tagName, Map&lt;String, String&gt; tagAttributes, BroadleafðŸ”µ</abbr></span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 110          StringBuffer sb = new StringBuffer();                                                                     </span>
<span class="2880528239678716865" onmouseenter="enter('2880528239678716865');" onmouseout="out('2880528239678716865');" style=""> 111          Map&lt;String, String&gt; trackers = getTrackers();                                                             </span>
<span class="1433824051485786916" onmouseenter="enter('1433824051485786916');" onmouseout="out('1433824051485786916');" style=""> 112          if (MapUtils.isNotEmpty(trackers)) {                                                                      </span>
<span class="-225159766305017924" onmouseenter="enter('-225159766305017924');" onmouseout="out('-225159766305017924');" style=""> 113              sb.append(&quot;(function(i,s,o,g,r,a,m){i[&#x27;GoogleAnalyticsObject&#x27;]=r;i[r]=i[r]||function(){&quot;);            </span>
<span class="-75534907468996798" onmouseenter="enter('-75534907468996798');" onmouseout="out('-75534907468996798');" style=""> 114              sb.append(&quot;(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),&quot;);          </span>
<span class="787448617478028585" onmouseenter="enter('787448617478028585');" onmouseout="out('787448617478028585');" style=""> 115              sb.append(&quot;m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)&quot;);         </span>
<span class="3709749594906836963" onmouseenter="enter('3709749594906836963');" onmouseout="out('3709749594906836963');" style=""> 116              sb.append(&quot;})(window,document,&#x27;script&#x27;,&#x27;//www.google-analytics.com/analytics.js&#x27;,&#x27;ga&#x27;);&quot;);            </span>
<span  style=""> 117                                                                                                                    </span>
<span class="8350540313808247660" onmouseenter="enter('8350540313808247660');" onmouseout="out('8350540313808247660');" style=""> 118              String orderNumberExpression = tagAttributes.get(&quot;ordernumber&quot;);                                      </span>
<span class="-4116557390625637530" onmouseenter="enter('-4116557390625637530');" onmouseout="out('-4116557390625637530');" style=""> 119              String orderNumber = null;                                                                            </span>
<span class="1554006189045169119" onmouseenter="enter('1554006189045169119');" onmouseout="out('1554006189045169119');" style=""> 120              if (orderNumberExpression != null) {                                                                  </span>
<span class="-8521652288646315683" onmouseenter="enter('-8521652288646315683');" onmouseout="out('-8521652288646315683');" style=""> 121                  orderNumber = (String) context.parseExpression(orderNumberExpression);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122              }                                                                                                     </span>
<span  style=""> 123                                                                                                                    </span>
<span class="-3391477864870857752" onmouseenter="enter('-3391477864870857752');" onmouseout="out('-3391477864870857752');" style=""> 124              Order order = null;                                                                                   </span>
<span class="3032325866360707625" onmouseenter="enter('3032325866360707625');" onmouseout="out('3032325866360707625');" style=""> 125              if (orderNumber != null) {                                                                            </span>
<span class="8749278739372980865" onmouseenter="enter('8749278739372980865');" onmouseout="out('8749278739372980865');" style=""> 126                  order = orderService.findOrderByOrderNumber(orderNumber);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127              }                                                                                                     </span>
<span  style=""> 128                                                                                                                    </span>
<span class="6811598938615422064" onmouseenter="enter('6811598938615422064');" onmouseout="out('6811598938615422064');" style=""> 129              for (Entry&lt;String, String&gt; tracker : trackers.entrySet()) {                                           </span>
<span class="-6082993912017886430" onmouseenter="enter('-6082993912017886430');" onmouseout="out('-6082993912017886430');" style=""> 130                  String trackerName = tracker.getKey();                                                            </span>
<span class="-3120827425834628721" onmouseenter="enter('-3120827425834628721');" onmouseout="out('-3120827425834628721');" style=""> 131                  String trackerPrefix = &quot;&quot;;                                                                        </span>
<span class="7019647018974662667" onmouseenter="enter('7019647018974662667');" onmouseout="out('7019647018974662667');" style=""> 132                  String id = tracker.getValue();                                                                   </span>
<span class="3011142644875223402" onmouseenter="enter('3011142644875223402');" onmouseout="out('3011142644875223402');" style=""> 133                  sb.append(&quot;ga(&#x27;create&#x27;, &#x27;&quot; + id + &quot;&#x27;, &#x27;auto&#x27;, {&quot;);                                                </span>
<span  style=""> 134                                                                                                                    </span>
<span class="3839128902332571680" onmouseenter="enter('3839128902332571680');" onmouseout="out('3839128902332571680');" style=""> 135                  if (!&quot;webProperty&quot;.equals(trackerName)) {                                                         </span>
<span class="-7426441914050405472" onmouseenter="enter('-7426441914050405472');" onmouseout="out('-7426441914050405472');" style=""> 136                      trackerPrefix = trackerName + &quot;.&quot;;                                                            </span>
<span class="-3973100567386912971" onmouseenter="enter('-3973100567386912971');" onmouseout="out('-3973100567386912971');" style=""> 137                      sb.append(&quot;&#x27;name&#x27;: &#x27;&quot; + trackerName + &quot;&#x27;&quot;);                                                   </span>
<span class="3293478056291787725" onmouseenter="enter('3293478056291787725');" onmouseout="out('3293478056291787725');" style=""> 138                      if (testLocal) {                                                                              </span>
<span class="6725018595534739120" onmouseenter="enter('6725018595534739120');" onmouseout="out('6725018595534739120');" style=""> 139                          sb.append(&quot;,&quot;);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141                  }                                                                                                 </span>
<span class="3293478056291787725" onmouseenter="enter('3293478056291787725');" onmouseout="out('3293478056291787725');" style=""> 142                  if (testLocal) {                                                                                  </span>
<span class="-3353602519532140774" onmouseenter="enter('-3353602519532140774');" onmouseout="out('-3353602519532140774');" style=""> 143                      sb.append(&quot;&#x27;cookieDomain&#x27;: &#x27;none&#x27;&quot;);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144                  }                                                                                                 </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 145                  sb.append(&quot;});&quot;);                                                                                 </span>
<span  style=""> 146                                                                                                                    </span>
<span class="-7418475527567976254" onmouseenter="enter('-7418475527567976254');" onmouseout="out('-7418475527567976254');" style=""> 147                  if (&quot;webProperty&quot;.equals(trackerName)) {                                                          </span>
<span class="4360254575720880810" onmouseenter="enter('4360254575720880810');" onmouseout="out('4360254575720880810');" style=""><abbr title=" 148                      HttpServletRequest request = BroadleafRequestContext.getBroadleafRequestContext().getRequest();"> 148                      HttpServletRequest request = BroadleafRequestContext.getBroadleafRequestContext().getRequest()ðŸ”µ</abbr></span>
<span class="-5752363771942989481" onmouseenter="enter('-5752363771942989481');" onmouseout="out('-5752363771942989481');" style=""> 149                      if (request != null) {                                                                        </span>
<span class="3853533472488230976" onmouseenter="enter('3853533472488230976');" onmouseout="out('3853533472488230976');" style=""><abbr title=" 150                          Map&lt;String, String&gt; setValuesMap = (Map&lt;String, String&gt;) request.getAttribute(&quot;blGAValuesMap&quot;);"> 150                          Map&lt;String, String&gt; setValuesMap = (Map&lt;String, String&gt;) request.getAttribute(&quot;blGAValuesMðŸ”µ</abbr></span>
<span class="-4910410964255568960" onmouseenter="enter('-4910410964255568960');" onmouseout="out('-4910410964255568960');" style=""> 151                          if (setValuesMap != null) {                                                               </span>
<span class="1796428880304861730" onmouseenter="enter('1796428880304861730');" onmouseout="out('1796428880304861730');" style=""> 152                              for (Map.Entry&lt;String, String&gt; entry : setValuesMap.entrySet()) {                     </span>
<span class="6095212434965084893" onmouseenter="enter('6095212434965084893');" onmouseout="out('6095212434965084893');" style=""> 153                                  sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;set&#x27;,&quot;).append(entry.getKey()).append(&quot;,&quot;)    </span>
<span class="4491228529456646674" onmouseenter="enter('4491228529456646674');" onmouseout="out('4491228529456646674');" style=""> 154                                          .append(entry.getValue()).append(&quot;);&quot;);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158                  }                                                                                                 </span>
<span  style=""> 159                                                                                                                    </span>
<span class="-4889417558387717970" onmouseenter="enter('-4889417558387717970');" onmouseout="out('-4889417558387717970');" style=""> 160                  sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;send&#x27;, &#x27;pageview&#x27;);&quot;);                                        </span>
<span  style=""> 161                                                                                                                    </span>
<span class="-1815529951487720795" onmouseenter="enter('-1815529951487720795');" onmouseout="out('-1815529951487720795');" style=""> 162                  if (isIncludeLinkAttribution()) {                                                                 </span>
<span class="8560972280490216573" onmouseenter="enter('8560972280490216573');" onmouseout="out('8560972280490216573');" style=""> 163                      sb.append(getLinkAttributionJs(trackerPrefix));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164                  }                                                                                                 </span>
<span class="-7131894736179401387" onmouseenter="enter('-7131894736179401387');" onmouseout="out('-7131894736179401387');" style=""> 165                  if (isIncludeDisplayAdvertising()) {                                                              </span>
<span class="-8416140583577512322" onmouseenter="enter('-8416140583577512322');" onmouseout="out('-8416140583577512322');" style=""> 166                      sb.append(getDisplayAdvertisingJs(trackerPrefix));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167                  }                                                                                                 </span>
<span  style=""> 168                                                                                                                    </span>
<span class="3398338372153747583" onmouseenter="enter('3398338372153747583');" onmouseout="out('3398338372153747583');" style=""> 169                  if (order != null) {                                                                              </span>
<span class="-6179801228362718003" onmouseenter="enter('-6179801228362718003');" onmouseout="out('-6179801228362718003');" style=""> 170                      sb.append(getTransactionJs(order, trackerPrefix));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172              }                                                                                                     </span>
<span  style=""> 173                                                                                                                    </span>
<span class="-8412714651221999608" onmouseenter="enter('-8412714651221999608');" onmouseout="out('-8412714651221999608');" style=""> 174              // Add contentNode to the document                                                                    </span>
<span class="2586931587804785526" onmouseenter="enter('2586931587804785526');" onmouseout="out('2586931587804785526');" style=""> 175              BroadleafTemplateModel model = context.createModel();                                                 </span>
<span class="5956668170328902082" onmouseenter="enter('5956668170328902082');" onmouseout="out('5956668170328902082');" style=""> 176              BroadleafTemplateNonVoidElement scriptTag = context.createNonVoidElement(&quot;script&quot;);                   </span>
<span class="-4659749375667028744" onmouseenter="enter('-4659749375667028744');" onmouseout="out('-4659749375667028744');" style=""> 177              BroadleafTemplateElement script = context.createTextElement(sb.toString());                           </span>
<span class="247228039845397848" onmouseenter="enter('247228039845397848');" onmouseout="out('247228039845397848');" style=""> 178              scriptTag.addChild(script);                                                                           </span>
<span class="7450786220544571726" onmouseenter="enter('7450786220544571726');" onmouseout="out('7450786220544571726');" style=""> 179              model.addElement(scriptTag);                                                                          </span>
<span class="1327412617440986435" onmouseenter="enter('1327412617440986435');" onmouseout="out('1327412617440986435');" style=""> 180              return model;                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 181          } else {                                                                                                  </span>
<span class="2035563191225573078" onmouseenter="enter('2035563191225573078');" onmouseout="out('2035563191225573078');" style=""><abbr title=" 182              LOG.warn(&quot;No trackers were found, not outputting Google Analytics script. Set the googleAnalytics.webPropertyId&quot;"> 182              LOG.warn(&quot;No trackers were found, not outputting Google Analytics script. Set the googleAnalytics.webPðŸ”µ</abbr></span>
<span class="-5815171902766930389" onmouseenter="enter('-5815171902766930389');" onmouseout="out('-5815171902766930389');" style=""><abbr title=" 183                      + &quot; and/or the googleAnalytics.masterWebPropertyId system properties to output Google Analytics&quot;);"> 183                      + &quot; and/or the googleAnalytics.masterWebPropertyId system properties to output Google AnalyticðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 185          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186      }                                                                                                             </span>
<span  style=""> 187                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 188      /**                                                                                                           </span>
<span class="4526085554743721537" onmouseenter="enter('4526085554743721537');" onmouseout="out('4526085554743721537');" style=""> 189       * Grabs a map of trackers keyed by the tracker name with the analytics ID as the value                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 190       */                                                                                                           </span>
<span class="-372605794037605079" onmouseenter="enter('-372605794037605079');" onmouseout="out('-372605794037605079');" style=""> 191      protected Map&lt;String, String&gt; getTrackers() {                                                                 </span>
<span class="-307639934143605930" onmouseenter="enter('-307639934143605930');" onmouseout="out('-307639934143605930');" style=""> 192          Map&lt;String, String&gt; trackers = new HashMap&lt;&gt;();                                                           </span>
<span class="-7547677911791595799" onmouseenter="enter('-7547677911791595799');" onmouseout="out('-7547677911791595799');" style=""> 193          if (shouldShowMasterTracker()) {                                                                          </span>
<span class="7613356034540080851" onmouseenter="enter('7613356034540080851');" onmouseout="out('7613356034540080851');" style=""> 194              trackers.put(&quot;master&quot;, getMasterWebPropertyId());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195          }                                                                                                         </span>
<span class="7457001157732167405" onmouseenter="enter('7457001157732167405');" onmouseout="out('7457001157732167405');" style=""> 196          if (StringUtils.isNotBlank(getWebPropertyId())) {                                                         </span>
<span class="-1680205878775740489" onmouseenter="enter('-1680205878775740489');" onmouseout="out('-1680205878775740489');" style=""> 197              trackers.put(&quot;webProperty&quot;, getWebPropertyId());                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198          }                                                                                                         </span>
<span  style=""> 199                                                                                                                    </span>
<span class="7808054229367271940" onmouseenter="enter('7808054229367271940');" onmouseout="out('7808054229367271940');" style=""> 200          return trackers;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201      }                                                                                                             </span>
<span  style=""> 202                                                                                                                    </span>
<span class="7201288543731878163" onmouseenter="enter('7201288543731878163');" onmouseout="out('7201288543731878163');" style=""> 203      protected boolean shouldShowMasterTracker() {                                                                 </span>
<span class="5354981909841949210" onmouseenter="enter('5354981909841949210');" onmouseout="out('5354981909841949210');" style=""> 204          String masterWebPropertyId = getMasterWebPropertyId();                                                    </span>
<span class="-9816468277340784" onmouseenter="enter('-9816468277340784');" onmouseout="out('-9816468277340784');" style=""> 205          return (StringUtils.isNotBlank(masterWebPropertyId) &amp;&amp; (!&quot;UA-XXXXXXX-X&quot;.equals(masterWebPropertyId)));    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206      }                                                                                                             </span>
<span  style=""> 207                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 208      /**                                                                                                           </span>
<span class="4669840319029639930" onmouseenter="enter('4669840319029639930');" onmouseout="out('4669840319029639930');" style=""> 209       * Builds the linke attribution Javascript                                                                    </span>
<span class="8768361991211291337" onmouseenter="enter('8768361991211291337');" onmouseout="out('8768361991211291337');" style=""> 210       * @param tracker the name of the tracker that is using the link attribution                                  </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 211       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 212       */                                                                                                           </span>
<span class="-4727062141745445312" onmouseenter="enter('-4727062141745445312');" onmouseout="out('-4727062141745445312');" style=""> 213      protected String getLinkAttributionJs(String trackerPrefix) {                                                 </span>
<span class="4641935953841803222" onmouseenter="enter('4641935953841803222');" onmouseout="out('4641935953841803222');" style=""> 214          return &quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;linkid&#x27;, &#x27;linkid.js&#x27;);&quot;;                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215      }                                                                                                             </span>
<span  style=""> 216                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 217      /**                                                                                                           </span>
<span class="-1766163605340550882" onmouseenter="enter('-1766163605340550882');" onmouseout="out('-1766163605340550882');" style=""> 218       * Builds the display advertising Javascript for the given tracker                                            </span>
<span class="7955661006334297359" onmouseenter="enter('7955661006334297359');" onmouseout="out('7955661006334297359');" style=""> 219       * @param tracker                                                                                             </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 220       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 221       */                                                                                                           </span>
<span class="6227360005040256098" onmouseenter="enter('6227360005040256098');" onmouseout="out('6227360005040256098');" style=""> 222      protected String getDisplayAdvertisingJs(String trackerPrefix) {                                              </span>
<span class="3528222762911871195" onmouseenter="enter('3528222762911871195');" onmouseout="out('3528222762911871195');" style=""> 223          return &quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;displayfeatures&#x27;);&quot;;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224      }                                                                                                             </span>
<span  style=""> 225                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 226      /**                                                                                                           </span>
<span class="6584247125825541487" onmouseenter="enter('6584247125825541487');" onmouseout="out('6584247125825541487');" style=""><abbr title=" 227       * Builds the transaction analytics for the given tracker name. Invokes {@link #getItemJs(Order, String) for each item"> 227       * Builds the transaction analytics for the given tracker name. Invokes {@link #getItemJs(Order, String) for eðŸ”µ</abbr></span>
<span class="-1936212608501453784" onmouseenter="enter('-1936212608501453784');" onmouseout="out('-1936212608501453784');" style=""> 228       * in the given &lt;b&gt;order&lt;/b&gt;.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 229       */                                                                                                           </span>
<span class="9179487558003409237" onmouseenter="enter('9179487558003409237');" onmouseout="out('9179487558003409237');" style=""> 230      protected String getTransactionJs(Order order, String trackerPrefix) {                                        </span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 231          StringBuffer sb = new StringBuffer();                                                                     </span>
<span class="1809594812594725377" onmouseenter="enter('1809594812594725377');" onmouseout="out('1809594812594725377');" style=""> 232          sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;ecommerce&#x27;, &#x27;ecommerce.js&#x27;);&quot;);                            </span>
<span  style=""> 233                                                                                                                    </span>
<span class="-5012537295569901065" onmouseenter="enter('-5012537295569901065');" onmouseout="out('-5012537295569901065');" style=""> 234          sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:addTransaction&#x27;, {&quot;);                                       </span>
<span class="3802939893371272400" onmouseenter="enter('3802939893371272400');" onmouseout="out('3802939893371272400');" style=""> 235          sb.append(&quot;&#x27;id&#x27;: &#x27;&quot; + order.getOrderNumber() + &quot;&#x27;&quot;);                                                      </span>
<span class="-4495351553520504059" onmouseenter="enter('-4495351553520504059');" onmouseout="out('-4495351553520504059');" style=""> 236          if (StringUtils.isNotBlank(getAffiliation())) {                                                           </span>
<span class="2598773061427907348" onmouseenter="enter('2598773061427907348');" onmouseout="out('2598773061427907348');" style=""> 237              sb.append(&quot;,&#x27;affiliation&#x27;: &#x27;&quot; + getAffiliation() + &quot;&#x27;&quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238          }                                                                                                         </span>
<span class="-1600458020637022538" onmouseenter="enter('-1600458020637022538');" onmouseout="out('-1600458020637022538');" style=""> 239          sb.append(&quot;,&#x27;revenue&#x27;: &#x27;&quot; + order.getTotal() + &quot;&#x27;&quot;);                                                      </span>
<span class="-7105820260454958730" onmouseenter="enter('-7105820260454958730');" onmouseout="out('-7105820260454958730');" style=""> 240          sb.append(&quot;,&#x27;shipping&#x27;:&#x27;&quot; + order.getTotalShipping() + &quot;&#x27;&quot;);                                              </span>
<span class="4743629374093034580" onmouseenter="enter('4743629374093034580');" onmouseout="out('4743629374093034580');" style=""> 241          sb.append(&quot;,&#x27;tax&#x27;: &#x27;&quot; + order.getTotalTax() + &quot;&#x27;&quot;);                                                       </span>
<span  style=""> 242                                                                                                                    </span>
<span class="3530102425606482988" onmouseenter="enter('3530102425606482988');" onmouseout="out('3530102425606482988');" style=""> 243          if (order.getCurrency() != null) {                                                                        </span>
<span class="2532172931589873998" onmouseenter="enter('2532172931589873998');" onmouseout="out('2532172931589873998');" style=""> 244              sb.append(&quot;,&#x27;currency&#x27;: &#x27;&quot; + order.getCurrency().getCurrencyCode() + &quot;&#x27;&quot;);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245          }                                                                                                         </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 246          sb.append(&quot;});&quot;);                                                                                         </span>
<span  style=""> 247                                                                                                                    </span>
<span class="-7953667423558098854" onmouseenter="enter('-7953667423558098854');" onmouseout="out('-7953667423558098854');" style=""> 248          sb.append(getItemJs(order, trackerPrefix));                                                               </span>
<span  style=""> 249                                                                                                                    </span>
<span class="2925677874169908961" onmouseenter="enter('2925677874169908961');" onmouseout="out('2925677874169908961');" style=""> 250          sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:send&#x27;);&quot;);                                                  </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 251          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252      }                                                                                                             </span>
<span  style=""> 253                                                                                                                    </span>
<span class="5980134894234571756" onmouseenter="enter('5980134894234571756');" onmouseout="out('5980134894234571756');" style=""> 254      protected String getItemJs(Order order, String trackerPrefix) {                                               </span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 255          StringBuffer sb = new StringBuffer();                                                                     </span>
<span class="1072921294238695944" onmouseenter="enter('1072921294238695944');" onmouseout="out('1072921294238695944');" style=""> 256          for (FulfillmentGroup fulfillmentGroup : order.getFulfillmentGroups()) {                                  </span>
<span class="7256397867735119446" onmouseenter="enter('7256397867735119446');" onmouseout="out('7256397867735119446');" style=""> 257              for (FulfillmentGroupItem fulfillmentGroupItem : fulfillmentGroup.getFulfillmentGroupItems()) {       </span>
<span class="6727205496790990336" onmouseenter="enter('6727205496790990336');" onmouseout="out('6727205496790990336');" style=""> 258                  OrderItem orderItem = fulfillmentGroupItem.getOrderItem();                                        </span>
<span  style=""> 259                                                                                                                    </span>
<span class="-4497171920864475683" onmouseenter="enter('-4497171920864475683');" onmouseout="out('-4497171920864475683');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 260 -                Sku sku = ((SkuAccessor) orderItem).getSku();                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 261 -                                                                                                                  </span>
<span class="-8613458593272541119" onmouseenter="enter('-8613458593272541119');" onmouseout="out('-8613458593272541119');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 262 -                sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:addItem&#x27;, {&quot;);                                      </span>
<span class="3802939893371272400" onmouseenter="enter('3802939893371272400');" onmouseout="out('3802939893371272400');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 263 -                sb.append(&quot;&#x27;id&#x27;: &#x27;&quot; + order.getOrderNumber() + &quot;&#x27;&quot;);                                              </span>
<span class="-887663243915190383" onmouseenter="enter('-887663243915190383');" onmouseout="out('-887663243915190383');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 264 -                sb.append(&quot;,&#x27;name&#x27;: &#x27;&quot; + sku.getName() + &quot;&#x27;&quot;);                                                    </span>
<span class="-7742482896330545050" onmouseenter="enter('-7742482896330545050');" onmouseout="out('-7742482896330545050');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 265 -                sb.append(&quot;,&#x27;sku&#x27;: &#x27;&quot; + sku.getId() + &quot;&#x27;&quot;);                                                       </span>
<span class="-1605838225351785854" onmouseenter="enter('-1605838225351785854');" onmouseout="out('-1605838225351785854');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 266 -                sb.append(&quot;,&#x27;category&#x27;: &#x27;&quot; + getVariation(orderItem) + &quot;&#x27;&quot;);                                      </span>
<span class="-4039856411666157290" onmouseenter="enter('-4039856411666157290');" onmouseout="out('-4039856411666157290');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 267 -                sb.append(&quot;,&#x27;price&#x27;: &#x27;&quot; + orderItem.getAveragePrice() + &quot;&#x27;&quot;);                                     </span>
<span class="-6864347081607696224" onmouseenter="enter('-6864347081607696224');" onmouseout="out('-6864347081607696224');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 268 -                sb.append(&quot;,&#x27;quantity&#x27;: &#x27;&quot; + orderItem.getQuantity() + &quot;&#x27;&quot;);                                      </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 269 -                sb.append(&quot;});&quot;);                                                                                 </span>
<span class="-7078716540017248808" onmouseenter="enter('-7078716540017248808');" onmouseout="out('-7078716540017248808');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +                if (SkuAccessor.class.isAssignableFrom(orderItem.getClass())) {                                   </span>
<span class="-4497171920864475683" onmouseenter="enter('-4497171920864475683');" onmouseout="out('-4497171920864475683');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +                    Sku sku = ((SkuAccessor) orderItem).getSku();                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 272 +                                                                                                                  </span>
<span class="-8613458593272541119" onmouseenter="enter('-8613458593272541119');" onmouseout="out('-8613458593272541119');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 273 +                    sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:addItem&#x27;, {&quot;);                                  </span>
<span class="3802939893371272400" onmouseenter="enter('3802939893371272400');" onmouseout="out('3802939893371272400');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 274 +                    sb.append(&quot;&#x27;id&#x27;: &#x27;&quot; + order.getOrderNumber() + &quot;&#x27;&quot;);                                          </span>
<span class="-887663243915190383" onmouseenter="enter('-887663243915190383');" onmouseout="out('-887663243915190383');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 275 +                    sb.append(&quot;,&#x27;name&#x27;: &#x27;&quot; + sku.getName() + &quot;&#x27;&quot;);                                                </span>
<span class="-7742482896330545050" onmouseenter="enter('-7742482896330545050');" onmouseout="out('-7742482896330545050');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 276 +                    sb.append(&quot;,&#x27;sku&#x27;: &#x27;&quot; + sku.getId() + &quot;&#x27;&quot;);                                                   </span>
<span class="-1605838225351785854" onmouseenter="enter('-1605838225351785854');" onmouseout="out('-1605838225351785854');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +                    sb.append(&quot;,&#x27;category&#x27;: &#x27;&quot; + getVariation(orderItem) + &quot;&#x27;&quot;);                                  </span>
<span class="-4039856411666157290" onmouseenter="enter('-4039856411666157290');" onmouseout="out('-4039856411666157290');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 278 +                    sb.append(&quot;,&#x27;price&#x27;: &#x27;&quot; + orderItem.getAveragePrice() + &quot;&#x27;&quot;);                                 </span>
<span class="-6864347081607696224" onmouseenter="enter('-6864347081607696224');" onmouseout="out('-6864347081607696224');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 279 +                    sb.append(&quot;,&#x27;quantity&#x27;: &#x27;&quot; + orderItem.getQuantity() + &quot;&#x27;&quot;);                                  </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 280 +                    sb.append(&quot;});&quot;);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 281 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283          }                                                                                                         </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 284          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285      }                                                                                                             </span>
<span  style=""> 286                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 287      /**                                                                                                           </span>
<span class="6923647488705566386" onmouseenter="enter('6923647488705566386');" onmouseout="out('6923647488705566386');" style=""> 288       * Returns the product option values separated by a space if they are                                         </span>
<span class="1487274611034840884" onmouseenter="enter('1487274611034840884');" onmouseout="out('1487274611034840884');" style=""> 289       * relevant for the item, or the product category if no options are available                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 290       *                                                                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 291       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 292       */                                                                                                           </span>
<span class="5846271843428503958" onmouseenter="enter('5846271843428503958');" onmouseout="out('5846271843428503958');" style=""> 293      protected String getVariation(OrderItem item) {                                                               </span>
<span class="-1900425779688459231" onmouseenter="enter('-1900425779688459231');" onmouseout="out('-1900425779688459231');" style=""> 294          if (MapUtils.isEmpty(item.getOrderItemAttributes())) {                                                    </span>
<span class="-2607232819614252500" onmouseenter="enter('-2607232819614252500');" onmouseout="out('-2607232819614252500');" style=""> 295              return item.getCategory() == null ? &quot;&quot; : item.getCategory().getName();                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296          }                                                                                                         </span>
<span  style=""> 297                                                                                                                    </span>
<span class="3636026723966887885" onmouseenter="enter('3636026723966887885');" onmouseout="out('3636026723966887885');" style=""> 298          //use product options instead                                                                             </span>
<span class="-3623621045223349277" onmouseenter="enter('-3623621045223349277');" onmouseout="out('-3623621045223349277');" style=""> 299          String result = &quot;&quot;;                                                                                       </span>
<span class="-3052053556715064621" onmouseenter="enter('-3052053556715064621');" onmouseout="out('-3052053556715064621');" style=""> 300          for (Map.Entry&lt;String, OrderItemAttribute&gt; entry : item.getOrderItemAttributes().entrySet()) {            </span>
<span class="-7464419131479451077" onmouseenter="enter('-7464419131479451077');" onmouseout="out('-7464419131479451077');" style=""> 301              result += entry.getValue().getValue() + &quot; &quot;;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302          }                                                                                                         </span>
<span  style=""> 303                                                                                                                    </span>
<span class="-6864210689922892589" onmouseenter="enter('-6864210689922892589');" onmouseout="out('-6864210689922892589');" style=""> 304          //the result has a space at the end, ensure that is stripped out                                          </span>
<span class="6125747973705988751" onmouseenter="enter('6125747973705988751');" onmouseout="out('6125747973705988751');" style=""> 305          return result.substring(0, result.length() - 1);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306      }                                                                                                             </span>
<span  style=""> 307                                                                                                                    </span>
<span class="7688964624751652763" onmouseenter="enter('7688964624751652763');" onmouseout="out('7688964624751652763');" style=""> 308      public String getMasterWebPropertyId() {                                                                      </span>
<span class="8804391615898929387" onmouseenter="enter('8804391615898929387');" onmouseout="out('8804391615898929387');" style=""> 309          return masterWebPropertyId;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310      }                                                                                                             </span>
<span  style=""> 311                                                                                                                    </span>
<span class="-2978295786667990463" onmouseenter="enter('-2978295786667990463');" onmouseout="out('-2978295786667990463');" style=""> 312      public void setMasterWebPropertyId(String masterWebPropertyId) {                                              </span>
<span class="7918620816210150178" onmouseenter="enter('7918620816210150178');" onmouseout="out('7918620816210150178');" style=""> 313          this.masterWebPropertyId = masterWebPropertyId;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314      }                                                                                                             </span>
<span  style=""> 315                                                                                                                    </span>
<span class="6671223003008841723" onmouseenter="enter('6671223003008841723');" onmouseout="out('6671223003008841723');" style=""> 316      public String getAffiliation() {                                                                              </span>
<span class="7807255797153975973" onmouseenter="enter('7807255797153975973');" onmouseout="out('7807255797153975973');" style=""> 317          return BLCSystemProperty.resolveSystemProperty(&quot;googleAnalytics.affiliation&quot;);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318      }                                                                                                             </span>
<span  style=""> 319                                                                                                                    </span>
<span class="8203350595237245612" onmouseenter="enter('8203350595237245612');" onmouseout="out('8203350595237245612');" style=""> 320      public String getWebPropertyId() {                                                                            </span>
<span class="850776087520408196" onmouseenter="enter('850776087520408196');" onmouseout="out('850776087520408196');" style=""> 321          return BLCSystemProperty.resolveSystemProperty(&quot;googleAnalytics.webPropertyId&quot;);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322      }                                                                                                             </span>
<span  style=""> 323                                                                                                                    </span>
<span class="825053779558488694" onmouseenter="enter('825053779558488694');" onmouseout="out('825053779558488694');" style=""> 324      public boolean isIncludeLinkAttribution() {                                                                   </span>
<span class="5065521424805687131" onmouseenter="enter('5065521424805687131');" onmouseout="out('5065521424805687131');" style=""> 325          return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableLinkAttribution&quot;, true);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326      }                                                                                                             </span>
<span  style=""> 327                                                                                                                    </span>
<span class="4570506314302342970" onmouseenter="enter('4570506314302342970');" onmouseout="out('4570506314302342970');" style=""> 328      public boolean isIncludeDisplayAdvertising() {                                                                </span>
<span class="-1788412357185885205" onmouseenter="enter('-1788412357185885205');" onmouseout="out('-1788412357185885205');" style=""> 329          return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableDisplayAdvertising&quot;, false); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330      }                                                                                                             </span>
<span  style=""> 331                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="6211491254187717485" onmouseenter="enter('6211491254187717485');" onmouseout="out('6211491254187717485');" style="">   3   * BroadleafCommerce Framework Web                                                                                </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="-579043521764695224" onmouseenter="enter('-579043521764695224');" onmouseout="out('-579043521764695224');" style="">  18  package org.broadleafcommerce.core.web.processor;                                                                 </span>
<span  style="">  19                                                                                                                    </span>
<span class="4020017653195254006" onmouseenter="enter('4020017653195254006');" onmouseout="out('4020017653195254006');" style="">  20  import org.apache.commons.collections.MapUtils;                                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  21  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="494203924075255110" onmouseenter="enter('494203924075255110');" onmouseout="out('494203924075255110');" style="">  22  import org.apache.commons.logging.Log;                                                                            </span>
<span class="-8227491862907452788" onmouseenter="enter('-8227491862907452788');" onmouseout="out('-8227491862907452788');" style="">  23  import org.apache.commons.logging.LogFactory;                                                                     </span>
<span class="4862799527593989873" onmouseenter="enter('4862799527593989873');" onmouseout="out('4862799527593989873');" style="">  24  import org.broadleafcommerce.common.util.BLCSystemProperty;                                                       </span>
<span class="8689743329875302887" onmouseenter="enter('8689743329875302887');" onmouseout="out('8689743329875302887');" style="">  25  import org.broadleafcommerce.common.web.BroadleafRequestContext;                                                  </span>
<span class="550063679509398140" onmouseenter="enter('550063679509398140');" onmouseout="out('550063679509398140');" style="">  26  import org.broadleafcommerce.core.catalog.domain.Sku;                                                             </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  27 +import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                                 </span>
<span class="-6302349778747925467" onmouseenter="enter('-6302349778747925467');" onmouseout="out('-6302349778747925467');" style="">  28  import org.broadleafcommerce.core.order.domain.FulfillmentGroup;                                                  </span>
<span class="-7855842771160128779" onmouseenter="enter('-7855842771160128779');" onmouseout="out('-7855842771160128779');" style="">  29  import org.broadleafcommerce.core.order.domain.FulfillmentGroupItem;                                              </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  30  import org.broadleafcommerce.core.order.domain.Order;                                                             </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  31  import org.broadleafcommerce.core.order.domain.OrderItem;                                                         </span>
<span class="2123683748922877231" onmouseenter="enter('2123683748922877231');" onmouseout="out('2123683748922877231');" style="">  32  import org.broadleafcommerce.core.order.domain.OrderItemAttribute;                                                </span>
<span class="3047856393988054011" onmouseenter="enter('3047856393988054011');" onmouseout="out('3047856393988054011');" style="">  33  import org.broadleafcommerce.core.order.domain.SkuAccessor;                                                       </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  34  import org.broadleafcommerce.core.order.service.OrderService;                                                     </span>
<span class="205237632867733562" onmouseenter="enter('205237632867733562');" onmouseout="out('205237632867733562');" style="">  35  import org.broadleafcommerce.presentation.condition.ConditionalOnTemplating;                                      </span>
<span class="5380655934740542528" onmouseenter="enter('5380655934740542528');" onmouseout="out('5380655934740542528');" style="">  36  import org.broadleafcommerce.presentation.dialect.AbstractBroadleafTagReplacementProcessor;                       </span>
<span class="7486567025810647827" onmouseenter="enter('7486567025810647827');" onmouseout="out('7486567025810647827');" style="">  37  import org.broadleafcommerce.presentation.model.BroadleafTemplateContext;                                         </span>
<span class="-2001850062613906669" onmouseenter="enter('-2001850062613906669');" onmouseout="out('-2001850062613906669');" style="">  38  import org.broadleafcommerce.presentation.model.BroadleafTemplateElement;                                         </span>
<span class="8100767512529469135" onmouseenter="enter('8100767512529469135');" onmouseout="out('8100767512529469135');" style="">  39  import org.broadleafcommerce.presentation.model.BroadleafTemplateModel;                                           </span>
<span class="-6189886993649876021" onmouseenter="enter('-6189886993649876021');" onmouseout="out('-6189886993649876021');" style="">  40  import org.broadleafcommerce.presentation.model.BroadleafTemplateNonVoidElement;                                  </span>
<span class="-7404358339654927739" onmouseenter="enter('-7404358339654927739');" onmouseout="out('-7404358339654927739');" style="">  41  import org.springframework.beans.factory.annotation.Value;                                                        </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  42  import org.springframework.stereotype.Component;                                                                  </span>
<span  style="">  43                                                                                                                    </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  44  import java.util.HashMap;                                                                                         </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  45  import java.util.Map;                                                                                             </span>
<span class="2393042000349901971" onmouseenter="enter('2393042000349901971');" onmouseout="out('2393042000349901971');" style="">  46  import java.util.Map.Entry;                                                                                       </span>
<span  style="">  47                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  48  import javax.annotation.Resource;                                                                                 </span>
<span class="-2972028083581866805" onmouseenter="enter('-2972028083581866805');" onmouseout="out('-2972028083581866805');" style="">  49  import javax.servlet.http.HttpServletRequest;                                                                     </span>
<span  style="">  50                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  51  /**                                                                                                               </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  52   * &lt;p&gt;                                                                                                            </span>
<span class="-143385427104872854" onmouseenter="enter('-143385427104872854');" onmouseout="out('-143385427104872854');" style="">  53   * Takes advantage of the new-stype analytics.js from Google Analytics rather than the deprected ga.js. This also </span>
<span class="-8898438840079886526" onmouseenter="enter('-8898438840079886526');" onmouseout="out('-8898438840079886526');" style=""><abbr title="  54   * supports a pre-processed &lt;b&gt;orderNumber&lt;/b&gt; attribute that can be null, suitable for things like the order confirmation">  54   * supports a pre-processed &lt;b&gt;orderNumber&lt;/b&gt; attribute that can be null, suitable for things like the order confðŸ”µ</abbr></span>
<span class="-7917044275166249545" onmouseenter="enter('-7917044275166249545');" onmouseout="out('-7917044275166249545');" style="">  55   * page to send e-commerce transactions. Example usage:                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  56   *                                                                                                                </span>
<span class="-661354662451427256" onmouseenter="enter('-661354662451427256');" onmouseout="out('-661354662451427256');" style="">  57   * &lt;pre&gt;                                                                                                          </span>
<span class="-7906919746321802108" onmouseenter="enter('-7906919746321802108');" onmouseout="out('-7906919746321802108');" style="">  58   * &amp;lt;google_universal_analytics ordernumber=&quot;${order?.orderNumber&quot; /&amp;gt;                                        </span>
<span class="2390307265644686" onmouseenter="enter('2390307265644686');" onmouseout="out('2390307265644686');" style="">  59   * &lt;/pre&gt;                                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  60   *                                                                                                                </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  61   * &lt;p&gt;                                                                                                            </span>
<span class="8606412176857267386" onmouseenter="enter('8606412176857267386');" onmouseout="out('8606412176857267386');" style="">  62   * This processor also supports:                                                                                  </span>
<span class="2717555647352622731" onmouseenter="enter('2717555647352622731');" onmouseout="out('2717555647352622731');" style="">  63   * &lt;ul&gt;                                                                                                           </span>
<span class="-8530737739149477803" onmouseenter="enter('-8530737739149477803');" onmouseout="out('-8530737739149477803');" style=""><abbr title="  64   *  &lt;li&gt;Multiple trackers (extensible via {@link #getTrackers()} or by setting the {@code googleAnalytics.masterWebPropertyId}">  64   *  &lt;li&gt;Multiple trackers (extensible via {@link #getTrackers()} or by setting the {@code googleAnalytics.masterWeðŸ”µ</abbr></span>
<span class="6265505146874472773" onmouseenter="enter('6265505146874472773');" onmouseout="out('6265505146874472773');" style="">  65   *      and {@code googleAnalytics.webPropertyId})&lt;/li&gt;                                                           </span>
<span class="-6827384770903327510" onmouseenter="enter('-6827384770903327510');" onmouseout="out('-6827384770903327510');" style="">  66   *  &lt;li&gt;Affiliates for e-commerce ({@ googleAnalytics.affiliation property})&lt;/li&gt;                                 </span>
<span class="7100814537211017894" onmouseenter="enter('7100814537211017894');" onmouseout="out('7100814537211017894');" style="">  67   *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/2558867?hl=en&amp;utm_id=ad&quot;&gt;Link attribution&lt;/a&gt;        </span>
<span class="4406549444147281940" onmouseenter="enter('4406549444147281940');" onmouseout="out('4406549444147281940');" style="">  68   *      ({@code googleAnalytics.enableLinkAttribution} system property, default {@code true})&lt;/li&gt;                </span>
<span class="-684988223968504417" onmouseenter="enter('-684988223968504417');" onmouseout="out('-684988223968504417');" style="">  69   *  &lt;li&gt;&lt;a href=&quot;https://support.google.com/analytics/answer/3450482&quot;&gt;Display Advertising&lt;/a&gt;                     </span>
<span class="7299106057661310467" onmouseenter="enter('7299106057661310467');" onmouseout="out('7299106057661310467');" style="">  70   *      ({@code googleAnalytics.enableDisplayAdvertising} system property, default {@code false})&lt;/li&gt;            </span>
<span class="599475583152278076" onmouseenter="enter('599475583152278076');" onmouseout="out('599475583152278076');" style="">  71   * &lt;/ul&gt;                                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  72   *                                                                                                                </span>
<span class="630288204851723761" onmouseenter="enter('630288204851723761');" onmouseout="out('630288204851723761');" style="">  73   * @param ordernumber the order number to look up for ecommerce tracking, such as on the confirmation page        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  74   *                                                                                                                </span>
<span class="2670632328160232809" onmouseenter="enter('2670632328160232809');" onmouseout="out('2670632328160232809');" style="">  75   * @author Phillip Verheyden (phillipuniverse)                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  76   */                                                                                                               </span>
<span class="-7627801935997636319" onmouseenter="enter('-7627801935997636319');" onmouseout="out('-7627801935997636319');" style="">  77  @Component(&quot;blGoogleUniversalAnalyticsProcessor&quot;)                                                                 </span>
<span class="7070618034916085721" onmouseenter="enter('7070618034916085721');" onmouseout="out('7070618034916085721');" style="">  78  @ConditionalOnTemplating                                                                                          </span>
<span class="-2399886873569081592" onmouseenter="enter('-2399886873569081592');" onmouseout="out('-2399886873569081592');" style="">  79  public class GoogleUniversalAnalyticsProcessor extends AbstractBroadleafTagReplacementProcessor {                 </span>
<span  style="">  80                                                                                                                    </span>
<span class="4721694570459087610" onmouseenter="enter('4721694570459087610');" onmouseout="out('4721694570459087610');" style="">  81      private static final Log LOG = LogFactory.getLog(GoogleUniversalAnalyticsProcessor.class);                    </span>
<span  style="">  82                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  83      /**                                                                                                           </span>
<span class="5978956812126798070" onmouseenter="enter('5978956812126798070');" onmouseout="out('5978956812126798070');" style="">  84       * Global value, intentionally only retrieved as a file property NOT via the system properties service        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  85       */                                                                                                           </span>
<span class="2486332857350127859" onmouseenter="enter('2486332857350127859');" onmouseout="out('2486332857350127859');" style="">  86      @Value(&quot;${googleAnalytics.masterWebPropertyId}&quot;)                                                              </span>
<span class="8766018855843754021" onmouseenter="enter('8766018855843754021');" onmouseout="out('8766018855843754021');" style="">  87      protected String masterWebPropertyId;                                                                         </span>
<span  style="">  88                                                                                                                    </span>
<span class="-6135682035086935956" onmouseenter="enter('-6135682035086935956');" onmouseout="out('-6135682035086935956');" style="">  89      @Resource(name = &quot;blOrderService&quot;)                                                                            </span>
<span class="4242410752290390693" onmouseenter="enter('4242410752290390693');" onmouseout="out('4242410752290390693');" style="">  90      protected OrderService orderService;                                                                          </span>
<span  style="">  91                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  92      /**                                                                                                           </span>
<span class="-4826553869963905978" onmouseenter="enter('-4826553869963905978');" onmouseout="out('-4826553869963905978');" style="">  93       * This will force the domain to 127.0.0.1 which is useful to determine if the Google Analytics tag is sending</span>
<span class="4379972517565340413" onmouseenter="enter('4379972517565340413');" onmouseout="out('4379972517565340413');" style="">  94       * a request to Google                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  95       */                                                                                                           </span>
<span class="4765817096410164031" onmouseenter="enter('4765817096410164031');" onmouseout="out('4765817096410164031');" style="">  96      @Value(&quot;${googleAnalytics.testLocal}&quot;)                                                                        </span>
<span class="-1900167704265329937" onmouseenter="enter('-1900167704265329937');" onmouseout="out('-1900167704265329937');" style="">  97      protected boolean testLocal = false;                                                                          </span>
<span  style="">  98                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  99      @Override                                                                                                     </span>
<span class="190238665005496725" onmouseenter="enter('190238665005496725');" onmouseout="out('190238665005496725');" style=""> 100      public String getName() {                                                                                     </span>
<span class="-8270913471972923893" onmouseenter="enter('-8270913471972923893');" onmouseout="out('-8270913471972923893');" style=""> 101          return &quot;google_universal_analytics&quot;;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102      }                                                                                                             </span>
<span  style=""> 103                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 104      @Override                                                                                                     </span>
<span class="9191046360773473694" onmouseenter="enter('9191046360773473694');" onmouseout="out('9191046360773473694');" style=""> 105      public int getPrecedence() {                                                                                  </span>
<span class="-8269198090232257590" onmouseenter="enter('-8269198090232257590');" onmouseout="out('-8269198090232257590');" style=""> 106          return 0;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107      }                                                                                                             </span>
<span  style=""> 108                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 109      @Override                                                                                                     </span>
<span class="4464809424342535940" onmouseenter="enter('4464809424342535940');" onmouseout="out('4464809424342535940');" style=""><abbr title=" 110      public BroadleafTemplateModel getReplacementModel(String tagName, Map&lt;String, String&gt; tagAttributes, BroadleafTemplateContext context) {"> 110      public BroadleafTemplateModel getReplacementModel(String tagName, Map&lt;String, String&gt; tagAttributes, BroadleafðŸ”µ</abbr></span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 111          StringBuffer sb = new StringBuffer();                                                                     </span>
<span class="2880528239678716865" onmouseenter="enter('2880528239678716865');" onmouseout="out('2880528239678716865');" style=""> 112          Map&lt;String, String&gt; trackers = getTrackers();                                                             </span>
<span class="1433824051485786916" onmouseenter="enter('1433824051485786916');" onmouseout="out('1433824051485786916');" style=""> 113          if (MapUtils.isNotEmpty(trackers)) {                                                                      </span>
<span class="-225159766305017924" onmouseenter="enter('-225159766305017924');" onmouseout="out('-225159766305017924');" style=""> 114              sb.append(&quot;(function(i,s,o,g,r,a,m){i[&#x27;GoogleAnalyticsObject&#x27;]=r;i[r]=i[r]||function(){&quot;);            </span>
<span class="-75534907468996798" onmouseenter="enter('-75534907468996798');" onmouseout="out('-75534907468996798');" style=""> 115              sb.append(&quot;(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),&quot;);          </span>
<span class="787448617478028585" onmouseenter="enter('787448617478028585');" onmouseout="out('787448617478028585');" style=""> 116              sb.append(&quot;m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)&quot;);         </span>
<span class="3709749594906836963" onmouseenter="enter('3709749594906836963');" onmouseout="out('3709749594906836963');" style=""> 117              sb.append(&quot;})(window,document,&#x27;script&#x27;,&#x27;//www.google-analytics.com/analytics.js&#x27;,&#x27;ga&#x27;);&quot;);            </span>
<span  style=""> 118                                                                                                                    </span>
<span class="8350540313808247660" onmouseenter="enter('8350540313808247660');" onmouseout="out('8350540313808247660');" style=""> 119              String orderNumberExpression = tagAttributes.get(&quot;ordernumber&quot;);                                      </span>
<span class="-4116557390625637530" onmouseenter="enter('-4116557390625637530');" onmouseout="out('-4116557390625637530');" style=""> 120              String orderNumber = null;                                                                            </span>
<span class="1554006189045169119" onmouseenter="enter('1554006189045169119');" onmouseout="out('1554006189045169119');" style=""> 121              if (orderNumberExpression != null) {                                                                  </span>
<span class="-8521652288646315683" onmouseenter="enter('-8521652288646315683');" onmouseout="out('-8521652288646315683');" style=""> 122                  orderNumber = (String) context.parseExpression(orderNumberExpression);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123              }                                                                                                     </span>
<span  style=""> 124                                                                                                                    </span>
<span class="-3391477864870857752" onmouseenter="enter('-3391477864870857752');" onmouseout="out('-3391477864870857752');" style=""> 125              Order order = null;                                                                                   </span>
<span class="3032325866360707625" onmouseenter="enter('3032325866360707625');" onmouseout="out('3032325866360707625');" style=""> 126              if (orderNumber != null) {                                                                            </span>
<span class="8749278739372980865" onmouseenter="enter('8749278739372980865');" onmouseout="out('8749278739372980865');" style=""> 127                  order = orderService.findOrderByOrderNumber(orderNumber);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128              }                                                                                                     </span>
<span  style=""> 129                                                                                                                    </span>
<span class="6811598938615422064" onmouseenter="enter('6811598938615422064');" onmouseout="out('6811598938615422064');" style=""> 130              for (Entry&lt;String, String&gt; tracker : trackers.entrySet()) {                                           </span>
<span class="-6082993912017886430" onmouseenter="enter('-6082993912017886430');" onmouseout="out('-6082993912017886430');" style=""> 131                  String trackerName = tracker.getKey();                                                            </span>
<span class="-3120827425834628721" onmouseenter="enter('-3120827425834628721');" onmouseout="out('-3120827425834628721');" style=""> 132                  String trackerPrefix = &quot;&quot;;                                                                        </span>
<span class="7019647018974662667" onmouseenter="enter('7019647018974662667');" onmouseout="out('7019647018974662667');" style=""> 133                  String id = tracker.getValue();                                                                   </span>
<span class="3011142644875223402" onmouseenter="enter('3011142644875223402');" onmouseout="out('3011142644875223402');" style=""> 134                  sb.append(&quot;ga(&#x27;create&#x27;, &#x27;&quot; + id + &quot;&#x27;, &#x27;auto&#x27;, {&quot;);                                                </span>
<span  style=""> 135                                                                                                                    </span>
<span class="3839128902332571680" onmouseenter="enter('3839128902332571680');" onmouseout="out('3839128902332571680');" style=""> 136                  if (!&quot;webProperty&quot;.equals(trackerName)) {                                                         </span>
<span class="-7426441914050405472" onmouseenter="enter('-7426441914050405472');" onmouseout="out('-7426441914050405472');" style=""> 137                      trackerPrefix = trackerName + &quot;.&quot;;                                                            </span>
<span class="-3973100567386912971" onmouseenter="enter('-3973100567386912971');" onmouseout="out('-3973100567386912971');" style=""> 138                      sb.append(&quot;&#x27;name&#x27;: &#x27;&quot; + trackerName + &quot;&#x27;&quot;);                                                   </span>
<span class="3293478056291787725" onmouseenter="enter('3293478056291787725');" onmouseout="out('3293478056291787725');" style=""> 139                      if (testLocal) {                                                                              </span>
<span class="6725018595534739120" onmouseenter="enter('6725018595534739120');" onmouseout="out('6725018595534739120');" style=""> 140                          sb.append(&quot;,&quot;);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142                  }                                                                                                 </span>
<span class="3293478056291787725" onmouseenter="enter('3293478056291787725');" onmouseout="out('3293478056291787725');" style=""> 143                  if (testLocal) {                                                                                  </span>
<span class="-3353602519532140774" onmouseenter="enter('-3353602519532140774');" onmouseout="out('-3353602519532140774');" style=""> 144                      sb.append(&quot;&#x27;cookieDomain&#x27;: &#x27;none&#x27;&quot;);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145                  }                                                                                                 </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 146                  sb.append(&quot;});&quot;);                                                                                 </span>
<span  style=""> 147                                                                                                                    </span>
<span class="-7418475527567976254" onmouseenter="enter('-7418475527567976254');" onmouseout="out('-7418475527567976254');" style=""> 148                  if (&quot;webProperty&quot;.equals(trackerName)) {                                                          </span>
<span class="4360254575720880810" onmouseenter="enter('4360254575720880810');" onmouseout="out('4360254575720880810');" style=""><abbr title=" 149                      HttpServletRequest request = BroadleafRequestContext.getBroadleafRequestContext().getRequest();"> 149                      HttpServletRequest request = BroadleafRequestContext.getBroadleafRequestContext().getRequest()ðŸ”µ</abbr></span>
<span class="-5752363771942989481" onmouseenter="enter('-5752363771942989481');" onmouseout="out('-5752363771942989481');" style=""> 150                      if (request != null) {                                                                        </span>
<span class="3853533472488230976" onmouseenter="enter('3853533472488230976');" onmouseout="out('3853533472488230976');" style=""><abbr title=" 151                          Map&lt;String, String&gt; setValuesMap = (Map&lt;String, String&gt;) request.getAttribute(&quot;blGAValuesMap&quot;);"> 151                          Map&lt;String, String&gt; setValuesMap = (Map&lt;String, String&gt;) request.getAttribute(&quot;blGAValuesMðŸ”µ</abbr></span>
<span class="-4910410964255568960" onmouseenter="enter('-4910410964255568960');" onmouseout="out('-4910410964255568960');" style=""> 152                          if (setValuesMap != null) {                                                               </span>
<span class="1796428880304861730" onmouseenter="enter('1796428880304861730');" onmouseout="out('1796428880304861730');" style=""> 153                              for (Map.Entry&lt;String, String&gt; entry : setValuesMap.entrySet()) {                     </span>
<span class="6095212434965084893" onmouseenter="enter('6095212434965084893');" onmouseout="out('6095212434965084893');" style=""> 154                                  sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;set&#x27;,&quot;).append(entry.getKey()).append(&quot;,&quot;)    </span>
<span class="4491228529456646674" onmouseenter="enter('4491228529456646674');" onmouseout="out('4491228529456646674');" style=""> 155                                          .append(entry.getValue()).append(&quot;);&quot;);                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                              }                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159                  }                                                                                                 </span>
<span  style=""> 160                                                                                                                    </span>
<span class="-4889417558387717970" onmouseenter="enter('-4889417558387717970');" onmouseout="out('-4889417558387717970');" style=""> 161                  sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;send&#x27;, &#x27;pageview&#x27;);&quot;);                                        </span>
<span  style=""> 162                                                                                                                    </span>
<span class="-1815529951487720795" onmouseenter="enter('-1815529951487720795');" onmouseout="out('-1815529951487720795');" style=""> 163                  if (isIncludeLinkAttribution()) {                                                                 </span>
<span class="8560972280490216573" onmouseenter="enter('8560972280490216573');" onmouseout="out('8560972280490216573');" style=""> 164                      sb.append(getLinkAttributionJs(trackerPrefix));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165                  }                                                                                                 </span>
<span class="-7131894736179401387" onmouseenter="enter('-7131894736179401387');" onmouseout="out('-7131894736179401387');" style=""> 166                  if (isIncludeDisplayAdvertising()) {                                                              </span>
<span class="-8416140583577512322" onmouseenter="enter('-8416140583577512322');" onmouseout="out('-8416140583577512322');" style=""> 167                      sb.append(getDisplayAdvertisingJs(trackerPrefix));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168                  }                                                                                                 </span>
<span  style=""> 169                                                                                                                    </span>
<span class="3398338372153747583" onmouseenter="enter('3398338372153747583');" onmouseout="out('3398338372153747583');" style=""> 170                  if (order != null) {                                                                              </span>
<span class="-6179801228362718003" onmouseenter="enter('-6179801228362718003');" onmouseout="out('-6179801228362718003');" style=""> 171                      sb.append(getTransactionJs(order, trackerPrefix));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173              }                                                                                                     </span>
<span  style=""> 174                                                                                                                    </span>
<span class="-8412714651221999608" onmouseenter="enter('-8412714651221999608');" onmouseout="out('-8412714651221999608');" style=""> 175              // Add contentNode to the document                                                                    </span>
<span class="2586931587804785526" onmouseenter="enter('2586931587804785526');" onmouseout="out('2586931587804785526');" style=""> 176              BroadleafTemplateModel model = context.createModel();                                                 </span>
<span class="5956668170328902082" onmouseenter="enter('5956668170328902082');" onmouseout="out('5956668170328902082');" style=""> 177              BroadleafTemplateNonVoidElement scriptTag = context.createNonVoidElement(&quot;script&quot;);                   </span>
<span class="-4659749375667028744" onmouseenter="enter('-4659749375667028744');" onmouseout="out('-4659749375667028744');" style=""> 178              BroadleafTemplateElement script = context.createTextElement(sb.toString());                           </span>
<span class="247228039845397848" onmouseenter="enter('247228039845397848');" onmouseout="out('247228039845397848');" style=""> 179              scriptTag.addChild(script);                                                                           </span>
<span class="7450786220544571726" onmouseenter="enter('7450786220544571726');" onmouseout="out('7450786220544571726');" style=""> 180              model.addElement(scriptTag);                                                                          </span>
<span class="1327412617440986435" onmouseenter="enter('1327412617440986435');" onmouseout="out('1327412617440986435');" style=""> 181              return model;                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 182          } else {                                                                                                  </span>
<span class="2035563191225573078" onmouseenter="enter('2035563191225573078');" onmouseout="out('2035563191225573078');" style=""><abbr title=" 183              LOG.warn(&quot;No trackers were found, not outputting Google Analytics script. Set the googleAnalytics.webPropertyId&quot;"> 183              LOG.warn(&quot;No trackers were found, not outputting Google Analytics script. Set the googleAnalytics.webPðŸ”µ</abbr></span>
<span class="-5815171902766930389" onmouseenter="enter('-5815171902766930389');" onmouseout="out('-5815171902766930389');" style=""><abbr title=" 184                      + &quot; and/or the googleAnalytics.masterWebPropertyId system properties to output Google Analytics&quot;);"> 184                      + &quot; and/or the googleAnalytics.masterWebPropertyId system properties to output Google AnalyticðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185          }                                                                                                         </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 186          return null;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187      }                                                                                                             </span>
<span  style=""> 188                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 189      /**                                                                                                           </span>
<span class="4526085554743721537" onmouseenter="enter('4526085554743721537');" onmouseout="out('4526085554743721537');" style=""> 190       * Grabs a map of trackers keyed by the tracker name with the analytics ID as the value                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 191       */                                                                                                           </span>
<span class="-372605794037605079" onmouseenter="enter('-372605794037605079');" onmouseout="out('-372605794037605079');" style=""> 192      protected Map&lt;String, String&gt; getTrackers() {                                                                 </span>
<span class="-307639934143605930" onmouseenter="enter('-307639934143605930');" onmouseout="out('-307639934143605930');" style=""> 193          Map&lt;String, String&gt; trackers = new HashMap&lt;&gt;();                                                           </span>
<span class="-7547677911791595799" onmouseenter="enter('-7547677911791595799');" onmouseout="out('-7547677911791595799');" style=""> 194          if (shouldShowMasterTracker()) {                                                                          </span>
<span class="7613356034540080851" onmouseenter="enter('7613356034540080851');" onmouseout="out('7613356034540080851');" style=""> 195              trackers.put(&quot;master&quot;, getMasterWebPropertyId());                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196          }                                                                                                         </span>
<span class="7457001157732167405" onmouseenter="enter('7457001157732167405');" onmouseout="out('7457001157732167405');" style=""> 197          if (StringUtils.isNotBlank(getWebPropertyId())) {                                                         </span>
<span class="-1680205878775740489" onmouseenter="enter('-1680205878775740489');" onmouseout="out('-1680205878775740489');" style=""> 198              trackers.put(&quot;webProperty&quot;, getWebPropertyId());                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199          }                                                                                                         </span>
<span  style=""> 200                                                                                                                    </span>
<span class="7808054229367271940" onmouseenter="enter('7808054229367271940');" onmouseout="out('7808054229367271940');" style=""> 201          return trackers;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202      }                                                                                                             </span>
<span  style=""> 203                                                                                                                    </span>
<span class="7201288543731878163" onmouseenter="enter('7201288543731878163');" onmouseout="out('7201288543731878163');" style=""> 204      protected boolean shouldShowMasterTracker() {                                                                 </span>
<span class="5354981909841949210" onmouseenter="enter('5354981909841949210');" onmouseout="out('5354981909841949210');" style=""> 205          String masterWebPropertyId = getMasterWebPropertyId();                                                    </span>
<span class="-9816468277340784" onmouseenter="enter('-9816468277340784');" onmouseout="out('-9816468277340784');" style=""> 206          return (StringUtils.isNotBlank(masterWebPropertyId) &amp;&amp; (!&quot;UA-XXXXXXX-X&quot;.equals(masterWebPropertyId)));    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207      }                                                                                                             </span>
<span  style=""> 208                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 209      /**                                                                                                           </span>
<span class="4669840319029639930" onmouseenter="enter('4669840319029639930');" onmouseout="out('4669840319029639930');" style=""> 210       * Builds the linke attribution Javascript                                                                    </span>
<span class="8768361991211291337" onmouseenter="enter('8768361991211291337');" onmouseout="out('8768361991211291337');" style=""> 211       * @param tracker the name of the tracker that is using the link attribution                                  </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 212       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 213       */                                                                                                           </span>
<span class="-4727062141745445312" onmouseenter="enter('-4727062141745445312');" onmouseout="out('-4727062141745445312');" style=""> 214      protected String getLinkAttributionJs(String trackerPrefix) {                                                 </span>
<span class="4641935953841803222" onmouseenter="enter('4641935953841803222');" onmouseout="out('4641935953841803222');" style=""> 215          return &quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;linkid&#x27;, &#x27;linkid.js&#x27;);&quot;;                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216      }                                                                                                             </span>
<span  style=""> 217                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 218      /**                                                                                                           </span>
<span class="-1766163605340550882" onmouseenter="enter('-1766163605340550882');" onmouseout="out('-1766163605340550882');" style=""> 219       * Builds the display advertising Javascript for the given tracker                                            </span>
<span class="7955661006334297359" onmouseenter="enter('7955661006334297359');" onmouseout="out('7955661006334297359');" style=""> 220       * @param tracker                                                                                             </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 221       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 222       */                                                                                                           </span>
<span class="6227360005040256098" onmouseenter="enter('6227360005040256098');" onmouseout="out('6227360005040256098');" style=""> 223      protected String getDisplayAdvertisingJs(String trackerPrefix) {                                              </span>
<span class="3528222762911871195" onmouseenter="enter('3528222762911871195');" onmouseout="out('3528222762911871195');" style=""> 224          return &quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;displayfeatures&#x27;);&quot;;                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225      }                                                                                                             </span>
<span  style=""> 226                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 227      /**                                                                                                           </span>
<span class="6584247125825541487" onmouseenter="enter('6584247125825541487');" onmouseout="out('6584247125825541487');" style=""><abbr title=" 228       * Builds the transaction analytics for the given tracker name. Invokes {@link #getItemJs(Order, String) for each item"> 228       * Builds the transaction analytics for the given tracker name. Invokes {@link #getItemJs(Order, String) for eðŸ”µ</abbr></span>
<span class="-1936212608501453784" onmouseenter="enter('-1936212608501453784');" onmouseout="out('-1936212608501453784');" style=""> 229       * in the given &lt;b&gt;order&lt;/b&gt;.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 230       */                                                                                                           </span>
<span class="9179487558003409237" onmouseenter="enter('9179487558003409237');" onmouseout="out('9179487558003409237');" style=""> 231      protected String getTransactionJs(Order order, String trackerPrefix) {                                        </span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 232          StringBuffer sb = new StringBuffer();                                                                     </span>
<span class="1809594812594725377" onmouseenter="enter('1809594812594725377');" onmouseout="out('1809594812594725377');" style=""> 233          sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;require&#x27;, &#x27;ecommerce&#x27;, &#x27;ecommerce.js&#x27;);&quot;);                            </span>
<span  style=""> 234                                                                                                                    </span>
<span class="-5012537295569901065" onmouseenter="enter('-5012537295569901065');" onmouseout="out('-5012537295569901065');" style=""> 235          sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:addTransaction&#x27;, {&quot;);                                       </span>
<span class="3802939893371272400" onmouseenter="enter('3802939893371272400');" onmouseout="out('3802939893371272400');" style=""> 236          sb.append(&quot;&#x27;id&#x27;: &#x27;&quot; + order.getOrderNumber() + &quot;&#x27;&quot;);                                                      </span>
<span class="-4495351553520504059" onmouseenter="enter('-4495351553520504059');" onmouseout="out('-4495351553520504059');" style=""> 237          if (StringUtils.isNotBlank(getAffiliation())) {                                                           </span>
<span class="2598773061427907348" onmouseenter="enter('2598773061427907348');" onmouseout="out('2598773061427907348');" style=""> 238              sb.append(&quot;,&#x27;affiliation&#x27;: &#x27;&quot; + getAffiliation() + &quot;&#x27;&quot;);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239          }                                                                                                         </span>
<span class="-1600458020637022538" onmouseenter="enter('-1600458020637022538');" onmouseout="out('-1600458020637022538');" style=""> 240          sb.append(&quot;,&#x27;revenue&#x27;: &#x27;&quot; + order.getTotal() + &quot;&#x27;&quot;);                                                      </span>
<span class="-7105820260454958730" onmouseenter="enter('-7105820260454958730');" onmouseout="out('-7105820260454958730');" style=""> 241          sb.append(&quot;,&#x27;shipping&#x27;:&#x27;&quot; + order.getTotalShipping() + &quot;&#x27;&quot;);                                              </span>
<span class="4743629374093034580" onmouseenter="enter('4743629374093034580');" onmouseout="out('4743629374093034580');" style=""> 242          sb.append(&quot;,&#x27;tax&#x27;: &#x27;&quot; + order.getTotalTax() + &quot;&#x27;&quot;);                                                       </span>
<span  style=""> 243                                                                                                                    </span>
<span class="3530102425606482988" onmouseenter="enter('3530102425606482988');" onmouseout="out('3530102425606482988');" style=""> 244          if (order.getCurrency() != null) {                                                                        </span>
<span class="2532172931589873998" onmouseenter="enter('2532172931589873998');" onmouseout="out('2532172931589873998');" style=""> 245              sb.append(&quot;,&#x27;currency&#x27;: &#x27;&quot; + order.getCurrency().getCurrencyCode() + &quot;&#x27;&quot;);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246          }                                                                                                         </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style=""> 247          sb.append(&quot;});&quot;);                                                                                         </span>
<span  style=""> 248                                                                                                                    </span>
<span class="-7953667423558098854" onmouseenter="enter('-7953667423558098854');" onmouseout="out('-7953667423558098854');" style=""> 249          sb.append(getItemJs(order, trackerPrefix));                                                               </span>
<span  style=""> 250                                                                                                                    </span>
<span class="2925677874169908961" onmouseenter="enter('2925677874169908961');" onmouseout="out('2925677874169908961');" style=""> 251          sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:send&#x27;);&quot;);                                                  </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 252          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253      }                                                                                                             </span>
<span  style=""> 254                                                                                                                    </span>
<span class="5980134894234571756" onmouseenter="enter('5980134894234571756');" onmouseout="out('5980134894234571756');" style=""> 255      protected String getItemJs(Order order, String trackerPrefix) {                                               </span>
<span class="3102651754471655563" onmouseenter="enter('3102651754471655563');" onmouseout="out('3102651754471655563');" style=""> 256          StringBuffer sb = new StringBuffer();                                                                     </span>
<span class="1072921294238695944" onmouseenter="enter('1072921294238695944');" onmouseout="out('1072921294238695944');" style=""> 257          for (FulfillmentGroup fulfillmentGroup : order.getFulfillmentGroups()) {                                  </span>
<span class="7256397867735119446" onmouseenter="enter('7256397867735119446');" onmouseout="out('7256397867735119446');" style=""> 258              for (FulfillmentGroupItem fulfillmentGroupItem : fulfillmentGroup.getFulfillmentGroupItems()) {       </span>
<span class="6727205496790990336" onmouseenter="enter('6727205496790990336');" onmouseout="out('6727205496790990336');" style=""> 259                  OrderItem orderItem = fulfillmentGroupItem.getOrderItem();                                        </span>
<span  style=""> 260                                                                                                                    </span>
<span class="-4497171920864475683" onmouseenter="enter('-4497171920864475683');" onmouseout="out('-4497171920864475683');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 261 -                Sku sku = ((SkuAccessor) orderItem).getSku();                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 262 -                                                                                                                  </span>
<span class="-8613458593272541119" onmouseenter="enter('-8613458593272541119');" onmouseout="out('-8613458593272541119');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 263 -                sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:addItem&#x27;, {&quot;);                                      </span>
<span class="3802939893371272400" onmouseenter="enter('3802939893371272400');" onmouseout="out('3802939893371272400');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 264 -                sb.append(&quot;&#x27;id&#x27;: &#x27;&quot; + order.getOrderNumber() + &quot;&#x27;&quot;);                                              </span>
<span class="-887663243915190383" onmouseenter="enter('-887663243915190383');" onmouseout="out('-887663243915190383');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 265 -                sb.append(&quot;,&#x27;name&#x27;: &#x27;&quot; + sku.getName() + &quot;&#x27;&quot;);                                                    </span>
<span class="-7742482896330545050" onmouseenter="enter('-7742482896330545050');" onmouseout="out('-7742482896330545050');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 266 -                sb.append(&quot;,&#x27;sku&#x27;: &#x27;&quot; + sku.getId() + &quot;&#x27;&quot;);                                                       </span>
<span class="-1605838225351785854" onmouseenter="enter('-1605838225351785854');" onmouseout="out('-1605838225351785854');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 267 -                sb.append(&quot;,&#x27;category&#x27;: &#x27;&quot; + getVariation(orderItem) + &quot;&#x27;&quot;);                                      </span>
<span class="-4039856411666157290" onmouseenter="enter('-4039856411666157290');" onmouseout="out('-4039856411666157290');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 268 -                sb.append(&quot;,&#x27;price&#x27;: &#x27;&quot; + orderItem.getAveragePrice() + &quot;&#x27;&quot;);                                     </span>
<span class="-6864347081607696224" onmouseenter="enter('-6864347081607696224');" onmouseout="out('-6864347081607696224');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 269 -                sb.append(&quot;,&#x27;quantity&#x27;: &#x27;&quot; + orderItem.getQuantity() + &quot;&#x27;&quot;);                                      </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 270 -                sb.append(&quot;});&quot;);                                                                                 </span>
<span class="-1726294213977632923" onmouseenter="enter('-1726294213977632923');" onmouseout="out('-1726294213977632923');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +                if (orderItem instanceof DiscreteOrderItem) {                                                     </span>
<span class="-4497171920864475683" onmouseenter="enter('-4497171920864475683');" onmouseout="out('-4497171920864475683');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 272 +                    Sku sku = ((SkuAccessor) orderItem).getSku();                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 273 +                                                                                                                  </span>
<span class="-8613458593272541119" onmouseenter="enter('-8613458593272541119');" onmouseout="out('-8613458593272541119');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 274 +                    sb.append(&quot;ga(&#x27;&quot; + trackerPrefix + &quot;ecommerce:addItem&#x27;, {&quot;);                                  </span>
<span class="3802939893371272400" onmouseenter="enter('3802939893371272400');" onmouseout="out('3802939893371272400');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 275 +                    sb.append(&quot;&#x27;id&#x27;: &#x27;&quot; + order.getOrderNumber() + &quot;&#x27;&quot;);                                          </span>
<span class="-887663243915190383" onmouseenter="enter('-887663243915190383');" onmouseout="out('-887663243915190383');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 276 +                    sb.append(&quot;,&#x27;name&#x27;: &#x27;&quot; + sku.getName() + &quot;&#x27;&quot;);                                                </span>
<span class="-7742482896330545050" onmouseenter="enter('-7742482896330545050');" onmouseout="out('-7742482896330545050');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +                    sb.append(&quot;,&#x27;sku&#x27;: &#x27;&quot; + sku.getId() + &quot;&#x27;&quot;);                                                   </span>
<span class="-1605838225351785854" onmouseenter="enter('-1605838225351785854');" onmouseout="out('-1605838225351785854');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 278 +                    sb.append(&quot;,&#x27;category&#x27;: &#x27;&quot; + getVariation(orderItem) + &quot;&#x27;&quot;);                                  </span>
<span class="-4039856411666157290" onmouseenter="enter('-4039856411666157290');" onmouseout="out('-4039856411666157290');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 279 +                    sb.append(&quot;,&#x27;price&#x27;: &#x27;&quot; + orderItem.getAveragePrice() + &quot;&#x27;&quot;);                                 </span>
<span class="-6864347081607696224" onmouseenter="enter('-6864347081607696224');" onmouseout="out('-6864347081607696224');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 280 +                    sb.append(&quot;,&#x27;quantity&#x27;: &#x27;&quot; + orderItem.getQuantity() + &quot;&#x27;&quot;);                                  </span>
<span class="1197309135131315647" onmouseenter="enter('1197309135131315647');" onmouseout="out('1197309135131315647');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 281 +                    sb.append(&quot;});&quot;);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 282 +                }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284          }                                                                                                         </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 285          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286      }                                                                                                             </span>
<span  style=""> 287                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 288      /**                                                                                                           </span>
<span class="6923647488705566386" onmouseenter="enter('6923647488705566386');" onmouseout="out('6923647488705566386');" style=""> 289       * Returns the product option values separated by a space if they are                                         </span>
<span class="1487274611034840884" onmouseenter="enter('1487274611034840884');" onmouseout="out('1487274611034840884');" style=""> 290       * relevant for the item, or the product category if no options are available                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 291       *                                                                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 292       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 293       */                                                                                                           </span>
<span class="5846271843428503958" onmouseenter="enter('5846271843428503958');" onmouseout="out('5846271843428503958');" style=""> 294      protected String getVariation(OrderItem item) {                                                               </span>
<span class="-1900425779688459231" onmouseenter="enter('-1900425779688459231');" onmouseout="out('-1900425779688459231');" style=""> 295          if (MapUtils.isEmpty(item.getOrderItemAttributes())) {                                                    </span>
<span class="-2607232819614252500" onmouseenter="enter('-2607232819614252500');" onmouseout="out('-2607232819614252500');" style=""> 296              return item.getCategory() == null ? &quot;&quot; : item.getCategory().getName();                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297          }                                                                                                         </span>
<span  style=""> 298                                                                                                                    </span>
<span class="3636026723966887885" onmouseenter="enter('3636026723966887885');" onmouseout="out('3636026723966887885');" style=""> 299          //use product options instead                                                                             </span>
<span class="-3623621045223349277" onmouseenter="enter('-3623621045223349277');" onmouseout="out('-3623621045223349277');" style=""> 300          String result = &quot;&quot;;                                                                                       </span>
<span class="-3052053556715064621" onmouseenter="enter('-3052053556715064621');" onmouseout="out('-3052053556715064621');" style=""> 301          for (Map.Entry&lt;String, OrderItemAttribute&gt; entry : item.getOrderItemAttributes().entrySet()) {            </span>
<span class="-7464419131479451077" onmouseenter="enter('-7464419131479451077');" onmouseout="out('-7464419131479451077');" style=""> 302              result += entry.getValue().getValue() + &quot; &quot;;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303          }                                                                                                         </span>
<span  style=""> 304                                                                                                                    </span>
<span class="-6864210689922892589" onmouseenter="enter('-6864210689922892589');" onmouseout="out('-6864210689922892589');" style=""> 305          //the result has a space at the end, ensure that is stripped out                                          </span>
<span class="6125747973705988751" onmouseenter="enter('6125747973705988751');" onmouseout="out('6125747973705988751');" style=""> 306          return result.substring(0, result.length() - 1);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307      }                                                                                                             </span>
<span  style=""> 308                                                                                                                    </span>
<span class="7688964624751652763" onmouseenter="enter('7688964624751652763');" onmouseout="out('7688964624751652763');" style=""> 309      public String getMasterWebPropertyId() {                                                                      </span>
<span class="8804391615898929387" onmouseenter="enter('8804391615898929387');" onmouseout="out('8804391615898929387');" style=""> 310          return masterWebPropertyId;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311      }                                                                                                             </span>
<span  style=""> 312                                                                                                                    </span>
<span class="-2978295786667990463" onmouseenter="enter('-2978295786667990463');" onmouseout="out('-2978295786667990463');" style=""> 313      public void setMasterWebPropertyId(String masterWebPropertyId) {                                              </span>
<span class="7918620816210150178" onmouseenter="enter('7918620816210150178');" onmouseout="out('7918620816210150178');" style=""> 314          this.masterWebPropertyId = masterWebPropertyId;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315      }                                                                                                             </span>
<span  style=""> 316                                                                                                                    </span>
<span class="6671223003008841723" onmouseenter="enter('6671223003008841723');" onmouseout="out('6671223003008841723');" style=""> 317      public String getAffiliation() {                                                                              </span>
<span class="7807255797153975973" onmouseenter="enter('7807255797153975973');" onmouseout="out('7807255797153975973');" style=""> 318          return BLCSystemProperty.resolveSystemProperty(&quot;googleAnalytics.affiliation&quot;);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319      }                                                                                                             </span>
<span  style=""> 320                                                                                                                    </span>
<span class="8203350595237245612" onmouseenter="enter('8203350595237245612');" onmouseout="out('8203350595237245612');" style=""> 321      public String getWebPropertyId() {                                                                            </span>
<span class="850776087520408196" onmouseenter="enter('850776087520408196');" onmouseout="out('850776087520408196');" style=""> 322          return BLCSystemProperty.resolveSystemProperty(&quot;googleAnalytics.webPropertyId&quot;);                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323      }                                                                                                             </span>
<span  style=""> 324                                                                                                                    </span>
<span class="825053779558488694" onmouseenter="enter('825053779558488694');" onmouseout="out('825053779558488694');" style=""> 325      public boolean isIncludeLinkAttribution() {                                                                   </span>
<span class="5065521424805687131" onmouseenter="enter('5065521424805687131');" onmouseout="out('5065521424805687131');" style=""> 326          return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableLinkAttribution&quot;, true);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327      }                                                                                                             </span>
<span  style=""> 328                                                                                                                    </span>
<span class="4570506314302342970" onmouseenter="enter('4570506314302342970');" onmouseout="out('4570506314302342970');" style=""> 329      public boolean isIncludeDisplayAdvertising() {                                                                </span>
<span class="-1788412357185885205" onmouseenter="enter('-1788412357185885205');" onmouseout="out('-1788412357185885205');" style=""> 330          return BLCSystemProperty.resolveBooleanSystemProperty(&quot;googleAnalytics.enableDisplayAdvertising&quot;, false); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 331      }                                                                                                             </span>
<span  style=""> 332                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            