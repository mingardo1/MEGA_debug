<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>280</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    280
                    <a href="279.html">prev</a>
                    <a href="281.html">next</a>
                    <a href="280_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Automattic/simplenote-android_289d73798436413d6717ebe27ac4225c1b72220a_Simplenote/src/main/java/com/automattic/simplenote/TagsListActivity.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;289d73798436413d6717ebe27ac4225c1b72220a:Simplenote/src/main/java/com/automattic/simplenote/TagsListActivity.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;289d73798436413d6717ebe27ac4225c1b72220a^1:Simplenote/src/main/java/com/automattic/simplenote/TagsListActivity.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;289d73798436413d6717ebe27ac4225c1b72220a^2:Simplenote/src/main/java/com/automattic/simplenote/TagsListActivity.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;e8c0cc6eb145965734732c7ccbf4c00c49ed6e23:Simplenote/src/main/java/com/automattic/simplenote/TagsListActivity.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[sbj]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
   2 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import android.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import android.app.ListActivity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import android.os.AsyncTask;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 import android.text.Html;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import android.text.Spannable;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 import android.text.SpannableString;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import android.view.ActionMode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 import android.view.Menu;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 import android.view.MenuInflater;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 import android.view.MenuItem;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import android.widget.AbsListView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import android.widget.AdapterView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import android.widget.EditText;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import android.widget.ImageButton;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import android.widget.LinearLayout;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import com.automattic.simplenote.models.Tag;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import com.automattic.simplenote.utils.ThemeUtils;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import com.automattic.simplenote.widgets.TypefaceSpan;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import com.google.analytics.tracking.android.EasyTracker;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import com.google.analytics.tracking.android.Tracker;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 import com.simperium.client.BucketObjectNameInvalid;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44  * Created by Dan Roundhill on 6/26/13. (In Greece!)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  46 public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionMode.Callback, AbsListView.MultiChoiceModeListener, AdapterView.OnItemLongClickListener, Bucket.Listener&lt;Tag&gt; {">  46 public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionModeðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48     private ActionMode mActionMode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49     private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50     private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51     private TagsAdapter mTagsAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53     private Tracker mTracker;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56     public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58         ThemeUtils.setTheme(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62         setContentView(R.layout.activity_tags_list);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64         SpannableString s = new SpannableString(getString(R.string.edit_tags));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65         s.setSpan(new TypefaceSpan(this), 0, s.length(),</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66                 Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67         getActionBar().setTitle(s);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69         getActionBar().setDisplayHomeAsUpEnabled(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71         TextView emptyTextView = (TextView)findViewById(android.R.id.empty);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  72         emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + getString(R.string.no_tags_found) + &quot;&lt;/strong&gt;&quot;));">  72         emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + getString(R.string.no_tags_found) + &quot;&lt;/strong&gt;&quot;)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74         ListView listView = getListView();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75         listView.setMultiChoiceModeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76         listView.setOnItemClickListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77         // Disabling long press CAB action for now since bulk deleting is incomplete</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78         // listView.setOnItemLongClickListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         Simplenote application = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81         mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82         mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84         mTagsAdapter = new TagsAdapter(getBaseContext(), null, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85         setListAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86         refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88         EasyTracker.getInstance().activityStart(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89         mTracker = EasyTracker.getTracker();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93     protected void onResume() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94         super.onResume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96         mNotesBucket.start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97         mTagsBucket.start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99         mTagsBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100         mTagsBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101         mTagsBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105     protected void onPause() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106         super.onPause();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         mTagsBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109         mTagsBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110         mTagsBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114     public void onStop() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115         super.onStop();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116         EasyTracker.getInstance().activityStop(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119     protected void refreshTags() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 120         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);"> 120         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121         ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122         mTagsAdapter.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126     public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int row, long l) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128         final AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129         LinearLayout alertView = (LinearLayout) getLayoutInflater().inflate(R.layout.edit_tag, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131         final Tag tag = mTagsAdapter.getItem(row);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133         final EditText tagNameEditText = (EditText) alertView.findViewById(R.id.tag_name_edit);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134         tagNameEditText.setText(tag.getName());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135         tagNameEditText.setSelection(tagNameEditText.length());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136         alert.setView(alertView);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137         alert.setTitle(R.string.rename_tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138         alert.setPositiveButton(R.string.save, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140                 String value = tagNameEditText.getText().toString().trim();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141                 try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142                     tag.renameTo(value, mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143                     mTracker.sendEvent(&quot;tag&quot;, &quot;edited_tag&quot;, &quot;tag_alert_edit_box&quot;, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144                 } catch (BucketObjectNameInvalid e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145                     android.util.Log.e(Simplenote.TAG, &quot;Unable to rename tag&quot;, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146                     // TODO: show user a message that new tag name is not ok</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150         alert.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152                 // Do nothing</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155         alert.show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159     // TODO: Finish bulk editing</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161     public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162         MenuInflater inflater = actionMode.getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163         inflater.inflate(R.menu.bulk_edit_tags, menu);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164         mActionMode = actionMode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165         return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169     public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170         return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174     public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175         switch (menuItem.getItemId()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176             case R.id.menu_delete:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177                 actionMode.finish(); // Action picked, so close the CAB</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179             default:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180                 return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185     public void onDestroyActionMode(ActionMode actionMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186         mActionMode = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190     public void onItemCheckedStateChanged(ActionMode actionMode, int i, long l, boolean b) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191         final int checkedCount = getListView().getCheckedItemCount();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192         switch (checkedCount) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193             case 0:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194                 actionMode.setSubtitle(null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195                 break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196             case 1:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197                 actionMode.setSubtitle(&quot;One item selected&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198                 break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199             default:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200                 actionMode.setSubtitle(&quot;&quot; + checkedCount + &quot; items selected&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201                 break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206     public boolean onItemLongClick(AdapterView&lt;?&gt; adapterView, View view, int position, long l) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207         getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208         getListView().setItemChecked(position, true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209         if (mActionMode == null)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210             startActionMode(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211         //isCABDestroyed = false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212         return false; // so this action does not consume the event!!!</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216     public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218         if (item.getItemId() == android.R.id.home) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219             finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223         return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226     // Tag Bucket listeners</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228     public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231             public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238     public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241             public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248     public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251             public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258     public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259         // noop</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262     private class TagsAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264         private ObjectCursor&lt;Tag&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266         public TagsAdapter(Context context, ObjectCursor&lt;Tag&gt; c, int flags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267             super(context, c, flags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268             mCursor = c;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271         public void changeCursor(ObjectCursor&lt;Tag&gt; cursor) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272             super.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277         public Tag getItem(int row) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278             super.getItem(row);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283         public View getView(final int position, View convertView, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287             if (convertView == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288                 convertView = getLayoutInflater().inflate(R.layout.tags_list_row, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290             final Tag tag = mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291             convertView.setTag(tag.getSimperiumKey());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293             TextView tagTitle = (TextView) convertView.findViewById(R.id.tag_name);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294             TextView tagCountTextView = (TextView) convertView.findViewById(R.id.tag_count);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295             tagTitle.setText(tag.getName());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 296             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getSimperiumKey()).count();"> 296             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.geðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297             if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298                 tagCountTextView.setText(Integer.toString(tagCount));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299             } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300                 tagCountTextView.setText(&quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303             ImageButton deleteButton = (ImageButton) convertView.findViewById(R.id.tag_trash);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304             deleteButton.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305                 @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306                 public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307                     if (tagCount == 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308                         deleteTag(tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309                     } else if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310                         AlertDialog.Builder alert = new AlertDialog.Builder(TagsListActivity.this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311                         alert.setTitle(R.string.delete_tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312                         alert.setMessage(getString(R.string.confirm_delete_tag));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313                         alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314                             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315                                 deleteTag(tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316                             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317                         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318                         alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319                             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320                                 // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321                             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322                         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323                         alert.show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328             return convertView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331         private void deleteTag(Tag tag) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332             tag.delete();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333             new removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334             mTracker.sendEvent(&quot;tag&quot;, &quot;deleted_tag&quot;, &quot;list_trash_button&quot;, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338         public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339             return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343         public void bindView(View view, Context context, Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348     private class removeTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351         protected Void doInBackground(Tag... removedTags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352             Tag tag = removedTags[0];</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353             if (tag != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354                 ObjectCursor&lt;Note&gt; notesCursor = tag.findNotes(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355                 while (notesCursor.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356                     Note note = notesCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357                     List&lt;String&gt; tags = note.getTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358                     tags.remove(tag.getName());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359                     note.setTags(tags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360                     note.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362                 notesCursor.close();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364             return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367 }</span>
 368 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371 import android.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372 import android.app.ListActivity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376 import android.os.AsyncTask;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378 import android.text.Html;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379 import android.text.Spannable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380 import android.text.SpannableString;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381 import android.view.ActionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382 import android.view.Menu;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383 import android.view.MenuInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384 import android.view.MenuItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387 import android.widget.AbsListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388 import android.widget.AdapterView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390 import android.widget.EditText;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391 import android.widget.ImageButton;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392 import android.widget.LinearLayout;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 396 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 397 import com.automattic.simplenote.models.Tag;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398 import com.automattic.simplenote.utils.ThemeUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399 import com.automattic.simplenote.widgets.TypefaceSpan;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 400 import com.google.android.gms.analytics.HitBuilders;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 401 import com.google.android.gms.analytics.Tracker;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404 import com.simperium.client.BucketObjectNameInvalid;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 407 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 408 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410  * Created by Dan Roundhill on 6/26/13. (In Greece!)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 412 public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionMode.Callback, AbsListView.MultiChoiceModeListener, AdapterView.OnItemLongClickListener, Bucket.Listener&lt;Tag&gt; {"> 412 public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionModeðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414     private ActionMode mActionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 415     private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416     private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417     private TagsAdapter mTagsAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419     private Tracker mTracker;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 421     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422     public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424         ThemeUtils.setTheme(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 426         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 428         setContentView(R.layout.activity_tags_list);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430         SpannableString s = new SpannableString(getString(R.string.edit_tags));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431         s.setSpan(new TypefaceSpan(this), 0, s.length(),</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432                 Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433         getActionBar().setTitle(s);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435         getActionBar().setDisplayHomeAsUpEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437         TextView emptyTextView = (TextView)findViewById(android.R.id.empty);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 438         emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + getString(R.string.no_tags_found) + &quot;&lt;/strong&gt;&quot;));"> 438         emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + getString(R.string.no_tags_found) + &quot;&lt;/strong&gt;&quot;)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440         ListView listView = getListView();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441         listView.setMultiChoiceModeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442         listView.setOnItemClickListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443         // Disabling long press CAB action for now since bulk deleting is incomplete</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444         // listView.setOnItemLongClickListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 445 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 446         Simplenote application = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 447         mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 448         mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 449 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 450         mTagsAdapter = new TagsAdapter(getBaseContext(), null, 0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 451         setListAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 452         refreshTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 453 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 454         mTracker = application.getTracker();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 455     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 456 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 457     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 458     protected void onResume() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 459         super.onResume();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 460 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 461         mNotesBucket.start();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 462         mTagsBucket.start();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 463 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 464         mTagsBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 465         mTagsBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 466         mTagsBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 467     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 468 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 469     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 470     protected void onPause() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 471         super.onPause();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 472 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 473         mTagsBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 474         mTagsBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 475         mTagsBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 476     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 477 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 478     protected void refreshTags() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 479         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);"> 479         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 480         ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 481         mTagsAdapter.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 482     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 483 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 484     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 485     public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int row, long l) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 486 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 487         final AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 488         LinearLayout alertView = (LinearLayout) getLayoutInflater().inflate(R.layout.edit_tag, null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 489 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 490         final Tag tag = mTagsAdapter.getItem(row);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 491 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 492         final EditText tagNameEditText = (EditText) alertView.findViewById(R.id.tag_name_edit);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 493         tagNameEditText.setText(tag.getName());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 494         tagNameEditText.setSelection(tagNameEditText.length());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 495         alert.setView(alertView);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 496         alert.setTitle(R.string.rename_tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 497         alert.setPositiveButton(R.string.save, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 498             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 499                 String value = tagNameEditText.getText().toString().trim();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 500                 try {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 501                     tag.renameTo(value, mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 502                     mTracker.send(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 503                             new HitBuilders.EventBuilder()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 504                                     .setCategory(&quot;tag&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505                                     .setAction(&quot;edited_tag&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506                                     .setLabel(&quot;tag_alert_edit_box&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507                                     .build()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508                     );</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509                 } catch (BucketObjectNameInvalid e) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510                     android.util.Log.e(Simplenote.TAG, &quot;Unable to rename tag&quot;, e);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511                     // TODO: show user a message that new tag name is not ok</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515         alert.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517                 // Do nothing</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520         alert.show();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524     // TODO: Finish bulk editing</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526     public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527         MenuInflater inflater = actionMode.getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528         inflater.inflate(R.menu.bulk_edit_tags, menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529         mActionMode = actionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530         return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534     public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 536     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 537 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 538     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 539     public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 540         switch (menuItem.getItemId()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 541             case R.id.menu_delete:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542                 actionMode.finish(); // Action picked, so close the CAB</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544             default:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545                 return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 546         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 547     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 548 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 549     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550     public void onDestroyActionMode(ActionMode actionMode) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551         mActionMode = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 552     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 553 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 554     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 555     public void onItemCheckedStateChanged(ActionMode actionMode, int i, long l, boolean b) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 556         final int checkedCount = getListView().getCheckedItemCount();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 557         switch (checkedCount) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 558             case 0:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 559                 actionMode.setSubtitle(null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 560                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 561             case 1:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 562                 actionMode.setSubtitle(&quot;One item selected&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 563                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 564             default:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 565                 actionMode.setSubtitle(&quot;&quot; + checkedCount + &quot; items selected&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 566                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 567         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 568     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 569 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 570     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 571     public boolean onItemLongClick(AdapterView&lt;?&gt; adapterView, View view, int position, long l) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 572         getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 573         getListView().setItemChecked(position, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 574         if (mActionMode == null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 575             startActionMode(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 576         //isCABDestroyed = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 577         return false; // so this action does not consume the event!!!</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 578     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 579 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 580     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 581     public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 582 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 583         if (item.getItemId() == android.R.id.home) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 584             finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 585             return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 586         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 587 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 588         return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 589     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 590 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 591     // Tag Bucket listeners</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 592     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 593     public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 594         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 595             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 596             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 597                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 598             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 599         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 600     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 601 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 602     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 603     public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 604         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 605             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 606             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 607                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 608             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 609         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 610     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 611 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 612     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 613     public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 614         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 615             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 616             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 617                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 618             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 619         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 620     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 621 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 622     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 623     public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 624         // noop</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 625     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 626 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 627     private class TagsAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 628 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 629         private ObjectCursor&lt;Tag&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 630 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 631         public TagsAdapter(Context context, ObjectCursor&lt;Tag&gt; c, int flags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 632             super(context, c, flags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 633             mCursor = c;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 634         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 635 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 636         public void changeCursor(ObjectCursor&lt;Tag&gt; cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 637             super.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 638             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 639         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 640 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 641         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 642         public Tag getItem(int row) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 643             super.getItem(row);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 644             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 645         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 646 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 647         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 648         public View getView(final int position, View convertView, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 649 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 650             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 651 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 652             if (convertView == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 653                 convertView = getLayoutInflater().inflate(R.layout.tags_list_row, null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 654             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 655             final Tag tag = mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 656             convertView.setTag(tag.getSimperiumKey());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 657 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 658             TextView tagTitle = (TextView) convertView.findViewById(R.id.tag_name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 659             TextView tagCountTextView = (TextView) convertView.findViewById(R.id.tag_count);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 660             tagTitle.setText(tag.getName());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 661             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getSimperiumKey()).count();"> 661             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.geðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 662             if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 663                 tagCountTextView.setText(Integer.toString(tagCount));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 664             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 665                 tagCountTextView.setText(&quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 666             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 667 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 668             ImageButton deleteButton = (ImageButton) convertView.findViewById(R.id.tag_trash);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 669             deleteButton.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 670                 @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 671                 public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 672                     if (tagCount == 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 673                         deleteTag(tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 674                     } else if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 675                         AlertDialog.Builder alert = new AlertDialog.Builder(TagsListActivity.this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 676                         alert.setTitle(R.string.delete_tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 677                         alert.setMessage(getString(R.string.confirm_delete_tag));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 678                         alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 679                             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 680                                 deleteTag(tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 681                             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 682                         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 683                         alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 684                             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 685                                 // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 686                             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 687                         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 688                         alert.show();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 689                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 690                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 691             });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 692 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 693             return convertView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 694         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 695 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 696         private void deleteTag(Tag tag) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 697             tag.delete();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 698             new removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 699             mTracker.send(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 700                     new HitBuilders.EventBuilder()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 701                             .setCategory(&quot;tag&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 702                             .setAction(&quot;deleted_tag&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 703                             .setLabel(&quot;list_trash_button&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 704                             .build()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 705             );</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 706         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 707 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 708         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 709         public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 710             return null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 713         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 714         public void bindView(View view, Context context, Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 715 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 716         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 717     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 718 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 719     private class removeTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 720 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 721         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 722         protected Void doInBackground(Tag... removedTags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 723             Tag tag = removedTags[0];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 724             if (tag != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 725                 ObjectCursor&lt;Note&gt; notesCursor = tag.findNotes(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 726                 while (notesCursor.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 727                     Note note = notesCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 728                     List&lt;String&gt; tags = note.getTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 729                     tags.remove(tag.getName());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 730                     note.setTags(tags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 731                     note.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 732                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 733                 notesCursor.close();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 734             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 735             return null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 736         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 737     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 738 }</span>
 739 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import android.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import android.app.ListActivity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import android.os.AsyncTask;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 import android.text.Html;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import android.text.Spannable;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 import android.text.SpannableString;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import android.view.ActionMode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 import android.view.Menu;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 import android.view.MenuInflater;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 import android.view.MenuItem;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import android.widget.AbsListView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import android.widget.AdapterView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import android.widget.EditText;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import android.widget.ImageButton;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import android.widget.LinearLayout;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import com.automattic.simplenote.models.Tag;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import com.automattic.simplenote.utils.ThemeUtils;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import com.automattic.simplenote.widgets.TypefaceSpan;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import com.google.analytics.tracking.android.EasyTracker;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import com.google.analytics.tracking.android.Tracker;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 import com.simperium.client.BucketObjectNameInvalid;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44  * Created by Dan Roundhill on 6/26/13. (In Greece!)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  46 public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionMode.Callback, AbsListView.MultiChoiceModeListener, AdapterView.OnItemLongClickListener, Bucket.Listener&lt;Tag&gt; {">  46 public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionModeðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48     private ActionMode mActionMode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49     private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50     private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51     private TagsAdapter mTagsAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53     private Tracker mTracker;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56     public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58         ThemeUtils.setTheme(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62         setContentView(R.layout.activity_tags_list);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64         SpannableString s = new SpannableString(getString(R.string.edit_tags));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65         s.setSpan(new TypefaceSpan(this), 0, s.length(),</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66                 Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67         getActionBar().setTitle(s);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69         getActionBar().setDisplayHomeAsUpEnabled(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71         TextView emptyTextView = (TextView)findViewById(android.R.id.empty);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  72         emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + getString(R.string.no_tags_found) + &quot;&lt;/strong&gt;&quot;));">  72         emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + getString(R.string.no_tags_found) + &quot;&lt;/strong&gt;&quot;)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74         ListView listView = getListView();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75         listView.setMultiChoiceModeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76         listView.setOnItemClickListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77         // Disabling long press CAB action for now since bulk deleting is incomplete</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78         // listView.setOnItemLongClickListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         Simplenote application = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81         mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82         mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84         mTagsAdapter = new TagsAdapter(getBaseContext(), null, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85         setListAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86         refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88         EasyTracker.getInstance().activityStart(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89         mTracker = EasyTracker.getTracker();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93     protected void onResume() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94         super.onResume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96         mNotesBucket.start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97         mTagsBucket.start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99         mTagsBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100         mTagsBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101         mTagsBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105     protected void onPause() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106         super.onPause();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         mTagsBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109         mTagsBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110         mTagsBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114     public void onStop() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115         super.onStop();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116         EasyTracker.getInstance().activityStop(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119     protected void refreshTags() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 120         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);"> 120         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121         ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122         mTagsAdapter.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126     public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int row, long l) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128         final AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129         LinearLayout alertView = (LinearLayout) getLayoutInflater().inflate(R.layout.edit_tag, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131         final Tag tag = mTagsAdapter.getItem(row);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133         final EditText tagNameEditText = (EditText) alertView.findViewById(R.id.tag_name_edit);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134         tagNameEditText.setText(tag.getName());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135         tagNameEditText.setSelection(tagNameEditText.length());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136         alert.setView(alertView);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137         alert.setTitle(R.string.rename_tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138         alert.setPositiveButton(R.string.save, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140                 String value = tagNameEditText.getText().toString().trim();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141                 try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142                     tag.renameTo(value, mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143                     mTracker.sendEvent(&quot;tag&quot;, &quot;edited_tag&quot;, &quot;tag_alert_edit_box&quot;, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144                 } catch (BucketObjectNameInvalid e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145                     android.util.Log.e(Simplenote.TAG, &quot;Unable to rename tag&quot;, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146                     // TODO: show user a message that new tag name is not ok</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150         alert.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152                 // Do nothing</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155         alert.show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159     // TODO: Finish bulk editing</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161     public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162         MenuInflater inflater = actionMode.getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163         inflater.inflate(R.menu.bulk_edit_tags, menu);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164         mActionMode = actionMode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165         return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169     public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170         return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174     public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175         switch (menuItem.getItemId()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176             case R.id.menu_delete:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177                 actionMode.finish(); // Action picked, so close the CAB</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179             default:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180                 return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185     public void onDestroyActionMode(ActionMode actionMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186         mActionMode = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190     public void onItemCheckedStateChanged(ActionMode actionMode, int i, long l, boolean b) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191         final int checkedCount = getListView().getCheckedItemCount();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192         switch (checkedCount) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193             case 0:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194                 actionMode.setSubtitle(null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195                 break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196             case 1:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197                 actionMode.setSubtitle(&quot;One item selected&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198                 break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199             default:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200                 actionMode.setSubtitle(&quot;&quot; + checkedCount + &quot; items selected&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201                 break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206     public boolean onItemLongClick(AdapterView&lt;?&gt; adapterView, View view, int position, long l) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207         getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208         getListView().setItemChecked(position, true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209         if (mActionMode == null)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210             startActionMode(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211         //isCABDestroyed = false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212         return false; // so this action does not consume the event!!!</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216     public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218         if (item.getItemId() == android.R.id.home) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219             finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223         return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226     // Tag Bucket listeners</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228     public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231             public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238     public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241             public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248     public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251             public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258     public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259         // noop</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262     private class TagsAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264         private ObjectCursor&lt;Tag&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266         public TagsAdapter(Context context, ObjectCursor&lt;Tag&gt; c, int flags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267             super(context, c, flags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268             mCursor = c;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271         public void changeCursor(ObjectCursor&lt;Tag&gt; cursor) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272             super.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277         public Tag getItem(int row) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278             super.getItem(row);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283         public View getView(final int position, View convertView, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287             if (convertView == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288                 convertView = getLayoutInflater().inflate(R.layout.tags_list_row, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290             final Tag tag = mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291             convertView.setTag(tag.getSimperiumKey());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293             TextView tagTitle = (TextView) convertView.findViewById(R.id.tag_name);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294             TextView tagCountTextView = (TextView) convertView.findViewById(R.id.tag_count);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295             tagTitle.setText(tag.getName());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 296             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getSimperiumKey()).count();"> 296             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.geðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297             if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298                 tagCountTextView.setText(Integer.toString(tagCount));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299             } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300                 tagCountTextView.setText(&quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303             ImageButton deleteButton = (ImageButton) convertView.findViewById(R.id.tag_trash);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304             deleteButton.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305                 @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306                 public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307                     if (tagCount == 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308                         deleteTag(tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309                     } else if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310                         AlertDialog.Builder alert = new AlertDialog.Builder(TagsListActivity.this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311                         alert.setTitle(R.string.delete_tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312                         alert.setMessage(getString(R.string.confirm_delete_tag));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313                         alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314                             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315                                 deleteTag(tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316                             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317                         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318                         alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319                             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320                                 // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321                             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322                         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323                         alert.show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328             return convertView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331         private void deleteTag(Tag tag) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332             tag.delete();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333             new removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334             mTracker.sendEvent(&quot;tag&quot;, &quot;deleted_tag&quot;, &quot;list_trash_button&quot;, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338         public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339             return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343         public void bindView(View view, Context context, Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348     private class removeTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351         protected Void doInBackground(Tag... removedTags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352             Tag tag = removedTags[0];</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353             if (tag != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354                 ObjectCursor&lt;Note&gt; notesCursor = tag.findNotes(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355                 while (notesCursor.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356                     Note note = notesCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357                     List&lt;String&gt; tags = note.getTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358                     tags.remove(tag.getName());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359                     note.setTags(tags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360                     note.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362                 notesCursor.close();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364             return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367 }</span>
 368 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371 import android.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372 import android.app.ListActivity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376 import android.os.AsyncTask;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378 import android.text.Html;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379 import android.text.Spannable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380 import android.text.SpannableString;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381 import android.view.ActionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382 import android.view.Menu;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383 import android.view.MenuInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384 import android.view.MenuItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387 import android.widget.AbsListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388 import android.widget.AdapterView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390 import android.widget.EditText;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391 import android.widget.ImageButton;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392 import android.widget.LinearLayout;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 396 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 397 import com.automattic.simplenote.models.Tag;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398 import com.automattic.simplenote.utils.ThemeUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399 import com.automattic.simplenote.widgets.TypefaceSpan;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 400 import com.google.android.gms.analytics.HitBuilders;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 401 import com.google.android.gms.analytics.Tracker;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404 import com.simperium.client.BucketObjectNameInvalid;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 407 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 408 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410  * Created by Dan Roundhill on 6/26/13. (In Greece!)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 412 public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionMode.Callback, AbsListView.MultiChoiceModeListener, AdapterView.OnItemLongClickListener, Bucket.Listener&lt;Tag&gt; {"> 412 public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionModeðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414     private ActionMode mActionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 415     private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416     private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417     private TagsAdapter mTagsAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419     private Tracker mTracker;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 421     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422     public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424         ThemeUtils.setTheme(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 426         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 428         setContentView(R.layout.activity_tags_list);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430         SpannableString s = new SpannableString(getString(R.string.edit_tags));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431         s.setSpan(new TypefaceSpan(this), 0, s.length(),</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432                 Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433         getActionBar().setTitle(s);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435         getActionBar().setDisplayHomeAsUpEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437         TextView emptyTextView = (TextView)findViewById(android.R.id.empty);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 438         emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + getString(R.string.no_tags_found) + &quot;&lt;/strong&gt;&quot;));"> 438         emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + getString(R.string.no_tags_found) + &quot;&lt;/strong&gt;&quot;)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440         ListView listView = getListView();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441         listView.setMultiChoiceModeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442         listView.setOnItemClickListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443         // Disabling long press CAB action for now since bulk deleting is incomplete</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444         // listView.setOnItemLongClickListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 445 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 446         Simplenote application = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 447         mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 448         mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 449 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 450         mTagsAdapter = new TagsAdapter(getBaseContext(), null, 0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 451         setListAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 452         refreshTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 453 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 454         mTracker = application.getTracker();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 455     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 456 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 457     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 458     protected void onResume() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 459         super.onResume();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 460 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 461         mNotesBucket.start();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 462         mTagsBucket.start();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 463 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 464         mTagsBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 465         mTagsBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 466         mTagsBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 467     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 468 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 469     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 470     protected void onPause() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 471         super.onPause();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 472 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 473         mTagsBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 474         mTagsBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 475         mTagsBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 476     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 477 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 478     protected void refreshTags() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 479         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);"> 479         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 480         ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 481         mTagsAdapter.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 482     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 483 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 484     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 485     public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int row, long l) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 486 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 487         final AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 488         LinearLayout alertView = (LinearLayout) getLayoutInflater().inflate(R.layout.edit_tag, null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 489 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 490         final Tag tag = mTagsAdapter.getItem(row);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 491 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 492         final EditText tagNameEditText = (EditText) alertView.findViewById(R.id.tag_name_edit);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 493         tagNameEditText.setText(tag.getName());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 494         tagNameEditText.setSelection(tagNameEditText.length());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 495         alert.setView(alertView);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 496         alert.setTitle(R.string.rename_tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 497         alert.setPositiveButton(R.string.save, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 498             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 499                 String value = tagNameEditText.getText().toString().trim();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 500                 try {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 501                     tag.renameTo(value, mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 502                     mTracker.send(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 503                             new HitBuilders.EventBuilder()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 504                                     .setCategory(&quot;tag&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505                                     .setAction(&quot;edited_tag&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506                                     .setLabel(&quot;tag_alert_edit_box&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507                                     .build()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508                     );</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509                 } catch (BucketObjectNameInvalid e) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510                     android.util.Log.e(Simplenote.TAG, &quot;Unable to rename tag&quot;, e);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511                     // TODO: show user a message that new tag name is not ok</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515         alert.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517                 // Do nothing</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520         alert.show();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524     // TODO: Finish bulk editing</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526     public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527         MenuInflater inflater = actionMode.getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528         inflater.inflate(R.menu.bulk_edit_tags, menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529         mActionMode = actionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530         return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534     public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 536     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 537 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 538     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 539     public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 540         switch (menuItem.getItemId()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 541             case R.id.menu_delete:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542                 actionMode.finish(); // Action picked, so close the CAB</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544             default:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545                 return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 546         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 547     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 548 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 549     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550     public void onDestroyActionMode(ActionMode actionMode) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551         mActionMode = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 552     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 553 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 554     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 555     public void onItemCheckedStateChanged(ActionMode actionMode, int i, long l, boolean b) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 556         final int checkedCount = getListView().getCheckedItemCount();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 557         switch (checkedCount) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 558             case 0:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 559                 actionMode.setSubtitle(null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 560                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 561             case 1:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 562                 actionMode.setSubtitle(&quot;One item selected&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 563                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 564             default:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 565                 actionMode.setSubtitle(&quot;&quot; + checkedCount + &quot; items selected&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 566                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 567         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 568     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 569 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 570     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 571     public boolean onItemLongClick(AdapterView&lt;?&gt; adapterView, View view, int position, long l) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 572         getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 573         getListView().setItemChecked(position, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 574         if (mActionMode == null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 575             startActionMode(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 576         //isCABDestroyed = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 577         return false; // so this action does not consume the event!!!</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 578     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 579 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 580     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 581     public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 582 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 583         if (item.getItemId() == android.R.id.home) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 584             finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 585             return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 586         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 587 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 588         return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 589     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 590 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 591     // Tag Bucket listeners</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 592     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 593     public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 594         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 595             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 596             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 597                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 598             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 599         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 600     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 601 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 602     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 603     public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 604         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 605             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 606             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 607                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 608             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 609         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 610     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 611 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 612     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 613     public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 614         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 615             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 616             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 617                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 618             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 619         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 620     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 621 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 622     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 623     public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 624         // noop</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 625     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 626 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 627     private class TagsAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 628 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 629         private ObjectCursor&lt;Tag&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 630 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 631         public TagsAdapter(Context context, ObjectCursor&lt;Tag&gt; c, int flags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 632             super(context, c, flags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 633             mCursor = c;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 634         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 635 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 636         public void changeCursor(ObjectCursor&lt;Tag&gt; cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 637             super.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 638             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 639         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 640 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 641         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 642         public Tag getItem(int row) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 643             super.getItem(row);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 644             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 645         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 646 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 647         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 648         public View getView(final int position, View convertView, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 649 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 650             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 651 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 652             if (convertView == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 653                 convertView = getLayoutInflater().inflate(R.layout.tags_list_row, null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 654             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 655             final Tag tag = mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 656             convertView.setTag(tag.getSimperiumKey());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 657 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 658             TextView tagTitle = (TextView) convertView.findViewById(R.id.tag_name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 659             TextView tagCountTextView = (TextView) convertView.findViewById(R.id.tag_count);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 660             tagTitle.setText(tag.getName());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 661             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getSimperiumKey()).count();"> 661             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.geðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 662             if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 663                 tagCountTextView.setText(Integer.toString(tagCount));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 664             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 665                 tagCountTextView.setText(&quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 666             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 667 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 668             ImageButton deleteButton = (ImageButton) convertView.findViewById(R.id.tag_trash);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 669             deleteButton.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 670                 @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 671                 public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 672                     if (tagCount == 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 673                         deleteTag(tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 674                     } else if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 675                         AlertDialog.Builder alert = new AlertDialog.Builder(TagsListActivity.this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 676                         alert.setTitle(R.string.delete_tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 677                         alert.setMessage(getString(R.string.confirm_delete_tag));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 678                         alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 679                             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 680                                 deleteTag(tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 681                             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 682                         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 683                         alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 684                             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 685                                 // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 686                             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 687                         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 688                         alert.show();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 689                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 690                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 691             });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 692 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 693             return convertView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 694         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 695 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 696         private void deleteTag(Tag tag) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 697             tag.delete();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 698             new removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 699             mTracker.send(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 700                     new HitBuilders.EventBuilder()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 701                             .setCategory(&quot;tag&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 702                             .setAction(&quot;deleted_tag&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 703                             .setLabel(&quot;list_trash_button&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 704                             .build()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 705             );</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 706         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 707 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 708         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 709         public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 710             return null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 713         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 714         public void bindView(View view, Context context, Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 715 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 716         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 717     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 718 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 719     private class removeTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 720 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 721         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 722         protected Void doInBackground(Tag... removedTags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 723             Tag tag = removedTags[0];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 724             if (tag != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 725                 ObjectCursor&lt;Note&gt; notesCursor = tag.findNotes(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 726                 while (notesCursor.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 727                     Note note = notesCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 728                     List&lt;String&gt; tags = note.getTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 729                     tags.remove(tag.getName());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 730                     note.setTags(tags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 731                     note.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 732                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 733                 notesCursor.close();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 734             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 735             return null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 736         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 737     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 738 }</span>
 739 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
   4 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   5 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   6 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   7 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   8 import android.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   9 import android.app.ListActivity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  10 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  11 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  12 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  13 import android.os.AsyncTask;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  14 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  15 import android.text.Html;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  16 import android.text.Spannable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  17 import android.text.SpannableString;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  18 import android.view.ActionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  19 import android.view.Menu;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  20 import android.view.MenuInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  21 import android.view.MenuItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  22 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  24 import android.widget.AbsListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  25 import android.widget.AdapterView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  26 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  27 import android.widget.EditText;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  28 import android.widget.ImageButton;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  29 import android.widget.LinearLayout;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  30 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  31 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  32 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  33 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  34 import com.automattic.simplenote.models.Tag;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  35 import com.automattic.simplenote.utils.ThemeUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36 import com.automattic.simplenote.widgets.TypefaceSpan;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37 import com.google.android.gms.analytics.HitBuilders;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38 import com.google.android.gms.analytics.Tracker;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  39 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  40 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  41 import com.simperium.client.BucketObjectNameInvalid;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  42 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  43 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  44 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  45 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  46 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  47  * Created by Dan Roundhill on 6/26/13. (In Greece!)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  48  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  49 public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionMode.Callback, AbsListView.MultiChoiceModeListener, AdapterView.OnItemLongClickListener, Bucket.Listener&lt;Tag&gt; {">  49 public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionModeðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51     private ActionMode mActionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52     private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53     private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54     private TagsAdapter mTagsAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  55 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  56     private Tracker mTracker;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59     public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61         ThemeUtils.setTheme(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65         setContentView(R.layout.activity_tags_list);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67         SpannableString s = new SpannableString(getString(R.string.edit_tags));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68         s.setSpan(new TypefaceSpan(this), 0, s.length(),</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69                 Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  70         getActionBar().setTitle(s);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72         getActionBar().setDisplayHomeAsUpEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74         TextView emptyTextView = (TextView)findViewById(android.R.id.empty);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  75         emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + getString(R.string.no_tags_found) + &quot;&lt;/strong&gt;&quot;));">  75         emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + getString(R.string.no_tags_found) + &quot;&lt;/strong&gt;&quot;)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77         ListView listView = getListView();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78         listView.setMultiChoiceModeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79         listView.setOnItemClickListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  80         // Disabling long press CAB action for now since bulk deleting is incomplete</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81         // listView.setOnItemLongClickListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83         Simplenote application = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84         mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85         mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87         mTagsAdapter = new TagsAdapter(getBaseContext(), null, 0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88         setListAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89         refreshTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91         mTracker = application.getTracker();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95     protected void onResume() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96         super.onResume();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98         mNotesBucket.start();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99         mTagsBucket.start();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101         mTagsBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102         mTagsBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103         mTagsBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107     protected void onPause() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108         super.onPause();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110         mTagsBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111         mTagsBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112         mTagsBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115     protected void refreshTags() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 116         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);"> 116         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117         ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118         mTagsAdapter.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122     public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int row, long l) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124         final AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125         LinearLayout alertView = (LinearLayout) getLayoutInflater().inflate(R.layout.edit_tag, null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127         final Tag tag = mTagsAdapter.getItem(row);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129         final EditText tagNameEditText = (EditText) alertView.findViewById(R.id.tag_name_edit);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130         tagNameEditText.setText(tag.getName());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131         tagNameEditText.setSelection(tagNameEditText.length());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132         alert.setView(alertView);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133         alert.setTitle(R.string.rename_tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134         alert.setPositiveButton(R.string.save, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136                 String value = tagNameEditText.getText().toString().trim();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137                 try {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138                     tag.renameTo(value, mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139                     mTracker.send(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140                             new HitBuilders.EventBuilder()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141                                     .setCategory(&quot;tag&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142                                     .setAction(&quot;edited_tag&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143                                     .setLabel(&quot;tag_alert_edit_box&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144                                     .build()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145                     );</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146                 } catch (BucketObjectNameInvalid e) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147                     android.util.Log.e(Simplenote.TAG, &quot;Unable to rename tag&quot;, e);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148                     // TODO: show user a message that new tag name is not ok</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152         alert.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154                 // Do nothing</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157         alert.show();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161     // TODO: Finish bulk editing</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163     public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164         MenuInflater inflater = actionMode.getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165         inflater.inflate(R.menu.bulk_edit_tags, menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166         mActionMode = actionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167         return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171     public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176     public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177         switch (menuItem.getItemId()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178             case R.id.menu_delete:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179                 actionMode.finish(); // Action picked, so close the CAB</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181             default:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182                 return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187     public void onDestroyActionMode(ActionMode actionMode) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188         mActionMode = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192     public void onItemCheckedStateChanged(ActionMode actionMode, int i, long l, boolean b) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193         final int checkedCount = getListView().getCheckedItemCount();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194         switch (checkedCount) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195             case 0:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196                 actionMode.setSubtitle(null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198             case 1:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199                 actionMode.setSubtitle(&quot;One item selected&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201             default:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202                 actionMode.setSubtitle(&quot;&quot; + checkedCount + &quot; items selected&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208     public boolean onItemLongClick(AdapterView&lt;?&gt; adapterView, View view, int position, long l) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209         getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210         getListView().setItemChecked(position, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211         if (mActionMode == null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212             startActionMode(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213         //isCABDestroyed = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214         return false; // so this action does not consume the event!!!</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218     public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220         if (item.getItemId() == android.R.id.home) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221             finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222             return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225         return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228     // Tag Bucket listeners</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230     public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240     public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250     public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254                 refreshTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260     public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261         // noop</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264     private class TagsAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266         private ObjectCursor&lt;Tag&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268         public TagsAdapter(Context context, ObjectCursor&lt;Tag&gt; c, int flags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269             super(context, c, flags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270             mCursor = c;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273         public void changeCursor(ObjectCursor&lt;Tag&gt; cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274             super.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279         public Tag getItem(int row) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280             super.getItem(row);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285         public View getView(final int position, View convertView, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289             if (convertView == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290                 convertView = getLayoutInflater().inflate(R.layout.tags_list_row, null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292             final Tag tag = mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293             convertView.setTag(tag.getSimperiumKey());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295             TextView tagTitle = (TextView) convertView.findViewById(R.id.tag_name);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296             TextView tagCountTextView = (TextView) convertView.findViewById(R.id.tag_count);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297             tagTitle.setText(tag.getName());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 298             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getSimperiumKey()).count();"> 298             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.geðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299             if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300                 tagCountTextView.setText(Integer.toString(tagCount));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302                 tagCountTextView.setText(&quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 303             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305             ImageButton deleteButton = (ImageButton) convertView.findViewById(R.id.tag_trash);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306             deleteButton.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307                 @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308                 public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309                     if (tagCount == 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310                         deleteTag(tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311                     } else if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312                         AlertDialog.Builder alert = new AlertDialog.Builder(TagsListActivity.this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313                         alert.setTitle(R.string.delete_tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314                         alert.setMessage(getString(R.string.confirm_delete_tag));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315                         alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316                             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317                                 deleteTag(tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318                             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 319                         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320                         alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 321                             public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 322                                 // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 323                             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 324                         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 325                         alert.show();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 326                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 327                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 328             });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 329 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 330             return convertView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 331         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 332 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 333         private void deleteTag(Tag tag) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 334             tag.delete();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 335             new removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 336             mTracker.send(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 337                     new HitBuilders.EventBuilder()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 338                             .setCategory(&quot;tag&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 339                             .setAction(&quot;deleted_tag&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 340                             .setLabel(&quot;list_trash_button&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 341                             .build()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 342             );</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 343         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 344 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 345         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 346         public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 347             return null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 348         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 349 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 350         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 351         public void bindView(View view, Context context, Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 352 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356     private class removeTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359         protected Void doInBackground(Tag... removedTags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360             Tag tag = removedTags[0];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361             if (tag != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362                 ObjectCursor&lt;Note&gt; notesCursor = tag.findNotes(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363                 while (notesCursor.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364                     Note note = notesCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365                     List&lt;String&gt; tags = note.getTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366                     tags.remove(tag.getName());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367                     note.setTags(tags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368                     note.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370                 notesCursor.close();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372             return null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375 }</span>
 376 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   1 -package com.automattic.simplenote;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   2 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   3 -import android.app.AlertDialog;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   4 -import android.app.ListActivity;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   5 -import android.content.Context;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   6 -import android.content.DialogInterface;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   7 -import android.database.Cursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   8 -import android.os.AsyncTask;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   9 -import android.os.Bundle;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  10 -import android.text.Html;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  11 -import android.text.Spannable;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  12 -import android.text.SpannableString;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  13 -import android.view.ActionMode;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  14 -import android.view.Menu;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  15 -import android.view.MenuInflater;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  16 -import android.view.MenuItem;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  17 -import android.view.View;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  18 -import android.view.ViewGroup;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -import android.widget.AbsListView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -import android.widget.AdapterView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -import android.widget.EditText;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -import android.widget.ImageButton;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -import android.widget.LinearLayout;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -import android.widget.ListView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  26 -import android.widget.TextView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  28 -import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -import com.automattic.simplenote.models.Tag;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 -import com.automattic.simplenote.utils.ThemeUtils;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  31 -import com.automattic.simplenote.widgets.TypefaceSpan;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 -import com.google.analytics.tracking.android.EasyTracker;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -import com.google.analytics.tracking.android.Tracker;</span>


<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  35 -import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 -import com.simperium.client.BucketObjectNameInvalid;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  37 -import com.simperium.client.Query;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  38 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  39 -import java.util.List;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 -/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 - * Created by Dan Roundhill on 6/26/13. (In Greece!)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 - */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  44 -public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionMode.Callback, AbsListView.MultiChoiceModeListener, AdapterView.OnItemLongClickListener, Bucket.Listener&lt;Tag&gt; {">  44 -public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionMode.CallbackðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -    private ActionMode mActionMode;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -    private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -    private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -    private TagsAdapter mTagsAdapter;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  50 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -    private Tracker mTracker;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  52 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  53 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -    public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -        ThemeUtils.setTheme(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -        super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -        setContentView(R.layout.activity_tags_list);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  61 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  62 -        SpannableString s = new SpannableString(getString(R.string.edit_tags));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -        s.setSpan(new TypefaceSpan(this), 0, s.length(),</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -                Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -        getActionBar().setTitle(s);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  67 -        getActionBar().setDisplayHomeAsUpEnabled(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  68 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  69 -        TextView emptyTextView = (TextView)findViewById(android.R.id.empty);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  70 -        emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + getString(R.string.no_tags_found) + &quot;&lt;/strong&gt;&quot;));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  71 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  72 -        ListView listView = getListView();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -        listView.setMultiChoiceModeListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -        listView.setOnItemClickListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -        // Disabling long press CAB action for now since bulk deleting is incomplete</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  76 -        // listView.setOnItemLongClickListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  77 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  78 -        Simplenote application = (Simplenote) getApplication();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  79 -        mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -        mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -        mTagsAdapter = new TagsAdapter(getBaseContext(), null, 0);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -        setListAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  84 -        refreshTags();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -        EasyTracker.getInstance().activityStart(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -        mTracker = EasyTracker.getTracker();</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  90 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -    protected void onResume() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -        super.onResume();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -        mNotesBucket.start();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  95 -        mTagsBucket.start();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  96 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  97 -        mTagsBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  98 -        mTagsBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  99 -        mTagsBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 100 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 101 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 102 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 103 -    protected void onPause() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 104 -        super.onPause();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 105 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 106 -        mTagsBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 107 -        mTagsBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 108 -        mTagsBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 109 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 110 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 111 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 112 -    public void onStop() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 113 -        super.onStop();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 114 -        EasyTracker.getInstance().activityStop(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 115 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -    protected void refreshTags() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 118 -        Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 119 -        ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 120 -        mTagsAdapter.changeCursor(cursor);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 123 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 124 -    public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int row, long l) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 126 -        final AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 127 -        LinearLayout alertView = (LinearLayout) getLayoutInflater().inflate(R.layout.edit_tag, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 128 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 129 -        final Tag tag = mTagsAdapter.getItem(row);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 130 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 131 -        final EditText tagNameEditText = (EditText) alertView.findViewById(R.id.tag_name_edit);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 132 -        tagNameEditText.setText(tag.getName());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 133 -        tagNameEditText.setSelection(tagNameEditText.length());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 134 -        alert.setView(alertView);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 135 -        alert.setTitle(R.string.rename_tag);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 136 -        alert.setPositiveButton(R.string.save, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 137 -            public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 138 -                String value = tagNameEditText.getText().toString().trim();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 139 -                try {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 140 -                    tag.renameTo(value, mNotesBucket);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 141 -                    mTracker.sendEvent(&quot;tag&quot;, &quot;edited_tag&quot;, &quot;tag_alert_edit_box&quot;, null);</span>







<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 142 -                } catch (BucketObjectNameInvalid e) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 143 -                    android.util.Log.e(Simplenote.TAG, &quot;Unable to rename tag&quot;, e);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 144 -                    // TODO: show user a message that new tag name is not ok</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 145 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 146 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 147 -        });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 148 -        alert.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 149 -            public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 150 -                // Do nothing</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 151 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 152 -        });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 153 -        alert.show();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 154 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 155 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 156 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -    // TODO: Finish bulk editing</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 158 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 159 -    public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 160 -        MenuInflater inflater = actionMode.getMenuInflater();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 161 -        inflater.inflate(R.menu.bulk_edit_tags, menu);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 162 -        mActionMode = actionMode;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 163 -        return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 164 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 165 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 166 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -    public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 168 -        return false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 169 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 170 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 171 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 172 -    public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 173 -        switch (menuItem.getItemId()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 174 -            case R.id.menu_delete:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 175 -                actionMode.finish(); // Action picked, so close the CAB</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 176 -                return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 177 -            default:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 178 -                return false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 179 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 180 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 181 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 182 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 183 -    public void onDestroyActionMode(ActionMode actionMode) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 184 -        mActionMode = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 185 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 186 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 187 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 188 -    public void onItemCheckedStateChanged(ActionMode actionMode, int i, long l, boolean b) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 189 -        final int checkedCount = getListView().getCheckedItemCount();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 190 -        switch (checkedCount) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 191 -            case 0:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 192 -                actionMode.setSubtitle(null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 193 -                break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 194 -            case 1:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 195 -                actionMode.setSubtitle(&quot;One item selected&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 196 -                break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 197 -            default:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 198 -                actionMode.setSubtitle(&quot;&quot; + checkedCount + &quot; items selected&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 199 -                break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 200 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 201 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 202 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 203 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 204 -    public boolean onItemLongClick(AdapterView&lt;?&gt; adapterView, View view, int position, long l) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 205 -        getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 206 -        getListView().setItemChecked(position, true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 207 -        if (mActionMode == null)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 208 -            startActionMode(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 209 -        //isCABDestroyed = false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 210 -        return false; // so this action does not consume the event!!!</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 211 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 212 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 213 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 214 -    public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 215 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 216 -        if (item.getItemId() == android.R.id.home) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 217 -            finish();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 218 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 219 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 220 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 221 -        return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 222 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 223 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 224 -    // Tag Bucket listeners</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 225 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 226 -    public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 227 -        runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 228 -            @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 229 -            public void run() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 230 -                refreshTags();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 231 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 232 -        });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 233 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 234 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 235 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 236 -    public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 237 -        runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 238 -            @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 239 -            public void run() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 240 -                refreshTags();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 241 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 242 -        });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 243 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 244 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 245 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 246 -    public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 247 -        runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 248 -            @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 249 -            public void run() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 250 -                refreshTags();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 251 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 252 -        });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 253 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 254 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 255 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 256 -    public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 257 -        // noop</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 258 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 259 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 260 -    private class TagsAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 261 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 262 -        private ObjectCursor&lt;Tag&gt; mCursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 263 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 264 -        public TagsAdapter(Context context, ObjectCursor&lt;Tag&gt; c, int flags) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 265 -            super(context, c, flags);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 266 -            mCursor = c;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 267 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 268 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 269 -        public void changeCursor(ObjectCursor&lt;Tag&gt; cursor) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 270 -            super.changeCursor(cursor);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 271 -            mCursor = cursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 272 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 273 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 274 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 275 -        public Tag getItem(int row) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 276 -            super.getItem(row);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 277 -            return mCursor.getObject();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 278 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 279 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 280 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 281 -        public View getView(final int position, View convertView, ViewGroup parent) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 282 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 283 -            mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 284 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 285 -            if (convertView == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 286 -                convertView = getLayoutInflater().inflate(R.layout.tags_list_row, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 287 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 288 -            final Tag tag = mCursor.getObject();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 289 -            convertView.setTag(tag.getSimperiumKey());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 290 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 291 -            TextView tagTitle = (TextView) convertView.findViewById(R.id.tag_name);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 292 -            TextView tagCountTextView = (TextView) convertView.findViewById(R.id.tag_count);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 293 -            tagTitle.setText(tag.getName());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 294 -            final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getSimperiumKey()).count();"> 294 -            final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getSimperiuðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 295 -            if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 296 -                tagCountTextView.setText(Integer.toString(tagCount));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 297 -            } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 298 -                tagCountTextView.setText(&quot;&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 299 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 300 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 301 -            ImageButton deleteButton = (ImageButton) convertView.findViewById(R.id.tag_trash);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 302 -            deleteButton.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 303 -                @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 304 -                public void onClick(View view) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 305 -                    if (tagCount == 0) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 306 -                        deleteTag(tag);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 307 -                    } else if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 308 -                        AlertDialog.Builder alert = new AlertDialog.Builder(TagsListActivity.this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 309 -                        alert.setTitle(R.string.delete_tag);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 310 -                        alert.setMessage(getString(R.string.confirm_delete_tag));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 311 -                        alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 312 -                            public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 313 -                                deleteTag(tag);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 314 -                            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 315 -                        });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 316 -                        alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 317 -                            public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 318 -                                // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 319 -                            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 320 -                        });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 321 -                        alert.show();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 322 -                    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 323 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 324 -            });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 325 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 326 -            return convertView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 327 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 328 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 329 -        private void deleteTag(Tag tag) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 330 -            tag.delete();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 331 -            new removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, tag);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 332 -            mTracker.sendEvent(&quot;tag&quot;, &quot;deleted_tag&quot;, &quot;list_trash_button&quot;, null);</span>







<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 333 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 334 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 335 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 336 -        public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 337 -            return null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 338 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 339 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 340 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 341 -        public void bindView(View view, Context context, Cursor cursor) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 342 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 343 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 344 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 345 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 346 -    private class removeTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 347 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 348 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 349 -        protected Void doInBackground(Tag... removedTags) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 350 -            Tag tag = removedTags[0];</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 351 -            if (tag != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 352 -                ObjectCursor&lt;Note&gt; notesCursor = tag.findNotes(mNotesBucket);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 353 -                while (notesCursor.moveToNext()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 354 -                    Note note = notesCursor.getObject();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 355 -                    List&lt;String&gt; tags = note.getTags();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 356 -                    tags.remove(tag.getName());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 357 -                    note.setTags(tags);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 358 -                    note.save();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 359 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 360 -                notesCursor.close();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 361 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 362 -            return null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 363 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 364 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 365 -}</span></pre></td>
                            <td><pre>   1  package com.automattic.simplenote;
   2  
   3  import android.app.AlertDialog;
   4  import android.app.ListActivity;
   5  import android.content.Context;
   6  import android.content.DialogInterface;
   7  import android.database.Cursor;
   8  import android.os.AsyncTask;
   9  import android.os.Bundle;
  10  import android.text.Html;
  11  import android.text.Spannable;
  12  import android.text.SpannableString;
  13  import android.view.ActionMode;
  14  import android.view.Menu;
  15  import android.view.MenuInflater;
  16  import android.view.MenuItem;
  17  import android.view.View;
  18  import android.view.ViewGroup;
  19  import android.widget.AbsListView;
  20  import android.widget.AdapterView;
  21  import android.widget.CursorAdapter;
  22  import android.widget.EditText;
  23  import android.widget.ImageButton;
  24  import android.widget.LinearLayout;
  25  import android.widget.ListView;
  26  import android.widget.TextView;
  27  
  28  import com.automattic.simplenote.models.Note;
  29  import com.automattic.simplenote.models.Tag;
  30  import com.automattic.simplenote.utils.ThemeUtils;
  31  import com.automattic.simplenote.widgets.TypefaceSpan;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 -import com.google.analytics.tracking.android.EasyTracker;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -import com.google.analytics.tracking.android.Tracker;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  34 +import com.google.android.gms.analytics.HitBuilders;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  35 +import com.google.android.gms.analytics.Tracker;</span>
  36  import com.simperium.client.Bucket;
  37  import com.simperium.client.Bucket.ObjectCursor;
  38  import com.simperium.client.BucketObjectNameInvalid;
  39  import com.simperium.client.Query;
  40  
  41  import java.util.List;
  42  
  43  /**
  44   * Created by Dan Roundhill on 6/26/13. (In Greece!)
  45   */
<abbr title="  46  public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionMode.Callback, AbsListView.MultiChoiceModeListener, AdapterView.OnItemLongClickListener, Bucket.Listener&lt;Tag&gt; {">  46  public class TagsListActivity extends ListActivity implements AdapterView.OnItemClickListener, ActionMode.CallbackðŸ”µ</abbr>
  47  
  48      private ActionMode mActionMode;
  49      private Bucket&lt;Tag&gt; mTagsBucket;
  50      private Bucket&lt;Note&gt; mNotesBucket;
  51      private TagsAdapter mTagsAdapter;
  52  
  53      private Tracker mTracker;
  54  
  55      @Override
  56      public void onCreate(Bundle savedInstanceState) {
  57  
  58          ThemeUtils.setTheme(this);
  59  
  60          super.onCreate(savedInstanceState);
  61  
  62          setContentView(R.layout.activity_tags_list);
  63  
  64          SpannableString s = new SpannableString(getString(R.string.edit_tags));
  65          s.setSpan(new TypefaceSpan(this), 0, s.length(),
  66                  Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
  67          getActionBar().setTitle(s);
  68  
  69          getActionBar().setDisplayHomeAsUpEnabled(true);
  70  
  71          TextView emptyTextView = (TextView)findViewById(android.R.id.empty);
  72          emptyTextView.setText(Html.fromHtml(&quot;&lt;strong&gt;&quot; + getString(R.string.no_tags_found) + &quot;&lt;/strong&gt;&quot;));
  73  
  74          ListView listView = getListView();
  75          listView.setMultiChoiceModeListener(this);
  76          listView.setOnItemClickListener(this);
  77          // Disabling long press CAB action for now since bulk deleting is incomplete
  78          // listView.setOnItemLongClickListener(this);
  79  
  80          Simplenote application = (Simplenote) getApplication();
  81          mTagsBucket = application.getTagsBucket();
  82          mNotesBucket = application.getNotesBucket();
  83  
  84          mTagsAdapter = new TagsAdapter(getBaseContext(), null, 0);
  85          setListAdapter(mTagsAdapter);
  86          refreshTags();
  87  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -        EasyTracker.getInstance().activityStart(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -        mTracker = EasyTracker.getTracker();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +        mTracker = application.getTracker();</span>
  91      }
  92  
  93      @Override
  94      protected void onResume() {
  95          super.onResume();
  96  
  97          mNotesBucket.start();
  98          mTagsBucket.start();
  99  
 100          mTagsBucket.addOnNetworkChangeListener(this);
 101          mTagsBucket.addOnSaveObjectListener(this);
 102          mTagsBucket.addOnDeleteObjectListener(this);
 103      }
 104  
 105      @Override
 106      protected void onPause() {
 107          super.onPause();
 108  
 109          mTagsBucket.removeOnNetworkChangeListener(this);
 110          mTagsBucket.removeOnSaveObjectListener(this);
 111          mTagsBucket.removeOnDeleteObjectListener(this);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 112 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 113 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 114 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 115 -    public void onStop() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -        super.onStop();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -        EasyTracker.getInstance().activityStop(this);</span>
 118      }
 119  
 120      protected void refreshTags() {
 121          Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);
 122          ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();
 123          mTagsAdapter.changeCursor(cursor);
 124      }
 125  
 126      @Override
 127      public void onItemClick(AdapterView&lt;?&gt; adapterView, View view, int row, long l) {
 128  
 129          final AlertDialog.Builder alert = new AlertDialog.Builder(this);
 130          LinearLayout alertView = (LinearLayout) getLayoutInflater().inflate(R.layout.edit_tag, null);
 131  
 132          final Tag tag = mTagsAdapter.getItem(row);
 133  
 134          final EditText tagNameEditText = (EditText) alertView.findViewById(R.id.tag_name_edit);
 135          tagNameEditText.setText(tag.getName());
 136          tagNameEditText.setSelection(tagNameEditText.length());
 137          alert.setView(alertView);
 138          alert.setTitle(R.string.rename_tag);
 139          alert.setPositiveButton(R.string.save, new DialogInterface.OnClickListener() {
 140              public void onClick(DialogInterface dialog, int whichButton) {
 141                  String value = tagNameEditText.getText().toString().trim();
 142                  try {
 143                      tag.renameTo(value, mNotesBucket);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 144 -                    mTracker.sendEvent(&quot;tag&quot;, &quot;edited_tag&quot;, &quot;tag_alert_edit_box&quot;, null);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +                    mTracker.send(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +                            new HitBuilders.EventBuilder()</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +                                    .setCategory(&quot;tag&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +                                    .setAction(&quot;edited_tag&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +                                    .setLabel(&quot;tag_alert_edit_box&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +                                    .build()</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +                    );</span>
 152                  } catch (BucketObjectNameInvalid e) {
 153                      android.util.Log.e(Simplenote.TAG, &quot;Unable to rename tag&quot;, e);
 154                      // TODO: show user a message that new tag name is not ok
 155                  }
 156              }
 157          });
 158          alert.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {
 159              public void onClick(DialogInterface dialog, int whichButton) {
 160                  // Do nothing
 161              }
 162          });
 163          alert.show();
 164  
 165      }
 166  
 167      // TODO: Finish bulk editing
 168      @Override
 169      public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {
 170          MenuInflater inflater = actionMode.getMenuInflater();
 171          inflater.inflate(R.menu.bulk_edit_tags, menu);
 172          mActionMode = actionMode;
 173          return true;
 174      }
 175  
 176      @Override
 177      public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {
 178          return false;
 179      }
 180  
 181      @Override
 182      public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {
 183          switch (menuItem.getItemId()) {
 184              case R.id.menu_delete:
 185                  actionMode.finish(); // Action picked, so close the CAB
 186                  return true;
 187              default:
 188                  return false;
 189          }
 190      }
 191  
 192      @Override
 193      public void onDestroyActionMode(ActionMode actionMode) {
 194          mActionMode = null;
 195      }
 196  
 197      @Override
 198      public void onItemCheckedStateChanged(ActionMode actionMode, int i, long l, boolean b) {
 199          final int checkedCount = getListView().getCheckedItemCount();
 200          switch (checkedCount) {
 201              case 0:
 202                  actionMode.setSubtitle(null);
 203                  break;
 204              case 1:
 205                  actionMode.setSubtitle(&quot;One item selected&quot;);
 206                  break;
 207              default:
 208                  actionMode.setSubtitle(&quot;&quot; + checkedCount + &quot; items selected&quot;);
 209                  break;
 210          }
 211      }
 212  
 213      @Override
 214      public boolean onItemLongClick(AdapterView&lt;?&gt; adapterView, View view, int position, long l) {
 215          getListView().setChoiceMode(ListView.CHOICE_MODE_MULTIPLE_MODAL);
 216          getListView().setItemChecked(position, true);
 217          if (mActionMode == null)
 218              startActionMode(this);
 219          //isCABDestroyed = false;
 220          return false; // so this action does not consume the event!!!
 221      }
 222  
 223      @Override
 224      public boolean onOptionsItemSelected(MenuItem item) {
 225  
 226          if (item.getItemId() == android.R.id.home) {
 227              finish();
 228              return true;
 229          }
 230  
 231          return super.onOptionsItemSelected(item);
 232      }
 233  
 234      // Tag Bucket listeners
 235      @Override
 236      public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 237          runOnUiThread(new Runnable() {
 238              @Override
 239              public void run() {
 240                  refreshTags();
 241              }
 242          });
 243      }
 244  
 245      @Override
 246      public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {
 247          runOnUiThread(new Runnable() {
 248              @Override
 249              public void run() {
 250                  refreshTags();
 251              }
 252          });
 253      }
 254  
 255      @Override
 256      public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 257          runOnUiThread(new Runnable() {
 258              @Override
 259              public void run() {
 260                  refreshTags();
 261              }
 262          });
 263      }
 264  
 265      @Override
 266      public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 267          // noop
 268      }
 269  
 270      private class TagsAdapter extends CursorAdapter {
 271  
 272          private ObjectCursor&lt;Tag&gt; mCursor;
 273  
 274          public TagsAdapter(Context context, ObjectCursor&lt;Tag&gt; c, int flags) {
 275              super(context, c, flags);
 276              mCursor = c;
 277          }
 278  
 279          public void changeCursor(ObjectCursor&lt;Tag&gt; cursor) {
 280              super.changeCursor(cursor);
 281              mCursor = cursor;
 282          }
 283  
 284          @Override
 285          public Tag getItem(int row) {
 286              super.getItem(row);
 287              return mCursor.getObject();
 288          }
 289  
 290          @Override
 291          public View getView(final int position, View convertView, ViewGroup parent) {
 292  
 293              mCursor.moveToPosition(position);
 294  
 295              if (convertView == null) {
 296                  convertView = getLayoutInflater().inflate(R.layout.tags_list_row, null);
 297              }
 298              final Tag tag = mCursor.getObject();
 299              convertView.setTag(tag.getSimperiumKey());
 300  
 301              TextView tagTitle = (TextView) convertView.findViewById(R.id.tag_name);
 302              TextView tagCountTextView = (TextView) convertView.findViewById(R.id.tag_count);
 303              tagTitle.setText(tag.getName());
<abbr title=" 304              final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getSimperiumKey()).count();"> 304              final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getSimperiuðŸ”µ</abbr>
 305              if (tagCount &gt; 0) {
 306                  tagCountTextView.setText(Integer.toString(tagCount));
 307              } else {
 308                  tagCountTextView.setText(&quot;&quot;);
 309              }
 310  
 311              ImageButton deleteButton = (ImageButton) convertView.findViewById(R.id.tag_trash);
 312              deleteButton.setOnClickListener(new View.OnClickListener() {
 313                  @Override
 314                  public void onClick(View view) {
 315                      if (tagCount == 0) {
 316                          deleteTag(tag);
 317                      } else if (tagCount &gt; 0) {
 318                          AlertDialog.Builder alert = new AlertDialog.Builder(TagsListActivity.this);
 319                          alert.setTitle(R.string.delete_tag);
 320                          alert.setMessage(getString(R.string.confirm_delete_tag));
 321                          alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {
 322                              public void onClick(DialogInterface dialog, int whichButton) {
 323                                  deleteTag(tag);
 324                              }
 325                          });
 326                          alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {
 327                              public void onClick(DialogInterface dialog, int whichButton) {
 328                                  // Do nothing, just closing the dialog
 329                              }
 330                          });
 331                          alert.show();
 332                      }
 333                  }
 334              });
 335  
 336              return convertView;
 337          }
 338  
 339          private void deleteTag(Tag tag) {
 340              tag.delete();
 341              new removeTagFromNotesTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, tag);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 342 -            mTracker.sendEvent(&quot;tag&quot;, &quot;deleted_tag&quot;, &quot;list_trash_button&quot;, null);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +            mTracker.send(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 344 +                    new HitBuilders.EventBuilder()</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 345 +                            .setCategory(&quot;tag&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 346 +                            .setAction(&quot;deleted_tag&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 347 +                            .setLabel(&quot;list_trash_button&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 348 +                            .build()</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 349 +            );</span>
 350          }
 351  
 352          @Override
 353          public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {
 354              return null;
 355          }
 356  
 357          @Override
 358          public void bindView(View view, Context context, Cursor cursor) {
 359  
 360          }
 361      }
 362  
 363      private class removeTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {
 364  
 365          @Override
 366          protected Void doInBackground(Tag... removedTags) {
 367              Tag tag = removedTags[0];
 368              if (tag != null) {
 369                  ObjectCursor&lt;Note&gt; notesCursor = tag.findNotes(mNotesBucket);
 370                  while (notesCursor.moveToNext()) {
 371                      Note note = notesCursor.getObject();
 372                      List&lt;String&gt; tags = note.getTags();
 373                      tags.remove(tag.getName());
 374                      note.setTags(tags);
 375                      note.save();
 376                  }
 377                  notesCursor.close();
 378              }
 379              return null;
 380          }
 381      }
 382  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            