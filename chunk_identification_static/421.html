<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>421</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    421
                    <a href="420.html">prev</a>
                    <a href="422.html">next</a>
                    <a href="421_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_5553ee5c6410a412ab4ed61d9499805adee8995a_kudu/kudu-side/kudu-async-side/src/main/java/com/dtstack/flink/sql/side/kudu/KuduAsyncReqRow.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;5553ee5c6410a412ab4ed61d9499805adee8995a:kudu/kudu-side/kudu-async-side/src/main/java/com/dtstack/flink/sql/side/kudu/KuduAsyncReqRow.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;5553ee5c6410a412ab4ed61d9499805adee8995a^1:kudu/kudu-side/kudu-async-side/src/main/java/com/dtstack/flink/sql/side/kudu/KuduAsyncReqRow.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;5553ee5c6410a412ab4ed61d9499805adee8995a^2:kudu/kudu-side/kudu-async-side/src/main/java/com/dtstack/flink/sql/side/kudu/KuduAsyncReqRow.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e0a10435dcb243a911c0405daebc6aa667d5119d:kudu/kudu-side/kudu-async-side/src/main/java/com/dtstack/flink/sql/side/kudu/KuduAsyncReqRow.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [bj]], subset: [[b], [bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-8840953368027741170" onmouseenter="enter('-8840953368027741170');" onmouseout="out('-8840953368027741170');" style="">   1 package com.dtstack.flink.sql.side.kudu;                                                                 </span>
<span  style="">   2                                                                                                          </span>
<span class="3774663631063558777" onmouseenter="enter('3774663631063558777');" onmouseout="out('3774663631063558777');" style="">   3 import com.dtstack.flink.sql.enums.ECacheContentType;                                                    </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">   4 import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                 </span>
<span class="-1010634606182625441" onmouseenter="enter('-1010634606182625441');" onmouseout="out('-1010634606182625441');" style="">   5 import com.dtstack.flink.sql.side.BaseAsyncReqRow;                                                       </span>
<span class="3586780810941248070" onmouseenter="enter('3586780810941248070');" onmouseout="out('3586780810941248070');" style="">   6 import com.dtstack.flink.sql.side.CacheMissVal;                                                          </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">   7 import com.dtstack.flink.sql.side.FieldInfo;                                                             </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">   8 import com.dtstack.flink.sql.side.JoinInfo;                                                              </span>
<span class="1614892075588798997" onmouseenter="enter('1614892075588798997');" onmouseout="out('1614892075588798997');" style="">   9 import com.dtstack.flink.sql.side.PredicateInfo;                                                         </span>
<span class="423094574771867323" onmouseenter="enter('423094574771867323');" onmouseout="out('423094574771867323');" style="">  10 import com.dtstack.flink.sql.side.cache.CacheObj;                                                        </span>
<span class="5710642889135375263" onmouseenter="enter('5710642889135375263');" onmouseout="out('5710642889135375263');" style="">  11 import com.dtstack.flink.sql.side.kudu.table.KuduSideTableInfo;                                          </span>
<span class="1164335795537447661" onmouseenter="enter('1164335795537447661');" onmouseout="out('1164335795537447661');" style="">  12 import com.dtstack.flink.sql.side.kudu.utils.KuduUtil;                                                   </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="">  13 import com.dtstack.flink.sql.util.RowDataComplete;                                                       </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  14 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  15 import com.google.common.collect.Maps;                                                                   </span>
<span class="-5750625329012831967" onmouseenter="enter('-5750625329012831967');" onmouseout="out('-5750625329012831967');" style="">  16 import com.stumbleupon.async.Callback;                                                                   </span>
<span class="-5487067255628915347" onmouseenter="enter('-5487067255628915347');" onmouseout="out('-5487067255628915347');" style="">  17 import com.stumbleupon.async.Deferred;                                                                   </span>
<span class="-8491175051504538735" onmouseenter="enter('-8491175051504538735');" onmouseout="out('-8491175051504538735');" style="">  18 import io.vertx.core.json.JsonArray;                                                                     </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  19 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  20 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  21 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  22 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="-2094289371926699111" onmouseenter="enter('-2094289371926699111');" onmouseout="out('-2094289371926699111');" style="">  23 import org.apache.flink.streaming.api.functions.async.ResultFuture;                                      </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  24 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  25 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  26 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="1631232015531818624" onmouseenter="enter('1631232015531818624');" onmouseout="out('1631232015531818624');" style="">  27 import org.apache.kudu.ColumnSchema;                                                                     </span>
<span class="-1755042893780385624" onmouseenter="enter('-1755042893780385624');" onmouseout="out('-1755042893780385624');" style="">  28 import org.apache.kudu.Schema;                                                                           </span>
<span class="7204708202450962745" onmouseenter="enter('7204708202450962745');" onmouseout="out('7204708202450962745');" style="">  29 import org.apache.kudu.client.AsyncKuduClient;                                                           </span>
<span class="3400841229030892477" onmouseenter="enter('3400841229030892477');" onmouseout="out('3400841229030892477');" style="">  30 import org.apache.kudu.client.AsyncKuduScanner;                                                          </span>
<span class="1860194643195428903" onmouseenter="enter('1860194643195428903');" onmouseout="out('1860194643195428903');" style="">  31 import org.apache.kudu.client.KuduException;                                                             </span>
<span class="128288131530978478" onmouseenter="enter('128288131530978478');" onmouseout="out('128288131530978478');" style="">  32 import org.apache.kudu.client.KuduPredicate;                                                             </span>
<span class="-342692776902705676" onmouseenter="enter('-342692776902705676');" onmouseout="out('-342692776902705676');" style="">  33 import org.apache.kudu.client.KuduTable;                                                                 </span>
<span class="-6157621177665621032" onmouseenter="enter('-6157621177665621032');" onmouseout="out('-6157621177665621032');" style="">  34 import org.apache.kudu.client.RowResult;                                                                 </span>
<span class="-1845673204769190809" onmouseenter="enter('-1845673204769190809');" onmouseout="out('-1845673204769190809');" style="">  35 import org.apache.kudu.client.RowResultIterator;                                                         </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  36 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  37 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  38                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  39 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  40 import java.util.Arrays;                                                                                 </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41 import java.util.Collections;                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  43 import java.util.Map;                                                                                    </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  44 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45 import java.sql.Timestamp;                                                                               </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46 import java.util.Arrays;                                                                                 </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 import java.util.Collections;                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 import java.util.Map;                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  50 =======                                                                                                  </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51 import java.sql.Timestamp;                                                                               </span>
<span class="196713859697444637" onmouseenter="enter('196713859697444637');" onmouseout="out('196713859697444637');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52 import java.util.*;                                                                                      </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  53 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style="">  54                                                                                                          </span>
<span class="3638139650453766874" onmouseenter="enter('3638139650453766874');" onmouseout="out('3638139650453766874');" style="">  55 public class KuduAsyncReqRow extends BaseAsyncReqRow {                                                   </span>
<span  style="">  56                                                                                                          </span>
<span class="-2074213480282018260" onmouseenter="enter('-2074213480282018260');" onmouseout="out('-2074213480282018260');" style="">  57     private static final Logger LOG = LoggerFactory.getLogger(KuduAsyncReqRow.class);                    </span>
<span  style="">  58                                                                                                          </span>
<span class="2989253342565506687" onmouseenter="enter('2989253342565506687');" onmouseout="out('2989253342565506687');" style="">  59     private static final TimeZone LOCAL_TZ = TimeZone.getDefault();                                      </span>
<span  style="">  60                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  61     /**                                                                                                  </span>
<span class="-8285284077529796986" onmouseenter="enter('-8285284077529796986');" onmouseout="out('-8285284077529796986');" style="">  62      * 获取连接的尝试次数                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  63      */                                                                                                  </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  64     private static final int CONN_RETRY_NUM = 3;                                                         </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  65     /**                                                                                                  </span>
<span class="4062789252244833512" onmouseenter="enter('4062789252244833512');" onmouseout="out('4062789252244833512');" style="">  66      * 缓存条数                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  67      */                                                                                                  </span>
<span class="1004470848600586149" onmouseenter="enter('1004470848600586149');" onmouseout="out('1004470848600586149');" style="">  68     private static final Long FETCH_SIZE = 1000L;                                                        </span>
<span  style="">  69                                                                                                          </span>
<span class="5253634271646137455" onmouseenter="enter('5253634271646137455');" onmouseout="out('5253634271646137455');" style="">  70     private static final long serialVersionUID = 5028583854989267753L;                                   </span>
<span  style="">  71                                                                                                          </span>
<span  style="">  72                                                                                                          </span>
<span class="6513367378672126597" onmouseenter="enter('6513367378672126597');" onmouseout="out('6513367378672126597');" style="">  73     private AsyncKuduClient asyncClient;                                                                 </span>
<span  style="">  74                                                                                                          </span>
<span class="1317689277640300307" onmouseenter="enter('1317689277640300307');" onmouseout="out('1317689277640300307');" style="">  75     private KuduTable table;                                                                             </span>
<span  style="">  76                                                                                                          </span>
<span class="4635177141603060317" onmouseenter="enter('4635177141603060317');" onmouseout="out('4635177141603060317');" style="">  77     private KuduSideTableInfo kuduSideTableInfo;                                                         </span>
<span  style="">  78                                                                                                          </span>
<span class="4170992710598328570" onmouseenter="enter('4170992710598328570');" onmouseout="out('4170992710598328570');" style="">  79     private AsyncKuduScanner.AsyncKuduScannerBuilder scannerBuilder;                                     </span>
<span  style="">  80                                                                                                          </span>
<span class="-5994744104468733303" onmouseenter="enter('-5994744104468733303');" onmouseout="out('-5994744104468733303');" style=""><abbr title="  81     public KuduAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  81     public KuduAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, 🔵</abbr></span>
<span class="6563035163892178349" onmouseenter="enter('6563035163892178349');" onmouseout="out('6563035163892178349');" style="">  82         super(new KuduAsyncSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83     }                                                                                                    </span>
<span  style="">  84                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  85     @Override                                                                                            </span>
<span class="-8008343056571207451" onmouseenter="enter('-8008343056571207451');" onmouseout="out('-8008343056571207451');" style="">  86     public void open(Configuration parameters) throws Exception {                                        </span>
<span class="8736254984801772910" onmouseenter="enter('8736254984801772910');" onmouseout="out('8736254984801772910');" style="">  87         super.open(parameters);                                                                          </span>
<span class="-7685679746867905609" onmouseenter="enter('-7685679746867905609');" onmouseout="out('-7685679746867905609');" style="">  88         kuduSideTableInfo = (KuduSideTableInfo) sideInfo.getSideTableInfo();                             </span>
<span class="-4562633082775627441" onmouseenter="enter('-4562633082775627441');" onmouseout="out('-4562633082775627441');" style="">  89         connKuDu();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90     }                                                                                                    </span>
<span  style="">  91                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  92     /**                                                                                                  </span>
<span class="803083353752398343" onmouseenter="enter('803083353752398343');" onmouseout="out('803083353752398343');" style="">  93      * 连接kudu中的表                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  94      *                                                                                                   </span>
<span class="-5432256053392020081" onmouseenter="enter('-5432256053392020081');" onmouseout="out('-5432256053392020081');" style="">  95      * @throws KuduException                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  96      */                                                                                                  </span>
<span class="-5290115760614089350" onmouseenter="enter('-5290115760614089350');" onmouseout="out('-5290115760614089350');" style="">  97     private void connKuDu() throws KuduException {                                                       </span>
<span class="-56179035184578959" onmouseenter="enter('-56179035184578959');" onmouseout="out('-56179035184578959');" style="">  98         if (null == table) {                                                                             </span>
<span class="4308396336047168888" onmouseenter="enter('4308396336047168888');" onmouseout="out('4308396336047168888');" style="">  99             String kuduMasters = kuduSideTableInfo.getKuduMasters();                                     </span>
<span class="-4444229447990232757" onmouseenter="enter('-4444229447990232757');" onmouseout="out('-4444229447990232757');" style=""> 100             String tableName = kuduSideTableInfo.getTableName();                                         </span>
<span class="4427587995392923155" onmouseenter="enter('4427587995392923155');" onmouseout="out('4427587995392923155');" style=""> 101             Integer workerCount = kuduSideTableInfo.getWorkerCount();                                    </span>
<span class="-5299851536099138671" onmouseenter="enter('-5299851536099138671');" onmouseout="out('-5299851536099138671');" style=""> 102             Integer defaultSocketReadTimeoutMs = kuduSideTableInfo.getDefaultSocketReadTimeoutMs();      </span>
<span class="-2694307185983387776" onmouseenter="enter('-2694307185983387776');" onmouseout="out('-2694307185983387776');" style=""> 103             Integer defaultOperationTimeoutMs = kuduSideTableInfo.getDefaultOperationTimeoutMs();        </span>
<span  style=""> 104                                                                                                          </span>
<span class="-6052455991030570635" onmouseenter="enter('-6052455991030570635');" onmouseout="out('-6052455991030570635');" style=""> 105             Preconditions.checkNotNull(kuduMasters, &quot;kuduMasters could not be null&quot;);                    </span>
<span  style=""> 106                                                                                                          </span>
<span class="-6520194397411128459" onmouseenter="enter('-6520194397411128459');" onmouseout="out('-6520194397411128459');" style=""><abbr title=" 107             AsyncKuduClient.AsyncKuduClientBuilder asyncKuduClientBuilder = new AsyncKuduClient.AsyncKuduClientBuilder(kuduMasters);"> 107             AsyncKuduClient.AsyncKuduClientBuilder asyncKuduClientBuilder = new AsyncKuduClient.AsyncKudu🔵</abbr></span>
<span class="-8227759523178082238" onmouseenter="enter('-8227759523178082238');" onmouseout="out('-8227759523178082238');" style=""> 108             if (null != workerCount) {                                                                   </span>
<span class="-5467062577113570128" onmouseenter="enter('-5467062577113570128');" onmouseout="out('-5467062577113570128');" style=""> 109                 asyncKuduClientBuilder.workerCount(workerCount);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110             }                                                                                            </span>
<span  style=""> 111                                                                                                          </span>
<span class="-2397215110746175709" onmouseenter="enter('-2397215110746175709');" onmouseout="out('-2397215110746175709');" style=""> 112             if (null != defaultOperationTimeoutMs) {                                                     </span>
<span class="7366215511831154275" onmouseenter="enter('7366215511831154275');" onmouseout="out('7366215511831154275');" style=""> 113                 asyncKuduClientBuilder.defaultOperationTimeoutMs(defaultOperationTimeoutMs);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114             }                                                                                            </span>
<span class="2560969904046492964" onmouseenter="enter('2560969904046492964');" onmouseout="out('2560969904046492964');" style=""> 115             asyncClient = asyncKuduClientBuilder.build();                                                </span>
<span class="441886789095796306" onmouseenter="enter('441886789095796306');" onmouseout="out('441886789095796306');" style=""> 116             if (!asyncClient.syncClient().tableExists(tableName)) {                                      </span>
<span class="4123299035781055923" onmouseenter="enter('4123299035781055923');" onmouseout="out('4123299035781055923');" style=""> 117                 throw new IllegalArgumentException(&quot;Table Open Failed , please check table exists&quot;);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118             }                                                                                            </span>
<span class="4092827604202793861" onmouseenter="enter('4092827604202793861');" onmouseout="out('4092827604202793861');" style=""> 119             table = asyncClient.syncClient().openTable(tableName);                                       </span>
<span class="4177758485368982030" onmouseenter="enter('4177758485368982030');" onmouseout="out('4177758485368982030');" style=""> 120             LOG.info(&quot;connect kudu is successed!&quot;);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121         }                                                                                                </span>
<span class="2924668647776163983" onmouseenter="enter('2924668647776163983');" onmouseout="out('2924668647776163983');" style=""> 122         scannerBuilder = asyncClient.newScannerBuilder(table);                                           </span>
<span class="-4404448253596110496" onmouseenter="enter('-4404448253596110496');" onmouseout="out('-4404448253596110496');" style=""> 123         Integer batchSizeBytes = kuduSideTableInfo.getBatchSizeBytes();                                  </span>
<span class="-7735055932391271380" onmouseenter="enter('-7735055932391271380');" onmouseout="out('-7735055932391271380');" style=""> 124         Long limitNum = kuduSideTableInfo.getLimitNum();                                                 </span>
<span class="1611473127340759637" onmouseenter="enter('1611473127340759637');" onmouseout="out('1611473127340759637');" style=""> 125         Boolean isFaultTolerant = kuduSideTableInfo.getFaultTolerant();                                  </span>
<span class="-8526639943056837274" onmouseenter="enter('-8526639943056837274');" onmouseout="out('-8526639943056837274');" style=""> 126         //查询需要的字段                                                                                        </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 127         String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                </span>
<span  style=""> 128                                                                                                          </span>
<span class="-8080913465496496419" onmouseenter="enter('-8080913465496496419');" onmouseout="out('-8080913465496496419');" style=""> 129         if (null == limitNum || limitNum &lt;= 0) {                                                         </span>
<span class="7767157001459171317" onmouseenter="enter('7767157001459171317');" onmouseout="out('7767157001459171317');" style=""> 130             scannerBuilder.limit(FETCH_SIZE);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 131         } else {                                                                                         </span>
<span class="6087958399625777057" onmouseenter="enter('6087958399625777057');" onmouseout="out('6087958399625777057');" style=""> 132             scannerBuilder.limit(limitNum);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133         }                                                                                                </span>
<span class="-5740110908714073879" onmouseenter="enter('-5740110908714073879');" onmouseout="out('-5740110908714073879');" style=""> 134         if (null != batchSizeBytes) {                                                                    </span>
<span class="-3929060200025616829" onmouseenter="enter('-3929060200025616829');" onmouseout="out('-3929060200025616829');" style=""> 135             scannerBuilder.batchSizeBytes(batchSizeBytes);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136         }                                                                                                </span>
<span class="-8680730272034558637" onmouseenter="enter('-8680730272034558637');" onmouseout="out('-8680730272034558637');" style=""> 137         if (null != isFaultTolerant) {                                                                   </span>
<span class="-5364988782144201666" onmouseenter="enter('-5364988782144201666');" onmouseout="out('-5364988782144201666');" style=""> 138             scannerBuilder.setFaultTolerant(isFaultTolerant);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139         }                                                                                                </span>
<span  style=""> 140                                                                                                          </span>
<span class="6330664272177173056" onmouseenter="enter('6330664272177173056');" onmouseout="out('6330664272177173056');" style=""> 141         List&lt;String&gt; projectColumns = Arrays.asList(sideFieldNames);                                     </span>
<span class="2684072470806705647" onmouseenter="enter('2684072470806705647');" onmouseout="out('2684072470806705647');" style=""> 142         scannerBuilder.setProjectedColumnNames(projectColumns);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143     }                                                                                                    </span>
<span  style=""> 144                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 145     @Override                                                                                            </span>
<span class="3547897215975148581" onmouseenter="enter('3547897215975148581');" onmouseout="out('3547897215975148581');" style=""><abbr title=" 146     public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resultFuture) throws Exception {"> 146     public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resul🔵</abbr></span>
<span class="-2042762712356066763" onmouseenter="enter('-2042762712356066763');" onmouseout="out('-2042762712356066763');" style=""> 147         Row inputCopy = Row.copy(input);                                                                 </span>
<span class="5065834272723126023" onmouseenter="enter('5065834272723126023');" onmouseout="out('5065834272723126023');" style=""> 148         //scannerBuilder 设置为null重新加载过滤条件,然后connkudu重新赋值                                                  </span>
<span class="2495891823177141345" onmouseenter="enter('2495891823177141345');" onmouseout="out('2495891823177141345');" style=""> 149         //todo:代码需要优化                                                                                    </span>
<span class="3515238287407101771" onmouseenter="enter('3515238287407101771');" onmouseout="out('3515238287407101771');" style=""> 150         scannerBuilder = null;                                                                           </span>
<span class="-4562633082775627441" onmouseenter="enter('-4562633082775627441');" onmouseout="out('-4562633082775627441');" style=""> 151         connKuDu();                                                                                      </span>
<span class="6789989036272871448" onmouseenter="enter('6789989036272871448');" onmouseout="out('6789989036272871448');" style=""> 152         Schema schema = table.getSchema();                                                               </span>
<span class="-6874703698410301106" onmouseenter="enter('-6874703698410301106');" onmouseout="out('-6874703698410301106');" style=""> 153         //  @wenbaoup fix bug                                                                            </span>
<span class="-2762964740504478972" onmouseenter="enter('-2762964740504478972');" onmouseout="out('-2762964740504478972');" style=""> 154         inputParams.entrySet().forEach(e -&gt;{                                                             </span>
<span class="-44569786791220301" onmouseenter="enter('-44569786791220301');" onmouseout="out('-44569786791220301');" style=""><abbr title=" 155             scannerBuilder.addPredicate(KuduPredicate.newInListPredicate(schema.getColumn(e.getKey()), Collections.singletonList(e.getValue())));"> 155             scannerBuilder.addPredicate(KuduPredicate.newInListPredicate(schema.getColumn(e.getKey()), Co🔵</abbr></span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 156         });                                                                                              </span>
<span  style=""> 157                                                                                                          </span>
<span class="-5863912479223093982" onmouseenter="enter('-5863912479223093982');" onmouseout="out('-5863912479223093982');" style=""> 158         //  填充谓词信息                                                                                       </span>
<span class="-8839623202504591157" onmouseenter="enter('-8839623202504591157');" onmouseout="out('-8839623202504591157');" style=""> 159         List&lt;PredicateInfo&gt; predicateInfoes = sideInfo.getSideTableInfo().getPredicateInfoes();          </span>
<span class="1131384255148676390" onmouseenter="enter('1131384255148676390');" onmouseout="out('1131384255148676390');" style=""> 160         if (predicateInfoes.size() &gt; 0) {                                                                </span>
<span class="7087000648291367893" onmouseenter="enter('7087000648291367893');" onmouseout="out('7087000648291367893');" style=""> 161             predicateInfoes.stream().map(info -&gt; {                                                       </span>
<span class="-3754680470381432050" onmouseenter="enter('-3754680470381432050');" onmouseout="out('-3754680470381432050');" style=""> 162                 KuduPredicate kuduPredicate = KuduUtil.buildKuduPredicate(schema, info);                 </span>
<span class="8493928812165156395" onmouseenter="enter('8493928812165156395');" onmouseout="out('8493928812165156395');" style=""> 163                 if (null != kuduPredicate) {                                                             </span>
<span class="-8515842596395934222" onmouseenter="enter('-8515842596395934222');" onmouseout="out('-8515842596395934222');" style=""> 164                     scannerBuilder.addPredicate(kuduPredicate);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165                 }                                                                                        </span>
<span class="-3556780733195614200" onmouseenter="enter('-3556780733195614200');" onmouseout="out('-3556780733195614200');" style=""> 166                 return info;                                                                             </span>
<span class="3075434854107094892" onmouseenter="enter('3075434854107094892');" onmouseout="out('3075434854107094892');" style=""> 167             }).count();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168         }                                                                                                </span>
<span  style=""> 169                                                                                                          </span>
<span class="510800137927766729" onmouseenter="enter('510800137927766729');" onmouseout="out('510800137927766729');" style=""> 170         List&lt;Map&lt;String, Object&gt;&gt; cacheContent = Lists.newArrayList();                                   </span>
<span class="-5519708164731405413" onmouseenter="enter('-5519708164731405413');" onmouseout="out('-5519708164731405413');" style=""> 171         AsyncKuduScanner asyncKuduScanner = scannerBuilder.build();                                      </span>
<span class="212265186367526848" onmouseenter="enter('212265186367526848');" onmouseout="out('212265186367526848');" style=""> 172         List&lt;Row&gt; rowList = Lists.newArrayList();                                                        </span>
<span class="6180779613695836367" onmouseenter="enter('6180779613695836367');" onmouseout="out('6180779613695836367');" style=""> 173         Deferred&lt;RowResultIterator&gt; data = asyncKuduScanner.nextRows();                                  </span>
<span class="-7087386879750881573" onmouseenter="enter('-7087386879750881573');" onmouseout="out('-7087386879750881573');" style=""> 174         //从之前的同步修改为调用异步的Callback                                                                         </span>
<span class="278649099550089909" onmouseenter="enter('278649099550089909');" onmouseout="out('278649099550089909');" style=""><abbr title=" 175         data.addCallbackDeferring(new GetListRowCB(inputCopy, cacheContent, rowList, asyncKuduScanner, resultFuture, buildCacheKey(inputParams)));"> 175         data.addCallbackDeferring(new GetListRowCB(inputCopy, cacheContent, rowList, asyncKuduScanner, re🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176     }                                                                                                    </span>
<span  style=""> 177                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 178     @Override                                                                                            </span>
<span class="6374398777166986707" onmouseenter="enter('6374398777166986707');" onmouseout="out('6374398777166986707');" style=""> 179     public String buildCacheKey(Map&lt;String, Object&gt; inputParams) {                                       </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 180         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="-3940662932484837264" onmouseenter="enter('-3940662932484837264');" onmouseout="out('-3940662932484837264');" style=""> 181         for (Object ele : inputParams.values()) {                                                        </span>
<span class="-9219177986461641503" onmouseenter="enter('-9219177986461641503');" onmouseout="out('-9219177986461641503');" style=""> 182             sb.append(ele.toString())                                                                    </span>
<span class="-7037257933228320495" onmouseenter="enter('-7037257933228320495');" onmouseout="out('-7037257933228320495');" style=""> 183                     .append(&quot;_&quot;);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184         }                                                                                                </span>
<span  style=""> 185                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 186         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187     }                                                                                                    </span>
<span  style=""> 188                                                                                                          </span>
<span  style=""> 189                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 190     @Override                                                                                            </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style=""> 191     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style=""> 192         Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                 </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style=""> 193         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style=""> 194         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style=""> 195             Object obj = input.getField(entry.getValue());                                               </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 196 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 197             obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                    </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 198 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 199             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 199             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 201             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 201             //Type information for indicating event or processing time. However, it behaves like a regula🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203                 obj = ((Timestamp) obj).getTime();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204             }                                                                                            </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206         }                                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 207 =======                                                                                                  </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 208             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 208             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 210             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 210             //Type information for indicating event or processing time. However, it behaves like a regula🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212                 obj = ((Timestamp) obj).getTime();                                                       </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213                 //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                            </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 214                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());"> 214                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime())🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215             }                                                                                            </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 216 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style=""> 217             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218         }                                                                                                </span>
<span  style=""> 219                                                                                                          </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style=""> 220         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style=""> 221             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 222                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 223             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style=""> 224                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226         }                                                                                                </span>
<span  style=""> 227                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 228         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229     }                                                                                                    </span>
<span  style=""> 230                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 231     @Override                                                                                            </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 232     public void close() throws Exception {                                                               </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 233         super.close();                                                                                   </span>
<span class="-466861721853404898" onmouseenter="enter('-466861721853404898');" onmouseout="out('-466861721853404898');" style=""> 234         if (null != asyncClient) {                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 235             try {                                                                                        </span>
<span class="-2833913701521345427" onmouseenter="enter('-2833913701521345427');" onmouseout="out('-2833913701521345427');" style=""> 236                 asyncClient.close();                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 237             } catch (Exception e) {                                                                      </span>
<span class="7169708839653618971" onmouseenter="enter('7169708839653618971');" onmouseout="out('7169708839653618971');" style=""> 238                 LOG.error(&quot;Error while closing client.&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241     }                                                                                                    </span>
<span  style=""> 242                                                                                                          </span>
<span class="3638800353225348075" onmouseenter="enter('3638800353225348075');" onmouseout="out('3638800353225348075');" style=""> 243     class GetListRowCB implements Callback&lt;Deferred&lt;List&lt;Row&gt;&gt;, RowResultIterator&gt; {                     </span>
<span class="7503629168352274570" onmouseenter="enter('7503629168352274570');" onmouseout="out('7503629168352274570');" style=""> 244         private Row input;                                                                               </span>
<span class="-3461178940071231317" onmouseenter="enter('-3461178940071231317');" onmouseout="out('-3461178940071231317');" style=""> 245         private List&lt;Map&lt;String, Object&gt;&gt; cacheContent;                                                  </span>
<span class="8807764549675743801" onmouseenter="enter('8807764549675743801');" onmouseout="out('8807764549675743801');" style=""> 246         private List&lt;Row&gt; rowList;                                                                       </span>
<span class="5723031173307092846" onmouseenter="enter('5723031173307092846');" onmouseout="out('5723031173307092846');" style=""> 247         private AsyncKuduScanner asyncKuduScanner;                                                       </span>
<span class="-2087617261824804701" onmouseenter="enter('-2087617261824804701');" onmouseout="out('-2087617261824804701');" style=""> 248         private ResultFuture&lt;BaseRow&gt; resultFuture;                                                      </span>
<span class="-1449703644783381384" onmouseenter="enter('-1449703644783381384');" onmouseout="out('-1449703644783381384');" style=""> 249         private String key;                                                                              </span>
<span  style=""> 250                                                                                                          </span>
<span  style=""> 251                                                                                                          </span>
<span class="1613753735602313740" onmouseenter="enter('1613753735602313740');" onmouseout="out('1613753735602313740');" style=""> 252         public GetListRowCB() {                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253         }                                                                                                </span>
<span  style=""> 254                                                                                                          </span>
<span class="-3702604554334756935" onmouseenter="enter('-3702604554334756935');" onmouseout="out('-3702604554334756935');" style=""> 255         GetListRowCB(Row input, List&lt;Map&lt;String, Object&gt;&gt; cacheContent, List&lt;Row&gt; rowList,               </span>
<span class="2572339002080827901" onmouseenter="enter('2572339002080827901');" onmouseout="out('2572339002080827901');" style=""> 256                      AsyncKuduScanner asyncKuduScanner, ResultFuture&lt;BaseRow&gt; resultFuture, String key) {</span>
<span class="8214429602983504200" onmouseenter="enter('8214429602983504200');" onmouseout="out('8214429602983504200');" style=""> 257             this.input = input;                                                                          </span>
<span class="-7432664925500830597" onmouseenter="enter('-7432664925500830597');" onmouseout="out('-7432664925500830597');" style=""> 258             this.cacheContent = cacheContent;                                                            </span>
<span class="5762471889889938429" onmouseenter="enter('5762471889889938429');" onmouseout="out('5762471889889938429');" style=""> 259             this.rowList = rowList;                                                                      </span>
<span class="4954020228022176436" onmouseenter="enter('4954020228022176436');" onmouseout="out('4954020228022176436');" style=""> 260             this.asyncKuduScanner = asyncKuduScanner;                                                    </span>
<span class="592225705701792215" onmouseenter="enter('592225705701792215');" onmouseout="out('592225705701792215');" style=""> 261             this.resultFuture = resultFuture;                                                            </span>
<span class="5062295098979135982" onmouseenter="enter('5062295098979135982');" onmouseout="out('5062295098979135982');" style=""> 262             this.key = key;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263         }                                                                                                </span>
<span  style=""> 264                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 265         @Override                                                                                        </span>
<span class="8767874272678853351" onmouseenter="enter('8767874272678853351');" onmouseout="out('8767874272678853351');" style=""> 266         public Deferred&lt;List&lt;Row&gt;&gt; call(RowResultIterator results) throws Exception {                    </span>
<span class="-8941030450012249491" onmouseenter="enter('-8941030450012249491');" onmouseout="out('-8941030450012249491');" style=""> 267             for (RowResult result : results) {                                                           </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 268                 Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                          </span>
<span class="4786776012437782338" onmouseenter="enter('4786776012437782338');" onmouseout="out('4786776012437782338');" style=""> 269                 for (String sideFieldName1 : StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;)) {   </span>
<span class="5422300911827801712" onmouseenter="enter('5422300911827801712');" onmouseout="out('5422300911827801712');" style=""> 270                     String sideFieldName = sideFieldName1.trim();                                        </span>
<span class="-7396994512053753949" onmouseenter="enter('-7396994512053753949');" onmouseout="out('-7396994512053753949');" style=""> 271                     ColumnSchema columnSchema = table.getSchema().getColumn(sideFieldName);              </span>
<span class="-1551001954350423389" onmouseenter="enter('-1551001954350423389');" onmouseout="out('-1551001954350423389');" style=""> 272                     if (null != columnSchema) {                                                          </span>
<span class="-9080618923968214410" onmouseenter="enter('-9080618923968214410');" onmouseout="out('-9080618923968214410');" style=""> 273                         KuduUtil.setMapValue(columnSchema.getType(), oneRow, sideFieldName, result);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275                 }                                                                                        </span>
<span class="-7708136132104498122" onmouseenter="enter('-7708136132104498122');" onmouseout="out('-7708136132104498122');" style=""> 276                 Row row = fillData(input, oneRow);                                                       </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 277                 if (openCache()) {                                                                       </span>
<span class="1888587301705190474" onmouseenter="enter('1888587301705190474');" onmouseout="out('1888587301705190474');" style=""> 278                     cacheContent.add(oneRow);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279                 }                                                                                        </span>
<span class="8104339441102894963" onmouseenter="enter('8104339441102894963');" onmouseout="out('8104339441102894963');" style=""> 280                 rowList.add(row);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281             }                                                                                            </span>
<span class="-5880917173204222408" onmouseenter="enter('-5880917173204222408');" onmouseout="out('-5880917173204222408');" style=""> 282             if (asyncKuduScanner.hasMoreRows()) {                                                        </span>
<span class="411290205859931493" onmouseenter="enter('411290205859931493');" onmouseout="out('411290205859931493');" style=""> 283                 return asyncKuduScanner.nextRows().addCallbackDeferring(this);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284             }                                                                                            </span>
<span  style=""> 285                                                                                                          </span>
<span class="-5182000486454444757" onmouseenter="enter('-5182000486454444757');" onmouseout="out('-5182000486454444757');" style=""> 286             if (rowList.size() &gt; 0) {                                                                    </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 287                 if (openCache()) {                                                                       </span>
<span class="-1330765095474862231" onmouseenter="enter('-1330765095474862231');" onmouseout="out('-1330765095474862231');" style=""> 288                     putCache(key, CacheObj.buildCacheObj(ECacheContentType.MultiLine, cacheContent));    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289                 }                                                                                        </span>
<span class="-3708188502172280479" onmouseenter="enter('-3708188502172280479');" onmouseout="out('-3708188502172280479');" style=""> 290                 RowDataComplete.completeRow(resultFuture, rowList);                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 291             } else {                                                                                     </span>
<span class="-5083140435457393877" onmouseenter="enter('-5083140435457393877');" onmouseout="out('-5083140435457393877');" style=""> 292                 dealMissKey(input, resultFuture);                                                        </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 293                 if (openCache()) {                                                                       </span>
<span class="-7075096462798044408" onmouseenter="enter('-7075096462798044408');" onmouseout="out('-7075096462798044408');" style=""> 294                     //放置在putCache的Miss中 一段时间内同一个key都会直接返回                                                </span>
<span class="-5736723344410400278" onmouseenter="enter('-5736723344410400278');" onmouseout="out('-5736723344410400278');" style=""> 295                     putCache(key, CacheMissVal.getMissKeyObj());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297             }                                                                                            </span>
<span  style=""> 298                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 299             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301     }                                                                                                    </span>
<span  style=""> 302                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303 }                                                                                                        </span></pre></td>
                            <td><pre><span class="-8840953368027741170" onmouseenter="enter('-8840953368027741170');" onmouseout="out('-8840953368027741170');" style="">   1 package com.dtstack.flink.sql.side.kudu;                                                                 </span>
<span  style="">   2                                                                                                          </span>
<span class="3774663631063558777" onmouseenter="enter('3774663631063558777');" onmouseout="out('3774663631063558777');" style="">   3 import com.dtstack.flink.sql.enums.ECacheContentType;                                                    </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">   4 import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                 </span>
<span class="-1010634606182625441" onmouseenter="enter('-1010634606182625441');" onmouseout="out('-1010634606182625441');" style="">   5 import com.dtstack.flink.sql.side.BaseAsyncReqRow;                                                       </span>
<span class="3586780810941248070" onmouseenter="enter('3586780810941248070');" onmouseout="out('3586780810941248070');" style="">   6 import com.dtstack.flink.sql.side.CacheMissVal;                                                          </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">   7 import com.dtstack.flink.sql.side.FieldInfo;                                                             </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">   8 import com.dtstack.flink.sql.side.JoinInfo;                                                              </span>
<span class="1614892075588798997" onmouseenter="enter('1614892075588798997');" onmouseout="out('1614892075588798997');" style="">   9 import com.dtstack.flink.sql.side.PredicateInfo;                                                         </span>
<span class="423094574771867323" onmouseenter="enter('423094574771867323');" onmouseout="out('423094574771867323');" style="">  10 import com.dtstack.flink.sql.side.cache.CacheObj;                                                        </span>
<span class="5710642889135375263" onmouseenter="enter('5710642889135375263');" onmouseout="out('5710642889135375263');" style="">  11 import com.dtstack.flink.sql.side.kudu.table.KuduSideTableInfo;                                          </span>
<span class="1164335795537447661" onmouseenter="enter('1164335795537447661');" onmouseout="out('1164335795537447661');" style="">  12 import com.dtstack.flink.sql.side.kudu.utils.KuduUtil;                                                   </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="">  13 import com.dtstack.flink.sql.util.RowDataComplete;                                                       </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  14 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  15 import com.google.common.collect.Maps;                                                                   </span>
<span class="-5750625329012831967" onmouseenter="enter('-5750625329012831967');" onmouseout="out('-5750625329012831967');" style="">  16 import com.stumbleupon.async.Callback;                                                                   </span>
<span class="-5487067255628915347" onmouseenter="enter('-5487067255628915347');" onmouseout="out('-5487067255628915347');" style="">  17 import com.stumbleupon.async.Deferred;                                                                   </span>
<span class="-8491175051504538735" onmouseenter="enter('-8491175051504538735');" onmouseout="out('-8491175051504538735');" style="">  18 import io.vertx.core.json.JsonArray;                                                                     </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  19 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  20 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  21 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  22 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="-2094289371926699111" onmouseenter="enter('-2094289371926699111');" onmouseout="out('-2094289371926699111');" style="">  23 import org.apache.flink.streaming.api.functions.async.ResultFuture;                                      </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  24 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  25 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  26 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="1631232015531818624" onmouseenter="enter('1631232015531818624');" onmouseout="out('1631232015531818624');" style="">  27 import org.apache.kudu.ColumnSchema;                                                                     </span>
<span class="-1755042893780385624" onmouseenter="enter('-1755042893780385624');" onmouseout="out('-1755042893780385624');" style="">  28 import org.apache.kudu.Schema;                                                                           </span>
<span class="7204708202450962745" onmouseenter="enter('7204708202450962745');" onmouseout="out('7204708202450962745');" style="">  29 import org.apache.kudu.client.AsyncKuduClient;                                                           </span>
<span class="3400841229030892477" onmouseenter="enter('3400841229030892477');" onmouseout="out('3400841229030892477');" style="">  30 import org.apache.kudu.client.AsyncKuduScanner;                                                          </span>
<span class="1860194643195428903" onmouseenter="enter('1860194643195428903');" onmouseout="out('1860194643195428903');" style="">  31 import org.apache.kudu.client.KuduException;                                                             </span>
<span class="128288131530978478" onmouseenter="enter('128288131530978478');" onmouseout="out('128288131530978478');" style="">  32 import org.apache.kudu.client.KuduPredicate;                                                             </span>
<span class="-342692776902705676" onmouseenter="enter('-342692776902705676');" onmouseout="out('-342692776902705676');" style="">  33 import org.apache.kudu.client.KuduTable;                                                                 </span>
<span class="-6157621177665621032" onmouseenter="enter('-6157621177665621032');" onmouseout="out('-6157621177665621032');" style="">  34 import org.apache.kudu.client.RowResult;                                                                 </span>
<span class="-1845673204769190809" onmouseenter="enter('-1845673204769190809');" onmouseout="out('-1845673204769190809');" style="">  35 import org.apache.kudu.client.RowResultIterator;                                                         </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  36 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  37 import org.slf4j.LoggerFactory;                                                                          </span>
<span class="196713859697444637" onmouseenter="enter('196713859697444637');" onmouseout="out('196713859697444637');" style="">  38 import java.util.*;                                                                                      </span>
<span  style="">  39                                                                                                          </span>
<span class="3638139650453766874" onmouseenter="enter('3638139650453766874');" onmouseout="out('3638139650453766874');" style="">  40 public class KuduAsyncReqRow extends BaseAsyncReqRow {                                                   </span>
<span  style="">  41                                                                                                          </span>
<span class="-2074213480282018260" onmouseenter="enter('-2074213480282018260');" onmouseout="out('-2074213480282018260');" style="">  42     private static final Logger LOG = LoggerFactory.getLogger(KuduAsyncReqRow.class);                    </span>
<span  style="">  43                                                                                                          </span>
<span class="2989253342565506687" onmouseenter="enter('2989253342565506687');" onmouseout="out('2989253342565506687');" style="">  44     private static final TimeZone LOCAL_TZ = TimeZone.getDefault();                                      </span>
<span  style="">  45                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  46     /**                                                                                                  </span>
<span class="-8285284077529796986" onmouseenter="enter('-8285284077529796986');" onmouseout="out('-8285284077529796986');" style="">  47      * 获取连接的尝试次数                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  48      */                                                                                                  </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  49     private static final int CONN_RETRY_NUM = 3;                                                         </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50     /**                                                                                                  </span>
<span class="4062789252244833512" onmouseenter="enter('4062789252244833512');" onmouseout="out('4062789252244833512');" style="">  51      * 缓存条数                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52      */                                                                                                  </span>
<span class="1004470848600586149" onmouseenter="enter('1004470848600586149');" onmouseout="out('1004470848600586149');" style="">  53     private static final Long FETCH_SIZE = 1000L;                                                        </span>
<span  style="">  54                                                                                                          </span>
<span class="5253634271646137455" onmouseenter="enter('5253634271646137455');" onmouseout="out('5253634271646137455');" style="">  55     private static final long serialVersionUID = 5028583854989267753L;                                   </span>
<span  style="">  56                                                                                                          </span>
<span  style="">  57                                                                                                          </span>
<span class="6513367378672126597" onmouseenter="enter('6513367378672126597');" onmouseout="out('6513367378672126597');" style="">  58     private AsyncKuduClient asyncClient;                                                                 </span>
<span  style="">  59                                                                                                          </span>
<span class="1317689277640300307" onmouseenter="enter('1317689277640300307');" onmouseout="out('1317689277640300307');" style="">  60     private KuduTable table;                                                                             </span>
<span  style="">  61                                                                                                          </span>
<span class="4635177141603060317" onmouseenter="enter('4635177141603060317');" onmouseout="out('4635177141603060317');" style="">  62     private KuduSideTableInfo kuduSideTableInfo;                                                         </span>
<span  style="">  63                                                                                                          </span>
<span class="4170992710598328570" onmouseenter="enter('4170992710598328570');" onmouseout="out('4170992710598328570');" style="">  64     private AsyncKuduScanner.AsyncKuduScannerBuilder scannerBuilder;                                     </span>
<span  style="">  65                                                                                                          </span>
<span class="-5994744104468733303" onmouseenter="enter('-5994744104468733303');" onmouseout="out('-5994744104468733303');" style=""><abbr title="  66     public KuduAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  66     public KuduAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, 🔵</abbr></span>
<span class="6563035163892178349" onmouseenter="enter('6563035163892178349');" onmouseout="out('6563035163892178349');" style="">  67         super(new KuduAsyncSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  68     }                                                                                                    </span>
<span  style="">  69                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  70     @Override                                                                                            </span>
<span class="-8008343056571207451" onmouseenter="enter('-8008343056571207451');" onmouseout="out('-8008343056571207451');" style="">  71     public void open(Configuration parameters) throws Exception {                                        </span>
<span class="8736254984801772910" onmouseenter="enter('8736254984801772910');" onmouseout="out('8736254984801772910');" style="">  72         super.open(parameters);                                                                          </span>
<span class="-7685679746867905609" onmouseenter="enter('-7685679746867905609');" onmouseout="out('-7685679746867905609');" style="">  73         kuduSideTableInfo = (KuduSideTableInfo) sideInfo.getSideTableInfo();                             </span>
<span class="-4562633082775627441" onmouseenter="enter('-4562633082775627441');" onmouseout="out('-4562633082775627441');" style="">  74         connKuDu();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75     }                                                                                                    </span>
<span  style="">  76                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  77     /**                                                                                                  </span>
<span class="803083353752398343" onmouseenter="enter('803083353752398343');" onmouseout="out('803083353752398343');" style="">  78      * 连接kudu中的表                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  79      *                                                                                                   </span>
<span class="-5432256053392020081" onmouseenter="enter('-5432256053392020081');" onmouseout="out('-5432256053392020081');" style="">  80      * @throws KuduException                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  81      */                                                                                                  </span>
<span class="-5290115760614089350" onmouseenter="enter('-5290115760614089350');" onmouseout="out('-5290115760614089350');" style="">  82     private void connKuDu() throws KuduException {                                                       </span>
<span class="-56179035184578959" onmouseenter="enter('-56179035184578959');" onmouseout="out('-56179035184578959');" style="">  83         if (null == table) {                                                                             </span>
<span class="4308396336047168888" onmouseenter="enter('4308396336047168888');" onmouseout="out('4308396336047168888');" style="">  84             String kuduMasters = kuduSideTableInfo.getKuduMasters();                                     </span>
<span class="-4444229447990232757" onmouseenter="enter('-4444229447990232757');" onmouseout="out('-4444229447990232757');" style="">  85             String tableName = kuduSideTableInfo.getTableName();                                         </span>
<span class="4427587995392923155" onmouseenter="enter('4427587995392923155');" onmouseout="out('4427587995392923155');" style="">  86             Integer workerCount = kuduSideTableInfo.getWorkerCount();                                    </span>
<span class="-5299851536099138671" onmouseenter="enter('-5299851536099138671');" onmouseout="out('-5299851536099138671');" style="">  87             Integer defaultSocketReadTimeoutMs = kuduSideTableInfo.getDefaultSocketReadTimeoutMs();      </span>
<span class="-2694307185983387776" onmouseenter="enter('-2694307185983387776');" onmouseout="out('-2694307185983387776');" style="">  88             Integer defaultOperationTimeoutMs = kuduSideTableInfo.getDefaultOperationTimeoutMs();        </span>
<span  style="">  89                                                                                                          </span>
<span class="-6052455991030570635" onmouseenter="enter('-6052455991030570635');" onmouseout="out('-6052455991030570635');" style="">  90             Preconditions.checkNotNull(kuduMasters, &quot;kuduMasters could not be null&quot;);                    </span>
<span  style="">  91                                                                                                          </span>
<span class="-6520194397411128459" onmouseenter="enter('-6520194397411128459');" onmouseout="out('-6520194397411128459');" style=""><abbr title="  92             AsyncKuduClient.AsyncKuduClientBuilder asyncKuduClientBuilder = new AsyncKuduClient.AsyncKuduClientBuilder(kuduMasters);">  92             AsyncKuduClient.AsyncKuduClientBuilder asyncKuduClientBuilder = new AsyncKuduClient.AsyncKudu🔵</abbr></span>
<span class="-8227759523178082238" onmouseenter="enter('-8227759523178082238');" onmouseout="out('-8227759523178082238');" style="">  93             if (null != workerCount) {                                                                   </span>
<span class="-5467062577113570128" onmouseenter="enter('-5467062577113570128');" onmouseout="out('-5467062577113570128');" style="">  94                 asyncKuduClientBuilder.workerCount(workerCount);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  95             }                                                                                            </span>
<span  style="">  96                                                                                                          </span>
<span class="-2397215110746175709" onmouseenter="enter('-2397215110746175709');" onmouseout="out('-2397215110746175709');" style="">  97             if (null != defaultOperationTimeoutMs) {                                                     </span>
<span class="7366215511831154275" onmouseenter="enter('7366215511831154275');" onmouseout="out('7366215511831154275');" style="">  98                 asyncKuduClientBuilder.defaultOperationTimeoutMs(defaultOperationTimeoutMs);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99             }                                                                                            </span>
<span class="2560969904046492964" onmouseenter="enter('2560969904046492964');" onmouseout="out('2560969904046492964');" style=""> 100             asyncClient = asyncKuduClientBuilder.build();                                                </span>
<span class="441886789095796306" onmouseenter="enter('441886789095796306');" onmouseout="out('441886789095796306');" style=""> 101             if (!asyncClient.syncClient().tableExists(tableName)) {                                      </span>
<span class="4123299035781055923" onmouseenter="enter('4123299035781055923');" onmouseout="out('4123299035781055923');" style=""> 102                 throw new IllegalArgumentException(&quot;Table Open Failed , please check table exists&quot;);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103             }                                                                                            </span>
<span class="4092827604202793861" onmouseenter="enter('4092827604202793861');" onmouseout="out('4092827604202793861');" style=""> 104             table = asyncClient.syncClient().openTable(tableName);                                       </span>
<span class="4177758485368982030" onmouseenter="enter('4177758485368982030');" onmouseout="out('4177758485368982030');" style=""> 105             LOG.info(&quot;connect kudu is successed!&quot;);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106         }                                                                                                </span>
<span class="2924668647776163983" onmouseenter="enter('2924668647776163983');" onmouseout="out('2924668647776163983');" style=""> 107         scannerBuilder = asyncClient.newScannerBuilder(table);                                           </span>
<span class="-4404448253596110496" onmouseenter="enter('-4404448253596110496');" onmouseout="out('-4404448253596110496');" style=""> 108         Integer batchSizeBytes = kuduSideTableInfo.getBatchSizeBytes();                                  </span>
<span class="-7735055932391271380" onmouseenter="enter('-7735055932391271380');" onmouseout="out('-7735055932391271380');" style=""> 109         Long limitNum = kuduSideTableInfo.getLimitNum();                                                 </span>
<span class="1611473127340759637" onmouseenter="enter('1611473127340759637');" onmouseout="out('1611473127340759637');" style=""> 110         Boolean isFaultTolerant = kuduSideTableInfo.getFaultTolerant();                                  </span>
<span class="-8526639943056837274" onmouseenter="enter('-8526639943056837274');" onmouseout="out('-8526639943056837274');" style=""> 111         //查询需要的字段                                                                                        </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 112         String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                </span>
<span  style=""> 113                                                                                                          </span>
<span class="-8080913465496496419" onmouseenter="enter('-8080913465496496419');" onmouseout="out('-8080913465496496419');" style=""> 114         if (null == limitNum || limitNum &lt;= 0) {                                                         </span>
<span class="7767157001459171317" onmouseenter="enter('7767157001459171317');" onmouseout="out('7767157001459171317');" style=""> 115             scannerBuilder.limit(FETCH_SIZE);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 116         } else {                                                                                         </span>
<span class="6087958399625777057" onmouseenter="enter('6087958399625777057');" onmouseout="out('6087958399625777057');" style=""> 117             scannerBuilder.limit(limitNum);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118         }                                                                                                </span>
<span class="-5740110908714073879" onmouseenter="enter('-5740110908714073879');" onmouseout="out('-5740110908714073879');" style=""> 119         if (null != batchSizeBytes) {                                                                    </span>
<span class="-3929060200025616829" onmouseenter="enter('-3929060200025616829');" onmouseout="out('-3929060200025616829');" style=""> 120             scannerBuilder.batchSizeBytes(batchSizeBytes);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121         }                                                                                                </span>
<span class="-8680730272034558637" onmouseenter="enter('-8680730272034558637');" onmouseout="out('-8680730272034558637');" style=""> 122         if (null != isFaultTolerant) {                                                                   </span>
<span class="-5364988782144201666" onmouseenter="enter('-5364988782144201666');" onmouseout="out('-5364988782144201666');" style=""> 123             scannerBuilder.setFaultTolerant(isFaultTolerant);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124         }                                                                                                </span>
<span  style=""> 125                                                                                                          </span>
<span class="6330664272177173056" onmouseenter="enter('6330664272177173056');" onmouseout="out('6330664272177173056');" style=""> 126         List&lt;String&gt; projectColumns = Arrays.asList(sideFieldNames);                                     </span>
<span class="2684072470806705647" onmouseenter="enter('2684072470806705647');" onmouseout="out('2684072470806705647');" style=""> 127         scannerBuilder.setProjectedColumnNames(projectColumns);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128     }                                                                                                    </span>
<span  style=""> 129                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 130     @Override                                                                                            </span>
<span class="3547897215975148581" onmouseenter="enter('3547897215975148581');" onmouseout="out('3547897215975148581');" style=""><abbr title=" 131     public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resultFuture) throws Exception {"> 131     public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resul🔵</abbr></span>
<span class="-2042762712356066763" onmouseenter="enter('-2042762712356066763');" onmouseout="out('-2042762712356066763');" style=""> 132         Row inputCopy = Row.copy(input);                                                                 </span>
<span class="5065834272723126023" onmouseenter="enter('5065834272723126023');" onmouseout="out('5065834272723126023');" style=""> 133         //scannerBuilder 设置为null重新加载过滤条件,然后connkudu重新赋值                                                  </span>
<span class="2495891823177141345" onmouseenter="enter('2495891823177141345');" onmouseout="out('2495891823177141345');" style=""> 134         //todo:代码需要优化                                                                                    </span>
<span class="3515238287407101771" onmouseenter="enter('3515238287407101771');" onmouseout="out('3515238287407101771');" style=""> 135         scannerBuilder = null;                                                                           </span>
<span class="-4562633082775627441" onmouseenter="enter('-4562633082775627441');" onmouseout="out('-4562633082775627441');" style=""> 136         connKuDu();                                                                                      </span>
<span class="6789989036272871448" onmouseenter="enter('6789989036272871448');" onmouseout="out('6789989036272871448');" style=""> 137         Schema schema = table.getSchema();                                                               </span>
<span class="-6874703698410301106" onmouseenter="enter('-6874703698410301106');" onmouseout="out('-6874703698410301106');" style=""> 138         //  @wenbaoup fix bug                                                                            </span>
<span class="-2762964740504478972" onmouseenter="enter('-2762964740504478972');" onmouseout="out('-2762964740504478972');" style=""> 139         inputParams.entrySet().forEach(e -&gt;{                                                             </span>
<span class="-44569786791220301" onmouseenter="enter('-44569786791220301');" onmouseout="out('-44569786791220301');" style=""><abbr title=" 140             scannerBuilder.addPredicate(KuduPredicate.newInListPredicate(schema.getColumn(e.getKey()), Collections.singletonList(e.getValue())));"> 140             scannerBuilder.addPredicate(KuduPredicate.newInListPredicate(schema.getColumn(e.getKey()), Co🔵</abbr></span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 141         });                                                                                              </span>
<span  style=""> 142                                                                                                          </span>
<span class="-5863912479223093982" onmouseenter="enter('-5863912479223093982');" onmouseout="out('-5863912479223093982');" style=""> 143         //  填充谓词信息                                                                                       </span>
<span class="-8839623202504591157" onmouseenter="enter('-8839623202504591157');" onmouseout="out('-8839623202504591157');" style=""> 144         List&lt;PredicateInfo&gt; predicateInfoes = sideInfo.getSideTableInfo().getPredicateInfoes();          </span>
<span class="1131384255148676390" onmouseenter="enter('1131384255148676390');" onmouseout="out('1131384255148676390');" style=""> 145         if (predicateInfoes.size() &gt; 0) {                                                                </span>
<span class="7087000648291367893" onmouseenter="enter('7087000648291367893');" onmouseout="out('7087000648291367893');" style=""> 146             predicateInfoes.stream().map(info -&gt; {                                                       </span>
<span class="-3754680470381432050" onmouseenter="enter('-3754680470381432050');" onmouseout="out('-3754680470381432050');" style=""> 147                 KuduPredicate kuduPredicate = KuduUtil.buildKuduPredicate(schema, info);                 </span>
<span class="8493928812165156395" onmouseenter="enter('8493928812165156395');" onmouseout="out('8493928812165156395');" style=""> 148                 if (null != kuduPredicate) {                                                             </span>
<span class="-8515842596395934222" onmouseenter="enter('-8515842596395934222');" onmouseout="out('-8515842596395934222');" style=""> 149                     scannerBuilder.addPredicate(kuduPredicate);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150                 }                                                                                        </span>
<span class="-3556780733195614200" onmouseenter="enter('-3556780733195614200');" onmouseout="out('-3556780733195614200');" style=""> 151                 return info;                                                                             </span>
<span class="3075434854107094892" onmouseenter="enter('3075434854107094892');" onmouseout="out('3075434854107094892');" style=""> 152             }).count();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153         }                                                                                                </span>
<span  style=""> 154                                                                                                          </span>
<span class="510800137927766729" onmouseenter="enter('510800137927766729');" onmouseout="out('510800137927766729');" style=""> 155         List&lt;Map&lt;String, Object&gt;&gt; cacheContent = Lists.newArrayList();                                   </span>
<span class="-5519708164731405413" onmouseenter="enter('-5519708164731405413');" onmouseout="out('-5519708164731405413');" style=""> 156         AsyncKuduScanner asyncKuduScanner = scannerBuilder.build();                                      </span>
<span class="212265186367526848" onmouseenter="enter('212265186367526848');" onmouseout="out('212265186367526848');" style=""> 157         List&lt;Row&gt; rowList = Lists.newArrayList();                                                        </span>
<span class="6180779613695836367" onmouseenter="enter('6180779613695836367');" onmouseout="out('6180779613695836367');" style=""> 158         Deferred&lt;RowResultIterator&gt; data = asyncKuduScanner.nextRows();                                  </span>
<span class="-7087386879750881573" onmouseenter="enter('-7087386879750881573');" onmouseout="out('-7087386879750881573');" style=""> 159         //从之前的同步修改为调用异步的Callback                                                                         </span>
<span class="278649099550089909" onmouseenter="enter('278649099550089909');" onmouseout="out('278649099550089909');" style=""><abbr title=" 160         data.addCallbackDeferring(new GetListRowCB(inputCopy, cacheContent, rowList, asyncKuduScanner, resultFuture, buildCacheKey(inputParams)));"> 160         data.addCallbackDeferring(new GetListRowCB(inputCopy, cacheContent, rowList, asyncKuduScanner, re🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161     }                                                                                                    </span>
<span  style=""> 162                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 163     @Override                                                                                            </span>
<span class="6374398777166986707" onmouseenter="enter('6374398777166986707');" onmouseout="out('6374398777166986707');" style=""> 164     public String buildCacheKey(Map&lt;String, Object&gt; inputParams) {                                       </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 165         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="-3940662932484837264" onmouseenter="enter('-3940662932484837264');" onmouseout="out('-3940662932484837264');" style=""> 166         for (Object ele : inputParams.values()) {                                                        </span>
<span class="-9219177986461641503" onmouseenter="enter('-9219177986461641503');" onmouseout="out('-9219177986461641503');" style=""> 167             sb.append(ele.toString())                                                                    </span>
<span class="-7037257933228320495" onmouseenter="enter('-7037257933228320495');" onmouseout="out('-7037257933228320495');" style=""> 168                     .append(&quot;_&quot;);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169         }                                                                                                </span>
<span  style=""> 170                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 171         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172     }                                                                                                    </span>
<span  style=""> 173                                                                                                          </span>
<span  style=""> 174                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 175     @Override                                                                                            </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style=""> 176     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style=""> 177         Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                 </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style=""> 178         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style=""> 179         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style=""> 180             Object obj = input.getField(entry.getValue());                                               </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 181 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182             obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                    </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 183 ||||||| BASE                                                                                             </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 184             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 184             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 186             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 186             //Type information for indicating event or processing time. However, it behaves like a regula🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188                 obj = ((Timestamp) obj).getTime();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189             }                                                                                            </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191         }                                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 192 =======                                                                                                  </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 193             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 193             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 195             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 195             //Type information for indicating event or processing time. However, it behaves like a regula🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197                 obj = ((Timestamp) obj).getTime();                                                       </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198                 //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                            </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 199                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());"> 199                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime())🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200             }                                                                                            </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 201 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style=""> 202             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203         }                                                                                                </span>
<span  style=""> 204                                                                                                          </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style=""> 205         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style=""> 206             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 207                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 208             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style=""> 209                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211         }                                                                                                </span>
<span  style=""> 212                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 213         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214     }                                                                                                    </span>
<span  style=""> 215                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 216     @Override                                                                                            </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 217     public void close() throws Exception {                                                               </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 218         super.close();                                                                                   </span>
<span class="-466861721853404898" onmouseenter="enter('-466861721853404898');" onmouseout="out('-466861721853404898');" style=""> 219         if (null != asyncClient) {                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 220             try {                                                                                        </span>
<span class="-2833913701521345427" onmouseenter="enter('-2833913701521345427');" onmouseout="out('-2833913701521345427');" style=""> 221                 asyncClient.close();                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 222             } catch (Exception e) {                                                                      </span>
<span class="7169708839653618971" onmouseenter="enter('7169708839653618971');" onmouseout="out('7169708839653618971');" style=""> 223                 LOG.error(&quot;Error while closing client.&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226     }                                                                                                    </span>
<span  style=""> 227                                                                                                          </span>
<span class="3638800353225348075" onmouseenter="enter('3638800353225348075');" onmouseout="out('3638800353225348075');" style=""> 228     class GetListRowCB implements Callback&lt;Deferred&lt;List&lt;Row&gt;&gt;, RowResultIterator&gt; {                     </span>
<span class="7503629168352274570" onmouseenter="enter('7503629168352274570');" onmouseout="out('7503629168352274570');" style=""> 229         private Row input;                                                                               </span>
<span class="-3461178940071231317" onmouseenter="enter('-3461178940071231317');" onmouseout="out('-3461178940071231317');" style=""> 230         private List&lt;Map&lt;String, Object&gt;&gt; cacheContent;                                                  </span>
<span class="8807764549675743801" onmouseenter="enter('8807764549675743801');" onmouseout="out('8807764549675743801');" style=""> 231         private List&lt;Row&gt; rowList;                                                                       </span>
<span class="5723031173307092846" onmouseenter="enter('5723031173307092846');" onmouseout="out('5723031173307092846');" style=""> 232         private AsyncKuduScanner asyncKuduScanner;                                                       </span>
<span class="-2087617261824804701" onmouseenter="enter('-2087617261824804701');" onmouseout="out('-2087617261824804701');" style=""> 233         private ResultFuture&lt;BaseRow&gt; resultFuture;                                                      </span>
<span class="-1449703644783381384" onmouseenter="enter('-1449703644783381384');" onmouseout="out('-1449703644783381384');" style=""> 234         private String key;                                                                              </span>
<span  style=""> 235                                                                                                          </span>
<span  style=""> 236                                                                                                          </span>
<span class="1613753735602313740" onmouseenter="enter('1613753735602313740');" onmouseout="out('1613753735602313740');" style=""> 237         public GetListRowCB() {                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238         }                                                                                                </span>
<span  style=""> 239                                                                                                          </span>
<span class="-3702604554334756935" onmouseenter="enter('-3702604554334756935');" onmouseout="out('-3702604554334756935');" style=""> 240         GetListRowCB(Row input, List&lt;Map&lt;String, Object&gt;&gt; cacheContent, List&lt;Row&gt; rowList,               </span>
<span class="2572339002080827901" onmouseenter="enter('2572339002080827901');" onmouseout="out('2572339002080827901');" style=""> 241                      AsyncKuduScanner asyncKuduScanner, ResultFuture&lt;BaseRow&gt; resultFuture, String key) {</span>
<span class="8214429602983504200" onmouseenter="enter('8214429602983504200');" onmouseout="out('8214429602983504200');" style=""> 242             this.input = input;                                                                          </span>
<span class="-7432664925500830597" onmouseenter="enter('-7432664925500830597');" onmouseout="out('-7432664925500830597');" style=""> 243             this.cacheContent = cacheContent;                                                            </span>
<span class="5762471889889938429" onmouseenter="enter('5762471889889938429');" onmouseout="out('5762471889889938429');" style=""> 244             this.rowList = rowList;                                                                      </span>
<span class="4954020228022176436" onmouseenter="enter('4954020228022176436');" onmouseout="out('4954020228022176436');" style=""> 245             this.asyncKuduScanner = asyncKuduScanner;                                                    </span>
<span class="592225705701792215" onmouseenter="enter('592225705701792215');" onmouseout="out('592225705701792215');" style=""> 246             this.resultFuture = resultFuture;                                                            </span>
<span class="5062295098979135982" onmouseenter="enter('5062295098979135982');" onmouseout="out('5062295098979135982');" style=""> 247             this.key = key;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248         }                                                                                                </span>
<span  style=""> 249                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 250         @Override                                                                                        </span>
<span class="8767874272678853351" onmouseenter="enter('8767874272678853351');" onmouseout="out('8767874272678853351');" style=""> 251         public Deferred&lt;List&lt;Row&gt;&gt; call(RowResultIterator results) throws Exception {                    </span>
<span class="-8941030450012249491" onmouseenter="enter('-8941030450012249491');" onmouseout="out('-8941030450012249491');" style=""> 252             for (RowResult result : results) {                                                           </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 253                 Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                          </span>
<span class="4786776012437782338" onmouseenter="enter('4786776012437782338');" onmouseout="out('4786776012437782338');" style=""> 254                 for (String sideFieldName1 : StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;)) {   </span>
<span class="5422300911827801712" onmouseenter="enter('5422300911827801712');" onmouseout="out('5422300911827801712');" style=""> 255                     String sideFieldName = sideFieldName1.trim();                                        </span>
<span class="-7396994512053753949" onmouseenter="enter('-7396994512053753949');" onmouseout="out('-7396994512053753949');" style=""> 256                     ColumnSchema columnSchema = table.getSchema().getColumn(sideFieldName);              </span>
<span class="-1551001954350423389" onmouseenter="enter('-1551001954350423389');" onmouseout="out('-1551001954350423389');" style=""> 257                     if (null != columnSchema) {                                                          </span>
<span class="-9080618923968214410" onmouseenter="enter('-9080618923968214410');" onmouseout="out('-9080618923968214410');" style=""> 258                         KuduUtil.setMapValue(columnSchema.getType(), oneRow, sideFieldName, result);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260                 }                                                                                        </span>
<span class="-7708136132104498122" onmouseenter="enter('-7708136132104498122');" onmouseout="out('-7708136132104498122');" style=""> 261                 Row row = fillData(input, oneRow);                                                       </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 262                 if (openCache()) {                                                                       </span>
<span class="1888587301705190474" onmouseenter="enter('1888587301705190474');" onmouseout="out('1888587301705190474');" style=""> 263                     cacheContent.add(oneRow);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264                 }                                                                                        </span>
<span class="8104339441102894963" onmouseenter="enter('8104339441102894963');" onmouseout="out('8104339441102894963');" style=""> 265                 rowList.add(row);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266             }                                                                                            </span>
<span class="-5880917173204222408" onmouseenter="enter('-5880917173204222408');" onmouseout="out('-5880917173204222408');" style=""> 267             if (asyncKuduScanner.hasMoreRows()) {                                                        </span>
<span class="411290205859931493" onmouseenter="enter('411290205859931493');" onmouseout="out('411290205859931493');" style=""> 268                 return asyncKuduScanner.nextRows().addCallbackDeferring(this);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269             }                                                                                            </span>
<span  style=""> 270                                                                                                          </span>
<span class="-5182000486454444757" onmouseenter="enter('-5182000486454444757');" onmouseout="out('-5182000486454444757');" style=""> 271             if (rowList.size() &gt; 0) {                                                                    </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 272                 if (openCache()) {                                                                       </span>
<span class="-1330765095474862231" onmouseenter="enter('-1330765095474862231');" onmouseout="out('-1330765095474862231');" style=""> 273                     putCache(key, CacheObj.buildCacheObj(ECacheContentType.MultiLine, cacheContent));    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274                 }                                                                                        </span>
<span class="-3708188502172280479" onmouseenter="enter('-3708188502172280479');" onmouseout="out('-3708188502172280479');" style=""> 275                 RowDataComplete.completeRow(resultFuture, rowList);                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 276             } else {                                                                                     </span>
<span class="-5083140435457393877" onmouseenter="enter('-5083140435457393877');" onmouseout="out('-5083140435457393877');" style=""> 277                 dealMissKey(input, resultFuture);                                                        </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 278                 if (openCache()) {                                                                       </span>
<span class="-7075096462798044408" onmouseenter="enter('-7075096462798044408');" onmouseout="out('-7075096462798044408');" style=""> 279                     //放置在putCache的Miss中 一段时间内同一个key都会直接返回                                                </span>
<span class="-5736723344410400278" onmouseenter="enter('-5736723344410400278');" onmouseout="out('-5736723344410400278');" style=""> 280                     putCache(key, CacheMissVal.getMissKeyObj());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282             }                                                                                            </span>
<span  style=""> 283                                                                                                          </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 284             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286     }                                                                                                    </span>
<span  style=""> 287                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288 }                                                                                                        </span>













</pre></td>
                            <td><pre><span class="-8840953368027741170" onmouseenter="enter('-8840953368027741170');" onmouseout="out('-8840953368027741170');" style="">   1 package com.dtstack.flink.sql.side.kudu;                                                                 </span>
<span  style="">   2                                                                                                          </span>
<span class="3774663631063558777" onmouseenter="enter('3774663631063558777');" onmouseout="out('3774663631063558777');" style="">   3 import com.dtstack.flink.sql.enums.ECacheContentType;                                                    </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">   4 import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                 </span>
<span class="-1010634606182625441" onmouseenter="enter('-1010634606182625441');" onmouseout="out('-1010634606182625441');" style="">   5 import com.dtstack.flink.sql.side.BaseAsyncReqRow;                                                       </span>
<span class="3586780810941248070" onmouseenter="enter('3586780810941248070');" onmouseout="out('3586780810941248070');" style="">   6 import com.dtstack.flink.sql.side.CacheMissVal;                                                          </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">   7 import com.dtstack.flink.sql.side.FieldInfo;                                                             </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">   8 import com.dtstack.flink.sql.side.JoinInfo;                                                              </span>
<span class="1614892075588798997" onmouseenter="enter('1614892075588798997');" onmouseout="out('1614892075588798997');" style="">   9 import com.dtstack.flink.sql.side.PredicateInfo;                                                         </span>
<span class="423094574771867323" onmouseenter="enter('423094574771867323');" onmouseout="out('423094574771867323');" style="">  10 import com.dtstack.flink.sql.side.cache.CacheObj;                                                        </span>
<span class="5710642889135375263" onmouseenter="enter('5710642889135375263');" onmouseout="out('5710642889135375263');" style="">  11 import com.dtstack.flink.sql.side.kudu.table.KuduSideTableInfo;                                          </span>
<span class="1164335795537447661" onmouseenter="enter('1164335795537447661');" onmouseout="out('1164335795537447661');" style="">  12 import com.dtstack.flink.sql.side.kudu.utils.KuduUtil;                                                   </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="">  13 import com.dtstack.flink.sql.util.RowDataComplete;                                                       </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  14 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  15 import com.google.common.collect.Maps;                                                                   </span>
<span class="-5750625329012831967" onmouseenter="enter('-5750625329012831967');" onmouseout="out('-5750625329012831967');" style="">  16 import com.stumbleupon.async.Callback;                                                                   </span>
<span class="-5487067255628915347" onmouseenter="enter('-5487067255628915347');" onmouseout="out('-5487067255628915347');" style="">  17 import com.stumbleupon.async.Deferred;                                                                   </span>
<span class="-8491175051504538735" onmouseenter="enter('-8491175051504538735');" onmouseout="out('-8491175051504538735');" style="">  18 import io.vertx.core.json.JsonArray;                                                                     </span>
<span class="196713859697444637" onmouseenter="enter('196713859697444637');" onmouseout="out('196713859697444637');" style="">  19 import java.util.*;                                                                                      </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  20 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  21 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  22 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  23 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="-2094289371926699111" onmouseenter="enter('-2094289371926699111');" onmouseout="out('-2094289371926699111');" style="">  24 import org.apache.flink.streaming.api.functions.async.ResultFuture;                                      </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  25 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  26 import org.apache.flink.types.Row;                                                                       </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  27 import org.apache.flink.util.Preconditions;                                                              </span>
<span class="1631232015531818624" onmouseenter="enter('1631232015531818624');" onmouseout="out('1631232015531818624');" style="">  28 import org.apache.kudu.ColumnSchema;                                                                     </span>
<span class="-1755042893780385624" onmouseenter="enter('-1755042893780385624');" onmouseout="out('-1755042893780385624');" style="">  29 import org.apache.kudu.Schema;                                                                           </span>
<span class="7204708202450962745" onmouseenter="enter('7204708202450962745');" onmouseout="out('7204708202450962745');" style="">  30 import org.apache.kudu.client.AsyncKuduClient;                                                           </span>
<span class="3400841229030892477" onmouseenter="enter('3400841229030892477');" onmouseout="out('3400841229030892477');" style="">  31 import org.apache.kudu.client.AsyncKuduScanner;                                                          </span>
<span class="1860194643195428903" onmouseenter="enter('1860194643195428903');" onmouseout="out('1860194643195428903');" style="">  32 import org.apache.kudu.client.KuduException;                                                             </span>
<span class="128288131530978478" onmouseenter="enter('128288131530978478');" onmouseout="out('128288131530978478');" style="">  33 import org.apache.kudu.client.KuduPredicate;                                                             </span>
<span class="-342692776902705676" onmouseenter="enter('-342692776902705676');" onmouseout="out('-342692776902705676');" style="">  34 import org.apache.kudu.client.KuduTable;                                                                 </span>
<span class="-6157621177665621032" onmouseenter="enter('-6157621177665621032');" onmouseout="out('-6157621177665621032');" style="">  35 import org.apache.kudu.client.RowResult;                                                                 </span>
<span class="-1845673204769190809" onmouseenter="enter('-1845673204769190809');" onmouseout="out('-1845673204769190809');" style="">  36 import org.apache.kudu.client.RowResultIterator;                                                         </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  37 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  38 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  39                                                                                                          </span>
<span  style="">  40                                                                                                          </span>
<span class="3638139650453766874" onmouseenter="enter('3638139650453766874');" onmouseout="out('3638139650453766874');" style="">  41 public class KuduAsyncReqRow extends BaseAsyncReqRow {                                                   </span>
<span class="-2074213480282018260" onmouseenter="enter('-2074213480282018260');" onmouseout="out('-2074213480282018260');" style="">  42     private static final Logger LOG = LoggerFactory.getLogger(KuduAsyncReqRow.class);                    </span>
<span  style="">  43                                                                                                          </span>
<span class="2989253342565506687" onmouseenter="enter('2989253342565506687');" onmouseout="out('2989253342565506687');" style="">  44     private static final TimeZone LOCAL_TZ = TimeZone.getDefault();                                      </span>
<span  style="">  45                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  46     /**                                                                                                  </span>
<span class="-8285284077529796986" onmouseenter="enter('-8285284077529796986');" onmouseout="out('-8285284077529796986');" style="">  47      * 获取连接的尝试次数                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  48      */                                                                                                  </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  49     private static final int CONN_RETRY_NUM = 3;                                                         </span>
<span  style="">  50                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  51     /**                                                                                                  </span>
<span class="4062789252244833512" onmouseenter="enter('4062789252244833512');" onmouseout="out('4062789252244833512');" style="">  52      * 缓存条数                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  53      */                                                                                                  </span>
<span class="1004470848600586149" onmouseenter="enter('1004470848600586149');" onmouseout="out('1004470848600586149');" style="">  54     private static final Long FETCH_SIZE = 1000L;                                                        </span>
<span  style="">  55                                                                                                          </span>
<span class="5253634271646137455" onmouseenter="enter('5253634271646137455');" onmouseout="out('5253634271646137455');" style="">  56     private static final long serialVersionUID = 5028583854989267753L;                                   </span>
<span  style="">  57                                                                                                          </span>
<span class="6513367378672126597" onmouseenter="enter('6513367378672126597');" onmouseout="out('6513367378672126597');" style="">  58     private AsyncKuduClient asyncClient;                                                                 </span>
<span  style="">  59                                                                                                          </span>
<span class="1317689277640300307" onmouseenter="enter('1317689277640300307');" onmouseout="out('1317689277640300307');" style="">  60     private KuduTable table;                                                                             </span>
<span  style="">  61                                                                                                          </span>
<span class="4635177141603060317" onmouseenter="enter('4635177141603060317');" onmouseout="out('4635177141603060317');" style="">  62     private KuduSideTableInfo kuduSideTableInfo;                                                         </span>
<span  style="">  63                                                                                                          </span>
<span class="4170992710598328570" onmouseenter="enter('4170992710598328570');" onmouseout="out('4170992710598328570');" style="">  64     private AsyncKuduScanner.AsyncKuduScannerBuilder scannerBuilder;                                     </span>
<span  style="">  65                                                                                                          </span>
<span class="-5994744104468733303" onmouseenter="enter('-5994744104468733303');" onmouseout="out('-5994744104468733303');" style=""><abbr title="  66     public KuduAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  66     public KuduAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, 🔵</abbr></span>
<span class="6563035163892178349" onmouseenter="enter('6563035163892178349');" onmouseout="out('6563035163892178349');" style="">  67         super(new KuduAsyncSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  68     }                                                                                                    </span>
<span  style="">  69                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  70     @Override                                                                                            </span>
<span class="-8008343056571207451" onmouseenter="enter('-8008343056571207451');" onmouseout="out('-8008343056571207451');" style="">  71     public void open(Configuration parameters) throws Exception {                                        </span>
<span class="8736254984801772910" onmouseenter="enter('8736254984801772910');" onmouseout="out('8736254984801772910');" style="">  72         super.open(parameters);                                                                          </span>
<span class="-1939401601132925138" onmouseenter="enter('-1939401601132925138');" onmouseout="out('-1939401601132925138');" style="">  73         kuduSideTableInfo = ((KuduSideTableInfo) (sideInfo.getSideTableInfo()));                         </span>
<span class="-4562633082775627441" onmouseenter="enter('-4562633082775627441');" onmouseout="out('-4562633082775627441');" style="">  74         connKuDu();                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75     }                                                                                                    </span>
<span  style="">  76                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  77     /**                                                                                                  </span>
<span class="803083353752398343" onmouseenter="enter('803083353752398343');" onmouseout="out('803083353752398343');" style="">  78      * 连接kudu中的表                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  79      *                                                                                                   </span>
<span class="-5432256053392020081" onmouseenter="enter('-5432256053392020081');" onmouseout="out('-5432256053392020081');" style="">  80      * @throws KuduException                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  81      */                                                                                                  </span>
<span class="-5290115760614089350" onmouseenter="enter('-5290115760614089350');" onmouseout="out('-5290115760614089350');" style="">  82     private void connKuDu() throws KuduException {                                                       </span>
<span class="-56179035184578959" onmouseenter="enter('-56179035184578959');" onmouseout="out('-56179035184578959');" style="">  83         if (null == table) {                                                                             </span>
<span class="4308396336047168888" onmouseenter="enter('4308396336047168888');" onmouseout="out('4308396336047168888');" style="">  84             String kuduMasters = kuduSideTableInfo.getKuduMasters();                                     </span>
<span class="-4444229447990232757" onmouseenter="enter('-4444229447990232757');" onmouseout="out('-4444229447990232757');" style="">  85             String tableName = kuduSideTableInfo.getTableName();                                         </span>
<span class="4427587995392923155" onmouseenter="enter('4427587995392923155');" onmouseout="out('4427587995392923155');" style="">  86             Integer workerCount = kuduSideTableInfo.getWorkerCount();                                    </span>
<span class="-5299851536099138671" onmouseenter="enter('-5299851536099138671');" onmouseout="out('-5299851536099138671');" style="">  87             Integer defaultSocketReadTimeoutMs = kuduSideTableInfo.getDefaultSocketReadTimeoutMs();      </span>
<span class="-2694307185983387776" onmouseenter="enter('-2694307185983387776');" onmouseout="out('-2694307185983387776');" style="">  88             Integer defaultOperationTimeoutMs = kuduSideTableInfo.getDefaultOperationTimeoutMs();        </span>
<span class="-6052455991030570635" onmouseenter="enter('-6052455991030570635');" onmouseout="out('-6052455991030570635');" style="">  89             Preconditions.checkNotNull(kuduMasters, &quot;kuduMasters could not be null&quot;);                    </span>
<span class="-6520194397411128459" onmouseenter="enter('-6520194397411128459');" onmouseout="out('-6520194397411128459');" style=""><abbr title="  90             AsyncKuduClient.AsyncKuduClientBuilder asyncKuduClientBuilder = new AsyncKuduClient.AsyncKuduClientBuilder(kuduMasters);">  90             AsyncKuduClient.AsyncKuduClientBuilder asyncKuduClientBuilder = new AsyncKuduClient.AsyncKudu🔵</abbr></span>
<span class="-8227759523178082238" onmouseenter="enter('-8227759523178082238');" onmouseout="out('-8227759523178082238');" style="">  91             if (null != workerCount) {                                                                   </span>
<span class="-5467062577113570128" onmouseenter="enter('-5467062577113570128');" onmouseout="out('-5467062577113570128');" style="">  92                 asyncKuduClientBuilder.workerCount(workerCount);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93             }                                                                                            </span>
<span class="-2397215110746175709" onmouseenter="enter('-2397215110746175709');" onmouseout="out('-2397215110746175709');" style="">  94             if (null != defaultOperationTimeoutMs) {                                                     </span>
<span class="7366215511831154275" onmouseenter="enter('7366215511831154275');" onmouseout="out('7366215511831154275');" style="">  95                 asyncKuduClientBuilder.defaultOperationTimeoutMs(defaultOperationTimeoutMs);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96             }                                                                                            </span>
<span class="2560969904046492964" onmouseenter="enter('2560969904046492964');" onmouseout="out('2560969904046492964');" style="">  97             asyncClient = asyncKuduClientBuilder.build();                                                </span>
<span class="441886789095796306" onmouseenter="enter('441886789095796306');" onmouseout="out('441886789095796306');" style="">  98             if (!asyncClient.syncClient().tableExists(tableName)) {                                      </span>
<span class="4123299035781055923" onmouseenter="enter('4123299035781055923');" onmouseout="out('4123299035781055923');" style="">  99                 throw new IllegalArgumentException(&quot;Table Open Failed , please check table exists&quot;);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100             }                                                                                            </span>
<span class="4092827604202793861" onmouseenter="enter('4092827604202793861');" onmouseout="out('4092827604202793861');" style=""> 101             table = asyncClient.syncClient().openTable(tableName);                                       </span>
<span class="4177758485368982030" onmouseenter="enter('4177758485368982030');" onmouseout="out('4177758485368982030');" style=""> 102             LOG.info(&quot;connect kudu is successed!&quot;);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103         }                                                                                                </span>
<span class="2924668647776163983" onmouseenter="enter('2924668647776163983');" onmouseout="out('2924668647776163983');" style=""> 104         scannerBuilder = asyncClient.newScannerBuilder(table);                                           </span>
<span class="-4404448253596110496" onmouseenter="enter('-4404448253596110496');" onmouseout="out('-4404448253596110496');" style=""> 105         Integer batchSizeBytes = kuduSideTableInfo.getBatchSizeBytes();                                  </span>
<span class="-7735055932391271380" onmouseenter="enter('-7735055932391271380');" onmouseout="out('-7735055932391271380');" style=""> 106         Long limitNum = kuduSideTableInfo.getLimitNum();                                                 </span>
<span class="1611473127340759637" onmouseenter="enter('1611473127340759637');" onmouseout="out('1611473127340759637');" style=""> 107         Boolean isFaultTolerant = kuduSideTableInfo.getFaultTolerant();                                  </span>
<span class="-8526639943056837274" onmouseenter="enter('-8526639943056837274');" onmouseout="out('-8526639943056837274');" style=""> 108         //查询需要的字段                                                                                        </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 109         String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                </span>
<span class="662560916977494904" onmouseenter="enter('662560916977494904');" onmouseout="out('662560916977494904');" style=""> 110         if ((null == limitNum) || (limitNum &lt;= 0)) {                                                     </span>
<span class="7767157001459171317" onmouseenter="enter('7767157001459171317');" onmouseout="out('7767157001459171317');" style=""> 111             scannerBuilder.limit(FETCH_SIZE);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 112         } else {                                                                                         </span>
<span class="6087958399625777057" onmouseenter="enter('6087958399625777057');" onmouseout="out('6087958399625777057');" style=""> 113             scannerBuilder.limit(limitNum);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114         }                                                                                                </span>
<span class="-5740110908714073879" onmouseenter="enter('-5740110908714073879');" onmouseout="out('-5740110908714073879');" style=""> 115         if (null != batchSizeBytes) {                                                                    </span>
<span class="-3929060200025616829" onmouseenter="enter('-3929060200025616829');" onmouseout="out('-3929060200025616829');" style=""> 116             scannerBuilder.batchSizeBytes(batchSizeBytes);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117         }                                                                                                </span>
<span class="-8680730272034558637" onmouseenter="enter('-8680730272034558637');" onmouseout="out('-8680730272034558637');" style=""> 118         if (null != isFaultTolerant) {                                                                   </span>
<span class="-5364988782144201666" onmouseenter="enter('-5364988782144201666');" onmouseout="out('-5364988782144201666');" style=""> 119             scannerBuilder.setFaultTolerant(isFaultTolerant);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120         }                                                                                                </span>
<span class="6330664272177173056" onmouseenter="enter('6330664272177173056');" onmouseout="out('6330664272177173056');" style=""> 121         List&lt;String&gt; projectColumns = Arrays.asList(sideFieldNames);                                     </span>
<span class="2684072470806705647" onmouseenter="enter('2684072470806705647');" onmouseout="out('2684072470806705647');" style=""> 122         scannerBuilder.setProjectedColumnNames(projectColumns);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123     }                                                                                                    </span>
<span  style=""> 124                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 125     @Override                                                                                            </span>
<span class="3547897215975148581" onmouseenter="enter('3547897215975148581');" onmouseout="out('3547897215975148581');" style=""><abbr title=" 126     public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resultFuture) throws Exception {"> 126     public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resul🔵</abbr></span>
<span class="-2042762712356066763" onmouseenter="enter('-2042762712356066763');" onmouseout="out('-2042762712356066763');" style=""> 127         Row inputCopy = Row.copy(input);                                                                 </span>
<span class="8095734502037569780" onmouseenter="enter('8095734502037569780');" onmouseout="out('8095734502037569780');" style=""> 128         // scannerBuilder 设置为null重新加载过滤条件,然后connkudu重新赋值                                                 </span>
<span class="-5341927942690581165" onmouseenter="enter('-5341927942690581165');" onmouseout="out('-5341927942690581165');" style=""> 129         // todo:代码需要优化                                                                                   </span>
<span class="3515238287407101771" onmouseenter="enter('3515238287407101771');" onmouseout="out('3515238287407101771');" style=""> 130         scannerBuilder = null;                                                                           </span>
<span class="-4562633082775627441" onmouseenter="enter('-4562633082775627441');" onmouseout="out('-4562633082775627441');" style=""> 131         connKuDu();                                                                                      </span>
<span class="6789989036272871448" onmouseenter="enter('6789989036272871448');" onmouseout="out('6789989036272871448');" style=""> 132         Schema schema = table.getSchema();                                                               </span>
<span class="8122921302633965382" onmouseenter="enter('8122921302633965382');" onmouseout="out('8122921302633965382');" style=""> 133         // @wenbaoup fix bug                                                                             </span>
<span class="-359741823083691063" onmouseenter="enter('-359741823083691063');" onmouseout="out('-359741823083691063');" style=""> 134         inputParams.entrySet().forEach(( e) -&gt; {                                                         </span>
<span class="-44569786791220301" onmouseenter="enter('-44569786791220301');" onmouseout="out('-44569786791220301');" style=""><abbr title=" 135             scannerBuilder.addPredicate(KuduPredicate.newInListPredicate(schema.getColumn(e.getKey()), Collections.singletonList(e.getValue())));"> 135             scannerBuilder.addPredicate(KuduPredicate.newInListPredicate(schema.getColumn(e.getKey()), Co🔵</abbr></span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 136         });                                                                                              </span>
<span class="-5863912479223093982" onmouseenter="enter('-5863912479223093982');" onmouseout="out('-5863912479223093982');" style=""> 137         //  填充谓词信息                                                                                       </span>
<span class="-8839623202504591157" onmouseenter="enter('-8839623202504591157');" onmouseout="out('-8839623202504591157');" style=""> 138         List&lt;PredicateInfo&gt; predicateInfoes = sideInfo.getSideTableInfo().getPredicateInfoes();          </span>
<span class="1131384255148676390" onmouseenter="enter('1131384255148676390');" onmouseout="out('1131384255148676390');" style=""> 139         if (predicateInfoes.size() &gt; 0) {                                                                </span>
<span class="3439458092021767207" onmouseenter="enter('3439458092021767207');" onmouseout="out('3439458092021767207');" style=""> 140             predicateInfoes.stream().map(( info) -&gt; {                                                    </span>
<span class="-3754680470381432050" onmouseenter="enter('-3754680470381432050');" onmouseout="out('-3754680470381432050');" style=""> 141                 KuduPredicate kuduPredicate = KuduUtil.buildKuduPredicate(schema, info);                 </span>
<span class="8493928812165156395" onmouseenter="enter('8493928812165156395');" onmouseout="out('8493928812165156395');" style=""> 142                 if (null != kuduPredicate) {                                                             </span>
<span class="-8515842596395934222" onmouseenter="enter('-8515842596395934222');" onmouseout="out('-8515842596395934222');" style=""> 143                     scannerBuilder.addPredicate(kuduPredicate);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144                 }                                                                                        </span>
<span class="-3556780733195614200" onmouseenter="enter('-3556780733195614200');" onmouseout="out('-3556780733195614200');" style=""> 145                 return info;                                                                             </span>
<span class="3075434854107094892" onmouseenter="enter('3075434854107094892');" onmouseout="out('3075434854107094892');" style=""> 146             }).count();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147         }                                                                                                </span>
<span class="510800137927766729" onmouseenter="enter('510800137927766729');" onmouseout="out('510800137927766729');" style=""> 148         List&lt;Map&lt;String, Object&gt;&gt; cacheContent = Lists.newArrayList();                                   </span>
<span class="-5519708164731405413" onmouseenter="enter('-5519708164731405413');" onmouseout="out('-5519708164731405413');" style=""> 149         AsyncKuduScanner asyncKuduScanner = scannerBuilder.build();                                      </span>
<span class="212265186367526848" onmouseenter="enter('212265186367526848');" onmouseout="out('212265186367526848');" style=""> 150         List&lt;Row&gt; rowList = Lists.newArrayList();                                                        </span>
<span class="6180779613695836367" onmouseenter="enter('6180779613695836367');" onmouseout="out('6180779613695836367');" style=""> 151         Deferred&lt;RowResultIterator&gt; data = asyncKuduScanner.nextRows();                                  </span>
<span class="-7087386879750881573" onmouseenter="enter('-7087386879750881573');" onmouseout="out('-7087386879750881573');" style=""> 152         //从之前的同步修改为调用异步的Callback                                                                         </span>
<span class="278649099550089909" onmouseenter="enter('278649099550089909');" onmouseout="out('278649099550089909');" style=""><abbr title=" 153         data.addCallbackDeferring(new GetListRowCB(inputCopy, cacheContent, rowList, asyncKuduScanner, resultFuture, buildCacheKey(inputParams)));"> 153         data.addCallbackDeferring(new GetListRowCB(inputCopy, cacheContent, rowList, asyncKuduScanner, re🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 156     @Override                                                                                            </span>
<span class="6374398777166986707" onmouseenter="enter('6374398777166986707');" onmouseout="out('6374398777166986707');" style=""> 157     public String buildCacheKey(Map&lt;String, Object&gt; inputParams) {                                       </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 158         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="-3940662932484837264" onmouseenter="enter('-3940662932484837264');" onmouseout="out('-3940662932484837264');" style=""> 159         for (Object ele : inputParams.values()) {                                                        </span>
<span class="-9219177986461641503" onmouseenter="enter('-9219177986461641503');" onmouseout="out('-9219177986461641503');" style=""> 160             sb.append(ele.toString())                                                                    </span>
<span class="-7037257933228320495" onmouseenter="enter('-7037257933228320495');" onmouseout="out('-7037257933228320495');" style=""> 161                     .append(&quot;_&quot;);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span  style=""> 163                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 164         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165     }                                                                                                    </span>
<span  style=""> 166                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 167     @Override                                                                                            </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style=""> 168     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="2926391945845903809" onmouseenter="enter('2926391945845903809');" onmouseout="out('2926391945845903809');" style=""> 169         Map&lt;String, Object&gt; cacheInfo = ((Map&lt;String, Object&gt;) (sideInput));                             </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style=""> 170         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style=""> 171         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style=""> 172             Object obj = input.getField(entry.getValue());                                               </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style=""> 173             obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                    </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style=""> 174             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175         }                                                                                                </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style=""> 176         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style=""> 177             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 178                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 179             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style=""> 180                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182         }                                                                                                </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 183         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184     }                                                                                                    </span>
<span  style=""> 185                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 186     @Override                                                                                            </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 187     public void close() throws Exception {                                                               </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 188         super.close();                                                                                   </span>
<span class="-466861721853404898" onmouseenter="enter('-466861721853404898');" onmouseout="out('-466861721853404898');" style=""> 189         if (null != asyncClient) {                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 190             try {                                                                                        </span>
<span class="-2833913701521345427" onmouseenter="enter('-2833913701521345427');" onmouseout="out('-2833913701521345427');" style=""> 191                 asyncClient.close();                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 192             } catch (Exception e) {                                                                      </span>
<span class="7169708839653618971" onmouseenter="enter('7169708839653618971');" onmouseout="out('7169708839653618971');" style=""> 193                 LOG.error(&quot;Error while closing client.&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196     }                                                                                                    </span>
<span  style=""> 197                                                                                                          </span>
<span class="3638800353225348075" onmouseenter="enter('3638800353225348075');" onmouseout="out('3638800353225348075');" style=""> 198     class GetListRowCB implements Callback&lt;Deferred&lt;List&lt;Row&gt;&gt;, RowResultIterator&gt; {                     </span>
<span class="7503629168352274570" onmouseenter="enter('7503629168352274570');" onmouseout="out('7503629168352274570');" style=""> 199         private Row input;                                                                               </span>
<span  style=""> 200                                                                                                          </span>
<span class="-3461178940071231317" onmouseenter="enter('-3461178940071231317');" onmouseout="out('-3461178940071231317');" style=""> 201         private List&lt;Map&lt;String, Object&gt;&gt; cacheContent;                                                  </span>
<span  style=""> 202                                                                                                          </span>
<span class="8807764549675743801" onmouseenter="enter('8807764549675743801');" onmouseout="out('8807764549675743801');" style=""> 203         private List&lt;Row&gt; rowList;                                                                       </span>
<span  style=""> 204                                                                                                          </span>
<span class="5723031173307092846" onmouseenter="enter('5723031173307092846');" onmouseout="out('5723031173307092846');" style=""> 205         private AsyncKuduScanner asyncKuduScanner;                                                       </span>
<span  style=""> 206                                                                                                          </span>
<span class="-2087617261824804701" onmouseenter="enter('-2087617261824804701');" onmouseout="out('-2087617261824804701');" style=""> 207         private ResultFuture&lt;BaseRow&gt; resultFuture;                                                      </span>
<span  style=""> 208                                                                                                          </span>
<span class="-1449703644783381384" onmouseenter="enter('-1449703644783381384');" onmouseout="out('-1449703644783381384');" style=""> 209         private String key;                                                                              </span>
<span  style=""> 210                                                                                                          </span>
<span class="1613753735602313740" onmouseenter="enter('1613753735602313740');" onmouseout="out('1613753735602313740');" style=""> 211         public GetListRowCB() {                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212         }                                                                                                </span>
<span  style=""> 213                                                                                                          </span>
<span class="-989890602987333485" onmouseenter="enter('-989890602987333485');" onmouseout="out('-989890602987333485');" style=""><abbr title=" 214         GetListRowCB(Row input, List&lt;Map&lt;String, Object&gt;&gt; cacheContent, List&lt;Row&gt; rowList, AsyncKuduScanner asyncKuduScanner, ResultFuture&lt;BaseRow&gt; resultFuture, String key) {"> 214         GetListRowCB(Row input, List&lt;Map&lt;String, Object&gt;&gt; cacheContent, List&lt;Row&gt; rowList, AsyncKuduScann🔵</abbr></span>
<span class="8214429602983504200" onmouseenter="enter('8214429602983504200');" onmouseout="out('8214429602983504200');" style=""> 215             this.input = input;                                                                          </span>
<span class="-7432664925500830597" onmouseenter="enter('-7432664925500830597');" onmouseout="out('-7432664925500830597');" style=""> 216             this.cacheContent = cacheContent;                                                            </span>
<span class="5762471889889938429" onmouseenter="enter('5762471889889938429');" onmouseout="out('5762471889889938429');" style=""> 217             this.rowList = rowList;                                                                      </span>
<span class="4954020228022176436" onmouseenter="enter('4954020228022176436');" onmouseout="out('4954020228022176436');" style=""> 218             this.asyncKuduScanner = asyncKuduScanner;                                                    </span>
<span class="592225705701792215" onmouseenter="enter('592225705701792215');" onmouseout="out('592225705701792215');" style=""> 219             this.resultFuture = resultFuture;                                                            </span>
<span class="5062295098979135982" onmouseenter="enter('5062295098979135982');" onmouseout="out('5062295098979135982');" style=""> 220             this.key = key;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221         }                                                                                                </span>
<span  style=""> 222                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 223         @Override                                                                                        </span>
<span class="8767874272678853351" onmouseenter="enter('8767874272678853351');" onmouseout="out('8767874272678853351');" style=""> 224         public Deferred&lt;List&lt;Row&gt;&gt; call(RowResultIterator results) throws Exception {                    </span>
<span class="-8941030450012249491" onmouseenter="enter('-8941030450012249491');" onmouseout="out('-8941030450012249491');" style=""> 225             for (RowResult result : results) {                                                           </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 226                 Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                          </span>
<span class="4786776012437782338" onmouseenter="enter('4786776012437782338');" onmouseout="out('4786776012437782338');" style=""> 227                 for (String sideFieldName1 : StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;)) {   </span>
<span class="5422300911827801712" onmouseenter="enter('5422300911827801712');" onmouseout="out('5422300911827801712');" style=""> 228                     String sideFieldName = sideFieldName1.trim();                                        </span>
<span class="-7396994512053753949" onmouseenter="enter('-7396994512053753949');" onmouseout="out('-7396994512053753949');" style=""> 229                     ColumnSchema columnSchema = table.getSchema().getColumn(sideFieldName);              </span>
<span class="-1551001954350423389" onmouseenter="enter('-1551001954350423389');" onmouseout="out('-1551001954350423389');" style=""> 230                     if (null != columnSchema) {                                                          </span>
<span class="-9080618923968214410" onmouseenter="enter('-9080618923968214410');" onmouseout="out('-9080618923968214410');" style=""> 231                         KuduUtil.setMapValue(columnSchema.getType(), oneRow, sideFieldName, result);     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233                 }                                                                                        </span>
<span class="-7708136132104498122" onmouseenter="enter('-7708136132104498122');" onmouseout="out('-7708136132104498122');" style=""> 234                 Row row = fillData(input, oneRow);                                                       </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 235                 if (openCache()) {                                                                       </span>
<span class="1888587301705190474" onmouseenter="enter('1888587301705190474');" onmouseout="out('1888587301705190474');" style=""> 236                     cacheContent.add(oneRow);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237                 }                                                                                        </span>
<span class="8104339441102894963" onmouseenter="enter('8104339441102894963');" onmouseout="out('8104339441102894963');" style=""> 238                 rowList.add(row);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239             }                                                                                            </span>
<span class="-5880917173204222408" onmouseenter="enter('-5880917173204222408');" onmouseout="out('-5880917173204222408');" style=""> 240             if (asyncKuduScanner.hasMoreRows()) {                                                        </span>
<span class="411290205859931493" onmouseenter="enter('411290205859931493');" onmouseout="out('411290205859931493');" style=""> 241                 return asyncKuduScanner.nextRows().addCallbackDeferring(this);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242             }                                                                                            </span>
<span class="-5182000486454444757" onmouseenter="enter('-5182000486454444757');" onmouseout="out('-5182000486454444757');" style=""> 243             if (rowList.size() &gt; 0) {                                                                    </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 244                 if (openCache()) {                                                                       </span>
<span class="-1330765095474862231" onmouseenter="enter('-1330765095474862231');" onmouseout="out('-1330765095474862231');" style=""> 245                     putCache(key, CacheObj.buildCacheObj(ECacheContentType.MultiLine, cacheContent));    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246                 }                                                                                        </span>
<span class="-3708188502172280479" onmouseenter="enter('-3708188502172280479');" onmouseout="out('-3708188502172280479');" style=""> 247                 RowDataComplete.completeRow(resultFuture, rowList);                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 248             } else {                                                                                     </span>
<span class="-5083140435457393877" onmouseenter="enter('-5083140435457393877');" onmouseout="out('-5083140435457393877');" style=""> 249                 dealMissKey(input, resultFuture);                                                        </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 250                 if (openCache()) {                                                                       </span>
<span class="-8441501593343926173" onmouseenter="enter('-8441501593343926173');" onmouseout="out('-8441501593343926173');" style=""> 251                     // 放置在putCache的Miss中 一段时间内同一个key都会直接返回                                               </span>
<span class="-5736723344410400278" onmouseenter="enter('-5736723344410400278');" onmouseout="out('-5736723344410400278');" style=""> 252                     putCache(key, CacheMissVal.getMissKeyObj());                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254             }                                                                                            </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 255             return null;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258 }                                                                                                        </span>











































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-8840953368027741170" onmouseenter="enter('-8840953368027741170');" onmouseout="out('-8840953368027741170');" style="">   1  package com.dtstack.flink.sql.side.kudu;                                                                          </span>
<span  style="">   2                                                                                                                    </span>
<span class="3774663631063558777" onmouseenter="enter('3774663631063558777');" onmouseout="out('3774663631063558777');" style="">   3  import com.dtstack.flink.sql.enums.ECacheContentType;                                                             </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">   4  import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                          </span>
<span class="-1010634606182625441" onmouseenter="enter('-1010634606182625441');" onmouseout="out('-1010634606182625441');" style="">   5  import com.dtstack.flink.sql.side.BaseAsyncReqRow;                                                                </span>
<span class="3586780810941248070" onmouseenter="enter('3586780810941248070');" onmouseout="out('3586780810941248070');" style="">   6  import com.dtstack.flink.sql.side.CacheMissVal;                                                                   </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">   7  import com.dtstack.flink.sql.side.FieldInfo;                                                                      </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">   8  import com.dtstack.flink.sql.side.JoinInfo;                                                                       </span>
<span class="1614892075588798997" onmouseenter="enter('1614892075588798997');" onmouseout="out('1614892075588798997');" style="">   9  import com.dtstack.flink.sql.side.PredicateInfo;                                                                  </span>
<span class="423094574771867323" onmouseenter="enter('423094574771867323');" onmouseout="out('423094574771867323');" style="">  10  import com.dtstack.flink.sql.side.cache.CacheObj;                                                                 </span>
<span class="5710642889135375263" onmouseenter="enter('5710642889135375263');" onmouseout="out('5710642889135375263');" style="">  11  import com.dtstack.flink.sql.side.kudu.table.KuduSideTableInfo;                                                   </span>
<span class="1164335795537447661" onmouseenter="enter('1164335795537447661');" onmouseout="out('1164335795537447661');" style="">  12  import com.dtstack.flink.sql.side.kudu.utils.KuduUtil;                                                            </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  13 +import com.dtstack.flink.sql.util.RowDataComplete;                                                                </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  14  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  15  import com.google.common.collect.Maps;                                                                            </span>
<span class="-5750625329012831967" onmouseenter="enter('-5750625329012831967');" onmouseout="out('-5750625329012831967');" style="">  16  import com.stumbleupon.async.Callback;                                                                            </span>
<span class="-5487067255628915347" onmouseenter="enter('-5487067255628915347');" onmouseout="out('-5487067255628915347');" style="">  17  import com.stumbleupon.async.Deferred;                                                                            </span>
<span class="-8491175051504538735" onmouseenter="enter('-8491175051504538735');" onmouseout="out('-8491175051504538735');" style="">  18  import io.vertx.core.json.JsonArray;                                                                              </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  19  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  20 +import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  21  import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  22  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="-2094289371926699111" onmouseenter="enter('-2094289371926699111');" onmouseout="out('-2094289371926699111');" style="">  23  import org.apache.flink.streaming.api.functions.async.ResultFuture;                                               </span>
<span class="3883198981410010526" onmouseenter="enter('3883198981410010526');" onmouseout="out('3883198981410010526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import org.apache.flink.table.runtime.types.CRow;                                                                 </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  26 +import org.apache.flink.table.dataformat.BaseRow;                                                                 </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  27  import org.apache.flink.types.Row;                                                                                </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  28  import org.apache.flink.util.Preconditions;                                                                       </span>
<span class="1631232015531818624" onmouseenter="enter('1631232015531818624');" onmouseout="out('1631232015531818624');" style="">  29  import org.apache.kudu.ColumnSchema;                                                                              </span>
<span class="-1755042893780385624" onmouseenter="enter('-1755042893780385624');" onmouseout="out('-1755042893780385624');" style="">  30  import org.apache.kudu.Schema;                                                                                    </span>
<span class="7204708202450962745" onmouseenter="enter('7204708202450962745');" onmouseout="out('7204708202450962745');" style="">  31  import org.apache.kudu.client.AsyncKuduClient;                                                                    </span>
<span class="3400841229030892477" onmouseenter="enter('3400841229030892477');" onmouseout="out('3400841229030892477');" style="">  32  import org.apache.kudu.client.AsyncKuduScanner;                                                                   </span>
<span class="1860194643195428903" onmouseenter="enter('1860194643195428903');" onmouseout="out('1860194643195428903');" style="">  33  import org.apache.kudu.client.KuduException;                                                                      </span>
<span class="128288131530978478" onmouseenter="enter('128288131530978478');" onmouseout="out('128288131530978478');" style="">  34  import org.apache.kudu.client.KuduPredicate;                                                                      </span>
<span class="-342692776902705676" onmouseenter="enter('-342692776902705676');" onmouseout="out('-342692776902705676');" style="">  35  import org.apache.kudu.client.KuduTable;                                                                          </span>
<span class="-6157621177665621032" onmouseenter="enter('-6157621177665621032');" onmouseout="out('-6157621177665621032');" style="">  36  import org.apache.kudu.client.RowResult;                                                                          </span>
<span class="-1845673204769190809" onmouseenter="enter('-1845673204769190809');" onmouseout="out('-1845673204769190809');" style="">  37  import org.apache.kudu.client.RowResultIterator;                                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  38  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  39  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  40                                                                                                                    </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  41 -import java.sql.Timestamp;                                                                                        </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  42  import java.util.Arrays;                                                                                          </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  43  import java.util.Collections;                                                                                     </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  44  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  45  import java.util.Map;                                                                                             </span>

<span  style="">  46                                                                                                                    </span>
<span class="3638139650453766874" onmouseenter="enter('3638139650453766874');" onmouseout="out('3638139650453766874');" style="">  47  public class KuduAsyncReqRow extends BaseAsyncReqRow {                                                            </span>
<span  style="">  48                                                                                                                    </span>
<span class="-2074213480282018260" onmouseenter="enter('-2074213480282018260');" onmouseout="out('-2074213480282018260');" style="">  49      private static final Logger LOG = LoggerFactory.getLogger(KuduAsyncReqRow.class);                             </span>



<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50      /**                                                                                                           </span>
<span class="-8285284077529796986" onmouseenter="enter('-8285284077529796986');" onmouseout="out('-8285284077529796986');" style="">  51       * 获取连接的尝试次数                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52       */                                                                                                           </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  53      private static final int CONN_RETRY_NUM = 3;                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  54      /**                                                                                                           </span>
<span class="4062789252244833512" onmouseenter="enter('4062789252244833512');" onmouseout="out('4062789252244833512');" style="">  55       * 缓存条数                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  56       */                                                                                                           </span>
<span class="1004470848600586149" onmouseenter="enter('1004470848600586149');" onmouseout="out('1004470848600586149');" style="">  57      private static final Long FETCH_SIZE = 1000L;                                                                 </span>
<span  style="">  58                                                                                                                    </span>
<span class="5253634271646137455" onmouseenter="enter('5253634271646137455');" onmouseout="out('5253634271646137455');" style="">  59      private static final long serialVersionUID = 5028583854989267753L;                                            </span>
<span  style="">  60                                                                                                                    </span>
<span  style="">  61                                                                                                                    </span>
<span class="6513367378672126597" onmouseenter="enter('6513367378672126597');" onmouseout="out('6513367378672126597');" style="">  62      private AsyncKuduClient asyncClient;                                                                          </span>
<span  style="">  63                                                                                                                    </span>
<span class="1317689277640300307" onmouseenter="enter('1317689277640300307');" onmouseout="out('1317689277640300307');" style="">  64      private KuduTable table;                                                                                      </span>
<span  style="">  65                                                                                                                    </span>
<span class="4635177141603060317" onmouseenter="enter('4635177141603060317');" onmouseout="out('4635177141603060317');" style="">  66      private KuduSideTableInfo kuduSideTableInfo;                                                                  </span>
<span  style="">  67                                                                                                                    </span>
<span class="4170992710598328570" onmouseenter="enter('4170992710598328570');" onmouseout="out('4170992710598328570');" style="">  68      private AsyncKuduScanner.AsyncKuduScannerBuilder scannerBuilder;                                              </span>
<span  style="">  69                                                                                                                    </span>
<span class="-5994744104468733303" onmouseenter="enter('-5994744104468733303');" onmouseout="out('-5994744104468733303');" style=""><abbr title="  70      public KuduAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  70      public KuduAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractS🔵</abbr></span>
<span class="6563035163892178349" onmouseenter="enter('6563035163892178349');" onmouseout="out('6563035163892178349');" style="">  71          super(new KuduAsyncSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72      }                                                                                                             </span>
<span  style="">  73                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  74      @Override                                                                                                     </span>
<span class="-8008343056571207451" onmouseenter="enter('-8008343056571207451');" onmouseout="out('-8008343056571207451');" style="">  75      public void open(Configuration parameters) throws Exception {                                                 </span>
<span class="8736254984801772910" onmouseenter="enter('8736254984801772910');" onmouseout="out('8736254984801772910');" style="">  76          super.open(parameters);                                                                                   </span>
<span class="-7685679746867905609" onmouseenter="enter('-7685679746867905609');" onmouseout="out('-7685679746867905609');" style="">  77          kuduSideTableInfo = (KuduSideTableInfo) sideInfo.getSideTableInfo();                                      </span>
<span class="-4562633082775627441" onmouseenter="enter('-4562633082775627441');" onmouseout="out('-4562633082775627441');" style="">  78          connKuDu();                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79      }                                                                                                             </span>
<span  style="">  80                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  81      /**                                                                                                           </span>
<span class="803083353752398343" onmouseenter="enter('803083353752398343');" onmouseout="out('803083353752398343');" style="">  82       * 连接kudu中的表                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  83       *                                                                                                            </span>
<span class="-5432256053392020081" onmouseenter="enter('-5432256053392020081');" onmouseout="out('-5432256053392020081');" style="">  84       * @throws KuduException                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  85       */                                                                                                           </span>
<span class="-5290115760614089350" onmouseenter="enter('-5290115760614089350');" onmouseout="out('-5290115760614089350');" style="">  86      private void connKuDu() throws KuduException {                                                                </span>
<span class="-56179035184578959" onmouseenter="enter('-56179035184578959');" onmouseout="out('-56179035184578959');" style="">  87          if (null == table) {                                                                                      </span>
<span class="4308396336047168888" onmouseenter="enter('4308396336047168888');" onmouseout="out('4308396336047168888');" style="">  88              String kuduMasters = kuduSideTableInfo.getKuduMasters();                                              </span>
<span class="-4444229447990232757" onmouseenter="enter('-4444229447990232757');" onmouseout="out('-4444229447990232757');" style="">  89              String tableName = kuduSideTableInfo.getTableName();                                                  </span>
<span class="4427587995392923155" onmouseenter="enter('4427587995392923155');" onmouseout="out('4427587995392923155');" style="">  90              Integer workerCount = kuduSideTableInfo.getWorkerCount();                                             </span>
<span class="-5299851536099138671" onmouseenter="enter('-5299851536099138671');" onmouseout="out('-5299851536099138671');" style="">  91              Integer defaultSocketReadTimeoutMs = kuduSideTableInfo.getDefaultSocketReadTimeoutMs();               </span>
<span class="-2694307185983387776" onmouseenter="enter('-2694307185983387776');" onmouseout="out('-2694307185983387776');" style="">  92              Integer defaultOperationTimeoutMs = kuduSideTableInfo.getDefaultOperationTimeoutMs();                 </span>
<span  style="">  93                                                                                                                    </span>
<span class="-6052455991030570635" onmouseenter="enter('-6052455991030570635');" onmouseout="out('-6052455991030570635');" style="">  94              Preconditions.checkNotNull(kuduMasters, &quot;kuduMasters could not be null&quot;);                             </span>
<span  style="">  95                                                                                                                    </span>
<span class="-6520194397411128459" onmouseenter="enter('-6520194397411128459');" onmouseout="out('-6520194397411128459');" style=""><abbr title="  96              AsyncKuduClient.AsyncKuduClientBuilder asyncKuduClientBuilder = new AsyncKuduClient.AsyncKuduClientBuilder(kuduMasters);">  96              AsyncKuduClient.AsyncKuduClientBuilder asyncKuduClientBuilder = new AsyncKuduClient.AsyncKuduClientBui🔵</abbr></span>
<span class="-8227759523178082238" onmouseenter="enter('-8227759523178082238');" onmouseout="out('-8227759523178082238');" style="">  97              if (null != workerCount) {                                                                            </span>
<span class="-5467062577113570128" onmouseenter="enter('-5467062577113570128');" onmouseout="out('-5467062577113570128');" style="">  98                  asyncKuduClientBuilder.workerCount(workerCount);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99              }                                                                                                     </span>
<span  style=""> 100                                                                                                                    </span>
<span class="-2397215110746175709" onmouseenter="enter('-2397215110746175709');" onmouseout="out('-2397215110746175709');" style=""> 101              if (null != defaultOperationTimeoutMs) {                                                              </span>
<span class="7366215511831154275" onmouseenter="enter('7366215511831154275');" onmouseout="out('7366215511831154275');" style=""> 102                  asyncKuduClientBuilder.defaultOperationTimeoutMs(defaultOperationTimeoutMs);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103              }                                                                                                     </span>
<span class="2560969904046492964" onmouseenter="enter('2560969904046492964');" onmouseout="out('2560969904046492964');" style=""> 104              asyncClient = asyncKuduClientBuilder.build();                                                         </span>
<span class="441886789095796306" onmouseenter="enter('441886789095796306');" onmouseout="out('441886789095796306');" style=""> 105              if (!asyncClient.syncClient().tableExists(tableName)) {                                               </span>
<span class="4123299035781055923" onmouseenter="enter('4123299035781055923');" onmouseout="out('4123299035781055923');" style=""> 106                  throw new IllegalArgumentException(&quot;Table Open Failed , please check table exists&quot;);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107              }                                                                                                     </span>
<span class="4092827604202793861" onmouseenter="enter('4092827604202793861');" onmouseout="out('4092827604202793861');" style=""> 108              table = asyncClient.syncClient().openTable(tableName);                                                </span>
<span class="4177758485368982030" onmouseenter="enter('4177758485368982030');" onmouseout="out('4177758485368982030');" style=""> 109              LOG.info(&quot;connect kudu is successed!&quot;);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110          }                                                                                                         </span>
<span class="2924668647776163983" onmouseenter="enter('2924668647776163983');" onmouseout="out('2924668647776163983');" style=""> 111          scannerBuilder = asyncClient.newScannerBuilder(table);                                                    </span>
<span class="-4404448253596110496" onmouseenter="enter('-4404448253596110496');" onmouseout="out('-4404448253596110496');" style=""> 112          Integer batchSizeBytes = kuduSideTableInfo.getBatchSizeBytes();                                           </span>
<span class="-7735055932391271380" onmouseenter="enter('-7735055932391271380');" onmouseout="out('-7735055932391271380');" style=""> 113          Long limitNum = kuduSideTableInfo.getLimitNum();                                                          </span>
<span class="1611473127340759637" onmouseenter="enter('1611473127340759637');" onmouseout="out('1611473127340759637');" style=""> 114          Boolean isFaultTolerant = kuduSideTableInfo.getFaultTolerant();                                           </span>
<span class="-8526639943056837274" onmouseenter="enter('-8526639943056837274');" onmouseout="out('-8526639943056837274');" style=""> 115          //查询需要的字段                                                                                                 </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 116          String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                         </span>
<span  style=""> 117                                                                                                                    </span>
<span class="-8080913465496496419" onmouseenter="enter('-8080913465496496419');" onmouseout="out('-8080913465496496419');" style=""> 118          if (null == limitNum || limitNum &lt;= 0) {                                                                  </span>
<span class="7767157001459171317" onmouseenter="enter('7767157001459171317');" onmouseout="out('7767157001459171317');" style=""> 119              scannerBuilder.limit(FETCH_SIZE);                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 120          } else {                                                                                                  </span>
<span class="6087958399625777057" onmouseenter="enter('6087958399625777057');" onmouseout="out('6087958399625777057');" style=""> 121              scannerBuilder.limit(limitNum);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122          }                                                                                                         </span>
<span class="-5740110908714073879" onmouseenter="enter('-5740110908714073879');" onmouseout="out('-5740110908714073879');" style=""> 123          if (null != batchSizeBytes) {                                                                             </span>
<span class="-3929060200025616829" onmouseenter="enter('-3929060200025616829');" onmouseout="out('-3929060200025616829');" style=""> 124              scannerBuilder.batchSizeBytes(batchSizeBytes);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125          }                                                                                                         </span>
<span class="-8680730272034558637" onmouseenter="enter('-8680730272034558637');" onmouseout="out('-8680730272034558637');" style=""> 126          if (null != isFaultTolerant) {                                                                            </span>
<span class="-5364988782144201666" onmouseenter="enter('-5364988782144201666');" onmouseout="out('-5364988782144201666');" style=""> 127              scannerBuilder.setFaultTolerant(isFaultTolerant);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128          }                                                                                                         </span>
<span  style=""> 129                                                                                                                    </span>
<span class="6330664272177173056" onmouseenter="enter('6330664272177173056');" onmouseout="out('6330664272177173056');" style=""> 130          List&lt;String&gt; projectColumns = Arrays.asList(sideFieldNames);                                              </span>
<span class="2684072470806705647" onmouseenter="enter('2684072470806705647');" onmouseout="out('2684072470806705647');" style=""> 131          scannerBuilder.setProjectedColumnNames(projectColumns);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132      }                                                                                                             </span>
<span  style=""> 133                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 134      @Override                                                                                                     </span>
<span class="-3645419592203298662" onmouseenter="enter('-3645419592203298662');" onmouseout="out('-3645419592203298662');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 135 -    public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, CRow input, ResultFuture&lt;CRow&gt; resultFuture) throws Exception {"> 135 -    public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, CRow input, ResultFuture&lt;CRow&gt; resultFuture) th🔵</abbr></span>
<span class="1202395436001278606" onmouseenter="enter('1202395436001278606');" onmouseout="out('1202395436001278606');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -        CRow inputCopy = new CRow(input.row(), input.change());                                                   </span>
<span class="3547897215975148581" onmouseenter="enter('3547897215975148581');" onmouseout="out('3547897215975148581');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 137 +    public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resultFuture) throws Exception {"> 137 +    public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, Row input, ResultFuture&lt;BaseRow&gt; resultFuture) 🔵</abbr></span>
<span class="-2042762712356066763" onmouseenter="enter('-2042762712356066763');" onmouseout="out('-2042762712356066763');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +        Row inputCopy = Row.copy(input);                                                                          </span>
<span class="5065834272723126023" onmouseenter="enter('5065834272723126023');" onmouseout="out('5065834272723126023');" style=""> 139          //scannerBuilder 设置为null重新加载过滤条件,然后connkudu重新赋值                                                           </span>
<span class="2495891823177141345" onmouseenter="enter('2495891823177141345');" onmouseout="out('2495891823177141345');" style=""> 140          //todo:代码需要优化                                                                                             </span>
<span class="3515238287407101771" onmouseenter="enter('3515238287407101771');" onmouseout="out('3515238287407101771');" style=""> 141          scannerBuilder = null;                                                                                    </span>
<span class="-4562633082775627441" onmouseenter="enter('-4562633082775627441');" onmouseout="out('-4562633082775627441');" style=""> 142          connKuDu();                                                                                               </span>
<span class="6789989036272871448" onmouseenter="enter('6789989036272871448');" onmouseout="out('6789989036272871448');" style=""> 143          Schema schema = table.getSchema();                                                                        </span>
<span class="-6874703698410301106" onmouseenter="enter('-6874703698410301106');" onmouseout="out('-6874703698410301106');" style=""> 144          //  @wenbaoup fix bug                                                                                     </span>
<span class="-2762964740504478972" onmouseenter="enter('-2762964740504478972');" onmouseout="out('-2762964740504478972');" style=""> 145          inputParams.entrySet().forEach(e -&gt;{                                                                      </span>
<span class="-44569786791220301" onmouseenter="enter('-44569786791220301');" onmouseout="out('-44569786791220301');" style=""><abbr title=" 146              scannerBuilder.addPredicate(KuduPredicate.newInListPredicate(schema.getColumn(e.getKey()), Collections.singletonList(e.getValue())));"> 146              scannerBuilder.addPredicate(KuduPredicate.newInListPredicate(schema.getColumn(e.getKey()), Collections🔵</abbr></span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 147          });                                                                                                       </span>
<span  style=""> 148                                                                                                                    </span>
<span class="-5863912479223093982" onmouseenter="enter('-5863912479223093982');" onmouseout="out('-5863912479223093982');" style=""> 149          //  填充谓词信息                                                                                                </span>
<span class="-8839623202504591157" onmouseenter="enter('-8839623202504591157');" onmouseout="out('-8839623202504591157');" style=""> 150          List&lt;PredicateInfo&gt; predicateInfoes = sideInfo.getSideTableInfo().getPredicateInfoes();                   </span>
<span class="1131384255148676390" onmouseenter="enter('1131384255148676390');" onmouseout="out('1131384255148676390');" style=""> 151          if (predicateInfoes.size() &gt; 0) {                                                                         </span>
<span class="7087000648291367893" onmouseenter="enter('7087000648291367893');" onmouseout="out('7087000648291367893');" style=""> 152              predicateInfoes.stream().map(info -&gt; {                                                                </span>
<span class="-3754680470381432050" onmouseenter="enter('-3754680470381432050');" onmouseout="out('-3754680470381432050');" style=""> 153                  KuduPredicate kuduPredicate = KuduUtil.buildKuduPredicate(schema, info);                          </span>
<span class="8493928812165156395" onmouseenter="enter('8493928812165156395');" onmouseout="out('8493928812165156395');" style=""> 154                  if (null != kuduPredicate) {                                                                      </span>
<span class="-8515842596395934222" onmouseenter="enter('-8515842596395934222');" onmouseout="out('-8515842596395934222');" style=""> 155                      scannerBuilder.addPredicate(kuduPredicate);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                  }                                                                                                 </span>
<span class="-3556780733195614200" onmouseenter="enter('-3556780733195614200');" onmouseout="out('-3556780733195614200');" style=""> 157                  return info;                                                                                      </span>
<span class="3075434854107094892" onmouseenter="enter('3075434854107094892');" onmouseout="out('3075434854107094892');" style=""> 158              }).count();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159          }                                                                                                         </span>
<span  style=""> 160                                                                                                                    </span>
<span class="510800137927766729" onmouseenter="enter('510800137927766729');" onmouseout="out('510800137927766729');" style=""> 161          List&lt;Map&lt;String, Object&gt;&gt; cacheContent = Lists.newArrayList();                                            </span>
<span class="-5519708164731405413" onmouseenter="enter('-5519708164731405413');" onmouseout="out('-5519708164731405413');" style=""> 162          AsyncKuduScanner asyncKuduScanner = scannerBuilder.build();                                               </span>
<span class="-3770803949601695435" onmouseenter="enter('-3770803949601695435');" onmouseout="out('-3770803949601695435');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 163 -        List&lt;CRow&gt; rowList = Lists.newArrayList();                                                                </span>
<span class="212265186367526848" onmouseenter="enter('212265186367526848');" onmouseout="out('212265186367526848');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +        List&lt;Row&gt; rowList = Lists.newArrayList();                                                                 </span>
<span class="6180779613695836367" onmouseenter="enter('6180779613695836367');" onmouseout="out('6180779613695836367');" style=""> 165          Deferred&lt;RowResultIterator&gt; data = asyncKuduScanner.nextRows();                                           </span>
<span class="-7087386879750881573" onmouseenter="enter('-7087386879750881573');" onmouseout="out('-7087386879750881573');" style=""> 166          //从之前的同步修改为调用异步的Callback                                                                                  </span>
<span class="278649099550089909" onmouseenter="enter('278649099550089909');" onmouseout="out('278649099550089909');" style=""><abbr title=" 167          data.addCallbackDeferring(new GetListRowCB(inputCopy, cacheContent, rowList, asyncKuduScanner, resultFuture, buildCacheKey(inputParams)));"> 167          data.addCallbackDeferring(new GetListRowCB(inputCopy, cacheContent, rowList, asyncKuduScanner, resultFutur🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168      }                                                                                                             </span>
<span  style=""> 169                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 170      @Override                                                                                                     </span>
<span class="6374398777166986707" onmouseenter="enter('6374398777166986707');" onmouseout="out('6374398777166986707');" style=""> 171      public String buildCacheKey(Map&lt;String, Object&gt; inputParams) {                                                </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 172          StringBuilder sb = new StringBuilder();                                                                   </span>
<span class="-3940662932484837264" onmouseenter="enter('-3940662932484837264');" onmouseout="out('-3940662932484837264');" style=""> 173          for (Object ele : inputParams.values()) {                                                                 </span>
<span class="-9219177986461641503" onmouseenter="enter('-9219177986461641503');" onmouseout="out('-9219177986461641503');" style=""> 174              sb.append(ele.toString())                                                                             </span>
<span class="-7037257933228320495" onmouseenter="enter('-7037257933228320495');" onmouseout="out('-7037257933228320495');" style=""> 175                      .append(&quot;_&quot;);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176          }                                                                                                         </span>
<span  style=""> 177                                                                                                                    </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 178          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179      }                                                                                                             </span>
<span  style=""> 180                                                                                                                    </span>
<span  style=""> 181                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 182      @Override                                                                                                     </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style=""> 183      public Row fillData(Row input, Object sideInput) {                                                            </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style=""> 184          Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                          </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style=""> 185          Row row = new Row(sideInfo.getOutFieldInfoList().size());                                                 </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style=""> 186          for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                         </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style=""> 187              Object obj = input.getField(entry.getValue());                                                        </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 188 -            boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 188 -            boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo🔵</abbr></span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 189 -                                                                                                                  </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 190 -            //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 190 -            //Type information for indicating event or processing time. However, it behaves like a regular SQL tim🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 191 -            if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                            </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 192 -                obj = ((Timestamp) obj).getTime();                                                                </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 193 -            }                                                                                                     </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +            obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                             </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style=""> 195              row.setField(entry.getKey(), obj);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196          }                                                                                                         </span>
<span  style=""> 197                                                                                                                    </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style=""> 198          for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {                    </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style=""> 199              if (cacheInfo == null) {                                                                              </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 200                  row.setField(entry.getKey(), null);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 201              } else {                                                                                              </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style=""> 202                  row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204          }                                                                                                         </span>
<span  style=""> 205                                                                                                                    </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 206          return row;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207      }                                                                                                             </span>
<span  style=""> 208                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 209      @Override                                                                                                     </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 210      public void close() throws Exception {                                                                        </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 211          super.close();                                                                                            </span>
<span class="-466861721853404898" onmouseenter="enter('-466861721853404898');" onmouseout="out('-466861721853404898');" style=""> 212          if (null != asyncClient) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 213              try {                                                                                                 </span>
<span class="-2833913701521345427" onmouseenter="enter('-2833913701521345427');" onmouseout="out('-2833913701521345427');" style=""> 214                  asyncClient.close();                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 215              } catch (Exception e) {                                                                               </span>
<span class="7169708839653618971" onmouseenter="enter('7169708839653618971');" onmouseout="out('7169708839653618971');" style=""> 216                  LOG.error(&quot;Error while closing client.&quot;, e);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219      }                                                                                                             </span>
<span  style=""> 220                                                                                                                    </span>
<span class="3638800353225348075" onmouseenter="enter('3638800353225348075');" onmouseout="out('3638800353225348075');" style=""> 221      class GetListRowCB implements Callback&lt;Deferred&lt;List&lt;Row&gt;&gt;, RowResultIterator&gt; {                              </span>
<span class="2001251848416688346" onmouseenter="enter('2001251848416688346');" onmouseout="out('2001251848416688346');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 222 -        private CRow input;                                                                                       </span>
<span class="7503629168352274570" onmouseenter="enter('7503629168352274570');" onmouseout="out('7503629168352274570');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +        private Row input;                                                                                        </span>
<span class="-3461178940071231317" onmouseenter="enter('-3461178940071231317');" onmouseout="out('-3461178940071231317');" style=""> 224          private List&lt;Map&lt;String, Object&gt;&gt; cacheContent;                                                           </span>
<span class="-5357459632477081071" onmouseenter="enter('-5357459632477081071');" onmouseout="out('-5357459632477081071');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 225 -        private List&lt;CRow&gt; rowList;                                                                               </span>
<span class="8807764549675743801" onmouseenter="enter('8807764549675743801');" onmouseout="out('8807764549675743801');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +        private List&lt;Row&gt; rowList;                                                                                </span>
<span class="5723031173307092846" onmouseenter="enter('5723031173307092846');" onmouseout="out('5723031173307092846');" style=""> 227          private AsyncKuduScanner asyncKuduScanner;                                                                </span>
<span class="5555801037685047910" onmouseenter="enter('5555801037685047910');" onmouseout="out('5555801037685047910');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -        private ResultFuture&lt;CRow&gt; resultFuture;                                                                  </span>
<span class="-2087617261824804701" onmouseenter="enter('-2087617261824804701');" onmouseout="out('-2087617261824804701');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +        private ResultFuture&lt;BaseRow&gt; resultFuture;                                                               </span>
<span class="-1449703644783381384" onmouseenter="enter('-1449703644783381384');" onmouseout="out('-1449703644783381384');" style=""> 230          private String key;                                                                                       </span>
<span  style=""> 231                                                                                                                    </span>
<span  style=""> 232                                                                                                                    </span>
<span class="1613753735602313740" onmouseenter="enter('1613753735602313740');" onmouseout="out('1613753735602313740');" style=""> 233          public GetListRowCB() {                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234          }                                                                                                         </span>
<span  style=""> 235                                                                                                                    </span>
<span class="-1210642425124689079" onmouseenter="enter('-1210642425124689079');" onmouseout="out('-1210642425124689079');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 236 -        GetListRowCB(CRow input, List&lt;Map&lt;String, Object&gt;&gt; cacheContent, List&lt;CRow&gt; rowList, AsyncKuduScanner asyncKuduScanner, ResultFuture&lt;CRow&gt; resultFuture, String key) {"> 236 -        GetListRowCB(CRow input, List&lt;Map&lt;String, Object&gt;&gt; cacheContent, List&lt;CRow&gt; rowList, AsyncKuduScanner asyn🔵</abbr></span>
<span class="-3702604554334756935" onmouseenter="enter('-3702604554334756935');" onmouseout="out('-3702604554334756935');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +        GetListRowCB(Row input, List&lt;Map&lt;String, Object&gt;&gt; cacheContent, List&lt;Row&gt; rowList,                        </span>
<span class="2572339002080827901" onmouseenter="enter('2572339002080827901');" onmouseout="out('2572339002080827901');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +                     AsyncKuduScanner asyncKuduScanner, ResultFuture&lt;BaseRow&gt; resultFuture, String key) {         </span>
<span class="8214429602983504200" onmouseenter="enter('8214429602983504200');" onmouseout="out('8214429602983504200');" style=""> 239              this.input = input;                                                                                   </span>
<span class="-7432664925500830597" onmouseenter="enter('-7432664925500830597');" onmouseout="out('-7432664925500830597');" style=""> 240              this.cacheContent = cacheContent;                                                                     </span>
<span class="5762471889889938429" onmouseenter="enter('5762471889889938429');" onmouseout="out('5762471889889938429');" style=""> 241              this.rowList = rowList;                                                                               </span>
<span class="4954020228022176436" onmouseenter="enter('4954020228022176436');" onmouseout="out('4954020228022176436');" style=""> 242              this.asyncKuduScanner = asyncKuduScanner;                                                             </span>
<span class="592225705701792215" onmouseenter="enter('592225705701792215');" onmouseout="out('592225705701792215');" style=""> 243              this.resultFuture = resultFuture;                                                                     </span>
<span class="5062295098979135982" onmouseenter="enter('5062295098979135982');" onmouseout="out('5062295098979135982');" style=""> 244              this.key = key;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245          }                                                                                                         </span>
<span  style=""> 246                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 247          @Override                                                                                                 </span>
<span class="8767874272678853351" onmouseenter="enter('8767874272678853351');" onmouseout="out('8767874272678853351');" style=""> 248          public Deferred&lt;List&lt;Row&gt;&gt; call(RowResultIterator results) throws Exception {                             </span>
<span class="-8941030450012249491" onmouseenter="enter('-8941030450012249491');" onmouseout="out('-8941030450012249491');" style=""> 249              for (RowResult result : results) {                                                                    </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 250                  Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                                   </span>
<span class="4786776012437782338" onmouseenter="enter('4786776012437782338');" onmouseout="out('4786776012437782338');" style=""> 251                  for (String sideFieldName1 : StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;)) {            </span>
<span class="5422300911827801712" onmouseenter="enter('5422300911827801712');" onmouseout="out('5422300911827801712');" style=""> 252                      String sideFieldName = sideFieldName1.trim();                                                 </span>
<span class="-7396994512053753949" onmouseenter="enter('-7396994512053753949');" onmouseout="out('-7396994512053753949');" style=""> 253                      ColumnSchema columnSchema = table.getSchema().getColumn(sideFieldName);                       </span>
<span class="-1551001954350423389" onmouseenter="enter('-1551001954350423389');" onmouseout="out('-1551001954350423389');" style=""> 254                      if (null != columnSchema) {                                                                   </span>
<span class="-9080618923968214410" onmouseenter="enter('-9080618923968214410');" onmouseout="out('-9080618923968214410');" style=""> 255                          KuduUtil.setMapValue(columnSchema.getType(), oneRow, sideFieldName, result);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257                  }                                                                                                 </span>
<span class="-209789566031535321" onmouseenter="enter('-209789566031535321');" onmouseout="out('-209789566031535321');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 258 -                Row row = fillData(input.row(), oneRow);                                                          </span>
<span class="-7708136132104498122" onmouseenter="enter('-7708136132104498122');" onmouseout="out('-7708136132104498122');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +                Row row = fillData(input, oneRow);                                                                </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 260                  if (openCache()) {                                                                                </span>
<span class="1888587301705190474" onmouseenter="enter('1888587301705190474');" onmouseout="out('1888587301705190474');" style=""> 261                      cacheContent.add(oneRow);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262                  }                                                                                                 </span>
<span class="5232888746699619450" onmouseenter="enter('5232888746699619450');" onmouseout="out('5232888746699619450');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 263 -                rowList.add(new CRow(row, input.change()));                                                       </span>
<span class="8104339441102894963" onmouseenter="enter('8104339441102894963');" onmouseout="out('8104339441102894963');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 264 +                rowList.add(row);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265              }                                                                                                     </span>
<span class="-5880917173204222408" onmouseenter="enter('-5880917173204222408');" onmouseout="out('-5880917173204222408');" style=""> 266              if (asyncKuduScanner.hasMoreRows()) {                                                                 </span>
<span class="411290205859931493" onmouseenter="enter('411290205859931493');" onmouseout="out('411290205859931493');" style=""> 267                  return asyncKuduScanner.nextRows().addCallbackDeferring(this);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268              }                                                                                                     </span>
<span  style=""> 269                                                                                                                    </span>
<span class="-5182000486454444757" onmouseenter="enter('-5182000486454444757');" onmouseout="out('-5182000486454444757');" style=""> 270              if (rowList.size() &gt; 0) {                                                                             </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 271                  if (openCache()) {                                                                                </span>
<span class="-1330765095474862231" onmouseenter="enter('-1330765095474862231');" onmouseout="out('-1330765095474862231');" style=""> 272                      putCache(key, CacheObj.buildCacheObj(ECacheContentType.MultiLine, cacheContent));             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273                  }                                                                                                 </span>
<span class="510192174520611392" onmouseenter="enter('510192174520611392');" onmouseout="out('510192174520611392');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 274 -                resultFuture.complete(rowList);                                                                   </span>
<span class="-3708188502172280479" onmouseenter="enter('-3708188502172280479');" onmouseout="out('-3708188502172280479');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 275 +                RowDataComplete.completeRow(resultFuture, rowList);                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 276              } else {                                                                                              </span>
<span class="-5083140435457393877" onmouseenter="enter('-5083140435457393877');" onmouseout="out('-5083140435457393877');" style=""> 277                  dealMissKey(input, resultFuture);                                                                 </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 278                  if (openCache()) {                                                                                </span>
<span class="-7075096462798044408" onmouseenter="enter('-7075096462798044408');" onmouseout="out('-7075096462798044408');" style=""> 279                      //放置在putCache的Miss中 一段时间内同一个key都会直接返回                                                         </span>
<span class="-5736723344410400278" onmouseenter="enter('-5736723344410400278');" onmouseout="out('-5736723344410400278');" style=""> 280                      putCache(key, CacheMissVal.getMissKeyObj());                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282              }                                                                                                     </span>
<span  style=""> 283                                                                                                                    </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 284              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286      }                                                                                                             </span>
<span  style=""> 287                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="-8840953368027741170" onmouseenter="enter('-8840953368027741170');" onmouseout="out('-8840953368027741170');" style="">   1  package com.dtstack.flink.sql.side.kudu;                                                                          </span>
<span  style="">   2                                                                                                                    </span>
<span class="3774663631063558777" onmouseenter="enter('3774663631063558777');" onmouseout="out('3774663631063558777');" style="">   3  import com.dtstack.flink.sql.enums.ECacheContentType;                                                             </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">   4  import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                          </span>
<span class="-1010634606182625441" onmouseenter="enter('-1010634606182625441');" onmouseout="out('-1010634606182625441');" style="">   5  import com.dtstack.flink.sql.side.BaseAsyncReqRow;                                                                </span>
<span class="3586780810941248070" onmouseenter="enter('3586780810941248070');" onmouseout="out('3586780810941248070');" style="">   6  import com.dtstack.flink.sql.side.CacheMissVal;                                                                   </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">   7  import com.dtstack.flink.sql.side.FieldInfo;                                                                      </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">   8  import com.dtstack.flink.sql.side.JoinInfo;                                                                       </span>
<span class="1614892075588798997" onmouseenter="enter('1614892075588798997');" onmouseout="out('1614892075588798997');" style="">   9  import com.dtstack.flink.sql.side.PredicateInfo;                                                                  </span>
<span class="423094574771867323" onmouseenter="enter('423094574771867323');" onmouseout="out('423094574771867323');" style="">  10  import com.dtstack.flink.sql.side.cache.CacheObj;                                                                 </span>
<span class="5710642889135375263" onmouseenter="enter('5710642889135375263');" onmouseout="out('5710642889135375263');" style="">  11  import com.dtstack.flink.sql.side.kudu.table.KuduSideTableInfo;                                                   </span>
<span class="1164335795537447661" onmouseenter="enter('1164335795537447661');" onmouseout="out('1164335795537447661');" style="">  12  import com.dtstack.flink.sql.side.kudu.utils.KuduUtil;                                                            </span>

<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  13  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  14  import com.google.common.collect.Maps;                                                                            </span>
<span class="-5750625329012831967" onmouseenter="enter('-5750625329012831967');" onmouseout="out('-5750625329012831967');" style="">  15  import com.stumbleupon.async.Callback;                                                                            </span>
<span class="-5487067255628915347" onmouseenter="enter('-5487067255628915347');" onmouseout="out('-5487067255628915347');" style="">  16  import com.stumbleupon.async.Deferred;                                                                            </span>
<span class="-8491175051504538735" onmouseenter="enter('-8491175051504538735');" onmouseout="out('-8491175051504538735');" style="">  17  import io.vertx.core.json.JsonArray;                                                                              </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  18  import org.apache.commons.lang3.StringUtils;                                                                      </span>

<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  19  import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  20  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="-2094289371926699111" onmouseenter="enter('-2094289371926699111');" onmouseout="out('-2094289371926699111');" style="">  21  import org.apache.flink.streaming.api.functions.async.ResultFuture;                                               </span>
<span class="3883198981410010526" onmouseenter="enter('3883198981410010526');" onmouseout="out('3883198981410010526');" style="">  22  import org.apache.flink.table.runtime.types.CRow;                                                                 </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  23  import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>

<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  24  import org.apache.flink.types.Row;                                                                                </span>
<span class="-6095686798359729307" onmouseenter="enter('-6095686798359729307');" onmouseout="out('-6095686798359729307');" style="">  25  import org.apache.flink.util.Preconditions;                                                                       </span>
<span class="1631232015531818624" onmouseenter="enter('1631232015531818624');" onmouseout="out('1631232015531818624');" style="">  26  import org.apache.kudu.ColumnSchema;                                                                              </span>
<span class="-1755042893780385624" onmouseenter="enter('-1755042893780385624');" onmouseout="out('-1755042893780385624');" style="">  27  import org.apache.kudu.Schema;                                                                                    </span>
<span class="7204708202450962745" onmouseenter="enter('7204708202450962745');" onmouseout="out('7204708202450962745');" style="">  28  import org.apache.kudu.client.AsyncKuduClient;                                                                    </span>
<span class="3400841229030892477" onmouseenter="enter('3400841229030892477');" onmouseout="out('3400841229030892477');" style="">  29  import org.apache.kudu.client.AsyncKuduScanner;                                                                   </span>
<span class="1860194643195428903" onmouseenter="enter('1860194643195428903');" onmouseout="out('1860194643195428903');" style="">  30  import org.apache.kudu.client.KuduException;                                                                      </span>
<span class="128288131530978478" onmouseenter="enter('128288131530978478');" onmouseout="out('128288131530978478');" style="">  31  import org.apache.kudu.client.KuduPredicate;                                                                      </span>
<span class="-342692776902705676" onmouseenter="enter('-342692776902705676');" onmouseout="out('-342692776902705676');" style="">  32  import org.apache.kudu.client.KuduTable;                                                                          </span>
<span class="-6157621177665621032" onmouseenter="enter('-6157621177665621032');" onmouseout="out('-6157621177665621032');" style="">  33  import org.apache.kudu.client.RowResult;                                                                          </span>
<span class="-1845673204769190809" onmouseenter="enter('-1845673204769190809');" onmouseout="out('-1845673204769190809');" style="">  34  import org.apache.kudu.client.RowResultIterator;                                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  35  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  36  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  37                                                                                                                    </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  38  import java.sql.Timestamp;                                                                                        </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  39 -import java.util.Arrays;                                                                                          </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  40 -import java.util.Collections;                                                                                     </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  41 -import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  42 -import java.util.Map;                                                                                             </span>
<span class="196713859697444637" onmouseenter="enter('196713859697444637');" onmouseout="out('196713859697444637');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  43 +import java.util.*;                                                                                               </span>
<span  style="">  44                                                                                                                    </span>
<span class="3638139650453766874" onmouseenter="enter('3638139650453766874');" onmouseout="out('3638139650453766874');" style="">  45  public class KuduAsyncReqRow extends BaseAsyncReqRow {                                                            </span>
<span  style="">  46                                                                                                                    </span>
<span class="-2074213480282018260" onmouseenter="enter('-2074213480282018260');" onmouseout="out('-2074213480282018260');" style="">  47      private static final Logger LOG = LoggerFactory.getLogger(KuduAsyncReqRow.class);                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +                                                                                                                  </span>
<span class="2989253342565506687" onmouseenter="enter('2989253342565506687');" onmouseout="out('2989253342565506687');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +    private static final TimeZone LOCAL_TZ = TimeZone.getDefault();                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  50 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  51      /**                                                                                                           </span>
<span class="-8285284077529796986" onmouseenter="enter('-8285284077529796986');" onmouseout="out('-8285284077529796986');" style="">  52       * 获取连接的尝试次数                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  53       */                                                                                                           </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  54      private static final int CONN_RETRY_NUM = 3;                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55      /**                                                                                                           </span>
<span class="4062789252244833512" onmouseenter="enter('4062789252244833512');" onmouseout="out('4062789252244833512');" style="">  56       * 缓存条数                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  57       */                                                                                                           </span>
<span class="1004470848600586149" onmouseenter="enter('1004470848600586149');" onmouseout="out('1004470848600586149');" style="">  58      private static final Long FETCH_SIZE = 1000L;                                                                 </span>
<span  style="">  59                                                                                                                    </span>
<span class="5253634271646137455" onmouseenter="enter('5253634271646137455');" onmouseout="out('5253634271646137455');" style="">  60      private static final long serialVersionUID = 5028583854989267753L;                                            </span>
<span  style="">  61                                                                                                                    </span>
<span  style="">  62                                                                                                                    </span>
<span class="6513367378672126597" onmouseenter="enter('6513367378672126597');" onmouseout="out('6513367378672126597');" style="">  63      private AsyncKuduClient asyncClient;                                                                          </span>
<span  style="">  64                                                                                                                    </span>
<span class="1317689277640300307" onmouseenter="enter('1317689277640300307');" onmouseout="out('1317689277640300307');" style="">  65      private KuduTable table;                                                                                      </span>
<span  style="">  66                                                                                                                    </span>
<span class="4635177141603060317" onmouseenter="enter('4635177141603060317');" onmouseout="out('4635177141603060317');" style="">  67      private KuduSideTableInfo kuduSideTableInfo;                                                                  </span>
<span  style="">  68                                                                                                                    </span>
<span class="4170992710598328570" onmouseenter="enter('4170992710598328570');" onmouseout="out('4170992710598328570');" style="">  69      private AsyncKuduScanner.AsyncKuduScannerBuilder scannerBuilder;                                              </span>
<span  style="">  70                                                                                                                    </span>
<span class="-5994744104468733303" onmouseenter="enter('-5994744104468733303');" onmouseout="out('-5994744104468733303');" style=""><abbr title="  71      public KuduAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  71      public KuduAsyncReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractS🔵</abbr></span>
<span class="6563035163892178349" onmouseenter="enter('6563035163892178349');" onmouseout="out('6563035163892178349');" style="">  72          super(new KuduAsyncSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  73      }                                                                                                             </span>
<span  style="">  74                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  75      @Override                                                                                                     </span>
<span class="-8008343056571207451" onmouseenter="enter('-8008343056571207451');" onmouseout="out('-8008343056571207451');" style="">  76      public void open(Configuration parameters) throws Exception {                                                 </span>
<span class="8736254984801772910" onmouseenter="enter('8736254984801772910');" onmouseout="out('8736254984801772910');" style="">  77          super.open(parameters);                                                                                   </span>
<span class="-7685679746867905609" onmouseenter="enter('-7685679746867905609');" onmouseout="out('-7685679746867905609');" style="">  78          kuduSideTableInfo = (KuduSideTableInfo) sideInfo.getSideTableInfo();                                      </span>
<span class="-4562633082775627441" onmouseenter="enter('-4562633082775627441');" onmouseout="out('-4562633082775627441');" style="">  79          connKuDu();                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  80      }                                                                                                             </span>
<span  style="">  81                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  82      /**                                                                                                           </span>
<span class="803083353752398343" onmouseenter="enter('803083353752398343');" onmouseout="out('803083353752398343');" style="">  83       * 连接kudu中的表                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  84       *                                                                                                            </span>
<span class="-5432256053392020081" onmouseenter="enter('-5432256053392020081');" onmouseout="out('-5432256053392020081');" style="">  85       * @throws KuduException                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  86       */                                                                                                           </span>
<span class="-5290115760614089350" onmouseenter="enter('-5290115760614089350');" onmouseout="out('-5290115760614089350');" style="">  87      private void connKuDu() throws KuduException {                                                                </span>
<span class="-56179035184578959" onmouseenter="enter('-56179035184578959');" onmouseout="out('-56179035184578959');" style="">  88          if (null == table) {                                                                                      </span>
<span class="4308396336047168888" onmouseenter="enter('4308396336047168888');" onmouseout="out('4308396336047168888');" style="">  89              String kuduMasters = kuduSideTableInfo.getKuduMasters();                                              </span>
<span class="-4444229447990232757" onmouseenter="enter('-4444229447990232757');" onmouseout="out('-4444229447990232757');" style="">  90              String tableName = kuduSideTableInfo.getTableName();                                                  </span>
<span class="4427587995392923155" onmouseenter="enter('4427587995392923155');" onmouseout="out('4427587995392923155');" style="">  91              Integer workerCount = kuduSideTableInfo.getWorkerCount();                                             </span>
<span class="-5299851536099138671" onmouseenter="enter('-5299851536099138671');" onmouseout="out('-5299851536099138671');" style="">  92              Integer defaultSocketReadTimeoutMs = kuduSideTableInfo.getDefaultSocketReadTimeoutMs();               </span>
<span class="-2694307185983387776" onmouseenter="enter('-2694307185983387776');" onmouseout="out('-2694307185983387776');" style="">  93              Integer defaultOperationTimeoutMs = kuduSideTableInfo.getDefaultOperationTimeoutMs();                 </span>
<span  style="">  94                                                                                                                    </span>
<span class="-6052455991030570635" onmouseenter="enter('-6052455991030570635');" onmouseout="out('-6052455991030570635');" style="">  95              Preconditions.checkNotNull(kuduMasters, &quot;kuduMasters could not be null&quot;);                             </span>
<span  style="">  96                                                                                                                    </span>
<span class="-6520194397411128459" onmouseenter="enter('-6520194397411128459');" onmouseout="out('-6520194397411128459');" style=""><abbr title="  97              AsyncKuduClient.AsyncKuduClientBuilder asyncKuduClientBuilder = new AsyncKuduClient.AsyncKuduClientBuilder(kuduMasters);">  97              AsyncKuduClient.AsyncKuduClientBuilder asyncKuduClientBuilder = new AsyncKuduClient.AsyncKuduClientBui🔵</abbr></span>
<span class="-8227759523178082238" onmouseenter="enter('-8227759523178082238');" onmouseout="out('-8227759523178082238');" style="">  98              if (null != workerCount) {                                                                            </span>
<span class="-5467062577113570128" onmouseenter="enter('-5467062577113570128');" onmouseout="out('-5467062577113570128');" style="">  99                  asyncKuduClientBuilder.workerCount(workerCount);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100              }                                                                                                     </span>
<span  style=""> 101                                                                                                                    </span>
<span class="-2397215110746175709" onmouseenter="enter('-2397215110746175709');" onmouseout="out('-2397215110746175709');" style=""> 102              if (null != defaultOperationTimeoutMs) {                                                              </span>
<span class="7366215511831154275" onmouseenter="enter('7366215511831154275');" onmouseout="out('7366215511831154275');" style=""> 103                  asyncKuduClientBuilder.defaultOperationTimeoutMs(defaultOperationTimeoutMs);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104              }                                                                                                     </span>
<span class="2560969904046492964" onmouseenter="enter('2560969904046492964');" onmouseout="out('2560969904046492964');" style=""> 105              asyncClient = asyncKuduClientBuilder.build();                                                         </span>
<span class="441886789095796306" onmouseenter="enter('441886789095796306');" onmouseout="out('441886789095796306');" style=""> 106              if (!asyncClient.syncClient().tableExists(tableName)) {                                               </span>
<span class="4123299035781055923" onmouseenter="enter('4123299035781055923');" onmouseout="out('4123299035781055923');" style=""> 107                  throw new IllegalArgumentException(&quot;Table Open Failed , please check table exists&quot;);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108              }                                                                                                     </span>
<span class="4092827604202793861" onmouseenter="enter('4092827604202793861');" onmouseout="out('4092827604202793861');" style=""> 109              table = asyncClient.syncClient().openTable(tableName);                                                </span>
<span class="4177758485368982030" onmouseenter="enter('4177758485368982030');" onmouseout="out('4177758485368982030');" style=""> 110              LOG.info(&quot;connect kudu is successed!&quot;);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111          }                                                                                                         </span>
<span class="2924668647776163983" onmouseenter="enter('2924668647776163983');" onmouseout="out('2924668647776163983');" style=""> 112          scannerBuilder = asyncClient.newScannerBuilder(table);                                                    </span>
<span class="-4404448253596110496" onmouseenter="enter('-4404448253596110496');" onmouseout="out('-4404448253596110496');" style=""> 113          Integer batchSizeBytes = kuduSideTableInfo.getBatchSizeBytes();                                           </span>
<span class="-7735055932391271380" onmouseenter="enter('-7735055932391271380');" onmouseout="out('-7735055932391271380');" style=""> 114          Long limitNum = kuduSideTableInfo.getLimitNum();                                                          </span>
<span class="1611473127340759637" onmouseenter="enter('1611473127340759637');" onmouseout="out('1611473127340759637');" style=""> 115          Boolean isFaultTolerant = kuduSideTableInfo.getFaultTolerant();                                           </span>
<span class="-8526639943056837274" onmouseenter="enter('-8526639943056837274');" onmouseout="out('-8526639943056837274');" style=""> 116          //查询需要的字段                                                                                                 </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 117          String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                         </span>
<span  style=""> 118                                                                                                                    </span>
<span class="-8080913465496496419" onmouseenter="enter('-8080913465496496419');" onmouseout="out('-8080913465496496419');" style=""> 119          if (null == limitNum || limitNum &lt;= 0) {                                                                  </span>
<span class="7767157001459171317" onmouseenter="enter('7767157001459171317');" onmouseout="out('7767157001459171317');" style=""> 120              scannerBuilder.limit(FETCH_SIZE);                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 121          } else {                                                                                                  </span>
<span class="6087958399625777057" onmouseenter="enter('6087958399625777057');" onmouseout="out('6087958399625777057');" style=""> 122              scannerBuilder.limit(limitNum);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123          }                                                                                                         </span>
<span class="-5740110908714073879" onmouseenter="enter('-5740110908714073879');" onmouseout="out('-5740110908714073879');" style=""> 124          if (null != batchSizeBytes) {                                                                             </span>
<span class="-3929060200025616829" onmouseenter="enter('-3929060200025616829');" onmouseout="out('-3929060200025616829');" style=""> 125              scannerBuilder.batchSizeBytes(batchSizeBytes);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126          }                                                                                                         </span>
<span class="-8680730272034558637" onmouseenter="enter('-8680730272034558637');" onmouseout="out('-8680730272034558637');" style=""> 127          if (null != isFaultTolerant) {                                                                            </span>
<span class="-5364988782144201666" onmouseenter="enter('-5364988782144201666');" onmouseout="out('-5364988782144201666');" style=""> 128              scannerBuilder.setFaultTolerant(isFaultTolerant);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129          }                                                                                                         </span>
<span  style=""> 130                                                                                                                    </span>
<span class="6330664272177173056" onmouseenter="enter('6330664272177173056');" onmouseout="out('6330664272177173056');" style=""> 131          List&lt;String&gt; projectColumns = Arrays.asList(sideFieldNames);                                              </span>
<span class="2684072470806705647" onmouseenter="enter('2684072470806705647');" onmouseout="out('2684072470806705647');" style=""> 132          scannerBuilder.setProjectedColumnNames(projectColumns);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133      }                                                                                                             </span>
<span  style=""> 134                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 135      @Override                                                                                                     </span>
<span class="-3645419592203298662" onmouseenter="enter('-3645419592203298662');" onmouseout="out('-3645419592203298662');" style=""><abbr title=" 136      public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, CRow input, ResultFuture&lt;CRow&gt; resultFuture) throws Exception {"> 136      public void handleAsyncInvoke(Map&lt;String, Object&gt; inputParams, CRow input, ResultFuture&lt;CRow&gt; resultFuture) th🔵</abbr></span>
<span class="1202395436001278606" onmouseenter="enter('1202395436001278606');" onmouseout="out('1202395436001278606');" style=""> 137          CRow inputCopy = new CRow(input.row(), input.change());                                                   </span>


<span class="5065834272723126023" onmouseenter="enter('5065834272723126023');" onmouseout="out('5065834272723126023');" style=""> 138          //scannerBuilder 设置为null重新加载过滤条件,然后connkudu重新赋值                                                           </span>
<span class="2495891823177141345" onmouseenter="enter('2495891823177141345');" onmouseout="out('2495891823177141345');" style=""> 139          //todo:代码需要优化                                                                                             </span>
<span class="3515238287407101771" onmouseenter="enter('3515238287407101771');" onmouseout="out('3515238287407101771');" style=""> 140          scannerBuilder = null;                                                                                    </span>
<span class="-4562633082775627441" onmouseenter="enter('-4562633082775627441');" onmouseout="out('-4562633082775627441');" style=""> 141          connKuDu();                                                                                               </span>
<span class="6789989036272871448" onmouseenter="enter('6789989036272871448');" onmouseout="out('6789989036272871448');" style=""> 142          Schema schema = table.getSchema();                                                                        </span>
<span class="-6874703698410301106" onmouseenter="enter('-6874703698410301106');" onmouseout="out('-6874703698410301106');" style=""> 143          //  @wenbaoup fix bug                                                                                     </span>
<span class="-2762964740504478972" onmouseenter="enter('-2762964740504478972');" onmouseout="out('-2762964740504478972');" style=""> 144          inputParams.entrySet().forEach(e -&gt;{                                                                      </span>
<span class="-44569786791220301" onmouseenter="enter('-44569786791220301');" onmouseout="out('-44569786791220301');" style=""><abbr title=" 145              scannerBuilder.addPredicate(KuduPredicate.newInListPredicate(schema.getColumn(e.getKey()), Collections.singletonList(e.getValue())));"> 145              scannerBuilder.addPredicate(KuduPredicate.newInListPredicate(schema.getColumn(e.getKey()), Collections🔵</abbr></span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style=""> 146          });                                                                                                       </span>
<span  style=""> 147                                                                                                                    </span>
<span class="-5863912479223093982" onmouseenter="enter('-5863912479223093982');" onmouseout="out('-5863912479223093982');" style=""> 148          //  填充谓词信息                                                                                                </span>
<span class="-8839623202504591157" onmouseenter="enter('-8839623202504591157');" onmouseout="out('-8839623202504591157');" style=""> 149          List&lt;PredicateInfo&gt; predicateInfoes = sideInfo.getSideTableInfo().getPredicateInfoes();                   </span>
<span class="1131384255148676390" onmouseenter="enter('1131384255148676390');" onmouseout="out('1131384255148676390');" style=""> 150          if (predicateInfoes.size() &gt; 0) {                                                                         </span>
<span class="7087000648291367893" onmouseenter="enter('7087000648291367893');" onmouseout="out('7087000648291367893');" style=""> 151              predicateInfoes.stream().map(info -&gt; {                                                                </span>
<span class="-3754680470381432050" onmouseenter="enter('-3754680470381432050');" onmouseout="out('-3754680470381432050');" style=""> 152                  KuduPredicate kuduPredicate = KuduUtil.buildKuduPredicate(schema, info);                          </span>
<span class="8493928812165156395" onmouseenter="enter('8493928812165156395');" onmouseout="out('8493928812165156395');" style=""> 153                  if (null != kuduPredicate) {                                                                      </span>
<span class="-8515842596395934222" onmouseenter="enter('-8515842596395934222');" onmouseout="out('-8515842596395934222');" style=""> 154                      scannerBuilder.addPredicate(kuduPredicate);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155                  }                                                                                                 </span>
<span class="-3556780733195614200" onmouseenter="enter('-3556780733195614200');" onmouseout="out('-3556780733195614200');" style=""> 156                  return info;                                                                                      </span>
<span class="3075434854107094892" onmouseenter="enter('3075434854107094892');" onmouseout="out('3075434854107094892');" style=""> 157              }).count();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158          }                                                                                                         </span>
<span  style=""> 159                                                                                                                    </span>
<span class="510800137927766729" onmouseenter="enter('510800137927766729');" onmouseout="out('510800137927766729');" style=""> 160          List&lt;Map&lt;String, Object&gt;&gt; cacheContent = Lists.newArrayList();                                            </span>
<span class="-5519708164731405413" onmouseenter="enter('-5519708164731405413');" onmouseout="out('-5519708164731405413');" style=""> 161          AsyncKuduScanner asyncKuduScanner = scannerBuilder.build();                                               </span>
<span class="-3770803949601695435" onmouseenter="enter('-3770803949601695435');" onmouseout="out('-3770803949601695435');" style=""> 162          List&lt;CRow&gt; rowList = Lists.newArrayList();                                                                </span>

<span class="6180779613695836367" onmouseenter="enter('6180779613695836367');" onmouseout="out('6180779613695836367');" style=""> 163          Deferred&lt;RowResultIterator&gt; data = asyncKuduScanner.nextRows();                                           </span>
<span class="-7087386879750881573" onmouseenter="enter('-7087386879750881573');" onmouseout="out('-7087386879750881573');" style=""> 164          //从之前的同步修改为调用异步的Callback                                                                                  </span>
<span class="278649099550089909" onmouseenter="enter('278649099550089909');" onmouseout="out('278649099550089909');" style=""><abbr title=" 165          data.addCallbackDeferring(new GetListRowCB(inputCopy, cacheContent, rowList, asyncKuduScanner, resultFuture, buildCacheKey(inputParams)));"> 165          data.addCallbackDeferring(new GetListRowCB(inputCopy, cacheContent, rowList, asyncKuduScanner, resultFutur🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166      }                                                                                                             </span>
<span  style=""> 167                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 168      @Override                                                                                                     </span>
<span class="6374398777166986707" onmouseenter="enter('6374398777166986707');" onmouseout="out('6374398777166986707');" style=""> 169      public String buildCacheKey(Map&lt;String, Object&gt; inputParams) {                                                </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 170          StringBuilder sb = new StringBuilder();                                                                   </span>
<span class="-3940662932484837264" onmouseenter="enter('-3940662932484837264');" onmouseout="out('-3940662932484837264');" style=""> 171          for (Object ele : inputParams.values()) {                                                                 </span>
<span class="-9219177986461641503" onmouseenter="enter('-9219177986461641503');" onmouseout="out('-9219177986461641503');" style=""> 172              sb.append(ele.toString())                                                                             </span>
<span class="-7037257933228320495" onmouseenter="enter('-7037257933228320495');" onmouseout="out('-7037257933228320495');" style=""> 173                      .append(&quot;_&quot;);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174          }                                                                                                         </span>
<span  style=""> 175                                                                                                                    </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 176          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177      }                                                                                                             </span>
<span  style=""> 178                                                                                                                    </span>
<span  style=""> 179                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 180      @Override                                                                                                     </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style=""> 181      public Row fillData(Row input, Object sideInput) {                                                            </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style=""> 182          Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                          </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style=""> 183          Row row = new Row(sideInfo.getOutFieldInfoList().size());                                                 </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style=""> 184          for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                         </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style=""> 185              Object obj = input.getField(entry.getValue());                                                        </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style=""><abbr title=" 186              boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 186              boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo🔵</abbr></span>
<span  style=""> 187                                                                                                                    </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style=""><abbr title=" 188              //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 188              //Type information for indicating event or processing time. However, it behaves like a regular SQL tim🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style=""> 189              if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                            </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style=""> 190                  obj = ((Timestamp) obj).getTime();                                                                </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +                //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                                     </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +                obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193              }                                                                                                     </span>

<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style=""> 194              row.setField(entry.getKey(), obj);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195          }                                                                                                         </span>
<span  style=""> 196                                                                                                                    </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style=""> 197          for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {                    </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style=""> 198              if (cacheInfo == null) {                                                                              </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 199                  row.setField(entry.getKey(), null);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 200              } else {                                                                                              </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style=""> 201                  row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203          }                                                                                                         </span>
<span  style=""> 204                                                                                                                    </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 205          return row;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206      }                                                                                                             </span>
<span  style=""> 207                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 208      @Override                                                                                                     </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 209      public void close() throws Exception {                                                                        </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 210          super.close();                                                                                            </span>
<span class="-466861721853404898" onmouseenter="enter('-466861721853404898');" onmouseout="out('-466861721853404898');" style=""> 211          if (null != asyncClient) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 212              try {                                                                                                 </span>
<span class="-2833913701521345427" onmouseenter="enter('-2833913701521345427');" onmouseout="out('-2833913701521345427');" style=""> 213                  asyncClient.close();                                                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 214              } catch (Exception e) {                                                                               </span>
<span class="7169708839653618971" onmouseenter="enter('7169708839653618971');" onmouseout="out('7169708839653618971');" style=""> 215                  LOG.error(&quot;Error while closing client.&quot;, e);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218      }                                                                                                             </span>
<span  style=""> 219                                                                                                                    </span>
<span class="3638800353225348075" onmouseenter="enter('3638800353225348075');" onmouseout="out('3638800353225348075');" style=""> 220      class GetListRowCB implements Callback&lt;Deferred&lt;List&lt;Row&gt;&gt;, RowResultIterator&gt; {                              </span>
<span class="2001251848416688346" onmouseenter="enter('2001251848416688346');" onmouseout="out('2001251848416688346');" style=""> 221          private CRow input;                                                                                       </span>

<span class="-3461178940071231317" onmouseenter="enter('-3461178940071231317');" onmouseout="out('-3461178940071231317');" style=""> 222          private List&lt;Map&lt;String, Object&gt;&gt; cacheContent;                                                           </span>
<span class="-5357459632477081071" onmouseenter="enter('-5357459632477081071');" onmouseout="out('-5357459632477081071');" style=""> 223          private List&lt;CRow&gt; rowList;                                                                               </span>

<span class="5723031173307092846" onmouseenter="enter('5723031173307092846');" onmouseout="out('5723031173307092846');" style=""> 224          private AsyncKuduScanner asyncKuduScanner;                                                                </span>
<span class="5555801037685047910" onmouseenter="enter('5555801037685047910');" onmouseout="out('5555801037685047910');" style=""> 225          private ResultFuture&lt;CRow&gt; resultFuture;                                                                  </span>

<span class="-1449703644783381384" onmouseenter="enter('-1449703644783381384');" onmouseout="out('-1449703644783381384');" style=""> 226          private String key;                                                                                       </span>
<span  style=""> 227                                                                                                                    </span>
<span  style=""> 228                                                                                                                    </span>
<span class="1613753735602313740" onmouseenter="enter('1613753735602313740');" onmouseout="out('1613753735602313740');" style=""> 229          public GetListRowCB() {                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230          }                                                                                                         </span>
<span  style=""> 231                                                                                                                    </span>
<span class="-1210642425124689079" onmouseenter="enter('-1210642425124689079');" onmouseout="out('-1210642425124689079');" style=""><abbr title=" 232          GetListRowCB(CRow input, List&lt;Map&lt;String, Object&gt;&gt; cacheContent, List&lt;CRow&gt; rowList, AsyncKuduScanner asyncKuduScanner, ResultFuture&lt;CRow&gt; resultFuture, String key) {"> 232          GetListRowCB(CRow input, List&lt;Map&lt;String, Object&gt;&gt; cacheContent, List&lt;CRow&gt; rowList, AsyncKuduScanner asyn🔵</abbr></span>


<span class="8214429602983504200" onmouseenter="enter('8214429602983504200');" onmouseout="out('8214429602983504200');" style=""> 233              this.input = input;                                                                                   </span>
<span class="-7432664925500830597" onmouseenter="enter('-7432664925500830597');" onmouseout="out('-7432664925500830597');" style=""> 234              this.cacheContent = cacheContent;                                                                     </span>
<span class="5762471889889938429" onmouseenter="enter('5762471889889938429');" onmouseout="out('5762471889889938429');" style=""> 235              this.rowList = rowList;                                                                               </span>
<span class="4954020228022176436" onmouseenter="enter('4954020228022176436');" onmouseout="out('4954020228022176436');" style=""> 236              this.asyncKuduScanner = asyncKuduScanner;                                                             </span>
<span class="592225705701792215" onmouseenter="enter('592225705701792215');" onmouseout="out('592225705701792215');" style=""> 237              this.resultFuture = resultFuture;                                                                     </span>
<span class="5062295098979135982" onmouseenter="enter('5062295098979135982');" onmouseout="out('5062295098979135982');" style=""> 238              this.key = key;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239          }                                                                                                         </span>
<span  style=""> 240                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 241          @Override                                                                                                 </span>
<span class="8767874272678853351" onmouseenter="enter('8767874272678853351');" onmouseout="out('8767874272678853351');" style=""> 242          public Deferred&lt;List&lt;Row&gt;&gt; call(RowResultIterator results) throws Exception {                             </span>
<span class="-8941030450012249491" onmouseenter="enter('-8941030450012249491');" onmouseout="out('-8941030450012249491');" style=""> 243              for (RowResult result : results) {                                                                    </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 244                  Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                                   </span>
<span class="4786776012437782338" onmouseenter="enter('4786776012437782338');" onmouseout="out('4786776012437782338');" style=""> 245                  for (String sideFieldName1 : StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;)) {            </span>
<span class="5422300911827801712" onmouseenter="enter('5422300911827801712');" onmouseout="out('5422300911827801712');" style=""> 246                      String sideFieldName = sideFieldName1.trim();                                                 </span>
<span class="-7396994512053753949" onmouseenter="enter('-7396994512053753949');" onmouseout="out('-7396994512053753949');" style=""> 247                      ColumnSchema columnSchema = table.getSchema().getColumn(sideFieldName);                       </span>
<span class="-1551001954350423389" onmouseenter="enter('-1551001954350423389');" onmouseout="out('-1551001954350423389');" style=""> 248                      if (null != columnSchema) {                                                                   </span>
<span class="-9080618923968214410" onmouseenter="enter('-9080618923968214410');" onmouseout="out('-9080618923968214410');" style=""> 249                          KuduUtil.setMapValue(columnSchema.getType(), oneRow, sideFieldName, result);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251                  }                                                                                                 </span>
<span class="-209789566031535321" onmouseenter="enter('-209789566031535321');" onmouseout="out('-209789566031535321');" style=""> 252                  Row row = fillData(input.row(), oneRow);                                                          </span>

<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 253                  if (openCache()) {                                                                                </span>
<span class="1888587301705190474" onmouseenter="enter('1888587301705190474');" onmouseout="out('1888587301705190474');" style=""> 254                      cacheContent.add(oneRow);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255                  }                                                                                                 </span>
<span class="5232888746699619450" onmouseenter="enter('5232888746699619450');" onmouseout="out('5232888746699619450');" style=""> 256                  rowList.add(new CRow(row, input.change()));                                                       </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257              }                                                                                                     </span>
<span class="-5880917173204222408" onmouseenter="enter('-5880917173204222408');" onmouseout="out('-5880917173204222408');" style=""> 258              if (asyncKuduScanner.hasMoreRows()) {                                                                 </span>
<span class="411290205859931493" onmouseenter="enter('411290205859931493');" onmouseout="out('411290205859931493');" style=""> 259                  return asyncKuduScanner.nextRows().addCallbackDeferring(this);                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260              }                                                                                                     </span>
<span  style=""> 261                                                                                                                    </span>
<span class="-5182000486454444757" onmouseenter="enter('-5182000486454444757');" onmouseout="out('-5182000486454444757');" style=""> 262              if (rowList.size() &gt; 0) {                                                                             </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 263                  if (openCache()) {                                                                                </span>
<span class="-1330765095474862231" onmouseenter="enter('-1330765095474862231');" onmouseout="out('-1330765095474862231');" style=""> 264                      putCache(key, CacheObj.buildCacheObj(ECacheContentType.MultiLine, cacheContent));             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265                  }                                                                                                 </span>
<span class="510192174520611392" onmouseenter="enter('510192174520611392');" onmouseout="out('510192174520611392');" style=""> 266                  resultFuture.complete(rowList);                                                                   </span>

<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 267              } else {                                                                                              </span>
<span class="-5083140435457393877" onmouseenter="enter('-5083140435457393877');" onmouseout="out('-5083140435457393877');" style=""> 268                  dealMissKey(input, resultFuture);                                                                 </span>
<span class="-4036333604028613811" onmouseenter="enter('-4036333604028613811');" onmouseout="out('-4036333604028613811');" style=""> 269                  if (openCache()) {                                                                                </span>
<span class="-7075096462798044408" onmouseenter="enter('-7075096462798044408');" onmouseout="out('-7075096462798044408');" style=""> 270                      //放置在putCache的Miss中 一段时间内同一个key都会直接返回                                                         </span>
<span class="-5736723344410400278" onmouseenter="enter('-5736723344410400278');" onmouseout="out('-5736723344410400278');" style=""> 271                      putCache(key, CacheMissVal.getMissKeyObj());                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273              }                                                                                                     </span>
<span  style=""> 274                                                                                                                    </span>
<span class="-3732568077477539923" onmouseenter="enter('-3732568077477539923');" onmouseout="out('-3732568077477539923');" style=""> 275              return null;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277      }                                                                                                             </span>
<span  style=""> 278                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            