<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>175</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    175
                    <a href="174.html">prev</a>
                    <a href="176.html">next</a>
                    <a href="175_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_b2742e6260e4e7d992c82e42c7d3b352419d17bb_core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/checkout/service/CheckoutServiceImpl.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;b2742e6260e4e7d992c82e42c7d3b352419d17bb:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/checkout/service/CheckoutServiceImpl.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;b2742e6260e4e7d992c82e42c7d3b352419d17bb^1:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/checkout/service/CheckoutServiceImpl.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;b2742e6260e4e7d992c82e42c7d3b352419d17bb^2:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/checkout/service/CheckoutServiceImpl.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;0e1bf7b54bdd251cdbd1077c4e8dc9aae3c8dc95:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/checkout/service/CheckoutServiceImpl.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b], [j], [j], [j], [j]], subset: [[bj], [bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2837200662160373495" onmouseenter="enter('2837200662160373495');" onmouseout="out('2837200662160373495');" style="">  18 package org.broadleafcommerce.core.checkout.service;                                                     </span>
<span  style="">  19                                                                                                          </span>
<span class="6519729880675887369" onmouseenter="enter('6519729880675887369');" onmouseout="out('6519729880675887369');" style="">  20 import org.broadleafcommerce.common.event.BroadleafApplicationEventPublisher;                            </span>
<span class="-9091558695437765808" onmouseenter="enter('-9091558695437765808');" onmouseout="out('-9091558695437765808');" style="">  21 import org.broadleafcommerce.common.event.OrderSubmittedEvent;                                           </span>
<span class="6522313194277917605" onmouseenter="enter('6522313194277917605');" onmouseout="out('6522313194277917605');" style="">  22 import org.broadleafcommerce.core.checkout.service.exception.CheckoutException;                          </span>
<span class="1643403549897197838" onmouseenter="enter('1643403549897197838');" onmouseout="out('1643403549897197838');" style="">  23 import org.broadleafcommerce.core.checkout.service.workflow.CheckoutResponse;                            </span>
<span class="7544921825722489220" onmouseenter="enter('7544921825722489220');" onmouseout="out('7544921825722489220');" style="">  24 import org.broadleafcommerce.core.checkout.service.workflow.CheckoutSeed;                                </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  25 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  26 import org.broadleafcommerce.core.order.service.OrderService;                                            </span>
<span class="-5209046066651310391" onmouseenter="enter('-5209046066651310391');" onmouseout="out('-5209046066651310391');" style="">  27 import org.broadleafcommerce.core.order.service.exception.RequiredAttributeNotProvidedException;         </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  28 import org.broadleafcommerce.core.order.service.type.OrderStatus;                                        </span>
<span class="-1629731899052688234" onmouseenter="enter('-1629731899052688234');" onmouseout="out('-1629731899052688234');" style="">  29 import org.broadleafcommerce.core.pricing.service.exception.PricingException;                            </span>
<span class="3294319710024405078" onmouseenter="enter('3294319710024405078');" onmouseout="out('3294319710024405078');" style="">  30 import org.broadleafcommerce.core.workflow.ActivityMessages;                                             </span>
<span class="-8060007382563500117" onmouseenter="enter('-8060007382563500117');" onmouseout="out('-8060007382563500117');" style="">  31 import org.broadleafcommerce.core.workflow.ProcessContext;                                               </span>
<span class="-3962095904812897416" onmouseenter="enter('-3962095904812897416');" onmouseout="out('-3962095904812897416');" style="">  32 import org.broadleafcommerce.core.workflow.Processor;                                                    </span>
<span class="2917073962618941638" onmouseenter="enter('2917073962618941638');" onmouseout="out('2917073962618941638');" style="">  33 import org.broadleafcommerce.core.workflow.WorkflowException;                                            </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  34 import org.springframework.beans.factory.annotation.Autowired;                                           </span>
<span class="-4664978283136443479" onmouseenter="enter('-4664978283136443479');" onmouseout="out('-4664978283136443479');" style="">  35 import org.springframework.beans.factory.annotation.Qualifier;                                           </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  36 import org.springframework.stereotype.Service;                                                           </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  37 import java.util.HashMap;                                                                                </span>
<span class="8600016768069240092" onmouseenter="enter('8600016768069240092');" onmouseout="out('8600016768069240092');" style="">  38 import java.util.concurrent.ConcurrentHashMap;                                                           </span>
<span class="-8712007787466626518" onmouseenter="enter('-8712007787466626518');" onmouseout="out('-8712007787466626518');" style="">  39 import java.util.concurrent.ConcurrentMap;                                                               </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  40 import javax.annotation.Resource;                                                                        </span>
<span  style="">  41                                                                                                          </span>
<span class="-2096539983704526716" onmouseenter="enter('-2096539983704526716');" onmouseout="out('-2096539983704526716');" style="">  42 @Service(&quot;blCheckoutService&quot;)                                                                            </span>
<span class="1999503991265051531" onmouseenter="enter('1999503991265051531');" onmouseout="out('1999503991265051531');" style="">  43 public class CheckoutServiceImpl implements CheckoutService {                                            </span>
<span  style="">  44                                                                                                          </span>
<span class="8946174698814933187" onmouseenter="enter('8946174698814933187');" onmouseout="out('8946174698814933187');" style="">  45     @Resource(name=&quot;blCheckoutWorkflow&quot;)                                                                 </span>
<span class="-1903451900676189110" onmouseenter="enter('-1903451900676189110');" onmouseout="out('-1903451900676189110');" style="">  46     protected Processor&lt;CheckoutSeed, CheckoutSeed&gt; checkoutWorkflow;                                    </span>
<span  style="">  47                                                                                                          </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="">  48     @Autowired                                                                                           </span>
<span class="-7224044524343370301" onmouseenter="enter('-7224044524343370301');" onmouseout="out('-7224044524343370301');" style="">  49     @Qualifier(&quot;blApplicationEventPublisher&quot;)                                                            </span>
<span class="-5629661248749562711" onmouseenter="enter('-5629661248749562711');" onmouseout="out('-5629661248749562711');" style="">  50     protected BroadleafApplicationEventPublisher eventPublisher;                                         </span>
<span  style="">  51                                                                                                          </span>
<span class="4923990489900261754" onmouseenter="enter('4923990489900261754');" onmouseout="out('4923990489900261754');" style="">  52     @Resource(name=&quot;blOrderService&quot;)                                                                     </span>
<span class="4242410752290390693" onmouseenter="enter('4242410752290390693');" onmouseout="out('4242410752290390693');" style="">  53     protected OrderService orderService;                                                                 </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  54 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  55 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57     /**                                                                                                  </span>
<span class="2655193152803379355" onmouseenter="enter('2655193152803379355');" onmouseout="out('2655193152803379355');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  58      * Map of locks for given order ids. This lock map ensures that only a single request can handle a particular order">  58      * Map of locks for given order ids. This lock map ensures that only a single request can handle a paðŸ”µ</abbr></span>
<span class="6090453435388357874" onmouseenter="enter('6090453435388357874');" onmouseout="out('6090453435388357874');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59      * at a time                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60      */                                                                                                  </span>
<span class="-244605010045706570" onmouseenter="enter('-244605010045706570');" onmouseout="out('-244605010045706570');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61     protected static ConcurrentMap&lt;Long, Object&gt; lockMap = new ConcurrentHashMap&lt;&gt;();                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  62 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64     /**                                                                                                  </span>
<span class="-8852247884129261371" onmouseenter="enter('-8852247884129261371');" onmouseout="out('-8852247884129261371');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65      * @deprecated no longer supported - simplifying interface                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67     @Deprecated                                                                                          </span>
<span class="-244605010045706570" onmouseenter="enter('-244605010045706570');" onmouseout="out('-244605010045706570');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68     protected static ConcurrentMap&lt;Long, Object&gt; lockMap = new ConcurrentHashMap&lt;&gt;();                    </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  69 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style="">  70                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  71     @Override                                                                                            </span>
<span class="-6205942273611381609" onmouseenter="enter('-6205942273611381609');" onmouseout="out('-6205942273611381609');" style="">  72     public CheckoutResponse performCheckout(Order order) throws CheckoutException {                      </span>
<span class="-7631213923363427044" onmouseenter="enter('-7631213923363427044');" onmouseout="out('-7631213923363427044');" style="">  73         // Immediately fail if this order has already been checked out previously                        </span>
<span class="-8468900189698035586" onmouseenter="enter('-8468900189698035586');" onmouseout="out('-8468900189698035586');" style="">  74         if (hasOrderBeenCompleted(order)) {                                                              </span>
<span class="2023447600086359039" onmouseenter="enter('2023447600086359039');" onmouseout="out('2023447600086359039');" style=""><abbr title="  75             throw new CheckoutException(&quot;This order has already been submitted or cancelled, unable to checkout order -- id: &quot; + order.getId(), new CheckoutSeed(order, new HashMap&lt;String, Object&gt;()));">  75             throw new CheckoutException(&quot;This order has already been submitted or cancelled, unable to chðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76         }                                                                                                </span>
<span  style="">  77                                                                                                          </span>
<span class="1137122659916554565" onmouseenter="enter('1137122659916554565');" onmouseout="out('1137122659916554565');" style="">  78         CheckoutSeed seed = null;                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  79         try {                                                                                            </span>
<span class="-1641300208118656595" onmouseenter="enter('-1641300208118656595');" onmouseout="out('-1641300208118656595');" style="">  80             // Do a final save of the order before going through with the checkout workflow              </span>
<span class="6494558446725059340" onmouseenter="enter('6494558446725059340');" onmouseout="out('6494558446725059340');" style="">  81             order = orderService.save(order, false);                                                     </span>
<span class="-2934620883649106718" onmouseenter="enter('-2934620883649106718');" onmouseout="out('-2934620883649106718');" style="">  82             seed = new CheckoutSeed(order, new HashMap&lt;&gt;());                                             </span>
<span  style="">  83                                                                                                          </span>
<span class="7383087180359490305" onmouseenter="enter('7383087180359490305');" onmouseout="out('7383087180359490305');" style="">  84             ProcessContext&lt;CheckoutSeed&gt; context = checkoutWorkflow.doActivities(seed);                  </span>
<span  style="">  85                                                                                                          </span>
<span class="-4673077056432893236" onmouseenter="enter('-4673077056432893236');" onmouseout="out('-4673077056432893236');" style=""><abbr title="  86             // We need to pull the order off the seed and save it here in case any activity modified the order.">  86             // We need to pull the order off the seed and save it here in case any activity modified the ðŸ”µ</abbr></span>
<span class="2617366754045918309" onmouseenter="enter('2617366754045918309');" onmouseout="out('2617366754045918309');" style="">  87             order = orderService.save(seed.getOrder(), false);                                           </span>
<span class="-1009658261722038540" onmouseenter="enter('-1009658261722038540');" onmouseout="out('-1009658261722038540');" style="">  88             order.getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());         </span>
<span class="-243734768973433623" onmouseenter="enter('-243734768973433623');" onmouseout="out('-243734768973433623');" style="">  89             seed.setOrder(order);                                                                        </span>
<span  style="">  90                                                                                                          </span>
<span class="-4086298984117942412" onmouseenter="enter('-4086298984117942412');" onmouseout="out('-4086298984117942412');" style=""><abbr title="  91             OrderSubmittedEvent event = new OrderSubmittedEvent(this, seed.getOrder().getId(), seed.getOrder().getOrderNumber());">  91             OrderSubmittedEvent event = new OrderSubmittedEvent(this, seed.getOrder().getId(), seed.getOrðŸ”µ</abbr></span>
<span class="-5031346483494114887" onmouseenter="enter('-5031346483494114887');" onmouseout="out('-5031346483494114887');" style="">  92             eventPublisher.publishEvent(event);                                                          </span>
<span  style="">  93                                                                                                          </span>
<span class="-4962567525074277725" onmouseenter="enter('-4962567525074277725');" onmouseout="out('-4962567525074277725');" style="">  94             return seed;                                                                                 </span>
<span class="8325775691603685335" onmouseenter="enter('8325775691603685335');" onmouseout="out('8325775691603685335');" style="">  95         } catch (PricingException e) {                                                                   </span>
<span class="7492159716890660353" onmouseenter="enter('7492159716890660353');" onmouseout="out('7492159716890660353');" style="">  96             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e, seed);    </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style="">  97         } catch (WorkflowException e) {                                                                  </span>
<span class="4510003336402340271" onmouseenter="enter('4510003336402340271');" onmouseout="out('4510003336402340271');" style=""><abbr title="  98             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getRootCause(), seed);">  98             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getRootCausðŸ”µ</abbr></span>
<span class="-3309265739981452342" onmouseenter="enter('-3309265739981452342');" onmouseout="out('-3309265739981452342');" style="">  99         } catch (RequiredAttributeNotProvidedException e) {                                              </span>
<span class="5802058541684837280" onmouseenter="enter('5802058541684837280');" onmouseout="out('5802058541684837280');" style=""><abbr title=" 100             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getCause(), seed);"> 100             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getCause(),ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102     }                                                                                                    </span>
<span  style=""> 103                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 104     /**                                                                                                  </span>
<span class="-8117112094151685875" onmouseenter="enter('-8117112094151685875');" onmouseout="out('-8117112094151685875');" style=""> 105      * Checks if the &lt;b&gt;order&lt;/b&gt; has already been gone through the checkout workflow.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 106      *                                                                                                   </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 107      * @param order                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 108      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 109      */                                                                                                  </span>
<span class="-5515852034666982207" onmouseenter="enter('-5515852034666982207');" onmouseout="out('-5515852034666982207');" style=""> 110     protected boolean hasOrderBeenCompleted(Order order) {                                               </span>
<span class="2926809942071606155" onmouseenter="enter('2926809942071606155');" onmouseout="out('2926809942071606155');" style=""><abbr title=" 111         return (OrderStatus.SUBMITTED.equals(order.getStatus()) || OrderStatus.CANCELLED.equals(order.getStatus()));"> 111         return (OrderStatus.SUBMITTED.equals(order.getStatus()) || OrderStatus.CANCELLED.equals(order.getðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112     }                                                                                                    </span>
<span  style=""> 113                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 114 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 115 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-918631296561360088" onmouseenter="enter('-918631296561360088');" onmouseout="out('-918631296561360088');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116             // The order has completed processing, remove the order from the processing map              </span>
<span class="1372486891811636578" onmouseenter="enter('1372486891811636578');" onmouseout="out('1372486891811636578');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117             removeLock(order.getId());                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121     /**                                                                                                  </span>
<span class="-8117112094151685875" onmouseenter="enter('-8117112094151685875');" onmouseout="out('-8117112094151685875');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122      * Checks if the &lt;b&gt;order&lt;/b&gt; has already been gone through the checkout workflow.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123      *                                                                                                   </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124      * @param order                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126      */                                                                                                  </span>
<span class="-5515852034666982207" onmouseenter="enter('-5515852034666982207');" onmouseout="out('-5515852034666982207');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127     protected boolean hasOrderBeenCompleted(Order order) {                                               </span>
<span class="2926809942071606155" onmouseenter="enter('2926809942071606155');" onmouseout="out('2926809942071606155');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 128         return (OrderStatus.SUBMITTED.equals(order.getStatus()) || OrderStatus.CANCELLED.equals(order.getStatus()));"> 128         return (OrderStatus.SUBMITTED.equals(order.getStatus()) || OrderStatus.CANCELLED.equals(order.getðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131     /**                                                                                                  </span>
<span class="-5372345371946067385" onmouseenter="enter('-5372345371946067385');" onmouseout="out('-5372345371946067385');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132     * Get an object to lock on for the given order id                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133     *                                                                                                    </span>
<span class="5792031585211722007" onmouseenter="enter('5792031585211722007');" onmouseout="out('5792031585211722007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134     * @param orderId                                                                                     </span>
<span class="-3624008020148253684" onmouseenter="enter('-3624008020148253684');" onmouseout="out('-3624008020148253684');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 135     * @return null if there was not already a lock object available. If an object was already in the map, this will return"> 135     * @return null if there was not already a lock object available. If an object was already in the map,ðŸ”µ</abbr></span>
<span class="8251882172424081133" onmouseenter="enter('8251882172424081133');" onmouseout="out('8251882172424081133');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 136     * that object, which means that there is already a thread attempting to go through the checkout workflow"> 136     * that object, which means that there is already a thread attempting to go through the checkout workfðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137     */                                                                                                   </span>
<span class="-1013140991726993136" onmouseenter="enter('-1013140991726993136');" onmouseout="out('-1013140991726993136');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138     protected Object putLock(Long orderId) {                                                             </span>
<span class="-7460032303013323591" onmouseenter="enter('-7460032303013323591');" onmouseout="out('-7460032303013323591');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139         return lockMap.putIfAbsent(orderId, new Object());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142     /**                                                                                                  </span>
<span class="-4636268065863031943" onmouseenter="enter('-4636268065863031943');" onmouseout="out('-4636268065863031943');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143      * Done with processing the given orderId, remove the lock from the map                              </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 144 =======                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145     /**                                                                                                  </span>
<span class="-8852247884129261371" onmouseenter="enter('-8852247884129261371');" onmouseout="out('-8852247884129261371');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146      * @deprecated no longer supported - simplifying interface                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148     @Deprecated                                                                                          </span>
<span class="-1013140991726993136" onmouseenter="enter('-1013140991726993136');" onmouseout="out('-1013140991726993136');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149     protected Object putLock(Long orderId) {                                                             </span>
<span class="-7460032303013323591" onmouseenter="enter('-7460032303013323591');" onmouseout="out('-7460032303013323591');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150         return lockMap.putIfAbsent(orderId, new Object());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153     /**                                                                                                  </span>
<span class="-8852247884129261371" onmouseenter="enter('-8852247884129261371');" onmouseout="out('-8852247884129261371');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154      * @deprecated no longer supported - simplifying interface                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155      */                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156     @Deprecated                                                                                          </span>
<span class="-8588872842896633602" onmouseenter="enter('-8588872842896633602');" onmouseout="out('-8588872842896633602');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157     protected void removeLock(Long orderId) {                                                            </span>
<span class="-2960538426035023873" onmouseenter="enter('-2960538426035023873');" onmouseout="out('-2960538426035023873');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158         lockMap.remove(orderId);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160                                                                                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 161 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162 }                                                                                                        </span>




















</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2837200662160373495" onmouseenter="enter('2837200662160373495');" onmouseout="out('2837200662160373495');" style="">  18 package org.broadleafcommerce.core.checkout.service;                                                     </span>
<span  style="">  19                                                                                                          </span>
<span class="6519729880675887369" onmouseenter="enter('6519729880675887369');" onmouseout="out('6519729880675887369');" style="">  20 import org.broadleafcommerce.common.event.BroadleafApplicationEventPublisher;                            </span>
<span class="-9091558695437765808" onmouseenter="enter('-9091558695437765808');" onmouseout="out('-9091558695437765808');" style="">  21 import org.broadleafcommerce.common.event.OrderSubmittedEvent;                                           </span>
<span class="6522313194277917605" onmouseenter="enter('6522313194277917605');" onmouseout="out('6522313194277917605');" style="">  22 import org.broadleafcommerce.core.checkout.service.exception.CheckoutException;                          </span>
<span class="1643403549897197838" onmouseenter="enter('1643403549897197838');" onmouseout="out('1643403549897197838');" style="">  23 import org.broadleafcommerce.core.checkout.service.workflow.CheckoutResponse;                            </span>
<span class="7544921825722489220" onmouseenter="enter('7544921825722489220');" onmouseout="out('7544921825722489220');" style="">  24 import org.broadleafcommerce.core.checkout.service.workflow.CheckoutSeed;                                </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  25 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  26 import org.broadleafcommerce.core.order.service.OrderService;                                            </span>
<span class="-5209046066651310391" onmouseenter="enter('-5209046066651310391');" onmouseout="out('-5209046066651310391');" style="">  27 import org.broadleafcommerce.core.order.service.exception.RequiredAttributeNotProvidedException;         </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  28 import org.broadleafcommerce.core.order.service.type.OrderStatus;                                        </span>
<span class="-1629731899052688234" onmouseenter="enter('-1629731899052688234');" onmouseout="out('-1629731899052688234');" style="">  29 import org.broadleafcommerce.core.pricing.service.exception.PricingException;                            </span>
<span class="3294319710024405078" onmouseenter="enter('3294319710024405078');" onmouseout="out('3294319710024405078');" style="">  30 import org.broadleafcommerce.core.workflow.ActivityMessages;                                             </span>
<span class="-8060007382563500117" onmouseenter="enter('-8060007382563500117');" onmouseout="out('-8060007382563500117');" style="">  31 import org.broadleafcommerce.core.workflow.ProcessContext;                                               </span>
<span class="-3962095904812897416" onmouseenter="enter('-3962095904812897416');" onmouseout="out('-3962095904812897416');" style="">  32 import org.broadleafcommerce.core.workflow.Processor;                                                    </span>
<span class="2917073962618941638" onmouseenter="enter('2917073962618941638');" onmouseout="out('2917073962618941638');" style="">  33 import org.broadleafcommerce.core.workflow.WorkflowException;                                            </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  34 import org.springframework.beans.factory.annotation.Autowired;                                           </span>
<span class="-4664978283136443479" onmouseenter="enter('-4664978283136443479');" onmouseout="out('-4664978283136443479');" style="">  35 import org.springframework.beans.factory.annotation.Qualifier;                                           </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  36 import org.springframework.stereotype.Service;                                                           </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  37 import java.util.HashMap;                                                                                </span>
<span class="8600016768069240092" onmouseenter="enter('8600016768069240092');" onmouseout="out('8600016768069240092');" style="">  38 import java.util.concurrent.ConcurrentHashMap;                                                           </span>
<span class="-8712007787466626518" onmouseenter="enter('-8712007787466626518');" onmouseout="out('-8712007787466626518');" style="">  39 import java.util.concurrent.ConcurrentMap;                                                               </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  40 import javax.annotation.Resource;                                                                        </span>
<span  style="">  41                                                                                                          </span>
<span class="-2096539983704526716" onmouseenter="enter('-2096539983704526716');" onmouseout="out('-2096539983704526716');" style="">  42 @Service(&quot;blCheckoutService&quot;)                                                                            </span>
<span class="1999503991265051531" onmouseenter="enter('1999503991265051531');" onmouseout="out('1999503991265051531');" style="">  43 public class CheckoutServiceImpl implements CheckoutService {                                            </span>
<span  style="">  44                                                                                                          </span>
<span class="8946174698814933187" onmouseenter="enter('8946174698814933187');" onmouseout="out('8946174698814933187');" style="">  45     @Resource(name=&quot;blCheckoutWorkflow&quot;)                                                                 </span>
<span class="-1903451900676189110" onmouseenter="enter('-1903451900676189110');" onmouseout="out('-1903451900676189110');" style="">  46     protected Processor&lt;CheckoutSeed, CheckoutSeed&gt; checkoutWorkflow;                                    </span>
<span  style="">  47                                                                                                          </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="">  48     @Autowired                                                                                           </span>
<span class="-7224044524343370301" onmouseenter="enter('-7224044524343370301');" onmouseout="out('-7224044524343370301');" style="">  49     @Qualifier(&quot;blApplicationEventPublisher&quot;)                                                            </span>
<span class="-5629661248749562711" onmouseenter="enter('-5629661248749562711');" onmouseout="out('-5629661248749562711');" style="">  50     protected BroadleafApplicationEventPublisher eventPublisher;                                         </span>
<span  style="">  51                                                                                                          </span>
<span class="4923990489900261754" onmouseenter="enter('4923990489900261754');" onmouseout="out('4923990489900261754');" style="">  52     @Resource(name=&quot;blOrderService&quot;)                                                                     </span>
<span class="4242410752290390693" onmouseenter="enter('4242410752290390693');" onmouseout="out('4242410752290390693');" style="">  53     protected OrderService orderService;                                                                 </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  54 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  55 ||||||| BASE                                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58     /**                                                                                                  </span>
<span class="2655193152803379355" onmouseenter="enter('2655193152803379355');" onmouseout="out('2655193152803379355');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  59      * Map of locks for given order ids. This lock map ensures that only a single request can handle a particular order">  59      * Map of locks for given order ids. This lock map ensures that only a single request can handle a paðŸ”µ</abbr></span>
<span class="6090453435388357874" onmouseenter="enter('6090453435388357874');" onmouseout="out('6090453435388357874');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60      * at a time                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61      */                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  63 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66     /**                                                                                                  </span>
<span class="-8852247884129261371" onmouseenter="enter('-8852247884129261371');" onmouseout="out('-8852247884129261371');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67      * @deprecated no longer supported - simplifying interface                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68      */                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69                                                                                                          </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style="">  70 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  71 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  72 ||||||| BASE                                                                                             </span>
<span class="-244605010045706570" onmouseenter="enter('-244605010045706570');" onmouseout="out('-244605010045706570');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73 protected static ConcurrentMap&lt;Long, Object&gt; lockMap = new ConcurrentHashMap&lt;&gt;();                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  74 =======                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75 @Deprecated                                                                                              </span>
<span class="-244605010045706570" onmouseenter="enter('-244605010045706570');" onmouseout="out('-244605010045706570');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76     protected static ConcurrentMap&lt;Long, Object&gt; lockMap = new ConcurrentHashMap&lt;&gt;();                    </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style="">  77 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style="">  78                                                                                                          </span>
<span  style="">  79                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  80     @Override                                                                                            </span>
<span class="-6205942273611381609" onmouseenter="enter('-6205942273611381609');" onmouseout="out('-6205942273611381609');" style="">  81     public CheckoutResponse performCheckout(Order order) throws CheckoutException {                      </span>
<span class="-7631213923363427044" onmouseenter="enter('-7631213923363427044');" onmouseout="out('-7631213923363427044');" style="">  82         // Immediately fail if this order has already been checked out previously                        </span>
<span class="-8468900189698035586" onmouseenter="enter('-8468900189698035586');" onmouseout="out('-8468900189698035586');" style="">  83         if (hasOrderBeenCompleted(order)) {                                                              </span>
<span class="2023447600086359039" onmouseenter="enter('2023447600086359039');" onmouseout="out('2023447600086359039');" style=""><abbr title="  84             throw new CheckoutException(&quot;This order has already been submitted or cancelled, unable to checkout order -- id: &quot; + order.getId(), new CheckoutSeed(order, new HashMap&lt;String, Object&gt;()));">  84             throw new CheckoutException(&quot;This order has already been submitted or cancelled, unable to chðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85         }                                                                                                </span>
<span  style="">  86                                                                                                          </span>
<span class="1137122659916554565" onmouseenter="enter('1137122659916554565');" onmouseout="out('1137122659916554565');" style="">  87         CheckoutSeed seed = null;                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  88         try {                                                                                            </span>
<span class="-1641300208118656595" onmouseenter="enter('-1641300208118656595');" onmouseout="out('-1641300208118656595');" style="">  89             // Do a final save of the order before going through with the checkout workflow              </span>
<span class="6494558446725059340" onmouseenter="enter('6494558446725059340');" onmouseout="out('6494558446725059340');" style="">  90             order = orderService.save(order, false);                                                     </span>
<span class="-2934620883649106718" onmouseenter="enter('-2934620883649106718');" onmouseout="out('-2934620883649106718');" style="">  91             seed = new CheckoutSeed(order, new HashMap&lt;&gt;());                                             </span>
<span  style="">  92                                                                                                          </span>
<span class="7383087180359490305" onmouseenter="enter('7383087180359490305');" onmouseout="out('7383087180359490305');" style="">  93             ProcessContext&lt;CheckoutSeed&gt; context = checkoutWorkflow.doActivities(seed);                  </span>
<span  style="">  94                                                                                                          </span>
<span class="-4673077056432893236" onmouseenter="enter('-4673077056432893236');" onmouseout="out('-4673077056432893236');" style=""><abbr title="  95             // We need to pull the order off the seed and save it here in case any activity modified the order.">  95             // We need to pull the order off the seed and save it here in case any activity modified the ðŸ”µ</abbr></span>
<span class="2617366754045918309" onmouseenter="enter('2617366754045918309');" onmouseout="out('2617366754045918309');" style="">  96             order = orderService.save(seed.getOrder(), false);                                           </span>
<span class="-1009658261722038540" onmouseenter="enter('-1009658261722038540');" onmouseout="out('-1009658261722038540');" style="">  97             order.getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());         </span>
<span class="-243734768973433623" onmouseenter="enter('-243734768973433623');" onmouseout="out('-243734768973433623');" style="">  98             seed.setOrder(order);                                                                        </span>
<span  style="">  99                                                                                                          </span>
<span class="-4086298984117942412" onmouseenter="enter('-4086298984117942412');" onmouseout="out('-4086298984117942412');" style=""><abbr title=" 100             OrderSubmittedEvent event = new OrderSubmittedEvent(this, seed.getOrder().getId(), seed.getOrder().getOrderNumber());"> 100             OrderSubmittedEvent event = new OrderSubmittedEvent(this, seed.getOrder().getId(), seed.getOrðŸ”µ</abbr></span>
<span class="-5031346483494114887" onmouseenter="enter('-5031346483494114887');" onmouseout="out('-5031346483494114887');" style=""> 101             eventPublisher.publishEvent(event);                                                          </span>
<span  style=""> 102                                                                                                          </span>
<span class="-4962567525074277725" onmouseenter="enter('-4962567525074277725');" onmouseout="out('-4962567525074277725');" style=""> 103             return seed;                                                                                 </span>
<span class="8325775691603685335" onmouseenter="enter('8325775691603685335');" onmouseout="out('8325775691603685335');" style=""> 104         } catch (PricingException e) {                                                                   </span>
<span class="7492159716890660353" onmouseenter="enter('7492159716890660353');" onmouseout="out('7492159716890660353');" style=""> 105             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e, seed);    </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style=""> 106         } catch (WorkflowException e) {                                                                  </span>
<span class="4510003336402340271" onmouseenter="enter('4510003336402340271');" onmouseout="out('4510003336402340271');" style=""><abbr title=" 107             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getRootCause(), seed);"> 107             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getRootCausðŸ”µ</abbr></span>
<span class="-3309265739981452342" onmouseenter="enter('-3309265739981452342');" onmouseout="out('-3309265739981452342');" style=""> 108         } catch (RequiredAttributeNotProvidedException e) {                                              </span>
<span class="5802058541684837280" onmouseenter="enter('5802058541684837280');" onmouseout="out('5802058541684837280');" style=""><abbr title=" 109             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getCause(), seed);"> 109             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getCause(),ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111     }                                                                                                    </span>
<span  style=""> 112                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 113     /**                                                                                                  </span>
<span class="-8117112094151685875" onmouseenter="enter('-8117112094151685875');" onmouseout="out('-8117112094151685875');" style=""> 114      * Checks if the &lt;b&gt;order&lt;/b&gt; has already been gone through the checkout workflow.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 115      *                                                                                                   </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 116      * @param order                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 117      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 118      */                                                                                                  </span>
<span class="-5515852034666982207" onmouseenter="enter('-5515852034666982207');" onmouseout="out('-5515852034666982207');" style=""> 119     protected boolean hasOrderBeenCompleted(Order order) {                                               </span>
<span class="2926809942071606155" onmouseenter="enter('2926809942071606155');" onmouseout="out('2926809942071606155');" style=""><abbr title=" 120         return (OrderStatus.SUBMITTED.equals(order.getStatus()) || OrderStatus.CANCELLED.equals(order.getStatus()));"> 120         return (OrderStatus.SUBMITTED.equals(order.getStatus()) || OrderStatus.CANCELLED.equals(order.getðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121     }                                                                                                    </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 122 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 123 ||||||| BASE                                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126     /**                                                                                                  </span>
<span class="-5372345371946067385" onmouseenter="enter('-5372345371946067385');" onmouseout="out('-5372345371946067385');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127     * Get an object to lock on for the given order id                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128     *                                                                                                    </span>
<span class="5792031585211722007" onmouseenter="enter('5792031585211722007');" onmouseout="out('5792031585211722007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129     * @param orderId                                                                                     </span>
<span class="-3624008020148253684" onmouseenter="enter('-3624008020148253684');" onmouseout="out('-3624008020148253684');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 130     * @return null if there was not already a lock object available. If an object was already in the map, this will return"> 130     * @return null if there was not already a lock object available. If an object was already in the map,ðŸ”µ</abbr></span>
<span class="8251882172424081133" onmouseenter="enter('8251882172424081133');" onmouseout="out('8251882172424081133');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 131     * that object, which means that there is already a thread attempting to go through the checkout workflow"> 131     * that object, which means that there is already a thread attempting to go through the checkout workfðŸ”µ</abbr></span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132     */                                                                                                   </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 134 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137     /**                                                                                                  </span>
<span class="-8852247884129261371" onmouseenter="enter('-8852247884129261371');" onmouseout="out('-8852247884129261371');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138      * @deprecated no longer supported - simplifying interface                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139      */                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140                                                                                                          </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 141 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 142 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 143 ||||||| BASE                                                                                             </span>
<span class="-1013140991726993136" onmouseenter="enter('-1013140991726993136');" onmouseout="out('-1013140991726993136');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144 protected Object putLock(Long orderId) {                                                                 </span>
<span class="-7460032303013323591" onmouseenter="enter('-7460032303013323591');" onmouseout="out('-7460032303013323591');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145         return lockMap.putIfAbsent(orderId, new Object());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 147 =======                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148 @Deprecated                                                                                              </span>
<span class="-1013140991726993136" onmouseenter="enter('-1013140991726993136');" onmouseout="out('-1013140991726993136');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149     protected Object putLock(Long orderId) {                                                             </span>
<span class="-7460032303013323591" onmouseenter="enter('-7460032303013323591');" onmouseout="out('-7460032303013323591');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150         return lockMap.putIfAbsent(orderId, new Object());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151     }                                                                                                    </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 152 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 153 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 154 ||||||| BASE                                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157     /**                                                                                                  </span>
<span class="-4636268065863031943" onmouseenter="enter('-4636268065863031943');" onmouseout="out('-4636268065863031943');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158      * Done with processing the given orderId, remove the lock from the map                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159      *                                                                                                   </span>
<span class="5792031585211722007" onmouseenter="enter('5792031585211722007');" onmouseout="out('5792031585211722007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160      * @param orderId                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161      */                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 163 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166     /**                                                                                                  </span>
<span class="-8852247884129261371" onmouseenter="enter('-8852247884129261371');" onmouseout="out('-8852247884129261371');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167      * @deprecated no longer supported - simplifying interface                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168      */                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169                                                                                                          </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 170 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 171 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 172 ||||||| BASE                                                                                             </span>
<span class="-8588872842896633602" onmouseenter="enter('-8588872842896633602');" onmouseout="out('-8588872842896633602');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173 protected void removeLock(Long orderId) {                                                                </span>
<span class="-2960538426035023873" onmouseenter="enter('-2960538426035023873');" onmouseout="out('-2960538426035023873');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174         lockMap.remove(orderId);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 176 =======                                                                                                  </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177 @Deprecated                                                                                              </span>
<span class="-8588872842896633602" onmouseenter="enter('-8588872842896633602');" onmouseout="out('-8588872842896633602');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178     protected void removeLock(Long orderId) {                                                            </span>
<span class="-2960538426035023873" onmouseenter="enter('-2960538426035023873');" onmouseout="out('-2960538426035023873');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179         lockMap.remove(orderId);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180     }                                                                                                    </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 181 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 182                                                                                                          </span>
<span  style=""> 183                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2837200662160373495" onmouseenter="enter('2837200662160373495');" onmouseout="out('2837200662160373495');" style="">  18 package org.broadleafcommerce.core.checkout.service;                                                     </span>
<span  style="">  19                                                                                                          </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  20 import java.util.HashMap;                                                                                </span>
<span class="8600016768069240092" onmouseenter="enter('8600016768069240092');" onmouseout="out('8600016768069240092');" style="">  21 import java.util.concurrent.ConcurrentHashMap;                                                           </span>
<span class="-8712007787466626518" onmouseenter="enter('-8712007787466626518');" onmouseout="out('-8712007787466626518');" style="">  22 import java.util.concurrent.ConcurrentMap;                                                               </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  23 import javax.annotation.Resource;                                                                        </span>
<span class="6519729880675887369" onmouseenter="enter('6519729880675887369');" onmouseout="out('6519729880675887369');" style="">  24 import org.broadleafcommerce.common.event.BroadleafApplicationEventPublisher;                            </span>
<span class="-9091558695437765808" onmouseenter="enter('-9091558695437765808');" onmouseout="out('-9091558695437765808');" style="">  25 import org.broadleafcommerce.common.event.OrderSubmittedEvent;                                           </span>
<span class="6522313194277917605" onmouseenter="enter('6522313194277917605');" onmouseout="out('6522313194277917605');" style="">  26 import org.broadleafcommerce.core.checkout.service.exception.CheckoutException;                          </span>
<span class="1643403549897197838" onmouseenter="enter('1643403549897197838');" onmouseout="out('1643403549897197838');" style="">  27 import org.broadleafcommerce.core.checkout.service.workflow.CheckoutResponse;                            </span>
<span class="7544921825722489220" onmouseenter="enter('7544921825722489220');" onmouseout="out('7544921825722489220');" style="">  28 import org.broadleafcommerce.core.checkout.service.workflow.CheckoutSeed;                                </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  29 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  30 import org.broadleafcommerce.core.order.service.OrderService;                                            </span>
<span class="-5209046066651310391" onmouseenter="enter('-5209046066651310391');" onmouseout="out('-5209046066651310391');" style="">  31 import org.broadleafcommerce.core.order.service.exception.RequiredAttributeNotProvidedException;         </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  32 import org.broadleafcommerce.core.order.service.type.OrderStatus;                                        </span>
<span class="-1629731899052688234" onmouseenter="enter('-1629731899052688234');" onmouseout="out('-1629731899052688234');" style="">  33 import org.broadleafcommerce.core.pricing.service.exception.PricingException;                            </span>
<span class="3294319710024405078" onmouseenter="enter('3294319710024405078');" onmouseout="out('3294319710024405078');" style="">  34 import org.broadleafcommerce.core.workflow.ActivityMessages;                                             </span>
<span class="-8060007382563500117" onmouseenter="enter('-8060007382563500117');" onmouseout="out('-8060007382563500117');" style="">  35 import org.broadleafcommerce.core.workflow.ProcessContext;                                               </span>
<span class="-3962095904812897416" onmouseenter="enter('-3962095904812897416');" onmouseout="out('-3962095904812897416');" style="">  36 import org.broadleafcommerce.core.workflow.Processor;                                                    </span>
<span class="2917073962618941638" onmouseenter="enter('2917073962618941638');" onmouseout="out('2917073962618941638');" style="">  37 import org.broadleafcommerce.core.workflow.WorkflowException;                                            </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  38 import org.springframework.beans.factory.annotation.Autowired;                                           </span>
<span class="-4664978283136443479" onmouseenter="enter('-4664978283136443479');" onmouseout="out('-4664978283136443479');" style="">  39 import org.springframework.beans.factory.annotation.Qualifier;                                           </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  40 import org.springframework.stereotype.Service;                                                           </span>
<span  style="">  41                                                                                                          </span>
<span  style="">  42                                                                                                          </span>
<span class="-2096539983704526716" onmouseenter="enter('-2096539983704526716');" onmouseout="out('-2096539983704526716');" style="">  43 @Service(&quot;blCheckoutService&quot;)                                                                            </span>
<span class="1999503991265051531" onmouseenter="enter('1999503991265051531');" onmouseout="out('1999503991265051531');" style="">  44 public class CheckoutServiceImpl implements CheckoutService {                                            </span>
<span class="598085921250037761" onmouseenter="enter('598085921250037761');" onmouseout="out('598085921250037761');" style="">  45     @Resource(name = &quot;blCheckoutWorkflow&quot;)                                                               </span>
<span class="-1903451900676189110" onmouseenter="enter('-1903451900676189110');" onmouseout="out('-1903451900676189110');" style="">  46     protected Processor&lt;CheckoutSeed, CheckoutSeed&gt; checkoutWorkflow;                                    </span>
<span  style="">  47                                                                                                          </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="">  48     @Autowired                                                                                           </span>
<span class="-7224044524343370301" onmouseenter="enter('-7224044524343370301');" onmouseout="out('-7224044524343370301');" style="">  49     @Qualifier(&quot;blApplicationEventPublisher&quot;)                                                            </span>
<span class="-5629661248749562711" onmouseenter="enter('-5629661248749562711');" onmouseout="out('-5629661248749562711');" style="">  50     protected BroadleafApplicationEventPublisher eventPublisher;                                         </span>
<span  style="">  51                                                                                                          </span>
<span class="4923990489900261754" onmouseenter="enter('4923990489900261754');" onmouseout="out('4923990489900261754');" style="">  52     @Resource(name=&quot;blOrderService&quot;)                                                                     </span>
<span class="4242410752290390693" onmouseenter="enter('4242410752290390693');" onmouseout="out('4242410752290390693');" style="">  53     protected OrderService orderService;                                                                 </span>
<span  style="">  54                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  55     @Override                                                                                            </span>
<span class="-6205942273611381609" onmouseenter="enter('-6205942273611381609');" onmouseout="out('-6205942273611381609');" style="">  56     public CheckoutResponse performCheckout(Order order) throws CheckoutException {                      </span>
<span class="-7631213923363427044" onmouseenter="enter('-7631213923363427044');" onmouseout="out('-7631213923363427044');" style="">  57         // Immediately fail if this order has already been checked out previously                        </span>
<span class="-8468900189698035586" onmouseenter="enter('-8468900189698035586');" onmouseout="out('-8468900189698035586');" style="">  58         if (hasOrderBeenCompleted(order)) {                                                              </span>
<span class="2023447600086359039" onmouseenter="enter('2023447600086359039');" onmouseout="out('2023447600086359039');" style=""><abbr title="  59             throw new CheckoutException(&quot;This order has already been submitted or cancelled, unable to checkout order -- id: &quot; + order.getId(), new CheckoutSeed(order, new HashMap&lt;String, Object&gt;()));">  59             throw new CheckoutException(&quot;This order has already been submitted or cancelled, unable to chðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  60         }                                                                                                </span>
<span class="1137122659916554565" onmouseenter="enter('1137122659916554565');" onmouseout="out('1137122659916554565');" style="">  61         CheckoutSeed seed = null;                                                                        </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  62         try {                                                                                            </span>
<span class="-1641300208118656595" onmouseenter="enter('-1641300208118656595');" onmouseout="out('-1641300208118656595');" style="">  63             // Do a final save of the order before going through with the checkout workflow              </span>
<span class="6494558446725059340" onmouseenter="enter('6494558446725059340');" onmouseout="out('6494558446725059340');" style="">  64             order = orderService.save(order, false);                                                     </span>
<span class="-2934620883649106718" onmouseenter="enter('-2934620883649106718');" onmouseout="out('-2934620883649106718');" style="">  65             seed = new CheckoutSeed(order, new HashMap&lt;&gt;());                                             </span>
<span class="7383087180359490305" onmouseenter="enter('7383087180359490305');" onmouseout="out('7383087180359490305');" style="">  66             ProcessContext&lt;CheckoutSeed&gt; context = checkoutWorkflow.doActivities(seed);                  </span>
<span class="-4673077056432893236" onmouseenter="enter('-4673077056432893236');" onmouseout="out('-4673077056432893236');" style=""><abbr title="  67             // We need to pull the order off the seed and save it here in case any activity modified the order.">  67             // We need to pull the order off the seed and save it here in case any activity modified the ðŸ”µ</abbr></span>
<span class="2617366754045918309" onmouseenter="enter('2617366754045918309');" onmouseout="out('2617366754045918309');" style="">  68             order = orderService.save(seed.getOrder(), false);                                           </span>
<span class="6340363706898666188" onmouseenter="enter('6340363706898666188');" onmouseout="out('6340363706898666188');" style="">  69             order.getOrderMessages().addAll(((ActivityMessages) (context)).getActivityMessages());       </span>
<span class="-243734768973433623" onmouseenter="enter('-243734768973433623');" onmouseout="out('-243734768973433623');" style="">  70             seed.setOrder(order);                                                                        </span>
<span class="-4086298984117942412" onmouseenter="enter('-4086298984117942412');" onmouseout="out('-4086298984117942412');" style=""><abbr title="  71             OrderSubmittedEvent event = new OrderSubmittedEvent(this, seed.getOrder().getId(), seed.getOrder().getOrderNumber());">  71             OrderSubmittedEvent event = new OrderSubmittedEvent(this, seed.getOrder().getId(), seed.getOrðŸ”µ</abbr></span>
<span class="-5031346483494114887" onmouseenter="enter('-5031346483494114887');" onmouseout="out('-5031346483494114887');" style="">  72             eventPublisher.publishEvent(event);                                                          </span>
<span class="-4962567525074277725" onmouseenter="enter('-4962567525074277725');" onmouseout="out('-4962567525074277725');" style="">  73             return seed;                                                                                 </span>
<span class="8325775691603685335" onmouseenter="enter('8325775691603685335');" onmouseout="out('8325775691603685335');" style="">  74         } catch (PricingException e) {                                                                   </span>
<span class="7492159716890660353" onmouseenter="enter('7492159716890660353');" onmouseout="out('7492159716890660353');" style="">  75             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e, seed);    </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style="">  76         } catch (WorkflowException e) {                                                                  </span>
<span class="4510003336402340271" onmouseenter="enter('4510003336402340271');" onmouseout="out('4510003336402340271');" style=""><abbr title="  77             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getRootCause(), seed);">  77             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getRootCausðŸ”µ</abbr></span>
<span class="-3309265739981452342" onmouseenter="enter('-3309265739981452342');" onmouseout="out('-3309265739981452342');" style="">  78         } catch (RequiredAttributeNotProvidedException e) {                                              </span>
<span class="5802058541684837280" onmouseenter="enter('5802058541684837280');" onmouseout="out('5802058541684837280');" style=""><abbr title="  79             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getCause(), seed);">  79             throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getCause(),ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  80         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81     }                                                                                                    </span>
<span  style="">  82                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  83     /**                                                                                                  </span>
<span class="-8117112094151685875" onmouseenter="enter('-8117112094151685875');" onmouseout="out('-8117112094151685875');" style="">  84      * Checks if the &lt;b&gt;order&lt;/b&gt; has already been gone through the checkout workflow.                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  85      *                                                                                                   </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style="">  86      * @param order                                                                                      </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">  87      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  88      */                                                                                                  </span>
<span class="-5515852034666982207" onmouseenter="enter('-5515852034666982207');" onmouseout="out('-5515852034666982207');" style="">  89     protected boolean hasOrderBeenCompleted(Order order) {                                               </span>
<span class="2926809942071606155" onmouseenter="enter('2926809942071606155');" onmouseout="out('2926809942071606155');" style=""><abbr title="  90         return (OrderStatus.SUBMITTED.equals(order.getStatus()) || OrderStatus.CANCELLED.equals(order.getStatus()));">  90         return (OrderStatus.SUBMITTED.equals(order.getStatus()) || OrderStatus.CANCELLED.equals(order.getðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92 }                                                                                                        </span>


























































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3   * BroadleafCommerce Framework                                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="2837200662160373495" onmouseenter="enter('2837200662160373495');" onmouseout="out('2837200662160373495');" style="">  18  package org.broadleafcommerce.core.checkout.service;                                                              </span>
<span  style="">  19                                                                                                                    </span>
<span class="6519729880675887369" onmouseenter="enter('6519729880675887369');" onmouseout="out('6519729880675887369');" style="">  20  import org.broadleafcommerce.common.event.BroadleafApplicationEventPublisher;                                     </span>
<span class="-9091558695437765808" onmouseenter="enter('-9091558695437765808');" onmouseout="out('-9091558695437765808');" style="">  21  import org.broadleafcommerce.common.event.OrderSubmittedEvent;                                                    </span>
<span class="6522313194277917605" onmouseenter="enter('6522313194277917605');" onmouseout="out('6522313194277917605');" style="">  22  import org.broadleafcommerce.core.checkout.service.exception.CheckoutException;                                   </span>
<span class="1643403549897197838" onmouseenter="enter('1643403549897197838');" onmouseout="out('1643403549897197838');" style="">  23  import org.broadleafcommerce.core.checkout.service.workflow.CheckoutResponse;                                     </span>
<span class="7544921825722489220" onmouseenter="enter('7544921825722489220');" onmouseout="out('7544921825722489220');" style="">  24  import org.broadleafcommerce.core.checkout.service.workflow.CheckoutSeed;                                         </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  25  import org.broadleafcommerce.core.order.domain.Order;                                                             </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  26  import org.broadleafcommerce.core.order.service.OrderService;                                                     </span>
<span class="-5209046066651310391" onmouseenter="enter('-5209046066651310391');" onmouseout="out('-5209046066651310391');" style="">  27  import org.broadleafcommerce.core.order.service.exception.RequiredAttributeNotProvidedException;                  </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  28  import org.broadleafcommerce.core.order.service.type.OrderStatus;                                                 </span>
<span class="-1629731899052688234" onmouseenter="enter('-1629731899052688234');" onmouseout="out('-1629731899052688234');" style="">  29  import org.broadleafcommerce.core.pricing.service.exception.PricingException;                                     </span>
<span class="3294319710024405078" onmouseenter="enter('3294319710024405078');" onmouseout="out('3294319710024405078');" style="">  30  import org.broadleafcommerce.core.workflow.ActivityMessages;                                                      </span>
<span class="-8060007382563500117" onmouseenter="enter('-8060007382563500117');" onmouseout="out('-8060007382563500117');" style="">  31  import org.broadleafcommerce.core.workflow.ProcessContext;                                                        </span>
<span class="-3962095904812897416" onmouseenter="enter('-3962095904812897416');" onmouseout="out('-3962095904812897416');" style="">  32  import org.broadleafcommerce.core.workflow.Processor;                                                             </span>
<span class="2917073962618941638" onmouseenter="enter('2917073962618941638');" onmouseout="out('2917073962618941638');" style="">  33  import org.broadleafcommerce.core.workflow.WorkflowException;                                                     </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  34  import org.springframework.beans.factory.annotation.Autowired;                                                    </span>
<span class="-4664978283136443479" onmouseenter="enter('-4664978283136443479');" onmouseout="out('-4664978283136443479');" style="">  35  import org.springframework.beans.factory.annotation.Qualifier;                                                    </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  36  import org.springframework.stereotype.Service;                                                                    </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  37  import java.util.HashMap;                                                                                         </span>
<span class="8600016768069240092" onmouseenter="enter('8600016768069240092');" onmouseout="out('8600016768069240092');" style="">  38  import java.util.concurrent.ConcurrentHashMap;                                                                    </span>
<span class="-8712007787466626518" onmouseenter="enter('-8712007787466626518');" onmouseout="out('-8712007787466626518');" style="">  39  import java.util.concurrent.ConcurrentMap;                                                                        </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  40  import javax.annotation.Resource;                                                                                 </span>
<span  style="">  41                                                                                                                    </span>
<span class="-2096539983704526716" onmouseenter="enter('-2096539983704526716');" onmouseout="out('-2096539983704526716');" style="">  42  @Service(&quot;blCheckoutService&quot;)                                                                                     </span>
<span class="1999503991265051531" onmouseenter="enter('1999503991265051531');" onmouseout="out('1999503991265051531');" style="">  43  public class CheckoutServiceImpl implements CheckoutService {                                                     </span>
<span  style="">  44                                                                                                                    </span>
<span class="8946174698814933187" onmouseenter="enter('8946174698814933187');" onmouseout="out('8946174698814933187');" style="">  45      @Resource(name=&quot;blCheckoutWorkflow&quot;)                                                                          </span>
<span class="-1903451900676189110" onmouseenter="enter('-1903451900676189110');" onmouseout="out('-1903451900676189110');" style="">  46      protected Processor&lt;CheckoutSeed, CheckoutSeed&gt; checkoutWorkflow;                                             </span>
<span  style="">  47                                                                                                                    </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="">  48      @Autowired                                                                                                    </span>
<span class="-7224044524343370301" onmouseenter="enter('-7224044524343370301');" onmouseout="out('-7224044524343370301');" style="">  49      @Qualifier(&quot;blApplicationEventPublisher&quot;)                                                                     </span>
<span class="-5629661248749562711" onmouseenter="enter('-5629661248749562711');" onmouseout="out('-5629661248749562711');" style="">  50      protected BroadleafApplicationEventPublisher eventPublisher;                                                  </span>
<span  style="">  51                                                                                                                    </span>
<span class="4923990489900261754" onmouseenter="enter('4923990489900261754');" onmouseout="out('4923990489900261754');" style="">  52      @Resource(name=&quot;blOrderService&quot;)                                                                              </span>
<span class="4242410752290390693" onmouseenter="enter('4242410752290390693');" onmouseout="out('4242410752290390693');" style="">  53      protected OrderService orderService;                                                                          </span>
<span  style="">  54                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 -    /**                                                                                                           </span>
<span class="2655193152803379355" onmouseenter="enter('2655193152803379355');" onmouseout="out('2655193152803379355');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  56 -     * Map of locks for given order ids. This lock map ensures that only a single request can handle a particular order">  56 -     * Map of locks for given order ids. This lock map ensures that only a single request can handle a particular ðŸ”µ</abbr></span>
<span class="6090453435388357874" onmouseenter="enter('6090453435388357874');" onmouseout="out('6090453435388357874');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  57 -     * at a time                                                                                                  </span>

<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  58 -     */                                                                                                           </span>

<span class="-244605010045706570" onmouseenter="enter('-244605010045706570');" onmouseout="out('-244605010045706570');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -    protected static ConcurrentMap&lt;Long, Object&gt; lockMap = new ConcurrentHashMap&lt;&gt;();                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  60 -                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  61      @Override                                                                                                     </span>
<span class="-6205942273611381609" onmouseenter="enter('-6205942273611381609');" onmouseout="out('-6205942273611381609');" style="">  62      public CheckoutResponse performCheckout(Order order) throws CheckoutException {                               </span>
<span class="1195793506276053894" onmouseenter="enter('1195793506276053894');" onmouseout="out('1195793506276053894');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  63 -        //Immediately fail if another thread is currently attempting to check out the order                       </span>
<span class="1743295593848301109" onmouseenter="enter('1743295593848301109');" onmouseout="out('1743295593848301109');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  64 -        Object lockObject = putLock(order.getId());                                                               </span>
<span class="280634753564671369" onmouseenter="enter('280634753564671369');" onmouseout="out('280634753564671369');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  65 -        if (lockObject != null) {                                                                                 </span>
<span class="-3010083470697043730" onmouseenter="enter('-3010083470697043730');" onmouseout="out('-3010083470697043730');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  66 -            throw new CheckoutException(&quot;This order is already in the process of being submitted, unable to checkout order -- id: &quot; + order.getId(), new CheckoutSeed(order, new HashMap&lt;String, Object&gt;()));">  66 -            throw new CheckoutException(&quot;This order is already in the process of being submitted, unable to checkoðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  67 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  68 -                                                                                                                  </span>
<span class="-7631213923363427044" onmouseenter="enter('-7631213923363427044');" onmouseout="out('-7631213923363427044');" style="">  69          // Immediately fail if this order has already been checked out previously                                 </span>
<span class="-8468900189698035586" onmouseenter="enter('-8468900189698035586');" onmouseout="out('-8468900189698035586');" style="">  70          if (hasOrderBeenCompleted(order)) {                                                                       </span>
<span class="2023447600086359039" onmouseenter="enter('2023447600086359039');" onmouseout="out('2023447600086359039');" style=""><abbr title="  71              throw new CheckoutException(&quot;This order has already been submitted or cancelled, unable to checkout order -- id: &quot; + order.getId(), new CheckoutSeed(order, new HashMap&lt;String, Object&gt;()));">  71              throw new CheckoutException(&quot;This order has already been submitted or cancelled, unable to checkout orðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72          }                                                                                                         </span>
<span  style="">  73                                                                                                                    </span>
<span class="1137122659916554565" onmouseenter="enter('1137122659916554565');" onmouseout="out('1137122659916554565');" style="">  74          CheckoutSeed seed = null;                                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  75          try {                                                                                                     </span>
<span class="-1641300208118656595" onmouseenter="enter('-1641300208118656595');" onmouseout="out('-1641300208118656595');" style="">  76              // Do a final save of the order before going through with the checkout workflow                       </span>
<span class="6494558446725059340" onmouseenter="enter('6494558446725059340');" onmouseout="out('6494558446725059340');" style="">  77              order = orderService.save(order, false);                                                              </span>
<span class="3134669698875821643" onmouseenter="enter('3134669698875821643');" onmouseout="out('3134669698875821643');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  78 -            seed = new CheckoutSeed(order, new HashMap&lt;String, Object&gt;());                                        </span>
<span class="-2934620883649106718" onmouseenter="enter('-2934620883649106718');" onmouseout="out('-2934620883649106718');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  79 +            seed = new CheckoutSeed(order, new HashMap&lt;&gt;());                                                      </span>
<span  style="">  80                                                                                                                    </span>
<span class="7383087180359490305" onmouseenter="enter('7383087180359490305');" onmouseout="out('7383087180359490305');" style="">  81              ProcessContext&lt;CheckoutSeed&gt; context = checkoutWorkflow.doActivities(seed);                           </span>
<span  style="">  82                                                                                                                    </span>
<span class="-4673077056432893236" onmouseenter="enter('-4673077056432893236');" onmouseout="out('-4673077056432893236');" style="">  83              // We need to pull the order off the seed and save it here in case any activity modified the order.   </span>
<span class="2617366754045918309" onmouseenter="enter('2617366754045918309');" onmouseout="out('2617366754045918309');" style="">  84              order = orderService.save(seed.getOrder(), false);                                                    </span>
<span class="-1009658261722038540" onmouseenter="enter('-1009658261722038540');" onmouseout="out('-1009658261722038540');" style="">  85              order.getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());                  </span>
<span class="-243734768973433623" onmouseenter="enter('-243734768973433623');" onmouseout="out('-243734768973433623');" style="">  86              seed.setOrder(order);                                                                                 </span>
<span  style="">  87                                                                                                                    </span>
<span class="-4086298984117942412" onmouseenter="enter('-4086298984117942412');" onmouseout="out('-4086298984117942412');" style=""><abbr title="  88              OrderSubmittedEvent event = new OrderSubmittedEvent(this, seed.getOrder().getId(), seed.getOrder().getOrderNumber());">  88              OrderSubmittedEvent event = new OrderSubmittedEvent(this, seed.getOrder().getId(), seed.getOrder().getðŸ”µ</abbr></span>
<span class="-5031346483494114887" onmouseenter="enter('-5031346483494114887');" onmouseout="out('-5031346483494114887');" style="">  89              eventPublisher.publishEvent(event);                                                                   </span>
<span  style="">  90                                                                                                                    </span>
<span class="-4962567525074277725" onmouseenter="enter('-4962567525074277725');" onmouseout="out('-4962567525074277725');" style="">  91              return seed;                                                                                          </span>
<span class="8325775691603685335" onmouseenter="enter('8325775691603685335');" onmouseout="out('8325775691603685335');" style="">  92          } catch (PricingException e) {                                                                            </span>
<span class="7492159716890660353" onmouseenter="enter('7492159716890660353');" onmouseout="out('7492159716890660353');" style="">  93              throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e, seed);             </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style="">  94          } catch (WorkflowException e) {                                                                           </span>
<span class="4510003336402340271" onmouseenter="enter('4510003336402340271');" onmouseout="out('4510003336402340271');" style=""><abbr title="  95              throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getRootCause(), seed);">  95              throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getRootCause(), seedðŸ”µ</abbr></span>
<span class="-3309265739981452342" onmouseenter="enter('-3309265739981452342');" onmouseout="out('-3309265739981452342');" style="">  96          } catch (RequiredAttributeNotProvidedException e) {                                                       </span>
<span class="5802058541684837280" onmouseenter="enter('5802058541684837280');" onmouseout="out('5802058541684837280');" style="">  97              throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getCause(), seed);  </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -        } finally {                                                                                               </span>
<span class="-918631296561360088" onmouseenter="enter('-918631296561360088');" onmouseout="out('-918631296561360088');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -            // The order has completed processing, remove the order from the processing map                       </span>
<span class="1372486891811636578" onmouseenter="enter('1372486891811636578');" onmouseout="out('1372486891811636578');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -            removeLock(order.getId());                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102      }                                                                                                             </span>
<span  style=""> 103                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 104      /**                                                                                                           </span>
<span class="-8117112094151685875" onmouseenter="enter('-8117112094151685875');" onmouseout="out('-8117112094151685875');" style=""> 105       * Checks if the &lt;b&gt;order&lt;/b&gt; has already been gone through the checkout workflow.                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 106       *                                                                                                            </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 107       * @param order                                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 108       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 109       */                                                                                                           </span>
<span class="-5515852034666982207" onmouseenter="enter('-5515852034666982207');" onmouseout="out('-5515852034666982207');" style=""> 110      protected boolean hasOrderBeenCompleted(Order order) {                                                        </span>
<span class="2926809942071606155" onmouseenter="enter('2926809942071606155');" onmouseout="out('2926809942071606155');" style=""><abbr title=" 111          return (OrderStatus.SUBMITTED.equals(order.getStatus()) || OrderStatus.CANCELLED.equals(order.getStatus()));"> 111          return (OrderStatus.SUBMITTED.equals(order.getStatus()) || OrderStatus.CANCELLED.equals(order.getStatus())ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112      }                                                                                                             </span>
<span  style=""> 113                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -    /**                                                                                                           </span>
<span class="-5372345371946067385" onmouseenter="enter('-5372345371946067385');" onmouseout="out('-5372345371946067385');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 115 -    * Get an object to lock on for the given order id                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 116 -    *                                                                                                             </span>
<span class="5792031585211722007" onmouseenter="enter('5792031585211722007');" onmouseout="out('5792031585211722007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -    * @param orderId                                                                                              </span>
<span class="-3624008020148253684" onmouseenter="enter('-3624008020148253684');" onmouseout="out('-3624008020148253684');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 118 -    * @return null if there was not already a lock object available. If an object was already in the map, this will return"> 118 -    * @return null if there was not already a lock object available. If an object was already in the map, this wilðŸ”µ</abbr></span>
<span class="8251882172424081133" onmouseenter="enter('8251882172424081133');" onmouseout="out('8251882172424081133');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 119 -    * that object, which means that there is already a thread attempting to go through the checkout workflow      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 120 -    */                                                                                                            </span>



<span class="-1013140991726993136" onmouseenter="enter('-1013140991726993136');" onmouseout="out('-1013140991726993136');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 121 -    protected Object putLock(Long orderId) {                                                                      </span>
<span class="-7460032303013323591" onmouseenter="enter('-7460032303013323591');" onmouseout="out('-7460032303013323591');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 122 -        return lockMap.putIfAbsent(orderId, new Object());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 123 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 124 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 125 -    /**                                                                                                           </span>
<span class="-4636268065863031943" onmouseenter="enter('-4636268065863031943');" onmouseout="out('-4636268065863031943');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 126 -     * Done with processing the given orderId, remove the lock from the map                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 127 -     *                                                                                                            </span>
<span class="5792031585211722007" onmouseenter="enter('5792031585211722007');" onmouseout="out('5792031585211722007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 128 -     * @param orderId                                                                                             </span>

<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 129 -     */                                                                                                           </span>

<span class="-8588872842896633602" onmouseenter="enter('-8588872842896633602');" onmouseout="out('-8588872842896633602');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 130 -    protected void removeLock(Long orderId) {                                                                     </span>
<span class="-2960538426035023873" onmouseenter="enter('-2960538426035023873');" onmouseout="out('-2960538426035023873');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 131 -        lockMap.remove(orderId);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 132 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 133 -                                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3   * BroadleafCommerce Framework                                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="2837200662160373495" onmouseenter="enter('2837200662160373495');" onmouseout="out('2837200662160373495');" style="">  18  package org.broadleafcommerce.core.checkout.service;                                                              </span>
<span  style="">  19                                                                                                                    </span>
<span class="6519729880675887369" onmouseenter="enter('6519729880675887369');" onmouseout="out('6519729880675887369');" style="">  20  import org.broadleafcommerce.common.event.BroadleafApplicationEventPublisher;                                     </span>
<span class="-9091558695437765808" onmouseenter="enter('-9091558695437765808');" onmouseout="out('-9091558695437765808');" style="">  21  import org.broadleafcommerce.common.event.OrderSubmittedEvent;                                                    </span>
<span class="6522313194277917605" onmouseenter="enter('6522313194277917605');" onmouseout="out('6522313194277917605');" style="">  22  import org.broadleafcommerce.core.checkout.service.exception.CheckoutException;                                   </span>
<span class="1643403549897197838" onmouseenter="enter('1643403549897197838');" onmouseout="out('1643403549897197838');" style="">  23  import org.broadleafcommerce.core.checkout.service.workflow.CheckoutResponse;                                     </span>
<span class="7544921825722489220" onmouseenter="enter('7544921825722489220');" onmouseout="out('7544921825722489220');" style="">  24  import org.broadleafcommerce.core.checkout.service.workflow.CheckoutSeed;                                         </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  25  import org.broadleafcommerce.core.order.domain.Order;                                                             </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  26  import org.broadleafcommerce.core.order.service.OrderService;                                                     </span>
<span class="-5209046066651310391" onmouseenter="enter('-5209046066651310391');" onmouseout="out('-5209046066651310391');" style="">  27  import org.broadleafcommerce.core.order.service.exception.RequiredAttributeNotProvidedException;                  </span>
<span class="614288234168063731" onmouseenter="enter('614288234168063731');" onmouseout="out('614288234168063731');" style="">  28  import org.broadleafcommerce.core.order.service.type.OrderStatus;                                                 </span>
<span class="-1629731899052688234" onmouseenter="enter('-1629731899052688234');" onmouseout="out('-1629731899052688234');" style="">  29  import org.broadleafcommerce.core.pricing.service.exception.PricingException;                                     </span>
<span class="3294319710024405078" onmouseenter="enter('3294319710024405078');" onmouseout="out('3294319710024405078');" style="">  30  import org.broadleafcommerce.core.workflow.ActivityMessages;                                                      </span>
<span class="-8060007382563500117" onmouseenter="enter('-8060007382563500117');" onmouseout="out('-8060007382563500117');" style="">  31  import org.broadleafcommerce.core.workflow.ProcessContext;                                                        </span>
<span class="-3962095904812897416" onmouseenter="enter('-3962095904812897416');" onmouseout="out('-3962095904812897416');" style="">  32  import org.broadleafcommerce.core.workflow.Processor;                                                             </span>
<span class="2917073962618941638" onmouseenter="enter('2917073962618941638');" onmouseout="out('2917073962618941638');" style="">  33  import org.broadleafcommerce.core.workflow.WorkflowException;                                                     </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  34  import org.springframework.beans.factory.annotation.Autowired;                                                    </span>
<span class="-4664978283136443479" onmouseenter="enter('-4664978283136443479');" onmouseout="out('-4664978283136443479');" style="">  35  import org.springframework.beans.factory.annotation.Qualifier;                                                    </span>
<span class="-5275076188864034753" onmouseenter="enter('-5275076188864034753');" onmouseout="out('-5275076188864034753');" style="">  36  import org.springframework.stereotype.Service;                                                                    </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  37  import java.util.HashMap;                                                                                         </span>
<span class="8600016768069240092" onmouseenter="enter('8600016768069240092');" onmouseout="out('8600016768069240092');" style="">  38  import java.util.concurrent.ConcurrentHashMap;                                                                    </span>
<span class="-8712007787466626518" onmouseenter="enter('-8712007787466626518');" onmouseout="out('-8712007787466626518');" style="">  39  import java.util.concurrent.ConcurrentMap;                                                                        </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  40  import javax.annotation.Resource;                                                                                 </span>
<span  style="">  41                                                                                                                    </span>
<span class="-2096539983704526716" onmouseenter="enter('-2096539983704526716');" onmouseout="out('-2096539983704526716');" style="">  42  @Service(&quot;blCheckoutService&quot;)                                                                                     </span>
<span class="1999503991265051531" onmouseenter="enter('1999503991265051531');" onmouseout="out('1999503991265051531');" style="">  43  public class CheckoutServiceImpl implements CheckoutService {                                                     </span>
<span  style="">  44                                                                                                                    </span>
<span class="8946174698814933187" onmouseenter="enter('8946174698814933187');" onmouseout="out('8946174698814933187');" style="">  45      @Resource(name=&quot;blCheckoutWorkflow&quot;)                                                                          </span>
<span class="-1903451900676189110" onmouseenter="enter('-1903451900676189110');" onmouseout="out('-1903451900676189110');" style="">  46      protected Processor&lt;CheckoutSeed, CheckoutSeed&gt; checkoutWorkflow;                                             </span>
<span  style="">  47                                                                                                                    </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="">  48      @Autowired                                                                                                    </span>
<span class="-7224044524343370301" onmouseenter="enter('-7224044524343370301');" onmouseout="out('-7224044524343370301');" style="">  49      @Qualifier(&quot;blApplicationEventPublisher&quot;)                                                                     </span>
<span class="-5629661248749562711" onmouseenter="enter('-5629661248749562711');" onmouseout="out('-5629661248749562711');" style="">  50      protected BroadleafApplicationEventPublisher eventPublisher;                                                  </span>
<span  style="">  51                                                                                                                    </span>
<span class="4923990489900261754" onmouseenter="enter('4923990489900261754');" onmouseout="out('4923990489900261754');" style="">  52      @Resource(name=&quot;blOrderService&quot;)                                                                              </span>
<span class="4242410752290390693" onmouseenter="enter('4242410752290390693');" onmouseout="out('4242410752290390693');" style="">  53      protected OrderService orderService;                                                                          </span>
<span  style="">  54                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55      /**                                                                                                           </span>
<span class="2655193152803379355" onmouseenter="enter('2655193152803379355');" onmouseout="out('2655193152803379355');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  56 -     * Map of locks for given order ids. This lock map ensures that only a single request can handle a particular order">  56 -     * Map of locks for given order ids. This lock map ensures that only a single request can handle a particular ðŸ”µ</abbr></span>
<span class="6090453435388357874" onmouseenter="enter('6090453435388357874');" onmouseout="out('6090453435388357874');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  57 -     * at a time                                                                                                  </span>
<span class="-8852247884129261371" onmouseenter="enter('-8852247884129261371');" onmouseout="out('-8852247884129261371');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +     * @deprecated no longer supported - simplifying interface                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  59       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +    @Deprecated                                                                                                   </span>
<span class="-244605010045706570" onmouseenter="enter('-244605010045706570');" onmouseout="out('-244605010045706570');" style="">  61      protected static ConcurrentMap&lt;Long, Object&gt; lockMap = new ConcurrentHashMap&lt;&gt;();                             </span>
<span  style="">  62                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  63      @Override                                                                                                     </span>
<span class="-6205942273611381609" onmouseenter="enter('-6205942273611381609');" onmouseout="out('-6205942273611381609');" style="">  64      public CheckoutResponse performCheckout(Order order) throws CheckoutException {                               </span>
<span class="1195793506276053894" onmouseenter="enter('1195793506276053894');" onmouseout="out('1195793506276053894');" style="">  65          //Immediately fail if another thread is currently attempting to check out the order                       </span>
<span class="1743295593848301109" onmouseenter="enter('1743295593848301109');" onmouseout="out('1743295593848301109');" style="">  66          Object lockObject = putLock(order.getId());                                                               </span>
<span class="280634753564671369" onmouseenter="enter('280634753564671369');" onmouseout="out('280634753564671369');" style="">  67          if (lockObject != null) {                                                                                 </span>
<span class="-3010083470697043730" onmouseenter="enter('-3010083470697043730');" onmouseout="out('-3010083470697043730');" style=""><abbr title="  68              throw new CheckoutException(&quot;This order is already in the process of being submitted, unable to checkout order -- id: &quot; + order.getId(), new CheckoutSeed(order, new HashMap&lt;String, Object&gt;()));">  68              throw new CheckoutException(&quot;This order is already in the process of being submitted, unable to checkoðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69          }                                                                                                         </span>
<span  style="">  70                                                                                                                    </span>
<span class="-7631213923363427044" onmouseenter="enter('-7631213923363427044');" onmouseout="out('-7631213923363427044');" style="">  71          // Immediately fail if this order has already been checked out previously                                 </span>
<span class="-8468900189698035586" onmouseenter="enter('-8468900189698035586');" onmouseout="out('-8468900189698035586');" style="">  72          if (hasOrderBeenCompleted(order)) {                                                                       </span>
<span class="2023447600086359039" onmouseenter="enter('2023447600086359039');" onmouseout="out('2023447600086359039');" style=""><abbr title="  73              throw new CheckoutException(&quot;This order has already been submitted or cancelled, unable to checkout order -- id: &quot; + order.getId(), new CheckoutSeed(order, new HashMap&lt;String, Object&gt;()));">  73              throw new CheckoutException(&quot;This order has already been submitted or cancelled, unable to checkout orðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  74          }                                                                                                         </span>
<span  style="">  75                                                                                                                    </span>
<span class="1137122659916554565" onmouseenter="enter('1137122659916554565');" onmouseout="out('1137122659916554565');" style="">  76          CheckoutSeed seed = null;                                                                                 </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  77          try {                                                                                                     </span>
<span class="-1641300208118656595" onmouseenter="enter('-1641300208118656595');" onmouseout="out('-1641300208118656595');" style="">  78              // Do a final save of the order before going through with the checkout workflow                       </span>
<span class="6494558446725059340" onmouseenter="enter('6494558446725059340');" onmouseout="out('6494558446725059340');" style="">  79              order = orderService.save(order, false);                                                              </span>
<span class="3134669698875821643" onmouseenter="enter('3134669698875821643');" onmouseout="out('3134669698875821643');" style="">  80              seed = new CheckoutSeed(order, new HashMap&lt;String, Object&gt;());                                        </span>

<span  style="">  81                                                                                                                    </span>
<span class="7383087180359490305" onmouseenter="enter('7383087180359490305');" onmouseout="out('7383087180359490305');" style="">  82              ProcessContext&lt;CheckoutSeed&gt; context = checkoutWorkflow.doActivities(seed);                           </span>
<span  style="">  83                                                                                                                    </span>
<span class="-4673077056432893236" onmouseenter="enter('-4673077056432893236');" onmouseout="out('-4673077056432893236');" style="">  84              // We need to pull the order off the seed and save it here in case any activity modified the order.   </span>
<span class="2617366754045918309" onmouseenter="enter('2617366754045918309');" onmouseout="out('2617366754045918309');" style="">  85              order = orderService.save(seed.getOrder(), false);                                                    </span>
<span class="-1009658261722038540" onmouseenter="enter('-1009658261722038540');" onmouseout="out('-1009658261722038540');" style="">  86              order.getOrderMessages().addAll(((ActivityMessages) context).getActivityMessages());                  </span>
<span class="-243734768973433623" onmouseenter="enter('-243734768973433623');" onmouseout="out('-243734768973433623');" style="">  87              seed.setOrder(order);                                                                                 </span>
<span  style="">  88                                                                                                                    </span>
<span class="-4086298984117942412" onmouseenter="enter('-4086298984117942412');" onmouseout="out('-4086298984117942412');" style=""><abbr title="  89              OrderSubmittedEvent event = new OrderSubmittedEvent(this, seed.getOrder().getId(), seed.getOrder().getOrderNumber());">  89              OrderSubmittedEvent event = new OrderSubmittedEvent(this, seed.getOrder().getId(), seed.getOrder().getðŸ”µ</abbr></span>
<span class="-5031346483494114887" onmouseenter="enter('-5031346483494114887');" onmouseout="out('-5031346483494114887');" style="">  90              eventPublisher.publishEvent(event);                                                                   </span>
<span  style="">  91                                                                                                                    </span>
<span class="-4962567525074277725" onmouseenter="enter('-4962567525074277725');" onmouseout="out('-4962567525074277725');" style="">  92              return seed;                                                                                          </span>
<span class="8325775691603685335" onmouseenter="enter('8325775691603685335');" onmouseout="out('8325775691603685335');" style="">  93          } catch (PricingException e) {                                                                            </span>
<span class="7492159716890660353" onmouseenter="enter('7492159716890660353');" onmouseout="out('7492159716890660353');" style="">  94              throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e, seed);             </span>
<span class="-363519760546583315" onmouseenter="enter('-363519760546583315');" onmouseout="out('-363519760546583315');" style="">  95          } catch (WorkflowException e) {                                                                           </span>
<span class="4510003336402340271" onmouseenter="enter('4510003336402340271');" onmouseout="out('4510003336402340271');" style=""><abbr title="  96              throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getRootCause(), seed);">  96              throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getRootCause(), seedðŸ”µ</abbr></span>
<span class="-3309265739981452342" onmouseenter="enter('-3309265739981452342');" onmouseout="out('-3309265739981452342');" style="">  97          } catch (RequiredAttributeNotProvidedException e) {                                                       </span>
<span class="5802058541684837280" onmouseenter="enter('5802058541684837280');" onmouseout="out('5802058541684837280');" style="">  98              throw new CheckoutException(&quot;Unable to checkout order -- id: &quot; + order.getId(), e.getCause(), seed);  </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -        } finally {                                                                                               </span>
<span class="-918631296561360088" onmouseenter="enter('-918631296561360088');" onmouseout="out('-918631296561360088');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -            // The order has completed processing, remove the order from the processing map                       </span>
<span class="1372486891811636578" onmouseenter="enter('1372486891811636578');" onmouseout="out('1372486891811636578');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -            removeLock(order.getId());                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103      }                                                                                                             </span>
<span  style=""> 104                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 105      /**                                                                                                           </span>
<span class="-8117112094151685875" onmouseenter="enter('-8117112094151685875');" onmouseout="out('-8117112094151685875');" style=""> 106       * Checks if the &lt;b&gt;order&lt;/b&gt; has already been gone through the checkout workflow.                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 107       *                                                                                                            </span>
<span class="6414796960983960786" onmouseenter="enter('6414796960983960786');" onmouseout="out('6414796960983960786');" style=""> 108       * @param order                                                                                               </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 109       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 110       */                                                                                                           </span>
<span class="-5515852034666982207" onmouseenter="enter('-5515852034666982207');" onmouseout="out('-5515852034666982207');" style=""> 111      protected boolean hasOrderBeenCompleted(Order order) {                                                        </span>
<span class="2926809942071606155" onmouseenter="enter('2926809942071606155');" onmouseout="out('2926809942071606155');" style=""><abbr title=" 112          return (OrderStatus.SUBMITTED.equals(order.getStatus()) || OrderStatus.CANCELLED.equals(order.getStatus()));"> 112          return (OrderStatus.SUBMITTED.equals(order.getStatus()) || OrderStatus.CANCELLED.equals(order.getStatus())ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113      }                                                                                                             </span>
<span  style=""> 114                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 115      /**                                                                                                           </span>
<span class="-5372345371946067385" onmouseenter="enter('-5372345371946067385');" onmouseout="out('-5372345371946067385');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 116 -    * Get an object to lock on for the given order id                                                             </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -    *                                                                                                             </span>
<span class="5792031585211722007" onmouseenter="enter('5792031585211722007');" onmouseout="out('5792031585211722007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 118 -    * @param orderId                                                                                              </span>
<span class="-3624008020148253684" onmouseenter="enter('-3624008020148253684');" onmouseout="out('-3624008020148253684');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 119 -    * @return null if there was not already a lock object available. If an object was already in the map, this will return"> 119 -    * @return null if there was not already a lock object available. If an object was already in the map, this wilðŸ”µ</abbr></span>
<span class="8251882172424081133" onmouseenter="enter('8251882172424081133');" onmouseout="out('8251882172424081133');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 120 -    * that object, which means that there is already a thread attempting to go through the checkout workflow      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 121 -    */                                                                                                            </span>
<span class="-8852247884129261371" onmouseenter="enter('-8852247884129261371');" onmouseout="out('-8852247884129261371');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +     * @deprecated no longer supported - simplifying interface                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +     */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +    @Deprecated                                                                                                   </span>
<span class="-1013140991726993136" onmouseenter="enter('-1013140991726993136');" onmouseout="out('-1013140991726993136');" style=""> 125      protected Object putLock(Long orderId) {                                                                      </span>
<span class="-7460032303013323591" onmouseenter="enter('-7460032303013323591');" onmouseout="out('-7460032303013323591');" style=""> 126          return lockMap.putIfAbsent(orderId, new Object());                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127      }                                                                                                             </span>
<span  style=""> 128                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 129      /**                                                                                                           </span>
<span class="-4636268065863031943" onmouseenter="enter('-4636268065863031943');" onmouseout="out('-4636268065863031943');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 130 -     * Done with processing the given orderId, remove the lock from the map                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 131 -     *                                                                                                            </span>
<span class="5792031585211722007" onmouseenter="enter('5792031585211722007');" onmouseout="out('5792031585211722007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 132 -     * @param orderId                                                                                             </span>
<span class="-8852247884129261371" onmouseenter="enter('-8852247884129261371');" onmouseout="out('-8852247884129261371');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +     * @deprecated no longer supported - simplifying interface                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 134       */                                                                                                           </span>
<span class="-9122364098618956613" onmouseenter="enter('-9122364098618956613');" onmouseout="out('-9122364098618956613');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 135 +    @Deprecated                                                                                                   </span>
<span class="-8588872842896633602" onmouseenter="enter('-8588872842896633602');" onmouseout="out('-8588872842896633602');" style=""> 136      protected void removeLock(Long orderId) {                                                                     </span>
<span class="-2960538426035023873" onmouseenter="enter('-2960538426035023873');" onmouseout="out('-2960538426035023873');" style=""> 137          lockMap.remove(orderId);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138      }                                                                                                             </span>
<span  style=""> 139                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            