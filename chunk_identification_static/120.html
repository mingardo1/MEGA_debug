<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>120</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    120
                    <a href="119.html">prev</a>
                    <a href="121.html">next</a>
                    <a href="120_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_89e275c67fd74f0edf3ff03711c8c7a4a9610791_core/broadleaf-framework/src/test/java/org/broadleafcommerce/core/offer/service/processor/ItemOfferProcessorTest.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;89e275c67fd74f0edf3ff03711c8c7a4a9610791:core/broadleaf-framework/src/test/java/org/broadleafcommerce/core/offer/service/processor/ItemOfferProcessorTest.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;89e275c67fd74f0edf3ff03711c8c7a4a9610791^1:core/broadleaf-framework/src/test/java/org/broadleafcommerce/core/offer/service/processor/ItemOfferProcessorTest.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;89e275c67fd74f0edf3ff03711c8c7a4a9610791^2:core/broadleaf-framework/src/test/java/org/broadleafcommerce/core/offer/service/processor/ItemOfferProcessorTest.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;a48cd6ca647e4a58cde4097171bd233ed3e8511d:core/broadleaf-framework/src/test/java/org/broadleafcommerce/core/offer/service/processor/ItemOfferProcessorTest.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [bsj], [bj]], subset: [[b], [bsj], [bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-4156106492343801428" onmouseenter="enter('-4156106492343801428');" onmouseout="out('-4156106492343801428');" style="">  18 package org.broadleafcommerce.core.offer.service.processor;                                              </span>
<span  style="">  19                                                                                                          </span>
<span class="5589978463048615898" onmouseenter="enter('5589978463048615898');" onmouseout="out('5589978463048615898');" style="">  20 import junit.framework.TestCase;                                                                         </span>
<span  style="">  21                                                                                                          </span>
<span class="-274639712180431568" onmouseenter="enter('-274639712180431568');" onmouseout="out('-274639712180431568');" style="">  22 import org.broadleafcommerce.common.money.Money;                                                         </span>
<span class="-1492144387614747576" onmouseenter="enter('-1492144387614747576');" onmouseout="out('-1492144387614747576');" style="">  23 import org.broadleafcommerce.common.service.GenericEntityService;                                        </span>
<span class="6205208880685044389" onmouseenter="enter('6205208880685044389');" onmouseout="out('6205208880685044389');" style="">  24 import org.broadleafcommerce.core.offer.dao.CustomerOfferDao;                                            </span>
<span class="-7911436562744873568" onmouseenter="enter('-7911436562744873568');" onmouseout="out('-7911436562744873568');" style="">  25 import org.broadleafcommerce.core.offer.dao.OfferCodeDao;                                                </span>
<span class="-2793633202507663758" onmouseenter="enter('-2793633202507663758');" onmouseout="out('-2793633202507663758');" style="">  26 import org.broadleafcommerce.core.offer.dao.OfferDao;                                                    </span>
<span class="4011152823911960428" onmouseenter="enter('4011152823911960428');" onmouseout="out('4011152823911960428');" style="">  27 import org.broadleafcommerce.core.offer.domain.CandidateItemOffer;                                       </span>
<span class="-735428748329738672" onmouseenter="enter('-735428748329738672');" onmouseout="out('-735428748329738672');" style="">  28 import org.broadleafcommerce.core.offer.domain.CandidateItemOfferImpl;                                   </span>
<span class="4081153142019712377" onmouseenter="enter('4081153142019712377');" onmouseout="out('4081153142019712377');" style="">  29 import org.broadleafcommerce.core.offer.domain.Offer;                                                    </span>
<span class="-7025591891527881733" onmouseenter="enter('-7025591891527881733');" onmouseout="out('-7025591891527881733');" style="">  30 import org.broadleafcommerce.core.offer.domain.OfferImpl;                                                </span>
<span class="1133170227846016200" onmouseenter="enter('1133170227846016200');" onmouseout="out('1133170227846016200');" style="">  31 import org.broadleafcommerce.core.offer.domain.OfferQualifyingCriteriaXref;                              </span>
<span class="5060973083944568665" onmouseenter="enter('5060973083944568665');" onmouseout="out('5060973083944568665');" style="">  32 import org.broadleafcommerce.core.offer.domain.OfferTargetCriteriaXref;                                  </span>
<span class="-1124625745990626401" onmouseenter="enter('-1124625745990626401');" onmouseout="out('-1124625745990626401');" style="">  33 import org.broadleafcommerce.core.offer.domain.OrderItemAdjustment;                                      </span>
<span class="-6005336697873394325" onmouseenter="enter('-6005336697873394325');" onmouseout="out('-6005336697873394325');" style="">  34 import org.broadleafcommerce.core.offer.domain.OrderItemAdjustmentImpl;                                  </span>
<span class="6786419255693124735" onmouseenter="enter('6786419255693124735');" onmouseout="out('6786419255693124735');" style="">  35 import org.broadleafcommerce.core.offer.domain.OrderItemPriceDetailAdjustment;                           </span>
<span class="1848619708404770384" onmouseenter="enter('1848619708404770384');" onmouseout="out('1848619708404770384');" style="">  36 import org.broadleafcommerce.core.offer.service.OfferDataItemProvider;                                   </span>
<span class="-6326345691456347408" onmouseenter="enter('-6326345691456347408');" onmouseout="out('-6326345691456347408');" style="">  37 import org.broadleafcommerce.core.offer.service.OfferServiceImpl;                                        </span>
<span class="-3097197529305387536" onmouseenter="enter('-3097197529305387536');" onmouseout="out('-3097197529305387536');" style="">  38 import org.broadleafcommerce.core.offer.service.OfferServiceUtilitiesImpl;                               </span>
<span class="212527052176527689" onmouseenter="enter('212527052176527689');" onmouseout="out('212527052176527689');" style="">  39 import org.broadleafcommerce.core.offer.service.discount.CandidatePromotionItems;                        </span>
<span class="7831481241902679836" onmouseenter="enter('7831481241902679836');" onmouseout="out('7831481241902679836');" style="">  40 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableCandidateItemOffer;            </span>
<span class="-7261038068657094491" onmouseenter="enter('-7261038068657094491');" onmouseout="out('-7261038068657094491');" style="">  41 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableItemFactoryImpl;               </span>
<span class="5738750158392070" onmouseenter="enter('5738750158392070');" onmouseout="out('5738750158392070');" style="">  42 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOfferUtility;                  </span>
<span class="8873929720094471664" onmouseenter="enter('8873929720094471664');" onmouseout="out('8873929720094471664');" style="">  43 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOfferUtilityImpl;              </span>
<span class="-6456406933954769040" onmouseenter="enter('-6456406933954769040');" onmouseout="out('-6456406933954769040');" style="">  44 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOrder;                         </span>
<span class="-7733804833771661823" onmouseenter="enter('-7733804833771661823');" onmouseout="out('-7733804833771661823');" style="">  45 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOrderItem;                     </span>
<span class="-5253725521220244448" onmouseenter="enter('-5253725521220244448');" onmouseout="out('-5253725521220244448');" style="">  46 import org.broadleafcommerce.core.offer.service.type.OfferDiscountType;                                  </span>
<span class="-8068779110760425254" onmouseenter="enter('-8068779110760425254');" onmouseout="out('-8068779110760425254');" style="">  47 import org.broadleafcommerce.core.offer.service.type.OfferItemRestrictionRuleType;                       </span>
<span class="-4951365057913084569" onmouseenter="enter('-4951365057913084569');" onmouseout="out('-4951365057913084569');" style="">  48 import org.broadleafcommerce.core.order.dao.FulfillmentGroupItemDao;                                     </span>
<span class="-7012758821456487335" onmouseenter="enter('-7012758821456487335');" onmouseout="out('-7012758821456487335');" style="">  49 import org.broadleafcommerce.core.order.dao.OrderItemDao;                                                </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  50 import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                        </span>
<span class="-7855842771160128779" onmouseenter="enter('-7855842771160128779');" onmouseout="out('-7855842771160128779');" style="">  51 import org.broadleafcommerce.core.order.domain.FulfillmentGroupItem;                                     </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  52 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  53 import org.broadleafcommerce.core.order.domain.OrderItem;                                                </span>
<span class="230297408131782266" onmouseenter="enter('230297408131782266');" onmouseout="out('230297408131782266');" style="">  54 import org.broadleafcommerce.core.order.domain.OrderItemPriceDetail;                                     </span>
<span class="1218446574017128210" onmouseenter="enter('1218446574017128210');" onmouseout="out('1218446574017128210');" style="">  55 import org.broadleafcommerce.core.order.domain.OrderMultishipOption;                                     </span>
<span class="9050710118625717230" onmouseenter="enter('9050710118625717230');" onmouseout="out('9050710118625717230');" style="">  56 import org.broadleafcommerce.core.order.service.FulfillmentGroupService;                                 </span>
<span class="2043331085843421951" onmouseenter="enter('2043331085843421951');" onmouseout="out('2043331085843421951');" style="">  57 import org.broadleafcommerce.core.order.service.OrderItemService;                                        </span>
<span class="-4438462058374014857" onmouseenter="enter('-4438462058374014857');" onmouseout="out('-4438462058374014857');" style="">  58 import org.broadleafcommerce.core.order.service.OrderMultishipOptionService;                             </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  59 import org.broadleafcommerce.core.order.service.OrderService;                                            </span>
<span class="426062199469058864" onmouseenter="enter('426062199469058864');" onmouseout="out('426062199469058864');" style="">  60 import org.broadleafcommerce.core.order.service.call.FulfillmentGroupItemRequest;                        </span>
<span class="8043089028015557901" onmouseenter="enter('8043089028015557901');" onmouseout="out('8043089028015557901');" style="">  61 import org.easymock.EasyMock;                                                                            </span>
<span class="8773851019359685182" onmouseenter="enter('8773851019359685182');" onmouseout="out('8773851019359685182');" style="">  62 import org.easymock.IAnswer;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  63 import java.util.ArrayList;                                                                              </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  64 import java.util.List;                                                                                   </span>
<span class="-3682115440535733483" onmouseenter="enter('-3682115440535733483');" onmouseout="out('-3682115440535733483');" style="">  65 import java.util.TimeZone;                                                                               </span>
<span  style="">  66                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  67 /**                                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  68  *                                                                                                       </span>
<span class="3104529581940833663" onmouseenter="enter('3104529581940833663');" onmouseout="out('3104529581940833663');" style="">  69  * @author jfischer                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  70  *                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  71  */                                                                                                      </span>
<span class="-2169245893345022929" onmouseenter="enter('-2169245893345022929');" onmouseout="out('-2169245893345022929');" style="">  72 public class ItemOfferProcessorTest extends TestCase {                                                   </span>
<span  style="">  73                                                                                                          </span>
<span class="2764411618740579830" onmouseenter="enter('2764411618740579830');" onmouseout="out('2764411618740579830');" style="">  74     protected OfferDao offerDaoMock;                                                                     </span>
<span class="-1028825014202044443" onmouseenter="enter('-1028825014202044443');" onmouseout="out('-1028825014202044443');" style="">  75     protected OrderItemDao orderItemDaoMock;                                                             </span>
<span class="-5369679977326057444" onmouseenter="enter('-5369679977326057444');" onmouseout="out('-5369679977326057444');" style="">  76     protected OrderService orderServiceMock;                                                             </span>
<span class="3942591246150891792" onmouseenter="enter('3942591246150891792');" onmouseout="out('3942591246150891792');" style="">  77     protected OfferServiceImpl offerService;                                                             </span>
<span class="-2082308031004269425" onmouseenter="enter('-2082308031004269425');" onmouseout="out('-2082308031004269425');" style="">  78     protected OrderItemService orderItemServiceMock;                                                     </span>
<span class="8143262996519322151" onmouseenter="enter('8143262996519322151');" onmouseout="out('8143262996519322151');" style="">  79     protected FulfillmentGroupItemDao fgItemDaoMock;                                                     </span>
<span class="7756339209203921246" onmouseenter="enter('7756339209203921246');" onmouseout="out('7756339209203921246');" style="">  80     protected OfferDataItemProvider dataProvider = new OfferDataItemProvider();                          </span>
<span class="3331618624366763309" onmouseenter="enter('3331618624366763309');" onmouseout="out('3331618624366763309');" style="">  81     protected FulfillmentGroupService fgServiceMock;                                                     </span>
<span class="2038085072144601851" onmouseenter="enter('2038085072144601851');" onmouseout="out('2038085072144601851');" style="">  82     protected OrderMultishipOptionService multishipOptionServiceMock;                                    </span>
<span class="1636757603740185885" onmouseenter="enter('1636757603740185885');" onmouseout="out('1636757603740185885');" style="">  83     protected OfferTimeZoneProcessor offerTimeZoneProcessorMock;                                         </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  84 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-363767546438432308" onmouseenter="enter('-363767546438432308');" onmouseout="out('-363767546438432308');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85     protected PromotableOfferUtility promotableOfferUtility;                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  86 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-3472214566962333184" onmouseenter="enter('-3472214566962333184');" onmouseout="out('-3472214566962333184');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87     protected ItemOfferProcessorImpl itemProcessor;                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  88 =======                                                                                                  </span>
<span class="8126767976686599164" onmouseenter="enter('8126767976686599164');" onmouseout="out('8126767976686599164');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89     protected GenericEntityService genericEntityServiceMock;                                             </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  90 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style="">  91                                                                                                          </span>
<span class="-3472214566962333184" onmouseenter="enter('-3472214566962333184');" onmouseout="out('-3472214566962333184');" style="">  92     protected ItemOfferProcessorImpl itemProcessor;                                                      </span>
<span  style="">  93                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  94     @Override                                                                                            </span>
<span class="2289017037938349582" onmouseenter="enter('2289017037938349582');" onmouseout="out('2289017037938349582');" style="">  95     protected void setUp() throws Exception {                                                            </span>
<span  style="">  96                                                                                                          </span>
<span class="-5376116141285812671" onmouseenter="enter('-5376116141285812671');" onmouseout="out('-5376116141285812671');" style="">  97         CustomerOfferDao customerOfferDaoMock = EasyMock.createMock(CustomerOfferDao.class);             </span>
<span class="-570975167499705701" onmouseenter="enter('-570975167499705701');" onmouseout="out('-570975167499705701');" style="">  98         OfferCodeDao offerCodeDaoMock = EasyMock.createMock(OfferCodeDao.class);                         </span>
<span class="3258640190833853601" onmouseenter="enter('3258640190833853601');" onmouseout="out('3258640190833853601');" style="">  99         offerDaoMock = EasyMock.createMock(OfferDao.class);                                              </span>
<span class="7274735973437056507" onmouseenter="enter('7274735973437056507');" onmouseout="out('7274735973437056507');" style=""> 100         orderItemDaoMock = EasyMock.createMock(OrderItemDao.class);                                      </span>
<span class="393627947078248392" onmouseenter="enter('393627947078248392');" onmouseout="out('393627947078248392');" style=""> 101         orderServiceMock = EasyMock.createMock(OrderService.class);                                      </span>
<span class="1993264780541814880" onmouseenter="enter('1993264780541814880');" onmouseout="out('1993264780541814880');" style=""> 102         orderItemServiceMock = EasyMock.createMock(OrderItemService.class);                              </span>
<span class="-3213369057155598174" onmouseenter="enter('-3213369057155598174');" onmouseout="out('-3213369057155598174');" style=""> 103         fgItemDaoMock = EasyMock.createMock(FulfillmentGroupItemDao.class);                              </span>
<span class="6964150545963317885" onmouseenter="enter('6964150545963317885');" onmouseout="out('6964150545963317885');" style=""> 104         fgServiceMock = EasyMock.createMock(FulfillmentGroupService.class);                              </span>
<span class="-3871783238737974896" onmouseenter="enter('-3871783238737974896');" onmouseout="out('-3871783238737974896');" style=""> 105         multishipOptionServiceMock = EasyMock.createMock(OrderMultishipOptionService.class);             </span>
<span class="-3280473616402059983" onmouseenter="enter('-3280473616402059983');" onmouseout="out('-3280473616402059983');" style=""> 106         offerTimeZoneProcessorMock = EasyMock.createMock(OfferTimeZoneProcessor.class);                  </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 107 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-5708051595893590327" onmouseenter="enter('-5708051595893590327');" onmouseout="out('-5708051595893590327');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108         promotableOfferUtility = new PromotableOfferUtilityImpl();                                       </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 109 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="4393308911552043332" onmouseenter="enter('4393308911552043332');" onmouseout="out('4393308911552043332');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110         offerServiceUtilities.setOfferDao(offerDaoMock);                                                 </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 111 =======                                                                                                  </span>
<span class="-8978123556236380411" onmouseenter="enter('-8978123556236380411');" onmouseout="out('-8978123556236380411');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112         genericEntityServiceMock = EasyMock.createMock(GenericEntityService.class);                      </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 113 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style=""> 114                                                                                                          </span>
<span  style=""> 115                                                                                                          </span>
<span class="3514247750798048226" onmouseenter="enter('3514247750798048226');" onmouseout="out('3514247750798048226');" style=""><abbr title=" 116         OfferServiceUtilitiesImpl offerServiceUtilities = new OfferServiceUtilitiesImpl(promotableOfferUtility);"> 116         OfferServiceUtilitiesImpl offerServiceUtilities = new OfferServiceUtilitiesImpl(promotableOfferUtðŸ”µ</abbr></span>
<span class="4393308911552043332" onmouseenter="enter('4393308911552043332');" onmouseout="out('4393308911552043332');" style=""> 117         offerServiceUtilities.setOfferDao(offerDaoMock);                                                 </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 118 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="7561232175961587910" onmouseenter="enter('7561232175961587910');" onmouseout="out('7561232175961587910');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 119         offerServiceUtilities.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));"> 119         offerServiceUtilities.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtiliðŸ”µ</abbr></span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 120 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-7004957386218896406" onmouseenter="enter('-7004957386218896406');" onmouseout="out('-7004957386218896406');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121         itemProcessor.setOfferDao(offerDaoMock);                                                         </span>
<span class="-7985735156898326914" onmouseenter="enter('-7985735156898326914');" onmouseout="out('-7985735156898326914');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122         itemProcessor.setOrderItemDao(orderItemDaoMock);                                                 </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 123 =======                                                                                                  </span>
<span class="8672470870156482430" onmouseenter="enter('8672470870156482430');" onmouseout="out('8672470870156482430');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124         offerServiceUtilities.setPromotableItemFactory(new PromotableItemFactoryImpl());                 </span>
<span class="8346807884110674152" onmouseenter="enter('8346807884110674152');" onmouseout="out('8346807884110674152');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125         offerServiceUtilities.setGenericEntityService(genericEntityServiceMock);                         </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 126 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style=""> 127                                                                                                          </span>
<span class="-5954143808619933939" onmouseenter="enter('-5954143808619933939');" onmouseout="out('-5954143808619933939');" style=""> 128         itemProcessor = new ItemOfferProcessorImpl(promotableOfferUtility);                              </span>
<span class="-7004957386218896406" onmouseenter="enter('-7004957386218896406');" onmouseout="out('-7004957386218896406');" style=""> 129         itemProcessor.setOfferDao(offerDaoMock);                                                         </span>
<span class="-7985735156898326914" onmouseenter="enter('-7985735156898326914');" onmouseout="out('-7985735156898326914');" style=""> 130         itemProcessor.setOrderItemDao(orderItemDaoMock);                                                 </span>
<span class="-4628842602683269361" onmouseenter="enter('-4628842602683269361');" onmouseout="out('-4628842602683269361');" style=""> 131         itemProcessor.setOfferTimeZoneProcessor(offerTimeZoneProcessorMock);                             </span>
<span class="-2793185480423849018" onmouseenter="enter('-2793185480423849018');" onmouseout="out('-2793185480423849018');" style=""> 132         itemProcessor.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));   </span>
<span class="1873271206223196651" onmouseenter="enter('1873271206223196651');" onmouseout="out('1873271206223196651');" style=""> 133         itemProcessor.setOfferServiceUtilities(offerServiceUtilities);                                   </span>
<span  style=""> 134                                                                                                          </span>
<span class="-7001064742117532685" onmouseenter="enter('-7001064742117532685');" onmouseout="out('-7001064742117532685');" style=""> 135         offerService = new OfferServiceImpl();                                                           </span>
<span  style=""> 136                                                                                                          </span>
<span class="-7168324839350089956" onmouseenter="enter('-7168324839350089956');" onmouseout="out('-7168324839350089956');" style=""> 137         OrderOfferProcessorImpl orderProcessor = new OrderOfferProcessorImpl(promotableOfferUtility);    </span>
<span class="-8216532080679576302" onmouseenter="enter('-8216532080679576302');" onmouseout="out('-8216532080679576302');" style=""> 138         orderProcessor.setOfferDao(offerDaoMock);                                                        </span>
<span class="5575229934633988866" onmouseenter="enter('5575229934633988866');" onmouseout="out('5575229934633988866');" style=""> 139         orderProcessor.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));  </span>
<span class="-4588344466186947569" onmouseenter="enter('-4588344466186947569');" onmouseout="out('-4588344466186947569');" style=""> 140         orderProcessor.setOfferTimeZoneProcessor(offerTimeZoneProcessorMock);                            </span>
<span class="-7787408525763214442" onmouseenter="enter('-7787408525763214442');" onmouseout="out('-7787408525763214442');" style=""> 141         orderProcessor.setOrderItemDao(orderItemDaoMock);                                                </span>
<span class="-8932862412317704790" onmouseenter="enter('-8932862412317704790');" onmouseout="out('-8932862412317704790');" style=""> 142         orderProcessor.setOfferServiceUtilities(offerServiceUtilities);                                  </span>
<span  style=""> 143                                                                                                          </span>
<span class="-7594314374485898167" onmouseenter="enter('-7594314374485898167');" onmouseout="out('-7594314374485898167');" style=""> 144         offerService.setCustomerOfferDao(customerOfferDaoMock);                                          </span>
<span class="483175997286853822" onmouseenter="enter('483175997286853822');" onmouseout="out('483175997286853822');" style=""> 145         offerService.setOfferCodeDao(offerCodeDaoMock);                                                  </span>
<span class="-157638129368187663" onmouseenter="enter('-157638129368187663');" onmouseout="out('-157638129368187663');" style=""> 146         offerService.setOfferDao(offerDaoMock);                                                          </span>
<span class="-2861300639666845512" onmouseenter="enter('-2861300639666845512');" onmouseout="out('-2861300639666845512');" style=""> 147         offerService.setOrderOfferProcessor(orderProcessor);                                             </span>
<span class="4668119620018038426" onmouseenter="enter('4668119620018038426');" onmouseout="out('4668119620018038426');" style=""> 148         offerService.setItemOfferProcessor(itemProcessor);                                               </span>
<span class="-2798583477021709202" onmouseenter="enter('-2798583477021709202');" onmouseout="out('-2798583477021709202');" style=""> 149         offerService.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));    </span>
<span class="-7013122243510448528" onmouseenter="enter('-7013122243510448528');" onmouseout="out('-7013122243510448528');" style=""> 150         offerService.setOrderService(orderServiceMock);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151     }                                                                                                    </span>
<span  style=""> 152                                                                                                          </span>
<span class="-425214870767341244" onmouseenter="enter('-425214870767341244');" onmouseout="out('-425214870767341244');" style=""> 153     public void replay() throws Exception {                                                              </span>
<span class="3688914841313020601" onmouseenter="enter('3688914841313020601');" onmouseout="out('3688914841313020601');" style=""><abbr title=" 154         EasyMock.expect(orderItemDaoMock.createOrderItemPriceDetail()).andAnswer(OfferDataItemProvider.getCreateOrderItemPriceDetailAnswer()).anyTimes();"> 154         EasyMock.expect(orderItemDaoMock.createOrderItemPriceDetail()).andAnswer(OfferDataItemProvider.geðŸ”µ</abbr></span>
<span class="-201012827833234886" onmouseenter="enter('-201012827833234886');" onmouseout="out('-201012827833234886');" style=""><abbr title=" 155         EasyMock.expect(orderItemDaoMock.createOrderItemQualifier()).andAnswer(OfferDataItemProvider.getCreateOrderItemQualifierAnswer()).anyTimes();"> 155         EasyMock.expect(orderItemDaoMock.createOrderItemQualifier()).andAnswer(OfferDataItemProvider.getCðŸ”µ</abbr></span>
<span class="3313434268437563429" onmouseenter="enter('3313434268437563429');" onmouseout="out('3313434268437563429');" style=""><abbr title=" 156         EasyMock.expect(offerDaoMock.createOrderItemPriceDetailAdjustment()).andAnswer(OfferDataItemProvider.getCreateOrderItemPriceDetailAdjustmentAnswer()).anyTimes();"> 156         EasyMock.expect(offerDaoMock.createOrderItemPriceDetailAdjustment()).andAnswer(OfferDataItemProviðŸ”µ</abbr></span>
<span  style=""> 157                                                                                                          </span>
<span class="-4805711593793558927" onmouseenter="enter('-4805711593793558927');" onmouseout="out('-4805711593793558927');" style=""><abbr title=" 158         EasyMock.expect(fgServiceMock.addItemToFulfillmentGroup(EasyMock.isA(FulfillmentGroupItemRequest.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getAddItemToFulfillmentGroupAnswer()).anyTimes();"> 158         EasyMock.expect(fgServiceMock.addItemToFulfillmentGroup(EasyMock.isA(FulfillmentGroupItemRequest.ðŸ”µ</abbr></span>
<span class="-4648578783612235576" onmouseenter="enter('-4648578783612235576');" onmouseout="out('-4648578783612235576');" style=""><abbr title=" 159         EasyMock.expect(orderServiceMock.removeItem(EasyMock.isA(Long.class), EasyMock.isA(Long.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getRemoveItemFromOrderAnswer()).anyTimes();"> 159         EasyMock.expect(orderServiceMock.removeItem(EasyMock.isA(Long.class), EasyMock.isA(Long.class), EðŸ”µ</abbr></span>
<span class="-25100646963641968" onmouseenter="enter('-25100646963641968');" onmouseout="out('-25100646963641968');" style=""><abbr title=" 160         EasyMock.expect(orderServiceMock.save(EasyMock.isA(Order.class), EasyMock.isA(Boolean.class))).andAnswer(OfferDataItemProvider.getSaveOrderAnswer()).anyTimes();"> 160         EasyMock.expect(orderServiceMock.save(EasyMock.isA(Order.class), EasyMock.isA(Boolean.class))).anðŸ”µ</abbr></span>
<span  style=""> 161                                                                                                          </span>
<span class="2160564019413082164" onmouseenter="enter('2160564019413082164');" onmouseout="out('2160564019413082164');" style=""> 162         EasyMock.expect(orderServiceMock.getAutomaticallyMergeLikeItems()).andReturn(true).anyTimes();   </span>
<span  style=""> 163                                                                                                          </span>
<span class="-8884522234726007395" onmouseenter="enter('-8884522234726007395');" onmouseout="out('-8884522234726007395');" style=""><abbr title=" 164         EasyMock.expect(orderItemServiceMock.saveOrderItem(EasyMock.isA(OrderItem.class))).andAnswer(OfferDataItemProvider.getSaveOrderItemAnswer()).anyTimes();"> 164         EasyMock.expect(orderItemServiceMock.saveOrderItem(EasyMock.isA(OrderItem.class))).andAnswer(OffeðŸ”µ</abbr></span>
<span class="-3554631046904274751" onmouseenter="enter('-3554631046904274751');" onmouseout="out('-3554631046904274751');" style=""><abbr title=" 165         EasyMock.expect(fgItemDaoMock.save(EasyMock.isA(FulfillmentGroupItem.class))).andAnswer(OfferDataItemProvider.getSaveFulfillmentGroupItemAnswer()).anyTimes();"> 165         EasyMock.expect(fgItemDaoMock.save(EasyMock.isA(FulfillmentGroupItem.class))).andAnswer(OfferDataðŸ”µ</abbr></span>
<span  style=""> 166                                                                                                          </span>
<span class="2031702441279524669" onmouseenter="enter('2031702441279524669');" onmouseout="out('2031702441279524669');" style=""><abbr title=" 167         EasyMock.expect(multishipOptionServiceMock.findOrderMultishipOptions(EasyMock.isA(Long.class))).andAnswer(new IAnswer&lt;List&lt;OrderMultishipOption&gt;&gt;() {"> 167         EasyMock.expect(multishipOptionServiceMock.findOrderMultishipOptions(EasyMock.isA(Long.class))).aðŸ”µ</abbr></span>
<span  style=""> 168                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 169             @Override                                                                                    </span>
<span class="4982536128511672004" onmouseenter="enter('4982536128511672004');" onmouseout="out('4982536128511672004');" style=""> 170             public List&lt;OrderMultishipOption&gt; answer() throws Throwable {                                </span>
<span class="4748136149545123859" onmouseenter="enter('4748136149545123859');" onmouseout="out('4748136149545123859');" style=""> 171                 return new ArrayList&lt;OrderMultishipOption&gt;();                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172             }                                                                                            </span>
<span class="-8356082990236199220" onmouseenter="enter('-8356082990236199220');" onmouseout="out('-8356082990236199220');" style=""> 173         }).anyTimes();                                                                                   </span>
<span  style=""> 174                                                                                                          </span>
<span class="5730763888734231228" onmouseenter="enter('5730763888734231228');" onmouseout="out('5730763888734231228');" style=""> 175         multishipOptionServiceMock.deleteAllOrderMultishipOptions(EasyMock.isA(Order.class));            </span>
<span class="-238683341484251031" onmouseenter="enter('-238683341484251031');" onmouseout="out('-238683341484251031');" style=""> 176         EasyMock.expectLastCall().anyTimes();                                                            </span>
<span class="3680375331985361488" onmouseenter="enter('3680375331985361488');" onmouseout="out('3680375331985361488');" style=""><abbr title=" 177         EasyMock.expect(fgServiceMock.collapseToOneShippableFulfillmentGroup(EasyMock.isA(Order.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getSameOrderAnswer()).anyTimes();"> 177         EasyMock.expect(fgServiceMock.collapseToOneShippableFulfillmentGroup(EasyMock.isA(Order.class), EðŸ”µ</abbr></span>
<span class="7005207656442723333" onmouseenter="enter('7005207656442723333');" onmouseout="out('7005207656442723333');" style=""><abbr title=" 178         EasyMock.expect(fgItemDaoMock.create()).andAnswer(OfferDataItemProvider.getCreateFulfillmentGroupItemAnswer()).anyTimes();"> 178         EasyMock.expect(fgItemDaoMock.create()).andAnswer(OfferDataItemProvider.getCreateFulfillmentGroupðŸ”µ</abbr></span>
<span class="3552856255510166668" onmouseenter="enter('3552856255510166668');" onmouseout="out('3552856255510166668');" style=""> 179         fgItemDaoMock.delete(EasyMock.isA(FulfillmentGroupItem.class));                                  </span>
<span class="-238683341484251031" onmouseenter="enter('-238683341484251031');" onmouseout="out('-238683341484251031');" style=""> 180         EasyMock.expectLastCall().anyTimes();                                                            </span>
<span class="602433099109498087" onmouseenter="enter('602433099109498087');" onmouseout="out('602433099109498087');" style=""><abbr title=" 181         EasyMock.expect(offerTimeZoneProcessorMock.getTimeZone(EasyMock.isA(OfferImpl.class))).andReturn(TimeZone.getTimeZone(&quot;CST&quot;)).anyTimes();"> 181         EasyMock.expect(offerTimeZoneProcessorMock.getTimeZone(EasyMock.isA(OfferImpl.class))).andReturn(ðŸ”µ</abbr></span>
<span  style=""> 182                                                                                                          </span>
<span class="4039967104390893601" onmouseenter="enter('4039967104390893601');" onmouseout="out('4039967104390893601');" style=""> 183         EasyMock.replay(offerDaoMock);                                                                   </span>
<span class="-8438798452743116996" onmouseenter="enter('-8438798452743116996');" onmouseout="out('-8438798452743116996');" style=""> 184         EasyMock.replay(orderItemDaoMock);                                                               </span>
<span class="-306516478140011318" onmouseenter="enter('-306516478140011318');" onmouseout="out('-306516478140011318');" style=""> 185         EasyMock.replay(orderServiceMock);                                                               </span>
<span class="-1764805494951210013" onmouseenter="enter('-1764805494951210013');" onmouseout="out('-1764805494951210013');" style=""> 186         EasyMock.replay(orderItemServiceMock);                                                           </span>
<span class="1127149787736159594" onmouseenter="enter('1127149787736159594');" onmouseout="out('1127149787736159594');" style=""> 187         EasyMock.replay(fgItemDaoMock);                                                                  </span>
<span class="220377317211655869" onmouseenter="enter('220377317211655869');" onmouseout="out('220377317211655869');" style=""> 188         EasyMock.replay(fgServiceMock);                                                                  </span>
<span class="7141248576860687210" onmouseenter="enter('7141248576860687210');" onmouseout="out('7141248576860687210');" style=""> 189         EasyMock.replay(multishipOptionServiceMock);                                                     </span>
<span class="1625398624145697967" onmouseenter="enter('1625398624145697967');" onmouseout="out('1625398624145697967');" style=""> 190         EasyMock.replay(offerTimeZoneProcessorMock);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191     }                                                                                                    </span>
<span  style=""> 192                                                                                                          </span>
<span class="6267001839391766981" onmouseenter="enter('6267001839391766981');" onmouseout="out('6267001839391766981');" style=""> 193     public void verify() {                                                                               </span>
<span class="6756940960390862422" onmouseenter="enter('6756940960390862422');" onmouseout="out('6756940960390862422');" style=""> 194         EasyMock.verify(offerDaoMock);                                                                   </span>
<span class="-5117344946758939057" onmouseenter="enter('-5117344946758939057');" onmouseout="out('-5117344946758939057');" style=""> 195         EasyMock.verify(orderItemDaoMock);                                                               </span>
<span class="-6538245312297088944" onmouseenter="enter('-6538245312297088944');" onmouseout="out('-6538245312297088944');" style=""> 196         EasyMock.verify(orderServiceMock);                                                               </span>
<span class="4656187310788509663" onmouseenter="enter('4656187310788509663');" onmouseout="out('4656187310788509663');" style=""> 197         EasyMock.verify(orderItemServiceMock);                                                           </span>
<span class="-3344344690958109982" onmouseenter="enter('-3344344690958109982');" onmouseout="out('-3344344690958109982');" style=""> 198         EasyMock.verify(fgItemDaoMock);                                                                  </span>
<span class="-7107457974865616724" onmouseenter="enter('-7107457974865616724');" onmouseout="out('-7107457974865616724');" style=""> 199         EasyMock.verify(fgServiceMock);                                                                  </span>
<span class="3082501288673197520" onmouseenter="enter('3082501288673197520');" onmouseout="out('3082501288673197520');" style=""> 200         EasyMock.verify(multishipOptionServiceMock);                                                     </span>
<span class="8968216054532738001" onmouseenter="enter('8968216054532738001');" onmouseout="out('8968216054532738001');" style=""> 201         EasyMock.verify(offerTimeZoneProcessorMock);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202     }                                                                                                    </span>
<span  style=""> 203                                                                                                          </span>
<span class="4417344074261065537" onmouseenter="enter('4417344074261065537');" onmouseout="out('4417344074261065537');" style=""> 204     public void testFilterItemLevelOffer() throws Exception {                                            </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 205         replay();                                                                                        </span>
<span  style=""> 206                                                                                                          </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""><abbr title=" 207         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();"> 207         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;(ðŸ”µ</abbr></span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 208         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                          </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 209             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 210                 OfferDiscountType.PERCENT_OFF,                                                           </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 211             null,                                                                                        </span>
<span class="-4216650843576585517" onmouseenter="enter('-4216650843576585517');" onmouseout="out('-4216650843576585517');" style=""> 212             null                                                                                         </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 213         );                                                                                               </span>
<span  style=""> 214                                                                                                          </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style=""> 215         PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);         </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 216         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span  style=""> 217                                                                                                          </span>
<span class="8849096113443711736" onmouseenter="enter('8849096113443711736');" onmouseout="out('8849096113443711736');" style=""> 218         //test that the valid order item offer is included - legacy format - no qualifier                </span>
<span class="5326116414476463681" onmouseenter="enter('5326116414476463681');" onmouseout="out('5326116414476463681');" style=""> 219         //since there&#x27;s no qualifier, both items can apply                                               </span>
<span class="8674824753424198113" onmouseenter="enter('8674824753424198113');" onmouseout="out('8674824753424198113');" style=""> 220         // This line is commented out because we are no longer creating legacy offers.                   </span>
<span class="4622569814719673082" onmouseenter="enter('4622569814719673082');" onmouseout="out('4622569814719673082');" style=""><abbr title=" 221         //assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offers.get(0)));"> 221         //assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0ðŸ”µ</abbr></span>
<span  style=""> 222                                                                                                          </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 223         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 224         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 225             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 226             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 227             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 227             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 228             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 228             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 229         );                                                                                               </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 230         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span  style=""> 231                                                                                                          </span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 232         //test that the valid order item offer is included                                               </span>
<span class="3764014390603703627" onmouseenter="enter('3764014390603703627');" onmouseout="out('3764014390603703627');" style=""><abbr title=" 233         //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one qualifier in the qualifiers map"> 233         //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be ðŸ”µ</abbr></span>
<span class="6792085890314091009" onmouseenter="enter('6792085890314091009');" onmouseout="out('6792085890314091009');" style=""> 234         //we don&#x27;t know the targets yet, so there&#x27;s only one CandidateItemOffer for now                  </span>
<span class="-7187194290173616188" onmouseenter="enter('-7187194290173616188');" onmouseout="out('-7187194290173616188');" style=""><abbr title=" 235         assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1);"> 235         assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0))ðŸ”µ</abbr></span>
<span  style=""> 236                                                                                                          </span>
<span class="-8860615526139513207" onmouseenter="enter('-8860615526139513207');" onmouseout="out('-8860615526139513207');" style=""> 237         // Add a subtotal requirement that will be met by the item offer.                                </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 238         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 239         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 240             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 241             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 242             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 242             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 243             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 243             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 244         );                                                                                               </span>
<span  style=""> 245                                                                                                          </span>
<span class="8674510659006467642" onmouseenter="enter('8674510659006467642');" onmouseout="out('8674510659006467642');" style=""> 246         offers.get(0).setQualifyingItemSubTotal(new Money(1));                                           </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 247         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span  style=""> 248                                                                                                          </span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 249         //test that the valid order item offer is included                                               </span>
<span class="3764014390603703627" onmouseenter="enter('3764014390603703627');" onmouseout="out('3764014390603703627');" style=""><abbr title=" 250         //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one qualifier in the qualifiers map"> 250         //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be ðŸ”µ</abbr></span>
<span class="6792085890314091009" onmouseenter="enter('6792085890314091009');" onmouseout="out('6792085890314091009');" style=""> 251         //we don&#x27;t know the targets yet, so there&#x27;s only one CandidateItemOffer for now                  </span>
<span class="-7187194290173616188" onmouseenter="enter('-7187194290173616188');" onmouseout="out('-7187194290173616188');" style=""><abbr title=" 252         assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1);"> 252         assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0))ðŸ”µ</abbr></span>
<span  style=""> 253                                                                                                          </span>
<span  style=""> 254                                                                                                          </span>
<span class="5301041827655263880" onmouseenter="enter('5301041827655263880');" onmouseout="out('5301041827655263880');" style=""> 255         // Add a subtotal requirement that will not be met by the item offer.                            </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 256         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 257         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 258             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 259             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 260             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 260             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 261             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 261             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 262         );                                                                                               </span>
<span  style=""> 263                                                                                                          </span>
<span class="1138045012752265464" onmouseenter="enter('1138045012752265464');" onmouseout="out('1138045012752265464');" style=""> 264         offers.get(0).setQualifyingItemSubTotal(new Money(99999));                                       </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 265         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span  style=""> 266                                                                                                          </span>
<span class="-2233954948767969133" onmouseenter="enter('-2233954948767969133');" onmouseout="out('-2233954948767969133');" style=""> 267         // Since the item qualification subTotal is not met, the qualified offer size should             </span>
<span class="-2484407164144589249" onmouseenter="enter('-2484407164144589249');" onmouseout="out('-2484407164144589249');" style=""> 268         // be zero.                                                                                      </span>
<span class="5374855092322283448" onmouseenter="enter('5374855092322283448');" onmouseout="out('5374855092322283448');" style=""> 269         assertTrue(qualifiedOffers.size() == 0);                                                         </span>
<span  style=""> 270                                                                                                          </span>
<span  style=""> 271                                                                                                          </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 272         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 273         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 274             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 275             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-6301719950201762066" onmouseenter="enter('-6301719950201762066');" onmouseout="out('-6301719950201762066');" style=""><abbr title=" 276             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 276             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MðŸ”µ</abbr></span>
<span class="800271347213994814" onmouseenter="enter('800271347213994814');" onmouseout="out('800271347213994814');" style=""><abbr title=" 277             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 277             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 278         );                                                                                               </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 279         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span  style=""> 280                                                                                                          </span>
<span class="202008870314622194" onmouseenter="enter('202008870314622194');" onmouseout="out('202008870314622194');" style=""> 281         //test that the invalid order item offer is excluded                                             </span>
<span class="5374855092322283448" onmouseenter="enter('5374855092322283448');" onmouseout="out('5374855092322283448');" style=""> 282         assertTrue(qualifiedOffers.size() == 0);                                                         </span>
<span  style=""> 283                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 284         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285     }                                                                                                    </span>
<span  style=""> 286                                                                                                          </span>
<span class="2350776504190590277" onmouseenter="enter('2350776504190590277');" onmouseout="out('2350776504190590277');" style=""> 287     public void testCouldOfferApplyToOrder() throws Exception {                                          </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 288         replay();                                                                                        </span>
<span  style=""> 289                                                                                                          </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style=""> 290         PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);         </span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 291         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                          </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 292             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 293             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 294             null,                                                                                        </span>
<span class="-4216650843576585517" onmouseenter="enter('-4216650843576585517');" onmouseout="out('-4216650843576585517');" style=""> 295             null                                                                                         </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 296         );                                                                                               </span>
<span  style=""> 297                                                                                                          </span>
<span class="7853971483654053322" onmouseenter="enter('7853971483654053322');" onmouseout="out('7853971483654053322');" style=""><abbr title=" 298         boolean couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderItems().get(0), order.getFulfillmentGroups().get(0));"> 298         boolean couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountðŸ”µ</abbr></span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 299         //test that the valid order item offer is included                                               </span>
<span class="7931914881113900287" onmouseenter="enter('7931914881113900287');" onmouseout="out('7931914881113900287');" style=""> 300         assertTrue(couldApply);                                                                          </span>
<span  style=""> 301                                                                                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 302         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-966907751053524789" onmouseenter="enter('-966907751053524789');" onmouseout="out('-966907751053524789');" style=""> 303             &quot;order.subTotal.getAmount()==0&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 304             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 305             null,                                                                                        </span>
<span class="-4216650843576585517" onmouseenter="enter('-4216650843576585517');" onmouseout="out('-4216650843576585517');" style=""> 306             null                                                                                         </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 307         );                                                                                               </span>
<span class="2583469720888306492" onmouseenter="enter('2583469720888306492');" onmouseout="out('2583469720888306492');" style=""><abbr title=" 308         couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderItems().get(0), order.getFulfillmentGroups().get(0));"> 308         couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrdeðŸ”µ</abbr></span>
<span class="202008870314622194" onmouseenter="enter('202008870314622194');" onmouseout="out('202008870314622194');" style=""> 309         //test that the invalid order item offer is excluded                                             </span>
<span class="2773091290643222945" onmouseenter="enter('2773091290643222945');" onmouseout="out('2773091290643222945');" style=""> 310         assertFalse(couldApply);                                                                         </span>
<span  style=""> 311                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 312         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313     }                                                                                                    </span>
<span  style=""> 314                                                                                                          </span>
<span class="-3815970332732974591" onmouseenter="enter('-3815970332732974591');" onmouseout="out('-3815970332732974591');" style=""> 315     public void testCouldOrderItemMeetOfferRequirement() throws Exception {                              </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 316         replay();                                                                                        </span>
<span  style=""> 317                                                                                                          </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style=""> 318         PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);         </span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 319         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                          </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 320             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 321             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 322             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 322             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 323             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 323             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 324         );                                                                                               </span>
<span  style=""> 325                                                                                                          </span>
<span class="1501673451570831850" onmouseenter="enter('1501673451570831850');" onmouseout="out('1501673451570831850');" style=""><abbr title=" 326         OfferQualifyingCriteriaXref xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next();"> 326         OfferQualifyingCriteriaXref xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next(ðŸ”µ</abbr></span>
<span class="-472249920513934405" onmouseenter="enter('-472249920513934405');" onmouseout="out('-472249920513934405');" style=""><abbr title=" 327         boolean couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.getDiscountableOrderItems().get(0));"> 327         boolean couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria()ðŸ”µ</abbr></span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 328         //test that the valid order item offer is included                                               </span>
<span class="7931914881113900287" onmouseenter="enter('7931914881113900287');" onmouseout="out('7931914881113900287');" style=""> 329         assertTrue(couldApply);                                                                          </span>
<span  style=""> 330                                                                                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 331         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 332             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 333             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-6301719950201762066" onmouseenter="enter('-6301719950201762066');" onmouseout="out('-6301719950201762066');" style=""><abbr title=" 334             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 334             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MðŸ”µ</abbr></span>
<span class="800271347213994814" onmouseenter="enter('800271347213994814');" onmouseout="out('800271347213994814');" style=""><abbr title=" 335             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 335             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 336         );                                                                                               </span>
<span class="2238137642305281390" onmouseenter="enter('2238137642305281390');" onmouseout="out('2238137642305281390');" style=""> 337         xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next();                          </span>
<span class="7022359060345229272" onmouseenter="enter('7022359060345229272');" onmouseout="out('7022359060345229272');" style=""><abbr title=" 338         couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.getDiscountableOrderItems().get(0));"> 338         couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.ðŸ”µ</abbr></span>
<span class="202008870314622194" onmouseenter="enter('202008870314622194');" onmouseout="out('202008870314622194');" style=""> 339         //test that the invalid order item offer is excluded                                             </span>
<span class="2773091290643222945" onmouseenter="enter('2773091290643222945');" onmouseout="out('2773091290643222945');" style=""> 340         assertFalse(couldApply);                                                                         </span>
<span  style=""> 341                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 342         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343     }                                                                                                    </span>
<span  style=""> 344                                                                                                          </span>
<span class="8397400473119507330" onmouseenter="enter('8397400473119507330');" onmouseout="out('8397400473119507330');" style=""> 345     public void testCouldOfferApplyToOrderItems() throws Exception {                                     </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 346         replay();                                                                                        </span>
<span  style=""> 347                                                                                                          </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style=""> 348         PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);         </span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 349         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                          </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 350             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 351             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 352             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 352             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 353             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 353             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 354         );                                                                                               </span>
<span class="-4222545078163101091" onmouseenter="enter('-4222545078163101091');" onmouseout="out('-4222545078163101091');" style=""> 355         List&lt;PromotableOrderItem&gt; orderItems = new ArrayList&lt;PromotableOrderItem&gt;();                     </span>
<span class="-7372483979901719352" onmouseenter="enter('-7372483979901719352');" onmouseout="out('-7372483979901719352');" style=""> 356         for (PromotableOrderItem orderItem : order.getDiscountableOrderItems()) {                        </span>
<span class="5423314879443576267" onmouseenter="enter('5423314879443576267');" onmouseout="out('5423314879443576267');" style=""> 357             orderItems.add(orderItem);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358         }                                                                                                </span>
<span class="8798832722266180533" onmouseenter="enter('8798832722266180533');" onmouseout="out('8798832722266180533');" style=""><abbr title=" 359         CandidatePromotionItems candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), orderItems);"> 359         CandidatePromotionItems candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), ordðŸ”µ</abbr></span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 360         //test that the valid order item offer is included                                               </span>
<span class="-7375750347374851802" onmouseenter="enter('-7375750347374851802');" onmouseout="out('-7375750347374851802');" style=""> 361         //both cart items are valid for qualification and target                                         </span>
<span class="-7973040919570615736" onmouseenter="enter('-7973040919570615736');" onmouseout="out('-7973040919570615736');" style=""><abbr title=" 362         assertTrue(candidates.isMatchedQualifier() &amp;&amp; candidates.getCandidateQualifiersMap().size() == 1 &amp;&amp;"> 362         assertTrue(candidates.isMatchedQualifier() &amp;&amp; candidates.getCandidateQualifiersMap().size() == 1 ðŸ”µ</abbr></span>
<span class="2769824792004949663" onmouseenter="enter('2769824792004949663');" onmouseout="out('2769824792004949663');" style=""> 363                 candidates.getCandidateQualifiersMap().values().iterator().next().size() == 2 &amp;&amp;         </span>
<span class="-2057082480309621191" onmouseenter="enter('-2057082480309621191');" onmouseout="out('-2057082480309621191');" style=""> 364                 candidates.isMatchedTarget() &amp;&amp; candidates.getCandidateTargetsMap().size() == 1 &amp;&amp;       </span>
<span class="2986039361500944684" onmouseenter="enter('2986039361500944684');" onmouseout="out('2986039361500944684');" style=""> 365                 candidates.getCandidateTargetsMap().values().iterator().next().size() == 2);             </span>
<span  style=""> 366                                                                                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 367         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 368             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 369             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-6301719950201762066" onmouseenter="enter('-6301719950201762066');" onmouseout="out('-6301719950201762066');" style=""><abbr title=" 370             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 370             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MðŸ”µ</abbr></span>
<span class="800271347213994814" onmouseenter="enter('800271347213994814');" onmouseout="out('800271347213994814');" style=""><abbr title=" 371             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 371             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 372         );                                                                                               </span>
<span class="-7318029938713023882" onmouseenter="enter('-7318029938713023882');" onmouseout="out('-7318029938713023882');" style=""> 373         candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), orderItems);               </span>
<span class="5723156784615186428" onmouseenter="enter('5723156784615186428');" onmouseout="out('5723156784615186428');" style=""> 374         //test that the invalid order item offer is excluded because there are no qualifying items       </span>
<span class="-265242688274418245" onmouseenter="enter('-265242688274418245');" onmouseout="out('-265242688274418245');" style=""><abbr title=" 375         assertFalse(candidates.isMatchedQualifier() &amp;&amp; candidates.getCandidateQualifiersMap().size() == 1);"> 375         assertFalse(candidates.isMatchedQualifier() &amp;&amp; candidates.getCandidateQualifiersMap().size() == 1ðŸ”µ</abbr></span>
<span  style=""> 376                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 377         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378     }                                                                                                    </span>
<span  style=""> 379                                                                                                          </span>
<span class="-2310379539708411407" onmouseenter="enter('-2310379539708411407');" onmouseout="out('-2310379539708411407');" style=""> 380     private int checkOrderItemOfferAppliedCount(Order order) {                                           </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 381         int count = 0;                                                                                   </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 382         for (OrderItem item : order.getOrderItems()) {                                                   </span>
<span class="773323050474809935" onmouseenter="enter('773323050474809935');" onmouseout="out('773323050474809935');" style=""> 383             for (OrderItemPriceDetail detail : item.getOrderItemPriceDetails()) {                        </span>
<span class="-7653326266832377040" onmouseenter="enter('-7653326266832377040');" onmouseout="out('-7653326266832377040');" style=""><abbr title=" 384                 count = count + (detail.getOrderItemPriceDetailAdjustments().size() * detail.getQuantity());"> 384                 count = count + (detail.getOrderItemPriceDetailAdjustments().size() * detail.getQuantity(ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 385             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 386         }                                                                                                </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 387         return count;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 388     }                                                                                                    </span>
<span  style=""> 389                                                                                                          </span>
<span class="352390873819089414" onmouseenter="enter('352390873819089414');" onmouseout="out('352390873819089414');" style=""> 390     private int checkOrderItemOfferAppliedQuantity(Order order, Offer offer) {                           </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 391         int count = 0;                                                                                   </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 392         for (OrderItem item : order.getOrderItems()) {                                                   </span>
<span class="773323050474809935" onmouseenter="enter('773323050474809935');" onmouseout="out('773323050474809935');" style=""> 393             for (OrderItemPriceDetail detail : item.getOrderItemPriceDetails()) {                        </span>
<span class="-2015743447488247947" onmouseenter="enter('-2015743447488247947');" onmouseout="out('-2015743447488247947');" style=""><abbr title=" 394                 for (OrderItemPriceDetailAdjustment adjustment : detail.getOrderItemPriceDetailAdjustments()) {"> 394                 for (OrderItemPriceDetailAdjustment adjustment : detail.getOrderItemPriceDetailAdjustmentðŸ”µ</abbr></span>
<span class="-6326222561939664995" onmouseenter="enter('-6326222561939664995');" onmouseout="out('-6326222561939664995');" style=""> 395                     if (adjustment.getOffer().getId().equals(offer.getId())) {                           </span>
<span class="6653455861258404903" onmouseenter="enter('6653455861258404903');" onmouseout="out('6653455861258404903');" style=""> 396                         count += detail.getQuantity();                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 398                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 400         }                                                                                                </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 401         return count;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402     }                                                                                                    </span>
<span  style=""> 403                                                                                                          </span>
<span class="8856632786224131584" onmouseenter="enter('8856632786224131584');" onmouseout="out('8856632786224131584');" style=""> 404     private int countPriceDetails(Order order) {                                                         </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 405         int count = 0;                                                                                   </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 406         for (OrderItem item : order.getOrderItems()) {                                                   </span>
<span class="-2490083702571223921" onmouseenter="enter('-2490083702571223921');" onmouseout="out('-2490083702571223921');" style=""> 407             count = count + item.getOrderItemPriceDetails().size();                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 408         }                                                                                                </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 409         return count;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410     }                                                                                                    </span>
<span  style=""> 411                                                                                                          </span>
<span  style=""> 412                                                                                                          </span>
<span class="-7256708927614783311" onmouseenter="enter('-7256708927614783311');" onmouseout="out('-7256708927614783311');" style=""> 413     public void testApplyAllItemOffers() throws Exception {                                              </span>
<span  style=""> 414                                                                                                          </span>
<span  style=""> 415                                                                                                          </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 416         replay();                                                                                        </span>
<span  style=""> 417                                                                                                          </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 418         Order order = dataProvider.createBasicOrder();                                                   </span>
<span  style=""> 419                                                                                                          </span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 420         Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 421             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 422             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 423             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 423             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 424             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 424             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 425         ).get(0);                                                                                        </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 426         offer1.setId(1L);                                                                                </span>
<span  style=""> 427                                                                                                          </span>
<span class="2099956539522342594" onmouseenter="enter('2099956539522342594');" onmouseout="out('2099956539522342594');" style=""> 428         List&lt;Offer&gt; offers = new ArrayList&lt;Offer&gt;();                                                     </span>
<span class="-8212520581628164505" onmouseenter="enter('-8212520581628164505');" onmouseout="out('-8212520581628164505');" style=""> 429         offers.add(offer1);                                                                              </span>
<span  style=""> 430                                                                                                          </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""><abbr title=" 431         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();"> 431         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;(ðŸ”µ</abbr></span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 432         order.updatePrices();                                                                            </span>
<span class="1815029190775922456" onmouseenter="enter('1815029190775922456');" onmouseout="out('1815029190775922456');" style=""> 433         offerService.applyAndSaveOffersToOrder(offers, order);                                           </span>
<span  style=""> 434                                                                                                          </span>
<span class="5029607886283012370" onmouseenter="enter('5029607886283012370');" onmouseout="out('5029607886283012370');" style=""> 435         assertTrue(order.getTotalAdjustmentsValue().getAmount().doubleValue() &gt; 0);                      </span>
<span  style=""> 436                                                                                                          </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 437         order = dataProvider.createBasicOrder();                                                         </span>
<span  style=""> 438                                                                                                          </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 439         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="7246766169005062112" onmouseenter="enter('7246766169005062112');" onmouseout="out('7246766169005062112');" style=""> 440         offer1.setApplyDiscountToSalePrice(false);                                                       </span>
<span class="2600361857999587596" onmouseenter="enter('2600361857999587596');" onmouseout="out('2600361857999587596');" style=""> 441         ((DiscreteOrderItem) order.getOrderItems().get(0)).getSku().setSalePrice(new Money(1D));         </span>
<span class="7325578290287955946" onmouseenter="enter('7325578290287955946');" onmouseout="out('7325578290287955946');" style=""> 442         ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(new Money(1D));         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 443         order.updatePrices();                                                                            </span>
<span class="1815029190775922456" onmouseenter="enter('1815029190775922456');" onmouseout="out('1815029190775922456');" style=""> 444         offerService.applyAndSaveOffersToOrder(offers, order);                                           </span>
<span  style=""> 445                                                                                                          </span>
<span class="-6354950951868192224" onmouseenter="enter('-6354950951868192224');" onmouseout="out('-6354950951868192224');" style=""> 446         assertTrue(order.getTotalAdjustmentsValue().getAmount().doubleValue() == 0);                     </span>
<span  style=""> 447                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 448         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 449     }                                                                                                    </span>
<span  style=""> 450                                                                                                          </span>
<span class="5445671973328535543" onmouseenter="enter('5445671973328535543');" onmouseout="out('5445671973328535543');" style=""> 451     public void testApplyAdjustments() throws Exception {                                                </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 452         replay();                                                                                        </span>
<span  style=""> 453                                                                                                          </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 454         Order order = dataProvider.createBasicOrder();                                                   </span>
<span  style=""> 455                                                                                                          </span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 456         Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 457             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 458             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 459             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 459             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 460             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 460             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 461         ).get(0);                                                                                        </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 462         offer1.setId(1L);                                                                                </span>
<span class="-4071252017012046157" onmouseenter="enter('-4071252017012046157');" onmouseout="out('-4071252017012046157');" style=""> 463         OfferQualifyingCriteriaXref xref = offer1.getQualifyingItemCriteriaXref().iterator().next();     </span>
<span class="-7032540125324645344" onmouseenter="enter('-7032540125324645344');" onmouseout="out('-7032540125324645344');" style=""> 464         xref.getOfferItemCriteria().setQuantity(2);                                                      </span>
<span class="7720028840114078774" onmouseenter="enter('7720028840114078774');" onmouseout="out('7720028840114078774');" style=""> 465         offer1.setCombinableWithOtherOffers(false);                                                      </span>
<span class="-1956075415585459204" onmouseenter="enter('-1956075415585459204');" onmouseout="out('-1956075415585459204');" style=""> 466         Offer offer2 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 467             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 468             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 469             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 469             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 470             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 470             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 471         ).get(0);                                                                                        </span>
<span class="-6767777846149293935" onmouseenter="enter('-6767777846149293935');" onmouseout="out('-6767777846149293935');" style=""> 472         offer2.setId(2L);                                                                                </span>
<span  style=""> 473                                                                                                          </span>
<span class="8631188538838496439" onmouseenter="enter('8631188538838496439');" onmouseout="out('8631188538838496439');" style=""> 474         List&lt;Offer&gt; offerListWithOneOffer = new ArrayList&lt;Offer&gt;();                                      </span>
<span class="-7734009620886563381" onmouseenter="enter('-7734009620886563381');" onmouseout="out('-7734009620886563381');" style=""> 475         offerListWithOneOffer.add(offer1);                                                               </span>
<span  style=""> 476                                                                                                          </span>
<span class="-2645409726359466791" onmouseenter="enter('-2645409726359466791');" onmouseout="out('-2645409726359466791');" style=""> 477         List&lt;Offer&gt; offerListWithTwoOffers = new ArrayList&lt;Offer&gt;();                                     </span>
<span class="-2242941289654799072" onmouseenter="enter('-2242941289654799072');" onmouseout="out('-2242941289654799072');" style=""> 478         offerListWithTwoOffers.add(offer1);                                                              </span>
<span class="-7736021191926792461" onmouseenter="enter('-7736021191926792461');" onmouseout="out('-7736021191926792461');" style=""> 479         offerListWithTwoOffers.add(offer2);                                                              </span>
<span  style=""> 480                                                                                                          </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 481         order.updatePrices();                                                                            </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 482         offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                            </span>
<span class="1819254978181053470" onmouseenter="enter('1819254978181053470');" onmouseout="out('1819254978181053470');" style=""> 483         assertTrue(checkOrderItemOfferAppliedCount(order) == 1);                                         </span>
<span class="-1512986248678261918" onmouseenter="enter('-1512986248678261918');" onmouseout="out('-1512986248678261918');" style=""> 484         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 1);                              </span>
<span  style=""> 485                                                                                                          </span>
<span class="-992574443533108741" onmouseenter="enter('-992574443533108741');" onmouseout="out('-992574443533108741');" style=""> 486         // Add the second offer.   The first was nonCombinable so it should still be 1                   </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 487         order = dataProvider.createBasicOrder();                                                         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 488         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 489         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 490         assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                         </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 491         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                              </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 492         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                              </span>
<span  style=""> 493                                                                                                          </span>
<span  style=""> 494                                                                                                          </span>
<span class="4143880644635780347" onmouseenter="enter('4143880644635780347');" onmouseout="out('4143880644635780347');" style=""> 495         // Reset offer1 to combinable.   Now both should be applied.                                     </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 496         offer1.setCombinableWithOtherOffers(true);                                                       </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 497         order = dataProvider.createBasicOrder();                                                         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 498         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 499         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 500         assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                         </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 501         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                              </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 502         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                              </span>
<span  style=""> 503                                                                                                          </span>
<span class="7464184952874881203" onmouseenter="enter('7464184952874881203');" onmouseout="out('7464184952874881203');" style=""> 504         // Offer 1 back to nonCombinable but don&#x27;t allow discount to the sale price                      </span>
<span class="-1417948014770234923" onmouseenter="enter('-1417948014770234923');" onmouseout="out('-1417948014770234923');" style=""> 505         // and make the sale price a better overall offer                                                </span>
<span class="7720028840114078774" onmouseenter="enter('7720028840114078774');" onmouseout="out('7720028840114078774');" style=""> 506         offer1.setCombinableWithOtherOffers(false);                                                      </span>
<span class="7246766169005062112" onmouseenter="enter('7246766169005062112');" onmouseout="out('7246766169005062112');" style=""> 507         offer1.setApplyDiscountToSalePrice(false);                                                       </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 508         order = dataProvider.createBasicOrder();                                                         </span>
<span class="-5732736595573562244" onmouseenter="enter('-5732736595573562244');" onmouseout="out('-5732736595573562244');" style=""> 509         ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(new Money(10D));        </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 510         order.updatePrices();                                                                            </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 511         offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                            </span>
<span class="-3398637566880609797" onmouseenter="enter('-3398637566880609797');" onmouseout="out('-3398637566880609797');" style=""> 512         assertTrue(checkOrderItemOfferAppliedCount(order) == 0);                                         </span>
<span  style=""> 513                                                                                                          </span>
<span class="1023771780730500424" onmouseenter="enter('1023771780730500424');" onmouseout="out('1023771780730500424');" style=""> 514         // Try again with two offers.   The second should be applied.                                    </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 515         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 516         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 517         assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                         </span>
<span  style=""> 518                                                                                                          </span>
<span class="-1661318026700279078" onmouseenter="enter('-1661318026700279078');" onmouseout="out('-1661318026700279078');" style=""> 519         // Trying with 2nd offer as nonCombinable.                                                       </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 520         offer1.setCombinableWithOtherOffers(true);                                                       </span>
<span class="7546366022368659645" onmouseenter="enter('7546366022368659645');" onmouseout="out('7546366022368659645');" style=""> 521         ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(null);                  </span>
<span class="-7762597468102373652" onmouseenter="enter('-7762597468102373652');" onmouseout="out('-7762597468102373652');" style=""> 522         offer2.setCombinableWithOtherOffers(false);                                                      </span>
<span  style=""> 523                                                                                                          </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 524         order.updatePrices();                                                                            </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 525         offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                            </span>
<span class="1819254978181053470" onmouseenter="enter('1819254978181053470');" onmouseout="out('1819254978181053470');" style=""> 526         assertTrue(checkOrderItemOfferAppliedCount(order) == 1);                                         </span>
<span  style=""> 527                                                                                                          </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 528         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 529         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 530         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                              </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 531         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                              </span>
<span  style=""> 532                                                                                                          </span>
<span class="-4953067338675041826" onmouseenter="enter('-4953067338675041826');" onmouseout="out('-4953067338675041826');" style=""> 533         // Set qualifying criteria quantity to 1                                                         </span>
<span class="2746062014348300811" onmouseenter="enter('2746062014348300811');" onmouseout="out('2746062014348300811');" style=""> 534         // Set qualifying target criteria to 2                                                           </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 535         order = dataProvider.createBasicOrder();                                                         </span>
<span class="-6688543313838783650" onmouseenter="enter('-6688543313838783650');" onmouseout="out('-6688543313838783650');" style=""> 536         xref = offer1.getQualifyingItemCriteriaXref().iterator().next();                                 </span>
<span class="2724580140749596242" onmouseenter="enter('2724580140749596242');" onmouseout="out('2724580140749596242');" style=""> 537         xref.getOfferItemCriteria().setQuantity(1);                                                      </span>
<span  style=""> 538                                                                                                          </span>
<span class="2987053505448788974" onmouseenter="enter('2987053505448788974');" onmouseout="out('2987053505448788974');" style=""> 539         OfferTargetCriteriaXref targetXref = offer1.getTargetItemCriteriaXref().iterator().next();       </span>
<span class="7956044162267364758" onmouseenter="enter('7956044162267364758');" onmouseout="out('7956044162267364758');" style=""> 540         targetXref.getOfferItemCriteria().setQuantity(2);                                                </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 541         order.updatePrices();                                                                            </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 542         offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                            </span>
<span class="-7080380211983716353" onmouseenter="enter('-7080380211983716353');" onmouseout="out('-7080380211983716353');" style=""> 543         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 2);                              </span>
<span  style=""> 544                                                                                                          </span>
<span class="-2183171090813944888" onmouseenter="enter('-2183171090813944888');" onmouseout="out('-2183171090813944888');" style=""> 545         // Reset both offers to combinable and the qualifiers as allowing duplicate QUALIFIERs           </span>
<span class="-2255179946339237317" onmouseenter="enter('-2255179946339237317');" onmouseout="out('-2255179946339237317');" style=""> 546         // and Targets                                                                                   </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 547         offer1.setCombinableWithOtherOffers(true);                                                       </span>
<span class="2527637603040178756" onmouseenter="enter('2527637603040178756');" onmouseout="out('2527637603040178756');" style=""> 548         offer2.setCombinableWithOtherOffers(true);                                                       </span>
<span class="-2476264833911625662" onmouseenter="enter('-2476264833911625662');" onmouseout="out('-2476264833911625662');" style=""> 549         offer1.setOfferItemQualifierRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);             </span>
<span class="-7410686570241782346" onmouseenter="enter('-7410686570241782346');" onmouseout="out('-7410686570241782346');" style=""> 550         offer1.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                </span>
<span class="1961218096433141479" onmouseenter="enter('1961218096433141479');" onmouseout="out('1961218096433141479');" style=""> 551         offer2.setOfferItemQualifierRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);             </span>
<span class="7075569690739658894" onmouseenter="enter('7075569690739658894');" onmouseout="out('7075569690739658894');" style=""> 552         offer2.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 553         order = dataProvider.createBasicOrder();                                                         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 554         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 555         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-7329741501515817260" onmouseenter="enter('-7329741501515817260');" onmouseout="out('-7329741501515817260');" style=""> 556         assertTrue(checkOrderItemOfferAppliedCount(order) == 4);                                         </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 557         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                              </span>
<span class="-7080380211983716353" onmouseenter="enter('-7080380211983716353');" onmouseout="out('-7080380211983716353');" style=""> 558         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 2);                              </span>
<span  style=""> 559                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 560         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 561     }                                                                                                    </span>
<span  style=""> 562                                                                                                          </span>
<span class="1804876492874242702" onmouseenter="enter('1804876492874242702');" onmouseout="out('1804876492874242702');" style=""> 563     public void testApplyItemQualifiersAndTargets() throws Exception {                                   </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 564         replay();                                                                                        </span>
<span  style=""> 565                                                                                                          </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""><abbr title=" 566         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();"> 566         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;(ðŸ”µ</abbr></span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 567         Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 568             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 569             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 570             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 570             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 571             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 571             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 572         ).get(0);                                                                                        </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 573         offer1.setId(1L);                                                                                </span>
<span class="-1956075415585459204" onmouseenter="enter('-1956075415585459204');" onmouseout="out('-1956075415585459204');" style=""> 574         Offer offer2 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 575             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 576             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 577             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 577             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 578             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 578             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 579         ).get(0);                                                                                        </span>
<span class="-6767777846149293935" onmouseenter="enter('-6767777846149293935');" onmouseout="out('-6767777846149293935');" style=""> 580         offer2.setId(2L);                                                                                </span>
<span  style=""> 581                                                                                                          </span>
<span class="-946400959636335360" onmouseenter="enter('-946400959636335360');" onmouseout="out('-946400959636335360');" style=""> 582         OfferTargetCriteriaXref targetXref = offer2.getTargetItemCriteriaXref().iterator().next();       </span>
<span class="-8974993586722209178" onmouseenter="enter('-8974993586722209178');" onmouseout="out('-8974993586722209178');" style=""> 583         targetXref.getOfferItemCriteria().setQuantity(4);                                                </span>
<span class="-7641378772090546772" onmouseenter="enter('-7641378772090546772');" onmouseout="out('-7641378772090546772');" style=""> 584         offer2.getQualifyingItemCriteriaXref().clear();                                                  </span>
<span class="-4860738879403790739" onmouseenter="enter('-4860738879403790739');" onmouseout="out('-4860738879403790739');" style=""> 585         offer2.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.TARGET);                          </span>
<span class="4265078036448799603" onmouseenter="enter('4265078036448799603');" onmouseout="out('4265078036448799603');" style=""> 586         Offer offer3 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 587             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 588             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 589             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 589             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 590             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 590             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 591         ).get(0);                                                                                        </span>
<span  style=""> 592                                                                                                          </span>
<span class="5984499010113424780" onmouseenter="enter('5984499010113424780');" onmouseout="out('5984499010113424780');" style=""><abbr title=" 593         PromotableOrder promotableOrder = dataProvider.createBasicPromotableOrder(promotableOfferUtility);"> 593         PromotableOrder promotableOrder = dataProvider.createBasicPromotableOrder(promotableOfferUtility)ðŸ”µ</abbr></span>
<span class="1609760517765742590" onmouseenter="enter('1609760517765742590');" onmouseout="out('1609760517765742590');" style=""> 594         itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer1);                    </span>
<span class="-8779152254781384438" onmouseenter="enter('-8779152254781384438');" onmouseout="out('-8779152254781384438');" style=""><abbr title=" 595         assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offer1) &amp;&amp; qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1);"> 595         assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offer1) &amp;&amp; quaðŸ”µ</abbr></span>
<span  style=""> 596                                                                                                          </span>
<span class="3664680620844694596" onmouseenter="enter('3664680620844694596');" onmouseout="out('3664680620844694596');" style=""> 597         itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer2);                    </span>
<span class="5658243282537406724" onmouseenter="enter('5658243282537406724');" onmouseout="out('5658243282537406724');" style=""><abbr title=" 598         assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offer2) &amp;&amp; qualifiedOffers.get(1).getCandidateQualifiersMap().size() == 0);"> 598         assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offer2) &amp;&amp; quaðŸ”µ</abbr></span>
<span  style=""> 599                                                                                                          </span>
<span class="-3826912296678151810" onmouseenter="enter('-3826912296678151810');" onmouseout="out('-3826912296678151810');" style=""> 600         itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer3);                    </span>
<span class="1911054944218617418" onmouseenter="enter('1911054944218617418');" onmouseout="out('1911054944218617418');" style=""><abbr title=" 601         assertTrue(qualifiedOffers.size() == 3 &amp;&amp; qualifiedOffers.get(2).getOffer().equals(offer3) &amp;&amp; qualifiedOffers.get(2).getCandidateQualifiersMap().size() == 1);"> 601         assertTrue(qualifiedOffers.size() == 3 &amp;&amp; qualifiedOffers.get(2).getOffer().equals(offer3) &amp;&amp; quaðŸ”µ</abbr></span>
<span  style=""> 602                                                                                                          </span>
<span class="1766810220278806135" onmouseenter="enter('1766810220278806135');" onmouseout="out('1766810220278806135');" style=""><abbr title=" 603         // Try with just the second offer.   Expect to get 4 targets based on the offer having no qualifiers required"> 603         // Try with just the second offer.   Expect to get 4 targets based on the offer having no qualifiðŸ”µ</abbr></span>
<span class="-4912150122214844213" onmouseenter="enter('-4912150122214844213');" onmouseout="out('-4912150122214844213');" style=""> 604         // and targeting category test1 or test2 and that the offer requires 4 target criteria.          </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 605         Order order = dataProvider.createBasicOrder();                                                   </span>
<span class="8583068860005847748" onmouseenter="enter('8583068860005847748');" onmouseout="out('8583068860005847748');" style=""> 606         List&lt;Offer&gt; offerList = new ArrayList&lt;Offer&gt;();                                                  </span>
<span class="3860405318390761830" onmouseenter="enter('3860405318390761830');" onmouseout="out('3860405318390761830');" style=""> 607         offerList.add(offer2);                                                                           </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 608         offerService.applyAndSaveOffersToOrder(offerList, order);                                        </span>
<span class="-8213637320090973795" onmouseenter="enter('-8213637320090973795');" onmouseout="out('-8213637320090973795');" style=""> 609         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 4);                              </span>
<span class="1606234139614227925" onmouseenter="enter('1606234139614227925');" onmouseout="out('1606234139614227925');" style=""> 610         assertTrue(countPriceDetails(order) == 3);                                                       </span>
<span  style=""> 611                                                                                                          </span>
<span class="2040936482538754372" onmouseenter="enter('2040936482538754372');" onmouseout="out('2040936482538754372');" style=""><abbr title=" 612         // Now try with both offers.   Since the targets can be reused, we expect to have 4 targets on offer2 "> 612         // Now try with both offers.   Since the targets can be reused, we expect to have 4 targets on ofðŸ”µ</abbr></span>
<span class="8516822473741223062" onmouseenter="enter('8516822473741223062');" onmouseout="out('8516822473741223062');" style=""> 613         // and 1 target on offer1                                                                        </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 614         order = dataProvider.createBasicOrder();                                                         </span>
<span class="2231055284542614880" onmouseenter="enter('2231055284542614880');" onmouseout="out('2231055284542614880');" style=""> 615         offerList.add(offer1); // add in second offer (which happens to be offer1)                       </span>
<span  style=""> 616                                                                                                          </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 617         offerService.applyAndSaveOffersToOrder(offerList, order);                                        </span>
<span class="-8213637320090973795" onmouseenter="enter('-8213637320090973795');" onmouseout="out('-8213637320090973795');" style=""> 618         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 4);                              </span>
<span class="1606234139614227925" onmouseenter="enter('1606234139614227925');" onmouseout="out('1606234139614227925');" style=""> 619         assertTrue(countPriceDetails(order) == 3);                                                       </span>
<span  style=""> 620                                                                                                          </span>
<span class="-8510477625850873985" onmouseenter="enter('-8510477625850873985');" onmouseout="out('-8510477625850873985');" style=""> 621         // All three offers - offer 3 is now higher priority so the best offer (offer 2) won&#x27;t be applied</span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 622         order = dataProvider.createBasicOrder();                                                         </span>
<span class="-2751996978326205337" onmouseenter="enter('-2751996978326205337');" onmouseout="out('-2751996978326205337');" style=""> 623         offerList.add(offer3); // add in second offer (which happens to be offer1)                       </span>
<span class="3305227095626441424" onmouseenter="enter('3305227095626441424');" onmouseout="out('3305227095626441424');" style=""> 624         offer3.setPriority(-1);                                                                          </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 625         offerService.applyAndSaveOffersToOrder(offerList, order);                                        </span>
<span class="7385283043446040112" onmouseenter="enter('7385283043446040112');" onmouseout="out('7385283043446040112');" style=""> 626         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer3) == 2);                              </span>
<span class="7014092410184079185" onmouseenter="enter('7014092410184079185');" onmouseout="out('7014092410184079185');" style=""> 627         assertTrue(countPriceDetails(order) == 4);                                                       </span>
<span  style=""> 628                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 629         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 630     }                                                                                                    </span>
<span  style=""> 631                                                                                                          </span>
<span class="8243234137390807561" onmouseenter="enter('8243234137390807561');" onmouseout="out('8243234137390807561');" style=""> 632     public class Answer implements IAnswer&lt;CandidateItemOffer&gt; {                                         </span>
<span  style=""> 633                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 634         @Override                                                                                        </span>
<span class="2347184973793483651" onmouseenter="enter('2347184973793483651');" onmouseout="out('2347184973793483651');" style=""> 635         public CandidateItemOffer answer() throws Throwable {                                            </span>
<span class="7644422100596500085" onmouseenter="enter('7644422100596500085');" onmouseout="out('7644422100596500085');" style=""> 636             return new CandidateItemOfferImpl();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 637         }                                                                                                </span>
<span  style=""> 638                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 639     }                                                                                                    </span>
<span  style=""> 640                                                                                                          </span>
<span class="-8622711476449936611" onmouseenter="enter('-8622711476449936611');" onmouseout="out('-8622711476449936611');" style=""> 641     public class Answer2 implements IAnswer&lt;OrderItemAdjustment&gt; {                                       </span>
<span  style=""> 642                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 643         @Override                                                                                        </span>
<span class="4861248105020273136" onmouseenter="enter('4861248105020273136');" onmouseout="out('4861248105020273136');" style=""> 644         public OrderItemAdjustment answer() throws Throwable {                                           </span>
<span class="7697130786892874769" onmouseenter="enter('7697130786892874769');" onmouseout="out('7697130786892874769');" style=""> 645             return new OrderItemAdjustmentImpl();                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 646         }                                                                                                </span>
<span  style=""> 647                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 648     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 649 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-4156106492343801428" onmouseenter="enter('-4156106492343801428');" onmouseout="out('-4156106492343801428');" style="">  18 package org.broadleafcommerce.core.offer.service.processor;                                              </span>
<span  style="">  19                                                                                                          </span>
<span class="-274639712180431568" onmouseenter="enter('-274639712180431568');" onmouseout="out('-274639712180431568');" style="">  20 import org.broadleafcommerce.common.money.Money;                                                         </span>
<span class="-1492144387614747576" onmouseenter="enter('-1492144387614747576');" onmouseout="out('-1492144387614747576');" style="">  21 import org.broadleafcommerce.common.service.GenericEntityService;                                        </span>
<span class="6205208880685044389" onmouseenter="enter('6205208880685044389');" onmouseout="out('6205208880685044389');" style="">  22 import org.broadleafcommerce.core.offer.dao.CustomerOfferDao;                                            </span>
<span class="-7911436562744873568" onmouseenter="enter('-7911436562744873568');" onmouseout="out('-7911436562744873568');" style="">  23 import org.broadleafcommerce.core.offer.dao.OfferCodeDao;                                                </span>
<span class="-2793633202507663758" onmouseenter="enter('-2793633202507663758');" onmouseout="out('-2793633202507663758');" style="">  24 import org.broadleafcommerce.core.offer.dao.OfferDao;                                                    </span>
<span class="4011152823911960428" onmouseenter="enter('4011152823911960428');" onmouseout="out('4011152823911960428');" style="">  25 import org.broadleafcommerce.core.offer.domain.CandidateItemOffer;                                       </span>
<span class="-735428748329738672" onmouseenter="enter('-735428748329738672');" onmouseout="out('-735428748329738672');" style="">  26 import org.broadleafcommerce.core.offer.domain.CandidateItemOfferImpl;                                   </span>
<span class="4081153142019712377" onmouseenter="enter('4081153142019712377');" onmouseout="out('4081153142019712377');" style="">  27 import org.broadleafcommerce.core.offer.domain.Offer;                                                    </span>
<span class="-7025591891527881733" onmouseenter="enter('-7025591891527881733');" onmouseout="out('-7025591891527881733');" style="">  28 import org.broadleafcommerce.core.offer.domain.OfferImpl;                                                </span>
<span class="1133170227846016200" onmouseenter="enter('1133170227846016200');" onmouseout="out('1133170227846016200');" style="">  29 import org.broadleafcommerce.core.offer.domain.OfferQualifyingCriteriaXref;                              </span>
<span class="5060973083944568665" onmouseenter="enter('5060973083944568665');" onmouseout="out('5060973083944568665');" style="">  30 import org.broadleafcommerce.core.offer.domain.OfferTargetCriteriaXref;                                  </span>
<span class="-1124625745990626401" onmouseenter="enter('-1124625745990626401');" onmouseout="out('-1124625745990626401');" style="">  31 import org.broadleafcommerce.core.offer.domain.OrderItemAdjustment;                                      </span>
<span class="-6005336697873394325" onmouseenter="enter('-6005336697873394325');" onmouseout="out('-6005336697873394325');" style="">  32 import org.broadleafcommerce.core.offer.domain.OrderItemAdjustmentImpl;                                  </span>
<span class="6786419255693124735" onmouseenter="enter('6786419255693124735');" onmouseout="out('6786419255693124735');" style="">  33 import org.broadleafcommerce.core.offer.domain.OrderItemPriceDetailAdjustment;                           </span>
<span class="1848619708404770384" onmouseenter="enter('1848619708404770384');" onmouseout="out('1848619708404770384');" style="">  34 import org.broadleafcommerce.core.offer.service.OfferDataItemProvider;                                   </span>
<span class="-6326345691456347408" onmouseenter="enter('-6326345691456347408');" onmouseout="out('-6326345691456347408');" style="">  35 import org.broadleafcommerce.core.offer.service.OfferServiceImpl;                                        </span>
<span class="-3097197529305387536" onmouseenter="enter('-3097197529305387536');" onmouseout="out('-3097197529305387536');" style="">  36 import org.broadleafcommerce.core.offer.service.OfferServiceUtilitiesImpl;                               </span>
<span class="212527052176527689" onmouseenter="enter('212527052176527689');" onmouseout="out('212527052176527689');" style="">  37 import org.broadleafcommerce.core.offer.service.discount.CandidatePromotionItems;                        </span>
<span class="7831481241902679836" onmouseenter="enter('7831481241902679836');" onmouseout="out('7831481241902679836');" style="">  38 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableCandidateItemOffer;            </span>
<span class="-7261038068657094491" onmouseenter="enter('-7261038068657094491');" onmouseout="out('-7261038068657094491');" style="">  39 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableItemFactoryImpl;               </span>
<span class="5738750158392070" onmouseenter="enter('5738750158392070');" onmouseout="out('5738750158392070');" style="">  40 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOfferUtility;                  </span>
<span class="8873929720094471664" onmouseenter="enter('8873929720094471664');" onmouseout="out('8873929720094471664');" style="">  41 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOfferUtilityImpl;              </span>
<span class="-6456406933954769040" onmouseenter="enter('-6456406933954769040');" onmouseout="out('-6456406933954769040');" style="">  42 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOrder;                         </span>
<span class="-7733804833771661823" onmouseenter="enter('-7733804833771661823');" onmouseout="out('-7733804833771661823');" style="">  43 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOrderItem;                     </span>
<span class="-5253725521220244448" onmouseenter="enter('-5253725521220244448');" onmouseout="out('-5253725521220244448');" style="">  44 import org.broadleafcommerce.core.offer.service.type.OfferDiscountType;                                  </span>
<span class="-8068779110760425254" onmouseenter="enter('-8068779110760425254');" onmouseout="out('-8068779110760425254');" style="">  45 import org.broadleafcommerce.core.offer.service.type.OfferItemRestrictionRuleType;                       </span>
<span class="-4951365057913084569" onmouseenter="enter('-4951365057913084569');" onmouseout="out('-4951365057913084569');" style="">  46 import org.broadleafcommerce.core.order.dao.FulfillmentGroupItemDao;                                     </span>
<span class="-7012758821456487335" onmouseenter="enter('-7012758821456487335');" onmouseout="out('-7012758821456487335');" style="">  47 import org.broadleafcommerce.core.order.dao.OrderItemDao;                                                </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  48 import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                        </span>
<span class="-7855842771160128779" onmouseenter="enter('-7855842771160128779');" onmouseout="out('-7855842771160128779');" style="">  49 import org.broadleafcommerce.core.order.domain.FulfillmentGroupItem;                                     </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  50 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  51 import org.broadleafcommerce.core.order.domain.OrderItem;                                                </span>
<span class="230297408131782266" onmouseenter="enter('230297408131782266');" onmouseout="out('230297408131782266');" style="">  52 import org.broadleafcommerce.core.order.domain.OrderItemPriceDetail;                                     </span>
<span class="1218446574017128210" onmouseenter="enter('1218446574017128210');" onmouseout="out('1218446574017128210');" style="">  53 import org.broadleafcommerce.core.order.domain.OrderMultishipOption;                                     </span>
<span class="9050710118625717230" onmouseenter="enter('9050710118625717230');" onmouseout="out('9050710118625717230');" style="">  54 import org.broadleafcommerce.core.order.service.FulfillmentGroupService;                                 </span>
<span class="2043331085843421951" onmouseenter="enter('2043331085843421951');" onmouseout="out('2043331085843421951');" style="">  55 import org.broadleafcommerce.core.order.service.OrderItemService;                                        </span>
<span class="-4438462058374014857" onmouseenter="enter('-4438462058374014857');" onmouseout="out('-4438462058374014857');" style="">  56 import org.broadleafcommerce.core.order.service.OrderMultishipOptionService;                             </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  57 import org.broadleafcommerce.core.order.service.OrderService;                                            </span>
<span class="426062199469058864" onmouseenter="enter('426062199469058864');" onmouseout="out('426062199469058864');" style="">  58 import org.broadleafcommerce.core.order.service.call.FulfillmentGroupItemRequest;                        </span>
<span class="8043089028015557901" onmouseenter="enter('8043089028015557901');" onmouseout="out('8043089028015557901');" style="">  59 import org.easymock.EasyMock;                                                                            </span>
<span class="8773851019359685182" onmouseenter="enter('8773851019359685182');" onmouseout="out('8773851019359685182');" style="">  60 import org.easymock.IAnswer;                                                                             </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  61 import java.util.ArrayList;                                                                              </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  62 import java.util.List;                                                                                   </span>
<span class="-3682115440535733483" onmouseenter="enter('-3682115440535733483');" onmouseout="out('-3682115440535733483');" style="">  63 import java.util.TimeZone;                                                                               </span>
<span  style="">  64                                                                                                          </span>
<span class="5589978463048615898" onmouseenter="enter('5589978463048615898');" onmouseout="out('5589978463048615898');" style="">  65 import junit.framework.TestCase;                                                                         </span>
<span  style="">  66                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  67 /**                                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  68  *                                                                                                       </span>
<span class="3104529581940833663" onmouseenter="enter('3104529581940833663');" onmouseout="out('3104529581940833663');" style="">  69  * @author jfischer                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  70  *                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  71  */                                                                                                      </span>
<span class="-2169245893345022929" onmouseenter="enter('-2169245893345022929');" onmouseout="out('-2169245893345022929');" style="">  72 public class ItemOfferProcessorTest extends TestCase {                                                   </span>
<span  style="">  73                                                                                                          </span>
<span class="2764411618740579830" onmouseenter="enter('2764411618740579830');" onmouseout="out('2764411618740579830');" style="">  74     protected OfferDao offerDaoMock;                                                                     </span>
<span class="-1028825014202044443" onmouseenter="enter('-1028825014202044443');" onmouseout="out('-1028825014202044443');" style="">  75     protected OrderItemDao orderItemDaoMock;                                                             </span>
<span class="-5369679977326057444" onmouseenter="enter('-5369679977326057444');" onmouseout="out('-5369679977326057444');" style="">  76     protected OrderService orderServiceMock;                                                             </span>
<span class="3942591246150891792" onmouseenter="enter('3942591246150891792');" onmouseout="out('3942591246150891792');" style="">  77     protected OfferServiceImpl offerService;                                                             </span>
<span class="-2082308031004269425" onmouseenter="enter('-2082308031004269425');" onmouseout="out('-2082308031004269425');" style="">  78     protected OrderItemService orderItemServiceMock;                                                     </span>
<span class="8143262996519322151" onmouseenter="enter('8143262996519322151');" onmouseout="out('8143262996519322151');" style="">  79     protected FulfillmentGroupItemDao fgItemDaoMock;                                                     </span>
<span class="7756339209203921246" onmouseenter="enter('7756339209203921246');" onmouseout="out('7756339209203921246');" style="">  80     protected OfferDataItemProvider dataProvider = new OfferDataItemProvider();                          </span>
<span class="3331618624366763309" onmouseenter="enter('3331618624366763309');" onmouseout="out('3331618624366763309');" style="">  81     protected FulfillmentGroupService fgServiceMock;                                                     </span>
<span class="2038085072144601851" onmouseenter="enter('2038085072144601851');" onmouseout="out('2038085072144601851');" style="">  82     protected OrderMultishipOptionService multishipOptionServiceMock;                                    </span>
<span class="1636757603740185885" onmouseenter="enter('1636757603740185885');" onmouseout="out('1636757603740185885');" style="">  83     protected OfferTimeZoneProcessor offerTimeZoneProcessorMock;                                         </span>
<span class="-363767546438432308" onmouseenter="enter('-363767546438432308');" onmouseout="out('-363767546438432308');" style="">  84     protected PromotableOfferUtility promotableOfferUtility;                                             </span>
<span class="8126767976686599164" onmouseenter="enter('8126767976686599164');" onmouseout="out('8126767976686599164');" style="">  85     protected GenericEntityService genericEntityServiceMock;                                             </span>
<span  style="">  86                                                                                                          </span>
<span class="-3472214566962333184" onmouseenter="enter('-3472214566962333184');" onmouseout="out('-3472214566962333184');" style="">  87     protected ItemOfferProcessorImpl itemProcessor;                                                      </span>
<span  style="">  88                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  89     @Override                                                                                            </span>
<span class="2289017037938349582" onmouseenter="enter('2289017037938349582');" onmouseout="out('2289017037938349582');" style="">  90     protected void setUp() throws Exception {                                                            </span>
<span  style="">  91                                                                                                          </span>
<span class="-5376116141285812671" onmouseenter="enter('-5376116141285812671');" onmouseout="out('-5376116141285812671');" style="">  92         CustomerOfferDao customerOfferDaoMock = EasyMock.createMock(CustomerOfferDao.class);             </span>
<span class="-570975167499705701" onmouseenter="enter('-570975167499705701');" onmouseout="out('-570975167499705701');" style="">  93         OfferCodeDao offerCodeDaoMock = EasyMock.createMock(OfferCodeDao.class);                         </span>
<span class="3258640190833853601" onmouseenter="enter('3258640190833853601');" onmouseout="out('3258640190833853601');" style="">  94         offerDaoMock = EasyMock.createMock(OfferDao.class);                                              </span>
<span class="7274735973437056507" onmouseenter="enter('7274735973437056507');" onmouseout="out('7274735973437056507');" style="">  95         orderItemDaoMock = EasyMock.createMock(OrderItemDao.class);                                      </span>
<span class="393627947078248392" onmouseenter="enter('393627947078248392');" onmouseout="out('393627947078248392');" style="">  96         orderServiceMock = EasyMock.createMock(OrderService.class);                                      </span>
<span class="1993264780541814880" onmouseenter="enter('1993264780541814880');" onmouseout="out('1993264780541814880');" style="">  97         orderItemServiceMock = EasyMock.createMock(OrderItemService.class);                              </span>
<span class="-3213369057155598174" onmouseenter="enter('-3213369057155598174');" onmouseout="out('-3213369057155598174');" style="">  98         fgItemDaoMock = EasyMock.createMock(FulfillmentGroupItemDao.class);                              </span>
<span class="6964150545963317885" onmouseenter="enter('6964150545963317885');" onmouseout="out('6964150545963317885');" style="">  99         fgServiceMock = EasyMock.createMock(FulfillmentGroupService.class);                              </span>
<span class="-3871783238737974896" onmouseenter="enter('-3871783238737974896');" onmouseout="out('-3871783238737974896');" style=""> 100         multishipOptionServiceMock = EasyMock.createMock(OrderMultishipOptionService.class);             </span>
<span class="-3280473616402059983" onmouseenter="enter('-3280473616402059983');" onmouseout="out('-3280473616402059983');" style=""> 101         offerTimeZoneProcessorMock = EasyMock.createMock(OfferTimeZoneProcessor.class);                  </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 102 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-5708051595893590327" onmouseenter="enter('-5708051595893590327');" onmouseout="out('-5708051595893590327');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103         promotableOfferUtility = new PromotableOfferUtilityImpl();                                       </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 104 ||||||| BASE                                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 106 =======                                                                                                  </span>
<span class="-8978123556236380411" onmouseenter="enter('-8978123556236380411');" onmouseout="out('-8978123556236380411');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107         genericEntityServiceMock = EasyMock.createMock(GenericEntityService.class);                      </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 108 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 109                                                                                                          </span>
<span  style=""> 110                                                                                                          </span>
<span class="3514247750798048226" onmouseenter="enter('3514247750798048226');" onmouseout="out('3514247750798048226');" style=""><abbr title=" 111         OfferServiceUtilitiesImpl offerServiceUtilities = new OfferServiceUtilitiesImpl(promotableOfferUtility);"> 111         OfferServiceUtilitiesImpl offerServiceUtilities = new OfferServiceUtilitiesImpl(promotableOfferUtðŸ”µ</abbr></span>
<span class="4393308911552043332" onmouseenter="enter('4393308911552043332');" onmouseout="out('4393308911552043332');" style=""> 112         offerServiceUtilities.setOfferDao(offerDaoMock);                                                 </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 113 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7561232175961587910" onmouseenter="enter('7561232175961587910');" onmouseout="out('7561232175961587910');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 114         offerServiceUtilities.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));"> 114         offerServiceUtilities.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtiliðŸ”µ</abbr></span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 115 ||||||| BASE                                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116                                                                                                          </span>
<span class="-3017287549985506064" onmouseenter="enter('-3017287549985506064');" onmouseout="out('-3017287549985506064');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117         itemProcessor = new ItemOfferProcessorImpl();                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 118 =======                                                                                                  </span>
<span class="8672470870156482430" onmouseenter="enter('8672470870156482430');" onmouseout="out('8672470870156482430');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119         offerServiceUtilities.setPromotableItemFactory(new PromotableItemFactoryImpl());                 </span>
<span class="8346807884110674152" onmouseenter="enter('8346807884110674152');" onmouseout="out('8346807884110674152');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120         offerServiceUtilities.setGenericEntityService(genericEntityServiceMock);                         </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 121 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 122                                                                                                          </span>
<span class="-5954143808619933939" onmouseenter="enter('-5954143808619933939');" onmouseout="out('-5954143808619933939');" style=""> 123         itemProcessor = new ItemOfferProcessorImpl(promotableOfferUtility);                              </span>
<span class="-7004957386218896406" onmouseenter="enter('-7004957386218896406');" onmouseout="out('-7004957386218896406');" style=""> 124         itemProcessor.setOfferDao(offerDaoMock);                                                         </span>
<span class="-7985735156898326914" onmouseenter="enter('-7985735156898326914');" onmouseout="out('-7985735156898326914');" style=""> 125         itemProcessor.setOrderItemDao(orderItemDaoMock);                                                 </span>
<span class="-4628842602683269361" onmouseenter="enter('-4628842602683269361');" onmouseout="out('-4628842602683269361');" style=""> 126         itemProcessor.setOfferTimeZoneProcessor(offerTimeZoneProcessorMock);                             </span>
<span class="-2793185480423849018" onmouseenter="enter('-2793185480423849018');" onmouseout="out('-2793185480423849018');" style=""> 127         itemProcessor.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));   </span>
<span class="1873271206223196651" onmouseenter="enter('1873271206223196651');" onmouseout="out('1873271206223196651');" style=""> 128         itemProcessor.setOfferServiceUtilities(offerServiceUtilities);                                   </span>
<span  style=""> 129                                                                                                          </span>
<span class="-7001064742117532685" onmouseenter="enter('-7001064742117532685');" onmouseout="out('-7001064742117532685');" style=""> 130         offerService = new OfferServiceImpl();                                                           </span>
<span  style=""> 131                                                                                                          </span>
<span class="-7168324839350089956" onmouseenter="enter('-7168324839350089956');" onmouseout="out('-7168324839350089956');" style=""> 132         OrderOfferProcessorImpl orderProcessor = new OrderOfferProcessorImpl(promotableOfferUtility);    </span>
<span class="-8216532080679576302" onmouseenter="enter('-8216532080679576302');" onmouseout="out('-8216532080679576302');" style=""> 133         orderProcessor.setOfferDao(offerDaoMock);                                                        </span>
<span class="5575229934633988866" onmouseenter="enter('5575229934633988866');" onmouseout="out('5575229934633988866');" style=""> 134         orderProcessor.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));  </span>
<span class="-4588344466186947569" onmouseenter="enter('-4588344466186947569');" onmouseout="out('-4588344466186947569');" style=""> 135         orderProcessor.setOfferTimeZoneProcessor(offerTimeZoneProcessorMock);                            </span>
<span class="-7787408525763214442" onmouseenter="enter('-7787408525763214442');" onmouseout="out('-7787408525763214442');" style=""> 136         orderProcessor.setOrderItemDao(orderItemDaoMock);                                                </span>
<span class="-8932862412317704790" onmouseenter="enter('-8932862412317704790');" onmouseout="out('-8932862412317704790');" style=""> 137         orderProcessor.setOfferServiceUtilities(offerServiceUtilities);                                  </span>
<span  style=""> 138                                                                                                          </span>
<span class="-7594314374485898167" onmouseenter="enter('-7594314374485898167');" onmouseout="out('-7594314374485898167');" style=""> 139         offerService.setCustomerOfferDao(customerOfferDaoMock);                                          </span>
<span class="483175997286853822" onmouseenter="enter('483175997286853822');" onmouseout="out('483175997286853822');" style=""> 140         offerService.setOfferCodeDao(offerCodeDaoMock);                                                  </span>
<span class="-157638129368187663" onmouseenter="enter('-157638129368187663');" onmouseout="out('-157638129368187663');" style=""> 141         offerService.setOfferDao(offerDaoMock);                                                          </span>
<span class="-2861300639666845512" onmouseenter="enter('-2861300639666845512');" onmouseout="out('-2861300639666845512');" style=""> 142         offerService.setOrderOfferProcessor(orderProcessor);                                             </span>
<span class="4668119620018038426" onmouseenter="enter('4668119620018038426');" onmouseout="out('4668119620018038426');" style=""> 143         offerService.setItemOfferProcessor(itemProcessor);                                               </span>
<span class="-2798583477021709202" onmouseenter="enter('-2798583477021709202');" onmouseout="out('-2798583477021709202');" style=""> 144         offerService.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));    </span>
<span class="-7013122243510448528" onmouseenter="enter('-7013122243510448528');" onmouseout="out('-7013122243510448528');" style=""> 145         offerService.setOrderService(orderServiceMock);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146     }                                                                                                    </span>
<span  style=""> 147                                                                                                          </span>
<span class="-425214870767341244" onmouseenter="enter('-425214870767341244');" onmouseout="out('-425214870767341244');" style=""> 148     public void replay() throws Exception {                                                              </span>
<span class="3688914841313020601" onmouseenter="enter('3688914841313020601');" onmouseout="out('3688914841313020601');" style=""><abbr title=" 149         EasyMock.expect(orderItemDaoMock.createOrderItemPriceDetail()).andAnswer(OfferDataItemProvider.getCreateOrderItemPriceDetailAnswer()).anyTimes();"> 149         EasyMock.expect(orderItemDaoMock.createOrderItemPriceDetail()).andAnswer(OfferDataItemProvider.geðŸ”µ</abbr></span>
<span class="-201012827833234886" onmouseenter="enter('-201012827833234886');" onmouseout="out('-201012827833234886');" style=""><abbr title=" 150         EasyMock.expect(orderItemDaoMock.createOrderItemQualifier()).andAnswer(OfferDataItemProvider.getCreateOrderItemQualifierAnswer()).anyTimes();"> 150         EasyMock.expect(orderItemDaoMock.createOrderItemQualifier()).andAnswer(OfferDataItemProvider.getCðŸ”µ</abbr></span>
<span class="3313434268437563429" onmouseenter="enter('3313434268437563429');" onmouseout="out('3313434268437563429');" style=""><abbr title=" 151         EasyMock.expect(offerDaoMock.createOrderItemPriceDetailAdjustment()).andAnswer(OfferDataItemProvider.getCreateOrderItemPriceDetailAdjustmentAnswer()).anyTimes();"> 151         EasyMock.expect(offerDaoMock.createOrderItemPriceDetailAdjustment()).andAnswer(OfferDataItemProviðŸ”µ</abbr></span>
<span  style=""> 152                                                                                                          </span>
<span class="-4805711593793558927" onmouseenter="enter('-4805711593793558927');" onmouseout="out('-4805711593793558927');" style=""><abbr title=" 153         EasyMock.expect(fgServiceMock.addItemToFulfillmentGroup(EasyMock.isA(FulfillmentGroupItemRequest.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getAddItemToFulfillmentGroupAnswer()).anyTimes();"> 153         EasyMock.expect(fgServiceMock.addItemToFulfillmentGroup(EasyMock.isA(FulfillmentGroupItemRequest.ðŸ”µ</abbr></span>
<span class="-4648578783612235576" onmouseenter="enter('-4648578783612235576');" onmouseout="out('-4648578783612235576');" style=""><abbr title=" 154         EasyMock.expect(orderServiceMock.removeItem(EasyMock.isA(Long.class), EasyMock.isA(Long.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getRemoveItemFromOrderAnswer()).anyTimes();"> 154         EasyMock.expect(orderServiceMock.removeItem(EasyMock.isA(Long.class), EasyMock.isA(Long.class), EðŸ”µ</abbr></span>
<span class="-25100646963641968" onmouseenter="enter('-25100646963641968');" onmouseout="out('-25100646963641968');" style=""><abbr title=" 155         EasyMock.expect(orderServiceMock.save(EasyMock.isA(Order.class), EasyMock.isA(Boolean.class))).andAnswer(OfferDataItemProvider.getSaveOrderAnswer()).anyTimes();"> 155         EasyMock.expect(orderServiceMock.save(EasyMock.isA(Order.class), EasyMock.isA(Boolean.class))).anðŸ”µ</abbr></span>
<span  style=""> 156                                                                                                          </span>
<span class="2160564019413082164" onmouseenter="enter('2160564019413082164');" onmouseout="out('2160564019413082164');" style=""> 157         EasyMock.expect(orderServiceMock.getAutomaticallyMergeLikeItems()).andReturn(true).anyTimes();   </span>
<span  style=""> 158                                                                                                          </span>
<span class="-8884522234726007395" onmouseenter="enter('-8884522234726007395');" onmouseout="out('-8884522234726007395');" style=""><abbr title=" 159         EasyMock.expect(orderItemServiceMock.saveOrderItem(EasyMock.isA(OrderItem.class))).andAnswer(OfferDataItemProvider.getSaveOrderItemAnswer()).anyTimes();"> 159         EasyMock.expect(orderItemServiceMock.saveOrderItem(EasyMock.isA(OrderItem.class))).andAnswer(OffeðŸ”µ</abbr></span>
<span class="-3554631046904274751" onmouseenter="enter('-3554631046904274751');" onmouseout="out('-3554631046904274751');" style=""><abbr title=" 160         EasyMock.expect(fgItemDaoMock.save(EasyMock.isA(FulfillmentGroupItem.class))).andAnswer(OfferDataItemProvider.getSaveFulfillmentGroupItemAnswer()).anyTimes();"> 160         EasyMock.expect(fgItemDaoMock.save(EasyMock.isA(FulfillmentGroupItem.class))).andAnswer(OfferDataðŸ”µ</abbr></span>
<span  style=""> 161                                                                                                          </span>
<span class="2031702441279524669" onmouseenter="enter('2031702441279524669');" onmouseout="out('2031702441279524669');" style=""><abbr title=" 162         EasyMock.expect(multishipOptionServiceMock.findOrderMultishipOptions(EasyMock.isA(Long.class))).andAnswer(new IAnswer&lt;List&lt;OrderMultishipOption&gt;&gt;() {"> 162         EasyMock.expect(multishipOptionServiceMock.findOrderMultishipOptions(EasyMock.isA(Long.class))).aðŸ”µ</abbr></span>
<span  style=""> 163                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 164             @Override                                                                                    </span>
<span class="4982536128511672004" onmouseenter="enter('4982536128511672004');" onmouseout="out('4982536128511672004');" style=""> 165             public List&lt;OrderMultishipOption&gt; answer() throws Throwable {                                </span>
<span class="4748136149545123859" onmouseenter="enter('4748136149545123859');" onmouseout="out('4748136149545123859');" style=""> 166                 return new ArrayList&lt;OrderMultishipOption&gt;();                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167             }                                                                                            </span>
<span class="-8356082990236199220" onmouseenter="enter('-8356082990236199220');" onmouseout="out('-8356082990236199220');" style=""> 168         }).anyTimes();                                                                                   </span>
<span  style=""> 169                                                                                                          </span>
<span class="5730763888734231228" onmouseenter="enter('5730763888734231228');" onmouseout="out('5730763888734231228');" style=""> 170         multishipOptionServiceMock.deleteAllOrderMultishipOptions(EasyMock.isA(Order.class));            </span>
<span class="-238683341484251031" onmouseenter="enter('-238683341484251031');" onmouseout="out('-238683341484251031');" style=""> 171         EasyMock.expectLastCall().anyTimes();                                                            </span>
<span class="3680375331985361488" onmouseenter="enter('3680375331985361488');" onmouseout="out('3680375331985361488');" style=""><abbr title=" 172         EasyMock.expect(fgServiceMock.collapseToOneShippableFulfillmentGroup(EasyMock.isA(Order.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getSameOrderAnswer()).anyTimes();"> 172         EasyMock.expect(fgServiceMock.collapseToOneShippableFulfillmentGroup(EasyMock.isA(Order.class), EðŸ”µ</abbr></span>
<span class="7005207656442723333" onmouseenter="enter('7005207656442723333');" onmouseout="out('7005207656442723333');" style=""><abbr title=" 173         EasyMock.expect(fgItemDaoMock.create()).andAnswer(OfferDataItemProvider.getCreateFulfillmentGroupItemAnswer()).anyTimes();"> 173         EasyMock.expect(fgItemDaoMock.create()).andAnswer(OfferDataItemProvider.getCreateFulfillmentGroupðŸ”µ</abbr></span>
<span class="3552856255510166668" onmouseenter="enter('3552856255510166668');" onmouseout="out('3552856255510166668');" style=""> 174         fgItemDaoMock.delete(EasyMock.isA(FulfillmentGroupItem.class));                                  </span>
<span class="-238683341484251031" onmouseenter="enter('-238683341484251031');" onmouseout="out('-238683341484251031');" style=""> 175         EasyMock.expectLastCall().anyTimes();                                                            </span>
<span class="602433099109498087" onmouseenter="enter('602433099109498087');" onmouseout="out('602433099109498087');" style=""><abbr title=" 176         EasyMock.expect(offerTimeZoneProcessorMock.getTimeZone(EasyMock.isA(OfferImpl.class))).andReturn(TimeZone.getTimeZone(&quot;CST&quot;)).anyTimes();"> 176         EasyMock.expect(offerTimeZoneProcessorMock.getTimeZone(EasyMock.isA(OfferImpl.class))).andReturn(ðŸ”µ</abbr></span>
<span  style=""> 177                                                                                                          </span>
<span class="4039967104390893601" onmouseenter="enter('4039967104390893601');" onmouseout="out('4039967104390893601');" style=""> 178         EasyMock.replay(offerDaoMock);                                                                   </span>
<span class="-8438798452743116996" onmouseenter="enter('-8438798452743116996');" onmouseout="out('-8438798452743116996');" style=""> 179         EasyMock.replay(orderItemDaoMock);                                                               </span>
<span class="-306516478140011318" onmouseenter="enter('-306516478140011318');" onmouseout="out('-306516478140011318');" style=""> 180         EasyMock.replay(orderServiceMock);                                                               </span>
<span class="-1764805494951210013" onmouseenter="enter('-1764805494951210013');" onmouseout="out('-1764805494951210013');" style=""> 181         EasyMock.replay(orderItemServiceMock);                                                           </span>
<span class="1127149787736159594" onmouseenter="enter('1127149787736159594');" onmouseout="out('1127149787736159594');" style=""> 182         EasyMock.replay(fgItemDaoMock);                                                                  </span>
<span class="220377317211655869" onmouseenter="enter('220377317211655869');" onmouseout="out('220377317211655869');" style=""> 183         EasyMock.replay(fgServiceMock);                                                                  </span>
<span class="7141248576860687210" onmouseenter="enter('7141248576860687210');" onmouseout="out('7141248576860687210');" style=""> 184         EasyMock.replay(multishipOptionServiceMock);                                                     </span>
<span class="1625398624145697967" onmouseenter="enter('1625398624145697967');" onmouseout="out('1625398624145697967');" style=""> 185         EasyMock.replay(offerTimeZoneProcessorMock);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186     }                                                                                                    </span>
<span  style=""> 187                                                                                                          </span>
<span class="6267001839391766981" onmouseenter="enter('6267001839391766981');" onmouseout="out('6267001839391766981');" style=""> 188     public void verify() {                                                                               </span>
<span class="6756940960390862422" onmouseenter="enter('6756940960390862422');" onmouseout="out('6756940960390862422');" style=""> 189         EasyMock.verify(offerDaoMock);                                                                   </span>
<span class="-5117344946758939057" onmouseenter="enter('-5117344946758939057');" onmouseout="out('-5117344946758939057');" style=""> 190         EasyMock.verify(orderItemDaoMock);                                                               </span>
<span class="-6538245312297088944" onmouseenter="enter('-6538245312297088944');" onmouseout="out('-6538245312297088944');" style=""> 191         EasyMock.verify(orderServiceMock);                                                               </span>
<span class="4656187310788509663" onmouseenter="enter('4656187310788509663');" onmouseout="out('4656187310788509663');" style=""> 192         EasyMock.verify(orderItemServiceMock);                                                           </span>
<span class="-3344344690958109982" onmouseenter="enter('-3344344690958109982');" onmouseout="out('-3344344690958109982');" style=""> 193         EasyMock.verify(fgItemDaoMock);                                                                  </span>
<span class="-7107457974865616724" onmouseenter="enter('-7107457974865616724');" onmouseout="out('-7107457974865616724');" style=""> 194         EasyMock.verify(fgServiceMock);                                                                  </span>
<span class="3082501288673197520" onmouseenter="enter('3082501288673197520');" onmouseout="out('3082501288673197520');" style=""> 195         EasyMock.verify(multishipOptionServiceMock);                                                     </span>
<span class="8968216054532738001" onmouseenter="enter('8968216054532738001');" onmouseout="out('8968216054532738001');" style=""> 196         EasyMock.verify(offerTimeZoneProcessorMock);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197     }                                                                                                    </span>
<span  style=""> 198                                                                                                          </span>
<span class="4417344074261065537" onmouseenter="enter('4417344074261065537');" onmouseout="out('4417344074261065537');" style=""> 199     public void testFilterItemLevelOffer() throws Exception {                                            </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 200         replay();                                                                                        </span>
<span  style=""> 201                                                                                                          </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""><abbr title=" 202         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();"> 202         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;(ðŸ”µ</abbr></span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 203         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                          </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 204             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 205                 OfferDiscountType.PERCENT_OFF,                                                           </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 206             null,                                                                                        </span>
<span class="-4216650843576585517" onmouseenter="enter('-4216650843576585517');" onmouseout="out('-4216650843576585517');" style=""> 207             null                                                                                         </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 208         );                                                                                               </span>
<span  style=""> 209                                                                                                          </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style=""> 210         PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);         </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 211         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span  style=""> 212                                                                                                          </span>
<span class="8849096113443711736" onmouseenter="enter('8849096113443711736');" onmouseout="out('8849096113443711736');" style=""> 213         //test that the valid order item offer is included - legacy format - no qualifier                </span>
<span class="5326116414476463681" onmouseenter="enter('5326116414476463681');" onmouseout="out('5326116414476463681');" style=""> 214         //since there&#x27;s no qualifier, both items can apply                                               </span>
<span class="8674824753424198113" onmouseenter="enter('8674824753424198113');" onmouseout="out('8674824753424198113');" style=""> 215         // This line is commented out because we are no longer creating legacy offers.                   </span>
<span class="4622569814719673082" onmouseenter="enter('4622569814719673082');" onmouseout="out('4622569814719673082');" style=""><abbr title=" 216         //assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offers.get(0)));"> 216         //assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0ðŸ”µ</abbr></span>
<span  style=""> 217                                                                                                          </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 218         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 219         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 220             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 221             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 222             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 222             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 223             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 223             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 224         );                                                                                               </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 225         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span  style=""> 226                                                                                                          </span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 227         //test that the valid order item offer is included                                               </span>
<span class="3764014390603703627" onmouseenter="enter('3764014390603703627');" onmouseout="out('3764014390603703627');" style=""><abbr title=" 228         //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one qualifier in the qualifiers map"> 228         //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be ðŸ”µ</abbr></span>
<span class="6792085890314091009" onmouseenter="enter('6792085890314091009');" onmouseout="out('6792085890314091009');" style=""> 229         //we don&#x27;t know the targets yet, so there&#x27;s only one CandidateItemOffer for now                  </span>
<span class="-7187194290173616188" onmouseenter="enter('-7187194290173616188');" onmouseout="out('-7187194290173616188');" style=""><abbr title=" 230         assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1);"> 230         assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0))ðŸ”µ</abbr></span>
<span  style=""> 231                                                                                                          </span>
<span class="-8860615526139513207" onmouseenter="enter('-8860615526139513207');" onmouseout="out('-8860615526139513207');" style=""> 232         // Add a subtotal requirement that will be met by the item offer.                                </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 233         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 234         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 235             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 236             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 237             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 237             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 238             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 238             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 239         );                                                                                               </span>
<span  style=""> 240                                                                                                          </span>
<span class="8674510659006467642" onmouseenter="enter('8674510659006467642');" onmouseout="out('8674510659006467642');" style=""> 241         offers.get(0).setQualifyingItemSubTotal(new Money(1));                                           </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 242         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span  style=""> 243                                                                                                          </span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 244         //test that the valid order item offer is included                                               </span>
<span class="3764014390603703627" onmouseenter="enter('3764014390603703627');" onmouseout="out('3764014390603703627');" style=""><abbr title=" 245         //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one qualifier in the qualifiers map"> 245         //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be ðŸ”µ</abbr></span>
<span class="6792085890314091009" onmouseenter="enter('6792085890314091009');" onmouseout="out('6792085890314091009');" style=""> 246         //we don&#x27;t know the targets yet, so there&#x27;s only one CandidateItemOffer for now                  </span>
<span class="-7187194290173616188" onmouseenter="enter('-7187194290173616188');" onmouseout="out('-7187194290173616188');" style=""><abbr title=" 247         assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1);"> 247         assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0))ðŸ”µ</abbr></span>
<span  style=""> 248                                                                                                          </span>
<span  style=""> 249                                                                                                          </span>
<span class="5301041827655263880" onmouseenter="enter('5301041827655263880');" onmouseout="out('5301041827655263880');" style=""> 250         // Add a subtotal requirement that will not be met by the item offer.                            </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 251         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 252         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 253             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 254             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 255             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 255             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 256             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 256             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 257         );                                                                                               </span>
<span  style=""> 258                                                                                                          </span>
<span class="1138045012752265464" onmouseenter="enter('1138045012752265464');" onmouseout="out('1138045012752265464');" style=""> 259         offers.get(0).setQualifyingItemSubTotal(new Money(99999));                                       </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 260         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span  style=""> 261                                                                                                          </span>
<span class="-2233954948767969133" onmouseenter="enter('-2233954948767969133');" onmouseout="out('-2233954948767969133');" style=""> 262         // Since the item qualification subTotal is not met, the qualified offer size should             </span>
<span class="-2484407164144589249" onmouseenter="enter('-2484407164144589249');" onmouseout="out('-2484407164144589249');" style=""> 263         // be zero.                                                                                      </span>
<span class="5374855092322283448" onmouseenter="enter('5374855092322283448');" onmouseout="out('5374855092322283448');" style=""> 264         assertTrue(qualifiedOffers.size() == 0);                                                         </span>
<span  style=""> 265                                                                                                          </span>
<span  style=""> 266                                                                                                          </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 267         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 268         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 269             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 270             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-6301719950201762066" onmouseenter="enter('-6301719950201762066');" onmouseout="out('-6301719950201762066');" style=""><abbr title=" 271             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 271             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MðŸ”µ</abbr></span>
<span class="800271347213994814" onmouseenter="enter('800271347213994814');" onmouseout="out('800271347213994814');" style=""><abbr title=" 272             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 272             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 273         );                                                                                               </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 274         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span  style=""> 275                                                                                                          </span>
<span class="202008870314622194" onmouseenter="enter('202008870314622194');" onmouseout="out('202008870314622194');" style=""> 276         //test that the invalid order item offer is excluded                                             </span>
<span class="5374855092322283448" onmouseenter="enter('5374855092322283448');" onmouseout="out('5374855092322283448');" style=""> 277         assertTrue(qualifiedOffers.size() == 0);                                                         </span>
<span  style=""> 278                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 279         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 280     }                                                                                                    </span>
<span  style=""> 281                                                                                                          </span>
<span class="2350776504190590277" onmouseenter="enter('2350776504190590277');" onmouseout="out('2350776504190590277');" style=""> 282     public void testCouldOfferApplyToOrder() throws Exception {                                          </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 283         replay();                                                                                        </span>
<span  style=""> 284                                                                                                          </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style=""> 285         PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);         </span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 286         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                          </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 287             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 288             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 289             null,                                                                                        </span>
<span class="-4216650843576585517" onmouseenter="enter('-4216650843576585517');" onmouseout="out('-4216650843576585517');" style=""> 290             null                                                                                         </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 291         );                                                                                               </span>
<span  style=""> 292                                                                                                          </span>
<span class="7853971483654053322" onmouseenter="enter('7853971483654053322');" onmouseout="out('7853971483654053322');" style=""><abbr title=" 293         boolean couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderItems().get(0), order.getFulfillmentGroups().get(0));"> 293         boolean couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountðŸ”µ</abbr></span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 294         //test that the valid order item offer is included                                               </span>
<span class="7931914881113900287" onmouseenter="enter('7931914881113900287');" onmouseout="out('7931914881113900287');" style=""> 295         assertTrue(couldApply);                                                                          </span>
<span  style=""> 296                                                                                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 297         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-966907751053524789" onmouseenter="enter('-966907751053524789');" onmouseout="out('-966907751053524789');" style=""> 298             &quot;order.subTotal.getAmount()==0&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 299             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 300             null,                                                                                        </span>
<span class="-4216650843576585517" onmouseenter="enter('-4216650843576585517');" onmouseout="out('-4216650843576585517');" style=""> 301             null                                                                                         </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 302         );                                                                                               </span>
<span class="2583469720888306492" onmouseenter="enter('2583469720888306492');" onmouseout="out('2583469720888306492');" style=""><abbr title=" 303         couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderItems().get(0), order.getFulfillmentGroups().get(0));"> 303         couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrdeðŸ”µ</abbr></span>
<span class="202008870314622194" onmouseenter="enter('202008870314622194');" onmouseout="out('202008870314622194');" style=""> 304         //test that the invalid order item offer is excluded                                             </span>
<span class="2773091290643222945" onmouseenter="enter('2773091290643222945');" onmouseout="out('2773091290643222945');" style=""> 305         assertFalse(couldApply);                                                                         </span>
<span  style=""> 306                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 307         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308     }                                                                                                    </span>
<span  style=""> 309                                                                                                          </span>
<span class="-3815970332732974591" onmouseenter="enter('-3815970332732974591');" onmouseout="out('-3815970332732974591');" style=""> 310     public void testCouldOrderItemMeetOfferRequirement() throws Exception {                              </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 311         replay();                                                                                        </span>
<span  style=""> 312                                                                                                          </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style=""> 313         PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);         </span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 314         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                          </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 315             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 316             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 317             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 317             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 318             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 318             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 319         );                                                                                               </span>
<span  style=""> 320                                                                                                          </span>
<span class="1501673451570831850" onmouseenter="enter('1501673451570831850');" onmouseout="out('1501673451570831850');" style=""><abbr title=" 321         OfferQualifyingCriteriaXref xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next();"> 321         OfferQualifyingCriteriaXref xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next(ðŸ”µ</abbr></span>
<span class="-472249920513934405" onmouseenter="enter('-472249920513934405');" onmouseout="out('-472249920513934405');" style=""><abbr title=" 322         boolean couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.getDiscountableOrderItems().get(0));"> 322         boolean couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria()ðŸ”µ</abbr></span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 323         //test that the valid order item offer is included                                               </span>
<span class="7931914881113900287" onmouseenter="enter('7931914881113900287');" onmouseout="out('7931914881113900287');" style=""> 324         assertTrue(couldApply);                                                                          </span>
<span  style=""> 325                                                                                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 326         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 327             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 328             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-6301719950201762066" onmouseenter="enter('-6301719950201762066');" onmouseout="out('-6301719950201762066');" style=""><abbr title=" 329             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 329             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MðŸ”µ</abbr></span>
<span class="800271347213994814" onmouseenter="enter('800271347213994814');" onmouseout="out('800271347213994814');" style=""><abbr title=" 330             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 330             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 331         );                                                                                               </span>
<span class="2238137642305281390" onmouseenter="enter('2238137642305281390');" onmouseout="out('2238137642305281390');" style=""> 332         xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next();                          </span>
<span class="7022359060345229272" onmouseenter="enter('7022359060345229272');" onmouseout="out('7022359060345229272');" style=""><abbr title=" 333         couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.getDiscountableOrderItems().get(0));"> 333         couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.ðŸ”µ</abbr></span>
<span class="202008870314622194" onmouseenter="enter('202008870314622194');" onmouseout="out('202008870314622194');" style=""> 334         //test that the invalid order item offer is excluded                                             </span>
<span class="2773091290643222945" onmouseenter="enter('2773091290643222945');" onmouseout="out('2773091290643222945');" style=""> 335         assertFalse(couldApply);                                                                         </span>
<span  style=""> 336                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 337         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338     }                                                                                                    </span>
<span  style=""> 339                                                                                                          </span>
<span class="8397400473119507330" onmouseenter="enter('8397400473119507330');" onmouseout="out('8397400473119507330');" style=""> 340     public void testCouldOfferApplyToOrderItems() throws Exception {                                     </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 341         replay();                                                                                        </span>
<span  style=""> 342                                                                                                          </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style=""> 343         PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);         </span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 344         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                          </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 345             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 346             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 347             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 347             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 348             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 348             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 349         );                                                                                               </span>
<span class="-4222545078163101091" onmouseenter="enter('-4222545078163101091');" onmouseout="out('-4222545078163101091');" style=""> 350         List&lt;PromotableOrderItem&gt; orderItems = new ArrayList&lt;PromotableOrderItem&gt;();                     </span>
<span class="-7372483979901719352" onmouseenter="enter('-7372483979901719352');" onmouseout="out('-7372483979901719352');" style=""> 351         for (PromotableOrderItem orderItem : order.getDiscountableOrderItems()) {                        </span>
<span class="5423314879443576267" onmouseenter="enter('5423314879443576267');" onmouseout="out('5423314879443576267');" style=""> 352             orderItems.add(orderItem);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353         }                                                                                                </span>
<span class="8798832722266180533" onmouseenter="enter('8798832722266180533');" onmouseout="out('8798832722266180533');" style=""><abbr title=" 354         CandidatePromotionItems candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), orderItems);"> 354         CandidatePromotionItems candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), ordðŸ”µ</abbr></span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 355         //test that the valid order item offer is included                                               </span>
<span class="-7375750347374851802" onmouseenter="enter('-7375750347374851802');" onmouseout="out('-7375750347374851802');" style=""> 356         //both cart items are valid for qualification and target                                         </span>
<span class="-7973040919570615736" onmouseenter="enter('-7973040919570615736');" onmouseout="out('-7973040919570615736');" style=""><abbr title=" 357         assertTrue(candidates.isMatchedQualifier() &amp;&amp; candidates.getCandidateQualifiersMap().size() == 1 &amp;&amp;"> 357         assertTrue(candidates.isMatchedQualifier() &amp;&amp; candidates.getCandidateQualifiersMap().size() == 1 ðŸ”µ</abbr></span>
<span class="2769824792004949663" onmouseenter="enter('2769824792004949663');" onmouseout="out('2769824792004949663');" style=""> 358                 candidates.getCandidateQualifiersMap().values().iterator().next().size() == 2 &amp;&amp;         </span>
<span class="-2057082480309621191" onmouseenter="enter('-2057082480309621191');" onmouseout="out('-2057082480309621191');" style=""> 359                 candidates.isMatchedTarget() &amp;&amp; candidates.getCandidateTargetsMap().size() == 1 &amp;&amp;       </span>
<span class="2986039361500944684" onmouseenter="enter('2986039361500944684');" onmouseout="out('2986039361500944684');" style=""> 360                 candidates.getCandidateTargetsMap().values().iterator().next().size() == 2);             </span>
<span  style=""> 361                                                                                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 362         offers = dataProvider.createItemBasedOfferWithItemCriteria(                                      </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 363             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 364             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-6301719950201762066" onmouseenter="enter('-6301719950201762066');" onmouseout="out('-6301719950201762066');" style=""><abbr title=" 365             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 365             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MðŸ”µ</abbr></span>
<span class="800271347213994814" onmouseenter="enter('800271347213994814');" onmouseout="out('800271347213994814');" style=""><abbr title=" 366             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 366             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 367         );                                                                                               </span>
<span class="-7318029938713023882" onmouseenter="enter('-7318029938713023882');" onmouseout="out('-7318029938713023882');" style=""> 368         candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), orderItems);               </span>
<span class="5723156784615186428" onmouseenter="enter('5723156784615186428');" onmouseout="out('5723156784615186428');" style=""> 369         //test that the invalid order item offer is excluded because there are no qualifying items       </span>
<span class="-265242688274418245" onmouseenter="enter('-265242688274418245');" onmouseout="out('-265242688274418245');" style=""><abbr title=" 370         assertFalse(candidates.isMatchedQualifier() &amp;&amp; candidates.getCandidateQualifiersMap().size() == 1);"> 370         assertFalse(candidates.isMatchedQualifier() &amp;&amp; candidates.getCandidateQualifiersMap().size() == 1ðŸ”µ</abbr></span>
<span  style=""> 371                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 372         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373     }                                                                                                    </span>
<span  style=""> 374                                                                                                          </span>
<span class="-2310379539708411407" onmouseenter="enter('-2310379539708411407');" onmouseout="out('-2310379539708411407');" style=""> 375     private int checkOrderItemOfferAppliedCount(Order order) {                                           </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 376         int count = 0;                                                                                   </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 377         for (OrderItem item : order.getOrderItems()) {                                                   </span>
<span class="773323050474809935" onmouseenter="enter('773323050474809935');" onmouseout="out('773323050474809935');" style=""> 378             for (OrderItemPriceDetail detail : item.getOrderItemPriceDetails()) {                        </span>
<span class="-7653326266832377040" onmouseenter="enter('-7653326266832377040');" onmouseout="out('-7653326266832377040');" style=""><abbr title=" 379                 count = count + (detail.getOrderItemPriceDetailAdjustments().size() * detail.getQuantity());"> 379                 count = count + (detail.getOrderItemPriceDetailAdjustments().size() * detail.getQuantity(ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381         }                                                                                                </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 382         return count;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383     }                                                                                                    </span>
<span  style=""> 384                                                                                                          </span>
<span class="352390873819089414" onmouseenter="enter('352390873819089414');" onmouseout="out('352390873819089414');" style=""> 385     private int checkOrderItemOfferAppliedQuantity(Order order, Offer offer) {                           </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 386         int count = 0;                                                                                   </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 387         for (OrderItem item : order.getOrderItems()) {                                                   </span>
<span class="773323050474809935" onmouseenter="enter('773323050474809935');" onmouseout="out('773323050474809935');" style=""> 388             for (OrderItemPriceDetail detail : item.getOrderItemPriceDetails()) {                        </span>
<span class="-2015743447488247947" onmouseenter="enter('-2015743447488247947');" onmouseout="out('-2015743447488247947');" style=""><abbr title=" 389                 for (OrderItemPriceDetailAdjustment adjustment : detail.getOrderItemPriceDetailAdjustments()) {"> 389                 for (OrderItemPriceDetailAdjustment adjustment : detail.getOrderItemPriceDetailAdjustmentðŸ”µ</abbr></span>
<span class="-6326222561939664995" onmouseenter="enter('-6326222561939664995');" onmouseout="out('-6326222561939664995');" style=""> 390                     if (adjustment.getOffer().getId().equals(offer.getId())) {                           </span>
<span class="6653455861258404903" onmouseenter="enter('6653455861258404903');" onmouseout="out('6653455861258404903');" style=""> 391                         count += detail.getQuantity();                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 394             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395         }                                                                                                </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 396         return count;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397     }                                                                                                    </span>
<span  style=""> 398                                                                                                          </span>
<span class="8856632786224131584" onmouseenter="enter('8856632786224131584');" onmouseout="out('8856632786224131584');" style=""> 399     private int countPriceDetails(Order order) {                                                         </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 400         int count = 0;                                                                                   </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 401         for (OrderItem item : order.getOrderItems()) {                                                   </span>
<span class="-2490083702571223921" onmouseenter="enter('-2490083702571223921');" onmouseout="out('-2490083702571223921');" style=""> 402             count = count + item.getOrderItemPriceDetails().size();                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403         }                                                                                                </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 404         return count;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 405     }                                                                                                    </span>
<span  style=""> 406                                                                                                          </span>
<span  style=""> 407                                                                                                          </span>
<span class="-7256708927614783311" onmouseenter="enter('-7256708927614783311');" onmouseout="out('-7256708927614783311');" style=""> 408     public void testApplyAllItemOffers() throws Exception {                                              </span>
<span  style=""> 409                                                                                                          </span>
<span  style=""> 410                                                                                                          </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 411         replay();                                                                                        </span>
<span  style=""> 412                                                                                                          </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 413         Order order = dataProvider.createBasicOrder();                                                   </span>
<span  style=""> 414                                                                                                          </span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 415         Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 416             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 417             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 418             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 418             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 419             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 419             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 420         ).get(0);                                                                                        </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 421         offer1.setId(1L);                                                                                </span>
<span  style=""> 422                                                                                                          </span>
<span class="2099956539522342594" onmouseenter="enter('2099956539522342594');" onmouseout="out('2099956539522342594');" style=""> 423         List&lt;Offer&gt; offers = new ArrayList&lt;Offer&gt;();                                                     </span>
<span class="-8212520581628164505" onmouseenter="enter('-8212520581628164505');" onmouseout="out('-8212520581628164505');" style=""> 424         offers.add(offer1);                                                                              </span>
<span  style=""> 425                                                                                                          </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""><abbr title=" 426         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();"> 426         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;(ðŸ”µ</abbr></span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 427         order.updatePrices();                                                                            </span>
<span class="1815029190775922456" onmouseenter="enter('1815029190775922456');" onmouseout="out('1815029190775922456');" style=""> 428         offerService.applyAndSaveOffersToOrder(offers, order);                                           </span>
<span  style=""> 429                                                                                                          </span>
<span class="5029607886283012370" onmouseenter="enter('5029607886283012370');" onmouseout="out('5029607886283012370');" style=""> 430         assertTrue(order.getTotalAdjustmentsValue().getAmount().doubleValue() &gt; 0);                      </span>
<span  style=""> 431                                                                                                          </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 432         order = dataProvider.createBasicOrder();                                                         </span>
<span  style=""> 433                                                                                                          </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 434         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="7246766169005062112" onmouseenter="enter('7246766169005062112');" onmouseout="out('7246766169005062112');" style=""> 435         offer1.setApplyDiscountToSalePrice(false);                                                       </span>
<span class="2600361857999587596" onmouseenter="enter('2600361857999587596');" onmouseout="out('2600361857999587596');" style=""> 436         ((DiscreteOrderItem) order.getOrderItems().get(0)).getSku().setSalePrice(new Money(1D));         </span>
<span class="7325578290287955946" onmouseenter="enter('7325578290287955946');" onmouseout="out('7325578290287955946');" style=""> 437         ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(new Money(1D));         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 438         order.updatePrices();                                                                            </span>
<span class="1815029190775922456" onmouseenter="enter('1815029190775922456');" onmouseout="out('1815029190775922456');" style=""> 439         offerService.applyAndSaveOffersToOrder(offers, order);                                           </span>
<span  style=""> 440                                                                                                          </span>
<span class="-6354950951868192224" onmouseenter="enter('-6354950951868192224');" onmouseout="out('-6354950951868192224');" style=""> 441         assertTrue(order.getTotalAdjustmentsValue().getAmount().doubleValue() == 0);                     </span>
<span  style=""> 442                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 443         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444     }                                                                                                    </span>
<span  style=""> 445                                                                                                          </span>
<span class="5445671973328535543" onmouseenter="enter('5445671973328535543');" onmouseout="out('5445671973328535543');" style=""> 446     public void testApplyAdjustments() throws Exception {                                                </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 447         replay();                                                                                        </span>
<span  style=""> 448                                                                                                          </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 449         Order order = dataProvider.createBasicOrder();                                                   </span>
<span  style=""> 450                                                                                                          </span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 451         Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 452             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 453             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 454             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 454             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 455             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 455             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 456         ).get(0);                                                                                        </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 457         offer1.setId(1L);                                                                                </span>
<span class="-4071252017012046157" onmouseenter="enter('-4071252017012046157');" onmouseout="out('-4071252017012046157');" style=""> 458         OfferQualifyingCriteriaXref xref = offer1.getQualifyingItemCriteriaXref().iterator().next();     </span>
<span class="-7032540125324645344" onmouseenter="enter('-7032540125324645344');" onmouseout="out('-7032540125324645344');" style=""> 459         xref.getOfferItemCriteria().setQuantity(2);                                                      </span>
<span class="7720028840114078774" onmouseenter="enter('7720028840114078774');" onmouseout="out('7720028840114078774');" style=""> 460         offer1.setCombinableWithOtherOffers(false);                                                      </span>
<span class="-1956075415585459204" onmouseenter="enter('-1956075415585459204');" onmouseout="out('-1956075415585459204');" style=""> 461         Offer offer2 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 462             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 463             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 464             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 464             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 465             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 465             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 466         ).get(0);                                                                                        </span>
<span class="-6767777846149293935" onmouseenter="enter('-6767777846149293935');" onmouseout="out('-6767777846149293935');" style=""> 467         offer2.setId(2L);                                                                                </span>
<span  style=""> 468                                                                                                          </span>
<span class="8631188538838496439" onmouseenter="enter('8631188538838496439');" onmouseout="out('8631188538838496439');" style=""> 469         List&lt;Offer&gt; offerListWithOneOffer = new ArrayList&lt;Offer&gt;();                                      </span>
<span class="-7734009620886563381" onmouseenter="enter('-7734009620886563381');" onmouseout="out('-7734009620886563381');" style=""> 470         offerListWithOneOffer.add(offer1);                                                               </span>
<span  style=""> 471                                                                                                          </span>
<span class="-2645409726359466791" onmouseenter="enter('-2645409726359466791');" onmouseout="out('-2645409726359466791');" style=""> 472         List&lt;Offer&gt; offerListWithTwoOffers = new ArrayList&lt;Offer&gt;();                                     </span>
<span class="-2242941289654799072" onmouseenter="enter('-2242941289654799072');" onmouseout="out('-2242941289654799072');" style=""> 473         offerListWithTwoOffers.add(offer1);                                                              </span>
<span class="-7736021191926792461" onmouseenter="enter('-7736021191926792461');" onmouseout="out('-7736021191926792461');" style=""> 474         offerListWithTwoOffers.add(offer2);                                                              </span>
<span  style=""> 475                                                                                                          </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 476         order.updatePrices();                                                                            </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 477         offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                            </span>
<span class="1819254978181053470" onmouseenter="enter('1819254978181053470');" onmouseout="out('1819254978181053470');" style=""> 478         assertTrue(checkOrderItemOfferAppliedCount(order) == 1);                                         </span>
<span class="-1512986248678261918" onmouseenter="enter('-1512986248678261918');" onmouseout="out('-1512986248678261918');" style=""> 479         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 1);                              </span>
<span  style=""> 480                                                                                                          </span>
<span class="-992574443533108741" onmouseenter="enter('-992574443533108741');" onmouseout="out('-992574443533108741');" style=""> 481         // Add the second offer.   The first was nonCombinable so it should still be 1                   </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 482         order = dataProvider.createBasicOrder();                                                         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 483         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 484         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 485         assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                         </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 486         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                              </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 487         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                              </span>
<span  style=""> 488                                                                                                          </span>
<span  style=""> 489                                                                                                          </span>
<span class="4143880644635780347" onmouseenter="enter('4143880644635780347');" onmouseout="out('4143880644635780347');" style=""> 490         // Reset offer1 to combinable.   Now both should be applied.                                     </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 491         offer1.setCombinableWithOtherOffers(true);                                                       </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 492         order = dataProvider.createBasicOrder();                                                         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 493         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 494         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 495         assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                         </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 496         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                              </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 497         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                              </span>
<span  style=""> 498                                                                                                          </span>
<span class="7464184952874881203" onmouseenter="enter('7464184952874881203');" onmouseout="out('7464184952874881203');" style=""> 499         // Offer 1 back to nonCombinable but don&#x27;t allow discount to the sale price                      </span>
<span class="-1417948014770234923" onmouseenter="enter('-1417948014770234923');" onmouseout="out('-1417948014770234923');" style=""> 500         // and make the sale price a better overall offer                                                </span>
<span class="7720028840114078774" onmouseenter="enter('7720028840114078774');" onmouseout="out('7720028840114078774');" style=""> 501         offer1.setCombinableWithOtherOffers(false);                                                      </span>
<span class="7246766169005062112" onmouseenter="enter('7246766169005062112');" onmouseout="out('7246766169005062112');" style=""> 502         offer1.setApplyDiscountToSalePrice(false);                                                       </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 503         order = dataProvider.createBasicOrder();                                                         </span>
<span class="-5732736595573562244" onmouseenter="enter('-5732736595573562244');" onmouseout="out('-5732736595573562244');" style=""> 504         ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(new Money(10D));        </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 505         order.updatePrices();                                                                            </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 506         offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                            </span>
<span class="-3398637566880609797" onmouseenter="enter('-3398637566880609797');" onmouseout="out('-3398637566880609797');" style=""> 507         assertTrue(checkOrderItemOfferAppliedCount(order) == 0);                                         </span>
<span  style=""> 508                                                                                                          </span>
<span class="1023771780730500424" onmouseenter="enter('1023771780730500424');" onmouseout="out('1023771780730500424');" style=""> 509         // Try again with two offers.   The second should be applied.                                    </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 510         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 511         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 512         assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                         </span>
<span  style=""> 513                                                                                                          </span>
<span class="-1661318026700279078" onmouseenter="enter('-1661318026700279078');" onmouseout="out('-1661318026700279078');" style=""> 514         // Trying with 2nd offer as nonCombinable.                                                       </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 515         offer1.setCombinableWithOtherOffers(true);                                                       </span>
<span class="7546366022368659645" onmouseenter="enter('7546366022368659645');" onmouseout="out('7546366022368659645');" style=""> 516         ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(null);                  </span>
<span class="-7762597468102373652" onmouseenter="enter('-7762597468102373652');" onmouseout="out('-7762597468102373652');" style=""> 517         offer2.setCombinableWithOtherOffers(false);                                                      </span>
<span  style=""> 518                                                                                                          </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 519         order.updatePrices();                                                                            </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 520         offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                            </span>
<span class="1819254978181053470" onmouseenter="enter('1819254978181053470');" onmouseout="out('1819254978181053470');" style=""> 521         assertTrue(checkOrderItemOfferAppliedCount(order) == 1);                                         </span>
<span  style=""> 522                                                                                                          </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 523         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 524         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 525         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                              </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 526         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                              </span>
<span  style=""> 527                                                                                                          </span>
<span class="-4953067338675041826" onmouseenter="enter('-4953067338675041826');" onmouseout="out('-4953067338675041826');" style=""> 528         // Set qualifying criteria quantity to 1                                                         </span>
<span class="2746062014348300811" onmouseenter="enter('2746062014348300811');" onmouseout="out('2746062014348300811');" style=""> 529         // Set qualifying target criteria to 2                                                           </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 530         order = dataProvider.createBasicOrder();                                                         </span>
<span class="-6688543313838783650" onmouseenter="enter('-6688543313838783650');" onmouseout="out('-6688543313838783650');" style=""> 531         xref = offer1.getQualifyingItemCriteriaXref().iterator().next();                                 </span>
<span class="2724580140749596242" onmouseenter="enter('2724580140749596242');" onmouseout="out('2724580140749596242');" style=""> 532         xref.getOfferItemCriteria().setQuantity(1);                                                      </span>
<span  style=""> 533                                                                                                          </span>
<span class="2987053505448788974" onmouseenter="enter('2987053505448788974');" onmouseout="out('2987053505448788974');" style=""> 534         OfferTargetCriteriaXref targetXref = offer1.getTargetItemCriteriaXref().iterator().next();       </span>
<span class="7956044162267364758" onmouseenter="enter('7956044162267364758');" onmouseout="out('7956044162267364758');" style=""> 535         targetXref.getOfferItemCriteria().setQuantity(2);                                                </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 536         order.updatePrices();                                                                            </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 537         offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                            </span>
<span class="-7080380211983716353" onmouseenter="enter('-7080380211983716353');" onmouseout="out('-7080380211983716353');" style=""> 538         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 2);                              </span>
<span  style=""> 539                                                                                                          </span>
<span class="-2183171090813944888" onmouseenter="enter('-2183171090813944888');" onmouseout="out('-2183171090813944888');" style=""> 540         // Reset both offers to combinable and the qualifiers as allowing duplicate QUALIFIERs           </span>
<span class="-2255179946339237317" onmouseenter="enter('-2255179946339237317');" onmouseout="out('-2255179946339237317');" style=""> 541         // and Targets                                                                                   </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 542         offer1.setCombinableWithOtherOffers(true);                                                       </span>
<span class="2527637603040178756" onmouseenter="enter('2527637603040178756');" onmouseout="out('2527637603040178756');" style=""> 543         offer2.setCombinableWithOtherOffers(true);                                                       </span>
<span class="-2476264833911625662" onmouseenter="enter('-2476264833911625662');" onmouseout="out('-2476264833911625662');" style=""> 544         offer1.setOfferItemQualifierRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);             </span>
<span class="-7410686570241782346" onmouseenter="enter('-7410686570241782346');" onmouseout="out('-7410686570241782346');" style=""> 545         offer1.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                </span>
<span class="1961218096433141479" onmouseenter="enter('1961218096433141479');" onmouseout="out('1961218096433141479');" style=""> 546         offer2.setOfferItemQualifierRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);             </span>
<span class="7075569690739658894" onmouseenter="enter('7075569690739658894');" onmouseout="out('7075569690739658894');" style=""> 547         offer2.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 548         order = dataProvider.createBasicOrder();                                                         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 549         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 550         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-7329741501515817260" onmouseenter="enter('-7329741501515817260');" onmouseout="out('-7329741501515817260');" style=""> 551         assertTrue(checkOrderItemOfferAppliedCount(order) == 4);                                         </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 552         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                              </span>
<span class="-7080380211983716353" onmouseenter="enter('-7080380211983716353');" onmouseout="out('-7080380211983716353');" style=""> 553         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 2);                              </span>
<span  style=""> 554                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 555         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556     }                                                                                                    </span>
<span  style=""> 557                                                                                                          </span>
<span class="1804876492874242702" onmouseenter="enter('1804876492874242702');" onmouseout="out('1804876492874242702');" style=""> 558     public void testApplyItemQualifiersAndTargets() throws Exception {                                   </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 559         replay();                                                                                        </span>
<span  style=""> 560                                                                                                          </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""><abbr title=" 561         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();"> 561         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;(ðŸ”µ</abbr></span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 562         Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 563             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 564             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 565             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 565             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 566             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 566             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 567         ).get(0);                                                                                        </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 568         offer1.setId(1L);                                                                                </span>
<span class="-1956075415585459204" onmouseenter="enter('-1956075415585459204');" onmouseout="out('-1956075415585459204');" style=""> 569         Offer offer2 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 570             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 571             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 572             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 572             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 573             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 573             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 574         ).get(0);                                                                                        </span>
<span class="-6767777846149293935" onmouseenter="enter('-6767777846149293935');" onmouseout="out('-6767777846149293935');" style=""> 575         offer2.setId(2L);                                                                                </span>
<span  style=""> 576                                                                                                          </span>
<span class="-946400959636335360" onmouseenter="enter('-946400959636335360');" onmouseout="out('-946400959636335360');" style=""> 577         OfferTargetCriteriaXref targetXref = offer2.getTargetItemCriteriaXref().iterator().next();       </span>
<span class="-8974993586722209178" onmouseenter="enter('-8974993586722209178');" onmouseout="out('-8974993586722209178');" style=""> 578         targetXref.getOfferItemCriteria().setQuantity(4);                                                </span>
<span class="-7641378772090546772" onmouseenter="enter('-7641378772090546772');" onmouseout="out('-7641378772090546772');" style=""> 579         offer2.getQualifyingItemCriteriaXref().clear();                                                  </span>
<span class="-4860738879403790739" onmouseenter="enter('-4860738879403790739');" onmouseout="out('-4860738879403790739');" style=""> 580         offer2.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.TARGET);                          </span>
<span class="4265078036448799603" onmouseenter="enter('4265078036448799603');" onmouseout="out('4265078036448799603');" style=""> 581         Offer offer3 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 582             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 583             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 584             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 584             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 585             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 585             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 586         ).get(0);                                                                                        </span>
<span  style=""> 587                                                                                                          </span>
<span class="5984499010113424780" onmouseenter="enter('5984499010113424780');" onmouseout="out('5984499010113424780');" style=""><abbr title=" 588         PromotableOrder promotableOrder = dataProvider.createBasicPromotableOrder(promotableOfferUtility);"> 588         PromotableOrder promotableOrder = dataProvider.createBasicPromotableOrder(promotableOfferUtility)ðŸ”µ</abbr></span>
<span class="1609760517765742590" onmouseenter="enter('1609760517765742590');" onmouseout="out('1609760517765742590');" style=""> 589         itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer1);                    </span>
<span class="-8779152254781384438" onmouseenter="enter('-8779152254781384438');" onmouseout="out('-8779152254781384438');" style=""><abbr title=" 590         assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offer1) &amp;&amp; qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1);"> 590         assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offer1) &amp;&amp; quaðŸ”µ</abbr></span>
<span  style=""> 591                                                                                                          </span>
<span class="3664680620844694596" onmouseenter="enter('3664680620844694596');" onmouseout="out('3664680620844694596');" style=""> 592         itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer2);                    </span>
<span class="5658243282537406724" onmouseenter="enter('5658243282537406724');" onmouseout="out('5658243282537406724');" style=""><abbr title=" 593         assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offer2) &amp;&amp; qualifiedOffers.get(1).getCandidateQualifiersMap().size() == 0);"> 593         assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offer2) &amp;&amp; quaðŸ”µ</abbr></span>
<span  style=""> 594                                                                                                          </span>
<span class="-3826912296678151810" onmouseenter="enter('-3826912296678151810');" onmouseout="out('-3826912296678151810');" style=""> 595         itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer3);                    </span>
<span class="1911054944218617418" onmouseenter="enter('1911054944218617418');" onmouseout="out('1911054944218617418');" style=""><abbr title=" 596         assertTrue(qualifiedOffers.size() == 3 &amp;&amp; qualifiedOffers.get(2).getOffer().equals(offer3) &amp;&amp; qualifiedOffers.get(2).getCandidateQualifiersMap().size() == 1);"> 596         assertTrue(qualifiedOffers.size() == 3 &amp;&amp; qualifiedOffers.get(2).getOffer().equals(offer3) &amp;&amp; quaðŸ”µ</abbr></span>
<span  style=""> 597                                                                                                          </span>
<span class="1766810220278806135" onmouseenter="enter('1766810220278806135');" onmouseout="out('1766810220278806135');" style=""><abbr title=" 598         // Try with just the second offer.   Expect to get 4 targets based on the offer having no qualifiers required"> 598         // Try with just the second offer.   Expect to get 4 targets based on the offer having no qualifiðŸ”µ</abbr></span>
<span class="-4912150122214844213" onmouseenter="enter('-4912150122214844213');" onmouseout="out('-4912150122214844213');" style=""> 599         // and targeting category test1 or test2 and that the offer requires 4 target criteria.          </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 600         Order order = dataProvider.createBasicOrder();                                                   </span>
<span class="8583068860005847748" onmouseenter="enter('8583068860005847748');" onmouseout="out('8583068860005847748');" style=""> 601         List&lt;Offer&gt; offerList = new ArrayList&lt;Offer&gt;();                                                  </span>
<span class="3860405318390761830" onmouseenter="enter('3860405318390761830');" onmouseout="out('3860405318390761830');" style=""> 602         offerList.add(offer2);                                                                           </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 603         offerService.applyAndSaveOffersToOrder(offerList, order);                                        </span>
<span class="-8213637320090973795" onmouseenter="enter('-8213637320090973795');" onmouseout="out('-8213637320090973795');" style=""> 604         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 4);                              </span>
<span class="1606234139614227925" onmouseenter="enter('1606234139614227925');" onmouseout="out('1606234139614227925');" style=""> 605         assertTrue(countPriceDetails(order) == 3);                                                       </span>
<span  style=""> 606                                                                                                          </span>
<span class="2040936482538754372" onmouseenter="enter('2040936482538754372');" onmouseout="out('2040936482538754372');" style=""><abbr title=" 607         // Now try with both offers.   Since the targets can be reused, we expect to have 4 targets on offer2"> 607         // Now try with both offers.   Since the targets can be reused, we expect to have 4 targets on ofðŸ”µ</abbr></span>
<span class="8516822473741223062" onmouseenter="enter('8516822473741223062');" onmouseout="out('8516822473741223062');" style=""> 608         // and 1 target on offer1                                                                        </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 609         order = dataProvider.createBasicOrder();                                                         </span>
<span class="2231055284542614880" onmouseenter="enter('2231055284542614880');" onmouseout="out('2231055284542614880');" style=""> 610         offerList.add(offer1); // add in second offer (which happens to be offer1)                       </span>
<span  style=""> 611                                                                                                          </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 612         offerService.applyAndSaveOffersToOrder(offerList, order);                                        </span>
<span class="-8213637320090973795" onmouseenter="enter('-8213637320090973795');" onmouseout="out('-8213637320090973795');" style=""> 613         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 4);                              </span>
<span class="1606234139614227925" onmouseenter="enter('1606234139614227925');" onmouseout="out('1606234139614227925');" style=""> 614         assertTrue(countPriceDetails(order) == 3);                                                       </span>
<span  style=""> 615                                                                                                          </span>
<span class="-8510477625850873985" onmouseenter="enter('-8510477625850873985');" onmouseout="out('-8510477625850873985');" style=""> 616         // All three offers - offer 3 is now higher priority so the best offer (offer 2) won&#x27;t be applied</span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 617         order = dataProvider.createBasicOrder();                                                         </span>
<span class="-2751996978326205337" onmouseenter="enter('-2751996978326205337');" onmouseout="out('-2751996978326205337');" style=""> 618         offerList.add(offer3); // add in second offer (which happens to be offer1)                       </span>
<span class="3305227095626441424" onmouseenter="enter('3305227095626441424');" onmouseout="out('3305227095626441424');" style=""> 619         offer3.setPriority(-1);                                                                          </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 620         offerService.applyAndSaveOffersToOrder(offerList, order);                                        </span>
<span class="7385283043446040112" onmouseenter="enter('7385283043446040112');" onmouseout="out('7385283043446040112');" style=""> 621         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer3) == 2);                              </span>
<span class="7014092410184079185" onmouseenter="enter('7014092410184079185');" onmouseout="out('7014092410184079185');" style=""> 622         assertTrue(countPriceDetails(order) == 4);                                                       </span>
<span  style=""> 623                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 624         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 625     }                                                                                                    </span>
<span  style=""> 626                                                                                                          </span>
<span class="8243234137390807561" onmouseenter="enter('8243234137390807561');" onmouseout="out('8243234137390807561');" style=""> 627     public class Answer implements IAnswer&lt;CandidateItemOffer&gt; {                                         </span>
<span  style=""> 628                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 629         @Override                                                                                        </span>
<span class="2347184973793483651" onmouseenter="enter('2347184973793483651');" onmouseout="out('2347184973793483651');" style=""> 630         public CandidateItemOffer answer() throws Throwable {                                            </span>
<span class="7644422100596500085" onmouseenter="enter('7644422100596500085');" onmouseout="out('7644422100596500085');" style=""> 631             return new CandidateItemOfferImpl();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 632         }                                                                                                </span>
<span  style=""> 633                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 634     }                                                                                                    </span>
<span  style=""> 635                                                                                                          </span>
<span class="-8622711476449936611" onmouseenter="enter('-8622711476449936611');" onmouseout="out('-8622711476449936611');" style=""> 636     public class Answer2 implements IAnswer&lt;OrderItemAdjustment&gt; {                                       </span>
<span  style=""> 637                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 638         @Override                                                                                        </span>
<span class="4861248105020273136" onmouseenter="enter('4861248105020273136');" onmouseout="out('4861248105020273136');" style=""> 639         public OrderItemAdjustment answer() throws Throwable {                                           </span>
<span class="7697130786892874769" onmouseenter="enter('7697130786892874769');" onmouseout="out('7697130786892874769');" style=""> 640             return new OrderItemAdjustmentImpl();                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 641         }                                                                                                </span>
<span  style=""> 642                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 643     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644 }                                                                                                        </span>



</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-4156106492343801428" onmouseenter="enter('-4156106492343801428');" onmouseout="out('-4156106492343801428');" style="">  18 package org.broadleafcommerce.core.offer.service.processor;                                              </span>
<span  style="">  19                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  20 import java.util.ArrayList;                                                                              </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  21 import java.util.List;                                                                                   </span>
<span class="-3682115440535733483" onmouseenter="enter('-3682115440535733483');" onmouseout="out('-3682115440535733483');" style="">  22 import java.util.TimeZone;                                                                               </span>
<span class="5589978463048615898" onmouseenter="enter('5589978463048615898');" onmouseout="out('5589978463048615898');" style="">  23 import junit.framework.TestCase;                                                                         </span>
<span class="-274639712180431568" onmouseenter="enter('-274639712180431568');" onmouseout="out('-274639712180431568');" style="">  24 import org.broadleafcommerce.common.money.Money;                                                         </span>
<span class="-1492144387614747576" onmouseenter="enter('-1492144387614747576');" onmouseout="out('-1492144387614747576');" style="">  25 import org.broadleafcommerce.common.service.GenericEntityService;                                        </span>
<span class="6205208880685044389" onmouseenter="enter('6205208880685044389');" onmouseout="out('6205208880685044389');" style="">  26 import org.broadleafcommerce.core.offer.dao.CustomerOfferDao;                                            </span>
<span class="-7911436562744873568" onmouseenter="enter('-7911436562744873568');" onmouseout="out('-7911436562744873568');" style="">  27 import org.broadleafcommerce.core.offer.dao.OfferCodeDao;                                                </span>
<span class="-2793633202507663758" onmouseenter="enter('-2793633202507663758');" onmouseout="out('-2793633202507663758');" style="">  28 import org.broadleafcommerce.core.offer.dao.OfferDao;                                                    </span>
<span class="4011152823911960428" onmouseenter="enter('4011152823911960428');" onmouseout="out('4011152823911960428');" style="">  29 import org.broadleafcommerce.core.offer.domain.CandidateItemOffer;                                       </span>
<span class="-735428748329738672" onmouseenter="enter('-735428748329738672');" onmouseout="out('-735428748329738672');" style="">  30 import org.broadleafcommerce.core.offer.domain.CandidateItemOfferImpl;                                   </span>
<span class="4081153142019712377" onmouseenter="enter('4081153142019712377');" onmouseout="out('4081153142019712377');" style="">  31 import org.broadleafcommerce.core.offer.domain.Offer;                                                    </span>
<span class="-7025591891527881733" onmouseenter="enter('-7025591891527881733');" onmouseout="out('-7025591891527881733');" style="">  32 import org.broadleafcommerce.core.offer.domain.OfferImpl;                                                </span>
<span class="1133170227846016200" onmouseenter="enter('1133170227846016200');" onmouseout="out('1133170227846016200');" style="">  33 import org.broadleafcommerce.core.offer.domain.OfferQualifyingCriteriaXref;                              </span>
<span class="5060973083944568665" onmouseenter="enter('5060973083944568665');" onmouseout="out('5060973083944568665');" style="">  34 import org.broadleafcommerce.core.offer.domain.OfferTargetCriteriaXref;                                  </span>
<span class="-1124625745990626401" onmouseenter="enter('-1124625745990626401');" onmouseout="out('-1124625745990626401');" style="">  35 import org.broadleafcommerce.core.offer.domain.OrderItemAdjustment;                                      </span>
<span class="-6005336697873394325" onmouseenter="enter('-6005336697873394325');" onmouseout="out('-6005336697873394325');" style="">  36 import org.broadleafcommerce.core.offer.domain.OrderItemAdjustmentImpl;                                  </span>
<span class="6786419255693124735" onmouseenter="enter('6786419255693124735');" onmouseout="out('6786419255693124735');" style="">  37 import org.broadleafcommerce.core.offer.domain.OrderItemPriceDetailAdjustment;                           </span>
<span class="1848619708404770384" onmouseenter="enter('1848619708404770384');" onmouseout="out('1848619708404770384');" style="">  38 import org.broadleafcommerce.core.offer.service.OfferDataItemProvider;                                   </span>
<span class="-6326345691456347408" onmouseenter="enter('-6326345691456347408');" onmouseout="out('-6326345691456347408');" style="">  39 import org.broadleafcommerce.core.offer.service.OfferServiceImpl;                                        </span>
<span class="-3097197529305387536" onmouseenter="enter('-3097197529305387536');" onmouseout="out('-3097197529305387536');" style="">  40 import org.broadleafcommerce.core.offer.service.OfferServiceUtilitiesImpl;                               </span>
<span class="212527052176527689" onmouseenter="enter('212527052176527689');" onmouseout="out('212527052176527689');" style="">  41 import org.broadleafcommerce.core.offer.service.discount.CandidatePromotionItems;                        </span>
<span class="7831481241902679836" onmouseenter="enter('7831481241902679836');" onmouseout="out('7831481241902679836');" style="">  42 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableCandidateItemOffer;            </span>
<span class="-7261038068657094491" onmouseenter="enter('-7261038068657094491');" onmouseout="out('-7261038068657094491');" style="">  43 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableItemFactoryImpl;               </span>
<span class="5738750158392070" onmouseenter="enter('5738750158392070');" onmouseout="out('5738750158392070');" style="">  44 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOfferUtility;                  </span>
<span class="8873929720094471664" onmouseenter="enter('8873929720094471664');" onmouseout="out('8873929720094471664');" style="">  45 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOfferUtilityImpl;              </span>
<span class="-6456406933954769040" onmouseenter="enter('-6456406933954769040');" onmouseout="out('-6456406933954769040');" style="">  46 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOrder;                         </span>
<span class="-7733804833771661823" onmouseenter="enter('-7733804833771661823');" onmouseout="out('-7733804833771661823');" style="">  47 import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOrderItem;                     </span>
<span class="-5253725521220244448" onmouseenter="enter('-5253725521220244448');" onmouseout="out('-5253725521220244448');" style="">  48 import org.broadleafcommerce.core.offer.service.type.OfferDiscountType;                                  </span>
<span class="-8068779110760425254" onmouseenter="enter('-8068779110760425254');" onmouseout="out('-8068779110760425254');" style="">  49 import org.broadleafcommerce.core.offer.service.type.OfferItemRestrictionRuleType;                       </span>
<span class="-4951365057913084569" onmouseenter="enter('-4951365057913084569');" onmouseout="out('-4951365057913084569');" style="">  50 import org.broadleafcommerce.core.order.dao.FulfillmentGroupItemDao;                                     </span>
<span class="-7012758821456487335" onmouseenter="enter('-7012758821456487335');" onmouseout="out('-7012758821456487335');" style="">  51 import org.broadleafcommerce.core.order.dao.OrderItemDao;                                                </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  52 import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                        </span>
<span class="-7855842771160128779" onmouseenter="enter('-7855842771160128779');" onmouseout="out('-7855842771160128779');" style="">  53 import org.broadleafcommerce.core.order.domain.FulfillmentGroupItem;                                     </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  54 import org.broadleafcommerce.core.order.domain.Order;                                                    </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  55 import org.broadleafcommerce.core.order.domain.OrderItem;                                                </span>
<span class="230297408131782266" onmouseenter="enter('230297408131782266');" onmouseout="out('230297408131782266');" style="">  56 import org.broadleafcommerce.core.order.domain.OrderItemPriceDetail;                                     </span>
<span class="1218446574017128210" onmouseenter="enter('1218446574017128210');" onmouseout="out('1218446574017128210');" style="">  57 import org.broadleafcommerce.core.order.domain.OrderMultishipOption;                                     </span>
<span class="9050710118625717230" onmouseenter="enter('9050710118625717230');" onmouseout="out('9050710118625717230');" style="">  58 import org.broadleafcommerce.core.order.service.FulfillmentGroupService;                                 </span>
<span class="2043331085843421951" onmouseenter="enter('2043331085843421951');" onmouseout="out('2043331085843421951');" style="">  59 import org.broadleafcommerce.core.order.service.OrderItemService;                                        </span>
<span class="-4438462058374014857" onmouseenter="enter('-4438462058374014857');" onmouseout="out('-4438462058374014857');" style="">  60 import org.broadleafcommerce.core.order.service.OrderMultishipOptionService;                             </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  61 import org.broadleafcommerce.core.order.service.OrderService;                                            </span>
<span class="426062199469058864" onmouseenter="enter('426062199469058864');" onmouseout="out('426062199469058864');" style="">  62 import org.broadleafcommerce.core.order.service.call.FulfillmentGroupItemRequest;                        </span>
<span class="8043089028015557901" onmouseenter="enter('8043089028015557901');" onmouseout="out('8043089028015557901');" style="">  63 import org.easymock.EasyMock;                                                                            </span>
<span class="8773851019359685182" onmouseenter="enter('8773851019359685182');" onmouseout="out('8773851019359685182');" style="">  64 import org.easymock.IAnswer;                                                                             </span>
<span  style="">  65                                                                                                          </span>
<span  style="">  66                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  67 /**                                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  68  *                                                                                                       </span>
<span class="3104529581940833663" onmouseenter="enter('3104529581940833663');" onmouseout="out('3104529581940833663');" style="">  69  * @author jfischer                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  70  *                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  71  */                                                                                                      </span>
<span class="-2169245893345022929" onmouseenter="enter('-2169245893345022929');" onmouseout="out('-2169245893345022929');" style="">  72 public class ItemOfferProcessorTest extends TestCase {                                                   </span>
<span class="2764411618740579830" onmouseenter="enter('2764411618740579830');" onmouseout="out('2764411618740579830');" style="">  73     protected OfferDao offerDaoMock;                                                                     </span>
<span  style="">  74                                                                                                          </span>
<span class="-1028825014202044443" onmouseenter="enter('-1028825014202044443');" onmouseout="out('-1028825014202044443');" style="">  75     protected OrderItemDao orderItemDaoMock;                                                             </span>
<span  style="">  76                                                                                                          </span>
<span class="-5369679977326057444" onmouseenter="enter('-5369679977326057444');" onmouseout="out('-5369679977326057444');" style="">  77     protected OrderService orderServiceMock;                                                             </span>
<span  style="">  78                                                                                                          </span>
<span class="3942591246150891792" onmouseenter="enter('3942591246150891792');" onmouseout="out('3942591246150891792');" style="">  79     protected OfferServiceImpl offerService;                                                             </span>
<span  style="">  80                                                                                                          </span>
<span class="-2082308031004269425" onmouseenter="enter('-2082308031004269425');" onmouseout="out('-2082308031004269425');" style="">  81     protected OrderItemService orderItemServiceMock;                                                     </span>
<span  style="">  82                                                                                                          </span>
<span class="8143262996519322151" onmouseenter="enter('8143262996519322151');" onmouseout="out('8143262996519322151');" style="">  83     protected FulfillmentGroupItemDao fgItemDaoMock;                                                     </span>
<span  style="">  84                                                                                                          </span>
<span class="7756339209203921246" onmouseenter="enter('7756339209203921246');" onmouseout="out('7756339209203921246');" style="">  85     protected OfferDataItemProvider dataProvider = new OfferDataItemProvider();                          </span>
<span  style="">  86                                                                                                          </span>
<span class="3331618624366763309" onmouseenter="enter('3331618624366763309');" onmouseout="out('3331618624366763309');" style="">  87     protected FulfillmentGroupService fgServiceMock;                                                     </span>
<span  style="">  88                                                                                                          </span>
<span class="2038085072144601851" onmouseenter="enter('2038085072144601851');" onmouseout="out('2038085072144601851');" style="">  89     protected OrderMultishipOptionService multishipOptionServiceMock;                                    </span>
<span  style="">  90                                                                                                          </span>
<span class="1636757603740185885" onmouseenter="enter('1636757603740185885');" onmouseout="out('1636757603740185885');" style="">  91     protected OfferTimeZoneProcessor offerTimeZoneProcessorMock;                                         </span>
<span  style="">  92                                                                                                          </span>
<span class="-363767546438432308" onmouseenter="enter('-363767546438432308');" onmouseout="out('-363767546438432308');" style="">  93     protected PromotableOfferUtility promotableOfferUtility;                                             </span>
<span  style="">  94                                                                                                          </span>
<span class="8126767976686599164" onmouseenter="enter('8126767976686599164');" onmouseout="out('8126767976686599164');" style="">  95     protected GenericEntityService genericEntityServiceMock;                                             </span>
<span  style="">  96                                                                                                          </span>
<span class="-3472214566962333184" onmouseenter="enter('-3472214566962333184');" onmouseout="out('-3472214566962333184');" style="">  97     protected ItemOfferProcessorImpl itemProcessor;                                                      </span>
<span  style="">  98                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  99     @Override                                                                                            </span>
<span class="2289017037938349582" onmouseenter="enter('2289017037938349582');" onmouseout="out('2289017037938349582');" style=""> 100     protected void setUp() throws Exception {                                                            </span>
<span class="-5376116141285812671" onmouseenter="enter('-5376116141285812671');" onmouseout="out('-5376116141285812671');" style=""> 101         CustomerOfferDao customerOfferDaoMock = EasyMock.createMock(CustomerOfferDao.class);             </span>
<span class="-570975167499705701" onmouseenter="enter('-570975167499705701');" onmouseout="out('-570975167499705701');" style=""> 102         OfferCodeDao offerCodeDaoMock = EasyMock.createMock(OfferCodeDao.class);                         </span>
<span class="3258640190833853601" onmouseenter="enter('3258640190833853601');" onmouseout="out('3258640190833853601');" style=""> 103         offerDaoMock = EasyMock.createMock(OfferDao.class);                                              </span>
<span class="7274735973437056507" onmouseenter="enter('7274735973437056507');" onmouseout="out('7274735973437056507');" style=""> 104         orderItemDaoMock = EasyMock.createMock(OrderItemDao.class);                                      </span>
<span class="393627947078248392" onmouseenter="enter('393627947078248392');" onmouseout="out('393627947078248392');" style=""> 105         orderServiceMock = EasyMock.createMock(OrderService.class);                                      </span>
<span class="1993264780541814880" onmouseenter="enter('1993264780541814880');" onmouseout="out('1993264780541814880');" style=""> 106         orderItemServiceMock = EasyMock.createMock(OrderItemService.class);                              </span>
<span class="-3213369057155598174" onmouseenter="enter('-3213369057155598174');" onmouseout="out('-3213369057155598174');" style=""> 107         fgItemDaoMock = EasyMock.createMock(FulfillmentGroupItemDao.class);                              </span>
<span class="6964150545963317885" onmouseenter="enter('6964150545963317885');" onmouseout="out('6964150545963317885');" style=""> 108         fgServiceMock = EasyMock.createMock(FulfillmentGroupService.class);                              </span>
<span class="-3871783238737974896" onmouseenter="enter('-3871783238737974896');" onmouseout="out('-3871783238737974896');" style=""> 109         multishipOptionServiceMock = EasyMock.createMock(OrderMultishipOptionService.class);             </span>
<span class="-3280473616402059983" onmouseenter="enter('-3280473616402059983');" onmouseout="out('-3280473616402059983');" style=""> 110         offerTimeZoneProcessorMock = EasyMock.createMock(OfferTimeZoneProcessor.class);                  </span>
<span  style=""> 111                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 112 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-5708051595893590327" onmouseenter="enter('-5708051595893590327');" onmouseout="out('-5708051595893590327');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 113         promotableOfferUtility = new PromotableOfferUtilityImpl();                                       </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 114 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 115 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 115 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 116 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117                                                                                                          </span>
<span class="-8978123556236380411" onmouseenter="enter('-8978123556236380411');" onmouseout="out('-8978123556236380411');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118         genericEntityServiceMock = EasyMock.createMock(GenericEntityService.class);                      </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 119 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style=""> 120                                                                                                          </span>
<span class="3514247750798048226" onmouseenter="enter('3514247750798048226');" onmouseout="out('3514247750798048226');" style=""><abbr title=" 121         OfferServiceUtilitiesImpl offerServiceUtilities = new OfferServiceUtilitiesImpl(promotableOfferUtility);"> 121         OfferServiceUtilitiesImpl offerServiceUtilities = new OfferServiceUtilitiesImpl(promotableOfferUtðŸ”µ</abbr></span>
<span class="4393308911552043332" onmouseenter="enter('4393308911552043332');" onmouseout="out('4393308911552043332');" style=""> 122         offerServiceUtilities.setOfferDao(offerDaoMock);                                                 </span>
<span class="7561232175961587910" onmouseenter="enter('7561232175961587910');" onmouseout="out('7561232175961587910');" style=""><abbr title=" 123         offerServiceUtilities.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));"> 123         offerServiceUtilities.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtiliðŸ”µ</abbr></span>
<span class="8346807884110674152" onmouseenter="enter('8346807884110674152');" onmouseout="out('8346807884110674152');" style=""> 124         offerServiceUtilities.setGenericEntityService(genericEntityServiceMock);                         </span>
<span class="-5954143808619933939" onmouseenter="enter('-5954143808619933939');" onmouseout="out('-5954143808619933939');" style=""> 125         itemProcessor = new ItemOfferProcessorImpl(promotableOfferUtility);                              </span>
<span class="-7004957386218896406" onmouseenter="enter('-7004957386218896406');" onmouseout="out('-7004957386218896406');" style=""> 126         itemProcessor.setOfferDao(offerDaoMock);                                                         </span>
<span class="-7985735156898326914" onmouseenter="enter('-7985735156898326914');" onmouseout="out('-7985735156898326914');" style=""> 127         itemProcessor.setOrderItemDao(orderItemDaoMock);                                                 </span>
<span class="-4628842602683269361" onmouseenter="enter('-4628842602683269361');" onmouseout="out('-4628842602683269361');" style=""> 128         itemProcessor.setOfferTimeZoneProcessor(offerTimeZoneProcessorMock);                             </span>
<span class="-2793185480423849018" onmouseenter="enter('-2793185480423849018');" onmouseout="out('-2793185480423849018');" style=""> 129         itemProcessor.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));   </span>
<span class="1873271206223196651" onmouseenter="enter('1873271206223196651');" onmouseout="out('1873271206223196651');" style=""> 130         itemProcessor.setOfferServiceUtilities(offerServiceUtilities);                                   </span>
<span class="-7001064742117532685" onmouseenter="enter('-7001064742117532685');" onmouseout="out('-7001064742117532685');" style=""> 131         offerService = new OfferServiceImpl();                                                           </span>
<span class="-7168324839350089956" onmouseenter="enter('-7168324839350089956');" onmouseout="out('-7168324839350089956');" style=""> 132         OrderOfferProcessorImpl orderProcessor = new OrderOfferProcessorImpl(promotableOfferUtility);    </span>
<span class="-8216532080679576302" onmouseenter="enter('-8216532080679576302');" onmouseout="out('-8216532080679576302');" style=""> 133         orderProcessor.setOfferDao(offerDaoMock);                                                        </span>
<span class="5575229934633988866" onmouseenter="enter('5575229934633988866');" onmouseout="out('5575229934633988866');" style=""> 134         orderProcessor.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));  </span>
<span class="-4588344466186947569" onmouseenter="enter('-4588344466186947569');" onmouseout="out('-4588344466186947569');" style=""> 135         orderProcessor.setOfferTimeZoneProcessor(offerTimeZoneProcessorMock);                            </span>
<span class="-7787408525763214442" onmouseenter="enter('-7787408525763214442');" onmouseout="out('-7787408525763214442');" style=""> 136         orderProcessor.setOrderItemDao(orderItemDaoMock);                                                </span>
<span class="-8932862412317704790" onmouseenter="enter('-8932862412317704790');" onmouseout="out('-8932862412317704790');" style=""> 137         orderProcessor.setOfferServiceUtilities(offerServiceUtilities);                                  </span>
<span class="-7594314374485898167" onmouseenter="enter('-7594314374485898167');" onmouseout="out('-7594314374485898167');" style=""> 138         offerService.setCustomerOfferDao(customerOfferDaoMock);                                          </span>
<span class="483175997286853822" onmouseenter="enter('483175997286853822');" onmouseout="out('483175997286853822');" style=""> 139         offerService.setOfferCodeDao(offerCodeDaoMock);                                                  </span>
<span class="-157638129368187663" onmouseenter="enter('-157638129368187663');" onmouseout="out('-157638129368187663');" style=""> 140         offerService.setOfferDao(offerDaoMock);                                                          </span>
<span class="-2861300639666845512" onmouseenter="enter('-2861300639666845512');" onmouseout="out('-2861300639666845512');" style=""> 141         offerService.setOrderOfferProcessor(orderProcessor);                                             </span>
<span class="4668119620018038426" onmouseenter="enter('4668119620018038426');" onmouseout="out('4668119620018038426');" style=""> 142         offerService.setItemOfferProcessor(itemProcessor);                                               </span>
<span class="-2798583477021709202" onmouseenter="enter('-2798583477021709202');" onmouseout="out('-2798583477021709202');" style=""> 143         offerService.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));    </span>
<span class="-7013122243510448528" onmouseenter="enter('-7013122243510448528');" onmouseout="out('-7013122243510448528');" style=""> 144         offerService.setOrderService(orderServiceMock);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145     }                                                                                                    </span>
<span  style=""> 146                                                                                                          </span>
<span class="-425214870767341244" onmouseenter="enter('-425214870767341244');" onmouseout="out('-425214870767341244');" style=""> 147     public void replay() throws Exception {                                                              </span>
<span class="3688914841313020601" onmouseenter="enter('3688914841313020601');" onmouseout="out('3688914841313020601');" style=""><abbr title=" 148         EasyMock.expect(orderItemDaoMock.createOrderItemPriceDetail()).andAnswer(OfferDataItemProvider.getCreateOrderItemPriceDetailAnswer()).anyTimes();"> 148         EasyMock.expect(orderItemDaoMock.createOrderItemPriceDetail()).andAnswer(OfferDataItemProvider.geðŸ”µ</abbr></span>
<span class="-201012827833234886" onmouseenter="enter('-201012827833234886');" onmouseout="out('-201012827833234886');" style=""><abbr title=" 149         EasyMock.expect(orderItemDaoMock.createOrderItemQualifier()).andAnswer(OfferDataItemProvider.getCreateOrderItemQualifierAnswer()).anyTimes();"> 149         EasyMock.expect(orderItemDaoMock.createOrderItemQualifier()).andAnswer(OfferDataItemProvider.getCðŸ”µ</abbr></span>
<span class="3313434268437563429" onmouseenter="enter('3313434268437563429');" onmouseout="out('3313434268437563429');" style=""><abbr title=" 150         EasyMock.expect(offerDaoMock.createOrderItemPriceDetailAdjustment()).andAnswer(OfferDataItemProvider.getCreateOrderItemPriceDetailAdjustmentAnswer()).anyTimes();"> 150         EasyMock.expect(offerDaoMock.createOrderItemPriceDetailAdjustment()).andAnswer(OfferDataItemProviðŸ”µ</abbr></span>
<span  style=""> 151                                                                                                          </span>
<span class="-4805711593793558927" onmouseenter="enter('-4805711593793558927');" onmouseout="out('-4805711593793558927');" style=""><abbr title=" 152         EasyMock.expect(fgServiceMock.addItemToFulfillmentGroup(EasyMock.isA(FulfillmentGroupItemRequest.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getAddItemToFulfillmentGroupAnswer()).anyTimes();"> 152         EasyMock.expect(fgServiceMock.addItemToFulfillmentGroup(EasyMock.isA(FulfillmentGroupItemRequest.ðŸ”µ</abbr></span>
<span class="-4648578783612235576" onmouseenter="enter('-4648578783612235576');" onmouseout="out('-4648578783612235576');" style=""><abbr title=" 153         EasyMock.expect(orderServiceMock.removeItem(EasyMock.isA(Long.class), EasyMock.isA(Long.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getRemoveItemFromOrderAnswer()).anyTimes();"> 153         EasyMock.expect(orderServiceMock.removeItem(EasyMock.isA(Long.class), EasyMock.isA(Long.class), EðŸ”µ</abbr></span>
<span class="-25100646963641968" onmouseenter="enter('-25100646963641968');" onmouseout="out('-25100646963641968');" style=""><abbr title=" 154         EasyMock.expect(orderServiceMock.save(EasyMock.isA(Order.class), EasyMock.isA(Boolean.class))).andAnswer(OfferDataItemProvider.getSaveOrderAnswer()).anyTimes();"> 154         EasyMock.expect(orderServiceMock.save(EasyMock.isA(Order.class), EasyMock.isA(Boolean.class))).anðŸ”µ</abbr></span>
<span  style=""> 155                                                                                                          </span>
<span class="2160564019413082164" onmouseenter="enter('2160564019413082164');" onmouseout="out('2160564019413082164');" style=""> 156         EasyMock.expect(orderServiceMock.getAutomaticallyMergeLikeItems()).andReturn(true).anyTimes();   </span>
<span  style=""> 157                                                                                                          </span>
<span class="-8884522234726007395" onmouseenter="enter('-8884522234726007395');" onmouseout="out('-8884522234726007395');" style=""><abbr title=" 158         EasyMock.expect(orderItemServiceMock.saveOrderItem(EasyMock.isA(OrderItem.class))).andAnswer(OfferDataItemProvider.getSaveOrderItemAnswer()).anyTimes();"> 158         EasyMock.expect(orderItemServiceMock.saveOrderItem(EasyMock.isA(OrderItem.class))).andAnswer(OffeðŸ”µ</abbr></span>
<span class="-3554631046904274751" onmouseenter="enter('-3554631046904274751');" onmouseout="out('-3554631046904274751');" style=""><abbr title=" 159         EasyMock.expect(fgItemDaoMock.save(EasyMock.isA(FulfillmentGroupItem.class))).andAnswer(OfferDataItemProvider.getSaveFulfillmentGroupItemAnswer()).anyTimes();"> 159         EasyMock.expect(fgItemDaoMock.save(EasyMock.isA(FulfillmentGroupItem.class))).andAnswer(OfferDataðŸ”µ</abbr></span>
<span  style=""> 160                                                                                                          </span>
<span class="2031702441279524669" onmouseenter="enter('2031702441279524669');" onmouseout="out('2031702441279524669');" style=""><abbr title=" 161         EasyMock.expect(multishipOptionServiceMock.findOrderMultishipOptions(EasyMock.isA(Long.class))).andAnswer(new IAnswer&lt;List&lt;OrderMultishipOption&gt;&gt;() {"> 161         EasyMock.expect(multishipOptionServiceMock.findOrderMultishipOptions(EasyMock.isA(Long.class))).aðŸ”µ</abbr></span>
<span  style=""> 162                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 163             @Override                                                                                    </span>
<span class="4982536128511672004" onmouseenter="enter('4982536128511672004');" onmouseout="out('4982536128511672004');" style=""> 164             public List&lt;OrderMultishipOption&gt; answer() throws Throwable {                                </span>
<span class="4748136149545123859" onmouseenter="enter('4748136149545123859');" onmouseout="out('4748136149545123859');" style=""> 165                 return new ArrayList&lt;OrderMultishipOption&gt;();                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166             }                                                                                            </span>
<span class="-8356082990236199220" onmouseenter="enter('-8356082990236199220');" onmouseout="out('-8356082990236199220');" style=""> 167         }).anyTimes();                                                                                   </span>
<span  style=""> 168                                                                                                          </span>
<span class="5730763888734231228" onmouseenter="enter('5730763888734231228');" onmouseout="out('5730763888734231228');" style=""> 169         multishipOptionServiceMock.deleteAllOrderMultishipOptions(EasyMock.isA(Order.class));            </span>
<span class="-238683341484251031" onmouseenter="enter('-238683341484251031');" onmouseout="out('-238683341484251031');" style=""> 170         EasyMock.expectLastCall().anyTimes();                                                            </span>
<span class="3680375331985361488" onmouseenter="enter('3680375331985361488');" onmouseout="out('3680375331985361488');" style=""><abbr title=" 171         EasyMock.expect(fgServiceMock.collapseToOneShippableFulfillmentGroup(EasyMock.isA(Order.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getSameOrderAnswer()).anyTimes();"> 171         EasyMock.expect(fgServiceMock.collapseToOneShippableFulfillmentGroup(EasyMock.isA(Order.class), EðŸ”µ</abbr></span>
<span class="7005207656442723333" onmouseenter="enter('7005207656442723333');" onmouseout="out('7005207656442723333');" style=""><abbr title=" 172         EasyMock.expect(fgItemDaoMock.create()).andAnswer(OfferDataItemProvider.getCreateFulfillmentGroupItemAnswer()).anyTimes();"> 172         EasyMock.expect(fgItemDaoMock.create()).andAnswer(OfferDataItemProvider.getCreateFulfillmentGroupðŸ”µ</abbr></span>
<span class="3552856255510166668" onmouseenter="enter('3552856255510166668');" onmouseout="out('3552856255510166668');" style=""> 173         fgItemDaoMock.delete(EasyMock.isA(FulfillmentGroupItem.class));                                  </span>
<span class="-238683341484251031" onmouseenter="enter('-238683341484251031');" onmouseout="out('-238683341484251031');" style=""> 174         EasyMock.expectLastCall().anyTimes();                                                            </span>
<span class="602433099109498087" onmouseenter="enter('602433099109498087');" onmouseout="out('602433099109498087');" style=""><abbr title=" 175         EasyMock.expect(offerTimeZoneProcessorMock.getTimeZone(EasyMock.isA(OfferImpl.class))).andReturn(TimeZone.getTimeZone(&quot;CST&quot;)).anyTimes();"> 175         EasyMock.expect(offerTimeZoneProcessorMock.getTimeZone(EasyMock.isA(OfferImpl.class))).andReturn(ðŸ”µ</abbr></span>
<span  style=""> 176                                                                                                          </span>
<span class="4039967104390893601" onmouseenter="enter('4039967104390893601');" onmouseout="out('4039967104390893601');" style=""> 177         EasyMock.replay(offerDaoMock);                                                                   </span>
<span class="-8438798452743116996" onmouseenter="enter('-8438798452743116996');" onmouseout="out('-8438798452743116996');" style=""> 178         EasyMock.replay(orderItemDaoMock);                                                               </span>
<span class="-306516478140011318" onmouseenter="enter('-306516478140011318');" onmouseout="out('-306516478140011318');" style=""> 179         EasyMock.replay(orderServiceMock);                                                               </span>
<span class="-1764805494951210013" onmouseenter="enter('-1764805494951210013');" onmouseout="out('-1764805494951210013');" style=""> 180         EasyMock.replay(orderItemServiceMock);                                                           </span>
<span class="1127149787736159594" onmouseenter="enter('1127149787736159594');" onmouseout="out('1127149787736159594');" style=""> 181         EasyMock.replay(fgItemDaoMock);                                                                  </span>
<span class="220377317211655869" onmouseenter="enter('220377317211655869');" onmouseout="out('220377317211655869');" style=""> 182         EasyMock.replay(fgServiceMock);                                                                  </span>
<span class="7141248576860687210" onmouseenter="enter('7141248576860687210');" onmouseout="out('7141248576860687210');" style=""> 183         EasyMock.replay(multishipOptionServiceMock);                                                     </span>
<span class="1625398624145697967" onmouseenter="enter('1625398624145697967');" onmouseout="out('1625398624145697967');" style=""> 184         EasyMock.replay(offerTimeZoneProcessorMock);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185     }                                                                                                    </span>
<span  style=""> 186                                                                                                          </span>
<span class="6267001839391766981" onmouseenter="enter('6267001839391766981');" onmouseout="out('6267001839391766981');" style=""> 187     public void verify() {                                                                               </span>
<span class="6756940960390862422" onmouseenter="enter('6756940960390862422');" onmouseout="out('6756940960390862422');" style=""> 188         EasyMock.verify(offerDaoMock);                                                                   </span>
<span class="-5117344946758939057" onmouseenter="enter('-5117344946758939057');" onmouseout="out('-5117344946758939057');" style=""> 189         EasyMock.verify(orderItemDaoMock);                                                               </span>
<span class="-6538245312297088944" onmouseenter="enter('-6538245312297088944');" onmouseout="out('-6538245312297088944');" style=""> 190         EasyMock.verify(orderServiceMock);                                                               </span>
<span class="4656187310788509663" onmouseenter="enter('4656187310788509663');" onmouseout="out('4656187310788509663');" style=""> 191         EasyMock.verify(orderItemServiceMock);                                                           </span>
<span class="-3344344690958109982" onmouseenter="enter('-3344344690958109982');" onmouseout="out('-3344344690958109982');" style=""> 192         EasyMock.verify(fgItemDaoMock);                                                                  </span>
<span class="-7107457974865616724" onmouseenter="enter('-7107457974865616724');" onmouseout="out('-7107457974865616724');" style=""> 193         EasyMock.verify(fgServiceMock);                                                                  </span>
<span class="3082501288673197520" onmouseenter="enter('3082501288673197520');" onmouseout="out('3082501288673197520');" style=""> 194         EasyMock.verify(multishipOptionServiceMock);                                                     </span>
<span class="8968216054532738001" onmouseenter="enter('8968216054532738001');" onmouseout="out('8968216054532738001');" style=""> 195         EasyMock.verify(offerTimeZoneProcessorMock);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196     }                                                                                                    </span>
<span  style=""> 197                                                                                                          </span>
<span class="4417344074261065537" onmouseenter="enter('4417344074261065537');" onmouseout="out('4417344074261065537');" style=""> 198     public void testFilterItemLevelOffer() throws Exception {                                            </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 199         replay();                                                                                        </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""><abbr title=" 200         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();"> 200         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;(ðŸ”µ</abbr></span>
<span class="3261984753430660401" onmouseenter="enter('3261984753430660401');" onmouseout="out('3261984753430660401');" style=""><abbr title=" 201         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, null, null);"> 201         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount(ðŸ”µ</abbr></span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style=""> 202         PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);         </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 203         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span class="-5619667927750455603" onmouseenter="enter('-5619667927750455603');" onmouseout="out('-5619667927750455603');" style=""> 204         // test that the valid order item offer is included - legacy format - no qualifier               </span>
<span class="-8982013321199183577" onmouseenter="enter('-8982013321199183577');" onmouseout="out('-8982013321199183577');" style=""> 205         // since there&#x27;s no qualifier, both items can apply                                              </span>
<span class="8674824753424198113" onmouseenter="enter('8674824753424198113');" onmouseout="out('8674824753424198113');" style=""> 206         // This line is commented out because we are no longer creating legacy offers.                   </span>
<span class="-6120001570063350256" onmouseenter="enter('-6120001570063350256');" onmouseout="out('-6120001570063350256');" style=""><abbr title=" 207         // assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offers.get(0)));"> 207         // assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(ðŸ”µ</abbr></span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 208         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="-8544227672031967841" onmouseenter="enter('-8544227672031967841');" onmouseout="out('-8544227672031967841');" style=""><abbr title=" 209         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;);"> 209         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferðŸ”µ</abbr></span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 210         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span class="-5044607870597538258" onmouseenter="enter('-5044607870597538258');" onmouseout="out('-5044607870597538258');" style=""> 211         // test that the valid order item offer is included                                              </span>
<span class="-2938861025997318052" onmouseenter="enter('-2938861025997318052');" onmouseout="out('-2938861025997318052');" style=""><abbr title=" 212         // there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one qualifier in the qualifiers map"> 212         // there is a qualifier and the item qualifying criteria requires only 1, therefore there will beðŸ”µ</abbr></span>
<span class="-259319583278204968" onmouseenter="enter('-259319583278204968');" onmouseout="out('-259319583278204968');" style=""> 213         // we don&#x27;t know the targets yet, so there&#x27;s only one CandidateItemOffer for now                 </span>
<span class="-4972655435311768749" onmouseenter="enter('-4972655435311768749');" onmouseout="out('-4972655435311768749');" style=""><abbr title=" 214         assertTrue(((qualifiedOffers.size() == 1) &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0))) &amp;&amp; (qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1));"> 214         assertTrue(((qualifiedOffers.size() == 1) &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(ðŸ”µ</abbr></span>
<span class="-8860615526139513207" onmouseenter="enter('-8860615526139513207');" onmouseout="out('-8860615526139513207');" style=""> 215         // Add a subtotal requirement that will be met by the item offer.                                </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 216         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="-8544227672031967841" onmouseenter="enter('-8544227672031967841');" onmouseout="out('-8544227672031967841');" style=""><abbr title=" 217         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;);"> 217         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferðŸ”µ</abbr></span>
<span class="8674510659006467642" onmouseenter="enter('8674510659006467642');" onmouseout="out('8674510659006467642');" style=""> 218         offers.get(0).setQualifyingItemSubTotal(new Money(1));                                           </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 219         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span class="-5044607870597538258" onmouseenter="enter('-5044607870597538258');" onmouseout="out('-5044607870597538258');" style=""> 220         // test that the valid order item offer is included                                              </span>
<span class="-2938861025997318052" onmouseenter="enter('-2938861025997318052');" onmouseout="out('-2938861025997318052');" style=""><abbr title=" 221         // there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one qualifier in the qualifiers map"> 221         // there is a qualifier and the item qualifying criteria requires only 1, therefore there will beðŸ”µ</abbr></span>
<span class="-259319583278204968" onmouseenter="enter('-259319583278204968');" onmouseout="out('-259319583278204968');" style=""> 222         // we don&#x27;t know the targets yet, so there&#x27;s only one CandidateItemOffer for now                 </span>
<span class="-4972655435311768749" onmouseenter="enter('-4972655435311768749');" onmouseout="out('-4972655435311768749');" style=""><abbr title=" 223         assertTrue(((qualifiedOffers.size() == 1) &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0))) &amp;&amp; (qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1));"> 223         assertTrue(((qualifiedOffers.size() == 1) &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(ðŸ”µ</abbr></span>
<span class="5301041827655263880" onmouseenter="enter('5301041827655263880');" onmouseout="out('5301041827655263880');" style=""> 224         // Add a subtotal requirement that will not be met by the item offer.                            </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 225         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="-8544227672031967841" onmouseenter="enter('-8544227672031967841');" onmouseout="out('-8544227672031967841');" style=""><abbr title=" 226         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;);"> 226         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferðŸ”µ</abbr></span>
<span class="1138045012752265464" onmouseenter="enter('1138045012752265464');" onmouseout="out('1138045012752265464');" style=""> 227         offers.get(0).setQualifyingItemSubTotal(new Money(99999));                                       </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 228         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span class="-2233954948767969133" onmouseenter="enter('-2233954948767969133');" onmouseout="out('-2233954948767969133');" style=""> 229         // Since the item qualification subTotal is not met, the qualified offer size should             </span>
<span class="-2484407164144589249" onmouseenter="enter('-2484407164144589249');" onmouseout="out('-2484407164144589249');" style=""> 230         // be zero.                                                                                      </span>
<span class="5374855092322283448" onmouseenter="enter('5374855092322283448');" onmouseout="out('5374855092322283448');" style=""> 231         assertTrue(qualifiedOffers.size() == 0);                                                         </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 232         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="4006445850521218236" onmouseenter="enter('4006445850521218236');" onmouseout="out('4006445850521218236');" style=""><abbr title=" 233         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;);"> 233         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferðŸ”µ</abbr></span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 234         itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                       </span>
<span class="3903235845851128309" onmouseenter="enter('3903235845851128309');" onmouseout="out('3903235845851128309');" style=""> 235         // test that the invalid order item offer is excluded                                            </span>
<span class="5374855092322283448" onmouseenter="enter('5374855092322283448');" onmouseout="out('5374855092322283448');" style=""> 236         assertTrue(qualifiedOffers.size() == 0);                                                         </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 237         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238     }                                                                                                    </span>
<span  style=""> 239                                                                                                          </span>
<span class="2350776504190590277" onmouseenter="enter('2350776504190590277');" onmouseout="out('2350776504190590277');" style=""> 240     public void testCouldOfferApplyToOrder() throws Exception {                                          </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 241         replay();                                                                                        </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style=""> 242         PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);         </span>
<span class="3261984753430660401" onmouseenter="enter('3261984753430660401');" onmouseout="out('3261984753430660401');" style=""><abbr title=" 243         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, null, null);"> 243         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount(ðŸ”µ</abbr></span>
<span class="7853971483654053322" onmouseenter="enter('7853971483654053322');" onmouseout="out('7853971483654053322');" style=""><abbr title=" 244         boolean couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderItems().get(0), order.getFulfillmentGroups().get(0));"> 244         boolean couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountðŸ”µ</abbr></span>
<span class="-5044607870597538258" onmouseenter="enter('-5044607870597538258');" onmouseout="out('-5044607870597538258');" style=""> 245         // test that the valid order item offer is included                                              </span>
<span class="7931914881113900287" onmouseenter="enter('7931914881113900287');" onmouseout="out('7931914881113900287');" style=""> 246         assertTrue(couldApply);                                                                          </span>
<span class="3107146737101088359" onmouseenter="enter('3107146737101088359');" onmouseout="out('3107146737101088359');" style=""><abbr title=" 247         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()==0&quot;, OfferDiscountType.PERCENT_OFF, null, null);"> 247         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()==0&quot;, OfferðŸ”µ</abbr></span>
<span class="2583469720888306492" onmouseenter="enter('2583469720888306492');" onmouseout="out('2583469720888306492');" style=""><abbr title=" 248         couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderItems().get(0), order.getFulfillmentGroups().get(0));"> 248         couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrdeðŸ”µ</abbr></span>
<span class="3903235845851128309" onmouseenter="enter('3903235845851128309');" onmouseout="out('3903235845851128309');" style=""> 249         // test that the invalid order item offer is excluded                                            </span>
<span class="2773091290643222945" onmouseenter="enter('2773091290643222945');" onmouseout="out('2773091290643222945');" style=""> 250         assertFalse(couldApply);                                                                         </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 251         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252     }                                                                                                    </span>
<span  style=""> 253                                                                                                          </span>
<span class="-3815970332732974591" onmouseenter="enter('-3815970332732974591');" onmouseout="out('-3815970332732974591');" style=""> 254     public void testCouldOrderItemMeetOfferRequirement() throws Exception {                              </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 255         replay();                                                                                        </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style=""> 256         PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);         </span>
<span class="-749682114149899464" onmouseenter="enter('-749682114149899464');" onmouseout="out('-749682114149899464');" style=""><abbr title=" 257         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;);"> 257         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount(ðŸ”µ</abbr></span>
<span class="1501673451570831850" onmouseenter="enter('1501673451570831850');" onmouseout="out('1501673451570831850');" style=""><abbr title=" 258         OfferQualifyingCriteriaXref xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next();"> 258         OfferQualifyingCriteriaXref xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next(ðŸ”µ</abbr></span>
<span class="-472249920513934405" onmouseenter="enter('-472249920513934405');" onmouseout="out('-472249920513934405');" style=""><abbr title=" 259         boolean couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.getDiscountableOrderItems().get(0));"> 259         boolean couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria()ðŸ”µ</abbr></span>
<span class="-5044607870597538258" onmouseenter="enter('-5044607870597538258');" onmouseout="out('-5044607870597538258');" style=""> 260         // test that the valid order item offer is included                                              </span>
<span class="7931914881113900287" onmouseenter="enter('7931914881113900287');" onmouseout="out('7931914881113900287');" style=""> 261         assertTrue(couldApply);                                                                          </span>
<span class="4006445850521218236" onmouseenter="enter('4006445850521218236');" onmouseout="out('4006445850521218236');" style=""><abbr title=" 262         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;);"> 262         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferðŸ”µ</abbr></span>
<span class="2238137642305281390" onmouseenter="enter('2238137642305281390');" onmouseout="out('2238137642305281390');" style=""> 263         xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next();                          </span>
<span class="7022359060345229272" onmouseenter="enter('7022359060345229272');" onmouseout="out('7022359060345229272');" style=""><abbr title=" 264         couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.getDiscountableOrderItems().get(0));"> 264         couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.ðŸ”µ</abbr></span>
<span class="3903235845851128309" onmouseenter="enter('3903235845851128309');" onmouseout="out('3903235845851128309');" style=""> 265         // test that the invalid order item offer is excluded                                            </span>
<span class="2773091290643222945" onmouseenter="enter('2773091290643222945');" onmouseout="out('2773091290643222945');" style=""> 266         assertFalse(couldApply);                                                                         </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 267         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268     }                                                                                                    </span>
<span  style=""> 269                                                                                                          </span>
<span class="8397400473119507330" onmouseenter="enter('8397400473119507330');" onmouseout="out('8397400473119507330');" style=""> 270     public void testCouldOfferApplyToOrderItems() throws Exception {                                     </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 271         replay();                                                                                        </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style=""> 272         PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);         </span>
<span class="-749682114149899464" onmouseenter="enter('-749682114149899464');" onmouseout="out('-749682114149899464');" style=""><abbr title=" 273         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;);"> 273         List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount(ðŸ”µ</abbr></span>
<span class="-4222545078163101091" onmouseenter="enter('-4222545078163101091');" onmouseout="out('-4222545078163101091');" style=""> 274         List&lt;PromotableOrderItem&gt; orderItems = new ArrayList&lt;PromotableOrderItem&gt;();                     </span>
<span class="-7372483979901719352" onmouseenter="enter('-7372483979901719352');" onmouseout="out('-7372483979901719352');" style=""> 275         for (PromotableOrderItem orderItem : order.getDiscountableOrderItems()) {                        </span>
<span class="5423314879443576267" onmouseenter="enter('5423314879443576267');" onmouseout="out('5423314879443576267');" style=""> 276             orderItems.add(orderItem);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277         }                                                                                                </span>
<span class="8798832722266180533" onmouseenter="enter('8798832722266180533');" onmouseout="out('8798832722266180533');" style=""><abbr title=" 278         CandidatePromotionItems candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), orderItems);"> 278         CandidatePromotionItems candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), ordðŸ”µ</abbr></span>
<span class="-5044607870597538258" onmouseenter="enter('-5044607870597538258');" onmouseout="out('-5044607870597538258');" style=""> 279         // test that the valid order item offer is included                                              </span>
<span class="3581347350657271654" onmouseenter="enter('3581347350657271654');" onmouseout="out('3581347350657271654');" style=""> 280         // both cart items are valid for qualification and target                                        </span>
<span class="-7796213717334839221" onmouseenter="enter('-7796213717334839221');" onmouseout="out('-7796213717334839221');" style=""><abbr title=" 281         assertTrue(((((candidates.isMatchedQualifier() &amp;&amp; (candidates.getCandidateQualifiersMap().size() == 1)) &amp;&amp; (candidates.getCandidateQualifiersMap().values().iterator().next().size() == 2)) &amp;&amp; candidates.isMatchedTarget()) &amp;&amp; (candidates.getCandidateTargetsMap().size() == 1)) &amp;&amp; (candidates.getCandidateTargetsMap().values().iterator().next().size() == 2));"> 281         assertTrue(((((candidates.isMatchedQualifier() &amp;&amp; (candidates.getCandidateQualifiersMap().size() ðŸ”µ</abbr></span>
<span class="4006445850521218236" onmouseenter="enter('4006445850521218236');" onmouseout="out('4006445850521218236');" style=""><abbr title=" 282         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;);"> 282         offers = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferðŸ”µ</abbr></span>
<span class="-7318029938713023882" onmouseenter="enter('-7318029938713023882');" onmouseout="out('-7318029938713023882');" style=""> 283         candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), orderItems);               </span>
<span class="-140807031159722622" onmouseenter="enter('-140807031159722622');" onmouseout="out('-140807031159722622');" style=""> 284         // test that the invalid order item offer is excluded because there are no qualifying items      </span>
<span class="1594257511686915167" onmouseenter="enter('1594257511686915167');" onmouseout="out('1594257511686915167');" style=""><abbr title=" 285         assertFalse(candidates.isMatchedQualifier() &amp;&amp; (candidates.getCandidateQualifiersMap().size() == 1));"> 285         assertFalse(candidates.isMatchedQualifier() &amp;&amp; (candidates.getCandidateQualifiersMap().size() == ðŸ”µ</abbr></span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 286         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287     }                                                                                                    </span>
<span  style=""> 288                                                                                                          </span>
<span class="-2310379539708411407" onmouseenter="enter('-2310379539708411407');" onmouseout="out('-2310379539708411407');" style=""> 289     private int checkOrderItemOfferAppliedCount(Order order) {                                           </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 290         int count = 0;                                                                                   </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 291         for (OrderItem item : order.getOrderItems()) {                                                   </span>
<span class="773323050474809935" onmouseenter="enter('773323050474809935');" onmouseout="out('773323050474809935');" style=""> 292             for (OrderItemPriceDetail detail : item.getOrderItemPriceDetails()) {                        </span>
<span class="-7653326266832377040" onmouseenter="enter('-7653326266832377040');" onmouseout="out('-7653326266832377040');" style=""><abbr title=" 293                 count = count + (detail.getOrderItemPriceDetailAdjustments().size() * detail.getQuantity());"> 293                 count = count + (detail.getOrderItemPriceDetailAdjustments().size() * detail.getQuantity(ðŸ”µ</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295         }                                                                                                </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 296         return count;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297     }                                                                                                    </span>
<span  style=""> 298                                                                                                          </span>
<span class="352390873819089414" onmouseenter="enter('352390873819089414');" onmouseout="out('352390873819089414');" style=""> 299     private int checkOrderItemOfferAppliedQuantity(Order order, Offer offer) {                           </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 300         int count = 0;                                                                                   </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 301         for (OrderItem item : order.getOrderItems()) {                                                   </span>
<span class="773323050474809935" onmouseenter="enter('773323050474809935');" onmouseout="out('773323050474809935');" style=""> 302             for (OrderItemPriceDetail detail : item.getOrderItemPriceDetails()) {                        </span>
<span class="-2015743447488247947" onmouseenter="enter('-2015743447488247947');" onmouseout="out('-2015743447488247947');" style=""><abbr title=" 303                 for (OrderItemPriceDetailAdjustment adjustment : detail.getOrderItemPriceDetailAdjustments()) {"> 303                 for (OrderItemPriceDetailAdjustment adjustment : detail.getOrderItemPriceDetailAdjustmentðŸ”µ</abbr></span>
<span class="-6326222561939664995" onmouseenter="enter('-6326222561939664995');" onmouseout="out('-6326222561939664995');" style=""> 304                     if (adjustment.getOffer().getId().equals(offer.getId())) {                           </span>
<span class="6653455861258404903" onmouseenter="enter('6653455861258404903');" onmouseout="out('6653455861258404903');" style=""> 305                         count += detail.getQuantity();                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309         }                                                                                                </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 310         return count;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311     }                                                                                                    </span>
<span  style=""> 312                                                                                                          </span>
<span class="8856632786224131584" onmouseenter="enter('8856632786224131584');" onmouseout="out('8856632786224131584');" style=""> 313     private int countPriceDetails(Order order) {                                                         </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 314         int count = 0;                                                                                   </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 315         for (OrderItem item : order.getOrderItems()) {                                                   </span>
<span class="-2490083702571223921" onmouseenter="enter('-2490083702571223921');" onmouseout="out('-2490083702571223921');" style=""> 316             count = count + item.getOrderItemPriceDetails().size();                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317         }                                                                                                </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 318         return count;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319     }                                                                                                    </span>
<span  style=""> 320                                                                                                          </span>
<span class="-7256708927614783311" onmouseenter="enter('-7256708927614783311');" onmouseout="out('-7256708927614783311');" style=""> 321     public void testApplyAllItemOffers() throws Exception {                                              </span>
<span  style=""> 322                                                                                                          </span>
<span  style=""> 323                                                                                                          </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 324         replay();                                                                                        </span>
<span  style=""> 325                                                                                                          </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 326         Order order = dataProvider.createBasicOrder();                                                   </span>
<span  style=""> 327                                                                                                          </span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 328         Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 329             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 330             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 331             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 331             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 332             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 332             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 333         ).get(0);                                                                                        </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 334         offer1.setId(1L);                                                                                </span>
<span  style=""> 335                                                                                                          </span>
<span class="2099956539522342594" onmouseenter="enter('2099956539522342594');" onmouseout="out('2099956539522342594');" style=""> 336         List&lt;Offer&gt; offers = new ArrayList&lt;Offer&gt;();                                                     </span>
<span class="-8212520581628164505" onmouseenter="enter('-8212520581628164505');" onmouseout="out('-8212520581628164505');" style=""> 337         offers.add(offer1);                                                                              </span>
<span  style=""> 338                                                                                                          </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""><abbr title=" 339         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();"> 339         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;(ðŸ”µ</abbr></span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 340         order.updatePrices();                                                                            </span>
<span class="1815029190775922456" onmouseenter="enter('1815029190775922456');" onmouseout="out('1815029190775922456');" style=""> 341         offerService.applyAndSaveOffersToOrder(offers, order);                                           </span>
<span  style=""> 342                                                                                                          </span>
<span class="5029607886283012370" onmouseenter="enter('5029607886283012370');" onmouseout="out('5029607886283012370');" style=""> 343         assertTrue(order.getTotalAdjustmentsValue().getAmount().doubleValue() &gt; 0);                      </span>
<span  style=""> 344                                                                                                          </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 345         order = dataProvider.createBasicOrder();                                                         </span>
<span  style=""> 346                                                                                                          </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 347         qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                 </span>
<span class="7246766169005062112" onmouseenter="enter('7246766169005062112');" onmouseout="out('7246766169005062112');" style=""> 348         offer1.setApplyDiscountToSalePrice(false);                                                       </span>
<span class="2600361857999587596" onmouseenter="enter('2600361857999587596');" onmouseout="out('2600361857999587596');" style=""> 349         ((DiscreteOrderItem) order.getOrderItems().get(0)).getSku().setSalePrice(new Money(1D));         </span>
<span class="7325578290287955946" onmouseenter="enter('7325578290287955946');" onmouseout="out('7325578290287955946');" style=""> 350         ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(new Money(1D));         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 351         order.updatePrices();                                                                            </span>
<span class="1815029190775922456" onmouseenter="enter('1815029190775922456');" onmouseout="out('1815029190775922456');" style=""> 352         offerService.applyAndSaveOffersToOrder(offers, order);                                           </span>
<span  style=""> 353                                                                                                          </span>
<span class="-6354950951868192224" onmouseenter="enter('-6354950951868192224');" onmouseout="out('-6354950951868192224');" style=""> 354         assertTrue(order.getTotalAdjustmentsValue().getAmount().doubleValue() == 0);                     </span>
<span  style=""> 355                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 356         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357     }                                                                                                    </span>
<span  style=""> 358                                                                                                          </span>
<span class="5445671973328535543" onmouseenter="enter('5445671973328535543');" onmouseout="out('5445671973328535543');" style=""> 359     public void testApplyAdjustments() throws Exception {                                                </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 360         replay();                                                                                        </span>
<span  style=""> 361                                                                                                          </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 362         Order order = dataProvider.createBasicOrder();                                                   </span>
<span  style=""> 363                                                                                                          </span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 364         Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 365             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 366             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 367             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 367             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 368             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 368             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 369         ).get(0);                                                                                        </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 370         offer1.setId(1L);                                                                                </span>
<span class="-4071252017012046157" onmouseenter="enter('-4071252017012046157');" onmouseout="out('-4071252017012046157');" style=""> 371         OfferQualifyingCriteriaXref xref = offer1.getQualifyingItemCriteriaXref().iterator().next();     </span>
<span class="-7032540125324645344" onmouseenter="enter('-7032540125324645344');" onmouseout="out('-7032540125324645344');" style=""> 372         xref.getOfferItemCriteria().setQuantity(2);                                                      </span>
<span class="7720028840114078774" onmouseenter="enter('7720028840114078774');" onmouseout="out('7720028840114078774');" style=""> 373         offer1.setCombinableWithOtherOffers(false);                                                      </span>
<span class="-1956075415585459204" onmouseenter="enter('-1956075415585459204');" onmouseout="out('-1956075415585459204');" style=""> 374         Offer offer2 = dataProvider.createItemBasedOfferWithItemCriteria(                                </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 375             &quot;order.subTotal.getAmount()&gt;20&quot;,                                                             </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 376             OfferDiscountType.PERCENT_OFF,                                                               </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 377             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 377             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 378             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 378             &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 379         ).get(0);                                                                                        </span>
<span class="-6767777846149293935" onmouseenter="enter('-6767777846149293935');" onmouseout="out('-6767777846149293935');" style=""> 380         offer2.setId(2L);                                                                                </span>
<span  style=""> 381                                                                                                          </span>
<span class="8631188538838496439" onmouseenter="enter('8631188538838496439');" onmouseout="out('8631188538838496439');" style=""> 382         List&lt;Offer&gt; offerListWithOneOffer = new ArrayList&lt;Offer&gt;();                                      </span>
<span class="-7734009620886563381" onmouseenter="enter('-7734009620886563381');" onmouseout="out('-7734009620886563381');" style=""> 383         offerListWithOneOffer.add(offer1);                                                               </span>
<span  style=""> 384                                                                                                          </span>
<span class="-2645409726359466791" onmouseenter="enter('-2645409726359466791');" onmouseout="out('-2645409726359466791');" style=""> 385         List&lt;Offer&gt; offerListWithTwoOffers = new ArrayList&lt;Offer&gt;();                                     </span>
<span class="-2242941289654799072" onmouseenter="enter('-2242941289654799072');" onmouseout="out('-2242941289654799072');" style=""> 386         offerListWithTwoOffers.add(offer1);                                                              </span>
<span class="-7736021191926792461" onmouseenter="enter('-7736021191926792461');" onmouseout="out('-7736021191926792461');" style=""> 387         offerListWithTwoOffers.add(offer2);                                                              </span>
<span  style=""> 388                                                                                                          </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 389         order.updatePrices();                                                                            </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 390         offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                            </span>
<span class="1819254978181053470" onmouseenter="enter('1819254978181053470');" onmouseout="out('1819254978181053470');" style=""> 391         assertTrue(checkOrderItemOfferAppliedCount(order) == 1);                                         </span>
<span class="-1512986248678261918" onmouseenter="enter('-1512986248678261918');" onmouseout="out('-1512986248678261918');" style=""> 392         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 1);                              </span>
<span  style=""> 393                                                                                                          </span>
<span class="-992574443533108741" onmouseenter="enter('-992574443533108741');" onmouseout="out('-992574443533108741');" style=""> 394         // Add the second offer.   The first was nonCombinable so it should still be 1                   </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 395         order = dataProvider.createBasicOrder();                                                         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 396         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 397         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 398         assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                         </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 399         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                              </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 400         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                              </span>
<span  style=""> 401                                                                                                          </span>
<span  style=""> 402                                                                                                          </span>
<span class="4143880644635780347" onmouseenter="enter('4143880644635780347');" onmouseout="out('4143880644635780347');" style=""> 403         // Reset offer1 to combinable.   Now both should be applied.                                     </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 404         offer1.setCombinableWithOtherOffers(true);                                                       </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 405         order = dataProvider.createBasicOrder();                                                         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 406         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 407         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 408         assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                         </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 409         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                              </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 410         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                              </span>
<span  style=""> 411                                                                                                          </span>
<span class="7464184952874881203" onmouseenter="enter('7464184952874881203');" onmouseout="out('7464184952874881203');" style=""> 412         // Offer 1 back to nonCombinable but don&#x27;t allow discount to the sale price                      </span>
<span class="-1417948014770234923" onmouseenter="enter('-1417948014770234923');" onmouseout="out('-1417948014770234923');" style=""> 413         // and make the sale price a better overall offer                                                </span>
<span class="7720028840114078774" onmouseenter="enter('7720028840114078774');" onmouseout="out('7720028840114078774');" style=""> 414         offer1.setCombinableWithOtherOffers(false);                                                      </span>
<span class="7246766169005062112" onmouseenter="enter('7246766169005062112');" onmouseout="out('7246766169005062112');" style=""> 415         offer1.setApplyDiscountToSalePrice(false);                                                       </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 416         order = dataProvider.createBasicOrder();                                                         </span>
<span class="-5732736595573562244" onmouseenter="enter('-5732736595573562244');" onmouseout="out('-5732736595573562244');" style=""> 417         ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(new Money(10D));        </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 418         order.updatePrices();                                                                            </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 419         offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                            </span>
<span class="-3398637566880609797" onmouseenter="enter('-3398637566880609797');" onmouseout="out('-3398637566880609797');" style=""> 420         assertTrue(checkOrderItemOfferAppliedCount(order) == 0);                                         </span>
<span  style=""> 421                                                                                                          </span>
<span class="1023771780730500424" onmouseenter="enter('1023771780730500424');" onmouseout="out('1023771780730500424');" style=""> 422         // Try again with two offers.   The second should be applied.                                    </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 423         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 424         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 425         assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                         </span>
<span  style=""> 426                                                                                                          </span>
<span class="-1661318026700279078" onmouseenter="enter('-1661318026700279078');" onmouseout="out('-1661318026700279078');" style=""> 427         // Trying with 2nd offer as nonCombinable.                                                       </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 428         offer1.setCombinableWithOtherOffers(true);                                                       </span>
<span class="7546366022368659645" onmouseenter="enter('7546366022368659645');" onmouseout="out('7546366022368659645');" style=""> 429         ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(null);                  </span>
<span class="-7762597468102373652" onmouseenter="enter('-7762597468102373652');" onmouseout="out('-7762597468102373652');" style=""> 430         offer2.setCombinableWithOtherOffers(false);                                                      </span>
<span  style=""> 431                                                                                                          </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 432         order.updatePrices();                                                                            </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 433         offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                            </span>
<span class="1819254978181053470" onmouseenter="enter('1819254978181053470');" onmouseout="out('1819254978181053470');" style=""> 434         assertTrue(checkOrderItemOfferAppliedCount(order) == 1);                                         </span>
<span  style=""> 435                                                                                                          </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 436         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 437         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 438         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                              </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 439         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                              </span>
<span  style=""> 440                                                                                                          </span>
<span class="-4953067338675041826" onmouseenter="enter('-4953067338675041826');" onmouseout="out('-4953067338675041826');" style=""> 441         // Set qualifying criteria quantity to 1                                                         </span>
<span class="2746062014348300811" onmouseenter="enter('2746062014348300811');" onmouseout="out('2746062014348300811');" style=""> 442         // Set qualifying target criteria to 2                                                           </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 443         order = dataProvider.createBasicOrder();                                                         </span>
<span class="-6688543313838783650" onmouseenter="enter('-6688543313838783650');" onmouseout="out('-6688543313838783650');" style=""> 444         xref = offer1.getQualifyingItemCriteriaXref().iterator().next();                                 </span>
<span class="2724580140749596242" onmouseenter="enter('2724580140749596242');" onmouseout="out('2724580140749596242');" style=""> 445         xref.getOfferItemCriteria().setQuantity(1);                                                      </span>
<span  style=""> 446                                                                                                          </span>
<span class="2987053505448788974" onmouseenter="enter('2987053505448788974');" onmouseout="out('2987053505448788974');" style=""> 447         OfferTargetCriteriaXref targetXref = offer1.getTargetItemCriteriaXref().iterator().next();       </span>
<span class="7956044162267364758" onmouseenter="enter('7956044162267364758');" onmouseout="out('7956044162267364758');" style=""> 448         targetXref.getOfferItemCriteria().setQuantity(2);                                                </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 449         order.updatePrices();                                                                            </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 450         offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                            </span>
<span class="-7080380211983716353" onmouseenter="enter('-7080380211983716353');" onmouseout="out('-7080380211983716353');" style=""> 451         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 2);                              </span>
<span  style=""> 452                                                                                                          </span>
<span class="-2183171090813944888" onmouseenter="enter('-2183171090813944888');" onmouseout="out('-2183171090813944888');" style=""> 453         // Reset both offers to combinable and the qualifiers as allowing duplicate QUALIFIERs           </span>
<span class="-2255179946339237317" onmouseenter="enter('-2255179946339237317');" onmouseout="out('-2255179946339237317');" style=""> 454         // and Targets                                                                                   </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 455         offer1.setCombinableWithOtherOffers(true);                                                       </span>
<span class="2527637603040178756" onmouseenter="enter('2527637603040178756');" onmouseout="out('2527637603040178756');" style=""> 456         offer2.setCombinableWithOtherOffers(true);                                                       </span>
<span class="-2476264833911625662" onmouseenter="enter('-2476264833911625662');" onmouseout="out('-2476264833911625662');" style=""> 457         offer1.setOfferItemQualifierRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);             </span>
<span class="-7410686570241782346" onmouseenter="enter('-7410686570241782346');" onmouseout="out('-7410686570241782346');" style=""> 458         offer1.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                </span>
<span class="1961218096433141479" onmouseenter="enter('1961218096433141479');" onmouseout="out('1961218096433141479');" style=""> 459         offer2.setOfferItemQualifierRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);             </span>
<span class="7075569690739658894" onmouseenter="enter('7075569690739658894');" onmouseout="out('7075569690739658894');" style=""> 460         offer2.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 461         order = dataProvider.createBasicOrder();                                                         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 462         order.updatePrices();                                                                            </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 463         offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                           </span>
<span class="-7329741501515817260" onmouseenter="enter('-7329741501515817260');" onmouseout="out('-7329741501515817260');" style=""> 464         assertTrue(checkOrderItemOfferAppliedCount(order) == 4);                                         </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 465         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                              </span>
<span class="-7080380211983716353" onmouseenter="enter('-7080380211983716353');" onmouseout="out('-7080380211983716353');" style=""> 466         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 2);                              </span>
<span  style=""> 467                                                                                                          </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 468         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 469     }                                                                                                    </span>
<span  style=""> 470                                                                                                          </span>
<span class="1804876492874242702" onmouseenter="enter('1804876492874242702');" onmouseout="out('1804876492874242702');" style=""> 471     public void testApplyItemQualifiersAndTargets() throws Exception {                                   </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 472         replay();                                                                                        </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""><abbr title=" 473         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();"> 473         List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;(ðŸ”µ</abbr></span>
<span class="-4543837608611211227" onmouseenter="enter('-4543837608611211227');" onmouseout="out('-4543837608611211227');" style=""><abbr title=" 474         Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;).get(0);"> 474         Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;,ðŸ”µ</abbr></span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 475         offer1.setId(1L);                                                                                </span>
<span class="-662724071419588331" onmouseenter="enter('-662724071419588331');" onmouseout="out('-662724071419588331');" style=""><abbr title=" 476         Offer offer2 = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;).get(0);"> 476         Offer offer2 = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;,ðŸ”µ</abbr></span>
<span class="-6767777846149293935" onmouseenter="enter('-6767777846149293935');" onmouseout="out('-6767777846149293935');" style=""> 477         offer2.setId(2L);                                                                                </span>
<span class="-946400959636335360" onmouseenter="enter('-946400959636335360');" onmouseout="out('-946400959636335360');" style=""> 478         OfferTargetCriteriaXref targetXref = offer2.getTargetItemCriteriaXref().iterator().next();       </span>
<span class="-8974993586722209178" onmouseenter="enter('-8974993586722209178');" onmouseout="out('-8974993586722209178');" style=""> 479         targetXref.getOfferItemCriteria().setQuantity(4);                                                </span>
<span class="-7641378772090546772" onmouseenter="enter('-7641378772090546772');" onmouseout="out('-7641378772090546772');" style=""> 480         offer2.getQualifyingItemCriteriaXref().clear();                                                  </span>
<span class="-4860738879403790739" onmouseenter="enter('-4860738879403790739');" onmouseout="out('-4860738879403790739');" style=""> 481         offer2.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.TARGET);                          </span>
<span class="-2029107156746006439" onmouseenter="enter('-2029107156746006439');" onmouseout="out('-2029107156746006439');" style=""><abbr title=" 482         Offer offer3 = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;, OfferDiscountType.PERCENT_OFF, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;, &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;).get(0);"> 482         Offer offer3 = dataProvider.createItemBasedOfferWithItemCriteria(&quot;order.subTotal.getAmount()&gt;20&quot;,ðŸ”µ</abbr></span>
<span class="5984499010113424780" onmouseenter="enter('5984499010113424780');" onmouseout="out('5984499010113424780');" style=""><abbr title=" 483         PromotableOrder promotableOrder = dataProvider.createBasicPromotableOrder(promotableOfferUtility);"> 483         PromotableOrder promotableOrder = dataProvider.createBasicPromotableOrder(promotableOfferUtility)ðŸ”µ</abbr></span>
<span class="1609760517765742590" onmouseenter="enter('1609760517765742590');" onmouseout="out('1609760517765742590');" style=""> 484         itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer1);                    </span>
<span class="980494803684066022" onmouseenter="enter('980494803684066022');" onmouseout="out('980494803684066022');" style=""><abbr title=" 485         assertTrue(((qualifiedOffers.size() == 1) &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offer1)) &amp;&amp; (qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1));"> 485         assertTrue(((qualifiedOffers.size() == 1) &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offer1)) &amp;&amp;ðŸ”µ</abbr></span>
<span class="3664680620844694596" onmouseenter="enter('3664680620844694596');" onmouseout="out('3664680620844694596');" style=""> 486         itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer2);                    </span>
<span class="-2836125716407639436" onmouseenter="enter('-2836125716407639436');" onmouseout="out('-2836125716407639436');" style=""><abbr title=" 487         assertTrue(((qualifiedOffers.size() == 2) &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offer2)) &amp;&amp; (qualifiedOffers.get(1).getCandidateQualifiersMap().size() == 0));"> 487         assertTrue(((qualifiedOffers.size() == 2) &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offer2)) &amp;&amp;ðŸ”µ</abbr></span>
<span class="-3826912296678151810" onmouseenter="enter('-3826912296678151810');" onmouseout="out('-3826912296678151810');" style=""> 488         itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer3);                    </span>
<span class="2666022039022933906" onmouseenter="enter('2666022039022933906');" onmouseout="out('2666022039022933906');" style=""><abbr title=" 489         assertTrue(((qualifiedOffers.size() == 3) &amp;&amp; qualifiedOffers.get(2).getOffer().equals(offer3)) &amp;&amp; (qualifiedOffers.get(2).getCandidateQualifiersMap().size() == 1));"> 489         assertTrue(((qualifiedOffers.size() == 3) &amp;&amp; qualifiedOffers.get(2).getOffer().equals(offer3)) &amp;&amp;ðŸ”µ</abbr></span>
<span class="1766810220278806135" onmouseenter="enter('1766810220278806135');" onmouseout="out('1766810220278806135');" style=""><abbr title=" 490         // Try with just the second offer.   Expect to get 4 targets based on the offer having no qualifiers required"> 490         // Try with just the second offer.   Expect to get 4 targets based on the offer having no qualifiðŸ”µ</abbr></span>
<span class="-4912150122214844213" onmouseenter="enter('-4912150122214844213');" onmouseout="out('-4912150122214844213');" style=""> 491         // and targeting category test1 or test2 and that the offer requires 4 target criteria.          </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 492         Order order = dataProvider.createBasicOrder();                                                   </span>
<span class="8583068860005847748" onmouseenter="enter('8583068860005847748');" onmouseout="out('8583068860005847748');" style=""> 493         List&lt;Offer&gt; offerList = new ArrayList&lt;Offer&gt;();                                                  </span>
<span class="3860405318390761830" onmouseenter="enter('3860405318390761830');" onmouseout="out('3860405318390761830');" style=""> 494         offerList.add(offer2);                                                                           </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 495         offerService.applyAndSaveOffersToOrder(offerList, order);                                        </span>
<span class="-8213637320090973795" onmouseenter="enter('-8213637320090973795');" onmouseout="out('-8213637320090973795');" style=""> 496         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 4);                              </span>
<span class="1606234139614227925" onmouseenter="enter('1606234139614227925');" onmouseout="out('1606234139614227925');" style=""> 497         assertTrue(countPriceDetails(order) == 3);                                                       </span>
<span class="2040936482538754372" onmouseenter="enter('2040936482538754372');" onmouseout="out('2040936482538754372');" style=""><abbr title=" 498         // Now try with both offers.   Since the targets can be reused, we expect to have 4 targets on offer2"> 498         // Now try with both offers.   Since the targets can be reused, we expect to have 4 targets on ofðŸ”µ</abbr></span>
<span class="8516822473741223062" onmouseenter="enter('8516822473741223062');" onmouseout="out('8516822473741223062');" style=""> 499         // and 1 target on offer1                                                                        </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 500         order = dataProvider.createBasicOrder();                                                         </span>
<span class="-3479395211805369222" onmouseenter="enter('-3479395211805369222');" onmouseout="out('-3479395211805369222');" style=""> 501         offerList.add(offer1);// add in second offer (which happens to be offer1)                        </span>
<span  style=""> 502                                                                                                          </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 503         offerService.applyAndSaveOffersToOrder(offerList, order);                                        </span>
<span class="-8213637320090973795" onmouseenter="enter('-8213637320090973795');" onmouseout="out('-8213637320090973795');" style=""> 504         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 4);                              </span>
<span class="1606234139614227925" onmouseenter="enter('1606234139614227925');" onmouseout="out('1606234139614227925');" style=""> 505         assertTrue(countPriceDetails(order) == 3);                                                       </span>
<span class="-8510477625850873985" onmouseenter="enter('-8510477625850873985');" onmouseout="out('-8510477625850873985');" style=""> 506         // All three offers - offer 3 is now higher priority so the best offer (offer 2) won&#x27;t be applied</span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 507         order = dataProvider.createBasicOrder();                                                         </span>
<span class="-1812578495273658454" onmouseenter="enter('-1812578495273658454');" onmouseout="out('-1812578495273658454');" style=""> 508         offerList.add(offer3);// add in second offer (which happens to be offer1)                        </span>
<span  style=""> 509                                                                                                          </span>
<span class="3305227095626441424" onmouseenter="enter('3305227095626441424');" onmouseout="out('3305227095626441424');" style=""> 510         offer3.setPriority(-1);                                                                          </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 511         offerService.applyAndSaveOffersToOrder(offerList, order);                                        </span>
<span class="7385283043446040112" onmouseenter="enter('7385283043446040112');" onmouseout="out('7385283043446040112');" style=""> 512         assertTrue(checkOrderItemOfferAppliedQuantity(order, offer3) == 2);                              </span>
<span class="7014092410184079185" onmouseenter="enter('7014092410184079185');" onmouseout="out('7014092410184079185');" style=""> 513         assertTrue(countPriceDetails(order) == 4);                                                       </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 514         verify();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515     }                                                                                                    </span>
<span  style=""> 516                                                                                                          </span>
<span class="8243234137390807561" onmouseenter="enter('8243234137390807561');" onmouseout="out('8243234137390807561');" style=""> 517     public class Answer implements IAnswer&lt;CandidateItemOffer&gt; {                                         </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 518         @Override                                                                                        </span>
<span class="2347184973793483651" onmouseenter="enter('2347184973793483651');" onmouseout="out('2347184973793483651');" style=""> 519         public CandidateItemOffer answer() throws Throwable {                                            </span>
<span class="7644422100596500085" onmouseenter="enter('7644422100596500085');" onmouseout="out('7644422100596500085');" style=""> 520             return new CandidateItemOfferImpl();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 521         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 522     }                                                                                                    </span>
<span  style=""> 523                                                                                                          </span>
<span class="-8622711476449936611" onmouseenter="enter('-8622711476449936611');" onmouseout="out('-8622711476449936611');" style=""> 524     public class Answer2 implements IAnswer&lt;OrderItemAdjustment&gt; {                                       </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 525         @Override                                                                                        </span>
<span class="4861248105020273136" onmouseenter="enter('4861248105020273136');" onmouseout="out('4861248105020273136');" style=""> 526         public OrderItemAdjustment answer() throws Throwable {                                           </span>
<span class="7697130786892874769" onmouseenter="enter('7697130786892874769');" onmouseout="out('7697130786892874769');" style=""> 527             return new OrderItemAdjustmentImpl();                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530 }                                                                                                        </span>





















































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3   * BroadleafCommerce Framework                                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="-4156106492343801428" onmouseenter="enter('-4156106492343801428');" onmouseout="out('-4156106492343801428');" style="">  18  package org.broadleafcommerce.core.offer.service.processor;                                                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  19 +                                                                                                                  </span>
<span class="5589978463048615898" onmouseenter="enter('5589978463048615898');" onmouseout="out('5589978463048615898');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  20 +import junit.framework.TestCase;                                                                                  </span>
<span  style="">  21                                                                                                                    </span>
<span class="-274639712180431568" onmouseenter="enter('-274639712180431568');" onmouseout="out('-274639712180431568');" style="">  22  import org.broadleafcommerce.common.money.Money;                                                                  </span>

<span class="6205208880685044389" onmouseenter="enter('6205208880685044389');" onmouseout="out('6205208880685044389');" style="">  23  import org.broadleafcommerce.core.offer.dao.CustomerOfferDao;                                                     </span>
<span class="-7911436562744873568" onmouseenter="enter('-7911436562744873568');" onmouseout="out('-7911436562744873568');" style="">  24  import org.broadleafcommerce.core.offer.dao.OfferCodeDao;                                                         </span>
<span class="-2793633202507663758" onmouseenter="enter('-2793633202507663758');" onmouseout="out('-2793633202507663758');" style="">  25  import org.broadleafcommerce.core.offer.dao.OfferDao;                                                             </span>
<span class="4011152823911960428" onmouseenter="enter('4011152823911960428');" onmouseout="out('4011152823911960428');" style="">  26  import org.broadleafcommerce.core.offer.domain.CandidateItemOffer;                                                </span>
<span class="-735428748329738672" onmouseenter="enter('-735428748329738672');" onmouseout="out('-735428748329738672');" style="">  27  import org.broadleafcommerce.core.offer.domain.CandidateItemOfferImpl;                                            </span>
<span class="4081153142019712377" onmouseenter="enter('4081153142019712377');" onmouseout="out('4081153142019712377');" style="">  28  import org.broadleafcommerce.core.offer.domain.Offer;                                                             </span>
<span class="-7025591891527881733" onmouseenter="enter('-7025591891527881733');" onmouseout="out('-7025591891527881733');" style="">  29  import org.broadleafcommerce.core.offer.domain.OfferImpl;                                                         </span>
<span class="1133170227846016200" onmouseenter="enter('1133170227846016200');" onmouseout="out('1133170227846016200');" style="">  30  import org.broadleafcommerce.core.offer.domain.OfferQualifyingCriteriaXref;                                       </span>
<span class="5060973083944568665" onmouseenter="enter('5060973083944568665');" onmouseout="out('5060973083944568665');" style="">  31  import org.broadleafcommerce.core.offer.domain.OfferTargetCriteriaXref;                                           </span>
<span class="-1124625745990626401" onmouseenter="enter('-1124625745990626401');" onmouseout="out('-1124625745990626401');" style="">  32  import org.broadleafcommerce.core.offer.domain.OrderItemAdjustment;                                               </span>
<span class="-6005336697873394325" onmouseenter="enter('-6005336697873394325');" onmouseout="out('-6005336697873394325');" style="">  33  import org.broadleafcommerce.core.offer.domain.OrderItemAdjustmentImpl;                                           </span>
<span class="6786419255693124735" onmouseenter="enter('6786419255693124735');" onmouseout="out('6786419255693124735');" style="">  34  import org.broadleafcommerce.core.offer.domain.OrderItemPriceDetailAdjustment;                                    </span>
<span class="1848619708404770384" onmouseenter="enter('1848619708404770384');" onmouseout="out('1848619708404770384');" style="">  35  import org.broadleafcommerce.core.offer.service.OfferDataItemProvider;                                            </span>
<span class="-6326345691456347408" onmouseenter="enter('-6326345691456347408');" onmouseout="out('-6326345691456347408');" style="">  36  import org.broadleafcommerce.core.offer.service.OfferServiceImpl;                                                 </span>
<span class="-3097197529305387536" onmouseenter="enter('-3097197529305387536');" onmouseout="out('-3097197529305387536');" style="">  37  import org.broadleafcommerce.core.offer.service.OfferServiceUtilitiesImpl;                                        </span>
<span class="212527052176527689" onmouseenter="enter('212527052176527689');" onmouseout="out('212527052176527689');" style="">  38  import org.broadleafcommerce.core.offer.service.discount.CandidatePromotionItems;                                 </span>
<span class="7831481241902679836" onmouseenter="enter('7831481241902679836');" onmouseout="out('7831481241902679836');" style="">  39  import org.broadleafcommerce.core.offer.service.discount.domain.PromotableCandidateItemOffer;                     </span>
<span class="-7261038068657094491" onmouseenter="enter('-7261038068657094491');" onmouseout="out('-7261038068657094491');" style="">  40  import org.broadleafcommerce.core.offer.service.discount.domain.PromotableItemFactoryImpl;                        </span>
<span class="5738750158392070" onmouseenter="enter('5738750158392070');" onmouseout="out('5738750158392070');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  41 +import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOfferUtility;                           </span>
<span class="8873929720094471664" onmouseenter="enter('8873929720094471664');" onmouseout="out('8873929720094471664');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  42 +import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOfferUtilityImpl;                       </span>
<span class="-6456406933954769040" onmouseenter="enter('-6456406933954769040');" onmouseout="out('-6456406933954769040');" style="">  43  import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOrder;                                  </span>
<span class="-7733804833771661823" onmouseenter="enter('-7733804833771661823');" onmouseout="out('-7733804833771661823');" style="">  44  import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOrderItem;                              </span>
<span class="-5253725521220244448" onmouseenter="enter('-5253725521220244448');" onmouseout="out('-5253725521220244448');" style="">  45  import org.broadleafcommerce.core.offer.service.type.OfferDiscountType;                                           </span>
<span class="-8068779110760425254" onmouseenter="enter('-8068779110760425254');" onmouseout="out('-8068779110760425254');" style="">  46  import org.broadleafcommerce.core.offer.service.type.OfferItemRestrictionRuleType;                                </span>
<span class="-4951365057913084569" onmouseenter="enter('-4951365057913084569');" onmouseout="out('-4951365057913084569');" style="">  47  import org.broadleafcommerce.core.order.dao.FulfillmentGroupItemDao;                                              </span>
<span class="-7012758821456487335" onmouseenter="enter('-7012758821456487335');" onmouseout="out('-7012758821456487335');" style="">  48  import org.broadleafcommerce.core.order.dao.OrderItemDao;                                                         </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  49  import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                                 </span>
<span class="-7855842771160128779" onmouseenter="enter('-7855842771160128779');" onmouseout="out('-7855842771160128779');" style="">  50  import org.broadleafcommerce.core.order.domain.FulfillmentGroupItem;                                              </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  51  import org.broadleafcommerce.core.order.domain.Order;                                                             </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  52  import org.broadleafcommerce.core.order.domain.OrderItem;                                                         </span>
<span class="230297408131782266" onmouseenter="enter('230297408131782266');" onmouseout="out('230297408131782266');" style="">  53  import org.broadleafcommerce.core.order.domain.OrderItemPriceDetail;                                              </span>
<span class="1218446574017128210" onmouseenter="enter('1218446574017128210');" onmouseout="out('1218446574017128210');" style="">  54  import org.broadleafcommerce.core.order.domain.OrderMultishipOption;                                              </span>
<span class="9050710118625717230" onmouseenter="enter('9050710118625717230');" onmouseout="out('9050710118625717230');" style="">  55  import org.broadleafcommerce.core.order.service.FulfillmentGroupService;                                          </span>
<span class="2043331085843421951" onmouseenter="enter('2043331085843421951');" onmouseout="out('2043331085843421951');" style="">  56  import org.broadleafcommerce.core.order.service.OrderItemService;                                                 </span>
<span class="-4438462058374014857" onmouseenter="enter('-4438462058374014857');" onmouseout="out('-4438462058374014857');" style="">  57  import org.broadleafcommerce.core.order.service.OrderMultishipOptionService;                                      </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  58  import org.broadleafcommerce.core.order.service.OrderService;                                                     </span>
<span class="426062199469058864" onmouseenter="enter('426062199469058864');" onmouseout="out('426062199469058864');" style="">  59  import org.broadleafcommerce.core.order.service.call.FulfillmentGroupItemRequest;                                 </span>
<span class="8043089028015557901" onmouseenter="enter('8043089028015557901');" onmouseout="out('8043089028015557901');" style="">  60  import org.easymock.EasyMock;                                                                                     </span>
<span class="8773851019359685182" onmouseenter="enter('8773851019359685182');" onmouseout="out('8773851019359685182');" style="">  61  import org.easymock.IAnswer;                                                                                      </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  62 -                                                                                                                  </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  63  import java.util.ArrayList;                                                                                       </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  64  import java.util.List;                                                                                            </span>
<span class="-3682115440535733483" onmouseenter="enter('-3682115440535733483');" onmouseout="out('-3682115440535733483');" style="">  65  import java.util.TimeZone;                                                                                        </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  66 -                                                                                                                  </span>
<span class="5589978463048615898" onmouseenter="enter('5589978463048615898');" onmouseout="out('5589978463048615898');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  67 -import junit.framework.TestCase;                                                                                  </span>
<span  style="">  68                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  69  /**                                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  70   *                                                                                                                </span>
<span class="3104529581940833663" onmouseenter="enter('3104529581940833663');" onmouseout="out('3104529581940833663');" style="">  71   * @author jfischer                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  72   *                                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  73   */                                                                                                               </span>
<span class="-2169245893345022929" onmouseenter="enter('-2169245893345022929');" onmouseout="out('-2169245893345022929');" style="">  74  public class ItemOfferProcessorTest extends TestCase {                                                            </span>
<span  style="">  75                                                                                                                    </span>
<span class="2764411618740579830" onmouseenter="enter('2764411618740579830');" onmouseout="out('2764411618740579830');" style="">  76      protected OfferDao offerDaoMock;                                                                              </span>
<span class="-1028825014202044443" onmouseenter="enter('-1028825014202044443');" onmouseout="out('-1028825014202044443');" style="">  77      protected OrderItemDao orderItemDaoMock;                                                                      </span>
<span class="-5369679977326057444" onmouseenter="enter('-5369679977326057444');" onmouseout="out('-5369679977326057444');" style="">  78      protected OrderService orderServiceMock;                                                                      </span>
<span class="3942591246150891792" onmouseenter="enter('3942591246150891792');" onmouseout="out('3942591246150891792');" style="">  79      protected OfferServiceImpl offerService;                                                                      </span>
<span class="-2082308031004269425" onmouseenter="enter('-2082308031004269425');" onmouseout="out('-2082308031004269425');" style="">  80      protected OrderItemService orderItemServiceMock;                                                              </span>
<span class="8143262996519322151" onmouseenter="enter('8143262996519322151');" onmouseout="out('8143262996519322151');" style="">  81      protected FulfillmentGroupItemDao fgItemDaoMock;                                                              </span>
<span class="7756339209203921246" onmouseenter="enter('7756339209203921246');" onmouseout="out('7756339209203921246');" style="">  82      protected OfferDataItemProvider dataProvider = new OfferDataItemProvider();                                   </span>
<span class="3331618624366763309" onmouseenter="enter('3331618624366763309');" onmouseout="out('3331618624366763309');" style="">  83      protected FulfillmentGroupService fgServiceMock;                                                              </span>
<span class="2038085072144601851" onmouseenter="enter('2038085072144601851');" onmouseout="out('2038085072144601851');" style="">  84      protected OrderMultishipOptionService multishipOptionServiceMock;                                             </span>
<span class="1636757603740185885" onmouseenter="enter('1636757603740185885');" onmouseout="out('1636757603740185885');" style="">  85      protected OfferTimeZoneProcessor offerTimeZoneProcessorMock;                                                  </span>
<span class="-363767546438432308" onmouseenter="enter('-363767546438432308');" onmouseout="out('-363767546438432308');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  86 +    protected PromotableOfferUtility promotableOfferUtility;                                                      </span>
<span  style="">  87                                                                                                                    </span>
<span class="-3472214566962333184" onmouseenter="enter('-3472214566962333184');" onmouseout="out('-3472214566962333184');" style="">  88      protected ItemOfferProcessorImpl itemProcessor;                                                               </span>
<span  style="">  89                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  90      @Override                                                                                                     </span>
<span class="2289017037938349582" onmouseenter="enter('2289017037938349582');" onmouseout="out('2289017037938349582');" style="">  91      protected void setUp() throws Exception {                                                                     </span>
<span  style="">  92                                                                                                                    </span>
<span class="-5376116141285812671" onmouseenter="enter('-5376116141285812671');" onmouseout="out('-5376116141285812671');" style="">  93          CustomerOfferDao customerOfferDaoMock = EasyMock.createMock(CustomerOfferDao.class);                      </span>
<span class="-570975167499705701" onmouseenter="enter('-570975167499705701');" onmouseout="out('-570975167499705701');" style="">  94          OfferCodeDao offerCodeDaoMock = EasyMock.createMock(OfferCodeDao.class);                                  </span>
<span class="3258640190833853601" onmouseenter="enter('3258640190833853601');" onmouseout="out('3258640190833853601');" style="">  95          offerDaoMock = EasyMock.createMock(OfferDao.class);                                                       </span>
<span class="7274735973437056507" onmouseenter="enter('7274735973437056507');" onmouseout="out('7274735973437056507');" style="">  96          orderItemDaoMock = EasyMock.createMock(OrderItemDao.class);                                               </span>
<span class="393627947078248392" onmouseenter="enter('393627947078248392');" onmouseout="out('393627947078248392');" style="">  97          orderServiceMock = EasyMock.createMock(OrderService.class);                                               </span>
<span class="1993264780541814880" onmouseenter="enter('1993264780541814880');" onmouseout="out('1993264780541814880');" style="">  98          orderItemServiceMock = EasyMock.createMock(OrderItemService.class);                                       </span>
<span class="-3213369057155598174" onmouseenter="enter('-3213369057155598174');" onmouseout="out('-3213369057155598174');" style="">  99          fgItemDaoMock = EasyMock.createMock(FulfillmentGroupItemDao.class);                                       </span>
<span class="6964150545963317885" onmouseenter="enter('6964150545963317885');" onmouseout="out('6964150545963317885');" style=""> 100          fgServiceMock = EasyMock.createMock(FulfillmentGroupService.class);                                       </span>
<span class="-3871783238737974896" onmouseenter="enter('-3871783238737974896');" onmouseout="out('-3871783238737974896');" style=""> 101          multishipOptionServiceMock = EasyMock.createMock(OrderMultishipOptionService.class);                      </span>
<span class="-3280473616402059983" onmouseenter="enter('-3280473616402059983');" onmouseout="out('-3280473616402059983');" style=""> 102          offerTimeZoneProcessorMock = EasyMock.createMock(OfferTimeZoneProcessor.class);                           </span>

<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -                                                                                                                  </span>
<span class="-2101358397833099204" onmouseenter="enter('-2101358397833099204');" onmouseout="out('-2101358397833099204');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -        OfferServiceUtilitiesImpl offerServiceUtilities = new OfferServiceUtilitiesImpl();                        </span>
<span class="-5708051595893590327" onmouseenter="enter('-5708051595893590327');" onmouseout="out('-5708051595893590327');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +        promotableOfferUtility = new PromotableOfferUtilityImpl();                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +                                                                                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +                                                                                                                  </span>
<span class="3514247750798048226" onmouseenter="enter('3514247750798048226');" onmouseout="out('3514247750798048226');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +        OfferServiceUtilitiesImpl offerServiceUtilities = new OfferServiceUtilitiesImpl(promotableOfferUtility);  </span>
<span class="4393308911552043332" onmouseenter="enter('4393308911552043332');" onmouseout="out('4393308911552043332');" style=""> 109          offerServiceUtilities.setOfferDao(offerDaoMock);                                                          </span>
<span class="8672470870156482430" onmouseenter="enter('8672470870156482430');" onmouseout="out('8672470870156482430');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -        offerServiceUtilities.setPromotableItemFactory(new PromotableItemFactoryImpl());                          </span>

<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 111 -                                                                                                                  </span>
<span class="-3017287549985506064" onmouseenter="enter('-3017287549985506064');" onmouseout="out('-3017287549985506064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 112 -        itemProcessor = new ItemOfferProcessorImpl();                                                             </span>
<span class="7561232175961587910" onmouseenter="enter('7561232175961587910');" onmouseout="out('7561232175961587910');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +        offerServiceUtilities.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +                                                                                                                  </span>
<span class="-5954143808619933939" onmouseenter="enter('-5954143808619933939');" onmouseout="out('-5954143808619933939');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +        itemProcessor = new ItemOfferProcessorImpl(promotableOfferUtility);                                       </span>
<span class="-7004957386218896406" onmouseenter="enter('-7004957386218896406');" onmouseout="out('-7004957386218896406');" style=""> 116          itemProcessor.setOfferDao(offerDaoMock);                                                                  </span>
<span class="-7985735156898326914" onmouseenter="enter('-7985735156898326914');" onmouseout="out('-7985735156898326914');" style=""> 117          itemProcessor.setOrderItemDao(orderItemDaoMock);                                                          </span>
<span class="-4628842602683269361" onmouseenter="enter('-4628842602683269361');" onmouseout="out('-4628842602683269361');" style=""> 118          itemProcessor.setOfferTimeZoneProcessor(offerTimeZoneProcessorMock);                                      </span>
<span class="-4774736295542748467" onmouseenter="enter('-4774736295542748467');" onmouseout="out('-4774736295542748467');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 119 -        itemProcessor.setPromotableItemFactory(new PromotableItemFactoryImpl());                                  </span>
<span class="-2793185480423849018" onmouseenter="enter('-2793185480423849018');" onmouseout="out('-2793185480423849018');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +        itemProcessor.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));            </span>
<span class="1873271206223196651" onmouseenter="enter('1873271206223196651');" onmouseout="out('1873271206223196651');" style=""> 121          itemProcessor.setOfferServiceUtilities(offerServiceUtilities);                                            </span>
<span  style=""> 122                                                                                                                    </span>
<span class="-7001064742117532685" onmouseenter="enter('-7001064742117532685');" onmouseout="out('-7001064742117532685');" style=""> 123          offerService = new OfferServiceImpl();                                                                    </span>
<span  style=""> 124                                                                                                                    </span>
<span class="-2065747208737510923" onmouseenter="enter('-2065747208737510923');" onmouseout="out('-2065747208737510923');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 125 -        OrderOfferProcessorImpl orderProcessor = new OrderOfferProcessorImpl();                                   </span>
<span class="-7168324839350089956" onmouseenter="enter('-7168324839350089956');" onmouseout="out('-7168324839350089956');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +        OrderOfferProcessorImpl orderProcessor = new OrderOfferProcessorImpl(promotableOfferUtility);             </span>
<span class="-8216532080679576302" onmouseenter="enter('-8216532080679576302');" onmouseout="out('-8216532080679576302');" style=""> 127          orderProcessor.setOfferDao(offerDaoMock);                                                                 </span>
<span class="7588180708377269856" onmouseenter="enter('7588180708377269856');" onmouseout="out('7588180708377269856');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 128 -        orderProcessor.setPromotableItemFactory(new PromotableItemFactoryImpl());                                 </span>
<span class="5575229934633988866" onmouseenter="enter('5575229934633988866');" onmouseout="out('5575229934633988866');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +        orderProcessor.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));           </span>
<span class="-4588344466186947569" onmouseenter="enter('-4588344466186947569');" onmouseout="out('-4588344466186947569');" style=""> 130          orderProcessor.setOfferTimeZoneProcessor(offerTimeZoneProcessorMock);                                     </span>
<span class="-7787408525763214442" onmouseenter="enter('-7787408525763214442');" onmouseout="out('-7787408525763214442');" style=""> 131          orderProcessor.setOrderItemDao(orderItemDaoMock);                                                         </span>
<span class="-8932862412317704790" onmouseenter="enter('-8932862412317704790');" onmouseout="out('-8932862412317704790');" style=""> 132          orderProcessor.setOfferServiceUtilities(offerServiceUtilities);                                           </span>
<span  style=""> 133                                                                                                                    </span>
<span class="-7594314374485898167" onmouseenter="enter('-7594314374485898167');" onmouseout="out('-7594314374485898167');" style=""> 134          offerService.setCustomerOfferDao(customerOfferDaoMock);                                                   </span>
<span class="483175997286853822" onmouseenter="enter('483175997286853822');" onmouseout="out('483175997286853822');" style=""> 135          offerService.setOfferCodeDao(offerCodeDaoMock);                                                           </span>
<span class="-157638129368187663" onmouseenter="enter('-157638129368187663');" onmouseout="out('-157638129368187663');" style=""> 136          offerService.setOfferDao(offerDaoMock);                                                                   </span>
<span class="-2861300639666845512" onmouseenter="enter('-2861300639666845512');" onmouseout="out('-2861300639666845512');" style=""> 137          offerService.setOrderOfferProcessor(orderProcessor);                                                      </span>
<span class="4668119620018038426" onmouseenter="enter('4668119620018038426');" onmouseout="out('4668119620018038426');" style=""> 138          offerService.setItemOfferProcessor(itemProcessor);                                                        </span>
<span class="-7075295889541966474" onmouseenter="enter('-7075295889541966474');" onmouseout="out('-7075295889541966474');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 139 -        offerService.setPromotableItemFactory(new PromotableItemFactoryImpl());                                   </span>
<span class="-2798583477021709202" onmouseenter="enter('-2798583477021709202');" onmouseout="out('-2798583477021709202');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +        offerService.setPromotableItemFactory(new PromotableItemFactoryImpl(promotableOfferUtility));             </span>
<span class="-7013122243510448528" onmouseenter="enter('-7013122243510448528');" onmouseout="out('-7013122243510448528');" style=""> 141          offerService.setOrderService(orderServiceMock);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142      }                                                                                                             </span>
<span  style=""> 143                                                                                                                    </span>
<span class="-425214870767341244" onmouseenter="enter('-425214870767341244');" onmouseout="out('-425214870767341244');" style=""> 144      public void replay() throws Exception {                                                                       </span>
<span class="3688914841313020601" onmouseenter="enter('3688914841313020601');" onmouseout="out('3688914841313020601');" style=""><abbr title=" 145          EasyMock.expect(orderItemDaoMock.createOrderItemPriceDetail()).andAnswer(OfferDataItemProvider.getCreateOrderItemPriceDetailAnswer()).anyTimes();"> 145          EasyMock.expect(orderItemDaoMock.createOrderItemPriceDetail()).andAnswer(OfferDataItemProvider.getCreateOrðŸ”µ</abbr></span>
<span class="-201012827833234886" onmouseenter="enter('-201012827833234886');" onmouseout="out('-201012827833234886');" style=""><abbr title=" 146          EasyMock.expect(orderItemDaoMock.createOrderItemQualifier()).andAnswer(OfferDataItemProvider.getCreateOrderItemQualifierAnswer()).anyTimes();"> 146          EasyMock.expect(orderItemDaoMock.createOrderItemQualifier()).andAnswer(OfferDataItemProvider.getCreateOrdeðŸ”µ</abbr></span>
<span class="3313434268437563429" onmouseenter="enter('3313434268437563429');" onmouseout="out('3313434268437563429');" style=""><abbr title=" 147          EasyMock.expect(offerDaoMock.createOrderItemPriceDetailAdjustment()).andAnswer(OfferDataItemProvider.getCreateOrderItemPriceDetailAdjustmentAnswer()).anyTimes();"> 147          EasyMock.expect(offerDaoMock.createOrderItemPriceDetailAdjustment()).andAnswer(OfferDataItemProvider.getCrðŸ”µ</abbr></span>
<span  style=""> 148                                                                                                                    </span>
<span class="-4805711593793558927" onmouseenter="enter('-4805711593793558927');" onmouseout="out('-4805711593793558927');" style=""><abbr title=" 149          EasyMock.expect(fgServiceMock.addItemToFulfillmentGroup(EasyMock.isA(FulfillmentGroupItemRequest.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getAddItemToFulfillmentGroupAnswer()).anyTimes();"> 149          EasyMock.expect(fgServiceMock.addItemToFulfillmentGroup(EasyMock.isA(FulfillmentGroupItemRequest.class), EðŸ”µ</abbr></span>
<span class="-4648578783612235576" onmouseenter="enter('-4648578783612235576');" onmouseout="out('-4648578783612235576');" style=""><abbr title=" 150          EasyMock.expect(orderServiceMock.removeItem(EasyMock.isA(Long.class), EasyMock.isA(Long.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getRemoveItemFromOrderAnswer()).anyTimes();"> 150          EasyMock.expect(orderServiceMock.removeItem(EasyMock.isA(Long.class), EasyMock.isA(Long.class), EasyMock.eðŸ”µ</abbr></span>
<span class="-25100646963641968" onmouseenter="enter('-25100646963641968');" onmouseout="out('-25100646963641968');" style=""><abbr title=" 151          EasyMock.expect(orderServiceMock.save(EasyMock.isA(Order.class), EasyMock.isA(Boolean.class))).andAnswer(OfferDataItemProvider.getSaveOrderAnswer()).anyTimes();"> 151          EasyMock.expect(orderServiceMock.save(EasyMock.isA(Order.class), EasyMock.isA(Boolean.class))).andAnswer(OðŸ”µ</abbr></span>
<span  style=""> 152                                                                                                                    </span>
<span class="2160564019413082164" onmouseenter="enter('2160564019413082164');" onmouseout="out('2160564019413082164');" style=""> 153          EasyMock.expect(orderServiceMock.getAutomaticallyMergeLikeItems()).andReturn(true).anyTimes();            </span>
<span  style=""> 154                                                                                                                    </span>
<span class="-8884522234726007395" onmouseenter="enter('-8884522234726007395');" onmouseout="out('-8884522234726007395');" style=""><abbr title=" 155          EasyMock.expect(orderItemServiceMock.saveOrderItem(EasyMock.isA(OrderItem.class))).andAnswer(OfferDataItemProvider.getSaveOrderItemAnswer()).anyTimes();"> 155          EasyMock.expect(orderItemServiceMock.saveOrderItem(EasyMock.isA(OrderItem.class))).andAnswer(OfferDataItemðŸ”µ</abbr></span>
<span class="-3554631046904274751" onmouseenter="enter('-3554631046904274751');" onmouseout="out('-3554631046904274751');" style=""><abbr title=" 156          EasyMock.expect(fgItemDaoMock.save(EasyMock.isA(FulfillmentGroupItem.class))).andAnswer(OfferDataItemProvider.getSaveFulfillmentGroupItemAnswer()).anyTimes();"> 156          EasyMock.expect(fgItemDaoMock.save(EasyMock.isA(FulfillmentGroupItem.class))).andAnswer(OfferDataItemProviðŸ”µ</abbr></span>
<span  style=""> 157                                                                                                                    </span>
<span class="2031702441279524669" onmouseenter="enter('2031702441279524669');" onmouseout="out('2031702441279524669');" style=""><abbr title=" 158          EasyMock.expect(multishipOptionServiceMock.findOrderMultishipOptions(EasyMock.isA(Long.class))).andAnswer(new IAnswer&lt;List&lt;OrderMultishipOption&gt;&gt;() {"> 158          EasyMock.expect(multishipOptionServiceMock.findOrderMultishipOptions(EasyMock.isA(Long.class))).andAnswer(ðŸ”µ</abbr></span>
<span  style=""> 159                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 160              @Override                                                                                             </span>
<span class="4982536128511672004" onmouseenter="enter('4982536128511672004');" onmouseout="out('4982536128511672004');" style=""> 161              public List&lt;OrderMultishipOption&gt; answer() throws Throwable {                                         </span>
<span class="4748136149545123859" onmouseenter="enter('4748136149545123859');" onmouseout="out('4748136149545123859');" style=""> 162                  return new ArrayList&lt;OrderMultishipOption&gt;();                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163              }                                                                                                     </span>
<span class="-8356082990236199220" onmouseenter="enter('-8356082990236199220');" onmouseout="out('-8356082990236199220');" style=""> 164          }).anyTimes();                                                                                            </span>
<span  style=""> 165                                                                                                                    </span>
<span class="5730763888734231228" onmouseenter="enter('5730763888734231228');" onmouseout="out('5730763888734231228');" style=""> 166          multishipOptionServiceMock.deleteAllOrderMultishipOptions(EasyMock.isA(Order.class));                     </span>
<span class="-238683341484251031" onmouseenter="enter('-238683341484251031');" onmouseout="out('-238683341484251031');" style=""> 167          EasyMock.expectLastCall().anyTimes();                                                                     </span>
<span class="3680375331985361488" onmouseenter="enter('3680375331985361488');" onmouseout="out('3680375331985361488');" style=""><abbr title=" 168          EasyMock.expect(fgServiceMock.collapseToOneShippableFulfillmentGroup(EasyMock.isA(Order.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getSameOrderAnswer()).anyTimes();"> 168          EasyMock.expect(fgServiceMock.collapseToOneShippableFulfillmentGroup(EasyMock.isA(Order.class), EasyMock.eðŸ”µ</abbr></span>
<span class="7005207656442723333" onmouseenter="enter('7005207656442723333');" onmouseout="out('7005207656442723333');" style=""><abbr title=" 169          EasyMock.expect(fgItemDaoMock.create()).andAnswer(OfferDataItemProvider.getCreateFulfillmentGroupItemAnswer()).anyTimes();"> 169          EasyMock.expect(fgItemDaoMock.create()).andAnswer(OfferDataItemProvider.getCreateFulfillmentGroupItemAnsweðŸ”µ</abbr></span>
<span class="3552856255510166668" onmouseenter="enter('3552856255510166668');" onmouseout="out('3552856255510166668');" style=""> 170          fgItemDaoMock.delete(EasyMock.isA(FulfillmentGroupItem.class));                                           </span>
<span class="-238683341484251031" onmouseenter="enter('-238683341484251031');" onmouseout="out('-238683341484251031');" style=""> 171          EasyMock.expectLastCall().anyTimes();                                                                     </span>
<span class="602433099109498087" onmouseenter="enter('602433099109498087');" onmouseout="out('602433099109498087');" style=""><abbr title=" 172          EasyMock.expect(offerTimeZoneProcessorMock.getTimeZone(EasyMock.isA(OfferImpl.class))).andReturn(TimeZone.getTimeZone(&quot;CST&quot;)).anyTimes();"> 172          EasyMock.expect(offerTimeZoneProcessorMock.getTimeZone(EasyMock.isA(OfferImpl.class))).andReturn(TimeZone.ðŸ”µ</abbr></span>
<span  style=""> 173                                                                                                                    </span>
<span class="4039967104390893601" onmouseenter="enter('4039967104390893601');" onmouseout="out('4039967104390893601');" style=""> 174          EasyMock.replay(offerDaoMock);                                                                            </span>
<span class="-8438798452743116996" onmouseenter="enter('-8438798452743116996');" onmouseout="out('-8438798452743116996');" style=""> 175          EasyMock.replay(orderItemDaoMock);                                                                        </span>
<span class="-306516478140011318" onmouseenter="enter('-306516478140011318');" onmouseout="out('-306516478140011318');" style=""> 176          EasyMock.replay(orderServiceMock);                                                                        </span>
<span class="-1764805494951210013" onmouseenter="enter('-1764805494951210013');" onmouseout="out('-1764805494951210013');" style=""> 177          EasyMock.replay(orderItemServiceMock);                                                                    </span>
<span class="1127149787736159594" onmouseenter="enter('1127149787736159594');" onmouseout="out('1127149787736159594');" style=""> 178          EasyMock.replay(fgItemDaoMock);                                                                           </span>
<span class="220377317211655869" onmouseenter="enter('220377317211655869');" onmouseout="out('220377317211655869');" style=""> 179          EasyMock.replay(fgServiceMock);                                                                           </span>
<span class="7141248576860687210" onmouseenter="enter('7141248576860687210');" onmouseout="out('7141248576860687210');" style=""> 180          EasyMock.replay(multishipOptionServiceMock);                                                              </span>
<span class="1625398624145697967" onmouseenter="enter('1625398624145697967');" onmouseout="out('1625398624145697967');" style=""> 181          EasyMock.replay(offerTimeZoneProcessorMock);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182      }                                                                                                             </span>
<span  style=""> 183                                                                                                                    </span>
<span class="6267001839391766981" onmouseenter="enter('6267001839391766981');" onmouseout="out('6267001839391766981');" style=""> 184      public void verify() {                                                                                        </span>
<span class="6756940960390862422" onmouseenter="enter('6756940960390862422');" onmouseout="out('6756940960390862422');" style=""> 185          EasyMock.verify(offerDaoMock);                                                                            </span>
<span class="-5117344946758939057" onmouseenter="enter('-5117344946758939057');" onmouseout="out('-5117344946758939057');" style=""> 186          EasyMock.verify(orderItemDaoMock);                                                                        </span>
<span class="-6538245312297088944" onmouseenter="enter('-6538245312297088944');" onmouseout="out('-6538245312297088944');" style=""> 187          EasyMock.verify(orderServiceMock);                                                                        </span>
<span class="4656187310788509663" onmouseenter="enter('4656187310788509663');" onmouseout="out('4656187310788509663');" style=""> 188          EasyMock.verify(orderItemServiceMock);                                                                    </span>
<span class="-3344344690958109982" onmouseenter="enter('-3344344690958109982');" onmouseout="out('-3344344690958109982');" style=""> 189          EasyMock.verify(fgItemDaoMock);                                                                           </span>
<span class="-7107457974865616724" onmouseenter="enter('-7107457974865616724');" onmouseout="out('-7107457974865616724');" style=""> 190          EasyMock.verify(fgServiceMock);                                                                           </span>
<span class="3082501288673197520" onmouseenter="enter('3082501288673197520');" onmouseout="out('3082501288673197520');" style=""> 191          EasyMock.verify(multishipOptionServiceMock);                                                              </span>
<span class="8968216054532738001" onmouseenter="enter('8968216054532738001');" onmouseout="out('8968216054532738001');" style=""> 192          EasyMock.verify(offerTimeZoneProcessorMock);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193      }                                                                                                             </span>
<span  style=""> 194                                                                                                                    </span>
<span class="4417344074261065537" onmouseenter="enter('4417344074261065537');" onmouseout="out('4417344074261065537');" style=""> 195      public void testFilterItemLevelOffer() throws Exception {                                                     </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 196          replay();                                                                                                 </span>
<span  style=""> 197                                                                                                                    </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""> 198          List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();       </span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 199          List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                                   </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 200              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 201                  OfferDiscountType.PERCENT_OFF,                                                                    </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 202              null,                                                                                                 </span>
<span class="-4216650843576585517" onmouseenter="enter('-4216650843576585517');" onmouseout="out('-4216650843576585517');" style=""> 203              null                                                                                                  </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 204          );                                                                                                        </span>
<span  style=""> 205                                                                                                                    </span>
<span class="-7122718500348489334" onmouseenter="enter('-7122718500348489334');" onmouseout="out('-7122718500348489334');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 206 -        PromotableOrder order = dataProvider.createBasicPromotableOrder();                                        </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +        PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);                  </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 208          itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                                </span>
<span  style=""> 209                                                                                                                    </span>
<span class="8849096113443711736" onmouseenter="enter('8849096113443711736');" onmouseout="out('8849096113443711736');" style=""> 210          //test that the valid order item offer is included - legacy format - no qualifier                         </span>
<span class="5326116414476463681" onmouseenter="enter('5326116414476463681');" onmouseout="out('5326116414476463681');" style=""> 211          //since there&#x27;s no qualifier, both items can apply                                                        </span>
<span class="8674824753424198113" onmouseenter="enter('8674824753424198113');" onmouseout="out('8674824753424198113');" style=""> 212          // This line is commented out because we are no longer creating legacy offers.                            </span>
<span class="4622569814719673082" onmouseenter="enter('4622569814719673082');" onmouseout="out('4622569814719673082');" style=""><abbr title=" 213          //assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offers.get(0)));"> 213          //assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; quaðŸ”µ</abbr></span>
<span  style=""> 214                                                                                                                    </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 215          qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 216          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 217              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 218              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 219              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 219              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 220              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 220              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 221          );                                                                                                        </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 222          itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                                </span>
<span  style=""> 223                                                                                                                    </span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 224          //test that the valid order item offer is included                                                        </span>
<span class="3764014390603703627" onmouseenter="enter('3764014390603703627');" onmouseout="out('3764014390603703627');" style=""><abbr title=" 225          //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one qualifier in the qualifiers map"> 225          //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one ðŸ”µ</abbr></span>
<span class="6792085890314091009" onmouseenter="enter('6792085890314091009');" onmouseout="out('6792085890314091009');" style=""> 226          //we don&#x27;t know the targets yet, so there&#x27;s only one CandidateItemOffer for now                           </span>
<span class="-7187194290173616188" onmouseenter="enter('-7187194290173616188');" onmouseout="out('-7187194290173616188');" style=""><abbr title=" 227          assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1);"> 227          assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualiðŸ”µ</abbr></span>
<span  style=""> 228                                                                                                                    </span>
<span class="-8860615526139513207" onmouseenter="enter('-8860615526139513207');" onmouseout="out('-8860615526139513207');" style=""> 229          // Add a subtotal requirement that will be met by the item offer.                                         </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 230          qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 231          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 232              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 233              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 234              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 234              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 235              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 235              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 236          );                                                                                                        </span>
<span  style=""> 237                                                                                                                    </span>
<span class="8674510659006467642" onmouseenter="enter('8674510659006467642');" onmouseout="out('8674510659006467642');" style=""> 238          offers.get(0).setQualifyingItemSubTotal(new Money(1));                                                    </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 239          itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                                </span>
<span  style=""> 240                                                                                                                    </span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 241          //test that the valid order item offer is included                                                        </span>
<span class="3764014390603703627" onmouseenter="enter('3764014390603703627');" onmouseout="out('3764014390603703627');" style=""><abbr title=" 242          //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one qualifier in the qualifiers map"> 242          //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one ðŸ”µ</abbr></span>
<span class="6792085890314091009" onmouseenter="enter('6792085890314091009');" onmouseout="out('6792085890314091009');" style=""> 243          //we don&#x27;t know the targets yet, so there&#x27;s only one CandidateItemOffer for now                           </span>
<span class="-7187194290173616188" onmouseenter="enter('-7187194290173616188');" onmouseout="out('-7187194290173616188');" style=""><abbr title=" 244          assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1);"> 244          assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualiðŸ”µ</abbr></span>
<span  style=""> 245                                                                                                                    </span>
<span  style=""> 246                                                                                                                    </span>
<span class="5301041827655263880" onmouseenter="enter('5301041827655263880');" onmouseout="out('5301041827655263880');" style=""> 247          // Add a subtotal requirement that will not be met by the item offer.                                     </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 248          qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 249          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 250              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 251              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 252              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 252              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 253              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 253              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 254          );                                                                                                        </span>
<span  style=""> 255                                                                                                                    </span>
<span class="1138045012752265464" onmouseenter="enter('1138045012752265464');" onmouseout="out('1138045012752265464');" style=""> 256          offers.get(0).setQualifyingItemSubTotal(new Money(99999));                                                </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 257          itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                                </span>
<span  style=""> 258                                                                                                                    </span>
<span class="-2233954948767969133" onmouseenter="enter('-2233954948767969133');" onmouseout="out('-2233954948767969133');" style=""> 259          // Since the item qualification subTotal is not met, the qualified offer size should                      </span>
<span class="-2484407164144589249" onmouseenter="enter('-2484407164144589249');" onmouseout="out('-2484407164144589249');" style=""> 260          // be zero.                                                                                               </span>
<span class="5374855092322283448" onmouseenter="enter('5374855092322283448');" onmouseout="out('5374855092322283448');" style=""> 261          assertTrue(qualifiedOffers.size() == 0);                                                                  </span>
<span  style=""> 262                                                                                                                    </span>
<span  style=""> 263                                                                                                                    </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 264          qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 265          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 266              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 267              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-6301719950201762066" onmouseenter="enter('-6301719950201762066');" onmouseout="out('-6301719950201762066');" style=""><abbr title=" 268              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 268              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="800271347213994814" onmouseenter="enter('800271347213994814');" onmouseout="out('800271347213994814');" style=""><abbr title=" 269              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 269              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 270          );                                                                                                        </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 271          itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                                </span>
<span  style=""> 272                                                                                                                    </span>
<span class="202008870314622194" onmouseenter="enter('202008870314622194');" onmouseout="out('202008870314622194');" style=""> 273          //test that the invalid order item offer is excluded                                                      </span>
<span class="5374855092322283448" onmouseenter="enter('5374855092322283448');" onmouseout="out('5374855092322283448');" style=""> 274          assertTrue(qualifiedOffers.size() == 0);                                                                  </span>
<span  style=""> 275                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 276          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277      }                                                                                                             </span>
<span  style=""> 278                                                                                                                    </span>
<span class="2350776504190590277" onmouseenter="enter('2350776504190590277');" onmouseout="out('2350776504190590277');" style=""> 279      public void testCouldOfferApplyToOrder() throws Exception {                                                   </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 280          replay();                                                                                                 </span>
<span  style=""> 281                                                                                                                    </span>
<span class="-7122718500348489334" onmouseenter="enter('-7122718500348489334');" onmouseout="out('-7122718500348489334');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 282 -        PromotableOrder order = dataProvider.createBasicPromotableOrder();                                        </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 283 +        PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);                  </span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 284          List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                                   </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 285              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 286              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 287              null,                                                                                                 </span>
<span class="-4216650843576585517" onmouseenter="enter('-4216650843576585517');" onmouseout="out('-4216650843576585517');" style=""> 288              null                                                                                                  </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 289          );                                                                                                        </span>
<span  style=""> 290                                                                                                                    </span>
<span class="7853971483654053322" onmouseenter="enter('7853971483654053322');" onmouseout="out('7853971483654053322');" style=""><abbr title=" 291          boolean couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderItems().get(0), order.getFulfillmentGroups().get(0));"> 291          boolean couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderðŸ”µ</abbr></span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 292          //test that the valid order item offer is included                                                        </span>
<span class="7931914881113900287" onmouseenter="enter('7931914881113900287');" onmouseout="out('7931914881113900287');" style=""> 293          assertTrue(couldApply);                                                                                   </span>
<span  style=""> 294                                                                                                                    </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 295          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-966907751053524789" onmouseenter="enter('-966907751053524789');" onmouseout="out('-966907751053524789');" style=""> 296              &quot;order.subTotal.getAmount()==0&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 297              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 298              null,                                                                                                 </span>
<span class="-4216650843576585517" onmouseenter="enter('-4216650843576585517');" onmouseout="out('-4216650843576585517');" style=""> 299              null                                                                                                  </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 300          );                                                                                                        </span>
<span class="2583469720888306492" onmouseenter="enter('2583469720888306492');" onmouseout="out('2583469720888306492');" style=""><abbr title=" 301          couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderItems().get(0), order.getFulfillmentGroups().get(0));"> 301          couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderItems().ðŸ”µ</abbr></span>
<span class="202008870314622194" onmouseenter="enter('202008870314622194');" onmouseout="out('202008870314622194');" style=""> 302          //test that the invalid order item offer is excluded                                                      </span>
<span class="2773091290643222945" onmouseenter="enter('2773091290643222945');" onmouseout="out('2773091290643222945');" style=""> 303          assertFalse(couldApply);                                                                                  </span>
<span  style=""> 304                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 305          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306      }                                                                                                             </span>
<span  style=""> 307                                                                                                                    </span>
<span class="-3815970332732974591" onmouseenter="enter('-3815970332732974591');" onmouseout="out('-3815970332732974591');" style=""> 308      public void testCouldOrderItemMeetOfferRequirement() throws Exception {                                       </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 309          replay();                                                                                                 </span>
<span  style=""> 310                                                                                                                    </span>
<span class="-7122718500348489334" onmouseenter="enter('-7122718500348489334');" onmouseout="out('-7122718500348489334');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 311 -        PromotableOrder order = dataProvider.createBasicPromotableOrder();                                        </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 312 +        PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);                  </span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 313          List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                                   </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 314              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 315              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 316              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 316              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 317              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 317              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 318          );                                                                                                        </span>
<span  style=""> 319                                                                                                                    </span>
<span class="1501673451570831850" onmouseenter="enter('1501673451570831850');" onmouseout="out('1501673451570831850');" style=""> 320          OfferQualifyingCriteriaXref xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next();       </span>
<span class="-472249920513934405" onmouseenter="enter('-472249920513934405');" onmouseout="out('-472249920513934405');" style=""><abbr title=" 321          boolean couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.getDiscountableOrderItems().get(0));"> 321          boolean couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.gðŸ”µ</abbr></span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 322          //test that the valid order item offer is included                                                        </span>
<span class="7931914881113900287" onmouseenter="enter('7931914881113900287');" onmouseout="out('7931914881113900287');" style=""> 323          assertTrue(couldApply);                                                                                   </span>
<span  style=""> 324                                                                                                                    </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 325          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 326              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 327              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-6301719950201762066" onmouseenter="enter('-6301719950201762066');" onmouseout="out('-6301719950201762066');" style=""><abbr title=" 328              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 328              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="800271347213994814" onmouseenter="enter('800271347213994814');" onmouseout="out('800271347213994814');" style=""><abbr title=" 329              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 329              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 330          );                                                                                                        </span>
<span class="2238137642305281390" onmouseenter="enter('2238137642305281390');" onmouseout="out('2238137642305281390');" style=""> 331          xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next();                                   </span>
<span class="7022359060345229272" onmouseenter="enter('7022359060345229272');" onmouseout="out('7022359060345229272');" style=""><abbr title=" 332          couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.getDiscountableOrderItems().get(0));"> 332          couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.getDiscouðŸ”µ</abbr></span>
<span class="202008870314622194" onmouseenter="enter('202008870314622194');" onmouseout="out('202008870314622194');" style=""> 333          //test that the invalid order item offer is excluded                                                      </span>
<span class="2773091290643222945" onmouseenter="enter('2773091290643222945');" onmouseout="out('2773091290643222945');" style=""> 334          assertFalse(couldApply);                                                                                  </span>
<span  style=""> 335                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 336          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337      }                                                                                                             </span>
<span  style=""> 338                                                                                                                    </span>
<span class="8397400473119507330" onmouseenter="enter('8397400473119507330');" onmouseout="out('8397400473119507330');" style=""> 339      public void testCouldOfferApplyToOrderItems() throws Exception {                                              </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 340          replay();                                                                                                 </span>
<span  style=""> 341                                                                                                                    </span>
<span class="-7122718500348489334" onmouseenter="enter('-7122718500348489334');" onmouseout="out('-7122718500348489334');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 342 -        PromotableOrder order = dataProvider.createBasicPromotableOrder();                                        </span>
<span class="2989998759169393992" onmouseenter="enter('2989998759169393992');" onmouseout="out('2989998759169393992');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +        PromotableOrder order = dataProvider.createBasicPromotableOrder(promotableOfferUtility);                  </span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 344          List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                                   </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 345              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 346              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 347              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 347              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 348              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 348              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 349          );                                                                                                        </span>
<span class="-4222545078163101091" onmouseenter="enter('-4222545078163101091');" onmouseout="out('-4222545078163101091');" style=""> 350          List&lt;PromotableOrderItem&gt; orderItems = new ArrayList&lt;PromotableOrderItem&gt;();                              </span>
<span class="-7372483979901719352" onmouseenter="enter('-7372483979901719352');" onmouseout="out('-7372483979901719352');" style=""> 351          for (PromotableOrderItem orderItem : order.getDiscountableOrderItems()) {                                 </span>
<span class="5423314879443576267" onmouseenter="enter('5423314879443576267');" onmouseout="out('5423314879443576267');" style=""> 352              orderItems.add(orderItem);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353          }                                                                                                         </span>
<span class="8798832722266180533" onmouseenter="enter('8798832722266180533');" onmouseout="out('8798832722266180533');" style=""> 354          CandidatePromotionItems candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), orderItems);</span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 355          //test that the valid order item offer is included                                                        </span>
<span class="-7375750347374851802" onmouseenter="enter('-7375750347374851802');" onmouseout="out('-7375750347374851802');" style=""> 356          //both cart items are valid for qualification and target                                                  </span>
<span class="-7973040919570615736" onmouseenter="enter('-7973040919570615736');" onmouseout="out('-7973040919570615736');" style=""> 357          assertTrue(candidates.isMatchedQualifier() &amp;&amp; candidates.getCandidateQualifiersMap().size() == 1 &amp;&amp;       </span>
<span class="2769824792004949663" onmouseenter="enter('2769824792004949663');" onmouseout="out('2769824792004949663');" style=""> 358                  candidates.getCandidateQualifiersMap().values().iterator().next().size() == 2 &amp;&amp;                  </span>
<span class="-2057082480309621191" onmouseenter="enter('-2057082480309621191');" onmouseout="out('-2057082480309621191');" style=""> 359                  candidates.isMatchedTarget() &amp;&amp; candidates.getCandidateTargetsMap().size() == 1 &amp;&amp;                </span>
<span class="2986039361500944684" onmouseenter="enter('2986039361500944684');" onmouseout="out('2986039361500944684');" style=""> 360                  candidates.getCandidateTargetsMap().values().iterator().next().size() == 2);                      </span>
<span  style=""> 361                                                                                                                    </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 362          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 363              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 364              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-6301719950201762066" onmouseenter="enter('-6301719950201762066');" onmouseout="out('-6301719950201762066');" style=""><abbr title=" 365              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 365              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="800271347213994814" onmouseenter="enter('800271347213994814');" onmouseout="out('800271347213994814');" style=""><abbr title=" 366              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 366              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 367          );                                                                                                        </span>
<span class="-7318029938713023882" onmouseenter="enter('-7318029938713023882');" onmouseout="out('-7318029938713023882');" style=""> 368          candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), orderItems);                        </span>
<span class="5723156784615186428" onmouseenter="enter('5723156784615186428');" onmouseout="out('5723156784615186428');" style=""> 369          //test that the invalid order item offer is excluded because there are no qualifying items                </span>
<span class="-265242688274418245" onmouseenter="enter('-265242688274418245');" onmouseout="out('-265242688274418245');" style=""> 370          assertFalse(candidates.isMatchedQualifier() &amp;&amp; candidates.getCandidateQualifiersMap().size() == 1);       </span>
<span  style=""> 371                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 372          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373      }                                                                                                             </span>
<span  style=""> 374                                                                                                                    </span>
<span class="-2310379539708411407" onmouseenter="enter('-2310379539708411407');" onmouseout="out('-2310379539708411407');" style=""> 375      private int checkOrderItemOfferAppliedCount(Order order) {                                                    </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 376          int count = 0;                                                                                            </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 377          for (OrderItem item : order.getOrderItems()) {                                                            </span>
<span class="773323050474809935" onmouseenter="enter('773323050474809935');" onmouseout="out('773323050474809935');" style=""> 378              for (OrderItemPriceDetail detail : item.getOrderItemPriceDetails()) {                                 </span>
<span class="-7653326266832377040" onmouseenter="enter('-7653326266832377040');" onmouseout="out('-7653326266832377040');" style=""> 379                  count = count + (detail.getOrderItemPriceDetailAdjustments().size() * detail.getQuantity());      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 380              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381          }                                                                                                         </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 382          return count;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 383      }                                                                                                             </span>
<span  style=""> 384                                                                                                                    </span>
<span class="352390873819089414" onmouseenter="enter('352390873819089414');" onmouseout="out('352390873819089414');" style=""> 385      private int checkOrderItemOfferAppliedQuantity(Order order, Offer offer) {                                    </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 386          int count = 0;                                                                                            </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 387          for (OrderItem item : order.getOrderItems()) {                                                            </span>
<span class="773323050474809935" onmouseenter="enter('773323050474809935');" onmouseout="out('773323050474809935');" style=""> 388              for (OrderItemPriceDetail detail : item.getOrderItemPriceDetails()) {                                 </span>
<span class="-2015743447488247947" onmouseenter="enter('-2015743447488247947');" onmouseout="out('-2015743447488247947');" style=""> 389                  for (OrderItemPriceDetailAdjustment adjustment : detail.getOrderItemPriceDetailAdjustments()) {   </span>
<span class="-6326222561939664995" onmouseenter="enter('-6326222561939664995');" onmouseout="out('-6326222561939664995');" style=""> 390                      if (adjustment.getOffer().getId().equals(offer.getId())) {                                    </span>
<span class="6653455861258404903" onmouseenter="enter('6653455861258404903');" onmouseout="out('6653455861258404903');" style=""> 391                          count += detail.getQuantity();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 392                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 393                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 394              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 395          }                                                                                                         </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 396          return count;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397      }                                                                                                             </span>
<span  style=""> 398                                                                                                                    </span>
<span class="8856632786224131584" onmouseenter="enter('8856632786224131584');" onmouseout="out('8856632786224131584');" style=""> 399      private int countPriceDetails(Order order) {                                                                  </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 400          int count = 0;                                                                                            </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 401          for (OrderItem item : order.getOrderItems()) {                                                            </span>
<span class="-2490083702571223921" onmouseenter="enter('-2490083702571223921');" onmouseout="out('-2490083702571223921');" style=""> 402              count = count + item.getOrderItemPriceDetails().size();                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403          }                                                                                                         </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 404          return count;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 405      }                                                                                                             </span>
<span  style=""> 406                                                                                                                    </span>
<span  style=""> 407                                                                                                                    </span>
<span class="-7256708927614783311" onmouseenter="enter('-7256708927614783311');" onmouseout="out('-7256708927614783311');" style=""> 408      public void testApplyAllItemOffers() throws Exception {                                                       </span>
<span  style=""> 409                                                                                                                    </span>
<span  style=""> 410                                                                                                                    </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 411          replay();                                                                                                 </span>
<span  style=""> 412                                                                                                                    </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 413          Order order = dataProvider.createBasicOrder();                                                            </span>
<span  style=""> 414                                                                                                                    </span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 415          Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                         </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 416              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 417              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 418              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 418              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 419              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 419              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 420          ).get(0);                                                                                                 </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 421          offer1.setId(1L);                                                                                         </span>
<span  style=""> 422                                                                                                                    </span>
<span class="2099956539522342594" onmouseenter="enter('2099956539522342594');" onmouseout="out('2099956539522342594');" style=""> 423          List&lt;Offer&gt; offers = new ArrayList&lt;Offer&gt;();                                                              </span>
<span class="-8212520581628164505" onmouseenter="enter('-8212520581628164505');" onmouseout="out('-8212520581628164505');" style=""> 424          offers.add(offer1);                                                                                       </span>
<span  style=""> 425                                                                                                                    </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""> 426          List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();       </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 427          order.updatePrices();                                                                                     </span>
<span class="1815029190775922456" onmouseenter="enter('1815029190775922456');" onmouseout="out('1815029190775922456');" style=""> 428          offerService.applyAndSaveOffersToOrder(offers, order);                                                    </span>
<span  style=""> 429                                                                                                                    </span>
<span class="5029607886283012370" onmouseenter="enter('5029607886283012370');" onmouseout="out('5029607886283012370');" style=""> 430          assertTrue(order.getTotalAdjustmentsValue().getAmount().doubleValue() &gt; 0);                               </span>
<span  style=""> 431                                                                                                                    </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 432          order = dataProvider.createBasicOrder();                                                                  </span>
<span  style=""> 433                                                                                                                    </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 434          qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                          </span>
<span class="7246766169005062112" onmouseenter="enter('7246766169005062112');" onmouseout="out('7246766169005062112');" style=""> 435          offer1.setApplyDiscountToSalePrice(false);                                                                </span>
<span class="2600361857999587596" onmouseenter="enter('2600361857999587596');" onmouseout="out('2600361857999587596');" style=""> 436          ((DiscreteOrderItem) order.getOrderItems().get(0)).getSku().setSalePrice(new Money(1D));                  </span>
<span class="7325578290287955946" onmouseenter="enter('7325578290287955946');" onmouseout="out('7325578290287955946');" style=""> 437          ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(new Money(1D));                  </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 438          order.updatePrices();                                                                                     </span>
<span class="1815029190775922456" onmouseenter="enter('1815029190775922456');" onmouseout="out('1815029190775922456');" style=""> 439          offerService.applyAndSaveOffersToOrder(offers, order);                                                    </span>
<span  style=""> 440                                                                                                                    </span>
<span class="-6354950951868192224" onmouseenter="enter('-6354950951868192224');" onmouseout="out('-6354950951868192224');" style=""> 441          assertTrue(order.getTotalAdjustmentsValue().getAmount().doubleValue() == 0);                              </span>
<span  style=""> 442                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 443          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 444      }                                                                                                             </span>
<span  style=""> 445                                                                                                                    </span>
<span class="5445671973328535543" onmouseenter="enter('5445671973328535543');" onmouseout="out('5445671973328535543');" style=""> 446      public void testApplyAdjustments() throws Exception {                                                         </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 447          replay();                                                                                                 </span>
<span  style=""> 448                                                                                                                    </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 449          Order order = dataProvider.createBasicOrder();                                                            </span>
<span  style=""> 450                                                                                                                    </span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 451          Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                         </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 452              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 453              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 454              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 454              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 455              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 455              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 456          ).get(0);                                                                                                 </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 457          offer1.setId(1L);                                                                                         </span>
<span class="-4071252017012046157" onmouseenter="enter('-4071252017012046157');" onmouseout="out('-4071252017012046157');" style=""> 458          OfferQualifyingCriteriaXref xref = offer1.getQualifyingItemCriteriaXref().iterator().next();              </span>
<span class="-7032540125324645344" onmouseenter="enter('-7032540125324645344');" onmouseout="out('-7032540125324645344');" style=""> 459          xref.getOfferItemCriteria().setQuantity(2);                                                               </span>
<span class="7720028840114078774" onmouseenter="enter('7720028840114078774');" onmouseout="out('7720028840114078774');" style=""> 460          offer1.setCombinableWithOtherOffers(false);                                                               </span>
<span class="-1956075415585459204" onmouseenter="enter('-1956075415585459204');" onmouseout="out('-1956075415585459204');" style=""> 461          Offer offer2 = dataProvider.createItemBasedOfferWithItemCriteria(                                         </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 462              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 463              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 464              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 464              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 465              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 465              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 466          ).get(0);                                                                                                 </span>
<span class="-6767777846149293935" onmouseenter="enter('-6767777846149293935');" onmouseout="out('-6767777846149293935');" style=""> 467          offer2.setId(2L);                                                                                         </span>
<span  style=""> 468                                                                                                                    </span>
<span class="8631188538838496439" onmouseenter="enter('8631188538838496439');" onmouseout="out('8631188538838496439');" style=""> 469          List&lt;Offer&gt; offerListWithOneOffer = new ArrayList&lt;Offer&gt;();                                               </span>
<span class="-7734009620886563381" onmouseenter="enter('-7734009620886563381');" onmouseout="out('-7734009620886563381');" style=""> 470          offerListWithOneOffer.add(offer1);                                                                        </span>
<span  style=""> 471                                                                                                                    </span>
<span class="-2645409726359466791" onmouseenter="enter('-2645409726359466791');" onmouseout="out('-2645409726359466791');" style=""> 472          List&lt;Offer&gt; offerListWithTwoOffers = new ArrayList&lt;Offer&gt;();                                              </span>
<span class="-2242941289654799072" onmouseenter="enter('-2242941289654799072');" onmouseout="out('-2242941289654799072');" style=""> 473          offerListWithTwoOffers.add(offer1);                                                                       </span>
<span class="-7736021191926792461" onmouseenter="enter('-7736021191926792461');" onmouseout="out('-7736021191926792461');" style=""> 474          offerListWithTwoOffers.add(offer2);                                                                       </span>
<span  style=""> 475                                                                                                                    </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 476          order.updatePrices();                                                                                     </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 477          offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                                     </span>
<span class="1819254978181053470" onmouseenter="enter('1819254978181053470');" onmouseout="out('1819254978181053470');" style=""> 478          assertTrue(checkOrderItemOfferAppliedCount(order) == 1);                                                  </span>
<span class="-1512986248678261918" onmouseenter="enter('-1512986248678261918');" onmouseout="out('-1512986248678261918');" style=""> 479          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 1);                                       </span>
<span  style=""> 480                                                                                                                    </span>
<span class="-992574443533108741" onmouseenter="enter('-992574443533108741');" onmouseout="out('-992574443533108741');" style=""> 481          // Add the second offer.   The first was nonCombinable so it should still be 1                            </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 482          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 483          order.updatePrices();                                                                                     </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 484          offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                                    </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 485          assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                                  </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 486          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                                       </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 487          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                                       </span>
<span  style=""> 488                                                                                                                    </span>
<span  style=""> 489                                                                                                                    </span>
<span class="4143880644635780347" onmouseenter="enter('4143880644635780347');" onmouseout="out('4143880644635780347');" style=""> 490          // Reset offer1 to combinable.   Now both should be applied.                                              </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 491          offer1.setCombinableWithOtherOffers(true);                                                                </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 492          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 493          order.updatePrices();                                                                                     </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 494          offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                                    </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 495          assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                                  </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 496          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                                       </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 497          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                                       </span>
<span  style=""> 498                                                                                                                    </span>
<span class="7464184952874881203" onmouseenter="enter('7464184952874881203');" onmouseout="out('7464184952874881203');" style=""> 499          // Offer 1 back to nonCombinable but don&#x27;t allow discount to the sale price                               </span>
<span class="-1417948014770234923" onmouseenter="enter('-1417948014770234923');" onmouseout="out('-1417948014770234923');" style=""> 500          // and make the sale price a better overall offer                                                         </span>
<span class="7720028840114078774" onmouseenter="enter('7720028840114078774');" onmouseout="out('7720028840114078774');" style=""> 501          offer1.setCombinableWithOtherOffers(false);                                                               </span>
<span class="7246766169005062112" onmouseenter="enter('7246766169005062112');" onmouseout="out('7246766169005062112');" style=""> 502          offer1.setApplyDiscountToSalePrice(false);                                                                </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 503          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="-5732736595573562244" onmouseenter="enter('-5732736595573562244');" onmouseout="out('-5732736595573562244');" style=""> 504          ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(new Money(10D));                 </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 505          order.updatePrices();                                                                                     </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 506          offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                                     </span>
<span class="-3398637566880609797" onmouseenter="enter('-3398637566880609797');" onmouseout="out('-3398637566880609797');" style=""> 507          assertTrue(checkOrderItemOfferAppliedCount(order) == 0);                                                  </span>
<span  style=""> 508                                                                                                                    </span>
<span class="1023771780730500424" onmouseenter="enter('1023771780730500424');" onmouseout="out('1023771780730500424');" style=""> 509          // Try again with two offers.   The second should be applied.                                             </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 510          order.updatePrices();                                                                                     </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 511          offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                                    </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 512          assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                                  </span>
<span  style=""> 513                                                                                                                    </span>
<span class="-1661318026700279078" onmouseenter="enter('-1661318026700279078');" onmouseout="out('-1661318026700279078');" style=""> 514          // Trying with 2nd offer as nonCombinable.                                                                </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 515          offer1.setCombinableWithOtherOffers(true);                                                                </span>
<span class="7546366022368659645" onmouseenter="enter('7546366022368659645');" onmouseout="out('7546366022368659645');" style=""> 516          ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(null);                           </span>
<span class="-7762597468102373652" onmouseenter="enter('-7762597468102373652');" onmouseout="out('-7762597468102373652');" style=""> 517          offer2.setCombinableWithOtherOffers(false);                                                               </span>
<span  style=""> 518                                                                                                                    </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 519          order.updatePrices();                                                                                     </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 520          offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                                     </span>
<span class="1819254978181053470" onmouseenter="enter('1819254978181053470');" onmouseout="out('1819254978181053470');" style=""> 521          assertTrue(checkOrderItemOfferAppliedCount(order) == 1);                                                  </span>
<span  style=""> 522                                                                                                                    </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 523          order.updatePrices();                                                                                     </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 524          offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                                    </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 525          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                                       </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 526          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                                       </span>
<span  style=""> 527                                                                                                                    </span>
<span class="-4953067338675041826" onmouseenter="enter('-4953067338675041826');" onmouseout="out('-4953067338675041826');" style=""> 528          // Set qualifying criteria quantity to 1                                                                  </span>
<span class="2746062014348300811" onmouseenter="enter('2746062014348300811');" onmouseout="out('2746062014348300811');" style=""> 529          // Set qualifying target criteria to 2                                                                    </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 530          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="-6688543313838783650" onmouseenter="enter('-6688543313838783650');" onmouseout="out('-6688543313838783650');" style=""> 531          xref = offer1.getQualifyingItemCriteriaXref().iterator().next();                                          </span>
<span class="2724580140749596242" onmouseenter="enter('2724580140749596242');" onmouseout="out('2724580140749596242');" style=""> 532          xref.getOfferItemCriteria().setQuantity(1);                                                               </span>
<span  style=""> 533                                                                                                                    </span>
<span class="2987053505448788974" onmouseenter="enter('2987053505448788974');" onmouseout="out('2987053505448788974');" style=""> 534          OfferTargetCriteriaXref targetXref = offer1.getTargetItemCriteriaXref().iterator().next();                </span>
<span class="7956044162267364758" onmouseenter="enter('7956044162267364758');" onmouseout="out('7956044162267364758');" style=""> 535          targetXref.getOfferItemCriteria().setQuantity(2);                                                         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 536          order.updatePrices();                                                                                     </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 537          offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                                     </span>
<span class="-7080380211983716353" onmouseenter="enter('-7080380211983716353');" onmouseout="out('-7080380211983716353');" style=""> 538          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 2);                                       </span>
<span  style=""> 539                                                                                                                    </span>
<span class="-2183171090813944888" onmouseenter="enter('-2183171090813944888');" onmouseout="out('-2183171090813944888');" style=""> 540          // Reset both offers to combinable and the qualifiers as allowing duplicate QUALIFIERs                    </span>
<span class="-2255179946339237317" onmouseenter="enter('-2255179946339237317');" onmouseout="out('-2255179946339237317');" style=""> 541          // and Targets                                                                                            </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 542          offer1.setCombinableWithOtherOffers(true);                                                                </span>
<span class="2527637603040178756" onmouseenter="enter('2527637603040178756');" onmouseout="out('2527637603040178756');" style=""> 543          offer2.setCombinableWithOtherOffers(true);                                                                </span>
<span class="-2476264833911625662" onmouseenter="enter('-2476264833911625662');" onmouseout="out('-2476264833911625662');" style=""> 544          offer1.setOfferItemQualifierRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                      </span>
<span class="-7410686570241782346" onmouseenter="enter('-7410686570241782346');" onmouseout="out('-7410686570241782346');" style=""> 545          offer1.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                         </span>
<span class="1961218096433141479" onmouseenter="enter('1961218096433141479');" onmouseout="out('1961218096433141479');" style=""> 546          offer2.setOfferItemQualifierRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                      </span>
<span class="7075569690739658894" onmouseenter="enter('7075569690739658894');" onmouseout="out('7075569690739658894');" style=""> 547          offer2.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                         </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 548          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 549          order.updatePrices();                                                                                     </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 550          offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                                    </span>
<span class="-7329741501515817260" onmouseenter="enter('-7329741501515817260');" onmouseout="out('-7329741501515817260');" style=""> 551          assertTrue(checkOrderItemOfferAppliedCount(order) == 4);                                                  </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 552          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                                       </span>
<span class="-7080380211983716353" onmouseenter="enter('-7080380211983716353');" onmouseout="out('-7080380211983716353');" style=""> 553          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 2);                                       </span>
<span  style=""> 554                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 555          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 556      }                                                                                                             </span>
<span  style=""> 557                                                                                                                    </span>
<span class="1804876492874242702" onmouseenter="enter('1804876492874242702');" onmouseout="out('1804876492874242702');" style=""> 558      public void testApplyItemQualifiersAndTargets() throws Exception {                                            </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 559          replay();                                                                                                 </span>
<span  style=""> 560                                                                                                                    </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""> 561          List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();       </span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 562          Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                         </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 563              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 564              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 565              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 565              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 566              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 566              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 567          ).get(0);                                                                                                 </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 568          offer1.setId(1L);                                                                                         </span>
<span class="-1956075415585459204" onmouseenter="enter('-1956075415585459204');" onmouseout="out('-1956075415585459204');" style=""> 569          Offer offer2 = dataProvider.createItemBasedOfferWithItemCriteria(                                         </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 570              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 571              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 572              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 572              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 573              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 573              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 574          ).get(0);                                                                                                 </span>
<span class="-6767777846149293935" onmouseenter="enter('-6767777846149293935');" onmouseout="out('-6767777846149293935');" style=""> 575          offer2.setId(2L);                                                                                         </span>
<span  style=""> 576                                                                                                                    </span>
<span class="-946400959636335360" onmouseenter="enter('-946400959636335360');" onmouseout="out('-946400959636335360');" style=""> 577          OfferTargetCriteriaXref targetXref = offer2.getTargetItemCriteriaXref().iterator().next();                </span>
<span class="-8974993586722209178" onmouseenter="enter('-8974993586722209178');" onmouseout="out('-8974993586722209178');" style=""> 578          targetXref.getOfferItemCriteria().setQuantity(4);                                                         </span>
<span class="-7641378772090546772" onmouseenter="enter('-7641378772090546772');" onmouseout="out('-7641378772090546772');" style=""> 579          offer2.getQualifyingItemCriteriaXref().clear();                                                           </span>
<span class="-4860738879403790739" onmouseenter="enter('-4860738879403790739');" onmouseout="out('-4860738879403790739');" style=""> 580          offer2.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.TARGET);                                   </span>
<span class="4265078036448799603" onmouseenter="enter('4265078036448799603');" onmouseout="out('4265078036448799603');" style=""> 581          Offer offer3 = dataProvider.createItemBasedOfferWithItemCriteria(                                         </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 582              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 583              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 584              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 584              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 585              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 585              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 586          ).get(0);                                                                                                 </span>
<span  style=""> 587                                                                                                                    </span>
<span class="-1327825397201902636" onmouseenter="enter('-1327825397201902636');" onmouseout="out('-1327825397201902636');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 588 -        PromotableOrder promotableOrder = dataProvider.createBasicPromotableOrder();                              </span>
<span class="5984499010113424780" onmouseenter="enter('5984499010113424780');" onmouseout="out('5984499010113424780');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 589 +        PromotableOrder promotableOrder = dataProvider.createBasicPromotableOrder(promotableOfferUtility);        </span>
<span class="1609760517765742590" onmouseenter="enter('1609760517765742590');" onmouseout="out('1609760517765742590');" style=""> 590          itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer1);                             </span>
<span class="-8779152254781384438" onmouseenter="enter('-8779152254781384438');" onmouseout="out('-8779152254781384438');" style=""><abbr title=" 591          assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offer1) &amp;&amp; qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1);"> 591          assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offer1) &amp;&amp; qualifiedOffðŸ”µ</abbr></span>
<span  style=""> 592                                                                                                                    </span>
<span class="3664680620844694596" onmouseenter="enter('3664680620844694596');" onmouseout="out('3664680620844694596');" style=""> 593          itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer2);                             </span>
<span class="5658243282537406724" onmouseenter="enter('5658243282537406724');" onmouseout="out('5658243282537406724');" style=""><abbr title=" 594          assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offer2) &amp;&amp; qualifiedOffers.get(1).getCandidateQualifiersMap().size() == 0);"> 594          assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offer2) &amp;&amp; qualifiedOffðŸ”µ</abbr></span>
<span  style=""> 595                                                                                                                    </span>
<span class="-3826912296678151810" onmouseenter="enter('-3826912296678151810');" onmouseout="out('-3826912296678151810');" style=""> 596          itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer3);                             </span>
<span class="1911054944218617418" onmouseenter="enter('1911054944218617418');" onmouseout="out('1911054944218617418');" style=""><abbr title=" 597          assertTrue(qualifiedOffers.size() == 3 &amp;&amp; qualifiedOffers.get(2).getOffer().equals(offer3) &amp;&amp; qualifiedOffers.get(2).getCandidateQualifiersMap().size() == 1);"> 597          assertTrue(qualifiedOffers.size() == 3 &amp;&amp; qualifiedOffers.get(2).getOffer().equals(offer3) &amp;&amp; qualifiedOffðŸ”µ</abbr></span>
<span  style=""> 598                                                                                                                    </span>
<span class="1766810220278806135" onmouseenter="enter('1766810220278806135');" onmouseout="out('1766810220278806135');" style=""><abbr title=" 599          // Try with just the second offer.   Expect to get 4 targets based on the offer having no qualifiers required"> 599          // Try with just the second offer.   Expect to get 4 targets based on the offer having no qualifiers requiðŸ”µ</abbr></span>
<span class="-4912150122214844213" onmouseenter="enter('-4912150122214844213');" onmouseout="out('-4912150122214844213');" style=""> 600          // and targeting category test1 or test2 and that the offer requires 4 target criteria.                   </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 601          Order order = dataProvider.createBasicOrder();                                                            </span>
<span class="8583068860005847748" onmouseenter="enter('8583068860005847748');" onmouseout="out('8583068860005847748');" style=""> 602          List&lt;Offer&gt; offerList = new ArrayList&lt;Offer&gt;();                                                           </span>
<span class="3860405318390761830" onmouseenter="enter('3860405318390761830');" onmouseout="out('3860405318390761830');" style=""> 603          offerList.add(offer2);                                                                                    </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 604          offerService.applyAndSaveOffersToOrder(offerList, order);                                                 </span>
<span class="-8213637320090973795" onmouseenter="enter('-8213637320090973795');" onmouseout="out('-8213637320090973795');" style=""> 605          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 4);                                       </span>
<span class="1606234139614227925" onmouseenter="enter('1606234139614227925');" onmouseout="out('1606234139614227925');" style=""> 606          assertTrue(countPriceDetails(order) == 3);                                                                </span>
<span  style=""> 607                                                                                                                    </span>
<span class="2040936482538754372" onmouseenter="enter('2040936482538754372');" onmouseout="out('2040936482538754372');" style=""> 608          // Now try with both offers.   Since the targets can be reused, we expect to have 4 targets on offer2     </span>
<span class="8516822473741223062" onmouseenter="enter('8516822473741223062');" onmouseout="out('8516822473741223062');" style=""> 609          // and 1 target on offer1                                                                                 </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 610          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="2231055284542614880" onmouseenter="enter('2231055284542614880');" onmouseout="out('2231055284542614880');" style=""> 611          offerList.add(offer1); // add in second offer (which happens to be offer1)                                </span>
<span  style=""> 612                                                                                                                    </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 613          offerService.applyAndSaveOffersToOrder(offerList, order);                                                 </span>
<span class="-8213637320090973795" onmouseenter="enter('-8213637320090973795');" onmouseout="out('-8213637320090973795');" style=""> 614          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 4);                                       </span>
<span class="1606234139614227925" onmouseenter="enter('1606234139614227925');" onmouseout="out('1606234139614227925');" style=""> 615          assertTrue(countPriceDetails(order) == 3);                                                                </span>
<span  style=""> 616                                                                                                                    </span>
<span class="-8510477625850873985" onmouseenter="enter('-8510477625850873985');" onmouseout="out('-8510477625850873985');" style=""> 617          // All three offers - offer 3 is now higher priority so the best offer (offer 2) won&#x27;t be applied         </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 618          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="-2751996978326205337" onmouseenter="enter('-2751996978326205337');" onmouseout="out('-2751996978326205337');" style=""> 619          offerList.add(offer3); // add in second offer (which happens to be offer1)                                </span>
<span class="3305227095626441424" onmouseenter="enter('3305227095626441424');" onmouseout="out('3305227095626441424');" style=""> 620          offer3.setPriority(-1);                                                                                   </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 621          offerService.applyAndSaveOffersToOrder(offerList, order);                                                 </span>
<span class="7385283043446040112" onmouseenter="enter('7385283043446040112');" onmouseout="out('7385283043446040112');" style=""> 622          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer3) == 2);                                       </span>
<span class="7014092410184079185" onmouseenter="enter('7014092410184079185');" onmouseout="out('7014092410184079185');" style=""> 623          assertTrue(countPriceDetails(order) == 4);                                                                </span>
<span  style=""> 624                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 625          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 626      }                                                                                                             </span>
<span  style=""> 627                                                                                                                    </span>
<span class="8243234137390807561" onmouseenter="enter('8243234137390807561');" onmouseout="out('8243234137390807561');" style=""> 628      public class Answer implements IAnswer&lt;CandidateItemOffer&gt; {                                                  </span>
<span  style=""> 629                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 630          @Override                                                                                                 </span>
<span class="2347184973793483651" onmouseenter="enter('2347184973793483651');" onmouseout="out('2347184973793483651');" style=""> 631          public CandidateItemOffer answer() throws Throwable {                                                     </span>
<span class="7644422100596500085" onmouseenter="enter('7644422100596500085');" onmouseout="out('7644422100596500085');" style=""> 632              return new CandidateItemOfferImpl();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 633          }                                                                                                         </span>
<span  style=""> 634                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 635      }                                                                                                             </span>
<span  style=""> 636                                                                                                                    </span>
<span class="-8622711476449936611" onmouseenter="enter('-8622711476449936611');" onmouseout="out('-8622711476449936611');" style=""> 637      public class Answer2 implements IAnswer&lt;OrderItemAdjustment&gt; {                                                </span>
<span  style=""> 638                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 639          @Override                                                                                                 </span>
<span class="4861248105020273136" onmouseenter="enter('4861248105020273136');" onmouseout="out('4861248105020273136');" style=""> 640          public OrderItemAdjustment answer() throws Throwable {                                                    </span>
<span class="7697130786892874769" onmouseenter="enter('7697130786892874769');" onmouseout="out('7697130786892874769');" style=""> 641              return new OrderItemAdjustmentImpl();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 642          }                                                                                                         </span>
<span  style=""> 643                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 644      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 645  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3   * BroadleafCommerce Framework                                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="1978304592184257722" onmouseenter="enter('1978304592184257722');" onmouseout="out('1978304592184257722');" style="">   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="-4156106492343801428" onmouseenter="enter('-4156106492343801428');" onmouseout="out('-4156106492343801428');" style="">  18  package org.broadleafcommerce.core.offer.service.processor;                                                       </span>


<span  style="">  19                                                                                                                    </span>
<span class="-274639712180431568" onmouseenter="enter('-274639712180431568');" onmouseout="out('-274639712180431568');" style="">  20  import org.broadleafcommerce.common.money.Money;                                                                  </span>
<span class="-1492144387614747576" onmouseenter="enter('-1492144387614747576');" onmouseout="out('-1492144387614747576');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  21 +import org.broadleafcommerce.common.service.GenericEntityService;                                                 </span>
<span class="6205208880685044389" onmouseenter="enter('6205208880685044389');" onmouseout="out('6205208880685044389');" style="">  22  import org.broadleafcommerce.core.offer.dao.CustomerOfferDao;                                                     </span>
<span class="-7911436562744873568" onmouseenter="enter('-7911436562744873568');" onmouseout="out('-7911436562744873568');" style="">  23  import org.broadleafcommerce.core.offer.dao.OfferCodeDao;                                                         </span>
<span class="-2793633202507663758" onmouseenter="enter('-2793633202507663758');" onmouseout="out('-2793633202507663758');" style="">  24  import org.broadleafcommerce.core.offer.dao.OfferDao;                                                             </span>
<span class="4011152823911960428" onmouseenter="enter('4011152823911960428');" onmouseout="out('4011152823911960428');" style="">  25  import org.broadleafcommerce.core.offer.domain.CandidateItemOffer;                                                </span>
<span class="-735428748329738672" onmouseenter="enter('-735428748329738672');" onmouseout="out('-735428748329738672');" style="">  26  import org.broadleafcommerce.core.offer.domain.CandidateItemOfferImpl;                                            </span>
<span class="4081153142019712377" onmouseenter="enter('4081153142019712377');" onmouseout="out('4081153142019712377');" style="">  27  import org.broadleafcommerce.core.offer.domain.Offer;                                                             </span>
<span class="-7025591891527881733" onmouseenter="enter('-7025591891527881733');" onmouseout="out('-7025591891527881733');" style="">  28  import org.broadleafcommerce.core.offer.domain.OfferImpl;                                                         </span>
<span class="1133170227846016200" onmouseenter="enter('1133170227846016200');" onmouseout="out('1133170227846016200');" style="">  29  import org.broadleafcommerce.core.offer.domain.OfferQualifyingCriteriaXref;                                       </span>
<span class="5060973083944568665" onmouseenter="enter('5060973083944568665');" onmouseout="out('5060973083944568665');" style="">  30  import org.broadleafcommerce.core.offer.domain.OfferTargetCriteriaXref;                                           </span>
<span class="-1124625745990626401" onmouseenter="enter('-1124625745990626401');" onmouseout="out('-1124625745990626401');" style="">  31  import org.broadleafcommerce.core.offer.domain.OrderItemAdjustment;                                               </span>
<span class="-6005336697873394325" onmouseenter="enter('-6005336697873394325');" onmouseout="out('-6005336697873394325');" style="">  32  import org.broadleafcommerce.core.offer.domain.OrderItemAdjustmentImpl;                                           </span>
<span class="6786419255693124735" onmouseenter="enter('6786419255693124735');" onmouseout="out('6786419255693124735');" style="">  33  import org.broadleafcommerce.core.offer.domain.OrderItemPriceDetailAdjustment;                                    </span>
<span class="1848619708404770384" onmouseenter="enter('1848619708404770384');" onmouseout="out('1848619708404770384');" style="">  34  import org.broadleafcommerce.core.offer.service.OfferDataItemProvider;                                            </span>
<span class="-6326345691456347408" onmouseenter="enter('-6326345691456347408');" onmouseout="out('-6326345691456347408');" style="">  35  import org.broadleafcommerce.core.offer.service.OfferServiceImpl;                                                 </span>
<span class="-3097197529305387536" onmouseenter="enter('-3097197529305387536');" onmouseout="out('-3097197529305387536');" style="">  36  import org.broadleafcommerce.core.offer.service.OfferServiceUtilitiesImpl;                                        </span>
<span class="212527052176527689" onmouseenter="enter('212527052176527689');" onmouseout="out('212527052176527689');" style="">  37  import org.broadleafcommerce.core.offer.service.discount.CandidatePromotionItems;                                 </span>
<span class="7831481241902679836" onmouseenter="enter('7831481241902679836');" onmouseout="out('7831481241902679836');" style="">  38  import org.broadleafcommerce.core.offer.service.discount.domain.PromotableCandidateItemOffer;                     </span>
<span class="-7261038068657094491" onmouseenter="enter('-7261038068657094491');" onmouseout="out('-7261038068657094491');" style="">  39  import org.broadleafcommerce.core.offer.service.discount.domain.PromotableItemFactoryImpl;                        </span>


<span class="-6456406933954769040" onmouseenter="enter('-6456406933954769040');" onmouseout="out('-6456406933954769040');" style="">  40  import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOrder;                                  </span>
<span class="-7733804833771661823" onmouseenter="enter('-7733804833771661823');" onmouseout="out('-7733804833771661823');" style="">  41  import org.broadleafcommerce.core.offer.service.discount.domain.PromotableOrderItem;                              </span>
<span class="-5253725521220244448" onmouseenter="enter('-5253725521220244448');" onmouseout="out('-5253725521220244448');" style="">  42  import org.broadleafcommerce.core.offer.service.type.OfferDiscountType;                                           </span>
<span class="-8068779110760425254" onmouseenter="enter('-8068779110760425254');" onmouseout="out('-8068779110760425254');" style="">  43  import org.broadleafcommerce.core.offer.service.type.OfferItemRestrictionRuleType;                                </span>
<span class="-4951365057913084569" onmouseenter="enter('-4951365057913084569');" onmouseout="out('-4951365057913084569');" style="">  44  import org.broadleafcommerce.core.order.dao.FulfillmentGroupItemDao;                                              </span>
<span class="-7012758821456487335" onmouseenter="enter('-7012758821456487335');" onmouseout="out('-7012758821456487335');" style="">  45  import org.broadleafcommerce.core.order.dao.OrderItemDao;                                                         </span>
<span class="-4077086760777187101" onmouseenter="enter('-4077086760777187101');" onmouseout="out('-4077086760777187101');" style="">  46  import org.broadleafcommerce.core.order.domain.DiscreteOrderItem;                                                 </span>
<span class="-7855842771160128779" onmouseenter="enter('-7855842771160128779');" onmouseout="out('-7855842771160128779');" style="">  47  import org.broadleafcommerce.core.order.domain.FulfillmentGroupItem;                                              </span>
<span class="-6039448701992847179" onmouseenter="enter('-6039448701992847179');" onmouseout="out('-6039448701992847179');" style="">  48  import org.broadleafcommerce.core.order.domain.Order;                                                             </span>
<span class="-3117062451881073195" onmouseenter="enter('-3117062451881073195');" onmouseout="out('-3117062451881073195');" style="">  49  import org.broadleafcommerce.core.order.domain.OrderItem;                                                         </span>
<span class="230297408131782266" onmouseenter="enter('230297408131782266');" onmouseout="out('230297408131782266');" style="">  50  import org.broadleafcommerce.core.order.domain.OrderItemPriceDetail;                                              </span>
<span class="1218446574017128210" onmouseenter="enter('1218446574017128210');" onmouseout="out('1218446574017128210');" style="">  51  import org.broadleafcommerce.core.order.domain.OrderMultishipOption;                                              </span>
<span class="9050710118625717230" onmouseenter="enter('9050710118625717230');" onmouseout="out('9050710118625717230');" style="">  52  import org.broadleafcommerce.core.order.service.FulfillmentGroupService;                                          </span>
<span class="2043331085843421951" onmouseenter="enter('2043331085843421951');" onmouseout="out('2043331085843421951');" style="">  53  import org.broadleafcommerce.core.order.service.OrderItemService;                                                 </span>
<span class="-4438462058374014857" onmouseenter="enter('-4438462058374014857');" onmouseout="out('-4438462058374014857');" style="">  54  import org.broadleafcommerce.core.order.service.OrderMultishipOptionService;                                      </span>
<span class="-4523094285760083742" onmouseenter="enter('-4523094285760083742');" onmouseout="out('-4523094285760083742');" style="">  55  import org.broadleafcommerce.core.order.service.OrderService;                                                     </span>
<span class="426062199469058864" onmouseenter="enter('426062199469058864');" onmouseout="out('426062199469058864');" style="">  56  import org.broadleafcommerce.core.order.service.call.FulfillmentGroupItemRequest;                                 </span>
<span class="8043089028015557901" onmouseenter="enter('8043089028015557901');" onmouseout="out('8043089028015557901');" style="">  57  import org.easymock.EasyMock;                                                                                     </span>
<span class="8773851019359685182" onmouseenter="enter('8773851019359685182');" onmouseout="out('8773851019359685182');" style="">  58  import org.easymock.IAnswer;                                                                                      </span>
<span  style="">  59                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  60  import java.util.ArrayList;                                                                                       </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  61  import java.util.List;                                                                                            </span>
<span class="-3682115440535733483" onmouseenter="enter('-3682115440535733483');" onmouseout="out('-3682115440535733483');" style="">  62  import java.util.TimeZone;                                                                                        </span>
<span  style="">  63                                                                                                                    </span>
<span class="5589978463048615898" onmouseenter="enter('5589978463048615898');" onmouseout="out('5589978463048615898');" style="">  64  import junit.framework.TestCase;                                                                                  </span>
<span  style="">  65                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  66  /**                                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  67   *                                                                                                                </span>
<span class="3104529581940833663" onmouseenter="enter('3104529581940833663');" onmouseout="out('3104529581940833663');" style="">  68   * @author jfischer                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  69   *                                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  70   */                                                                                                               </span>
<span class="-2169245893345022929" onmouseenter="enter('-2169245893345022929');" onmouseout="out('-2169245893345022929');" style="">  71  public class ItemOfferProcessorTest extends TestCase {                                                            </span>
<span  style="">  72                                                                                                                    </span>
<span class="2764411618740579830" onmouseenter="enter('2764411618740579830');" onmouseout="out('2764411618740579830');" style="">  73      protected OfferDao offerDaoMock;                                                                              </span>
<span class="-1028825014202044443" onmouseenter="enter('-1028825014202044443');" onmouseout="out('-1028825014202044443');" style="">  74      protected OrderItemDao orderItemDaoMock;                                                                      </span>
<span class="-5369679977326057444" onmouseenter="enter('-5369679977326057444');" onmouseout="out('-5369679977326057444');" style="">  75      protected OrderService orderServiceMock;                                                                      </span>
<span class="3942591246150891792" onmouseenter="enter('3942591246150891792');" onmouseout="out('3942591246150891792');" style="">  76      protected OfferServiceImpl offerService;                                                                      </span>
<span class="-2082308031004269425" onmouseenter="enter('-2082308031004269425');" onmouseout="out('-2082308031004269425');" style="">  77      protected OrderItemService orderItemServiceMock;                                                              </span>
<span class="8143262996519322151" onmouseenter="enter('8143262996519322151');" onmouseout="out('8143262996519322151');" style="">  78      protected FulfillmentGroupItemDao fgItemDaoMock;                                                              </span>
<span class="7756339209203921246" onmouseenter="enter('7756339209203921246');" onmouseout="out('7756339209203921246');" style="">  79      protected OfferDataItemProvider dataProvider = new OfferDataItemProvider();                                   </span>
<span class="3331618624366763309" onmouseenter="enter('3331618624366763309');" onmouseout="out('3331618624366763309');" style="">  80      protected FulfillmentGroupService fgServiceMock;                                                              </span>
<span class="2038085072144601851" onmouseenter="enter('2038085072144601851');" onmouseout="out('2038085072144601851');" style="">  81      protected OrderMultishipOptionService multishipOptionServiceMock;                                             </span>
<span class="1636757603740185885" onmouseenter="enter('1636757603740185885');" onmouseout="out('1636757603740185885');" style="">  82      protected OfferTimeZoneProcessor offerTimeZoneProcessorMock;                                                  </span>
<span class="8126767976686599164" onmouseenter="enter('8126767976686599164');" onmouseout="out('8126767976686599164');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +    protected GenericEntityService genericEntityServiceMock;                                                      </span>
<span  style="">  84                                                                                                                    </span>
<span class="-3472214566962333184" onmouseenter="enter('-3472214566962333184');" onmouseout="out('-3472214566962333184');" style="">  85      protected ItemOfferProcessorImpl itemProcessor;                                                               </span>
<span  style="">  86                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  87      @Override                                                                                                     </span>
<span class="2289017037938349582" onmouseenter="enter('2289017037938349582');" onmouseout="out('2289017037938349582');" style="">  88      protected void setUp() throws Exception {                                                                     </span>
<span  style="">  89                                                                                                                    </span>
<span class="-5376116141285812671" onmouseenter="enter('-5376116141285812671');" onmouseout="out('-5376116141285812671');" style="">  90          CustomerOfferDao customerOfferDaoMock = EasyMock.createMock(CustomerOfferDao.class);                      </span>
<span class="-570975167499705701" onmouseenter="enter('-570975167499705701');" onmouseout="out('-570975167499705701');" style="">  91          OfferCodeDao offerCodeDaoMock = EasyMock.createMock(OfferCodeDao.class);                                  </span>
<span class="3258640190833853601" onmouseenter="enter('3258640190833853601');" onmouseout="out('3258640190833853601');" style="">  92          offerDaoMock = EasyMock.createMock(OfferDao.class);                                                       </span>
<span class="7274735973437056507" onmouseenter="enter('7274735973437056507');" onmouseout="out('7274735973437056507');" style="">  93          orderItemDaoMock = EasyMock.createMock(OrderItemDao.class);                                               </span>
<span class="393627947078248392" onmouseenter="enter('393627947078248392');" onmouseout="out('393627947078248392');" style="">  94          orderServiceMock = EasyMock.createMock(OrderService.class);                                               </span>
<span class="1993264780541814880" onmouseenter="enter('1993264780541814880');" onmouseout="out('1993264780541814880');" style="">  95          orderItemServiceMock = EasyMock.createMock(OrderItemService.class);                                       </span>
<span class="-3213369057155598174" onmouseenter="enter('-3213369057155598174');" onmouseout="out('-3213369057155598174');" style="">  96          fgItemDaoMock = EasyMock.createMock(FulfillmentGroupItemDao.class);                                       </span>
<span class="6964150545963317885" onmouseenter="enter('6964150545963317885');" onmouseout="out('6964150545963317885');" style="">  97          fgServiceMock = EasyMock.createMock(FulfillmentGroupService.class);                                       </span>
<span class="-3871783238737974896" onmouseenter="enter('-3871783238737974896');" onmouseout="out('-3871783238737974896');" style="">  98          multishipOptionServiceMock = EasyMock.createMock(OrderMultishipOptionService.class);                      </span>
<span class="-3280473616402059983" onmouseenter="enter('-3280473616402059983');" onmouseout="out('-3280473616402059983');" style="">  99          offerTimeZoneProcessorMock = EasyMock.createMock(OfferTimeZoneProcessor.class);                           </span>
<span class="-8978123556236380411" onmouseenter="enter('-8978123556236380411');" onmouseout="out('-8978123556236380411');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +        genericEntityServiceMock = EasyMock.createMock(GenericEntityService.class);                               </span>
<span  style=""> 101                                                                                                                    </span>
<span class="-2101358397833099204" onmouseenter="enter('-2101358397833099204');" onmouseout="out('-2101358397833099204');" style=""> 102          OfferServiceUtilitiesImpl offerServiceUtilities = new OfferServiceUtilitiesImpl();                        </span>




<span class="4393308911552043332" onmouseenter="enter('4393308911552043332');" onmouseout="out('4393308911552043332');" style=""> 103          offerServiceUtilities.setOfferDao(offerDaoMock);                                                          </span>
<span class="8672470870156482430" onmouseenter="enter('8672470870156482430');" onmouseout="out('8672470870156482430');" style=""> 104          offerServiceUtilities.setPromotableItemFactory(new PromotableItemFactoryImpl());                          </span>
<span class="8346807884110674152" onmouseenter="enter('8346807884110674152');" onmouseout="out('8346807884110674152');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +        offerServiceUtilities.setGenericEntityService(genericEntityServiceMock);                                  </span>
<span  style=""> 106                                                                                                                    </span>
<span class="-3017287549985506064" onmouseenter="enter('-3017287549985506064');" onmouseout="out('-3017287549985506064');" style=""> 107          itemProcessor = new ItemOfferProcessorImpl();                                                             </span>



<span class="-7004957386218896406" onmouseenter="enter('-7004957386218896406');" onmouseout="out('-7004957386218896406');" style=""> 108          itemProcessor.setOfferDao(offerDaoMock);                                                                  </span>
<span class="-7985735156898326914" onmouseenter="enter('-7985735156898326914');" onmouseout="out('-7985735156898326914');" style=""> 109          itemProcessor.setOrderItemDao(orderItemDaoMock);                                                          </span>
<span class="-4628842602683269361" onmouseenter="enter('-4628842602683269361');" onmouseout="out('-4628842602683269361');" style=""> 110          itemProcessor.setOfferTimeZoneProcessor(offerTimeZoneProcessorMock);                                      </span>
<span class="-4774736295542748467" onmouseenter="enter('-4774736295542748467');" onmouseout="out('-4774736295542748467');" style=""> 111          itemProcessor.setPromotableItemFactory(new PromotableItemFactoryImpl());                                  </span>

<span class="1873271206223196651" onmouseenter="enter('1873271206223196651');" onmouseout="out('1873271206223196651');" style=""> 112          itemProcessor.setOfferServiceUtilities(offerServiceUtilities);                                            </span>
<span  style=""> 113                                                                                                                    </span>
<span class="-7001064742117532685" onmouseenter="enter('-7001064742117532685');" onmouseout="out('-7001064742117532685');" style=""> 114          offerService = new OfferServiceImpl();                                                                    </span>
<span  style=""> 115                                                                                                                    </span>
<span class="-2065747208737510923" onmouseenter="enter('-2065747208737510923');" onmouseout="out('-2065747208737510923');" style=""> 116          OrderOfferProcessorImpl orderProcessor = new OrderOfferProcessorImpl();                                   </span>

<span class="-8216532080679576302" onmouseenter="enter('-8216532080679576302');" onmouseout="out('-8216532080679576302');" style=""> 117          orderProcessor.setOfferDao(offerDaoMock);                                                                 </span>
<span class="7588180708377269856" onmouseenter="enter('7588180708377269856');" onmouseout="out('7588180708377269856');" style=""> 118          orderProcessor.setPromotableItemFactory(new PromotableItemFactoryImpl());                                 </span>

<span class="-4588344466186947569" onmouseenter="enter('-4588344466186947569');" onmouseout="out('-4588344466186947569');" style=""> 119          orderProcessor.setOfferTimeZoneProcessor(offerTimeZoneProcessorMock);                                     </span>
<span class="-7787408525763214442" onmouseenter="enter('-7787408525763214442');" onmouseout="out('-7787408525763214442');" style=""> 120          orderProcessor.setOrderItemDao(orderItemDaoMock);                                                         </span>
<span class="-8932862412317704790" onmouseenter="enter('-8932862412317704790');" onmouseout="out('-8932862412317704790');" style=""> 121          orderProcessor.setOfferServiceUtilities(offerServiceUtilities);                                           </span>
<span  style=""> 122                                                                                                                    </span>
<span class="-7594314374485898167" onmouseenter="enter('-7594314374485898167');" onmouseout="out('-7594314374485898167');" style=""> 123          offerService.setCustomerOfferDao(customerOfferDaoMock);                                                   </span>
<span class="483175997286853822" onmouseenter="enter('483175997286853822');" onmouseout="out('483175997286853822');" style=""> 124          offerService.setOfferCodeDao(offerCodeDaoMock);                                                           </span>
<span class="-157638129368187663" onmouseenter="enter('-157638129368187663');" onmouseout="out('-157638129368187663');" style=""> 125          offerService.setOfferDao(offerDaoMock);                                                                   </span>
<span class="-2861300639666845512" onmouseenter="enter('-2861300639666845512');" onmouseout="out('-2861300639666845512');" style=""> 126          offerService.setOrderOfferProcessor(orderProcessor);                                                      </span>
<span class="4668119620018038426" onmouseenter="enter('4668119620018038426');" onmouseout="out('4668119620018038426');" style=""> 127          offerService.setItemOfferProcessor(itemProcessor);                                                        </span>
<span class="-7075295889541966474" onmouseenter="enter('-7075295889541966474');" onmouseout="out('-7075295889541966474');" style=""> 128          offerService.setPromotableItemFactory(new PromotableItemFactoryImpl());                                   </span>

<span class="-7013122243510448528" onmouseenter="enter('-7013122243510448528');" onmouseout="out('-7013122243510448528');" style=""> 129          offerService.setOrderService(orderServiceMock);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130      }                                                                                                             </span>
<span  style=""> 131                                                                                                                    </span>
<span class="-425214870767341244" onmouseenter="enter('-425214870767341244');" onmouseout="out('-425214870767341244');" style=""> 132      public void replay() throws Exception {                                                                       </span>
<span class="3688914841313020601" onmouseenter="enter('3688914841313020601');" onmouseout="out('3688914841313020601');" style=""><abbr title=" 133          EasyMock.expect(orderItemDaoMock.createOrderItemPriceDetail()).andAnswer(OfferDataItemProvider.getCreateOrderItemPriceDetailAnswer()).anyTimes();"> 133          EasyMock.expect(orderItemDaoMock.createOrderItemPriceDetail()).andAnswer(OfferDataItemProvider.getCreateOrðŸ”µ</abbr></span>
<span class="-201012827833234886" onmouseenter="enter('-201012827833234886');" onmouseout="out('-201012827833234886');" style=""><abbr title=" 134          EasyMock.expect(orderItemDaoMock.createOrderItemQualifier()).andAnswer(OfferDataItemProvider.getCreateOrderItemQualifierAnswer()).anyTimes();"> 134          EasyMock.expect(orderItemDaoMock.createOrderItemQualifier()).andAnswer(OfferDataItemProvider.getCreateOrdeðŸ”µ</abbr></span>
<span class="3313434268437563429" onmouseenter="enter('3313434268437563429');" onmouseout="out('3313434268437563429');" style=""><abbr title=" 135          EasyMock.expect(offerDaoMock.createOrderItemPriceDetailAdjustment()).andAnswer(OfferDataItemProvider.getCreateOrderItemPriceDetailAdjustmentAnswer()).anyTimes();"> 135          EasyMock.expect(offerDaoMock.createOrderItemPriceDetailAdjustment()).andAnswer(OfferDataItemProvider.getCrðŸ”µ</abbr></span>
<span  style=""> 136                                                                                                                    </span>
<span class="-4805711593793558927" onmouseenter="enter('-4805711593793558927');" onmouseout="out('-4805711593793558927');" style=""><abbr title=" 137          EasyMock.expect(fgServiceMock.addItemToFulfillmentGroup(EasyMock.isA(FulfillmentGroupItemRequest.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getAddItemToFulfillmentGroupAnswer()).anyTimes();"> 137          EasyMock.expect(fgServiceMock.addItemToFulfillmentGroup(EasyMock.isA(FulfillmentGroupItemRequest.class), EðŸ”µ</abbr></span>
<span class="-4648578783612235576" onmouseenter="enter('-4648578783612235576');" onmouseout="out('-4648578783612235576');" style=""><abbr title=" 138          EasyMock.expect(orderServiceMock.removeItem(EasyMock.isA(Long.class), EasyMock.isA(Long.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getRemoveItemFromOrderAnswer()).anyTimes();"> 138          EasyMock.expect(orderServiceMock.removeItem(EasyMock.isA(Long.class), EasyMock.isA(Long.class), EasyMock.eðŸ”µ</abbr></span>
<span class="-25100646963641968" onmouseenter="enter('-25100646963641968');" onmouseout="out('-25100646963641968');" style=""><abbr title=" 139          EasyMock.expect(orderServiceMock.save(EasyMock.isA(Order.class), EasyMock.isA(Boolean.class))).andAnswer(OfferDataItemProvider.getSaveOrderAnswer()).anyTimes();"> 139          EasyMock.expect(orderServiceMock.save(EasyMock.isA(Order.class), EasyMock.isA(Boolean.class))).andAnswer(OðŸ”µ</abbr></span>
<span  style=""> 140                                                                                                                    </span>
<span class="2160564019413082164" onmouseenter="enter('2160564019413082164');" onmouseout="out('2160564019413082164');" style=""> 141          EasyMock.expect(orderServiceMock.getAutomaticallyMergeLikeItems()).andReturn(true).anyTimes();            </span>
<span  style=""> 142                                                                                                                    </span>
<span class="-8884522234726007395" onmouseenter="enter('-8884522234726007395');" onmouseout="out('-8884522234726007395');" style=""><abbr title=" 143          EasyMock.expect(orderItemServiceMock.saveOrderItem(EasyMock.isA(OrderItem.class))).andAnswer(OfferDataItemProvider.getSaveOrderItemAnswer()).anyTimes();"> 143          EasyMock.expect(orderItemServiceMock.saveOrderItem(EasyMock.isA(OrderItem.class))).andAnswer(OfferDataItemðŸ”µ</abbr></span>
<span class="-3554631046904274751" onmouseenter="enter('-3554631046904274751');" onmouseout="out('-3554631046904274751');" style=""><abbr title=" 144          EasyMock.expect(fgItemDaoMock.save(EasyMock.isA(FulfillmentGroupItem.class))).andAnswer(OfferDataItemProvider.getSaveFulfillmentGroupItemAnswer()).anyTimes();"> 144          EasyMock.expect(fgItemDaoMock.save(EasyMock.isA(FulfillmentGroupItem.class))).andAnswer(OfferDataItemProviðŸ”µ</abbr></span>
<span  style=""> 145                                                                                                                    </span>
<span class="2031702441279524669" onmouseenter="enter('2031702441279524669');" onmouseout="out('2031702441279524669');" style=""><abbr title=" 146          EasyMock.expect(multishipOptionServiceMock.findOrderMultishipOptions(EasyMock.isA(Long.class))).andAnswer(new IAnswer&lt;List&lt;OrderMultishipOption&gt;&gt;() {"> 146          EasyMock.expect(multishipOptionServiceMock.findOrderMultishipOptions(EasyMock.isA(Long.class))).andAnswer(ðŸ”µ</abbr></span>
<span  style=""> 147                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 148              @Override                                                                                             </span>
<span class="4982536128511672004" onmouseenter="enter('4982536128511672004');" onmouseout="out('4982536128511672004');" style=""> 149              public List&lt;OrderMultishipOption&gt; answer() throws Throwable {                                         </span>
<span class="4748136149545123859" onmouseenter="enter('4748136149545123859');" onmouseout="out('4748136149545123859');" style=""> 150                  return new ArrayList&lt;OrderMultishipOption&gt;();                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151              }                                                                                                     </span>
<span class="-8356082990236199220" onmouseenter="enter('-8356082990236199220');" onmouseout="out('-8356082990236199220');" style=""> 152          }).anyTimes();                                                                                            </span>
<span  style=""> 153                                                                                                                    </span>
<span class="5730763888734231228" onmouseenter="enter('5730763888734231228');" onmouseout="out('5730763888734231228');" style=""> 154          multishipOptionServiceMock.deleteAllOrderMultishipOptions(EasyMock.isA(Order.class));                     </span>
<span class="-238683341484251031" onmouseenter="enter('-238683341484251031');" onmouseout="out('-238683341484251031');" style=""> 155          EasyMock.expectLastCall().anyTimes();                                                                     </span>
<span class="3680375331985361488" onmouseenter="enter('3680375331985361488');" onmouseout="out('3680375331985361488');" style=""><abbr title=" 156          EasyMock.expect(fgServiceMock.collapseToOneShippableFulfillmentGroup(EasyMock.isA(Order.class), EasyMock.eq(false))).andAnswer(OfferDataItemProvider.getSameOrderAnswer()).anyTimes();"> 156          EasyMock.expect(fgServiceMock.collapseToOneShippableFulfillmentGroup(EasyMock.isA(Order.class), EasyMock.eðŸ”µ</abbr></span>
<span class="7005207656442723333" onmouseenter="enter('7005207656442723333');" onmouseout="out('7005207656442723333');" style=""><abbr title=" 157          EasyMock.expect(fgItemDaoMock.create()).andAnswer(OfferDataItemProvider.getCreateFulfillmentGroupItemAnswer()).anyTimes();"> 157          EasyMock.expect(fgItemDaoMock.create()).andAnswer(OfferDataItemProvider.getCreateFulfillmentGroupItemAnsweðŸ”µ</abbr></span>
<span class="3552856255510166668" onmouseenter="enter('3552856255510166668');" onmouseout="out('3552856255510166668');" style=""> 158          fgItemDaoMock.delete(EasyMock.isA(FulfillmentGroupItem.class));                                           </span>
<span class="-238683341484251031" onmouseenter="enter('-238683341484251031');" onmouseout="out('-238683341484251031');" style=""> 159          EasyMock.expectLastCall().anyTimes();                                                                     </span>
<span class="602433099109498087" onmouseenter="enter('602433099109498087');" onmouseout="out('602433099109498087');" style=""><abbr title=" 160          EasyMock.expect(offerTimeZoneProcessorMock.getTimeZone(EasyMock.isA(OfferImpl.class))).andReturn(TimeZone.getTimeZone(&quot;CST&quot;)).anyTimes();"> 160          EasyMock.expect(offerTimeZoneProcessorMock.getTimeZone(EasyMock.isA(OfferImpl.class))).andReturn(TimeZone.ðŸ”µ</abbr></span>
<span  style=""> 161                                                                                                                    </span>
<span class="4039967104390893601" onmouseenter="enter('4039967104390893601');" onmouseout="out('4039967104390893601');" style=""> 162          EasyMock.replay(offerDaoMock);                                                                            </span>
<span class="-8438798452743116996" onmouseenter="enter('-8438798452743116996');" onmouseout="out('-8438798452743116996');" style=""> 163          EasyMock.replay(orderItemDaoMock);                                                                        </span>
<span class="-306516478140011318" onmouseenter="enter('-306516478140011318');" onmouseout="out('-306516478140011318');" style=""> 164          EasyMock.replay(orderServiceMock);                                                                        </span>
<span class="-1764805494951210013" onmouseenter="enter('-1764805494951210013');" onmouseout="out('-1764805494951210013');" style=""> 165          EasyMock.replay(orderItemServiceMock);                                                                    </span>
<span class="1127149787736159594" onmouseenter="enter('1127149787736159594');" onmouseout="out('1127149787736159594');" style=""> 166          EasyMock.replay(fgItemDaoMock);                                                                           </span>
<span class="220377317211655869" onmouseenter="enter('220377317211655869');" onmouseout="out('220377317211655869');" style=""> 167          EasyMock.replay(fgServiceMock);                                                                           </span>
<span class="7141248576860687210" onmouseenter="enter('7141248576860687210');" onmouseout="out('7141248576860687210');" style=""> 168          EasyMock.replay(multishipOptionServiceMock);                                                              </span>
<span class="1625398624145697967" onmouseenter="enter('1625398624145697967');" onmouseout="out('1625398624145697967');" style=""> 169          EasyMock.replay(offerTimeZoneProcessorMock);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170      }                                                                                                             </span>
<span  style=""> 171                                                                                                                    </span>
<span class="6267001839391766981" onmouseenter="enter('6267001839391766981');" onmouseout="out('6267001839391766981');" style=""> 172      public void verify() {                                                                                        </span>
<span class="6756940960390862422" onmouseenter="enter('6756940960390862422');" onmouseout="out('6756940960390862422');" style=""> 173          EasyMock.verify(offerDaoMock);                                                                            </span>
<span class="-5117344946758939057" onmouseenter="enter('-5117344946758939057');" onmouseout="out('-5117344946758939057');" style=""> 174          EasyMock.verify(orderItemDaoMock);                                                                        </span>
<span class="-6538245312297088944" onmouseenter="enter('-6538245312297088944');" onmouseout="out('-6538245312297088944');" style=""> 175          EasyMock.verify(orderServiceMock);                                                                        </span>
<span class="4656187310788509663" onmouseenter="enter('4656187310788509663');" onmouseout="out('4656187310788509663');" style=""> 176          EasyMock.verify(orderItemServiceMock);                                                                    </span>
<span class="-3344344690958109982" onmouseenter="enter('-3344344690958109982');" onmouseout="out('-3344344690958109982');" style=""> 177          EasyMock.verify(fgItemDaoMock);                                                                           </span>
<span class="-7107457974865616724" onmouseenter="enter('-7107457974865616724');" onmouseout="out('-7107457974865616724');" style=""> 178          EasyMock.verify(fgServiceMock);                                                                           </span>
<span class="3082501288673197520" onmouseenter="enter('3082501288673197520');" onmouseout="out('3082501288673197520');" style=""> 179          EasyMock.verify(multishipOptionServiceMock);                                                              </span>
<span class="8968216054532738001" onmouseenter="enter('8968216054532738001');" onmouseout="out('8968216054532738001');" style=""> 180          EasyMock.verify(offerTimeZoneProcessorMock);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181      }                                                                                                             </span>
<span  style=""> 182                                                                                                                    </span>
<span class="4417344074261065537" onmouseenter="enter('4417344074261065537');" onmouseout="out('4417344074261065537');" style=""> 183      public void testFilterItemLevelOffer() throws Exception {                                                     </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 184          replay();                                                                                                 </span>
<span  style=""> 185                                                                                                                    </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""> 186          List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();       </span>
<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 187          List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                                   </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 188              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 189                  OfferDiscountType.PERCENT_OFF,                                                                    </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 190              null,                                                                                                 </span>
<span class="-4216650843576585517" onmouseenter="enter('-4216650843576585517');" onmouseout="out('-4216650843576585517');" style=""> 191              null                                                                                                  </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 192          );                                                                                                        </span>
<span  style=""> 193                                                                                                                    </span>
<span class="-7122718500348489334" onmouseenter="enter('-7122718500348489334');" onmouseout="out('-7122718500348489334');" style=""> 194          PromotableOrder order = dataProvider.createBasicPromotableOrder();                                        </span>

<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 195          itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                                </span>
<span  style=""> 196                                                                                                                    </span>
<span class="8849096113443711736" onmouseenter="enter('8849096113443711736');" onmouseout="out('8849096113443711736');" style=""> 197          //test that the valid order item offer is included - legacy format - no qualifier                         </span>
<span class="5326116414476463681" onmouseenter="enter('5326116414476463681');" onmouseout="out('5326116414476463681');" style=""> 198          //since there&#x27;s no qualifier, both items can apply                                                        </span>
<span class="8674824753424198113" onmouseenter="enter('8674824753424198113');" onmouseout="out('8674824753424198113');" style=""> 199          // This line is commented out because we are no longer creating legacy offers.                            </span>
<span class="4622569814719673082" onmouseenter="enter('4622569814719673082');" onmouseout="out('4622569814719673082');" style=""><abbr title=" 200          //assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offers.get(0)));"> 200          //assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; quaðŸ”µ</abbr></span>
<span  style=""> 201                                                                                                                    </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 202          qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 203          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 204              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 205              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 206              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 206              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 207              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 207              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 208          );                                                                                                        </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 209          itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                                </span>
<span  style=""> 210                                                                                                                    </span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 211          //test that the valid order item offer is included                                                        </span>
<span class="3764014390603703627" onmouseenter="enter('3764014390603703627');" onmouseout="out('3764014390603703627');" style=""><abbr title=" 212          //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one qualifier in the qualifiers map"> 212          //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one ðŸ”µ</abbr></span>
<span class="6792085890314091009" onmouseenter="enter('6792085890314091009');" onmouseout="out('6792085890314091009');" style=""> 213          //we don&#x27;t know the targets yet, so there&#x27;s only one CandidateItemOffer for now                           </span>
<span class="-7187194290173616188" onmouseenter="enter('-7187194290173616188');" onmouseout="out('-7187194290173616188');" style=""><abbr title=" 214          assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1);"> 214          assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualiðŸ”µ</abbr></span>
<span  style=""> 215                                                                                                                    </span>
<span class="-8860615526139513207" onmouseenter="enter('-8860615526139513207');" onmouseout="out('-8860615526139513207');" style=""> 216          // Add a subtotal requirement that will be met by the item offer.                                         </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 217          qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 218          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 219              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 220              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 221              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 221              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 222              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 222              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 223          );                                                                                                        </span>
<span  style=""> 224                                                                                                                    </span>
<span class="8674510659006467642" onmouseenter="enter('8674510659006467642');" onmouseout="out('8674510659006467642');" style=""> 225          offers.get(0).setQualifyingItemSubTotal(new Money(1));                                                    </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 226          itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                                </span>
<span  style=""> 227                                                                                                                    </span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 228          //test that the valid order item offer is included                                                        </span>
<span class="3764014390603703627" onmouseenter="enter('3764014390603703627');" onmouseout="out('3764014390603703627');" style=""><abbr title=" 229          //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one qualifier in the qualifiers map"> 229          //there is a qualifier and the item qualifying criteria requires only 1, therefore there will be only one ðŸ”µ</abbr></span>
<span class="6792085890314091009" onmouseenter="enter('6792085890314091009');" onmouseout="out('6792085890314091009');" style=""> 230          //we don&#x27;t know the targets yet, so there&#x27;s only one CandidateItemOffer for now                           </span>
<span class="-7187194290173616188" onmouseenter="enter('-7187194290173616188');" onmouseout="out('-7187194290173616188');" style=""><abbr title=" 231          assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1);"> 231          assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offers.get(0)) &amp;&amp; qualiðŸ”µ</abbr></span>
<span  style=""> 232                                                                                                                    </span>
<span  style=""> 233                                                                                                                    </span>
<span class="5301041827655263880" onmouseenter="enter('5301041827655263880');" onmouseout="out('5301041827655263880');" style=""> 234          // Add a subtotal requirement that will not be met by the item offer.                                     </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 235          qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 236          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 237              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 238              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 239              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 239              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 240              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 240              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 241          );                                                                                                        </span>
<span  style=""> 242                                                                                                                    </span>
<span class="1138045012752265464" onmouseenter="enter('1138045012752265464');" onmouseout="out('1138045012752265464');" style=""> 243          offers.get(0).setQualifyingItemSubTotal(new Money(99999));                                                </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 244          itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                                </span>
<span  style=""> 245                                                                                                                    </span>
<span class="-2233954948767969133" onmouseenter="enter('-2233954948767969133');" onmouseout="out('-2233954948767969133');" style=""> 246          // Since the item qualification subTotal is not met, the qualified offer size should                      </span>
<span class="-2484407164144589249" onmouseenter="enter('-2484407164144589249');" onmouseout="out('-2484407164144589249');" style=""> 247          // be zero.                                                                                               </span>
<span class="5374855092322283448" onmouseenter="enter('5374855092322283448');" onmouseout="out('5374855092322283448');" style=""> 248          assertTrue(qualifiedOffers.size() == 0);                                                                  </span>
<span  style=""> 249                                                                                                                    </span>
<span  style=""> 250                                                                                                                    </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 251          qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                          </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 252          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 253              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 254              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-6301719950201762066" onmouseenter="enter('-6301719950201762066');" onmouseout="out('-6301719950201762066');" style=""><abbr title=" 255              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 255              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="800271347213994814" onmouseenter="enter('800271347213994814');" onmouseout="out('800271347213994814');" style=""><abbr title=" 256              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 256              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 257          );                                                                                                        </span>
<span class="7890636588029661223" onmouseenter="enter('7890636588029661223');" onmouseout="out('7890636588029661223');" style=""> 258          itemProcessor.filterItemLevelOffer(order, qualifiedOffers, offers.get(0));                                </span>
<span  style=""> 259                                                                                                                    </span>
<span class="202008870314622194" onmouseenter="enter('202008870314622194');" onmouseout="out('202008870314622194');" style=""> 260          //test that the invalid order item offer is excluded                                                      </span>
<span class="5374855092322283448" onmouseenter="enter('5374855092322283448');" onmouseout="out('5374855092322283448');" style=""> 261          assertTrue(qualifiedOffers.size() == 0);                                                                  </span>
<span  style=""> 262                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 263          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264      }                                                                                                             </span>
<span  style=""> 265                                                                                                                    </span>
<span class="2350776504190590277" onmouseenter="enter('2350776504190590277');" onmouseout="out('2350776504190590277');" style=""> 266      public void testCouldOfferApplyToOrder() throws Exception {                                                   </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 267          replay();                                                                                                 </span>
<span  style=""> 268                                                                                                                    </span>
<span class="-7122718500348489334" onmouseenter="enter('-7122718500348489334');" onmouseout="out('-7122718500348489334');" style=""> 269          PromotableOrder order = dataProvider.createBasicPromotableOrder();                                        </span>

<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 270          List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                                   </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 271              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 272              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 273              null,                                                                                                 </span>
<span class="-4216650843576585517" onmouseenter="enter('-4216650843576585517');" onmouseout="out('-4216650843576585517');" style=""> 274              null                                                                                                  </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 275          );                                                                                                        </span>
<span  style=""> 276                                                                                                                    </span>
<span class="7853971483654053322" onmouseenter="enter('7853971483654053322');" onmouseout="out('7853971483654053322');" style=""><abbr title=" 277          boolean couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderItems().get(0), order.getFulfillmentGroups().get(0));"> 277          boolean couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderðŸ”µ</abbr></span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 278          //test that the valid order item offer is included                                                        </span>
<span class="7931914881113900287" onmouseenter="enter('7931914881113900287');" onmouseout="out('7931914881113900287');" style=""> 279          assertTrue(couldApply);                                                                                   </span>
<span  style=""> 280                                                                                                                    </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 281          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-966907751053524789" onmouseenter="enter('-966907751053524789');" onmouseout="out('-966907751053524789');" style=""> 282              &quot;order.subTotal.getAmount()==0&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 283              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-6501782133959337215" onmouseenter="enter('-6501782133959337215');" onmouseout="out('-6501782133959337215');" style=""> 284              null,                                                                                                 </span>
<span class="-4216650843576585517" onmouseenter="enter('-4216650843576585517');" onmouseout="out('-4216650843576585517');" style=""> 285              null                                                                                                  </span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 286          );                                                                                                        </span>
<span class="2583469720888306492" onmouseenter="enter('2583469720888306492');" onmouseout="out('2583469720888306492');" style=""><abbr title=" 287          couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderItems().get(0), order.getFulfillmentGroups().get(0));"> 287          couldApply = itemProcessor.couldOfferApplyToOrder(offers.get(0), order, order.getDiscountableOrderItems().ðŸ”µ</abbr></span>
<span class="202008870314622194" onmouseenter="enter('202008870314622194');" onmouseout="out('202008870314622194');" style=""> 288          //test that the invalid order item offer is excluded                                                      </span>
<span class="2773091290643222945" onmouseenter="enter('2773091290643222945');" onmouseout="out('2773091290643222945');" style=""> 289          assertFalse(couldApply);                                                                                  </span>
<span  style=""> 290                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 291          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292      }                                                                                                             </span>
<span  style=""> 293                                                                                                                    </span>
<span class="-3815970332732974591" onmouseenter="enter('-3815970332732974591');" onmouseout="out('-3815970332732974591');" style=""> 294      public void testCouldOrderItemMeetOfferRequirement() throws Exception {                                       </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 295          replay();                                                                                                 </span>
<span  style=""> 296                                                                                                                    </span>
<span class="-7122718500348489334" onmouseenter="enter('-7122718500348489334');" onmouseout="out('-7122718500348489334');" style=""> 297          PromotableOrder order = dataProvider.createBasicPromotableOrder();                                        </span>

<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 298          List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                                   </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 299              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 300              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 301              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 301              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 302              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 302              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 303          );                                                                                                        </span>
<span  style=""> 304                                                                                                                    </span>
<span class="1501673451570831850" onmouseenter="enter('1501673451570831850');" onmouseout="out('1501673451570831850');" style=""> 305          OfferQualifyingCriteriaXref xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next();       </span>
<span class="-472249920513934405" onmouseenter="enter('-472249920513934405');" onmouseout="out('-472249920513934405');" style=""><abbr title=" 306          boolean couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.getDiscountableOrderItems().get(0));"> 306          boolean couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.gðŸ”µ</abbr></span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 307          //test that the valid order item offer is included                                                        </span>
<span class="7931914881113900287" onmouseenter="enter('7931914881113900287');" onmouseout="out('7931914881113900287');" style=""> 308          assertTrue(couldApply);                                                                                   </span>
<span  style=""> 309                                                                                                                    </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 310          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 311              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 312              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-6301719950201762066" onmouseenter="enter('-6301719950201762066');" onmouseout="out('-6301719950201762066');" style=""><abbr title=" 313              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 313              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="800271347213994814" onmouseenter="enter('800271347213994814');" onmouseout="out('800271347213994814');" style=""><abbr title=" 314              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 314              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 315          );                                                                                                        </span>
<span class="2238137642305281390" onmouseenter="enter('2238137642305281390');" onmouseout="out('2238137642305281390');" style=""> 316          xref = offers.get(0).getQualifyingItemCriteriaXref().iterator().next();                                   </span>
<span class="7022359060345229272" onmouseenter="enter('7022359060345229272');" onmouseout="out('7022359060345229272');" style=""><abbr title=" 317          couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.getDiscountableOrderItems().get(0));"> 317          couldApply = itemProcessor.couldOrderItemMeetOfferRequirement(xref.getOfferItemCriteria(), order.getDiscouðŸ”µ</abbr></span>
<span class="202008870314622194" onmouseenter="enter('202008870314622194');" onmouseout="out('202008870314622194');" style=""> 318          //test that the invalid order item offer is excluded                                                      </span>
<span class="2773091290643222945" onmouseenter="enter('2773091290643222945');" onmouseout="out('2773091290643222945');" style=""> 319          assertFalse(couldApply);                                                                                  </span>
<span  style=""> 320                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 321          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322      }                                                                                                             </span>
<span  style=""> 323                                                                                                                    </span>
<span class="8397400473119507330" onmouseenter="enter('8397400473119507330');" onmouseout="out('8397400473119507330');" style=""> 324      public void testCouldOfferApplyToOrderItems() throws Exception {                                              </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 325          replay();                                                                                                 </span>
<span  style=""> 326                                                                                                                    </span>
<span class="-7122718500348489334" onmouseenter="enter('-7122718500348489334');" onmouseout="out('-7122718500348489334');" style=""> 327          PromotableOrder order = dataProvider.createBasicPromotableOrder();                                        </span>

<span class="-9184493469288637916" onmouseenter="enter('-9184493469288637916');" onmouseout="out('-9184493469288637916');" style=""> 328          List&lt;Offer&gt; offers = dataProvider.createItemBasedOfferWithItemCriteria(                                   </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 329              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 330              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 331              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 331              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 332              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 332              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 333          );                                                                                                        </span>
<span class="-4222545078163101091" onmouseenter="enter('-4222545078163101091');" onmouseout="out('-4222545078163101091');" style=""> 334          List&lt;PromotableOrderItem&gt; orderItems = new ArrayList&lt;PromotableOrderItem&gt;();                              </span>
<span class="-7372483979901719352" onmouseenter="enter('-7372483979901719352');" onmouseout="out('-7372483979901719352');" style=""> 335          for (PromotableOrderItem orderItem : order.getDiscountableOrderItems()) {                                 </span>
<span class="5423314879443576267" onmouseenter="enter('5423314879443576267');" onmouseout="out('5423314879443576267');" style=""> 336              orderItems.add(orderItem);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337          }                                                                                                         </span>
<span class="8798832722266180533" onmouseenter="enter('8798832722266180533');" onmouseout="out('8798832722266180533');" style=""> 338          CandidatePromotionItems candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), orderItems);</span>
<span class="-2239860486671048439" onmouseenter="enter('-2239860486671048439');" onmouseout="out('-2239860486671048439');" style=""> 339          //test that the valid order item offer is included                                                        </span>
<span class="-7375750347374851802" onmouseenter="enter('-7375750347374851802');" onmouseout="out('-7375750347374851802');" style=""> 340          //both cart items are valid for qualification and target                                                  </span>
<span class="-7973040919570615736" onmouseenter="enter('-7973040919570615736');" onmouseout="out('-7973040919570615736');" style=""> 341          assertTrue(candidates.isMatchedQualifier() &amp;&amp; candidates.getCandidateQualifiersMap().size() == 1 &amp;&amp;       </span>
<span class="2769824792004949663" onmouseenter="enter('2769824792004949663');" onmouseout="out('2769824792004949663');" style=""> 342                  candidates.getCandidateQualifiersMap().values().iterator().next().size() == 2 &amp;&amp;                  </span>
<span class="-2057082480309621191" onmouseenter="enter('-2057082480309621191');" onmouseout="out('-2057082480309621191');" style=""> 343                  candidates.isMatchedTarget() &amp;&amp; candidates.getCandidateTargetsMap().size() == 1 &amp;&amp;                </span>
<span class="2986039361500944684" onmouseenter="enter('2986039361500944684');" onmouseout="out('2986039361500944684');" style=""> 344                  candidates.getCandidateTargetsMap().values().iterator().next().size() == 2);                      </span>
<span  style=""> 345                                                                                                                    </span>
<span class="2603457283451180582" onmouseenter="enter('2603457283451180582');" onmouseout="out('2603457283451180582');" style=""> 346          offers = dataProvider.createItemBasedOfferWithItemCriteria(                                               </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 347              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 348              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-6301719950201762066" onmouseenter="enter('-6301719950201762066');" onmouseout="out('-6301719950201762066');" style=""><abbr title=" 349              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 349              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="800271347213994814" onmouseenter="enter('800271347213994814');" onmouseout="out('800271347213994814');" style=""><abbr title=" 350              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 350              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test5\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test6\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-4075588097149809180" onmouseenter="enter('-4075588097149809180');" onmouseout="out('-4075588097149809180');" style=""> 351          );                                                                                                        </span>
<span class="-7318029938713023882" onmouseenter="enter('-7318029938713023882');" onmouseout="out('-7318029938713023882');" style=""> 352          candidates = itemProcessor.couldOfferApplyToOrderItems(offers.get(0), orderItems);                        </span>
<span class="5723156784615186428" onmouseenter="enter('5723156784615186428');" onmouseout="out('5723156784615186428');" style=""> 353          //test that the invalid order item offer is excluded because there are no qualifying items                </span>
<span class="-265242688274418245" onmouseenter="enter('-265242688274418245');" onmouseout="out('-265242688274418245');" style=""> 354          assertFalse(candidates.isMatchedQualifier() &amp;&amp; candidates.getCandidateQualifiersMap().size() == 1);       </span>
<span  style=""> 355                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 356          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357      }                                                                                                             </span>
<span  style=""> 358                                                                                                                    </span>
<span class="-2310379539708411407" onmouseenter="enter('-2310379539708411407');" onmouseout="out('-2310379539708411407');" style=""> 359      private int checkOrderItemOfferAppliedCount(Order order) {                                                    </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 360          int count = 0;                                                                                            </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 361          for (OrderItem item : order.getOrderItems()) {                                                            </span>
<span class="773323050474809935" onmouseenter="enter('773323050474809935');" onmouseout="out('773323050474809935');" style=""> 362              for (OrderItemPriceDetail detail : item.getOrderItemPriceDetails()) {                                 </span>
<span class="-7653326266832377040" onmouseenter="enter('-7653326266832377040');" onmouseout="out('-7653326266832377040');" style=""> 363                  count = count + (detail.getOrderItemPriceDetailAdjustments().size() * detail.getQuantity());      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 365          }                                                                                                         </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 366          return count;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367      }                                                                                                             </span>
<span  style=""> 368                                                                                                                    </span>
<span class="352390873819089414" onmouseenter="enter('352390873819089414');" onmouseout="out('352390873819089414');" style=""> 369      private int checkOrderItemOfferAppliedQuantity(Order order, Offer offer) {                                    </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 370          int count = 0;                                                                                            </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 371          for (OrderItem item : order.getOrderItems()) {                                                            </span>
<span class="773323050474809935" onmouseenter="enter('773323050474809935');" onmouseout="out('773323050474809935');" style=""> 372              for (OrderItemPriceDetail detail : item.getOrderItemPriceDetails()) {                                 </span>
<span class="-2015743447488247947" onmouseenter="enter('-2015743447488247947');" onmouseout="out('-2015743447488247947');" style=""> 373                  for (OrderItemPriceDetailAdjustment adjustment : detail.getOrderItemPriceDetailAdjustments()) {   </span>
<span class="-6326222561939664995" onmouseenter="enter('-6326222561939664995');" onmouseout="out('-6326222561939664995');" style=""> 374                      if (adjustment.getOffer().getId().equals(offer.getId())) {                                    </span>
<span class="6653455861258404903" onmouseenter="enter('6653455861258404903');" onmouseout="out('6653455861258404903');" style=""> 375                          count += detail.getQuantity();                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 376                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 377                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379          }                                                                                                         </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 380          return count;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 381      }                                                                                                             </span>
<span  style=""> 382                                                                                                                    </span>
<span class="8856632786224131584" onmouseenter="enter('8856632786224131584');" onmouseout="out('8856632786224131584');" style=""> 383      private int countPriceDetails(Order order) {                                                                  </span>
<span class="-7835997453776942924" onmouseenter="enter('-7835997453776942924');" onmouseout="out('-7835997453776942924');" style=""> 384          int count = 0;                                                                                            </span>
<span class="820796442257070700" onmouseenter="enter('820796442257070700');" onmouseout="out('820796442257070700');" style=""> 385          for (OrderItem item : order.getOrderItems()) {                                                            </span>
<span class="-2490083702571223921" onmouseenter="enter('-2490083702571223921');" onmouseout="out('-2490083702571223921');" style=""> 386              count = count + item.getOrderItemPriceDetails().size();                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 387          }                                                                                                         </span>
<span class="7714877839932947695" onmouseenter="enter('7714877839932947695');" onmouseout="out('7714877839932947695');" style=""> 388          return count;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 389      }                                                                                                             </span>
<span  style=""> 390                                                                                                                    </span>
<span  style=""> 391                                                                                                                    </span>
<span class="-7256708927614783311" onmouseenter="enter('-7256708927614783311');" onmouseout="out('-7256708927614783311');" style=""> 392      public void testApplyAllItemOffers() throws Exception {                                                       </span>
<span  style=""> 393                                                                                                                    </span>
<span  style=""> 394                                                                                                                    </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 395          replay();                                                                                                 </span>
<span  style=""> 396                                                                                                                    </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 397          Order order = dataProvider.createBasicOrder();                                                            </span>
<span  style=""> 398                                                                                                                    </span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 399          Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                         </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 400              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 401              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 402              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 402              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 403              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 403              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 404          ).get(0);                                                                                                 </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 405          offer1.setId(1L);                                                                                         </span>
<span  style=""> 406                                                                                                                    </span>
<span class="2099956539522342594" onmouseenter="enter('2099956539522342594');" onmouseout="out('2099956539522342594');" style=""> 407          List&lt;Offer&gt; offers = new ArrayList&lt;Offer&gt;();                                                              </span>
<span class="-8212520581628164505" onmouseenter="enter('-8212520581628164505');" onmouseout="out('-8212520581628164505');" style=""> 408          offers.add(offer1);                                                                                       </span>
<span  style=""> 409                                                                                                                    </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""> 410          List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();       </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 411          order.updatePrices();                                                                                     </span>
<span class="1815029190775922456" onmouseenter="enter('1815029190775922456');" onmouseout="out('1815029190775922456');" style=""> 412          offerService.applyAndSaveOffersToOrder(offers, order);                                                    </span>
<span  style=""> 413                                                                                                                    </span>
<span class="5029607886283012370" onmouseenter="enter('5029607886283012370');" onmouseout="out('5029607886283012370');" style=""> 414          assertTrue(order.getTotalAdjustmentsValue().getAmount().doubleValue() &gt; 0);                               </span>
<span  style=""> 415                                                                                                                    </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 416          order = dataProvider.createBasicOrder();                                                                  </span>
<span  style=""> 417                                                                                                                    </span>
<span class="1078775613067151709" onmouseenter="enter('1078775613067151709');" onmouseout="out('1078775613067151709');" style=""> 418          qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();                                          </span>
<span class="7246766169005062112" onmouseenter="enter('7246766169005062112');" onmouseout="out('7246766169005062112');" style=""> 419          offer1.setApplyDiscountToSalePrice(false);                                                                </span>
<span class="2600361857999587596" onmouseenter="enter('2600361857999587596');" onmouseout="out('2600361857999587596');" style=""> 420          ((DiscreteOrderItem) order.getOrderItems().get(0)).getSku().setSalePrice(new Money(1D));                  </span>
<span class="7325578290287955946" onmouseenter="enter('7325578290287955946');" onmouseout="out('7325578290287955946');" style=""> 421          ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(new Money(1D));                  </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 422          order.updatePrices();                                                                                     </span>
<span class="1815029190775922456" onmouseenter="enter('1815029190775922456');" onmouseout="out('1815029190775922456');" style=""> 423          offerService.applyAndSaveOffersToOrder(offers, order);                                                    </span>
<span  style=""> 424                                                                                                                    </span>
<span class="-6354950951868192224" onmouseenter="enter('-6354950951868192224');" onmouseout="out('-6354950951868192224');" style=""> 425          assertTrue(order.getTotalAdjustmentsValue().getAmount().doubleValue() == 0);                              </span>
<span  style=""> 426                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 427          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 428      }                                                                                                             </span>
<span  style=""> 429                                                                                                                    </span>
<span class="5445671973328535543" onmouseenter="enter('5445671973328535543');" onmouseout="out('5445671973328535543');" style=""> 430      public void testApplyAdjustments() throws Exception {                                                         </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 431          replay();                                                                                                 </span>
<span  style=""> 432                                                                                                                    </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 433          Order order = dataProvider.createBasicOrder();                                                            </span>
<span  style=""> 434                                                                                                                    </span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 435          Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                         </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 436              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 437              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 438              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 438              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 439              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 439              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 440          ).get(0);                                                                                                 </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 441          offer1.setId(1L);                                                                                         </span>
<span class="-4071252017012046157" onmouseenter="enter('-4071252017012046157');" onmouseout="out('-4071252017012046157');" style=""> 442          OfferQualifyingCriteriaXref xref = offer1.getQualifyingItemCriteriaXref().iterator().next();              </span>
<span class="-7032540125324645344" onmouseenter="enter('-7032540125324645344');" onmouseout="out('-7032540125324645344');" style=""> 443          xref.getOfferItemCriteria().setQuantity(2);                                                               </span>
<span class="7720028840114078774" onmouseenter="enter('7720028840114078774');" onmouseout="out('7720028840114078774');" style=""> 444          offer1.setCombinableWithOtherOffers(false);                                                               </span>
<span class="-1956075415585459204" onmouseenter="enter('-1956075415585459204');" onmouseout="out('-1956075415585459204');" style=""> 445          Offer offer2 = dataProvider.createItemBasedOfferWithItemCriteria(                                         </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 446              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 447              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 448              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 448              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 449              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 449              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 450          ).get(0);                                                                                                 </span>
<span class="-6767777846149293935" onmouseenter="enter('-6767777846149293935');" onmouseout="out('-6767777846149293935');" style=""> 451          offer2.setId(2L);                                                                                         </span>
<span  style=""> 452                                                                                                                    </span>
<span class="8631188538838496439" onmouseenter="enter('8631188538838496439');" onmouseout="out('8631188538838496439');" style=""> 453          List&lt;Offer&gt; offerListWithOneOffer = new ArrayList&lt;Offer&gt;();                                               </span>
<span class="-7734009620886563381" onmouseenter="enter('-7734009620886563381');" onmouseout="out('-7734009620886563381');" style=""> 454          offerListWithOneOffer.add(offer1);                                                                        </span>
<span  style=""> 455                                                                                                                    </span>
<span class="-2645409726359466791" onmouseenter="enter('-2645409726359466791');" onmouseout="out('-2645409726359466791');" style=""> 456          List&lt;Offer&gt; offerListWithTwoOffers = new ArrayList&lt;Offer&gt;();                                              </span>
<span class="-2242941289654799072" onmouseenter="enter('-2242941289654799072');" onmouseout="out('-2242941289654799072');" style=""> 457          offerListWithTwoOffers.add(offer1);                                                                       </span>
<span class="-7736021191926792461" onmouseenter="enter('-7736021191926792461');" onmouseout="out('-7736021191926792461');" style=""> 458          offerListWithTwoOffers.add(offer2);                                                                       </span>
<span  style=""> 459                                                                                                                    </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 460          order.updatePrices();                                                                                     </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 461          offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                                     </span>
<span class="1819254978181053470" onmouseenter="enter('1819254978181053470');" onmouseout="out('1819254978181053470');" style=""> 462          assertTrue(checkOrderItemOfferAppliedCount(order) == 1);                                                  </span>
<span class="-1512986248678261918" onmouseenter="enter('-1512986248678261918');" onmouseout="out('-1512986248678261918');" style=""> 463          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 1);                                       </span>
<span  style=""> 464                                                                                                                    </span>
<span class="-992574443533108741" onmouseenter="enter('-992574443533108741');" onmouseout="out('-992574443533108741');" style=""> 465          // Add the second offer.   The first was nonCombinable so it should still be 1                            </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 466          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 467          order.updatePrices();                                                                                     </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 468          offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                                    </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 469          assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                                  </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 470          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                                       </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 471          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                                       </span>
<span  style=""> 472                                                                                                                    </span>
<span  style=""> 473                                                                                                                    </span>
<span class="4143880644635780347" onmouseenter="enter('4143880644635780347');" onmouseout="out('4143880644635780347');" style=""> 474          // Reset offer1 to combinable.   Now both should be applied.                                              </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 475          offer1.setCombinableWithOtherOffers(true);                                                                </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 476          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 477          order.updatePrices();                                                                                     </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 478          offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                                    </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 479          assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                                  </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 480          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                                       </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 481          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                                       </span>
<span  style=""> 482                                                                                                                    </span>
<span class="7464184952874881203" onmouseenter="enter('7464184952874881203');" onmouseout="out('7464184952874881203');" style=""> 483          // Offer 1 back to nonCombinable but don&#x27;t allow discount to the sale price                               </span>
<span class="-1417948014770234923" onmouseenter="enter('-1417948014770234923');" onmouseout="out('-1417948014770234923');" style=""> 484          // and make the sale price a better overall offer                                                         </span>
<span class="7720028840114078774" onmouseenter="enter('7720028840114078774');" onmouseout="out('7720028840114078774');" style=""> 485          offer1.setCombinableWithOtherOffers(false);                                                               </span>
<span class="7246766169005062112" onmouseenter="enter('7246766169005062112');" onmouseout="out('7246766169005062112');" style=""> 486          offer1.setApplyDiscountToSalePrice(false);                                                                </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 487          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="-5732736595573562244" onmouseenter="enter('-5732736595573562244');" onmouseout="out('-5732736595573562244');" style=""> 488          ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(new Money(10D));                 </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 489          order.updatePrices();                                                                                     </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 490          offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                                     </span>
<span class="-3398637566880609797" onmouseenter="enter('-3398637566880609797');" onmouseout="out('-3398637566880609797');" style=""> 491          assertTrue(checkOrderItemOfferAppliedCount(order) == 0);                                                  </span>
<span  style=""> 492                                                                                                                    </span>
<span class="1023771780730500424" onmouseenter="enter('1023771780730500424');" onmouseout="out('1023771780730500424');" style=""> 493          // Try again with two offers.   The second should be applied.                                             </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 494          order.updatePrices();                                                                                     </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 495          offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                                    </span>
<span class="-4525230421142201159" onmouseenter="enter('-4525230421142201159');" onmouseout="out('-4525230421142201159');" style=""> 496          assertTrue(checkOrderItemOfferAppliedCount(order) == 2);                                                  </span>
<span  style=""> 497                                                                                                                    </span>
<span class="-1661318026700279078" onmouseenter="enter('-1661318026700279078');" onmouseout="out('-1661318026700279078');" style=""> 498          // Trying with 2nd offer as nonCombinable.                                                                </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 499          offer1.setCombinableWithOtherOffers(true);                                                                </span>
<span class="7546366022368659645" onmouseenter="enter('7546366022368659645');" onmouseout="out('7546366022368659645');" style=""> 500          ((DiscreteOrderItem) order.getOrderItems().get(1)).getSku().setSalePrice(null);                           </span>
<span class="-7762597468102373652" onmouseenter="enter('-7762597468102373652');" onmouseout="out('-7762597468102373652');" style=""> 501          offer2.setCombinableWithOtherOffers(false);                                                               </span>
<span  style=""> 502                                                                                                                    </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 503          order.updatePrices();                                                                                     </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 504          offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                                     </span>
<span class="1819254978181053470" onmouseenter="enter('1819254978181053470');" onmouseout="out('1819254978181053470');" style=""> 505          assertTrue(checkOrderItemOfferAppliedCount(order) == 1);                                                  </span>
<span  style=""> 506                                                                                                                    </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 507          order.updatePrices();                                                                                     </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 508          offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                                    </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 509          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                                       </span>
<span class="-5022003892475651043" onmouseenter="enter('-5022003892475651043');" onmouseout="out('-5022003892475651043');" style=""> 510          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 0);                                       </span>
<span  style=""> 511                                                                                                                    </span>
<span class="-4953067338675041826" onmouseenter="enter('-4953067338675041826');" onmouseout="out('-4953067338675041826');" style=""> 512          // Set qualifying criteria quantity to 1                                                                  </span>
<span class="2746062014348300811" onmouseenter="enter('2746062014348300811');" onmouseout="out('2746062014348300811');" style=""> 513          // Set qualifying target criteria to 2                                                                    </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 514          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="-6688543313838783650" onmouseenter="enter('-6688543313838783650');" onmouseout="out('-6688543313838783650');" style=""> 515          xref = offer1.getQualifyingItemCriteriaXref().iterator().next();                                          </span>
<span class="2724580140749596242" onmouseenter="enter('2724580140749596242');" onmouseout="out('2724580140749596242');" style=""> 516          xref.getOfferItemCriteria().setQuantity(1);                                                               </span>
<span  style=""> 517                                                                                                                    </span>
<span class="2987053505448788974" onmouseenter="enter('2987053505448788974');" onmouseout="out('2987053505448788974');" style=""> 518          OfferTargetCriteriaXref targetXref = offer1.getTargetItemCriteriaXref().iterator().next();                </span>
<span class="7956044162267364758" onmouseenter="enter('7956044162267364758');" onmouseout="out('7956044162267364758');" style=""> 519          targetXref.getOfferItemCriteria().setQuantity(2);                                                         </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 520          order.updatePrices();                                                                                     </span>
<span class="-3431880499289047750" onmouseenter="enter('-3431880499289047750');" onmouseout="out('-3431880499289047750');" style=""> 521          offerService.applyAndSaveOffersToOrder(offerListWithOneOffer, order);                                     </span>
<span class="-7080380211983716353" onmouseenter="enter('-7080380211983716353');" onmouseout="out('-7080380211983716353');" style=""> 522          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 2);                                       </span>
<span  style=""> 523                                                                                                                    </span>
<span class="-2183171090813944888" onmouseenter="enter('-2183171090813944888');" onmouseout="out('-2183171090813944888');" style=""> 524          // Reset both offers to combinable and the qualifiers as allowing duplicate QUALIFIERs                    </span>
<span class="-2255179946339237317" onmouseenter="enter('-2255179946339237317');" onmouseout="out('-2255179946339237317');" style=""> 525          // and Targets                                                                                            </span>
<span class="4347212817422163521" onmouseenter="enter('4347212817422163521');" onmouseout="out('4347212817422163521');" style=""> 526          offer1.setCombinableWithOtherOffers(true);                                                                </span>
<span class="2527637603040178756" onmouseenter="enter('2527637603040178756');" onmouseout="out('2527637603040178756');" style=""> 527          offer2.setCombinableWithOtherOffers(true);                                                                </span>
<span class="-2476264833911625662" onmouseenter="enter('-2476264833911625662');" onmouseout="out('-2476264833911625662');" style=""> 528          offer1.setOfferItemQualifierRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                      </span>
<span class="-7410686570241782346" onmouseenter="enter('-7410686570241782346');" onmouseout="out('-7410686570241782346');" style=""> 529          offer1.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                         </span>
<span class="1961218096433141479" onmouseenter="enter('1961218096433141479');" onmouseout="out('1961218096433141479');" style=""> 530          offer2.setOfferItemQualifierRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                      </span>
<span class="7075569690739658894" onmouseenter="enter('7075569690739658894');" onmouseout="out('7075569690739658894');" style=""> 531          offer2.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.QUALIFIER_TARGET);                         </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 532          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="6434301866539320687" onmouseenter="enter('6434301866539320687');" onmouseout="out('6434301866539320687');" style=""> 533          order.updatePrices();                                                                                     </span>
<span class="8147295587280270379" onmouseenter="enter('8147295587280270379');" onmouseout="out('8147295587280270379');" style=""> 534          offerService.applyAndSaveOffersToOrder(offerListWithTwoOffers, order);                                    </span>
<span class="-7329741501515817260" onmouseenter="enter('-7329741501515817260');" onmouseout="out('-7329741501515817260');" style=""> 535          assertTrue(checkOrderItemOfferAppliedCount(order) == 4);                                                  </span>
<span class="-7989863931848982876" onmouseenter="enter('-7989863931848982876');" onmouseout="out('-7989863931848982876');" style=""> 536          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 2);                                       </span>
<span class="-7080380211983716353" onmouseenter="enter('-7080380211983716353');" onmouseout="out('-7080380211983716353');" style=""> 537          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer1) == 2);                                       </span>
<span  style=""> 538                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 539          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 540      }                                                                                                             </span>
<span  style=""> 541                                                                                                                    </span>
<span class="1804876492874242702" onmouseenter="enter('1804876492874242702');" onmouseout="out('1804876492874242702');" style=""> 542      public void testApplyItemQualifiersAndTargets() throws Exception {                                            </span>
<span class="3282532397622388039" onmouseenter="enter('3282532397622388039');" onmouseout="out('3282532397622388039');" style=""> 543          replay();                                                                                                 </span>
<span  style=""> 544                                                                                                                    </span>
<span class="-3168586063438010344" onmouseenter="enter('-3168586063438010344');" onmouseout="out('-3168586063438010344');" style=""> 545          List&lt;PromotableCandidateItemOffer&gt; qualifiedOffers = new ArrayList&lt;PromotableCandidateItemOffer&gt;();       </span>
<span class="-2384711291129434591" onmouseenter="enter('-2384711291129434591');" onmouseout="out('-2384711291129434591');" style=""> 546          Offer offer1 = dataProvider.createItemBasedOfferWithItemCriteria(                                         </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 547              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 548              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 549              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 549              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 550              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 550              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 551          ).get(0);                                                                                                 </span>
<span class="-2739678471133377583" onmouseenter="enter('-2739678471133377583');" onmouseout="out('-2739678471133377583');" style=""> 552          offer1.setId(1L);                                                                                         </span>
<span class="-1956075415585459204" onmouseenter="enter('-1956075415585459204');" onmouseout="out('-1956075415585459204');" style=""> 553          Offer offer2 = dataProvider.createItemBasedOfferWithItemCriteria(                                         </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 554              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 555              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 556              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 556              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 557              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 557              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 558          ).get(0);                                                                                                 </span>
<span class="-6767777846149293935" onmouseenter="enter('-6767777846149293935');" onmouseout="out('-6767777846149293935');" style=""> 559          offer2.setId(2L);                                                                                         </span>
<span  style=""> 560                                                                                                                    </span>
<span class="-946400959636335360" onmouseenter="enter('-946400959636335360');" onmouseout="out('-946400959636335360');" style=""> 561          OfferTargetCriteriaXref targetXref = offer2.getTargetItemCriteriaXref().iterator().next();                </span>
<span class="-8974993586722209178" onmouseenter="enter('-8974993586722209178');" onmouseout="out('-8974993586722209178');" style=""> 562          targetXref.getOfferItemCriteria().setQuantity(4);                                                         </span>
<span class="-7641378772090546772" onmouseenter="enter('-7641378772090546772');" onmouseout="out('-7641378772090546772');" style=""> 563          offer2.getQualifyingItemCriteriaXref().clear();                                                           </span>
<span class="-4860738879403790739" onmouseenter="enter('-4860738879403790739');" onmouseout="out('-4860738879403790739');" style=""> 564          offer2.setOfferItemTargetRuleType(OfferItemRestrictionRuleType.TARGET);                                   </span>
<span class="4265078036448799603" onmouseenter="enter('4265078036448799603');" onmouseout="out('4265078036448799603');" style=""> 565          Offer offer3 = dataProvider.createItemBasedOfferWithItemCriteria(                                         </span>
<span class="-971526457565278793" onmouseenter="enter('-971526457565278793');" onmouseout="out('-971526457565278793');" style=""> 566              &quot;order.subTotal.getAmount()&gt;20&quot;,                                                                      </span>
<span class="8626574580727552658" onmouseenter="enter('8626574580727552658');" onmouseout="out('8626574580727552658');" style=""> 567              OfferDiscountType.PERCENT_OFF,                                                                        </span>
<span class="-1086407973911983614" onmouseenter="enter('-1086407973911983614');" onmouseout="out('-1086407973911983614');" style=""><abbr title=" 568              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;,"> 568              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6157256577419644919" onmouseenter="enter('-6157256577419644919');" onmouseout="out('-6157256577419644919');" style=""><abbr title=" 569              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(\&quot;toUpperCase()\&quot;, discreteOrderItem.category.name))&quot;"> 569              &quot;([MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test1\&quot;), MVEL.eval(\&quot;toUpperCase()\&quot;,\&quot;test2\&quot;)] contains MVEL.eval(ðŸ”µ</abbr></span>
<span class="-6671120399365648350" onmouseenter="enter('-6671120399365648350');" onmouseout="out('-6671120399365648350');" style=""> 570          ).get(0);                                                                                                 </span>
<span  style=""> 571                                                                                                                    </span>
<span class="-1327825397201902636" onmouseenter="enter('-1327825397201902636');" onmouseout="out('-1327825397201902636');" style=""> 572          PromotableOrder promotableOrder = dataProvider.createBasicPromotableOrder();                              </span>

<span class="1609760517765742590" onmouseenter="enter('1609760517765742590');" onmouseout="out('1609760517765742590');" style=""> 573          itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer1);                             </span>
<span class="-8779152254781384438" onmouseenter="enter('-8779152254781384438');" onmouseout="out('-8779152254781384438');" style=""><abbr title=" 574          assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offer1) &amp;&amp; qualifiedOffers.get(0).getCandidateQualifiersMap().size() == 1);"> 574          assertTrue(qualifiedOffers.size() == 1 &amp;&amp; qualifiedOffers.get(0).getOffer().equals(offer1) &amp;&amp; qualifiedOffðŸ”µ</abbr></span>
<span  style=""> 575                                                                                                                    </span>
<span class="3664680620844694596" onmouseenter="enter('3664680620844694596');" onmouseout="out('3664680620844694596');" style=""> 576          itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer2);                             </span>
<span class="5658243282537406724" onmouseenter="enter('5658243282537406724');" onmouseout="out('5658243282537406724');" style=""><abbr title=" 577          assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offer2) &amp;&amp; qualifiedOffers.get(1).getCandidateQualifiersMap().size() == 0);"> 577          assertTrue(qualifiedOffers.size() == 2 &amp;&amp; qualifiedOffers.get(1).getOffer().equals(offer2) &amp;&amp; qualifiedOffðŸ”µ</abbr></span>
<span  style=""> 578                                                                                                                    </span>
<span class="-3826912296678151810" onmouseenter="enter('-3826912296678151810');" onmouseout="out('-3826912296678151810');" style=""> 579          itemProcessor.filterItemLevelOffer(promotableOrder, qualifiedOffers, offer3);                             </span>
<span class="1911054944218617418" onmouseenter="enter('1911054944218617418');" onmouseout="out('1911054944218617418');" style=""><abbr title=" 580          assertTrue(qualifiedOffers.size() == 3 &amp;&amp; qualifiedOffers.get(2).getOffer().equals(offer3) &amp;&amp; qualifiedOffers.get(2).getCandidateQualifiersMap().size() == 1);"> 580          assertTrue(qualifiedOffers.size() == 3 &amp;&amp; qualifiedOffers.get(2).getOffer().equals(offer3) &amp;&amp; qualifiedOffðŸ”µ</abbr></span>
<span  style=""> 581                                                                                                                    </span>
<span class="1766810220278806135" onmouseenter="enter('1766810220278806135');" onmouseout="out('1766810220278806135');" style=""><abbr title=" 582          // Try with just the second offer.   Expect to get 4 targets based on the offer having no qualifiers required"> 582          // Try with just the second offer.   Expect to get 4 targets based on the offer having no qualifiers requiðŸ”µ</abbr></span>
<span class="-4912150122214844213" onmouseenter="enter('-4912150122214844213');" onmouseout="out('-4912150122214844213');" style=""> 583          // and targeting category test1 or test2 and that the offer requires 4 target criteria.                   </span>
<span class="-5628787448724720908" onmouseenter="enter('-5628787448724720908');" onmouseout="out('-5628787448724720908');" style=""> 584          Order order = dataProvider.createBasicOrder();                                                            </span>
<span class="8583068860005847748" onmouseenter="enter('8583068860005847748');" onmouseout="out('8583068860005847748');" style=""> 585          List&lt;Offer&gt; offerList = new ArrayList&lt;Offer&gt;();                                                           </span>
<span class="3860405318390761830" onmouseenter="enter('3860405318390761830');" onmouseout="out('3860405318390761830');" style=""> 586          offerList.add(offer2);                                                                                    </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 587          offerService.applyAndSaveOffersToOrder(offerList, order);                                                 </span>
<span class="-8213637320090973795" onmouseenter="enter('-8213637320090973795');" onmouseout="out('-8213637320090973795');" style=""> 588          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 4);                                       </span>
<span class="1606234139614227925" onmouseenter="enter('1606234139614227925');" onmouseout="out('1606234139614227925');" style=""> 589          assertTrue(countPriceDetails(order) == 3);                                                                </span>
<span  style=""> 590                                                                                                                    </span>
<span class="2040936482538754372" onmouseenter="enter('2040936482538754372');" onmouseout="out('2040936482538754372');" style=""> 591          // Now try with both offers.   Since the targets can be reused, we expect to have 4 targets on offer2     </span>
<span class="8516822473741223062" onmouseenter="enter('8516822473741223062');" onmouseout="out('8516822473741223062');" style=""> 592          // and 1 target on offer1                                                                                 </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 593          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="2231055284542614880" onmouseenter="enter('2231055284542614880');" onmouseout="out('2231055284542614880');" style=""> 594          offerList.add(offer1); // add in second offer (which happens to be offer1)                                </span>
<span  style=""> 595                                                                                                                    </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 596          offerService.applyAndSaveOffersToOrder(offerList, order);                                                 </span>
<span class="-8213637320090973795" onmouseenter="enter('-8213637320090973795');" onmouseout="out('-8213637320090973795');" style=""> 597          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer2) == 4);                                       </span>
<span class="1606234139614227925" onmouseenter="enter('1606234139614227925');" onmouseout="out('1606234139614227925');" style=""> 598          assertTrue(countPriceDetails(order) == 3);                                                                </span>
<span  style=""> 599                                                                                                                    </span>
<span class="-8510477625850873985" onmouseenter="enter('-8510477625850873985');" onmouseout="out('-8510477625850873985');" style=""> 600          // All three offers - offer 3 is now higher priority so the best offer (offer 2) won&#x27;t be applied         </span>
<span class="6052806084932375672" onmouseenter="enter('6052806084932375672');" onmouseout="out('6052806084932375672');" style=""> 601          order = dataProvider.createBasicOrder();                                                                  </span>
<span class="-2751996978326205337" onmouseenter="enter('-2751996978326205337');" onmouseout="out('-2751996978326205337');" style=""> 602          offerList.add(offer3); // add in second offer (which happens to be offer1)                                </span>
<span class="3305227095626441424" onmouseenter="enter('3305227095626441424');" onmouseout="out('3305227095626441424');" style=""> 603          offer3.setPriority(-1);                                                                                   </span>
<span class="5326065371731063795" onmouseenter="enter('5326065371731063795');" onmouseout="out('5326065371731063795');" style=""> 604          offerService.applyAndSaveOffersToOrder(offerList, order);                                                 </span>
<span class="7385283043446040112" onmouseenter="enter('7385283043446040112');" onmouseout="out('7385283043446040112');" style=""> 605          assertTrue(checkOrderItemOfferAppliedQuantity(order, offer3) == 2);                                       </span>
<span class="7014092410184079185" onmouseenter="enter('7014092410184079185');" onmouseout="out('7014092410184079185');" style=""> 606          assertTrue(countPriceDetails(order) == 4);                                                                </span>
<span  style=""> 607                                                                                                                    </span>
<span class="-5058292317233132506" onmouseenter="enter('-5058292317233132506');" onmouseout="out('-5058292317233132506');" style=""> 608          verify();                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 609      }                                                                                                             </span>
<span  style=""> 610                                                                                                                    </span>
<span class="8243234137390807561" onmouseenter="enter('8243234137390807561');" onmouseout="out('8243234137390807561');" style=""> 611      public class Answer implements IAnswer&lt;CandidateItemOffer&gt; {                                                  </span>
<span  style=""> 612                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 613          @Override                                                                                                 </span>
<span class="2347184973793483651" onmouseenter="enter('2347184973793483651');" onmouseout="out('2347184973793483651');" style=""> 614          public CandidateItemOffer answer() throws Throwable {                                                     </span>
<span class="7644422100596500085" onmouseenter="enter('7644422100596500085');" onmouseout="out('7644422100596500085');" style=""> 615              return new CandidateItemOfferImpl();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 616          }                                                                                                         </span>
<span  style=""> 617                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 618      }                                                                                                             </span>
<span  style=""> 619                                                                                                                    </span>
<span class="-8622711476449936611" onmouseenter="enter('-8622711476449936611');" onmouseout="out('-8622711476449936611');" style=""> 620      public class Answer2 implements IAnswer&lt;OrderItemAdjustment&gt; {                                                </span>
<span  style=""> 621                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 622          @Override                                                                                                 </span>
<span class="4861248105020273136" onmouseenter="enter('4861248105020273136');" onmouseout="out('4861248105020273136');" style=""> 623          public OrderItemAdjustment answer() throws Throwable {                                                    </span>
<span class="7697130786892874769" onmouseenter="enter('7697130786892874769');" onmouseout="out('7697130786892874769');" style=""> 624              return new OrderItemAdjustmentImpl();                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 625          }                                                                                                         </span>
<span  style=""> 626                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 627      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 628  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            