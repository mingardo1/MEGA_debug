<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>104</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    104
                    <a href="103.html">prev</a>
                    <a href="105.html">next</a>
                    <a href="104_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Automattic/simplenote-android_30d88ec7c093849239a50dc1f681fcaf6fe0a6ec_Simplenote/src/main/java/com/automattic/simplenote/TagsListFragment.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;30d88ec7c093849239a50dc1f681fcaf6fe0a6ec:Simplenote/src/main/java/com/automattic/simplenote/TagsListFragment.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;30d88ec7c093849239a50dc1f681fcaf6fe0a6ec^1:Simplenote/src/main/java/com/automattic/simplenote/TagsListFragment.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;30d88ec7c093849239a50dc1f681fcaf6fe0a6ec^2:Simplenote/src/main/java/com/automattic/simplenote/TagsListFragment.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;74663dca81b35afccdcfcfe8cf560c21ed59d562:Simplenote/src/main/java/com/automattic/simplenote/TagsListFragment.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b], [bs], [sbj], [sbj], [bs], [s]], subset: [[b], [bs], [bs], [sbj], [sbj], [bs]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 package com.automattic.simplenote;
   2 
   3 import android.content.Context;
   4 import android.content.DialogInterface;
   5 import android.database.Cursor;
   6 import android.os.AsyncTask;
   7 import android.os.Bundle;
   8 import android.view.HapticFeedbackConstants;
   9 import android.view.LayoutInflater;
  10 import android.view.MenuItem;
  11 import android.view.View;
  12 import android.view.ViewGroup;
  13 import android.widget.EditText;
  14 import android.widget.ImageButton;
  15 import android.widget.ImageView;
  16 import android.widget.LinearLayout;
  17 import android.widget.TextView;
  18 import android.widget.Toast;
  19 
  20 import androidx.annotation.DrawableRes;
  21 import androidx.annotation.NonNull;
  22 import androidx.annotation.Nullable;
  23 import androidx.appcompat.app.AlertDialog;
  24 import androidx.appcompat.view.ContextThemeWrapper;
  25 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import androidx.fragment.app.Fragment;</span>
  27 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import androidx.annotation.NonNull;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import androidx.appcompat.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import androidx.appcompat.view.ContextThemeWrapper;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import androidx.recyclerview.widget.LinearLayoutManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import androidx.recyclerview.widget.RecyclerView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 </span>
  35 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36 import androidx.appcompat.widget.SearchView;</span>
  37 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  38 import androidx.recyclerview.widget.LinearLayoutManager;
  39 import androidx.recyclerview.widget.RecyclerView;
  40 
  41 import com.automattic.simplenote.analytics.AnalyticsTracker;
  42 import com.automattic.simplenote.models.Note;
  43 import com.automattic.simplenote.models.Tag;
  44 import com.automattic.simplenote.utils.BaseCursorAdapter;
  45 import com.automattic.simplenote.utils.DisplayUtils;
  46 import com.automattic.simplenote.utils.DrawableUtils;
  47 import com.automattic.simplenote.utils.HtmlCompat;
  48 import com.automattic.simplenote.widgets.EmptyViewRecyclerView;
  49 import com.simperium.client.Bucket;
  50 import com.simperium.client.BucketObjectNameInvalid;
  51 import com.simperium.client.Query;
  52 
  53 import java.lang.ref.SoftReference;
  54 import java.util.List;
  55 
  56 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57 public class TagsListFragment extends Fragment implements Bucket.Listener&lt;Tag&gt; {</span>
  58 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 import java.lang.ref.SoftReference;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 public class TagsListFragment extends Fragment implements ActionMode.Callback, Bucket.Listener&lt;Tag&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64     private ActionMode mActionMode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65     private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66     private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67     private TagsAdapter mTagsAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70      * Mandatory empty constructor for the fragment manager to instantiate the</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71      * fragment (e.g. upon screen orientation changes).</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72      */</span>
  73 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74 import static com.automattic.simplenote.models.Tag.NAME_PROPERTY;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76 public class TagsListFragment extends Fragment implements ActionMode.Callback, Bucket.Listener&lt;Tag&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77     private ActionMode mActionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78     private Bucket&lt;Tag&gt; mTagsBucket;</span>
  79 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  80     private Bucket&lt;Note&gt; mNotesBucket;
  81 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82     private Bucket&lt;Tag&gt; mTagsBucket;</span>
  83 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85 public class TagsListFragment extends Fragment implements ActionMode.Callback, Bucket.Listener&lt;Tag&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87     private ActionMode mActionMode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88     private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89     private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90     private TagsAdapter mTagsAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93      * Mandatory empty constructor for the fragment manager to instantiate the</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94      * fragment (e.g. upon screen orientation changes).</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96     public TagsListFragment() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 100     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {"> 100     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceS🔵</abbr></span>
 101 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102     private EmptyViewRecyclerView mTagsList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103     private ImageView mEmptyViewImage;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104     private MenuItem mSearchMenuItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105     private String mSearchQuery;</span>
 106 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 107     private TagsAdapter mTagsAdapter;
 108     private TextView mEmptyViewText;
 109     private boolean mIsSearching;
 110 
 111     /**
 112      * Mandatory empty constructor for the fragment manager to instantiate the
 113      * fragment (e.g. upon screen orientation changes).
 114      */
 115     public TagsListFragment() {
 116     }
 117 
 118     @Override
 119     public void onCreate(@Nullable Bundle savedInstanceState) {
 120         super.onCreate(savedInstanceState);
 121         setHasOptionsMenu(true);
 122     }
 123 
 124     @Override
 125     public void onCreateOptionsMenu(@NonNull Menu menu, @NonNull MenuInflater inflater) {
 126         super.onCreateOptionsMenu(menu, inflater);
 127         inflater.inflate(R.menu.tags_list, menu);
 128         DrawableUtils.tintMenuWithAttribute(getActivity(), menu, R.attr.toolbarIconColor);
 129 
 130         mSearchMenuItem = menu.findItem(R.id.menu_search);
 131         mSearchMenuItem.setOnActionExpandListener(
 132             new MenuItem.OnActionExpandListener() {
 133                 @Override
 134                 public boolean onMenuItemActionCollapse(MenuItem item) {
 135                     mIsSearching = false;
 136                     return true;
 137                 }
 138 
 139                 @Override
 140                 public boolean onMenuItemActionExpand(MenuItem item) {
 141                     mIsSearching = true;
 142                     return true;
 143                 }
 144             }
 145         );
 146         SearchView searchView = (SearchView) mSearchMenuItem.getActionView();
 147         LinearLayout searchEditFrame = searchView.findViewById(R.id.search_edit_frame);
 148         ((LinearLayout.LayoutParams) searchEditFrame.getLayoutParams()).leftMargin = 0;
 149 
 150         // Workaround for setting the search placeholder text color.
 151         @SuppressWarnings(&quot;ResourceType&quot;)
 152         String hintHexColor = getString(R.color.text_title_disabled).replace(&quot;ff&quot;, &quot;&quot;);
 153         searchView.setQueryHint(
 154             HtmlCompat.fromHtml(
 155                 String.format(
 156                     &quot;&lt;font color=\&quot;%s\&quot;&gt;%s&lt;/font&gt;&quot;,
 157                     hintHexColor,
 158                     getString(R.string.search_tags)
 159                 )
 160             )
 161         );
 162 
 163         searchView.setOnQueryTextListener(
 164             new SearchView.OnQueryTextListener() {
 165                 @Override
 166                 public boolean onQueryTextChange(String query) {
 167                     if (mSearchMenuItem.isActionViewExpanded()) {
 168                         mSearchQuery = query;
 169                         refreshTagsSearch();
 170                         mTagsList.scrollToPosition(0);
 171                         checkEmptyList();
 172                     }
 173 
 174                     return true;
 175                 }
 176 
 177                 @Override
 178                 public boolean onQueryTextSubmit(String queryText) {
 179                     return true;
 180                 }
 181             }
 182         );
 183 
 184         searchView.setOnCloseListener(
 185             new SearchView.OnCloseListener() {
 186                 @Override
 187                 public boolean onClose() {
 188                     mIsSearching = false;
 189                     mSearchQuery = &quot;&quot;;
 190                     refreshTags();
 191                     mTagsList.scrollToPosition(0);
 192                     checkEmptyList();
 193                     return false;
 194                 }
 195             }
 196         );
 197     }
 198 
 199     @Override
<abbr title=" 200     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {"> 200     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceS🔵</abbr>
 201         return inflater.inflate(R.layout.fragment_tags_list, container, false);
 202     }
 203 
 204     @Override
 205     public void onActivityCreated(Bundle savedInstanceState) {
 206         super.onActivityCreated(savedInstanceState);
 207 
 208         setHasOptionsMenu(true);
 209 
 210         Simplenote application = (Simplenote) requireActivity().getApplication();
 211         mTagsBucket = application.getTagsBucket();
 212         mNotesBucket = application.getNotesBucket();
 213 
 214 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 215         EmptyViewRecyclerView recyclerView = requireActivity().findViewById(R.id.list);</span>
 216 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218         Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219         mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220         mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222         EmptyViewRecyclerView recyclerView = getActivity().findViewById(R.id.list);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223         mTagsAdapter = new TagsAdapter();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224         recyclerView.setAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225         recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226         View emptyView = getActivity().findViewById(R.id.empty);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227         ImageView emptyViewImage = emptyView.findViewById(R.id.image);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228         emptyViewImage.setImageResource(R.drawable.ic_tag_24dp);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229         TextView emptyViewText = emptyView.findViewById(R.id.text);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230         emptyViewText.setText(R.string.empty_tags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231         recyclerView.setEmptyView(emptyView);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233         refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237     public void onResume() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238         super.onResume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240         mNotesBucket.start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241         mTagsBucket.start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243         mTagsBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244         mTagsBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245         mTagsBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249     public void onPause() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250         super.onPause();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252         mTagsBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253         mTagsBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254         mTagsBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256         mNotesBucket.stop();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257         mTagsBucket.stop();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260     protected void refreshTags() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 261         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);"> 261         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NA🔵</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262         Bucket.ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263         mTagsAdapter.swapCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266     // TODO: Finish bulk editing</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268     public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269         MenuInflater inflater = actionMode.getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270         inflater.inflate(R.menu.bulk_edit, menu);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271         mActionMode = actionMode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272         return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276     public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277         return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281     public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282         if (menuItem.getItemId() == R.id.menu_trash) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283             actionMode.finish(); // Action picked, so close the CAB</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286         return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290     public void onDestroyActionMode(ActionMode actionMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291         mActionMode = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295     public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297         if (item.getItemId() == android.R.id.home) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298             if (isAdded()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299                 getActivity().finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304         return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307     // Tag Bucket listeners</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309     public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310         if (isAdded()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311             getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312                 @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313                 public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314                     refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316             });</span>
 317 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318         mTagsList = getActivity().findViewById(R.id.list);</span>
 319 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 320         mTagsAdapter = new TagsAdapter();
 321 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 322         recyclerView.setAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 323         recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 324         View emptyView = requireActivity().findViewById(R.id.empty);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 325         ImageView emptyViewImage = emptyView.findViewById(R.id.image);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 326         emptyViewImage.setImageResource(R.drawable.ic_tag_24dp);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 327         TextView emptyViewText = emptyView.findViewById(R.id.text);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 328         emptyViewText.setText(R.string.empty_tags);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 329         recyclerView.setEmptyView(emptyView);</span>
 330 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331         mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332         mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334         EmptyViewRecyclerView recyclerView = getActivity().findViewById(R.id.list);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335         mTagsAdapter = new TagsAdapter();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336         recyclerView.setAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337         recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338         View emptyView = getActivity().findViewById(R.id.empty);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339         ImageView emptyViewImage = emptyView.findViewById(R.id.image);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340         emptyViewImage.setImageResource(R.drawable.ic_tag_24dp);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341         TextView emptyViewText = emptyView.findViewById(R.id.text);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342         emptyViewText.setText(R.string.empty_tags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343         recyclerView.setEmptyView(emptyView);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345         refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349     public void onResume() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350         super.onResume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352         mNotesBucket.start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353         mTagsBucket.start();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355         mTagsBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356         mTagsBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357         mTagsBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361     public void onPause() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362         super.onPause();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364         mTagsBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365         mTagsBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366         mTagsBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368         mNotesBucket.stop();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369         mTagsBucket.stop();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372     protected void refreshTags() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 373         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);"> 373         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NA🔵</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 374         Bucket.ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 375         mTagsAdapter.swapCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 376     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 378     // TODO: Finish bulk editing</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 380     public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 381         MenuInflater inflater = actionMode.getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382         inflater.inflate(R.menu.bulk_edit, menu);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383         mActionMode = actionMode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384         return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388     public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389         return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393     public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394         if (menuItem.getItemId() == R.id.menu_trash) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395             actionMode.finish(); // Action picked, so close the CAB</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398         return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402     public void onDestroyActionMode(ActionMode actionMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403         mActionMode = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407     public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409         if (item.getItemId() == android.R.id.home) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410             if (isAdded()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411                 getActivity().finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416         return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419     // Tag Bucket listeners</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421     public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422         if (isAdded()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423             getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424                 @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425                 public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426                     refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433     public void onNetworkChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434         if (isAdded()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435             getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436                 @Override</span>
 437 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438         mTagsList.setAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439         mTagsList.setLayoutManager(new LinearLayoutManager(getActivity()));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440         View emptyView = getActivity().findViewById(R.id.empty);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441         mEmptyViewImage = emptyView.findViewById(R.id.image);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442         mEmptyViewText = emptyView.findViewById(R.id.text);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443         checkEmptyList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444         mTagsList.setEmptyView(emptyView);</span>
 445 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 446 
 447         refreshTags();
 448     }
 449 
 450     @Override
 451     public void onResume() {
 452         super.onResume();
 453 
 454         mNotesBucket.start();
 455         mTagsBucket.start();
 456 
 457         mTagsBucket.addOnNetworkChangeListener(this);
 458         mTagsBucket.addOnSaveObjectListener(this);
 459         mTagsBucket.addOnDeleteObjectListener(this);
 460     }
 461 
 462     @Override
 463     public void onPause() {
 464         super.onPause();
 465 
 466         mTagsBucket.removeOnNetworkChangeListener(this);
 467         mTagsBucket.removeOnSaveObjectListener(this);
 468         mTagsBucket.removeOnDeleteObjectListener(this);
 469 
 470         mNotesBucket.stop();
 471         mTagsBucket.stop();
 472     }
 473 
 474     public void checkEmptyList() {
 475         if (mIsSearching) {
 476             if (DisplayUtils.isLandscape(getActivity()) &amp;&amp; !DisplayUtils.isLargeScreen(getActivity())) {
 477                 setEmptyListImage(-1);
 478                 setEmptyListMessage(getString(R.string.empty_tags_search));
 479             } else {
 480                 setEmptyListImage(R.drawable.ic_search_24dp);
 481                 setEmptyListMessage(getString(R.string.empty_tags_search));
 482             }
 483         } else {
 484             setEmptyListImage(R.drawable.ic_tag_24dp);
 485             setEmptyListMessage(getString(R.string.empty_tags));
 486         }
 487     }
 488 
 489     protected void refreshTags() {
<abbr title=" 490         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);"> 490         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NA🔵</abbr>
 491         Bucket.ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();
 492         mTagsAdapter.swapCursor(cursor);
 493     }
 494 
 495 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
 496 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 497         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);"> 497         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NA🔵</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498         Bucket.ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499         mTagsAdapter.swapCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 502     // TODO: Finish bulk editing</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 503     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 504     public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 505         MenuInflater inflater = actionMode.getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 506         inflater.inflate(R.menu.bulk_edit, menu);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 507         mActionMode = actionMode;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 508         return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 509     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 511     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512     public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513         return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 515 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 517     public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 518         if (menuItem.getItemId() == R.id.menu_trash) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 519             actionMode.finish(); // Action picked, so close the CAB</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 521         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 522         return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 523     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 524 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 525     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 526     public void onDestroyActionMode(ActionMode actionMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 527         mActionMode = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 528     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 529 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 530     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 531     public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 532 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 533         if (item.getItemId() == android.R.id.home) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 534             if (isAdded()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 535                 getActivity().finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 536                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 537             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 538         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 539 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 540         return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 541     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 542 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 543     // Tag Bucket listeners</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 544     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 545     public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 546         if (isAdded()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 547             getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 548                 @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 549                 public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 550                     refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 551                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 552             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 553         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 554     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 555 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 556     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 557     public void onNetworkChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 558         if (isAdded()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 559             getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 560                 @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 561                 public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 562                     refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 563                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 564             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 565         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 566     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 567 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 568     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 569     public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 570         if (isAdded()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 571             getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 572                 @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 573                 public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 574                     refreshTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 575                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 576             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 577         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 578     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 579 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 580     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 581     public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 582         // noop</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 583     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 584 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 585     private static class RemoveTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 586         private SoftReference&lt;TagsListFragment&gt; mTagsListFragmentReference;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 587 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 588         private RemoveTagFromNotesTask(TagsListFragment context) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 589             mTagsListFragmentReference = new SoftReference&lt;&gt;(context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 590         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 591 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 592         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 593         protected Void doInBackground(Tag... removedTags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 594             TagsListFragment fragment = mTagsListFragmentReference.get();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 595             Tag tag = removedTags[0];</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 596 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 597             if (tag != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 598                 Bucket.ObjectCursor&lt;Note&gt; cursor = tag.findNotes(fragment.mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 599 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 600                 while (cursor.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 601                     Note note = cursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 602                     List&lt;String&gt; tags = note.getTags();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 603                     tags.remove(tag.getName());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 604                     note.setTags(tags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 605                     note.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 606                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 607 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 608                 cursor.close();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 609             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 610 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 611             return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 612         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 613     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 614 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 615     private class TagsAdapter extends BaseCursorAdapter&lt;TagsAdapter.ViewHolder&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 616 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 617         public class ViewHolder extends RecyclerView.ViewHolder implements View.OnClickListener {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 618 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 619             private TextView tagTitle;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 620             private TextView tagCountTextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 621             private ImageButton deleteButton;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 622 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 623             private ViewHolder(View itemView) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 624                 super(itemView);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 625 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 626                 tagTitle = itemView.findViewById(R.id.tag_name);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 627                 tagCountTextView = itemView.findViewById(R.id.tag_count);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 628                 deleteButton = itemView.findViewById(R.id.tag_trash);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 629 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 630                 deleteButton.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 631                     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 632                     public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 633                         if (!isAdded() || !hasItem(getAdapterPosition())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 634                             return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 635                         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 636 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 637                         final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObject();"> 637                         final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObj🔵</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 638                         final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).count();"> 638                         final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUA🔵</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 639                         if (tagCount == 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 640                             deleteTag(tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 641                         } else if (tagCount &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 642                             AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.style.Dialog));"> 642                             AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(g🔵</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 643                             alert.setTitle(R.string.delete_tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 644                             alert.setMessage(getString(R.string.confirm_delete_tag));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 645                             alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 646                                 public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 647                                     deleteTag(tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 648                                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 649                             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 650                             alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 651                                 public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 652                                     // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 653                                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 654                             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 655                             alert.show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 656                         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 657                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 658                 });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 659                 deleteButton.setOnLongClickListener(new View.OnLongClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 660                     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 661                     public boolean onLongClick(View v) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 662                         if (v.isHapticFeedbackEnabled()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 663                             v.performHapticFeedback(HapticFeedbackConstants.LONG_PRESS);</span>
 664 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 665     protected void refreshTagsSearch() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 666         Query&lt;Tag&gt; tags = Tag.all(mTagsBucket)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 667             .where(NAME_PROPERTY, Query.ComparisonType.LIKE, &quot;%&quot; + mSearchQuery + &quot;%&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 668             .orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 669             .reorder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 670         Bucket.ObjectCursor&lt;Tag&gt; cursor = tags.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 671         mTagsAdapter.swapCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 672     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 673 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 674     private void setEmptyListImage(@DrawableRes int image) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 675         if (mEmptyViewImage != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 676             if (image != -1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 677                 mEmptyViewImage.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 678                 mEmptyViewImage.setImageResource(image);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 679             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 680                 mEmptyViewImage.setVisibility(View.GONE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 681             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 682         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 683     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 684 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 685     private void setEmptyListMessage(String message) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 686         if (mEmptyViewText != null &amp;&amp; message != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 687             mEmptyViewText.setText(message);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 688         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 689     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 690 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 691     // TODO: Finish bulk editing</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 692     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 693     public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 694         MenuInflater inflater = actionMode.getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 695         inflater.inflate(R.menu.bulk_edit, menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 696         mActionMode = actionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 697         return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 698     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 699 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 700     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 701     public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 702         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 703     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 704 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 705     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 706     public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 707         if (menuItem.getItemId() == R.id.menu_trash) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 708             actionMode.finish(); // Action picked, so close the CAB</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 709             return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 710         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 713 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 714     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 715     public void onDestroyActionMode(ActionMode actionMode) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 716         mActionMode = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 717     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 718 </span>
 719 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 720     @Override
 721     public boolean onOptionsItemSelected(MenuItem item) {
 722         if (item.getItemId() == android.R.id.home) {
 723             if (isAdded()) {
 724                 requireActivity().finish();
 725                 return true;
 726             }
 727         }
 728 
 729         return super.onOptionsItemSelected(item);
 730     }
 731 
 732     // Tag Bucket listeners
 733     @Override
 734     public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 735         if (isAdded()) {
 736             requireActivity().runOnUiThread(new Runnable() {
 737                 @Override
 738                 public void run() {
 739                     if (mIsSearching) {
 740                         refreshTagsSearch();
 741                     } else {
 742                         refreshTags();
 743                     }
 744                 }
 745             });
 746         }
 747     }
 748 
 749     @Override
 750     public void onNetworkChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {
 751         if (isAdded()) {
 752             requireActivity().runOnUiThread(new Runnable() {
 753                 @Override
 754                 public void run() {
 755                     if (mIsSearching) {
 756                         refreshTagsSearch();
 757                     } else {
 758                         refreshTags();
 759                     }
 760                 }
 761             });
 762         }
 763     }
 764 
 765     @Override
 766     public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 767         if (isAdded()) {
 768             requireActivity().runOnUiThread(new Runnable() {
 769                 @Override
 770                 public void run() {
 771                     if (mIsSearching) {
 772                         refreshTagsSearch();
 773                     } else {
 774                         refreshTags();
 775                     }
 776                 }
 777             });
 778         }
 779     }
 780 
 781     @Override
 782     public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 783         // noop
 784     }
 785 
 786     private static class RemoveTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {
 787         private SoftReference&lt;TagsListFragment&gt; mTagsListFragmentReference;
 788 
 789         private RemoveTagFromNotesTask(TagsListFragment context) {
 790             mTagsListFragmentReference = new SoftReference&lt;&gt;(context);
 791         }
 792 
 793         @Override
 794         protected Void doInBackground(Tag... removedTags) {
 795             TagsListFragment fragment = mTagsListFragmentReference.get();
 796             Tag tag = removedTags[0];
 797 
 798             if (tag != null) {
 799                 Bucket.ObjectCursor&lt;Note&gt; cursor = tag.findNotes(fragment.mNotesBucket);
 800 
 801                 while (cursor.moveToNext()) {
 802                     Note note = cursor.getObject();
 803                     List&lt;String&gt; tags = note.getTags();
 804                     tags.remove(tag.getName());
 805                     note.setTags(tags);
 806                     note.save();
 807                 }
 808 
 809                 cursor.close();
 810             }
 811 
 812             return null;
 813         }
 814     }
 815 
 816     private class TagsAdapter extends BaseCursorAdapter&lt;TagsAdapter.ViewHolder&gt; {
 817         public class ViewHolder extends RecyclerView.ViewHolder implements View.OnClickListener {
 818             private TextView tagTitle;
 819             private TextView tagCountTextView;
 820             private ImageButton deleteButton;
 821 
 822             private ViewHolder(View itemView) {
 823                 super(itemView);
 824 
 825                 tagTitle = itemView.findViewById(R.id.tag_name);
 826                 tagCountTextView = itemView.findViewById(R.id.tag_count);
 827                 deleteButton = itemView.findViewById(R.id.tag_trash);
 828 
 829                 deleteButton.setOnClickListener(new View.OnClickListener() {
 830                     @Override
 831                     public void onClick(View view) {
 832                         if (!isAdded() || !hasItem(getAdapterPosition())) {
 833                             return;
 834                         }
 835 
<abbr title=" 836                         final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObject();"> 836                         final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObj🔵</abbr>
<abbr title=" 837                         final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).count();"> 837                         final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUA🔵</abbr>
 838                         if (tagCount == 0) {
 839                             deleteTag(tag);
 840                         } else if (tagCount &gt; 0) {
<abbr title=" 841                             AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.style.Dialog));"> 841                             AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(g🔵</abbr>
 842                             alert.setTitle(R.string.delete_tag);
 843                             alert.setMessage(getString(R.string.confirm_delete_tag));
 844                             alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {
 845                                 public void onClick(DialogInterface dialog, int whichButton) {
 846                                     deleteTag(tag);
 847                                 }
 848                             });
 849                             alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {
 850                                 public void onClick(DialogInterface dialog, int whichButton) {
 851                                     // Do nothing, just closing the dialog
 852                                 }
 853                             });
 854                             alert.show();
 855                         }
 856                     }
 857                 });
 858                 deleteButton.setOnLongClickListener(new View.OnLongClickListener() {
 859                     @Override
 860                     public boolean onLongClick(View v) {
 861                         if (v.isHapticFeedbackEnabled()) {
 862                             v.performHapticFeedback(HapticFeedbackConstants.LONG_PRESS);
 863                         }
 864 
<abbr title=" 865                         Toast.makeText(getContext(), requireContext().getString(R.string.delete_tag), Toast.LENGTH_SHORT).show();"> 865                         Toast.makeText(getContext(), requireContext().getString(R.string.delete_tag), Toa🔵</abbr>
 866                         return true;
 867                     }
 868                 });
 869 
 870                 itemView.setOnClickListener(this);
 871             }
 872 
 873             @Override
 874             public void onClick(View view) {
 875                 if (!isAdded() || !hasItem(getAdapterPosition())) {
 876                     return;
 877                 }
 878 
<abbr title=" 879                 final AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.style.Dialog));"> 879                 final AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getCont🔵</abbr>
<abbr title=" 880                 LinearLayout alertView = (LinearLayout) requireActivity().getLayoutInflater().inflate(R.layout.edit_tag, null);"> 880                 LinearLayout alertView = (LinearLayout) requireActivity().getLayoutInflater().inflate(R.l🔵</abbr>
 881 
 882                 final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObject();
 883 
 884                 final EditText tagNameEditText = alertView.findViewById(R.id.tag_name_edit);
 885                 tagNameEditText.setText(tag.getName());
 886                 tagNameEditText.setSelection(tagNameEditText.length());
 887                 alert.setView(alertView);
 888                 alert.setTitle(R.string.rename_tag);
 889                 alert.setPositiveButton(R.string.save, new DialogInterface.OnClickListener() {
 890                     public void onClick(DialogInterface dialog, int whichButton) {
 891                         String value = tagNameEditText.getText().toString().trim();
 892                         try {
 893                             tag.renameTo(value, mNotesBucket);
 894                             AnalyticsTracker.track(
 895                                     AnalyticsTracker.Stat.TAG_EDITOR_ACCESSED,
 896                                     AnalyticsTracker.CATEGORY_TAG,
 897                                     &quot;tag_alert_edit_box&quot;
 898                             );
 899                         } catch (BucketObjectNameInvalid e) {
 900                             android.util.Log.e(Simplenote.TAG, &quot;Unable to rename tag&quot;, e);
 901                             // TODO: show user a message that new tag name is not ok
 902                         }
 903                     }
 904                 });
 905                 alert.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {
 906                     public void onClick(DialogInterface dialog, int whichButton) {
 907                         // Do nothing
 908                     }
 909                 });
 910                 alert.show();
 911             }
 912 
 913             private void deleteTag(Tag tag) {
 914                 tag.delete();
<abbr title=" 915                 new RemoveTagFromNotesTask(TagsListFragment.this).executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, tag);"> 915                 new RemoveTagFromNotesTask(TagsListFragment.this).executeOnExecutor(AsyncTask.THREAD_POOL🔵</abbr>
 916                 AnalyticsTracker.track(
 917                         AnalyticsTracker.Stat.TAG_MENU_DELETED,
 918                         AnalyticsTracker.CATEGORY_TAG,
 919                         &quot;list_trash_button&quot;
 920                 );
 921             }
 922         }
 923 
 924         private TagsAdapter() {
 925             super(null);
 926         }
 927 
 928         @NonNull
 929         @Override
 930         public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
 931             Context context = parent.getContext();
 932             LayoutInflater inflater = LayoutInflater.from(context);
 933             View contactView = inflater.inflate(R.layout.tags_list_row, parent, false);
 934             return new ViewHolder(contactView);
 935         }
 936 
 937         @Override
 938         public void onBindViewHolder(@NonNull ViewHolder holder, Cursor cursor) {
 939             Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;)cursor).getObject();
 940             holder.tagTitle.setText(tag.getName());
<abbr title=" 941             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).count();"> 941             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.ge🔵</abbr>
 942 
 943             if (tagCount &gt; 0) {
 944                 holder.tagCountTextView.setText(String.valueOf(tagCount));
 945             } else {
 946                 holder.tagCountTextView.setText(&quot;&quot;);
 947             }
 948         }
 949 
 950         @Override
 951         public void swapCursor(Cursor newCursor) {
 952             super.swapCursor(newCursor);
 953         }
 954     }
 955 }</pre></td>
                            <td><pre>   1 package com.automattic.simplenote;
   2 
   3 import android.content.Context;
   4 import android.content.DialogInterface;
   5 import android.database.Cursor;
   6 import android.os.AsyncTask;
   7 import android.os.Bundle;
   8 import android.view.HapticFeedbackConstants;
   9 import android.view.LayoutInflater;
  10 import android.view.MenuItem;
  11 import android.view.View;
  12 import android.view.ViewGroup;
  13 import android.widget.EditText;
  14 import android.widget.ImageButton;
  15 import android.widget.ImageView;
  16 import android.widget.LinearLayout;
  17 import android.widget.TextView;
  18 import android.widget.Toast;
  19 
  20 import androidx.annotation.DrawableRes;
  21 import androidx.annotation.NonNull;
  22 import androidx.annotation.Nullable;
  23 import androidx.appcompat.app.AlertDialog;
  24 import androidx.appcompat.view.ContextThemeWrapper;
  25 import androidx.fragment.app.Fragment;
  26 import androidx.appcompat.widget.SearchView;
  27 import androidx.recyclerview.widget.LinearLayoutManager;
  28 import androidx.recyclerview.widget.RecyclerView;
  29 
  30 import com.automattic.simplenote.analytics.AnalyticsTracker;
  31 import com.automattic.simplenote.models.Note;
  32 import com.automattic.simplenote.models.Tag;
  33 import com.automattic.simplenote.utils.BaseCursorAdapter;
  34 import com.automattic.simplenote.utils.DisplayUtils;
  35 import com.automattic.simplenote.utils.DrawableUtils;
  36 import com.automattic.simplenote.utils.HtmlCompat;
  37 import com.automattic.simplenote.widgets.EmptyViewRecyclerView;
  38 import com.simperium.client.Bucket;
  39 import com.simperium.client.BucketObjectNameInvalid;
  40 import com.simperium.client.Query;
  41 
  42 import java.lang.ref.SoftReference;
  43 import java.util.List;
  44 
  45 import static com.automattic.simplenote.models.Tag.NAME_PROPERTY;
  46 
  47 public class TagsListFragment extends Fragment implements Bucket.Listener&lt;Tag&gt; {
  48     private Bucket&lt;Tag&gt; mTagsBucket;
  49     private Bucket&lt;Note&gt; mNotesBucket;
  50     private EmptyViewRecyclerView mTagsList;
  51     private ImageView mEmptyViewImage;
  52     private MenuItem mSearchMenuItem;
  53     private String mSearchQuery;
  54     private TagsAdapter mTagsAdapter;
  55     private TextView mEmptyViewText;
  56     private boolean mIsSearching;
  57 
  58     /**
  59      * Mandatory empty constructor for the fragment manager to instantiate the
  60      * fragment (e.g. upon screen orientation changes).
  61      */
  62     public TagsListFragment() {
  63     }
  64 
  65     @Override
  66     public void onCreate(@Nullable Bundle savedInstanceState) {
  67         super.onCreate(savedInstanceState);
  68         setHasOptionsMenu(true);
  69     }
  70 
  71     @Override
  72     public void onCreateOptionsMenu(@NonNull Menu menu, @NonNull MenuInflater inflater) {
  73         super.onCreateOptionsMenu(menu, inflater);
  74         inflater.inflate(R.menu.tags_list, menu);
  75         DrawableUtils.tintMenuWithAttribute(getActivity(), menu, R.attr.toolbarIconColor);
  76 
  77         mSearchMenuItem = menu.findItem(R.id.menu_search);
  78         mSearchMenuItem.setOnActionExpandListener(
  79             new MenuItem.OnActionExpandListener() {
  80                 @Override
  81                 public boolean onMenuItemActionCollapse(MenuItem item) {
  82                     mIsSearching = false;
  83                     return true;
  84                 }
  85 
  86                 @Override
  87                 public boolean onMenuItemActionExpand(MenuItem item) {
  88                     mIsSearching = true;
  89                     return true;
  90                 }
  91             }
  92         );
  93         SearchView searchView = (SearchView) mSearchMenuItem.getActionView();
  94         LinearLayout searchEditFrame = searchView.findViewById(R.id.search_edit_frame);
  95         ((LinearLayout.LayoutParams) searchEditFrame.getLayoutParams()).leftMargin = 0;
  96 
  97         // Workaround for setting the search placeholder text color.
  98         @SuppressWarnings(&quot;ResourceType&quot;)
  99         String hintHexColor = getString(R.color.text_title_disabled).replace(&quot;ff&quot;, &quot;&quot;);
 100         searchView.setQueryHint(
 101             HtmlCompat.fromHtml(
 102                 String.format(
 103                     &quot;&lt;font color=\&quot;%s\&quot;&gt;%s&lt;/font&gt;&quot;,
 104                     hintHexColor,
 105                     getString(R.string.search_tags)
 106                 )
 107             )
 108         );
 109 
 110         searchView.setOnQueryTextListener(
 111             new SearchView.OnQueryTextListener() {
 112                 @Override
 113                 public boolean onQueryTextChange(String query) {
 114                     if (mSearchMenuItem.isActionViewExpanded()) {
 115                         mSearchQuery = query;
 116                         refreshTagsSearch();
 117                         mTagsList.scrollToPosition(0);
 118                         checkEmptyList();
 119                     }
 120 
 121                     return true;
 122                 }
 123 
 124                 @Override
 125                 public boolean onQueryTextSubmit(String queryText) {
 126                     return true;
 127                 }
 128             }
 129         );
 130 
 131         searchView.setOnCloseListener(
 132             new SearchView.OnCloseListener() {
 133                 @Override
 134                 public boolean onClose() {
 135                     mIsSearching = false;
 136                     mSearchQuery = &quot;&quot;;
 137                     refreshTags();
 138                     mTagsList.scrollToPosition(0);
 139                     checkEmptyList();
 140                     return false;
 141                 }
 142             }
 143         );
 144     }
 145 
 146     @Override
<abbr title=" 147     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {"> 147     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceS🔵</abbr>
 148         return inflater.inflate(R.layout.fragment_tags_list, container, false);
 149     }
 150 
 151     @Override
 152     public void onActivityCreated(Bundle savedInstanceState) {
 153         super.onActivityCreated(savedInstanceState);
 154 
 155         setHasOptionsMenu(true);
 156 
 157         Simplenote application = (Simplenote) requireActivity().getApplication();
 158         mTagsBucket = application.getTagsBucket();
 159         mNotesBucket = application.getNotesBucket();
 160 
 161 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162         EmptyViewRecyclerView recyclerView = requireActivity().findViewById(R.id.list);</span>
 163 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164         EmptyViewRecyclerView recyclerView = getActivity().findViewById(R.id.list);</span>
 165 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166         mTagsList = getActivity().findViewById(R.id.list);</span>
 167 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 168         mTagsAdapter = new TagsAdapter();
 169 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170         recyclerView.setAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171         recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172         View emptyView = requireActivity().findViewById(R.id.empty);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173         ImageView emptyViewImage = emptyView.findViewById(R.id.image);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174         emptyViewImage.setImageResource(R.drawable.ic_tag_24dp);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175         TextView emptyViewText = emptyView.findViewById(R.id.text);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176         emptyViewText.setText(R.string.empty_tags);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177         recyclerView.setEmptyView(emptyView);</span>
 178 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179         recyclerView.setAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180         recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181         View emptyView = getActivity().findViewById(R.id.empty);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182         ImageView emptyViewImage = emptyView.findViewById(R.id.image);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183         emptyViewImage.setImageResource(R.drawable.ic_tag_24dp);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184         TextView emptyViewText = emptyView.findViewById(R.id.text);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185         emptyViewText.setText(R.string.empty_tags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186         recyclerView.setEmptyView(emptyView);</span>
 187 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188         mTagsList.setAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189         mTagsList.setLayoutManager(new LinearLayoutManager(getActivity()));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190         View emptyView = getActivity().findViewById(R.id.empty);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191         mEmptyViewImage = emptyView.findViewById(R.id.image);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192         mEmptyViewText = emptyView.findViewById(R.id.text);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193         checkEmptyList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194         mTagsList.setEmptyView(emptyView);</span>
 195 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 196 
 197         refreshTags();
 198     }
 199 
 200     @Override
 201     public void onResume() {
 202         super.onResume();
 203 
 204         mNotesBucket.start();
 205         mTagsBucket.start();
 206 
 207         mTagsBucket.addOnNetworkChangeListener(this);
 208         mTagsBucket.addOnSaveObjectListener(this);
 209         mTagsBucket.addOnDeleteObjectListener(this);
 210     }
 211 
 212     @Override
 213     public void onPause() {
 214         super.onPause();
 215 
 216         mTagsBucket.removeOnNetworkChangeListener(this);
 217         mTagsBucket.removeOnSaveObjectListener(this);
 218         mTagsBucket.removeOnDeleteObjectListener(this);
 219 
 220         mNotesBucket.stop();
 221         mTagsBucket.stop();
 222     }
 223 
 224     public void checkEmptyList() {
 225         if (mIsSearching) {
 226             if (DisplayUtils.isLandscape(getActivity()) &amp;&amp; !DisplayUtils.isLargeScreen(getActivity())) {
 227                 setEmptyListImage(-1);
 228                 setEmptyListMessage(getString(R.string.empty_tags_search));
 229             } else {
 230                 setEmptyListImage(R.drawable.ic_search_24dp);
 231                 setEmptyListMessage(getString(R.string.empty_tags_search));
 232             }
 233         } else {
 234             setEmptyListImage(R.drawable.ic_tag_24dp);
 235             setEmptyListMessage(getString(R.string.empty_tags));
 236         }
 237     }
 238 
 239     protected void refreshTags() {
<abbr title=" 240         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);"> 240         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NA🔵</abbr>
 241         Bucket.ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();
 242         mTagsAdapter.swapCursor(cursor);
 243     }
 244 
 245     protected void refreshTagsSearch() {
 246         Query&lt;Tag&gt; tags = Tag.all(mTagsBucket)
 247             .where(NAME_PROPERTY, Query.ComparisonType.LIKE, &quot;%&quot; + mSearchQuery + &quot;%&quot;)
 248             .orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME)
 249             .reorder();
 250         Bucket.ObjectCursor&lt;Tag&gt; cursor = tags.execute();
 251         mTagsAdapter.swapCursor(cursor);
 252     }
 253 
 254     private void setEmptyListImage(@DrawableRes int image) {
 255         if (mEmptyViewImage != null) {
 256             if (image != -1) {
 257                 mEmptyViewImage.setVisibility(View.VISIBLE);
 258                 mEmptyViewImage.setImageResource(image);
 259             } else {
 260                 mEmptyViewImage.setVisibility(View.GONE);
 261             }
 262         }
 263     }
 264 
 265     private void setEmptyListMessage(String message) {
 266         if (mEmptyViewText != null &amp;&amp; message != null) {
 267             mEmptyViewText.setText(message);
 268         }
 269     }
 270 
 271     @Override
 272     public boolean onOptionsItemSelected(MenuItem item) {
 273         if (item.getItemId() == android.R.id.home) {
 274             if (isAdded()) {
 275                 requireActivity().finish();
 276                 return true;
 277             }
 278         }
 279 
 280         return super.onOptionsItemSelected(item);
 281     }
 282 
 283     // Tag Bucket listeners
 284     @Override
 285     public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 286         if (isAdded()) {
 287             requireActivity().runOnUiThread(new Runnable() {
 288                 @Override
 289                 public void run() {
 290                     if (mIsSearching) {
 291                         refreshTagsSearch();
 292                     } else {
 293                     refreshTags();
 294                 }
 295                 }
 296             });
 297         }
 298     }
 299 
 300     @Override
 301     public void onNetworkChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {
 302         if (isAdded()) {
 303             requireActivity().runOnUiThread(new Runnable() {
 304                 @Override
 305                 public void run() {
 306                     if (mIsSearching) {
 307                         refreshTagsSearch();
 308                     } else {
 309                     refreshTags();
 310                 }
 311                 }
 312             });
 313         }
 314     }
 315 
 316     @Override
 317     public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 318         if (isAdded()) {
 319             requireActivity().runOnUiThread(new Runnable() {
 320                 @Override
 321                 public void run() {
 322                     if (mIsSearching) {
 323                         refreshTagsSearch();
 324                     } else {
 325                     refreshTags();
 326                 }
 327                 }
 328             });
 329         }
 330     }
 331 
 332     @Override
 333     public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 334         // noop
 335     }
 336 
 337     private static class RemoveTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {
 338         private SoftReference&lt;TagsListFragment&gt; mTagsListFragmentReference;
 339 
 340         private RemoveTagFromNotesTask(TagsListFragment context) {
 341             mTagsListFragmentReference = new SoftReference&lt;&gt;(context);
 342         }
 343 
 344         @Override
 345         protected Void doInBackground(Tag... removedTags) {
 346             TagsListFragment fragment = mTagsListFragmentReference.get();
 347             Tag tag = removedTags[0];
 348 
 349             if (tag != null) {
 350                 Bucket.ObjectCursor&lt;Note&gt; cursor = tag.findNotes(fragment.mNotesBucket);
 351 
 352                 while (cursor.moveToNext()) {
 353                     Note note = cursor.getObject();
 354                     List&lt;String&gt; tags = note.getTags();
 355                     tags.remove(tag.getName());
 356                     note.setTags(tags);
 357                     note.save();
 358                 }
 359 
 360                 cursor.close();
 361             }
 362 
 363             return null;
 364         }
 365     }
 366 
 367     private class TagsAdapter extends BaseCursorAdapter&lt;TagsAdapter.ViewHolder&gt; {
 368         public class ViewHolder extends RecyclerView.ViewHolder implements View.OnClickListener {
 369             private TextView tagTitle;
 370             private TextView tagCountTextView;
 371             private ImageButton deleteButton;
 372 
 373             private ViewHolder(View itemView) {
 374                 super(itemView);
 375 
 376                 tagTitle = itemView.findViewById(R.id.tag_name);
 377                 tagCountTextView = itemView.findViewById(R.id.tag_count);
 378                 deleteButton = itemView.findViewById(R.id.tag_trash);
 379 
 380                 deleteButton.setOnClickListener(new View.OnClickListener() {
 381                     @Override
 382                     public void onClick(View view) {
 383                         if (!isAdded() || !hasItem(getAdapterPosition())) {
 384                             return;
 385                         }
 386 
<abbr title=" 387                         final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObject();"> 387                         final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObj🔵</abbr>
<abbr title=" 388                         final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).count();"> 388                         final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUA🔵</abbr>
 389                         if (tagCount == 0) {
 390                             deleteTag(tag);
 391                         } else if (tagCount &gt; 0) {
<abbr title=" 392                             AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.style.Dialog));"> 392                             AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(g🔵</abbr>
 393                             alert.setTitle(R.string.delete_tag);
 394                             alert.setMessage(getString(R.string.confirm_delete_tag));
 395                             alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {
 396                                 public void onClick(DialogInterface dialog, int whichButton) {
 397                                     deleteTag(tag);
 398                                 }
 399                             });
 400                             alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {
 401                                 public void onClick(DialogInterface dialog, int whichButton) {
 402                                     // Do nothing, just closing the dialog
 403                                 }
 404                             });
 405                             alert.show();
 406                         }
 407                     }
 408                 });
 409                 deleteButton.setOnLongClickListener(new View.OnLongClickListener() {
 410                     @Override
 411                     public boolean onLongClick(View v) {
 412                         if (v.isHapticFeedbackEnabled()) {
 413                             v.performHapticFeedback(HapticFeedbackConstants.LONG_PRESS);
 414                         }
 415 
<abbr title=" 416                         Toast.makeText(getContext(), requireContext().getString(R.string.delete_tag), Toast.LENGTH_SHORT).show();"> 416                         Toast.makeText(getContext(), requireContext().getString(R.string.delete_tag), Toa🔵</abbr>
 417                         return true;
 418                     }
 419                 });
 420 
 421                 itemView.setOnClickListener(this);
 422             }
 423 
 424             @Override
 425             public void onClick(View view) {
 426                 if (!isAdded() || !hasItem(getAdapterPosition())) {
 427                     return;
 428                 }
 429 
<abbr title=" 430                 final AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.style.Dialog));"> 430                 final AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getCont🔵</abbr>
<abbr title=" 431                 LinearLayout alertView = (LinearLayout) requireActivity().getLayoutInflater().inflate(R.layout.edit_tag, null);"> 431                 LinearLayout alertView = (LinearLayout) requireActivity().getLayoutInflater().inflate(R.l🔵</abbr>
 432 
 433                 final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObject();
 434 
 435                 final EditText tagNameEditText = alertView.findViewById(R.id.tag_name_edit);
 436                 tagNameEditText.setText(tag.getName());
 437                 tagNameEditText.setSelection(tagNameEditText.length());
 438                 alert.setView(alertView);
 439                 alert.setTitle(R.string.rename_tag);
 440                 alert.setPositiveButton(R.string.save, new DialogInterface.OnClickListener() {
 441                     public void onClick(DialogInterface dialog, int whichButton) {
 442                         String value = tagNameEditText.getText().toString().trim();
 443                         try {
 444                             tag.renameTo(value, mNotesBucket);
 445                             AnalyticsTracker.track(
 446                                     AnalyticsTracker.Stat.TAG_EDITOR_ACCESSED,
 447                                     AnalyticsTracker.CATEGORY_TAG,
 448                                     &quot;tag_alert_edit_box&quot;
 449                             );
 450                         } catch (BucketObjectNameInvalid e) {
 451                             android.util.Log.e(Simplenote.TAG, &quot;Unable to rename tag&quot;, e);
 452                             // TODO: show user a message that new tag name is not ok
 453                         }
 454                     }
 455                 });
 456                 alert.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {
 457                     public void onClick(DialogInterface dialog, int whichButton) {
 458                         // Do nothing
 459                     }
 460                 });
 461                 alert.show();
 462             }
 463 
 464             private void deleteTag(Tag tag) {
 465                 tag.delete();
<abbr title=" 466                 new RemoveTagFromNotesTask(TagsListFragment.this).executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, tag);"> 466                 new RemoveTagFromNotesTask(TagsListFragment.this).executeOnExecutor(AsyncTask.THREAD_POOL🔵</abbr>
 467                 AnalyticsTracker.track(
 468                         AnalyticsTracker.Stat.TAG_MENU_DELETED,
 469                         AnalyticsTracker.CATEGORY_TAG,
 470                         &quot;list_trash_button&quot;
 471                 );
 472             }
 473         }
 474 
 475         private TagsAdapter() {
 476             super(null);
 477         }
 478 
 479         @NonNull
 480         @Override
 481         public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
 482             Context context = parent.getContext();
 483             LayoutInflater inflater = LayoutInflater.from(context);
 484             View contactView = inflater.inflate(R.layout.tags_list_row, parent, false);
 485             return new ViewHolder(contactView);
 486         }
 487 
 488         @Override
 489         public void onBindViewHolder(@NonNull ViewHolder holder, Cursor cursor) {
 490             Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;)cursor).getObject();
 491             holder.tagTitle.setText(tag.getName());
<abbr title=" 492             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).count();"> 492             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.ge🔵</abbr>
 493 
 494             if (tagCount &gt; 0) {
 495                 holder.tagCountTextView.setText(String.valueOf(tagCount));
 496             } else {
 497                 holder.tagCountTextView.setText(&quot;&quot;);
 498             }
 499         }
 500 
 501         @Override
 502         public void swapCursor(Cursor newCursor) {
 503             super.swapCursor(newCursor);
 504         }
 505     }
 506 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 package com.automattic.simplenote;
   2 
   3 import android.content.Context;
   4 import android.content.DialogInterface;
   5 import android.database.Cursor;
   6 import android.os.AsyncTask;
   7 import android.os.Bundle;
   8 import android.view.HapticFeedbackConstants;
   9 import android.view.LayoutInflater;
  10 import android.view.MenuItem;
  11 import android.view.View;
  12 import android.view.ViewGroup;
  13 import android.widget.EditText;
  14 import android.widget.ImageButton;
  15 import android.widget.ImageView;
  16 import android.widget.LinearLayout;
  17 import android.widget.TextView;
  18 import android.widget.Toast;
  19 import androidx.annotation.DrawableRes;
  20 import androidx.annotation.NonNull;
  21 import androidx.annotation.Nullable;
  22 import androidx.appcompat.app.AlertDialog;
  23 import androidx.appcompat.view.ContextThemeWrapper;
  24 import androidx.appcompat.widget.SearchView;
  25 import androidx.fragment.app.Fragment;
  26 import androidx.recyclerview.widget.LinearLayoutManager;
  27 import androidx.recyclerview.widget.RecyclerView;
  28 import com.automattic.simplenote.analytics.AnalyticsTracker;
  29 import com.automattic.simplenote.models.Note;
  30 import com.automattic.simplenote.models.Tag;
  31 import com.automattic.simplenote.utils.BaseCursorAdapter;
  32 import com.automattic.simplenote.utils.DisplayUtils;
  33 import com.automattic.simplenote.utils.DrawableUtils;
  34 import com.automattic.simplenote.utils.HtmlCompat;
  35 import com.automattic.simplenote.widgets.EmptyViewRecyclerView;
  36 import com.simperium.client.Bucket;
  37 import com.simperium.client.BucketObjectNameInvalid;
  38 import com.simperium.client.Query;
  39 import java.lang.ref.SoftReference;
  40 import java.util.List;
  41 import static com.automattic.simplenote.models.Tag.NAME_PROPERTY;
  42 
  43 
  44 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  45 public class TagsListFragment extends Fragment implements Bucket.Listener&lt;Tag&gt; {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  46 </span>
  47 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  48 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">  48 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
  49 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51 public class TagsListFragment extends Fragment implements ActionMode.Callback, Bucket.Listener&lt;Tag&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52     private ActionMode mActionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53     private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54 </span>
  55 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
  56     private Bucket&lt;Note&gt; mNotesBucket;
  57 
  58 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  59     private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60 </span>
  61 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  62 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">  62 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
  63 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65     private EmptyViewRecyclerView mTagsList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66     private ImageView mEmptyViewImage;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67     private MenuItem mSearchMenuItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68     private String mSearchQuery;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69 </span>
  70 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
  71     private TagsAdapter mTagsAdapter;
  72     private TextView mEmptyViewText;
  73     private boolean mIsSearching;
  74 
  75     /**
  76      * Mandatory empty constructor for the fragment manager to instantiate the
  77      * fragment (e.g. upon screen orientation changes).
  78      */
  79     public TagsListFragment() {
  80     }
  81 
  82     @Override
  83     public void onCreate(@Nullable Bundle savedInstanceState) {
  84         super.onCreate(savedInstanceState);
  85         setHasOptionsMenu(true);
  86     }
  87 
  88     @Override
  89     public void onCreateOptionsMenu(@NonNull Menu menu, @NonNull MenuInflater inflater) {
  90         super.onCreateOptionsMenu(menu, inflater);
  91         inflater.inflate(R.menu.tags_list, menu);
  92         DrawableUtils.tintMenuWithAttribute(getActivity(), menu, R.attr.toolbarIconColor);
  93 
  94         mSearchMenuItem = menu.findItem(R.id.menu_search);
  95         mSearchMenuItem.setOnActionExpandListener(
  96             new MenuItem.OnActionExpandListener() {
  97                 @Override
  98                 public boolean onMenuItemActionCollapse(MenuItem item) {
  99                     mIsSearching = false;
 100                     return true;
 101                 }
 102 
 103                 @Override
 104                 public boolean onMenuItemActionExpand(MenuItem item) {
 105                     mIsSearching = true;
 106                     return true;
 107                 }
 108             }
 109         );
 110         SearchView searchView = (SearchView) mSearchMenuItem.getActionView();
 111         LinearLayout searchEditFrame = searchView.findViewById(R.id.search_edit_frame);
 112         ((LinearLayout.LayoutParams) searchEditFrame.getLayoutParams()).leftMargin = 0;
 113 
 114         // Workaround for setting the search placeholder text color.
 115         @SuppressWarnings(&quot;ResourceType&quot;)
 116         String hintHexColor = getString(R.color.text_title_disabled).replace(&quot;ff&quot;, &quot;&quot;);
 117         searchView.setQueryHint(
 118             HtmlCompat.fromHtml(
 119                 String.format(
 120                     &quot;&lt;font color=\&quot;%s\&quot;&gt;%s&lt;/font&gt;&quot;,
 121                     hintHexColor,
 122                     getString(R.string.search_tags)
 123                 )
 124             )
 125         );
 126 
 127         searchView.setOnQueryTextListener(
 128             new SearchView.OnQueryTextListener() {
 129                 @Override
 130                 public boolean onQueryTextChange(String query) {
 131                     if (mSearchMenuItem.isActionViewExpanded()) {
 132                         mSearchQuery = query;
 133                         refreshTagsSearch();
 134                         mTagsList.scrollToPosition(0);
 135                         checkEmptyList();
 136                     }
 137 
 138                     return true;
 139                 }
 140 
 141                 @Override
 142                 public boolean onQueryTextSubmit(String queryText) {
 143                     return true;
 144                 }
 145             }
 146         );
 147 
 148         searchView.setOnCloseListener(
 149             new SearchView.OnCloseListener() {
 150                 @Override
 151                 public boolean onClose() {
 152                     mIsSearching = false;
 153                     mSearchQuery = &quot;&quot;;
 154                     refreshTags();
 155                     mTagsList.scrollToPosition(0);
 156                     checkEmptyList();
 157                     return false;
 158                 }
 159             }
 160         );
 161     }
 162 
 163     @Override
<abbr title=" 164     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {"> 164     public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceS🔵</abbr>
 165         return inflater.inflate(R.layout.fragment_tags_list, container, false);
 166     }
 167 
 168     @Override
 169     public void onActivityCreated(Bundle savedInstanceState) {
 170         super.onActivityCreated(savedInstanceState);
 171 
 172         setHasOptionsMenu(true);
 173 
 174         Simplenote application = (Simplenote) requireActivity().getApplication();
 175         mTagsBucket = application.getTagsBucket();
 176         mNotesBucket = application.getNotesBucket();
 177 
 178 
 179 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180         EmptyViewRecyclerView recyclerView = requireActivity().findViewById(R.id.list);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 181 </span>
 182 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 183 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 183 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
 184 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186         mTagsList = getActivity().findViewById(R.id.list);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187 </span>
 188 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 189         mTagsAdapter = new TagsAdapter();
 190 
 191 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 192         recyclerView.setAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 193         recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 194         View emptyView = requireActivity().findViewById(R.id.empty);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 195         ImageView emptyViewImage = emptyView.findViewById(R.id.image);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 196         emptyViewImage.setImageResource(R.drawable.ic_tag_24dp);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 197         TextView emptyViewText = emptyView.findViewById(R.id.text);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 198         emptyViewText.setText(R.string.empty_tags);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 199         recyclerView.setEmptyView(emptyView);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 200 </span>
 201 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 202 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 202 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
 203 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205         mTagsList.setAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206         mTagsList.setLayoutManager(new LinearLayoutManager(getActivity()));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207         View emptyView = getActivity().findViewById(R.id.empty);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208         mEmptyViewImage = emptyView.findViewById(R.id.image);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209         mEmptyViewText = emptyView.findViewById(R.id.text);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210         checkEmptyList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211         mTagsList.setEmptyView(emptyView);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212 </span>
 213 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 214 
 215         refreshTags();
 216     }
 217 
 218     @Override
 219     public void onResume() {
 220         super.onResume();
 221 
 222         mNotesBucket.start();
 223         mTagsBucket.start();
 224 
 225         mTagsBucket.addOnNetworkChangeListener(this);
 226         mTagsBucket.addOnSaveObjectListener(this);
 227         mTagsBucket.addOnDeleteObjectListener(this);
 228     }
 229 
 230     @Override
 231     public void onPause() {
 232         super.onPause();
 233 
 234         mTagsBucket.removeOnNetworkChangeListener(this);
 235         mTagsBucket.removeOnSaveObjectListener(this);
 236         mTagsBucket.removeOnDeleteObjectListener(this);
 237 
 238         mNotesBucket.stop();
 239         mTagsBucket.stop();
 240     }
 241 
 242     public void checkEmptyList() {
 243         if (mIsSearching) {
 244             if (DisplayUtils.isLandscape(getActivity()) &amp;&amp; !DisplayUtils.isLargeScreen(getActivity())) {
 245                 setEmptyListImage(-1);
 246                 setEmptyListMessage(getString(R.string.empty_tags_search));
 247             } else {
 248                 setEmptyListImage(R.drawable.ic_search_24dp);
 249                 setEmptyListMessage(getString(R.string.empty_tags_search));
 250             }
 251         } else {
 252             setEmptyListImage(R.drawable.ic_tag_24dp);
 253             setEmptyListMessage(getString(R.string.empty_tags));
 254         }
 255     }
 256 
 257     protected void refreshTags() {
<abbr title=" 258         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);"> 258         Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NA🔵</abbr>
 259         Bucket.ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();
 260         mTagsAdapter.swapCursor(cursor);
 261     }
 262 
 263 
 264 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 265 </span>
 266 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 267 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 267 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
 268 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270     protected void refreshTagsSearch() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271         Query&lt;Tag&gt; tags = Tag.all(mTagsBucket)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272             .where(NAME_PROPERTY, Query.ComparisonType.LIKE, &quot;%&quot; + mSearchQuery + &quot;%&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273             .orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274             .reorder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275         Bucket.ObjectCursor&lt;Tag&gt; cursor = tags.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276         mTagsAdapter.swapCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279     private void setEmptyListImage(@DrawableRes int image) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280         if (mEmptyViewImage != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281             if (image != -1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282                 mEmptyViewImage.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283                 mEmptyViewImage.setImageResource(image);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285                 mEmptyViewImage.setVisibility(View.GONE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290     private void setEmptyListMessage(String message) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291         if (mEmptyViewText != null &amp;&amp; message != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292             mEmptyViewText.setText(message);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296     // TODO: Finish bulk editing</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298     public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299         MenuInflater inflater = actionMode.getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300         inflater.inflate(R.menu.bulk_edit, menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301         mActionMode = actionMode;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302         return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 303     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306     public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311     public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312         if (menuItem.getItemId() == R.id.menu_trash) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313             actionMode.finish(); // Action picked, so close the CAB</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314             return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 319     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320     public void onDestroyActionMode(ActionMode actionMode) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 321         mActionMode = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 322     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 323 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 324 </span>
 325 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 326     @Override
 327     public boolean onOptionsItemSelected(MenuItem item) {
 328         if (item.getItemId() == android.R.id.home) {
 329             if (isAdded()) {
 330                 requireActivity().finish();
 331                 return true;
 332             }
 333         }
 334 
 335         return super.onOptionsItemSelected(item);
 336     }
 337 
 338     // Tag Bucket listeners
 339     @Override
 340     public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 341         if (isAdded()) {
 342             requireActivity().runOnUiThread(new Runnable() {
 343                 @Override
 344                 public void run() {
 345                     if (mIsSearching) {
 346                         refreshTagsSearch();
 347                     } else {
 348                         refreshTags();
 349                     }
 350                 }
 351             });
 352         }
 353     }
 354 
 355     @Override
 356     public void onNetworkChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {
 357         if (isAdded()) {
 358             requireActivity().runOnUiThread(new Runnable() {
 359                 @Override
 360                 public void run() {
 361                     if (mIsSearching) {
 362                         refreshTagsSearch();
 363                     } else {
 364                         refreshTags();
 365                     }
 366                 }
 367             });
 368         }
 369     }
 370 
 371     @Override
 372     public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 373         if (isAdded()) {
 374             requireActivity().runOnUiThread(new Runnable() {
 375                 @Override
 376                 public void run() {
 377                     if (mIsSearching) {
 378                         refreshTagsSearch();
 379                     } else {
 380                         refreshTags();
 381                     }
 382                 }
 383             });
 384         }
 385     }
 386 
 387     @Override
 388     public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 389         // noop
 390     }
 391 
 392     private static class RemoveTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {
 393         private SoftReference&lt;TagsListFragment&gt; mTagsListFragmentReference;
 394 
 395         private RemoveTagFromNotesTask(TagsListFragment context) {
 396             mTagsListFragmentReference = new SoftReference&lt;&gt;(context);
 397         }
 398 
 399         @Override
 400         protected Void doInBackground(Tag... removedTags) {
 401             TagsListFragment fragment = mTagsListFragmentReference.get();
 402             Tag tag = removedTags[0];
 403 
 404             if (tag != null) {
 405                 Bucket.ObjectCursor&lt;Note&gt; cursor = tag.findNotes(fragment.mNotesBucket);
 406 
 407                 while (cursor.moveToNext()) {
 408                     Note note = cursor.getObject();
 409                     List&lt;String&gt; tags = note.getTags();
 410                     tags.remove(tag.getName());
 411                     note.setTags(tags);
 412                     note.save();
 413                 }
 414 
 415                 cursor.close();
 416             }
 417 
 418             return null;
 419         }
 420     }
 421 
 422     private class TagsAdapter extends BaseCursorAdapter&lt;TagsAdapter.ViewHolder&gt; {
 423         public class ViewHolder extends RecyclerView.ViewHolder implements View.OnClickListener {
 424             private TextView tagTitle;
 425             private TextView tagCountTextView;
 426             private ImageButton deleteButton;
 427 
 428             private ViewHolder(View itemView) {
 429                 super(itemView);
 430 
 431                 tagTitle = itemView.findViewById(R.id.tag_name);
 432                 tagCountTextView = itemView.findViewById(R.id.tag_count);
 433                 deleteButton = itemView.findViewById(R.id.tag_trash);
 434 
 435                 deleteButton.setOnClickListener(new View.OnClickListener() {
 436                     @Override
 437                     public void onClick(View view) {
 438                         if (!isAdded() || !hasItem(getAdapterPosition())) {
 439                             return;
 440                         }
 441 
<abbr title=" 442                         final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObject();"> 442                         final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObj🔵</abbr>
<abbr title=" 443                         final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).count();"> 443                         final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUA🔵</abbr>
 444                         if (tagCount == 0) {
 445                             deleteTag(tag);
 446                         } else if (tagCount &gt; 0) {
<abbr title=" 447                             AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.style.Dialog));"> 447                             AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(g🔵</abbr>
 448                             alert.setTitle(R.string.delete_tag);
 449                             alert.setMessage(getString(R.string.confirm_delete_tag));
 450                             alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {
 451                                 public void onClick(DialogInterface dialog, int whichButton) {
 452                                     deleteTag(tag);
 453                                 }
 454                             });
 455                             alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {
 456                                 public void onClick(DialogInterface dialog, int whichButton) {
 457                                     // Do nothing, just closing the dialog
 458                                 }
 459                             });
 460                             alert.show();
 461                         }
 462                     }
 463                 });
 464                 deleteButton.setOnLongClickListener(new View.OnLongClickListener() {
 465                     @Override
 466                     public boolean onLongClick(View v) {
 467                         if (v.isHapticFeedbackEnabled()) {
 468                             v.performHapticFeedback(HapticFeedbackConstants.LONG_PRESS);
 469                         }
 470 
<abbr title=" 471                         Toast.makeText(getContext(), requireContext().getString(R.string.delete_tag), Toast.LENGTH_SHORT).show();"> 471                         Toast.makeText(getContext(), requireContext().getString(R.string.delete_tag), Toa🔵</abbr>
 472                         return true;
 473                     }
 474                 });
 475 
 476                 itemView.setOnClickListener(this);
 477             }
 478 
 479             @Override
 480             public void onClick(View view) {
 481                 if (!isAdded() || !hasItem(getAdapterPosition())) {
 482                     return;
 483                 }
 484 
<abbr title=" 485                 final AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.style.Dialog));"> 485                 final AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getCont🔵</abbr>
<abbr title=" 486                 LinearLayout alertView = (LinearLayout) requireActivity().getLayoutInflater().inflate(R.layout.edit_tag, null);"> 486                 LinearLayout alertView = (LinearLayout) requireActivity().getLayoutInflater().inflate(R.l🔵</abbr>
 487 
 488                 final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObject();
 489 
 490                 final EditText tagNameEditText = alertView.findViewById(R.id.tag_name_edit);
 491                 tagNameEditText.setText(tag.getName());
 492                 tagNameEditText.setSelection(tagNameEditText.length());
 493                 alert.setView(alertView);
 494                 alert.setTitle(R.string.rename_tag);
 495                 alert.setPositiveButton(R.string.save, new DialogInterface.OnClickListener() {
 496                     public void onClick(DialogInterface dialog, int whichButton) {
 497                         String value = tagNameEditText.getText().toString().trim();
 498                         try {
 499                             tag.renameTo(value, mNotesBucket);
 500                             AnalyticsTracker.track(
 501                                     AnalyticsTracker.Stat.TAG_EDITOR_ACCESSED,
 502                                     AnalyticsTracker.CATEGORY_TAG,
 503                                     &quot;tag_alert_edit_box&quot;
 504                             );
 505                         } catch (BucketObjectNameInvalid e) {
 506                             android.util.Log.e(Simplenote.TAG, &quot;Unable to rename tag&quot;, e);
 507                             // TODO: show user a message that new tag name is not ok
 508                         }
 509                     }
 510                 });
 511                 alert.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {
 512                     public void onClick(DialogInterface dialog, int whichButton) {
 513                         // Do nothing
 514                     }
 515                 });
 516                 alert.show();
 517             }
 518 
 519             private void deleteTag(Tag tag) {
 520                 tag.delete();
<abbr title=" 521                 new RemoveTagFromNotesTask(TagsListFragment.this).executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, tag);"> 521                 new RemoveTagFromNotesTask(TagsListFragment.this).executeOnExecutor(AsyncTask.THREAD_POOL🔵</abbr>
 522                 AnalyticsTracker.track(
 523                         AnalyticsTracker.Stat.TAG_MENU_DELETED,
 524                         AnalyticsTracker.CATEGORY_TAG,
 525                         &quot;list_trash_button&quot;
 526                 );
 527             }
 528         }
 529 
 530         private TagsAdapter() {
 531             super(null);
 532         }
 533 
 534         @NonNull
 535         @Override
 536         public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
 537             Context context = parent.getContext();
 538             LayoutInflater inflater = LayoutInflater.from(context);
 539             View contactView = inflater.inflate(R.layout.tags_list_row, parent, false);
 540             return new ViewHolder(contactView);
 541         }
 542 
 543         @Override
 544         public void onBindViewHolder(@NonNull ViewHolder holder, Cursor cursor) {
 545             Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;)cursor).getObject();
 546             holder.tagTitle.setText(tag.getName());
<abbr title=" 547             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).count();"> 547             final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.ge🔵</abbr>
 548 
 549             if (tagCount &gt; 0) {
 550                 holder.tagCountTextView.setText(String.valueOf(tagCount));
 551             } else {
 552                 holder.tagCountTextView.setText(&quot;&quot;);
 553             }
 554         }
 555 
 556         @Override
 557         public void swapCursor(Cursor newCursor) {
 558             super.swapCursor(newCursor);
 559         }
 560     }
 561 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  package com.automattic.simplenote;
   2  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   3 -import android.app.Fragment;</span>
   4  import android.content.Context;
   5  import android.content.DialogInterface;
   6  import android.database.Cursor;
   7  import android.os.AsyncTask;
   8  import android.os.Bundle;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   9 -import android.view.ActionMode;</span>
  10  import android.view.HapticFeedbackConstants;
  11  import android.view.LayoutInflater;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  12 -import android.view.Menu;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  13 -import android.view.MenuInflater;</span>
  14  import android.view.MenuItem;
  15  import android.view.View;
  16  import android.view.ViewGroup;
  17  import android.widget.EditText;
  18  import android.widget.ImageButton;
  19  import android.widget.ImageView;
  20  import android.widget.LinearLayout;
  21  import android.widget.TextView;
  22  import android.widget.Toast;
  23  

  24  import androidx.annotation.NonNull;

  25  import androidx.appcompat.app.AlertDialog;
  26  import androidx.appcompat.view.ContextThemeWrapper;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  27 +import androidx.fragment.app.Fragment;</span>
  28  import androidx.recyclerview.widget.LinearLayoutManager;
  29  import androidx.recyclerview.widget.RecyclerView;
  30  
  31  import com.automattic.simplenote.analytics.AnalyticsTracker;
  32  import com.automattic.simplenote.models.Note;
  33  import com.automattic.simplenote.models.Tag;
  34  import com.automattic.simplenote.utils.BaseCursorAdapter;



  35  import com.automattic.simplenote.widgets.EmptyViewRecyclerView;
  36  import com.simperium.client.Bucket;
  37  import com.simperium.client.BucketObjectNameInvalid;
  38  import com.simperium.client.Query;
  39  
  40  import java.lang.ref.SoftReference;
  41  import java.util.List;
  42  


<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 -public class TagsListFragment extends Fragment implements ActionMode.Callback, Bucket.Listener&lt;Tag&gt; {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 -    private ActionMode mActionMode;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +public class TagsListFragment extends Fragment implements Bucket.Listener&lt;Tag&gt; {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  47 +    private Bucket&lt;Note&gt; mNotesBucket;</span>
  48      private Bucket&lt;Tag&gt; mTagsBucket;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -    private Bucket&lt;Note&gt; mNotesBucket;</span>




  50      private TagsAdapter mTagsAdapter;


  51  
  52      /**
  53       * Mandatory empty constructor for the fragment manager to instantiate the
  54       * fragment (e.g. upon screen orientation changes).
  55       */
  56      public TagsListFragment() {
  57      }
  58  
  59      @Override

















































































  60      public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
  61          return inflater.inflate(R.layout.fragment_tags_list, container, false);
  62      }
  63  
  64      @Override
  65      public void onActivityCreated(Bundle savedInstanceState) {
  66          super.onActivityCreated(savedInstanceState);
  67  
  68          setHasOptionsMenu(true);
  69  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  70 -        Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +        Simplenote application = (Simplenote) requireActivity().getApplication();</span>
  72          mTagsBucket = application.getTagsBucket();
  73          mNotesBucket = application.getNotesBucket();
  74  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -        EmptyViewRecyclerView recyclerView = getActivity().findViewById(R.id.list);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +        EmptyViewRecyclerView recyclerView = requireActivity().findViewById(R.id.list);</span>
  77          mTagsAdapter = new TagsAdapter();
  78          recyclerView.setAdapter(mTagsAdapter);
  79          recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));


<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -        View emptyView = getActivity().findViewById(R.id.empty);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  81 +        View emptyView = requireActivity().findViewById(R.id.empty);</span>
  82          ImageView emptyViewImage = emptyView.findViewById(R.id.image);
  83          emptyViewImage.setImageResource(R.drawable.ic_tag_24dp);
  84          TextView emptyViewText = emptyView.findViewById(R.id.text);
  85          emptyViewText.setText(R.string.empty_tags);
  86          recyclerView.setEmptyView(emptyView);




  87  
  88          refreshTags();
  89      }
  90  
  91      @Override
  92      public void onResume() {
  93          super.onResume();
  94  
  95          mNotesBucket.start();
  96          mTagsBucket.start();
  97  
  98          mTagsBucket.addOnNetworkChangeListener(this);
  99          mTagsBucket.addOnSaveObjectListener(this);
 100          mTagsBucket.addOnDeleteObjectListener(this);
 101      }
 102  
 103      @Override
 104      public void onPause() {
 105          super.onPause();
 106  
 107          mTagsBucket.removeOnNetworkChangeListener(this);
 108          mTagsBucket.removeOnSaveObjectListener(this);
 109          mTagsBucket.removeOnDeleteObjectListener(this);
 110  
 111          mNotesBucket.stop();
 112          mTagsBucket.stop();















 113      }
 114  
 115      protected void refreshTags() {
 116          Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);
 117          Bucket.ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();
 118          mTagsAdapter.swapCursor(cursor);


























 119      }
 120  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -    // TODO: Finish bulk editing</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 123 -    public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 124 -        MenuInflater inflater = actionMode.getMenuInflater();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -        inflater.inflate(R.menu.bulk_edit, menu);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 126 -        mActionMode = actionMode;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 127 -        return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 128 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 129 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 130 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 131 -    public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 132 -        return false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 133 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 134 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 135 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 136 -    public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 137 -        if (menuItem.getItemId() == R.id.menu_trash) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 138 -            actionMode.finish(); // Action picked, so close the CAB</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 139 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 140 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 141 -        return false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 142 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 143 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 144 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 145 -    public void onDestroyActionMode(ActionMode actionMode) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 146 -        mActionMode = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 147 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 148 -</span>
 149      @Override
 150      public boolean onOptionsItemSelected(MenuItem item) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 151 -</span>
 152          if (item.getItemId() == android.R.id.home) {
 153              if (isAdded()) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 154 -                getActivity().finish();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +                requireActivity().finish();</span>
 156                  return true;
 157              }
 158          }
 159  
 160          return super.onOptionsItemSelected(item);
 161      }
 162  
 163      // Tag Bucket listeners
 164      @Override
 165      public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 166          if (isAdded()) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -            getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +            requireActivity().runOnUiThread(new Runnable() {</span>
 169                  @Override
 170                  public void run() {
 171                      refreshTags();





 172                  }
 173              });
 174          }
 175      }
 176  
 177      @Override
 178      public void onNetworkChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {
 179          if (isAdded()) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 180 -            getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +            requireActivity().runOnUiThread(new Runnable() {</span>
 182                  @Override
 183                  public void run() {
 184                      refreshTags();





 185                  }
 186              });
 187          }
 188      }
 189  
 190      @Override
 191      public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 192          if (isAdded()) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 193 -            getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +            requireActivity().runOnUiThread(new Runnable() {</span>
 195                  @Override
 196                  public void run() {
 197                      refreshTags();





 198                  }
 199              });
 200          }
 201      }
 202  
 203      @Override
 204      public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 205          // noop
 206      }
 207  
 208      private static class RemoveTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {
 209          private SoftReference&lt;TagsListFragment&gt; mTagsListFragmentReference;
 210  
 211          private RemoveTagFromNotesTask(TagsListFragment context) {
 212              mTagsListFragmentReference = new SoftReference&lt;&gt;(context);
 213          }
 214  
 215          @Override
 216          protected Void doInBackground(Tag... removedTags) {
 217              TagsListFragment fragment = mTagsListFragmentReference.get();
 218              Tag tag = removedTags[0];
 219  
 220              if (tag != null) {
 221                  Bucket.ObjectCursor&lt;Note&gt; cursor = tag.findNotes(fragment.mNotesBucket);
 222  
 223                  while (cursor.moveToNext()) {
 224                      Note note = cursor.getObject();
 225                      List&lt;String&gt; tags = note.getTags();
 226                      tags.remove(tag.getName());
 227                      note.setTags(tags);
 228                      note.save();
 229                  }
 230  
 231                  cursor.close();
 232              }
 233  
 234              return null;
 235          }
 236      }
 237  
 238      private class TagsAdapter extends BaseCursorAdapter&lt;TagsAdapter.ViewHolder&gt; {
 239  
 240          public class ViewHolder extends RecyclerView.ViewHolder implements View.OnClickListener {
 241  
 242              private TextView tagTitle;
 243              private TextView tagCountTextView;
 244              private ImageButton deleteButton;
 245  
 246              private ViewHolder(View itemView) {
 247                  super(itemView);
 248  
 249                  tagTitle = itemView.findViewById(R.id.tag_name);
 250                  tagCountTextView = itemView.findViewById(R.id.tag_count);
 251                  deleteButton = itemView.findViewById(R.id.tag_trash);
 252  
 253                  deleteButton.setOnClickListener(new View.OnClickListener() {
 254                      @Override
 255                      public void onClick(View view) {
 256                          if (!isAdded() || !hasItem(getAdapterPosition())) {
 257                              return;
 258                          }
 259  
 260                          final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObject();
<abbr title=" 261                          final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).count();"> 261                          final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag🔵</abbr>
 262                          if (tagCount == 0) {
 263                              deleteTag(tag);
 264                          } else if (tagCount &gt; 0) {
<abbr title=" 265                              AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.style.Dialog));"> 265                              AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext🔵</abbr>
 266                              alert.setTitle(R.string.delete_tag);
 267                              alert.setMessage(getString(R.string.confirm_delete_tag));
 268                              alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {
 269                                  public void onClick(DialogInterface dialog, int whichButton) {
 270                                      deleteTag(tag);
 271                                  }
 272                              });
 273                              alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {
 274                                  public void onClick(DialogInterface dialog, int whichButton) {
 275                                      // Do nothing, just closing the dialog
 276                                  }
 277                              });
 278                              alert.show();
 279                          }
 280                      }
 281                  });
 282                  deleteButton.setOnLongClickListener(new View.OnLongClickListener() {
 283                      @Override
 284                      public boolean onLongClick(View v) {
 285                          if (v.isHapticFeedbackEnabled()) {
 286                              v.performHapticFeedback(HapticFeedbackConstants.LONG_PRESS);
 287                          }
 288  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 289 -                        Toast.makeText(getContext(), getContext().getString(R.string.delete_tag), Toast.LENGTH_SHORT).show();"> 289 -                        Toast.makeText(getContext(), getContext().getString(R.string.delete_tag), Toast.LENGTH_SHO🔵</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 290 +                        Toast.makeText(getContext(), requireContext().getString(R.string.delete_tag), Toast.LENGTH_SHORT).show();"> 290 +                        Toast.makeText(getContext(), requireContext().getString(R.string.delete_tag), Toast.LENGTH🔵</abbr></span>
 291                          return true;
 292                      }
 293                  });
 294  
 295                  itemView.setOnClickListener(this);
 296              }
 297  
 298              @Override
 299              public void onClick(View view) {
 300                  if (!isAdded() || !hasItem(getAdapterPosition())) {
 301                      return;
 302                  }
 303  
<abbr title=" 304                  final AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.style.Dialog));"> 304                  final AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.🔵</abbr>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 305 -                LinearLayout alertView = (LinearLayout) getActivity().getLayoutInflater().inflate(R.layout.edit_tag, null);"> 305 -                LinearLayout alertView = (LinearLayout) getActivity().getLayoutInflater().inflate(R.layout.edit_ta🔵</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 306 +                LinearLayout alertView = (LinearLayout) requireActivity().getLayoutInflater().inflate(R.layout.edit_tag, null);"> 306 +                LinearLayout alertView = (LinearLayout) requireActivity().getLayoutInflater().inflate(R.layout.edi🔵</abbr></span>
 307  
 308                  final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObject();
 309  
 310                  final EditText tagNameEditText = alertView.findViewById(R.id.tag_name_edit);
 311                  tagNameEditText.setText(tag.getName());
 312                  tagNameEditText.setSelection(tagNameEditText.length());
 313                  alert.setView(alertView);
 314                  alert.setTitle(R.string.rename_tag);
 315                  alert.setPositiveButton(R.string.save, new DialogInterface.OnClickListener() {
 316                      public void onClick(DialogInterface dialog, int whichButton) {
 317                          String value = tagNameEditText.getText().toString().trim();
 318                          try {
 319                              tag.renameTo(value, mNotesBucket);
 320                              AnalyticsTracker.track(
 321                                      AnalyticsTracker.Stat.TAG_EDITOR_ACCESSED,
 322                                      AnalyticsTracker.CATEGORY_TAG,
 323                                      &quot;tag_alert_edit_box&quot;
 324                              );
 325                          } catch (BucketObjectNameInvalid e) {
 326                              android.util.Log.e(Simplenote.TAG, &quot;Unable to rename tag&quot;, e);
 327                              // TODO: show user a message that new tag name is not ok
 328                          }
 329                      }
 330                  });
 331                  alert.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {
 332                      public void onClick(DialogInterface dialog, int whichButton) {
 333                          // Do nothing
 334                      }
 335                  });
 336                  alert.show();
 337              }
 338  
 339              private void deleteTag(Tag tag) {
 340                  tag.delete();
<abbr title=" 341                  new RemoveTagFromNotesTask(TagsListFragment.this).executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, tag);"> 341                  new RemoveTagFromNotesTask(TagsListFragment.this).executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR🔵</abbr>
 342                  AnalyticsTracker.track(
 343                          AnalyticsTracker.Stat.TAG_MENU_DELETED,
 344                          AnalyticsTracker.CATEGORY_TAG,
 345                          &quot;list_trash_button&quot;
 346                  );
 347              }
 348          }
 349  
 350          private TagsAdapter() {
 351              super(null);
 352          }
 353  
 354          @NonNull
 355          @Override
 356          public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
 357              Context context = parent.getContext();
 358              LayoutInflater inflater = LayoutInflater.from(context);
 359  
 360              View contactView = inflater.inflate(R.layout.tags_list_row, parent, false);
 361  
 362              return new ViewHolder(contactView);
 363          }
 364  
 365          @Override
 366          public void onBindViewHolder(@NonNull ViewHolder holder, Cursor cursor) {
 367              Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;)cursor).getObject();
 368  
 369              holder.tagTitle.setText(tag.getName());
<abbr title=" 370              final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).count();"> 370              final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).🔵</abbr>

 371              if (tagCount &gt; 0) {
 372                  holder.tagCountTextView.setText(String.valueOf(tagCount));
 373              } else {
 374                  holder.tagCountTextView.setText(&quot;&quot;);
 375              }
 376          }
 377  
 378          @Override
 379          public void swapCursor(Cursor newCursor) {
 380              super.swapCursor(newCursor);
 381          }
 382      }
 383  }</pre></td>
                            <td><pre>   1  package com.automattic.simplenote;
   2  
   3  import android.app.Fragment;
   4  import android.content.Context;
   5  import android.content.DialogInterface;
   6  import android.database.Cursor;
   7  import android.os.AsyncTask;
   8  import android.os.Bundle;
   9  import android.view.ActionMode;
  10  import android.view.HapticFeedbackConstants;
  11  import android.view.LayoutInflater;
  12  import android.view.Menu;
  13  import android.view.MenuInflater;
  14  import android.view.MenuItem;
  15  import android.view.View;
  16  import android.view.ViewGroup;
  17  import android.widget.EditText;
  18  import android.widget.ImageButton;
  19  import android.widget.ImageView;
  20  import android.widget.LinearLayout;
  21  import android.widget.TextView;
  22  import android.widget.Toast;
  23  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  24 +import androidx.annotation.DrawableRes;</span>
  25  import androidx.annotation.NonNull;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  26 +import androidx.annotation.Nullable;</span>
  27  import androidx.appcompat.app.AlertDialog;
  28  import androidx.appcompat.view.ContextThemeWrapper;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import androidx.appcompat.widget.SearchView;</span>
  30  import androidx.recyclerview.widget.LinearLayoutManager;
  31  import androidx.recyclerview.widget.RecyclerView;
  32  
  33  import com.automattic.simplenote.analytics.AnalyticsTracker;
  34  import com.automattic.simplenote.models.Note;
  35  import com.automattic.simplenote.models.Tag;
  36  import com.automattic.simplenote.utils.BaseCursorAdapter;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +import com.automattic.simplenote.utils.DisplayUtils;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  38 +import com.automattic.simplenote.utils.DrawableUtils;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  39 +import com.automattic.simplenote.utils.HtmlCompat;</span>
  40  import com.automattic.simplenote.widgets.EmptyViewRecyclerView;
  41  import com.simperium.client.Bucket;
  42  import com.simperium.client.BucketObjectNameInvalid;
  43  import com.simperium.client.Query;
  44  
  45  import java.lang.ref.SoftReference;
  46  import java.util.List;
  47  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +import static com.automattic.simplenote.models.Tag.NAME_PROPERTY;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +</span>
  50  public class TagsListFragment extends Fragment implements ActionMode.Callback, Bucket.Listener&lt;Tag&gt; {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -</span>
  52      private ActionMode mActionMode;


  53      private Bucket&lt;Tag&gt; mTagsBucket;
  54      private Bucket&lt;Note&gt; mNotesBucket;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  55 +    private EmptyViewRecyclerView mTagsList;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  56 +    private ImageView mEmptyViewImage;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  57 +    private MenuItem mSearchMenuItem;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +    private String mSearchQuery;</span>
  59      private TagsAdapter mTagsAdapter;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +    private TextView mEmptyViewText;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +    private boolean mIsSearching;</span>
  62  
  63      /**
  64       * Mandatory empty constructor for the fragment manager to instantiate the
  65       * fragment (e.g. upon screen orientation changes).
  66       */
  67      public TagsListFragment() {
  68      }
  69  
  70      @Override
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +    public void onCreate(@Nullable Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +        super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +        setHasOptionsMenu(true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  75 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  77 +    public void onCreateOptionsMenu(@NonNull Menu menu, @NonNull MenuInflater inflater) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  78 +        super.onCreateOptionsMenu(menu, inflater);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  79 +        inflater.inflate(R.menu.tags_list, menu);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  80 +        DrawableUtils.tintMenuWithAttribute(getActivity(), menu, R.attr.toolbarIconColor);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  81 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +        mSearchMenuItem = menu.findItem(R.id.menu_search);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +        mSearchMenuItem.setOnActionExpandListener(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  84 +            new MenuItem.OnActionExpandListener() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +                @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  86 +                public boolean onMenuItemActionCollapse(MenuItem item) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +                    mIsSearching = false;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +                    return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  89 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +                @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +                public boolean onMenuItemActionExpand(MenuItem item) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  93 +                    mIsSearching = true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  94 +                    return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  95 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +        );</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +        SearchView searchView = (SearchView) mSearchMenuItem.getActionView();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +        LinearLayout searchEditFrame = searchView.findViewById(R.id.search_edit_frame);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +        ((LinearLayout.LayoutParams) searchEditFrame.getLayoutParams()).leftMargin = 0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +        // Workaround for setting the search placeholder text color.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +        @SuppressWarnings(&quot;ResourceType&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +        String hintHexColor = getString(R.color.text_title_disabled).replace(&quot;ff&quot;, &quot;&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +        searchView.setQueryHint(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +            HtmlCompat.fromHtml(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +                String.format(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +                    &quot;&lt;font color=\&quot;%s\&quot;&gt;%s&lt;/font&gt;&quot;,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +                    hintHexColor,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +                    getString(R.string.search_tags)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +                )</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 112 +            )</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +        );</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +        searchView.setOnQueryTextListener(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +            new SearchView.OnQueryTextListener() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +                @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +                public boolean onQueryTextChange(String query) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +                    if (mSearchMenuItem.isActionViewExpanded()) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +                        mSearchQuery = query;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +                        refreshTagsSearch();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +                        mTagsList.scrollToPosition(0);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +                        checkEmptyList();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +                    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +                    return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +                @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +                public boolean onQueryTextSubmit(String queryText) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +                    return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 134 +        );</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 135 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 136 +        searchView.setOnCloseListener(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +            new SearchView.OnCloseListener() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +                @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 139 +                public boolean onClose() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +                    mIsSearching = false;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +                    mSearchQuery = &quot;&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +                    refreshTags();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +                    mTagsList.scrollToPosition(0);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +                    checkEmptyList();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +                    return false;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +        );</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +    @Override</span>
 152      public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
 153          return inflater.inflate(R.layout.fragment_tags_list, container, false);
 154      }
 155  
 156      @Override
 157      public void onActivityCreated(Bundle savedInstanceState) {
 158          super.onActivityCreated(savedInstanceState);
 159  
 160          setHasOptionsMenu(true);
 161  
 162          Simplenote application = (Simplenote) getActivity().getApplication();

 163          mTagsBucket = application.getTagsBucket();
 164          mNotesBucket = application.getNotesBucket();
 165  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 166 -        EmptyViewRecyclerView recyclerView = getActivity().findViewById(R.id.list);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +        mTagsList = getActivity().findViewById(R.id.list);</span>
 168          mTagsAdapter = new TagsAdapter();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 169 -        recyclerView.setAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 170 -        recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +        mTagsList.setAdapter(mTagsAdapter);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +        mTagsList.setLayoutManager(new LinearLayoutManager(getActivity()));</span>
 173          View emptyView = getActivity().findViewById(R.id.empty);

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 174 -        ImageView emptyViewImage = emptyView.findViewById(R.id.image);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 175 -        emptyViewImage.setImageResource(R.drawable.ic_tag_24dp);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 176 -        TextView emptyViewText = emptyView.findViewById(R.id.text);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 177 -        emptyViewText.setText(R.string.empty_tags);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 178 -        recyclerView.setEmptyView(emptyView);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +        mEmptyViewImage = emptyView.findViewById(R.id.image);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +        mEmptyViewText = emptyView.findViewById(R.id.text);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +        checkEmptyList();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +        mTagsList.setEmptyView(emptyView);</span>
 183  
 184          refreshTags();
 185      }
 186  
 187      @Override
 188      public void onResume() {
 189          super.onResume();
 190  
 191          mNotesBucket.start();
 192          mTagsBucket.start();
 193  
 194          mTagsBucket.addOnNetworkChangeListener(this);
 195          mTagsBucket.addOnSaveObjectListener(this);
 196          mTagsBucket.addOnDeleteObjectListener(this);
 197      }
 198  
 199      @Override
 200      public void onPause() {
 201          super.onPause();
 202  
 203          mTagsBucket.removeOnNetworkChangeListener(this);
 204          mTagsBucket.removeOnSaveObjectListener(this);
 205          mTagsBucket.removeOnDeleteObjectListener(this);
 206  
 207          mNotesBucket.stop();
 208          mTagsBucket.stop();
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +    public void checkEmptyList() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +        if (mIsSearching) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +            if (DisplayUtils.isLandscape(getActivity()) &amp;&amp; !DisplayUtils.isLargeScreen(getActivity())) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +                setEmptyListImage(-1);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +                setEmptyListMessage(getString(R.string.empty_tags_search));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +            } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 217 +                setEmptyListImage(R.drawable.ic_search_24dp);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 218 +                setEmptyListMessage(getString(R.string.empty_tags_search));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 219 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +        } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +            setEmptyListImage(R.drawable.ic_tag_24dp);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +            setEmptyListMessage(getString(R.string.empty_tags));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +        }</span>
 224      }
 225  
 226      protected void refreshTags() {
 227          Query&lt;Tag&gt; tagQuery = Tag.all(mTagsBucket).reorder().orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME);
 228          Bucket.ObjectCursor&lt;Tag&gt; cursor = tagQuery.execute();
 229          mTagsAdapter.swapCursor(cursor);
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +    protected void refreshTagsSearch() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 233 +        Query&lt;Tag&gt; tags = Tag.all(mTagsBucket)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 234 +            .where(NAME_PROPERTY, Query.ComparisonType.LIKE, &quot;%&quot; + mSearchQuery + &quot;%&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +            .orderByKey().include(Tag.NOTE_COUNT_INDEX_NAME)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +            .reorder();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +        Bucket.ObjectCursor&lt;Tag&gt; cursor = tags.execute();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +        mTagsAdapter.swapCursor(cursor);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +    private void setEmptyListImage(@DrawableRes int image) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +        if (mEmptyViewImage != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +            if (image != -1) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +                mEmptyViewImage.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +                mEmptyViewImage.setImageResource(image);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +            } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +                mEmptyViewImage.setVisibility(View.GONE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +    private void setEmptyListMessage(String message) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +        if (mEmptyViewText != null &amp;&amp; message != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +            mEmptyViewText.setText(message);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +        }</span>
 256      }
 257  
 258      // TODO: Finish bulk editing
 259      @Override
 260      public boolean onCreateActionMode(ActionMode actionMode, Menu menu) {
 261          MenuInflater inflater = actionMode.getMenuInflater();
 262          inflater.inflate(R.menu.bulk_edit, menu);
 263          mActionMode = actionMode;
 264          return true;
 265      }
 266  
 267      @Override
 268      public boolean onPrepareActionMode(ActionMode actionMode, Menu menu) {
 269          return false;
 270      }
 271  
 272      @Override
 273      public boolean onActionItemClicked(ActionMode actionMode, MenuItem menuItem) {
 274          if (menuItem.getItemId() == R.id.menu_trash) {
 275              actionMode.finish(); // Action picked, so close the CAB
 276              return true;
 277          }
 278          return false;
 279      }
 280  
 281      @Override
 282      public void onDestroyActionMode(ActionMode actionMode) {
 283          mActionMode = null;
 284      }
 285  
 286      @Override
 287      public boolean onOptionsItemSelected(MenuItem item) {
 288  
 289          if (item.getItemId() == android.R.id.home) {
 290              if (isAdded()) {
 291                  getActivity().finish();

 292                  return true;
 293              }
 294          }
 295  
 296          return super.onOptionsItemSelected(item);
 297      }
 298  
 299      // Tag Bucket listeners
 300      @Override
 301      public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 302          if (isAdded()) {
 303              getActivity().runOnUiThread(new Runnable() {

 304                  @Override
 305                  public void run() {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 306 -                    refreshTags();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 307 +                    if (mIsSearching) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 308 +                        refreshTagsSearch();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 309 +                    } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 310 +                        refreshTags();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 311 +                    }</span>
 312                  }
 313              });
 314          }
 315      }
 316  
 317      @Override
 318      public void onNetworkChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key) {
 319          if (isAdded()) {
 320              getActivity().runOnUiThread(new Runnable() {

 321                  @Override
 322                  public void run() {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 323 -                    refreshTags();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 324 +                    if (mIsSearching) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 325 +                        refreshTagsSearch();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 326 +                    } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 327 +                        refreshTags();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 328 +                    }</span>
 329                  }
 330              });
 331          }
 332      }
 333  
 334      @Override
 335      public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 336          if (isAdded()) {
 337              getActivity().runOnUiThread(new Runnable() {

 338                  @Override
 339                  public void run() {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 340 -                    refreshTags();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +                    if (mIsSearching) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 342 +                        refreshTagsSearch();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +                    } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 344 +                        refreshTags();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 345 +                    }</span>
 346                  }
 347              });
 348          }
 349      }
 350  
 351      @Override
 352      public void onBeforeUpdateObject(Bucket&lt;Tag&gt; bucket, Tag object) {
 353          // noop
 354      }
 355  
 356      private static class RemoveTagFromNotesTask extends AsyncTask&lt;Tag, Void, Void&gt; {
 357          private SoftReference&lt;TagsListFragment&gt; mTagsListFragmentReference;
 358  
 359          private RemoveTagFromNotesTask(TagsListFragment context) {
 360              mTagsListFragmentReference = new SoftReference&lt;&gt;(context);
 361          }
 362  
 363          @Override
 364          protected Void doInBackground(Tag... removedTags) {
 365              TagsListFragment fragment = mTagsListFragmentReference.get();
 366              Tag tag = removedTags[0];
 367  
 368              if (tag != null) {
 369                  Bucket.ObjectCursor&lt;Note&gt; cursor = tag.findNotes(fragment.mNotesBucket);
 370  
 371                  while (cursor.moveToNext()) {
 372                      Note note = cursor.getObject();
 373                      List&lt;String&gt; tags = note.getTags();
 374                      tags.remove(tag.getName());
 375                      note.setTags(tags);
 376                      note.save();
 377                  }
 378  
 379                  cursor.close();
 380              }
 381  
 382              return null;
 383          }
 384      }
 385  
 386      private class TagsAdapter extends BaseCursorAdapter&lt;TagsAdapter.ViewHolder&gt; {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 387 -</span>
 388          public class ViewHolder extends RecyclerView.ViewHolder implements View.OnClickListener {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 389 -</span>
 390              private TextView tagTitle;
 391              private TextView tagCountTextView;
 392              private ImageButton deleteButton;
 393  
 394              private ViewHolder(View itemView) {
 395                  super(itemView);
 396  
 397                  tagTitle = itemView.findViewById(R.id.tag_name);
 398                  tagCountTextView = itemView.findViewById(R.id.tag_count);
 399                  deleteButton = itemView.findViewById(R.id.tag_trash);
 400  
 401                  deleteButton.setOnClickListener(new View.OnClickListener() {
 402                      @Override
 403                      public void onClick(View view) {
 404                          if (!isAdded() || !hasItem(getAdapterPosition())) {
 405                              return;
 406                          }
 407  
 408                          final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObject();
<abbr title=" 409                          final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).count();"> 409                          final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag🔵</abbr>
 410                          if (tagCount == 0) {
 411                              deleteTag(tag);
 412                          } else if (tagCount &gt; 0) {
<abbr title=" 413                              AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.style.Dialog));"> 413                              AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext🔵</abbr>
 414                              alert.setTitle(R.string.delete_tag);
 415                              alert.setMessage(getString(R.string.confirm_delete_tag));
 416                              alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {
 417                                  public void onClick(DialogInterface dialog, int whichButton) {
 418                                      deleteTag(tag);
 419                                  }
 420                              });
 421                              alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {
 422                                  public void onClick(DialogInterface dialog, int whichButton) {
 423                                      // Do nothing, just closing the dialog
 424                                  }
 425                              });
 426                              alert.show();
 427                          }
 428                      }
 429                  });
 430                  deleteButton.setOnLongClickListener(new View.OnLongClickListener() {
 431                      @Override
 432                      public boolean onLongClick(View v) {
 433                          if (v.isHapticFeedbackEnabled()) {
 434                              v.performHapticFeedback(HapticFeedbackConstants.LONG_PRESS);
 435                          }
 436  
<abbr title=" 437                          Toast.makeText(getContext(), getContext().getString(R.string.delete_tag), Toast.LENGTH_SHORT).show();"> 437                          Toast.makeText(getContext(), getContext().getString(R.string.delete_tag), Toast.LENGTH_SHO🔵</abbr>

 438                          return true;
 439                      }
 440                  });
 441  
 442                  itemView.setOnClickListener(this);
 443              }
 444  
 445              @Override
 446              public void onClick(View view) {
 447                  if (!isAdded() || !hasItem(getAdapterPosition())) {
 448                      return;
 449                  }
 450  
<abbr title=" 451                  final AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.style.Dialog));"> 451                  final AlertDialog.Builder alert = new AlertDialog.Builder(new ContextThemeWrapper(getContext(), R.🔵</abbr>
<abbr title=" 452                  LinearLayout alertView = (LinearLayout) getActivity().getLayoutInflater().inflate(R.layout.edit_tag, null);"> 452                  LinearLayout alertView = (LinearLayout) getActivity().getLayoutInflater().inflate(R.layout.edit_ta🔵</abbr>

 453  
 454                  final Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;) getItem(getAdapterPosition())).getObject();
 455  
 456                  final EditText tagNameEditText = alertView.findViewById(R.id.tag_name_edit);
 457                  tagNameEditText.setText(tag.getName());
 458                  tagNameEditText.setSelection(tagNameEditText.length());
 459                  alert.setView(alertView);
 460                  alert.setTitle(R.string.rename_tag);
 461                  alert.setPositiveButton(R.string.save, new DialogInterface.OnClickListener() {
 462                      public void onClick(DialogInterface dialog, int whichButton) {
 463                          String value = tagNameEditText.getText().toString().trim();
 464                          try {
 465                              tag.renameTo(value, mNotesBucket);
 466                              AnalyticsTracker.track(
 467                                      AnalyticsTracker.Stat.TAG_EDITOR_ACCESSED,
 468                                      AnalyticsTracker.CATEGORY_TAG,
 469                                      &quot;tag_alert_edit_box&quot;
 470                              );
 471                          } catch (BucketObjectNameInvalid e) {
 472                              android.util.Log.e(Simplenote.TAG, &quot;Unable to rename tag&quot;, e);
 473                              // TODO: show user a message that new tag name is not ok
 474                          }
 475                      }
 476                  });
 477                  alert.setNegativeButton(R.string.cancel, new DialogInterface.OnClickListener() {
 478                      public void onClick(DialogInterface dialog, int whichButton) {
 479                          // Do nothing
 480                      }
 481                  });
 482                  alert.show();
 483              }
 484  
 485              private void deleteTag(Tag tag) {
 486                  tag.delete();
<abbr title=" 487                  new RemoveTagFromNotesTask(TagsListFragment.this).executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR, tag);"> 487                  new RemoveTagFromNotesTask(TagsListFragment.this).executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR🔵</abbr>
 488                  AnalyticsTracker.track(
 489                          AnalyticsTracker.Stat.TAG_MENU_DELETED,
 490                          AnalyticsTracker.CATEGORY_TAG,
 491                          &quot;list_trash_button&quot;
 492                  );
 493              }
 494          }
 495  
 496          private TagsAdapter() {
 497              super(null);
 498          }
 499  
 500          @NonNull
 501          @Override
 502          public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {
 503              Context context = parent.getContext();
 504              LayoutInflater inflater = LayoutInflater.from(context);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 505 -</span>
 506              View contactView = inflater.inflate(R.layout.tags_list_row, parent, false);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 507 -</span>
 508              return new ViewHolder(contactView);
 509          }
 510  
 511          @Override
 512          public void onBindViewHolder(@NonNull ViewHolder holder, Cursor cursor) {
 513              Tag tag = ((Bucket.ObjectCursor&lt;Tag&gt;)cursor).getObject();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 514 -</span>
 515              holder.tagTitle.setText(tag.getName());
<abbr title=" 516              final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).count();"> 516              final int tagCount = mNotesBucket.query().where(&quot;tags&quot;, Query.ComparisonType.EQUAL_TO, tag.getName()).🔵</abbr>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 517 +</span>
 518              if (tagCount &gt; 0) {
 519                  holder.tagCountTextView.setText(String.valueOf(tagCount));
 520              } else {
 521                  holder.tagCountTextView.setText(&quot;&quot;);
 522              }
 523          }
 524  
 525          @Override
 526          public void swapCursor(Cursor newCursor) {
 527              super.swapCursor(newCursor);
 528          }
 529      }
 530  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            