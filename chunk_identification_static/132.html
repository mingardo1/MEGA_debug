<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>132</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    132
                    <a href="131.html">prev</a>
                    <a href="133.html">next</a>
                    <a href="132_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    CarGuo/GSYVideoPlayer_a1061d62099001b02357c265e6d4fce0b95a66fc_gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/demo/EventLogger.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;a1061d62099001b02357c265e6d4fce0b95a66fc:gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/demo/EventLogger.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;a1061d62099001b02357c265e6d4fce0b95a66fc^1:gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/demo/EventLogger.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;a1061d62099001b02357c265e6d4fce0b95a66fc^2:gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/demo/EventLogger.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\CarGuo\GSYVideoPlayer show &quot;0bbf9d653eac231e9add9fe4bd2073e7054970dc:gsyVideoPlayer-exo_player2/src/main/java/tv/danmaku/ijk/media/exo2/demo/EventLogger.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b], [b], [b], [b], [bj], [bj], [b], [b], [b], [b], [j], [j], [j], [j], [j], [j], [s], [s], [s], [s], [s]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 The Android Open Source Project
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package tv.danmaku.ijk.media.exo2.demo;
  17 
  18 import android.os.SystemClock;
  19 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
  20 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import androidx.annotation.Nullable;</span>
  22 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23 </span>
  24 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  25 import android.util.Log;
  26 
  27 import androidx.annotation.NonNull;
  28 import androidx.annotation.Nullable;
  29 
  30 import com.google.android.exoplayer2.C;
  31 import com.google.android.exoplayer2.ExoPlaybackException;
  32 import com.google.android.exoplayer2.Format;
  33 import com.google.android.exoplayer2.PlaybackParameters;
  34 import com.google.android.exoplayer2.Player;
  35 import com.google.android.exoplayer2.RendererCapabilities;
  36 import com.google.android.exoplayer2.Timeline;
  37 import com.google.android.exoplayer2.audio.AudioRendererEventListener;
  38 import com.google.android.exoplayer2.decoder.DecoderCounters;
  39 import com.google.android.exoplayer2.decoder.DecoderReuseEvaluation;
  40 import com.google.android.exoplayer2.metadata.Metadata;
  41 import com.google.android.exoplayer2.metadata.MetadataOutput;
  42 import com.google.android.exoplayer2.metadata.emsg.EventMessage;
  43 import com.google.android.exoplayer2.metadata.id3.ApicFrame;
  44 import com.google.android.exoplayer2.metadata.id3.CommentFrame;
  45 import com.google.android.exoplayer2.metadata.id3.GeobFrame;
  46 import com.google.android.exoplayer2.metadata.id3.Id3Frame;
  47 import com.google.android.exoplayer2.metadata.id3.PrivFrame;
  48 import com.google.android.exoplayer2.metadata.id3.TextInformationFrame;
  49 import com.google.android.exoplayer2.metadata.id3.UrlLinkFrame;
  50 import com.google.android.exoplayer2.source.MediaSourceEventListener;
  51 import com.google.android.exoplayer2.source.TrackGroup;
  52 import com.google.android.exoplayer2.source.TrackGroupArray;
  53 import com.google.android.exoplayer2.text.Cue;
  54 import com.google.android.exoplayer2.trackselection.MappingTrackSelector;
  55 import com.google.android.exoplayer2.trackselection.MappingTrackSelector.MappedTrackInfo;
  56 import com.google.android.exoplayer2.trackselection.TrackSelection;
  57 import com.google.android.exoplayer2.trackselection.TrackSelectionArray;
  58 import com.google.android.exoplayer2.video.VideoRendererEventListener;
  59 import com.google.android.exoplayer2.video.VideoSize;
  60 
  61 import java.text.NumberFormat;
  62 import java.util.List;
  63 import java.util.Locale;
  64 
  65 
  66 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67 public final class EventLogger implements Player.EventListener, MetadataOutput,</span>
  68 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69         AudioRendererEventListener, VideoRendererEventListener, MediaSourceEventListener{</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 </span>
  71 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72 public final class EventLogger implements Player.Listener, MetadataOutput,</span>
  73 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  74         AudioRendererEventListener, VideoRendererEventListener, MediaSourceEventListener {
  75 
  76     private static final String TAG = &quot;EventLogger&quot;;
  77     private static final int MAX_TIMELINE_ITEM_LINES = 3;
  78     private static final NumberFormat TIME_FORMAT;
  79 
  80     static {
  81         TIME_FORMAT = NumberFormat.getInstance(Locale.US);
  82         TIME_FORMAT.setMinimumFractionDigits(2);
  83         TIME_FORMAT.setMaximumFractionDigits(2);
  84         TIME_FORMAT.setGroupingUsed(false);
  85     }
  86 
  87     private final MappingTrackSelector trackSelector;
  88     private final Timeline.Window window;
  89     private final Timeline.Period period;
  90     private final long startTimeMs;
  91 
  92     public EventLogger(MappingTrackSelector trackSelector) {
  93         this.trackSelector = trackSelector;
  94         window = new Timeline.Window();
  95         period = new Timeline.Period();
  96         startTimeMs = SystemClock.elapsedRealtime();
  97     }
  98 
  99 
 100     // Player.EventListener
 101 
 102 
 103     @Override
 104 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
 105 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109     public void onPlayerStateChanged(boolean playWhenReady, int state) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110         Log.d(TAG, &quot;state [&quot; + getSessionTimeString() + &quot;, &quot; + playWhenReady + &quot;, &quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111                 + getStateString(state) + &quot;]&quot;);</span>
 112 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113     public void onCues(List&lt;Cue&gt; cues) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117     @Override</span>
 118 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 119     public void onIsLoadingChanged(boolean isLoading) {
 120         Log.d(TAG, &quot;loading [&quot; + isLoading + &quot;]&quot;);
 121     }
 122 
 123     @Override
 124 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125     public void onPlaybackStateChanged(int state) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126         boolean playWhenReady = state == Player.STATE_READY;</span>
 127 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128                 + getStateString(state) + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132     public void onRepeatModeChanged(@Player.RepeatMode int repeatMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133         Log.d(TAG, &quot;repeatMode [&quot; + getRepeatModeString(repeatMode) + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137     public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138         Log.d(TAG, &quot;shuffleModeEnabled [&quot; + shuffleModeEnabled + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140 </span>
 141 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142     public void onPlaybackStateChanged(@Player.State int state) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143         Log.d(TAG, &quot;state [&quot; + getSessionTimeString()  + &quot;, &quot;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144                 + getStateString(state) + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148     public void onPlayWhenReadyChanged(boolean playWhenReady, int state) {</span>
 149 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 150         Log.d(TAG, &quot;state [&quot; + getSessionTimeString() + &quot;, &quot; + playWhenReady + &quot;, &quot;
 151                 + getStateString(state) + &quot;]&quot;);
 152     }
 153 
 154     @Override
 155     public void onRepeatModeChanged(@Player.RepeatMode int repeatMode) {
 156         Log.d(TAG, &quot;repeatMode [&quot; + getRepeatModeString(repeatMode) + &quot;]&quot;);
 157     }
 158 
 159     @Override
 160     public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {
 161         Log.d(TAG, &quot;shuffleModeEnabled [&quot; + shuffleModeEnabled + &quot;]&quot;);
 162     }
 163 
 164 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165     private static String getDiscontinuityReasonString(@Player.DiscontinuityReason int reason) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 166         switch (reason) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 167             case Player.DISCONTINUITY_REASON_AUTO_TRANSITION:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 168                 return &quot;AUTO_TRANSITION&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 169             case Player.DISCONTINUITY_REASON_SEEK:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 170                 return &quot;SEEK&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 171             case Player.DISCONTINUITY_REASON_SEEK_ADJUSTMENT:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 172                 return &quot;SEEK_ADJUSTMENT&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173             case Player.DISCONTINUITY_REASON_INTERNAL:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174                 return &quot;INTERNAL&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175             default:</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 176                 return &quot;?&quot;;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 177         }</span>
 178 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182     public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183         Log.d(TAG, &quot;playbackParameters &quot; + String.format(</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184                 &quot;[speed=%.2f, pitch=%.2f]&quot;, playbackParameters.speed, playbackParameters.pitch));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188     public void onPlayerError(ExoPlaybackException e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189         Log.e(TAG, &quot;playerFailed [&quot; + getSessionTimeString() + &quot;]&quot;, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192     @Override</span>
 193 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 195     public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition, @Player.DiscontinuityReason int reason) {"> 195     public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition,🔵</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196         Log.d(TAG, &quot;positionDiscontinuity [&quot; + getDiscontinuityReasonString(reason) + &quot;]&quot;);</span>
 197 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 198     }
 199 
 200     @Override
 201     public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {
 202         Log.d(TAG, &quot;playbackParameters &quot; + String.format(
 203                 &quot;[speed=%.2f, pitch=%.2f]&quot;, playbackParameters.speed, playbackParameters.pitch));
 204     }
 205 
 206     @Override
 207     public void onPlayerError(@NonNull ExoPlaybackException e) {
 208         Log.e(TAG, &quot;playerFailed [&quot; + getSessionTimeString() + &quot;]&quot;, e);
 209     }
 210 
 211     @Override
<abbr title=" 212     public void onTracksChanged(@NonNull TrackGroupArray ignored, @NonNull TrackSelectionArray trackSelections) {"> 212     public void onTracksChanged(@NonNull TrackGroupArray ignored, @NonNull TrackSelectionArray trackSelec🔵</abbr>
 213         MappedTrackInfo mappedTrackInfo = trackSelector.getCurrentMappedTrackInfo();
 214         if (mappedTrackInfo == null) {
 215             Log.d(TAG, &quot;Tracks []&quot;);
 216             return;
 217         }
 218         Log.d(TAG, &quot;Tracks [&quot;);
 219         // Log tracks associated to renderers.
<abbr title=" 220         for (int rendererIndex = 0; rendererIndex &lt; mappedTrackInfo.getRendererCount(); rendererIndex++) {"> 220         for (int rendererIndex = 0; rendererIndex &lt; mappedTrackInfo.getRendererCount(); rendererIndex++) 🔵</abbr>
 221             TrackGroupArray rendererTrackGroups = mappedTrackInfo.getTrackGroups(rendererIndex);
 222             TrackSelection trackSelection = trackSelections.get(rendererIndex);
 223             if (rendererTrackGroups.length &gt; 0) {
 224                 Log.d(TAG, &quot;  Renderer:&quot; + rendererIndex + &quot; [&quot;);
 225                 for (int groupIndex = 0; groupIndex &lt; rendererTrackGroups.length; groupIndex++) {
 226                     TrackGroup trackGroup = rendererTrackGroups.get(groupIndex);
 227                     String adaptiveSupport = getAdaptiveSupportString(trackGroup.length,
 228                             mappedTrackInfo.getAdaptiveSupport(rendererIndex, groupIndex, false));
<abbr title=" 229                     Log.d(TAG, &quot;    Group:&quot; + groupIndex + &quot;, adaptive_supported=&quot; + adaptiveSupport + &quot; [&quot;);"> 229                     Log.d(TAG, &quot;    Group:&quot; + groupIndex + &quot;, adaptive_supported=&quot; + adaptiveSupport + &quot; 🔵</abbr>
 230                     Log.d(TAG, &quot;    ]&quot;);
 231                 }
 232                 // Log metadata for at most one of the tracks selected for the renderer.
 233                 if (trackSelection != null) {
<abbr title=" 234                     for (int selectionIndex = 0; selectionIndex &lt; trackSelection.length(); selectionIndex++) {"> 234                     for (int selectionIndex = 0; selectionIndex &lt; trackSelection.length(); selectionIndex🔵</abbr>
 235                         Metadata metadata = trackSelection.getFormat(selectionIndex).metadata;
 236                         if (metadata != null) {
 237                             Log.d(TAG, &quot;    Metadata [&quot;);
 238                             printMetadata(metadata, &quot;      &quot;);
 239                             Log.d(TAG, &quot;    ]&quot;);
 240                             break;
 241                         }
 242                     }
 243                 }
 244                 Log.d(TAG, &quot;  ]&quot;);
 245             }
 246         }
 247         // Log tracks not associated with a renderer.
 248         TrackGroupArray unassociatedTrackGroups = mappedTrackInfo.getUnmappedTrackGroups();
 249         if (unassociatedTrackGroups.length &gt; 0) {
 250             Log.d(TAG, &quot;  Renderer:None [&quot;);
 251             for (int groupIndex = 0; groupIndex &lt; unassociatedTrackGroups.length; groupIndex++) {
 252                 Log.d(TAG, &quot;    Group:&quot; + groupIndex + &quot; [&quot;);
 253                 TrackGroup trackGroup = unassociatedTrackGroups.get(groupIndex);
 254                 for (int trackIndex = 0; trackIndex &lt; trackGroup.length; trackIndex++) {
 255                     String status = getTrackStatusString(false);
 256                     String formatSupport = getFormatSupportString(
 257                             C.FORMAT_UNSUPPORTED_TYPE);
 258                     Log.d(TAG, &quot;      &quot; + status + &quot; Track:&quot; + trackIndex + &quot;, &quot;
 259                             + Format.toLogString(trackGroup.getFormat(trackIndex))
 260                             + &quot;, supported=&quot; + formatSupport);
 261                 }
 262                 Log.d(TAG, &quot;    ]&quot;);
 263             }
 264             Log.d(TAG, &quot;  ]&quot;);
 265         }
 266         Log.d(TAG, &quot;]&quot;);
 267     }
 268 
 269     // MetadataOutput
 270 
 271     @Override
 272     public void onMetadata(@NonNull Metadata metadata) {
 273         Log.d(TAG, &quot;onMetadata [&quot;);
 274         printMetadata(metadata, &quot;  &quot;);
 275         Log.d(TAG, &quot;]&quot;);
 276     }
 277 
 278     // AudioRendererEventListener
 279 
 280     @Override
 281     public void onAudioEnabled(DecoderCounters counters) {
 282         Log.d(TAG, &quot;audioEnabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 283     }
 284 
 285     @Override
 286     public void onAudioDecoderInitialized(String decoderName, long elapsedRealtimeMs,
 287                                           long initializationDurationMs) {
 288         Log.d(TAG, &quot;audioDecoderInitialized [&quot; + getSessionTimeString() + &quot;, &quot; + decoderName + &quot;]&quot;);
 289     }
 290 
 291     @Override
 292 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 293     public void onAudioInputFormatChanged(Format format, @Nullable DecoderReuseEvaluation decoderReuseEvaluation) {"> 293     public void onAudioInputFormatChanged(Format format, @Nullable DecoderReuseEvaluation decoderReuseEva🔵</abbr></span>
 294 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296     public void onAudioDisabled(DecoderCounters counters) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297         Log.d(TAG, &quot;audioDisabled [&quot; + getSessionTimeString() + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299 </span>
 300 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301     public void onAudioInputFormatChanged(Format format, DecoderReuseEvaluation decoderReuseEvaluation) {</span>
 302 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 303         Log.d(TAG, &quot;audioFormatChanged [&quot; + getSessionTimeString() + &quot;, &quot; + Format.toLogString(format)
 304                 + &quot;]&quot;);
 305     }
 306 
 307     @Override
 308     public void onAudioDisabled(DecoderCounters counters) {
 309         Log.d(TAG, &quot;audioDisabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 310     }
 311 
 312     // VideoRendererEventListener
 313 
 314     @Override
 315     public void onVideoEnabled(DecoderCounters counters) {
 316         Log.d(TAG, &quot;videoEnabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 317     }
 318 
 319     @Override
 320     public void onVideoDecoderInitialized(String decoderName, long elapsedRealtimeMs,
 321                                           long initializationDurationMs) {
 322         Log.d(TAG, &quot;videoDecoderInitialized [&quot; + getSessionTimeString() + &quot;, &quot; + decoderName + &quot;]&quot;);
 323     }
 324 
 325     @Override
 326 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 327     public void onVideoInputFormatChanged(Format format, @Nullable DecoderReuseEvaluation decoderReuseEvaluation) {"> 327     public void onVideoInputFormatChanged(Format format, @Nullable DecoderReuseEvaluation decoderReuseEva🔵</abbr></span>
 328 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330     public void onVideoDisabled(DecoderCounters counters) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331         Log.d(TAG, &quot;videoDisabled [&quot; + getSessionTimeString() + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333 </span>
 334 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 335     public void onVideoInputFormatChanged(Format format, DecoderReuseEvaluation decoderReuseEvaluation) {</span>
 336 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 337         Log.d(TAG, &quot;videoFormatChanged [&quot; + getSessionTimeString() + &quot;, &quot; + Format.toLogString(format)
 338                 + &quot;]&quot;);
 339     }
 340 
 341     @Override
 342     public void onVideoDisabled(DecoderCounters counters) {
 343         Log.d(TAG, &quot;videoDisabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 344     }
 345 
 346     @Override
 347     public void onDroppedFrames(int count, long elapsed) {
 348         Log.d(TAG, &quot;droppedFrames [&quot; + getSessionTimeString() + &quot;, &quot; + count + &quot;]&quot;);
 349     }
 350 
 351     @Override
 352 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 353     public void onPositionDiscontinuity(</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 354             @NonNull Player.PositionInfo oldPosition,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 355             @NonNull Player.PositionInfo newPosition,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 356             @Player.DiscontinuityReason int reason</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 357     ) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 358         Log.d(TAG, &quot;positionDiscontinuity [&quot; + getDiscontinuityReasonString(reason) + &quot;]&quot;);</span>
 359 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361     public void onRenderedFirstFrame(Surface surface) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362         Log.d(TAG, &quot;renderedFirstFrame [&quot; + surface + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365     //MediaSourceEventListener</span>
 366 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367     public void onVideoSizeChanged(VideoSize videoSize) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368         Log.d(TAG, &quot;videoSizeChanged [&quot; + videoSize.width + &quot;, &quot; + videoSize.height + &quot;]&quot;);</span>
 369 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 370     }
 371 
 372     @Override
 373 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 374     public void onVideoSizeChanged(VideoSize videoSize) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 375         Log.d(TAG, &quot;videoSizeChanged [&quot; + videoSize.width + &quot;, &quot; + videoSize.height + &quot;]&quot;);</span>
 376 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377         int periodCount = timeline.getPeriodCount();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 378         int windowCount = timeline.getWindowCount();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379         Log.d(TAG, &quot;sourceInfo [periodCount=&quot; + periodCount + &quot;, windowCount=&quot; + windowCount);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 380         for (int i = 0; i &lt; Math.min(periodCount, MAX_TIMELINE_ITEM_LINES); i++) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 381             timeline.getPeriod(i, period);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382             Log.d(TAG, &quot;  &quot; + &quot;period [&quot; + getTimeString(period.getDurationMs()) + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383         }</span>
 384 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385     public void onRenderedFirstFrame(Object output, long renderTimeMs) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386         Log.d(TAG, &quot;renderedFirstFrame [&quot; + output + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390     public void onSkipSilenceEnabledChanged(boolean skipSilenceEnabled) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391 </span>
 392 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 393     }
 394 
 395     //MediaSourceEventListener
 396 
 397 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 398     @Override</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 399     public void onTimelineChanged(Timeline timeline, int reason) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 400         int periodCount = timeline.getPeriodCount();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 401         int windowCount = timeline.getWindowCount();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 402         Log.d(TAG, &quot;sourceInfo [periodCount=&quot; + periodCount + &quot;, windowCount=&quot; + windowCount);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 403         for (int i = 0; i &lt; Math.min(periodCount, MAX_TIMELINE_ITEM_LINES); i++) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 404             timeline.getPeriod(i, period);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 405             Log.d(TAG, &quot;  &quot; + &quot;period [&quot; + getTimeString(period.getDurationMs()) + &quot;]&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 406         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 407         if (periodCount &gt; MAX_TIMELINE_ITEM_LINES) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 408             Log.d(TAG, &quot;  ...&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 409         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 410         for (int i = 0; i &lt; Math.min(windowCount, MAX_TIMELINE_ITEM_LINES); i++) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 411             timeline.getWindow(i, window);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 412             Log.d(TAG, &quot;  &quot; + &quot;window [&quot; + getTimeString(window.getDurationMs()) + &quot;, &quot;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 413                     + window.isSeekable + &quot;, &quot; + window.isDynamic + &quot;]&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 414         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 415         if (windowCount &gt; MAX_TIMELINE_ITEM_LINES) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 416             Log.d(TAG, &quot;  ...&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 417         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 418         Log.d(TAG, &quot;]&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 419     }</span>
 420 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422         if (periodCount &gt; MAX_TIMELINE_ITEM_LINES) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423             Log.d(TAG, &quot;  ...&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425         for (int i = 0; i &lt; Math.min(windowCount, MAX_TIMELINE_ITEM_LINES); i++) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426             timeline.getWindow(i, window);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427             Log.d(TAG, &quot;  &quot; + &quot;window [&quot; + getTimeString(window.getDurationMs()) + &quot;, &quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428                     + window.isSeekable + &quot;, &quot; + window.isDynamic + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430         if (windowCount &gt; MAX_TIMELINE_ITEM_LINES) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431             Log.d(TAG, &quot;  ...&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433         Log.d(TAG, &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436     // Internal methods</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438     private void printInternalError(String type, Exception e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439         Log.e(TAG, &quot;internalError [&quot; + getSessionTimeString() + &quot;, &quot; + type + &quot;]&quot;, e);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442     private void printMetadata(Metadata metadata, String prefix) {</span>
 443 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444     // Internal methods</span>
 445 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 446 
 447     private void printMetadata(Metadata metadata, String prefix) {
 448         for (int i = 0; i &lt; metadata.length(); i++) {
 449             Metadata.Entry entry = metadata.get(i);
 450             if (entry instanceof TextInformationFrame) {
 451                 TextInformationFrame textInformationFrame = (TextInformationFrame) entry;
 452                 Log.d(TAG, prefix + String.format(&quot;%s: value=%s&quot;, textInformationFrame.id,
 453                         textInformationFrame.value));
 454             } else if (entry instanceof UrlLinkFrame) {
 455                 UrlLinkFrame urlLinkFrame = (UrlLinkFrame) entry;
 456                 Log.d(TAG, prefix + String.format(&quot;%s: url=%s&quot;, urlLinkFrame.id, urlLinkFrame.url));
 457             } else if (entry instanceof PrivFrame) {
 458                 PrivFrame privFrame = (PrivFrame) entry;
 459                 Log.d(TAG, prefix + String.format(&quot;%s: owner=%s&quot;, privFrame.id, privFrame.owner));
 460             } else if (entry instanceof GeobFrame) {
 461                 GeobFrame geobFrame = (GeobFrame) entry;
 462                 Log.d(TAG, prefix + String.format(&quot;%s: mimeType=%s, filename=%s, description=%s&quot;,
 463                         geobFrame.id, geobFrame.mimeType, geobFrame.filename, geobFrame.description));
 464             } else if (entry instanceof ApicFrame) {
 465                 ApicFrame apicFrame = (ApicFrame) entry;
 466                 Log.d(TAG, prefix + String.format(&quot;%s: mimeType=%s, description=%s&quot;,
 467                         apicFrame.id, apicFrame.mimeType, apicFrame.description));
 468             } else if (entry instanceof CommentFrame) {
 469                 CommentFrame commentFrame = (CommentFrame) entry;
 470                 Log.d(TAG, prefix + String.format(&quot;%s: language=%s, description=%s&quot;, commentFrame.id,
 471                         commentFrame.language, commentFrame.description));
 472             } else if (entry instanceof Id3Frame) {
 473                 Id3Frame id3Frame = (Id3Frame) entry;
 474                 Log.d(TAG, prefix + String.format(&quot;%s&quot;, id3Frame.id));
 475             } else if (entry instanceof EventMessage) {
 476                 EventMessage eventMessage = (EventMessage) entry;
 477                 Log.d(TAG, prefix + String.format(&quot;EMSG: scheme=%s, id=%d, value=%s&quot;,
 478                         eventMessage.schemeIdUri, eventMessage.id, eventMessage.value));
 479             }
 480         }
 481     }
 482 
 483     private String getSessionTimeString() {
 484         return getTimeString(SystemClock.elapsedRealtime() - startTimeMs);
 485     }
 486 
 487     private static String getTimeString(long timeMs) {
 488         return timeMs == C.TIME_UNSET ? &quot;?&quot; : TIME_FORMAT.format((timeMs) / 1000f);
 489     }
 490 
 491     private static String getStateString(int state) {
 492         switch (state) {
 493             case Player.STATE_BUFFERING:
 494                 return &quot;B&quot;;
 495             case Player.STATE_ENDED:
 496                 return &quot;E&quot;;
 497             case Player.STATE_IDLE:
 498                 return &quot;I&quot;;
 499             case Player.STATE_READY:
 500                 return &quot;R&quot;;
 501             default:
 502                 return &quot;?&quot;;
 503         }
 504     }
 505 
 506     private static String getFormatSupportString(int formatSupport) {
 507         switch (formatSupport) {
 508             case C.FORMAT_HANDLED:
 509                 return &quot;YES&quot;;
 510             case C.FORMAT_EXCEEDS_CAPABILITIES:
 511                 return &quot;NO_EXCEEDS_CAPABILITIES&quot;;
 512             case C.FORMAT_UNSUPPORTED_DRM:
 513                 return &quot;NO_UNSUPPORTED_DRM&quot;;
 514             case C.FORMAT_UNSUPPORTED_SUBTYPE:
 515                 return &quot;NO_UNSUPPORTED_TYPE&quot;;
 516             case C.FORMAT_UNSUPPORTED_TYPE:
 517                 return &quot;NO&quot;;
 518             default:
 519                 return &quot;?&quot;;
 520         }
 521     }
 522 
 523     private static String getAdaptiveSupportString(int trackCount, int adaptiveSupport) {
 524         if (trackCount &lt; 2) {
 525             return &quot;N/A&quot;;
 526         }
 527         switch (adaptiveSupport) {
 528             case RendererCapabilities.ADAPTIVE_SEAMLESS:
 529                 return &quot;YES&quot;;
 530             case RendererCapabilities.ADAPTIVE_NOT_SEAMLESS:
 531                 return &quot;YES_NOT_SEAMLESS&quot;;
 532             case RendererCapabilities.ADAPTIVE_NOT_SUPPORTED:
 533                 return &quot;NO&quot;;
 534             default:
 535                 return &quot;?&quot;;
 536         }
 537     }
 538 
 539     private static String getTrackStatusString(TrackSelection selection, TrackGroup group,
 540                                                int trackIndex) {
 541         return getTrackStatusString(selection != null &amp;&amp; selection.getTrackGroup() == group
 542                 &amp;&amp; selection.indexOf(trackIndex) != C.INDEX_UNSET);
 543     }
 544 
 545     private static String getTrackStatusString(boolean enabled) {
 546         return enabled ? &quot;[X]&quot; : &quot;[ ]&quot;;
 547     }
 548 
 549     private static String getRepeatModeString(@Player.RepeatMode int repeatMode) {
 550         switch (repeatMode) {
 551             case Player.REPEAT_MODE_OFF:
 552                 return &quot;OFF&quot;;
 553             case Player.REPEAT_MODE_ONE:
 554                 return &quot;ONE&quot;;
 555             case Player.REPEAT_MODE_ALL:
 556                 return &quot;ALL&quot;;
 557             default:
 558                 return &quot;?&quot;;
 559         }
 560     }
 561 
 562 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 563     @Override</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 564     public void onRenderedFirstFrame(Object output, long renderTimeMs) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 565         if (output instanceof Surface) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 566             Log.d(TAG, &quot;renderedFirstFrame [&quot; + (Surface) output + &quot;]&quot;);</span>
 567 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 568 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 569     private static String getRepeatModeString(@Player.RepeatMode int repeatMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 570         switch (repeatMode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 571             case Player.REPEAT_MODE_OFF:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 572                 return &quot;OFF&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 573             case Player.REPEAT_MODE_ONE:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 574                 return &quot;ONE&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 575             case Player.REPEAT_MODE_ALL:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 576                 return &quot;ALL&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 577             default:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 578                 return &quot;?&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 579         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 580     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 581 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 582     private static String getDiscontinuityReasonString(@Player.DiscontinuityReason int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 583         switch (reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 584             case Player.DISCONTINUITY_REASON_PERIOD_TRANSITION:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 585                 return &quot;PERIOD_TRANSITION&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 586             case Player.DISCONTINUITY_REASON_SEEK:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 587                 return &quot;SEEK&quot;;</span>
 588 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 589     private static String getDiscontinuityReasonString(@Player.DiscontinuityReason int reason) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 590         switch (reason) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 591             case Player.DISCONTINUITY_REASON_AUTO_TRANSITION:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 592                 return &quot;PERIOD_TRANSITION&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 593             case Player.DISCONTINUITY_REASON_SEEK:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 594                 return &quot;SEEK&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 595             case Player.DISCONTINUITY_REASON_SEEK_ADJUSTMENT:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 596                 return &quot;SEEK_ADJUSTMENT&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 597             case Player.DISCONTINUITY_REASON_INTERNAL:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 598                 return &quot;INTERNAL&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 599             case Player.DISCONTINUITY_REASON_REMOVE:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 600             case Player.DISCONTINUITY_REASON_SKIP:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 601             default:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 602                 return &quot;?&quot;;</span>
 603 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 604         }
 605     }
 606 }</pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 The Android Open Source Project
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package tv.danmaku.ijk.media.exo2.demo;
  17 
  18 import android.os.SystemClock;
  19 
  20 import android.util.Log;
  21 
  22 import androidx.annotation.NonNull;
  23 
  24 import com.google.android.exoplayer2.C;
  25 import com.google.android.exoplayer2.ExoPlaybackException;
  26 import com.google.android.exoplayer2.Format;
  27 import com.google.android.exoplayer2.PlaybackParameters;
  28 import com.google.android.exoplayer2.Player;
  29 import com.google.android.exoplayer2.RendererCapabilities;
  30 import com.google.android.exoplayer2.Timeline;
  31 import com.google.android.exoplayer2.audio.AudioRendererEventListener;
  32 import com.google.android.exoplayer2.decoder.DecoderCounters;
  33 import com.google.android.exoplayer2.decoder.DecoderReuseEvaluation;
  34 import com.google.android.exoplayer2.metadata.Metadata;
  35 import com.google.android.exoplayer2.metadata.MetadataOutput;
  36 import com.google.android.exoplayer2.metadata.emsg.EventMessage;
  37 import com.google.android.exoplayer2.metadata.id3.ApicFrame;
  38 import com.google.android.exoplayer2.metadata.id3.CommentFrame;
  39 import com.google.android.exoplayer2.metadata.id3.GeobFrame;
  40 import com.google.android.exoplayer2.metadata.id3.Id3Frame;
  41 import com.google.android.exoplayer2.metadata.id3.PrivFrame;
  42 import com.google.android.exoplayer2.metadata.id3.TextInformationFrame;
  43 import com.google.android.exoplayer2.metadata.id3.UrlLinkFrame;
  44 import com.google.android.exoplayer2.source.MediaSourceEventListener;
  45 import com.google.android.exoplayer2.source.TrackGroup;
  46 import com.google.android.exoplayer2.source.TrackGroupArray;
  47 import com.google.android.exoplayer2.text.Cue;
  48 import com.google.android.exoplayer2.trackselection.MappingTrackSelector;
  49 import com.google.android.exoplayer2.trackselection.MappingTrackSelector.MappedTrackInfo;
  50 import com.google.android.exoplayer2.trackselection.TrackSelection;
  51 import com.google.android.exoplayer2.trackselection.TrackSelectionArray;
  52 import com.google.android.exoplayer2.video.VideoRendererEventListener;
  53 import com.google.android.exoplayer2.video.VideoSize;
  54 
  55 import java.text.NumberFormat;
  56 import java.util.List;
  57 import java.util.Locale;
  58 
  59 
  60 public final class EventLogger implements Player.Listener, MetadataOutput,
  61         AudioRendererEventListener, VideoRendererEventListener, MediaSourceEventListener {
  62 
  63     private static final String TAG = &quot;EventLogger&quot;;
  64     private static final int MAX_TIMELINE_ITEM_LINES = 3;
  65     private static final NumberFormat TIME_FORMAT;
  66 
  67     static {
  68         TIME_FORMAT = NumberFormat.getInstance(Locale.US);
  69         TIME_FORMAT.setMinimumFractionDigits(2);
  70         TIME_FORMAT.setMaximumFractionDigits(2);
  71         TIME_FORMAT.setGroupingUsed(false);
  72     }
  73 
  74     private final MappingTrackSelector trackSelector;
  75     private final Timeline.Window window;
  76     private final Timeline.Period period;
  77     private final long startTimeMs;
  78 
  79     public EventLogger(MappingTrackSelector trackSelector) {
  80         this.trackSelector = trackSelector;
  81         window = new Timeline.Window();
  82         period = new Timeline.Period();
  83         startTimeMs = SystemClock.elapsedRealtime();
  84     }
  85 
  86 
  87     // Player.EventListener
  88 
  89 
  90     @Override
  91     public void onCues(List&lt;Cue&gt; cues) {
  92 
  93     }
  94 
  95     // Player.EventListener
  96 
  97     @Override
  98     public void onIsLoadingChanged(boolean isLoading) {
  99         Log.d(TAG, &quot;loading [&quot; + isLoading + &quot;]&quot;);
 100     }
 101 
 102     @Override
 103 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104     public void onPlaybackStateChanged(int state) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105         boolean playWhenReady = state == Player.STATE_READY;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106         Log.d(TAG, &quot;state [&quot; + getSessionTimeString() + &quot;, &quot; + playWhenReady + &quot;, &quot;</span>
 107 ||||||| BASE
 108 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109     public void onPlaybackStateChanged(@Player.State int state) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110         Log.d(TAG, &quot;state [&quot; + getSessionTimeString()  + &quot;, &quot;</span>
 111 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 112                 + getStateString(state) + &quot;]&quot;);
 113     }
 114 
 115 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116 </span>
 117 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119     public void onPlayerStateChanged(boolean playWhenReady, int state) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120         Log.d(TAG, &quot;state [&quot; + getSessionTimeString() + &quot;, &quot; + playWhenReady + &quot;, &quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121                 + getStateString(state) + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122     }</span>
 123 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125     public void onPlayWhenReadyChanged(boolean playWhenReady, int state) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126         Log.d(TAG, &quot;state [&quot; + getSessionTimeString() + &quot;, &quot; + playWhenReady + &quot;, &quot;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127                 + getStateString(state) + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128     }</span>
 129 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 130 
 131     @Override
 132     public void onRepeatModeChanged(@Player.RepeatMode int repeatMode) {
 133         Log.d(TAG, &quot;repeatMode [&quot; + getRepeatModeString(repeatMode) + &quot;]&quot;);
 134     }
 135 
 136     @Override
 137     public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {
 138         Log.d(TAG, &quot;shuffleModeEnabled [&quot; + shuffleModeEnabled + &quot;]&quot;);
 139     }
 140 
 141     @Override
 142 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143     public void onPositionDiscontinuity(</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144             @NonNull Player.PositionInfo oldPosition,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145             @NonNull Player.PositionInfo newPosition,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146             @Player.DiscontinuityReason int reason</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147     ) {</span>
 148 ||||||| BASE
 149 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 150     public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition, @Player.DiscontinuityReason int reason) {"> 150     public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition,🔵</abbr></span>
 151 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 152         Log.d(TAG, &quot;positionDiscontinuity [&quot; + getDiscontinuityReasonString(reason) + &quot;]&quot;);
 153     }
 154 
 155     @Override
 156     public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {
 157         Log.d(TAG, &quot;playbackParameters &quot; + String.format(
 158                 &quot;[speed=%.2f, pitch=%.2f]&quot;, playbackParameters.speed, playbackParameters.pitch));
 159     }
 160 
 161     @Override
 162     public void onPlayerError(@NonNull ExoPlaybackException e) {
 163         Log.e(TAG, &quot;playerFailed [&quot; + getSessionTimeString() + &quot;]&quot;, e);
 164     }
 165 
 166     @Override
<abbr title=" 167     public void onTracksChanged(@NonNull TrackGroupArray ignored, @NonNull TrackSelectionArray trackSelections) {"> 167     public void onTracksChanged(@NonNull TrackGroupArray ignored, @NonNull TrackSelectionArray trackSelec🔵</abbr>
 168         MappedTrackInfo mappedTrackInfo = trackSelector.getCurrentMappedTrackInfo();
 169         if (mappedTrackInfo == null) {
 170             Log.d(TAG, &quot;Tracks []&quot;);
 171             return;
 172         }
 173         Log.d(TAG, &quot;Tracks [&quot;);
 174         // Log tracks associated to renderers.
<abbr title=" 175         for (int rendererIndex = 0; rendererIndex &lt; mappedTrackInfo.getRendererCount(); rendererIndex++) {"> 175         for (int rendererIndex = 0; rendererIndex &lt; mappedTrackInfo.getRendererCount(); rendererIndex++) 🔵</abbr>
 176             TrackGroupArray rendererTrackGroups = mappedTrackInfo.getTrackGroups(rendererIndex);
 177             TrackSelection trackSelection = trackSelections.get(rendererIndex);
 178             if (rendererTrackGroups.length &gt; 0) {
 179                 Log.d(TAG, &quot;  Renderer:&quot; + rendererIndex + &quot; [&quot;);
 180                 for (int groupIndex = 0; groupIndex &lt; rendererTrackGroups.length; groupIndex++) {
 181                     TrackGroup trackGroup = rendererTrackGroups.get(groupIndex);
 182                     String adaptiveSupport = getAdaptiveSupportString(trackGroup.length,
 183                             mappedTrackInfo.getAdaptiveSupport(rendererIndex, groupIndex, false));
<abbr title=" 184                     Log.d(TAG, &quot;    Group:&quot; + groupIndex + &quot;, adaptive_supported=&quot; + adaptiveSupport + &quot; [&quot;);"> 184                     Log.d(TAG, &quot;    Group:&quot; + groupIndex + &quot;, adaptive_supported=&quot; + adaptiveSupport + &quot; 🔵</abbr>
 185                     Log.d(TAG, &quot;    ]&quot;);
 186                 }
 187                 // Log metadata for at most one of the tracks selected for the renderer.
 188                 if (trackSelection != null) {
<abbr title=" 189                     for (int selectionIndex = 0; selectionIndex &lt; trackSelection.length(); selectionIndex++) {"> 189                     for (int selectionIndex = 0; selectionIndex &lt; trackSelection.length(); selectionIndex🔵</abbr>
 190                         Metadata metadata = trackSelection.getFormat(selectionIndex).metadata;
 191                         if (metadata != null) {
 192                             Log.d(TAG, &quot;    Metadata [&quot;);
 193                             printMetadata(metadata, &quot;      &quot;);
 194                             Log.d(TAG, &quot;    ]&quot;);
 195                             break;
 196                         }
 197                     }
 198                 }
 199                 Log.d(TAG, &quot;  ]&quot;);
 200             }
 201         }
 202         // Log tracks not associated with a renderer.
 203         TrackGroupArray unassociatedTrackGroups = mappedTrackInfo.getUnmappedTrackGroups();
 204         if (unassociatedTrackGroups.length &gt; 0) {
 205             Log.d(TAG, &quot;  Renderer:None [&quot;);
 206             for (int groupIndex = 0; groupIndex &lt; unassociatedTrackGroups.length; groupIndex++) {
 207                 Log.d(TAG, &quot;    Group:&quot; + groupIndex + &quot; [&quot;);
 208                 TrackGroup trackGroup = unassociatedTrackGroups.get(groupIndex);
 209                 for (int trackIndex = 0; trackIndex &lt; trackGroup.length; trackIndex++) {
 210                     String status = getTrackStatusString(false);
 211                     String formatSupport = getFormatSupportString(
 212                             C.FORMAT_UNSUPPORTED_TYPE);
 213                     Log.d(TAG, &quot;      &quot; + status + &quot; Track:&quot; + trackIndex + &quot;, &quot;
 214                             + Format.toLogString(trackGroup.getFormat(trackIndex))
 215                             + &quot;, supported=&quot; + formatSupport);
 216                 }
 217                 Log.d(TAG, &quot;    ]&quot;);
 218             }
 219             Log.d(TAG, &quot;  ]&quot;);
 220         }
 221         Log.d(TAG, &quot;]&quot;);
 222     }
 223 
 224     // MetadataOutput
 225 
 226     @Override
 227     public void onMetadata(@NonNull Metadata metadata) {
 228         Log.d(TAG, &quot;onMetadata [&quot;);
 229         printMetadata(metadata, &quot;  &quot;);
 230         Log.d(TAG, &quot;]&quot;);
 231     }
 232 
 233     // AudioRendererEventListener
 234 
 235     @Override
 236     public void onAudioEnabled(DecoderCounters counters) {
 237         Log.d(TAG, &quot;audioEnabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 238     }
 239 
 240     @Override
 241     public void onAudioDecoderInitialized(String decoderName, long elapsedRealtimeMs,
 242                                           long initializationDurationMs) {
 243         Log.d(TAG, &quot;audioDecoderInitialized [&quot; + getSessionTimeString() + &quot;, &quot; + decoderName + &quot;]&quot;);
 244     }
 245 
 246     @Override
 247 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 248     public void onAudioInputFormatChanged(Format format, @Nullable DecoderReuseEvaluation decoderReuseEvaluation) {"> 248     public void onAudioInputFormatChanged(Format format, @Nullable DecoderReuseEvaluation decoderReuseEva🔵</abbr></span>
 249 ||||||| BASE
 250 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251     public void onAudioInputFormatChanged(Format format, DecoderReuseEvaluation decoderReuseEvaluation) {</span>
 252 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 253         Log.d(TAG, &quot;audioFormatChanged [&quot; + getSessionTimeString() + &quot;, &quot; + Format.toLogString(format)
 254                 + &quot;]&quot;);
 255     }
 256 
 257     @Override
 258     public void onAudioDisabled(DecoderCounters counters) {
 259         Log.d(TAG, &quot;audioDisabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 260     }
 261 
 262     // VideoRendererEventListener
 263 
 264     @Override
 265     public void onVideoEnabled(DecoderCounters counters) {
 266         Log.d(TAG, &quot;videoEnabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 267     }
 268 
 269     @Override
 270     public void onVideoDecoderInitialized(String decoderName, long elapsedRealtimeMs,
 271                                           long initializationDurationMs) {
 272         Log.d(TAG, &quot;videoDecoderInitialized [&quot; + getSessionTimeString() + &quot;, &quot; + decoderName + &quot;]&quot;);
 273     }
 274 
 275     @Override
 276 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title=" 277     public void onVideoInputFormatChanged(Format format, @Nullable DecoderReuseEvaluation decoderReuseEvaluation) {"> 277     public void onVideoInputFormatChanged(Format format, @Nullable DecoderReuseEvaluation decoderReuseEva🔵</abbr></span>
 278 ||||||| BASE
 279 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280     public void onVideoInputFormatChanged(Format format, DecoderReuseEvaluation decoderReuseEvaluation) {</span>
 281 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 282         Log.d(TAG, &quot;videoFormatChanged [&quot; + getSessionTimeString() + &quot;, &quot; + Format.toLogString(format)
 283                 + &quot;]&quot;);
 284     }
 285 
 286     @Override
 287     public void onVideoDisabled(DecoderCounters counters) {
 288         Log.d(TAG, &quot;videoDisabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 289     }
 290 
 291     @Override
 292     public void onDroppedFrames(int count, long elapsed) {
 293         Log.d(TAG, &quot;droppedFrames [&quot; + getSessionTimeString() + &quot;, &quot; + count + &quot;]&quot;);
 294     }
 295 
 296     @Override
 297     public void onVideoSizeChanged(VideoSize videoSize) {
 298         Log.d(TAG, &quot;videoSizeChanged [&quot; + videoSize.width + &quot;, &quot; + videoSize.height + &quot;]&quot;);
 299     }
 300 
 301     //MediaSourceEventListener
 302 
 303 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 304     @Override</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 305     public void onTimelineChanged(Timeline timeline, int reason) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 306         int periodCount = timeline.getPeriodCount();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 307         int windowCount = timeline.getWindowCount();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 308         Log.d(TAG, &quot;sourceInfo [periodCount=&quot; + periodCount + &quot;, windowCount=&quot; + windowCount);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 309         for (int i = 0; i &lt; Math.min(periodCount, MAX_TIMELINE_ITEM_LINES); i++) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 310             timeline.getPeriod(i, period);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 311             Log.d(TAG, &quot;  &quot; + &quot;period [&quot; + getTimeString(period.getDurationMs()) + &quot;]&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 312         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 313         if (periodCount &gt; MAX_TIMELINE_ITEM_LINES) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 314             Log.d(TAG, &quot;  ...&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 315         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 316         for (int i = 0; i &lt; Math.min(windowCount, MAX_TIMELINE_ITEM_LINES); i++) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 317             timeline.getWindow(i, window);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 318             Log.d(TAG, &quot;  &quot; + &quot;window [&quot; + getTimeString(window.getDurationMs()) + &quot;, &quot;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 319                     + window.isSeekable + &quot;, &quot; + window.isDynamic + &quot;]&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 320         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 321         if (windowCount &gt; MAX_TIMELINE_ITEM_LINES) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 322             Log.d(TAG, &quot;  ...&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 323         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 324         Log.d(TAG, &quot;]&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 325     }</span>
 326 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328     public void onTimelineChanged(Timeline timeline, Object manifest, int reason) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329         int periodCount = timeline.getPeriodCount();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330         int windowCount = timeline.getWindowCount();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331         Log.d(TAG, &quot;sourceInfo [periodCount=&quot; + periodCount + &quot;, windowCount=&quot; + windowCount);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332         for (int i = 0; i &lt; Math.min(periodCount, MAX_TIMELINE_ITEM_LINES); i++) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333             timeline.getPeriod(i, period);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334             Log.d(TAG, &quot;  &quot; + &quot;period [&quot; + getTimeString(period.getDurationMs()) + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336         if (periodCount &gt; MAX_TIMELINE_ITEM_LINES) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337             Log.d(TAG, &quot;  ...&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339         for (int i = 0; i &lt; Math.min(windowCount, MAX_TIMELINE_ITEM_LINES); i++) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340             timeline.getWindow(i, window);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341             Log.d(TAG, &quot;  &quot; + &quot;window [&quot; + getTimeString(window.getDurationMs()) + &quot;, &quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342                     + window.isSeekable + &quot;, &quot; + window.isDynamic + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344         if (windowCount &gt; MAX_TIMELINE_ITEM_LINES) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345             Log.d(TAG, &quot;  ...&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347         Log.d(TAG, &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348     }</span>
 349 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 350 </span>
 351 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 352 
 353 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 354 </span>
 355 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357     public void onRenderedFirstFrame(Surface surface) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358         Log.d(TAG, &quot;renderedFirstFrame [&quot; + surface + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359     }</span>
 360 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362     public void onRenderedFirstFrame(Object output, long renderTimeMs) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363         Log.d(TAG, &quot;renderedFirstFrame [&quot; + output + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364     }</span>
 365 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 366 
 367     @Override
 368     public void onSkipSilenceEnabledChanged(boolean skipSilenceEnabled) {
 369 
 370     }
 371 
 372     //MediaSourceEventListener
 373 
 374     // Internal methods
 375 
 376     private void printMetadata(Metadata metadata, String prefix) {
 377         for (int i = 0; i &lt; metadata.length(); i++) {
 378             Metadata.Entry entry = metadata.get(i);
 379             if (entry instanceof TextInformationFrame) {
 380                 TextInformationFrame textInformationFrame = (TextInformationFrame) entry;
 381                 Log.d(TAG, prefix + String.format(&quot;%s: value=%s&quot;, textInformationFrame.id,
 382                         textInformationFrame.value));
 383             } else if (entry instanceof UrlLinkFrame) {
 384                 UrlLinkFrame urlLinkFrame = (UrlLinkFrame) entry;
 385                 Log.d(TAG, prefix + String.format(&quot;%s: url=%s&quot;, urlLinkFrame.id, urlLinkFrame.url));
 386             } else if (entry instanceof PrivFrame) {
 387                 PrivFrame privFrame = (PrivFrame) entry;
 388                 Log.d(TAG, prefix + String.format(&quot;%s: owner=%s&quot;, privFrame.id, privFrame.owner));
 389             } else if (entry instanceof GeobFrame) {
 390                 GeobFrame geobFrame = (GeobFrame) entry;
 391                 Log.d(TAG, prefix + String.format(&quot;%s: mimeType=%s, filename=%s, description=%s&quot;,
 392                         geobFrame.id, geobFrame.mimeType, geobFrame.filename, geobFrame.description));
 393             } else if (entry instanceof ApicFrame) {
 394                 ApicFrame apicFrame = (ApicFrame) entry;
 395                 Log.d(TAG, prefix + String.format(&quot;%s: mimeType=%s, description=%s&quot;,
 396                         apicFrame.id, apicFrame.mimeType, apicFrame.description));
 397             } else if (entry instanceof CommentFrame) {
 398                 CommentFrame commentFrame = (CommentFrame) entry;
 399                 Log.d(TAG, prefix + String.format(&quot;%s: language=%s, description=%s&quot;, commentFrame.id,
 400                         commentFrame.language, commentFrame.description));
 401             } else if (entry instanceof Id3Frame) {
 402                 Id3Frame id3Frame = (Id3Frame) entry;
 403                 Log.d(TAG, prefix + String.format(&quot;%s&quot;, id3Frame.id));
 404             } else if (entry instanceof EventMessage) {
 405                 EventMessage eventMessage = (EventMessage) entry;
 406                 Log.d(TAG, prefix + String.format(&quot;EMSG: scheme=%s, id=%d, value=%s&quot;,
 407                         eventMessage.schemeIdUri, eventMessage.id, eventMessage.value));
 408             }
 409         }
 410     }
 411 
 412     private String getSessionTimeString() {
 413         return getTimeString(SystemClock.elapsedRealtime() - startTimeMs);
 414     }
 415 
 416     private static String getTimeString(long timeMs) {
 417         return timeMs == C.TIME_UNSET ? &quot;?&quot; : TIME_FORMAT.format((timeMs) / 1000f);
 418     }
 419 
 420     private static String getStateString(int state) {
 421         switch (state) {
 422             case Player.STATE_BUFFERING:
 423                 return &quot;B&quot;;
 424             case Player.STATE_ENDED:
 425                 return &quot;E&quot;;
 426             case Player.STATE_IDLE:
 427                 return &quot;I&quot;;
 428             case Player.STATE_READY:
 429                 return &quot;R&quot;;
 430             default:
 431                 return &quot;?&quot;;
 432         }
 433     }
 434 
 435     private static String getFormatSupportString(int formatSupport) {
 436         switch (formatSupport) {
 437             case C.FORMAT_HANDLED:
 438                 return &quot;YES&quot;;
 439             case C.FORMAT_EXCEEDS_CAPABILITIES:
 440                 return &quot;NO_EXCEEDS_CAPABILITIES&quot;;
 441             case C.FORMAT_UNSUPPORTED_DRM:
 442                 return &quot;NO_UNSUPPORTED_DRM&quot;;
 443             case C.FORMAT_UNSUPPORTED_SUBTYPE:
 444                 return &quot;NO_UNSUPPORTED_TYPE&quot;;
 445             case C.FORMAT_UNSUPPORTED_TYPE:
 446                 return &quot;NO&quot;;
 447             default:
 448                 return &quot;?&quot;;
 449         }
 450     }
 451 
 452     private static String getAdaptiveSupportString(int trackCount, int adaptiveSupport) {
 453         if (trackCount &lt; 2) {
 454             return &quot;N/A&quot;;
 455         }
 456         switch (adaptiveSupport) {
 457             case RendererCapabilities.ADAPTIVE_SEAMLESS:
 458                 return &quot;YES&quot;;
 459             case RendererCapabilities.ADAPTIVE_NOT_SEAMLESS:
 460                 return &quot;YES_NOT_SEAMLESS&quot;;
 461             case RendererCapabilities.ADAPTIVE_NOT_SUPPORTED:
 462                 return &quot;NO&quot;;
 463             default:
 464                 return &quot;?&quot;;
 465         }
 466     }
 467 
 468     private static String getTrackStatusString(TrackSelection selection, TrackGroup group,
 469                                                int trackIndex) {
 470         return getTrackStatusString(selection != null &amp;&amp; selection.getTrackGroup() == group
 471                 &amp;&amp; selection.indexOf(trackIndex) != C.INDEX_UNSET);
 472     }
 473 
 474     private static String getTrackStatusString(boolean enabled) {
 475         return enabled ? &quot;[X]&quot; : &quot;[ ]&quot;;
 476     }
 477 
 478     private static String getRepeatModeString(@Player.RepeatMode int repeatMode) {
 479         switch (repeatMode) {
 480             case Player.REPEAT_MODE_OFF:
 481                 return &quot;OFF&quot;;
 482             case Player.REPEAT_MODE_ONE:
 483                 return &quot;ONE&quot;;
 484             case Player.REPEAT_MODE_ALL:
 485                 return &quot;ALL&quot;;
 486             default:
 487                 return &quot;?&quot;;
 488         }
 489     }
 490 
 491     private static String getDiscontinuityReasonString(@Player.DiscontinuityReason int reason) {
 492         switch (reason) {
 493             case Player.DISCONTINUITY_REASON_AUTO_TRANSITION:
 494 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 495                 return &quot;AUTO_TRANSITION&quot;;</span>
 496 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497                 return &quot;PERIOD_TRANSITION&quot;;</span>
 498 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 499                 return &quot;PERIOD_TRANSITION&quot;;</span>
 500 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 501             case Player.DISCONTINUITY_REASON_SEEK:
 502                 return &quot;SEEK&quot;;
 503             case Player.DISCONTINUITY_REASON_SEEK_ADJUSTMENT:
 504                 return &quot;SEEK_ADJUSTMENT&quot;;
 505             case Player.DISCONTINUITY_REASON_INTERNAL:
 506                 return &quot;INTERNAL&quot;;
 507             case Player.DISCONTINUITY_REASON_REMOVE:
 508             case Player.DISCONTINUITY_REASON_SKIP:
 509             default:
 510                 return &quot;?&quot;;
 511         }
 512     }
 513 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 The Android Open Source Project
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package tv.danmaku.ijk.media.exo2.demo;
  17 
  18 import android.os.SystemClock;
  19 import android.util.Log;
  20 import androidx.annotation.NonNull;
  21 import com.google.android.exoplayer2.C;
  22 import com.google.android.exoplayer2.ExoPlaybackException;
  23 import com.google.android.exoplayer2.Format;
  24 import com.google.android.exoplayer2.PlaybackParameters;
  25 import com.google.android.exoplayer2.Player;
  26 import com.google.android.exoplayer2.RendererCapabilities;
  27 import com.google.android.exoplayer2.Timeline;
  28 import com.google.android.exoplayer2.audio.AudioRendererEventListener;
  29 import com.google.android.exoplayer2.decoder.DecoderCounters;
  30 import com.google.android.exoplayer2.decoder.DecoderReuseEvaluation;
  31 import com.google.android.exoplayer2.metadata.Metadata;
  32 import com.google.android.exoplayer2.metadata.MetadataOutput;
  33 import com.google.android.exoplayer2.metadata.emsg.EventMessage;
  34 import com.google.android.exoplayer2.metadata.id3.ApicFrame;
  35 import com.google.android.exoplayer2.metadata.id3.CommentFrame;
  36 import com.google.android.exoplayer2.metadata.id3.GeobFrame;
  37 import com.google.android.exoplayer2.metadata.id3.Id3Frame;
  38 import com.google.android.exoplayer2.metadata.id3.PrivFrame;
  39 import com.google.android.exoplayer2.metadata.id3.TextInformationFrame;
  40 import com.google.android.exoplayer2.metadata.id3.UrlLinkFrame;
  41 import com.google.android.exoplayer2.source.MediaSourceEventListener;
  42 import com.google.android.exoplayer2.source.TrackGroup;
  43 import com.google.android.exoplayer2.source.TrackGroupArray;
  44 import com.google.android.exoplayer2.text.Cue;
  45 import com.google.android.exoplayer2.trackselection.MappingTrackSelector.MappedTrackInfo;
  46 import com.google.android.exoplayer2.trackselection.MappingTrackSelector;
  47 import com.google.android.exoplayer2.trackselection.TrackSelection;
  48 import com.google.android.exoplayer2.trackselection.TrackSelectionArray;
  49 import com.google.android.exoplayer2.video.VideoRendererEventListener;
  50 import com.google.android.exoplayer2.video.VideoSize;
  51 import java.text.NumberFormat;
  52 import java.util.List;
  53 import java.util.Locale;
  54 
  55 
<abbr title="  56 public final class EventLogger implements Player.Listener , MetadataOutput , AudioRendererEventListener , VideoRendererEventListener , MediaSourceEventListener {">  56 public final class EventLogger implements Player.Listener , MetadataOutput , AudioRendererEventListener ,🔵</abbr>
  57     @Override
  58 
  59 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  60     public void onTimelineChanged(Timeline timeline, int reason) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  61         int periodCount = timeline.getPeriodCount();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  62         int windowCount = timeline.getWindowCount();</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  63         Log.d(TAG, &quot;sourceInfo [periodCount=&quot; + periodCount + &quot;, windowCount=&quot; + windowCount);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  64         for (int i = 0; i &lt; Math.min(periodCount, MAX_TIMELINE_ITEM_LINES); i++) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  65             timeline.getPeriod(i, period);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  66             Log.d(TAG, &quot;  &quot; + &quot;period [&quot; + getTimeString(period.getDurationMs()) + &quot;]&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68         if (periodCount &gt; MAX_TIMELINE_ITEM_LINES) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  69             Log.d(TAG, &quot;  ...&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  71         for (int i = 0; i &lt; Math.min(windowCount, MAX_TIMELINE_ITEM_LINES); i++) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  72             timeline.getWindow(i, window);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  73             Log.d(TAG, &quot;  &quot; + &quot;window [&quot; + getTimeString(window.getDurationMs()) + &quot;, &quot;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  74                     + window.isSeekable + &quot;, &quot; + window.isDynamic + &quot;]&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76         if (windowCount &gt; MAX_TIMELINE_ITEM_LINES) {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77             Log.d(TAG, &quot;  ...&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78         }</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79         Log.d(TAG, &quot;]&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80 </span>
  81 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  82 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">  82 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
  83 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85     public void onSkipSilenceEnabledChanged(boolean skipSilenceEnabled) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87 </span>
  88 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
  89     }
  90 
  91     private static final String TAG = &quot;EventLogger&quot;;
  92 
  93     private static final int MAX_TIMELINE_ITEM_LINES = 3;
  94 
  95     private static final NumberFormat TIME_FORMAT;
  96 
  97     static {
  98         TIME_FORMAT = NumberFormat.getInstance(Locale.US);
  99         TIME_FORMAT.setMinimumFractionDigits(2);
 100         TIME_FORMAT.setMaximumFractionDigits(2);
 101         TIME_FORMAT.setGroupingUsed(false);
 102     }
 103 
 104     private final MappingTrackSelector trackSelector;
 105 
 106     private final Timeline.Window window;
 107 
 108     private final Timeline.Period period;
 109 
 110     private final long startTimeMs;
 111 
 112     public EventLogger(MappingTrackSelector trackSelector) {
 113         this.trackSelector = trackSelector;
 114         window = new Timeline.Window();
 115         period = new Timeline.Period();
 116         startTimeMs = SystemClock.elapsedRealtime();
 117     }
 118 
 119     // Player.EventListener
 120     @Override
 121     public void onCues(List&lt;Cue&gt; cues) {
 122     }
 123 
 124     @Override
 125     public void onIsLoadingChanged(boolean isLoading) {
 126         Log.d(TAG, (&quot;loading [&quot; + isLoading) + &quot;]&quot;);
 127     }
 128 
 129     @Override
 130     public void onRepeatModeChanged(@Player.RepeatMode int repeatMode) {
 131         Log.d(TAG, &quot;repeatMode [&quot; + getRepeatModeString(repeatMode) + &quot;]&quot;);
 132     }
 133 
 134     @Override
 135     public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {
 136         Log.d(TAG, &quot;shuffleModeEnabled [&quot; + shuffleModeEnabled + &quot;]&quot;);
 137     }
 138 
 139     private static String getDiscontinuityReasonString(@Player.DiscontinuityReason
 140     int reason) {
 141         switch (reason) {
 142             case Player.DISCONTINUITY_REASON_AUTO_TRANSITION :
 143                 return &quot;AUTO_TRANSITION&quot;;
 144             case Player.DISCONTINUITY_REASON_SEEK :
 145                 return &quot;SEEK&quot;;
 146             case Player.DISCONTINUITY_REASON_SEEK_ADJUSTMENT :
 147                 return &quot;SEEK_ADJUSTMENT&quot;;
 148             case Player.DISCONTINUITY_REASON_INTERNAL :
 149                 return &quot;INTERNAL&quot;;
 150             case Player.DISCONTINUITY_REASON_REMOVE :
 151             case Player.DISCONTINUITY_REASON_SKIP :
 152             default :
 153                 return &quot;?&quot;;
 154         }
 155     }
 156 
 157     @Override
 158     public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {
 159         Log.d(TAG, &quot;playbackParameters &quot; + String.format(
 160                 &quot;[speed=%.2f, pitch=%.2f]&quot;, playbackParameters.speed, playbackParameters.pitch));
 161     }
 162 
 163     @Override
 164     public void onPlayerError(@NonNull
 165     ExoPlaybackException e) {
 166         Log.e(TAG, (&quot;playerFailed [&quot; + getSessionTimeString()) + &quot;]&quot;, e);
 167     }
 168 
 169     @Override
 170     public void onTracksChanged(@NonNull
 171     TrackGroupArray ignored, @NonNull
 172     TrackSelectionArray trackSelections) {
 173         MappedTrackInfo mappedTrackInfo = trackSelector.getCurrentMappedTrackInfo();
 174         if (mappedTrackInfo == null) {
 175             Log.d(TAG, &quot;Tracks []&quot;);
 176             return;
 177         }
 178         Log.d(TAG, &quot;Tracks [&quot;);
 179         // Log tracks associated to renderers.
<abbr title=" 180         for (int rendererIndex = 0; rendererIndex &lt; mappedTrackInfo.getRendererCount(); rendererIndex++) {"> 180         for (int rendererIndex = 0; rendererIndex &lt; mappedTrackInfo.getRendererCount(); rendererIndex++) 🔵</abbr>
 181             TrackGroupArray rendererTrackGroups = mappedTrackInfo.getTrackGroups(rendererIndex);
 182             TrackSelection trackSelection = trackSelections.get(rendererIndex);
 183             if (rendererTrackGroups.length &gt; 0) {
 184                 Log.d(TAG, (&quot;  Renderer:&quot; + rendererIndex) + &quot; [&quot;);
 185                 for (int groupIndex = 0; groupIndex &lt; rendererTrackGroups.length; groupIndex++) {
 186                     TrackGroup trackGroup = rendererTrackGroups.get(groupIndex);
<abbr title=" 187                     String adaptiveSupport = getAdaptiveSupportString(trackGroup.length, mappedTrackInfo.getAdaptiveSupport(rendererIndex, groupIndex, false));"> 187                     String adaptiveSupport = getAdaptiveSupportString(trackGroup.length, mappedTrackInfo.🔵</abbr>
<abbr title=" 188                     Log.d(TAG, (((&quot;    Group:&quot; + groupIndex) + &quot;, adaptive_supported=&quot;) + adaptiveSupport) + &quot; [&quot;);"> 188                     Log.d(TAG, (((&quot;    Group:&quot; + groupIndex) + &quot;, adaptive_supported=&quot;) + adaptiveSupport🔵</abbr>
 189                     Log.d(TAG, &quot;    ]&quot;);
 190                 }
 191                 // Log metadata for at most one of the tracks selected for the renderer.
 192                 if (trackSelection != null) {
<abbr title=" 193                     for (int selectionIndex = 0; selectionIndex &lt; trackSelection.length(); selectionIndex++) {"> 193                     for (int selectionIndex = 0; selectionIndex &lt; trackSelection.length(); selectionIndex🔵</abbr>
 194                         Metadata metadata = trackSelection.getFormat(selectionIndex).metadata;
 195                         if (metadata != null) {
 196                             Log.d(TAG, &quot;    Metadata [&quot;);
 197                             printMetadata(metadata, &quot;      &quot;);
 198                             Log.d(TAG, &quot;    ]&quot;);
 199                             break;
 200                         }
 201                     }
 202                 }
 203                 Log.d(TAG, &quot;  ]&quot;);
 204             }
 205         }
 206         // Log tracks not associated with a renderer.
 207         TrackGroupArray unassociatedTrackGroups = mappedTrackInfo.getUnmappedTrackGroups();
 208         if (unassociatedTrackGroups.length &gt; 0) {
 209             Log.d(TAG, &quot;  Renderer:None [&quot;);
 210             for (int groupIndex = 0; groupIndex &lt; unassociatedTrackGroups.length; groupIndex++) {
 211                 Log.d(TAG, (&quot;    Group:&quot; + groupIndex) + &quot; [&quot;);
 212                 TrackGroup trackGroup = unassociatedTrackGroups.get(groupIndex);
 213                 for (int trackIndex = 0; trackIndex &lt; trackGroup.length; trackIndex++) {
 214                     String status = getTrackStatusString(false);
 215                     String formatSupport = getFormatSupportString(C.FORMAT_UNSUPPORTED_TYPE);
<abbr title=" 216                     Log.d(TAG, ((((((&quot;      &quot; + status) + &quot; Track:&quot;) + trackIndex) + &quot;, &quot;) + Format.toLogString(trackGroup.getFormat(trackIndex))) + &quot;, supported=&quot;) + formatSupport);"> 216                     Log.d(TAG, ((((((&quot;      &quot; + status) + &quot; Track:&quot;) + trackIndex) + &quot;, &quot;) + Format.toLog🔵</abbr>
 217                 }
 218                 Log.d(TAG, &quot;    ]&quot;);
 219             }
 220             Log.d(TAG, &quot;  ]&quot;);
 221         }
 222         Log.d(TAG, &quot;]&quot;);
 223     }
 224 
 225     // MetadataOutput
 226     @Override
 227     public void onMetadata(@NonNull
 228     Metadata metadata) {
 229         Log.d(TAG, &quot;onMetadata [&quot;);
 230         printMetadata(metadata, &quot;  &quot;);
 231         Log.d(TAG, &quot;]&quot;);
 232     }
 233 
 234     // AudioRendererEventListener
 235 
 236     @Override
 237     public void onAudioEnabled(DecoderCounters counters) {
 238         Log.d(TAG, &quot;audioEnabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 239     }
 240 
 241     @Override
 242     public void onAudioDecoderInitialized(String decoderName, long elapsedRealtimeMs,
 243                                           long initializationDurationMs) {
 244         Log.d(TAG, &quot;audioDecoderInitialized [&quot; + getSessionTimeString() + &quot;, &quot; + decoderName + &quot;]&quot;);
 245     }
 246 
 247     @Override
 248     public void onAudioInputFormatChanged(Format format,
 249 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 250 @Nullable DecoderReuseEvaluation decoderReuseEvaluation</span>
 251 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 252 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 252 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
 253 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255 DecoderReuseEvaluation decoderReuseEvaluation</span>
 256 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 257     ) {
<abbr title=" 258         Log.d(TAG, (((&quot;audioFormatChanged [&quot; + getSessionTimeString()) + &quot;, &quot;) + Format.toLogString(format)) + &quot;]&quot;);"> 258         Log.d(TAG, (((&quot;audioFormatChanged [&quot; + getSessionTimeString()) + &quot;, &quot;) + Format.toLogString(forma🔵</abbr>
 259     }
 260 
 261     @Override
 262     public void onAudioDisabled(DecoderCounters counters) {
 263         Log.d(TAG, &quot;audioDisabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 264     }
 265 
 266     // VideoRendererEventListener
 267 
 268     @Override
 269     public void onVideoEnabled(DecoderCounters counters) {
 270         Log.d(TAG, &quot;videoEnabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 271     }
 272 
 273     @Override
 274     public void onVideoDecoderInitialized(String decoderName, long elapsedRealtimeMs,
 275                                           long initializationDurationMs) {
 276         Log.d(TAG, &quot;videoDecoderInitialized [&quot; + getSessionTimeString() + &quot;, &quot; + decoderName + &quot;]&quot;);
 277     }
 278 
 279     @Override
 280     public void onVideoInputFormatChanged(Format format,
 281 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 282 @Nullable DecoderReuseEvaluation decoderReuseEvaluation</span>
 283 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 284 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 284 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
 285 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287 DecoderReuseEvaluation decoderReuseEvaluation</span>
 288 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 289     ) {
<abbr title=" 290         Log.d(TAG, (((&quot;videoFormatChanged [&quot; + getSessionTimeString()) + &quot;, &quot;) + Format.toLogString(format)) + &quot;]&quot;);"> 290         Log.d(TAG, (((&quot;videoFormatChanged [&quot; + getSessionTimeString()) + &quot;, &quot;) + Format.toLogString(forma🔵</abbr>
 291     }
 292 
 293     @Override
 294     public void onVideoDisabled(DecoderCounters counters) {
 295         Log.d(TAG, &quot;videoDisabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 296     }
 297 
 298     @Override
 299     public void onDroppedFrames(int count, long elapsed) {
 300         Log.d(TAG, &quot;droppedFrames [&quot; + getSessionTimeString() + &quot;, &quot; + count + &quot;]&quot;);
 301     }
 302 
 303     @Override
 304     public void onPositionDiscontinuity(
 305 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 306             @NonNull Player.PositionInfo oldPosition,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 307             @NonNull Player.PositionInfo newPosition</span>
 308 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 309 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 309 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
 310 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312 Player.PositionInfo oldPosition, Player.PositionInfo newPosition</span>
 313 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 314     , @Player.DiscontinuityReason
 315     int reason) {
 316         Log.d(TAG, (&quot;positionDiscontinuity [&quot; + getDiscontinuityReasonString(reason)) + &quot;]&quot;);
 317     }
 318 
 319     //MediaSourceEventListener
 320     // Internal methods
 321     private void printMetadata(Metadata metadata, String prefix) {
 322         for (int i = 0; i &lt; metadata.length(); i++) {
 323             Metadata.Entry entry = metadata.get(i);
 324             if (entry instanceof TextInformationFrame) {
 325                 TextInformationFrame textInformationFrame = ((TextInformationFrame) (entry));
<abbr title=" 326                 Log.d(TAG, prefix + String.format(&quot;%s: value=%s&quot;, textInformationFrame.id, textInformationFrame.value));"> 326                 Log.d(TAG, prefix + String.format(&quot;%s: value=%s&quot;, textInformationFrame.id, textInformatio🔵</abbr>
 327             } else if (entry instanceof UrlLinkFrame) {
 328                 UrlLinkFrame urlLinkFrame = ((UrlLinkFrame) (entry));
 329                 Log.d(TAG, prefix + String.format(&quot;%s: url=%s&quot;, urlLinkFrame.id, urlLinkFrame.url));
 330             } else if (entry instanceof PrivFrame) {
 331                 PrivFrame privFrame = ((PrivFrame) (entry));
 332                 Log.d(TAG, prefix + String.format(&quot;%s: owner=%s&quot;, privFrame.id, privFrame.owner));
 333             } else if (entry instanceof GeobFrame) {
 334                 GeobFrame geobFrame = ((GeobFrame) (entry));
<abbr title=" 335                 Log.d(TAG, prefix + String.format(&quot;%s: mimeType=%s, filename=%s, description=%s&quot;, geobFrame.id, geobFrame.mimeType, geobFrame.filename, geobFrame.description));"> 335                 Log.d(TAG, prefix + String.format(&quot;%s: mimeType=%s, filename=%s, description=%s&quot;, geobFra🔵</abbr>
 336             } else if (entry instanceof ApicFrame) {
 337                 ApicFrame apicFrame = ((ApicFrame) (entry));
<abbr title=" 338                 Log.d(TAG, prefix + String.format(&quot;%s: mimeType=%s, description=%s&quot;, apicFrame.id, apicFrame.mimeType, apicFrame.description));"> 338                 Log.d(TAG, prefix + String.format(&quot;%s: mimeType=%s, description=%s&quot;, apicFrame.id, apicFr🔵</abbr>
 339             } else if (entry instanceof CommentFrame) {
 340                 CommentFrame commentFrame = ((CommentFrame) (entry));
<abbr title=" 341                 Log.d(TAG, prefix + String.format(&quot;%s: language=%s, description=%s&quot;, commentFrame.id, commentFrame.language, commentFrame.description));"> 341                 Log.d(TAG, prefix + String.format(&quot;%s: language=%s, description=%s&quot;, commentFrame.id, com🔵</abbr>
 342             } else if (entry instanceof Id3Frame) {
 343                 Id3Frame id3Frame = ((Id3Frame) (entry));
 344                 Log.d(TAG, prefix + String.format(&quot;%s&quot;, id3Frame.id));
 345             } else if (entry instanceof EventMessage) {
 346                 EventMessage eventMessage = ((EventMessage) (entry));
<abbr title=" 347                 Log.d(TAG, prefix + String.format(&quot;EMSG: scheme=%s, id=%d, value=%s&quot;, eventMessage.schemeIdUri, eventMessage.id, eventMessage.value));"> 347                 Log.d(TAG, prefix + String.format(&quot;EMSG: scheme=%s, id=%d, value=%s&quot;, eventMessage.scheme🔵</abbr>
 348             }
 349         }
 350     }
 351 
 352     private String getSessionTimeString() {
 353         return getTimeString(SystemClock.elapsedRealtime() - startTimeMs);
 354     }
 355 
 356     private static String getTimeString(long timeMs) {
 357         return timeMs == C.TIME_UNSET ? &quot;?&quot; : TIME_FORMAT.format((timeMs) / 1000f);
 358     }
 359 
 360     private static String getStateString(int state) {
 361         switch (state) {
 362             case Player.STATE_BUFFERING:
 363                 return &quot;B&quot;;
 364             case Player.STATE_ENDED:
 365                 return &quot;E&quot;;
 366             case Player.STATE_IDLE:
 367                 return &quot;I&quot;;
 368             case Player.STATE_READY:
 369                 return &quot;R&quot;;
 370             default:
 371                 return &quot;?&quot;;
 372         }
 373     }
 374 
 375     private static String getFormatSupportString(int formatSupport) {
 376         switch (formatSupport) {
 377             case C.FORMAT_HANDLED :
 378                 return &quot;YES&quot;;
 379             case C.FORMAT_EXCEEDS_CAPABILITIES :
 380                 return &quot;NO_EXCEEDS_CAPABILITIES&quot;;
 381             case C.FORMAT_UNSUPPORTED_DRM :
 382                 return &quot;NO_UNSUPPORTED_DRM&quot;;
 383             case C.FORMAT_UNSUPPORTED_SUBTYPE :
 384                 return &quot;NO_UNSUPPORTED_TYPE&quot;;
 385             case C.FORMAT_UNSUPPORTED_TYPE :
 386                 return &quot;NO&quot;;
 387             default :
 388                 return &quot;?&quot;;
 389         }
 390     }
 391 
 392     private static String getAdaptiveSupportString(int trackCount, int adaptiveSupport) {
 393         if (trackCount &lt; 2) {
 394             return &quot;N/A&quot;;
 395         }
 396         switch (adaptiveSupport) {
 397             case RendererCapabilities.ADAPTIVE_SEAMLESS:
 398                 return &quot;YES&quot;;
 399             case RendererCapabilities.ADAPTIVE_NOT_SEAMLESS:
 400                 return &quot;YES_NOT_SEAMLESS&quot;;
 401             case RendererCapabilities.ADAPTIVE_NOT_SUPPORTED:
 402                 return &quot;NO&quot;;
 403             default:
 404                 return &quot;?&quot;;
 405         }
 406     }
 407 
 408     private static String getTrackStatusString(TrackSelection selection, TrackGroup group,
 409                                                int trackIndex) {
 410         return getTrackStatusString(selection != null &amp;&amp; selection.getTrackGroup() == group
 411                 &amp;&amp; selection.indexOf(trackIndex) != C.INDEX_UNSET);
 412     }
 413 
 414     private static String getTrackStatusString(boolean enabled) {
 415         return enabled ? &quot;[X]&quot; : &quot;[ ]&quot;;
 416     }
 417 
 418     private static String getRepeatModeString(@Player.RepeatMode int repeatMode) {
 419         switch (repeatMode) {
 420             case Player.REPEAT_MODE_OFF:
 421                 return &quot;OFF&quot;;
 422             case Player.REPEAT_MODE_ONE:
 423                 return &quot;ONE&quot;;
 424             case Player.REPEAT_MODE_ALL:
 425                 return &quot;ALL&quot;;
 426             default:
 427                 return &quot;?&quot;;
 428         }
 429     }
 430 
 431     @Override
 432     public void onRenderedFirstFrame(Object output, long renderTimeMs) {
 433         if (output instanceof Surface) {
 434             Log.d(TAG, (&quot;renderedFirstFrame [&quot; + ((Surface) (output))) + &quot;]&quot;);
 435         }
 436     }
 437 
 438     @Override
 439     public void onPlaybackStateChanged(@Player.State
 440     int state) {
 441         boolean playWhenReady = state == Player.STATE_READY;
 442         Log.d(TAG,
 443 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 444 &quot;state [&quot; + getSessionTimeString() + &quot;, &quot; + playWhenReady + &quot;, &quot;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 445                 + getStateString(state) + &quot;]&quot;</span>
 446 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 447 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 447 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
 448 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 449 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 450 &quot;internalError [&quot; + getSessionTimeString() + &quot;, &quot; + type + &quot;]&quot;</span>
 451 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 452         );
 453     }
 454 
 455     @Override
 456     public void onVideoSizeChanged(VideoSize videoSize)
 457 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 458 {</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 459         Log.d(TAG, &quot;videoSizeChanged [&quot; + videoSize.width + &quot;, &quot; + videoSize.height + &quot;]&quot;);</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 460     }</span>
 461 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 462 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 462 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
 463 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 464 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 465 {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 466         Log.d(TAG, &quot;videoSizeChanged [&quot; + width + &quot;, &quot; + height + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 467     }</span>
 468 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 469 
 470 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 The Android Open Source Project
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  package tv.danmaku.ijk.media.exo2.demo;
  17  
  18  import android.os.SystemClock;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -import androidx.annotation.Nullable;</span>

  20  import android.util.Log;
  21  import android.view.Surface;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  22 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  23 +import androidx.annotation.NonNull;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  24 +import androidx.annotation.Nullable;</span>
  25  
  26  import com.google.android.exoplayer2.C;
  27  import com.google.android.exoplayer2.ExoPlaybackException;
  28  import com.google.android.exoplayer2.Format;
  29  import com.google.android.exoplayer2.PlaybackParameters;
  30  import com.google.android.exoplayer2.Player;
  31  import com.google.android.exoplayer2.RendererCapabilities;
  32  import com.google.android.exoplayer2.Timeline;
  33  import com.google.android.exoplayer2.audio.AudioRendererEventListener;
  34  import com.google.android.exoplayer2.decoder.DecoderCounters;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  35 +import com.google.android.exoplayer2.decoder.DecoderReuseEvaluation;</span>
  36  import com.google.android.exoplayer2.metadata.Metadata;
  37  import com.google.android.exoplayer2.metadata.MetadataOutput;
  38  import com.google.android.exoplayer2.metadata.emsg.EventMessage;
  39  import com.google.android.exoplayer2.metadata.id3.ApicFrame;
  40  import com.google.android.exoplayer2.metadata.id3.CommentFrame;
  41  import com.google.android.exoplayer2.metadata.id3.GeobFrame;
  42  import com.google.android.exoplayer2.metadata.id3.Id3Frame;
  43  import com.google.android.exoplayer2.metadata.id3.PrivFrame;
  44  import com.google.android.exoplayer2.metadata.id3.TextInformationFrame;
  45  import com.google.android.exoplayer2.metadata.id3.UrlLinkFrame;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -import com.google.android.exoplayer2.source.MediaSource;</span>
  47  import com.google.android.exoplayer2.source.MediaSourceEventListener;
  48  import com.google.android.exoplayer2.source.TrackGroup;
  49  import com.google.android.exoplayer2.source.TrackGroupArray;

  50  import com.google.android.exoplayer2.trackselection.MappingTrackSelector;
  51  import com.google.android.exoplayer2.trackselection.MappingTrackSelector.MappedTrackInfo;
  52  import com.google.android.exoplayer2.trackselection.TrackSelection;
  53  import com.google.android.exoplayer2.trackselection.TrackSelectionArray;
  54  import com.google.android.exoplayer2.video.VideoRendererEventListener;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -import java.io.IOException;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  57 +import com.google.android.exoplayer2.video.VideoSize;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +</span>
  59  import java.text.NumberFormat;

  60  import java.util.Locale;
  61  
  62  
  63  public final class EventLogger implements Player.EventListener, MetadataOutput,
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -        AudioRendererEventListener, VideoRendererEventListener, MediaSourceEventListener{</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +        AudioRendererEventListener, VideoRendererEventListener, MediaSourceEventListener {</span>

  66  
  67      private static final String TAG = &quot;EventLogger&quot;;
  68      private static final int MAX_TIMELINE_ITEM_LINES = 3;
  69      private static final NumberFormat TIME_FORMAT;
  70  
  71      static {
  72          TIME_FORMAT = NumberFormat.getInstance(Locale.US);
  73          TIME_FORMAT.setMinimumFractionDigits(2);
  74          TIME_FORMAT.setMaximumFractionDigits(2);
  75          TIME_FORMAT.setGroupingUsed(false);
  76      }
  77  
  78      private final MappingTrackSelector trackSelector;
  79      private final Timeline.Window window;
  80      private final Timeline.Period period;
  81      private final long startTimeMs;
  82  
  83      public EventLogger(MappingTrackSelector trackSelector) {
  84          this.trackSelector = trackSelector;
  85          window = new Timeline.Window();
  86          period = new Timeline.Period();
  87          startTimeMs = SystemClock.elapsedRealtime();
  88      }
  89  

  90      // Player.EventListener
  91  
  92      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -    public void onLoadingChanged(boolean isLoading) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  94 +    public void onIsLoadingChanged(boolean isLoading) {</span>







  95          Log.d(TAG, &quot;loading [&quot; + isLoading + &quot;]&quot;);
  96      }
  97  
  98      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  99 -    public void onPlayerStateChanged(boolean playWhenReady, int state) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +    public void onPlaybackStateChanged(int state) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +        boolean playWhenReady = state == Player.STATE_READY;</span>





 102          Log.d(TAG, &quot;state [&quot; + getSessionTimeString() + &quot;, &quot; + playWhenReady + &quot;, &quot;
 103                  + getStateString(state) + &quot;]&quot;);
 104      }
 105  
 106      @Override
 107      public void onRepeatModeChanged(@Player.RepeatMode int repeatMode) {
 108          Log.d(TAG, &quot;repeatMode [&quot; + getRepeatModeString(repeatMode) + &quot;]&quot;);
 109      }
 110  
 111      @Override
 112      public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {
 113          Log.d(TAG, &quot;shuffleModeEnabled [&quot; + shuffleModeEnabled + &quot;]&quot;);
 114      }
 115  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -    public void onPositionDiscontinuity(@Player.DiscontinuityReason int reason) {</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 118 -        Log.d(TAG, &quot;positionDiscontinuity [&quot; + getDiscontinuityReasonString(reason) + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +    private static String getDiscontinuityReasonString(@Player.DiscontinuityReason int reason) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +        switch (reason) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +            case Player.DISCONTINUITY_REASON_AUTO_TRANSITION:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +                return &quot;AUTO_TRANSITION&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +            case Player.DISCONTINUITY_REASON_SEEK:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +                return &quot;SEEK&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +            case Player.DISCONTINUITY_REASON_SEEK_ADJUSTMENT:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +                return &quot;SEEK_ADJUSTMENT&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +            case Player.DISCONTINUITY_REASON_INTERNAL:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +                return &quot;INTERNAL&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +            default:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +                return &quot;?&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +        }</span>
 132      }
 133  
 134      @Override
 135      public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {
 136          Log.d(TAG, &quot;playbackParameters &quot; + String.format(
 137                  &quot;[speed=%.2f, pitch=%.2f]&quot;, playbackParameters.speed, playbackParameters.pitch));
 138      }
 139  
 140      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 141 -    public void onPlayerError(ExoPlaybackException e) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +    public void onPlayerError(@NonNull ExoPlaybackException e) {</span>
 143          Log.e(TAG, &quot;playerFailed [&quot; + getSessionTimeString() + &quot;]&quot;, e);
 144      }
 145  
 146      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 147 -    public void onTracksChanged(TrackGroupArray ignored, TrackSelectionArray trackSelections) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +    public void onTracksChanged(@NonNull TrackGroupArray ignored, @NonNull TrackSelectionArray trackSelections) {</span>
 149          MappedTrackInfo mappedTrackInfo = trackSelector.getCurrentMappedTrackInfo();
 150          if (mappedTrackInfo == null) {
 151              Log.d(TAG, &quot;Tracks []&quot;);
 152              return;
 153          }
 154          Log.d(TAG, &quot;Tracks [&quot;);
 155          // Log tracks associated to renderers.
 156          for (int rendererIndex = 0; rendererIndex &lt; mappedTrackInfo.getRendererCount(); rendererIndex++) {
 157              TrackGroupArray rendererTrackGroups = mappedTrackInfo.getTrackGroups(rendererIndex);
 158              TrackSelection trackSelection = trackSelections.get(rendererIndex);
 159              if (rendererTrackGroups.length &gt; 0) {
 160                  Log.d(TAG, &quot;  Renderer:&quot; + rendererIndex + &quot; [&quot;);
 161                  for (int groupIndex = 0; groupIndex &lt; rendererTrackGroups.length; groupIndex++) {
 162                      TrackGroup trackGroup = rendererTrackGroups.get(groupIndex);
 163                      String adaptiveSupport = getAdaptiveSupportString(trackGroup.length,
 164                              mappedTrackInfo.getAdaptiveSupport(rendererIndex, groupIndex, false));
 165                      Log.d(TAG, &quot;    Group:&quot; + groupIndex + &quot;, adaptive_supported=&quot; + adaptiveSupport + &quot; [&quot;);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 166 -                    for (int trackIndex = 0; trackIndex &lt; trackGroup.length; trackIndex++) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -                        String status = getTrackStatusString(trackSelection, trackGroup, trackIndex);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 168 -                        /*String formatSupport = getFormatSupportString(</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 169 -                                mappedTrackInfo.getTrackFormatSupport(rendererIndex, groupIndex, trackIndex));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 170 -                        Log.d(TAG, &quot;      &quot; + status + &quot; Track:&quot; + trackIndex + &quot;, &quot;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 171 -                                + Format.toLogString(trackGroup.getFormat(trackIndex))</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 172 -                                + &quot;, supported=&quot; + formatSupport);*/</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 173 -                    }</span>
 174                      Log.d(TAG, &quot;    ]&quot;);
 175                  }
 176                  // Log metadata for at most one of the tracks selected for the renderer.
 177                  if (trackSelection != null) {
 178                      for (int selectionIndex = 0; selectionIndex &lt; trackSelection.length(); selectionIndex++) {
 179                          Metadata metadata = trackSelection.getFormat(selectionIndex).metadata;
 180                          if (metadata != null) {
 181                              Log.d(TAG, &quot;    Metadata [&quot;);
 182                              printMetadata(metadata, &quot;      &quot;);
 183                              Log.d(TAG, &quot;    ]&quot;);
 184                              break;
 185                          }
 186                      }
 187                  }
 188                  Log.d(TAG, &quot;  ]&quot;);
 189              }
 190          }
 191          // Log tracks not associated with a renderer.
 192          TrackGroupArray unassociatedTrackGroups = mappedTrackInfo.getUnmappedTrackGroups();
 193          if (unassociatedTrackGroups.length &gt; 0) {
 194              Log.d(TAG, &quot;  Renderer:None [&quot;);
 195              for (int groupIndex = 0; groupIndex &lt; unassociatedTrackGroups.length; groupIndex++) {
 196                  Log.d(TAG, &quot;    Group:&quot; + groupIndex + &quot; [&quot;);
 197                  TrackGroup trackGroup = unassociatedTrackGroups.get(groupIndex);
 198                  for (int trackIndex = 0; trackIndex &lt; trackGroup.length; trackIndex++) {
 199                      String status = getTrackStatusString(false);
 200                      String formatSupport = getFormatSupportString(
 201                              RendererCapabilities.FORMAT_UNSUPPORTED_TYPE);

 202                      Log.d(TAG, &quot;      &quot; + status + &quot; Track:&quot; + trackIndex + &quot;, &quot;
 203                              + Format.toLogString(trackGroup.getFormat(trackIndex))
 204                              + &quot;, supported=&quot; + formatSupport);
 205                  }
 206                  Log.d(TAG, &quot;    ]&quot;);
 207              }
 208              Log.d(TAG, &quot;  ]&quot;);
 209          }
 210          Log.d(TAG, &quot;]&quot;);
 211      }
 212  
 213      @Override
 214      public void onSeekProcessed() {
 215          Log.d(TAG, &quot;seekProcessed&quot;);
 216      }
 217  
 218      // MetadataOutput
 219  
 220      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 221 -    public void onMetadata(Metadata metadata) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 222 +    public void onMetadata(@NonNull Metadata metadata) {</span>
 223          Log.d(TAG, &quot;onMetadata [&quot;);
 224          printMetadata(metadata, &quot;  &quot;);
 225          Log.d(TAG, &quot;]&quot;);
 226      }
 227  
 228      // AudioRendererEventListener
 229  
 230      @Override
 231      public void onAudioEnabled(DecoderCounters counters) {
 232          Log.d(TAG, &quot;audioEnabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 233      }
 234  
 235      @Override
 236      public void onAudioDecoderInitialized(String decoderName, long elapsedRealtimeMs,
 237                                            long initializationDurationMs) {
 238          Log.d(TAG, &quot;audioDecoderInitialized [&quot; + getSessionTimeString() + &quot;, &quot; + decoderName + &quot;]&quot;);
 239      }
 240  
 241      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 242 -    public void onAudioInputFormatChanged(Format format) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 243 +    public void onAudioInputFormatChanged(Format format, @Nullable DecoderReuseEvaluation decoderReuseEvaluation) {"> 243 +    public void onAudioInputFormatChanged(Format format, @Nullable DecoderReuseEvaluation decoderReuseEvaluation) 🔵</abbr></span>
 244          Log.d(TAG, &quot;audioFormatChanged [&quot; + getSessionTimeString() + &quot;, &quot; + Format.toLogString(format)
 245                  + &quot;]&quot;);
 246      }
 247  
 248      @Override
 249      public void onAudioDisabled(DecoderCounters counters) {
 250          Log.d(TAG, &quot;audioDisabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 251      }
 252  
 253      // VideoRendererEventListener
 254  
 255      @Override
 256      public void onVideoEnabled(DecoderCounters counters) {
 257          Log.d(TAG, &quot;videoEnabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 258      }
 259  
 260      @Override
 261      public void onVideoDecoderInitialized(String decoderName, long elapsedRealtimeMs,
 262                                            long initializationDurationMs) {
 263          Log.d(TAG, &quot;videoDecoderInitialized [&quot; + getSessionTimeString() + &quot;, &quot; + decoderName + &quot;]&quot;);
 264      }
 265  
 266      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 267 -    public void onVideoInputFormatChanged(Format format) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 268 +    public void onVideoInputFormatChanged(Format format, @Nullable DecoderReuseEvaluation decoderReuseEvaluation) {"> 268 +    public void onVideoInputFormatChanged(Format format, @Nullable DecoderReuseEvaluation decoderReuseEvaluation) 🔵</abbr></span>
 269          Log.d(TAG, &quot;videoFormatChanged [&quot; + getSessionTimeString() + &quot;, &quot; + Format.toLogString(format)
 270                  + &quot;]&quot;);
 271      }
 272  
 273      @Override
 274      public void onVideoDisabled(DecoderCounters counters) {
 275          Log.d(TAG, &quot;videoDisabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 276      }
 277  
 278      @Override
 279      public void onDroppedFrames(int count, long elapsed) {
 280          Log.d(TAG, &quot;droppedFrames [&quot; + getSessionTimeString() + &quot;, &quot; + count + &quot;]&quot;);
 281      }
 282  
 283      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 284 -    public void onVideoSizeChanged(int width, int height, int unappliedRotationDegrees,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 285 -                                   float pixelWidthHeightRatio) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 286 -        Log.d(TAG, &quot;videoSizeChanged [&quot; + width + &quot;, &quot; + height + &quot;]&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 287 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 288 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 289 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 290 -    public void onRenderedFirstFrame(Surface surface) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 291 -        Log.d(TAG, &quot;renderedFirstFrame [&quot; + surface + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +    public void onPositionDiscontinuity(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +            @NonNull Player.PositionInfo oldPosition,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +            @NonNull Player.PositionInfo newPosition,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +            @Player.DiscontinuityReason int reason</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +    ) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +        Log.d(TAG, &quot;positionDiscontinuity [&quot; + getDiscontinuityReasonString(reason) + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +    public void onVideoSizeChanged(VideoSize videoSize) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 302 +        Log.d(TAG, &quot;videoSizeChanged [&quot; + videoSize.width + &quot;, &quot; + videoSize.height + &quot;]&quot;);</span>

 303      }
 304  
 305      //MediaSourceEventListener
 306  
 307      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 308 -    public void onTimelineChanged(Timeline timeline, Object manifest, int reason) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 309 +    public void onTimelineChanged(Timeline timeline, int reason) {</span>
 310          int periodCount = timeline.getPeriodCount();
 311          int windowCount = timeline.getWindowCount();
 312          Log.d(TAG, &quot;sourceInfo [periodCount=&quot; + periodCount + &quot;, windowCount=&quot; + windowCount);
 313          for (int i = 0; i &lt; Math.min(periodCount, MAX_TIMELINE_ITEM_LINES); i++) {
 314              timeline.getPeriod(i, period);
 315              Log.d(TAG, &quot;  &quot; + &quot;period [&quot; + getTimeString(period.getDurationMs()) + &quot;]&quot;);
 316          }
 317          if (periodCount &gt; MAX_TIMELINE_ITEM_LINES) {
 318              Log.d(TAG, &quot;  ...&quot;);
 319          }
 320          for (int i = 0; i &lt; Math.min(windowCount, MAX_TIMELINE_ITEM_LINES); i++) {
 321              timeline.getWindow(i, window);
 322              Log.d(TAG, &quot;  &quot; + &quot;window [&quot; + getTimeString(window.getDurationMs()) + &quot;, &quot;
 323                      + window.isSeekable + &quot;, &quot; + window.isDynamic + &quot;]&quot;);
 324          }
 325          if (windowCount &gt; MAX_TIMELINE_ITEM_LINES) {
 326              Log.d(TAG, &quot;  ...&quot;);
 327          }
 328          Log.d(TAG, &quot;]&quot;);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 329 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 330 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 331 -    // Internal methods</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 332 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 333 -    private void printInternalError(String type, Exception e) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 334 -        Log.e(TAG, &quot;internalError [&quot; + getSessionTimeString() + &quot;, &quot; + type + &quot;]&quot;, e);</span>
 335      }
 336  
 337      private void printMetadata(Metadata metadata, String prefix) {
 338          for (int i = 0; i &lt; metadata.length(); i++) {
 339              Metadata.Entry entry = metadata.get(i);
 340              if (entry instanceof TextInformationFrame) {
 341                  TextInformationFrame textInformationFrame = (TextInformationFrame) entry;
 342                  Log.d(TAG, prefix + String.format(&quot;%s: value=%s&quot;, textInformationFrame.id,
 343                          textInformationFrame.value));
 344              } else if (entry instanceof UrlLinkFrame) {
 345                  UrlLinkFrame urlLinkFrame = (UrlLinkFrame) entry;
 346                  Log.d(TAG, prefix + String.format(&quot;%s: url=%s&quot;, urlLinkFrame.id, urlLinkFrame.url));
 347              } else if (entry instanceof PrivFrame) {
 348                  PrivFrame privFrame = (PrivFrame) entry;
 349                  Log.d(TAG, prefix + String.format(&quot;%s: owner=%s&quot;, privFrame.id, privFrame.owner));
 350              } else if (entry instanceof GeobFrame) {
 351                  GeobFrame geobFrame = (GeobFrame) entry;
 352                  Log.d(TAG, prefix + String.format(&quot;%s: mimeType=%s, filename=%s, description=%s&quot;,
 353                          geobFrame.id, geobFrame.mimeType, geobFrame.filename, geobFrame.description));
 354              } else if (entry instanceof ApicFrame) {
 355                  ApicFrame apicFrame = (ApicFrame) entry;
 356                  Log.d(TAG, prefix + String.format(&quot;%s: mimeType=%s, description=%s&quot;,
 357                          apicFrame.id, apicFrame.mimeType, apicFrame.description));
 358              } else if (entry instanceof CommentFrame) {
 359                  CommentFrame commentFrame = (CommentFrame) entry;
 360                  Log.d(TAG, prefix + String.format(&quot;%s: language=%s, description=%s&quot;, commentFrame.id,
 361                          commentFrame.language, commentFrame.description));
 362              } else if (entry instanceof Id3Frame) {
 363                  Id3Frame id3Frame = (Id3Frame) entry;
 364                  Log.d(TAG, prefix + String.format(&quot;%s&quot;, id3Frame.id));
 365              } else if (entry instanceof EventMessage) {
 366                  EventMessage eventMessage = (EventMessage) entry;
 367                  Log.d(TAG, prefix + String.format(&quot;EMSG: scheme=%s, id=%d, value=%s&quot;,
 368                          eventMessage.schemeIdUri, eventMessage.id, eventMessage.value));
 369              }
 370          }
 371      }
 372  
 373      private String getSessionTimeString() {
 374          return getTimeString(SystemClock.elapsedRealtime() - startTimeMs);
 375      }
 376  
 377      private static String getTimeString(long timeMs) {
 378          return timeMs == C.TIME_UNSET ? &quot;?&quot; : TIME_FORMAT.format((timeMs) / 1000f);
 379      }
 380  
 381      private static String getStateString(int state) {
 382          switch (state) {
 383              case Player.STATE_BUFFERING:
 384                  return &quot;B&quot;;
 385              case Player.STATE_ENDED:
 386                  return &quot;E&quot;;
 387              case Player.STATE_IDLE:
 388                  return &quot;I&quot;;
 389              case Player.STATE_READY:
 390                  return &quot;R&quot;;
 391              default:
 392                  return &quot;?&quot;;
 393          }
 394      }
 395  
 396      private static String getFormatSupportString(int formatSupport) {
 397          switch (formatSupport) {
 398              case RendererCapabilities.FORMAT_HANDLED:

 399                  return &quot;YES&quot;;
 400              case RendererCapabilities.FORMAT_EXCEEDS_CAPABILITIES:

 401                  return &quot;NO_EXCEEDS_CAPABILITIES&quot;;
 402              case RendererCapabilities.FORMAT_UNSUPPORTED_DRM:

 403                  return &quot;NO_UNSUPPORTED_DRM&quot;;
 404              case RendererCapabilities.FORMAT_UNSUPPORTED_SUBTYPE:

 405                  return &quot;NO_UNSUPPORTED_TYPE&quot;;
 406              case RendererCapabilities.FORMAT_UNSUPPORTED_TYPE:

 407                  return &quot;NO&quot;;
 408              default:
 409                  return &quot;?&quot;;
 410          }
 411      }
 412  
 413      private static String getAdaptiveSupportString(int trackCount, int adaptiveSupport) {
 414          if (trackCount &lt; 2) {
 415              return &quot;N/A&quot;;
 416          }
 417          switch (adaptiveSupport) {
 418              case RendererCapabilities.ADAPTIVE_SEAMLESS:
 419                  return &quot;YES&quot;;
 420              case RendererCapabilities.ADAPTIVE_NOT_SEAMLESS:
 421                  return &quot;YES_NOT_SEAMLESS&quot;;
 422              case RendererCapabilities.ADAPTIVE_NOT_SUPPORTED:
 423                  return &quot;NO&quot;;
 424              default:
 425                  return &quot;?&quot;;
 426          }
 427      }
 428  
 429      private static String getTrackStatusString(TrackSelection selection, TrackGroup group,
 430                                                 int trackIndex) {
 431          return getTrackStatusString(selection != null &amp;&amp; selection.getTrackGroup() == group
 432                  &amp;&amp; selection.indexOf(trackIndex) != C.INDEX_UNSET);
 433      }
 434  
 435      private static String getTrackStatusString(boolean enabled) {
 436          return enabled ? &quot;[X]&quot; : &quot;[ ]&quot;;
 437      }
 438  
 439      private static String getRepeatModeString(@Player.RepeatMode int repeatMode) {
 440          switch (repeatMode) {
 441              case Player.REPEAT_MODE_OFF:
 442                  return &quot;OFF&quot;;
 443              case Player.REPEAT_MODE_ONE:
 444                  return &quot;ONE&quot;;
 445              case Player.REPEAT_MODE_ALL:
 446                  return &quot;ALL&quot;;
 447              default:
 448                  return &quot;?&quot;;
 449          }
 450      }
 451  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 452 -    private static String getDiscontinuityReasonString(@Player.DiscontinuityReason int reason) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 453 -        switch (reason) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 454 -            case Player.DISCONTINUITY_REASON_PERIOD_TRANSITION:</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 455 -                return &quot;PERIOD_TRANSITION&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 456 -            case Player.DISCONTINUITY_REASON_SEEK:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 457 -                return &quot;SEEK&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 458 -            case Player.DISCONTINUITY_REASON_SEEK_ADJUSTMENT:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 459 -                return &quot;SEEK_ADJUSTMENT&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 460 -            case Player.DISCONTINUITY_REASON_INTERNAL:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 461 -                return &quot;INTERNAL&quot;;</span>


<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 462 -            default:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 463 -                return &quot;?&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 464 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 465 +    public void onRenderedFirstFrame(Object output, long renderTimeMs) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 466 +        if (output instanceof Surface) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 467 +            Log.d(TAG, &quot;renderedFirstFrame [&quot; + (Surface) output + &quot;]&quot;);</span>
 468          }
 469      }
 470  }</pre></td>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 The Android Open Source Project
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  package tv.danmaku.ijk.media.exo2.demo;
  17  
  18  import android.os.SystemClock;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -import androidx.annotation.Nullable;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  20 +</span>
  21  import android.util.Log;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -import android.view.Surface;</span>



  23  
  24  import com.google.android.exoplayer2.C;
  25  import com.google.android.exoplayer2.ExoPlaybackException;
  26  import com.google.android.exoplayer2.Format;
  27  import com.google.android.exoplayer2.PlaybackParameters;
  28  import com.google.android.exoplayer2.Player;
  29  import com.google.android.exoplayer2.RendererCapabilities;
  30  import com.google.android.exoplayer2.Timeline;
  31  import com.google.android.exoplayer2.audio.AudioRendererEventListener;
  32  import com.google.android.exoplayer2.decoder.DecoderCounters;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  33 +import com.google.android.exoplayer2.decoder.DecoderReuseEvaluation;</span>
  34  import com.google.android.exoplayer2.metadata.Metadata;
  35  import com.google.android.exoplayer2.metadata.MetadataOutput;
  36  import com.google.android.exoplayer2.metadata.emsg.EventMessage;
  37  import com.google.android.exoplayer2.metadata.id3.ApicFrame;
  38  import com.google.android.exoplayer2.metadata.id3.CommentFrame;
  39  import com.google.android.exoplayer2.metadata.id3.GeobFrame;
  40  import com.google.android.exoplayer2.metadata.id3.Id3Frame;
  41  import com.google.android.exoplayer2.metadata.id3.PrivFrame;
  42  import com.google.android.exoplayer2.metadata.id3.TextInformationFrame;
  43  import com.google.android.exoplayer2.metadata.id3.UrlLinkFrame;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 -import com.google.android.exoplayer2.source.MediaSource;</span>
  45  import com.google.android.exoplayer2.source.MediaSourceEventListener;
  46  import com.google.android.exoplayer2.source.TrackGroup;
  47  import com.google.android.exoplayer2.source.TrackGroupArray;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +import com.google.android.exoplayer2.text.Cue;</span>
  49  import com.google.android.exoplayer2.trackselection.MappingTrackSelector;
  50  import com.google.android.exoplayer2.trackselection.MappingTrackSelector.MappedTrackInfo;
  51  import com.google.android.exoplayer2.trackselection.TrackSelection;
  52  import com.google.android.exoplayer2.trackselection.TrackSelectionArray;
  53  import com.google.android.exoplayer2.video.VideoRendererEventListener;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -import java.io.IOException;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  56 +import com.google.android.exoplayer2.video.VideoSize;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  57 +</span>
  58  import java.text.NumberFormat;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  59 +import java.util.List;</span>
  60  import java.util.Locale;
  61  
  62  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -public final class EventLogger implements Player.EventListener, MetadataOutput,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -        AudioRendererEventListener, VideoRendererEventListener, MediaSourceEventListener{</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +public final class EventLogger implements Player.Listener, MetadataOutput,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +        AudioRendererEventListener, VideoRendererEventListener, MediaSourceEventListener {</span>
  67  
  68      private static final String TAG = &quot;EventLogger&quot;;
  69      private static final int MAX_TIMELINE_ITEM_LINES = 3;
  70      private static final NumberFormat TIME_FORMAT;
  71  
  72      static {
  73          TIME_FORMAT = NumberFormat.getInstance(Locale.US);
  74          TIME_FORMAT.setMinimumFractionDigits(2);
  75          TIME_FORMAT.setMaximumFractionDigits(2);
  76          TIME_FORMAT.setGroupingUsed(false);
  77      }
  78  
  79      private final MappingTrackSelector trackSelector;
  80      private final Timeline.Window window;
  81      private final Timeline.Period period;
  82      private final long startTimeMs;
  83  
  84      public EventLogger(MappingTrackSelector trackSelector) {
  85          this.trackSelector = trackSelector;
  86          window = new Timeline.Window();
  87          period = new Timeline.Period();
  88          startTimeMs = SystemClock.elapsedRealtime();
  89      }
  90  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +</span>
  92      // Player.EventListener
  93  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  95 -    public void onLoadingChanged(boolean isLoading) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +    public void onCues(List&lt;Cue&gt; cues) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +    public void onIsLoadingChanged(boolean isLoading) {</span>
 104          Log.d(TAG, &quot;loading [&quot; + isLoading + &quot;]&quot;);
 105      }
 106  
 107      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 108 -    public void onPlayerStateChanged(boolean playWhenReady, int state) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +    public void onPlaybackStateChanged(@Player.State int state) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +        Log.d(TAG, &quot;state [&quot; + getSessionTimeString()  + &quot;, &quot;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +                + getStateString(state) + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 112 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +    public void onPlayWhenReadyChanged(boolean playWhenReady, int state) {</span>
 116          Log.d(TAG, &quot;state [&quot; + getSessionTimeString() + &quot;, &quot; + playWhenReady + &quot;, &quot;
 117                  + getStateString(state) + &quot;]&quot;);
 118      }
 119  
 120      @Override
 121      public void onRepeatModeChanged(@Player.RepeatMode int repeatMode) {
 122          Log.d(TAG, &quot;repeatMode [&quot; + getRepeatModeString(repeatMode) + &quot;]&quot;);
 123      }
 124  
 125      @Override
 126      public void onShuffleModeEnabledChanged(boolean shuffleModeEnabled) {
 127          Log.d(TAG, &quot;shuffleModeEnabled [&quot; + shuffleModeEnabled + &quot;]&quot;);
 128      }
 129  
 130      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 131 -    public void onPositionDiscontinuity(@Player.DiscontinuityReason int reason) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 132 +    public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition, @Player.DiscontinuityReason int reason) {"> 132 +    public void onPositionDiscontinuity(Player.PositionInfo oldPosition, Player.PositionInfo newPosition, @Player.🔵</abbr></span>
 133          Log.d(TAG, &quot;positionDiscontinuity [&quot; + getDiscontinuityReasonString(reason) + &quot;]&quot;);













 134      }
 135  
 136      @Override
 137      public void onPlaybackParametersChanged(PlaybackParameters playbackParameters) {
 138          Log.d(TAG, &quot;playbackParameters &quot; + String.format(
 139                  &quot;[speed=%.2f, pitch=%.2f]&quot;, playbackParameters.speed, playbackParameters.pitch));
 140      }
 141  
 142      @Override
 143      public void onPlayerError(ExoPlaybackException e) {

 144          Log.e(TAG, &quot;playerFailed [&quot; + getSessionTimeString() + &quot;]&quot;, e);
 145      }
 146  
 147      @Override
 148      public void onTracksChanged(TrackGroupArray ignored, TrackSelectionArray trackSelections) {

 149          MappedTrackInfo mappedTrackInfo = trackSelector.getCurrentMappedTrackInfo();
 150          if (mappedTrackInfo == null) {
 151              Log.d(TAG, &quot;Tracks []&quot;);
 152              return;
 153          }
 154          Log.d(TAG, &quot;Tracks [&quot;);
 155          // Log tracks associated to renderers.
 156          for (int rendererIndex = 0; rendererIndex &lt; mappedTrackInfo.getRendererCount(); rendererIndex++) {
 157              TrackGroupArray rendererTrackGroups = mappedTrackInfo.getTrackGroups(rendererIndex);
 158              TrackSelection trackSelection = trackSelections.get(rendererIndex);
 159              if (rendererTrackGroups.length &gt; 0) {
 160                  Log.d(TAG, &quot;  Renderer:&quot; + rendererIndex + &quot; [&quot;);
 161                  for (int groupIndex = 0; groupIndex &lt; rendererTrackGroups.length; groupIndex++) {
 162                      TrackGroup trackGroup = rendererTrackGroups.get(groupIndex);
 163                      String adaptiveSupport = getAdaptiveSupportString(trackGroup.length,
 164                              mappedTrackInfo.getAdaptiveSupport(rendererIndex, groupIndex, false));
 165                      Log.d(TAG, &quot;    Group:&quot; + groupIndex + &quot;, adaptive_supported=&quot; + adaptiveSupport + &quot; [&quot;);
 166                      for (int trackIndex = 0; trackIndex &lt; trackGroup.length; trackIndex++) {
 167                          String status = getTrackStatusString(trackSelection, trackGroup, trackIndex);
 168                          /*String formatSupport = getFormatSupportString(
 169                                  mappedTrackInfo.getTrackFormatSupport(rendererIndex, groupIndex, trackIndex));
 170                          Log.d(TAG, &quot;      &quot; + status + &quot; Track:&quot; + trackIndex + &quot;, &quot;
 171                                  + Format.toLogString(trackGroup.getFormat(trackIndex))
 172                                  + &quot;, supported=&quot; + formatSupport);*/
 173                      }
 174                      Log.d(TAG, &quot;    ]&quot;);
 175                  }
 176                  // Log metadata for at most one of the tracks selected for the renderer.
 177                  if (trackSelection != null) {
 178                      for (int selectionIndex = 0; selectionIndex &lt; trackSelection.length(); selectionIndex++) {
 179                          Metadata metadata = trackSelection.getFormat(selectionIndex).metadata;
 180                          if (metadata != null) {
 181                              Log.d(TAG, &quot;    Metadata [&quot;);
 182                              printMetadata(metadata, &quot;      &quot;);
 183                              Log.d(TAG, &quot;    ]&quot;);
 184                              break;
 185                          }
 186                      }
 187                  }
 188                  Log.d(TAG, &quot;  ]&quot;);
 189              }
 190          }
 191          // Log tracks not associated with a renderer.
 192          TrackGroupArray unassociatedTrackGroups = mappedTrackInfo.getUnmappedTrackGroups();
 193          if (unassociatedTrackGroups.length &gt; 0) {
 194              Log.d(TAG, &quot;  Renderer:None [&quot;);
 195              for (int groupIndex = 0; groupIndex &lt; unassociatedTrackGroups.length; groupIndex++) {
 196                  Log.d(TAG, &quot;    Group:&quot; + groupIndex + &quot; [&quot;);
 197                  TrackGroup trackGroup = unassociatedTrackGroups.get(groupIndex);
 198                  for (int trackIndex = 0; trackIndex &lt; trackGroup.length; trackIndex++) {
 199                      String status = getTrackStatusString(false);
 200                      String formatSupport = getFormatSupportString(
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 201 -                            RendererCapabilities.FORMAT_UNSUPPORTED_TYPE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +                            C.FORMAT_UNSUPPORTED_TYPE);</span>
 203                      Log.d(TAG, &quot;      &quot; + status + &quot; Track:&quot; + trackIndex + &quot;, &quot;
 204                              + Format.toLogString(trackGroup.getFormat(trackIndex))
 205                              + &quot;, supported=&quot; + formatSupport);
 206                  }
 207                  Log.d(TAG, &quot;    ]&quot;);
 208              }
 209              Log.d(TAG, &quot;  ]&quot;);
 210          }
 211          Log.d(TAG, &quot;]&quot;);
 212      }
 213  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 214 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 215 -    public void onSeekProcessed() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 216 -        Log.d(TAG, &quot;seekProcessed&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 217 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 218 -</span>
 219      // MetadataOutput
 220  
 221      @Override
 222      public void onMetadata(Metadata metadata) {

 223          Log.d(TAG, &quot;onMetadata [&quot;);
 224          printMetadata(metadata, &quot;  &quot;);
 225          Log.d(TAG, &quot;]&quot;);
 226      }
 227  
 228      // AudioRendererEventListener
 229  
 230      @Override
 231      public void onAudioEnabled(DecoderCounters counters) {
 232          Log.d(TAG, &quot;audioEnabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 233      }
 234  
 235      @Override
 236      public void onAudioDecoderInitialized(String decoderName, long elapsedRealtimeMs,
 237                                            long initializationDurationMs) {
 238          Log.d(TAG, &quot;audioDecoderInitialized [&quot; + getSessionTimeString() + &quot;, &quot; + decoderName + &quot;]&quot;);
 239      }
 240  
 241      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 242 -    public void onAudioInputFormatChanged(Format format) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +    public void onAudioInputFormatChanged(Format format, DecoderReuseEvaluation decoderReuseEvaluation) {</span>
 244          Log.d(TAG, &quot;audioFormatChanged [&quot; + getSessionTimeString() + &quot;, &quot; + Format.toLogString(format)
 245                  + &quot;]&quot;);
 246      }
 247  
 248      @Override
 249      public void onAudioDisabled(DecoderCounters counters) {
 250          Log.d(TAG, &quot;audioDisabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 251      }
 252  
 253      // VideoRendererEventListener
 254  
 255      @Override
 256      public void onVideoEnabled(DecoderCounters counters) {
 257          Log.d(TAG, &quot;videoEnabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 258      }
 259  
 260      @Override
 261      public void onVideoDecoderInitialized(String decoderName, long elapsedRealtimeMs,
 262                                            long initializationDurationMs) {
 263          Log.d(TAG, &quot;videoDecoderInitialized [&quot; + getSessionTimeString() + &quot;, &quot; + decoderName + &quot;]&quot;);
 264      }
 265  
 266      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 267 -    public void onVideoInputFormatChanged(Format format) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 268 +    public void onVideoInputFormatChanged(Format format, DecoderReuseEvaluation decoderReuseEvaluation) {</span>
 269          Log.d(TAG, &quot;videoFormatChanged [&quot; + getSessionTimeString() + &quot;, &quot; + Format.toLogString(format)
 270                  + &quot;]&quot;);
 271      }
 272  
 273      @Override
 274      public void onVideoDisabled(DecoderCounters counters) {
 275          Log.d(TAG, &quot;videoDisabled [&quot; + getSessionTimeString() + &quot;]&quot;);
 276      }
 277  
 278      @Override
 279      public void onDroppedFrames(int count, long elapsed) {
 280          Log.d(TAG, &quot;droppedFrames [&quot; + getSessionTimeString() + &quot;, &quot; + count + &quot;]&quot;);
 281      }
 282  
 283      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 284 -    public void onVideoSizeChanged(int width, int height, int unappliedRotationDegrees,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 285 -                                   float pixelWidthHeightRatio) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 286 -        Log.d(TAG, &quot;videoSizeChanged [&quot; + width + &quot;, &quot; + height + &quot;]&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 287 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 288 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 289 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 290 -    public void onRenderedFirstFrame(Surface surface) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 291 -        Log.d(TAG, &quot;renderedFirstFrame [&quot; + surface + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +    public void onVideoSizeChanged(VideoSize videoSize) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +        Log.d(TAG, &quot;videoSizeChanged [&quot; + videoSize.width + &quot;, &quot; + videoSize.height + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +    public void onRenderedFirstFrame(Object output, long renderTimeMs) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +        Log.d(TAG, &quot;renderedFirstFrame [&quot; + output + &quot;]&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 302 +    public void onSkipSilenceEnabledChanged(boolean skipSilenceEnabled) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 303 +</span>
 304      }
 305  
 306      //MediaSourceEventListener
 307  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 308 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 309 -    public void onTimelineChanged(Timeline timeline, Object manifest, int reason) {</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 310 -        int periodCount = timeline.getPeriodCount();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 311 -        int windowCount = timeline.getWindowCount();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 312 -        Log.d(TAG, &quot;sourceInfo [periodCount=&quot; + periodCount + &quot;, windowCount=&quot; + windowCount);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 313 -        for (int i = 0; i &lt; Math.min(periodCount, MAX_TIMELINE_ITEM_LINES); i++) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 314 -            timeline.getPeriod(i, period);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 315 -            Log.d(TAG, &quot;  &quot; + &quot;period [&quot; + getTimeString(period.getDurationMs()) + &quot;]&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 316 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 317 -        if (periodCount &gt; MAX_TIMELINE_ITEM_LINES) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 318 -            Log.d(TAG, &quot;  ...&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 319 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 320 -        for (int i = 0; i &lt; Math.min(windowCount, MAX_TIMELINE_ITEM_LINES); i++) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 321 -            timeline.getWindow(i, window);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 322 -            Log.d(TAG, &quot;  &quot; + &quot;window [&quot; + getTimeString(window.getDurationMs()) + &quot;, &quot;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 323 -                    + window.isSeekable + &quot;, &quot; + window.isDynamic + &quot;]&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 324 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 325 -        if (windowCount &gt; MAX_TIMELINE_ITEM_LINES) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 326 -            Log.d(TAG, &quot;  ...&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 327 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 328 -        Log.d(TAG, &quot;]&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 329 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 330 -</span>
 331      // Internal methods
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 332 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 333 -    private void printInternalError(String type, Exception e) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 334 -        Log.e(TAG, &quot;internalError [&quot; + getSessionTimeString() + &quot;, &quot; + type + &quot;]&quot;, e);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 335 -    }</span>
 336  
 337      private void printMetadata(Metadata metadata, String prefix) {
 338          for (int i = 0; i &lt; metadata.length(); i++) {
 339              Metadata.Entry entry = metadata.get(i);
 340              if (entry instanceof TextInformationFrame) {
 341                  TextInformationFrame textInformationFrame = (TextInformationFrame) entry;
 342                  Log.d(TAG, prefix + String.format(&quot;%s: value=%s&quot;, textInformationFrame.id,
 343                          textInformationFrame.value));
 344              } else if (entry instanceof UrlLinkFrame) {
 345                  UrlLinkFrame urlLinkFrame = (UrlLinkFrame) entry;
 346                  Log.d(TAG, prefix + String.format(&quot;%s: url=%s&quot;, urlLinkFrame.id, urlLinkFrame.url));
 347              } else if (entry instanceof PrivFrame) {
 348                  PrivFrame privFrame = (PrivFrame) entry;
 349                  Log.d(TAG, prefix + String.format(&quot;%s: owner=%s&quot;, privFrame.id, privFrame.owner));
 350              } else if (entry instanceof GeobFrame) {
 351                  GeobFrame geobFrame = (GeobFrame) entry;
 352                  Log.d(TAG, prefix + String.format(&quot;%s: mimeType=%s, filename=%s, description=%s&quot;,
 353                          geobFrame.id, geobFrame.mimeType, geobFrame.filename, geobFrame.description));
 354              } else if (entry instanceof ApicFrame) {
 355                  ApicFrame apicFrame = (ApicFrame) entry;
 356                  Log.d(TAG, prefix + String.format(&quot;%s: mimeType=%s, description=%s&quot;,
 357                          apicFrame.id, apicFrame.mimeType, apicFrame.description));
 358              } else if (entry instanceof CommentFrame) {
 359                  CommentFrame commentFrame = (CommentFrame) entry;
 360                  Log.d(TAG, prefix + String.format(&quot;%s: language=%s, description=%s&quot;, commentFrame.id,
 361                          commentFrame.language, commentFrame.description));
 362              } else if (entry instanceof Id3Frame) {
 363                  Id3Frame id3Frame = (Id3Frame) entry;
 364                  Log.d(TAG, prefix + String.format(&quot;%s&quot;, id3Frame.id));
 365              } else if (entry instanceof EventMessage) {
 366                  EventMessage eventMessage = (EventMessage) entry;
 367                  Log.d(TAG, prefix + String.format(&quot;EMSG: scheme=%s, id=%d, value=%s&quot;,
 368                          eventMessage.schemeIdUri, eventMessage.id, eventMessage.value));
 369              }
 370          }
 371      }
 372  
 373      private String getSessionTimeString() {
 374          return getTimeString(SystemClock.elapsedRealtime() - startTimeMs);
 375      }
 376  
 377      private static String getTimeString(long timeMs) {
 378          return timeMs == C.TIME_UNSET ? &quot;?&quot; : TIME_FORMAT.format((timeMs) / 1000f);
 379      }
 380  
 381      private static String getStateString(int state) {
 382          switch (state) {
 383              case Player.STATE_BUFFERING:
 384                  return &quot;B&quot;;
 385              case Player.STATE_ENDED:
 386                  return &quot;E&quot;;
 387              case Player.STATE_IDLE:
 388                  return &quot;I&quot;;
 389              case Player.STATE_READY:
 390                  return &quot;R&quot;;
 391              default:
 392                  return &quot;?&quot;;
 393          }
 394      }
 395  
 396      private static String getFormatSupportString(int formatSupport) {
 397          switch (formatSupport) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 398 -            case RendererCapabilities.FORMAT_HANDLED:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 399 +            case C.FORMAT_HANDLED:</span>
 400                  return &quot;YES&quot;;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 401 -            case RendererCapabilities.FORMAT_EXCEEDS_CAPABILITIES:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 402 +            case C.FORMAT_EXCEEDS_CAPABILITIES:</span>
 403                  return &quot;NO_EXCEEDS_CAPABILITIES&quot;;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 404 -            case RendererCapabilities.FORMAT_UNSUPPORTED_DRM:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 405 +            case C.FORMAT_UNSUPPORTED_DRM:</span>
 406                  return &quot;NO_UNSUPPORTED_DRM&quot;;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 407 -            case RendererCapabilities.FORMAT_UNSUPPORTED_SUBTYPE:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 408 +            case C.FORMAT_UNSUPPORTED_SUBTYPE:</span>
 409                  return &quot;NO_UNSUPPORTED_TYPE&quot;;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 410 -            case RendererCapabilities.FORMAT_UNSUPPORTED_TYPE:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 411 +            case C.FORMAT_UNSUPPORTED_TYPE:</span>
 412                  return &quot;NO&quot;;
 413              default:
 414                  return &quot;?&quot;;
 415          }
 416      }
 417  
 418      private static String getAdaptiveSupportString(int trackCount, int adaptiveSupport) {
 419          if (trackCount &lt; 2) {
 420              return &quot;N/A&quot;;
 421          }
 422          switch (adaptiveSupport) {
 423              case RendererCapabilities.ADAPTIVE_SEAMLESS:
 424                  return &quot;YES&quot;;
 425              case RendererCapabilities.ADAPTIVE_NOT_SEAMLESS:
 426                  return &quot;YES_NOT_SEAMLESS&quot;;
 427              case RendererCapabilities.ADAPTIVE_NOT_SUPPORTED:
 428                  return &quot;NO&quot;;
 429              default:
 430                  return &quot;?&quot;;
 431          }
 432      }
 433  
 434      private static String getTrackStatusString(TrackSelection selection, TrackGroup group,
 435                                                 int trackIndex) {
 436          return getTrackStatusString(selection != null &amp;&amp; selection.getTrackGroup() == group
 437                  &amp;&amp; selection.indexOf(trackIndex) != C.INDEX_UNSET);
 438      }
 439  
 440      private static String getTrackStatusString(boolean enabled) {
 441          return enabled ? &quot;[X]&quot; : &quot;[ ]&quot;;
 442      }
 443  
 444      private static String getRepeatModeString(@Player.RepeatMode int repeatMode) {
 445          switch (repeatMode) {
 446              case Player.REPEAT_MODE_OFF:
 447                  return &quot;OFF&quot;;
 448              case Player.REPEAT_MODE_ONE:
 449                  return &quot;ONE&quot;;
 450              case Player.REPEAT_MODE_ALL:
 451                  return &quot;ALL&quot;;
 452              default:
 453                  return &quot;?&quot;;
 454          }
 455      }
 456  
 457      private static String getDiscontinuityReasonString(@Player.DiscontinuityReason int reason) {
 458          switch (reason) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 459 -            case Player.DISCONTINUITY_REASON_PERIOD_TRANSITION:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 460 +            case Player.DISCONTINUITY_REASON_AUTO_TRANSITION:</span>
 461                  return &quot;PERIOD_TRANSITION&quot;;
 462              case Player.DISCONTINUITY_REASON_SEEK:
 463                  return &quot;SEEK&quot;;
 464              case Player.DISCONTINUITY_REASON_SEEK_ADJUSTMENT:
 465                  return &quot;SEEK_ADJUSTMENT&quot;;
 466              case Player.DISCONTINUITY_REASON_INTERNAL:
 467                  return &quot;INTERNAL&quot;;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 468 +            case Player.DISCONTINUITY_REASON_REMOVE:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 469 +            case Player.DISCONTINUITY_REASON_SKIP:</span>
 470              default:
 471                  return &quot;?&quot;;




 472          }
 473      }
 474  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            