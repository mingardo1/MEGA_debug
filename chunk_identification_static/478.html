<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>478</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    478
                    <a href="477.html">prev</a>
                    <a href="479.html">next</a>
                    <a href="478_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_f7d04befb21c26162c7af61911a0e71624243147_core/src/main/java/com/dtstack/flink/sql/side/SideSQLParser.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;f7d04befb21c26162c7af61911a0e71624243147:core/src/main/java/com/dtstack/flink/sql/side/SideSQLParser.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;f7d04befb21c26162c7af61911a0e71624243147^1:core/src/main/java/com/dtstack/flink/sql/side/SideSQLParser.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;f7d04befb21c26162c7af61911a0e71624243147^2:core/src/main/java/com/dtstack/flink/sql/side/SideSQLParser.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;b59ef71c4aa3401fd523d61328334a6bac817e1c:core/src/main/java/com/dtstack/flink/sql/side/SideSQLParser.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj]], subset: [[bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span  style="">  20                                                                                                          </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  21 package com.dtstack.flink.sql.side;                                                                      </span>
<span  style="">  22                                                                                                          </span>
<span class="-283888887417937620" onmouseenter="enter('-283888887417937620');" onmouseout="out('-283888887417937620');" style="">  23 import com.dtstack.flink.sql.parser.FlinkPlanner;                                                        </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  24 import com.dtstack.flink.sql.util.TableUtils;                                                            </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  25 import com.google.common.collect.Maps;                                                                   </span>
<span class="1397139485218690137" onmouseenter="enter('1397139485218690137');" onmouseout="out('1397139485218690137');" style="">  26 import com.google.common.collect.Queues;                                                                 </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  27 import com.google.common.collect.Sets;                                                                   </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  28 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  29 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  30 import org.apache.calcite.sql.SqlInsert;                                                                 </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  31 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  32 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  33 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  34 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  35 import org.apache.calcite.sql.SqlOrderBy;                                                                </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  36 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="-8823326795697214951" onmouseenter="enter('-8823326795697214951');" onmouseout="out('-8823326795697214951');" style="">  37 import org.apache.calcite.sql.SqlWith;                                                                   </span>
<span class="9012576760183743580" onmouseenter="enter('9012576760183743580');" onmouseout="out('9012576760183743580');" style="">  38 import org.apache.calcite.sql.SqlWithItem;                                                               </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  39 import org.apache.calcite.sql.parser.SqlParseException;                                                  </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  40 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  41 import org.apache.flink.table.api.Table;                                                                 </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="">  42 import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  43 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  44 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  45                                                                                                          </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  46 import java.util.Map;                                                                                    </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  47 import java.util.Queue;                                                                                  </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  48 import java.util.Set;                                                                                    </span>
<span  style="">  49                                                                                                          </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  50 import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                 </span>
<span class="5903201271827982207" onmouseenter="enter('5903201271827982207');" onmouseout="out('5903201271827982207');" style="">  51 import static org.apache.calcite.sql.SqlKind.LITERAL;                                                    </span>
<span  style="">  52                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  53 /**                                                                                                      </span>
<span class="7605977213454941184" onmouseenter="enter('7605977213454941184');" onmouseout="out('7605977213454941184');" style="">  54  * Parsing sql, obtain execution information dimension table                                             </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  55  * Date: 2018/7/24                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  56  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  57  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  58  */                                                                                                      </span>
<span  style="">  59                                                                                                          </span>
<span class="3966585742332796558" onmouseenter="enter('3966585742332796558');" onmouseout="out('3966585742332796558');" style="">  60 public class SideSQLParser {                                                                             </span>
<span class="-77182390841532482" onmouseenter="enter('-77182390841532482');" onmouseout="out('-77182390841532482');" style="">  61     private static final Logger LOG = LoggerFactory.getLogger(SideSQLParser.class);                      </span>
<span  style="">  62                                                                                                          </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="">  63     private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                      </span>
<span  style="">  64                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  65 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-462390148177184466" onmouseenter="enter('-462390148177184466');" onmouseout="out('-462390148177184466');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title="  66     public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet, String scope) throws SqlParseException {">  66     public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet, String scope) throws SqlPar🔵</abbr></span>
<span class="-554334491296517619" onmouseenter="enter('-554334491296517619');" onmouseout="out('-554334491296517619');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67         System.out.println(&quot;----------exec original Sql----------&quot;);                                     </span>
<span class="6408637245030246244" onmouseenter="enter('6408637245030246244');" onmouseout="out('6408637245030246244');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68         System.out.println(exeSql);                                                                      </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  69 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="4228219262260732256" onmouseenter="enter('4228219262260732256');" onmouseout="out('4228219262260732256');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70     public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet) throws SqlParseException { </span>
<span class="-554334491296517619" onmouseenter="enter('-554334491296517619');" onmouseout="out('-554334491296517619');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71         System.out.println(&quot;----------exec original Sql----------&quot;);                                     </span>
<span class="6408637245030246244" onmouseenter="enter('6408637245030246244');" onmouseout="out('6408637245030246244');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72         System.out.println(exeSql);                                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  73 =======                                                                                                  </span>
<span class="4228219262260732256" onmouseenter="enter('4228219262260732256');" onmouseout="out('4228219262260732256');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74     public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet) throws SqlParseException { </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  75 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-7947557255342642708" onmouseenter="enter('-7947557255342642708');" onmouseout="out('-7947557255342642708');" style="">  76         LOG.info(&quot;----------exec original Sql----------&quot;);                                               </span>
<span class="1058132582852180835" onmouseenter="enter('1058132582852180835');" onmouseout="out('1058132582852180835');" style="">  77         LOG.info(exeSql);                                                                                </span>
<span  style="">  78                                                                                                          </span>
<span class="5128011700743018451" onmouseenter="enter('5128011700743018451');" onmouseout="out('5128011700743018451');" style="">  79         Queue&lt;Object&gt; queueInfo = Queues.newLinkedBlockingQueue();                                       </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style="">  80         FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                                  </span>
<span class="-6421300158550037914" onmouseenter="enter('-6421300158550037914');" onmouseout="out('-6421300158550037914');" style="">  81         SqlNode sqlNode = flinkPlanner.parse(exeSql);                                                    </span>
<span  style="">  82                                                                                                          </span>
<span class="-139933501212153033" onmouseenter="enter('-139933501212153033');" onmouseout="out('-139933501212153033');" style="">  83         parseSql(sqlNode, sideTableSet, queueInfo, null, null, null, scope);                             </span>
<span class="2886026929410252587" onmouseenter="enter('2886026929410252587');" onmouseout="out('2886026929410252587');" style="">  84         queueInfo.offer(sqlNode);                                                                        </span>
<span class="-7280577500312652584" onmouseenter="enter('-7280577500312652584');" onmouseout="out('-7280577500312652584');" style="">  85         return queueInfo;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86     }                                                                                                    </span>
<span  style="">  87                                                                                                          </span>
<span  style="">  88                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  89     /**                                                                                                  </span>
<span class="-3708169461439447854" onmouseenter="enter('-3708169461439447854');" onmouseout="out('-3708169461439447854');" style="">  90      *  解析 sql 根据维表 join关系重新组装新的sql                                                                      </span>
<span class="3061148848694484073" onmouseenter="enter('3061148848694484073');" onmouseout="out('3061148848694484073');" style="">  91      * @param sqlNode                                                                                    </span>
<span class="-8651210754005562825" onmouseenter="enter('-8651210754005562825');" onmouseout="out('-8651210754005562825');" style="">  92      * @param sideTableSet                                                                               </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style="">  93      * @param queueInfo                                                                                  </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style="">  94      * @param parentWhere                                                                                </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style="">  95      * @param parentSelectList                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">  96      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  97      */                                                                                                  </span>
<span class="-4912114046735086097" onmouseenter="enter('-4912114046735086097');" onmouseout="out('-4912114046735086097');" style="">  98     public Object parseSql(SqlNode sqlNode,                                                              </span>
<span class="-1952250395521254109" onmouseenter="enter('-1952250395521254109');" onmouseout="out('-1952250395521254109');" style="">  99                            Set&lt;String&gt; sideTableSet,                                                     </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style=""> 100                            Queue&lt;Object&gt; queueInfo,                                                      </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style=""> 101                            SqlNode parentWhere,                                                          </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 102                            SqlNodeList parentSelectList,                                                 </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style=""> 103                            SqlNodeList parentGroupByList,                                                </span>
<span class="1499010499274846565" onmouseenter="enter('1499010499274846565');" onmouseout="out('1499010499274846565');" style=""> 104                            String scope){                                                                </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 105         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style=""> 106         switch (sqlKind){                                                                                </span>
<span class="-4895776563178477738" onmouseenter="enter('-4895776563178477738');" onmouseout="out('-4895776563178477738');" style=""> 107             case WITH: {                                                                                 </span>
<span class="1074402989354786172" onmouseenter="enter('1074402989354786172');" onmouseout="out('1074402989354786172');" style=""> 108                 SqlWith sqlWith = (SqlWith) sqlNode;                                                     </span>
<span class="1112510853537726574" onmouseenter="enter('1112510853537726574');" onmouseout="out('1112510853537726574');" style=""> 109                 SqlNodeList sqlNodeList = sqlWith.withList;                                              </span>
<span class="5898329184559807321" onmouseenter="enter('5898329184559807321');" onmouseout="out('5898329184559807321');" style=""> 110                 for (SqlNode withAsTable : sqlNodeList) {                                                </span>
<span class="5054103522612994093" onmouseenter="enter('5054103522612994093');" onmouseout="out('5054103522612994093');" style=""> 111                     SqlWithItem sqlWithItem = (SqlWithItem) withAsTable;                                 </span>
<span class="3110928689497337082" onmouseenter="enter('3110928689497337082');" onmouseout="out('3110928689497337082');" style=""><abbr title=" 112                     parseSql(sqlWithItem.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 112                     parseSql(sqlWithItem.query, sideTableSet, queueInfo, parentWhere, parentSelectList, p🔵</abbr></span>
<span class="558256818041950127" onmouseenter="enter('558256818041950127');" onmouseout="out('558256818041950127');" style=""> 113                     queueInfo.add(sqlWithItem);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114                 }                                                                                        </span>
<span class="-8548018655211213586" onmouseenter="enter('-8548018655211213586');" onmouseout="out('-8548018655211213586');" style=""><abbr title=" 115                 parseSql(sqlWith.body, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 115                 parseSql(sqlWith.body, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGrou🔵</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 116                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117             }                                                                                            </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 118             case INSERT:                                                                                 </span>
<span class="-7853295063534246070" onmouseenter="enter('-7853295063534246070');" onmouseout="out('-7853295063534246070');" style=""> 119                 SqlNode sqlSource = ((SqlInsert)sqlNode).getSource();                                    </span>
<span class="5867380015935317570" onmouseenter="enter('5867380015935317570');" onmouseout="out('5867380015935317570');" style=""><abbr title=" 120                 return parseSql(sqlSource, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 120                 return parseSql(sqlSource, sideTableSet, queueInfo, parentWhere, parentSelectList, parent🔵</abbr></span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 121             case SELECT:                                                                                 </span>
<span class="-737340637367962148" onmouseenter="enter('-737340637367962148');" onmouseout="out('-737340637367962148');" style=""> 122                 SqlNode sqlFrom = ((SqlSelect)sqlNode).getFrom();                                        </span>
<span class="-4595996050370151557" onmouseenter="enter('-4595996050370151557');" onmouseout="out('-4595996050370151557');" style=""> 123                 SqlNode sqlWhere = ((SqlSelect)sqlNode).getWhere();                                      </span>
<span class="-6539957329780970839" onmouseenter="enter('-6539957329780970839');" onmouseout="out('-6539957329780970839');" style=""> 124                 SqlNodeList selectList = ((SqlSelect)sqlNode).getSelectList();                           </span>
<span class="1382610957563429127" onmouseenter="enter('1382610957563429127');" onmouseout="out('1382610957563429127');" style=""> 125                 SqlNodeList groupByList = ((SqlSelect) sqlNode).getGroup();                              </span>
<span  style=""> 126                                                                                                          </span>
<span class="-6669062104161423555" onmouseenter="enter('-6669062104161423555');" onmouseout="out('-6669062104161423555');" style=""> 127                 if(sqlFrom.getKind() != IDENTIFIER){                                                     </span>
<span class="-593702489163539700" onmouseenter="enter('-593702489163539700');" onmouseout="out('-593702489163539700');" style=""><abbr title=" 128                     Object result = parseSql(sqlFrom, sideTableSet, queueInfo, sqlWhere, selectList, groupByList, scope);"> 128                     Object result = parseSql(sqlFrom, sideTableSet, queueInfo, sqlWhere, selectList, grou🔵</abbr></span>
<span class="7802562789325773256" onmouseenter="enter('7802562789325773256');" onmouseout="out('7802562789325773256');" style=""> 129                     if(result instanceof JoinInfo){                                                      </span>
<span class="-8441429291693214923" onmouseenter="enter('-8441429291693214923');" onmouseout="out('-8441429291693214923');" style=""><abbr title=" 130                         return TableUtils.dealSelectResultWithJoinInfo((JoinInfo) result, (SqlSelect) sqlNode, queueInfo);"> 130                         return TableUtils.dealSelectResultWithJoinInfo((JoinInfo) result, (SqlSelect) sql🔵</abbr></span>
<span class="1716266177589910912" onmouseenter="enter('1716266177589910912');" onmouseout="out('1716266177589910912');" style=""> 131                     }else if(result instanceof AliasInfo){                                               </span>
<span class="-6975694729646816765" onmouseenter="enter('-6975694729646816765');" onmouseout="out('-6975694729646816765');" style=""> 132                         String tableName = ((AliasInfo) result).getName();                               </span>
<span class="23740069362058607" onmouseenter="enter('23740069362058607');" onmouseout="out('23740069362058607');" style=""> 133                         if(sideTableSet.contains(tableName)){                                            </span>
<span class="-1760230060361710630" onmouseenter="enter('-1760230060361710630');" onmouseout="out('-1760230060361710630');" style=""> 134                             throw new RuntimeException(&quot;side-table must be used in join operator&quot;);      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136                     }                                                                                    </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 137                 }else{                                                                                   </span>
<span class="1420748888812461485" onmouseenter="enter('1420748888812461485');" onmouseout="out('1420748888812461485');" style=""> 138                     String tableName = ((SqlIdentifier)sqlFrom).getSimple();                             </span>
<span class="23740069362058607" onmouseenter="enter('23740069362058607');" onmouseout="out('23740069362058607');" style=""> 139                     if(sideTableSet.contains(tableName)){                                                </span>
<span class="-1760230060361710630" onmouseenter="enter('-1760230060361710630');" onmouseout="out('-1760230060361710630');" style=""> 140                         throw new RuntimeException(&quot;side-table must be used in join operator&quot;);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 143                 break;                                                                                   </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 144             case JOIN:                                                                                   </span>
<span class="-3111758306527220061" onmouseenter="enter('-3111758306527220061');" onmouseout="out('-3111758306527220061');" style=""> 145                 JoinNodeDealer joinNodeDealer = new JoinNodeDealer(this);                                </span>
<span class="9078002366390414240" onmouseenter="enter('9078002366390414240');" onmouseout="out('9078002366390414240');" style=""> 146                 Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet = Sets.newHashSet();                            </span>
<span class="1100449665231490148" onmouseenter="enter('1100449665231490148');" onmouseout="out('1100449665231490148');" style=""> 147                 Map&lt;String, String&gt; tableRef = Maps.newHashMap();                                        </span>
<span class="-6306168579289105112" onmouseenter="enter('-6306168579289105112');" onmouseout="out('-6306168579289105112');" style=""> 148                 Map&lt;String, String&gt; fieldRef = Maps.newHashMap();                                        </span>
<span class="-1512934165488206441" onmouseenter="enter('-1512934165488206441');" onmouseout="out('-1512934165488206441');" style=""> 149                 return joinNodeDealer.dealJoinNode((SqlJoin) sqlNode, sideTableSet, queueInfo,           </span>
<span class="-8388746013614283447" onmouseenter="enter('-8388746013614283447');" onmouseout="out('-8388746013614283447');" style=""><abbr title=" 150                         parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef, scope);"> 150                         parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRe🔵</abbr></span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 151             case AS:                                                                                     </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 152                 SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                 </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 153                 SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                               </span>
<span class="-7314337242875568781" onmouseenter="enter('-7314337242875568781');" onmouseout="out('-7314337242875568781');" style=""> 154                 String infoStr = &quot;&quot;;                                                                     </span>
<span  style=""> 155                                                                                                          </span>
<span class="2126841880433088777" onmouseenter="enter('2126841880433088777');" onmouseout="out('2126841880433088777');" style=""> 156                 if(info.getKind() == IDENTIFIER){                                                        </span>
<span class="-6527219795850644409" onmouseenter="enter('-6527219795850644409');" onmouseout="out('-6527219795850644409');" style=""> 157                     infoStr = info.toString();                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 158                 } else {                                                                                 </span>
<span class="-2058738663149093900" onmouseenter="enter('-2058738663149093900');" onmouseout="out('-2058738663149093900');" style=""><abbr title=" 159                     infoStr = parseSql(info, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope).toString();"> 159                     infoStr = parseSql(info, sideTableSet, queueInfo, parentWhere, parentSelectList, pare🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160                 }                                                                                        </span>
<span  style=""> 161                                                                                                          </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 162                 AliasInfo aliasInfo = new AliasInfo();                                                   </span>
<span class="-6330277266292138558" onmouseenter="enter('-6330277266292138558');" onmouseout="out('-6330277266292138558');" style=""> 163                 aliasInfo.setName(infoStr);                                                              </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 164                 aliasInfo.setAlias(alias.toString());                                                    </span>
<span  style=""> 165                                                                                                          </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 166                 return aliasInfo;                                                                        </span>
<span  style=""> 167                                                                                                          </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 168             case UNION:                                                                                  </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 169                 SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                            </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 170                 SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                           </span>
<span  style=""> 171                                                                                                          </span>
<span class="413085527251650631" onmouseenter="enter('413085527251650631');" onmouseout="out('413085527251650631');" style=""><abbr title=" 172                 parseSql(unionLeft, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 172                 parseSql(unionLeft, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupBy🔵</abbr></span>
<span class="5239612470789521882" onmouseenter="enter('5239612470789521882');" onmouseout="out('5239612470789521882');" style=""><abbr title=" 173                 parseSql(unionRight, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 173                 parseSql(unionRight, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupB🔵</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 174                 break;                                                                                   </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 175             case ORDER_BY:                                                                               </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 176                 SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                           </span>
<span class="-7455932962237326040" onmouseenter="enter('-7455932962237326040');" onmouseout="out('-7455932962237326040');" style=""><abbr title=" 177                 parseSql(sqlOrderBy.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 177                 parseSql(sqlOrderBy.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parent🔵</abbr></span>
<span  style=""> 178                                                                                                          </span>
<span class="-2988899114509087250" onmouseenter="enter('-2988899114509087250');" onmouseout="out('-2988899114509087250');" style=""> 179             case LITERAL:                                                                                </span>
<span class="2819024748306122432" onmouseenter="enter('2819024748306122432');" onmouseout="out('2819024748306122432');" style=""> 180                 return LITERAL.toString();                                                               </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 181             default:                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 182                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183         }                                                                                                </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 184         return &quot;&quot;;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185     }                                                                                                    </span>
<span  style=""> 186                                                                                                          </span>
<span  style=""> 187                                                                                                          </span>
<span  style=""> 188                                                                                                          </span>
<span  style=""> 189                                                                                                          </span>
<span class="-649401327769177886" onmouseenter="enter('-649401327769177886');" onmouseout="out('-649401327769177886');" style=""> 190     public void setLocalTableCache(Map&lt;String, Table&gt; localTableCache) {                                 </span>
<span class="-1916936159945030154" onmouseenter="enter('-1916936159945030154');" onmouseout="out('-1916936159945030154');" style=""> 191         this.localTableCache = localTableCache;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192     }                                                                                                    </span>
<span  style=""> 193                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span  style="">  20                                                                                                          </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  21 package com.dtstack.flink.sql.side;                                                                      </span>
<span  style="">  22                                                                                                          </span>
<span class="-283888887417937620" onmouseenter="enter('-283888887417937620');" onmouseout="out('-283888887417937620');" style="">  23 import com.dtstack.flink.sql.parser.FlinkPlanner;                                                        </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  24 import com.dtstack.flink.sql.util.TableUtils;                                                            </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  25 import com.google.common.collect.Maps;                                                                   </span>
<span class="1397139485218690137" onmouseenter="enter('1397139485218690137');" onmouseout="out('1397139485218690137');" style="">  26 import com.google.common.collect.Queues;                                                                 </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  27 import com.google.common.collect.Sets;                                                                   </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  28 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  29 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  30 import org.apache.calcite.sql.SqlInsert;                                                                 </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  31 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  32 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  33 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  34 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  35 import org.apache.calcite.sql.SqlOrderBy;                                                                </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  36 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="-8823326795697214951" onmouseenter="enter('-8823326795697214951');" onmouseout="out('-8823326795697214951');" style="">  37 import org.apache.calcite.sql.SqlWith;                                                                   </span>
<span class="9012576760183743580" onmouseenter="enter('9012576760183743580');" onmouseout="out('9012576760183743580');" style="">  38 import org.apache.calcite.sql.SqlWithItem;                                                               </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  39 import org.apache.calcite.sql.parser.SqlParseException;                                                  </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  40 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  41 import org.apache.flink.table.api.Table;                                                                 </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="">  42 import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  43 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  44 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  45                                                                                                          </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  46 import java.util.Map;                                                                                    </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  47 import java.util.Queue;                                                                                  </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  48 import java.util.Set;                                                                                    </span>
<span  style="">  49                                                                                                          </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  50 import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                 </span>
<span class="5903201271827982207" onmouseenter="enter('5903201271827982207');" onmouseout="out('5903201271827982207');" style="">  51 import static org.apache.calcite.sql.SqlKind.LITERAL;                                                    </span>
<span  style="">  52                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  53 /**                                                                                                      </span>
<span class="7605977213454941184" onmouseenter="enter('7605977213454941184');" onmouseout="out('7605977213454941184');" style="">  54  * Parsing sql, obtain execution information dimension table                                             </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  55  * Date: 2018/7/24                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  56  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  57  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  58  */                                                                                                      </span>
<span  style="">  59                                                                                                          </span>
<span class="3966585742332796558" onmouseenter="enter('3966585742332796558');" onmouseout="out('3966585742332796558');" style="">  60 public class SideSQLParser {                                                                             </span>
<span class="-77182390841532482" onmouseenter="enter('-77182390841532482');" onmouseout="out('-77182390841532482');" style="">  61     private static final Logger LOG = LoggerFactory.getLogger(SideSQLParser.class);                      </span>
<span  style="">  62                                                                                                          </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="">  63     private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                      </span>
<span  style="">  64                                                                                                          </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  65 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-462390148177184466" onmouseenter="enter('-462390148177184466');" onmouseout="out('-462390148177184466');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"><abbr title="  66 public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet, String scope) throws SqlParseException {">  66 public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet, String scope) throws SqlParseEx🔵</abbr></span>
<span class="-554334491296517619" onmouseenter="enter('-554334491296517619');" onmouseout="out('-554334491296517619');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  67         System.out.println(&quot;----------exec original Sql----------&quot;);                                     </span>
<span class="6408637245030246244" onmouseenter="enter('6408637245030246244');" onmouseout="out('6408637245030246244');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  68         System.out.println(exeSql);                                                                      </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  69 ||||||| BASE                                                                                             </span>
<span class="4228219262260732256" onmouseenter="enter('4228219262260732256');" onmouseout="out('4228219262260732256');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet) throws SqlParseException {     </span>
<span class="-554334491296517619" onmouseenter="enter('-554334491296517619');" onmouseout="out('-554334491296517619');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71         System.out.println(&quot;----------exec original Sql----------&quot;);                                     </span>
<span class="6408637245030246244" onmouseenter="enter('6408637245030246244');" onmouseout="out('6408637245030246244');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72         System.out.println(exeSql);                                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  73 =======                                                                                                  </span>
<span class="4228219262260732256" onmouseenter="enter('4228219262260732256');" onmouseout="out('4228219262260732256');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74 public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet) throws SqlParseException {     </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style="">  75 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-7947557255342642708" onmouseenter="enter('-7947557255342642708');" onmouseout="out('-7947557255342642708');" style="">  76         LOG.info(&quot;----------exec original Sql----------&quot;);                                               </span>
<span class="1058132582852180835" onmouseenter="enter('1058132582852180835');" onmouseout="out('1058132582852180835');" style="">  77         LOG.info(exeSql);                                                                                </span>
<span  style="">  78                                                                                                          </span>
<span class="5128011700743018451" onmouseenter="enter('5128011700743018451');" onmouseout="out('5128011700743018451');" style="">  79         Queue&lt;Object&gt; queueInfo = Queues.newLinkedBlockingQueue();                                       </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style="">  80         FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                                  </span>
<span class="-6421300158550037914" onmouseenter="enter('-6421300158550037914');" onmouseout="out('-6421300158550037914');" style="">  81         SqlNode sqlNode = flinkPlanner.parse(exeSql);                                                    </span>
<span  style="">  82                                                                                                          </span>
<span class="-139933501212153033" onmouseenter="enter('-139933501212153033');" onmouseout="out('-139933501212153033');" style="">  83         parseSql(sqlNode, sideTableSet, queueInfo, null, null, null, scope);                             </span>
<span class="2886026929410252587" onmouseenter="enter('2886026929410252587');" onmouseout="out('2886026929410252587');" style="">  84         queueInfo.offer(sqlNode);                                                                        </span>
<span class="-7280577500312652584" onmouseenter="enter('-7280577500312652584');" onmouseout="out('-7280577500312652584');" style="">  85         return queueInfo;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86     }                                                                                                    </span>
<span  style="">  87                                                                                                          </span>
<span  style="">  88                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  89     /**                                                                                                  </span>
<span class="-3708169461439447854" onmouseenter="enter('-3708169461439447854');" onmouseout="out('-3708169461439447854');" style="">  90      *  解析 sql 根据维表 join关系重新组装新的sql                                                                      </span>
<span class="3061148848694484073" onmouseenter="enter('3061148848694484073');" onmouseout="out('3061148848694484073');" style="">  91      * @param sqlNode                                                                                    </span>
<span class="-8651210754005562825" onmouseenter="enter('-8651210754005562825');" onmouseout="out('-8651210754005562825');" style="">  92      * @param sideTableSet                                                                               </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style="">  93      * @param queueInfo                                                                                  </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style="">  94      * @param parentWhere                                                                                </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style="">  95      * @param parentSelectList                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">  96      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  97      */                                                                                                  </span>
<span class="-4912114046735086097" onmouseenter="enter('-4912114046735086097');" onmouseout="out('-4912114046735086097');" style="">  98     public Object parseSql(SqlNode sqlNode,                                                              </span>
<span class="-1952250395521254109" onmouseenter="enter('-1952250395521254109');" onmouseout="out('-1952250395521254109');" style="">  99                            Set&lt;String&gt; sideTableSet,                                                     </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style=""> 100                            Queue&lt;Object&gt; queueInfo,                                                      </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style=""> 101                            SqlNode parentWhere,                                                          </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style=""> 102                            SqlNodeList parentSelectList,                                                 </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style=""> 103                            SqlNodeList parentGroupByList,                                                </span>
<span class="1499010499274846565" onmouseenter="enter('1499010499274846565');" onmouseout="out('1499010499274846565');" style=""> 104                            String scope){                                                                </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 105         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style=""> 106         switch (sqlKind){                                                                                </span>
<span class="-4895776563178477738" onmouseenter="enter('-4895776563178477738');" onmouseout="out('-4895776563178477738');" style=""> 107             case WITH: {                                                                                 </span>
<span class="1074402989354786172" onmouseenter="enter('1074402989354786172');" onmouseout="out('1074402989354786172');" style=""> 108                 SqlWith sqlWith = (SqlWith) sqlNode;                                                     </span>
<span class="1112510853537726574" onmouseenter="enter('1112510853537726574');" onmouseout="out('1112510853537726574');" style=""> 109                 SqlNodeList sqlNodeList = sqlWith.withList;                                              </span>
<span class="5898329184559807321" onmouseenter="enter('5898329184559807321');" onmouseout="out('5898329184559807321');" style=""> 110                 for (SqlNode withAsTable : sqlNodeList) {                                                </span>
<span class="5054103522612994093" onmouseenter="enter('5054103522612994093');" onmouseout="out('5054103522612994093');" style=""> 111                     SqlWithItem sqlWithItem = (SqlWithItem) withAsTable;                                 </span>
<span class="3110928689497337082" onmouseenter="enter('3110928689497337082');" onmouseout="out('3110928689497337082');" style=""><abbr title=" 112                     parseSql(sqlWithItem.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 112                     parseSql(sqlWithItem.query, sideTableSet, queueInfo, parentWhere, parentSelectList, p🔵</abbr></span>
<span class="558256818041950127" onmouseenter="enter('558256818041950127');" onmouseout="out('558256818041950127');" style=""> 113                     queueInfo.add(sqlWithItem);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114                 }                                                                                        </span>
<span class="-8548018655211213586" onmouseenter="enter('-8548018655211213586');" onmouseout="out('-8548018655211213586');" style=""><abbr title=" 115                 parseSql(sqlWith.body, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 115                 parseSql(sqlWith.body, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGrou🔵</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 116                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117             }                                                                                            </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 118             case INSERT:                                                                                 </span>
<span class="-7853295063534246070" onmouseenter="enter('-7853295063534246070');" onmouseout="out('-7853295063534246070');" style=""> 119                 SqlNode sqlSource = ((SqlInsert)sqlNode).getSource();                                    </span>
<span class="5867380015935317570" onmouseenter="enter('5867380015935317570');" onmouseout="out('5867380015935317570');" style=""><abbr title=" 120                 return parseSql(sqlSource, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 120                 return parseSql(sqlSource, sideTableSet, queueInfo, parentWhere, parentSelectList, parent🔵</abbr></span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 121             case SELECT:                                                                                 </span>
<span class="-737340637367962148" onmouseenter="enter('-737340637367962148');" onmouseout="out('-737340637367962148');" style=""> 122                 SqlNode sqlFrom = ((SqlSelect)sqlNode).getFrom();                                        </span>
<span class="-4595996050370151557" onmouseenter="enter('-4595996050370151557');" onmouseout="out('-4595996050370151557');" style=""> 123                 SqlNode sqlWhere = ((SqlSelect)sqlNode).getWhere();                                      </span>
<span class="-6539957329780970839" onmouseenter="enter('-6539957329780970839');" onmouseout="out('-6539957329780970839');" style=""> 124                 SqlNodeList selectList = ((SqlSelect)sqlNode).getSelectList();                           </span>
<span class="1382610957563429127" onmouseenter="enter('1382610957563429127');" onmouseout="out('1382610957563429127');" style=""> 125                 SqlNodeList groupByList = ((SqlSelect) sqlNode).getGroup();                              </span>
<span  style=""> 126                                                                                                          </span>
<span class="-6669062104161423555" onmouseenter="enter('-6669062104161423555');" onmouseout="out('-6669062104161423555');" style=""> 127                 if(sqlFrom.getKind() != IDENTIFIER){                                                     </span>
<span class="-593702489163539700" onmouseenter="enter('-593702489163539700');" onmouseout="out('-593702489163539700');" style=""><abbr title=" 128                     Object result = parseSql(sqlFrom, sideTableSet, queueInfo, sqlWhere, selectList, groupByList, scope);"> 128                     Object result = parseSql(sqlFrom, sideTableSet, queueInfo, sqlWhere, selectList, grou🔵</abbr></span>
<span class="7802562789325773256" onmouseenter="enter('7802562789325773256');" onmouseout="out('7802562789325773256');" style=""> 129                     if(result instanceof JoinInfo){                                                      </span>
<span class="-8441429291693214923" onmouseenter="enter('-8441429291693214923');" onmouseout="out('-8441429291693214923');" style=""><abbr title=" 130                         return TableUtils.dealSelectResultWithJoinInfo((JoinInfo) result, (SqlSelect) sqlNode, queueInfo);"> 130                         return TableUtils.dealSelectResultWithJoinInfo((JoinInfo) result, (SqlSelect) sql🔵</abbr></span>
<span class="1716266177589910912" onmouseenter="enter('1716266177589910912');" onmouseout="out('1716266177589910912');" style=""> 131                     }else if(result instanceof AliasInfo){                                               </span>
<span class="-6975694729646816765" onmouseenter="enter('-6975694729646816765');" onmouseout="out('-6975694729646816765');" style=""> 132                         String tableName = ((AliasInfo) result).getName();                               </span>
<span class="23740069362058607" onmouseenter="enter('23740069362058607');" onmouseout="out('23740069362058607');" style=""> 133                         if(sideTableSet.contains(tableName)){                                            </span>
<span class="-1760230060361710630" onmouseenter="enter('-1760230060361710630');" onmouseout="out('-1760230060361710630');" style=""> 134                             throw new RuntimeException(&quot;side-table must be used in join operator&quot;);      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136                     }                                                                                    </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 137                 }else{                                                                                   </span>
<span class="1420748888812461485" onmouseenter="enter('1420748888812461485');" onmouseout="out('1420748888812461485');" style=""> 138                     String tableName = ((SqlIdentifier)sqlFrom).getSimple();                             </span>
<span class="23740069362058607" onmouseenter="enter('23740069362058607');" onmouseout="out('23740069362058607');" style=""> 139                     if(sideTableSet.contains(tableName)){                                                </span>
<span class="-1760230060361710630" onmouseenter="enter('-1760230060361710630');" onmouseout="out('-1760230060361710630');" style=""> 140                         throw new RuntimeException(&quot;side-table must be used in join operator&quot;);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 143                 break;                                                                                   </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 144             case JOIN:                                                                                   </span>
<span class="-3111758306527220061" onmouseenter="enter('-3111758306527220061');" onmouseout="out('-3111758306527220061');" style=""> 145                 JoinNodeDealer joinNodeDealer = new JoinNodeDealer(this);                                </span>
<span class="9078002366390414240" onmouseenter="enter('9078002366390414240');" onmouseout="out('9078002366390414240');" style=""> 146                 Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet = Sets.newHashSet();                            </span>
<span class="1100449665231490148" onmouseenter="enter('1100449665231490148');" onmouseout="out('1100449665231490148');" style=""> 147                 Map&lt;String, String&gt; tableRef = Maps.newHashMap();                                        </span>
<span class="-6306168579289105112" onmouseenter="enter('-6306168579289105112');" onmouseout="out('-6306168579289105112');" style=""> 148                 Map&lt;String, String&gt; fieldRef = Maps.newHashMap();                                        </span>
<span class="-1512934165488206441" onmouseenter="enter('-1512934165488206441');" onmouseout="out('-1512934165488206441');" style=""> 149                 return joinNodeDealer.dealJoinNode((SqlJoin) sqlNode, sideTableSet, queueInfo,           </span>
<span class="-8388746013614283447" onmouseenter="enter('-8388746013614283447');" onmouseout="out('-8388746013614283447');" style=""><abbr title=" 150                         parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef, scope);"> 150                         parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRe🔵</abbr></span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 151             case AS:                                                                                     </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 152                 SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                 </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 153                 SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                               </span>
<span class="-7314337242875568781" onmouseenter="enter('-7314337242875568781');" onmouseout="out('-7314337242875568781');" style=""> 154                 String infoStr = &quot;&quot;;                                                                     </span>
<span  style=""> 155                                                                                                          </span>
<span class="2126841880433088777" onmouseenter="enter('2126841880433088777');" onmouseout="out('2126841880433088777');" style=""> 156                 if(info.getKind() == IDENTIFIER){                                                        </span>
<span class="-6527219795850644409" onmouseenter="enter('-6527219795850644409');" onmouseout="out('-6527219795850644409');" style=""> 157                     infoStr = info.toString();                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 158                 } else {                                                                                 </span>
<span class="-2058738663149093900" onmouseenter="enter('-2058738663149093900');" onmouseout="out('-2058738663149093900');" style=""><abbr title=" 159                     infoStr = parseSql(info, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope).toString();"> 159                     infoStr = parseSql(info, sideTableSet, queueInfo, parentWhere, parentSelectList, pare🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160                 }                                                                                        </span>
<span  style=""> 161                                                                                                          </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 162                 AliasInfo aliasInfo = new AliasInfo();                                                   </span>
<span class="-6330277266292138558" onmouseenter="enter('-6330277266292138558');" onmouseout="out('-6330277266292138558');" style=""> 163                 aliasInfo.setName(infoStr);                                                              </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 164                 aliasInfo.setAlias(alias.toString());                                                    </span>
<span  style=""> 165                                                                                                          </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 166                 return aliasInfo;                                                                        </span>
<span  style=""> 167                                                                                                          </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 168             case UNION:                                                                                  </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 169                 SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                            </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 170                 SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                           </span>
<span  style=""> 171                                                                                                          </span>
<span class="413085527251650631" onmouseenter="enter('413085527251650631');" onmouseout="out('413085527251650631');" style=""><abbr title=" 172                 parseSql(unionLeft, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 172                 parseSql(unionLeft, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupBy🔵</abbr></span>
<span class="5239612470789521882" onmouseenter="enter('5239612470789521882');" onmouseout="out('5239612470789521882');" style=""><abbr title=" 173                 parseSql(unionRight, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 173                 parseSql(unionRight, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupB🔵</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 174                 break;                                                                                   </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 175             case ORDER_BY:                                                                               </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 176                 SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                           </span>
<span class="-7455932962237326040" onmouseenter="enter('-7455932962237326040');" onmouseout="out('-7455932962237326040');" style=""><abbr title=" 177                 parseSql(sqlOrderBy.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 177                 parseSql(sqlOrderBy.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parent🔵</abbr></span>
<span  style=""> 178                                                                                                          </span>
<span class="-2988899114509087250" onmouseenter="enter('-2988899114509087250');" onmouseout="out('-2988899114509087250');" style=""> 179             case LITERAL:                                                                                </span>
<span class="2819024748306122432" onmouseenter="enter('2819024748306122432');" onmouseout="out('2819024748306122432');" style=""> 180                 return LITERAL.toString();                                                               </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 181             default:                                                                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 182                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183         }                                                                                                </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 184         return &quot;&quot;;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185     }                                                                                                    </span>
<span  style=""> 186                                                                                                          </span>
<span  style=""> 187                                                                                                          </span>
<span  style=""> 188                                                                                                          </span>
<span  style=""> 189                                                                                                          </span>
<span class="-649401327769177886" onmouseenter="enter('-649401327769177886');" onmouseout="out('-649401327769177886');" style=""> 190     public void setLocalTableCache(Map&lt;String, Table&gt; localTableCache) {                                 </span>
<span class="-1916936159945030154" onmouseenter="enter('-1916936159945030154');" onmouseout="out('-1916936159945030154');" style=""> 191         this.localTableCache = localTableCache;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192     }                                                                                                    </span>
<span  style=""> 193                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  18 package com.dtstack.flink.sql.side;                                                                      </span>
<span  style="">  19                                                                                                          </span>
<span class="-283888887417937620" onmouseenter="enter('-283888887417937620');" onmouseout="out('-283888887417937620');" style="">  20 import com.dtstack.flink.sql.parser.FlinkPlanner;                                                        </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  21 import com.dtstack.flink.sql.util.TableUtils;                                                            </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  22 import com.google.common.collect.Maps;                                                                   </span>
<span class="1397139485218690137" onmouseenter="enter('1397139485218690137');" onmouseout="out('1397139485218690137');" style="">  23 import com.google.common.collect.Queues;                                                                 </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  24 import com.google.common.collect.Sets;                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  25 import java.util.Map;                                                                                    </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  26 import java.util.Queue;                                                                                  </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  27 import java.util.Set;                                                                                    </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  28 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  29 import org.apache.calcite.sql.SqlIdentifier;                                                             </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  30 import org.apache.calcite.sql.SqlInsert;                                                                 </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  31 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  32 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  33 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  34 import org.apache.calcite.sql.SqlNodeList;                                                               </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  35 import org.apache.calcite.sql.SqlOrderBy;                                                                </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  36 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="-8823326795697214951" onmouseenter="enter('-8823326795697214951');" onmouseout="out('-8823326795697214951');" style="">  37 import org.apache.calcite.sql.SqlWith;                                                                   </span>
<span class="9012576760183743580" onmouseenter="enter('9012576760183743580');" onmouseout="out('9012576760183743580');" style="">  38 import org.apache.calcite.sql.SqlWithItem;                                                               </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  39 import org.apache.calcite.sql.parser.SqlParseException;                                                  </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  40 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  41 import org.apache.flink.table.api.Table;                                                                 </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="">  42 import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  43 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  44 import org.slf4j.LoggerFactory;                                                                          </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  45 import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                 </span>
<span class="5903201271827982207" onmouseenter="enter('5903201271827982207');" onmouseout="out('5903201271827982207');" style="">  46 import static org.apache.calcite.sql.SqlKind.LITERAL;                                                    </span>
<span  style="">  47                                                                                                          </span>
<span  style="">  48                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  49 /**                                                                                                      </span>
<span class="7605977213454941184" onmouseenter="enter('7605977213454941184');" onmouseout="out('7605977213454941184');" style="">  50  * Parsing sql, obtain execution information dimension table                                             </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  51  * Date: 2018/7/24                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  52  * Company: www.dtstack.com                                                                              </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  53  * @author xuchao                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  54  */                                                                                                      </span>
<span class="3966585742332796558" onmouseenter="enter('3966585742332796558');" onmouseout="out('3966585742332796558');" style="">  55 public class SideSQLParser {                                                                             </span>
<span class="-77182390841532482" onmouseenter="enter('-77182390841532482');" onmouseout="out('-77182390841532482');" style="">  56     private static final Logger LOG = LoggerFactory.getLogger(SideSQLParser.class);                      </span>
<span  style="">  57                                                                                                          </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="">  58     private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                      </span>
<span  style="">  59                                                                                                          </span>
<span class="-462390148177184466" onmouseenter="enter('-462390148177184466');" onmouseout="out('-462390148177184466');" style=""><abbr title="  60     public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet, String scope) throws SqlParseException {">  60     public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet, String scope) throws SqlPar🔵</abbr></span>
<span class="-7947557255342642708" onmouseenter="enter('-7947557255342642708');" onmouseout="out('-7947557255342642708');" style="">  61         LOG.info(&quot;----------exec original Sql----------&quot;);                                               </span>
<span class="1058132582852180835" onmouseenter="enter('1058132582852180835');" onmouseout="out('1058132582852180835');" style="">  62         LOG.info(exeSql);                                                                                </span>
<span class="5128011700743018451" onmouseenter="enter('5128011700743018451');" onmouseout="out('5128011700743018451');" style="">  63         Queue&lt;Object&gt; queueInfo = Queues.newLinkedBlockingQueue();                                       </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style="">  64         FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                                  </span>
<span class="-6421300158550037914" onmouseenter="enter('-6421300158550037914');" onmouseout="out('-6421300158550037914');" style="">  65         SqlNode sqlNode = flinkPlanner.parse(exeSql);                                                    </span>
<span class="-139933501212153033" onmouseenter="enter('-139933501212153033');" onmouseout="out('-139933501212153033');" style="">  66         parseSql(sqlNode, sideTableSet, queueInfo, null, null, null, scope);                             </span>
<span class="2886026929410252587" onmouseenter="enter('2886026929410252587');" onmouseout="out('2886026929410252587');" style="">  67         queueInfo.offer(sqlNode);                                                                        </span>
<span class="-7280577500312652584" onmouseenter="enter('-7280577500312652584');" onmouseout="out('-7280577500312652584');" style="">  68         return queueInfo;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69     }                                                                                                    </span>
<span  style="">  70                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  71     /**                                                                                                  </span>
<span class="-3708169461439447854" onmouseenter="enter('-3708169461439447854');" onmouseout="out('-3708169461439447854');" style="">  72      *  解析 sql 根据维表 join关系重新组装新的sql                                                                      </span>
<span class="3061148848694484073" onmouseenter="enter('3061148848694484073');" onmouseout="out('3061148848694484073');" style="">  73      * @param sqlNode                                                                                    </span>
<span class="-8651210754005562825" onmouseenter="enter('-8651210754005562825');" onmouseout="out('-8651210754005562825');" style="">  74      * @param sideTableSet                                                                               </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style="">  75      * @param queueInfo                                                                                  </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style="">  76      * @param parentWhere                                                                                </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style="">  77      * @param parentSelectList                                                                           </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">  78      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  79      */                                                                                                  </span>
<span class="7540164783980983195" onmouseenter="enter('7540164783980983195');" onmouseout="out('7540164783980983195');" style=""><abbr title="  80     public Object parseSql(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueInfo, SqlNode parentWhere, SqlNodeList parentSelectList, SqlNodeList parentGroupByList, String scope) {">  80     public Object parseSql(SqlNode sqlNode, Set&lt;String&gt; sideTableSet, Queue&lt;Object&gt; queueInfo, SqlNode pa🔵</abbr></span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  81         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style="">  82         switch (sqlKind) {                                                                               </span>
<span class="-8624837119986957540" onmouseenter="enter('-8624837119986957540');" onmouseout="out('-8624837119986957540');" style="">  83             case WITH :                                                                                  </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style="">  84                 {                                                                                        </span>
<span class="-5613792330367174153" onmouseenter="enter('-5613792330367174153');" onmouseout="out('-5613792330367174153');" style="">  85                     SqlWith sqlWith = ((SqlWith) (sqlNode));                                             </span>
<span class="1112510853537726574" onmouseenter="enter('1112510853537726574');" onmouseout="out('1112510853537726574');" style="">  86                     SqlNodeList sqlNodeList = sqlWith.withList;                                          </span>
<span class="5898329184559807321" onmouseenter="enter('5898329184559807321');" onmouseout="out('5898329184559807321');" style="">  87                     for (SqlNode withAsTable : sqlNodeList) {                                            </span>
<span class="7351066786664767555" onmouseenter="enter('7351066786664767555');" onmouseout="out('7351066786664767555');" style="">  88                         SqlWithItem sqlWithItem = ((SqlWithItem) (withAsTable));                         </span>
<span class="3110928689497337082" onmouseenter="enter('3110928689497337082');" onmouseout="out('3110928689497337082');" style=""><abbr title="  89                         parseSql(sqlWithItem.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);">  89                         parseSql(sqlWithItem.query, sideTableSet, queueInfo, parentWhere, parentSelectLis🔵</abbr></span>
<span class="558256818041950127" onmouseenter="enter('558256818041950127');" onmouseout="out('558256818041950127');" style="">  90                         queueInfo.add(sqlWithItem);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91                     }                                                                                    </span>
<span class="-8548018655211213586" onmouseenter="enter('-8548018655211213586');" onmouseout="out('-8548018655211213586');" style=""><abbr title="  92                     parseSql(sqlWith.body, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);">  92                     parseSql(sqlWith.body, sideTableSet, queueInfo, parentWhere, parentSelectList, parent🔵</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="">  93                     break;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94                 }                                                                                        </span>
<span class="-3229205352829537061" onmouseenter="enter('-3229205352829537061');" onmouseout="out('-3229205352829537061');" style="">  95             case INSERT :                                                                                </span>
<span class="4923379117766569884" onmouseenter="enter('4923379117766569884');" onmouseout="out('4923379117766569884');" style="">  96                 SqlNode sqlSource = ((SqlInsert) (sqlNode)).getSource();                                 </span>
<span class="5867380015935317570" onmouseenter="enter('5867380015935317570');" onmouseout="out('5867380015935317570');" style=""><abbr title="  97                 return parseSql(sqlSource, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);">  97                 return parseSql(sqlSource, sideTableSet, queueInfo, parentWhere, parentSelectList, parent🔵</abbr></span>
<span class="-3198951126756304146" onmouseenter="enter('-3198951126756304146');" onmouseout="out('-3198951126756304146');" style="">  98             case SELECT :                                                                                </span>
<span class="-1459310299914917625" onmouseenter="enter('-1459310299914917625');" onmouseout="out('-1459310299914917625');" style="">  99                 SqlNode sqlFrom = ((SqlSelect) (sqlNode)).getFrom();                                     </span>
<span class="-2393426376845809432" onmouseenter="enter('-2393426376845809432');" onmouseout="out('-2393426376845809432');" style=""> 100                 SqlNode sqlWhere = ((SqlSelect) (sqlNode)).getWhere();                                   </span>
<span class="-3132291294692602869" onmouseenter="enter('-3132291294692602869');" onmouseout="out('-3132291294692602869');" style=""> 101                 SqlNodeList selectList = ((SqlSelect) (sqlNode)).getSelectList();                        </span>
<span class="-8102726577559173244" onmouseenter="enter('-8102726577559173244');" onmouseout="out('-8102726577559173244');" style=""> 102                 SqlNodeList groupByList = ((SqlSelect) (sqlNode)).getGroup();                            </span>
<span class="5209906327995996306" onmouseenter="enter('5209906327995996306');" onmouseout="out('5209906327995996306');" style=""> 103                 if (sqlFrom.getKind() != IDENTIFIER) {                                                   </span>
<span class="-593702489163539700" onmouseenter="enter('-593702489163539700');" onmouseout="out('-593702489163539700');" style=""><abbr title=" 104                     Object result = parseSql(sqlFrom, sideTableSet, queueInfo, sqlWhere, selectList, groupByList, scope);"> 104                     Object result = parseSql(sqlFrom, sideTableSet, queueInfo, sqlWhere, selectList, grou🔵</abbr></span>
<span class="-2846633646845060547" onmouseenter="enter('-2846633646845060547');" onmouseout="out('-2846633646845060547');" style=""> 105                     if (result instanceof JoinInfo) {                                                    </span>
<span class="3265840953062921003" onmouseenter="enter('3265840953062921003');" onmouseout="out('3265840953062921003');" style=""><abbr title=" 106                         return TableUtils.dealSelectResultWithJoinInfo(((JoinInfo) (result)), ((SqlSelect) (sqlNode)), queueInfo);"> 106                         return TableUtils.dealSelectResultWithJoinInfo(((JoinInfo) (result)), ((SqlSelect🔵</abbr></span>
<span class="-793414957286274210" onmouseenter="enter('-793414957286274210');" onmouseout="out('-793414957286274210');" style=""> 107                     } else if (result instanceof AliasInfo) {                                            </span>
<span class="6118954434459284547" onmouseenter="enter('6118954434459284547');" onmouseout="out('6118954434459284547');" style=""> 108                         String tableName = ((AliasInfo) (result)).getName();                             </span>
<span class="7998125235127077949" onmouseenter="enter('7998125235127077949');" onmouseout="out('7998125235127077949');" style=""> 109                         if (sideTableSet.contains(tableName)) {                                          </span>
<span class="-1760230060361710630" onmouseenter="enter('-1760230060361710630');" onmouseout="out('-1760230060361710630');" style=""> 110                             throw new RuntimeException(&quot;side-table must be used in join operator&quot;);      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112                     }                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 113                 } else {                                                                                 </span>
<span class="-4890106399696482914" onmouseenter="enter('-4890106399696482914');" onmouseout="out('-4890106399696482914');" style=""> 114                     String tableName = ((SqlIdentifier) (sqlFrom)).getSimple();                          </span>
<span class="7998125235127077949" onmouseenter="enter('7998125235127077949');" onmouseout="out('7998125235127077949');" style=""> 115                     if (sideTableSet.contains(tableName)) {                                              </span>
<span class="-1760230060361710630" onmouseenter="enter('-1760230060361710630');" onmouseout="out('-1760230060361710630');" style=""> 116                         throw new RuntimeException(&quot;side-table must be used in join operator&quot;);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 119                 break;                                                                                   </span>
<span class="-6812790603264225102" onmouseenter="enter('-6812790603264225102');" onmouseout="out('-6812790603264225102');" style=""> 120             case JOIN :                                                                                  </span>
<span class="-3111758306527220061" onmouseenter="enter('-3111758306527220061');" onmouseout="out('-3111758306527220061');" style=""> 121                 JoinNodeDealer joinNodeDealer = new JoinNodeDealer(this);                                </span>
<span class="9078002366390414240" onmouseenter="enter('9078002366390414240');" onmouseout="out('9078002366390414240');" style=""> 122                 Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet = Sets.newHashSet();                            </span>
<span class="1100449665231490148" onmouseenter="enter('1100449665231490148');" onmouseout="out('1100449665231490148');" style=""> 123                 Map&lt;String, String&gt; tableRef = Maps.newHashMap();                                        </span>
<span class="-6306168579289105112" onmouseenter="enter('-6306168579289105112');" onmouseout="out('-6306168579289105112');" style=""> 124                 Map&lt;String, String&gt; fieldRef = Maps.newHashMap();                                        </span>
<span class="5224746362656952052" onmouseenter="enter('5224746362656952052');" onmouseout="out('5224746362656952052');" style=""><abbr title=" 125                 return joinNodeDealer.dealJoinNode(((SqlJoin) (sqlNode)), sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef, scope);"> 125                 return joinNodeDealer.dealJoinNode(((SqlJoin) (sqlNode)), sideTableSet, queueInfo, parent🔵</abbr></span>
<span class="-7603101237578294688" onmouseenter="enter('-7603101237578294688');" onmouseout="out('-7603101237578294688');" style=""> 126             case AS :                                                                                    </span>
<span class="-2581148716866963551" onmouseenter="enter('-2581148716866963551');" onmouseout="out('-2581148716866963551');" style=""> 127                 SqlNode info = ((SqlBasicCall) (sqlNode)).getOperands()[0];                              </span>
<span class="6674876786664753496" onmouseenter="enter('6674876786664753496');" onmouseout="out('6674876786664753496');" style=""> 128                 SqlNode alias = ((SqlBasicCall) (sqlNode)).getOperands()[1];                             </span>
<span class="-7314337242875568781" onmouseenter="enter('-7314337242875568781');" onmouseout="out('-7314337242875568781');" style=""> 129                 String infoStr = &quot;&quot;;                                                                     </span>
<span class="3045881535147637942" onmouseenter="enter('3045881535147637942');" onmouseout="out('3045881535147637942');" style=""> 130                 if (info.getKind() == IDENTIFIER) {                                                      </span>
<span class="-6527219795850644409" onmouseenter="enter('-6527219795850644409');" onmouseout="out('-6527219795850644409');" style=""> 131                     infoStr = info.toString();                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 132                 } else {                                                                                 </span>
<span class="-2058738663149093900" onmouseenter="enter('-2058738663149093900');" onmouseout="out('-2058738663149093900');" style=""><abbr title=" 133                     infoStr = parseSql(info, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope).toString();"> 133                     infoStr = parseSql(info, sideTableSet, queueInfo, parentWhere, parentSelectList, pare🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134                 }                                                                                        </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 135                 AliasInfo aliasInfo = new AliasInfo();                                                   </span>
<span class="-6330277266292138558" onmouseenter="enter('-6330277266292138558');" onmouseout="out('-6330277266292138558');" style=""> 136                 aliasInfo.setName(infoStr);                                                              </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 137                 aliasInfo.setAlias(alias.toString());                                                    </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 138                 return aliasInfo;                                                                        </span>
<span class="1238941309895419592" onmouseenter="enter('1238941309895419592');" onmouseout="out('1238941309895419592');" style=""> 139             case UNION :                                                                                 </span>
<span class="3847221911167009847" onmouseenter="enter('3847221911167009847');" onmouseout="out('3847221911167009847');" style=""> 140                 SqlNode unionLeft = ((SqlBasicCall) (sqlNode)).getOperands()[0];                         </span>
<span class="-4021192438573809697" onmouseenter="enter('-4021192438573809697');" onmouseout="out('-4021192438573809697');" style=""> 141                 SqlNode unionRight = ((SqlBasicCall) (sqlNode)).getOperands()[1];                        </span>
<span class="413085527251650631" onmouseenter="enter('413085527251650631');" onmouseout="out('413085527251650631');" style=""><abbr title=" 142                 parseSql(unionLeft, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 142                 parseSql(unionLeft, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupBy🔵</abbr></span>
<span class="5239612470789521882" onmouseenter="enter('5239612470789521882');" onmouseout="out('5239612470789521882');" style=""><abbr title=" 143                 parseSql(unionRight, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 143                 parseSql(unionRight, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupB🔵</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 144                 break;                                                                                   </span>
<span class="9103487536272409028" onmouseenter="enter('9103487536272409028');" onmouseout="out('9103487536272409028');" style=""> 145             case ORDER_BY :                                                                              </span>
<span class="-6096761147743361957" onmouseenter="enter('-6096761147743361957');" onmouseout="out('-6096761147743361957');" style=""> 146                 SqlOrderBy sqlOrderBy = ((SqlOrderBy) (sqlNode));                                        </span>
<span class="-7455932962237326040" onmouseenter="enter('-7455932962237326040');" onmouseout="out('-7455932962237326040');" style=""><abbr title=" 147                 parseSql(sqlOrderBy.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 147                 parseSql(sqlOrderBy.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parent🔵</abbr></span>
<span class="-6513246306553746423" onmouseenter="enter('-6513246306553746423');" onmouseout="out('-6513246306553746423');" style=""> 148             case LITERAL :                                                                               </span>
<span class="2819024748306122432" onmouseenter="enter('2819024748306122432');" onmouseout="out('2819024748306122432');" style=""> 149                 return LITERAL.toString();                                                               </span>
<span class="3050734735710613783" onmouseenter="enter('3050734735710613783');" onmouseout="out('3050734735710613783');" style=""> 150             default :                                                                                    </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 151                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152         }                                                                                                </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 153         return &quot;&quot;;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span class="-649401327769177886" onmouseenter="enter('-649401327769177886');" onmouseout="out('-649401327769177886');" style=""> 156     public void setLocalTableCache(Map&lt;String, Table&gt; localTableCache) {                                 </span>
<span class="-1916936159945030154" onmouseenter="enter('-1916936159945030154');" onmouseout="out('-1916936159945030154');" style=""> 157         this.localTableCache = localTableCache;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159 }                                                                                                        </span>

































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="">  20                                                                                                                    </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  21  package com.dtstack.flink.sql.side;                                                                               </span>
<span  style="">  22                                                                                                                    </span>
<span class="-283888887417937620" onmouseenter="enter('-283888887417937620');" onmouseout="out('-283888887417937620');" style="">  23  import com.dtstack.flink.sql.parser.FlinkPlanner;                                                                 </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  24  import com.dtstack.flink.sql.util.TableUtils;                                                                     </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  25  import com.google.common.collect.Maps;                                                                            </span>
<span class="1397139485218690137" onmouseenter="enter('1397139485218690137');" onmouseout="out('1397139485218690137');" style="">  26  import com.google.common.collect.Queues;                                                                          </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  27  import com.google.common.collect.Sets;                                                                            </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  28  import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  29  import org.apache.calcite.sql.SqlIdentifier;                                                                      </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  30  import org.apache.calcite.sql.SqlInsert;                                                                          </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  31  import org.apache.calcite.sql.SqlJoin;                                                                            </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  32  import org.apache.calcite.sql.SqlKind;                                                                            </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  33  import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  34  import org.apache.calcite.sql.SqlNodeList;                                                                        </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  35  import org.apache.calcite.sql.SqlOrderBy;                                                                         </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  36  import org.apache.calcite.sql.SqlSelect;                                                                          </span>
<span class="-8823326795697214951" onmouseenter="enter('-8823326795697214951');" onmouseout="out('-8823326795697214951');" style="">  37  import org.apache.calcite.sql.SqlWith;                                                                            </span>
<span class="9012576760183743580" onmouseenter="enter('9012576760183743580');" onmouseout="out('9012576760183743580');" style="">  38  import org.apache.calcite.sql.SqlWithItem;                                                                        </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  39  import org.apache.calcite.sql.parser.SqlParseException;                                                           </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  40  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  41  import org.apache.flink.table.api.Table;                                                                          </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="">  42  import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  43  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  44  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  45                                                                                                                    </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  46  import java.util.Map;                                                                                             </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  47  import java.util.Queue;                                                                                           </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  48  import java.util.Set;                                                                                             </span>
<span  style="">  49                                                                                                                    </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="">  50  import static org.apache.calcite.sql.SqlKind.*;                                                                   </span>


<span  style="">  51                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  52  /**                                                                                                               </span>
<span class="7605977213454941184" onmouseenter="enter('7605977213454941184');" onmouseout="out('7605977213454941184');" style="">  53   * Parsing sql, obtain execution information dimension table                                                      </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  54   * Date: 2018/7/24                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  55   * Company: www.dtstack.com                                                                                       </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  56   * @author xuchao                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  57   */                                                                                                               </span>
<span  style="">  58                                                                                                                    </span>
<span class="3966585742332796558" onmouseenter="enter('3966585742332796558');" onmouseout="out('3966585742332796558');" style="">  59  public class SideSQLParser {                                                                                      </span>
<span class="-77182390841532482" onmouseenter="enter('-77182390841532482');" onmouseout="out('-77182390841532482');" style="">  60      private static final Logger LOG = LoggerFactory.getLogger(SideSQLParser.class);                               </span>
<span  style="">  61                                                                                                                    </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="">  62      private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                               </span>
<span  style="">  63                                                                                                                    </span>
<span class="4228219262260732256" onmouseenter="enter('4228219262260732256');" onmouseout="out('4228219262260732256');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  64 -    public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet) throws SqlParseException {          </span>
<span class="-462390148177184466" onmouseenter="enter('-462390148177184466');" onmouseout="out('-462390148177184466');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title="  65 +    public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet, String scope) throws SqlParseException {">  65 +    public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet, String scope) throws SqlParseExcepti🔵</abbr></span>
<span class="-554334491296517619" onmouseenter="enter('-554334491296517619');" onmouseout="out('-554334491296517619');" style="">  66          System.out.println(&quot;----------exec original Sql----------&quot;);                                              </span>
<span class="6408637245030246244" onmouseenter="enter('6408637245030246244');" onmouseout="out('6408637245030246244');" style="">  67          System.out.println(exeSql);                                                                               </span>
<span class="-7947557255342642708" onmouseenter="enter('-7947557255342642708');" onmouseout="out('-7947557255342642708');" style="">  68          LOG.info(&quot;----------exec original Sql----------&quot;);                                                        </span>
<span class="1058132582852180835" onmouseenter="enter('1058132582852180835');" onmouseout="out('1058132582852180835');" style="">  69          LOG.info(exeSql);                                                                                         </span>
<span  style="">  70                                                                                                                    </span>
<span class="5128011700743018451" onmouseenter="enter('5128011700743018451');" onmouseout="out('5128011700743018451');" style="">  71          Queue&lt;Object&gt; queueInfo = Queues.newLinkedBlockingQueue();                                                </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style="">  72          FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                                           </span>
<span class="-6421300158550037914" onmouseenter="enter('-6421300158550037914');" onmouseout="out('-6421300158550037914');" style="">  73          SqlNode sqlNode = flinkPlanner.parse(exeSql);                                                             </span>
<span  style="">  74                                                                                                                    </span>
<span class="-9041946153418018780" onmouseenter="enter('-9041946153418018780');" onmouseout="out('-9041946153418018780');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  75 -        parseSql(sqlNode, sideTableSet, queueInfo, null, null, null);                                             </span>
<span class="-139933501212153033" onmouseenter="enter('-139933501212153033');" onmouseout="out('-139933501212153033');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +        parseSql(sqlNode, sideTableSet, queueInfo, null, null, null, scope);                                      </span>
<span class="2886026929410252587" onmouseenter="enter('2886026929410252587');" onmouseout="out('2886026929410252587');" style="">  77          queueInfo.offer(sqlNode);                                                                                 </span>
<span class="-7280577500312652584" onmouseenter="enter('-7280577500312652584');" onmouseout="out('-7280577500312652584');" style="">  78          return queueInfo;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79      }                                                                                                             </span>
<span  style="">  80                                                                                                                    </span>
<span  style="">  81                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  82      /**                                                                                                           </span>
<span class="-3708169461439447854" onmouseenter="enter('-3708169461439447854');" onmouseout="out('-3708169461439447854');" style="">  83       *  解析 sql 根据维表 join关系重新组装新的sql                                                                               </span>
<span class="3061148848694484073" onmouseenter="enter('3061148848694484073');" onmouseout="out('3061148848694484073');" style="">  84       * @param sqlNode                                                                                             </span>
<span class="-8651210754005562825" onmouseenter="enter('-8651210754005562825');" onmouseout="out('-8651210754005562825');" style="">  85       * @param sideTableSet                                                                                        </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style="">  86       * @param queueInfo                                                                                           </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style="">  87       * @param parentWhere                                                                                         </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style="">  88       * @param parentSelectList                                                                                    </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">  89       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  90       */                                                                                                           </span>
<span class="-4912114046735086097" onmouseenter="enter('-4912114046735086097');" onmouseout="out('-4912114046735086097');" style="">  91      public Object parseSql(SqlNode sqlNode,                                                                       </span>
<span class="-1952250395521254109" onmouseenter="enter('-1952250395521254109');" onmouseout="out('-1952250395521254109');" style="">  92                             Set&lt;String&gt; sideTableSet,                                                              </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style="">  93                             Queue&lt;Object&gt; queueInfo,                                                               </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style="">  94                             SqlNode parentWhere,                                                                   </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style="">  95                             SqlNodeList parentSelectList,                                                          </span>
<span class="1233396441588378287" onmouseenter="enter('1233396441588378287');" onmouseout="out('1233396441588378287');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -                           SqlNodeList parentGroupByList){                                                        </span>
<span class="2895297379320094873" onmouseenter="enter('2895297379320094873');" onmouseout="out('2895297379320094873');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +                           SqlNodeList parentGroupByList,                                                         </span>
<span class="1499010499274846565" onmouseenter="enter('1499010499274846565');" onmouseout="out('1499010499274846565');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +                           String scope){                                                                         </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  99          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style=""> 100          switch (sqlKind){                                                                                         </span>
<span class="-4895776563178477738" onmouseenter="enter('-4895776563178477738');" onmouseout="out('-4895776563178477738');" style=""> 101              case WITH: {                                                                                          </span>
<span class="1074402989354786172" onmouseenter="enter('1074402989354786172');" onmouseout="out('1074402989354786172');" style=""> 102                  SqlWith sqlWith = (SqlWith) sqlNode;                                                              </span>
<span class="1112510853537726574" onmouseenter="enter('1112510853537726574');" onmouseout="out('1112510853537726574');" style=""> 103                  SqlNodeList sqlNodeList = sqlWith.withList;                                                       </span>
<span class="5898329184559807321" onmouseenter="enter('5898329184559807321');" onmouseout="out('5898329184559807321');" style=""> 104                  for (SqlNode withAsTable : sqlNodeList) {                                                         </span>
<span class="5054103522612994093" onmouseenter="enter('5054103522612994093');" onmouseout="out('5054103522612994093');" style=""> 105                      SqlWithItem sqlWithItem = (SqlWithItem) withAsTable;                                          </span>
<span class="-2137122394942275343" onmouseenter="enter('-2137122394942275343');" onmouseout="out('-2137122394942275343');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 106 -                    parseSql(sqlWithItem.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 106 -                    parseSql(sqlWithItem.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGrou🔵</abbr></span>
<span class="3110928689497337082" onmouseenter="enter('3110928689497337082');" onmouseout="out('3110928689497337082');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 107 +                    parseSql(sqlWithItem.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 107 +                    parseSql(sqlWithItem.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGrou🔵</abbr></span>
<span class="558256818041950127" onmouseenter="enter('558256818041950127');" onmouseout="out('558256818041950127');" style=""> 108                      queueInfo.add(sqlWithItem);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109                  }                                                                                                 </span>
<span class="3054548125000552946" onmouseenter="enter('3054548125000552946');" onmouseout="out('3054548125000552946');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -                parseSql(sqlWith.body, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);</span>
<span class="-8548018655211213586" onmouseenter="enter('-8548018655211213586');" onmouseout="out('-8548018655211213586');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 111 +                parseSql(sqlWith.body, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 111 +                parseSql(sqlWith.body, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, 🔵</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 112                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113              }                                                                                                     </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 114              case INSERT:                                                                                          </span>
<span class="-7853295063534246070" onmouseenter="enter('-7853295063534246070');" onmouseout="out('-7853295063534246070');" style=""> 115                  SqlNode sqlSource = ((SqlInsert)sqlNode).getSource();                                             </span>
<span class="2601968389209545089" onmouseenter="enter('2601968389209545089');" onmouseout="out('2601968389209545089');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 116 -                return parseSql(sqlSource, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 116 -                return parseSql(sqlSource, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByLi🔵</abbr></span>
<span class="5867380015935317570" onmouseenter="enter('5867380015935317570');" onmouseout="out('5867380015935317570');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 117 +                return parseSql(sqlSource, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 117 +                return parseSql(sqlSource, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByLi🔵</abbr></span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 118              case SELECT:                                                                                          </span>
<span class="-737340637367962148" onmouseenter="enter('-737340637367962148');" onmouseout="out('-737340637367962148');" style=""> 119                  SqlNode sqlFrom = ((SqlSelect)sqlNode).getFrom();                                                 </span>
<span class="-4595996050370151557" onmouseenter="enter('-4595996050370151557');" onmouseout="out('-4595996050370151557');" style=""> 120                  SqlNode sqlWhere = ((SqlSelect)sqlNode).getWhere();                                               </span>
<span class="-6539957329780970839" onmouseenter="enter('-6539957329780970839');" onmouseout="out('-6539957329780970839');" style=""> 121                  SqlNodeList selectList = ((SqlSelect)sqlNode).getSelectList();                                    </span>
<span class="1382610957563429127" onmouseenter="enter('1382610957563429127');" onmouseout="out('1382610957563429127');" style=""> 122                  SqlNodeList groupByList = ((SqlSelect) sqlNode).getGroup();                                       </span>
<span  style=""> 123                                                                                                                    </span>
<span class="-6669062104161423555" onmouseenter="enter('-6669062104161423555');" onmouseout="out('-6669062104161423555');" style=""> 124                  if(sqlFrom.getKind() != IDENTIFIER){                                                              </span>
<span class="-3530162948571427823" onmouseenter="enter('-3530162948571427823');" onmouseout="out('-3530162948571427823');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 125 -                    Object result = parseSql(sqlFrom, sideTableSet, queueInfo, sqlWhere, selectList, groupByList);</span>
<span class="-593702489163539700" onmouseenter="enter('-593702489163539700');" onmouseout="out('-593702489163539700');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 126 +                    Object result = parseSql(sqlFrom, sideTableSet, queueInfo, sqlWhere, selectList, groupByList, scope);"> 126 +                    Object result = parseSql(sqlFrom, sideTableSet, queueInfo, sqlWhere, selectList, groupByList, 🔵</abbr></span>
<span class="7802562789325773256" onmouseenter="enter('7802562789325773256');" onmouseout="out('7802562789325773256');" style=""> 127                      if(result instanceof JoinInfo){                                                               </span>
<span class="-8441429291693214923" onmouseenter="enter('-8441429291693214923');" onmouseout="out('-8441429291693214923');" style=""><abbr title=" 128                          return TableUtils.dealSelectResultWithJoinInfo((JoinInfo) result, (SqlSelect) sqlNode, queueInfo);"> 128                          return TableUtils.dealSelectResultWithJoinInfo((JoinInfo) result, (SqlSelect) sqlNode, que🔵</abbr></span>
<span class="1716266177589910912" onmouseenter="enter('1716266177589910912');" onmouseout="out('1716266177589910912');" style=""> 129                      }else if(result instanceof AliasInfo){                                                        </span>
<span class="-6975694729646816765" onmouseenter="enter('-6975694729646816765');" onmouseout="out('-6975694729646816765');" style=""> 130                          String tableName = ((AliasInfo) result).getName();                                        </span>
<span class="23740069362058607" onmouseenter="enter('23740069362058607');" onmouseout="out('23740069362058607');" style=""> 131                          if(sideTableSet.contains(tableName)){                                                     </span>
<span class="-1760230060361710630" onmouseenter="enter('-1760230060361710630');" onmouseout="out('-1760230060361710630');" style=""> 132                              throw new RuntimeException(&quot;side-table must be used in join operator&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134                      }                                                                                             </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 135                  }else{                                                                                            </span>
<span class="1420748888812461485" onmouseenter="enter('1420748888812461485');" onmouseout="out('1420748888812461485');" style=""> 136                      String tableName = ((SqlIdentifier)sqlFrom).getSimple();                                      </span>
<span class="23740069362058607" onmouseenter="enter('23740069362058607');" onmouseout="out('23740069362058607');" style=""> 137                      if(sideTableSet.contains(tableName)){                                                         </span>
<span class="-1760230060361710630" onmouseenter="enter('-1760230060361710630');" onmouseout="out('-1760230060361710630');" style=""> 138                          throw new RuntimeException(&quot;side-table must be used in join operator&quot;);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 141                  break;                                                                                            </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 142              case JOIN:                                                                                            </span>
<span class="-3111758306527220061" onmouseenter="enter('-3111758306527220061');" onmouseout="out('-3111758306527220061');" style=""> 143                  JoinNodeDealer joinNodeDealer = new JoinNodeDealer(this);                                         </span>
<span class="9078002366390414240" onmouseenter="enter('9078002366390414240');" onmouseout="out('9078002366390414240');" style=""> 144                  Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet = Sets.newHashSet();                                     </span>
<span class="1100449665231490148" onmouseenter="enter('1100449665231490148');" onmouseout="out('1100449665231490148');" style=""> 145                  Map&lt;String, String&gt; tableRef = Maps.newHashMap();                                                 </span>
<span class="-6306168579289105112" onmouseenter="enter('-6306168579289105112');" onmouseout="out('-6306168579289105112');" style=""> 146                  Map&lt;String, String&gt; fieldRef = Maps.newHashMap();                                                 </span>
<span class="-1512934165488206441" onmouseenter="enter('-1512934165488206441');" onmouseout="out('-1512934165488206441');" style=""> 147                  return joinNodeDealer.dealJoinNode((SqlJoin) sqlNode, sideTableSet, queueInfo,                    </span>
<span class="8113418629148402447" onmouseenter="enter('8113418629148402447');" onmouseout="out('8113418629148402447');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -                        parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef);      </span>
<span class="-8388746013614283447" onmouseenter="enter('-8388746013614283447');" onmouseout="out('-8388746013614283447');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 149 +                        parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef, scope);"> 149 +                        parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef, scope)🔵</abbr></span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 150              case AS:                                                                                              </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 151                  SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                          </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 152                  SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                        </span>
<span class="-7314337242875568781" onmouseenter="enter('-7314337242875568781');" onmouseout="out('-7314337242875568781');" style=""> 153                  String infoStr = &quot;&quot;;                                                                              </span>
<span  style=""> 154                                                                                                                    </span>
<span class="2126841880433088777" onmouseenter="enter('2126841880433088777');" onmouseout="out('2126841880433088777');" style=""> 155                  if(info.getKind() == IDENTIFIER){                                                                 </span>
<span class="-6527219795850644409" onmouseenter="enter('-6527219795850644409');" onmouseout="out('-6527219795850644409');" style=""> 156                      infoStr = info.toString();                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 157                  } else {                                                                                          </span>
<span class="3298089944558441209" onmouseenter="enter('3298089944558441209');" onmouseout="out('3298089944558441209');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 158 -                    infoStr = parseSql(info, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList).toString();"> 158 -                    infoStr = parseSql(info, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupBy🔵</abbr></span>
<span class="-2058738663149093900" onmouseenter="enter('-2058738663149093900');" onmouseout="out('-2058738663149093900');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 159 +                    infoStr = parseSql(info, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope).toString();"> 159 +                    infoStr = parseSql(info, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupBy🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160                  }                                                                                                 </span>
<span  style=""> 161                                                                                                                    </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 162                  AliasInfo aliasInfo = new AliasInfo();                                                            </span>
<span class="-6330277266292138558" onmouseenter="enter('-6330277266292138558');" onmouseout="out('-6330277266292138558');" style=""> 163                  aliasInfo.setName(infoStr);                                                                       </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 164                  aliasInfo.setAlias(alias.toString());                                                             </span>
<span  style=""> 165                                                                                                                    </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 166                  return aliasInfo;                                                                                 </span>
<span  style=""> 167                                                                                                                    </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 168              case UNION:                                                                                           </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 169                  SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 170                  SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                                    </span>
<span  style=""> 171                                                                                                                    </span>
<span class="-4603896956067102557" onmouseenter="enter('-4603896956067102557');" onmouseout="out('-4603896956067102557');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 172 -                parseSql(unionLeft, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);   </span>
<span class="-4077767015718338016" onmouseenter="enter('-4077767015718338016');" onmouseout="out('-4077767015718338016');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 173 -                parseSql(unionRight, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);  </span>
<span class="413085527251650631" onmouseenter="enter('413085527251650631');" onmouseout="out('413085527251650631');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 174 +                parseSql(unionLeft, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 174 +                parseSql(unionLeft, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, sco🔵</abbr></span>
<span class="5239612470789521882" onmouseenter="enter('5239612470789521882');" onmouseout="out('5239612470789521882');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 175 +                parseSql(unionRight, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 175 +                parseSql(unionRight, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, sc🔵</abbr></span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 176                  break;                                                                                            </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 177              case ORDER_BY:                                                                                        </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 178                  SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                                    </span>
<span class="5885804299572217205" onmouseenter="enter('5885804299572217205');" onmouseout="out('5885804299572217205');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 179 -                parseSql(sqlOrderBy.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 179 -                parseSql(sqlOrderBy.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByLi🔵</abbr></span>
<span class="-7455932962237326040" onmouseenter="enter('-7455932962237326040');" onmouseout="out('-7455932962237326040');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 180 +                parseSql(sqlOrderBy.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList, scope);"> 180 +                parseSql(sqlOrderBy.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByLi🔵</abbr></span>
<span  style=""> 181                                                                                                                    </span>
<span class="-2988899114509087250" onmouseenter="enter('-2988899114509087250');" onmouseout="out('-2988899114509087250');" style=""> 182              case LITERAL:                                                                                         </span>
<span class="2819024748306122432" onmouseenter="enter('2819024748306122432');" onmouseout="out('2819024748306122432');" style=""> 183                  return LITERAL.toString();                                                                        </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184          }                                                                                                         </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 185          return &quot;&quot;;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186      }                                                                                                             </span>
<span  style=""> 187                                                                                                                    </span>
<span  style=""> 188                                                                                                                    </span>
<span  style=""> 189                                                                                                                    </span>
<span  style=""> 190                                                                                                                    </span>
<span class="-649401327769177886" onmouseenter="enter('-649401327769177886');" onmouseout="out('-649401327769177886');" style=""> 191      public void setLocalTableCache(Map&lt;String, Table&gt; localTableCache) {                                          </span>
<span class="-1916936159945030154" onmouseenter="enter('-1916936159945030154');" onmouseout="out('-1916936159945030154');" style=""> 192          this.localTableCache = localTableCache;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193      }                                                                                                             </span>
<span  style=""> 194                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="">  20                                                                                                                    </span>
<span class="2641237788859285263" onmouseenter="enter('2641237788859285263');" onmouseout="out('2641237788859285263');" style="">  21  package com.dtstack.flink.sql.side;                                                                               </span>
<span  style="">  22                                                                                                                    </span>
<span class="-283888887417937620" onmouseenter="enter('-283888887417937620');" onmouseout="out('-283888887417937620');" style="">  23  import com.dtstack.flink.sql.parser.FlinkPlanner;                                                                 </span>
<span class="6766772234276428268" onmouseenter="enter('6766772234276428268');" onmouseout="out('6766772234276428268');" style="">  24  import com.dtstack.flink.sql.util.TableUtils;                                                                     </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  25  import com.google.common.collect.Maps;                                                                            </span>
<span class="1397139485218690137" onmouseenter="enter('1397139485218690137');" onmouseout="out('1397139485218690137');" style="">  26  import com.google.common.collect.Queues;                                                                          </span>
<span class="6390139568718476113" onmouseenter="enter('6390139568718476113');" onmouseout="out('6390139568718476113');" style="">  27  import com.google.common.collect.Sets;                                                                            </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  28  import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="-589720985119795452" onmouseenter="enter('-589720985119795452');" onmouseout="out('-589720985119795452');" style="">  29  import org.apache.calcite.sql.SqlIdentifier;                                                                      </span>
<span class="8181544981280840437" onmouseenter="enter('8181544981280840437');" onmouseout="out('8181544981280840437');" style="">  30  import org.apache.calcite.sql.SqlInsert;                                                                          </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  31  import org.apache.calcite.sql.SqlJoin;                                                                            </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  32  import org.apache.calcite.sql.SqlKind;                                                                            </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  33  import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="1272597113869071893" onmouseenter="enter('1272597113869071893');" onmouseout="out('1272597113869071893');" style="">  34  import org.apache.calcite.sql.SqlNodeList;                                                                        </span>
<span class="-3308206799401099273" onmouseenter="enter('-3308206799401099273');" onmouseout="out('-3308206799401099273');" style="">  35  import org.apache.calcite.sql.SqlOrderBy;                                                                         </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  36  import org.apache.calcite.sql.SqlSelect;                                                                          </span>
<span class="-8823326795697214951" onmouseenter="enter('-8823326795697214951');" onmouseout="out('-8823326795697214951');" style="">  37  import org.apache.calcite.sql.SqlWith;                                                                            </span>
<span class="9012576760183743580" onmouseenter="enter('9012576760183743580');" onmouseout="out('9012576760183743580');" style="">  38  import org.apache.calcite.sql.SqlWithItem;                                                                        </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  39  import org.apache.calcite.sql.parser.SqlParseException;                                                           </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  40  import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="5165777186879784670" onmouseenter="enter('5165777186879784670');" onmouseout="out('5165777186879784670');" style="">  41  import org.apache.flink.table.api.Table;                                                                          </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="">  42  import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  43  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  44  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  45                                                                                                                    </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  46  import java.util.Map;                                                                                             </span>
<span class="-2789246819365843415" onmouseenter="enter('-2789246819365843415');" onmouseout="out('-2789246819365843415');" style="">  47  import java.util.Queue;                                                                                           </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  48  import java.util.Set;                                                                                             </span>
<span  style="">  49                                                                                                                    </span>
<span class="7147213704442467623" onmouseenter="enter('7147213704442467623');" onmouseout="out('7147213704442467623');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  50 -import static org.apache.calcite.sql.SqlKind.*;                                                                   </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  51 +import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                          </span>
<span class="5903201271827982207" onmouseenter="enter('5903201271827982207');" onmouseout="out('5903201271827982207');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  52 +import static org.apache.calcite.sql.SqlKind.LITERAL;                                                             </span>
<span  style="">  53                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  54  /**                                                                                                               </span>
<span class="7605977213454941184" onmouseenter="enter('7605977213454941184');" onmouseout="out('7605977213454941184');" style="">  55   * Parsing sql, obtain execution information dimension table                                                      </span>
<span class="-6082749432478588798" onmouseenter="enter('-6082749432478588798');" onmouseout="out('-6082749432478588798');" style="">  56   * Date: 2018/7/24                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  57   * Company: www.dtstack.com                                                                                       </span>
<span class="5932225095843400519" onmouseenter="enter('5932225095843400519');" onmouseout="out('5932225095843400519');" style="">  58   * @author xuchao                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  59   */                                                                                                               </span>
<span  style="">  60                                                                                                                    </span>
<span class="3966585742332796558" onmouseenter="enter('3966585742332796558');" onmouseout="out('3966585742332796558');" style="">  61  public class SideSQLParser {                                                                                      </span>
<span class="-77182390841532482" onmouseenter="enter('-77182390841532482');" onmouseout="out('-77182390841532482');" style="">  62      private static final Logger LOG = LoggerFactory.getLogger(SideSQLParser.class);                               </span>
<span  style="">  63                                                                                                                    </span>
<span class="4175687380086503813" onmouseenter="enter('4175687380086503813');" onmouseout="out('4175687380086503813');" style="">  64      private Map&lt;String, Table&gt; localTableCache = Maps.newHashMap();                                               </span>
<span  style="">  65                                                                                                                    </span>
<span class="4228219262260732256" onmouseenter="enter('4228219262260732256');" onmouseout="out('4228219262260732256');" style="">  66      public Queue&lt;Object&gt; getExeQueue(String exeSql, Set&lt;String&gt; sideTableSet) throws SqlParseException {          </span>

<span class="-554334491296517619" onmouseenter="enter('-554334491296517619');" onmouseout="out('-554334491296517619');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  67 -        System.out.println(&quot;----------exec original Sql----------&quot;);                                              </span>
<span class="6408637245030246244" onmouseenter="enter('6408637245030246244');" onmouseout="out('6408637245030246244');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  68 -        System.out.println(exeSql);                                                                               </span>
<span class="-7947557255342642708" onmouseenter="enter('-7947557255342642708');" onmouseout="out('-7947557255342642708');" style="">  69          LOG.info(&quot;----------exec original Sql----------&quot;);                                                        </span>
<span class="1058132582852180835" onmouseenter="enter('1058132582852180835');" onmouseout="out('1058132582852180835');" style="">  70          LOG.info(exeSql);                                                                                         </span>
<span  style="">  71                                                                                                                    </span>
<span class="5128011700743018451" onmouseenter="enter('5128011700743018451');" onmouseout="out('5128011700743018451');" style="">  72          Queue&lt;Object&gt; queueInfo = Queues.newLinkedBlockingQueue();                                                </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style="">  73          FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                                           </span>
<span class="-6421300158550037914" onmouseenter="enter('-6421300158550037914');" onmouseout="out('-6421300158550037914');" style="">  74          SqlNode sqlNode = flinkPlanner.parse(exeSql);                                                             </span>
<span  style="">  75                                                                                                                    </span>
<span class="-9041946153418018780" onmouseenter="enter('-9041946153418018780');" onmouseout="out('-9041946153418018780');" style="">  76          parseSql(sqlNode, sideTableSet, queueInfo, null, null, null);                                             </span>

<span class="2886026929410252587" onmouseenter="enter('2886026929410252587');" onmouseout="out('2886026929410252587');" style="">  77          queueInfo.offer(sqlNode);                                                                                 </span>
<span class="-7280577500312652584" onmouseenter="enter('-7280577500312652584');" onmouseout="out('-7280577500312652584');" style="">  78          return queueInfo;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79      }                                                                                                             </span>
<span  style="">  80                                                                                                                    </span>
<span  style="">  81                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  82      /**                                                                                                           </span>
<span class="-3708169461439447854" onmouseenter="enter('-3708169461439447854');" onmouseout="out('-3708169461439447854');" style="">  83       *  解析 sql 根据维表 join关系重新组装新的sql                                                                               </span>
<span class="3061148848694484073" onmouseenter="enter('3061148848694484073');" onmouseout="out('3061148848694484073');" style="">  84       * @param sqlNode                                                                                             </span>
<span class="-8651210754005562825" onmouseenter="enter('-8651210754005562825');" onmouseout="out('-8651210754005562825');" style="">  85       * @param sideTableSet                                                                                        </span>
<span class="3894561521416724418" onmouseenter="enter('3894561521416724418');" onmouseout="out('3894561521416724418');" style="">  86       * @param queueInfo                                                                                           </span>
<span class="-2398019711746074784" onmouseenter="enter('-2398019711746074784');" onmouseout="out('-2398019711746074784');" style="">  87       * @param parentWhere                                                                                         </span>
<span class="845191212344219041" onmouseenter="enter('845191212344219041');" onmouseout="out('845191212344219041');" style="">  88       * @param parentSelectList                                                                                    </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style="">  89       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  90       */                                                                                                           </span>
<span class="-4912114046735086097" onmouseenter="enter('-4912114046735086097');" onmouseout="out('-4912114046735086097');" style="">  91      public Object parseSql(SqlNode sqlNode,                                                                       </span>
<span class="-1952250395521254109" onmouseenter="enter('-1952250395521254109');" onmouseout="out('-1952250395521254109');" style="">  92                             Set&lt;String&gt; sideTableSet,                                                              </span>
<span class="405358965608327863" onmouseenter="enter('405358965608327863');" onmouseout="out('405358965608327863');" style="">  93                             Queue&lt;Object&gt; queueInfo,                                                               </span>
<span class="2199848844813933222" onmouseenter="enter('2199848844813933222');" onmouseout="out('2199848844813933222');" style="">  94                             SqlNode parentWhere,                                                                   </span>
<span class="1680427389939842559" onmouseenter="enter('1680427389939842559');" onmouseout="out('1680427389939842559');" style="">  95                             SqlNodeList parentSelectList,                                                          </span>
<span class="1233396441588378287" onmouseenter="enter('1233396441588378287');" onmouseout="out('1233396441588378287');" style="">  96                             SqlNodeList parentGroupByList){                                                        </span>


<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  97          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style="">  98          switch (sqlKind){                                                                                         </span>
<span class="-4895776563178477738" onmouseenter="enter('-4895776563178477738');" onmouseout="out('-4895776563178477738');" style="">  99              case WITH: {                                                                                          </span>
<span class="1074402989354786172" onmouseenter="enter('1074402989354786172');" onmouseout="out('1074402989354786172');" style=""> 100                  SqlWith sqlWith = (SqlWith) sqlNode;                                                              </span>
<span class="1112510853537726574" onmouseenter="enter('1112510853537726574');" onmouseout="out('1112510853537726574');" style=""> 101                  SqlNodeList sqlNodeList = sqlWith.withList;                                                       </span>
<span class="5898329184559807321" onmouseenter="enter('5898329184559807321');" onmouseout="out('5898329184559807321');" style=""> 102                  for (SqlNode withAsTable : sqlNodeList) {                                                         </span>
<span class="5054103522612994093" onmouseenter="enter('5054103522612994093');" onmouseout="out('5054103522612994093');" style=""> 103                      SqlWithItem sqlWithItem = (SqlWithItem) withAsTable;                                          </span>
<span class="-2137122394942275343" onmouseenter="enter('-2137122394942275343');" onmouseout="out('-2137122394942275343');" style=""><abbr title=" 104                      parseSql(sqlWithItem.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 104                      parseSql(sqlWithItem.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGrou🔵</abbr></span>

<span class="558256818041950127" onmouseenter="enter('558256818041950127');" onmouseout="out('558256818041950127');" style=""> 105                      queueInfo.add(sqlWithItem);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106                  }                                                                                                 </span>
<span class="3054548125000552946" onmouseenter="enter('3054548125000552946');" onmouseout="out('3054548125000552946');" style=""> 107                  parseSql(sqlWith.body, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);</span>

<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 108                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109              }                                                                                                     </span>
<span class="2388664439372983474" onmouseenter="enter('2388664439372983474');" onmouseout="out('2388664439372983474');" style=""> 110              case INSERT:                                                                                          </span>
<span class="-7853295063534246070" onmouseenter="enter('-7853295063534246070');" onmouseout="out('-7853295063534246070');" style=""> 111                  SqlNode sqlSource = ((SqlInsert)sqlNode).getSource();                                             </span>
<span class="2601968389209545089" onmouseenter="enter('2601968389209545089');" onmouseout="out('2601968389209545089');" style=""><abbr title=" 112                  return parseSql(sqlSource, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 112                  return parseSql(sqlSource, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByLi🔵</abbr></span>

<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 113              case SELECT:                                                                                          </span>
<span class="-737340637367962148" onmouseenter="enter('-737340637367962148');" onmouseout="out('-737340637367962148');" style=""> 114                  SqlNode sqlFrom = ((SqlSelect)sqlNode).getFrom();                                                 </span>
<span class="-4595996050370151557" onmouseenter="enter('-4595996050370151557');" onmouseout="out('-4595996050370151557');" style=""> 115                  SqlNode sqlWhere = ((SqlSelect)sqlNode).getWhere();                                               </span>
<span class="-6539957329780970839" onmouseenter="enter('-6539957329780970839');" onmouseout="out('-6539957329780970839');" style=""> 116                  SqlNodeList selectList = ((SqlSelect)sqlNode).getSelectList();                                    </span>
<span class="1382610957563429127" onmouseenter="enter('1382610957563429127');" onmouseout="out('1382610957563429127');" style=""> 117                  SqlNodeList groupByList = ((SqlSelect) sqlNode).getGroup();                                       </span>
<span  style=""> 118                                                                                                                    </span>
<span class="-6669062104161423555" onmouseenter="enter('-6669062104161423555');" onmouseout="out('-6669062104161423555');" style=""> 119                  if(sqlFrom.getKind() != IDENTIFIER){                                                              </span>
<span class="-3530162948571427823" onmouseenter="enter('-3530162948571427823');" onmouseout="out('-3530162948571427823');" style=""> 120                      Object result = parseSql(sqlFrom, sideTableSet, queueInfo, sqlWhere, selectList, groupByList);</span>

<span class="7802562789325773256" onmouseenter="enter('7802562789325773256');" onmouseout="out('7802562789325773256');" style=""> 121                      if(result instanceof JoinInfo){                                                               </span>
<span class="-8441429291693214923" onmouseenter="enter('-8441429291693214923');" onmouseout="out('-8441429291693214923');" style=""><abbr title=" 122                          return TableUtils.dealSelectResultWithJoinInfo((JoinInfo) result, (SqlSelect) sqlNode, queueInfo);"> 122                          return TableUtils.dealSelectResultWithJoinInfo((JoinInfo) result, (SqlSelect) sqlNode, que🔵</abbr></span>
<span class="1716266177589910912" onmouseenter="enter('1716266177589910912');" onmouseout="out('1716266177589910912');" style=""> 123                      }else if(result instanceof AliasInfo){                                                        </span>
<span class="-6975694729646816765" onmouseenter="enter('-6975694729646816765');" onmouseout="out('-6975694729646816765');" style=""> 124                          String tableName = ((AliasInfo) result).getName();                                        </span>
<span class="23740069362058607" onmouseenter="enter('23740069362058607');" onmouseout="out('23740069362058607');" style=""> 125                          if(sideTableSet.contains(tableName)){                                                     </span>
<span class="-1760230060361710630" onmouseenter="enter('-1760230060361710630');" onmouseout="out('-1760230060361710630');" style=""> 126                              throw new RuntimeException(&quot;side-table must be used in join operator&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128                      }                                                                                             </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 129                  }else{                                                                                            </span>
<span class="1420748888812461485" onmouseenter="enter('1420748888812461485');" onmouseout="out('1420748888812461485');" style=""> 130                      String tableName = ((SqlIdentifier)sqlFrom).getSimple();                                      </span>
<span class="23740069362058607" onmouseenter="enter('23740069362058607');" onmouseout="out('23740069362058607');" style=""> 131                      if(sideTableSet.contains(tableName)){                                                         </span>
<span class="-1760230060361710630" onmouseenter="enter('-1760230060361710630');" onmouseout="out('-1760230060361710630');" style=""> 132                          throw new RuntimeException(&quot;side-table must be used in join operator&quot;);                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 135                  break;                                                                                            </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 136              case JOIN:                                                                                            </span>
<span class="-3111758306527220061" onmouseenter="enter('-3111758306527220061');" onmouseout="out('-3111758306527220061');" style=""> 137                  JoinNodeDealer joinNodeDealer = new JoinNodeDealer(this);                                         </span>
<span class="9078002366390414240" onmouseenter="enter('9078002366390414240');" onmouseout="out('9078002366390414240');" style=""> 138                  Set&lt;Tuple2&lt;String, String&gt;&gt; joinFieldSet = Sets.newHashSet();                                     </span>
<span class="1100449665231490148" onmouseenter="enter('1100449665231490148');" onmouseout="out('1100449665231490148');" style=""> 139                  Map&lt;String, String&gt; tableRef = Maps.newHashMap();                                                 </span>
<span class="-6306168579289105112" onmouseenter="enter('-6306168579289105112');" onmouseout="out('-6306168579289105112');" style=""> 140                  Map&lt;String, String&gt; fieldRef = Maps.newHashMap();                                                 </span>
<span class="-1512934165488206441" onmouseenter="enter('-1512934165488206441');" onmouseout="out('-1512934165488206441');" style=""> 141                  return joinNodeDealer.dealJoinNode((SqlJoin) sqlNode, sideTableSet, queueInfo,                    </span>
<span class="8113418629148402447" onmouseenter="enter('8113418629148402447');" onmouseout="out('8113418629148402447');" style=""> 142                          parentWhere, parentSelectList, parentGroupByList, joinFieldSet, tableRef, fieldRef);      </span>

<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 143              case AS:                                                                                              </span>
<span class="-4085054753182131209" onmouseenter="enter('-4085054753182131209');" onmouseout="out('-4085054753182131209');" style=""> 144                  SqlNode info = ((SqlBasicCall)sqlNode).getOperands()[0];                                          </span>
<span class="1760960030368050225" onmouseenter="enter('1760960030368050225');" onmouseout="out('1760960030368050225');" style=""> 145                  SqlNode alias = ((SqlBasicCall) sqlNode).getOperands()[1];                                        </span>
<span class="-7314337242875568781" onmouseenter="enter('-7314337242875568781');" onmouseout="out('-7314337242875568781');" style=""> 146                  String infoStr = &quot;&quot;;                                                                              </span>
<span  style=""> 147                                                                                                                    </span>
<span class="2126841880433088777" onmouseenter="enter('2126841880433088777');" onmouseout="out('2126841880433088777');" style=""> 148                  if(info.getKind() == IDENTIFIER){                                                                 </span>
<span class="-6527219795850644409" onmouseenter="enter('-6527219795850644409');" onmouseout="out('-6527219795850644409');" style=""> 149                      infoStr = info.toString();                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 150                  } else {                                                                                          </span>
<span class="3298089944558441209" onmouseenter="enter('3298089944558441209');" onmouseout="out('3298089944558441209');" style=""><abbr title=" 151                      infoStr = parseSql(info, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList).toString();"> 151                      infoStr = parseSql(info, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupBy🔵</abbr></span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152                  }                                                                                                 </span>
<span  style=""> 153                                                                                                                    </span>
<span class="-2458625767668584085" onmouseenter="enter('-2458625767668584085');" onmouseout="out('-2458625767668584085');" style=""> 154                  AliasInfo aliasInfo = new AliasInfo();                                                            </span>
<span class="-6330277266292138558" onmouseenter="enter('-6330277266292138558');" onmouseout="out('-6330277266292138558');" style=""> 155                  aliasInfo.setName(infoStr);                                                                       </span>
<span class="-6584143955119724642" onmouseenter="enter('-6584143955119724642');" onmouseout="out('-6584143955119724642');" style=""> 156                  aliasInfo.setAlias(alias.toString());                                                             </span>
<span  style=""> 157                                                                                                                    </span>
<span class="-3107000398971930583" onmouseenter="enter('-3107000398971930583');" onmouseout="out('-3107000398971930583');" style=""> 158                  return aliasInfo;                                                                                 </span>
<span  style=""> 159                                                                                                                    </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 160              case UNION:                                                                                           </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 161                  SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 162                  SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                                    </span>
<span  style=""> 163                                                                                                                    </span>
<span class="-4603896956067102557" onmouseenter="enter('-4603896956067102557');" onmouseout="out('-4603896956067102557');" style=""> 164                  parseSql(unionLeft, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);   </span>
<span class="-4077767015718338016" onmouseenter="enter('-4077767015718338016');" onmouseout="out('-4077767015718338016');" style=""> 165                  parseSql(unionRight, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);  </span>


<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 166                  break;                                                                                            </span>
<span class="9033815331900391172" onmouseenter="enter('9033815331900391172');" onmouseout="out('9033815331900391172');" style=""> 167              case ORDER_BY:                                                                                        </span>
<span class="3723185693474391186" onmouseenter="enter('3723185693474391186');" onmouseout="out('3723185693474391186');" style=""> 168                  SqlOrderBy sqlOrderBy  = (SqlOrderBy) sqlNode;                                                    </span>
<span class="5885804299572217205" onmouseenter="enter('5885804299572217205');" onmouseout="out('5885804299572217205');" style=""><abbr title=" 169                  parseSql(sqlOrderBy.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByList);"> 169                  parseSql(sqlOrderBy.query, sideTableSet, queueInfo, parentWhere, parentSelectList, parentGroupByLi🔵</abbr></span>

<span  style=""> 170                                                                                                                    </span>
<span class="-2988899114509087250" onmouseenter="enter('-2988899114509087250');" onmouseout="out('-2988899114509087250');" style=""> 171              case LITERAL:                                                                                         </span>
<span class="2819024748306122432" onmouseenter="enter('2819024748306122432');" onmouseout="out('2819024748306122432');" style=""> 172                  return LITERAL.toString();                                                                        </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +            default:                                                                                              </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +                break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175          }                                                                                                         </span>
<span class="-8289946804601166879" onmouseenter="enter('-8289946804601166879');" onmouseout="out('-8289946804601166879');" style=""> 176          return &quot;&quot;;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177      }                                                                                                             </span>
<span  style=""> 178                                                                                                                    </span>
<span  style=""> 179                                                                                                                    </span>
<span  style=""> 180                                                                                                                    </span>
<span  style=""> 181                                                                                                                    </span>
<span class="-649401327769177886" onmouseenter="enter('-649401327769177886');" onmouseout="out('-649401327769177886');" style=""> 182      public void setLocalTableCache(Map&lt;String, Table&gt; localTableCache) {                                          </span>
<span class="-1916936159945030154" onmouseenter="enter('-1916936159945030154');" onmouseout="out('-1916936159945030154');" style=""> 183          this.localTableCache = localTableCache;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184      }                                                                                                             </span>
<span  style=""> 185                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            