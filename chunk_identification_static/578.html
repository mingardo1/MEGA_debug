<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>578</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    578
                    <a href="577.html">prev</a>
                    <a href="579.html">next</a>
                    <a href="578_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Freeyourgadget/Gadgetbridge_5c0c5581bbd6e1bf50ddfca9da164ee8571714c0_app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinator.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;5c0c5581bbd6e1bf50ddfca9da164ee8571714c0:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinator.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;5c0c5581bbd6e1bf50ddfca9da164ee8571714c0^1:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinator.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;5c0c5581bbd6e1bf50ddfca9da164ee8571714c0^2:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinator.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Freeyourgadget\Gadgetbridge show &quot;9eade33d72360fdd6642c6f96f31c52b89afbc63:app/src/main/java/nodomain/freeyourgadget/gadgetbridge/devices/AbstractDeviceCoordinator.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-2153024702397574105" onmouseenter="enter('-2153024702397574105');" onmouseout="out('-2153024702397574105');" style="">   1 /*  Copyright (C) 2015-2017 Carsten Pfeiffer                                                             </span>
<span  style="">   2                                                                                                          </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   3     This file is part of Gadgetbridge.                                                                   </span>
<span  style="">   4                                                                                                          </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   5     Gadgetbridge is free software: you can redistribute it and/or modify                                 </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   6     it under the terms of the GNU Affero General Public License as published                             </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   7     by the Free Software Foundation, either version 3 of the License, or                                 </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">   8     (at your option) any later version.                                                                  </span>
<span  style="">   9                                                                                                          </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  10     Gadgetbridge is distributed in the hope that it will be useful,                                      </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  11     but WITHOUT ANY WARRANTY; without even the implied warranty of                                       </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  12     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                        </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  13     GNU Affero General Public License for more details.                                                  </span>
<span  style="">  14                                                                                                          </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  15     You should have received a copy of the GNU Affero General Public License                             </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  16     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                             </span>
<span class="3135677453084526940" onmouseenter="enter('3135677453084526940');" onmouseout="out('3135677453084526940');" style="">  17 package nodomain.freeyourgadget.gadgetbridge.devices;                                                    </span>
<span  style="">  18                                                                                                          </span>
<span class="-311917288644069537" onmouseenter="enter('-311917288644069537');" onmouseout="out('-311917288644069537');" style="">  19 import android.bluetooth.BluetoothClass;                                                                 </span>
<span class="2859895893394018468" onmouseenter="enter('2859895893394018468');" onmouseout="out('2859895893394018468');" style="">  20 import android.bluetooth.BluetoothDevice;                                                                </span>
<span class="4786958806676392792" onmouseenter="enter('4786958806676392792');" onmouseout="out('4786958806676392792');" style="">  21 import android.bluetooth.le.ScanFilter;                                                                  </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  22 import android.support.annotation.NonNull;                                                               </span>
<span  style="">  23                                                                                                          </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  24 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  25 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  26                                                                                                          </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  27 import java.util.Collection;                                                                             </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  28 import java.util.Collections;                                                                            </span>
<span  style="">  29                                                                                                          </span>
<span class="-4354487052338529220" onmouseenter="enter('-4354487052338529220');" onmouseout="out('-4354487052338529220');" style="">  30 import de.greenrobot.dao.query.QueryBuilder;                                                             </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  31 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-1471644270559892265" onmouseenter="enter('-1471644270559892265');" onmouseout="out('-1471644270559892265');" style="">  32 import nodomain.freeyourgadget.gadgetbridge.GBException;                                                 </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  33 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4338650188295783318" onmouseenter="enter('4338650188295783318');" onmouseout="out('4338650188295783318');" style="">  34 import nodomain.freeyourgadget.gadgetbridge.database.DBHelper;                                           </span>
<span class="804944882642105225" onmouseenter="enter('804944882642105225');" onmouseout="out('804944882642105225');" style="">  35 import nodomain.freeyourgadget.gadgetbridge.entities.DaoSession;                                         </span>
<span class="4469307411224397441" onmouseenter="enter('4469307411224397441');" onmouseout="out('4469307411224397441');" style="">  36 import nodomain.freeyourgadget.gadgetbridge.entities.Device;                                             </span>
<span class="-977151012090239476" onmouseenter="enter('-977151012090239476');" onmouseout="out('-977151012090239476');" style="">  37 import nodomain.freeyourgadget.gadgetbridge.entities.DeviceAttributesDao;                                </span>
<span class="4836892992022606579" onmouseenter="enter('4836892992022606579');" onmouseout="out('4836892992022606579');" style="">  38 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;                                               </span>
<span class="-1351120908834620909" onmouseenter="enter('-1351120908834620909');" onmouseout="out('-1351120908834620909');" style="">  39 import nodomain.freeyourgadget.gadgetbridge.impl.GBDeviceCandidate;                                      </span>
<span  style="">  40                                                                                                          </span>
<span class="-4230229064741158074" onmouseenter="enter('-4230229064741158074');" onmouseout="out('-4230229064741158074');" style="">  41 public abstract class AbstractDeviceCoordinator implements DeviceCoordinator {                           </span>
<span class="1533308298984062740" onmouseenter="enter('1533308298984062740');" onmouseout="out('1533308298984062740');" style="">  42     private static final Logger LOG = LoggerFactory.getLogger(AbstractDeviceCoordinator.class);          </span>
<span  style="">  43                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  44     @Override                                                                                            </span>
<span class="-5773753981017336979" onmouseenter="enter('-5773753981017336979');" onmouseout="out('-5773753981017336979');" style="">  45     public final boolean supports(GBDeviceCandidate candidate) {                                         </span>
<span class="-5193755579287929052" onmouseenter="enter('-5193755579287929052');" onmouseout="out('-5193755579287929052');" style="">  46         return getSupportedType(candidate).isSupported();                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  47     }                                                                                                    </span>
<span  style="">  48                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  49     @Override                                                                                            </span>
<span class="4078602725554603282" onmouseenter="enter('4078602725554603282');" onmouseout="out('4078602725554603282');" style="">  50     public boolean supports(GBDevice device) {                                                           </span>
<span class="-5403859112831240356" onmouseenter="enter('-5403859112831240356');" onmouseout="out('-5403859112831240356');" style="">  51         return getDeviceType().equals(device.getType());                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  52     }                                                                                                    </span>
<span  style="">  53                                                                                                          </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style="">  54     @NonNull                                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  55     @Override                                                                                            </span>
<span class="1062073963528652044" onmouseenter="enter('1062073963528652044');" onmouseout="out('1062073963528652044');" style="">  56     public Collection&lt;? extends ScanFilter&gt; createBLEScanFilters() {                                     </span>
<span class="-6093315130064080899" onmouseenter="enter('-6093315130064080899');" onmouseout="out('-6093315130064080899');" style="">  57         return Collections.emptyList();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  58     }                                                                                                    </span>
<span  style="">  59                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  60     @Override                                                                                            </span>
<span class="2107833060147006233" onmouseenter="enter('2107833060147006233');" onmouseout="out('2107833060147006233');" style="">  61     public GBDevice createDevice(GBDeviceCandidate candidate) {                                          </span>
<span class="7068827190476029649" onmouseenter="enter('7068827190476029649');" onmouseout="out('7068827190476029649');" style="">  62         return new GBDevice(candidate.getDevice().getAddress(), candidate.getName(), getDeviceType());   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  63     }                                                                                                    </span>
<span  style="">  64                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  65     @Override                                                                                            </span>
<span class="2456275557980692881" onmouseenter="enter('2456275557980692881');" onmouseout="out('2456275557980692881');" style="">  66     public void deleteDevice(final GBDevice gbDevice) throws GBException {                               </span>
<span class="-2748439011794217767" onmouseenter="enter('-2748439011794217767');" onmouseout="out('-2748439011794217767');" style="">  67         LOG.info(&quot;will try to delete device: &quot; + gbDevice.getName());                                    </span>
<span class="-5483779301960408381" onmouseenter="enter('-5483779301960408381');" onmouseout="out('-5483779301960408381');" style="">  68         if (gbDevice.isConnected() || gbDevice.isConnecting()) {                                         </span>
<span class="7347953572742694021" onmouseenter="enter('7347953572742694021');" onmouseout="out('7347953572742694021');" style="">  69             GBApplication.deviceService().disconnect();                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70         }                                                                                                </span>
<span class="8566685229205195929" onmouseenter="enter('8566685229205195929');" onmouseout="out('8566685229205195929');" style="">  71         try (DBHandler dbHandler = GBApplication.acquireDB()) {                                          </span>
<span class="-5035264817263566539" onmouseenter="enter('-5035264817263566539');" onmouseout="out('-5035264817263566539');" style="">  72             DaoSession session = dbHandler.getDaoSession();                                              </span>
<span class="7301165332090965101" onmouseenter="enter('7301165332090965101');" onmouseout="out('7301165332090965101');" style="">  73             Device device = DBHelper.findDevice(gbDevice, session);                                      </span>
<span class="-8372003146204379455" onmouseenter="enter('-8372003146204379455');" onmouseout="out('-8372003146204379455');" style="">  74             if (device != null) {                                                                        </span>
<span class="2653457635170470666" onmouseenter="enter('2653457635170470666');" onmouseout="out('2653457635170470666');" style="">  75                 deleteDevice(gbDevice, device, session);                                                 </span>
<span class="-3608622048077556792" onmouseenter="enter('-3608622048077556792');" onmouseout="out('-3608622048077556792');" style="">  76                 QueryBuilder&lt;?&gt; qb = session.getDeviceAttributesDao().queryBuilder();                    </span>
<span class="-8958331783640360848" onmouseenter="enter('-8958331783640360848');" onmouseout="out('-8958331783640360848');" style=""><abbr title="  77                 qb.where(DeviceAttributesDao.Properties.DeviceId.eq(device.getId())).buildDelete().executeDeleteWithoutDetachingEntities();">  77                 qb.where(DeviceAttributesDao.Properties.DeviceId.eq(device.getId())).buildDelete().executðŸ”µ</abbr></span>
<span class="5697251904061281905" onmouseenter="enter('5697251904061281905');" onmouseout="out('5697251904061281905');" style="">  78                 session.getDeviceDao().delete(device);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  79             } else {                                                                                     </span>
<span class="5738091463814250523" onmouseenter="enter('5738091463814250523');" onmouseout="out('5738091463814250523');" style="">  80                 LOG.info(&quot;device to delete not found in db: &quot; + gbDevice);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="">  82         } catch (Exception e) {                                                                          </span>
<span class="-6625841807606110692" onmouseenter="enter('-6625841807606110692');" onmouseout="out('-6625841807606110692');" style="">  83             throw new GBException(&quot;Error deleting device: &quot; + e.getMessage(), e);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85     }                                                                                                    </span>
<span  style="">  86                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  87     /**                                                                                                  </span>
<span class="8590530733634682184" onmouseenter="enter('8590530733634682184');" onmouseout="out('8590530733634682184');" style="">  88      * Hook for subclasses to perform device-specific deletion logic, e.g. db cleanup.                   </span>
<span class="-8983980441374315330" onmouseenter="enter('-8983980441374315330');" onmouseout="out('-8983980441374315330');" style="">  89      * @param gbDevice the GBDevice                                                                      </span>
<span class="3611176693110093725" onmouseenter="enter('3611176693110093725');" onmouseout="out('3611176693110093725');" style="">  90      * @param device the corresponding database Device                                                   </span>
<span class="5140805568250941919" onmouseenter="enter('5140805568250941919');" onmouseout="out('5140805568250941919');" style="">  91      * @param session the session to use                                                                 </span>
<span class="1173013685970588399" onmouseenter="enter('1173013685970588399');" onmouseout="out('1173013685970588399');" style="">  92      * @throws GBException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  93      */                                                                                                  </span>
<span class="-3091409604540615006" onmouseenter="enter('-3091409604540615006');" onmouseout="out('-3091409604540615006');" style=""><abbr title="  94     protected abstract void deleteDevice(@NonNull GBDevice gbDevice, @NonNull Device device, @NonNull DaoSession session) throws GBException;">  94     protected abstract void deleteDevice(@NonNull GBDevice gbDevice, @NonNull Device device, @NonNull DaoðŸ”µ</abbr></span>
<span  style="">  95                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  96     @Override                                                                                            </span>
<span class="5032938558076004173" onmouseenter="enter('5032938558076004173');" onmouseout="out('5032938558076004173');" style="">  97     public boolean allowFetchActivityData(GBDevice device) {                                             </span>
<span class="-8904227237820426841" onmouseenter="enter('-8904227237820426841');" onmouseout="out('-8904227237820426841');" style="">  98         return device.isInitialized() &amp;&amp; !device.isBusy() &amp;&amp; supportsActivityDataFetching();             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99     }                                                                                                    </span>
<span  style=""> 100                                                                                                          </span>
<span class="-72396039432407750" onmouseenter="enter('-72396039432407750');" onmouseout="out('-72396039432407750');" style=""> 101     public boolean isHealthWearable(BluetoothDevice device) {                                            </span>
<span class="3231480528462724625" onmouseenter="enter('3231480528462724625');" onmouseout="out('3231480528462724625');" style=""> 102         BluetoothClass bluetoothClass = device.getBluetoothClass();                                      </span>
<span class="-30808472190140405" onmouseenter="enter('-30808472190140405');" onmouseout="out('-30808472190140405');" style=""> 103         if (bluetoothClass == null) {                                                                    </span>
<span class="4138348823358409315" onmouseenter="enter('4138348823358409315');" onmouseout="out('4138348823358409315');" style=""> 104             LOG.warn(&quot;unable to determine bluetooth device class of &quot; + device);                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 105             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106         }                                                                                                </span>
<span class="-858729263309297055" onmouseenter="enter('-858729263309297055');" onmouseout="out('-858729263309297055');" style=""> 107         if (bluetoothClass.getMajorDeviceClass() == BluetoothClass.Device.Major.WEARABLE                 </span>
<span class="2556881658902461803" onmouseenter="enter('2556881658902461803');" onmouseout="out('2556881658902461803');" style=""> 108             || bluetoothClass.getMajorDeviceClass() == BluetoothClass.Device.Major.UNCATEGORIZED) {      </span>
<span class="1671595227222781940" onmouseenter="enter('1671595227222781940');" onmouseout="out('1671595227222781940');" style=""> 109             int deviceClasses =                                                                          </span>
<span class="-1146163008414071478" onmouseenter="enter('-1146163008414071478');" onmouseout="out('-1146163008414071478');" style=""> 110                     BluetoothClass.Device.HEALTH_BLOOD_PRESSURE                                          </span>
<span class="6235589915448172621" onmouseenter="enter('6235589915448172621');" onmouseout="out('6235589915448172621');" style=""> 111                     | BluetoothClass.Device.HEALTH_DATA_DISPLAY                                          </span>
<span class="-8276652658854527263" onmouseenter="enter('-8276652658854527263');" onmouseout="out('-8276652658854527263');" style=""> 112                     | BluetoothClass.Device.HEALTH_PULSE_RATE                                            </span>
<span class="-3060079684210404996" onmouseenter="enter('-3060079684210404996');" onmouseout="out('-3060079684210404996');" style=""> 113                     | BluetoothClass.Device.HEALTH_WEIGHING                                              </span>
<span class="7563771026288700463" onmouseenter="enter('7563771026288700463');" onmouseout="out('7563771026288700463');" style=""> 114                     | BluetoothClass.Device.HEALTH_UNCATEGORIZED                                         </span>
<span class="5469110676853020998" onmouseenter="enter('5469110676853020998');" onmouseout="out('5469110676853020998');" style=""> 115                     | BluetoothClass.Device.HEALTH_PULSE_OXIMETER                                        </span>
<span class="1786090042007026357" onmouseenter="enter('1786090042007026357');" onmouseout="out('1786090042007026357');" style=""> 116                     | BluetoothClass.Device.HEALTH_GLUCOSE;                                              </span>
<span  style=""> 117                                                                                                          </span>
<span class="925651856192218134" onmouseenter="enter('925651856192218134');" onmouseout="out('925651856192218134');" style=""> 118             return (bluetoothClass.getDeviceClass() &amp; deviceClasses) != 0;                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 120         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121     }                                                                                                    </span>
<span  style=""> 122                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 123     @Override                                                                                            </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 124 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="8516715393014815109" onmouseenter="enter('8516715393014815109');" onmouseout="out('8516715393014815109');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125     public boolean needsBackgroundWebView(GBDevice device) {                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126         return false;                                                                                    </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 127 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 128 =======                                                                                                  </span>
<span class="-864084109100916389" onmouseenter="enter('-864084109100916389');" onmouseout="out('-864084109100916389');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129     public int getBondingStyle(GBDeviceCandidate deviceCandidate) {                                      </span>
<span class="936380115549042993" onmouseenter="enter('936380115549042993');" onmouseout="out('936380115549042993');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130         return BONDING_STYLE_ASK;                                                                        </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 131 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133 }                                                                                                        </span></pre></td>
                            <td><pre><span class="-2153024702397574105" onmouseenter="enter('-2153024702397574105');" onmouseout="out('-2153024702397574105');" style="">   1 /*  Copyright (C) 2015-2017 Carsten Pfeiffer                                                             </span>
<span  style="">   2                                                                                                          </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   3     This file is part of Gadgetbridge.                                                                   </span>
<span  style="">   4                                                                                                          </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   5     Gadgetbridge is free software: you can redistribute it and/or modify                                 </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   6     it under the terms of the GNU Affero General Public License as published                             </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   7     by the Free Software Foundation, either version 3 of the License, or                                 </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">   8     (at your option) any later version.                                                                  </span>
<span  style="">   9                                                                                                          </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  10     Gadgetbridge is distributed in the hope that it will be useful,                                      </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  11     but WITHOUT ANY WARRANTY; without even the implied warranty of                                       </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  12     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                        </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  13     GNU Affero General Public License for more details.                                                  </span>
<span  style="">  14                                                                                                          </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  15     You should have received a copy of the GNU Affero General Public License                             </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  16     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                             </span>
<span class="3135677453084526940" onmouseenter="enter('3135677453084526940');" onmouseout="out('3135677453084526940');" style="">  17 package nodomain.freeyourgadget.gadgetbridge.devices;                                                    </span>
<span  style="">  18                                                                                                          </span>
<span class="-311917288644069537" onmouseenter="enter('-311917288644069537');" onmouseout="out('-311917288644069537');" style="">  19 import android.bluetooth.BluetoothClass;                                                                 </span>
<span class="2859895893394018468" onmouseenter="enter('2859895893394018468');" onmouseout="out('2859895893394018468');" style="">  20 import android.bluetooth.BluetoothDevice;                                                                </span>
<span class="4786958806676392792" onmouseenter="enter('4786958806676392792');" onmouseout="out('4786958806676392792');" style="">  21 import android.bluetooth.le.ScanFilter;                                                                  </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  22 import android.support.annotation.NonNull;                                                               </span>
<span  style="">  23                                                                                                          </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  24 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  25 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  26                                                                                                          </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  27 import java.util.Collection;                                                                             </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  28 import java.util.Collections;                                                                            </span>
<span  style="">  29                                                                                                          </span>
<span class="-4354487052338529220" onmouseenter="enter('-4354487052338529220');" onmouseout="out('-4354487052338529220');" style="">  30 import de.greenrobot.dao.query.QueryBuilder;                                                             </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  31 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-1471644270559892265" onmouseenter="enter('-1471644270559892265');" onmouseout="out('-1471644270559892265');" style="">  32 import nodomain.freeyourgadget.gadgetbridge.GBException;                                                 </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  33 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4338650188295783318" onmouseenter="enter('4338650188295783318');" onmouseout="out('4338650188295783318');" style="">  34 import nodomain.freeyourgadget.gadgetbridge.database.DBHelper;                                           </span>
<span class="804944882642105225" onmouseenter="enter('804944882642105225');" onmouseout="out('804944882642105225');" style="">  35 import nodomain.freeyourgadget.gadgetbridge.entities.DaoSession;                                         </span>
<span class="4469307411224397441" onmouseenter="enter('4469307411224397441');" onmouseout="out('4469307411224397441');" style="">  36 import nodomain.freeyourgadget.gadgetbridge.entities.Device;                                             </span>
<span class="-977151012090239476" onmouseenter="enter('-977151012090239476');" onmouseout="out('-977151012090239476');" style="">  37 import nodomain.freeyourgadget.gadgetbridge.entities.DeviceAttributesDao;                                </span>
<span class="4836892992022606579" onmouseenter="enter('4836892992022606579');" onmouseout="out('4836892992022606579');" style="">  38 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;                                               </span>
<span class="-1351120908834620909" onmouseenter="enter('-1351120908834620909');" onmouseout="out('-1351120908834620909');" style="">  39 import nodomain.freeyourgadget.gadgetbridge.impl.GBDeviceCandidate;                                      </span>
<span  style="">  40                                                                                                          </span>
<span class="-4230229064741158074" onmouseenter="enter('-4230229064741158074');" onmouseout="out('-4230229064741158074');" style="">  41 public abstract class AbstractDeviceCoordinator implements DeviceCoordinator {                           </span>
<span class="1533308298984062740" onmouseenter="enter('1533308298984062740');" onmouseout="out('1533308298984062740');" style="">  42     private static final Logger LOG = LoggerFactory.getLogger(AbstractDeviceCoordinator.class);          </span>
<span  style="">  43                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  44     @Override                                                                                            </span>
<span class="-5773753981017336979" onmouseenter="enter('-5773753981017336979');" onmouseout="out('-5773753981017336979');" style="">  45     public final boolean supports(GBDeviceCandidate candidate) {                                         </span>
<span class="-5193755579287929052" onmouseenter="enter('-5193755579287929052');" onmouseout="out('-5193755579287929052');" style="">  46         return getSupportedType(candidate).isSupported();                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  47     }                                                                                                    </span>
<span  style="">  48                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  49     @Override                                                                                            </span>
<span class="4078602725554603282" onmouseenter="enter('4078602725554603282');" onmouseout="out('4078602725554603282');" style="">  50     public boolean supports(GBDevice device) {                                                           </span>
<span class="-5403859112831240356" onmouseenter="enter('-5403859112831240356');" onmouseout="out('-5403859112831240356');" style="">  51         return getDeviceType().equals(device.getType());                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  52     }                                                                                                    </span>
<span  style="">  53                                                                                                          </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style="">  54     @NonNull                                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  55     @Override                                                                                            </span>
<span class="1062073963528652044" onmouseenter="enter('1062073963528652044');" onmouseout="out('1062073963528652044');" style="">  56     public Collection&lt;? extends ScanFilter&gt; createBLEScanFilters() {                                     </span>
<span class="-6093315130064080899" onmouseenter="enter('-6093315130064080899');" onmouseout="out('-6093315130064080899');" style="">  57         return Collections.emptyList();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  58     }                                                                                                    </span>
<span  style="">  59                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  60     @Override                                                                                            </span>
<span class="2107833060147006233" onmouseenter="enter('2107833060147006233');" onmouseout="out('2107833060147006233');" style="">  61     public GBDevice createDevice(GBDeviceCandidate candidate) {                                          </span>
<span class="7068827190476029649" onmouseenter="enter('7068827190476029649');" onmouseout="out('7068827190476029649');" style="">  62         return new GBDevice(candidate.getDevice().getAddress(), candidate.getName(), getDeviceType());   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  63     }                                                                                                    </span>
<span  style="">  64                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  65     @Override                                                                                            </span>
<span class="2456275557980692881" onmouseenter="enter('2456275557980692881');" onmouseout="out('2456275557980692881');" style="">  66     public void deleteDevice(final GBDevice gbDevice) throws GBException {                               </span>
<span class="-2748439011794217767" onmouseenter="enter('-2748439011794217767');" onmouseout="out('-2748439011794217767');" style="">  67         LOG.info(&quot;will try to delete device: &quot; + gbDevice.getName());                                    </span>
<span class="-5483779301960408381" onmouseenter="enter('-5483779301960408381');" onmouseout="out('-5483779301960408381');" style="">  68         if (gbDevice.isConnected() || gbDevice.isConnecting()) {                                         </span>
<span class="7347953572742694021" onmouseenter="enter('7347953572742694021');" onmouseout="out('7347953572742694021');" style="">  69             GBApplication.deviceService().disconnect();                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70         }                                                                                                </span>
<span class="8566685229205195929" onmouseenter="enter('8566685229205195929');" onmouseout="out('8566685229205195929');" style="">  71         try (DBHandler dbHandler = GBApplication.acquireDB()) {                                          </span>
<span class="-5035264817263566539" onmouseenter="enter('-5035264817263566539');" onmouseout="out('-5035264817263566539');" style="">  72             DaoSession session = dbHandler.getDaoSession();                                              </span>
<span class="7301165332090965101" onmouseenter="enter('7301165332090965101');" onmouseout="out('7301165332090965101');" style="">  73             Device device = DBHelper.findDevice(gbDevice, session);                                      </span>
<span class="-8372003146204379455" onmouseenter="enter('-8372003146204379455');" onmouseout="out('-8372003146204379455');" style="">  74             if (device != null) {                                                                        </span>
<span class="2653457635170470666" onmouseenter="enter('2653457635170470666');" onmouseout="out('2653457635170470666');" style="">  75                 deleteDevice(gbDevice, device, session);                                                 </span>
<span class="-3608622048077556792" onmouseenter="enter('-3608622048077556792');" onmouseout="out('-3608622048077556792');" style="">  76                 QueryBuilder&lt;?&gt; qb = session.getDeviceAttributesDao().queryBuilder();                    </span>
<span class="-8958331783640360848" onmouseenter="enter('-8958331783640360848');" onmouseout="out('-8958331783640360848');" style=""><abbr title="  77                 qb.where(DeviceAttributesDao.Properties.DeviceId.eq(device.getId())).buildDelete().executeDeleteWithoutDetachingEntities();">  77                 qb.where(DeviceAttributesDao.Properties.DeviceId.eq(device.getId())).buildDelete().executðŸ”µ</abbr></span>
<span class="5697251904061281905" onmouseenter="enter('5697251904061281905');" onmouseout="out('5697251904061281905');" style="">  78                 session.getDeviceDao().delete(device);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  79             } else {                                                                                     </span>
<span class="5738091463814250523" onmouseenter="enter('5738091463814250523');" onmouseout="out('5738091463814250523');" style="">  80                 LOG.info(&quot;device to delete not found in db: &quot; + gbDevice);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="">  82         } catch (Exception e) {                                                                          </span>
<span class="-6625841807606110692" onmouseenter="enter('-6625841807606110692');" onmouseout="out('-6625841807606110692');" style="">  83             throw new GBException(&quot;Error deleting device: &quot; + e.getMessage(), e);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85     }                                                                                                    </span>
<span  style="">  86                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  87     /**                                                                                                  </span>
<span class="8590530733634682184" onmouseenter="enter('8590530733634682184');" onmouseout="out('8590530733634682184');" style="">  88      * Hook for subclasses to perform device-specific deletion logic, e.g. db cleanup.                   </span>
<span class="-8983980441374315330" onmouseenter="enter('-8983980441374315330');" onmouseout="out('-8983980441374315330');" style="">  89      * @param gbDevice the GBDevice                                                                      </span>
<span class="3611176693110093725" onmouseenter="enter('3611176693110093725');" onmouseout="out('3611176693110093725');" style="">  90      * @param device the corresponding database Device                                                   </span>
<span class="5140805568250941919" onmouseenter="enter('5140805568250941919');" onmouseout="out('5140805568250941919');" style="">  91      * @param session the session to use                                                                 </span>
<span class="1173013685970588399" onmouseenter="enter('1173013685970588399');" onmouseout="out('1173013685970588399');" style="">  92      * @throws GBException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  93      */                                                                                                  </span>
<span class="-3091409604540615006" onmouseenter="enter('-3091409604540615006');" onmouseout="out('-3091409604540615006');" style=""><abbr title="  94     protected abstract void deleteDevice(@NonNull GBDevice gbDevice, @NonNull Device device, @NonNull DaoSession session) throws GBException;">  94     protected abstract void deleteDevice(@NonNull GBDevice gbDevice, @NonNull Device device, @NonNull DaoðŸ”µ</abbr></span>
<span  style="">  95                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  96     @Override                                                                                            </span>
<span class="5032938558076004173" onmouseenter="enter('5032938558076004173');" onmouseout="out('5032938558076004173');" style="">  97     public boolean allowFetchActivityData(GBDevice device) {                                             </span>
<span class="-8904227237820426841" onmouseenter="enter('-8904227237820426841');" onmouseout="out('-8904227237820426841');" style="">  98         return device.isInitialized() &amp;&amp; !device.isBusy() &amp;&amp; supportsActivityDataFetching();             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99     }                                                                                                    </span>
<span  style=""> 100                                                                                                          </span>
<span class="-72396039432407750" onmouseenter="enter('-72396039432407750');" onmouseout="out('-72396039432407750');" style=""> 101     public boolean isHealthWearable(BluetoothDevice device) {                                            </span>
<span class="3231480528462724625" onmouseenter="enter('3231480528462724625');" onmouseout="out('3231480528462724625');" style=""> 102         BluetoothClass bluetoothClass = device.getBluetoothClass();                                      </span>
<span class="-30808472190140405" onmouseenter="enter('-30808472190140405');" onmouseout="out('-30808472190140405');" style=""> 103         if (bluetoothClass == null) {                                                                    </span>
<span class="4138348823358409315" onmouseenter="enter('4138348823358409315');" onmouseout="out('4138348823358409315');" style=""> 104             LOG.warn(&quot;unable to determine bluetooth device class of &quot; + device);                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 105             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106         }                                                                                                </span>
<span class="-858729263309297055" onmouseenter="enter('-858729263309297055');" onmouseout="out('-858729263309297055');" style=""> 107         if (bluetoothClass.getMajorDeviceClass() == BluetoothClass.Device.Major.WEARABLE                 </span>
<span class="2556881658902461803" onmouseenter="enter('2556881658902461803');" onmouseout="out('2556881658902461803');" style=""> 108             || bluetoothClass.getMajorDeviceClass() == BluetoothClass.Device.Major.UNCATEGORIZED) {      </span>
<span class="1671595227222781940" onmouseenter="enter('1671595227222781940');" onmouseout="out('1671595227222781940');" style=""> 109             int deviceClasses =                                                                          </span>
<span class="-1146163008414071478" onmouseenter="enter('-1146163008414071478');" onmouseout="out('-1146163008414071478');" style=""> 110                     BluetoothClass.Device.HEALTH_BLOOD_PRESSURE                                          </span>
<span class="6235589915448172621" onmouseenter="enter('6235589915448172621');" onmouseout="out('6235589915448172621');" style=""> 111                     | BluetoothClass.Device.HEALTH_DATA_DISPLAY                                          </span>
<span class="-8276652658854527263" onmouseenter="enter('-8276652658854527263');" onmouseout="out('-8276652658854527263');" style=""> 112                     | BluetoothClass.Device.HEALTH_PULSE_RATE                                            </span>
<span class="-3060079684210404996" onmouseenter="enter('-3060079684210404996');" onmouseout="out('-3060079684210404996');" style=""> 113                     | BluetoothClass.Device.HEALTH_WEIGHING                                              </span>
<span class="7563771026288700463" onmouseenter="enter('7563771026288700463');" onmouseout="out('7563771026288700463');" style=""> 114                     | BluetoothClass.Device.HEALTH_UNCATEGORIZED                                         </span>
<span class="5469110676853020998" onmouseenter="enter('5469110676853020998');" onmouseout="out('5469110676853020998');" style=""> 115                     | BluetoothClass.Device.HEALTH_PULSE_OXIMETER                                        </span>
<span class="1786090042007026357" onmouseenter="enter('1786090042007026357');" onmouseout="out('1786090042007026357');" style=""> 116                     | BluetoothClass.Device.HEALTH_GLUCOSE;                                              </span>
<span  style=""> 117                                                                                                          </span>
<span class="925651856192218134" onmouseenter="enter('925651856192218134');" onmouseout="out('925651856192218134');" style=""> 118             return (bluetoothClass.getDeviceClass() &amp; deviceClasses) != 0;                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 120         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121     }                                                                                                    </span>
<span  style=""> 122                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 123     @Override                                                                                            </span>
<span class="8516715393014815109" onmouseenter="enter('8516715393014815109');" onmouseout="out('8516715393014815109');" style=""> 124     public boolean needsBackgroundWebView(GBDevice device) {                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 125         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126     }                                                                                                    </span>
<span  style=""> 127                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 128     @Override                                                                                            </span>
<span class="-864084109100916389" onmouseenter="enter('-864084109100916389');" onmouseout="out('-864084109100916389');" style=""> 129     public int getBondingStyle(GBDeviceCandidate deviceCandidate) {                                      </span>
<span class="936380115549042993" onmouseenter="enter('936380115549042993');" onmouseout="out('936380115549042993');" style=""> 130         return BONDING_STYLE_ASK;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132 }                                                                                                        </span></pre></td>
                            <td><pre><span class="-2153024702397574105" onmouseenter="enter('-2153024702397574105');" onmouseout="out('-2153024702397574105');" style="">   1 /*  Copyright (C) 2015-2017 Carsten Pfeiffer                                                             </span>
<span  style="">   2                                                                                                          </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   3     This file is part of Gadgetbridge.                                                                   </span>
<span  style="">   4                                                                                                          </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   5     Gadgetbridge is free software: you can redistribute it and/or modify                                 </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   6     it under the terms of the GNU Affero General Public License as published                             </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   7     by the Free Software Foundation, either version 3 of the License, or                                 </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">   8     (at your option) any later version.                                                                  </span>
<span  style="">   9                                                                                                          </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  10     Gadgetbridge is distributed in the hope that it will be useful,                                      </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  11     but WITHOUT ANY WARRANTY; without even the implied warranty of                                       </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  12     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                        </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  13     GNU Affero General Public License for more details.                                                  </span>
<span  style="">  14                                                                                                          </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  15     You should have received a copy of the GNU Affero General Public License                             </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  16     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                             </span>
<span class="3135677453084526940" onmouseenter="enter('3135677453084526940');" onmouseout="out('3135677453084526940');" style="">  17 package nodomain.freeyourgadget.gadgetbridge.devices;                                                    </span>
<span  style="">  18                                                                                                          </span>
<span class="-311917288644069537" onmouseenter="enter('-311917288644069537');" onmouseout="out('-311917288644069537');" style="">  19 import android.bluetooth.BluetoothClass;                                                                 </span>
<span class="2859895893394018468" onmouseenter="enter('2859895893394018468');" onmouseout="out('2859895893394018468');" style="">  20 import android.bluetooth.BluetoothDevice;                                                                </span>
<span class="4786958806676392792" onmouseenter="enter('4786958806676392792');" onmouseout="out('4786958806676392792');" style="">  21 import android.bluetooth.le.ScanFilter;                                                                  </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  22 import android.support.annotation.NonNull;                                                               </span>
<span class="-4354487052338529220" onmouseenter="enter('-4354487052338529220');" onmouseout="out('-4354487052338529220');" style="">  23 import de.greenrobot.dao.query.QueryBuilder;                                                             </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  24 import java.util.Collection;                                                                             </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  25 import java.util.Collections;                                                                            </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  26 import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                               </span>
<span class="-1471644270559892265" onmouseenter="enter('-1471644270559892265');" onmouseout="out('-1471644270559892265');" style="">  27 import nodomain.freeyourgadget.gadgetbridge.GBException;                                                 </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  28 import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                          </span>
<span class="4338650188295783318" onmouseenter="enter('4338650188295783318');" onmouseout="out('4338650188295783318');" style="">  29 import nodomain.freeyourgadget.gadgetbridge.database.DBHelper;                                           </span>
<span class="804944882642105225" onmouseenter="enter('804944882642105225');" onmouseout="out('804944882642105225');" style="">  30 import nodomain.freeyourgadget.gadgetbridge.entities.DaoSession;                                         </span>
<span class="4469307411224397441" onmouseenter="enter('4469307411224397441');" onmouseout="out('4469307411224397441');" style="">  31 import nodomain.freeyourgadget.gadgetbridge.entities.Device;                                             </span>
<span class="-977151012090239476" onmouseenter="enter('-977151012090239476');" onmouseout="out('-977151012090239476');" style="">  32 import nodomain.freeyourgadget.gadgetbridge.entities.DeviceAttributesDao;                                </span>
<span class="4836892992022606579" onmouseenter="enter('4836892992022606579');" onmouseout="out('4836892992022606579');" style="">  33 import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;                                               </span>
<span class="-1351120908834620909" onmouseenter="enter('-1351120908834620909');" onmouseout="out('-1351120908834620909');" style="">  34 import nodomain.freeyourgadget.gadgetbridge.impl.GBDeviceCandidate;                                      </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  35 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  36 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  37                                                                                                          </span>
<span  style="">  38                                                                                                          </span>
<span class="-4230229064741158074" onmouseenter="enter('-4230229064741158074');" onmouseout="out('-4230229064741158074');" style="">  39 public abstract class AbstractDeviceCoordinator implements DeviceCoordinator {                           </span>
<span class="1533308298984062740" onmouseenter="enter('1533308298984062740');" onmouseout="out('1533308298984062740');" style="">  40     private static final Logger LOG = LoggerFactory.getLogger(AbstractDeviceCoordinator.class);          </span>
<span  style="">  41                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  42     @Override                                                                                            </span>
<span class="-5773753981017336979" onmouseenter="enter('-5773753981017336979');" onmouseout="out('-5773753981017336979');" style="">  43     public final boolean supports(GBDeviceCandidate candidate) {                                         </span>
<span class="-5193755579287929052" onmouseenter="enter('-5193755579287929052');" onmouseout="out('-5193755579287929052');" style="">  44         return getSupportedType(candidate).isSupported();                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  45     }                                                                                                    </span>
<span  style="">  46                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  47     @Override                                                                                            </span>
<span class="4078602725554603282" onmouseenter="enter('4078602725554603282');" onmouseout="out('4078602725554603282');" style="">  48     public boolean supports(GBDevice device) {                                                           </span>
<span class="-5403859112831240356" onmouseenter="enter('-5403859112831240356');" onmouseout="out('-5403859112831240356');" style="">  49         return getDeviceType().equals(device.getType());                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  50     }                                                                                                    </span>
<span  style="">  51                                                                                                          </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style="">  52     @NonNull                                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  53     @Override                                                                                            </span>
<span class="1062073963528652044" onmouseenter="enter('1062073963528652044');" onmouseout="out('1062073963528652044');" style="">  54     public Collection&lt;? extends ScanFilter&gt; createBLEScanFilters() {                                     </span>
<span class="-6093315130064080899" onmouseenter="enter('-6093315130064080899');" onmouseout="out('-6093315130064080899');" style="">  55         return Collections.emptyList();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  56     }                                                                                                    </span>
<span  style="">  57                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  58     @Override                                                                                            </span>
<span class="2107833060147006233" onmouseenter="enter('2107833060147006233');" onmouseout="out('2107833060147006233');" style="">  59     public GBDevice createDevice(GBDeviceCandidate candidate) {                                          </span>
<span class="7068827190476029649" onmouseenter="enter('7068827190476029649');" onmouseout="out('7068827190476029649');" style="">  60         return new GBDevice(candidate.getDevice().getAddress(), candidate.getName(), getDeviceType());   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  61     }                                                                                                    </span>
<span  style="">  62                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  63     @Override                                                                                            </span>
<span class="2456275557980692881" onmouseenter="enter('2456275557980692881');" onmouseout="out('2456275557980692881');" style="">  64     public void deleteDevice(final GBDevice gbDevice) throws GBException {                               </span>
<span class="-2748439011794217767" onmouseenter="enter('-2748439011794217767');" onmouseout="out('-2748439011794217767');" style="">  65         LOG.info(&quot;will try to delete device: &quot; + gbDevice.getName());                                    </span>
<span class="-5483779301960408381" onmouseenter="enter('-5483779301960408381');" onmouseout="out('-5483779301960408381');" style="">  66         if (gbDevice.isConnected() || gbDevice.isConnecting()) {                                         </span>
<span class="7347953572742694021" onmouseenter="enter('7347953572742694021');" onmouseout="out('7347953572742694021');" style="">  67             GBApplication.deviceService().disconnect();                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  68         }                                                                                                </span>
<span class="8566685229205195929" onmouseenter="enter('8566685229205195929');" onmouseout="out('8566685229205195929');" style="">  69         try (DBHandler dbHandler = GBApplication.acquireDB()) {                                          </span>
<span class="-5035264817263566539" onmouseenter="enter('-5035264817263566539');" onmouseout="out('-5035264817263566539');" style="">  70             DaoSession session = dbHandler.getDaoSession();                                              </span>
<span class="7301165332090965101" onmouseenter="enter('7301165332090965101');" onmouseout="out('7301165332090965101');" style="">  71             Device device = DBHelper.findDevice(gbDevice, session);                                      </span>
<span class="-8372003146204379455" onmouseenter="enter('-8372003146204379455');" onmouseout="out('-8372003146204379455');" style="">  72             if (device != null) {                                                                        </span>
<span class="2653457635170470666" onmouseenter="enter('2653457635170470666');" onmouseout="out('2653457635170470666');" style="">  73                 deleteDevice(gbDevice, device, session);                                                 </span>
<span class="-3608622048077556792" onmouseenter="enter('-3608622048077556792');" onmouseout="out('-3608622048077556792');" style="">  74                 QueryBuilder&lt;?&gt; qb = session.getDeviceAttributesDao().queryBuilder();                    </span>
<span class="-8958331783640360848" onmouseenter="enter('-8958331783640360848');" onmouseout="out('-8958331783640360848');" style=""><abbr title="  75                 qb.where(DeviceAttributesDao.Properties.DeviceId.eq(device.getId())).buildDelete().executeDeleteWithoutDetachingEntities();">  75                 qb.where(DeviceAttributesDao.Properties.DeviceId.eq(device.getId())).buildDelete().executðŸ”µ</abbr></span>
<span class="5697251904061281905" onmouseenter="enter('5697251904061281905');" onmouseout="out('5697251904061281905');" style="">  76                 session.getDeviceDao().delete(device);                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  77             } else {                                                                                     </span>
<span class="5738091463814250523" onmouseenter="enter('5738091463814250523');" onmouseout="out('5738091463814250523');" style="">  78                 LOG.info(&quot;device to delete not found in db: &quot; + gbDevice);                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="">  80         } catch (Exception e) {                                                                          </span>
<span class="-6625841807606110692" onmouseenter="enter('-6625841807606110692');" onmouseout="out('-6625841807606110692');" style="">  81             throw new GBException(&quot;Error deleting device: &quot; + e.getMessage(), e);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83     }                                                                                                    </span>
<span  style="">  84                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  85     /**                                                                                                  </span>
<span class="8590530733634682184" onmouseenter="enter('8590530733634682184');" onmouseout="out('8590530733634682184');" style="">  86      * Hook for subclasses to perform device-specific deletion logic, e.g. db cleanup.                   </span>
<span class="-8983980441374315330" onmouseenter="enter('-8983980441374315330');" onmouseout="out('-8983980441374315330');" style="">  87      * @param gbDevice the GBDevice                                                                      </span>
<span class="3611176693110093725" onmouseenter="enter('3611176693110093725');" onmouseout="out('3611176693110093725');" style="">  88      * @param device the corresponding database Device                                                   </span>
<span class="5140805568250941919" onmouseenter="enter('5140805568250941919');" onmouseout="out('5140805568250941919');" style="">  89      * @param session the session to use                                                                 </span>
<span class="1173013685970588399" onmouseenter="enter('1173013685970588399');" onmouseout="out('1173013685970588399');" style="">  90      * @throws GBException                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  91      */                                                                                                  </span>
<span class="-3091409604540615006" onmouseenter="enter('-3091409604540615006');" onmouseout="out('-3091409604540615006');" style=""><abbr title="  92     protected abstract void deleteDevice(@NonNull GBDevice gbDevice, @NonNull Device device, @NonNull DaoSession session) throws GBException;">  92     protected abstract void deleteDevice(@NonNull GBDevice gbDevice, @NonNull Device device, @NonNull DaoðŸ”µ</abbr></span>
<span  style="">  93                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  94     @Override                                                                                            </span>
<span class="5032938558076004173" onmouseenter="enter('5032938558076004173');" onmouseout="out('5032938558076004173');" style="">  95     public boolean allowFetchActivityData(GBDevice device) {                                             </span>
<span class="-8904227237820426841" onmouseenter="enter('-8904227237820426841');" onmouseout="out('-8904227237820426841');" style="">  96         return device.isInitialized() &amp;&amp; !device.isBusy() &amp;&amp; supportsActivityDataFetching();             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97     }                                                                                                    </span>
<span  style="">  98                                                                                                          </span>
<span class="-72396039432407750" onmouseenter="enter('-72396039432407750');" onmouseout="out('-72396039432407750');" style="">  99     public boolean isHealthWearable(BluetoothDevice device) {                                            </span>
<span class="3231480528462724625" onmouseenter="enter('3231480528462724625');" onmouseout="out('3231480528462724625');" style=""> 100         BluetoothClass bluetoothClass = device.getBluetoothClass();                                      </span>
<span class="-30808472190140405" onmouseenter="enter('-30808472190140405');" onmouseout="out('-30808472190140405');" style=""> 101         if (bluetoothClass == null) {                                                                    </span>
<span class="4138348823358409315" onmouseenter="enter('4138348823358409315');" onmouseout="out('4138348823358409315');" style=""> 102             LOG.warn(&quot;unable to determine bluetooth device class of &quot; + device);                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 103             return false;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104         }                                                                                                </span>
<span class="-858729263309297055" onmouseenter="enter('-858729263309297055');" onmouseout="out('-858729263309297055');" style=""> 105         if (bluetoothClass.getMajorDeviceClass() == BluetoothClass.Device.Major.WEARABLE                 </span>
<span class="2556881658902461803" onmouseenter="enter('2556881658902461803');" onmouseout="out('2556881658902461803');" style=""> 106             || bluetoothClass.getMajorDeviceClass() == BluetoothClass.Device.Major.UNCATEGORIZED) {      </span>
<span class="1671595227222781940" onmouseenter="enter('1671595227222781940');" onmouseout="out('1671595227222781940');" style=""> 107             int deviceClasses =                                                                          </span>
<span class="-1146163008414071478" onmouseenter="enter('-1146163008414071478');" onmouseout="out('-1146163008414071478');" style=""> 108                     BluetoothClass.Device.HEALTH_BLOOD_PRESSURE                                          </span>
<span class="6235589915448172621" onmouseenter="enter('6235589915448172621');" onmouseout="out('6235589915448172621');" style=""> 109                     | BluetoothClass.Device.HEALTH_DATA_DISPLAY                                          </span>
<span class="-8276652658854527263" onmouseenter="enter('-8276652658854527263');" onmouseout="out('-8276652658854527263');" style=""> 110                     | BluetoothClass.Device.HEALTH_PULSE_RATE                                            </span>
<span class="-3060079684210404996" onmouseenter="enter('-3060079684210404996');" onmouseout="out('-3060079684210404996');" style=""> 111                     | BluetoothClass.Device.HEALTH_WEIGHING                                              </span>
<span class="7563771026288700463" onmouseenter="enter('7563771026288700463');" onmouseout="out('7563771026288700463');" style=""> 112                     | BluetoothClass.Device.HEALTH_UNCATEGORIZED                                         </span>
<span class="5469110676853020998" onmouseenter="enter('5469110676853020998');" onmouseout="out('5469110676853020998');" style=""> 113                     | BluetoothClass.Device.HEALTH_PULSE_OXIMETER                                        </span>
<span class="1786090042007026357" onmouseenter="enter('1786090042007026357');" onmouseout="out('1786090042007026357');" style=""> 114                     | BluetoothClass.Device.HEALTH_GLUCOSE;                                              </span>
<span  style=""> 115                                                                                                          </span>
<span class="925651856192218134" onmouseenter="enter('925651856192218134');" onmouseout="out('925651856192218134');" style=""> 116             return (bluetoothClass.getDeviceClass() &amp; deviceClasses) != 0;                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117         }                                                                                                </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 118         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119     }                                                                                                    </span>
<span  style=""> 120                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 121     @Override                                                                                            </span>
<span class="8516715393014815109" onmouseenter="enter('8516715393014815109');" onmouseout="out('8516715393014815109');" style=""> 122     public boolean needsBackgroundWebView(GBDevice device) {                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 123         return false;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124     }                                                                                                    </span>
<span  style=""> 125                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 126     @Override                                                                                            </span>
<span class="-864084109100916389" onmouseenter="enter('-864084109100916389');" onmouseout="out('-864084109100916389');" style=""> 127     public int getBondingStyle(GBDeviceCandidate deviceCandidate) {                                      </span>
<span class="936380115549042993" onmouseenter="enter('936380115549042993');" onmouseout="out('936380115549042993');" style=""> 128         return BONDING_STYLE_ASK;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130 }                                                                                                        </span>

</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-2153024702397574105" onmouseenter="enter('-2153024702397574105');" onmouseout="out('-2153024702397574105');" style="">   1  /*  Copyright (C) 2015-2017 Carsten Pfeiffer                                                                      </span>
<span  style="">   2                                                                                                                    </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   3      This file is part of Gadgetbridge.                                                                            </span>
<span  style="">   4                                                                                                                    </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   5      Gadgetbridge is free software: you can redistribute it and/or modify                                          </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   6      it under the terms of the GNU Affero General Public License as published                                      </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   7      by the Free Software Foundation, either version 3 of the License, or                                          </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">   8      (at your option) any later version.                                                                           </span>
<span  style="">   9                                                                                                                    </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  10      Gadgetbridge is distributed in the hope that it will be useful,                                               </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  11      but WITHOUT ANY WARRANTY; without even the implied warranty of                                                </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  12      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                                 </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  13      GNU Affero General Public License for more details.                                                           </span>
<span  style="">  14                                                                                                                    </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  15      You should have received a copy of the GNU Affero General Public License                                      </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  16      along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                                      </span>
<span class="3135677453084526940" onmouseenter="enter('3135677453084526940');" onmouseout="out('3135677453084526940');" style="">  17  package nodomain.freeyourgadget.gadgetbridge.devices;                                                             </span>
<span  style="">  18                                                                                                                    </span>
<span class="-311917288644069537" onmouseenter="enter('-311917288644069537');" onmouseout="out('-311917288644069537');" style="">  19  import android.bluetooth.BluetoothClass;                                                                          </span>
<span class="2859895893394018468" onmouseenter="enter('2859895893394018468');" onmouseout="out('2859895893394018468');" style="">  20  import android.bluetooth.BluetoothDevice;                                                                         </span>
<span class="4786958806676392792" onmouseenter="enter('4786958806676392792');" onmouseout="out('4786958806676392792');" style="">  21  import android.bluetooth.le.ScanFilter;                                                                           </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  22  import android.support.annotation.NonNull;                                                                        </span>
<span  style="">  23                                                                                                                    </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  24  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  25  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  26                                                                                                                    </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  27  import java.util.Collection;                                                                                      </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  28  import java.util.Collections;                                                                                     </span>
<span  style="">  29                                                                                                                    </span>
<span class="-4354487052338529220" onmouseenter="enter('-4354487052338529220');" onmouseout="out('-4354487052338529220');" style="">  30  import de.greenrobot.dao.query.QueryBuilder;                                                                      </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  31  import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                                        </span>
<span class="-1471644270559892265" onmouseenter="enter('-1471644270559892265');" onmouseout="out('-1471644270559892265');" style="">  32  import nodomain.freeyourgadget.gadgetbridge.GBException;                                                          </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  33  import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                                   </span>
<span class="4338650188295783318" onmouseenter="enter('4338650188295783318');" onmouseout="out('4338650188295783318');" style="">  34  import nodomain.freeyourgadget.gadgetbridge.database.DBHelper;                                                    </span>
<span class="804944882642105225" onmouseenter="enter('804944882642105225');" onmouseout="out('804944882642105225');" style="">  35  import nodomain.freeyourgadget.gadgetbridge.entities.DaoSession;                                                  </span>
<span class="4469307411224397441" onmouseenter="enter('4469307411224397441');" onmouseout="out('4469307411224397441');" style="">  36  import nodomain.freeyourgadget.gadgetbridge.entities.Device;                                                      </span>
<span class="-977151012090239476" onmouseenter="enter('-977151012090239476');" onmouseout="out('-977151012090239476');" style="">  37  import nodomain.freeyourgadget.gadgetbridge.entities.DeviceAttributesDao;                                         </span>
<span class="4836892992022606579" onmouseenter="enter('4836892992022606579');" onmouseout="out('4836892992022606579');" style="">  38  import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;                                                        </span>
<span class="-1351120908834620909" onmouseenter="enter('-1351120908834620909');" onmouseout="out('-1351120908834620909');" style="">  39  import nodomain.freeyourgadget.gadgetbridge.impl.GBDeviceCandidate;                                               </span>
<span  style="">  40                                                                                                                    </span>
<span class="-4230229064741158074" onmouseenter="enter('-4230229064741158074');" onmouseout="out('-4230229064741158074');" style="">  41  public abstract class AbstractDeviceCoordinator implements DeviceCoordinator {                                    </span>
<span class="1533308298984062740" onmouseenter="enter('1533308298984062740');" onmouseout="out('1533308298984062740');" style="">  42      private static final Logger LOG = LoggerFactory.getLogger(AbstractDeviceCoordinator.class);                   </span>
<span  style="">  43                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  44      @Override                                                                                                     </span>
<span class="-5773753981017336979" onmouseenter="enter('-5773753981017336979');" onmouseout="out('-5773753981017336979');" style="">  45      public final boolean supports(GBDeviceCandidate candidate) {                                                  </span>
<span class="-5193755579287929052" onmouseenter="enter('-5193755579287929052');" onmouseout="out('-5193755579287929052');" style="">  46          return getSupportedType(candidate).isSupported();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  47      }                                                                                                             </span>
<span  style="">  48                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  49      @Override                                                                                                     </span>
<span class="4078602725554603282" onmouseenter="enter('4078602725554603282');" onmouseout="out('4078602725554603282');" style="">  50      public boolean supports(GBDevice device) {                                                                    </span>
<span class="-5403859112831240356" onmouseenter="enter('-5403859112831240356');" onmouseout="out('-5403859112831240356');" style="">  51          return getDeviceType().equals(device.getType());                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  52      }                                                                                                             </span>
<span  style="">  53                                                                                                                    </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style="">  54      @NonNull                                                                                                      </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  55      @Override                                                                                                     </span>
<span class="1062073963528652044" onmouseenter="enter('1062073963528652044');" onmouseout="out('1062073963528652044');" style="">  56      public Collection&lt;? extends ScanFilter&gt; createBLEScanFilters() {                                              </span>
<span class="-6093315130064080899" onmouseenter="enter('-6093315130064080899');" onmouseout="out('-6093315130064080899');" style="">  57          return Collections.emptyList();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  58      }                                                                                                             </span>
<span  style="">  59                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  60      @Override                                                                                                     </span>
<span class="2107833060147006233" onmouseenter="enter('2107833060147006233');" onmouseout="out('2107833060147006233');" style="">  61      public GBDevice createDevice(GBDeviceCandidate candidate) {                                                   </span>
<span class="7068827190476029649" onmouseenter="enter('7068827190476029649');" onmouseout="out('7068827190476029649');" style="">  62          return new GBDevice(candidate.getDevice().getAddress(), candidate.getName(), getDeviceType());            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  63      }                                                                                                             </span>
<span  style="">  64                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  65      @Override                                                                                                     </span>
<span class="2456275557980692881" onmouseenter="enter('2456275557980692881');" onmouseout="out('2456275557980692881');" style="">  66      public void deleteDevice(final GBDevice gbDevice) throws GBException {                                        </span>
<span class="-2748439011794217767" onmouseenter="enter('-2748439011794217767');" onmouseout="out('-2748439011794217767');" style="">  67          LOG.info(&quot;will try to delete device: &quot; + gbDevice.getName());                                             </span>
<span class="-5483779301960408381" onmouseenter="enter('-5483779301960408381');" onmouseout="out('-5483779301960408381');" style="">  68          if (gbDevice.isConnected() || gbDevice.isConnecting()) {                                                  </span>
<span class="7347953572742694021" onmouseenter="enter('7347953572742694021');" onmouseout="out('7347953572742694021');" style="">  69              GBApplication.deviceService().disconnect();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70          }                                                                                                         </span>
<span class="8566685229205195929" onmouseenter="enter('8566685229205195929');" onmouseout="out('8566685229205195929');" style="">  71          try (DBHandler dbHandler = GBApplication.acquireDB()) {                                                   </span>
<span class="-5035264817263566539" onmouseenter="enter('-5035264817263566539');" onmouseout="out('-5035264817263566539');" style="">  72              DaoSession session = dbHandler.getDaoSession();                                                       </span>
<span class="7301165332090965101" onmouseenter="enter('7301165332090965101');" onmouseout="out('7301165332090965101');" style="">  73              Device device = DBHelper.findDevice(gbDevice, session);                                               </span>
<span class="-8372003146204379455" onmouseenter="enter('-8372003146204379455');" onmouseout="out('-8372003146204379455');" style="">  74              if (device != null) {                                                                                 </span>
<span class="2653457635170470666" onmouseenter="enter('2653457635170470666');" onmouseout="out('2653457635170470666');" style="">  75                  deleteDevice(gbDevice, device, session);                                                          </span>
<span class="-3608622048077556792" onmouseenter="enter('-3608622048077556792');" onmouseout="out('-3608622048077556792');" style="">  76                  QueryBuilder&lt;?&gt; qb = session.getDeviceAttributesDao().queryBuilder();                             </span>
<span class="-8958331783640360848" onmouseenter="enter('-8958331783640360848');" onmouseout="out('-8958331783640360848');" style=""><abbr title="  77                  qb.where(DeviceAttributesDao.Properties.DeviceId.eq(device.getId())).buildDelete().executeDeleteWithoutDetachingEntities();">  77                  qb.where(DeviceAttributesDao.Properties.DeviceId.eq(device.getId())).buildDelete().executeDeleteWiðŸ”µ</abbr></span>
<span class="5697251904061281905" onmouseenter="enter('5697251904061281905');" onmouseout="out('5697251904061281905');" style="">  78                  session.getDeviceDao().delete(device);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  79              } else {                                                                                              </span>
<span class="5738091463814250523" onmouseenter="enter('5738091463814250523');" onmouseout="out('5738091463814250523');" style="">  80                  LOG.info(&quot;device to delete not found in db: &quot; + gbDevice);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="">  82          } catch (Exception e) {                                                                                   </span>
<span class="-6625841807606110692" onmouseenter="enter('-6625841807606110692');" onmouseout="out('-6625841807606110692');" style="">  83              throw new GBException(&quot;Error deleting device: &quot; + e.getMessage(), e);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85      }                                                                                                             </span>
<span  style="">  86                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  87      /**                                                                                                           </span>
<span class="8590530733634682184" onmouseenter="enter('8590530733634682184');" onmouseout="out('8590530733634682184');" style="">  88       * Hook for subclasses to perform device-specific deletion logic, e.g. db cleanup.                            </span>
<span class="-8983980441374315330" onmouseenter="enter('-8983980441374315330');" onmouseout="out('-8983980441374315330');" style="">  89       * @param gbDevice the GBDevice                                                                               </span>
<span class="3611176693110093725" onmouseenter="enter('3611176693110093725');" onmouseout="out('3611176693110093725');" style="">  90       * @param device the corresponding database Device                                                            </span>
<span class="5140805568250941919" onmouseenter="enter('5140805568250941919');" onmouseout="out('5140805568250941919');" style="">  91       * @param session the session to use                                                                          </span>
<span class="1173013685970588399" onmouseenter="enter('1173013685970588399');" onmouseout="out('1173013685970588399');" style="">  92       * @throws GBException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  93       */                                                                                                           </span>
<span class="-3091409604540615006" onmouseenter="enter('-3091409604540615006');" onmouseout="out('-3091409604540615006');" style=""><abbr title="  94      protected abstract void deleteDevice(@NonNull GBDevice gbDevice, @NonNull Device device, @NonNull DaoSession session) throws GBException;">  94      protected abstract void deleteDevice(@NonNull GBDevice gbDevice, @NonNull Device device, @NonNull DaoSession sðŸ”µ</abbr></span>
<span  style="">  95                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  96      @Override                                                                                                     </span>
<span class="5032938558076004173" onmouseenter="enter('5032938558076004173');" onmouseout="out('5032938558076004173');" style="">  97      public boolean allowFetchActivityData(GBDevice device) {                                                      </span>
<span class="-8904227237820426841" onmouseenter="enter('-8904227237820426841');" onmouseout="out('-8904227237820426841');" style="">  98          return device.isInitialized() &amp;&amp; !device.isBusy() &amp;&amp; supportsActivityDataFetching();                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99      }                                                                                                             </span>
<span  style=""> 100                                                                                                                    </span>
<span class="-72396039432407750" onmouseenter="enter('-72396039432407750');" onmouseout="out('-72396039432407750');" style=""> 101      public boolean isHealthWearable(BluetoothDevice device) {                                                     </span>
<span class="3231480528462724625" onmouseenter="enter('3231480528462724625');" onmouseout="out('3231480528462724625');" style=""> 102          BluetoothClass bluetoothClass = device.getBluetoothClass();                                               </span>
<span class="-30808472190140405" onmouseenter="enter('-30808472190140405');" onmouseout="out('-30808472190140405');" style=""> 103          if (bluetoothClass == null) {                                                                             </span>
<span class="4138348823358409315" onmouseenter="enter('4138348823358409315');" onmouseout="out('4138348823358409315');" style=""> 104              LOG.warn(&quot;unable to determine bluetooth device class of &quot; + device);                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 105              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106          }                                                                                                         </span>
<span class="-858729263309297055" onmouseenter="enter('-858729263309297055');" onmouseout="out('-858729263309297055');" style=""> 107          if (bluetoothClass.getMajorDeviceClass() == BluetoothClass.Device.Major.WEARABLE                          </span>
<span class="2556881658902461803" onmouseenter="enter('2556881658902461803');" onmouseout="out('2556881658902461803');" style=""> 108              || bluetoothClass.getMajorDeviceClass() == BluetoothClass.Device.Major.UNCATEGORIZED) {               </span>
<span class="1671595227222781940" onmouseenter="enter('1671595227222781940');" onmouseout="out('1671595227222781940');" style=""> 109              int deviceClasses =                                                                                   </span>
<span class="-1146163008414071478" onmouseenter="enter('-1146163008414071478');" onmouseout="out('-1146163008414071478');" style=""> 110                      BluetoothClass.Device.HEALTH_BLOOD_PRESSURE                                                   </span>
<span class="6235589915448172621" onmouseenter="enter('6235589915448172621');" onmouseout="out('6235589915448172621');" style=""> 111                      | BluetoothClass.Device.HEALTH_DATA_DISPLAY                                                   </span>
<span class="-8276652658854527263" onmouseenter="enter('-8276652658854527263');" onmouseout="out('-8276652658854527263');" style=""> 112                      | BluetoothClass.Device.HEALTH_PULSE_RATE                                                     </span>
<span class="-3060079684210404996" onmouseenter="enter('-3060079684210404996');" onmouseout="out('-3060079684210404996');" style=""> 113                      | BluetoothClass.Device.HEALTH_WEIGHING                                                       </span>
<span class="7563771026288700463" onmouseenter="enter('7563771026288700463');" onmouseout="out('7563771026288700463');" style=""> 114                      | BluetoothClass.Device.HEALTH_UNCATEGORIZED                                                  </span>
<span class="5469110676853020998" onmouseenter="enter('5469110676853020998');" onmouseout="out('5469110676853020998');" style=""> 115                      | BluetoothClass.Device.HEALTH_PULSE_OXIMETER                                                 </span>
<span class="1786090042007026357" onmouseenter="enter('1786090042007026357');" onmouseout="out('1786090042007026357');" style=""> 116                      | BluetoothClass.Device.HEALTH_GLUCOSE;                                                       </span>
<span  style=""> 117                                                                                                                    </span>
<span class="925651856192218134" onmouseenter="enter('925651856192218134');" onmouseout="out('925651856192218134');" style=""> 118              return (bluetoothClass.getDeviceClass() &amp; deviceClasses) != 0;                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 120          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121      }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +    @Override                                                                                                     </span>
<span class="8516715393014815109" onmouseenter="enter('8516715393014815109');" onmouseout="out('8516715393014815109');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +    public boolean needsBackgroundWebView(GBDevice device) {                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +        return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="-2153024702397574105" onmouseenter="enter('-2153024702397574105');" onmouseout="out('-2153024702397574105');" style="">   1  /*  Copyright (C) 2015-2017 Carsten Pfeiffer                                                                      </span>
<span  style="">   2                                                                                                                    </span>
<span class="-7759499394858783956" onmouseenter="enter('-7759499394858783956');" onmouseout="out('-7759499394858783956');" style="">   3      This file is part of Gadgetbridge.                                                                            </span>
<span  style="">   4                                                                                                                    </span>
<span class="-2647557636279629478" onmouseenter="enter('-2647557636279629478');" onmouseout="out('-2647557636279629478');" style="">   5      Gadgetbridge is free software: you can redistribute it and/or modify                                          </span>
<span class="4878736751218581391" onmouseenter="enter('4878736751218581391');" onmouseout="out('4878736751218581391');" style="">   6      it under the terms of the GNU Affero General Public License as published                                      </span>
<span class="-5160078368722358920" onmouseenter="enter('-5160078368722358920');" onmouseout="out('-5160078368722358920');" style="">   7      by the Free Software Foundation, either version 3 of the License, or                                          </span>
<span class="6661789815760177463" onmouseenter="enter('6661789815760177463');" onmouseout="out('6661789815760177463');" style="">   8      (at your option) any later version.                                                                           </span>
<span  style="">   9                                                                                                                    </span>
<span class="-6828199977528779968" onmouseenter="enter('-6828199977528779968');" onmouseout="out('-6828199977528779968');" style="">  10      Gadgetbridge is distributed in the hope that it will be useful,                                               </span>
<span class="4883593508173597945" onmouseenter="enter('4883593508173597945');" onmouseout="out('4883593508173597945');" style="">  11      but WITHOUT ANY WARRANTY; without even the implied warranty of                                                </span>
<span class="2300657568347926527" onmouseenter="enter('2300657568347926527');" onmouseout="out('2300657568347926527');" style="">  12      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                                 </span>
<span class="4681049817175334681" onmouseenter="enter('4681049817175334681');" onmouseout="out('4681049817175334681');" style="">  13      GNU Affero General Public License for more details.                                                           </span>
<span  style="">  14                                                                                                                    </span>
<span class="-3235531360569947201" onmouseenter="enter('-3235531360569947201');" onmouseout="out('-3235531360569947201');" style="">  15      You should have received a copy of the GNU Affero General Public License                                      </span>
<span class="-3088444562895398794" onmouseenter="enter('-3088444562895398794');" onmouseout="out('-3088444562895398794');" style="">  16      along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. */                                      </span>
<span class="3135677453084526940" onmouseenter="enter('3135677453084526940');" onmouseout="out('3135677453084526940');" style="">  17  package nodomain.freeyourgadget.gadgetbridge.devices;                                                             </span>
<span  style="">  18                                                                                                                    </span>
<span class="-311917288644069537" onmouseenter="enter('-311917288644069537');" onmouseout="out('-311917288644069537');" style="">  19  import android.bluetooth.BluetoothClass;                                                                          </span>
<span class="2859895893394018468" onmouseenter="enter('2859895893394018468');" onmouseout="out('2859895893394018468');" style="">  20  import android.bluetooth.BluetoothDevice;                                                                         </span>
<span class="4786958806676392792" onmouseenter="enter('4786958806676392792');" onmouseout="out('4786958806676392792');" style="">  21  import android.bluetooth.le.ScanFilter;                                                                           </span>
<span class="-2370850629707943459" onmouseenter="enter('-2370850629707943459');" onmouseout="out('-2370850629707943459');" style="">  22  import android.support.annotation.NonNull;                                                                        </span>
<span  style="">  23                                                                                                                    </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  24  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  25  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  26                                                                                                                    </span>
<span class="-112105277767313938" onmouseenter="enter('-112105277767313938');" onmouseout="out('-112105277767313938');" style="">  27  import java.util.Collection;                                                                                      </span>
<span class="2187055016371707860" onmouseenter="enter('2187055016371707860');" onmouseout="out('2187055016371707860');" style="">  28  import java.util.Collections;                                                                                     </span>
<span  style="">  29                                                                                                                    </span>
<span class="-4354487052338529220" onmouseenter="enter('-4354487052338529220');" onmouseout="out('-4354487052338529220');" style="">  30  import de.greenrobot.dao.query.QueryBuilder;                                                                      </span>
<span class="-8113221927992302576" onmouseenter="enter('-8113221927992302576');" onmouseout="out('-8113221927992302576');" style="">  31  import nodomain.freeyourgadget.gadgetbridge.GBApplication;                                                        </span>
<span class="-1471644270559892265" onmouseenter="enter('-1471644270559892265');" onmouseout="out('-1471644270559892265');" style="">  32  import nodomain.freeyourgadget.gadgetbridge.GBException;                                                          </span>
<span class="6679513218772020996" onmouseenter="enter('6679513218772020996');" onmouseout="out('6679513218772020996');" style="">  33  import nodomain.freeyourgadget.gadgetbridge.database.DBHandler;                                                   </span>
<span class="4338650188295783318" onmouseenter="enter('4338650188295783318');" onmouseout="out('4338650188295783318');" style="">  34  import nodomain.freeyourgadget.gadgetbridge.database.DBHelper;                                                    </span>
<span class="804944882642105225" onmouseenter="enter('804944882642105225');" onmouseout="out('804944882642105225');" style="">  35  import nodomain.freeyourgadget.gadgetbridge.entities.DaoSession;                                                  </span>
<span class="4469307411224397441" onmouseenter="enter('4469307411224397441');" onmouseout="out('4469307411224397441');" style="">  36  import nodomain.freeyourgadget.gadgetbridge.entities.Device;                                                      </span>
<span class="-977151012090239476" onmouseenter="enter('-977151012090239476');" onmouseout="out('-977151012090239476');" style="">  37  import nodomain.freeyourgadget.gadgetbridge.entities.DeviceAttributesDao;                                         </span>
<span class="4836892992022606579" onmouseenter="enter('4836892992022606579');" onmouseout="out('4836892992022606579');" style="">  38  import nodomain.freeyourgadget.gadgetbridge.impl.GBDevice;                                                        </span>
<span class="-1351120908834620909" onmouseenter="enter('-1351120908834620909');" onmouseout="out('-1351120908834620909');" style="">  39  import nodomain.freeyourgadget.gadgetbridge.impl.GBDeviceCandidate;                                               </span>
<span  style="">  40                                                                                                                    </span>
<span class="-4230229064741158074" onmouseenter="enter('-4230229064741158074');" onmouseout="out('-4230229064741158074');" style="">  41  public abstract class AbstractDeviceCoordinator implements DeviceCoordinator {                                    </span>
<span class="1533308298984062740" onmouseenter="enter('1533308298984062740');" onmouseout="out('1533308298984062740');" style="">  42      private static final Logger LOG = LoggerFactory.getLogger(AbstractDeviceCoordinator.class);                   </span>
<span  style="">  43                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  44      @Override                                                                                                     </span>
<span class="-5773753981017336979" onmouseenter="enter('-5773753981017336979');" onmouseout="out('-5773753981017336979');" style="">  45      public final boolean supports(GBDeviceCandidate candidate) {                                                  </span>
<span class="-5193755579287929052" onmouseenter="enter('-5193755579287929052');" onmouseout="out('-5193755579287929052');" style="">  46          return getSupportedType(candidate).isSupported();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  47      }                                                                                                             </span>
<span  style="">  48                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  49      @Override                                                                                                     </span>
<span class="4078602725554603282" onmouseenter="enter('4078602725554603282');" onmouseout="out('4078602725554603282');" style="">  50      public boolean supports(GBDevice device) {                                                                    </span>
<span class="-5403859112831240356" onmouseenter="enter('-5403859112831240356');" onmouseout="out('-5403859112831240356');" style="">  51          return getDeviceType().equals(device.getType());                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  52      }                                                                                                             </span>
<span  style="">  53                                                                                                                    </span>
<span class="5154748246392482767" onmouseenter="enter('5154748246392482767');" onmouseout="out('5154748246392482767');" style="">  54      @NonNull                                                                                                      </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  55      @Override                                                                                                     </span>
<span class="1062073963528652044" onmouseenter="enter('1062073963528652044');" onmouseout="out('1062073963528652044');" style="">  56      public Collection&lt;? extends ScanFilter&gt; createBLEScanFilters() {                                              </span>
<span class="-6093315130064080899" onmouseenter="enter('-6093315130064080899');" onmouseout="out('-6093315130064080899');" style="">  57          return Collections.emptyList();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  58      }                                                                                                             </span>
<span  style="">  59                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  60      @Override                                                                                                     </span>
<span class="2107833060147006233" onmouseenter="enter('2107833060147006233');" onmouseout="out('2107833060147006233');" style="">  61      public GBDevice createDevice(GBDeviceCandidate candidate) {                                                   </span>
<span class="7068827190476029649" onmouseenter="enter('7068827190476029649');" onmouseout="out('7068827190476029649');" style="">  62          return new GBDevice(candidate.getDevice().getAddress(), candidate.getName(), getDeviceType());            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  63      }                                                                                                             </span>
<span  style="">  64                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  65      @Override                                                                                                     </span>
<span class="2456275557980692881" onmouseenter="enter('2456275557980692881');" onmouseout="out('2456275557980692881');" style="">  66      public void deleteDevice(final GBDevice gbDevice) throws GBException {                                        </span>
<span class="-2748439011794217767" onmouseenter="enter('-2748439011794217767');" onmouseout="out('-2748439011794217767');" style="">  67          LOG.info(&quot;will try to delete device: &quot; + gbDevice.getName());                                             </span>
<span class="-5483779301960408381" onmouseenter="enter('-5483779301960408381');" onmouseout="out('-5483779301960408381');" style="">  68          if (gbDevice.isConnected() || gbDevice.isConnecting()) {                                                  </span>
<span class="7347953572742694021" onmouseenter="enter('7347953572742694021');" onmouseout="out('7347953572742694021');" style="">  69              GBApplication.deviceService().disconnect();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70          }                                                                                                         </span>
<span class="8566685229205195929" onmouseenter="enter('8566685229205195929');" onmouseout="out('8566685229205195929');" style="">  71          try (DBHandler dbHandler = GBApplication.acquireDB()) {                                                   </span>
<span class="-5035264817263566539" onmouseenter="enter('-5035264817263566539');" onmouseout="out('-5035264817263566539');" style="">  72              DaoSession session = dbHandler.getDaoSession();                                                       </span>
<span class="7301165332090965101" onmouseenter="enter('7301165332090965101');" onmouseout="out('7301165332090965101');" style="">  73              Device device = DBHelper.findDevice(gbDevice, session);                                               </span>
<span class="-8372003146204379455" onmouseenter="enter('-8372003146204379455');" onmouseout="out('-8372003146204379455');" style="">  74              if (device != null) {                                                                                 </span>
<span class="2653457635170470666" onmouseenter="enter('2653457635170470666');" onmouseout="out('2653457635170470666');" style="">  75                  deleteDevice(gbDevice, device, session);                                                          </span>
<span class="-3608622048077556792" onmouseenter="enter('-3608622048077556792');" onmouseout="out('-3608622048077556792');" style="">  76                  QueryBuilder&lt;?&gt; qb = session.getDeviceAttributesDao().queryBuilder();                             </span>
<span class="-8958331783640360848" onmouseenter="enter('-8958331783640360848');" onmouseout="out('-8958331783640360848');" style=""><abbr title="  77                  qb.where(DeviceAttributesDao.Properties.DeviceId.eq(device.getId())).buildDelete().executeDeleteWithoutDetachingEntities();">  77                  qb.where(DeviceAttributesDao.Properties.DeviceId.eq(device.getId())).buildDelete().executeDeleteWiðŸ”µ</abbr></span>
<span class="5697251904061281905" onmouseenter="enter('5697251904061281905');" onmouseout="out('5697251904061281905');" style="">  78                  session.getDeviceDao().delete(device);                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  79              } else {                                                                                              </span>
<span class="5738091463814250523" onmouseenter="enter('5738091463814250523');" onmouseout="out('5738091463814250523');" style="">  80                  LOG.info(&quot;device to delete not found in db: &quot; + gbDevice);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="">  82          } catch (Exception e) {                                                                                   </span>
<span class="-6625841807606110692" onmouseenter="enter('-6625841807606110692');" onmouseout="out('-6625841807606110692');" style="">  83              throw new GBException(&quot;Error deleting device: &quot; + e.getMessage(), e);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85      }                                                                                                             </span>
<span  style="">  86                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  87      /**                                                                                                           </span>
<span class="8590530733634682184" onmouseenter="enter('8590530733634682184');" onmouseout="out('8590530733634682184');" style="">  88       * Hook for subclasses to perform device-specific deletion logic, e.g. db cleanup.                            </span>
<span class="-8983980441374315330" onmouseenter="enter('-8983980441374315330');" onmouseout="out('-8983980441374315330');" style="">  89       * @param gbDevice the GBDevice                                                                               </span>
<span class="3611176693110093725" onmouseenter="enter('3611176693110093725');" onmouseout="out('3611176693110093725');" style="">  90       * @param device the corresponding database Device                                                            </span>
<span class="5140805568250941919" onmouseenter="enter('5140805568250941919');" onmouseout="out('5140805568250941919');" style="">  91       * @param session the session to use                                                                          </span>
<span class="1173013685970588399" onmouseenter="enter('1173013685970588399');" onmouseout="out('1173013685970588399');" style="">  92       * @throws GBException                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  93       */                                                                                                           </span>
<span class="-3091409604540615006" onmouseenter="enter('-3091409604540615006');" onmouseout="out('-3091409604540615006');" style=""><abbr title="  94      protected abstract void deleteDevice(@NonNull GBDevice gbDevice, @NonNull Device device, @NonNull DaoSession session) throws GBException;">  94      protected abstract void deleteDevice(@NonNull GBDevice gbDevice, @NonNull Device device, @NonNull DaoSession sðŸ”µ</abbr></span>
<span  style="">  95                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  96      @Override                                                                                                     </span>
<span class="5032938558076004173" onmouseenter="enter('5032938558076004173');" onmouseout="out('5032938558076004173');" style="">  97      public boolean allowFetchActivityData(GBDevice device) {                                                      </span>
<span class="-8904227237820426841" onmouseenter="enter('-8904227237820426841');" onmouseout="out('-8904227237820426841');" style="">  98          return device.isInitialized() &amp;&amp; !device.isBusy() &amp;&amp; supportsActivityDataFetching();                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99      }                                                                                                             </span>
<span  style=""> 100                                                                                                                    </span>
<span class="-72396039432407750" onmouseenter="enter('-72396039432407750');" onmouseout="out('-72396039432407750');" style=""> 101      public boolean isHealthWearable(BluetoothDevice device) {                                                     </span>
<span class="3231480528462724625" onmouseenter="enter('3231480528462724625');" onmouseout="out('3231480528462724625');" style=""> 102          BluetoothClass bluetoothClass = device.getBluetoothClass();                                               </span>
<span class="-30808472190140405" onmouseenter="enter('-30808472190140405');" onmouseout="out('-30808472190140405');" style=""> 103          if (bluetoothClass == null) {                                                                             </span>
<span class="4138348823358409315" onmouseenter="enter('4138348823358409315');" onmouseout="out('4138348823358409315');" style=""> 104              LOG.warn(&quot;unable to determine bluetooth device class of &quot; + device);                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 105              return false;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106          }                                                                                                         </span>
<span class="-858729263309297055" onmouseenter="enter('-858729263309297055');" onmouseout="out('-858729263309297055');" style=""> 107          if (bluetoothClass.getMajorDeviceClass() == BluetoothClass.Device.Major.WEARABLE                          </span>
<span class="2556881658902461803" onmouseenter="enter('2556881658902461803');" onmouseout="out('2556881658902461803');" style=""> 108              || bluetoothClass.getMajorDeviceClass() == BluetoothClass.Device.Major.UNCATEGORIZED) {               </span>
<span class="1671595227222781940" onmouseenter="enter('1671595227222781940');" onmouseout="out('1671595227222781940');" style=""> 109              int deviceClasses =                                                                                   </span>
<span class="-1146163008414071478" onmouseenter="enter('-1146163008414071478');" onmouseout="out('-1146163008414071478');" style=""> 110                      BluetoothClass.Device.HEALTH_BLOOD_PRESSURE                                                   </span>
<span class="6235589915448172621" onmouseenter="enter('6235589915448172621');" onmouseout="out('6235589915448172621');" style=""> 111                      | BluetoothClass.Device.HEALTH_DATA_DISPLAY                                                   </span>
<span class="-8276652658854527263" onmouseenter="enter('-8276652658854527263');" onmouseout="out('-8276652658854527263');" style=""> 112                      | BluetoothClass.Device.HEALTH_PULSE_RATE                                                     </span>
<span class="-3060079684210404996" onmouseenter="enter('-3060079684210404996');" onmouseout="out('-3060079684210404996');" style=""> 113                      | BluetoothClass.Device.HEALTH_WEIGHING                                                       </span>
<span class="7563771026288700463" onmouseenter="enter('7563771026288700463');" onmouseout="out('7563771026288700463');" style=""> 114                      | BluetoothClass.Device.HEALTH_UNCATEGORIZED                                                  </span>
<span class="5469110676853020998" onmouseenter="enter('5469110676853020998');" onmouseout="out('5469110676853020998');" style=""> 115                      | BluetoothClass.Device.HEALTH_PULSE_OXIMETER                                                 </span>
<span class="1786090042007026357" onmouseenter="enter('1786090042007026357');" onmouseout="out('1786090042007026357');" style=""> 116                      | BluetoothClass.Device.HEALTH_GLUCOSE;                                                       </span>
<span  style=""> 117                                                                                                                    </span>
<span class="925651856192218134" onmouseenter="enter('925651856192218134');" onmouseout="out('925651856192218134');" style=""> 118              return (bluetoothClass.getDeviceClass() &amp; deviceClasses) != 0;                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119          }                                                                                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 120          return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121      }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +    @Override                                                                                                     </span>
<span class="-864084109100916389" onmouseenter="enter('-864084109100916389');" onmouseout="out('-864084109100916389');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +    public int getBondingStyle(GBDeviceCandidate deviceCandidate) {                                               </span>
<span class="936380115549042993" onmouseenter="enter('936380115549042993');" onmouseout="out('936380115549042993');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +        return BONDING_STYLE_ASK;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            