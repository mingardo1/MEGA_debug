<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>8</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    8
                    <a href="7.html">prev</a>
                    <a href="9.html">next</a>
                    <a href="8_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_1469ca1ceaae9c691eee7790de89a3ee1f571403_Aria/src/main/java/com/arialyy/aria/core/common/AbsThreadTask.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;1469ca1ceaae9c691eee7790de89a3ee1f571403:Aria/src/main/java/com/arialyy/aria/core/common/AbsThreadTask.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;1469ca1ceaae9c691eee7790de89a3ee1f571403^1:Aria/src/main/java/com/arialyy/aria/core/common/AbsThreadTask.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;1469ca1ceaae9c691eee7790de89a3ee1f571403^2:Aria/src/main/java/com/arialyy/aria/core/common/AbsThreadTask.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;39a43c836d3309cbbf82de6d51309fe71fc25292:Aria/src/main/java/com/arialyy/aria/core/common/AbsThreadTask.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bs], [bsj], [bsj], [bsj], [bsj], [bsj], [bs], [bsj], [bsj], [bsj], [bsj], [j], [j]], subset: [[bs], [bsj], [bsj], [bsj], [bsj], [bsj], [bj], [bsj], [bsj], [bsj], [bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16 package com.arialyy.aria.core.common;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="-6390350725830347024" onmouseenter="enter('-6390350725830347024');" onmouseout="out('-6390350725830347024');" style="">  18 import android.net.TrafficStats;                                                                         </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  19 import android.os.Bundle;                                                                                </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="">  20 import android.os.Handler;                                                                               </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="">  21 import android.os.Message;                                                                               </span>
<span class="3485143652294101472" onmouseenter="enter('3485143652294101472');" onmouseout="out('3485143652294101472');" style="">  22 import android.os.Process;                                                                               </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="">  23 import android.support.annotation.Nullable;                                                              </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  24 import com.arialyy.aria.core.AriaManager;                                                                </span>
<span class="-7940163229294156086" onmouseenter="enter('-7940163229294156086');" onmouseout="out('-7940163229294156086');" style="">  25 import com.arialyy.aria.core.config.BaseTaskConfig;                                                      </span>
<span class="-1126292087500355850" onmouseenter="enter('-1126292087500355850');" onmouseout="out('-1126292087500355850');" style="">  26 import com.arialyy.aria.core.config.DGroupConfig;                                                        </span>
<span class="1425241372324221776" onmouseenter="enter('1425241372324221776');" onmouseout="out('1425241372324221776');" style="">  27 import com.arialyy.aria.core.config.DownloadConfig;                                                      </span>
<span class="1322200574016778248" onmouseenter="enter('1322200574016778248');" onmouseout="out('1322200574016778248');" style="">  28 import com.arialyy.aria.core.config.UploadConfig;                                                        </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  29 import com.arialyy.aria.core.inf.AbsNormalEntity;                                                        </span>
<span class="8472156907075048576" onmouseenter="enter('8472156907075048576');" onmouseout="out('8472156907075048576');" style="">  30 import com.arialyy.aria.core.inf.AbsTaskWrapper;                                                         </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  31 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-1066657515660882744" onmouseenter="enter('-1066657515660882744');" onmouseout="out('-1066657515660882744');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import com.arialyy.aria.core.inf.ITaskWrapper;                                                           </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  33 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import com.arialyy.aria.exception.BaseException;                                                         </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  35 =======                                                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  36 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="5965657858743993748" onmouseenter="enter('5965657858743993748');" onmouseout="out('5965657858743993748');" style="">  37 import com.arialyy.aria.core.manager.ThreadTaskManager;                                                  </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="">  38 import com.arialyy.aria.exception.BaseException;                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  39 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="">  40 import com.arialyy.aria.util.BufferedRandomAccessFile;                                                   </span>
<span class="3933848313391255451" onmouseenter="enter('3933848313391255451');" onmouseout="out('3933848313391255451');" style="">  41 import com.arialyy.aria.util.ErrorHelp;                                                                  </span>
<span class="-3921447581486569047" onmouseenter="enter('-3921447581486569047');" onmouseout="out('-3921447581486569047');" style="">  42 import com.arialyy.aria.util.NetUtils;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  43 import java.io.File;                                                                                     </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  44 import java.util.UUID;                                                                                   </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  45 import java.util.concurrent.Callable;                                                                    </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  46 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  47 import java.util.concurrent.Executors;                                                                   </span>
<span  style="">  48                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  49 /**                                                                                                      </span>
<span class="-7798270031920764735" onmouseenter="enter('-7798270031920764735');" onmouseout="out('-7798270031920764735');" style="">  50  * Created by lyy on 2017/1/18. 任务线程                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  51  */                                                                                                      </span>
<span class="-2011608922755448217" onmouseenter="enter('-2011608922755448217');" onmouseout="out('-2011608922755448217');" style=""><abbr title="  52 public abstract class AbsThreadTask&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTITY&gt;&gt;">  52 public abstract class AbsThreadTask&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;E🔵</abbr></span>
<span class="6675695936259737122" onmouseenter="enter('6675695936259737122');" onmouseout="out('6675695936259737122');" style="">  53     implements Callable&lt;AbsThreadTask&gt; {                                                                 </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  54   /**                                                                                                    </span>
<span class="-7421905703818920776" onmouseenter="enter('-7421905703818920776');" onmouseout="out('-7421905703818920776');" style="">  55    * 线程重试次数                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  56    */                                                                                                    </span>
<span class="2534354069603331424" onmouseenter="enter('2534354069603331424');" onmouseout="out('2534354069603331424');" style="">  57   private final int RETRY_NUM = 2;                                                                       </span>
<span  style="">  58                                                                                                          </span>
<span class="-6736605921341736924" onmouseenter="enter('-6736605921341736924');" onmouseout="out('-6736605921341736924');" style="">  59   private final String TAG = &quot;AbsThreadTask&quot;;                                                            </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  60   /**                                                                                                    </span>
<span class="5912262818254969140" onmouseenter="enter('5912262818254969140');" onmouseout="out('5912262818254969140');" style="">  61    * 当前子线程相对于总长度的位置                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  62    */                                                                                                    </span>
<span class="-6555994287222304012" onmouseenter="enter('-6555994287222304012');" onmouseout="out('-6555994287222304012');" style="">  63   protected long mChildCurrentLocation = 0;                                                              </span>
<span class="199695981196763510" onmouseenter="enter('199695981196763510');" onmouseout="out('199695981196763510');" style="">  64   private ENTITY mEntity;                                                                                </span>
<span class="4507751527304947270" onmouseenter="enter('4507751527304947270');" onmouseout="out('4507751527304947270');" style="">  65   protected TASK_WRAPPER mTaskWrapper;                                                                   </span>
<span class="7823640971996835282" onmouseenter="enter('7823640971996835282');" onmouseout="out('7823640971996835282');" style="">  66   private int mFailTimes = 0;                                                                            </span>
<span class="-2140378055800192500" onmouseenter="enter('-2140378055800192500');" onmouseout="out('-2140378055800192500');" style="">  67   private long mLastSaveTime;                                                                            </span>
<span class="7052955590557645990" onmouseenter="enter('7052955590557645990');" onmouseout="out('7052955590557645990');" style="">  68   private ExecutorService mConfigThreadPool;                                                             </span>
<span class="4205150814631290032" onmouseenter="enter('4205150814631290032');" onmouseout="out('4205150814631290032');" style="">  69   private boolean isNotNetRetry;  //断网情况是否重试                                                             </span>
<span class="-1742305716471965576" onmouseenter="enter('-1742305716471965576');" onmouseout="out('-1742305716471965576');" style="">  70   private boolean taskBreak = false;  //任务跳出                                                             </span>
<span class="7265458021260352388" onmouseenter="enter('7265458021260352388');" onmouseout="out('7265458021260352388');" style="">  71   protected BandwidthLimiter mSpeedBandUtil; //速度限制工具                                                    </span>
<span class="2782655601744072115" onmouseenter="enter('2782655601744072115');" onmouseout="out('2782655601744072115');" style="">  72   protected AriaManager mAridManager;                                                                    </span>
<span class="4110495559709840165" onmouseenter="enter('4110495559709840165');" onmouseout="out('4110495559709840165');" style="">  73   private boolean isInterrupted = false;                                                                 </span>
<span class="8034502532514277404" onmouseenter="enter('8034502532514277404');" onmouseout="out('8034502532514277404');" style="">  74   protected boolean isCancel = false, isStop = false;                                                    </span>
<span class="-161749363286472354" onmouseenter="enter('-161749363286472354');" onmouseout="out('-161749363286472354');" style="">  75   protected ThreadRecord mRecord;                                                                        </span>
<span class="8505538020780181250" onmouseenter="enter('8505538020780181250');" onmouseout="out('8505538020780181250');" style="">  76   private Handler mStateHandler;                                                                         </span>
<span class="-644453640718072602" onmouseenter="enter('-644453640718072602');" onmouseout="out('-644453640718072602');" style="">  77   private SubThreadConfig&lt;TASK_WRAPPER&gt; mConfig;                                                         </span>
<span  style="">  78                                                                                                          </span>
<span class="7317290166143616056" onmouseenter="enter('7317290166143616056');" onmouseout="out('7317290166143616056');" style="">  79   private Thread mConfigThread = new Thread(new Runnable() {                                             </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="">  80     @Override public void run() {                                                                        </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style="">  81       Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                     </span>
<span class="-5942055588561434981" onmouseenter="enter('-5942055588561434981');" onmouseout="out('-5942055588561434981');" style="">  82       final long currentTemp = mChildCurrentLocation;                                                    </span>
<span class="-8339432453951329407" onmouseenter="enter('-8339432453951329407');" onmouseout="out('-8339432453951329407');" style="">  83       writeConfig(false, currentTemp);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84     }                                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">  85   });                                                                                                    </span>
<span  style="">  86                                                                                                          </span>
<span class="-5675375355167610812" onmouseenter="enter('-5675375355167610812');" onmouseout="out('-5675375355167610812');" style="">  87   protected AbsThreadTask(SubThreadConfig&lt;TASK_WRAPPER&gt; config) {                                        </span>
<span class="-3079299502940909127" onmouseenter="enter('-3079299502940909127');" onmouseout="out('-3079299502940909127');" style="">  88     mConfig = config;                                                                                    </span>
<span class="7608526317231191360" onmouseenter="enter('7608526317231191360');" onmouseout="out('7608526317231191360');" style="">  89     mTaskWrapper = config.taskWrapper;                                                                   </span>
<span class="-9095243370238004613" onmouseenter="enter('-9095243370238004613');" onmouseout="out('-9095243370238004613');" style="">  90     mRecord = config.record;                                                                             </span>
<span class="2077392471576236354" onmouseenter="enter('2077392471576236354');" onmouseout="out('2077392471576236354');" style="">  91     mStateHandler = config.stateHandler;                                                                 </span>
<span class="-7408997685265206061" onmouseenter="enter('-7408997685265206061');" onmouseout="out('-7408997685265206061');" style="">  92     mEntity = mTaskWrapper.getEntity();                                                                  </span>
<span class="8631807426761684047" onmouseenter="enter('8631807426761684047');" onmouseout="out('8631807426761684047');" style="">  93     mLastSaveTime = System.currentTimeMillis();                                                          </span>
<span class="-6975975484715567483" onmouseenter="enter('-6975975484715567483');" onmouseout="out('-6975975484715567483');" style="">  94     mConfigThreadPool = Executors.newCachedThreadPool();                                                 </span>
<span class="1199175373698646667" onmouseenter="enter('1199175373698646667');" onmouseout="out('1199175373698646667');" style="">  95     mAridManager = AriaManager.getInstance(AriaManager.APP);                                             </span>
<span class="-8585141996075500857" onmouseenter="enter('-8585141996075500857');" onmouseout="out('-8585141996075500857');" style="">  96     if (getMaxSpeed() &gt; 0) {                                                                             </span>
<span class="2630549456901300935" onmouseenter="enter('2630549456901300935');" onmouseout="out('2630549456901300935');" style="">  97       mSpeedBandUtil = new BandwidthLimiter(getMaxSpeed(), config.startThreadNum);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98     }                                                                                                    </span>
<span class="-2615274212376114043" onmouseenter="enter('-2615274212376114043');" onmouseout="out('-2615274212376114043');" style="">  99     isNotNetRetry = mAridManager.getAppConfig().isNotNetRetry();                                         </span>
<span class="-9180213342108359819" onmouseenter="enter('-9180213342108359819');" onmouseout="out('-9180213342108359819');" style=""> 100     mChildCurrentLocation = mRecord.startLocation;                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101   }                                                                                                      </span>
<span  style=""> 102                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 103   /**                                                                                                    </span>
<span class="-8737617058794341165" onmouseenter="enter('-8737617058794341165');" onmouseout="out('-8737617058794341165');" style=""> 104    * 当前线程处理的文件名                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 105    */                                                                                                    </span>
<span class="7302389212643046972" onmouseenter="enter('7302389212643046972');" onmouseout="out('7302389212643046972');" style=""> 106   protected String getFileName() {                                                                       </span>
<span class="4833117926548008502" onmouseenter="enter('4833117926548008502');" onmouseout="out('4833117926548008502');" style=""> 107     return mConfig.tempFile.getName();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108   }                                                                                                      </span>
<span  style=""> 109                                                                                                          </span>
<span class="-3759066779726210536" onmouseenter="enter('-3759066779726210536');" onmouseout="out('-3759066779726210536');" style=""> 110   protected SubThreadConfig&lt;TASK_WRAPPER&gt; getConfig() {                                                  </span>
<span class="-7756481640167229217" onmouseenter="enter('-7756481640167229217');" onmouseout="out('-7756481640167229217');" style=""> 111     return mConfig;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112   }                                                                                                      </span>
<span  style=""> 113                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 114   /**                                                                                                    </span>
<span class="1636797617085164081" onmouseenter="enter('1636797617085164081');" onmouseout="out('1636797617085164081');" style=""> 115    * 设置线程是否中断                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 116    *                                                                                                     </span>
<span class="6061025491082520720" onmouseenter="enter('6061025491082520720');" onmouseout="out('6061025491082520720');" style=""> 117    * @param isInterrupted {@code true} 中断                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 118    */                                                                                                    </span>
<span class="-3489753654187641055" onmouseenter="enter('-3489753654187641055');" onmouseout="out('-3489753654187641055');" style=""> 119   public void setInterrupted(boolean isInterrupted) {                                                    </span>
<span class="3679723848447236272" onmouseenter="enter('3679723848447236272');" onmouseout="out('3679723848447236272');" style=""> 120     this.isInterrupted = isInterrupted;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121   }                                                                                                      </span>
<span  style=""> 122                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 123   /**                                                                                                    </span>
<span class="-9093294427063192169" onmouseenter="enter('-9093294427063192169');" onmouseout="out('-9093294427063192169');" style=""> 124    * 线程是否存活                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 125    *                                                                                                     </span>
<span class="-4472564326041631774" onmouseenter="enter('-4472564326041631774');" onmouseout="out('-4472564326041631774');" style=""> 126    * @return {@code true}存活                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 127    */                                                                                                    </span>
<span class="5343971881214349340" onmouseenter="enter('5343971881214349340');" onmouseout="out('5343971881214349340');" style=""> 128   protected boolean isLive() {                                                                           </span>
<span class="5056984206620082489" onmouseenter="enter('5056984206620082489');" onmouseout="out('5056984206620082489');" style=""> 129     return !Thread.currentThread().isInterrupted() &amp;&amp; !isInterrupted;                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130   }                                                                                                      </span>
<span  style=""> 131                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 132   /**                                                                                                    </span>
<span class="-1407135870976300" onmouseenter="enter('-1407135870976300');" onmouseout="out('-1407135870976300');" style=""> 133    * 当前线程是否完成，对于不支持断点的任务，一律未完成 {@code true} 完成；{@code false} 未完成                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 134    */                                                                                                    </span>
<span class="-5985760820188647103" onmouseenter="enter('-5985760820188647103');" onmouseout="out('-5985760820188647103');" style=""> 135   boolean isThreadComplete() {                                                                           </span>
<span class="-5832476025614563785" onmouseenter="enter('-5832476025614563785');" onmouseout="out('-5832476025614563785');" style=""> 136     return mRecord.isComplete;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137   }                                                                                                      </span>
<span  style=""> 138                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 139   /**                                                                                                    </span>
<span class="4246443053284865110" onmouseenter="enter('4246443053284865110');" onmouseout="out('4246443053284865110');" style=""> 140    * 获取实体                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 141    */                                                                                                    </span>
<span class="-2158320671868788574" onmouseenter="enter('-2158320671868788574');" onmouseout="out('-2158320671868788574');" style=""> 142   protected ENTITY getEntity() {                                                                         </span>
<span class="-2978486956956616380" onmouseenter="enter('-2978486956956616380');" onmouseout="out('-2978486956956616380');" style=""> 143     return mEntity;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144   }                                                                                                      </span>
<span  style=""> 145                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 146   /**                                                                                                    </span>
<span class="-6696632762627304447" onmouseenter="enter('-6696632762627304447');" onmouseout="out('-6696632762627304447');" style=""> 147    * 获取任务驱动对象                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 148    */                                                                                                    </span>
<span class="-7465189499125296678" onmouseenter="enter('-7465189499125296678');" onmouseout="out('-7465189499125296678');" style=""> 149   protected TASK_WRAPPER getTaskWrapper() {                                                              </span>
<span class="-6199220384104149910" onmouseenter="enter('-6199220384104149910');" onmouseout="out('-6199220384104149910');" style=""> 150     return mTaskWrapper;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151   }                                                                                                      </span>
<span  style=""> 152                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 153   /**                                                                                                    </span>
<span class="-8261306668739895881" onmouseenter="enter('-8261306668739895881');" onmouseout="out('-8261306668739895881');" style=""> 154    * 获取配置的最大上传/下载速度                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 155    *                                                                                                     </span>
<span class="5179376621123361386" onmouseenter="enter('5179376621123361386');" onmouseout="out('5179376621123361386');" style=""> 156    * @return 单位为：kb                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 157    */                                                                                                    </span>
<span class="-896115242554653093" onmouseenter="enter('-896115242554653093');" onmouseout="out('-896115242554653093');" style=""> 158   public abstract int getMaxSpeed();                                                                     </span>
<span  style=""> 159                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 160   /**                                                                                                    </span>
<span class="-7476262045555684443" onmouseenter="enter('-7476262045555684443');" onmouseout="out('-7476262045555684443');" style=""> 161    * 读取任务配置                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 162    *                                                                                                     </span>
<span class="2765744486349037181" onmouseenter="enter('2765744486349037181');" onmouseout="out('2765744486349037181');" style=""> 163    * @return {@link DownloadConfig}、{@link UploadConfig}、{@link DGroupConfig}                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 164    */                                                                                                    </span>
<span class="8843669963162911719" onmouseenter="enter('8843669963162911719');" onmouseout="out('8843669963162911719');" style=""> 165   protected abstract BaseTaskConfig getTaskConfig();                                                     </span>
<span  style=""> 166                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 167   /**                                                                                                    </span>
<span class="-440811555959535495" onmouseenter="enter('-440811555959535495');" onmouseout="out('-440811555959535495');" style=""> 168    * 设置最大下载速度                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 169    *                                                                                                     </span>
<span class="-1508955734956367613" onmouseenter="enter('-1508955734956367613');" onmouseout="out('-1508955734956367613');" style=""> 170    * @param speed 单位为：kb                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 171    */                                                                                                    </span>
<span class="-8974735338639184772" onmouseenter="enter('-8974735338639184772');" onmouseout="out('-8974735338639184772');" style=""> 172   public void setMaxSpeed(int speed) {                                                                   </span>
<span class="-649773427560821140" onmouseenter="enter('-649773427560821140');" onmouseout="out('-649773427560821140');" style=""> 173     if (mSpeedBandUtil != null) {                                                                        </span>
<span class="-7563158316316320789" onmouseenter="enter('-7563158316316320789');" onmouseout="out('-7563158316316320789');" style=""> 174       mSpeedBandUtil.setMaxRate(speed / mConfig.startThreadNum);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176   }                                                                                                      </span>
<span  style=""> 177                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 178   /**                                                                                                    </span>
<span class="6599720418575337619" onmouseenter="enter('6599720418575337619');" onmouseout="out('6599720418575337619');" style=""> 179    * 中断任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 180    */                                                                                                    </span>
<span class="4561569160041136245" onmouseenter="enter('4561569160041136245');" onmouseout="out('4561569160041136245');" style=""> 181   void breakTask() {                                                                                     </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 182     synchronized (AriaManager.LOCK) {                                                                    </span>
<span class="-3099491134649143832" onmouseenter="enter('-3099491134649143832');" onmouseout="out('-3099491134649143832');" style=""> 183       taskBreak = true;                                                                                  </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style=""> 184       if (mTaskWrapper.isSupportBP()) {                                                                  </span>
<span class="-5942055588561434981" onmouseenter="enter('-5942055588561434981');" onmouseout="out('-5942055588561434981');" style=""> 185         final long currentTemp = mChildCurrentLocation;                                                  </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 186 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="2043705367433474739" onmouseenter="enter('2043705367433474739');" onmouseout="out('2043705367433474739');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 187         sendState(IThreadState.STATE_STOP, null);                                                        </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 188 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189    */                                                                                                    </span>
<span class="-8974735338639184772" onmouseenter="enter('-8974735338639184772');" onmouseout="out('-8974735338639184772');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190   public void setMaxSpeed(int speed) {                                                                   </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 191 =======                                                                                                  </span>
<span class="4384426906541737800" onmouseenter="enter('4384426906541737800');" onmouseout="out('4384426906541737800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192         sendState(ThreadStateManager.STATE_STOP, null);                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 193 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="6146956303290790721" onmouseenter="enter('6146956303290790721');" onmouseout="out('6146956303290790721');" style=""> 194         ALog.d(TAG, String.format(&quot;任务【%s】thread__%s__中断【停止位置：%s】&quot;, getFileName(),                        </span>
<span class="376922911421079876" onmouseenter="enter('376922911421079876');" onmouseout="out('376922911421079876');" style=""> 195             mRecord.threadId, currentTemp));                                                             </span>
<span class="-8339432453951329407" onmouseenter="enter('-8339432453951329407');" onmouseout="out('-8339432453951329407');" style=""> 196         writeConfig(false, currentTemp);                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 197       } else {                                                                                           </span>
<span class="-2549462388866091673" onmouseenter="enter('-2549462388866091673');" onmouseout="out('-2549462388866091673');" style=""> 198         ALog.i(TAG, String.format(&quot;任务【%s】已中断&quot;, getFileName()));                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201   }                                                                                                      </span>
<span  style=""> 202                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 203   /**                                                                                                    </span>
<span class="5256203714917913991" onmouseenter="enter('5256203714917913991');" onmouseout="out('5256203714917913991');" style=""> 204    * 发送状态给状态处理器                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 205    *                                                                                                     </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 206 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-8049878616952568950" onmouseenter="enter('-8049878616952568950');" onmouseout="out('-8049878616952568950');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 207    * @param state {@link IThreadState#STATE_STOP}..                                                      </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 208 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="5006934068411751005" onmouseenter="enter('5006934068411751005');" onmouseout="out('5006934068411751005');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209       if (getConfig().SUPPORT_BP) {                                                                      </span>
<span class="-5942055588561434981" onmouseenter="enter('-5942055588561434981');" onmouseout="out('-5942055588561434981');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210         final long currentTemp = mChildCurrentLocation;                                                  </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 211 =======                                                                                                  </span>
<span class="-4769173749986063162" onmouseenter="enter('-4769173749986063162');" onmouseout="out('-4769173749986063162');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212    * @param state {@link ThreadStateManager#STATE_STOP}..                                                </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 213 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-4152917228807143386" onmouseenter="enter('-4152917228807143386');" onmouseout="out('-4152917228807143386');" style=""> 214    * @param bundle 而外数据                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 215    */                                                                                                    </span>
<span class="107634412995640864" onmouseenter="enter('107634412995640864');" onmouseout="out('107634412995640864');" style=""> 216   void sendState(int state, @Nullable Bundle bundle) {                                                   </span>
<span class="5312338573559356541" onmouseenter="enter('5312338573559356541');" onmouseout="out('5312338573559356541');" style=""> 217     Message msg = mStateHandler.obtainMessage();                                                         </span>
<span class="4586264514118761504" onmouseenter="enter('4586264514118761504');" onmouseout="out('4586264514118761504');" style=""> 218     msg.what = state;                                                                                    </span>
<span class="-3154970297737940190" onmouseenter="enter('-3154970297737940190');" onmouseout="out('-3154970297737940190');" style=""> 219     if (bundle != null) {                                                                                </span>
<span class="-5836915540506052451" onmouseenter="enter('-5836915540506052451');" onmouseout="out('-5836915540506052451');" style=""> 220       msg.setData(bundle);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221     }                                                                                                    </span>
<span class="-656061765258294758" onmouseenter="enter('-656061765258294758');" onmouseout="out('-656061765258294758');" style=""> 222     msg.sendToTarget();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223   }                                                                                                      </span>
<span  style=""> 224                                                                                                          </span>
<span class="5908327854870228087" onmouseenter="enter('5908327854870228087');" onmouseout="out('5908327854870228087');" style=""> 225   public boolean isInterrupted() {                                                                       </span>
<span class="-5203528151312862013" onmouseenter="enter('-5203528151312862013');" onmouseout="out('-5203528151312862013');" style=""> 226     return Thread.currentThread().isInterrupted();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227   }                                                                                                      </span>
<span  style=""> 228                                                                                                          </span>
<span class="-9198262987019797851" onmouseenter="enter('-9198262987019797851');" onmouseout="out('-9198262987019797851');" style=""> 229   @Override protected void finalize() throws Throwable {                                                 </span>
<span class="4114196779073131595" onmouseenter="enter('4114196779073131595');" onmouseout="out('4114196779073131595');" style=""> 230     super.finalize();                                                                                    </span>
<span class="-7477286483889370682" onmouseenter="enter('-7477286483889370682');" onmouseout="out('-7477286483889370682');" style=""> 231     if (mConfigThreadPool != null) {                                                                     </span>
<span class="6755739129057127055" onmouseenter="enter('6755739129057127055');" onmouseout="out('6755739129057127055');" style=""> 232       mConfigThreadPool.shutdown();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234   }                                                                                                      </span>
<span  style=""> 235                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 236   /**                                                                                                    </span>
<span class="4258051666929748339" onmouseenter="enter('4258051666929748339');" onmouseout="out('4258051666929748339');" style=""> 237    * 任务是否中断，中断条件： 1、任务取消 2、任务停止 3、手动中断 {@link #taskBreak}                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 238    *                                                                                                     </span>
<span class="8685725000128107952" onmouseenter="enter('8685725000128107952');" onmouseout="out('8685725000128107952');" style=""> 239    * @return {@code true} 中断，{@code false} 不是中断                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 240    */                                                                                                    </span>
<span class="1192236408818642919" onmouseenter="enter('1192236408818642919');" onmouseout="out('1192236408818642919');" style=""> 241   protected boolean isBreak() {                                                                          </span>
<span class="6435844081899071775" onmouseenter="enter('6435844081899071775');" onmouseout="out('6435844081899071775');" style=""> 242     return isCancel || isStop || taskBreak;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243   }                                                                                                      </span>
<span  style=""> 244                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 245   /**                                                                                                    </span>
<span class="-4436630274060532850" onmouseenter="enter('-4436630274060532850');" onmouseout="out('-4436630274060532850');" style=""> 246    * 检查下载完成的分块大小，如果下载完成的分块大小大于或小于分配的大小，则需要重新下载该分块 如果是非分块任务，直接返回{@code true}                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 247    *                                                                                                     </span>
<span class="-5962632420674681636" onmouseenter="enter('-5962632420674681636');" onmouseout="out('-5962632420674681636');" style=""> 248    * @return {@code true} 分块分大小正常，{@code false} 分块大小错误                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 249    */                                                                                                    </span>
<span class="-1715939541580522304" onmouseenter="enter('-1715939541580522304');" onmouseout="out('-1715939541580522304');" style=""> 250   protected boolean checkBlock() {                                                                       </span>
<span class="-8255347005712765724" onmouseenter="enter('-8255347005712765724');" onmouseout="out('-8255347005712765724');" style=""> 251     if (!mConfig.isBlock) {                                                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 252       return true;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253     }                                                                                                    </span>
<span class="3935656399577463427" onmouseenter="enter('3935656399577463427');" onmouseout="out('3935656399577463427');" style=""> 254     File blockFile = mConfig.tempFile;                                                                   </span>
<span class="-1695353633342038156" onmouseenter="enter('-1695353633342038156');" onmouseout="out('-1695353633342038156');" style=""> 255     if (!blockFile.exists() || blockFile.length() != mRecord.blockLen) {                                 </span>
<span class="-3869098922257348244" onmouseenter="enter('-3869098922257348244');" onmouseout="out('-3869098922257348244');" style=""> 256       ALog.i(TAG,                                                                                        </span>
<span class="-4253990883383800149" onmouseenter="enter('-4253990883383800149');" onmouseout="out('-4253990883383800149');" style=""> 257           String.format(&quot;分块【%s】错误，blockFileLen: %s, threadRect: %s; 即将重新下载该分块，开始位置：%s，结束位置：%s&quot;,          </span>
<span class="2939919814588467615" onmouseenter="enter('2939919814588467615');" onmouseout="out('2939919814588467615');" style=""> 258               blockFile.getName(), blockFile.length(), mRecord.blockLen, mRecord.startLocation,          </span>
<span class="7451819391210675610" onmouseenter="enter('7451819391210675610');" onmouseout="out('7451819391210675610');" style=""> 259               mRecord.endLocation));                                                                     </span>
<span class="-3823857485302692882" onmouseenter="enter('-3823857485302692882');" onmouseout="out('-3823857485302692882');" style=""> 260       if (blockFile.exists()) {                                                                          </span>
<span class="-8675830801645990020" onmouseenter="enter('-8675830801645990020');" onmouseout="out('-8675830801645990020');" style=""> 261         blockFile.delete();                                                                              </span>
<span class="2945539549828015550" onmouseenter="enter('2945539549828015550');" onmouseout="out('2945539549828015550');" style=""> 262         ALog.i(TAG, String.format(&quot;删除分块【%s】成功&quot;, blockFile.getName()));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263       }                                                                                                  </span>
<span class="-6720013085559771010" onmouseenter="enter('-6720013085559771010');" onmouseout="out('-6720013085559771010');" style=""> 264       retryThis(isBreak());                                                                              </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 265       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 267     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268   }                                                                                                      </span>
<span  style=""> 269                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 270   /**                                                                                                    </span>
<span class="-7882741939763414839" onmouseenter="enter('-7882741939763414839');" onmouseout="out('-7882741939763414839');" style=""> 271    * 停止任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 272    */                                                                                                    </span>
<span class="-1831798800985246753" onmouseenter="enter('-1831798800985246753');" onmouseout="out('-1831798800985246753');" style=""> 273   public void stop() {                                                                                   </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 274     synchronized (AriaManager.LOCK) {                                                                    </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style=""> 275       isStop = true;                                                                                     </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style=""> 276       if (mTaskWrapper.isSupportBP()) {                                                                  </span>
<span class="3999428278528562375" onmouseenter="enter('3999428278528562375');" onmouseout="out('3999428278528562375');" style=""> 277         final long stopLocation = mChildCurrentLocation;                                                 </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 278 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="2043705367433474739" onmouseenter="enter('2043705367433474739');" onmouseout="out('2043705367433474739');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 279         sendState(IThreadState.STATE_STOP, null);                                                        </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 280 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281       }                                                                                                  </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282       return true;                                                                                       </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 283 =======                                                                                                  </span>
<span class="4384426906541737800" onmouseenter="enter('4384426906541737800');" onmouseout="out('4384426906541737800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284         sendState(ThreadStateManager.STATE_STOP, null);                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 285 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style=""> 286         ALog.d(TAG,                                                                                      </span>
<span class="1550861091873015536" onmouseenter="enter('1550861091873015536');" onmouseout="out('1550861091873015536');" style=""> 287             String.format(&quot;任务【%s】thread__%s__停止【当前线程停止位置：%s】&quot;, getFileName(),                            </span>
<span class="-867220232156674741" onmouseenter="enter('-867220232156674741');" onmouseout="out('-867220232156674741');" style=""> 288                 mRecord.threadId, stopLocation));                                                        </span>
<span class="7792260418457311232" onmouseenter="enter('7792260418457311232');" onmouseout="out('7792260418457311232');" style=""> 289         writeConfig(false, stopLocation);                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 290       } else {                                                                                           </span>
<span class="-8753703196049872436" onmouseenter="enter('-8753703196049872436');" onmouseout="out('-8753703196049872436');" style=""> 291         ALog.i(TAG, String.format(&quot;任务【%s】已停止&quot;, getFileName()));                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 292 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="2043705367433474739" onmouseenter="enter('2043705367433474739');" onmouseout="out('2043705367433474739');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 293         sendState(IThreadState.STATE_STOP, null);                                                        </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 294 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295   /**                                                                                                    </span>
<span class="-4436630274060532850" onmouseenter="enter('-4436630274060532850');" onmouseout="out('-4436630274060532850');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296    * 检查下载完成的分块大小，如果下载完成的分块大小大于或小于分配的大小，则需要重新下载该分块 如果是非分块任务，直接返回{@code true}                              </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 297 =======                                                                                                  </span>
<span class="4384426906541737800" onmouseenter="enter('4384426906541737800');" onmouseout="out('4384426906541737800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298         sendState(ThreadStateManager.STATE_STOP, null);                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 299 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302   }                                                                                                      </span>
<span  style=""> 303                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 304   /**                                                                                                    </span>
<span class="7873398811029444044" onmouseenter="enter('7873398811029444044');" onmouseout="out('7873398811029444044');" style=""> 305    * 执行中                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 306    */                                                                                                    </span>
<span class="7428157636721718570" onmouseenter="enter('7428157636721718570');" onmouseout="out('7428157636721718570');" style=""> 307   protected void progress(long len) {                                                                    </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 308     synchronized (AriaManager.LOCK) {                                                                    </span>
<span class="2533028217200451003" onmouseenter="enter('2533028217200451003');" onmouseout="out('2533028217200451003');" style=""> 309       //if (getState().CURRENT_LOCATION &gt; getEntity().getFileSize() &amp;&amp; !getTaskWrapper().asHttp()        </span>
<span class="-1186412116255119268" onmouseenter="enter('-1186412116255119268');" onmouseout="out('-1186412116255119268');" style=""> 310       //    .isChunked()) {                                                                              </span>
<span class="-4532666615131915740" onmouseenter="enter('-4532666615131915740');" onmouseout="out('-4532666615131915740');" style=""> 311       //  String errorMsg =                                                                              </span>
<span class="518171698288030827" onmouseenter="enter('518171698288030827');" onmouseout="out('518171698288030827');" style=""> 312       //      String.format(&quot;下载失败，下载长度超出文件真实长度；currentLocation=%s, fileSize=%s&quot;,                         </span>
<span class="-3066839761455073570" onmouseenter="enter('-3066839761455073570');" onmouseout="out('-3066839761455073570');" style=""> 313       //          getState().CURRENT_LOCATION,                                                           </span>
<span class="-4715215170271404042" onmouseenter="enter('-4715215170271404042');" onmouseout="out('-4715215170271404042');" style=""> 314       //          getEntity().getFileSize());                                                            </span>
<span class="3035606892929688966" onmouseenter="enter('3035606892929688966');" onmouseout="out('3035606892929688966');" style=""> 315       //  taskBreak = true;                                                                              </span>
<span class="5067342317456439021" onmouseenter="enter('5067342317456439021');" onmouseout="out('5067342317456439021');" style=""> 316       //  fail(mChildCurrentLocation, new FileException(TAG, errorMsg), false);                          </span>
<span class="3500611444781325819" onmouseenter="enter('3500611444781325819');" onmouseout="out('3500611444781325819');" style=""> 317       //  return;                                                                                        </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style=""> 318       //}                                                                                                </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style=""> 319       mChildCurrentLocation += len;                                                                      </span>
<span class="-6345084862948761327" onmouseenter="enter('-6345084862948761327');" onmouseout="out('-6345084862948761327');" style=""> 320       if (!mStateHandler.getLooper().getThread().isAlive()) {                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 321         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322       }                                                                                                  </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 323 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-5752277786740261730" onmouseenter="enter('-5752277786740261730');" onmouseout="out('-5752277786740261730');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 324       mStateHandler.obtainMessage(IThreadState.STATE_RUNNING, len).sendToTarget();                       </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 325 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 328 =======                                                                                                  </span>
<span class="7039631086012701451" onmouseenter="enter('7039631086012701451');" onmouseout="out('7039631086012701451');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 329       mStateHandler.obtainMessage(ThreadStateManager.STATE_RUNNING, len).sendToTarget();                 </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 330 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="8466413356993225320" onmouseenter="enter('8466413356993225320');" onmouseout="out('8466413356993225320');" style=""> 331       if (System.currentTimeMillis() - mLastSaveTime &gt; 5000                                              </span>
<span class="-4608803573017792643" onmouseenter="enter('-4608803573017792643');" onmouseout="out('-4608803573017792643');" style=""> 332           &amp;&amp; mChildCurrentLocation &lt; mRecord.endLocation) {                                              </span>
<span class="8631807426761684047" onmouseenter="enter('8631807426761684047');" onmouseout="out('8631807426761684047');" style=""> 333         mLastSaveTime = System.currentTimeMillis();                                                      </span>
<span class="6892340968550800051" onmouseenter="enter('6892340968550800051');" onmouseout="out('6892340968550800051');" style=""> 334         if (!mConfigThreadPool.isShutdown()) {                                                           </span>
<span class="5224309411782533590" onmouseenter="enter('5224309411782533590');" onmouseout="out('5224309411782533590');" style=""> 335           mConfigThreadPool.execute(mConfigThread);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339   }                                                                                                      </span>
<span  style=""> 340                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 341   /**                                                                                                    </span>
<span class="-1608425225589706128" onmouseenter="enter('-1608425225589706128');" onmouseout="out('-1608425225589706128');" style=""> 342    * 取消任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 343    */                                                                                                    </span>
<span class="-6930343012855552909" onmouseenter="enter('-6930343012855552909');" onmouseout="out('-6930343012855552909');" style=""> 344   public void cancel() {                                                                                 </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 345     synchronized (AriaManager.LOCK) {                                                                    </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style=""> 346       isCancel = true;                                                                                   </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 347 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="4419200793409452847" onmouseenter="enter('4419200793409452847');" onmouseout="out('4419200793409452847');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 348       sendState(IThreadState.STATE_CANCEL, null);                                                        </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 349 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350         }                                                                                                </span>
<span class="983038057484720775" onmouseenter="enter('983038057484720775');" onmouseout="out('983038057484720775');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351         getState().STOP_NUM++;                                                                           </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 352 =======                                                                                                  </span>
<span class="5570544159779772188" onmouseenter="enter('5570544159779772188');" onmouseout="out('5570544159779772188');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353       sendState(ThreadStateManager.STATE_CANCEL, null);                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 354 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style=""> 355       ALog.d(TAG,                                                                                        </span>
<span class="-2078406994386200129" onmouseenter="enter('-2078406994386200129');" onmouseout="out('-2078406994386200129');" style=""> 356           String.format(&quot;任务【%s】thread__%s__取消&quot;, getFileName(), mRecord.threadId));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358   }                                                                                                      </span>
<span  style=""> 359                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 360   /**                                                                                                    </span>
<span class="-3628170746268112272" onmouseenter="enter('-3628170746268112272');" onmouseout="out('-3628170746268112272');" style=""> 361    * 线程任务失败                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 362    *                                                                                                     </span>
<span class="6810672559305889194" onmouseenter="enter('6810672559305889194');" onmouseout="out('6810672559305889194');" style=""> 363    * @param subCurrentLocation 当前线程下载进度                                                                  </span>
<span class="774581074216290190" onmouseenter="enter('774581074216290190');" onmouseout="out('774581074216290190');" style=""> 364    * @param ex 异常信息                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 365    */                                                                                                    </span>
<span class="1500165102101720475" onmouseenter="enter('1500165102101720475');" onmouseout="out('1500165102101720475');" style=""> 366   protected void fail(final long subCurrentLocation, BaseException ex) {                                 </span>
<span class="-2149101237246601219" onmouseenter="enter('-2149101237246601219');" onmouseout="out('-2149101237246601219');" style=""> 367     fail(subCurrentLocation, ex, true);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368   }                                                                                                      </span>
<span  style=""> 369                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 370   /**                                                                                                    </span>
<span class="7725539954827761966" onmouseenter="enter('7725539954827761966');" onmouseout="out('7725539954827761966');" style=""> 371    * 任务失败                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 372    *                                                                                                     </span>
<span class="7399711965916828500" onmouseenter="enter('7399711965916828500');" onmouseout="out('7399711965916828500');" style=""> 373    * @param subCurrentLocation 当前子线程进度                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 374    */                                                                                                    </span>
<span class="3846496864338478922" onmouseenter="enter('3846496864338478922');" onmouseout="out('3846496864338478922');" style=""> 375   protected void fail(final long subCurrentLocation, BaseException ex, boolean needRetry) {              </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style=""> 376     if (ex != null) {                                                                                    </span>
<span class="-333456365485290101" onmouseenter="enter('-333456365485290101');" onmouseout="out('-333456365485290101');" style=""> 377       ALog.e(TAG, ALog.getExceptionString(ex));                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 378     }                                                                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 379 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6310848794744788402" onmouseenter="enter('6310848794744788402');" onmouseout="out('6310848794744788402');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 380     if (mTaskWrapper.getRequestType() == ITaskWrapper.M3U8_FILE) {                                       </span>
<span class="4742082000916781311" onmouseenter="enter('4742082000916781311');" onmouseout="out('4742082000916781311');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 381       writeConfig(false, 0);                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 382 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-5689702993538725830" onmouseenter="enter('-5689702993538725830');" onmouseout="out('-5689702993538725830');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383           .isChunked()) {                                                                                </span>
<span class="272704129949425447" onmouseenter="enter('272704129949425447');" onmouseout="out('272704129949425447');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384         String errorMsg =                                                                                </span>
<span class="4440641683122614336" onmouseenter="enter('4440641683122614336');" onmouseout="out('4440641683122614336');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385             String.format(&quot;下载失败，下载长度超出文件真实长度；currentLocation=%s, fileSize=%s&quot;,                           </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 386 =======                                                                                                  </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387     if (mTaskWrapper.isSupportBP()) {                                                                    </span>
<span class="5636262962850437364" onmouseenter="enter('5636262962850437364');" onmouseout="out('5636262962850437364');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388       writeConfig(false, subCurrentLocation);                                                            </span>
<span class="7955132104080368983" onmouseenter="enter('7955132104080368983');" onmouseout="out('7955132104080368983');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389       retryThis(needRetry &amp;&amp; mConfig.startThreadNum != 1);                                               </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 390 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 391     } else {                                                                                             </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 392 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 393       if (mTaskWrapper.isSupportBP()) {                                                                  </span>
<span class="5636262962850437364" onmouseenter="enter('5636262962850437364');" onmouseout="out('5636262962850437364');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 394         writeConfig(false, subCurrentLocation);                                                          </span>
<span class="7955132104080368983" onmouseenter="enter('7955132104080368983');" onmouseout="out('7955132104080368983');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 395         retryThis(needRetry &amp;&amp; mConfig.startThreadNum != 1);                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 396       } else {                                                                                           </span>
<span class="6613685008099650869" onmouseenter="enter('6613685008099650869');" onmouseout="out('6613685008099650869');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 397         ALog.e(TAG, String.format(&quot;任务【%s】执行失败&quot;, getFileName()));                                         </span>
<span class="6290350204306664705" onmouseenter="enter('6290350204306664705');" onmouseout="out('6290350204306664705');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 398         ErrorHelp.saveError(TAG, &quot;&quot;, ALog.getExceptionString(ex));                                       </span>
<span class="-3645539894315514142" onmouseenter="enter('-3645539894315514142');" onmouseout="out('-3645539894315514142');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 399         sendFailMsg(null);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 400       }                                                                                                  </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 401 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="4915606519379135079" onmouseenter="enter('4915606519379135079');" onmouseout="out('4915606519379135079');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402                 getEntity().getFileSize());                                                              </span>
<span class="-3099491134649143832" onmouseenter="enter('-3099491134649143832');" onmouseout="out('-3099491134649143832');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403         taskBreak = true;                                                                                </span>
<span class="3048453949361930159" onmouseenter="enter('3048453949361930159');" onmouseout="out('3048453949361930159');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404         fail(mChildCurrentLocation, new FileException(TAG, errorMsg), false);                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406       }                                                                                                  </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407       mChildCurrentLocation += len;                                                                      </span>
<span class="7118339639886667974" onmouseenter="enter('7118339639886667974');" onmouseout="out('7118339639886667974');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408       getState().CURRENT_LOCATION += len;                                                                </span>
<span class="8466413356993225320" onmouseenter="enter('8466413356993225320');" onmouseout="out('8466413356993225320');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409       if (System.currentTimeMillis() - mLastSaveTime &gt; 5000                                              </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 410 =======                                                                                                  </span>
<span class="6613685008099650869" onmouseenter="enter('6613685008099650869');" onmouseout="out('6613685008099650869');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411       ALog.e(TAG, String.format(&quot;任务【%s】执行失败&quot;, getFileName()));                                           </span>
<span class="6290350204306664705" onmouseenter="enter('6290350204306664705');" onmouseout="out('6290350204306664705');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412       ErrorHelp.saveError(TAG, &quot;&quot;, ALog.getExceptionString(ex));                                         </span>
<span class="-3645539894315514142" onmouseenter="enter('-3645539894315514142');" onmouseout="out('-3645539894315514142');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413       sendFailMsg(null);                                                                                 </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 414 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 415     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 416   }                                                                                                      </span>
<span  style=""> 417                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 418   /**                                                                                                    </span>
<span class="-9093725986363149842" onmouseenter="enter('-9093725986363149842');" onmouseout="out('-9093725986363149842');" style=""> 419    * 重试当前线程，如果其中一条线程已经下载失败，则任务该任务下载失败，并且停止该任务的所有线程                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 420    *                                                                                                     </span>
<span class="-7715462203363144181" onmouseenter="enter('-7715462203363144181');" onmouseout="out('-7715462203363144181');" style=""> 421    * @param needRetry 是否可以重试                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 422    */                                                                                                    </span>
<span class="-4017949080492709723" onmouseenter="enter('-4017949080492709723');" onmouseout="out('-4017949080492709723');" style=""> 423   private void retryThis(boolean needRetry) {                                                            </span>
<span class="3310386334432410672" onmouseenter="enter('3310386334432410672');" onmouseout="out('3310386334432410672');" style=""> 424     if (!NetUtils.isConnected(AriaManager.APP) &amp;&amp; !isNotNetRetry) {                                      </span>
<span class="-540477151182203063" onmouseenter="enter('-540477151182203063');" onmouseout="out('-540477151182203063');" style=""> 425       ALog.w(TAG, String.format(&quot;任务【%s】重试失败，网络未连接&quot;, getFileName()));                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426     }                                                                                                    </span>
<span class="1591223325682575890" onmouseenter="enter('1591223325682575890');" onmouseout="out('1591223325682575890');" style=""> 427     if (mFailTimes &lt; RETRY_NUM &amp;&amp; needRetry &amp;&amp; (NetUtils.isConnected(AriaManager.APP)                    </span>
<span class="8286758897154980077" onmouseenter="enter('8286758897154980077');" onmouseout="out('8286758897154980077');" style=""> 428         || isNotNetRetry) &amp;&amp; !isBreak()) {                                                               </span>
<span class="-3870082629414944375" onmouseenter="enter('-3870082629414944375');" onmouseout="out('-3870082629414944375');" style=""> 429       ALog.w(TAG, String.format(&quot;任务【%s】正在重试&quot;, getFileName()));                                           </span>
<span class="-1094790045894886583" onmouseenter="enter('-1094790045894886583');" onmouseout="out('-1094790045894886583');" style=""> 430       mFailTimes++;                                                                                      </span>
<span class="4458054822073455179" onmouseenter="enter('4458054822073455179');" onmouseout="out('4458054822073455179');" style=""> 431       handleRetryRecord();                                                                               </span>
<span class="5034263136405999116" onmouseenter="enter('5034263136405999116');" onmouseout="out('5034263136405999116');" style=""> 432       ThreadTaskManager.getInstance().retryThread(AbsThreadTask.this);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 433     } else {                                                                                             </span>
<span class="-3645539894315514142" onmouseenter="enter('-3645539894315514142');" onmouseout="out('-3645539894315514142');" style=""> 434       sendFailMsg(null);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 435     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436   }                                                                                                      </span>
<span  style=""> 437                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 438   /**                                                                                                    </span>
<span class="2024814027088983613" onmouseenter="enter('2024814027088983613');" onmouseout="out('2024814027088983613');" style=""> 439    * 处理线程重试的记录，只有多线程任务才会执行                                                                               </span>
<span class="7355073000228872615" onmouseenter="enter('7355073000228872615');" onmouseout="out('7355073000228872615');" style=""> 440    * 如果是以前版本{@link BufferedRandomAccessFile}创建的下载，那么 record.startLocation不用修改                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 441    */                                                                                                    </span>
<span class="6729287348781078107" onmouseenter="enter('6729287348781078107');" onmouseout="out('6729287348781078107');" style=""> 442   private void handleRetryRecord() {                                                                     </span>
<span class="7525858464156079810" onmouseenter="enter('7525858464156079810');" onmouseout="out('7525858464156079810');" style=""> 443     if (mConfig.isBlock) {                                                                               </span>
<span class="-6754358035051648935" onmouseenter="enter('-6754358035051648935');" onmouseout="out('-6754358035051648935');" style=""> 444       // 默认线程分块长度                                                                                        </span>
<span class="669945524285390040" onmouseenter="enter('669945524285390040');" onmouseout="out('669945524285390040');" style=""> 445       File temp = mConfig.tempFile;                                                                      </span>
<span  style=""> 446                                                                                                          </span>
<span class="-793137946029070789" onmouseenter="enter('-793137946029070789');" onmouseout="out('-793137946029070789');" style=""> 447       long blockFileLen = temp.length(); // 磁盘中的分块文件长度                                                   </span>
<span class="8378527770954177996" onmouseenter="enter('8378527770954177996');" onmouseout="out('8378527770954177996');" style=""> 448       long threadRect = mRecord.blockLen;     // 当前线程的区间                                                 </span>
<span  style=""> 449                                                                                                          </span>
<span class="-2809861036487449932" onmouseenter="enter('-2809861036487449932');" onmouseout="out('-2809861036487449932');" style=""> 450       if (!temp.exists()) {                                                                              </span>
<span class="2335841033690112132" onmouseenter="enter('2335841033690112132');" onmouseout="out('2335841033690112132');" style=""> 451         ALog.i(TAG, String.format(&quot;分块文件【%s】不存在，该分块将重新开始&quot;, temp.getName()));                              </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style=""> 452         mRecord.isComplete = false;                                                                      </span>
<span class="-8890616152097691977" onmouseenter="enter('-8890616152097691977');" onmouseout="out('-8890616152097691977');" style=""> 453         mRecord.startLocation = mRecord.endLocation - threadRect;                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 454       } else {                                                                                           </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 455         /*                                                                                               </span>
<span class="3457188544010136028" onmouseenter="enter('3457188544010136028');" onmouseout="out('3457188544010136028');" style=""> 456          * 检查磁盘中的分块文件                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 457          */                                                                                              </span>
<span class="7157771772038955316" onmouseenter="enter('7157771772038955316');" onmouseout="out('7157771772038955316');" style=""> 458         if (blockFileLen &gt; threadRect) {                                                                 </span>
<span class="-3751962279648840181" onmouseenter="enter('-3751962279648840181');" onmouseout="out('-3751962279648840181');" style=""> 459           ALog.i(TAG, String.format(&quot;分块【%s】错误，将重新下载该分块&quot;, temp.getName()));                               </span>
<span class="-2826646494613153676" onmouseenter="enter('-2826646494613153676');" onmouseout="out('-2826646494613153676');" style=""> 460           temp.delete();                                                                                 </span>
<span class="8371392117975581366" onmouseenter="enter('8371392117975581366');" onmouseout="out('8371392117975581366');" style=""> 461           mRecord.startLocation = mRecord.endLocation - mRecord.blockLen;                                </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style=""> 462           mRecord.isComplete = false;                                                                    </span>
<span class="6776411255900347323" onmouseenter="enter('6776411255900347323');" onmouseout="out('6776411255900347323');" style=""> 463         } else if (blockFileLen &lt; mRecord.blockLen) {                                                    </span>
<span class="6584433194872596156" onmouseenter="enter('6584433194872596156');" onmouseout="out('6584433194872596156');" style=""> 464           mRecord.startLocation = mRecord.endLocation - mRecord.blockLen + blockFileLen;                 </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style=""> 465           mRecord.isComplete = false;                                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 466 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="3415967563254175421" onmouseenter="enter('3415967563254175421');" onmouseout="out('3415967563254175421');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 467           sendState(IThreadState.STATE_UPDATE_PROGRESS, null);                                           </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 468 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470   /**                                                                                                    </span>
<span class="7725539954827761966" onmouseenter="enter('7725539954827761966');" onmouseout="out('7725539954827761966');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471    * 任务失败                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472    *                                                                                                     </span>
<span class="7399711965916828500" onmouseenter="enter('7399711965916828500');" onmouseout="out('7399711965916828500');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473    * @param subCurrentLocation 当前子线程进度                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474    */                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 475 =======                                                                                                  </span>
<span class="6944687175787726084" onmouseenter="enter('6944687175787726084');" onmouseout="out('6944687175787726084');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 476           sendState(ThreadStateManager.STATE_UPDATE_PROGRESS, null);                                     </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 477 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-3869098922257348244" onmouseenter="enter('-3869098922257348244');" onmouseout="out('-3869098922257348244');" style=""> 478           ALog.i(TAG,                                                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 479 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="2733924598962321997" onmouseenter="enter('2733924598962321997');" onmouseout="out('2733924598962321997');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 480               String.format(&quot;修正分块【%s】记录，开始位置：%s，结束位置：%s&quot;, temp.getName(), mRecord.startLocation,         </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 481 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="7725539954827761966" onmouseenter="enter('7725539954827761966');" onmouseout="out('7725539954827761966');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482    * 任务失败                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483    *                                                                                                     </span>
<span class="7399711965916828500" onmouseenter="enter('7399711965916828500');" onmouseout="out('7399711965916828500');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484    * @param subCurrentLocation 当前子线程进度                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485    */                                                                                                    </span>
<span class="3846496864338478922" onmouseenter="enter('3846496864338478922');" onmouseout="out('3846496864338478922');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486   protected void fail(final long subCurrentLocation, BaseException ex, boolean needRetry) {              </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487     if (ex != null) {                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 488 =======                                                                                                  </span>
<span class="-9076885663859410178" onmouseenter="enter('-9076885663859410178');" onmouseout="out('-9076885663859410178');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 489               String.format(&quot;修正分块【%s】，开始位置：%s，结束位置：%s&quot;, temp.getName(), mRecord.startLocation,           </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 490 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="7451819391210675610" onmouseenter="enter('7451819391210675610');" onmouseout="out('7451819391210675610');" style=""> 491                   mRecord.endLocation));                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 492         } else {                                                                                         </span>
<span class="-6777046188674518761" onmouseenter="enter('-6777046188674518761');" onmouseout="out('-6777046188674518761');" style=""> 493           ALog.i(TAG, String.format(&quot;分块【%s】已完成，更新记录&quot;, temp.getName()));                                  </span>
<span class="-3752598072096250383" onmouseenter="enter('-3752598072096250383');" onmouseout="out('-3752598072096250383');" style=""> 494           mRecord.isComplete = true;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 495         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 496       }                                                                                                  </span>
<span class="-1713746282533100961" onmouseenter="enter('-1713746282533100961');" onmouseout="out('-1713746282533100961');" style=""> 497       mRecord.update();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 498     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 499   }                                                                                                      </span>
<span  style=""> 500                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 501   /**                                                                                                    </span>
<span class="590341144997189976" onmouseenter="enter('590341144997189976');" onmouseout="out('590341144997189976');" style=""> 502    * 发送任务完成的消息，并删除任务记录                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 503    */                                                                                                    </span>
<span class="1107873274627848500" onmouseenter="enter('1107873274627848500');" onmouseout="out('1107873274627848500');" style=""> 504   protected synchronized void sendCompleteMsg() {                                                        </span>
<span class="5765255273240095600" onmouseenter="enter('5765255273240095600');" onmouseout="out('5765255273240095600');" style=""> 505     ALog.i(TAG, String.format(&quot;任务【%s】完成&quot;, getFileName()));                                               </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 506 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="4674231415812911135" onmouseenter="enter('4674231415812911135');" onmouseout="out('4674231415812911135');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 507     sendState(IThreadState.STATE_COMPLETE, null);                                                        </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 508 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 509   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 511   /**                                                                                                    </span>
<span class="-9093725986363149842" onmouseenter="enter('-9093725986363149842');" onmouseout="out('-9093725986363149842');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512    * 重试当前线程，如果其中一条线程已经下载失败，则任务该任务下载失败，并且停止该任务的所有线程                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513    *                                                                                                     </span>
<span class="-7715462203363144181" onmouseenter="enter('-7715462203363144181');" onmouseout="out('-7715462203363144181');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514    * @param needRetry 是否可以重试                                                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 515 =======                                                                                                  </span>
<span class="7593389892196353154" onmouseenter="enter('7593389892196353154');" onmouseout="out('7593389892196353154');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516     sendState(ThreadStateManager.STATE_COMPLETE, null);                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 517 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 518   }                                                                                                      </span>
<span  style=""> 519                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 520   /**                                                                                                    </span>
<span class="2603197968032099438" onmouseenter="enter('2603197968032099438');" onmouseout="out('2603197968032099438');" style=""> 521    * 发送失败信息                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 522    */                                                                                                    </span>
<span class="5094334093525103652" onmouseenter="enter('5094334093525103652');" onmouseout="out('5094334093525103652');" style=""> 523   protected void sendFailMsg(@Nullable BaseException e) {                                                </span>
<span class="-125198456384004571" onmouseenter="enter('-125198456384004571');" onmouseout="out('-125198456384004571');" style=""> 524     if (e != null) {                                                                                     </span>
<span class="-6551099466538715534" onmouseenter="enter('-6551099466538715534');" onmouseout="out('-6551099466538715534');" style=""> 525       Bundle b = new Bundle();                                                                           </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 526 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6044105917207690073" onmouseenter="enter('6044105917207690073');" onmouseout="out('6044105917207690073');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 527       b.putSerializable(IThreadState.KEY_ERROR_INFO, e);                                                 </span>
<span class="-6547766989655415645" onmouseenter="enter('-6547766989655415645');" onmouseout="out('-6547766989655415645');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 528       sendState(IThreadState.STATE_FAIL, b);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 529     } else {                                                                                             </span>
<span class="6048350305855132996" onmouseenter="enter('6048350305855132996');" onmouseout="out('6048350305855132996');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 530       sendState(IThreadState.STATE_FAIL, null);                                                          </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 531 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-626911073917424062" onmouseenter="enter('-626911073917424062');" onmouseout="out('-626911073917424062');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 532       ALog.w(TAG, String.format(&quot;任务【%s】重试失败，网络未连接&quot;, getConfig().TEMP_FILE.getName()));                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 533     }                                                                                                    </span>
<span class="1591223325682575890" onmouseenter="enter('1591223325682575890');" onmouseout="out('1591223325682575890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 534     if (mFailTimes &lt; RETRY_NUM &amp;&amp; needRetry &amp;&amp; (NetUtils.isConnected(AriaManager.APP)                    </span>
<span class="8286758897154980077" onmouseenter="enter('8286758897154980077');" onmouseout="out('8286758897154980077');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 535         || isNotNetRetry) &amp;&amp; !isBreak()) {                                                               </span>
<span class="5627414684221265205" onmouseenter="enter('5627414684221265205');" onmouseout="out('5627414684221265205');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 536       ALog.d(TAG, String.format(&quot;isCancel: %s, isStop: %s, isBreak: %s&quot;, getState().isCancel,            </span>
<span class="-4811551907713175761" onmouseenter="enter('-4811551907713175761');" onmouseout="out('-4811551907713175761');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 537           getState().isStop, taskBreak));                                                                </span>
<span class="-7711180097266902820" onmouseenter="enter('-7711180097266902820');" onmouseout="out('-7711180097266902820');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 538       ALog.w(TAG, String.format(&quot;任务【%s】正在重试&quot;, getConfig().TEMP_FILE.getName()));                         </span>
<span class="-1094790045894886583" onmouseenter="enter('-1094790045894886583');" onmouseout="out('-1094790045894886583');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 539       mFailTimes++;                                                                                      </span>
<span class="4458054822073455179" onmouseenter="enter('4458054822073455179');" onmouseout="out('4458054822073455179');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 540       handleRetryRecord();                                                                               </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 541 =======                                                                                                  </span>
<span class="2257003064329280544" onmouseenter="enter('2257003064329280544');" onmouseout="out('2257003064329280544');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542       b.putSerializable(ThreadStateManager.KEY_ERROR_INFO, e);                                           </span>
<span class="1053312846940829509" onmouseenter="enter('1053312846940829509');" onmouseout="out('1053312846940829509');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543       sendState(ThreadStateManager.STATE_FAIL, b);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544     } else {                                                                                             </span>
<span class="737994709921278984" onmouseenter="enter('737994709921278984');" onmouseout="out('737994709921278984');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545       sendState(ThreadStateManager.STATE_FAIL, null);                                                    </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 546 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 547     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 548   }                                                                                                      </span>
<span  style=""> 549                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 550   /**                                                                                                    </span>
<span class="6719845586187631935" onmouseenter="enter('6719845586187631935');" onmouseout="out('6719845586187631935');" style=""> 551    * 将记录写入到配置文件                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 552    *                                                                                                     </span>
<span class="6391874541652225431" onmouseenter="enter('6391874541652225431');" onmouseout="out('6391874541652225431');" style=""> 553    * @param isComplete 当前线程是否完成 {@code true}完成                                                           </span>
<span class="-5364023467485105638" onmouseenter="enter('-5364023467485105638');" onmouseout="out('-5364023467485105638');" style=""> 554    * @param record 当前下载进度                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 555    */                                                                                                    </span>
<span class="5027582220747789474" onmouseenter="enter('5027582220747789474');" onmouseout="out('5027582220747789474');" style=""> 556   protected void writeConfig(boolean isComplete, final long record) {                                    </span>
<span class="8605925134180182455" onmouseenter="enter('8605925134180182455');" onmouseout="out('8605925134180182455');" style=""> 557     if (mRecord != null) {                                                                               </span>
<span class="-5137168811759188909" onmouseenter="enter('-5137168811759188909');" onmouseout="out('-5137168811759188909');" style=""> 558       mRecord.isComplete = isComplete;                                                                   </span>
<span class="7525858464156079810" onmouseenter="enter('7525858464156079810');" onmouseout="out('7525858464156079810');" style=""> 559       if (mConfig.isBlock) {                                                                             </span>
<span class="5039999237965274971" onmouseenter="enter('5039999237965274971');" onmouseout="out('5039999237965274971');" style=""> 560         mRecord.startLocation = record;                                                                  </span>
<span class="-1667997194350191014" onmouseenter="enter('-1667997194350191014');" onmouseout="out('-1667997194350191014');" style=""> 561       } else if (mConfig.isOpenDynamicFile) {                                                            </span>
<span class="-7448644562741689657" onmouseenter="enter('-7448644562741689657');" onmouseout="out('-7448644562741689657');" style=""> 562         mRecord.startLocation = mConfig.tempFile.length();                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 563       } else {                                                                                           </span>
<span class="111068837356204936" onmouseenter="enter('111068837356204936');" onmouseout="out('111068837356204936');" style=""> 564         if (0 &lt; record &amp;&amp; record &lt; mRecord.endLocation) {                                                </span>
<span class="5039999237965274971" onmouseenter="enter('5039999237965274971');" onmouseout="out('5039999237965274971');" style=""> 565           mRecord.startLocation = record;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 566         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 567       }                                                                                                  </span>
<span class="-1713746282533100961" onmouseenter="enter('-1713746282533100961');" onmouseout="out('-1713746282533100961');" style=""> 568       mRecord.update();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 569     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 570   }                                                                                                      </span>
<span  style=""> 571                                                                                                          </span>
<span class="-624413037734427342" onmouseenter="enter('-624413037734427342');" onmouseout="out('-624413037734427342');" style=""> 572   @Override public AbsThreadTask call() throws Exception {                                               </span>
<span class="7231940989594771196" onmouseenter="enter('7231940989594771196');" onmouseout="out('7231940989594771196');" style=""> 573     isInterrupted = false;                                                                               </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style=""> 574     Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                       </span>
<span class="-1851318291295515457" onmouseenter="enter('-1851318291295515457');" onmouseout="out('-1851318291295515457');" style=""> 575     TrafficStats.setThreadStatsTag(UUID.randomUUID().toString().hashCode());                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 576     return this;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 577   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 578 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16 package com.arialyy.aria.core.common;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="-6390350725830347024" onmouseenter="enter('-6390350725830347024');" onmouseout="out('-6390350725830347024');" style="">  18 import android.net.TrafficStats;                                                                         </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  19 import android.os.Bundle;                                                                                </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="">  20 import android.os.Handler;                                                                               </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="">  21 import android.os.Message;                                                                               </span>
<span class="3485143652294101472" onmouseenter="enter('3485143652294101472');" onmouseout="out('3485143652294101472');" style="">  22 import android.os.Process;                                                                               </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="">  23 import android.support.annotation.Nullable;                                                              </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  24 import com.arialyy.aria.core.AriaManager;                                                                </span>
<span class="-7940163229294156086" onmouseenter="enter('-7940163229294156086');" onmouseout="out('-7940163229294156086');" style="">  25 import com.arialyy.aria.core.config.BaseTaskConfig;                                                      </span>
<span class="-1126292087500355850" onmouseenter="enter('-1126292087500355850');" onmouseout="out('-1126292087500355850');" style="">  26 import com.arialyy.aria.core.config.DGroupConfig;                                                        </span>
<span class="1425241372324221776" onmouseenter="enter('1425241372324221776');" onmouseout="out('1425241372324221776');" style="">  27 import com.arialyy.aria.core.config.DownloadConfig;                                                      </span>
<span class="1322200574016778248" onmouseenter="enter('1322200574016778248');" onmouseout="out('1322200574016778248');" style="">  28 import com.arialyy.aria.core.config.UploadConfig;                                                        </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  29 import com.arialyy.aria.core.inf.AbsNormalEntity;                                                        </span>
<span class="8472156907075048576" onmouseenter="enter('8472156907075048576');" onmouseout="out('8472156907075048576');" style="">  30 import com.arialyy.aria.core.inf.AbsTaskWrapper;                                                         </span>
<span class="-1066657515660882744" onmouseenter="enter('-1066657515660882744');" onmouseout="out('-1066657515660882744');" style="">  31 import com.arialyy.aria.core.inf.ITaskWrapper;                                                           </span>
<span class="5965657858743993748" onmouseenter="enter('5965657858743993748');" onmouseout="out('5965657858743993748');" style="">  32 import com.arialyy.aria.core.manager.ThreadTaskManager;                                                  </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="">  33 import com.arialyy.aria.exception.BaseException;                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  34 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="">  35 import com.arialyy.aria.util.BufferedRandomAccessFile;                                                   </span>
<span class="3933848313391255451" onmouseenter="enter('3933848313391255451');" onmouseout="out('3933848313391255451');" style="">  36 import com.arialyy.aria.util.ErrorHelp;                                                                  </span>
<span class="-3921447581486569047" onmouseenter="enter('-3921447581486569047');" onmouseout="out('-3921447581486569047');" style="">  37 import com.arialyy.aria.util.NetUtils;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  38 import java.io.File;                                                                                     </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  39 import java.util.UUID;                                                                                   </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  40 import java.util.concurrent.Callable;                                                                    </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  41 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  42 import java.util.concurrent.Executors;                                                                   </span>
<span  style="">  43                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  44 /**                                                                                                      </span>
<span class="-7798270031920764735" onmouseenter="enter('-7798270031920764735');" onmouseout="out('-7798270031920764735');" style="">  45  * Created by lyy on 2017/1/18. 任务线程                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  46  */                                                                                                      </span>
<span class="-2011608922755448217" onmouseenter="enter('-2011608922755448217');" onmouseout="out('-2011608922755448217');" style=""><abbr title="  47 public abstract class AbsThreadTask&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTITY&gt;&gt;">  47 public abstract class AbsThreadTask&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;E🔵</abbr></span>
<span class="6675695936259737122" onmouseenter="enter('6675695936259737122');" onmouseout="out('6675695936259737122');" style="">  48     implements Callable&lt;AbsThreadTask&gt; {                                                                 </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  49   /**                                                                                                    </span>
<span class="-7421905703818920776" onmouseenter="enter('-7421905703818920776');" onmouseout="out('-7421905703818920776');" style="">  50    * 线程重试次数                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  51    */                                                                                                    </span>
<span class="2534354069603331424" onmouseenter="enter('2534354069603331424');" onmouseout="out('2534354069603331424');" style="">  52   private final int RETRY_NUM = 2;                                                                       </span>
<span  style="">  53                                                                                                          </span>
<span class="-6736605921341736924" onmouseenter="enter('-6736605921341736924');" onmouseout="out('-6736605921341736924');" style="">  54   private final String TAG = &quot;AbsThreadTask&quot;;                                                            </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55   /**                                                                                                    </span>
<span class="5912262818254969140" onmouseenter="enter('5912262818254969140');" onmouseout="out('5912262818254969140');" style="">  56    * 当前子线程相对于总长度的位置                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  57    */                                                                                                    </span>
<span class="-6555994287222304012" onmouseenter="enter('-6555994287222304012');" onmouseout="out('-6555994287222304012');" style="">  58   protected long mChildCurrentLocation = 0;                                                              </span>
<span class="199695981196763510" onmouseenter="enter('199695981196763510');" onmouseout="out('199695981196763510');" style="">  59   private ENTITY mEntity;                                                                                </span>
<span class="4507751527304947270" onmouseenter="enter('4507751527304947270');" onmouseout="out('4507751527304947270');" style="">  60   protected TASK_WRAPPER mTaskWrapper;                                                                   </span>
<span class="7823640971996835282" onmouseenter="enter('7823640971996835282');" onmouseout="out('7823640971996835282');" style="">  61   private int mFailTimes = 0;                                                                            </span>
<span class="-2140378055800192500" onmouseenter="enter('-2140378055800192500');" onmouseout="out('-2140378055800192500');" style="">  62   private long mLastSaveTime;                                                                            </span>
<span class="7052955590557645990" onmouseenter="enter('7052955590557645990');" onmouseout="out('7052955590557645990');" style="">  63   private ExecutorService mConfigThreadPool;                                                             </span>
<span class="4205150814631290032" onmouseenter="enter('4205150814631290032');" onmouseout="out('4205150814631290032');" style="">  64   private boolean isNotNetRetry;  //断网情况是否重试                                                             </span>
<span class="-1742305716471965576" onmouseenter="enter('-1742305716471965576');" onmouseout="out('-1742305716471965576');" style="">  65   private boolean taskBreak = false;  //任务跳出                                                             </span>
<span class="7265458021260352388" onmouseenter="enter('7265458021260352388');" onmouseout="out('7265458021260352388');" style="">  66   protected BandwidthLimiter mSpeedBandUtil; //速度限制工具                                                    </span>
<span class="2782655601744072115" onmouseenter="enter('2782655601744072115');" onmouseout="out('2782655601744072115');" style="">  67   protected AriaManager mAridManager;                                                                    </span>
<span class="4110495559709840165" onmouseenter="enter('4110495559709840165');" onmouseout="out('4110495559709840165');" style="">  68   private boolean isInterrupted = false;                                                                 </span>
<span class="8034502532514277404" onmouseenter="enter('8034502532514277404');" onmouseout="out('8034502532514277404');" style="">  69   protected boolean isCancel = false, isStop = false;                                                    </span>
<span class="-161749363286472354" onmouseenter="enter('-161749363286472354');" onmouseout="out('-161749363286472354');" style="">  70   protected ThreadRecord mRecord;                                                                        </span>
<span class="8505538020780181250" onmouseenter="enter('8505538020780181250');" onmouseout="out('8505538020780181250');" style="">  71   private Handler mStateHandler;                                                                         </span>
<span class="-644453640718072602" onmouseenter="enter('-644453640718072602');" onmouseout="out('-644453640718072602');" style="">  72   private SubThreadConfig&lt;TASK_WRAPPER&gt; mConfig;                                                         </span>
<span  style="">  73                                                                                                          </span>
<span class="7317290166143616056" onmouseenter="enter('7317290166143616056');" onmouseout="out('7317290166143616056');" style="">  74   private Thread mConfigThread = new Thread(new Runnable() {                                             </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="">  75     @Override public void run() {                                                                        </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style="">  76       Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                     </span>
<span class="-5942055588561434981" onmouseenter="enter('-5942055588561434981');" onmouseout="out('-5942055588561434981');" style="">  77       final long currentTemp = mChildCurrentLocation;                                                    </span>
<span class="-8339432453951329407" onmouseenter="enter('-8339432453951329407');" onmouseout="out('-8339432453951329407');" style="">  78       writeConfig(false, currentTemp);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79     }                                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">  80   });                                                                                                    </span>
<span  style="">  81                                                                                                          </span>
<span class="-5675375355167610812" onmouseenter="enter('-5675375355167610812');" onmouseout="out('-5675375355167610812');" style="">  82   protected AbsThreadTask(SubThreadConfig&lt;TASK_WRAPPER&gt; config) {                                        </span>
<span class="-3079299502940909127" onmouseenter="enter('-3079299502940909127');" onmouseout="out('-3079299502940909127');" style="">  83     mConfig = config;                                                                                    </span>
<span class="7608526317231191360" onmouseenter="enter('7608526317231191360');" onmouseout="out('7608526317231191360');" style="">  84     mTaskWrapper = config.taskWrapper;                                                                   </span>
<span class="-9095243370238004613" onmouseenter="enter('-9095243370238004613');" onmouseout="out('-9095243370238004613');" style="">  85     mRecord = config.record;                                                                             </span>
<span class="2077392471576236354" onmouseenter="enter('2077392471576236354');" onmouseout="out('2077392471576236354');" style="">  86     mStateHandler = config.stateHandler;                                                                 </span>
<span class="-7408997685265206061" onmouseenter="enter('-7408997685265206061');" onmouseout="out('-7408997685265206061');" style="">  87     mEntity = mTaskWrapper.getEntity();                                                                  </span>
<span class="8631807426761684047" onmouseenter="enter('8631807426761684047');" onmouseout="out('8631807426761684047');" style="">  88     mLastSaveTime = System.currentTimeMillis();                                                          </span>
<span class="-6975975484715567483" onmouseenter="enter('-6975975484715567483');" onmouseout="out('-6975975484715567483');" style="">  89     mConfigThreadPool = Executors.newCachedThreadPool();                                                 </span>
<span class="1199175373698646667" onmouseenter="enter('1199175373698646667');" onmouseout="out('1199175373698646667');" style="">  90     mAridManager = AriaManager.getInstance(AriaManager.APP);                                             </span>
<span class="-8585141996075500857" onmouseenter="enter('-8585141996075500857');" onmouseout="out('-8585141996075500857');" style="">  91     if (getMaxSpeed() &gt; 0) {                                                                             </span>
<span class="2630549456901300935" onmouseenter="enter('2630549456901300935');" onmouseout="out('2630549456901300935');" style="">  92       mSpeedBandUtil = new BandwidthLimiter(getMaxSpeed(), config.startThreadNum);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93     }                                                                                                    </span>
<span class="-2615274212376114043" onmouseenter="enter('-2615274212376114043');" onmouseout="out('-2615274212376114043');" style="">  94     isNotNetRetry = mAridManager.getAppConfig().isNotNetRetry();                                         </span>
<span class="-9180213342108359819" onmouseenter="enter('-9180213342108359819');" onmouseout="out('-9180213342108359819');" style="">  95     mChildCurrentLocation = mRecord.startLocation;                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96   }                                                                                                      </span>
<span  style="">  97                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  98   /**                                                                                                    </span>
<span class="-8737617058794341165" onmouseenter="enter('-8737617058794341165');" onmouseout="out('-8737617058794341165');" style="">  99    * 当前线程处理的文件名                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 100    */                                                                                                    </span>
<span class="7302389212643046972" onmouseenter="enter('7302389212643046972');" onmouseout="out('7302389212643046972');" style=""> 101   protected String getFileName() {                                                                       </span>
<span class="4833117926548008502" onmouseenter="enter('4833117926548008502');" onmouseout="out('4833117926548008502');" style=""> 102     return mConfig.tempFile.getName();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103   }                                                                                                      </span>
<span  style=""> 104                                                                                                          </span>
<span class="-3759066779726210536" onmouseenter="enter('-3759066779726210536');" onmouseout="out('-3759066779726210536');" style=""> 105   protected SubThreadConfig&lt;TASK_WRAPPER&gt; getConfig() {                                                  </span>
<span class="-7756481640167229217" onmouseenter="enter('-7756481640167229217');" onmouseout="out('-7756481640167229217');" style=""> 106     return mConfig;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107   }                                                                                                      </span>
<span  style=""> 108                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 109   /**                                                                                                    </span>
<span class="1636797617085164081" onmouseenter="enter('1636797617085164081');" onmouseout="out('1636797617085164081');" style=""> 110    * 设置线程是否中断                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 111    *                                                                                                     </span>
<span class="6061025491082520720" onmouseenter="enter('6061025491082520720');" onmouseout="out('6061025491082520720');" style=""> 112    * @param isInterrupted {@code true} 中断                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 113    */                                                                                                    </span>
<span class="-3489753654187641055" onmouseenter="enter('-3489753654187641055');" onmouseout="out('-3489753654187641055');" style=""> 114   public void setInterrupted(boolean isInterrupted) {                                                    </span>
<span class="3679723848447236272" onmouseenter="enter('3679723848447236272');" onmouseout="out('3679723848447236272');" style=""> 115     this.isInterrupted = isInterrupted;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116   }                                                                                                      </span>
<span  style=""> 117                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 118   /**                                                                                                    </span>
<span class="-9093294427063192169" onmouseenter="enter('-9093294427063192169');" onmouseout="out('-9093294427063192169');" style=""> 119    * 线程是否存活                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 120    *                                                                                                     </span>
<span class="-4472564326041631774" onmouseenter="enter('-4472564326041631774');" onmouseout="out('-4472564326041631774');" style=""> 121    * @return {@code true}存活                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 122    */                                                                                                    </span>
<span class="5343971881214349340" onmouseenter="enter('5343971881214349340');" onmouseout="out('5343971881214349340');" style=""> 123   protected boolean isLive() {                                                                           </span>
<span class="5056984206620082489" onmouseenter="enter('5056984206620082489');" onmouseout="out('5056984206620082489');" style=""> 124     return !Thread.currentThread().isInterrupted() &amp;&amp; !isInterrupted;                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125   }                                                                                                      </span>
<span  style=""> 126                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 127   /**                                                                                                    </span>
<span class="-1407135870976300" onmouseenter="enter('-1407135870976300');" onmouseout="out('-1407135870976300');" style=""> 128    * 当前线程是否完成，对于不支持断点的任务，一律未完成 {@code true} 完成；{@code false} 未完成                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 129    */                                                                                                    </span>
<span class="-5985760820188647103" onmouseenter="enter('-5985760820188647103');" onmouseout="out('-5985760820188647103');" style=""> 130   boolean isThreadComplete() {                                                                           </span>
<span class="-5832476025614563785" onmouseenter="enter('-5832476025614563785');" onmouseout="out('-5832476025614563785');" style=""> 131     return mRecord.isComplete;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132   }                                                                                                      </span>
<span  style=""> 133                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 134   /**                                                                                                    </span>
<span class="4246443053284865110" onmouseenter="enter('4246443053284865110');" onmouseout="out('4246443053284865110');" style=""> 135    * 获取实体                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 136    */                                                                                                    </span>
<span class="-2158320671868788574" onmouseenter="enter('-2158320671868788574');" onmouseout="out('-2158320671868788574');" style=""> 137   protected ENTITY getEntity() {                                                                         </span>
<span class="-2978486956956616380" onmouseenter="enter('-2978486956956616380');" onmouseout="out('-2978486956956616380');" style=""> 138     return mEntity;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139   }                                                                                                      </span>
<span  style=""> 140                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 141   /**                                                                                                    </span>
<span class="-6696632762627304447" onmouseenter="enter('-6696632762627304447');" onmouseout="out('-6696632762627304447');" style=""> 142    * 获取任务驱动对象                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 143    */                                                                                                    </span>
<span class="-7465189499125296678" onmouseenter="enter('-7465189499125296678');" onmouseout="out('-7465189499125296678');" style=""> 144   protected TASK_WRAPPER getTaskWrapper() {                                                              </span>
<span class="-6199220384104149910" onmouseenter="enter('-6199220384104149910');" onmouseout="out('-6199220384104149910');" style=""> 145     return mTaskWrapper;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146   }                                                                                                      </span>
<span  style=""> 147                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 148   /**                                                                                                    </span>
<span class="-8261306668739895881" onmouseenter="enter('-8261306668739895881');" onmouseout="out('-8261306668739895881');" style=""> 149    * 获取配置的最大上传/下载速度                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 150    *                                                                                                     </span>
<span class="5179376621123361386" onmouseenter="enter('5179376621123361386');" onmouseout="out('5179376621123361386');" style=""> 151    * @return 单位为：kb                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 152    */                                                                                                    </span>
<span class="-896115242554653093" onmouseenter="enter('-896115242554653093');" onmouseout="out('-896115242554653093');" style=""> 153   public abstract int getMaxSpeed();                                                                     </span>
<span  style=""> 154                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 155   /**                                                                                                    </span>
<span class="-7476262045555684443" onmouseenter="enter('-7476262045555684443');" onmouseout="out('-7476262045555684443');" style=""> 156    * 读取任务配置                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 157    *                                                                                                     </span>
<span class="2765744486349037181" onmouseenter="enter('2765744486349037181');" onmouseout="out('2765744486349037181');" style=""> 158    * @return {@link DownloadConfig}、{@link UploadConfig}、{@link DGroupConfig}                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 159    */                                                                                                    </span>
<span class="8843669963162911719" onmouseenter="enter('8843669963162911719');" onmouseout="out('8843669963162911719');" style=""> 160   protected abstract BaseTaskConfig getTaskConfig();                                                     </span>
<span  style=""> 161                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 162   /**                                                                                                    </span>
<span class="-440811555959535495" onmouseenter="enter('-440811555959535495');" onmouseout="out('-440811555959535495');" style=""> 163    * 设置最大下载速度                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 164    *                                                                                                     </span>
<span class="-1508955734956367613" onmouseenter="enter('-1508955734956367613');" onmouseout="out('-1508955734956367613');" style=""> 165    * @param speed 单位为：kb                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 166    */                                                                                                    </span>
<span class="-8974735338639184772" onmouseenter="enter('-8974735338639184772');" onmouseout="out('-8974735338639184772');" style=""> 167   public void setMaxSpeed(int speed) {                                                                   </span>
<span class="-649773427560821140" onmouseenter="enter('-649773427560821140');" onmouseout="out('-649773427560821140');" style=""> 168     if (mSpeedBandUtil != null) {                                                                        </span>
<span class="-7563158316316320789" onmouseenter="enter('-7563158316316320789');" onmouseout="out('-7563158316316320789');" style=""> 169       mSpeedBandUtil.setMaxRate(speed / mConfig.startThreadNum);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171   }                                                                                                      </span>
<span  style=""> 172                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 173   /**                                                                                                    </span>
<span class="6599720418575337619" onmouseenter="enter('6599720418575337619');" onmouseout="out('6599720418575337619');" style=""> 174    * 中断任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 175    */                                                                                                    </span>
<span class="4561569160041136245" onmouseenter="enter('4561569160041136245');" onmouseout="out('4561569160041136245');" style=""> 176   void breakTask() {                                                                                     </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 177     synchronized (AriaManager.LOCK) {                                                                    </span>
<span class="-3099491134649143832" onmouseenter="enter('-3099491134649143832');" onmouseout="out('-3099491134649143832');" style=""> 178       taskBreak = true;                                                                                  </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style=""> 179       if (mTaskWrapper.isSupportBP()) {                                                                  </span>
<span class="-5942055588561434981" onmouseenter="enter('-5942055588561434981');" onmouseout="out('-5942055588561434981');" style=""> 180         final long currentTemp = mChildCurrentLocation;                                                  </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 181 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="2043705367433474739" onmouseenter="enter('2043705367433474739');" onmouseout="out('2043705367433474739');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 182         sendState(IThreadState.STATE_STOP, null);                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 183 ||||||| BASE                                                                                             </span>
<span class="983038057484720775" onmouseenter="enter('983038057484720775');" onmouseout="out('983038057484720775');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184         getState().STOP_NUM++;                                                                           </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 185 =======                                                                                                  </span>
<span class="4384426906541737800" onmouseenter="enter('4384426906541737800');" onmouseout="out('4384426906541737800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186         sendState(ThreadStateManager.STATE_STOP, null);                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 187 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="6146956303290790721" onmouseenter="enter('6146956303290790721');" onmouseout="out('6146956303290790721');" style=""> 188         ALog.d(TAG, String.format(&quot;任务【%s】thread__%s__中断【停止位置：%s】&quot;, getFileName(),                        </span>
<span class="376922911421079876" onmouseenter="enter('376922911421079876');" onmouseout="out('376922911421079876');" style=""> 189             mRecord.threadId, currentTemp));                                                             </span>
<span class="-8339432453951329407" onmouseenter="enter('-8339432453951329407');" onmouseout="out('-8339432453951329407');" style=""> 190         writeConfig(false, currentTemp);                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 191       } else {                                                                                           </span>
<span class="-2549462388866091673" onmouseenter="enter('-2549462388866091673');" onmouseout="out('-2549462388866091673');" style=""> 192         ALog.i(TAG, String.format(&quot;任务【%s】已中断&quot;, getFileName()));                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195   }                                                                                                      </span>
<span  style=""> 196                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 197   /**                                                                                                    </span>
<span class="5256203714917913991" onmouseenter="enter('5256203714917913991');" onmouseout="out('5256203714917913991');" style=""> 198    * 发送状态给状态处理器                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 199    *                                                                                                     </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 200 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-8049878616952568950" onmouseenter="enter('-8049878616952568950');" onmouseout="out('-8049878616952568950');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 201    * @param state {@link IThreadState#STATE_STOP}..                                                      </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 202 ||||||| BASE                                                                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 203 =======                                                                                                  </span>
<span class="-4769173749986063162" onmouseenter="enter('-4769173749986063162');" onmouseout="out('-4769173749986063162');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204    * @param state {@link ThreadStateManager#STATE_STOP}..                                                </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 205 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-4152917228807143386" onmouseenter="enter('-4152917228807143386');" onmouseout="out('-4152917228807143386');" style=""> 206    * @param bundle 而外数据                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 207    */                                                                                                    </span>
<span class="107634412995640864" onmouseenter="enter('107634412995640864');" onmouseout="out('107634412995640864');" style=""> 208   void sendState(int state, @Nullable Bundle bundle) {                                                   </span>
<span class="5312338573559356541" onmouseenter="enter('5312338573559356541');" onmouseout="out('5312338573559356541');" style=""> 209     Message msg = mStateHandler.obtainMessage();                                                         </span>
<span class="4586264514118761504" onmouseenter="enter('4586264514118761504');" onmouseout="out('4586264514118761504');" style=""> 210     msg.what = state;                                                                                    </span>
<span class="-3154970297737940190" onmouseenter="enter('-3154970297737940190');" onmouseout="out('-3154970297737940190');" style=""> 211     if (bundle != null) {                                                                                </span>
<span class="-5836915540506052451" onmouseenter="enter('-5836915540506052451');" onmouseout="out('-5836915540506052451');" style=""> 212       msg.setData(bundle);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213     }                                                                                                    </span>
<span class="-656061765258294758" onmouseenter="enter('-656061765258294758');" onmouseout="out('-656061765258294758');" style=""> 214     msg.sendToTarget();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215   }                                                                                                      </span>
<span  style=""> 216                                                                                                          </span>
<span class="5908327854870228087" onmouseenter="enter('5908327854870228087');" onmouseout="out('5908327854870228087');" style=""> 217   public boolean isInterrupted() {                                                                       </span>
<span class="-5203528151312862013" onmouseenter="enter('-5203528151312862013');" onmouseout="out('-5203528151312862013');" style=""> 218     return Thread.currentThread().isInterrupted();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219   }                                                                                                      </span>
<span  style=""> 220                                                                                                          </span>
<span class="-9198262987019797851" onmouseenter="enter('-9198262987019797851');" onmouseout="out('-9198262987019797851');" style=""> 221   @Override protected void finalize() throws Throwable {                                                 </span>
<span class="4114196779073131595" onmouseenter="enter('4114196779073131595');" onmouseout="out('4114196779073131595');" style=""> 222     super.finalize();                                                                                    </span>
<span class="-7477286483889370682" onmouseenter="enter('-7477286483889370682');" onmouseout="out('-7477286483889370682');" style=""> 223     if (mConfigThreadPool != null) {                                                                     </span>
<span class="6755739129057127055" onmouseenter="enter('6755739129057127055');" onmouseout="out('6755739129057127055');" style=""> 224       mConfigThreadPool.shutdown();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226   }                                                                                                      </span>
<span  style=""> 227                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 228   /**                                                                                                    </span>
<span class="4258051666929748339" onmouseenter="enter('4258051666929748339');" onmouseout="out('4258051666929748339');" style=""> 229    * 任务是否中断，中断条件： 1、任务取消 2、任务停止 3、手动中断 {@link #taskBreak}                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 230    *                                                                                                     </span>
<span class="8685725000128107952" onmouseenter="enter('8685725000128107952');" onmouseout="out('8685725000128107952');" style=""> 231    * @return {@code true} 中断，{@code false} 不是中断                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 232    */                                                                                                    </span>
<span class="1192236408818642919" onmouseenter="enter('1192236408818642919');" onmouseout="out('1192236408818642919');" style=""> 233   protected boolean isBreak() {                                                                          </span>
<span class="6435844081899071775" onmouseenter="enter('6435844081899071775');" onmouseout="out('6435844081899071775');" style=""> 234     return isCancel || isStop || taskBreak;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235   }                                                                                                      </span>
<span  style=""> 236                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 237   /**                                                                                                    </span>
<span class="-4436630274060532850" onmouseenter="enter('-4436630274060532850');" onmouseout="out('-4436630274060532850');" style=""> 238    * 检查下载完成的分块大小，如果下载完成的分块大小大于或小于分配的大小，则需要重新下载该分块 如果是非分块任务，直接返回{@code true}                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 239    *                                                                                                     </span>
<span class="-5962632420674681636" onmouseenter="enter('-5962632420674681636');" onmouseout="out('-5962632420674681636');" style=""> 240    * @return {@code true} 分块分大小正常，{@code false} 分块大小错误                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 241    */                                                                                                    </span>
<span class="-1715939541580522304" onmouseenter="enter('-1715939541580522304');" onmouseout="out('-1715939541580522304');" style=""> 242   protected boolean checkBlock() {                                                                       </span>
<span class="-8255347005712765724" onmouseenter="enter('-8255347005712765724');" onmouseout="out('-8255347005712765724');" style=""> 243     if (!mConfig.isBlock) {                                                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 244       return true;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245     }                                                                                                    </span>
<span class="3935656399577463427" onmouseenter="enter('3935656399577463427');" onmouseout="out('3935656399577463427');" style=""> 246     File blockFile = mConfig.tempFile;                                                                   </span>
<span class="-1695353633342038156" onmouseenter="enter('-1695353633342038156');" onmouseout="out('-1695353633342038156');" style=""> 247     if (!blockFile.exists() || blockFile.length() != mRecord.blockLen) {                                 </span>
<span class="-3869098922257348244" onmouseenter="enter('-3869098922257348244');" onmouseout="out('-3869098922257348244');" style=""> 248       ALog.i(TAG,                                                                                        </span>
<span class="-4253990883383800149" onmouseenter="enter('-4253990883383800149');" onmouseout="out('-4253990883383800149');" style=""> 249           String.format(&quot;分块【%s】错误，blockFileLen: %s, threadRect: %s; 即将重新下载该分块，开始位置：%s，结束位置：%s&quot;,          </span>
<span class="2939919814588467615" onmouseenter="enter('2939919814588467615');" onmouseout="out('2939919814588467615');" style=""> 250               blockFile.getName(), blockFile.length(), mRecord.blockLen, mRecord.startLocation,          </span>
<span class="7451819391210675610" onmouseenter="enter('7451819391210675610');" onmouseout="out('7451819391210675610');" style=""> 251               mRecord.endLocation));                                                                     </span>
<span class="-3823857485302692882" onmouseenter="enter('-3823857485302692882');" onmouseout="out('-3823857485302692882');" style=""> 252       if (blockFile.exists()) {                                                                          </span>
<span class="-8675830801645990020" onmouseenter="enter('-8675830801645990020');" onmouseout="out('-8675830801645990020');" style=""> 253         blockFile.delete();                                                                              </span>
<span class="2945539549828015550" onmouseenter="enter('2945539549828015550');" onmouseout="out('2945539549828015550');" style=""> 254         ALog.i(TAG, String.format(&quot;删除分块【%s】成功&quot;, blockFile.getName()));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255       }                                                                                                  </span>
<span class="-6720013085559771010" onmouseenter="enter('-6720013085559771010');" onmouseout="out('-6720013085559771010');" style=""> 256       retryThis(isBreak());                                                                              </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 257       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 259     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260   }                                                                                                      </span>
<span  style=""> 261                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 262   /**                                                                                                    </span>
<span class="-7882741939763414839" onmouseenter="enter('-7882741939763414839');" onmouseout="out('-7882741939763414839');" style=""> 263    * 停止任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 264    */                                                                                                    </span>
<span class="-1831798800985246753" onmouseenter="enter('-1831798800985246753');" onmouseout="out('-1831798800985246753');" style=""> 265   public void stop() {                                                                                   </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 266     synchronized (AriaManager.LOCK) {                                                                    </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style=""> 267       isStop = true;                                                                                     </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style=""> 268       if (mTaskWrapper.isSupportBP()) {                                                                  </span>
<span class="3999428278528562375" onmouseenter="enter('3999428278528562375');" onmouseout="out('3999428278528562375');" style=""> 269         final long stopLocation = mChildCurrentLocation;                                                 </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 270 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="2043705367433474739" onmouseenter="enter('2043705367433474739');" onmouseout="out('2043705367433474739');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 271         sendState(IThreadState.STATE_STOP, null);                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 272 ||||||| BASE                                                                                             </span>
<span class="1047909086628301767" onmouseenter="enter('1047909086628301767');" onmouseout="out('1047909086628301767');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273           File blockFile = getBockFile();                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 274 =======                                                                                                  </span>
<span class="4384426906541737800" onmouseenter="enter('4384426906541737800');" onmouseout="out('4384426906541737800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275         sendState(ThreadStateManager.STATE_STOP, null);                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 276 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style=""> 277         ALog.d(TAG,                                                                                      </span>
<span class="1550861091873015536" onmouseenter="enter('1550861091873015536');" onmouseout="out('1550861091873015536');" style=""> 278             String.format(&quot;任务【%s】thread__%s__停止【当前线程停止位置：%s】&quot;, getFileName(),                            </span>
<span class="-867220232156674741" onmouseenter="enter('-867220232156674741');" onmouseout="out('-867220232156674741');" style=""> 279                 mRecord.threadId, stopLocation));                                                        </span>
<span class="7792260418457311232" onmouseenter="enter('7792260418457311232');" onmouseout="out('7792260418457311232');" style=""> 280         writeConfig(false, stopLocation);                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 281       } else {                                                                                           </span>
<span class="-8753703196049872436" onmouseenter="enter('-8753703196049872436');" onmouseout="out('-8753703196049872436');" style=""> 282         ALog.i(TAG, String.format(&quot;任务【%s】已停止&quot;, getFileName()));                                          </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 283 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="2043705367433474739" onmouseenter="enter('2043705367433474739');" onmouseout="out('2043705367433474739');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 284         sendState(IThreadState.STATE_STOP, null);                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 285 ||||||| BASE                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286         }                                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 287 =======                                                                                                  </span>
<span class="4384426906541737800" onmouseenter="enter('4384426906541737800');" onmouseout="out('4384426906541737800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288         sendState(ThreadStateManager.STATE_STOP, null);                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 289 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292   }                                                                                                      </span>
<span  style=""> 293                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 294   /**                                                                                                    </span>
<span class="7873398811029444044" onmouseenter="enter('7873398811029444044');" onmouseout="out('7873398811029444044');" style=""> 295    * 执行中                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 296    */                                                                                                    </span>
<span class="7428157636721718570" onmouseenter="enter('7428157636721718570');" onmouseout="out('7428157636721718570');" style=""> 297   protected void progress(long len) {                                                                    </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 298     synchronized (AriaManager.LOCK) {                                                                    </span>
<span class="2533028217200451003" onmouseenter="enter('2533028217200451003');" onmouseout="out('2533028217200451003');" style=""> 299       //if (getState().CURRENT_LOCATION &gt; getEntity().getFileSize() &amp;&amp; !getTaskWrapper().asHttp()        </span>
<span class="-1186412116255119268" onmouseenter="enter('-1186412116255119268');" onmouseout="out('-1186412116255119268');" style=""> 300       //    .isChunked()) {                                                                              </span>
<span class="-4532666615131915740" onmouseenter="enter('-4532666615131915740');" onmouseout="out('-4532666615131915740');" style=""> 301       //  String errorMsg =                                                                              </span>
<span class="518171698288030827" onmouseenter="enter('518171698288030827');" onmouseout="out('518171698288030827');" style=""> 302       //      String.format(&quot;下载失败，下载长度超出文件真实长度；currentLocation=%s, fileSize=%s&quot;,                         </span>
<span class="-3066839761455073570" onmouseenter="enter('-3066839761455073570');" onmouseout="out('-3066839761455073570');" style=""> 303       //          getState().CURRENT_LOCATION,                                                           </span>
<span class="-4715215170271404042" onmouseenter="enter('-4715215170271404042');" onmouseout="out('-4715215170271404042');" style=""> 304       //          getEntity().getFileSize());                                                            </span>
<span class="3035606892929688966" onmouseenter="enter('3035606892929688966');" onmouseout="out('3035606892929688966');" style=""> 305       //  taskBreak = true;                                                                              </span>
<span class="5067342317456439021" onmouseenter="enter('5067342317456439021');" onmouseout="out('5067342317456439021');" style=""> 306       //  fail(mChildCurrentLocation, new FileException(TAG, errorMsg), false);                          </span>
<span class="3500611444781325819" onmouseenter="enter('3500611444781325819');" onmouseout="out('3500611444781325819');" style=""> 307       //  return;                                                                                        </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style=""> 308       //}                                                                                                </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style=""> 309       mChildCurrentLocation += len;                                                                      </span>
<span class="-6345084862948761327" onmouseenter="enter('-6345084862948761327');" onmouseout="out('-6345084862948761327');" style=""> 310       if (!mStateHandler.getLooper().getThread().isAlive()) {                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 311         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312       }                                                                                                  </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 313 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-5752277786740261730" onmouseenter="enter('-5752277786740261730');" onmouseout="out('-5752277786740261730');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 314       mStateHandler.obtainMessage(IThreadState.STATE_RUNNING, len).sendToTarget();                       </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 315 ||||||| BASE                                                                                             </span>
<span class="8631807426761684047" onmouseenter="enter('8631807426761684047');" onmouseout="out('8631807426761684047');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316         mLastSaveTime = System.currentTimeMillis();                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 317 =======                                                                                                  </span>
<span class="7039631086012701451" onmouseenter="enter('7039631086012701451');" onmouseout="out('7039631086012701451');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318       mStateHandler.obtainMessage(ThreadStateManager.STATE_RUNNING, len).sendToTarget();                 </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 319 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="8466413356993225320" onmouseenter="enter('8466413356993225320');" onmouseout="out('8466413356993225320');" style=""> 320       if (System.currentTimeMillis() - mLastSaveTime &gt; 5000                                              </span>
<span class="-4608803573017792643" onmouseenter="enter('-4608803573017792643');" onmouseout="out('-4608803573017792643');" style=""> 321           &amp;&amp; mChildCurrentLocation &lt; mRecord.endLocation) {                                              </span>
<span class="8631807426761684047" onmouseenter="enter('8631807426761684047');" onmouseout="out('8631807426761684047');" style=""> 322         mLastSaveTime = System.currentTimeMillis();                                                      </span>
<span class="6892340968550800051" onmouseenter="enter('6892340968550800051');" onmouseout="out('6892340968550800051');" style=""> 323         if (!mConfigThreadPool.isShutdown()) {                                                           </span>
<span class="5224309411782533590" onmouseenter="enter('5224309411782533590');" onmouseout="out('5224309411782533590');" style=""> 324           mConfigThreadPool.execute(mConfigThread);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328   }                                                                                                      </span>
<span  style=""> 329                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 330   /**                                                                                                    </span>
<span class="-1608425225589706128" onmouseenter="enter('-1608425225589706128');" onmouseout="out('-1608425225589706128');" style=""> 331    * 取消任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 332    */                                                                                                    </span>
<span class="-6930343012855552909" onmouseenter="enter('-6930343012855552909');" onmouseout="out('-6930343012855552909');" style=""> 333   public void cancel() {                                                                                 </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 334     synchronized (AriaManager.LOCK) {                                                                    </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style=""> 335       isCancel = true;                                                                                   </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 336 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="4419200793409452847" onmouseenter="enter('4419200793409452847');" onmouseout="out('4419200793409452847');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 337       sendState(IThreadState.STATE_CANCEL, null);                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 338 ||||||| BASE                                                                                             </span>
<span class="-8476168595799833278" onmouseenter="enter('-8476168595799833278');" onmouseout="out('-8476168595799833278');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339         getState().CANCEL_NUM++;                                                                         </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 340 =======                                                                                                  </span>
<span class="5570544159779772188" onmouseenter="enter('5570544159779772188');" onmouseout="out('5570544159779772188');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 341       sendState(ThreadStateManager.STATE_CANCEL, null);                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 342 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style=""> 343         ALog.d(TAG,                                                                                      </span>
<span class="-2078406994386200129" onmouseenter="enter('-2078406994386200129');" onmouseout="out('-2078406994386200129');" style=""> 344           String.format(&quot;任务【%s】thread__%s__取消&quot;, getFileName(), mRecord.threadId));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 346   }                                                                                                      </span>
<span  style=""> 347                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 348   /**                                                                                                    </span>
<span class="-3628170746268112272" onmouseenter="enter('-3628170746268112272');" onmouseout="out('-3628170746268112272');" style=""> 349    * 线程任务失败                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 350    *                                                                                                     </span>
<span class="6810672559305889194" onmouseenter="enter('6810672559305889194');" onmouseout="out('6810672559305889194');" style=""> 351    * @param subCurrentLocation 当前线程下载进度                                                                  </span>
<span class="774581074216290190" onmouseenter="enter('774581074216290190');" onmouseout="out('774581074216290190');" style=""> 352    * @param ex 异常信息                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 353    */                                                                                                    </span>
<span class="1500165102101720475" onmouseenter="enter('1500165102101720475');" onmouseout="out('1500165102101720475');" style=""> 354   protected void fail(final long subCurrentLocation, BaseException ex) {                                 </span>
<span class="-2149101237246601219" onmouseenter="enter('-2149101237246601219');" onmouseout="out('-2149101237246601219');" style=""> 355     fail(subCurrentLocation, ex, true);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356   }                                                                                                      </span>
<span  style=""> 357                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 358   /**                                                                                                    </span>
<span class="7725539954827761966" onmouseenter="enter('7725539954827761966');" onmouseout="out('7725539954827761966');" style=""> 359    * 任务失败                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 360    *                                                                                                     </span>
<span class="7399711965916828500" onmouseenter="enter('7399711965916828500');" onmouseout="out('7399711965916828500');" style=""> 361    * @param subCurrentLocation 当前子线程进度                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 362    */                                                                                                    </span>
<span class="3846496864338478922" onmouseenter="enter('3846496864338478922');" onmouseout="out('3846496864338478922');" style=""> 363   protected void fail(final long subCurrentLocation, BaseException ex, boolean needRetry) {              </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style=""> 364     if (ex != null) {                                                                                    </span>
<span class="-333456365485290101" onmouseenter="enter('-333456365485290101');" onmouseout="out('-333456365485290101');" style=""> 365       ALog.e(TAG, ALog.getExceptionString(ex));                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 366     }                                                                                                    </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 367 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="6310848794744788402" onmouseenter="enter('6310848794744788402');" onmouseout="out('6310848794744788402');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 368     if (mTaskWrapper.getRequestType() == ITaskWrapper.M3U8_FILE) {                                       </span>
<span class="4742082000916781311" onmouseenter="enter('4742082000916781311');" onmouseout="out('4742082000916781311');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 369       writeConfig(false, 0);                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 370 ||||||| BASE                                                                                             </span>
<span class="5006934068411751005" onmouseenter="enter('5006934068411751005');" onmouseout="out('5006934068411751005');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371     if (getConfig().SUPPORT_BP) {                                                                        </span>
<span class="5636262962850437364" onmouseenter="enter('5636262962850437364');" onmouseout="out('5636262962850437364');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372       writeConfig(false, subCurrentLocation);                                                            </span>
<span class="-5022490975846662695" onmouseenter="enter('-5022490975846662695');" onmouseout="out('-5022490975846662695');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373       retryThis(needRetry &amp;&amp; getState().START_THREAD_NUM != 1);                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 374 =======                                                                                                  </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375     if (mTaskWrapper.isSupportBP()) {                                                                    </span>
<span class="5636262962850437364" onmouseenter="enter('5636262962850437364');" onmouseout="out('5636262962850437364');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376       writeConfig(false, subCurrentLocation);                                                            </span>
<span class="7955132104080368983" onmouseenter="enter('7955132104080368983');" onmouseout="out('7955132104080368983');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377       retryThis(needRetry &amp;&amp; mConfig.startThreadNum != 1);                                               </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 378 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 379     } else {                                                                                             </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 380 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 381       if (mTaskWrapper.isSupportBP()) {                                                                  </span>
<span class="5636262962850437364" onmouseenter="enter('5636262962850437364');" onmouseout="out('5636262962850437364');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 382         writeConfig(false, subCurrentLocation);                                                          </span>
<span class="7955132104080368983" onmouseenter="enter('7955132104080368983');" onmouseout="out('7955132104080368983');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 383         retryThis(needRetry &amp;&amp; mConfig.startThreadNum != 1);                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 384       } else {                                                                                           </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 385 ||||||| BASE                                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386     } else {                                                                                             </span>
<span class="3391323959293733932" onmouseenter="enter('3391323959293733932');" onmouseout="out('3391323959293733932');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387       ALog.e(TAG, String.format(&quot;任务【%s】执行失败&quot;, getConfig().TEMP_FILE.getName()));                         </span>
<span class="6290350204306664705" onmouseenter="enter('6290350204306664705');" onmouseout="out('6290350204306664705');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388       ErrorHelp.saveError(TAG, &quot;&quot;, ALog.getExceptionString(ex));                                         </span>
<span class="-2162507490503055467" onmouseenter="enter('-2162507490503055467');" onmouseout="out('-2162507490503055467');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389       handleFailState(!isBreak());                                                                       </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 390 =======                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 391 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="6613685008099650869" onmouseenter="enter('6613685008099650869');" onmouseout="out('6613685008099650869');" style=""> 392         ALog.e(TAG, String.format(&quot;任务【%s】执行失败&quot;, getFileName()));                                         </span>
<span class="6290350204306664705" onmouseenter="enter('6290350204306664705');" onmouseout="out('6290350204306664705');" style=""> 393       ErrorHelp.saveError(TAG, &quot;&quot;, ALog.getExceptionString(ex));                                         </span>
<span class="-3645539894315514142" onmouseenter="enter('-3645539894315514142');" onmouseout="out('-3645539894315514142');" style=""> 394         sendFailMsg(null);                                                                               </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 395 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 396       }                                                                                                  </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 397 ||||||| BASE                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399   }                                                                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 400 =======                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 401 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 402     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 403   }                                                                                                      </span>
<span  style=""> 404                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 405   /**                                                                                                    </span>
<span class="-9093725986363149842" onmouseenter="enter('-9093725986363149842');" onmouseout="out('-9093725986363149842');" style=""> 406    * 重试当前线程，如果其中一条线程已经下载失败，则任务该任务下载失败，并且停止该任务的所有线程                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 407    *                                                                                                     </span>
<span class="-7715462203363144181" onmouseenter="enter('-7715462203363144181');" onmouseout="out('-7715462203363144181');" style=""> 408    * @param needRetry 是否可以重试                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 409    */                                                                                                    </span>
<span class="-4017949080492709723" onmouseenter="enter('-4017949080492709723');" onmouseout="out('-4017949080492709723');" style=""> 410   private void retryThis(boolean needRetry) {                                                            </span>
<span class="3310386334432410672" onmouseenter="enter('3310386334432410672');" onmouseout="out('3310386334432410672');" style=""> 411     if (!NetUtils.isConnected(AriaManager.APP) &amp;&amp; !isNotNetRetry) {                                      </span>
<span class="-540477151182203063" onmouseenter="enter('-540477151182203063');" onmouseout="out('-540477151182203063');" style=""> 412       ALog.w(TAG, String.format(&quot;任务【%s】重试失败，网络未连接&quot;, getFileName()));                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 413     }                                                                                                    </span>
<span class="1591223325682575890" onmouseenter="enter('1591223325682575890');" onmouseout="out('1591223325682575890');" style=""> 414     if (mFailTimes &lt; RETRY_NUM &amp;&amp; needRetry &amp;&amp; (NetUtils.isConnected(AriaManager.APP)                    </span>
<span class="8286758897154980077" onmouseenter="enter('8286758897154980077');" onmouseout="out('8286758897154980077');" style=""> 415         || isNotNetRetry) &amp;&amp; !isBreak()) {                                                               </span>
<span class="-3870082629414944375" onmouseenter="enter('-3870082629414944375');" onmouseout="out('-3870082629414944375');" style=""> 416       ALog.w(TAG, String.format(&quot;任务【%s】正在重试&quot;, getFileName()));                                           </span>
<span class="-1094790045894886583" onmouseenter="enter('-1094790045894886583');" onmouseout="out('-1094790045894886583');" style=""> 417       mFailTimes++;                                                                                      </span>
<span class="4458054822073455179" onmouseenter="enter('4458054822073455179');" onmouseout="out('4458054822073455179');" style=""> 418       handleRetryRecord();                                                                               </span>
<span class="5034263136405999116" onmouseenter="enter('5034263136405999116');" onmouseout="out('5034263136405999116');" style=""> 419       ThreadTaskManager.getInstance().retryThread(AbsThreadTask.this);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 420     } else {                                                                                             </span>
<span class="-3645539894315514142" onmouseenter="enter('-3645539894315514142');" onmouseout="out('-3645539894315514142');" style=""> 421       sendFailMsg(null);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 422     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 423   }                                                                                                      </span>
<span  style=""> 424                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 425   /**                                                                                                    </span>
<span class="2024814027088983613" onmouseenter="enter('2024814027088983613');" onmouseout="out('2024814027088983613');" style=""> 426    * 处理线程重试的记录，只有多线程任务才会执行                                                                               </span>
<span class="7355073000228872615" onmouseenter="enter('7355073000228872615');" onmouseout="out('7355073000228872615');" style=""> 427    * 如果是以前版本{@link BufferedRandomAccessFile}创建的下载，那么 record.startLocation不用修改                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 428    */                                                                                                    </span>
<span class="6729287348781078107" onmouseenter="enter('6729287348781078107');" onmouseout="out('6729287348781078107');" style=""> 429   private void handleRetryRecord() {                                                                     </span>
<span class="7525858464156079810" onmouseenter="enter('7525858464156079810');" onmouseout="out('7525858464156079810');" style=""> 430     if (mConfig.isBlock) {                                                                               </span>
<span class="-6754358035051648935" onmouseenter="enter('-6754358035051648935');" onmouseout="out('-6754358035051648935');" style=""> 431       // 默认线程分块长度                                                                                        </span>
<span class="669945524285390040" onmouseenter="enter('669945524285390040');" onmouseout="out('669945524285390040');" style=""> 432       File temp = mConfig.tempFile;                                                                      </span>
<span  style=""> 433                                                                                                          </span>
<span class="-793137946029070789" onmouseenter="enter('-793137946029070789');" onmouseout="out('-793137946029070789');" style=""> 434       long blockFileLen = temp.length(); // 磁盘中的分块文件长度                                                   </span>
<span class="8378527770954177996" onmouseenter="enter('8378527770954177996');" onmouseout="out('8378527770954177996');" style=""> 435       long threadRect = mRecord.blockLen;     // 当前线程的区间                                                 </span>
<span  style=""> 436                                                                                                          </span>
<span class="-2809861036487449932" onmouseenter="enter('-2809861036487449932');" onmouseout="out('-2809861036487449932');" style=""> 437       if (!temp.exists()) {                                                                              </span>
<span class="2335841033690112132" onmouseenter="enter('2335841033690112132');" onmouseout="out('2335841033690112132');" style=""> 438         ALog.i(TAG, String.format(&quot;分块文件【%s】不存在，该分块将重新开始&quot;, temp.getName()));                              </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style=""> 439         mRecord.isComplete = false;                                                                      </span>
<span class="-8890616152097691977" onmouseenter="enter('-8890616152097691977');" onmouseout="out('-8890616152097691977');" style=""> 440         mRecord.startLocation = mRecord.endLocation - threadRect;                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 441       } else {                                                                                           </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 442         /*                                                                                               </span>
<span class="3457188544010136028" onmouseenter="enter('3457188544010136028');" onmouseout="out('3457188544010136028');" style=""> 443          * 检查磁盘中的分块文件                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 444          */                                                                                              </span>
<span class="7157771772038955316" onmouseenter="enter('7157771772038955316');" onmouseout="out('7157771772038955316');" style=""> 445         if (blockFileLen &gt; threadRect) {                                                                 </span>
<span class="-3751962279648840181" onmouseenter="enter('-3751962279648840181');" onmouseout="out('-3751962279648840181');" style=""> 446           ALog.i(TAG, String.format(&quot;分块【%s】错误，将重新下载该分块&quot;, temp.getName()));                               </span>
<span class="-2826646494613153676" onmouseenter="enter('-2826646494613153676');" onmouseout="out('-2826646494613153676');" style=""> 447           temp.delete();                                                                                 </span>
<span class="8371392117975581366" onmouseenter="enter('8371392117975581366');" onmouseout="out('8371392117975581366');" style=""> 448           mRecord.startLocation = mRecord.endLocation - mRecord.blockLen;                                </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style=""> 449           mRecord.isComplete = false;                                                                    </span>
<span class="6776411255900347323" onmouseenter="enter('6776411255900347323');" onmouseout="out('6776411255900347323');" style=""> 450         } else if (blockFileLen &lt; mRecord.blockLen) {                                                    </span>
<span class="6584433194872596156" onmouseenter="enter('6584433194872596156');" onmouseout="out('6584433194872596156');" style=""> 451           mRecord.startLocation = mRecord.endLocation - mRecord.blockLen + blockFileLen;                 </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style=""> 452           mRecord.isComplete = false;                                                                    </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 453 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="3415967563254175421" onmouseenter="enter('3415967563254175421');" onmouseout="out('3415967563254175421');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 454           sendState(IThreadState.STATE_UPDATE_PROGRESS, null);                                           </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 455 ||||||| BASE                                                                                             </span>
<span class="-2224292797040621368" onmouseenter="enter('-2224292797040621368');" onmouseout="out('-2224292797040621368');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456         } else if (blockFileLen &lt; tr.blockLen) {                                                         </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 457 =======                                                                                                  </span>
<span class="6944687175787726084" onmouseenter="enter('6944687175787726084');" onmouseout="out('6944687175787726084');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 458           sendState(ThreadStateManager.STATE_UPDATE_PROGRESS, null);                                     </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 459 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-3869098922257348244" onmouseenter="enter('-3869098922257348244');" onmouseout="out('-3869098922257348244');" style=""> 460           ALog.i(TAG,                                                                                    </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 461 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="2733924598962321997" onmouseenter="enter('2733924598962321997');" onmouseout="out('2733924598962321997');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 462               String.format(&quot;修正分块【%s】记录，开始位置：%s，结束位置：%s&quot;, temp.getName(), mRecord.startLocation,         </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 463 ||||||| BASE                                                                                             </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464           tr.isComplete = false;                                                                         </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 465 =======                                                                                                  </span>
<span class="-9076885663859410178" onmouseenter="enter('-9076885663859410178');" onmouseout="out('-9076885663859410178');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 466               String.format(&quot;修正分块【%s】，开始位置：%s，结束位置：%s&quot;, temp.getName(), mRecord.startLocation,           </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 467 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="7451819391210675610" onmouseenter="enter('7451819391210675610');" onmouseout="out('7451819391210675610');" style=""> 468                   mRecord.endLocation));                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 469         } else {                                                                                         </span>
<span class="-6777046188674518761" onmouseenter="enter('-6777046188674518761');" onmouseout="out('-6777046188674518761');" style=""> 470           ALog.i(TAG, String.format(&quot;分块【%s】已完成，更新记录&quot;, temp.getName()));                                  </span>
<span class="-3752598072096250383" onmouseenter="enter('-3752598072096250383');" onmouseout="out('-3752598072096250383');" style=""> 471           mRecord.isComplete = true;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 473       }                                                                                                  </span>
<span class="-1713746282533100961" onmouseenter="enter('-1713746282533100961');" onmouseout="out('-1713746282533100961');" style=""> 474       mRecord.update();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 475     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 476   }                                                                                                      </span>
<span  style=""> 477                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 478   /**                                                                                                    </span>
<span class="590341144997189976" onmouseenter="enter('590341144997189976');" onmouseout="out('590341144997189976');" style=""> 479    * 发送任务完成的消息，并删除任务记录                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 480    */                                                                                                    </span>
<span class="1107873274627848500" onmouseenter="enter('1107873274627848500');" onmouseout="out('1107873274627848500');" style=""> 481   protected synchronized void sendCompleteMsg() {                                                        </span>
<span class="5765255273240095600" onmouseenter="enter('5765255273240095600');" onmouseout="out('5765255273240095600');" style=""> 482     ALog.i(TAG, String.format(&quot;任务【%s】完成&quot;, getFileName()));                                               </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 483 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="4674231415812911135" onmouseenter="enter('4674231415812911135');" onmouseout="out('4674231415812911135');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 484     sendState(IThreadState.STATE_COMPLETE, null);                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 485 ||||||| BASE                                                                                             </span>
<span class="3769004510167361430" onmouseenter="enter('3769004510167361430');" onmouseout="out('3769004510167361430');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486     CommonUtil.delTaskRecord(mEntity.getKey(), mEntity instanceof DownloadEntity ? 1 : 2, false,         </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 487 =======                                                                                                  </span>
<span class="7593389892196353154" onmouseenter="enter('7593389892196353154');" onmouseout="out('7593389892196353154');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 488     sendState(ThreadStateManager.STATE_COMPLETE, null);                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 489 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 490   }                                                                                                      </span>
<span  style=""> 491                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 492   /**                                                                                                    </span>
<span class="2603197968032099438" onmouseenter="enter('2603197968032099438');" onmouseout="out('2603197968032099438');" style=""> 493    * 发送失败信息                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 494    */                                                                                                    </span>
<span class="5094334093525103652" onmouseenter="enter('5094334093525103652');" onmouseout="out('5094334093525103652');" style=""> 495   protected void sendFailMsg(@Nullable BaseException e) {                                                </span>
<span class="-125198456384004571" onmouseenter="enter('-125198456384004571');" onmouseout="out('-125198456384004571');" style=""> 496     if (e != null) {                                                                                     </span>
<span class="-6551099466538715534" onmouseenter="enter('-6551099466538715534');" onmouseout="out('-6551099466538715534');" style=""> 497       Bundle b = new Bundle();                                                                           </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 498 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="6044105917207690073" onmouseenter="enter('6044105917207690073');" onmouseout="out('6044105917207690073');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 499       b.putSerializable(IThreadState.KEY_ERROR_INFO, e);                                                 </span>
<span class="-6547766989655415645" onmouseenter="enter('-6547766989655415645');" onmouseout="out('-6547766989655415645');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 500       sendState(IThreadState.STATE_FAIL, b);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 501     } else {                                                                                             </span>
<span class="6048350305855132996" onmouseenter="enter('6048350305855132996');" onmouseout="out('6048350305855132996');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 502       sendState(IThreadState.STATE_FAIL, null);                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 503 ||||||| BASE                                                                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 504 =======                                                                                                  </span>
<span class="2257003064329280544" onmouseenter="enter('2257003064329280544');" onmouseout="out('2257003064329280544');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505       b.putSerializable(ThreadStateManager.KEY_ERROR_INFO, e);                                           </span>
<span class="1053312846940829509" onmouseenter="enter('1053312846940829509');" onmouseout="out('1053312846940829509');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506       sendState(ThreadStateManager.STATE_FAIL, b);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507     } else {                                                                                             </span>
<span class="737994709921278984" onmouseenter="enter('737994709921278984');" onmouseout="out('737994709921278984');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508       sendState(ThreadStateManager.STATE_FAIL, null);                                                    </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 509 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 511   }                                                                                                      </span>
<span  style=""> 512                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 513   /**                                                                                                    </span>
<span class="6719845586187631935" onmouseenter="enter('6719845586187631935');" onmouseout="out('6719845586187631935');" style=""> 514    * 将记录写入到配置文件                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 515    *                                                                                                     </span>
<span class="6391874541652225431" onmouseenter="enter('6391874541652225431');" onmouseout="out('6391874541652225431');" style=""> 516    * @param isComplete 当前线程是否完成 {@code true}完成                                                           </span>
<span class="-5364023467485105638" onmouseenter="enter('-5364023467485105638');" onmouseout="out('-5364023467485105638');" style=""> 517    * @param record 当前下载进度                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 518    */                                                                                                    </span>
<span class="5027582220747789474" onmouseenter="enter('5027582220747789474');" onmouseout="out('5027582220747789474');" style=""> 519   protected void writeConfig(boolean isComplete, final long record) {                                    </span>
<span class="8605925134180182455" onmouseenter="enter('8605925134180182455');" onmouseout="out('8605925134180182455');" style=""> 520     if (mRecord != null) {                                                                               </span>
<span class="-5137168811759188909" onmouseenter="enter('-5137168811759188909');" onmouseout="out('-5137168811759188909');" style=""> 521       mRecord.isComplete = isComplete;                                                                   </span>
<span class="7525858464156079810" onmouseenter="enter('7525858464156079810');" onmouseout="out('7525858464156079810');" style=""> 522       if (mConfig.isBlock) {                                                                             </span>
<span class="5039999237965274971" onmouseenter="enter('5039999237965274971');" onmouseout="out('5039999237965274971');" style=""> 523         mRecord.startLocation = record;                                                                  </span>
<span class="-1667997194350191014" onmouseenter="enter('-1667997194350191014');" onmouseout="out('-1667997194350191014');" style=""> 524       } else if (mConfig.isOpenDynamicFile) {                                                            </span>
<span class="-7448644562741689657" onmouseenter="enter('-7448644562741689657');" onmouseout="out('-7448644562741689657');" style=""> 525         mRecord.startLocation = mConfig.tempFile.length();                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 526       } else {                                                                                           </span>
<span class="111068837356204936" onmouseenter="enter('111068837356204936');" onmouseout="out('111068837356204936');" style=""> 527         if (0 &lt; record &amp;&amp; record &lt; mRecord.endLocation) {                                                </span>
<span class="5039999237965274971" onmouseenter="enter('5039999237965274971');" onmouseout="out('5039999237965274971');" style=""> 528           mRecord.startLocation = record;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 530       }                                                                                                  </span>
<span class="-1713746282533100961" onmouseenter="enter('-1713746282533100961');" onmouseout="out('-1713746282533100961');" style=""> 531       mRecord.update();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 532     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 533   }                                                                                                      </span>
<span  style=""> 534                                                                                                          </span>
<span class="-624413037734427342" onmouseenter="enter('-624413037734427342');" onmouseout="out('-624413037734427342');" style=""> 535   @Override public AbsThreadTask call() throws Exception {                                               </span>
<span class="7231940989594771196" onmouseenter="enter('7231940989594771196');" onmouseout="out('7231940989594771196');" style=""> 536     isInterrupted = false;                                                                               </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style=""> 537     Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                       </span>
<span class="-1851318291295515457" onmouseenter="enter('-1851318291295515457');" onmouseout="out('-1851318291295515457');" style=""> 538     TrafficStats.setThreadStatsTag(UUID.randomUUID().toString().hashCode());                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 539     return this;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 540   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541 }                                                                                                        </span>



































</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16 package com.arialyy.aria.core.common;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="-6390350725830347024" onmouseenter="enter('-6390350725830347024');" onmouseout="out('-6390350725830347024');" style="">  18 import android.net.TrafficStats;                                                                         </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="">  19 import android.os.Bundle;                                                                                </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="">  20 import android.os.Handler;                                                                               </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="">  21 import android.os.Message;                                                                               </span>
<span class="3485143652294101472" onmouseenter="enter('3485143652294101472');" onmouseout="out('3485143652294101472');" style="">  22 import android.os.Process;                                                                               </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="">  23 import android.support.annotation.Nullable;                                                              </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  24 import com.arialyy.aria.core.AriaManager;                                                                </span>
<span class="-7940163229294156086" onmouseenter="enter('-7940163229294156086');" onmouseout="out('-7940163229294156086');" style="">  25 import com.arialyy.aria.core.config.BaseTaskConfig;                                                      </span>
<span class="-1126292087500355850" onmouseenter="enter('-1126292087500355850');" onmouseout="out('-1126292087500355850');" style="">  26 import com.arialyy.aria.core.config.DGroupConfig;                                                        </span>
<span class="1425241372324221776" onmouseenter="enter('1425241372324221776');" onmouseout="out('1425241372324221776');" style="">  27 import com.arialyy.aria.core.config.DownloadConfig;                                                      </span>
<span class="1322200574016778248" onmouseenter="enter('1322200574016778248');" onmouseout="out('1322200574016778248');" style="">  28 import com.arialyy.aria.core.config.UploadConfig;                                                        </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  29 import com.arialyy.aria.core.inf.AbsNormalEntity;                                                        </span>
<span class="8472156907075048576" onmouseenter="enter('8472156907075048576');" onmouseout="out('8472156907075048576');" style="">  30 import com.arialyy.aria.core.inf.AbsTaskWrapper;                                                         </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style="">  31 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-1066657515660882744" onmouseenter="enter('-1066657515660882744');" onmouseout="out('-1066657515660882744');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  32 import com.arialyy.aria.core.inf.ITaskWrapper;                                                           </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  33 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  34 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">  34 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  35 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style="">  37 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="5965657858743993748" onmouseenter="enter('5965657858743993748');" onmouseout="out('5965657858743993748');" style="">  38 import com.arialyy.aria.core.manager.ThreadTaskManager;                                                  </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="">  39 import com.arialyy.aria.exception.BaseException;                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  40 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="">  41 import com.arialyy.aria.util.BufferedRandomAccessFile;                                                   </span>
<span class="3933848313391255451" onmouseenter="enter('3933848313391255451');" onmouseout="out('3933848313391255451');" style="">  42 import com.arialyy.aria.util.ErrorHelp;                                                                  </span>
<span class="-3921447581486569047" onmouseenter="enter('-3921447581486569047');" onmouseout="out('-3921447581486569047');" style="">  43 import com.arialyy.aria.util.NetUtils;                                                                   </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  44 import java.io.File;                                                                                     </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  45 import java.util.UUID;                                                                                   </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  46 import java.util.concurrent.Callable;                                                                    </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  47 import java.util.concurrent.ExecutorService;                                                             </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  48 import java.util.concurrent.Executors;                                                                   </span>
<span  style="">  49                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50 /**                                                                                                      </span>
<span class="-7798270031920764735" onmouseenter="enter('-7798270031920764735');" onmouseout="out('-7798270031920764735');" style="">  51  * Created by lyy on 2017/1/18. 任务线程                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52  */                                                                                                      </span>
<span class="-2011608922755448217" onmouseenter="enter('-2011608922755448217');" onmouseout="out('-2011608922755448217');" style=""><abbr title="  53 public abstract class AbsThreadTask&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTITY&gt;&gt;">  53 public abstract class AbsThreadTask&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;E🔵</abbr></span>
<span class="6675695936259737122" onmouseenter="enter('6675695936259737122');" onmouseout="out('6675695936259737122');" style="">  54     implements Callable&lt;AbsThreadTask&gt; {                                                                 </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55   /**                                                                                                    </span>
<span class="-7421905703818920776" onmouseenter="enter('-7421905703818920776');" onmouseout="out('-7421905703818920776');" style="">  56    * 线程重试次数                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  57    */                                                                                                    </span>
<span class="2534354069603331424" onmouseenter="enter('2534354069603331424');" onmouseout="out('2534354069603331424');" style="">  58   private final int RETRY_NUM = 2;                                                                       </span>
<span  style="">  59                                                                                                          </span>
<span class="-6736605921341736924" onmouseenter="enter('-6736605921341736924');" onmouseout="out('-6736605921341736924');" style="">  60   private final String TAG = &quot;AbsThreadTask&quot;;                                                            </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  61   /**                                                                                                    </span>
<span class="5912262818254969140" onmouseenter="enter('5912262818254969140');" onmouseout="out('5912262818254969140');" style="">  62    * 当前子线程相对于总长度的位置                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  63    */                                                                                                    </span>
<span class="-6555994287222304012" onmouseenter="enter('-6555994287222304012');" onmouseout="out('-6555994287222304012');" style="">  64   protected long mChildCurrentLocation = 0;                                                              </span>
<span class="199695981196763510" onmouseenter="enter('199695981196763510');" onmouseout="out('199695981196763510');" style="">  65   private ENTITY mEntity;                                                                                </span>
<span class="4507751527304947270" onmouseenter="enter('4507751527304947270');" onmouseout="out('4507751527304947270');" style="">  66   protected TASK_WRAPPER mTaskWrapper;                                                                   </span>
<span class="7823640971996835282" onmouseenter="enter('7823640971996835282');" onmouseout="out('7823640971996835282');" style="">  67   private int mFailTimes = 0;                                                                            </span>
<span class="-2140378055800192500" onmouseenter="enter('-2140378055800192500');" onmouseout="out('-2140378055800192500');" style="">  68   private long mLastSaveTime;                                                                            </span>
<span class="7052955590557645990" onmouseenter="enter('7052955590557645990');" onmouseout="out('7052955590557645990');" style="">  69   private ExecutorService mConfigThreadPool;                                                             </span>
<span class="4205150814631290032" onmouseenter="enter('4205150814631290032');" onmouseout="out('4205150814631290032');" style="">  70   private boolean isNotNetRetry;  //断网情况是否重试                                                             </span>
<span class="-1742305716471965576" onmouseenter="enter('-1742305716471965576');" onmouseout="out('-1742305716471965576');" style="">  71   private boolean taskBreak = false;  //任务跳出                                                             </span>
<span class="7265458021260352388" onmouseenter="enter('7265458021260352388');" onmouseout="out('7265458021260352388');" style="">  72   protected BandwidthLimiter mSpeedBandUtil; //速度限制工具                                                    </span>
<span class="2782655601744072115" onmouseenter="enter('2782655601744072115');" onmouseout="out('2782655601744072115');" style="">  73   protected AriaManager mAridManager;                                                                    </span>
<span class="4110495559709840165" onmouseenter="enter('4110495559709840165');" onmouseout="out('4110495559709840165');" style="">  74   private boolean isInterrupted = false;                                                                 </span>
<span class="8034502532514277404" onmouseenter="enter('8034502532514277404');" onmouseout="out('8034502532514277404');" style="">  75   protected boolean isCancel = false, isStop = false;                                                    </span>
<span class="-161749363286472354" onmouseenter="enter('-161749363286472354');" onmouseout="out('-161749363286472354');" style="">  76   protected ThreadRecord mRecord;                                                                        </span>
<span class="8505538020780181250" onmouseenter="enter('8505538020780181250');" onmouseout="out('8505538020780181250');" style="">  77   private Handler mStateHandler;                                                                         </span>
<span class="-644453640718072602" onmouseenter="enter('-644453640718072602');" onmouseout="out('-644453640718072602');" style="">  78   private SubThreadConfig&lt;TASK_WRAPPER&gt; mConfig;                                                         </span>
<span  style="">  79                                                                                                          </span>
<span class="7317290166143616056" onmouseenter="enter('7317290166143616056');" onmouseout="out('7317290166143616056');" style="">  80   private Thread mConfigThread = new Thread(new Runnable() {                                             </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="">  81     @Override public void run() {                                                                        </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style="">  82       Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                     </span>
<span class="-5942055588561434981" onmouseenter="enter('-5942055588561434981');" onmouseout="out('-5942055588561434981');" style="">  83       final long currentTemp = mChildCurrentLocation;                                                    </span>
<span class="-8339432453951329407" onmouseenter="enter('-8339432453951329407');" onmouseout="out('-8339432453951329407');" style="">  84       writeConfig(false, currentTemp);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85     }                                                                                                    </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">  86   });                                                                                                    </span>
<span  style="">  87                                                                                                          </span>
<span class="-5675375355167610812" onmouseenter="enter('-5675375355167610812');" onmouseout="out('-5675375355167610812');" style="">  88   protected AbsThreadTask(SubThreadConfig&lt;TASK_WRAPPER&gt; config) {                                        </span>
<span class="-3079299502940909127" onmouseenter="enter('-3079299502940909127');" onmouseout="out('-3079299502940909127');" style="">  89     mConfig = config;                                                                                    </span>
<span class="7608526317231191360" onmouseenter="enter('7608526317231191360');" onmouseout="out('7608526317231191360');" style="">  90     mTaskWrapper = config.taskWrapper;                                                                   </span>
<span class="-9095243370238004613" onmouseenter="enter('-9095243370238004613');" onmouseout="out('-9095243370238004613');" style="">  91     mRecord = config.record;                                                                             </span>
<span class="2077392471576236354" onmouseenter="enter('2077392471576236354');" onmouseout="out('2077392471576236354');" style="">  92     mStateHandler = config.stateHandler;                                                                 </span>
<span class="-7408997685265206061" onmouseenter="enter('-7408997685265206061');" onmouseout="out('-7408997685265206061');" style="">  93     mEntity = mTaskWrapper.getEntity();                                                                  </span>
<span class="8631807426761684047" onmouseenter="enter('8631807426761684047');" onmouseout="out('8631807426761684047');" style="">  94     mLastSaveTime = System.currentTimeMillis();                                                          </span>
<span class="-6975975484715567483" onmouseenter="enter('-6975975484715567483');" onmouseout="out('-6975975484715567483');" style="">  95     mConfigThreadPool = Executors.newCachedThreadPool();                                                 </span>
<span class="1199175373698646667" onmouseenter="enter('1199175373698646667');" onmouseout="out('1199175373698646667');" style="">  96     mAridManager = AriaManager.getInstance(AriaManager.APP);                                             </span>
<span class="-8585141996075500857" onmouseenter="enter('-8585141996075500857');" onmouseout="out('-8585141996075500857');" style="">  97     if (getMaxSpeed() &gt; 0) {                                                                             </span>
<span class="2630549456901300935" onmouseenter="enter('2630549456901300935');" onmouseout="out('2630549456901300935');" style="">  98       mSpeedBandUtil = new BandwidthLimiter(getMaxSpeed(), config.startThreadNum);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99     }                                                                                                    </span>
<span class="-2615274212376114043" onmouseenter="enter('-2615274212376114043');" onmouseout="out('-2615274212376114043');" style=""> 100     isNotNetRetry = mAridManager.getAppConfig().isNotNetRetry();                                         </span>
<span class="-9180213342108359819" onmouseenter="enter('-9180213342108359819');" onmouseout="out('-9180213342108359819');" style=""> 101     mChildCurrentLocation = mRecord.startLocation;                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102   }                                                                                                      </span>
<span  style=""> 103                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 104   /**                                                                                                    </span>
<span class="-8737617058794341165" onmouseenter="enter('-8737617058794341165');" onmouseout="out('-8737617058794341165');" style=""> 105    * 当前线程处理的文件名                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 106    */                                                                                                    </span>
<span class="7302389212643046972" onmouseenter="enter('7302389212643046972');" onmouseout="out('7302389212643046972');" style=""> 107   protected String getFileName() {                                                                       </span>
<span class="4833117926548008502" onmouseenter="enter('4833117926548008502');" onmouseout="out('4833117926548008502');" style=""> 108     return mConfig.tempFile.getName();                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109   }                                                                                                      </span>
<span  style=""> 110                                                                                                          </span>
<span class="-3759066779726210536" onmouseenter="enter('-3759066779726210536');" onmouseout="out('-3759066779726210536');" style=""> 111   protected SubThreadConfig&lt;TASK_WRAPPER&gt; getConfig() {                                                  </span>
<span class="-7756481640167229217" onmouseenter="enter('-7756481640167229217');" onmouseout="out('-7756481640167229217');" style=""> 112     return mConfig;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113   }                                                                                                      </span>
<span  style=""> 114                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 115   /**                                                                                                    </span>
<span class="1636797617085164081" onmouseenter="enter('1636797617085164081');" onmouseout="out('1636797617085164081');" style=""> 116    * 设置线程是否中断                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 117    *                                                                                                     </span>
<span class="6061025491082520720" onmouseenter="enter('6061025491082520720');" onmouseout="out('6061025491082520720');" style=""> 118    * @param isInterrupted {@code true} 中断                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 119    */                                                                                                    </span>
<span class="-3489753654187641055" onmouseenter="enter('-3489753654187641055');" onmouseout="out('-3489753654187641055');" style=""> 120   public void setInterrupted(boolean isInterrupted) {                                                    </span>
<span class="3679723848447236272" onmouseenter="enter('3679723848447236272');" onmouseout="out('3679723848447236272');" style=""> 121     this.isInterrupted = isInterrupted;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122   }                                                                                                      </span>
<span  style=""> 123                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 124   /**                                                                                                    </span>
<span class="-9093294427063192169" onmouseenter="enter('-9093294427063192169');" onmouseout="out('-9093294427063192169');" style=""> 125    * 线程是否存活                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 126    *                                                                                                     </span>
<span class="-4472564326041631774" onmouseenter="enter('-4472564326041631774');" onmouseout="out('-4472564326041631774');" style=""> 127    * @return {@code true}存活                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 128    */                                                                                                    </span>
<span class="5343971881214349340" onmouseenter="enter('5343971881214349340');" onmouseout="out('5343971881214349340');" style=""> 129   protected boolean isLive() {                                                                           </span>
<span class="5056984206620082489" onmouseenter="enter('5056984206620082489');" onmouseout="out('5056984206620082489');" style=""> 130     return !Thread.currentThread().isInterrupted() &amp;&amp; !isInterrupted;                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131   }                                                                                                      </span>
<span  style=""> 132                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 133   /**                                                                                                    </span>
<span class="-1407135870976300" onmouseenter="enter('-1407135870976300');" onmouseout="out('-1407135870976300');" style=""> 134    * 当前线程是否完成，对于不支持断点的任务，一律未完成 {@code true} 完成；{@code false} 未完成                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 135    */                                                                                                    </span>
<span class="-5985760820188647103" onmouseenter="enter('-5985760820188647103');" onmouseout="out('-5985760820188647103');" style=""> 136   boolean isThreadComplete() {                                                                           </span>
<span class="-5832476025614563785" onmouseenter="enter('-5832476025614563785');" onmouseout="out('-5832476025614563785');" style=""> 137     return mRecord.isComplete;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138   }                                                                                                      </span>
<span  style=""> 139                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 140   /**                                                                                                    </span>
<span class="4246443053284865110" onmouseenter="enter('4246443053284865110');" onmouseout="out('4246443053284865110');" style=""> 141    * 获取实体                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 142    */                                                                                                    </span>
<span class="-2158320671868788574" onmouseenter="enter('-2158320671868788574');" onmouseout="out('-2158320671868788574');" style=""> 143   protected ENTITY getEntity() {                                                                         </span>
<span class="-2978486956956616380" onmouseenter="enter('-2978486956956616380');" onmouseout="out('-2978486956956616380');" style=""> 144     return mEntity;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145   }                                                                                                      </span>
<span  style=""> 146                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 147   /**                                                                                                    </span>
<span class="-6696632762627304447" onmouseenter="enter('-6696632762627304447');" onmouseout="out('-6696632762627304447');" style=""> 148    * 获取任务驱动对象                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 149    */                                                                                                    </span>
<span class="-7465189499125296678" onmouseenter="enter('-7465189499125296678');" onmouseout="out('-7465189499125296678');" style=""> 150   protected TASK_WRAPPER getTaskWrapper() {                                                              </span>
<span class="-6199220384104149910" onmouseenter="enter('-6199220384104149910');" onmouseout="out('-6199220384104149910');" style=""> 151     return mTaskWrapper;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152   }                                                                                                      </span>
<span  style=""> 153                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 154   /**                                                                                                    </span>
<span class="-8261306668739895881" onmouseenter="enter('-8261306668739895881');" onmouseout="out('-8261306668739895881');" style=""> 155    * 获取配置的最大上传/下载速度                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 156    *                                                                                                     </span>
<span class="5179376621123361386" onmouseenter="enter('5179376621123361386');" onmouseout="out('5179376621123361386');" style=""> 157    * @return 单位为：kb                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 158    */                                                                                                    </span>
<span class="-896115242554653093" onmouseenter="enter('-896115242554653093');" onmouseout="out('-896115242554653093');" style=""> 159   public abstract int getMaxSpeed();                                                                     </span>
<span  style=""> 160                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 161   /**                                                                                                    </span>
<span class="-7476262045555684443" onmouseenter="enter('-7476262045555684443');" onmouseout="out('-7476262045555684443');" style=""> 162    * 读取任务配置                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 163    *                                                                                                     </span>
<span class="2765744486349037181" onmouseenter="enter('2765744486349037181');" onmouseout="out('2765744486349037181');" style=""> 164    * @return {@link DownloadConfig}、{@link UploadConfig}、{@link DGroupConfig}                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 165    */                                                                                                    </span>
<span class="8843669963162911719" onmouseenter="enter('8843669963162911719');" onmouseout="out('8843669963162911719');" style=""> 166   protected abstract BaseTaskConfig getTaskConfig();                                                     </span>
<span  style=""> 167                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 168   /**                                                                                                    </span>
<span class="-440811555959535495" onmouseenter="enter('-440811555959535495');" onmouseout="out('-440811555959535495');" style=""> 169    * 设置最大下载速度                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 170    *                                                                                                     </span>
<span class="-1508955734956367613" onmouseenter="enter('-1508955734956367613');" onmouseout="out('-1508955734956367613');" style=""> 171    * @param speed 单位为：kb                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 172    */                                                                                                    </span>
<span class="-8974735338639184772" onmouseenter="enter('-8974735338639184772');" onmouseout="out('-8974735338639184772');" style=""> 173   public void setMaxSpeed(int speed) {                                                                   </span>
<span class="-649773427560821140" onmouseenter="enter('-649773427560821140');" onmouseout="out('-649773427560821140');" style=""> 174     if (mSpeedBandUtil != null) {                                                                        </span>
<span class="-7563158316316320789" onmouseenter="enter('-7563158316316320789');" onmouseout="out('-7563158316316320789');" style=""> 175       mSpeedBandUtil.setMaxRate(speed / mConfig.startThreadNum);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177   }                                                                                                      </span>
<span  style=""> 178                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 179   /**                                                                                                    </span>
<span class="6599720418575337619" onmouseenter="enter('6599720418575337619');" onmouseout="out('6599720418575337619');" style=""> 180    * 中断任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 181    */                                                                                                    </span>
<span class="4561569160041136245" onmouseenter="enter('4561569160041136245');" onmouseout="out('4561569160041136245');" style=""> 182   void breakTask() {                                                                                     </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 183     synchronized (AriaManager.LOCK) {                                                                    </span>
<span class="-3099491134649143832" onmouseenter="enter('-3099491134649143832');" onmouseout="out('-3099491134649143832');" style=""> 184       taskBreak = true;                                                                                  </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style=""> 185       if (mTaskWrapper.isSupportBP()) {                                                                  </span>
<span class="-5942055588561434981" onmouseenter="enter('-5942055588561434981');" onmouseout="out('-5942055588561434981');" style=""> 186         final long currentTemp = mChildCurrentLocation;                                                  </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 187 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="2043705367433474739" onmouseenter="enter('2043705367433474739');" onmouseout="out('2043705367433474739');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 188         sendState(IThreadState.STATE_STOP, null);                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 189 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 190 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 190 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 191 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192                                                                                                          </span>
<span class="4384426906541737800" onmouseenter="enter('4384426906541737800');" onmouseout="out('4384426906541737800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193         sendState(ThreadStateManager.STATE_STOP, null);                                                  </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 194 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="6146956303290790721" onmouseenter="enter('6146956303290790721');" onmouseout="out('6146956303290790721');" style=""> 195         ALog.d(TAG, String.format(&quot;任务【%s】thread__%s__中断【停止位置：%s】&quot;, getFileName(),                        </span>
<span class="376922911421079876" onmouseenter="enter('376922911421079876');" onmouseout="out('376922911421079876');" style=""> 196             mRecord.threadId, currentTemp));                                                             </span>
<span class="-8339432453951329407" onmouseenter="enter('-8339432453951329407');" onmouseout="out('-8339432453951329407');" style=""> 197         writeConfig(false, currentTemp);                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 198       } else {                                                                                           </span>
<span class="-2549462388866091673" onmouseenter="enter('-2549462388866091673');" onmouseout="out('-2549462388866091673');" style=""> 199         ALog.i(TAG, String.format(&quot;任务【%s】已中断&quot;, getFileName()));                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202   }                                                                                                      </span>
<span  style=""> 203                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 204   /**                                                                                                    </span>
<span class="5256203714917913991" onmouseenter="enter('5256203714917913991');" onmouseout="out('5256203714917913991');" style=""> 205    * 发送状态给状态处理器                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 206    *                                                                                                     </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 207 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-8049878616952568950" onmouseenter="enter('-8049878616952568950');" onmouseout="out('-8049878616952568950');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 208    * @param state {@link IThreadState#STATE_STOP}..                                                      </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 209 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 210 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 210 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 211 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212                                                                                                          </span>
<span class="-4769173749986063162" onmouseenter="enter('-4769173749986063162');" onmouseout="out('-4769173749986063162');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213    * @param state {@link ThreadStateManager#STATE_STOP}..                                                </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 214 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-4152917228807143386" onmouseenter="enter('-4152917228807143386');" onmouseout="out('-4152917228807143386');" style=""> 215    * @param bundle 而外数据                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 216    */                                                                                                    </span>
<span class="107634412995640864" onmouseenter="enter('107634412995640864');" onmouseout="out('107634412995640864');" style=""> 217   void sendState(int state, @Nullable Bundle bundle) {                                                   </span>
<span class="5312338573559356541" onmouseenter="enter('5312338573559356541');" onmouseout="out('5312338573559356541');" style=""> 218     Message msg = mStateHandler.obtainMessage();                                                         </span>
<span class="4586264514118761504" onmouseenter="enter('4586264514118761504');" onmouseout="out('4586264514118761504');" style=""> 219     msg.what = state;                                                                                    </span>
<span class="-3154970297737940190" onmouseenter="enter('-3154970297737940190');" onmouseout="out('-3154970297737940190');" style=""> 220     if (bundle != null) {                                                                                </span>
<span class="-5836915540506052451" onmouseenter="enter('-5836915540506052451');" onmouseout="out('-5836915540506052451');" style=""> 221       msg.setData(bundle);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222     }                                                                                                    </span>
<span class="-656061765258294758" onmouseenter="enter('-656061765258294758');" onmouseout="out('-656061765258294758');" style=""> 223     msg.sendToTarget();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224   }                                                                                                      </span>
<span  style=""> 225                                                                                                          </span>
<span class="5908327854870228087" onmouseenter="enter('5908327854870228087');" onmouseout="out('5908327854870228087');" style=""> 226   public boolean isInterrupted() {                                                                       </span>
<span class="-5203528151312862013" onmouseenter="enter('-5203528151312862013');" onmouseout="out('-5203528151312862013');" style=""> 227     return Thread.currentThread().isInterrupted();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228   }                                                                                                      </span>
<span  style=""> 229                                                                                                          </span>
<span class="-9198262987019797851" onmouseenter="enter('-9198262987019797851');" onmouseout="out('-9198262987019797851');" style=""> 230   @Override protected void finalize() throws Throwable {                                                 </span>
<span class="4114196779073131595" onmouseenter="enter('4114196779073131595');" onmouseout="out('4114196779073131595');" style=""> 231     super.finalize();                                                                                    </span>
<span class="-7477286483889370682" onmouseenter="enter('-7477286483889370682');" onmouseout="out('-7477286483889370682');" style=""> 232     if (mConfigThreadPool != null) {                                                                     </span>
<span class="6755739129057127055" onmouseenter="enter('6755739129057127055');" onmouseout="out('6755739129057127055');" style=""> 233       mConfigThreadPool.shutdown();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235   }                                                                                                      </span>
<span  style=""> 236                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 237   /**                                                                                                    </span>
<span class="4258051666929748339" onmouseenter="enter('4258051666929748339');" onmouseout="out('4258051666929748339');" style=""> 238    * 任务是否中断，中断条件： 1、任务取消 2、任务停止 3、手动中断 {@link #taskBreak}                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 239    *                                                                                                     </span>
<span class="8685725000128107952" onmouseenter="enter('8685725000128107952');" onmouseout="out('8685725000128107952');" style=""> 240    * @return {@code true} 中断，{@code false} 不是中断                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 241    */                                                                                                    </span>
<span class="1192236408818642919" onmouseenter="enter('1192236408818642919');" onmouseout="out('1192236408818642919');" style=""> 242   protected boolean isBreak() {                                                                          </span>
<span class="6435844081899071775" onmouseenter="enter('6435844081899071775');" onmouseout="out('6435844081899071775');" style=""> 243     return isCancel || isStop || taskBreak;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244   }                                                                                                      </span>
<span  style=""> 245                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 246   /**                                                                                                    </span>
<span class="-4436630274060532850" onmouseenter="enter('-4436630274060532850');" onmouseout="out('-4436630274060532850');" style=""> 247    * 检查下载完成的分块大小，如果下载完成的分块大小大于或小于分配的大小，则需要重新下载该分块 如果是非分块任务，直接返回{@code true}                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 248    *                                                                                                     </span>
<span class="-5962632420674681636" onmouseenter="enter('-5962632420674681636');" onmouseout="out('-5962632420674681636');" style=""> 249    * @return {@code true} 分块分大小正常，{@code false} 分块大小错误                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 250    */                                                                                                    </span>
<span class="-1715939541580522304" onmouseenter="enter('-1715939541580522304');" onmouseout="out('-1715939541580522304');" style=""> 251   protected boolean checkBlock() {                                                                       </span>
<span class="-8255347005712765724" onmouseenter="enter('-8255347005712765724');" onmouseout="out('-8255347005712765724');" style=""> 252     if (!mConfig.isBlock) {                                                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 253       return true;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254     }                                                                                                    </span>
<span class="3935656399577463427" onmouseenter="enter('3935656399577463427');" onmouseout="out('3935656399577463427');" style=""> 255     File blockFile = mConfig.tempFile;                                                                   </span>
<span class="-1695353633342038156" onmouseenter="enter('-1695353633342038156');" onmouseout="out('-1695353633342038156');" style=""> 256     if (!blockFile.exists() || blockFile.length() != mRecord.blockLen) {                                 </span>
<span class="-3869098922257348244" onmouseenter="enter('-3869098922257348244');" onmouseout="out('-3869098922257348244');" style=""> 257       ALog.i(TAG,                                                                                        </span>
<span class="-4253990883383800149" onmouseenter="enter('-4253990883383800149');" onmouseout="out('-4253990883383800149');" style=""> 258           String.format(&quot;分块【%s】错误，blockFileLen: %s, threadRect: %s; 即将重新下载该分块，开始位置：%s，结束位置：%s&quot;,          </span>
<span class="2939919814588467615" onmouseenter="enter('2939919814588467615');" onmouseout="out('2939919814588467615');" style=""> 259               blockFile.getName(), blockFile.length(), mRecord.blockLen, mRecord.startLocation,          </span>
<span class="7451819391210675610" onmouseenter="enter('7451819391210675610');" onmouseout="out('7451819391210675610');" style=""> 260               mRecord.endLocation));                                                                     </span>
<span class="-3823857485302692882" onmouseenter="enter('-3823857485302692882');" onmouseout="out('-3823857485302692882');" style=""> 261       if (blockFile.exists()) {                                                                          </span>
<span class="-8675830801645990020" onmouseenter="enter('-8675830801645990020');" onmouseout="out('-8675830801645990020');" style=""> 262         blockFile.delete();                                                                              </span>
<span class="2945539549828015550" onmouseenter="enter('2945539549828015550');" onmouseout="out('2945539549828015550');" style=""> 263         ALog.i(TAG, String.format(&quot;删除分块【%s】成功&quot;, blockFile.getName()));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264       }                                                                                                  </span>
<span class="-6720013085559771010" onmouseenter="enter('-6720013085559771010');" onmouseout="out('-6720013085559771010');" style=""> 265       retryThis(isBreak());                                                                              </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 266       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 268     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269   }                                                                                                      </span>
<span  style=""> 270                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 271   /**                                                                                                    </span>
<span class="-7882741939763414839" onmouseenter="enter('-7882741939763414839');" onmouseout="out('-7882741939763414839');" style=""> 272    * 停止任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 273    */                                                                                                    </span>
<span class="-1831798800985246753" onmouseenter="enter('-1831798800985246753');" onmouseout="out('-1831798800985246753');" style=""> 274   public void stop() {                                                                                   </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 275     synchronized (AriaManager.LOCK) {                                                                    </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style=""> 276       isStop = true;                                                                                     </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style=""> 277       if (mTaskWrapper.isSupportBP()) {                                                                  </span>
<span class="3999428278528562375" onmouseenter="enter('3999428278528562375');" onmouseout="out('3999428278528562375');" style=""> 278         final long stopLocation = mChildCurrentLocation;                                                 </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 279 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="2043705367433474739" onmouseenter="enter('2043705367433474739');" onmouseout="out('2043705367433474739');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 280         sendState(IThreadState.STATE_STOP, null);                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 281 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 282 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 282 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 283 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284                                                                                                          </span>
<span class="4384426906541737800" onmouseenter="enter('4384426906541737800');" onmouseout="out('4384426906541737800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285         sendState(ThreadStateManager.STATE_STOP, null);                                                  </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 286 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style=""> 287         ALog.d(TAG,                                                                                      </span>
<span class="1550861091873015536" onmouseenter="enter('1550861091873015536');" onmouseout="out('1550861091873015536');" style=""> 288             String.format(&quot;任务【%s】thread__%s__停止【当前线程停止位置：%s】&quot;, getFileName(),                            </span>
<span class="-867220232156674741" onmouseenter="enter('-867220232156674741');" onmouseout="out('-867220232156674741');" style=""> 289                 mRecord.threadId, stopLocation));                                                        </span>
<span class="7792260418457311232" onmouseenter="enter('7792260418457311232');" onmouseout="out('7792260418457311232');" style=""> 290         writeConfig(false, stopLocation);                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 291       } else {                                                                                           </span>
<span class="-8753703196049872436" onmouseenter="enter('-8753703196049872436');" onmouseout="out('-8753703196049872436');" style=""> 292         ALog.i(TAG, String.format(&quot;任务【%s】已停止&quot;, getFileName()));                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 293 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="2043705367433474739" onmouseenter="enter('2043705367433474739');" onmouseout="out('2043705367433474739');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 294         sendState(IThreadState.STATE_STOP, null);                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 295 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 296 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 296 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 297 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298                                                                                                          </span>
<span class="4384426906541737800" onmouseenter="enter('4384426906541737800');" onmouseout="out('4384426906541737800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299         sendState(ThreadStateManager.STATE_STOP, null);                                                  </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 300 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303   }                                                                                                      </span>
<span  style=""> 304                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 305   /**                                                                                                    </span>
<span class="7873398811029444044" onmouseenter="enter('7873398811029444044');" onmouseout="out('7873398811029444044');" style=""> 306    * 执行中                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 307    */                                                                                                    </span>
<span class="7428157636721718570" onmouseenter="enter('7428157636721718570');" onmouseout="out('7428157636721718570');" style=""> 308   protected void progress(long len) {                                                                    </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 309     synchronized (AriaManager.LOCK) {                                                                    </span>
<span class="2533028217200451003" onmouseenter="enter('2533028217200451003');" onmouseout="out('2533028217200451003');" style=""> 310       //if (getState().CURRENT_LOCATION &gt; getEntity().getFileSize() &amp;&amp; !getTaskWrapper().asHttp()        </span>
<span class="-1186412116255119268" onmouseenter="enter('-1186412116255119268');" onmouseout="out('-1186412116255119268');" style=""> 311       //    .isChunked()) {                                                                              </span>
<span class="-4532666615131915740" onmouseenter="enter('-4532666615131915740');" onmouseout="out('-4532666615131915740');" style=""> 312       //  String errorMsg =                                                                              </span>
<span class="518171698288030827" onmouseenter="enter('518171698288030827');" onmouseout="out('518171698288030827');" style=""> 313       //      String.format(&quot;下载失败，下载长度超出文件真实长度；currentLocation=%s, fileSize=%s&quot;,                         </span>
<span class="-3066839761455073570" onmouseenter="enter('-3066839761455073570');" onmouseout="out('-3066839761455073570');" style=""> 314       //          getState().CURRENT_LOCATION,                                                           </span>
<span class="-4715215170271404042" onmouseenter="enter('-4715215170271404042');" onmouseout="out('-4715215170271404042');" style=""> 315       //          getEntity().getFileSize());                                                            </span>
<span class="3035606892929688966" onmouseenter="enter('3035606892929688966');" onmouseout="out('3035606892929688966');" style=""> 316       //  taskBreak = true;                                                                              </span>
<span class="5067342317456439021" onmouseenter="enter('5067342317456439021');" onmouseout="out('5067342317456439021');" style=""> 317       //  fail(mChildCurrentLocation, new FileException(TAG, errorMsg), false);                          </span>
<span class="3500611444781325819" onmouseenter="enter('3500611444781325819');" onmouseout="out('3500611444781325819');" style=""> 318       //  return;                                                                                        </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style=""> 319       //}                                                                                                </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style=""> 320       mChildCurrentLocation += len;                                                                      </span>
<span class="-6345084862948761327" onmouseenter="enter('-6345084862948761327');" onmouseout="out('-6345084862948761327');" style=""> 321       if (!mStateHandler.getLooper().getThread().isAlive()) {                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 322         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323       }                                                                                                  </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 324 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-5752277786740261730" onmouseenter="enter('-5752277786740261730');" onmouseout="out('-5752277786740261730');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 325       mStateHandler.obtainMessage(IThreadState.STATE_RUNNING, len).sendToTarget();                       </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 326 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 327 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 327 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 328 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 329                                                                                                          </span>
<span class="7039631086012701451" onmouseenter="enter('7039631086012701451');" onmouseout="out('7039631086012701451');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 330       mStateHandler.obtainMessage(ThreadStateManager.STATE_RUNNING, len).sendToTarget();                 </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 331 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="8466413356993225320" onmouseenter="enter('8466413356993225320');" onmouseout="out('8466413356993225320');" style=""> 332       if (System.currentTimeMillis() - mLastSaveTime &gt; 5000                                              </span>
<span class="-4608803573017792643" onmouseenter="enter('-4608803573017792643');" onmouseout="out('-4608803573017792643');" style=""> 333           &amp;&amp; mChildCurrentLocation &lt; mRecord.endLocation) {                                              </span>
<span class="8631807426761684047" onmouseenter="enter('8631807426761684047');" onmouseout="out('8631807426761684047');" style=""> 334         mLastSaveTime = System.currentTimeMillis();                                                      </span>
<span class="6892340968550800051" onmouseenter="enter('6892340968550800051');" onmouseout="out('6892340968550800051');" style=""> 335         if (!mConfigThreadPool.isShutdown()) {                                                           </span>
<span class="5224309411782533590" onmouseenter="enter('5224309411782533590');" onmouseout="out('5224309411782533590');" style=""> 336           mConfigThreadPool.execute(mConfigThread);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340   }                                                                                                      </span>
<span  style=""> 341                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 342   /**                                                                                                    </span>
<span class="-1608425225589706128" onmouseenter="enter('-1608425225589706128');" onmouseout="out('-1608425225589706128');" style=""> 343    * 取消任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 344    */                                                                                                    </span>
<span class="-6930343012855552909" onmouseenter="enter('-6930343012855552909');" onmouseout="out('-6930343012855552909');" style=""> 345   public void cancel() {                                                                                 </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 346     synchronized (AriaManager.LOCK) {                                                                    </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style=""> 347       isCancel = true;                                                                                   </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 348 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="4419200793409452847" onmouseenter="enter('4419200793409452847');" onmouseout="out('4419200793409452847');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 349       sendState(IThreadState.STATE_CANCEL, null);                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 350 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 351 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 351 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 352 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353                                                                                                          </span>
<span class="5570544159779772188" onmouseenter="enter('5570544159779772188');" onmouseout="out('5570544159779772188');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354       sendState(ThreadStateManager.STATE_CANCEL, null);                                                  </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 355 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style=""> 356       ALog.d(TAG,                                                                                        </span>
<span class="-2078406994386200129" onmouseenter="enter('-2078406994386200129');" onmouseout="out('-2078406994386200129');" style=""> 357           String.format(&quot;任务【%s】thread__%s__取消&quot;, getFileName(), mRecord.threadId));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 358     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 359   }                                                                                                      </span>
<span  style=""> 360                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 361   /**                                                                                                    </span>
<span class="-3628170746268112272" onmouseenter="enter('-3628170746268112272');" onmouseout="out('-3628170746268112272');" style=""> 362    * 线程任务失败                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 363    *                                                                                                     </span>
<span class="6810672559305889194" onmouseenter="enter('6810672559305889194');" onmouseout="out('6810672559305889194');" style=""> 364    * @param subCurrentLocation 当前线程下载进度                                                                  </span>
<span class="774581074216290190" onmouseenter="enter('774581074216290190');" onmouseout="out('774581074216290190');" style=""> 365    * @param ex 异常信息                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 366    */                                                                                                    </span>
<span class="1500165102101720475" onmouseenter="enter('1500165102101720475');" onmouseout="out('1500165102101720475');" style=""> 367   protected void fail(final long subCurrentLocation, BaseException ex) {                                 </span>
<span class="-2149101237246601219" onmouseenter="enter('-2149101237246601219');" onmouseout="out('-2149101237246601219');" style=""> 368     fail(subCurrentLocation, ex, true);                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 369   }                                                                                                      </span>
<span  style=""> 370                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 371   /**                                                                                                    </span>
<span class="7725539954827761966" onmouseenter="enter('7725539954827761966');" onmouseout="out('7725539954827761966');" style=""> 372    * 任务失败                                                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 373    *                                                                                                     </span>
<span class="7399711965916828500" onmouseenter="enter('7399711965916828500');" onmouseout="out('7399711965916828500');" style=""> 374    * @param subCurrentLocation 当前子线程进度                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 375    */                                                                                                    </span>
<span class="3846496864338478922" onmouseenter="enter('3846496864338478922');" onmouseout="out('3846496864338478922');" style=""> 376   protected void fail(final long subCurrentLocation, BaseException ex, boolean needRetry) {              </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style=""> 377     if (ex != null) {                                                                                    </span>
<span class="-333456365485290101" onmouseenter="enter('-333456365485290101');" onmouseout="out('-333456365485290101');" style=""> 378       ALog.e(TAG, ALog.getExceptionString(ex));                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379     }                                                                                                    </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 380 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="6310848794744788402" onmouseenter="enter('6310848794744788402');" onmouseout="out('6310848794744788402');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 381     if (mTaskWrapper.getRequestType() == ITaskWrapper.M3U8_FILE) {                                       </span>
<span class="4742082000916781311" onmouseenter="enter('4742082000916781311');" onmouseout="out('4742082000916781311');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 382       writeConfig(false, 0);                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 383 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 384 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 384 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 385 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386                                                                                                          </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387     if (mTaskWrapper.isSupportBP()) {                                                                    </span>
<span class="5636262962850437364" onmouseenter="enter('5636262962850437364');" onmouseout="out('5636262962850437364');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388       writeConfig(false, subCurrentLocation);                                                            </span>
<span class="7955132104080368983" onmouseenter="enter('7955132104080368983');" onmouseout="out('7955132104080368983');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389       retryThis(needRetry &amp;&amp; mConfig.startThreadNum != 1);                                               </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 390 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 391     } else {                                                                                             </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 392 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 393       if (mTaskWrapper.isSupportBP()) {                                                                  </span>
<span class="5636262962850437364" onmouseenter="enter('5636262962850437364');" onmouseout="out('5636262962850437364');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 394         writeConfig(false, subCurrentLocation);                                                          </span>
<span class="7955132104080368983" onmouseenter="enter('7955132104080368983');" onmouseout="out('7955132104080368983');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 395         retryThis(needRetry &amp;&amp; mConfig.startThreadNum != 1);                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 396       } else {                                                                                           </span>
<span class="6613685008099650869" onmouseenter="enter('6613685008099650869');" onmouseout="out('6613685008099650869');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 397         ALog.e(TAG, String.format(&quot;任务【%s】执行失败&quot;, getFileName()));                                         </span>
<span class="6290350204306664705" onmouseenter="enter('6290350204306664705');" onmouseout="out('6290350204306664705');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 398         ErrorHelp.saveError(TAG, &quot;&quot;, ALog.getExceptionString(ex));                                       </span>
<span class="-3645539894315514142" onmouseenter="enter('-3645539894315514142');" onmouseout="out('-3645539894315514142');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 399         sendFailMsg(null);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 400       }                                                                                                  </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 401 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 402 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 402 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 403 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404                                                                                                          </span>
<span class="6613685008099650869" onmouseenter="enter('6613685008099650869');" onmouseout="out('6613685008099650869');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405       ALog.e(TAG, String.format(&quot;任务【%s】执行失败&quot;, getFileName()));                                           </span>
<span class="6290350204306664705" onmouseenter="enter('6290350204306664705');" onmouseout="out('6290350204306664705');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406       ErrorHelp.saveError(TAG, &quot;&quot;, ALog.getExceptionString(ex));                                         </span>
<span class="-3645539894315514142" onmouseenter="enter('-3645539894315514142');" onmouseout="out('-3645539894315514142');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 407       sendFailMsg(null);                                                                                 </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 408 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 409     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 410   }                                                                                                      </span>
<span  style=""> 411                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 412   /**                                                                                                    </span>
<span class="-9093725986363149842" onmouseenter="enter('-9093725986363149842');" onmouseout="out('-9093725986363149842');" style=""> 413    * 重试当前线程，如果其中一条线程已经下载失败，则任务该任务下载失败，并且停止该任务的所有线程                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 414    *                                                                                                     </span>
<span class="-7715462203363144181" onmouseenter="enter('-7715462203363144181');" onmouseout="out('-7715462203363144181');" style=""> 415    * @param needRetry 是否可以重试                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 416    */                                                                                                    </span>
<span class="-4017949080492709723" onmouseenter="enter('-4017949080492709723');" onmouseout="out('-4017949080492709723');" style=""> 417   private void retryThis(boolean needRetry) {                                                            </span>
<span class="3310386334432410672" onmouseenter="enter('3310386334432410672');" onmouseout="out('3310386334432410672');" style=""> 418     if (!NetUtils.isConnected(AriaManager.APP) &amp;&amp; !isNotNetRetry) {                                      </span>
<span class="-540477151182203063" onmouseenter="enter('-540477151182203063');" onmouseout="out('-540477151182203063');" style=""> 419       ALog.w(TAG, String.format(&quot;任务【%s】重试失败，网络未连接&quot;, getFileName()));                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 420     }                                                                                                    </span>
<span class="1591223325682575890" onmouseenter="enter('1591223325682575890');" onmouseout="out('1591223325682575890');" style=""> 421     if (mFailTimes &lt; RETRY_NUM &amp;&amp; needRetry &amp;&amp; (NetUtils.isConnected(AriaManager.APP)                    </span>
<span class="8286758897154980077" onmouseenter="enter('8286758897154980077');" onmouseout="out('8286758897154980077');" style=""> 422         || isNotNetRetry) &amp;&amp; !isBreak()) {                                                               </span>
<span class="-3870082629414944375" onmouseenter="enter('-3870082629414944375');" onmouseout="out('-3870082629414944375');" style=""> 423       ALog.w(TAG, String.format(&quot;任务【%s】正在重试&quot;, getFileName()));                                           </span>
<span class="-1094790045894886583" onmouseenter="enter('-1094790045894886583');" onmouseout="out('-1094790045894886583');" style=""> 424       mFailTimes++;                                                                                      </span>
<span class="4458054822073455179" onmouseenter="enter('4458054822073455179');" onmouseout="out('4458054822073455179');" style=""> 425       handleRetryRecord();                                                                               </span>
<span class="5034263136405999116" onmouseenter="enter('5034263136405999116');" onmouseout="out('5034263136405999116');" style=""> 426       ThreadTaskManager.getInstance().retryThread(AbsThreadTask.this);                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 427     } else {                                                                                             </span>
<span class="-3645539894315514142" onmouseenter="enter('-3645539894315514142');" onmouseout="out('-3645539894315514142');" style=""> 428       sendFailMsg(null);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 429     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 430   }                                                                                                      </span>
<span  style=""> 431                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 432   /**                                                                                                    </span>
<span class="2024814027088983613" onmouseenter="enter('2024814027088983613');" onmouseout="out('2024814027088983613');" style=""> 433    * 处理线程重试的记录，只有多线程任务才会执行                                                                               </span>
<span class="7355073000228872615" onmouseenter="enter('7355073000228872615');" onmouseout="out('7355073000228872615');" style=""> 434    * 如果是以前版本{@link BufferedRandomAccessFile}创建的下载，那么 record.startLocation不用修改                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 435    */                                                                                                    </span>
<span class="6729287348781078107" onmouseenter="enter('6729287348781078107');" onmouseout="out('6729287348781078107');" style=""> 436   private void handleRetryRecord() {                                                                     </span>
<span class="7525858464156079810" onmouseenter="enter('7525858464156079810');" onmouseout="out('7525858464156079810');" style=""> 437     if (mConfig.isBlock) {                                                                               </span>
<span class="-6754358035051648935" onmouseenter="enter('-6754358035051648935');" onmouseout="out('-6754358035051648935');" style=""> 438       // 默认线程分块长度                                                                                        </span>
<span class="669945524285390040" onmouseenter="enter('669945524285390040');" onmouseout="out('669945524285390040');" style=""> 439       File temp = mConfig.tempFile;                                                                      </span>
<span  style=""> 440                                                                                                          </span>
<span class="-793137946029070789" onmouseenter="enter('-793137946029070789');" onmouseout="out('-793137946029070789');" style=""> 441       long blockFileLen = temp.length(); // 磁盘中的分块文件长度                                                   </span>
<span class="8378527770954177996" onmouseenter="enter('8378527770954177996');" onmouseout="out('8378527770954177996');" style=""> 442       long threadRect = mRecord.blockLen;     // 当前线程的区间                                                 </span>
<span  style=""> 443                                                                                                          </span>
<span class="-2809861036487449932" onmouseenter="enter('-2809861036487449932');" onmouseout="out('-2809861036487449932');" style=""> 444       if (!temp.exists()) {                                                                              </span>
<span class="2335841033690112132" onmouseenter="enter('2335841033690112132');" onmouseout="out('2335841033690112132');" style=""> 445         ALog.i(TAG, String.format(&quot;分块文件【%s】不存在，该分块将重新开始&quot;, temp.getName()));                              </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style=""> 446         mRecord.isComplete = false;                                                                      </span>
<span class="-8890616152097691977" onmouseenter="enter('-8890616152097691977');" onmouseout="out('-8890616152097691977');" style=""> 447         mRecord.startLocation = mRecord.endLocation - threadRect;                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 448       } else {                                                                                           </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 449         /*                                                                                               </span>
<span class="3457188544010136028" onmouseenter="enter('3457188544010136028');" onmouseout="out('3457188544010136028');" style=""> 450          * 检查磁盘中的分块文件                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 451          */                                                                                              </span>
<span class="7157771772038955316" onmouseenter="enter('7157771772038955316');" onmouseout="out('7157771772038955316');" style=""> 452         if (blockFileLen &gt; threadRect) {                                                                 </span>
<span class="-3751962279648840181" onmouseenter="enter('-3751962279648840181');" onmouseout="out('-3751962279648840181');" style=""> 453           ALog.i(TAG, String.format(&quot;分块【%s】错误，将重新下载该分块&quot;, temp.getName()));                               </span>
<span class="-2826646494613153676" onmouseenter="enter('-2826646494613153676');" onmouseout="out('-2826646494613153676');" style=""> 454           temp.delete();                                                                                 </span>
<span class="8371392117975581366" onmouseenter="enter('8371392117975581366');" onmouseout="out('8371392117975581366');" style=""> 455           mRecord.startLocation = mRecord.endLocation - mRecord.blockLen;                                </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style=""> 456           mRecord.isComplete = false;                                                                    </span>
<span class="6776411255900347323" onmouseenter="enter('6776411255900347323');" onmouseout="out('6776411255900347323');" style=""> 457         } else if (blockFileLen &lt; mRecord.blockLen) {                                                    </span>
<span class="6584433194872596156" onmouseenter="enter('6584433194872596156');" onmouseout="out('6584433194872596156');" style=""> 458           mRecord.startLocation = mRecord.endLocation - mRecord.blockLen + blockFileLen;                 </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style=""> 459           mRecord.isComplete = false;                                                                    </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 460 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="3415967563254175421" onmouseenter="enter('3415967563254175421');" onmouseout="out('3415967563254175421');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 461           sendState(IThreadState.STATE_UPDATE_PROGRESS, null);                                           </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 462 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 463 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 463 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 464 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 465                                                                                                          </span>
<span class="6944687175787726084" onmouseenter="enter('6944687175787726084');" onmouseout="out('6944687175787726084');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 466           sendState(ThreadStateManager.STATE_UPDATE_PROGRESS, null);                                     </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 467 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-3869098922257348244" onmouseenter="enter('-3869098922257348244');" onmouseout="out('-3869098922257348244');" style=""> 468           ALog.i(TAG,                                                                                    </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 469 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="2733924598962321997" onmouseenter="enter('2733924598962321997');" onmouseout="out('2733924598962321997');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 470               String.format(&quot;修正分块【%s】记录，开始位置：%s，结束位置：%s&quot;, temp.getName(), mRecord.startLocation,         </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 471 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 472 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 472 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 473 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 474                                                                                                          </span>
<span class="-9076885663859410178" onmouseenter="enter('-9076885663859410178');" onmouseout="out('-9076885663859410178');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 475               String.format(&quot;修正分块【%s】，开始位置：%s，结束位置：%s&quot;, temp.getName(), mRecord.startLocation,           </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 476 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="7451819391210675610" onmouseenter="enter('7451819391210675610');" onmouseout="out('7451819391210675610');" style=""> 477                   mRecord.endLocation));                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 478         } else {                                                                                         </span>
<span class="-6777046188674518761" onmouseenter="enter('-6777046188674518761');" onmouseout="out('-6777046188674518761');" style=""> 479           ALog.i(TAG, String.format(&quot;分块【%s】已完成，更新记录&quot;, temp.getName()));                                  </span>
<span class="-3752598072096250383" onmouseenter="enter('-3752598072096250383');" onmouseout="out('-3752598072096250383');" style=""> 480           mRecord.isComplete = true;                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 482       }                                                                                                  </span>
<span class="-1713746282533100961" onmouseenter="enter('-1713746282533100961');" onmouseout="out('-1713746282533100961');" style=""> 483       mRecord.update();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 484     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 485   }                                                                                                      </span>
<span  style=""> 486                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 487   /**                                                                                                    </span>
<span class="590341144997189976" onmouseenter="enter('590341144997189976');" onmouseout="out('590341144997189976');" style=""> 488    * 发送任务完成的消息，并删除任务记录                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 489    */                                                                                                    </span>
<span class="1107873274627848500" onmouseenter="enter('1107873274627848500');" onmouseout="out('1107873274627848500');" style=""> 490   protected synchronized void sendCompleteMsg() {                                                        </span>
<span class="5765255273240095600" onmouseenter="enter('5765255273240095600');" onmouseout="out('5765255273240095600');" style=""> 491     ALog.i(TAG, String.format(&quot;任务【%s】完成&quot;, getFileName()));                                               </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 492 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="4674231415812911135" onmouseenter="enter('4674231415812911135');" onmouseout="out('4674231415812911135');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 493     sendState(IThreadState.STATE_COMPLETE, null);                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 494 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 495 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 495 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 496 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 497                                                                                                          </span>
<span class="7593389892196353154" onmouseenter="enter('7593389892196353154');" onmouseout="out('7593389892196353154');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 498     sendState(ThreadStateManager.STATE_COMPLETE, null);                                                  </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 499 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500   }                                                                                                      </span>
<span  style=""> 501                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 502   /**                                                                                                    </span>
<span class="2603197968032099438" onmouseenter="enter('2603197968032099438');" onmouseout="out('2603197968032099438');" style=""> 503    * 发送失败信息                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 504    */                                                                                                    </span>
<span class="5094334093525103652" onmouseenter="enter('5094334093525103652');" onmouseout="out('5094334093525103652');" style=""> 505   protected void sendFailMsg(@Nullable BaseException e) {                                                </span>
<span class="-125198456384004571" onmouseenter="enter('-125198456384004571');" onmouseout="out('-125198456384004571');" style=""> 506     if (e != null) {                                                                                     </span>
<span class="-6551099466538715534" onmouseenter="enter('-6551099466538715534');" onmouseout="out('-6551099466538715534');" style=""> 507       Bundle b = new Bundle();                                                                           </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 508 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="6044105917207690073" onmouseenter="enter('6044105917207690073');" onmouseout="out('6044105917207690073');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 509       b.putSerializable(IThreadState.KEY_ERROR_INFO, e);                                                 </span>
<span class="-6547766989655415645" onmouseenter="enter('-6547766989655415645');" onmouseout="out('-6547766989655415645');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 510       sendState(IThreadState.STATE_FAIL, b);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 511     } else {                                                                                             </span>
<span class="6048350305855132996" onmouseenter="enter('6048350305855132996');" onmouseout="out('6048350305855132996');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 512       sendState(IThreadState.STATE_FAIL, null);                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 513 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 514 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 514 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 515 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516                                                                                                          </span>
<span class="2257003064329280544" onmouseenter="enter('2257003064329280544');" onmouseout="out('2257003064329280544');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517       b.putSerializable(ThreadStateManager.KEY_ERROR_INFO, e);                                           </span>
<span class="1053312846940829509" onmouseenter="enter('1053312846940829509');" onmouseout="out('1053312846940829509');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518       sendState(ThreadStateManager.STATE_FAIL, b);                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519     } else {                                                                                             </span>
<span class="737994709921278984" onmouseenter="enter('737994709921278984');" onmouseout="out('737994709921278984');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520       sendState(ThreadStateManager.STATE_FAIL, null);                                                    </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 521 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 522     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 523   }                                                                                                      </span>
<span  style=""> 524                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 525   /**                                                                                                    </span>
<span class="6719845586187631935" onmouseenter="enter('6719845586187631935');" onmouseout="out('6719845586187631935');" style=""> 526    * 将记录写入到配置文件                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 527    *                                                                                                     </span>
<span class="6391874541652225431" onmouseenter="enter('6391874541652225431');" onmouseout="out('6391874541652225431');" style=""> 528    * @param isComplete 当前线程是否完成 {@code true}完成                                                           </span>
<span class="-5364023467485105638" onmouseenter="enter('-5364023467485105638');" onmouseout="out('-5364023467485105638');" style=""> 529    * @param record 当前下载进度                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 530    */                                                                                                    </span>
<span class="5027582220747789474" onmouseenter="enter('5027582220747789474');" onmouseout="out('5027582220747789474');" style=""> 531   protected void writeConfig(boolean isComplete, final long record) {                                    </span>
<span class="8605925134180182455" onmouseenter="enter('8605925134180182455');" onmouseout="out('8605925134180182455');" style=""> 532     if (mRecord != null) {                                                                               </span>
<span class="-5137168811759188909" onmouseenter="enter('-5137168811759188909');" onmouseout="out('-5137168811759188909');" style=""> 533       mRecord.isComplete = isComplete;                                                                   </span>
<span class="7525858464156079810" onmouseenter="enter('7525858464156079810');" onmouseout="out('7525858464156079810');" style=""> 534       if (mConfig.isBlock) {                                                                             </span>
<span class="5039999237965274971" onmouseenter="enter('5039999237965274971');" onmouseout="out('5039999237965274971');" style=""> 535         mRecord.startLocation = record;                                                                  </span>
<span class="-1667997194350191014" onmouseenter="enter('-1667997194350191014');" onmouseout="out('-1667997194350191014');" style=""> 536       } else if (mConfig.isOpenDynamicFile) {                                                            </span>
<span class="-7448644562741689657" onmouseenter="enter('-7448644562741689657');" onmouseout="out('-7448644562741689657');" style=""> 537         mRecord.startLocation = mConfig.tempFile.length();                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 538       } else {                                                                                           </span>
<span class="111068837356204936" onmouseenter="enter('111068837356204936');" onmouseout="out('111068837356204936');" style=""> 539         if (0 &lt; record &amp;&amp; record &lt; mRecord.endLocation) {                                                </span>
<span class="5039999237965274971" onmouseenter="enter('5039999237965274971');" onmouseout="out('5039999237965274971');" style=""> 540           mRecord.startLocation = record;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 541         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 542       }                                                                                                  </span>
<span class="-1713746282533100961" onmouseenter="enter('-1713746282533100961');" onmouseout="out('-1713746282533100961');" style=""> 543       mRecord.update();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 544     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 545   }                                                                                                      </span>
<span  style=""> 546                                                                                                          </span>
<span class="-624413037734427342" onmouseenter="enter('-624413037734427342');" onmouseout="out('-624413037734427342');" style=""> 547   @Override public AbsThreadTask call() throws Exception {                                               </span>
<span class="7231940989594771196" onmouseenter="enter('7231940989594771196');" onmouseout="out('7231940989594771196');" style=""> 548     isInterrupted = false;                                                                               </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style=""> 549     Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                       </span>
<span class="-1851318291295515457" onmouseenter="enter('-1851318291295515457');" onmouseout="out('-1851318291295515457');" style=""> 550     TrafficStats.setThreadStatsTag(UUID.randomUUID().toString().hashCode());                             </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 551     return this;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 552   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 553 }                                                                                                        </span>























</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16  package com.arialyy.aria.core.common;                                                                             </span>
<span  style="">  17                                                                                                                    </span>
<span class="-6390350725830347024" onmouseenter="enter('-6390350725830347024');" onmouseout="out('-6390350725830347024');" style="">  18  import android.net.TrafficStats;                                                                                  </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  19 +import android.os.Bundle;                                                                                         </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  20 +import android.os.Handler;                                                                                        </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  21 +import android.os.Message;                                                                                        </span>
<span class="3485143652294101472" onmouseenter="enter('3485143652294101472');" onmouseout="out('3485143652294101472');" style="">  22  import android.os.Process;                                                                                        </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  23 +import android.support.annotation.Nullable;                                                                       </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  24  import com.arialyy.aria.core.AriaManager;                                                                         </span>
<span class="-7940163229294156086" onmouseenter="enter('-7940163229294156086');" onmouseout="out('-7940163229294156086');" style="">  25  import com.arialyy.aria.core.config.BaseTaskConfig;                                                               </span>
<span class="-1126292087500355850" onmouseenter="enter('-1126292087500355850');" onmouseout="out('-1126292087500355850');" style="">  26  import com.arialyy.aria.core.config.DGroupConfig;                                                                 </span>
<span class="1425241372324221776" onmouseenter="enter('1425241372324221776');" onmouseout="out('1425241372324221776');" style="">  27  import com.arialyy.aria.core.config.DownloadConfig;                                                               </span>
<span class="1322200574016778248" onmouseenter="enter('1322200574016778248');" onmouseout="out('1322200574016778248');" style="">  28  import com.arialyy.aria.core.config.UploadConfig;                                                                 </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import com.arialyy.aria.core.download.DownloadEntity;                                                             </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  30  import com.arialyy.aria.core.inf.AbsNormalEntity;                                                                 </span>
<span class="8472156907075048576" onmouseenter="enter('8472156907075048576');" onmouseout="out('8472156907075048576');" style="">  31  import com.arialyy.aria.core.inf.AbsTaskWrapper;                                                                  </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -import com.arialyy.aria.core.inf.IEventListener;                                                                  </span>
<span class="-1066657515660882744" onmouseenter="enter('-1066657515660882744');" onmouseout="out('-1066657515660882744');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  33 +import com.arialyy.aria.core.inf.ITaskWrapper;                                                                    </span>
<span class="5965657858743993748" onmouseenter="enter('5965657858743993748');" onmouseout="out('5965657858743993748');" style="">  34  import com.arialyy.aria.core.manager.ThreadTaskManager;                                                           </span>
<span class="-5831681804875068292" onmouseenter="enter('-5831681804875068292');" onmouseout="out('-5831681804875068292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  35 -import com.arialyy.aria.core.upload.UploadEntity;                                                                 </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="">  36  import com.arialyy.aria.exception.BaseException;                                                                  </span>
<span class="2312101434658071953" onmouseenter="enter('2312101434658071953');" onmouseout="out('2312101434658071953');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -import com.arialyy.aria.exception.FileException;                                                                  </span>
<span class="-5001091348570971924" onmouseenter="enter('-5001091348570971924');" onmouseout="out('-5001091348570971924');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -import com.arialyy.aria.exception.TaskException;                                                                  </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  39  import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  40 -import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  41 +import com.arialyy.aria.util.BufferedRandomAccessFile;                                                            </span>
<span class="3933848313391255451" onmouseenter="enter('3933848313391255451');" onmouseout="out('3933848313391255451');" style="">  42  import com.arialyy.aria.util.ErrorHelp;                                                                           </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  43 -import com.arialyy.aria.util.FileUtil;                                                                            </span>
<span class="-3921447581486569047" onmouseenter="enter('-3921447581486569047');" onmouseout="out('-3921447581486569047');" style="">  44  import com.arialyy.aria.util.NetUtils;                                                                            </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  45  import java.io.File;                                                                                              </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  46 -import java.util.ArrayList;                                                                                       </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  47 -import java.util.List;                                                                                            </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  48  import java.util.UUID;                                                                                            </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  49  import java.util.concurrent.Callable;                                                                             </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  50  import java.util.concurrent.ExecutorService;                                                                      </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  51  import java.util.concurrent.Executors;                                                                            </span>
<span  style="">  52                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  53  /**                                                                                                               </span>
<span class="-7798270031920764735" onmouseenter="enter('-7798270031920764735');" onmouseout="out('-7798270031920764735');" style="">  54   * Created by lyy on 2017/1/18. 任务线程                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  55   */                                                                                                               </span>
<span class="-2011608922755448217" onmouseenter="enter('-2011608922755448217');" onmouseout="out('-2011608922755448217');" style="">  56  public abstract class AbsThreadTask&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTITY&gt;&gt;  </span>
<span class="6675695936259737122" onmouseenter="enter('6675695936259737122');" onmouseout="out('6675695936259737122');" style="">  57      implements Callable&lt;AbsThreadTask&gt; {                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  58    /**                                                                                                             </span>
<span class="-7421905703818920776" onmouseenter="enter('-7421905703818920776');" onmouseout="out('-7421905703818920776');" style="">  59     * 线程重试次数                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  60     */                                                                                                             </span>
<span class="2534354069603331424" onmouseenter="enter('2534354069603331424');" onmouseout="out('2534354069603331424');" style="">  61    private final int RETRY_NUM = 2;                                                                                </span>
<span  style="">  62                                                                                                                    </span>
<span class="-6736605921341736924" onmouseenter="enter('-6736605921341736924');" onmouseout="out('-6736605921341736924');" style="">  63    private final String TAG = &quot;AbsThreadTask&quot;;                                                                     </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  64    /**                                                                                                             </span>
<span class="5912262818254969140" onmouseenter="enter('5912262818254969140');" onmouseout="out('5912262818254969140');" style="">  65     * 当前子线程相对于总长度的位置                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  66     */                                                                                                             </span>
<span class="-6555994287222304012" onmouseenter="enter('-6555994287222304012');" onmouseout="out('-6555994287222304012');" style="">  67    protected long mChildCurrentLocation = 0;                                                                       </span>
<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  68 -  protected IEventListener mListener;                                                                             </span>
<span class="7423688287198995687" onmouseenter="enter('7423688287198995687');" onmouseout="out('7423688287198995687');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  69 -  private StateConstance sState;                                                                                  </span>
<span class="-531667924955094712" onmouseenter="enter('-531667924955094712');" onmouseout="out('-531667924955094712');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  70 -  private SubThreadConfig&lt;TASK_WRAPPER&gt; sConfig;                                                                  </span>
<span class="199695981196763510" onmouseenter="enter('199695981196763510');" onmouseout="out('199695981196763510');" style="">  71    private ENTITY mEntity;                                                                                         </span>
<span class="-6503818311630937885" onmouseenter="enter('-6503818311630937885');" onmouseout="out('-6503818311630937885');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  72 -  private TASK_WRAPPER mTaskWrapper;                                                                              </span>
<span class="4507751527304947270" onmouseenter="enter('4507751527304947270');" onmouseout="out('4507751527304947270');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +  protected TASK_WRAPPER mTaskWrapper;                                                                            </span>
<span class="7823640971996835282" onmouseenter="enter('7823640971996835282');" onmouseout="out('7823640971996835282');" style="">  74    private int mFailTimes = 0;                                                                                     </span>
<span class="-2140378055800192500" onmouseenter="enter('-2140378055800192500');" onmouseout="out('-2140378055800192500');" style="">  75    private long mLastSaveTime;                                                                                     </span>
<span class="7052955590557645990" onmouseenter="enter('7052955590557645990');" onmouseout="out('7052955590557645990');" style="">  76    private ExecutorService mConfigThreadPool;                                                                      </span>
<span class="4205150814631290032" onmouseenter="enter('4205150814631290032');" onmouseout="out('4205150814631290032');" style="">  77    private boolean isNotNetRetry;  //断网情况是否重试                                                                      </span>
<span class="-1742305716471965576" onmouseenter="enter('-1742305716471965576');" onmouseout="out('-1742305716471965576');" style="">  78    private boolean taskBreak = false;  //任务跳出                                                                      </span>
<span class="-6139985633669783481" onmouseenter="enter('-6139985633669783481');" onmouseout="out('-6139985633669783481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  79 -  private int mThreadNum;                                                                                         </span>
<span class="7265458021260352388" onmouseenter="enter('7265458021260352388');" onmouseout="out('7265458021260352388');" style="">  80    protected BandwidthLimiter mSpeedBandUtil; //速度限制工具                                                             </span>
<span class="2782655601744072115" onmouseenter="enter('2782655601744072115');" onmouseout="out('2782655601744072115');" style="">  81    protected AriaManager mAridManager;                                                                             </span>
<span class="4110495559709840165" onmouseenter="enter('4110495559709840165');" onmouseout="out('4110495559709840165');" style="">  82    private boolean isInterrupted = false;                                                                          </span>
<span class="8034502532514277404" onmouseenter="enter('8034502532514277404');" onmouseout="out('8034502532514277404');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +  protected boolean isCancel = false, isStop = false;                                                             </span>
<span class="-161749363286472354" onmouseenter="enter('-161749363286472354');" onmouseout="out('-161749363286472354');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  84 +  protected ThreadRecord mRecord;                                                                                 </span>
<span class="8505538020780181250" onmouseenter="enter('8505538020780181250');" onmouseout="out('8505538020780181250');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +  private Handler mStateHandler;                                                                                  </span>
<span class="-644453640718072602" onmouseenter="enter('-644453640718072602');" onmouseout="out('-644453640718072602');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  86 +  private SubThreadConfig&lt;TASK_WRAPPER&gt; mConfig;                                                                  </span>
<span  style="">  87                                                                                                                    </span>
<span class="7317290166143616056" onmouseenter="enter('7317290166143616056');" onmouseout="out('7317290166143616056');" style="">  88    private Thread mConfigThread = new Thread(new Runnable() {                                                      </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="">  89      @Override public void run() {                                                                                 </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style="">  90        Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                              </span>
<span class="-5942055588561434981" onmouseenter="enter('-5942055588561434981');" onmouseout="out('-5942055588561434981');" style="">  91        final long currentTemp = mChildCurrentLocation;                                                             </span>
<span class="-8339432453951329407" onmouseenter="enter('-8339432453951329407');" onmouseout="out('-8339432453951329407');" style="">  92        writeConfig(false, currentTemp);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93      }                                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">  94    });                                                                                                             </span>
<span  style="">  95                                                                                                                    </span>
<span class="3074189361160379026" onmouseenter="enter('3074189361160379026');" onmouseout="out('3074189361160379026');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -  protected AbsThreadTask(StateConstance constance, IEventListener listener,                                      </span>
<span class="2373864060871007394" onmouseenter="enter('2373864060871007394');" onmouseout="out('2373864060871007394');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -      SubThreadConfig&lt;TASK_WRAPPER&gt; config) {                                                                     </span>
<span class="831497767920846752" onmouseenter="enter('831497767920846752');" onmouseout="out('831497767920846752');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -    sState = constance;                                                                                           </span>
<span class="3136850726515239208" onmouseenter="enter('3136850726515239208');" onmouseout="out('3136850726515239208');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -    sConfig = config;                                                                                             </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -    mListener = listener;                                                                                         </span>
<span class="-7311581110913810157" onmouseenter="enter('-7311581110913810157');" onmouseout="out('-7311581110913810157');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -    mTaskWrapper = getConfig().TASK_WRAPPER;                                                                      </span>
<span class="-5675375355167610812" onmouseenter="enter('-5675375355167610812');" onmouseout="out('-5675375355167610812');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +  protected AbsThreadTask(SubThreadConfig&lt;TASK_WRAPPER&gt; config) {                                                 </span>
<span class="-3079299502940909127" onmouseenter="enter('-3079299502940909127');" onmouseout="out('-3079299502940909127');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +    mConfig = config;                                                                                             </span>
<span class="7608526317231191360" onmouseenter="enter('7608526317231191360');" onmouseout="out('7608526317231191360');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +    mTaskWrapper = config.taskWrapper;                                                                            </span>
<span class="-9095243370238004613" onmouseenter="enter('-9095243370238004613');" onmouseout="out('-9095243370238004613');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +    mRecord = config.record;                                                                                      </span>
<span class="2077392471576236354" onmouseenter="enter('2077392471576236354');" onmouseout="out('2077392471576236354');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +    mStateHandler = config.stateHandler;                                                                          </span>
<span class="-7408997685265206061" onmouseenter="enter('-7408997685265206061');" onmouseout="out('-7408997685265206061');" style=""> 107      mEntity = mTaskWrapper.getEntity();                                                                           </span>
<span class="8631807426761684047" onmouseenter="enter('8631807426761684047');" onmouseout="out('8631807426761684047');" style=""> 108      mLastSaveTime = System.currentTimeMillis();                                                                   </span>
<span class="-6975975484715567483" onmouseenter="enter('-6975975484715567483');" onmouseout="out('-6975975484715567483');" style=""> 109      mConfigThreadPool = Executors.newCachedThreadPool();                                                          </span>
<span class="-8222889160787403128" onmouseenter="enter('-8222889160787403128');" onmouseout="out('-8222889160787403128');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -    mThreadNum = getState().TASK_RECORD.threadRecords.size();                                                     </span>
<span class="1199175373698646667" onmouseenter="enter('1199175373698646667');" onmouseout="out('1199175373698646667');" style=""> 111      mAridManager = AriaManager.getInstance(AriaManager.APP);                                                      </span>
<span class="-8585141996075500857" onmouseenter="enter('-8585141996075500857');" onmouseout="out('-8585141996075500857');" style=""> 112      if (getMaxSpeed() &gt; 0) {                                                                                      </span>
<span class="8662855150660412990" onmouseenter="enter('8662855150660412990');" onmouseout="out('8662855150660412990');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 113 -      mSpeedBandUtil = new BandwidthLimiter(getMaxSpeed(), mThreadNum);                                           </span>
<span class="2630549456901300935" onmouseenter="enter('2630549456901300935');" onmouseout="out('2630549456901300935');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +      mSpeedBandUtil = new BandwidthLimiter(getMaxSpeed(), config.startThreadNum);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115      }                                                                                                             </span>
<span class="-2615274212376114043" onmouseenter="enter('-2615274212376114043');" onmouseout="out('-2615274212376114043');" style=""> 116      isNotNetRetry = mAridManager.getAppConfig().isNotNetRetry();                                                  </span>
<span class="-9180213342108359819" onmouseenter="enter('-9180213342108359819');" onmouseout="out('-9180213342108359819');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +    mChildCurrentLocation = mRecord.startLocation;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +  /**                                                                                                             </span>
<span class="-8737617058794341165" onmouseenter="enter('-8737617058794341165');" onmouseout="out('-8737617058794341165');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +   * 当前线程处理的文件名                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +   */                                                                                                             </span>
<span class="7302389212643046972" onmouseenter="enter('7302389212643046972');" onmouseout="out('7302389212643046972');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +  protected String getFileName() {                                                                                </span>
<span class="4833117926548008502" onmouseenter="enter('4833117926548008502');" onmouseout="out('4833117926548008502');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +    return mConfig.tempFile.getName();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +                                                                                                                  </span>
<span class="-3759066779726210536" onmouseenter="enter('-3759066779726210536');" onmouseout="out('-3759066779726210536');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +  protected SubThreadConfig&lt;TASK_WRAPPER&gt; getConfig() {                                                           </span>
<span class="-7756481640167229217" onmouseenter="enter('-7756481640167229217');" onmouseout="out('-7756481640167229217');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +    return mConfig;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129    }                                                                                                               </span>
<span  style=""> 130                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 131    /**                                                                                                             </span>
<span class="1636797617085164081" onmouseenter="enter('1636797617085164081');" onmouseout="out('1636797617085164081');" style=""> 132     * 设置线程是否中断                                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 133     *                                                                                                              </span>
<span class="6061025491082520720" onmouseenter="enter('6061025491082520720');" onmouseout="out('6061025491082520720');" style=""> 134     * @param isInterrupted {@code true} 中断                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 135     */                                                                                                             </span>
<span class="-3489753654187641055" onmouseenter="enter('-3489753654187641055');" onmouseout="out('-3489753654187641055');" style=""> 136    public void setInterrupted(boolean isInterrupted) {                                                             </span>
<span class="3679723848447236272" onmouseenter="enter('3679723848447236272');" onmouseout="out('3679723848447236272');" style=""> 137      this.isInterrupted = isInterrupted;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138    }                                                                                                               </span>
<span  style=""> 139                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 140    /**                                                                                                             </span>
<span class="-9093294427063192169" onmouseenter="enter('-9093294427063192169');" onmouseout="out('-9093294427063192169');" style=""> 141     * 线程是否存活                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 142     *                                                                                                              </span>
<span class="-4472564326041631774" onmouseenter="enter('-4472564326041631774');" onmouseout="out('-4472564326041631774');" style=""> 143     * @return {@code true}存活                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 144     */                                                                                                             </span>
<span class="5343971881214349340" onmouseenter="enter('5343971881214349340');" onmouseout="out('5343971881214349340');" style=""> 145    protected boolean isLive() {                                                                                    </span>
<span class="5056984206620082489" onmouseenter="enter('5056984206620082489');" onmouseout="out('5056984206620082489');" style=""> 146      return !Thread.currentThread().isInterrupted() &amp;&amp; !isInterrupted;                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147    }                                                                                                               </span>
<span  style=""> 148                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 149    /**                                                                                                             </span>
<span class="-1407135870976300" onmouseenter="enter('-1407135870976300');" onmouseout="out('-1407135870976300');" style=""> 150     * 当前线程是否完成，对于不支持断点的任务，一律未完成 {@code true} 完成；{@code false} 未完成                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 151     */                                                                                                             </span>
<span class="-5985760820188647103" onmouseenter="enter('-5985760820188647103');" onmouseout="out('-5985760820188647103');" style=""> 152    boolean isThreadComplete() {                                                                                    </span>
<span class="4226408888236486200" onmouseenter="enter('4226408888236486200');" onmouseout="out('4226408888236486200');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -    return getConfig().THREAD_RECORD.isComplete;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 154 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 155 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 156 -  /**                                                                                                             </span>
<span class="-6332731377908905639" onmouseenter="enter('-6332731377908905639');" onmouseout="out('-6332731377908905639');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -   * 获取状态信息                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 158 -   */                                                                                                             </span>
<span class="2061169541052624644" onmouseenter="enter('2061169541052624644');" onmouseout="out('2061169541052624644');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -  protected StateConstance getState() {                                                                           </span>
<span class="2840565913553737849" onmouseenter="enter('2840565913553737849');" onmouseout="out('2840565913553737849');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 160 -    return sState;                                                                                                </span>
<span class="-5832476025614563785" onmouseenter="enter('-5832476025614563785');" onmouseout="out('-5832476025614563785');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +    return mRecord.isComplete;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162    }                                                                                                               </span>
<span  style=""> 163                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 164    /**                                                                                                             </span>
<span class="4246443053284865110" onmouseenter="enter('4246443053284865110');" onmouseout="out('4246443053284865110');" style=""> 165     * 获取实体                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 166     */                                                                                                             </span>
<span class="-2158320671868788574" onmouseenter="enter('-2158320671868788574');" onmouseout="out('-2158320671868788574');" style=""> 167    protected ENTITY getEntity() {                                                                                  </span>
<span class="-2978486956956616380" onmouseenter="enter('-2978486956956616380');" onmouseout="out('-2978486956956616380');" style=""> 168      return mEntity;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169    }                                                                                                               </span>
<span  style=""> 170                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 171    /**                                                                                                             </span>
<span class="-6696632762627304447" onmouseenter="enter('-6696632762627304447');" onmouseout="out('-6696632762627304447');" style=""> 172     * 获取任务驱动对象                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 173     */                                                                                                             </span>
<span class="-7465189499125296678" onmouseenter="enter('-7465189499125296678');" onmouseout="out('-7465189499125296678');" style=""> 174    protected TASK_WRAPPER getTaskWrapper() {                                                                       </span>
<span class="-6199220384104149910" onmouseenter="enter('-6199220384104149910');" onmouseout="out('-6199220384104149910');" style=""> 175      return mTaskWrapper;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176    }                                                                                                               </span>
<span  style=""> 177                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 178    /**                                                                                                             </span>
<span class="-4551370295195792241" onmouseenter="enter('-4551370295195792241');" onmouseout="out('-4551370295195792241');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 179 -   * 获取任务记录                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 180 -   */                                                                                                             </span>
<span class="-9188054686409268214" onmouseenter="enter('-9188054686409268214');" onmouseout="out('-9188054686409268214');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 181 -  private TaskRecord getTaskRecord() {                                                                            </span>
<span class="641663240327807226" onmouseenter="enter('641663240327807226');" onmouseout="out('641663240327807226');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 182 -    return getState().TASK_RECORD;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 183 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 184 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 185 -  /**                                                                                                             </span>
<span class="182363347818178659" onmouseenter="enter('182363347818178659');" onmouseout="out('182363347818178659');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 186 -   * 获取线程记录                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 187 -   */                                                                                                             </span>
<span class="-3982307524336000161" onmouseenter="enter('-3982307524336000161');" onmouseout="out('-3982307524336000161');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 188 -  protected ThreadRecord getThreadRecord() {                                                                      </span>
<span class="8207684855507410927" onmouseenter="enter('8207684855507410927');" onmouseout="out('8207684855507410927');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 189 -    return getConfig().THREAD_RECORD;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 190 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 191 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 192 -  /**                                                                                                             </span>
<span class="-8261306668739895881" onmouseenter="enter('-8261306668739895881');" onmouseout="out('-8261306668739895881');" style=""> 193     * 获取配置的最大上传/下载速度                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 194     *                                                                                                              </span>
<span class="5179376621123361386" onmouseenter="enter('5179376621123361386');" onmouseout="out('5179376621123361386');" style=""> 195     * @return 单位为：kb                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 196     */                                                                                                             </span>
<span class="-896115242554653093" onmouseenter="enter('-896115242554653093');" onmouseout="out('-896115242554653093');" style=""> 197    public abstract int getMaxSpeed();                                                                              </span>
<span  style=""> 198                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 199    /**                                                                                                             </span>
<span class="-7476262045555684443" onmouseenter="enter('-7476262045555684443');" onmouseout="out('-7476262045555684443');" style=""> 200     * 读取任务配置                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 201     *                                                                                                              </span>
<span class="2765744486349037181" onmouseenter="enter('2765744486349037181');" onmouseout="out('2765744486349037181');" style=""> 202     * @return {@link DownloadConfig}、{@link UploadConfig}、{@link DGroupConfig}                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 203     */                                                                                                             </span>
<span class="8843669963162911719" onmouseenter="enter('8843669963162911719');" onmouseout="out('8843669963162911719');" style=""> 204    protected abstract BaseTaskConfig getTaskConfig();                                                              </span>
<span  style=""> 205                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 206    /**                                                                                                             </span>
<span class="-440811555959535495" onmouseenter="enter('-440811555959535495');" onmouseout="out('-440811555959535495');" style=""> 207     * 设置最大下载速度                                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 208     *                                                                                                              </span>
<span class="-1508955734956367613" onmouseenter="enter('-1508955734956367613');" onmouseout="out('-1508955734956367613');" style=""> 209     * @param speed 单位为：kb                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 210     */                                                                                                             </span>
<span class="-8974735338639184772" onmouseenter="enter('-8974735338639184772');" onmouseout="out('-8974735338639184772');" style=""> 211    public void setMaxSpeed(int speed) {                                                                            </span>
<span class="-649773427560821140" onmouseenter="enter('-649773427560821140');" onmouseout="out('-649773427560821140');" style=""> 212      if (mSpeedBandUtil != null) {                                                                                 </span>
<span class="-9065733257927852124" onmouseenter="enter('-9065733257927852124');" onmouseout="out('-9065733257927852124');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 213 -      mSpeedBandUtil.setMaxRate(speed / mThreadNum);                                                              </span>
<span class="-7563158316316320789" onmouseenter="enter('-7563158316316320789');" onmouseout="out('-7563158316316320789');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +      mSpeedBandUtil.setMaxRate(speed / mConfig.startThreadNum);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216    }                                                                                                               </span>
<span  style=""> 217                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 218    /**                                                                                                             </span>
<span class="6599720418575337619" onmouseenter="enter('6599720418575337619');" onmouseout="out('6599720418575337619');" style=""> 219     * 中断任务                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 220     */                                                                                                             </span>
<span class="4561569160041136245" onmouseenter="enter('4561569160041136245');" onmouseout="out('4561569160041136245');" style=""> 221    void breakTask() {                                                                                              </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 222      synchronized (AriaManager.LOCK) {                                                                             </span>
<span class="-3099491134649143832" onmouseenter="enter('-3099491134649143832');" onmouseout="out('-3099491134649143832');" style=""> 223        taskBreak = true;                                                                                           </span>
<span class="5006934068411751005" onmouseenter="enter('5006934068411751005');" onmouseout="out('5006934068411751005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 224 -      if (getConfig().SUPPORT_BP) {                                                                               </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +      if (mTaskWrapper.isSupportBP()) {                                                                           </span>
<span class="-5942055588561434981" onmouseenter="enter('-5942055588561434981');" onmouseout="out('-5942055588561434981');" style=""> 226          final long currentTemp = mChildCurrentLocation;                                                           </span>
<span class="983038057484720775" onmouseenter="enter('983038057484720775');" onmouseout="out('983038057484720775');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 227 -        getState().STOP_NUM++;                                                                                    </span>
<span class="-4664013463983592719" onmouseenter="enter('-4664013463983592719');" onmouseout="out('-4664013463983592719');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -        ALog.d(TAG, String.format(&quot;任务【%s】thread__%s__中断【停止位置：%s】&quot;, getConfig().TEMP_FILE.getName(),               </span>
<span class="20570492298485329" onmouseenter="enter('20570492298485329');" onmouseout="out('20570492298485329');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 229 -            getConfig().THREAD_ID, currentTemp));                                                                 </span>
<span class="2043705367433474739" onmouseenter="enter('2043705367433474739');" onmouseout="out('2043705367433474739');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +        sendState(IThreadState.STATE_STOP, null);                                                                 </span>
<span class="6146956303290790721" onmouseenter="enter('6146956303290790721');" onmouseout="out('6146956303290790721');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +        ALog.d(TAG, String.format(&quot;任务【%s】thread__%s__中断【停止位置：%s】&quot;, getFileName(),                                 </span>
<span class="376922911421079876" onmouseenter="enter('376922911421079876');" onmouseout="out('376922911421079876');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +            mRecord.threadId, currentTemp));                                                                      </span>
<span class="-8339432453951329407" onmouseenter="enter('-8339432453951329407');" onmouseout="out('-8339432453951329407');" style=""> 233          writeConfig(false, currentTemp);                                                                          </span>
<span class="-2563849418598631324" onmouseenter="enter('-2563849418598631324');" onmouseout="out('-2563849418598631324');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 234 -        if (getState().isStop()) {                                                                                </span>
<span class="7844720676096853926" onmouseenter="enter('7844720676096853926');" onmouseout="out('7844720676096853926');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 235 -          ALog.i(TAG, String.format(&quot;任务【%s】已中断&quot;, getConfig().TEMP_FILE.getName()));                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 236 -        }                                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 237        } else {                                                                                                    </span>
<span class="7844720676096853926" onmouseenter="enter('7844720676096853926');" onmouseout="out('7844720676096853926');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 238 -        ALog.i(TAG, String.format(&quot;任务【%s】已中断&quot;, getConfig().TEMP_FILE.getName()));                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 239 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 240 -    }                                                                                                             </span>
<span class="-2549462388866091673" onmouseenter="enter('-2549462388866091673');" onmouseout="out('-2549462388866091673');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +        ALog.i(TAG, String.format(&quot;任务【%s】已中断&quot;, getFileName()));                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +  /**                                                                                                             </span>
<span class="5256203714917913991" onmouseenter="enter('5256203714917913991');" onmouseout="out('5256203714917913991');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +   * 发送状态给状态处理器                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +   *                                                                                                              </span>
<span class="-8049878616952568950" onmouseenter="enter('-8049878616952568950');" onmouseout="out('-8049878616952568950');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +   * @param state {@link IThreadState#STATE_STOP}..                                                               </span>
<span class="-4152917228807143386" onmouseenter="enter('-4152917228807143386');" onmouseout="out('-4152917228807143386');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +   * @param bundle 而外数据                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +   */                                                                                                             </span>
<span class="107634412995640864" onmouseenter="enter('107634412995640864');" onmouseout="out('107634412995640864');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +  void sendState(int state, @Nullable Bundle bundle) {                                                            </span>
<span class="5312338573559356541" onmouseenter="enter('5312338573559356541');" onmouseout="out('5312338573559356541');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +    Message msg = mStateHandler.obtainMessage();                                                                  </span>
<span class="4586264514118761504" onmouseenter="enter('4586264514118761504');" onmouseout="out('4586264514118761504');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +    msg.what = state;                                                                                             </span>
<span class="-3154970297737940190" onmouseenter="enter('-3154970297737940190');" onmouseout="out('-3154970297737940190');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +    if (bundle != null) {                                                                                         </span>
<span class="-5836915540506052451" onmouseenter="enter('-5836915540506052451');" onmouseout="out('-5836915540506052451');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +      msg.setData(bundle);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 257 +    }                                                                                                             </span>
<span class="-656061765258294758" onmouseenter="enter('-656061765258294758');" onmouseout="out('-656061765258294758');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 258 +    msg.sendToTarget();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259    }                                                                                                               </span>
<span  style=""> 260                                                                                                                    </span>
<span class="5908327854870228087" onmouseenter="enter('5908327854870228087');" onmouseout="out('5908327854870228087');" style=""> 261    public boolean isInterrupted() {                                                                                </span>
<span class="-5203528151312862013" onmouseenter="enter('-5203528151312862013');" onmouseout="out('-5203528151312862013');" style=""> 262      return Thread.currentThread().isInterrupted();                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 263 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 264 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 265 -  /**                                                                                                             </span>
<span class="-5848423053385458497" onmouseenter="enter('-5848423053385458497');" onmouseout="out('-5848423053385458497');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 266 -   * 获取线程配置信息                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 267 -   */                                                                                                             </span>
<span class="-3759066779726210536" onmouseenter="enter('-3759066779726210536');" onmouseout="out('-3759066779726210536');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 268 -  protected SubThreadConfig&lt;TASK_WRAPPER&gt; getConfig() {                                                           </span>
<span class="-8168561174497257303" onmouseenter="enter('-8168561174497257303');" onmouseout="out('-8168561174497257303');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 269 -    return sConfig;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270    }                                                                                                               </span>
<span  style=""> 271                                                                                                                    </span>
<span class="-9198262987019797851" onmouseenter="enter('-9198262987019797851');" onmouseout="out('-9198262987019797851');" style=""> 272    @Override protected void finalize() throws Throwable {                                                          </span>
<span class="4114196779073131595" onmouseenter="enter('4114196779073131595');" onmouseout="out('4114196779073131595');" style=""> 273      super.finalize();                                                                                             </span>
<span class="-7477286483889370682" onmouseenter="enter('-7477286483889370682');" onmouseout="out('-7477286483889370682');" style=""> 274      if (mConfigThreadPool != null) {                                                                              </span>
<span class="6755739129057127055" onmouseenter="enter('6755739129057127055');" onmouseout="out('6755739129057127055');" style=""> 275        mConfigThreadPool.shutdown();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277    }                                                                                                               </span>
<span  style=""> 278                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 279    /**                                                                                                             </span>
<span class="4258051666929748339" onmouseenter="enter('4258051666929748339');" onmouseout="out('4258051666929748339');" style=""> 280     * 任务是否中断，中断条件： 1、任务取消 2、任务停止 3、手动中断 {@link #taskBreak}                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 281     *                                                                                                              </span>
<span class="8685725000128107952" onmouseenter="enter('8685725000128107952');" onmouseout="out('8685725000128107952');" style=""> 282     * @return {@code true} 中断，{@code false} 不是中断                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 283     */                                                                                                             </span>
<span class="1192236408818642919" onmouseenter="enter('1192236408818642919');" onmouseout="out('1192236408818642919');" style=""> 284    protected boolean isBreak() {                                                                                   </span>
<span class="4515372269683129077" onmouseenter="enter('4515372269683129077');" onmouseout="out('4515372269683129077');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 285 -    return getState().isCancel || getState().isStop || taskBreak;                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 286 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 287 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 288 -  /**                                                                                                             </span>
<span class="-8362313205067342402" onmouseenter="enter('-8362313205067342402');" onmouseout="out('-8362313205067342402');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 289 -   * 合并文件                                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 290 -   *                                                                                                              </span>
<span class="7152954986304769445" onmouseenter="enter('7152954986304769445');" onmouseout="out('7152954986304769445');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 291 -   * @return {@code true} 合并成功，{@code false}合并失败                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 292 -   */                                                                                                             </span>
<span class="4555889719712359225" onmouseenter="enter('4555889719712359225');" onmouseout="out('4555889719712359225');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 293 -  protected boolean mergeFile() {                                                                                 </span>
<span class="7604758579765859822" onmouseenter="enter('7604758579765859822');" onmouseout="out('7604758579765859822');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 294 -    List&lt;String&gt; partPath = new ArrayList&lt;&gt;();                                                                    </span>
<span class="908327015487725145" onmouseenter="enter('908327015487725145');" onmouseout="out('908327015487725145');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 295 -    for (int i = 0, len = getState().TASK_RECORD.threadNum; i &lt; len; i++) {                                       </span>
<span class="4939743928858325156" onmouseenter="enter('4939743928858325156');" onmouseout="out('4939743928858325156');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 296 -      partPath.add(String.format(AbsFileer.SUB_PATH, getState().TASK_RECORD.filePath, i));                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 297 -    }                                                                                                             </span>
<span class="-5947936726893417650" onmouseenter="enter('-5947936726893417650');" onmouseout="out('-5947936726893417650');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 298 -    boolean isSuccess = FileUtil.mergeFile(getState().TASK_RECORD.filePath, partPath);                            </span>
<span class="155883027282181251" onmouseenter="enter('155883027282181251');" onmouseout="out('155883027282181251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 299 -    if (isSuccess) {                                                                                              </span>
<span class="-8585313318236954494" onmouseenter="enter('-8585313318236954494');" onmouseout="out('-8585313318236954494');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 300 -      for (String pp : partPath) {                                                                                </span>
<span class="528717567100361765" onmouseenter="enter('528717567100361765');" onmouseout="out('528717567100361765');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 301 -        File f = new File(pp);                                                                                    </span>
<span class="8226260359634022247" onmouseenter="enter('8226260359634022247');" onmouseout="out('8226260359634022247');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 302 -        if (f.exists()) {                                                                                         </span>
<span class="7682989536937550366" onmouseenter="enter('7682989536937550366');" onmouseout="out('7682989536937550366');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 303 -          f.delete();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 304 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 305 -      }                                                                                                           </span>
<span class="-4058925986228208358" onmouseenter="enter('-4058925986228208358');" onmouseout="out('-4058925986228208358');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 306 -      File targetFile = new File(getState().TASK_RECORD.filePath);                                                </span>
<span class="4158176026694498796" onmouseenter="enter('4158176026694498796');" onmouseout="out('4158176026694498796');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 307 -      if (targetFile.exists() &amp;&amp; targetFile.length() &gt; getEntity().getFileSize()) {                               </span>
<span class="-2471360084270286815" onmouseenter="enter('-2471360084270286815');" onmouseout="out('-2471360084270286815');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -        ALog.e(TAG, String.format(&quot;任务【%s】分块文件合并失败，下载长度超出文件真实长度，downloadLen: %s，fileSize: %s&quot;,                     </span>
<span class="-1236054566861987125" onmouseenter="enter('-1236054566861987125');" onmouseout="out('-1236054566861987125');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -            getConfig().TEMP_FILE.getName(), targetFile.length(), getEntity().getFileSize()));                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 310 -        return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 311 -      }                                                                                                           </span>
<span class="6435844081899071775" onmouseenter="enter('6435844081899071775');" onmouseout="out('6435844081899071775');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 312 +    return isCancel || isStop || taskBreak;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 313 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 314 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 315 +  /**                                                                                                             </span>
<span class="-4436630274060532850" onmouseenter="enter('-4436630274060532850');" onmouseout="out('-4436630274060532850');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 316 +   * 检查下载完成的分块大小，如果下载完成的分块大小大于或小于分配的大小，则需要重新下载该分块 如果是非分块任务，直接返回{@code true}                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 317 +   *                                                                                                              </span>
<span class="-5962632420674681636" onmouseenter="enter('-5962632420674681636');" onmouseout="out('-5962632420674681636');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 318 +   * @return {@code true} 分块分大小正常，{@code false} 分块大小错误                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 319 +   */                                                                                                             </span>
<span class="-1715939541580522304" onmouseenter="enter('-1715939541580522304');" onmouseout="out('-1715939541580522304');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 320 +  protected boolean checkBlock() {                                                                                </span>
<span class="-8255347005712765724" onmouseenter="enter('-8255347005712765724');" onmouseout="out('-8255347005712765724');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 321 +    if (!mConfig.isBlock) {                                                                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 322        return true;                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 323 -    } else {                                                                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 324 -      return false;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 325 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 326 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 327 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 328 -  /**                                                                                                             </span>
<span class="-4436630274060532850" onmouseenter="enter('-4436630274060532850');" onmouseout="out('-4436630274060532850');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 329 -   * 检查下载完成的分块大小，如果下载完成的分块大小大于或小于分配的大小，则需要重新下载该分块 如果是非分块任务，直接返回{@code true}                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 330 -   *                                                                                                              </span>
<span class="-5962632420674681636" onmouseenter="enter('-5962632420674681636');" onmouseout="out('-5962632420674681636');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 331 -   * @return {@code true} 分块分大小正常，{@code false} 分块大小错误                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 332 -   */                                                                                                             </span>
<span class="-1715939541580522304" onmouseenter="enter('-1715939541580522304');" onmouseout="out('-1715939541580522304');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 333 -  protected boolean checkBlock() {                                                                                </span>
<span class="-1670545497734825210" onmouseenter="enter('-1670545497734825210');" onmouseout="out('-1670545497734825210');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 334 -    if (!getTaskRecord().isBlock) {                                                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 335 -      return true;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 336 -    }                                                                                                             </span>
<span class="-772418395532567131" onmouseenter="enter('-772418395532567131');" onmouseout="out('-772418395532567131');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 337 -    ThreadRecord tr = getThreadRecord();                                                                          </span>
<span class="1047909086628301767" onmouseenter="enter('1047909086628301767');" onmouseout="out('1047909086628301767');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 338 -    File blockFile = getBockFile();                                                                               </span>
<span class="3308229969593575316" onmouseenter="enter('3308229969593575316');" onmouseout="out('3308229969593575316');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 339 -    if (!blockFile.exists() || blockFile.length() != tr.blockLen) {                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 340 +    }                                                                                                             </span>
<span class="3935656399577463427" onmouseenter="enter('3935656399577463427');" onmouseout="out('3935656399577463427');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +    File blockFile = mConfig.tempFile;                                                                            </span>
<span class="-1695353633342038156" onmouseenter="enter('-1695353633342038156');" onmouseout="out('-1695353633342038156');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 342 +    if (!blockFile.exists() || blockFile.length() != mRecord.blockLen) {                                          </span>
<span class="-3869098922257348244" onmouseenter="enter('-3869098922257348244');" onmouseout="out('-3869098922257348244');" style=""> 343        ALog.i(TAG,                                                                                                 </span>
<span class="-4253990883383800149" onmouseenter="enter('-4253990883383800149');" onmouseout="out('-4253990883383800149');" style=""> 344            String.format(&quot;分块【%s】错误，blockFileLen: %s, threadRect: %s; 即将重新下载该分块，开始位置：%s，结束位置：%s&quot;,                   </span>
<span class="3316816270966189813" onmouseenter="enter('3316816270966189813');" onmouseout="out('3316816270966189813');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 345 -              blockFile.getName(), blockFile.length(), tr.blockLen, tr.startLocation,                             </span>
<span class="-1499185844779558933" onmouseenter="enter('-1499185844779558933');" onmouseout="out('-1499185844779558933');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 346 -              tr.endLocation));                                                                                   </span>
<span class="2939919814588467615" onmouseenter="enter('2939919814588467615');" onmouseout="out('2939919814588467615');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 347 +              blockFile.getName(), blockFile.length(), mRecord.blockLen, mRecord.startLocation,                   </span>
<span class="7451819391210675610" onmouseenter="enter('7451819391210675610');" onmouseout="out('7451819391210675610');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 348 +              mRecord.endLocation));                                                                              </span>
<span class="-3823857485302692882" onmouseenter="enter('-3823857485302692882');" onmouseout="out('-3823857485302692882');" style=""> 349        if (blockFile.exists()) {                                                                                   </span>
<span class="-8675830801645990020" onmouseenter="enter('-8675830801645990020');" onmouseout="out('-8675830801645990020');" style=""> 350          blockFile.delete();                                                                                       </span>
<span class="2945539549828015550" onmouseenter="enter('2945539549828015550');" onmouseout="out('2945539549828015550');" style=""> 351          ALog.i(TAG, String.format(&quot;删除分块【%s】成功&quot;, blockFile.getName()));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 352        }                                                                                                           </span>
<span class="-6720013085559771010" onmouseenter="enter('-6720013085559771010');" onmouseout="out('-6720013085559771010');" style=""> 353        retryThis(isBreak());                                                                                       </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 354        return false;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355      }                                                                                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 356      return true;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357    }                                                                                                               </span>
<span  style=""> 358                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 359    /**                                                                                                             </span>
<span class="-7882741939763414839" onmouseenter="enter('-7882741939763414839');" onmouseout="out('-7882741939763414839');" style=""> 360     * 停止任务                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 361     */                                                                                                             </span>
<span class="-1831798800985246753" onmouseenter="enter('-1831798800985246753');" onmouseout="out('-1831798800985246753');" style=""> 362    public void stop() {                                                                                            </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 363      synchronized (AriaManager.LOCK) {                                                                             </span>
<span class="5006934068411751005" onmouseenter="enter('5006934068411751005');" onmouseout="out('5006934068411751005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 364 -      if (getConfig().SUPPORT_BP) {                                                                               </span>
<span class="3314071653469644267" onmouseenter="enter('3314071653469644267');" onmouseout="out('3314071653469644267');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 365 -        final long stopLocation;                                                                                  </span>
<span class="-6097666598137252140" onmouseenter="enter('-6097666598137252140');" onmouseout="out('-6097666598137252140');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 366 -        if (getTaskRecord().isBlock) {                                                                            </span>
<span class="1047909086628301767" onmouseenter="enter('1047909086628301767');" onmouseout="out('1047909086628301767');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 367 -          File blockFile = getBockFile();                                                                         </span>
<span class="-772418395532567131" onmouseenter="enter('-772418395532567131');" onmouseout="out('-772418395532567131');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 368 -          ThreadRecord tr = getThreadRecord();                                                                    </span>
<span class="5379353079923932335" onmouseenter="enter('5379353079923932335');" onmouseout="out('5379353079923932335');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 369 -          long block = getEntity().getFileSize() / getTaskRecord().threadRecords.size();                          </span>
<span class="-2425208671748558296" onmouseenter="enter('-2425208671748558296');" onmouseout="out('-2425208671748558296');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 370 -          stopLocation =                                                                                          </span>
<span class="-4052936473739545811" onmouseenter="enter('-4052936473739545811');" onmouseout="out('-4052936473739545811');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 371 -              blockFile.exists() ? (tr.threadId * block + blockFile.length()) : tr.threadId * block;              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 372 -        } else {                                                                                                  </span>
<span class="-6696570474422776739" onmouseenter="enter('-6696570474422776739');" onmouseout="out('-6696570474422776739');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 373 -          stopLocation = mChildCurrentLocation;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 374 -        }                                                                                                         </span>
<span class="983038057484720775" onmouseenter="enter('983038057484720775');" onmouseout="out('983038057484720775');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 375 -        getState().STOP_NUM++;                                                                                    </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 376 +      isStop = true;                                                                                              </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 377 +      if (mTaskWrapper.isSupportBP()) {                                                                           </span>
<span class="3999428278528562375" onmouseenter="enter('3999428278528562375');" onmouseout="out('3999428278528562375');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 378 +        final long stopLocation = mChildCurrentLocation;                                                          </span>
<span class="2043705367433474739" onmouseenter="enter('2043705367433474739');" onmouseout="out('2043705367433474739');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 379 +        sendState(IThreadState.STATE_STOP, null);                                                                 </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style=""> 380          ALog.d(TAG,                                                                                               </span>
<span class="1260993367462472769" onmouseenter="enter('1260993367462472769');" onmouseout="out('1260993367462472769');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 381 -            String.format(&quot;任务【%s】thread__%s__停止【当前线程停止位置：%s】&quot;, getConfig().TEMP_FILE.getName(),                   </span>
<span class="-1077621383480476737" onmouseenter="enter('-1077621383480476737');" onmouseout="out('-1077621383480476737');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 382 -                getConfig().THREAD_ID, stopLocation));                                                            </span>
<span class="1550861091873015536" onmouseenter="enter('1550861091873015536');" onmouseout="out('1550861091873015536');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 383 +            String.format(&quot;任务【%s】thread__%s__停止【当前线程停止位置：%s】&quot;, getFileName(),                                     </span>
<span class="-867220232156674741" onmouseenter="enter('-867220232156674741');" onmouseout="out('-867220232156674741');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 384 +                mRecord.threadId, stopLocation));                                                                 </span>
<span class="7792260418457311232" onmouseenter="enter('7792260418457311232');" onmouseout="out('7792260418457311232');" style=""> 385          writeConfig(false, stopLocation);                                                                         </span>
<span class="564635047036260779" onmouseenter="enter('564635047036260779');" onmouseout="out('564635047036260779');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 386 -        //ALog.d(TAG, String.format(&quot;stop_thread_num=%s; start_thread_num=%s; complete_thread_num=%s&quot;,            </span>
<span class="-6932797855731597085" onmouseenter="enter('-6932797855731597085');" onmouseout="out('-6932797855731597085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 387 -        //    getState().STOP_NUM, getState().START_THREAD_NUM, getState().COMPLETE_THREAD_NUM));                 </span>
<span class="-2563849418598631324" onmouseenter="enter('-2563849418598631324');" onmouseout="out('-2563849418598631324');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 388 -        if (getState().isStop()) {                                                                                </span>
<span class="668364159880084768" onmouseenter="enter('668364159880084768');" onmouseout="out('668364159880084768');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 389 -          ALog.i(TAG, String.format(&quot;任务【%s】已停止&quot;, getConfig().TEMP_FILE.getName()));                               </span>
<span class="1872144609445620235" onmouseenter="enter('1872144609445620235');" onmouseout="out('1872144609445620235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 390 -          mListener.onStop(getState().CURRENT_LOCATION);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 391 -        }                                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 392        } else {                                                                                                    </span>
<span class="668364159880084768" onmouseenter="enter('668364159880084768');" onmouseout="out('668364159880084768');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 393 -        ALog.i(TAG, String.format(&quot;任务【%s】已停止&quot;, getConfig().TEMP_FILE.getName()));                                 </span>
<span class="1872144609445620235" onmouseenter="enter('1872144609445620235');" onmouseout="out('1872144609445620235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 394 -        mListener.onStop(getState().CURRENT_LOCATION);                                                            </span>
<span class="-8753703196049872436" onmouseenter="enter('-8753703196049872436');" onmouseout="out('-8753703196049872436');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 395 +        ALog.i(TAG, String.format(&quot;任务【%s】已停止&quot;, getFileName()));                                                   </span>
<span class="2043705367433474739" onmouseenter="enter('2043705367433474739');" onmouseout="out('2043705367433474739');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 396 +        sendState(IThreadState.STATE_STOP, null);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 398      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 399    }                                                                                                               </span>
<span  style=""> 400                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 401    /**                                                                                                             </span>
<span class="7873398811029444044" onmouseenter="enter('7873398811029444044');" onmouseout="out('7873398811029444044');" style=""> 402     * 执行中                                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 403     */                                                                                                             </span>
<span class="7428157636721718570" onmouseenter="enter('7428157636721718570');" onmouseout="out('7428157636721718570');" style=""> 404    protected void progress(long len) {                                                                             </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 405      synchronized (AriaManager.LOCK) {                                                                             </span>
<span class="-5158817120850263884" onmouseenter="enter('-5158817120850263884');" onmouseout="out('-5158817120850263884');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 406 -      if (getState().CURRENT_LOCATION &gt; getEntity().getFileSize() &amp;&amp; !getTaskWrapper().asHttp()                   </span>
<span class="-5689702993538725830" onmouseenter="enter('-5689702993538725830');" onmouseout="out('-5689702993538725830');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 407 -          .isChunked()) {                                                                                         </span>
<span class="272704129949425447" onmouseenter="enter('272704129949425447');" onmouseout="out('272704129949425447');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 408 -        String errorMsg =                                                                                         </span>
<span class="4440641683122614336" onmouseenter="enter('4440641683122614336');" onmouseout="out('4440641683122614336');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 409 -            String.format(&quot;下载失败，下载长度超出文件真实长度；currentLocation=%s, fileSize=%s&quot;,                                    </span>
<span class="-4161466068211400608" onmouseenter="enter('-4161466068211400608');" onmouseout="out('-4161466068211400608');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 410 -                getState().CURRENT_LOCATION,                                                                      </span>
<span class="4915606519379135079" onmouseenter="enter('4915606519379135079');" onmouseout="out('4915606519379135079');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 411 -                getEntity().getFileSize());                                                                       </span>
<span class="-3099491134649143832" onmouseenter="enter('-3099491134649143832');" onmouseout="out('-3099491134649143832');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 412 -        taskBreak = true;                                                                                         </span>
<span class="3048453949361930159" onmouseenter="enter('3048453949361930159');" onmouseout="out('3048453949361930159');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 413 -        fail(mChildCurrentLocation, new FileException(TAG, errorMsg), false);                                     </span>
<span class="2533028217200451003" onmouseenter="enter('2533028217200451003');" onmouseout="out('2533028217200451003');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 414 +      //if (getState().CURRENT_LOCATION &gt; getEntity().getFileSize() &amp;&amp; !getTaskWrapper().asHttp()                 </span>
<span class="-1186412116255119268" onmouseenter="enter('-1186412116255119268');" onmouseout="out('-1186412116255119268');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 415 +      //    .isChunked()) {                                                                                       </span>
<span class="-4532666615131915740" onmouseenter="enter('-4532666615131915740');" onmouseout="out('-4532666615131915740');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 416 +      //  String errorMsg =                                                                                       </span>
<span class="518171698288030827" onmouseenter="enter('518171698288030827');" onmouseout="out('518171698288030827');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 417 +      //      String.format(&quot;下载失败，下载长度超出文件真实长度；currentLocation=%s, fileSize=%s&quot;,                                  </span>
<span class="-3066839761455073570" onmouseenter="enter('-3066839761455073570');" onmouseout="out('-3066839761455073570');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 418 +      //          getState().CURRENT_LOCATION,                                                                    </span>
<span class="-4715215170271404042" onmouseenter="enter('-4715215170271404042');" onmouseout="out('-4715215170271404042');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 419 +      //          getEntity().getFileSize());                                                                     </span>
<span class="3035606892929688966" onmouseenter="enter('3035606892929688966');" onmouseout="out('3035606892929688966');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 420 +      //  taskBreak = true;                                                                                       </span>
<span class="5067342317456439021" onmouseenter="enter('5067342317456439021');" onmouseout="out('5067342317456439021');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 421 +      //  fail(mChildCurrentLocation, new FileException(TAG, errorMsg), false);                                   </span>
<span class="3500611444781325819" onmouseenter="enter('3500611444781325819');" onmouseout="out('3500611444781325819');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 422 +      //  return;                                                                                                 </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 423 +      //}                                                                                                         </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 424 +      mChildCurrentLocation += len;                                                                               </span>
<span class="-6345084862948761327" onmouseenter="enter('-6345084862948761327');" onmouseout="out('-6345084862948761327');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 425 +      if (!mStateHandler.getLooper().getThread().isAlive()) {                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 426          return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 427        }                                                                                                           </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 428 -      mChildCurrentLocation += len;                                                                               </span>
<span class="7118339639886667974" onmouseenter="enter('7118339639886667974');" onmouseout="out('7118339639886667974');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 429 -      getState().CURRENT_LOCATION += len;                                                                         </span>
<span class="-5752277786740261730" onmouseenter="enter('-5752277786740261730');" onmouseout="out('-5752277786740261730');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 430 +      mStateHandler.obtainMessage(IThreadState.STATE_RUNNING, len).sendToTarget();                                </span>
<span class="8466413356993225320" onmouseenter="enter('8466413356993225320');" onmouseout="out('8466413356993225320');" style=""> 431        if (System.currentTimeMillis() - mLastSaveTime &gt; 5000                                                       </span>
<span class="-1760411904350794527" onmouseenter="enter('-1760411904350794527');" onmouseout="out('-1760411904350794527');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 432 -          &amp;&amp; mChildCurrentLocation &lt; getConfig().END_LOCATION) {                                                  </span>
<span class="-4608803573017792643" onmouseenter="enter('-4608803573017792643');" onmouseout="out('-4608803573017792643');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 433 +          &amp;&amp; mChildCurrentLocation &lt; mRecord.endLocation) {                                                       </span>
<span class="8631807426761684047" onmouseenter="enter('8631807426761684047');" onmouseout="out('8631807426761684047');" style=""> 434          mLastSaveTime = System.currentTimeMillis();                                                               </span>
<span class="6892340968550800051" onmouseenter="enter('6892340968550800051');" onmouseout="out('6892340968550800051');" style=""> 435          if (!mConfigThreadPool.isShutdown()) {                                                                    </span>
<span class="5224309411782533590" onmouseenter="enter('5224309411782533590');" onmouseout="out('5224309411782533590');" style=""> 436            mConfigThreadPool.execute(mConfigThread);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 440    }                                                                                                               </span>
<span  style=""> 441                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 442    /**                                                                                                             </span>
<span class="-1608425225589706128" onmouseenter="enter('-1608425225589706128');" onmouseout="out('-1608425225589706128');" style=""> 443     * 取消任务                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 444     */                                                                                                             </span>
<span class="-6930343012855552909" onmouseenter="enter('-6930343012855552909');" onmouseout="out('-6930343012855552909');" style=""> 445    public void cancel() {                                                                                          </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 446      synchronized (AriaManager.LOCK) {                                                                             </span>
<span class="5006934068411751005" onmouseenter="enter('5006934068411751005');" onmouseout="out('5006934068411751005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 447 -      if (getConfig().SUPPORT_BP) {                                                                               </span>
<span class="-8476168595799833278" onmouseenter="enter('-8476168595799833278');" onmouseout="out('-8476168595799833278');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 448 -        getState().CANCEL_NUM++;                                                                                  </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 449 -        ALog.d(TAG,                                                                                               </span>
<span class="6395804831943421275" onmouseenter="enter('6395804831943421275');" onmouseout="out('6395804831943421275');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 450 -            String.format(&quot;任务【%s】thread__%s__取消&quot;, getConfig().TEMP_FILE.getName(),                                </span>
<span class="-5134797844221077154" onmouseenter="enter('-5134797844221077154');" onmouseout="out('-5134797844221077154');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 451 -                getConfig().THREAD_ID));                                                                          </span>
<span class="-6928137037894099645" onmouseenter="enter('-6928137037894099645');" onmouseout="out('-6928137037894099645');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 452 -        //ALog.d(TAG, &quot;cancel_num = &quot;                                                                             </span>
<span class="-3808138091041989092" onmouseenter="enter('-3808138091041989092');" onmouseout="out('-3808138091041989092');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 453 -        //    + getState().CANCEL_NUM                                                                             </span>
<span class="-8428616108043738512" onmouseenter="enter('-8428616108043738512');" onmouseout="out('-8428616108043738512');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 454 -        //    + &quot;, start_thread_num = &quot;                                                                           </span>
<span class="4228072879151325436" onmouseenter="enter('4228072879151325436');" onmouseout="out('4228072879151325436');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 455 -        //    + getState().START_THREAD_NUM);                                                                     </span>
<span class="3713470206061401237" onmouseenter="enter('3713470206061401237');" onmouseout="out('3713470206061401237');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 456 -        if (getState().isCancel()) {                                                                              </span>
<span class="789849241623899039" onmouseenter="enter('789849241623899039');" onmouseout="out('789849241623899039');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 457 -          if (getConfig().TEMP_FILE.exists() &amp;&amp; !(getEntity() instanceof UploadEntity)) {                         </span>
<span class="5931760867942988811" onmouseenter="enter('5931760867942988811');" onmouseout="out('5931760867942988811');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 458 -            getConfig().TEMP_FILE.delete();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 459 -          }                                                                                                       </span>
<span class="1655463578773384958" onmouseenter="enter('1655463578773384958');" onmouseout="out('1655463578773384958');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 460 -          ALog.d(TAG, String.format(&quot;任务【%s】已取消&quot;, getConfig().TEMP_FILE.getName()));                               </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 461 -          mListener.onCancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 462 -        }                                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 463 -      } else {                                                                                                    </span>
<span class="1655463578773384958" onmouseenter="enter('1655463578773384958');" onmouseout="out('1655463578773384958');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 464 -        ALog.d(TAG, String.format(&quot;任务【%s】已取消&quot;, getConfig().TEMP_FILE.getName()));                                 </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 465 -        mListener.onCancel();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 466 -      }                                                                                                           </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 467 +      isCancel = true;                                                                                            </span>
<span class="4419200793409452847" onmouseenter="enter('4419200793409452847');" onmouseout="out('4419200793409452847');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 468 +      sendState(IThreadState.STATE_CANCEL, null);                                                                 </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 469 +      ALog.d(TAG,                                                                                                 </span>
<span class="-2078406994386200129" onmouseenter="enter('-2078406994386200129');" onmouseout="out('-2078406994386200129');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 470 +          String.format(&quot;任务【%s】thread__%s__取消&quot;, getFileName(), mRecord.threadId));                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 472    }                                                                                                               </span>
<span  style=""> 473                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 474    /**                                                                                                             </span>
<span class="-3628170746268112272" onmouseenter="enter('-3628170746268112272');" onmouseout="out('-3628170746268112272');" style=""> 475     * 线程任务失败                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 476     *                                                                                                              </span>
<span class="6810672559305889194" onmouseenter="enter('6810672559305889194');" onmouseout="out('6810672559305889194');" style=""> 477     * @param subCurrentLocation 当前线程下载进度                                                                           </span>
<span class="774581074216290190" onmouseenter="enter('774581074216290190');" onmouseout="out('774581074216290190');" style=""> 478     * @param ex 异常信息                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 479     */                                                                                                             </span>
<span class="1500165102101720475" onmouseenter="enter('1500165102101720475');" onmouseout="out('1500165102101720475');" style=""> 480    protected void fail(final long subCurrentLocation, BaseException ex) {                                          </span>
<span class="-2149101237246601219" onmouseenter="enter('-2149101237246601219');" onmouseout="out('-2149101237246601219');" style=""> 481      fail(subCurrentLocation, ex, true);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 482    }                                                                                                               </span>
<span  style=""> 483                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 484    /**                                                                                                             </span>
<span class="7725539954827761966" onmouseenter="enter('7725539954827761966');" onmouseout="out('7725539954827761966');" style=""> 485     * 任务失败                                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 486     *                                                                                                              </span>
<span class="7399711965916828500" onmouseenter="enter('7399711965916828500');" onmouseout="out('7399711965916828500');" style=""> 487     * @param subCurrentLocation 当前子线程进度                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 488     */                                                                                                             </span>
<span class="3846496864338478922" onmouseenter="enter('3846496864338478922');" onmouseout="out('3846496864338478922');" style=""> 489    protected void fail(final long subCurrentLocation, BaseException ex, boolean needRetry) {                       </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style=""> 490      if (ex != null) {                                                                                             </span>
<span class="-333456365485290101" onmouseenter="enter('-333456365485290101');" onmouseout="out('-333456365485290101');" style=""> 491        ALog.e(TAG, ALog.getExceptionString(ex));                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 492      }                                                                                                             </span>
<span class="5006934068411751005" onmouseenter="enter('5006934068411751005');" onmouseout="out('5006934068411751005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 493 -    if (getConfig().SUPPORT_BP) {                                                                                 </span>

<span class="5636262962850437364" onmouseenter="enter('5636262962850437364');" onmouseout="out('5636262962850437364');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 494 -      writeConfig(false, subCurrentLocation);                                                                     </span>
<span class="-5022490975846662695" onmouseenter="enter('-5022490975846662695');" onmouseout="out('-5022490975846662695');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 495 -      retryThis(needRetry &amp;&amp; getState().START_THREAD_NUM != 1);                                                   </span>
<span class="6310848794744788402" onmouseenter="enter('6310848794744788402');" onmouseout="out('6310848794744788402');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 496 +    if (mTaskWrapper.getRequestType() == ITaskWrapper.M3U8_FILE) {                                                </span>
<span class="4742082000916781311" onmouseenter="enter('4742082000916781311');" onmouseout="out('4742082000916781311');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 497 +      writeConfig(false, 0);                                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 498      } else {                                                                                                      </span>
<span class="3391323959293733932" onmouseenter="enter('3391323959293733932');" onmouseout="out('3391323959293733932');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 499 -      ALog.e(TAG, String.format(&quot;任务【%s】执行失败&quot;, getConfig().TEMP_FILE.getName()));                                  </span>

<span class="6290350204306664705" onmouseenter="enter('6290350204306664705');" onmouseout="out('6290350204306664705');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 500 -      ErrorHelp.saveError(TAG, &quot;&quot;, ALog.getExceptionString(ex));                                                  </span>
<span class="-2162507490503055467" onmouseenter="enter('-2162507490503055467');" onmouseout="out('-2162507490503055467');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 501 -      handleFailState(!isBreak());                                                                                </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 502 +      if (mTaskWrapper.isSupportBP()) {                                                                           </span>
<span class="5636262962850437364" onmouseenter="enter('5636262962850437364');" onmouseout="out('5636262962850437364');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 503 +        writeConfig(false, subCurrentLocation);                                                                   </span>
<span class="7955132104080368983" onmouseenter="enter('7955132104080368983');" onmouseout="out('7955132104080368983');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 504 +        retryThis(needRetry &amp;&amp; mConfig.startThreadNum != 1);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 505 +      } else {                                                                                                    </span>
<span class="6613685008099650869" onmouseenter="enter('6613685008099650869');" onmouseout="out('6613685008099650869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 506 +        ALog.e(TAG, String.format(&quot;任务【%s】执行失败&quot;, getFileName()));                                                  </span>
<span class="6290350204306664705" onmouseenter="enter('6290350204306664705');" onmouseout="out('6290350204306664705');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 507 +        ErrorHelp.saveError(TAG, &quot;&quot;, ALog.getExceptionString(ex));                                                </span>
<span class="-3645539894315514142" onmouseenter="enter('-3645539894315514142');" onmouseout="out('-3645539894315514142');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 508 +        sendFailMsg(null);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 509 +      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 510      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 511    }                                                                                                               </span>
<span  style=""> 512                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 513    /**                                                                                                             </span>
<span class="-9093725986363149842" onmouseenter="enter('-9093725986363149842');" onmouseout="out('-9093725986363149842');" style=""> 514     * 重试当前线程，如果其中一条线程已经下载失败，则任务该任务下载失败，并且停止该任务的所有线程                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 515     *                                                                                                              </span>
<span class="-7715462203363144181" onmouseenter="enter('-7715462203363144181');" onmouseout="out('-7715462203363144181');" style=""> 516     * @param needRetry 是否可以重试                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 517     */                                                                                                             </span>
<span class="-4017949080492709723" onmouseenter="enter('-4017949080492709723');" onmouseout="out('-4017949080492709723');" style=""> 518    private void retryThis(boolean needRetry) {                                                                     </span>
<span class="3310386334432410672" onmouseenter="enter('3310386334432410672');" onmouseout="out('3310386334432410672');" style=""> 519      if (!NetUtils.isConnected(AriaManager.APP) &amp;&amp; !isNotNetRetry) {                                               </span>
<span class="-626911073917424062" onmouseenter="enter('-626911073917424062');" onmouseout="out('-626911073917424062');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 520 -      ALog.w(TAG, String.format(&quot;任务【%s】重试失败，网络未连接&quot;, getConfig().TEMP_FILE.getName()));                            </span>
<span class="-540477151182203063" onmouseenter="enter('-540477151182203063');" onmouseout="out('-540477151182203063');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 521 +      ALog.w(TAG, String.format(&quot;任务【%s】重试失败，网络未连接&quot;, getFileName()));                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 522      }                                                                                                             </span>
<span class="1591223325682575890" onmouseenter="enter('1591223325682575890');" onmouseout="out('1591223325682575890');" style=""> 523      if (mFailTimes &lt; RETRY_NUM &amp;&amp; needRetry &amp;&amp; (NetUtils.isConnected(AriaManager.APP)                             </span>
<span class="8286758897154980077" onmouseenter="enter('8286758897154980077');" onmouseout="out('8286758897154980077');" style=""> 524          || isNotNetRetry) &amp;&amp; !isBreak()) {                                                                        </span>
<span class="5627414684221265205" onmouseenter="enter('5627414684221265205');" onmouseout="out('5627414684221265205');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 525 -      ALog.d(TAG, String.format(&quot;isCancel: %s, isStop: %s, isBreak: %s&quot;, getState().isCancel,                     </span>
<span class="-4811551907713175761" onmouseenter="enter('-4811551907713175761');" onmouseout="out('-4811551907713175761');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 526 -          getState().isStop, taskBreak));                                                                         </span>
<span class="-7711180097266902820" onmouseenter="enter('-7711180097266902820');" onmouseout="out('-7711180097266902820');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 527 -      ALog.w(TAG, String.format(&quot;任务【%s】正在重试&quot;, getConfig().TEMP_FILE.getName()));                                  </span>
<span class="-3870082629414944375" onmouseenter="enter('-3870082629414944375');" onmouseout="out('-3870082629414944375');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 528 +      ALog.w(TAG, String.format(&quot;任务【%s】正在重试&quot;, getFileName()));                                                    </span>
<span class="-1094790045894886583" onmouseenter="enter('-1094790045894886583');" onmouseout="out('-1094790045894886583');" style=""> 529        mFailTimes++;                                                                                               </span>
<span class="4458054822073455179" onmouseenter="enter('4458054822073455179');" onmouseout="out('4458054822073455179');" style=""> 530        handleRetryRecord();                                                                                        </span>
<span class="5034263136405999116" onmouseenter="enter('5034263136405999116');" onmouseout="out('5034263136405999116');" style=""> 531        ThreadTaskManager.getInstance().retryThread(AbsThreadTask.this);                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 532      } else {                                                                                                      </span>
<span class="-2162507490503055467" onmouseenter="enter('-2162507490503055467');" onmouseout="out('-2162507490503055467');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 533 -      handleFailState(!isBreak());                                                                                </span>
<span class="-3645539894315514142" onmouseenter="enter('-3645539894315514142');" onmouseout="out('-3645539894315514142');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 534 +      sendFailMsg(null);                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 535      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 536    }                                                                                                               </span>
<span  style=""> 537                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 538    /**                                                                                                             </span>
<span class="2024814027088983613" onmouseenter="enter('2024814027088983613');" onmouseout="out('2024814027088983613');" style=""> 539     * 处理线程重试的记录，只有多线程任务才会执行                                                                                        </span>
<span class="7355073000228872615" onmouseenter="enter('7355073000228872615');" onmouseout="out('7355073000228872615');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 540 +   * 如果是以前版本{@link BufferedRandomAccessFile}创建的下载，那么 record.startLocation不用修改                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 541     */                                                                                                             </span>
<span class="6729287348781078107" onmouseenter="enter('6729287348781078107');" onmouseout="out('6729287348781078107');" style=""> 542    private void handleRetryRecord() {                                                                              </span>
<span class="-6097666598137252140" onmouseenter="enter('-6097666598137252140');" onmouseout="out('-6097666598137252140');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 543 -    if (getTaskRecord().isBlock) {                                                                                </span>
<span class="-772418395532567131" onmouseenter="enter('-772418395532567131');" onmouseout="out('-772418395532567131');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 544 -      ThreadRecord tr = getThreadRecord();                                                                        </span>
<span class="7525858464156079810" onmouseenter="enter('7525858464156079810');" onmouseout="out('7525858464156079810');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 545 +    if (mConfig.isBlock) {                                                                                        </span>
<span class="-6754358035051648935" onmouseenter="enter('-6754358035051648935');" onmouseout="out('-6754358035051648935');" style=""> 546        // 默认线程分块长度                                                                                                 </span>
<span class="1435458847882886982" onmouseenter="enter('1435458847882886982');" onmouseout="out('1435458847882886982');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 547 -      long normalRectLen = getEntity().getFileSize() / getTaskRecord().threadRecords.size();                      </span>
<span class="1339069462370605015" onmouseenter="enter('1339069462370605015');" onmouseout="out('1339069462370605015');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 548 -      File temp = getBockFile();                                                                                  </span>
<span class="669945524285390040" onmouseenter="enter('669945524285390040');" onmouseout="out('669945524285390040');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 549 +      File temp = mConfig.tempFile;                                                                               </span>
<span  style=""> 550                                                                                                                    </span>
<span class="-793137946029070789" onmouseenter="enter('-793137946029070789');" onmouseout="out('-793137946029070789');" style=""> 551        long blockFileLen = temp.length(); // 磁盘中的分块文件长度                                                            </span>
<span class="1800685755263797470" onmouseenter="enter('1800685755263797470');" onmouseout="out('1800685755263797470');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 552 -      long threadRect = tr.blockLen;     // 当前线程的区间                                                               </span>
<span class="8378527770954177996" onmouseenter="enter('8378527770954177996');" onmouseout="out('8378527770954177996');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 553 +      long threadRect = mRecord.blockLen;     // 当前线程的区间                                                          </span>
<span  style=""> 554                                                                                                                    </span>
<span class="-2809861036487449932" onmouseenter="enter('-2809861036487449932');" onmouseout="out('-2809861036487449932');" style=""> 555        if (!temp.exists()) {                                                                                       </span>
<span class="2335841033690112132" onmouseenter="enter('2335841033690112132');" onmouseout="out('2335841033690112132');" style=""> 556          ALog.i(TAG, String.format(&quot;分块文件【%s】不存在，该分块将重新开始&quot;, temp.getName()));                                       </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 557 -        tr.isComplete = false;                                                                                    </span>
<span class="1794369607963048703" onmouseenter="enter('1794369607963048703');" onmouseout="out('1794369607963048703');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 558 -        getConfig().START_LOCATION = tr.startLocation;                                                            </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 559 +        mRecord.isComplete = false;                                                                               </span>
<span class="-8890616152097691977" onmouseenter="enter('-8890616152097691977');" onmouseout="out('-8890616152097691977');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 560 +        mRecord.startLocation = mRecord.endLocation - threadRect;                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 561        } else {                                                                                                    </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 562          /*                                                                                                        </span>
<span class="3457188544010136028" onmouseenter="enter('3457188544010136028');" onmouseout="out('3457188544010136028');" style=""> 563           * 检查磁盘中的分块文件                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 564           */                                                                                                       </span>
<span class="7157771772038955316" onmouseenter="enter('7157771772038955316');" onmouseout="out('7157771772038955316');" style=""> 565          if (blockFileLen &gt; threadRect) {                                                                          </span>
<span class="-3751962279648840181" onmouseenter="enter('-3751962279648840181');" onmouseout="out('-3751962279648840181');" style=""> 566            ALog.i(TAG, String.format(&quot;分块【%s】错误，将重新下载该分块&quot;, temp.getName()));                                        </span>
<span class="-2826646494613153676" onmouseenter="enter('-2826646494613153676');" onmouseout="out('-2826646494613153676');" style=""> 567            temp.delete();                                                                                          </span>
<span class="8390720937253795779" onmouseenter="enter('8390720937253795779');" onmouseout="out('8390720937253795779');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 568 -          tr.startLocation = normalRectLen * tr.threadId;                                                         </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 569 -          tr.isComplete = false;                                                                                  </span>
<span class="1794369607963048703" onmouseenter="enter('1794369607963048703');" onmouseout="out('1794369607963048703');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 570 -          getConfig().START_LOCATION = tr.startLocation;                                                          </span>
<span class="-2224292797040621368" onmouseenter="enter('-2224292797040621368');" onmouseout="out('-2224292797040621368');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 571 -        } else if (blockFileLen &lt; tr.blockLen) {                                                                  </span>
<span class="-4538066055428150738" onmouseenter="enter('-4538066055428150738');" onmouseout="out('-4538066055428150738');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 572 -          tr.startLocation = normalRectLen * tr.threadId + blockFileLen;                                          </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 573 -          tr.isComplete = false;                                                                                  </span>
<span class="1794369607963048703" onmouseenter="enter('1794369607963048703');" onmouseout="out('1794369607963048703');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 574 -          getConfig().START_LOCATION = tr.startLocation;                                                          </span>
<span class="-1518255202618997397" onmouseenter="enter('-1518255202618997397');" onmouseout="out('-1518255202618997397');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 575 -          getState().CURRENT_LOCATION = getBlockRealTotalSize();                                                  </span>
<span class="8371392117975581366" onmouseenter="enter('8371392117975581366');" onmouseout="out('8371392117975581366');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 576 +          mRecord.startLocation = mRecord.endLocation - mRecord.blockLen;                                         </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 577 +          mRecord.isComplete = false;                                                                             </span>
<span class="6776411255900347323" onmouseenter="enter('6776411255900347323');" onmouseout="out('6776411255900347323');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 578 +        } else if (blockFileLen &lt; mRecord.blockLen) {                                                             </span>
<span class="6584433194872596156" onmouseenter="enter('6584433194872596156');" onmouseout="out('6584433194872596156');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 579 +          mRecord.startLocation = mRecord.endLocation - mRecord.blockLen + blockFileLen;                          </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 580 +          mRecord.isComplete = false;                                                                             </span>
<span class="3415967563254175421" onmouseenter="enter('3415967563254175421');" onmouseout="out('3415967563254175421');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 581 +          sendState(IThreadState.STATE_UPDATE_PROGRESS, null);                                                    </span>
<span class="-3869098922257348244" onmouseenter="enter('-3869098922257348244');" onmouseout="out('-3869098922257348244');" style=""> 582            ALog.i(TAG,                                                                                             </span>
<span class="8437429982648821829" onmouseenter="enter('8437429982648821829');" onmouseout="out('8437429982648821829');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 583 -              String.format(&quot;修正分块【%s】，开始位置：%s，当前进度：%s&quot;, temp.getName(), tr.startLocation,                         </span>
<span class="2141132143456121531" onmouseenter="enter('2141132143456121531');" onmouseout="out('2141132143456121531');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 584 -                  getState().CURRENT_LOCATION));                                                                  </span>
<span class="2733924598962321997" onmouseenter="enter('2733924598962321997');" onmouseout="out('2733924598962321997');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 585 +              String.format(&quot;修正分块【%s】记录，开始位置：%s，结束位置：%s&quot;, temp.getName(), mRecord.startLocation,                  </span>
<span class="7451819391210675610" onmouseenter="enter('7451819391210675610');" onmouseout="out('7451819391210675610');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 586 +                  mRecord.endLocation));                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 587          } else {                                                                                                  </span>
<span class="-6777046188674518761" onmouseenter="enter('-6777046188674518761');" onmouseout="out('-6777046188674518761');" style=""> 588            ALog.i(TAG, String.format(&quot;分块【%s】已完成，更新记录&quot;, temp.getName()));                                           </span>
<span class="-1874286661234017426" onmouseenter="enter('-1874286661234017426');" onmouseout="out('-1874286661234017426');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 589 -          getState().COMPLETE_THREAD_NUM++;                                                                       </span>
<span class="6364817192610155634" onmouseenter="enter('6364817192610155634');" onmouseout="out('6364817192610155634');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 590 -          tr.isComplete = true;                                                                                   </span>
<span class="-3752598072096250383" onmouseenter="enter('-3752598072096250383');" onmouseout="out('-3752598072096250383');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 591 +          mRecord.isComplete = true;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 592          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 593        }                                                                                                           </span>
<span class="2745940133750228688" onmouseenter="enter('2745940133750228688');" onmouseout="out('2745940133750228688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 594 -      tr.update();                                                                                                </span>
<span class="-1713746282533100961" onmouseenter="enter('-1713746282533100961');" onmouseout="out('-1713746282533100961');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 595 +      mRecord.update();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 596 +    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 597 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 598 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 599 +  /**                                                                                                             </span>
<span class="590341144997189976" onmouseenter="enter('590341144997189976');" onmouseout="out('590341144997189976');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 600 +   * 发送任务完成的消息，并删除任务记录                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 601 +   */                                                                                                             </span>
<span class="1107873274627848500" onmouseenter="enter('1107873274627848500');" onmouseout="out('1107873274627848500');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 602 +  protected synchronized void sendCompleteMsg() {                                                                 </span>
<span class="5765255273240095600" onmouseenter="enter('5765255273240095600');" onmouseout="out('5765255273240095600');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 603 +    ALog.i(TAG, String.format(&quot;任务【%s】完成&quot;, getFileName()));                                                        </span>
<span class="4674231415812911135" onmouseenter="enter('4674231415812911135');" onmouseout="out('4674231415812911135');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 604 +    sendState(IThreadState.STATE_COMPLETE, null);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 605 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 606 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 607 +  /**                                                                                                             </span>
<span class="2603197968032099438" onmouseenter="enter('2603197968032099438');" onmouseout="out('2603197968032099438');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 608 +   * 发送失败信息                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 609 +   */                                                                                                             </span>
<span class="5094334093525103652" onmouseenter="enter('5094334093525103652');" onmouseout="out('5094334093525103652');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 610 +  protected void sendFailMsg(@Nullable BaseException e) {                                                         </span>
<span class="-125198456384004571" onmouseenter="enter('-125198456384004571');" onmouseout="out('-125198456384004571');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 611 +    if (e != null) {                                                                                              </span>
<span class="-6551099466538715534" onmouseenter="enter('-6551099466538715534');" onmouseout="out('-6551099466538715534');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 612 +      Bundle b = new Bundle();                                                                                    </span>
<span class="6044105917207690073" onmouseenter="enter('6044105917207690073');" onmouseout="out('6044105917207690073');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 613 +      b.putSerializable(IThreadState.KEY_ERROR_INFO, e);                                                          </span>
<span class="-6547766989655415645" onmouseenter="enter('-6547766989655415645');" onmouseout="out('-6547766989655415645');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 614 +      sendState(IThreadState.STATE_FAIL, b);                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 615      } else {                                                                                                      </span>
<span class="-9063021121610387938" onmouseenter="enter('-9063021121610387938');" onmouseout="out('-9063021121610387938');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 616 -      getConfig().START_LOCATION = mChildCurrentLocation == 0 ? getConfig().START_LOCATION                        </span>
<span class="6402636142825398324" onmouseenter="enter('6402636142825398324');" onmouseout="out('6402636142825398324');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 617 -          : getConfig().THREAD_RECORD.startLocation;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 618 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 619 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 620 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 621 -  /**                                                                                                             </span>
<span class="590341144997189976" onmouseenter="enter('590341144997189976');" onmouseout="out('590341144997189976');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 622 -   * 发送任务完成的消息，并删除任务记录                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 623 -   */                                                                                                             </span>
<span class="1107873274627848500" onmouseenter="enter('1107873274627848500');" onmouseout="out('1107873274627848500');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 624 -  protected synchronized void sendCompleteMsg() {                                                                 </span>
<span class="-5131553073025738201" onmouseenter="enter('-5131553073025738201');" onmouseout="out('-5131553073025738201');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 625 -    ALog.i(TAG, String.format(&quot;任务【%s】完成&quot;, mEntity.getFileName()));                                                </span>
<span class="3769004510167361430" onmouseenter="enter('3769004510167361430');" onmouseout="out('3769004510167361430');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 626 -    CommonUtil.delTaskRecord(mEntity.getKey(), mEntity instanceof DownloadEntity ? 1 : 2, false,                  </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 627 -        false);                                                                                                   </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 628 -    mListener.onComplete();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 629 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 630 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 631 -  /**                                                                                                             </span>
<span class="-4914781619633528981" onmouseenter="enter('-4914781619633528981');" onmouseout="out('-4914781619633528981');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 632 -   * 获取分块文件                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 633 -   *                                                                                                              </span>
<span class="-3403294675282309729" onmouseenter="enter('-3403294675282309729');" onmouseout="out('-3403294675282309729');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 634 -   * @return 分块文件                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 635 -   */                                                                                                             </span>
<span class="6324132714992558911" onmouseenter="enter('6324132714992558911');" onmouseout="out('6324132714992558911');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 636 -  private File getBockFile() {                                                                                    </span>
<span class="-3099288840421597936" onmouseenter="enter('-3099288840421597936');" onmouseout="out('-3099288840421597936');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 637 -    return new File(String.format(AbsFileer.SUB_PATH, getState().TASK_RECORD.filePath,                            </span>
<span class="107129339548236069" onmouseenter="enter('107129339548236069');" onmouseout="out('107129339548236069');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 638 -        getThreadRecord().threadId));                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 639 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 640 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 641 -  /**                                                                                                             </span>
<span class="4969531823063170669" onmouseenter="enter('4969531823063170669');" onmouseout="out('4969531823063170669');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 642 -   * 获取分块任务真实的进度                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 643 -   *                                                                                                              </span>
<span class="-7910542742577826170" onmouseenter="enter('-7910542742577826170');" onmouseout="out('-7910542742577826170');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 644 -   * @return 进度                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 645 -   */                                                                                                             </span>
<span class="2630103139076882842" onmouseenter="enter('2630103139076882842');" onmouseout="out('2630103139076882842');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 646 -  private long getBlockRealTotalSize() {                                                                          </span>
<span class="642216204902078772" onmouseenter="enter('642216204902078772');" onmouseout="out('642216204902078772');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 647 -    long size = 0;                                                                                                </span>
<span class="-2633808047987562515" onmouseenter="enter('-2633808047987562515');" onmouseout="out('-2633808047987562515');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 648 -    for (int i = 0, len = getTaskRecord().threadRecords.size(); i &lt; len; i++) {                                   </span>
<span class="2011759116138999417" onmouseenter="enter('2011759116138999417');" onmouseout="out('2011759116138999417');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 649 -      File temp = new File(String.format(AbsFileer.SUB_PATH, getTaskRecord().filePath, i));                       </span>
<span class="7100992962921282764" onmouseenter="enter('7100992962921282764');" onmouseout="out('7100992962921282764');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 650 -      if (temp.exists()) {                                                                                        </span>
<span class="9105498611704012504" onmouseenter="enter('9105498611704012504');" onmouseout="out('9105498611704012504');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 651 -        size += temp.length();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 652 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 653 -    }                                                                                                             </span>
<span class="7808415022879232995" onmouseenter="enter('7808415022879232995');" onmouseout="out('7808415022879232995');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 654 -    return size;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 655 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 656 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 657 -  /**                                                                                                             </span>
<span class="-6819868296763628683" onmouseenter="enter('-6819868296763628683');" onmouseout="out('-6819868296763628683');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 658 -   * 处理失败状态                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 659 -   *                                                                                                              </span>
<span class="3934936147770351393" onmouseenter="enter('3934936147770351393');" onmouseout="out('3934936147770351393');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 660 -   * @param taskNeedReTry 任务是否需要重试{@code true} 需要                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 661 -   */                                                                                                             </span>
<span class="-7222232112361188285" onmouseenter="enter('-7222232112361188285');" onmouseout="out('-7222232112361188285');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 662 -  private void handleFailState(boolean taskNeedReTry) {                                                           </span>
<span class="1108424211258829350" onmouseenter="enter('1108424211258829350');" onmouseout="out('1108424211258829350');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 663 -    getState().FAIL_NUM++;                                                                                        </span>
<span class="8039287929021169143" onmouseenter="enter('8039287929021169143');" onmouseout="out('8039287929021169143');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 664 -    if (getState().isFail()) {                                                                                    </span>
<span class="5700013221639440030" onmouseenter="enter('5700013221639440030');" onmouseout="out('5700013221639440030');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 665 -      // 手动停止不进行fail回调                                                                                            </span>
<span class="-1564742423953438638" onmouseenter="enter('-1564742423953438638');" onmouseout="out('-1564742423953438638');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 666 -      if (!getState().isStop) {                                                                                   </span>
<span class="-4114645115751754567" onmouseenter="enter('-4114645115751754567');" onmouseout="out('-4114645115751754567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 667 -        String errorMsg = String.format(&quot;任务【%s】执行失败&quot;, getConfig().TEMP_FILE.getName());                           </span>
<span class="-8924195278241805064" onmouseenter="enter('-8924195278241805064');" onmouseout="out('-8924195278241805064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 668 -        mListener.onFail(taskNeedReTry, new TaskException(TAG, errorMsg));                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 669 -      }                                                                                                           </span>
<span class="6048350305855132996" onmouseenter="enter('6048350305855132996');" onmouseout="out('6048350305855132996');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 670 +      sendState(IThreadState.STATE_FAIL, null);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 671      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 672    }                                                                                                               </span>
<span  style=""> 673                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 674    /**                                                                                                             </span>
<span class="6719845586187631935" onmouseenter="enter('6719845586187631935');" onmouseout="out('6719845586187631935');" style=""> 675     * 将记录写入到配置文件                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 676     *                                                                                                              </span>
<span class="6391874541652225431" onmouseenter="enter('6391874541652225431');" onmouseout="out('6391874541652225431');" style=""> 677     * @param isComplete 当前线程是否完成 {@code true}完成                                                                    </span>
<span class="-5364023467485105638" onmouseenter="enter('-5364023467485105638');" onmouseout="out('-5364023467485105638');" style=""> 678     * @param record 当前下载进度                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 679     */                                                                                                             </span>
<span class="5027582220747789474" onmouseenter="enter('5027582220747789474');" onmouseout="out('5027582220747789474');" style=""> 680    protected void writeConfig(boolean isComplete, final long record) {                                             </span>
<span class="-772418395532567131" onmouseenter="enter('-772418395532567131');" onmouseout="out('-772418395532567131');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 681 -    ThreadRecord tr = getThreadRecord();                                                                          </span>
<span class="1355828340554679893" onmouseenter="enter('1355828340554679893');" onmouseout="out('1355828340554679893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 682 -    if (tr != null) {                                                                                             </span>
<span class="-3117128929308758281" onmouseenter="enter('-3117128929308758281');" onmouseout="out('-3117128929308758281');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 683 -      tr.isComplete = isComplete;                                                                                 </span>
<span class="-6097666598137252140" onmouseenter="enter('-6097666598137252140');" onmouseout="out('-6097666598137252140');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 684 -      if (getTaskRecord().isBlock) {                                                                              </span>
<span class="-9020361014324490679" onmouseenter="enter('-9020361014324490679');" onmouseout="out('-9020361014324490679');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 685 -        tr.startLocation = record;                                                                                </span>
<span class="4349213121355893036" onmouseenter="enter('4349213121355893036');" onmouseout="out('4349213121355893036');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 686 -      } else if (getTaskRecord().isOpenDynamicFile) {                                                             </span>
<span class="-5284847096932428150" onmouseenter="enter('-5284847096932428150');" onmouseout="out('-5284847096932428150');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 687 -        tr.startLocation = getConfig().TEMP_FILE.length();                                                        </span>
<span class="8605925134180182455" onmouseenter="enter('8605925134180182455');" onmouseout="out('8605925134180182455');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 688 +    if (mRecord != null) {                                                                                        </span>
<span class="-5137168811759188909" onmouseenter="enter('-5137168811759188909');" onmouseout="out('-5137168811759188909');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 689 +      mRecord.isComplete = isComplete;                                                                            </span>
<span class="7525858464156079810" onmouseenter="enter('7525858464156079810');" onmouseout="out('7525858464156079810');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 690 +      if (mConfig.isBlock) {                                                                                      </span>
<span class="5039999237965274971" onmouseenter="enter('5039999237965274971');" onmouseout="out('5039999237965274971');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 691 +        mRecord.startLocation = record;                                                                           </span>
<span class="-1667997194350191014" onmouseenter="enter('-1667997194350191014');" onmouseout="out('-1667997194350191014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 692 +      } else if (mConfig.isOpenDynamicFile) {                                                                     </span>
<span class="-7448644562741689657" onmouseenter="enter('-7448644562741689657');" onmouseout="out('-7448644562741689657');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 693 +        mRecord.startLocation = mConfig.tempFile.length();                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 694        } else {                                                                                                    </span>
<span class="-3527672335905010214" onmouseenter="enter('-3527672335905010214');" onmouseout="out('-3527672335905010214');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 695 -        if (0 &lt; record &amp;&amp; record &lt; getConfig().END_LOCATION) {                                                    </span>
<span class="-9020361014324490679" onmouseenter="enter('-9020361014324490679');" onmouseout="out('-9020361014324490679');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 696 -          tr.startLocation = record;                                                                              </span>
<span class="111068837356204936" onmouseenter="enter('111068837356204936');" onmouseout="out('111068837356204936');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 697 +        if (0 &lt; record &amp;&amp; record &lt; mRecord.endLocation) {                                                         </span>
<span class="5039999237965274971" onmouseenter="enter('5039999237965274971');" onmouseout="out('5039999237965274971');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 698 +          mRecord.startLocation = record;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 699          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 700        }                                                                                                           </span>
<span class="2745940133750228688" onmouseenter="enter('2745940133750228688');" onmouseout="out('2745940133750228688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 701 -      tr.update();                                                                                                </span>
<span class="-1713746282533100961" onmouseenter="enter('-1713746282533100961');" onmouseout="out('-1713746282533100961');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 702 +      mRecord.update();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 703      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 704    }                                                                                                               </span>
<span  style=""> 705                                                                                                                    </span>
<span class="-624413037734427342" onmouseenter="enter('-624413037734427342');" onmouseout="out('-624413037734427342');" style=""> 706    @Override public AbsThreadTask call() throws Exception {                                                        </span>
<span class="7231940989594771196" onmouseenter="enter('7231940989594771196');" onmouseout="out('7231940989594771196');" style=""> 707      isInterrupted = false;                                                                                        </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style=""> 708      Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                                </span>
<span class="-1851318291295515457" onmouseenter="enter('-1851318291295515457');" onmouseout="out('-1851318291295515457');" style=""> 709      TrafficStats.setThreadStatsTag(UUID.randomUUID().toString().hashCode());                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 710      return this;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 711    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 712  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16  package com.arialyy.aria.core.common;                                                                             </span>
<span  style="">  17                                                                                                                    </span>
<span class="-6390350725830347024" onmouseenter="enter('-6390350725830347024');" onmouseout="out('-6390350725830347024');" style="">  18  import android.net.TrafficStats;                                                                                  </span>
<span class="8096531590004379472" onmouseenter="enter('8096531590004379472');" onmouseout="out('8096531590004379472');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  19 +import android.os.Bundle;                                                                                         </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  20 +import android.os.Handler;                                                                                        </span>
<span class="2113358441178436248" onmouseenter="enter('2113358441178436248');" onmouseout="out('2113358441178436248');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  21 +import android.os.Message;                                                                                        </span>
<span class="3485143652294101472" onmouseenter="enter('3485143652294101472');" onmouseout="out('3485143652294101472');" style="">  22  import android.os.Process;                                                                                        </span>
<span class="4394652512097310678" onmouseenter="enter('4394652512097310678');" onmouseout="out('4394652512097310678');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  23 +import android.support.annotation.Nullable;                                                                       </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  24  import com.arialyy.aria.core.AriaManager;                                                                         </span>
<span class="-7940163229294156086" onmouseenter="enter('-7940163229294156086');" onmouseout="out('-7940163229294156086');" style="">  25  import com.arialyy.aria.core.config.BaseTaskConfig;                                                               </span>
<span class="-1126292087500355850" onmouseenter="enter('-1126292087500355850');" onmouseout="out('-1126292087500355850');" style="">  26  import com.arialyy.aria.core.config.DGroupConfig;                                                                 </span>
<span class="1425241372324221776" onmouseenter="enter('1425241372324221776');" onmouseout="out('1425241372324221776');" style="">  27  import com.arialyy.aria.core.config.DownloadConfig;                                                               </span>
<span class="1322200574016778248" onmouseenter="enter('1322200574016778248');" onmouseout="out('1322200574016778248');" style="">  28  import com.arialyy.aria.core.config.UploadConfig;                                                                 </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import com.arialyy.aria.core.download.DownloadEntity;                                                             </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  30  import com.arialyy.aria.core.inf.AbsNormalEntity;                                                                 </span>
<span class="8472156907075048576" onmouseenter="enter('8472156907075048576');" onmouseout="out('8472156907075048576');" style="">  31  import com.arialyy.aria.core.inf.AbsTaskWrapper;                                                                  </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -import com.arialyy.aria.core.inf.IEventListener;                                                                  </span>

<span class="5965657858743993748" onmouseenter="enter('5965657858743993748');" onmouseout="out('5965657858743993748');" style="">  33  import com.arialyy.aria.core.manager.ThreadTaskManager;                                                           </span>
<span class="-5831681804875068292" onmouseenter="enter('-5831681804875068292');" onmouseout="out('-5831681804875068292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 -import com.arialyy.aria.core.upload.UploadEntity;                                                                 </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="">  35  import com.arialyy.aria.exception.BaseException;                                                                  </span>
<span class="2312101434658071953" onmouseenter="enter('2312101434658071953');" onmouseout="out('2312101434658071953');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -import com.arialyy.aria.exception.FileException;                                                                  </span>
<span class="-5001091348570971924" onmouseenter="enter('-5001091348570971924');" onmouseout="out('-5001091348570971924');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -import com.arialyy.aria.exception.TaskException;                                                                  </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  38  import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  39 -import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-1661010561836341583" onmouseenter="enter('-1661010561836341583');" onmouseout="out('-1661010561836341583');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  40 +import com.arialyy.aria.util.BufferedRandomAccessFile;                                                            </span>
<span class="3933848313391255451" onmouseenter="enter('3933848313391255451');" onmouseout="out('3933848313391255451');" style="">  41  import com.arialyy.aria.util.ErrorHelp;                                                                           </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  42 -import com.arialyy.aria.util.FileUtil;                                                                            </span>
<span class="-3921447581486569047" onmouseenter="enter('-3921447581486569047');" onmouseout="out('-3921447581486569047');" style="">  43  import com.arialyy.aria.util.NetUtils;                                                                            </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  44  import java.io.File;                                                                                              </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  45 -import java.util.ArrayList;                                                                                       </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  46 -import java.util.List;                                                                                            </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  47  import java.util.UUID;                                                                                            </span>
<span class="5756358326409676048" onmouseenter="enter('5756358326409676048');" onmouseout="out('5756358326409676048');" style="">  48  import java.util.concurrent.Callable;                                                                             </span>
<span class="-5549638946827519456" onmouseenter="enter('-5549638946827519456');" onmouseout="out('-5549638946827519456');" style="">  49  import java.util.concurrent.ExecutorService;                                                                      </span>
<span class="-3492814532060861089" onmouseenter="enter('-3492814532060861089');" onmouseout="out('-3492814532060861089');" style="">  50  import java.util.concurrent.Executors;                                                                            </span>
<span  style="">  51                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  52  /**                                                                                                               </span>
<span class="-7798270031920764735" onmouseenter="enter('-7798270031920764735');" onmouseout="out('-7798270031920764735');" style="">  53   * Created by lyy on 2017/1/18. 任务线程                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  54   */                                                                                                               </span>
<span class="-2011608922755448217" onmouseenter="enter('-2011608922755448217');" onmouseout="out('-2011608922755448217');" style="">  55  public abstract class AbsThreadTask&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTITY&gt;&gt;  </span>
<span class="6675695936259737122" onmouseenter="enter('6675695936259737122');" onmouseout="out('6675695936259737122');" style="">  56      implements Callable&lt;AbsThreadTask&gt; {                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  57    /**                                                                                                             </span>
<span class="-7421905703818920776" onmouseenter="enter('-7421905703818920776');" onmouseout="out('-7421905703818920776');" style="">  58     * 线程重试次数                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  59     */                                                                                                             </span>
<span class="2534354069603331424" onmouseenter="enter('2534354069603331424');" onmouseout="out('2534354069603331424');" style="">  60    private final int RETRY_NUM = 2;                                                                                </span>
<span  style="">  61                                                                                                                    </span>
<span class="-6736605921341736924" onmouseenter="enter('-6736605921341736924');" onmouseout="out('-6736605921341736924');" style="">  62    private final String TAG = &quot;AbsThreadTask&quot;;                                                                     </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  63    /**                                                                                                             </span>
<span class="5912262818254969140" onmouseenter="enter('5912262818254969140');" onmouseout="out('5912262818254969140');" style="">  64     * 当前子线程相对于总长度的位置                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  65     */                                                                                                             </span>
<span class="-6555994287222304012" onmouseenter="enter('-6555994287222304012');" onmouseout="out('-6555994287222304012');" style="">  66    protected long mChildCurrentLocation = 0;                                                                       </span>
<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  67 -  protected IEventListener mListener;                                                                             </span>
<span class="7423688287198995687" onmouseenter="enter('7423688287198995687');" onmouseout="out('7423688287198995687');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  68 -  private StateConstance sState;                                                                                  </span>
<span class="-531667924955094712" onmouseenter="enter('-531667924955094712');" onmouseout="out('-531667924955094712');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  69 -  private SubThreadConfig&lt;TASK_WRAPPER&gt; sConfig;                                                                  </span>
<span class="199695981196763510" onmouseenter="enter('199695981196763510');" onmouseout="out('199695981196763510');" style="">  70    private ENTITY mEntity;                                                                                         </span>
<span class="-6503818311630937885" onmouseenter="enter('-6503818311630937885');" onmouseout="out('-6503818311630937885');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  71 -  private TASK_WRAPPER mTaskWrapper;                                                                              </span>
<span class="4507751527304947270" onmouseenter="enter('4507751527304947270');" onmouseout="out('4507751527304947270');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +  protected TASK_WRAPPER mTaskWrapper;                                                                            </span>
<span class="7823640971996835282" onmouseenter="enter('7823640971996835282');" onmouseout="out('7823640971996835282');" style="">  73    private int mFailTimes = 0;                                                                                     </span>
<span class="-2140378055800192500" onmouseenter="enter('-2140378055800192500');" onmouseout="out('-2140378055800192500');" style="">  74    private long mLastSaveTime;                                                                                     </span>
<span class="7052955590557645990" onmouseenter="enter('7052955590557645990');" onmouseout="out('7052955590557645990');" style="">  75    private ExecutorService mConfigThreadPool;                                                                      </span>
<span class="4205150814631290032" onmouseenter="enter('4205150814631290032');" onmouseout="out('4205150814631290032');" style="">  76    private boolean isNotNetRetry;  //断网情况是否重试                                                                      </span>
<span class="-1742305716471965576" onmouseenter="enter('-1742305716471965576');" onmouseout="out('-1742305716471965576');" style="">  77    private boolean taskBreak = false;  //任务跳出                                                                      </span>
<span class="-6139985633669783481" onmouseenter="enter('-6139985633669783481');" onmouseout="out('-6139985633669783481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  78 -  private int mThreadNum;                                                                                         </span>
<span class="7265458021260352388" onmouseenter="enter('7265458021260352388');" onmouseout="out('7265458021260352388');" style="">  79    protected BandwidthLimiter mSpeedBandUtil; //速度限制工具                                                             </span>
<span class="2782655601744072115" onmouseenter="enter('2782655601744072115');" onmouseout="out('2782655601744072115');" style="">  80    protected AriaManager mAridManager;                                                                             </span>
<span class="4110495559709840165" onmouseenter="enter('4110495559709840165');" onmouseout="out('4110495559709840165');" style="">  81    private boolean isInterrupted = false;                                                                          </span>
<span class="8034502532514277404" onmouseenter="enter('8034502532514277404');" onmouseout="out('8034502532514277404');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +  protected boolean isCancel = false, isStop = false;                                                             </span>
<span class="-161749363286472354" onmouseenter="enter('-161749363286472354');" onmouseout="out('-161749363286472354');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +  protected ThreadRecord mRecord;                                                                                 </span>
<span class="8505538020780181250" onmouseenter="enter('8505538020780181250');" onmouseout="out('8505538020780181250');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  84 +  private Handler mStateHandler;                                                                                  </span>
<span class="-644453640718072602" onmouseenter="enter('-644453640718072602');" onmouseout="out('-644453640718072602');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +  private SubThreadConfig&lt;TASK_WRAPPER&gt; mConfig;                                                                  </span>
<span  style="">  86                                                                                                                    </span>
<span class="7317290166143616056" onmouseenter="enter('7317290166143616056');" onmouseout="out('7317290166143616056');" style="">  87    private Thread mConfigThread = new Thread(new Runnable() {                                                      </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="">  88      @Override public void run() {                                                                                 </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style="">  89        Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                              </span>
<span class="-5942055588561434981" onmouseenter="enter('-5942055588561434981');" onmouseout="out('-5942055588561434981');" style="">  90        final long currentTemp = mChildCurrentLocation;                                                             </span>
<span class="-8339432453951329407" onmouseenter="enter('-8339432453951329407');" onmouseout="out('-8339432453951329407');" style="">  91        writeConfig(false, currentTemp);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92      }                                                                                                             </span>
<span class="7938821646327104961" onmouseenter="enter('7938821646327104961');" onmouseout="out('7938821646327104961');" style="">  93    });                                                                                                             </span>
<span  style="">  94                                                                                                                    </span>
<span class="3074189361160379026" onmouseenter="enter('3074189361160379026');" onmouseout="out('3074189361160379026');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -  protected AbsThreadTask(StateConstance constance, IEventListener listener,                                      </span>
<span class="2373864060871007394" onmouseenter="enter('2373864060871007394');" onmouseout="out('2373864060871007394');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -      SubThreadConfig&lt;TASK_WRAPPER&gt; config) {                                                                     </span>
<span class="831497767920846752" onmouseenter="enter('831497767920846752');" onmouseout="out('831497767920846752');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -    sState = constance;                                                                                           </span>
<span class="3136850726515239208" onmouseenter="enter('3136850726515239208');" onmouseout="out('3136850726515239208');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -    sConfig = config;                                                                                             </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -    mListener = listener;                                                                                         </span>
<span class="-7311581110913810157" onmouseenter="enter('-7311581110913810157');" onmouseout="out('-7311581110913810157');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -    mTaskWrapper = getConfig().TASK_WRAPPER;                                                                      </span>
<span class="-5675375355167610812" onmouseenter="enter('-5675375355167610812');" onmouseout="out('-5675375355167610812');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +  protected AbsThreadTask(SubThreadConfig&lt;TASK_WRAPPER&gt; config) {                                                 </span>
<span class="-3079299502940909127" onmouseenter="enter('-3079299502940909127');" onmouseout="out('-3079299502940909127');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +    mConfig = config;                                                                                             </span>
<span class="7608526317231191360" onmouseenter="enter('7608526317231191360');" onmouseout="out('7608526317231191360');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +    mTaskWrapper = config.taskWrapper;                                                                            </span>
<span class="-9095243370238004613" onmouseenter="enter('-9095243370238004613');" onmouseout="out('-9095243370238004613');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +    mRecord = config.record;                                                                                      </span>
<span class="2077392471576236354" onmouseenter="enter('2077392471576236354');" onmouseout="out('2077392471576236354');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +    mStateHandler = config.stateHandler;                                                                          </span>
<span class="-7408997685265206061" onmouseenter="enter('-7408997685265206061');" onmouseout="out('-7408997685265206061');" style=""> 106      mEntity = mTaskWrapper.getEntity();                                                                           </span>
<span class="8631807426761684047" onmouseenter="enter('8631807426761684047');" onmouseout="out('8631807426761684047');" style=""> 107      mLastSaveTime = System.currentTimeMillis();                                                                   </span>
<span class="-6975975484715567483" onmouseenter="enter('-6975975484715567483');" onmouseout="out('-6975975484715567483');" style=""> 108      mConfigThreadPool = Executors.newCachedThreadPool();                                                          </span>
<span class="-8222889160787403128" onmouseenter="enter('-8222889160787403128');" onmouseout="out('-8222889160787403128');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 109 -    mThreadNum = getState().TASK_RECORD.threadRecords.size();                                                     </span>
<span class="1199175373698646667" onmouseenter="enter('1199175373698646667');" onmouseout="out('1199175373698646667');" style=""> 110      mAridManager = AriaManager.getInstance(AriaManager.APP);                                                      </span>
<span class="-8585141996075500857" onmouseenter="enter('-8585141996075500857');" onmouseout="out('-8585141996075500857');" style=""> 111      if (getMaxSpeed() &gt; 0) {                                                                                      </span>
<span class="8662855150660412990" onmouseenter="enter('8662855150660412990');" onmouseout="out('8662855150660412990');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 112 -      mSpeedBandUtil = new BandwidthLimiter(getMaxSpeed(), mThreadNum);                                           </span>
<span class="2630549456901300935" onmouseenter="enter('2630549456901300935');" onmouseout="out('2630549456901300935');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +      mSpeedBandUtil = new BandwidthLimiter(getMaxSpeed(), config.startThreadNum);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114      }                                                                                                             </span>
<span class="-2615274212376114043" onmouseenter="enter('-2615274212376114043');" onmouseout="out('-2615274212376114043');" style=""> 115      isNotNetRetry = mAridManager.getAppConfig().isNotNetRetry();                                                  </span>
<span class="-9180213342108359819" onmouseenter="enter('-9180213342108359819');" onmouseout="out('-9180213342108359819');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +    mChildCurrentLocation = mRecord.startLocation;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +  /**                                                                                                             </span>
<span class="-8737617058794341165" onmouseenter="enter('-8737617058794341165');" onmouseout="out('-8737617058794341165');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +   * 当前线程处理的文件名                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +   */                                                                                                             </span>
<span class="7302389212643046972" onmouseenter="enter('7302389212643046972');" onmouseout="out('7302389212643046972');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +  protected String getFileName() {                                                                                </span>
<span class="4833117926548008502" onmouseenter="enter('4833117926548008502');" onmouseout="out('4833117926548008502');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +    return mConfig.tempFile.getName();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +                                                                                                                  </span>
<span class="-3759066779726210536" onmouseenter="enter('-3759066779726210536');" onmouseout="out('-3759066779726210536');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +  protected SubThreadConfig&lt;TASK_WRAPPER&gt; getConfig() {                                                           </span>
<span class="-7756481640167229217" onmouseenter="enter('-7756481640167229217');" onmouseout="out('-7756481640167229217');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +    return mConfig;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128    }                                                                                                               </span>
<span  style=""> 129                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 130    /**                                                                                                             </span>
<span class="1636797617085164081" onmouseenter="enter('1636797617085164081');" onmouseout="out('1636797617085164081');" style=""> 131     * 设置线程是否中断                                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 132     *                                                                                                              </span>
<span class="6061025491082520720" onmouseenter="enter('6061025491082520720');" onmouseout="out('6061025491082520720');" style=""> 133     * @param isInterrupted {@code true} 中断                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 134     */                                                                                                             </span>
<span class="-3489753654187641055" onmouseenter="enter('-3489753654187641055');" onmouseout="out('-3489753654187641055');" style=""> 135    public void setInterrupted(boolean isInterrupted) {                                                             </span>
<span class="3679723848447236272" onmouseenter="enter('3679723848447236272');" onmouseout="out('3679723848447236272');" style=""> 136      this.isInterrupted = isInterrupted;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137    }                                                                                                               </span>
<span  style=""> 138                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 139    /**                                                                                                             </span>
<span class="-9093294427063192169" onmouseenter="enter('-9093294427063192169');" onmouseout="out('-9093294427063192169');" style=""> 140     * 线程是否存活                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 141     *                                                                                                              </span>
<span class="-4472564326041631774" onmouseenter="enter('-4472564326041631774');" onmouseout="out('-4472564326041631774');" style=""> 142     * @return {@code true}存活                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 143     */                                                                                                             </span>
<span class="5343971881214349340" onmouseenter="enter('5343971881214349340');" onmouseout="out('5343971881214349340');" style=""> 144    protected boolean isLive() {                                                                                    </span>
<span class="5056984206620082489" onmouseenter="enter('5056984206620082489');" onmouseout="out('5056984206620082489');" style=""> 145      return !Thread.currentThread().isInterrupted() &amp;&amp; !isInterrupted;                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146    }                                                                                                               </span>
<span  style=""> 147                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 148    /**                                                                                                             </span>
<span class="-1407135870976300" onmouseenter="enter('-1407135870976300');" onmouseout="out('-1407135870976300');" style=""> 149     * 当前线程是否完成，对于不支持断点的任务，一律未完成 {@code true} 完成；{@code false} 未完成                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 150     */                                                                                                             </span>
<span class="-5985760820188647103" onmouseenter="enter('-5985760820188647103');" onmouseout="out('-5985760820188647103');" style=""> 151    boolean isThreadComplete() {                                                                                    </span>
<span class="4226408888236486200" onmouseenter="enter('4226408888236486200');" onmouseout="out('4226408888236486200');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -    return getConfig().THREAD_RECORD.isComplete;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 154 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 155 -  /**                                                                                                             </span>
<span class="-6332731377908905639" onmouseenter="enter('-6332731377908905639');" onmouseout="out('-6332731377908905639');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 156 -   * 获取状态信息                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -   */                                                                                                             </span>
<span class="2061169541052624644" onmouseenter="enter('2061169541052624644');" onmouseout="out('2061169541052624644');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 158 -  protected StateConstance getState() {                                                                           </span>
<span class="2840565913553737849" onmouseenter="enter('2840565913553737849');" onmouseout="out('2840565913553737849');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -    return sState;                                                                                                </span>
<span class="-5832476025614563785" onmouseenter="enter('-5832476025614563785');" onmouseout="out('-5832476025614563785');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +    return mRecord.isComplete;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161    }                                                                                                               </span>
<span  style=""> 162                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 163    /**                                                                                                             </span>
<span class="4246443053284865110" onmouseenter="enter('4246443053284865110');" onmouseout="out('4246443053284865110');" style=""> 164     * 获取实体                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 165     */                                                                                                             </span>
<span class="-2158320671868788574" onmouseenter="enter('-2158320671868788574');" onmouseout="out('-2158320671868788574');" style=""> 166    protected ENTITY getEntity() {                                                                                  </span>
<span class="-2978486956956616380" onmouseenter="enter('-2978486956956616380');" onmouseout="out('-2978486956956616380');" style=""> 167      return mEntity;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168    }                                                                                                               </span>
<span  style=""> 169                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 170    /**                                                                                                             </span>
<span class="-6696632762627304447" onmouseenter="enter('-6696632762627304447');" onmouseout="out('-6696632762627304447');" style=""> 171     * 获取任务驱动对象                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 172     */                                                                                                             </span>
<span class="-7465189499125296678" onmouseenter="enter('-7465189499125296678');" onmouseout="out('-7465189499125296678');" style=""> 173    protected TASK_WRAPPER getTaskWrapper() {                                                                       </span>
<span class="-6199220384104149910" onmouseenter="enter('-6199220384104149910');" onmouseout="out('-6199220384104149910');" style=""> 174      return mTaskWrapper;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175    }                                                                                                               </span>
<span  style=""> 176                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 177    /**                                                                                                             </span>
<span class="-4551370295195792241" onmouseenter="enter('-4551370295195792241');" onmouseout="out('-4551370295195792241');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 178 -   * 获取任务记录                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 179 -   */                                                                                                             </span>
<span class="-9188054686409268214" onmouseenter="enter('-9188054686409268214');" onmouseout="out('-9188054686409268214');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 180 -  private TaskRecord getTaskRecord() {                                                                            </span>
<span class="641663240327807226" onmouseenter="enter('641663240327807226');" onmouseout="out('641663240327807226');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 181 -    return getState().TASK_RECORD;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 182 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 183 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 184 -  /**                                                                                                             </span>
<span class="182363347818178659" onmouseenter="enter('182363347818178659');" onmouseout="out('182363347818178659');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 185 -   * 获取线程记录                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 186 -   */                                                                                                             </span>
<span class="-3982307524336000161" onmouseenter="enter('-3982307524336000161');" onmouseout="out('-3982307524336000161');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 187 -  protected ThreadRecord getThreadRecord() {                                                                      </span>
<span class="8207684855507410927" onmouseenter="enter('8207684855507410927');" onmouseout="out('8207684855507410927');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 188 -    return getConfig().THREAD_RECORD;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 189 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 190 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 191 -  /**                                                                                                             </span>
<span class="-8261306668739895881" onmouseenter="enter('-8261306668739895881');" onmouseout="out('-8261306668739895881');" style=""> 192     * 获取配置的最大上传/下载速度                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 193     *                                                                                                              </span>
<span class="5179376621123361386" onmouseenter="enter('5179376621123361386');" onmouseout="out('5179376621123361386');" style=""> 194     * @return 单位为：kb                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 195     */                                                                                                             </span>
<span class="-896115242554653093" onmouseenter="enter('-896115242554653093');" onmouseout="out('-896115242554653093');" style=""> 196    public abstract int getMaxSpeed();                                                                              </span>
<span  style=""> 197                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 198    /**                                                                                                             </span>
<span class="-7476262045555684443" onmouseenter="enter('-7476262045555684443');" onmouseout="out('-7476262045555684443');" style=""> 199     * 读取任务配置                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 200     *                                                                                                              </span>
<span class="2765744486349037181" onmouseenter="enter('2765744486349037181');" onmouseout="out('2765744486349037181');" style=""> 201     * @return {@link DownloadConfig}、{@link UploadConfig}、{@link DGroupConfig}                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 202     */                                                                                                             </span>
<span class="8843669963162911719" onmouseenter="enter('8843669963162911719');" onmouseout="out('8843669963162911719');" style=""> 203    protected abstract BaseTaskConfig getTaskConfig();                                                              </span>
<span  style=""> 204                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 205    /**                                                                                                             </span>
<span class="-440811555959535495" onmouseenter="enter('-440811555959535495');" onmouseout="out('-440811555959535495');" style=""> 206     * 设置最大下载速度                                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 207     *                                                                                                              </span>
<span class="-1508955734956367613" onmouseenter="enter('-1508955734956367613');" onmouseout="out('-1508955734956367613');" style=""> 208     * @param speed 单位为：kb                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 209     */                                                                                                             </span>
<span class="-8974735338639184772" onmouseenter="enter('-8974735338639184772');" onmouseout="out('-8974735338639184772');" style=""> 210    public void setMaxSpeed(int speed) {                                                                            </span>
<span class="-649773427560821140" onmouseenter="enter('-649773427560821140');" onmouseout="out('-649773427560821140');" style=""> 211      if (mSpeedBandUtil != null) {                                                                                 </span>
<span class="-9065733257927852124" onmouseenter="enter('-9065733257927852124');" onmouseout="out('-9065733257927852124');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 212 -      mSpeedBandUtil.setMaxRate(speed / mThreadNum);                                                              </span>
<span class="-7563158316316320789" onmouseenter="enter('-7563158316316320789');" onmouseout="out('-7563158316316320789');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +      mSpeedBandUtil.setMaxRate(speed / mConfig.startThreadNum);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215    }                                                                                                               </span>
<span  style=""> 216                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 217    /**                                                                                                             </span>
<span class="6599720418575337619" onmouseenter="enter('6599720418575337619');" onmouseout="out('6599720418575337619');" style=""> 218     * 中断任务                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 219     */                                                                                                             </span>
<span class="4561569160041136245" onmouseenter="enter('4561569160041136245');" onmouseout="out('4561569160041136245');" style=""> 220    void breakTask() {                                                                                              </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 221      synchronized (AriaManager.LOCK) {                                                                             </span>
<span class="-3099491134649143832" onmouseenter="enter('-3099491134649143832');" onmouseout="out('-3099491134649143832');" style=""> 222        taskBreak = true;                                                                                           </span>
<span class="5006934068411751005" onmouseenter="enter('5006934068411751005');" onmouseout="out('5006934068411751005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 223 -      if (getConfig().SUPPORT_BP) {                                                                               </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +      if (mTaskWrapper.isSupportBP()) {                                                                           </span>
<span class="-5942055588561434981" onmouseenter="enter('-5942055588561434981');" onmouseout="out('-5942055588561434981');" style=""> 225          final long currentTemp = mChildCurrentLocation;                                                           </span>
<span class="983038057484720775" onmouseenter="enter('983038057484720775');" onmouseout="out('983038057484720775');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 226 -        getState().STOP_NUM++;                                                                                    </span>
<span class="-4664013463983592719" onmouseenter="enter('-4664013463983592719');" onmouseout="out('-4664013463983592719');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 227 -        ALog.d(TAG, String.format(&quot;任务【%s】thread__%s__中断【停止位置：%s】&quot;, getConfig().TEMP_FILE.getName(),               </span>
<span class="20570492298485329" onmouseenter="enter('20570492298485329');" onmouseout="out('20570492298485329');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -            getConfig().THREAD_ID, currentTemp));                                                                 </span>
<span class="4384426906541737800" onmouseenter="enter('4384426906541737800');" onmouseout="out('4384426906541737800');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +        sendState(ThreadStateManager.STATE_STOP, null);                                                           </span>
<span class="6146956303290790721" onmouseenter="enter('6146956303290790721');" onmouseout="out('6146956303290790721');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +        ALog.d(TAG, String.format(&quot;任务【%s】thread__%s__中断【停止位置：%s】&quot;, getFileName(),                                 </span>
<span class="376922911421079876" onmouseenter="enter('376922911421079876');" onmouseout="out('376922911421079876');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +            mRecord.threadId, currentTemp));                                                                      </span>
<span class="-8339432453951329407" onmouseenter="enter('-8339432453951329407');" onmouseout="out('-8339432453951329407');" style=""> 232          writeConfig(false, currentTemp);                                                                          </span>
<span class="-2563849418598631324" onmouseenter="enter('-2563849418598631324');" onmouseout="out('-2563849418598631324');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 233 -        if (getState().isStop()) {                                                                                </span>
<span class="7844720676096853926" onmouseenter="enter('7844720676096853926');" onmouseout="out('7844720676096853926');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 234 -          ALog.i(TAG, String.format(&quot;任务【%s】已中断&quot;, getConfig().TEMP_FILE.getName()));                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 235 -        }                                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 236        } else {                                                                                                    </span>
<span class="7844720676096853926" onmouseenter="enter('7844720676096853926');" onmouseout="out('7844720676096853926');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 237 -        ALog.i(TAG, String.format(&quot;任务【%s】已中断&quot;, getConfig().TEMP_FILE.getName()));                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 238 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 239 -    }                                                                                                             </span>
<span class="-2549462388866091673" onmouseenter="enter('-2549462388866091673');" onmouseout="out('-2549462388866091673');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +        ALog.i(TAG, String.format(&quot;任务【%s】已中断&quot;, getFileName()));                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +  /**                                                                                                             </span>
<span class="5256203714917913991" onmouseenter="enter('5256203714917913991');" onmouseout="out('5256203714917913991');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +   * 发送状态给状态处理器                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +   *                                                                                                              </span>
<span class="-4769173749986063162" onmouseenter="enter('-4769173749986063162');" onmouseout="out('-4769173749986063162');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +   * @param state {@link ThreadStateManager#STATE_STOP}..                                                         </span>
<span class="-4152917228807143386" onmouseenter="enter('-4152917228807143386');" onmouseout="out('-4152917228807143386');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +   * @param bundle 而外数据                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +   */                                                                                                             </span>
<span class="107634412995640864" onmouseenter="enter('107634412995640864');" onmouseout="out('107634412995640864');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +  void sendState(int state, @Nullable Bundle bundle) {                                                            </span>
<span class="5312338573559356541" onmouseenter="enter('5312338573559356541');" onmouseout="out('5312338573559356541');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +    Message msg = mStateHandler.obtainMessage();                                                                  </span>
<span class="4586264514118761504" onmouseenter="enter('4586264514118761504');" onmouseout="out('4586264514118761504');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +    msg.what = state;                                                                                             </span>
<span class="-3154970297737940190" onmouseenter="enter('-3154970297737940190');" onmouseout="out('-3154970297737940190');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +    if (bundle != null) {                                                                                         </span>
<span class="-5836915540506052451" onmouseenter="enter('-5836915540506052451');" onmouseout="out('-5836915540506052451');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +      msg.setData(bundle);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +    }                                                                                                             </span>
<span class="-656061765258294758" onmouseenter="enter('-656061765258294758');" onmouseout="out('-656061765258294758');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 257 +    msg.sendToTarget();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258    }                                                                                                               </span>
<span  style=""> 259                                                                                                                    </span>
<span class="5908327854870228087" onmouseenter="enter('5908327854870228087');" onmouseout="out('5908327854870228087');" style=""> 260    public boolean isInterrupted() {                                                                                </span>
<span class="-5203528151312862013" onmouseenter="enter('-5203528151312862013');" onmouseout="out('-5203528151312862013');" style=""> 261      return Thread.currentThread().isInterrupted();                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 262 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 263 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 264 -  /**                                                                                                             </span>
<span class="-5848423053385458497" onmouseenter="enter('-5848423053385458497');" onmouseout="out('-5848423053385458497');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 265 -   * 获取线程配置信息                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 266 -   */                                                                                                             </span>
<span class="-3759066779726210536" onmouseenter="enter('-3759066779726210536');" onmouseout="out('-3759066779726210536');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 267 -  protected SubThreadConfig&lt;TASK_WRAPPER&gt; getConfig() {                                                           </span>
<span class="-8168561174497257303" onmouseenter="enter('-8168561174497257303');" onmouseout="out('-8168561174497257303');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 268 -    return sConfig;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269    }                                                                                                               </span>
<span  style=""> 270                                                                                                                    </span>
<span class="-9198262987019797851" onmouseenter="enter('-9198262987019797851');" onmouseout="out('-9198262987019797851');" style=""> 271    @Override protected void finalize() throws Throwable {                                                          </span>
<span class="4114196779073131595" onmouseenter="enter('4114196779073131595');" onmouseout="out('4114196779073131595');" style=""> 272      super.finalize();                                                                                             </span>
<span class="-7477286483889370682" onmouseenter="enter('-7477286483889370682');" onmouseout="out('-7477286483889370682');" style=""> 273      if (mConfigThreadPool != null) {                                                                              </span>
<span class="6755739129057127055" onmouseenter="enter('6755739129057127055');" onmouseout="out('6755739129057127055');" style=""> 274        mConfigThreadPool.shutdown();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276    }                                                                                                               </span>
<span  style=""> 277                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 278    /**                                                                                                             </span>
<span class="4258051666929748339" onmouseenter="enter('4258051666929748339');" onmouseout="out('4258051666929748339');" style=""> 279     * 任务是否中断，中断条件： 1、任务取消 2、任务停止 3、手动中断 {@link #taskBreak}                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 280     *                                                                                                              </span>
<span class="8685725000128107952" onmouseenter="enter('8685725000128107952');" onmouseout="out('8685725000128107952');" style=""> 281     * @return {@code true} 中断，{@code false} 不是中断                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 282     */                                                                                                             </span>
<span class="1192236408818642919" onmouseenter="enter('1192236408818642919');" onmouseout="out('1192236408818642919');" style=""> 283    protected boolean isBreak() {                                                                                   </span>
<span class="4515372269683129077" onmouseenter="enter('4515372269683129077');" onmouseout="out('4515372269683129077');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 284 -    return getState().isCancel || getState().isStop || taskBreak;                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 285 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 286 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 287 -  /**                                                                                                             </span>
<span class="-8362313205067342402" onmouseenter="enter('-8362313205067342402');" onmouseout="out('-8362313205067342402');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 288 -   * 合并文件                                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 289 -   *                                                                                                              </span>
<span class="7152954986304769445" onmouseenter="enter('7152954986304769445');" onmouseout="out('7152954986304769445');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 290 -   * @return {@code true} 合并成功，{@code false}合并失败                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 291 -   */                                                                                                             </span>
<span class="4555889719712359225" onmouseenter="enter('4555889719712359225');" onmouseout="out('4555889719712359225');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 292 -  protected boolean mergeFile() {                                                                                 </span>
<span class="7604758579765859822" onmouseenter="enter('7604758579765859822');" onmouseout="out('7604758579765859822');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 293 -    List&lt;String&gt; partPath = new ArrayList&lt;&gt;();                                                                    </span>
<span class="908327015487725145" onmouseenter="enter('908327015487725145');" onmouseout="out('908327015487725145');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 294 -    for (int i = 0, len = getState().TASK_RECORD.threadNum; i &lt; len; i++) {                                       </span>
<span class="4939743928858325156" onmouseenter="enter('4939743928858325156');" onmouseout="out('4939743928858325156');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 295 -      partPath.add(String.format(AbsFileer.SUB_PATH, getState().TASK_RECORD.filePath, i));                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 296 -    }                                                                                                             </span>
<span class="-5947936726893417650" onmouseenter="enter('-5947936726893417650');" onmouseout="out('-5947936726893417650');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 297 -    boolean isSuccess = FileUtil.mergeFile(getState().TASK_RECORD.filePath, partPath);                            </span>
<span class="155883027282181251" onmouseenter="enter('155883027282181251');" onmouseout="out('155883027282181251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 298 -    if (isSuccess) {                                                                                              </span>
<span class="-8585313318236954494" onmouseenter="enter('-8585313318236954494');" onmouseout="out('-8585313318236954494');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 299 -      for (String pp : partPath) {                                                                                </span>
<span class="528717567100361765" onmouseenter="enter('528717567100361765');" onmouseout="out('528717567100361765');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 300 -        File f = new File(pp);                                                                                    </span>
<span class="8226260359634022247" onmouseenter="enter('8226260359634022247');" onmouseout="out('8226260359634022247');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 301 -        if (f.exists()) {                                                                                         </span>
<span class="7682989536937550366" onmouseenter="enter('7682989536937550366');" onmouseout="out('7682989536937550366');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 302 -          f.delete();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 303 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 304 -      }                                                                                                           </span>
<span class="-4058925986228208358" onmouseenter="enter('-4058925986228208358');" onmouseout="out('-4058925986228208358');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 305 -      File targetFile = new File(getState().TASK_RECORD.filePath);                                                </span>
<span class="4158176026694498796" onmouseenter="enter('4158176026694498796');" onmouseout="out('4158176026694498796');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 306 -      if (targetFile.exists() &amp;&amp; targetFile.length() &gt; getEntity().getFileSize()) {                               </span>
<span class="-2471360084270286815" onmouseenter="enter('-2471360084270286815');" onmouseout="out('-2471360084270286815');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 307 -        ALog.e(TAG, String.format(&quot;任务【%s】分块文件合并失败，下载长度超出文件真实长度，downloadLen: %s，fileSize: %s&quot;,                     </span>
<span class="-1236054566861987125" onmouseenter="enter('-1236054566861987125');" onmouseout="out('-1236054566861987125');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -            getConfig().TEMP_FILE.getName(), targetFile.length(), getEntity().getFileSize()));                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -        return false;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 310 -      }                                                                                                           </span>
<span class="6435844081899071775" onmouseenter="enter('6435844081899071775');" onmouseout="out('6435844081899071775');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 311 +    return isCancel || isStop || taskBreak;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 312 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 313 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 314 +  /**                                                                                                             </span>
<span class="-4436630274060532850" onmouseenter="enter('-4436630274060532850');" onmouseout="out('-4436630274060532850');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 315 +   * 检查下载完成的分块大小，如果下载完成的分块大小大于或小于分配的大小，则需要重新下载该分块 如果是非分块任务，直接返回{@code true}                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 316 +   *                                                                                                              </span>
<span class="-5962632420674681636" onmouseenter="enter('-5962632420674681636');" onmouseout="out('-5962632420674681636');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 317 +   * @return {@code true} 分块分大小正常，{@code false} 分块大小错误                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 318 +   */                                                                                                             </span>
<span class="-1715939541580522304" onmouseenter="enter('-1715939541580522304');" onmouseout="out('-1715939541580522304');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 319 +  protected boolean checkBlock() {                                                                                </span>
<span class="-8255347005712765724" onmouseenter="enter('-8255347005712765724');" onmouseout="out('-8255347005712765724');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 320 +    if (!mConfig.isBlock) {                                                                                       </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 321        return true;                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 322 -    } else {                                                                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 323 -      return false;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 324 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 325 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 326 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 327 -  /**                                                                                                             </span>
<span class="-4436630274060532850" onmouseenter="enter('-4436630274060532850');" onmouseout="out('-4436630274060532850');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 328 -   * 检查下载完成的分块大小，如果下载完成的分块大小大于或小于分配的大小，则需要重新下载该分块 如果是非分块任务，直接返回{@code true}                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 329 -   *                                                                                                              </span>
<span class="-5962632420674681636" onmouseenter="enter('-5962632420674681636');" onmouseout="out('-5962632420674681636');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 330 -   * @return {@code true} 分块分大小正常，{@code false} 分块大小错误                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 331 -   */                                                                                                             </span>
<span class="-1715939541580522304" onmouseenter="enter('-1715939541580522304');" onmouseout="out('-1715939541580522304');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 332 -  protected boolean checkBlock() {                                                                                </span>
<span class="-1670545497734825210" onmouseenter="enter('-1670545497734825210');" onmouseout="out('-1670545497734825210');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 333 -    if (!getTaskRecord().isBlock) {                                                                               </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 334 -      return true;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 335 -    }                                                                                                             </span>
<span class="-772418395532567131" onmouseenter="enter('-772418395532567131');" onmouseout="out('-772418395532567131');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 336 -    ThreadRecord tr = getThreadRecord();                                                                          </span>
<span class="1047909086628301767" onmouseenter="enter('1047909086628301767');" onmouseout="out('1047909086628301767');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 337 -    File blockFile = getBockFile();                                                                               </span>
<span class="3308229969593575316" onmouseenter="enter('3308229969593575316');" onmouseout="out('3308229969593575316');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 338 -    if (!blockFile.exists() || blockFile.length() != tr.blockLen) {                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 339 +    }                                                                                                             </span>
<span class="3935656399577463427" onmouseenter="enter('3935656399577463427');" onmouseout="out('3935656399577463427');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 340 +    File blockFile = mConfig.tempFile;                                                                            </span>
<span class="-1695353633342038156" onmouseenter="enter('-1695353633342038156');" onmouseout="out('-1695353633342038156');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +    if (!blockFile.exists() || blockFile.length() != mRecord.blockLen) {                                          </span>
<span class="-3869098922257348244" onmouseenter="enter('-3869098922257348244');" onmouseout="out('-3869098922257348244');" style=""> 342        ALog.i(TAG,                                                                                                 </span>
<span class="-4253990883383800149" onmouseenter="enter('-4253990883383800149');" onmouseout="out('-4253990883383800149');" style=""> 343            String.format(&quot;分块【%s】错误，blockFileLen: %s, threadRect: %s; 即将重新下载该分块，开始位置：%s，结束位置：%s&quot;,                   </span>
<span class="3316816270966189813" onmouseenter="enter('3316816270966189813');" onmouseout="out('3316816270966189813');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 344 -              blockFile.getName(), blockFile.length(), tr.blockLen, tr.startLocation,                             </span>
<span class="-1499185844779558933" onmouseenter="enter('-1499185844779558933');" onmouseout="out('-1499185844779558933');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 345 -              tr.endLocation));                                                                                   </span>
<span class="2939919814588467615" onmouseenter="enter('2939919814588467615');" onmouseout="out('2939919814588467615');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 346 +              blockFile.getName(), blockFile.length(), mRecord.blockLen, mRecord.startLocation,                   </span>
<span class="7451819391210675610" onmouseenter="enter('7451819391210675610');" onmouseout="out('7451819391210675610');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 347 +              mRecord.endLocation));                                                                              </span>
<span class="-3823857485302692882" onmouseenter="enter('-3823857485302692882');" onmouseout="out('-3823857485302692882');" style=""> 348        if (blockFile.exists()) {                                                                                   </span>
<span class="-8675830801645990020" onmouseenter="enter('-8675830801645990020');" onmouseout="out('-8675830801645990020');" style=""> 349          blockFile.delete();                                                                                       </span>
<span class="2945539549828015550" onmouseenter="enter('2945539549828015550');" onmouseout="out('2945539549828015550');" style=""> 350          ALog.i(TAG, String.format(&quot;删除分块【%s】成功&quot;, blockFile.getName()));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351        }                                                                                                           </span>
<span class="-6720013085559771010" onmouseenter="enter('-6720013085559771010');" onmouseout="out('-6720013085559771010');" style=""> 352        retryThis(isBreak());                                                                                       </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 353        return false;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 354      }                                                                                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 355      return true;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 356    }                                                                                                               </span>
<span  style=""> 357                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 358    /**                                                                                                             </span>
<span class="-7882741939763414839" onmouseenter="enter('-7882741939763414839');" onmouseout="out('-7882741939763414839');" style=""> 359     * 停止任务                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 360     */                                                                                                             </span>
<span class="-1831798800985246753" onmouseenter="enter('-1831798800985246753');" onmouseout="out('-1831798800985246753');" style=""> 361    public void stop() {                                                                                            </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 362      synchronized (AriaManager.LOCK) {                                                                             </span>
<span class="5006934068411751005" onmouseenter="enter('5006934068411751005');" onmouseout="out('5006934068411751005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 363 -      if (getConfig().SUPPORT_BP) {                                                                               </span>
<span class="3314071653469644267" onmouseenter="enter('3314071653469644267');" onmouseout="out('3314071653469644267');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 364 -        final long stopLocation;                                                                                  </span>
<span class="-6097666598137252140" onmouseenter="enter('-6097666598137252140');" onmouseout="out('-6097666598137252140');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 365 -        if (getTaskRecord().isBlock) {                                                                            </span>
<span class="1047909086628301767" onmouseenter="enter('1047909086628301767');" onmouseout="out('1047909086628301767');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 366 -          File blockFile = getBockFile();                                                                         </span>
<span class="-772418395532567131" onmouseenter="enter('-772418395532567131');" onmouseout="out('-772418395532567131');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 367 -          ThreadRecord tr = getThreadRecord();                                                                    </span>
<span class="5379353079923932335" onmouseenter="enter('5379353079923932335');" onmouseout="out('5379353079923932335');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 368 -          long block = getEntity().getFileSize() / getTaskRecord().threadRecords.size();                          </span>
<span class="-2425208671748558296" onmouseenter="enter('-2425208671748558296');" onmouseout="out('-2425208671748558296');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 369 -          stopLocation =                                                                                          </span>
<span class="-4052936473739545811" onmouseenter="enter('-4052936473739545811');" onmouseout="out('-4052936473739545811');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 370 -              blockFile.exists() ? (tr.threadId * block + blockFile.length()) : tr.threadId * block;              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 371 -        } else {                                                                                                  </span>
<span class="-6696570474422776739" onmouseenter="enter('-6696570474422776739');" onmouseout="out('-6696570474422776739');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 372 -          stopLocation = mChildCurrentLocation;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 373 -        }                                                                                                         </span>
<span class="983038057484720775" onmouseenter="enter('983038057484720775');" onmouseout="out('983038057484720775');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 374 -        getState().STOP_NUM++;                                                                                    </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 375 +      isStop = true;                                                                                              </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 376 +      if (mTaskWrapper.isSupportBP()) {                                                                           </span>
<span class="3999428278528562375" onmouseenter="enter('3999428278528562375');" onmouseout="out('3999428278528562375');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 377 +        final long stopLocation = mChildCurrentLocation;                                                          </span>
<span class="4384426906541737800" onmouseenter="enter('4384426906541737800');" onmouseout="out('4384426906541737800');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 378 +        sendState(ThreadStateManager.STATE_STOP, null);                                                           </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style=""> 379          ALog.d(TAG,                                                                                               </span>
<span class="1260993367462472769" onmouseenter="enter('1260993367462472769');" onmouseout="out('1260993367462472769');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 380 -            String.format(&quot;任务【%s】thread__%s__停止【当前线程停止位置：%s】&quot;, getConfig().TEMP_FILE.getName(),                   </span>
<span class="-1077621383480476737" onmouseenter="enter('-1077621383480476737');" onmouseout="out('-1077621383480476737');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 381 -                getConfig().THREAD_ID, stopLocation));                                                            </span>
<span class="1550861091873015536" onmouseenter="enter('1550861091873015536');" onmouseout="out('1550861091873015536');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 382 +            String.format(&quot;任务【%s】thread__%s__停止【当前线程停止位置：%s】&quot;, getFileName(),                                     </span>
<span class="-867220232156674741" onmouseenter="enter('-867220232156674741');" onmouseout="out('-867220232156674741');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 383 +                mRecord.threadId, stopLocation));                                                                 </span>
<span class="7792260418457311232" onmouseenter="enter('7792260418457311232');" onmouseout="out('7792260418457311232');" style=""> 384          writeConfig(false, stopLocation);                                                                         </span>
<span class="564635047036260779" onmouseenter="enter('564635047036260779');" onmouseout="out('564635047036260779');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 385 -        //ALog.d(TAG, String.format(&quot;stop_thread_num=%s; start_thread_num=%s; complete_thread_num=%s&quot;,            </span>
<span class="-6932797855731597085" onmouseenter="enter('-6932797855731597085');" onmouseout="out('-6932797855731597085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 386 -        //    getState().STOP_NUM, getState().START_THREAD_NUM, getState().COMPLETE_THREAD_NUM));                 </span>
<span class="-2563849418598631324" onmouseenter="enter('-2563849418598631324');" onmouseout="out('-2563849418598631324');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 387 -        if (getState().isStop()) {                                                                                </span>
<span class="668364159880084768" onmouseenter="enter('668364159880084768');" onmouseout="out('668364159880084768');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 388 -          ALog.i(TAG, String.format(&quot;任务【%s】已停止&quot;, getConfig().TEMP_FILE.getName()));                               </span>
<span class="1872144609445620235" onmouseenter="enter('1872144609445620235');" onmouseout="out('1872144609445620235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 389 -          mListener.onStop(getState().CURRENT_LOCATION);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 390 -        }                                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 391        } else {                                                                                                    </span>
<span class="668364159880084768" onmouseenter="enter('668364159880084768');" onmouseout="out('668364159880084768');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 392 -        ALog.i(TAG, String.format(&quot;任务【%s】已停止&quot;, getConfig().TEMP_FILE.getName()));                                 </span>
<span class="1872144609445620235" onmouseenter="enter('1872144609445620235');" onmouseout="out('1872144609445620235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 393 -        mListener.onStop(getState().CURRENT_LOCATION);                                                            </span>
<span class="-8753703196049872436" onmouseenter="enter('-8753703196049872436');" onmouseout="out('-8753703196049872436');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 394 +        ALog.i(TAG, String.format(&quot;任务【%s】已停止&quot;, getFileName()));                                                   </span>
<span class="4384426906541737800" onmouseenter="enter('4384426906541737800');" onmouseout="out('4384426906541737800');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 395 +        sendState(ThreadStateManager.STATE_STOP, null);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 396        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 397      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 398    }                                                                                                               </span>
<span  style=""> 399                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 400    /**                                                                                                             </span>
<span class="7873398811029444044" onmouseenter="enter('7873398811029444044');" onmouseout="out('7873398811029444044');" style=""> 401     * 执行中                                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 402     */                                                                                                             </span>
<span class="7428157636721718570" onmouseenter="enter('7428157636721718570');" onmouseout="out('7428157636721718570');" style=""> 403    protected void progress(long len) {                                                                             </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 404      synchronized (AriaManager.LOCK) {                                                                             </span>
<span class="-5158817120850263884" onmouseenter="enter('-5158817120850263884');" onmouseout="out('-5158817120850263884');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 405 -      if (getState().CURRENT_LOCATION &gt; getEntity().getFileSize() &amp;&amp; !getTaskWrapper().asHttp()                   </span>
<span class="-5689702993538725830" onmouseenter="enter('-5689702993538725830');" onmouseout="out('-5689702993538725830');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 406 -          .isChunked()) {                                                                                         </span>
<span class="272704129949425447" onmouseenter="enter('272704129949425447');" onmouseout="out('272704129949425447');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 407 -        String errorMsg =                                                                                         </span>
<span class="4440641683122614336" onmouseenter="enter('4440641683122614336');" onmouseout="out('4440641683122614336');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 408 -            String.format(&quot;下载失败，下载长度超出文件真实长度；currentLocation=%s, fileSize=%s&quot;,                                    </span>
<span class="-4161466068211400608" onmouseenter="enter('-4161466068211400608');" onmouseout="out('-4161466068211400608');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 409 -                getState().CURRENT_LOCATION,                                                                      </span>
<span class="4915606519379135079" onmouseenter="enter('4915606519379135079');" onmouseout="out('4915606519379135079');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 410 -                getEntity().getFileSize());                                                                       </span>
<span class="-3099491134649143832" onmouseenter="enter('-3099491134649143832');" onmouseout="out('-3099491134649143832');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 411 -        taskBreak = true;                                                                                         </span>
<span class="3048453949361930159" onmouseenter="enter('3048453949361930159');" onmouseout="out('3048453949361930159');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 412 -        fail(mChildCurrentLocation, new FileException(TAG, errorMsg), false);                                     </span>
<span class="2533028217200451003" onmouseenter="enter('2533028217200451003');" onmouseout="out('2533028217200451003');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 413 +      //if (getState().CURRENT_LOCATION &gt; getEntity().getFileSize() &amp;&amp; !getTaskWrapper().asHttp()                 </span>
<span class="-1186412116255119268" onmouseenter="enter('-1186412116255119268');" onmouseout="out('-1186412116255119268');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 414 +      //    .isChunked()) {                                                                                       </span>
<span class="-4532666615131915740" onmouseenter="enter('-4532666615131915740');" onmouseout="out('-4532666615131915740');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 415 +      //  String errorMsg =                                                                                       </span>
<span class="518171698288030827" onmouseenter="enter('518171698288030827');" onmouseout="out('518171698288030827');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 416 +      //      String.format(&quot;下载失败，下载长度超出文件真实长度；currentLocation=%s, fileSize=%s&quot;,                                  </span>
<span class="-3066839761455073570" onmouseenter="enter('-3066839761455073570');" onmouseout="out('-3066839761455073570');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 417 +      //          getState().CURRENT_LOCATION,                                                                    </span>
<span class="-4715215170271404042" onmouseenter="enter('-4715215170271404042');" onmouseout="out('-4715215170271404042');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 418 +      //          getEntity().getFileSize());                                                                     </span>
<span class="3035606892929688966" onmouseenter="enter('3035606892929688966');" onmouseout="out('3035606892929688966');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 419 +      //  taskBreak = true;                                                                                       </span>
<span class="5067342317456439021" onmouseenter="enter('5067342317456439021');" onmouseout="out('5067342317456439021');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 420 +      //  fail(mChildCurrentLocation, new FileException(TAG, errorMsg), false);                                   </span>
<span class="3500611444781325819" onmouseenter="enter('3500611444781325819');" onmouseout="out('3500611444781325819');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 421 +      //  return;                                                                                                 </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 422 +      //}                                                                                                         </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 423 +      mChildCurrentLocation += len;                                                                               </span>
<span class="-6345084862948761327" onmouseenter="enter('-6345084862948761327');" onmouseout="out('-6345084862948761327');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 424 +      if (!mStateHandler.getLooper().getThread().isAlive()) {                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 425          return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 426        }                                                                                                           </span>
<span class="-5510619108900694663" onmouseenter="enter('-5510619108900694663');" onmouseout="out('-5510619108900694663');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 427 -      mChildCurrentLocation += len;                                                                               </span>
<span class="7118339639886667974" onmouseenter="enter('7118339639886667974');" onmouseout="out('7118339639886667974');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 428 -      getState().CURRENT_LOCATION += len;                                                                         </span>
<span class="7039631086012701451" onmouseenter="enter('7039631086012701451');" onmouseout="out('7039631086012701451');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 429 +      mStateHandler.obtainMessage(ThreadStateManager.STATE_RUNNING, len).sendToTarget();                          </span>
<span class="8466413356993225320" onmouseenter="enter('8466413356993225320');" onmouseout="out('8466413356993225320');" style=""> 430        if (System.currentTimeMillis() - mLastSaveTime &gt; 5000                                                       </span>
<span class="-1760411904350794527" onmouseenter="enter('-1760411904350794527');" onmouseout="out('-1760411904350794527');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 431 -          &amp;&amp; mChildCurrentLocation &lt; getConfig().END_LOCATION) {                                                  </span>
<span class="-4608803573017792643" onmouseenter="enter('-4608803573017792643');" onmouseout="out('-4608803573017792643');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 432 +          &amp;&amp; mChildCurrentLocation &lt; mRecord.endLocation) {                                                       </span>
<span class="8631807426761684047" onmouseenter="enter('8631807426761684047');" onmouseout="out('8631807426761684047');" style=""> 433          mLastSaveTime = System.currentTimeMillis();                                                               </span>
<span class="6892340968550800051" onmouseenter="enter('6892340968550800051');" onmouseout="out('6892340968550800051');" style=""> 434          if (!mConfigThreadPool.isShutdown()) {                                                                    </span>
<span class="5224309411782533590" onmouseenter="enter('5224309411782533590');" onmouseout="out('5224309411782533590');" style=""> 435            mConfigThreadPool.execute(mConfigThread);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 436          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 437        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 438      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 439    }                                                                                                               </span>
<span  style=""> 440                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 441    /**                                                                                                             </span>
<span class="-1608425225589706128" onmouseenter="enter('-1608425225589706128');" onmouseout="out('-1608425225589706128');" style=""> 442     * 取消任务                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 443     */                                                                                                             </span>
<span class="-6930343012855552909" onmouseenter="enter('-6930343012855552909');" onmouseout="out('-6930343012855552909');" style=""> 444    public void cancel() {                                                                                          </span>
<span class="653614843745855757" onmouseenter="enter('653614843745855757');" onmouseout="out('653614843745855757');" style=""> 445      synchronized (AriaManager.LOCK) {                                                                             </span>
<span class="5006934068411751005" onmouseenter="enter('5006934068411751005');" onmouseout="out('5006934068411751005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 446 -      if (getConfig().SUPPORT_BP) {                                                                               </span>
<span class="-8476168595799833278" onmouseenter="enter('-8476168595799833278');" onmouseout="out('-8476168595799833278');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 447 -        getState().CANCEL_NUM++;                                                                                  </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 448 -        ALog.d(TAG,                                                                                               </span>
<span class="6395804831943421275" onmouseenter="enter('6395804831943421275');" onmouseout="out('6395804831943421275');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 449 -            String.format(&quot;任务【%s】thread__%s__取消&quot;, getConfig().TEMP_FILE.getName(),                                </span>
<span class="-5134797844221077154" onmouseenter="enter('-5134797844221077154');" onmouseout="out('-5134797844221077154');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 450 -                getConfig().THREAD_ID));                                                                          </span>
<span class="-6928137037894099645" onmouseenter="enter('-6928137037894099645');" onmouseout="out('-6928137037894099645');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 451 -        //ALog.d(TAG, &quot;cancel_num = &quot;                                                                             </span>
<span class="-3808138091041989092" onmouseenter="enter('-3808138091041989092');" onmouseout="out('-3808138091041989092');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 452 -        //    + getState().CANCEL_NUM                                                                             </span>
<span class="-8428616108043738512" onmouseenter="enter('-8428616108043738512');" onmouseout="out('-8428616108043738512');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 453 -        //    + &quot;, start_thread_num = &quot;                                                                           </span>
<span class="4228072879151325436" onmouseenter="enter('4228072879151325436');" onmouseout="out('4228072879151325436');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 454 -        //    + getState().START_THREAD_NUM);                                                                     </span>
<span class="3713470206061401237" onmouseenter="enter('3713470206061401237');" onmouseout="out('3713470206061401237');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 455 -        if (getState().isCancel()) {                                                                              </span>
<span class="789849241623899039" onmouseenter="enter('789849241623899039');" onmouseout="out('789849241623899039');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 456 -          if (getConfig().TEMP_FILE.exists() &amp;&amp; !(getEntity() instanceof UploadEntity)) {                         </span>
<span class="5931760867942988811" onmouseenter="enter('5931760867942988811');" onmouseout="out('5931760867942988811');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 457 -            getConfig().TEMP_FILE.delete();                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 458 -          }                                                                                                       </span>
<span class="1655463578773384958" onmouseenter="enter('1655463578773384958');" onmouseout="out('1655463578773384958');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 459 -          ALog.d(TAG, String.format(&quot;任务【%s】已取消&quot;, getConfig().TEMP_FILE.getName()));                               </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 460 -          mListener.onCancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 461 -        }                                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 462 -      } else {                                                                                                    </span>
<span class="1655463578773384958" onmouseenter="enter('1655463578773384958');" onmouseout="out('1655463578773384958');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 463 -        ALog.d(TAG, String.format(&quot;任务【%s】已取消&quot;, getConfig().TEMP_FILE.getName()));                                 </span>
<span class="-143920400974177420" onmouseenter="enter('-143920400974177420');" onmouseout="out('-143920400974177420');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 464 -        mListener.onCancel();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 465 -      }                                                                                                           </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 466 +      isCancel = true;                                                                                            </span>
<span class="5570544159779772188" onmouseenter="enter('5570544159779772188');" onmouseout="out('5570544159779772188');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 467 +      sendState(ThreadStateManager.STATE_CANCEL, null);                                                           </span>
<span class="4380341803279364696" onmouseenter="enter('4380341803279364696');" onmouseout="out('4380341803279364696');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 468 +      ALog.d(TAG,                                                                                                 </span>
<span class="-2078406994386200129" onmouseenter="enter('-2078406994386200129');" onmouseout="out('-2078406994386200129');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 469 +          String.format(&quot;任务【%s】thread__%s__取消&quot;, getFileName(), mRecord.threadId));                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 470      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 471    }                                                                                                               </span>
<span  style=""> 472                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 473    /**                                                                                                             </span>
<span class="-3628170746268112272" onmouseenter="enter('-3628170746268112272');" onmouseout="out('-3628170746268112272');" style=""> 474     * 线程任务失败                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 475     *                                                                                                              </span>
<span class="6810672559305889194" onmouseenter="enter('6810672559305889194');" onmouseout="out('6810672559305889194');" style=""> 476     * @param subCurrentLocation 当前线程下载进度                                                                           </span>
<span class="774581074216290190" onmouseenter="enter('774581074216290190');" onmouseout="out('774581074216290190');" style=""> 477     * @param ex 异常信息                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 478     */                                                                                                             </span>
<span class="1500165102101720475" onmouseenter="enter('1500165102101720475');" onmouseout="out('1500165102101720475');" style=""> 479    protected void fail(final long subCurrentLocation, BaseException ex) {                                          </span>
<span class="-2149101237246601219" onmouseenter="enter('-2149101237246601219');" onmouseout="out('-2149101237246601219');" style=""> 480      fail(subCurrentLocation, ex, true);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 481    }                                                                                                               </span>
<span  style=""> 482                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 483    /**                                                                                                             </span>
<span class="7725539954827761966" onmouseenter="enter('7725539954827761966');" onmouseout="out('7725539954827761966');" style=""> 484     * 任务失败                                                                                                         </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 485     *                                                                                                              </span>
<span class="7399711965916828500" onmouseenter="enter('7399711965916828500');" onmouseout="out('7399711965916828500');" style=""> 486     * @param subCurrentLocation 当前子线程进度                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 487     */                                                                                                             </span>
<span class="3846496864338478922" onmouseenter="enter('3846496864338478922');" onmouseout="out('3846496864338478922');" style=""> 488    protected void fail(final long subCurrentLocation, BaseException ex, boolean needRetry) {                       </span>
<span class="-3832690312485057937" onmouseenter="enter('-3832690312485057937');" onmouseout="out('-3832690312485057937');" style=""> 489      if (ex != null) {                                                                                             </span>
<span class="-333456365485290101" onmouseenter="enter('-333456365485290101');" onmouseout="out('-333456365485290101');" style=""> 490        ALog.e(TAG, ALog.getExceptionString(ex));                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491      }                                                                                                             </span>
<span class="5006934068411751005" onmouseenter="enter('5006934068411751005');" onmouseout="out('5006934068411751005');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 492 -    if (getConfig().SUPPORT_BP) {                                                                                 </span>
<span class="-1903706606316770403" onmouseenter="enter('-1903706606316770403');" onmouseout="out('-1903706606316770403');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 493 +    if (mTaskWrapper.isSupportBP()) {                                                                             </span>
<span class="5636262962850437364" onmouseenter="enter('5636262962850437364');" onmouseout="out('5636262962850437364');" style=""> 494        writeConfig(false, subCurrentLocation);                                                                     </span>
<span class="-5022490975846662695" onmouseenter="enter('-5022490975846662695');" onmouseout="out('-5022490975846662695');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 495 -      retryThis(needRetry &amp;&amp; getState().START_THREAD_NUM != 1);                                                   </span>
<span class="7955132104080368983" onmouseenter="enter('7955132104080368983');" onmouseout="out('7955132104080368983');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 496 +      retryThis(needRetry &amp;&amp; mConfig.startThreadNum != 1);                                                        </span>

<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 497      } else {                                                                                                      </span>
<span class="3391323959293733932" onmouseenter="enter('3391323959293733932');" onmouseout="out('3391323959293733932');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 498 -      ALog.e(TAG, String.format(&quot;任务【%s】执行失败&quot;, getConfig().TEMP_FILE.getName()));                                  </span>
<span class="6613685008099650869" onmouseenter="enter('6613685008099650869');" onmouseout="out('6613685008099650869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 499 +      ALog.e(TAG, String.format(&quot;任务【%s】执行失败&quot;, getFileName()));                                                    </span>
<span class="6290350204306664705" onmouseenter="enter('6290350204306664705');" onmouseout="out('6290350204306664705');" style=""> 500        ErrorHelp.saveError(TAG, &quot;&quot;, ALog.getExceptionString(ex));                                                  </span>
<span class="-2162507490503055467" onmouseenter="enter('-2162507490503055467');" onmouseout="out('-2162507490503055467');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 501 -      handleFailState(!isBreak());                                                                                </span>
<span class="-3645539894315514142" onmouseenter="enter('-3645539894315514142');" onmouseout="out('-3645539894315514142');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 502 +      sendFailMsg(null);                                                                                          </span>







<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 503      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 504    }                                                                                                               </span>
<span  style=""> 505                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 506    /**                                                                                                             </span>
<span class="-9093725986363149842" onmouseenter="enter('-9093725986363149842');" onmouseout="out('-9093725986363149842');" style=""> 507     * 重试当前线程，如果其中一条线程已经下载失败，则任务该任务下载失败，并且停止该任务的所有线程                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 508     *                                                                                                              </span>
<span class="-7715462203363144181" onmouseenter="enter('-7715462203363144181');" onmouseout="out('-7715462203363144181');" style=""> 509     * @param needRetry 是否可以重试                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 510     */                                                                                                             </span>
<span class="-4017949080492709723" onmouseenter="enter('-4017949080492709723');" onmouseout="out('-4017949080492709723');" style=""> 511    private void retryThis(boolean needRetry) {                                                                     </span>
<span class="3310386334432410672" onmouseenter="enter('3310386334432410672');" onmouseout="out('3310386334432410672');" style=""> 512      if (!NetUtils.isConnected(AriaManager.APP) &amp;&amp; !isNotNetRetry) {                                               </span>
<span class="-626911073917424062" onmouseenter="enter('-626911073917424062');" onmouseout="out('-626911073917424062');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 513 -      ALog.w(TAG, String.format(&quot;任务【%s】重试失败，网络未连接&quot;, getConfig().TEMP_FILE.getName()));                            </span>
<span class="-540477151182203063" onmouseenter="enter('-540477151182203063');" onmouseout="out('-540477151182203063');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 514 +      ALog.w(TAG, String.format(&quot;任务【%s】重试失败，网络未连接&quot;, getFileName()));                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 515      }                                                                                                             </span>
<span class="1591223325682575890" onmouseenter="enter('1591223325682575890');" onmouseout="out('1591223325682575890');" style=""> 516      if (mFailTimes &lt; RETRY_NUM &amp;&amp; needRetry &amp;&amp; (NetUtils.isConnected(AriaManager.APP)                             </span>
<span class="8286758897154980077" onmouseenter="enter('8286758897154980077');" onmouseout="out('8286758897154980077');" style=""> 517          || isNotNetRetry) &amp;&amp; !isBreak()) {                                                                        </span>
<span class="5627414684221265205" onmouseenter="enter('5627414684221265205');" onmouseout="out('5627414684221265205');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 518 -      ALog.d(TAG, String.format(&quot;isCancel: %s, isStop: %s, isBreak: %s&quot;, getState().isCancel,                     </span>
<span class="-4811551907713175761" onmouseenter="enter('-4811551907713175761');" onmouseout="out('-4811551907713175761');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 519 -          getState().isStop, taskBreak));                                                                         </span>
<span class="-7711180097266902820" onmouseenter="enter('-7711180097266902820');" onmouseout="out('-7711180097266902820');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 520 -      ALog.w(TAG, String.format(&quot;任务【%s】正在重试&quot;, getConfig().TEMP_FILE.getName()));                                  </span>
<span class="-3870082629414944375" onmouseenter="enter('-3870082629414944375');" onmouseout="out('-3870082629414944375');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 521 +      ALog.w(TAG, String.format(&quot;任务【%s】正在重试&quot;, getFileName()));                                                    </span>
<span class="-1094790045894886583" onmouseenter="enter('-1094790045894886583');" onmouseout="out('-1094790045894886583');" style=""> 522        mFailTimes++;                                                                                               </span>
<span class="4458054822073455179" onmouseenter="enter('4458054822073455179');" onmouseout="out('4458054822073455179');" style=""> 523        handleRetryRecord();                                                                                        </span>
<span class="5034263136405999116" onmouseenter="enter('5034263136405999116');" onmouseout="out('5034263136405999116');" style=""> 524        ThreadTaskManager.getInstance().retryThread(AbsThreadTask.this);                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 525      } else {                                                                                                      </span>
<span class="-2162507490503055467" onmouseenter="enter('-2162507490503055467');" onmouseout="out('-2162507490503055467');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 526 -      handleFailState(!isBreak());                                                                                </span>
<span class="-3645539894315514142" onmouseenter="enter('-3645539894315514142');" onmouseout="out('-3645539894315514142');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 527 +      sendFailMsg(null);                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 528      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 529    }                                                                                                               </span>
<span  style=""> 530                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 531    /**                                                                                                             </span>
<span class="2024814027088983613" onmouseenter="enter('2024814027088983613');" onmouseout="out('2024814027088983613');" style=""> 532     * 处理线程重试的记录，只有多线程任务才会执行                                                                                        </span>
<span class="7355073000228872615" onmouseenter="enter('7355073000228872615');" onmouseout="out('7355073000228872615');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 533 +   * 如果是以前版本{@link BufferedRandomAccessFile}创建的下载，那么 record.startLocation不用修改                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 534     */                                                                                                             </span>
<span class="6729287348781078107" onmouseenter="enter('6729287348781078107');" onmouseout="out('6729287348781078107');" style=""> 535    private void handleRetryRecord() {                                                                              </span>
<span class="-6097666598137252140" onmouseenter="enter('-6097666598137252140');" onmouseout="out('-6097666598137252140');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 536 -    if (getTaskRecord().isBlock) {                                                                                </span>
<span class="-772418395532567131" onmouseenter="enter('-772418395532567131');" onmouseout="out('-772418395532567131');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 537 -      ThreadRecord tr = getThreadRecord();                                                                        </span>
<span class="7525858464156079810" onmouseenter="enter('7525858464156079810');" onmouseout="out('7525858464156079810');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 538 +    if (mConfig.isBlock) {                                                                                        </span>
<span class="-6754358035051648935" onmouseenter="enter('-6754358035051648935');" onmouseout="out('-6754358035051648935');" style=""> 539        // 默认线程分块长度                                                                                                 </span>
<span class="1435458847882886982" onmouseenter="enter('1435458847882886982');" onmouseout="out('1435458847882886982');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 540 -      long normalRectLen = getEntity().getFileSize() / getTaskRecord().threadRecords.size();                      </span>
<span class="1339069462370605015" onmouseenter="enter('1339069462370605015');" onmouseout="out('1339069462370605015');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 541 -      File temp = getBockFile();                                                                                  </span>
<span class="669945524285390040" onmouseenter="enter('669945524285390040');" onmouseout="out('669945524285390040');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 542 +      File temp = mConfig.tempFile;                                                                               </span>
<span  style=""> 543                                                                                                                    </span>
<span class="-793137946029070789" onmouseenter="enter('-793137946029070789');" onmouseout="out('-793137946029070789');" style=""> 544        long blockFileLen = temp.length(); // 磁盘中的分块文件长度                                                            </span>
<span class="1800685755263797470" onmouseenter="enter('1800685755263797470');" onmouseout="out('1800685755263797470');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 545 -      long threadRect = tr.blockLen;     // 当前线程的区间                                                               </span>
<span class="8378527770954177996" onmouseenter="enter('8378527770954177996');" onmouseout="out('8378527770954177996');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 546 +      long threadRect = mRecord.blockLen;     // 当前线程的区间                                                          </span>
<span  style=""> 547                                                                                                                    </span>
<span class="-2809861036487449932" onmouseenter="enter('-2809861036487449932');" onmouseout="out('-2809861036487449932');" style=""> 548        if (!temp.exists()) {                                                                                       </span>
<span class="2335841033690112132" onmouseenter="enter('2335841033690112132');" onmouseout="out('2335841033690112132');" style=""> 549          ALog.i(TAG, String.format(&quot;分块文件【%s】不存在，该分块将重新开始&quot;, temp.getName()));                                       </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 550 -        tr.isComplete = false;                                                                                    </span>
<span class="1794369607963048703" onmouseenter="enter('1794369607963048703');" onmouseout="out('1794369607963048703');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 551 -        getConfig().START_LOCATION = tr.startLocation;                                                            </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 552 +        mRecord.isComplete = false;                                                                               </span>
<span class="-8890616152097691977" onmouseenter="enter('-8890616152097691977');" onmouseout="out('-8890616152097691977');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 553 +        mRecord.startLocation = mRecord.endLocation - threadRect;                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 554        } else {                                                                                                    </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style=""> 555          /*                                                                                                        </span>
<span class="3457188544010136028" onmouseenter="enter('3457188544010136028');" onmouseout="out('3457188544010136028');" style=""> 556           * 检查磁盘中的分块文件                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 557           */                                                                                                       </span>
<span class="7157771772038955316" onmouseenter="enter('7157771772038955316');" onmouseout="out('7157771772038955316');" style=""> 558          if (blockFileLen &gt; threadRect) {                                                                          </span>
<span class="-3751962279648840181" onmouseenter="enter('-3751962279648840181');" onmouseout="out('-3751962279648840181');" style=""> 559            ALog.i(TAG, String.format(&quot;分块【%s】错误，将重新下载该分块&quot;, temp.getName()));                                        </span>
<span class="-2826646494613153676" onmouseenter="enter('-2826646494613153676');" onmouseout="out('-2826646494613153676');" style=""> 560            temp.delete();                                                                                          </span>
<span class="8390720937253795779" onmouseenter="enter('8390720937253795779');" onmouseout="out('8390720937253795779');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 561 -          tr.startLocation = normalRectLen * tr.threadId;                                                         </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 562 -          tr.isComplete = false;                                                                                  </span>
<span class="1794369607963048703" onmouseenter="enter('1794369607963048703');" onmouseout="out('1794369607963048703');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 563 -          getConfig().START_LOCATION = tr.startLocation;                                                          </span>
<span class="-2224292797040621368" onmouseenter="enter('-2224292797040621368');" onmouseout="out('-2224292797040621368');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 564 -        } else if (blockFileLen &lt; tr.blockLen) {                                                                  </span>
<span class="-4538066055428150738" onmouseenter="enter('-4538066055428150738');" onmouseout="out('-4538066055428150738');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 565 -          tr.startLocation = normalRectLen * tr.threadId + blockFileLen;                                          </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 566 -          tr.isComplete = false;                                                                                  </span>
<span class="1794369607963048703" onmouseenter="enter('1794369607963048703');" onmouseout="out('1794369607963048703');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 567 -          getConfig().START_LOCATION = tr.startLocation;                                                          </span>
<span class="-1518255202618997397" onmouseenter="enter('-1518255202618997397');" onmouseout="out('-1518255202618997397');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 568 -          getState().CURRENT_LOCATION = getBlockRealTotalSize();                                                  </span>
<span class="8371392117975581366" onmouseenter="enter('8371392117975581366');" onmouseout="out('8371392117975581366');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 569 +          mRecord.startLocation = mRecord.endLocation - mRecord.blockLen;                                         </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 570 +          mRecord.isComplete = false;                                                                             </span>
<span class="6776411255900347323" onmouseenter="enter('6776411255900347323');" onmouseout="out('6776411255900347323');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 571 +        } else if (blockFileLen &lt; mRecord.blockLen) {                                                             </span>
<span class="6584433194872596156" onmouseenter="enter('6584433194872596156');" onmouseout="out('6584433194872596156');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 572 +          mRecord.startLocation = mRecord.endLocation - mRecord.blockLen + blockFileLen;                          </span>
<span class="-1656189461664912905" onmouseenter="enter('-1656189461664912905');" onmouseout="out('-1656189461664912905');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 573 +          mRecord.isComplete = false;                                                                             </span>
<span class="6944687175787726084" onmouseenter="enter('6944687175787726084');" onmouseout="out('6944687175787726084');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 574 +          sendState(ThreadStateManager.STATE_UPDATE_PROGRESS, null);                                              </span>
<span class="-3869098922257348244" onmouseenter="enter('-3869098922257348244');" onmouseout="out('-3869098922257348244');" style=""> 575            ALog.i(TAG,                                                                                             </span>
<span class="8437429982648821829" onmouseenter="enter('8437429982648821829');" onmouseout="out('8437429982648821829');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 576 -              String.format(&quot;修正分块【%s】，开始位置：%s，当前进度：%s&quot;, temp.getName(), tr.startLocation,                         </span>
<span class="2141132143456121531" onmouseenter="enter('2141132143456121531');" onmouseout="out('2141132143456121531');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 577 -                  getState().CURRENT_LOCATION));                                                                  </span>
<span class="-9076885663859410178" onmouseenter="enter('-9076885663859410178');" onmouseout="out('-9076885663859410178');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 578 +              String.format(&quot;修正分块【%s】，开始位置：%s，结束位置：%s&quot;, temp.getName(), mRecord.startLocation,                    </span>
<span class="7451819391210675610" onmouseenter="enter('7451819391210675610');" onmouseout="out('7451819391210675610');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 579 +                  mRecord.endLocation));                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 580          } else {                                                                                                  </span>
<span class="-6777046188674518761" onmouseenter="enter('-6777046188674518761');" onmouseout="out('-6777046188674518761');" style=""> 581            ALog.i(TAG, String.format(&quot;分块【%s】已完成，更新记录&quot;, temp.getName()));                                           </span>
<span class="-1874286661234017426" onmouseenter="enter('-1874286661234017426');" onmouseout="out('-1874286661234017426');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 582 -          getState().COMPLETE_THREAD_NUM++;                                                                       </span>
<span class="6364817192610155634" onmouseenter="enter('6364817192610155634');" onmouseout="out('6364817192610155634');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 583 -          tr.isComplete = true;                                                                                   </span>
<span class="-3752598072096250383" onmouseenter="enter('-3752598072096250383');" onmouseout="out('-3752598072096250383');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 584 +          mRecord.isComplete = true;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 585          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 586        }                                                                                                           </span>
<span class="2745940133750228688" onmouseenter="enter('2745940133750228688');" onmouseout="out('2745940133750228688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 587 -      tr.update();                                                                                                </span>
<span class="-1713746282533100961" onmouseenter="enter('-1713746282533100961');" onmouseout="out('-1713746282533100961');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 588 +      mRecord.update();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 589 +    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 590 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 591 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 592 +  /**                                                                                                             </span>
<span class="590341144997189976" onmouseenter="enter('590341144997189976');" onmouseout="out('590341144997189976');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 593 +   * 发送任务完成的消息，并删除任务记录                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 594 +   */                                                                                                             </span>
<span class="1107873274627848500" onmouseenter="enter('1107873274627848500');" onmouseout="out('1107873274627848500');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 595 +  protected synchronized void sendCompleteMsg() {                                                                 </span>
<span class="5765255273240095600" onmouseenter="enter('5765255273240095600');" onmouseout="out('5765255273240095600');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 596 +    ALog.i(TAG, String.format(&quot;任务【%s】完成&quot;, getFileName()));                                                        </span>
<span class="7593389892196353154" onmouseenter="enter('7593389892196353154');" onmouseout="out('7593389892196353154');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 597 +    sendState(ThreadStateManager.STATE_COMPLETE, null);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 598 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 599 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 600 +  /**                                                                                                             </span>
<span class="2603197968032099438" onmouseenter="enter('2603197968032099438');" onmouseout="out('2603197968032099438');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 601 +   * 发送失败信息                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 602 +   */                                                                                                             </span>
<span class="5094334093525103652" onmouseenter="enter('5094334093525103652');" onmouseout="out('5094334093525103652');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 603 +  protected void sendFailMsg(@Nullable BaseException e) {                                                         </span>
<span class="-125198456384004571" onmouseenter="enter('-125198456384004571');" onmouseout="out('-125198456384004571');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 604 +    if (e != null) {                                                                                              </span>
<span class="-6551099466538715534" onmouseenter="enter('-6551099466538715534');" onmouseout="out('-6551099466538715534');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 605 +      Bundle b = new Bundle();                                                                                    </span>
<span class="2257003064329280544" onmouseenter="enter('2257003064329280544');" onmouseout="out('2257003064329280544');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 606 +      b.putSerializable(ThreadStateManager.KEY_ERROR_INFO, e);                                                    </span>
<span class="1053312846940829509" onmouseenter="enter('1053312846940829509');" onmouseout="out('1053312846940829509');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 607 +      sendState(ThreadStateManager.STATE_FAIL, b);                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 608      } else {                                                                                                      </span>
<span class="-9063021121610387938" onmouseenter="enter('-9063021121610387938');" onmouseout="out('-9063021121610387938');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 609 -      getConfig().START_LOCATION = mChildCurrentLocation == 0 ? getConfig().START_LOCATION                        </span>
<span class="6402636142825398324" onmouseenter="enter('6402636142825398324');" onmouseout="out('6402636142825398324');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 610 -          : getConfig().THREAD_RECORD.startLocation;                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 611 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 612 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 613 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 614 -  /**                                                                                                             </span>
<span class="590341144997189976" onmouseenter="enter('590341144997189976');" onmouseout="out('590341144997189976');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 615 -   * 发送任务完成的消息，并删除任务记录                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 616 -   */                                                                                                             </span>
<span class="1107873274627848500" onmouseenter="enter('1107873274627848500');" onmouseout="out('1107873274627848500');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 617 -  protected synchronized void sendCompleteMsg() {                                                                 </span>
<span class="-5131553073025738201" onmouseenter="enter('-5131553073025738201');" onmouseout="out('-5131553073025738201');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 618 -    ALog.i(TAG, String.format(&quot;任务【%s】完成&quot;, mEntity.getFileName()));                                                </span>
<span class="3769004510167361430" onmouseenter="enter('3769004510167361430');" onmouseout="out('3769004510167361430');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 619 -    CommonUtil.delTaskRecord(mEntity.getKey(), mEntity instanceof DownloadEntity ? 1 : 2, false,                  </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 620 -        false);                                                                                                   </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 621 -    mListener.onComplete();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 622 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 623 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 624 -  /**                                                                                                             </span>
<span class="-4914781619633528981" onmouseenter="enter('-4914781619633528981');" onmouseout="out('-4914781619633528981');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 625 -   * 获取分块文件                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 626 -   *                                                                                                              </span>
<span class="-3403294675282309729" onmouseenter="enter('-3403294675282309729');" onmouseout="out('-3403294675282309729');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 627 -   * @return 分块文件                                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 628 -   */                                                                                                             </span>
<span class="6324132714992558911" onmouseenter="enter('6324132714992558911');" onmouseout="out('6324132714992558911');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 629 -  private File getBockFile() {                                                                                    </span>
<span class="-3099288840421597936" onmouseenter="enter('-3099288840421597936');" onmouseout="out('-3099288840421597936');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 630 -    return new File(String.format(AbsFileer.SUB_PATH, getState().TASK_RECORD.filePath,                            </span>
<span class="107129339548236069" onmouseenter="enter('107129339548236069');" onmouseout="out('107129339548236069');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 631 -        getThreadRecord().threadId));                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 632 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 633 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 634 -  /**                                                                                                             </span>
<span class="4969531823063170669" onmouseenter="enter('4969531823063170669');" onmouseout="out('4969531823063170669');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 635 -   * 获取分块任务真实的进度                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 636 -   *                                                                                                              </span>
<span class="-7910542742577826170" onmouseenter="enter('-7910542742577826170');" onmouseout="out('-7910542742577826170');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 637 -   * @return 进度                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 638 -   */                                                                                                             </span>
<span class="2630103139076882842" onmouseenter="enter('2630103139076882842');" onmouseout="out('2630103139076882842');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 639 -  private long getBlockRealTotalSize() {                                                                          </span>
<span class="642216204902078772" onmouseenter="enter('642216204902078772');" onmouseout="out('642216204902078772');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 640 -    long size = 0;                                                                                                </span>
<span class="-2633808047987562515" onmouseenter="enter('-2633808047987562515');" onmouseout="out('-2633808047987562515');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 641 -    for (int i = 0, len = getTaskRecord().threadRecords.size(); i &lt; len; i++) {                                   </span>
<span class="2011759116138999417" onmouseenter="enter('2011759116138999417');" onmouseout="out('2011759116138999417');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 642 -      File temp = new File(String.format(AbsFileer.SUB_PATH, getTaskRecord().filePath, i));                       </span>
<span class="7100992962921282764" onmouseenter="enter('7100992962921282764');" onmouseout="out('7100992962921282764');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 643 -      if (temp.exists()) {                                                                                        </span>
<span class="9105498611704012504" onmouseenter="enter('9105498611704012504');" onmouseout="out('9105498611704012504');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 644 -        size += temp.length();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 645 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 646 -    }                                                                                                             </span>
<span class="7808415022879232995" onmouseenter="enter('7808415022879232995');" onmouseout="out('7808415022879232995');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 647 -    return size;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 648 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 649 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 650 -  /**                                                                                                             </span>
<span class="-6819868296763628683" onmouseenter="enter('-6819868296763628683');" onmouseout="out('-6819868296763628683');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 651 -   * 处理失败状态                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 652 -   *                                                                                                              </span>
<span class="3934936147770351393" onmouseenter="enter('3934936147770351393');" onmouseout="out('3934936147770351393');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 653 -   * @param taskNeedReTry 任务是否需要重试{@code true} 需要                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 654 -   */                                                                                                             </span>
<span class="-7222232112361188285" onmouseenter="enter('-7222232112361188285');" onmouseout="out('-7222232112361188285');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 655 -  private void handleFailState(boolean taskNeedReTry) {                                                           </span>
<span class="1108424211258829350" onmouseenter="enter('1108424211258829350');" onmouseout="out('1108424211258829350');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 656 -    getState().FAIL_NUM++;                                                                                        </span>
<span class="8039287929021169143" onmouseenter="enter('8039287929021169143');" onmouseout="out('8039287929021169143');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 657 -    if (getState().isFail()) {                                                                                    </span>
<span class="5700013221639440030" onmouseenter="enter('5700013221639440030');" onmouseout="out('5700013221639440030');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 658 -      // 手动停止不进行fail回调                                                                                            </span>
<span class="-1564742423953438638" onmouseenter="enter('-1564742423953438638');" onmouseout="out('-1564742423953438638');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 659 -      if (!getState().isStop) {                                                                                   </span>
<span class="-4114645115751754567" onmouseenter="enter('-4114645115751754567');" onmouseout="out('-4114645115751754567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 660 -        String errorMsg = String.format(&quot;任务【%s】执行失败&quot;, getConfig().TEMP_FILE.getName());                           </span>
<span class="-8924195278241805064" onmouseenter="enter('-8924195278241805064');" onmouseout="out('-8924195278241805064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 661 -        mListener.onFail(taskNeedReTry, new TaskException(TAG, errorMsg));                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 662 -      }                                                                                                           </span>
<span class="737994709921278984" onmouseenter="enter('737994709921278984');" onmouseout="out('737994709921278984');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 663 +      sendState(ThreadStateManager.STATE_FAIL, null);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 664      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 665    }                                                                                                               </span>
<span  style=""> 666                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 667    /**                                                                                                             </span>
<span class="6719845586187631935" onmouseenter="enter('6719845586187631935');" onmouseout="out('6719845586187631935');" style=""> 668     * 将记录写入到配置文件                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 669     *                                                                                                              </span>
<span class="6391874541652225431" onmouseenter="enter('6391874541652225431');" onmouseout="out('6391874541652225431');" style=""> 670     * @param isComplete 当前线程是否完成 {@code true}完成                                                                    </span>
<span class="-5364023467485105638" onmouseenter="enter('-5364023467485105638');" onmouseout="out('-5364023467485105638');" style=""> 671     * @param record 当前下载进度                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 672     */                                                                                                             </span>
<span class="5027582220747789474" onmouseenter="enter('5027582220747789474');" onmouseout="out('5027582220747789474');" style=""> 673    protected void writeConfig(boolean isComplete, final long record) {                                             </span>
<span class="-772418395532567131" onmouseenter="enter('-772418395532567131');" onmouseout="out('-772418395532567131');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 674 -    ThreadRecord tr = getThreadRecord();                                                                          </span>
<span class="1355828340554679893" onmouseenter="enter('1355828340554679893');" onmouseout="out('1355828340554679893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 675 -    if (tr != null) {                                                                                             </span>
<span class="-3117128929308758281" onmouseenter="enter('-3117128929308758281');" onmouseout="out('-3117128929308758281');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 676 -      tr.isComplete = isComplete;                                                                                 </span>
<span class="-6097666598137252140" onmouseenter="enter('-6097666598137252140');" onmouseout="out('-6097666598137252140');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 677 -      if (getTaskRecord().isBlock) {                                                                              </span>
<span class="-9020361014324490679" onmouseenter="enter('-9020361014324490679');" onmouseout="out('-9020361014324490679');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 678 -        tr.startLocation = record;                                                                                </span>
<span class="4349213121355893036" onmouseenter="enter('4349213121355893036');" onmouseout="out('4349213121355893036');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 679 -      } else if (getTaskRecord().isOpenDynamicFile) {                                                             </span>
<span class="-5284847096932428150" onmouseenter="enter('-5284847096932428150');" onmouseout="out('-5284847096932428150');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 680 -        tr.startLocation = getConfig().TEMP_FILE.length();                                                        </span>
<span class="8605925134180182455" onmouseenter="enter('8605925134180182455');" onmouseout="out('8605925134180182455');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 681 +    if (mRecord != null) {                                                                                        </span>
<span class="-5137168811759188909" onmouseenter="enter('-5137168811759188909');" onmouseout="out('-5137168811759188909');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 682 +      mRecord.isComplete = isComplete;                                                                            </span>
<span class="7525858464156079810" onmouseenter="enter('7525858464156079810');" onmouseout="out('7525858464156079810');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 683 +      if (mConfig.isBlock) {                                                                                      </span>
<span class="5039999237965274971" onmouseenter="enter('5039999237965274971');" onmouseout="out('5039999237965274971');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 684 +        mRecord.startLocation = record;                                                                           </span>
<span class="-1667997194350191014" onmouseenter="enter('-1667997194350191014');" onmouseout="out('-1667997194350191014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 685 +      } else if (mConfig.isOpenDynamicFile) {                                                                     </span>
<span class="-7448644562741689657" onmouseenter="enter('-7448644562741689657');" onmouseout="out('-7448644562741689657');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 686 +        mRecord.startLocation = mConfig.tempFile.length();                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 687        } else {                                                                                                    </span>
<span class="-3527672335905010214" onmouseenter="enter('-3527672335905010214');" onmouseout="out('-3527672335905010214');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 688 -        if (0 &lt; record &amp;&amp; record &lt; getConfig().END_LOCATION) {                                                    </span>
<span class="-9020361014324490679" onmouseenter="enter('-9020361014324490679');" onmouseout="out('-9020361014324490679');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 689 -          tr.startLocation = record;                                                                              </span>
<span class="111068837356204936" onmouseenter="enter('111068837356204936');" onmouseout="out('111068837356204936');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 690 +        if (0 &lt; record &amp;&amp; record &lt; mRecord.endLocation) {                                                         </span>
<span class="5039999237965274971" onmouseenter="enter('5039999237965274971');" onmouseout="out('5039999237965274971');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 691 +          mRecord.startLocation = record;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 692          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 693        }                                                                                                           </span>
<span class="2745940133750228688" onmouseenter="enter('2745940133750228688');" onmouseout="out('2745940133750228688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 694 -      tr.update();                                                                                                </span>
<span class="-1713746282533100961" onmouseenter="enter('-1713746282533100961');" onmouseout="out('-1713746282533100961');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 695 +      mRecord.update();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 696      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 697    }                                                                                                               </span>
<span  style=""> 698                                                                                                                    </span>
<span class="-624413037734427342" onmouseenter="enter('-624413037734427342');" onmouseout="out('-624413037734427342');" style=""> 699    @Override public AbsThreadTask call() throws Exception {                                                        </span>
<span class="7231940989594771196" onmouseenter="enter('7231940989594771196');" onmouseout="out('7231940989594771196');" style=""> 700      isInterrupted = false;                                                                                        </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style=""> 701      Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                                </span>
<span class="-1851318291295515457" onmouseenter="enter('-1851318291295515457');" onmouseout="out('-1851318291295515457');" style=""> 702      TrafficStats.setThreadStatsTag(UUID.randomUUID().toString().hashCode());                                      </span>
<span class="2297715846939503398" onmouseenter="enter('2297715846939503398');" onmouseout="out('2297715846939503398');" style=""> 703      return this;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 704    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 705  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            