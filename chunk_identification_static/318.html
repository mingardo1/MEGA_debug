<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>318</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    318
                    <a href="317.html">prev</a>
                    <a href="319.html">next</a>
                    <a href="318_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Automattic/simplenote-android_6780311d33539eb86c4007a7d1993f6f1467a837_src/com/automattic/simplenote/models/Note.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837:src/com/automattic/simplenote/models/Note.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837^1:src/com/automattic/simplenote/models/Note.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837^2:src/com/automattic/simplenote/models/Note.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;20279c862696f156d42fbdab7ae10281f312fb27:src/com/automattic/simplenote/models/Note.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[sbj]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
   2 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote.models;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import java.text.DateFormat;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import java.text.SimpleDateFormat;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import java.util.HashMap;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import java.util.Locale;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import java.util.Map;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 import com.automattic.simplenote.R;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import com.simperium.client.BucketObject;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import com.simperium.client.BucketSchema;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import com.simperium.client.BucketSchema.Index;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import com.simperium.client.BucketSchema.Indexer;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 public class Note extends BucketObject {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 	public static final String BUCKET_NAME=&quot;note&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32     public static final String PINNED_TAG=&quot;pinned&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33     public static final String NEW_LINE=&quot;\n&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34     </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35     private static final String CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36     private static final String BLANK_CONTENT=&quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37     </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38     public static final String CONTENT_PROPERTY=&quot;content&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39     public static final String TAGS_PROPERTY=&quot;tags&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40     public static final String SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41     public static final String CREATION_DATE_PROPERTY=&quot;creationDate&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42     public static final String MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43     public static final String SHARE_URL_PROPERTY=&quot;shareURL&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44     public static final String PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45     public static final String DELETED_PROPERTY=&quot;deleted&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 	protected String title = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 	protected String contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 	public static class Schema extends BucketSchema&lt;Note&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52         public Schema(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53             autoIndex();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54             addIndex(noteIndexer);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55             setDefault(CONTENT_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56             setDefault(SYSTEM_TAGS_PROPERTY, new ArrayList&lt;Object&gt;());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57             setDefault(TAGS_PROPERTY, new ArrayList&lt;Object&gt;());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58             setDefault(DELETED_PROPERTY, false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59             setDefault(SHARE_URL_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60             setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63         private Indexer noteIndexer = new Indexer&lt;Note&gt;(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65             public List&lt;Index&gt; index(Note note){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66                 List&lt;Index&gt; indexes = new ArrayList&lt;Index&gt;();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67                 if (note.isPinned()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68                     indexes.add(new Index(&quot;pinned&quot;, true));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69                 } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70                     indexes.add(new Index(&quot;pinned&quot;, false));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72                 indexes.add(new Index(&quot;contentPreview&quot;, note.getContentPreview()));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73                 indexes.add(new Index(&quot;title&quot;, note.getTitle()));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74                 return indexes;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76         };</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78         public String getRemoteName(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79             return Note.BUCKET_NAME;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 		public Note build(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 			Note note = new Note(key, properties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84 			return note;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87         public void update(Note note, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88             note.properties = properties;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89             note.title = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90             note.contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93     </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94     public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; noteBucket){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99     public static Query&lt;Note&gt; allDeleted(Bucket&lt;Note&gt; noteBucket){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101                 .where(&quot;deleted&quot;, ComparisonType.EQUAL_TO, true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104     public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; noteBucket, String searchString){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107                 .where(&quot;content&quot;, ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110     public static Query&lt;Note&gt; allInTag(Bucket&lt;Note&gt; noteBucket, String tag){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113                 .where(&quot;tags&quot;, ComparisonType.LIKE, tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116 	public Note(String key, Map&lt;String,Object&gt;properties) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117 		super(key, properties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120     protected void updateTitleAndPreview(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121         // try to bulid a title and preview property out of content</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122         String content = getContent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123         // title = &quot;Hello World&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124         // contentPreview = &quot;This is a preview&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125         int location = -1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126         int lines = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127         int content_lines = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128         int start = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129         boolean foundTitle = false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130         boolean foundContent = false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131         // loop until we&#x27;ve found all the new lines</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132         do {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133             start = location + 1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134             location = content.indexOf(NEW_LINE, start);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135             if (location &gt; start + 1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136                 String possible = content.substring(start, location);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137                 if (!foundTitle) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138                     foundTitle = true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139                     title = possible;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142             lines ++;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143         } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; !foundTitle);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144         lines = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145         contentPreview = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146         do {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147             start = location + 1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148             location = content.indexOf(NEW_LINE, start);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149             if (location &gt; start + 1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150                 String possible = content.substring(start, location);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151                 contentPreview = String.format(CONTENT_CONCAT_FORMAT, contentPreview, possible);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152                 if (contentPreview.length() &gt;= 300) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153                     foundContent = true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154                     contentPreview = contentPreview.substring(0, 300);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157             lines ++;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158         } while(location &gt;= 0 &amp;&amp; !foundContent);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159         if (!foundTitle) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160             title = content;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162         if (contentPreview.isEmpty()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163             contentPreview = content;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165             contentPreview = contentPreview.trim();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169 	public String getTitle() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170         if (title == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173 		return title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175     </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176     public String getTitle(String ifBlank){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177         if (title == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180         if (title.trim().equals(&quot;&quot;)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181             return ifBlank;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183             return title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187 	public String getContent() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188         Object content = getProperty(CONTENT_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189         if (content == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190             return BLANK_CONTENT;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192         return (String) content;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195 	public void setContent(String content) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196         title = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197         contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198         setProperty(CONTENT_PROPERTY, content);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201 	public String getContentPreview() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202         if (contentPreview == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205 		return contentPreview;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208     public String getContentPreview(int lines){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209         if (contentPreview == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212         return contentPreview;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215 	public Calendar getCreationDate() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216         return numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219 	public void setCreationDate(Calendar creationDate) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220         setProperty(CREATION_DATE_PROPERTY, creationDate.getTimeInMillis()/1000);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223 	public Calendar getModificationDate() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224         return numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227 	public void setModificationDate(Calendar modificationDate) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228         setProperty(MODIFICATION_DATE_PROPERTY, modificationDate.getTimeInMillis()/1000);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231 	public List&lt;String&gt; getTags() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232         Object tags = getProperty(TAGS_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233         if (tags == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234             return new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236             return (ArrayList&lt;String&gt;) tags;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240 	public void setTags(List&lt;String&gt; tags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241         setProperty(TAGS_PROPERTY, tags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244 	public List&lt;String&gt; getSystemTags() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245         Object tags = getProperty(SYSTEM_TAGS_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246         if (tags == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247             return new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249         return (List&lt;String&gt;) tags;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252 	public Boolean isDeleted() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253         Object deleted = getProperty(DELETED_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254         if (deleted == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255             return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257 		if (deleted instanceof Boolean) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258 			return (Boolean) deleted;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259 		} else if (deleted instanceof Number) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260 			return ((Number)deleted).intValue() == 0 ? false : true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262             return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266 	public void setDeleted(boolean deleted) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267 		setProperty(DELETED_PROPERTY, deleted);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270 	public boolean isPinned() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271         return getSystemTags().contains(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274 	public void setPinned(boolean isPinned) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275         if (isPinned &amp;&amp; !isPinned()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276             getSystemTags().add(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277         } else if (!isPinned &amp;&amp; isPinned()){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278             getSystemTags().remove(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282     public static String dateString(Number time, boolean useShortFormat, Context context){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283         Calendar c = numberToDate(time);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284         return dateString(c, useShortFormat, context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287 	public static String dateString(Calendar c, boolean useShortFormat, Context context) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288 		int year, month, day;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290 		String time, date, retVal;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291 		time = date = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293 		Calendar diff = Calendar.getInstance();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294 		diff.setTimeInMillis(diff.getTimeInMillis() - c.getTimeInMillis());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296 		year = diff.get(Calendar.YEAR);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297 		month = diff.get(Calendar.MONTH);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298 		day = diff.get(Calendar.DAY_OF_MONTH);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300 		diff.setTimeInMillis(0); // starting time</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301 		time = DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 302 		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(Calendar.DAY_OF_MONTH))) {"> 302 		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(CalendðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303 			date = context.getResources().getString(R.string.today);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304 			if (useShortFormat)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305 				retVal = time;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306 			else</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307 				retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308 		} else if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == 1)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309 			date = context.getResources().getString(R.string.yesterday);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310 			if (useShortFormat)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311 				retVal = date;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312 			else</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313 				retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314 		} else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315 			date = new SimpleDateFormat(&quot;MMM dd&quot;, Locale.US).format(c.getTime());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316 			retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319 		return retVal;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322     protected Object getProperty(String key){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323         return properties.get(key);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326     protected void setProperty(String key, Object value){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327         properties.put(key, value);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330     public static Calendar numberToDate(Number time){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331         Calendar date = Calendar.getInstance();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332         if (time != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333             date.setTimeInMillis(time.longValue()*1000);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335         return date;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339      * Check if the note has any changes</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340      * @param content the new note content</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341      * @param tags array of tags</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342      * @param isPinned note is pinned</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343      * @return true if note has changes, false if it is unchanged.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345     public boolean hasChanges(String content, List&lt;String&gt; tags, boolean isPinned) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 347         if (content.equals(this.getContent()) &amp;&amp; tags.equals(this.getTags()) &amp;&amp; this.isPinned() == isPinned)"> 347         if (content.equals(this.getContent()) &amp;&amp; tags.equals(this.getTags()) &amp;&amp; this.isPinned() == isPinnðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348             return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349         else</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352 }</span>
 353 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354 package com.automattic.simplenote.models;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356 import java.text.DateFormat;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357 import java.text.SimpleDateFormat;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360 import java.util.HashMap;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361 import java.util.Locale;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362 import java.util.Map;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369 import com.automattic.simplenote.R;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373 import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375 import com.simperium.client.BucketObject;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376 import com.simperium.client.BucketSchema;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377 import com.simperium.client.BucketSchema.Index;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378 import com.simperium.client.BucketSchema.Indexer;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380 public class Note extends BucketObject {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381 	</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382 	public static final String BUCKET_NAME=&quot;note&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383     public static final String PINNED_TAG=&quot;pinned&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384     public static final String NEW_LINE=&quot;\n&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385     </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386     private static final String CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387     private static final String BLANK_CONTENT=&quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388     private static final String SPACE = &quot; &quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389     </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390     public static final String CONTENT_PROPERTY=&quot;content&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391     public static final String TAGS_PROPERTY=&quot;tags&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392     public static final String SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393     public static final String CREATION_DATE_PROPERTY=&quot;creationDate&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394     public static final String MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395     public static final String SHARE_URL_PROPERTY=&quot;shareURL&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 396     public static final String PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 397     public static final String DELETED_PROPERTY=&quot;deleted&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398 	</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399 	protected String title = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 400 	protected String contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 401 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402 	public static class Schema extends BucketSchema&lt;Note&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404         public Schema(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405             autoIndex();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406             addIndex(noteIndexer);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 407             setDefault(CONTENT_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 408             setDefault(SYSTEM_TAGS_PROPERTY, new ArrayList&lt;Object&gt;());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409             setDefault(TAGS_PROPERTY, new ArrayList&lt;Object&gt;());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410             setDefault(DELETED_PROPERTY, false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411             setDefault(SHARE_URL_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412             setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 415         private Indexer noteIndexer = new Indexer&lt;Note&gt;(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417             public List&lt;Index&gt; index(Note note){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418                 List&lt;Index&gt; indexes = new ArrayList&lt;Index&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419                 if (note.isPinned()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420                     indexes.add(new Index(&quot;pinned&quot;, true));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 421                 } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422                     indexes.add(new Index(&quot;pinned&quot;, false));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424                 indexes.add(new Index(&quot;contentPreview&quot;, note.getContentPreview()));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425                 indexes.add(new Index(&quot;title&quot;, note.getTitle()));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 426                 return indexes;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 428         };</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430         public String getRemoteName(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431             return Note.BUCKET_NAME;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434 		public Note build(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435 			Note note = new Note(key, properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436 			return note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439         public void update(Note note, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440             note.properties = properties;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441             note.title = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442             note.contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 445     </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 446     public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; noteBucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 447         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 448                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 449     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 450 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 451     public static Query&lt;Note&gt; allDeleted(Bucket&lt;Note&gt; noteBucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 452         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 453                 .where(&quot;deleted&quot;, ComparisonType.EQUAL_TO, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 454     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 455 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 456     public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; noteBucket, String searchString){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 457         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 458                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 459                 .where(&quot;content&quot;, ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 460     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 461 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 462     public static Query&lt;Note&gt; allInTag(Bucket&lt;Note&gt; noteBucket, String tag){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 463         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 464                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 465                 .where(&quot;tags&quot;, ComparisonType.LIKE, tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 466     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 467 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 468 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 469     public Note(String key){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 470         super(key, new HashMap&lt;String,Object&gt;());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 471     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 472 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 473 	public Note(String key, Map&lt;String,Object&gt;properties) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 474 		super(key, properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 475 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 476 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 477     protected void updateTitleAndPreview(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 478         // try to bulid a title and preview property out of content</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 479         String content = getContent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 480         // title = &quot;Hello World&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 481         // contentPreview = &quot;This is a preview&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 482         int location = -1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 483         int lines = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 484         int content_lines = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 485         int start = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 486         boolean foundTitle = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 487         boolean foundContent = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 488         // loop until we&#x27;ve found all the new lines</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 489         do {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 490             start = location + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 491             location = content.indexOf(NEW_LINE, start);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 492             if (location &gt; start + 1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 493                 String possible = content.substring(start, location);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 494                 if (!foundTitle) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 495                     foundTitle = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 496                     title = possible;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 497                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 498             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 499             lines ++;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 500         } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; !foundTitle);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 501         lines = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 502         contentPreview = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 503         do {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 504             start = location + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505             location = content.indexOf(NEW_LINE, start);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506             if (location &gt; start + 1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507                 String possible = content.substring(start, location);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508                 contentPreview = String.format(CONTENT_CONCAT_FORMAT, contentPreview, possible);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509                 if (contentPreview.length() &gt;= 300) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510                     foundContent = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511                     contentPreview = contentPreview.substring(0, 300);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514             lines ++;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515         } while(location &gt;= 0 &amp;&amp; !foundContent);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516         if (!foundTitle) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517             title = content;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519         if (contentPreview.isEmpty()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520             contentPreview = content;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522             contentPreview = contentPreview.trim();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525 	</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526 	public String getTitle() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527         if (title == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530 		return title;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532     </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533     public String getTitle(String ifBlank){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534         if (title == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 536         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 537         if (title.trim().equals(&quot;&quot;)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 538             return ifBlank;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 539         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 540             return title;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 541         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544 	public String getContent() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545         Object content = getProperty(CONTENT_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 546         if (content == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 547             return BLANK_CONTENT;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 548         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 549         return (String) content;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 552 	public void setContent(String content) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 553         title = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 554         contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 555         setProperty(CONTENT_PROPERTY, content);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 556 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 557 	</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 558 	public String getContentPreview() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 559         if (contentPreview == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 560             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 561         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 562 		return contentPreview;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 563 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 564 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 565     public String getContentPreview(int lines){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 566         if (contentPreview == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 567             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 568         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 569         return contentPreview;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 570     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 571 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 572 	public Calendar getCreationDate() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 573         return numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 574 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 575 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 576 	public void setCreationDate(Calendar creationDate) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 577         setProperty(CREATION_DATE_PROPERTY, creationDate.getTimeInMillis()/1000);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 578 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 579 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 580 	public Calendar getModificationDate() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 581         return numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 582 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 583 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 584 	public void setModificationDate(Calendar modificationDate) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 585         setProperty(MODIFICATION_DATE_PROPERTY, modificationDate.getTimeInMillis()/1000);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 586 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 587 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 588     public boolean hasTag(Tag tag){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 589         List&lt;String&gt; tags = getTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 590         for (String tagKey : tags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 591             if (tag.getSimperiumKey().equals(tagKey)) return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 592         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 593         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 594     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 595 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 596 	public List&lt;String&gt; getTags() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 597         Object tags = getProperty(TAGS_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 598         if (tags == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 599             tags = new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 600             setProperty(TAGS_PROPERTY, tags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 601         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 602         return (ArrayList&lt;String&gt;) tags;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 603 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 604 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 605 	public void setTags(List&lt;String&gt; tags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 606         setProperty(TAGS_PROPERTY, tags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 607 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 608 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 609     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 610      * String of tags delimited by a space</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 611      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 612     public CharSequence getTagString(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 613         StringBuilder tagString = new StringBuilder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 614         List&lt;String&gt; tags = getTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 615         for(String tag : tags){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 616             if (tagString.length() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 617                 tagString.append(SPACE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 618             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 619             tagString.append(tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 620         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 621         return tagString;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 622     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 623 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 624     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 625      * Sets the note&#x27;s tags by providing it with a {@link String} of space</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 626      * seperated tags. Filters out duplicate tags.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 627      * </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 628      * @param tagString a space delimited list of tags</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 629      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 630     public void setTagString(String tagString){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 631         List&lt;String&gt; tags = getTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 632         tags.clear();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 633         if (tagString == null) return;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 634         // for comparing case-insensitive strings, would like to find a way to</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 635         // do this without allocating a new list and strings</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 636         List&lt;String&gt; tagsUpperCase = new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 637         // remove all current tags</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 638         int start = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 639         int next = -1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 640         String possible;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 641         String possibleUpperCase;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 642         // search tag string for space characters and pull out individual tags</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 643         do {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 644             next = tagString.indexOf(SPACE, start);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 645             if (next &gt; start) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 646                 possible = tagString.substring(start, next);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 647                 possibleUpperCase = possible.toUpperCase();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 648                 if (!possible.equals(SPACE) &amp;&amp; !tagsUpperCase.contains(possibleUpperCase)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 649                     tagsUpperCase.add(possibleUpperCase);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 650                     tags.add(possible);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 651                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 652             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 653             start = next + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 654         } while(next &gt; -1);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 655     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 656 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 657 	public List&lt;String&gt; getSystemTags() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 658         Object tags = getProperty(SYSTEM_TAGS_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 659         if (tags == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 660             return new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 661         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 662         return (List&lt;String&gt;) tags;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 663 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 664 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 665 	public Boolean isDeleted() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 666         Object deleted = getProperty(DELETED_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 667         if (deleted == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 668             return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 669         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 670 		if (deleted instanceof Boolean) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 671 			return (Boolean) deleted;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 672 		} else if (deleted instanceof Number) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 673 			return ((Number)deleted).intValue() == 0 ? false : true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 674         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 675             return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 676         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 677 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 678 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 679 	public void setDeleted(boolean deleted) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 680 		setProperty(DELETED_PROPERTY, deleted);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 681 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 682 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 683 	public boolean isPinned() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 684         return getSystemTags().contains(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 685 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 686 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 687 	public void setPinned(boolean isPinned) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 688         if (isPinned &amp;&amp; !isPinned()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 689             getSystemTags().add(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 690         } else if (!isPinned &amp;&amp; isPinned()){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 691             getSystemTags().remove(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 692         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 693 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 694 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 695     public static String dateString(Number time, boolean useShortFormat, Context context){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 696         Calendar c = numberToDate(time);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 697         return dateString(c, useShortFormat, context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 698     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 699 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 700 	public static String dateString(Calendar c, boolean useShortFormat, Context context) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 701 		int year, month, day;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 702 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 703 		String time, date, retVal;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 704 		time = date = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 705 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 706 		Calendar diff = Calendar.getInstance();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 707 		diff.setTimeInMillis(diff.getTimeInMillis() - c.getTimeInMillis());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 708 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 709 		year = diff.get(Calendar.YEAR);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 710 		month = diff.get(Calendar.MONTH);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711 		day = diff.get(Calendar.DAY_OF_MONTH);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 713 		diff.setTimeInMillis(0); // starting time</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 714 		time = DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 715 		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(Calendar.DAY_OF_MONTH))) {"> 715 		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(CalendðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 716 			date = context.getResources().getString(R.string.today);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 717 			if (useShortFormat)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 718 				retVal = time;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 719 			else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 720 				retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 721 		} else if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == 1)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 722 			date = context.getResources().getString(R.string.yesterday);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 723 			if (useShortFormat)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 724 				retVal = date;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 725 			else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 726 				retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 727 		} else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 728 			date = new SimpleDateFormat(&quot;MMM dd&quot;, Locale.US).format(c.getTime());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 729 			retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 730 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 731 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 732 		return retVal;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 733 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 734 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 735     protected Object getProperty(String key){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 736         return properties.get(key);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 737     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 738 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 739     protected void setProperty(String key, Object value){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 740         properties.put(key, value);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 741     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 742 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 743     public static Calendar numberToDate(Number time){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 744         Calendar date = Calendar.getInstance();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 745         if (time != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 746             date.setTimeInMillis(time.longValue()*1000);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 747         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 748         return date;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 749     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 750 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 751     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 752      * Check if the note has any changes</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 753      * @param content the new note content</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 754      * @param tags array of tags</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 755      * @param isPinned note is pinned</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 756      * @return true if note has changes, false if it is unchanged.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 757      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 758     public boolean hasChanges(String content, boolean isPinned) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 759 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 760         if (content.equals(this.getContent()) &amp;&amp; this.isPinned() == isPinned)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 761             return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 762         else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 763             return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 764     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 765 }</span>
 766 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote.models;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import java.text.DateFormat;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import java.text.SimpleDateFormat;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import java.util.HashMap;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import java.util.Locale;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import java.util.Map;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 import com.automattic.simplenote.R;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import com.simperium.client.BucketObject;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import com.simperium.client.BucketSchema;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import com.simperium.client.BucketSchema.Index;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import com.simperium.client.BucketSchema.Indexer;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 public class Note extends BucketObject {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 	public static final String BUCKET_NAME=&quot;note&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32     public static final String PINNED_TAG=&quot;pinned&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33     public static final String NEW_LINE=&quot;\n&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35     private static final String CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36     private static final String BLANK_CONTENT=&quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38     public static final String CONTENT_PROPERTY=&quot;content&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39     public static final String TAGS_PROPERTY=&quot;tags&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40     public static final String SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41     public static final String CREATION_DATE_PROPERTY=&quot;creationDate&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42     public static final String MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43     public static final String SHARE_URL_PROPERTY=&quot;shareURL&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44     public static final String PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45     public static final String DELETED_PROPERTY=&quot;deleted&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 	protected String title = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 	protected String contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 	public static class Schema extends BucketSchema&lt;Note&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52         public Schema(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53             autoIndex();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54             addIndex(noteIndexer);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55             setDefault(CONTENT_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56             setDefault(SYSTEM_TAGS_PROPERTY, new ArrayList&lt;Object&gt;());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57             setDefault(TAGS_PROPERTY, new ArrayList&lt;Object&gt;());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58             setDefault(DELETED_PROPERTY, false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59             setDefault(SHARE_URL_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60             setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63         private Indexer noteIndexer = new Indexer&lt;Note&gt;(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65             public List&lt;Index&gt; index(Note note){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66                 List&lt;Index&gt; indexes = new ArrayList&lt;Index&gt;();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67                 if (note.isPinned()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68                     indexes.add(new Index(&quot;pinned&quot;, true));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69                 } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70                     indexes.add(new Index(&quot;pinned&quot;, false));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72                 indexes.add(new Index(&quot;contentPreview&quot;, note.getContentPreview()));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73                 indexes.add(new Index(&quot;title&quot;, note.getTitle()));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74                 return indexes;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76         };</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78         public String getRemoteName(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79             return Note.BUCKET_NAME;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 		public Note build(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 			Note note = new Note(key, properties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84 			return note;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87         public void update(Note note, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88             note.properties = properties;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89             note.title = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90             note.contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94     public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; noteBucket){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99     public static Query&lt;Note&gt; allDeleted(Bucket&lt;Note&gt; noteBucket){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101                 .where(&quot;deleted&quot;, ComparisonType.EQUAL_TO, true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104     public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; noteBucket, String searchString){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107                 .where(&quot;content&quot;, ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110     public static Query&lt;Note&gt; allInTag(Bucket&lt;Note&gt; noteBucket, String tag){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113                 .where(&quot;tags&quot;, ComparisonType.LIKE, tag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116 	public Note(String key, Map&lt;String,Object&gt;properties) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117 		super(key, properties);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120     protected void updateTitleAndPreview(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121         // try to bulid a title and preview property out of content</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122         String content = getContent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123         // title = &quot;Hello World&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124         // contentPreview = &quot;This is a preview&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125         int location = -1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126         int lines = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127         int content_lines = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128         int start = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129         boolean foundTitle = false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130         boolean foundContent = false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131         // loop until we&#x27;ve found all the new lines</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132         do {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133             start = location + 1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134             location = content.indexOf(NEW_LINE, start);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135             if (location &gt; start + 1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136                 String possible = content.substring(start, location);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137                 if (!foundTitle) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138                     foundTitle = true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139                     title = possible;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142             lines ++;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143         } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; !foundTitle);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144         lines = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145         contentPreview = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146         do {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147             start = location + 1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148             location = content.indexOf(NEW_LINE, start);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149             if (location &gt; start + 1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150                 String possible = content.substring(start, location);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151                 contentPreview = String.format(CONTENT_CONCAT_FORMAT, contentPreview, possible);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152                 if (contentPreview.length() &gt;= 300) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153                     foundContent = true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154                     contentPreview = contentPreview.substring(0, 300);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157             lines ++;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158         } while(location &gt;= 0 &amp;&amp; !foundContent);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159         if (!foundTitle) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160             title = content;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162         if (contentPreview.isEmpty()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163             contentPreview = content;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165             contentPreview = contentPreview.trim();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169 	public String getTitle() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170         if (title == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173 		return title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176     public String getTitle(String ifBlank){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177         if (title == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180         if (title.trim().equals(&quot;&quot;)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181             return ifBlank;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183             return title;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187 	public String getContent() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188         Object content = getProperty(CONTENT_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189         if (content == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190             return BLANK_CONTENT;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192         return (String) content;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195 	public void setContent(String content) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196         title = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197         contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198         setProperty(CONTENT_PROPERTY, content);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201 	public String getContentPreview() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202         if (contentPreview == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205 		return contentPreview;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208     public String getContentPreview(int lines){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209         if (contentPreview == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212         return contentPreview;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215 	public Calendar getCreationDate() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216         return numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219 	public void setCreationDate(Calendar creationDate) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220         setProperty(CREATION_DATE_PROPERTY, creationDate.getTimeInMillis()/1000);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223 	public Calendar getModificationDate() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224         return numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227 	public void setModificationDate(Calendar modificationDate) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228         setProperty(MODIFICATION_DATE_PROPERTY, modificationDate.getTimeInMillis()/1000);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231 	public List&lt;String&gt; getTags() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232         Object tags = getProperty(TAGS_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233         if (tags == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234             return new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236             return (ArrayList&lt;String&gt;) tags;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240 	public void setTags(List&lt;String&gt; tags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241         setProperty(TAGS_PROPERTY, tags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244 	public List&lt;String&gt; getSystemTags() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245         Object tags = getProperty(SYSTEM_TAGS_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246         if (tags == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247             return new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249         return (List&lt;String&gt;) tags;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252 	public Boolean isDeleted() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253         Object deleted = getProperty(DELETED_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254         if (deleted == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255             return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257 		if (deleted instanceof Boolean) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258 			return (Boolean) deleted;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259 		} else if (deleted instanceof Number) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260 			return ((Number)deleted).intValue() == 0 ? false : true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262             return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266 	public void setDeleted(boolean deleted) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267 		setProperty(DELETED_PROPERTY, deleted);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270 	public boolean isPinned() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271         return getSystemTags().contains(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274 	public void setPinned(boolean isPinned) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275         if (isPinned &amp;&amp; !isPinned()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276             getSystemTags().add(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277         } else if (!isPinned &amp;&amp; isPinned()){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278             getSystemTags().remove(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282     public static String dateString(Number time, boolean useShortFormat, Context context){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283         Calendar c = numberToDate(time);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284         return dateString(c, useShortFormat, context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287 	public static String dateString(Calendar c, boolean useShortFormat, Context context) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288 		int year, month, day;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290 		String time, date, retVal;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291 		time = date = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293 		Calendar diff = Calendar.getInstance();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294 		diff.setTimeInMillis(diff.getTimeInMillis() - c.getTimeInMillis());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296 		year = diff.get(Calendar.YEAR);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297 		month = diff.get(Calendar.MONTH);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298 		day = diff.get(Calendar.DAY_OF_MONTH);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300 		diff.setTimeInMillis(0); // starting time</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301 		time = DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 302 		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(Calendar.DAY_OF_MONTH))) {"> 302 		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(CalendðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303 			date = context.getResources().getString(R.string.today);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304 			if (useShortFormat)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305 				retVal = time;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306 			else</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307 				retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308 		} else if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == 1)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309 			date = context.getResources().getString(R.string.yesterday);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310 			if (useShortFormat)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311 				retVal = date;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312 			else</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313 				retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314 		} else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315 			date = new SimpleDateFormat(&quot;MMM dd&quot;, Locale.US).format(c.getTime());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316 			retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319 		return retVal;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322     protected Object getProperty(String key){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323         return properties.get(key);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326     protected void setProperty(String key, Object value){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327         properties.put(key, value);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330     public static Calendar numberToDate(Number time){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331         Calendar date = Calendar.getInstance();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332         if (time != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333             date.setTimeInMillis(time.longValue()*1000);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335         return date;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339      * Check if the note has any changes</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340      * @param content the new note content</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341      * @param tags array of tags</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342      * @param isPinned note is pinned</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343      * @return true if note has changes, false if it is unchanged.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345     public boolean hasChanges(String content, List&lt;String&gt; tags, boolean isPinned) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 347         if (content.equals(this.getContent()) &amp;&amp; tags.equals(this.getTags()) &amp;&amp; this.isPinned() == isPinned)"> 347         if (content.equals(this.getContent()) &amp;&amp; tags.equals(this.getTags()) &amp;&amp; this.isPinned() == isPinnðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348             return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349         else</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352 }</span>
 353 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354 package com.automattic.simplenote.models;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356 import java.text.DateFormat;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357 import java.text.SimpleDateFormat;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360 import java.util.HashMap;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361 import java.util.Locale;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362 import java.util.Map;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369 import com.automattic.simplenote.R;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373 import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375 import com.simperium.client.BucketObject;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376 import com.simperium.client.BucketSchema;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377 import com.simperium.client.BucketSchema.Index;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378 import com.simperium.client.BucketSchema.Indexer;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380 public class Note extends BucketObject {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382 	public static final String BUCKET_NAME=&quot;note&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383     public static final String PINNED_TAG=&quot;pinned&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384     public static final String NEW_LINE=&quot;\n&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386     private static final String CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387     private static final String BLANK_CONTENT=&quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388     private static final String SPACE = &quot; &quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390     public static final String CONTENT_PROPERTY=&quot;content&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391     public static final String TAGS_PROPERTY=&quot;tags&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392     public static final String SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393     public static final String CREATION_DATE_PROPERTY=&quot;creationDate&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394     public static final String MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395     public static final String SHARE_URL_PROPERTY=&quot;shareURL&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 396     public static final String PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 397     public static final String DELETED_PROPERTY=&quot;deleted&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399 	protected String title = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 400 	protected String contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 401 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402 	public static class Schema extends BucketSchema&lt;Note&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404         public Schema(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405             autoIndex();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406             addIndex(noteIndexer);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 407             setDefault(CONTENT_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 408             setDefault(SYSTEM_TAGS_PROPERTY, new ArrayList&lt;Object&gt;());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409             setDefault(TAGS_PROPERTY, new ArrayList&lt;Object&gt;());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410             setDefault(DELETED_PROPERTY, false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411             setDefault(SHARE_URL_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412             setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 415         private Indexer noteIndexer = new Indexer&lt;Note&gt;(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417             public List&lt;Index&gt; index(Note note){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418                 List&lt;Index&gt; indexes = new ArrayList&lt;Index&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419                 if (note.isPinned()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420                     indexes.add(new Index(&quot;pinned&quot;, true));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 421                 } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422                     indexes.add(new Index(&quot;pinned&quot;, false));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424                 indexes.add(new Index(&quot;contentPreview&quot;, note.getContentPreview()));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425                 indexes.add(new Index(&quot;title&quot;, note.getTitle()));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 426                 return indexes;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 428         };</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430         public String getRemoteName(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431             return Note.BUCKET_NAME;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434 		public Note build(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435 			Note note = new Note(key, properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436 			return note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439         public void update(Note note, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440             note.properties = properties;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441             note.title = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442             note.contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 445 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 446     public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; noteBucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 447         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 448                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 449     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 450 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 451     public static Query&lt;Note&gt; allDeleted(Bucket&lt;Note&gt; noteBucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 452         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 453                 .where(&quot;deleted&quot;, ComparisonType.EQUAL_TO, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 454     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 455 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 456     public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; noteBucket, String searchString){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 457         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 458                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 459                 .where(&quot;content&quot;, ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 460     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 461 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 462     public static Query&lt;Note&gt; allInTag(Bucket&lt;Note&gt; noteBucket, String tag){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 463         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 464                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 465                 .where(&quot;tags&quot;, ComparisonType.LIKE, tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 466     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 467 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 468 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 469     public Note(String key){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 470         super(key, new HashMap&lt;String,Object&gt;());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 471     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 472 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 473 	public Note(String key, Map&lt;String,Object&gt;properties) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 474 		super(key, properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 475 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 476 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 477     protected void updateTitleAndPreview(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 478         // try to bulid a title and preview property out of content</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 479         String content = getContent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 480         // title = &quot;Hello World&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 481         // contentPreview = &quot;This is a preview&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 482         int location = -1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 483         int lines = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 484         int content_lines = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 485         int start = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 486         boolean foundTitle = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 487         boolean foundContent = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 488         // loop until we&#x27;ve found all the new lines</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 489         do {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 490             start = location + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 491             location = content.indexOf(NEW_LINE, start);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 492             if (location &gt; start + 1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 493                 String possible = content.substring(start, location);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 494                 if (!foundTitle) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 495                     foundTitle = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 496                     title = possible;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 497                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 498             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 499             lines ++;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 500         } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; !foundTitle);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 501         lines = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 502         contentPreview = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 503         do {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 504             start = location + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505             location = content.indexOf(NEW_LINE, start);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506             if (location &gt; start + 1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507                 String possible = content.substring(start, location);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508                 contentPreview = String.format(CONTENT_CONCAT_FORMAT, contentPreview, possible);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509                 if (contentPreview.length() &gt;= 300) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510                     foundContent = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511                     contentPreview = contentPreview.substring(0, 300);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514             lines ++;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515         } while(location &gt;= 0 &amp;&amp; !foundContent);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516         if (!foundTitle) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517             title = content;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519         if (contentPreview.isEmpty()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520             contentPreview = content;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522             contentPreview = contentPreview.trim();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526 	public String getTitle() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527         if (title == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530 		return title;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533     public String getTitle(String ifBlank){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534         if (title == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 536         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 537         if (title.trim().equals(&quot;&quot;)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 538             return ifBlank;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 539         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 540             return title;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 541         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544 	public String getContent() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545         Object content = getProperty(CONTENT_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 546         if (content == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 547             return BLANK_CONTENT;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 548         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 549         return (String) content;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 552 	public void setContent(String content) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 553         title = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 554         contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 555         setProperty(CONTENT_PROPERTY, content);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 556 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 557 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 558 	public String getContentPreview() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 559         if (contentPreview == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 560             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 561         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 562 		return contentPreview;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 563 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 564 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 565     public String getContentPreview(int lines){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 566         if (contentPreview == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 567             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 568         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 569         return contentPreview;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 570     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 571 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 572 	public Calendar getCreationDate() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 573         return numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 574 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 575 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 576 	public void setCreationDate(Calendar creationDate) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 577         setProperty(CREATION_DATE_PROPERTY, creationDate.getTimeInMillis()/1000);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 578 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 579 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 580 	public Calendar getModificationDate() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 581         return numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 582 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 583 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 584 	public void setModificationDate(Calendar modificationDate) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 585         setProperty(MODIFICATION_DATE_PROPERTY, modificationDate.getTimeInMillis()/1000);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 586 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 587 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 588     public boolean hasTag(Tag tag){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 589         List&lt;String&gt; tags = getTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 590         for (String tagKey : tags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 591             if (tag.getSimperiumKey().equals(tagKey)) return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 592         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 593         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 594     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 595 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 596 	public List&lt;String&gt; getTags() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 597         Object tags = getProperty(TAGS_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 598         if (tags == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 599             tags = new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 600             setProperty(TAGS_PROPERTY, tags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 601         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 602         return (ArrayList&lt;String&gt;) tags;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 603 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 604 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 605 	public void setTags(List&lt;String&gt; tags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 606         setProperty(TAGS_PROPERTY, tags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 607 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 608 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 609     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 610      * String of tags delimited by a space</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 611      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 612     public CharSequence getTagString(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 613         StringBuilder tagString = new StringBuilder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 614         List&lt;String&gt; tags = getTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 615         for(String tag : tags){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 616             if (tagString.length() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 617                 tagString.append(SPACE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 618             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 619             tagString.append(tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 620         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 621         return tagString;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 622     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 623 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 624     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 625      * Sets the note&#x27;s tags by providing it with a {@link String} of space</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 626      * seperated tags. Filters out duplicate tags.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 627      *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 628      * @param tagString a space delimited list of tags</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 629      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 630     public void setTagString(String tagString){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 631         List&lt;String&gt; tags = getTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 632         tags.clear();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 633         if (tagString == null) return;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 634         // for comparing case-insensitive strings, would like to find a way to</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 635         // do this without allocating a new list and strings</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 636         List&lt;String&gt; tagsUpperCase = new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 637         // remove all current tags</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 638         int start = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 639         int next = -1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 640         String possible;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 641         String possibleUpperCase;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 642         // search tag string for space characters and pull out individual tags</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 643         do {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 644             next = tagString.indexOf(SPACE, start);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 645             if (next &gt; start) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 646                 possible = tagString.substring(start, next);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 647                 possibleUpperCase = possible.toUpperCase();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 648                 if (!possible.equals(SPACE) &amp;&amp; !tagsUpperCase.contains(possibleUpperCase)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 649                     tagsUpperCase.add(possibleUpperCase);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 650                     tags.add(possible);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 651                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 652             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 653             start = next + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 654         } while(next &gt; -1);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 655     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 656 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 657 	public List&lt;String&gt; getSystemTags() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 658         Object tags = getProperty(SYSTEM_TAGS_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 659         if (tags == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 660             return new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 661         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 662         return (List&lt;String&gt;) tags;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 663 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 664 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 665 	public Boolean isDeleted() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 666         Object deleted = getProperty(DELETED_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 667         if (deleted == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 668             return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 669         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 670 		if (deleted instanceof Boolean) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 671 			return (Boolean) deleted;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 672 		} else if (deleted instanceof Number) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 673 			return ((Number)deleted).intValue() == 0 ? false : true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 674         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 675             return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 676         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 677 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 678 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 679 	public void setDeleted(boolean deleted) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 680 		setProperty(DELETED_PROPERTY, deleted);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 681 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 682 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 683 	public boolean isPinned() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 684         return getSystemTags().contains(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 685 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 686 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 687 	public void setPinned(boolean isPinned) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 688         if (isPinned &amp;&amp; !isPinned()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 689             getSystemTags().add(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 690         } else if (!isPinned &amp;&amp; isPinned()){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 691             getSystemTags().remove(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 692         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 693 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 694 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 695     public static String dateString(Number time, boolean useShortFormat, Context context){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 696         Calendar c = numberToDate(time);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 697         return dateString(c, useShortFormat, context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 698     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 699 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 700 	public static String dateString(Calendar c, boolean useShortFormat, Context context) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 701 		int year, month, day;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 702 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 703 		String time, date, retVal;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 704 		time = date = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 705 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 706 		Calendar diff = Calendar.getInstance();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 707 		diff.setTimeInMillis(diff.getTimeInMillis() - c.getTimeInMillis());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 708 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 709 		year = diff.get(Calendar.YEAR);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 710 		month = diff.get(Calendar.MONTH);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711 		day = diff.get(Calendar.DAY_OF_MONTH);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 713 		diff.setTimeInMillis(0); // starting time</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 714 		time = DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 715 		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(Calendar.DAY_OF_MONTH))) {"> 715 		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(CalendðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 716 			date = context.getResources().getString(R.string.today);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 717 			if (useShortFormat)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 718 				retVal = time;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 719 			else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 720 				retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 721 		} else if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == 1)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 722 			date = context.getResources().getString(R.string.yesterday);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 723 			if (useShortFormat)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 724 				retVal = date;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 725 			else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 726 				retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 727 		} else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 728 			date = new SimpleDateFormat(&quot;MMM dd&quot;, Locale.US).format(c.getTime());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 729 			retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 730 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 731 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 732 		return retVal;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 733 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 734 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 735     protected Object getProperty(String key){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 736         return properties.get(key);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 737     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 738 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 739     protected void setProperty(String key, Object value){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 740         properties.put(key, value);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 741     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 742 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 743     public static Calendar numberToDate(Number time){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 744         Calendar date = Calendar.getInstance();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 745         if (time != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 746             date.setTimeInMillis(time.longValue()*1000);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 747         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 748         return date;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 749     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 750 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 751     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 752      * Check if the note has any changes</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 753      * @param content the new note content</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 754      * @param tags array of tags</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 755      * @param isPinned note is pinned</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 756      * @return true if note has changes, false if it is unchanged.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 757      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 758     public boolean hasChanges(String content, boolean isPinned) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 759 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 760         if (content.equals(this.getContent()) &amp;&amp; this.isPinned() == isPinned)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 761             return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 762         else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 763             return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 764     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 765 }</span>
 766 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
   4 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   5 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   6 package com.automattic.simplenote.models;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   7 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   8 import java.text.DateFormat;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   9 import java.text.SimpleDateFormat;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  10 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  11 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  12 import java.util.HashMap;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  13 import java.util.Locale;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  14 import java.util.Map;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  15 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  16 import java.util.ArrayList;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  17 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  18 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  19 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  20 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  21 import com.automattic.simplenote.R;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  22 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  24 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  25 import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  26 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  27 import com.simperium.client.BucketObject;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  28 import com.simperium.client.BucketSchema;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  29 import com.simperium.client.BucketSchema.Index;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  30 import com.simperium.client.BucketSchema.Indexer;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  31 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  32 public class Note extends BucketObject {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  33 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  34 	public static final String BUCKET_NAME=&quot;note&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  35     public static final String PINNED_TAG=&quot;pinned&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36     public static final String NEW_LINE=&quot;\n&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38     private static final String CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  39     private static final String BLANK_CONTENT=&quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  40     private static final String SPACE = &quot; &quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  41 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  42     public static final String CONTENT_PROPERTY=&quot;content&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  43     public static final String TAGS_PROPERTY=&quot;tags&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  44     public static final String SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  45     public static final String CREATION_DATE_PROPERTY=&quot;creationDate&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  46     public static final String MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  47     public static final String SHARE_URL_PROPERTY=&quot;shareURL&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  48     public static final String PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  49     public static final String DELETED_PROPERTY=&quot;deleted&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51 	protected String title = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52 	protected String contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54 	public static class Schema extends BucketSchema&lt;Note&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  55 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  56         public Schema(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57             autoIndex();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58             addIndex(noteIndexer);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59             setDefault(CONTENT_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60             setDefault(SYSTEM_TAGS_PROPERTY, new ArrayList&lt;Object&gt;());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61             setDefault(TAGS_PROPERTY, new ArrayList&lt;Object&gt;());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62             setDefault(DELETED_PROPERTY, false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63             setDefault(SHARE_URL_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64             setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67         private Indexer noteIndexer = new Indexer&lt;Note&gt;(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69             public List&lt;Index&gt; index(Note note){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  70                 List&lt;Index&gt; indexes = new ArrayList&lt;Index&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71                 if (note.isPinned()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72                     indexes.add(new Index(&quot;pinned&quot;, true));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73                 } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74                     indexes.add(new Index(&quot;pinned&quot;, false));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76                 indexes.add(new Index(&quot;contentPreview&quot;, note.getContentPreview()));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77                 indexes.add(new Index(&quot;title&quot;, note.getTitle()));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78                 return indexes;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  80         };</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82         public String getRemoteName(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83             return Note.BUCKET_NAME;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86 		public Note build(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87 			Note note = new Note(key, properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88 			return note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91         public void update(Note note, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92             note.properties = properties;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93             note.title = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94             note.contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98     public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; noteBucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103     public static Query&lt;Note&gt; allDeleted(Bucket&lt;Note&gt; noteBucket){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105                 .where(&quot;deleted&quot;, ComparisonType.EQUAL_TO, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108     public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; noteBucket, String searchString){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111                 .where(&quot;content&quot;, ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114     public static Query&lt;Note&gt; allInTag(Bucket&lt;Note&gt; noteBucket, String tag){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115         return noteBucket.query()</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116                 .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117                 .where(&quot;tags&quot;, ComparisonType.LIKE, tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121     public Note(String key){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122         super(key, new HashMap&lt;String,Object&gt;());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125 	public Note(String key, Map&lt;String,Object&gt;properties) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126 		super(key, properties);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129     protected void updateTitleAndPreview(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130         // try to bulid a title and preview property out of content</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131         String content = getContent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132         // title = &quot;Hello World&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133         // contentPreview = &quot;This is a preview&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134         int location = -1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135         int lines = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136         int content_lines = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137         int start = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138         boolean foundTitle = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139         boolean foundContent = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140         // loop until we&#x27;ve found all the new lines</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141         do {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142             start = location + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143             location = content.indexOf(NEW_LINE, start);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144             if (location &gt; start + 1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145                 String possible = content.substring(start, location);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146                 if (!foundTitle) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147                     foundTitle = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148                     title = possible;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151             lines ++;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152         } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; !foundTitle);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153         lines = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154         contentPreview = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155         do {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156             start = location + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157             location = content.indexOf(NEW_LINE, start);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158             if (location &gt; start + 1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159                 String possible = content.substring(start, location);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160                 contentPreview = String.format(CONTENT_CONCAT_FORMAT, contentPreview, possible);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161                 if (contentPreview.length() &gt;= 300) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162                     foundContent = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163                     contentPreview = contentPreview.substring(0, 300);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166             lines ++;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167         } while(location &gt;= 0 &amp;&amp; !foundContent);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168         if (!foundTitle) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169             title = content;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171         if (contentPreview.isEmpty()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172             contentPreview = content;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174             contentPreview = contentPreview.trim();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178 	public String getTitle() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179         if (title == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182 		return title;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185     public String getTitle(String ifBlank){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186         if (title == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189         if (title.trim().equals(&quot;&quot;)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190             return ifBlank;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192             return title;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196 	public String getContent() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197         Object content = getProperty(CONTENT_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198         if (content == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199             return BLANK_CONTENT;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201         return (String) content;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204 	public void setContent(String content) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205         title = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206         contentPreview = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207         setProperty(CONTENT_PROPERTY, content);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210 	public String getContentPreview() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211         if (contentPreview == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214 		return contentPreview;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217     public String getContentPreview(int lines){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218         if (contentPreview == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219             updateTitleAndPreview();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221         return contentPreview;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224 	public Calendar getCreationDate() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225         return numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228 	public void setCreationDate(Calendar creationDate) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229         setProperty(CREATION_DATE_PROPERTY, creationDate.getTimeInMillis()/1000);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232 	public Calendar getModificationDate() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233         return numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236 	public void setModificationDate(Calendar modificationDate) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237         setProperty(MODIFICATION_DATE_PROPERTY, modificationDate.getTimeInMillis()/1000);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240     public boolean hasTag(Tag tag){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241         List&lt;String&gt; tags = getTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242         for (String tagKey : tags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243             if (tag.getSimperiumKey().equals(tagKey)) return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248 	public List&lt;String&gt; getTags() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249         Object tags = getProperty(TAGS_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250         if (tags == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251             tags = new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252             setProperty(TAGS_PROPERTY, tags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254         return (ArrayList&lt;String&gt;) tags;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257 	public void setTags(List&lt;String&gt; tags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258         setProperty(TAGS_PROPERTY, tags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262      * String of tags delimited by a space</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264     public CharSequence getTagString(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265         StringBuilder tagString = new StringBuilder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266         List&lt;String&gt; tags = getTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267         for(String tag : tags){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268             if (tagString.length() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269                 tagString.append(SPACE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271             tagString.append(tag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273         return tagString;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277      * Sets the note&#x27;s tags by providing it with a {@link String} of space</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278      * seperated tags. Filters out duplicate tags.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279      *</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280      * @param tagString a space delimited list of tags</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282     public void setTagString(String tagString){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283         List&lt;String&gt; tags = getTags();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284         tags.clear();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285         if (tagString == null) return;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286         // for comparing case-insensitive strings, would like to find a way to</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287         // do this without allocating a new list and strings</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288         List&lt;String&gt; tagsUpperCase = new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289         // remove all current tags</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290         int start = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291         int next = -1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292         String possible;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293         String possibleUpperCase;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294         // search tag string for space characters and pull out individual tags</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295         do {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296             next = tagString.indexOf(SPACE, start);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297             if (next &gt; start) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298                 possible = tagString.substring(start, next);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299                 possibleUpperCase = possible.toUpperCase();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300                 if (!possible.equals(SPACE) &amp;&amp; !tagsUpperCase.contains(possibleUpperCase)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301                     tagsUpperCase.add(possibleUpperCase);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302                     tags.add(possible);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 303                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305             start = next + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306         } while(next &gt; -1);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309 	public List&lt;String&gt; getSystemTags() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310         Object tags = getProperty(SYSTEM_TAGS_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311         if (tags == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312             return new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314         return (List&lt;String&gt;) tags;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317 	public Boolean isDeleted() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318         Object deleted = getProperty(DELETED_PROPERTY);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 319         if (deleted == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320             return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 321         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 322 		if (deleted instanceof Boolean) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 323 			return (Boolean) deleted;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 324 		} else if (deleted instanceof Number) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 325 			return ((Number)deleted).intValue() == 0 ? false : true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 326         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 327             return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 328         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 329 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 330 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 331 	public void setDeleted(boolean deleted) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 332 		setProperty(DELETED_PROPERTY, deleted);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 333 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 334 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 335 	public boolean isPinned() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 336         return getSystemTags().contains(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 337 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 338 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 339 	public void setPinned(boolean isPinned) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 340         if (isPinned &amp;&amp; !isPinned()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 341             getSystemTags().add(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 342         } else if (!isPinned &amp;&amp; isPinned()){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 343             getSystemTags().remove(PINNED_TAG);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 344         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 345 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 346 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 347     public static String dateString(Number time, boolean useShortFormat, Context context){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 348         Calendar c = numberToDate(time);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 349         return dateString(c, useShortFormat, context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 350     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 351 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 352 	public static String dateString(Calendar c, boolean useShortFormat, Context context) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353 		int year, month, day;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355 		String time, date, retVal;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356 		time = date = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358 		Calendar diff = Calendar.getInstance();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359 		diff.setTimeInMillis(diff.getTimeInMillis() - c.getTimeInMillis());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361 		year = diff.get(Calendar.YEAR);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362 		month = diff.get(Calendar.MONTH);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363 		day = diff.get(Calendar.DAY_OF_MONTH);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365 		diff.setTimeInMillis(0); // starting time</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366 		time = DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 367 		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(Calendar.DAY_OF_MONTH))) {"> 367 		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(CalendðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368 			date = context.getResources().getString(R.string.today);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369 			if (useShortFormat)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370 				retVal = time;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371 			else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372 				retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373 		} else if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == 1)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374 			date = context.getResources().getString(R.string.yesterday);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375 			if (useShortFormat)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376 				retVal = date;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377 			else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378 				retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379 		} else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380 			date = new SimpleDateFormat(&quot;MMM dd&quot;, Locale.US).format(c.getTime());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381 			retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384 		return retVal;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387     protected Object getProperty(String key){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388         return properties.get(key);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391     protected void setProperty(String key, Object value){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392         properties.put(key, value);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395     public static Calendar numberToDate(Number time){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 396         Calendar date = Calendar.getInstance();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 397         if (time != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398             date.setTimeInMillis(time.longValue()*1000);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 400         return date;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 401     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404      * Check if the note has any changes</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405      * @param content the new note content</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406      * @param tags array of tags</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 407      * @param isPinned note is pinned</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 408      * @return true if note has changes, false if it is unchanged.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410     public boolean hasChanges(String content, boolean isPinned) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412         if (content.equals(this.getContent()) &amp;&amp; this.isPinned() == isPinned)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413             return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414         else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 415             return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417 }</span>
 418 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   1 -package com.automattic.simplenote.models;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   2 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   3 -import java.text.DateFormat;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   4 -import java.text.SimpleDateFormat;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   5 -import java.util.ArrayList;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   6 -import java.util.Calendar;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   7 -import java.util.HashMap;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   8 -import java.util.Locale;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   9 -import java.util.Map;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  10 -import java.util.List;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  11 -import java.util.ArrayList;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  12 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  13 -import android.content.Context;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  14 -import android.util.Log;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  15 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  16 -import com.automattic.simplenote.R;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  17 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  18 -import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -import com.simperium.client.Query;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -import com.simperium.client.BucketObject;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -import com.simperium.client.BucketSchema;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -import com.simperium.client.BucketSchema.Index;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -import com.simperium.client.BucketSchema.Indexer;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  26 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -public class Note extends BucketObject {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  28 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -	public static final String BUCKET_NAME=&quot;note&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 -    public static final String PINNED_TAG=&quot;pinned&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  31 -    public static final String NEW_LINE=&quot;\n&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -    private static final String CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -    private static final String BLANK_CONTENT=&quot;&quot;;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  35 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 -    public static final String CONTENT_PROPERTY=&quot;content&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  37 -    public static final String TAGS_PROPERTY=&quot;tags&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  38 -    public static final String SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  39 -    public static final String CREATION_DATE_PROPERTY=&quot;creationDate&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 -    public static final String MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 -    public static final String SHARE_URL_PROPERTY=&quot;shareURL&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 -    public static final String PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 -    public static final String DELETED_PROPERTY=&quot;deleted&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 -	protected String title = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -	protected String contentPreview = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -	public static class Schema extends BucketSchema&lt;Note&gt; {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  50 -        public Schema(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -            autoIndex();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  52 -            addIndex(noteIndexer);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  53 -            setDefault(CONTENT_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -            setDefault(SYSTEM_TAGS_PROPERTY, new ArrayList&lt;Object&gt;());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -            setDefault(TAGS_PROPERTY, new ArrayList&lt;Object&gt;());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -            setDefault(DELETED_PROPERTY, false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -            setDefault(SHARE_URL_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -            setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  61 -        private Indexer noteIndexer = new Indexer&lt;Note&gt;(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  62 -            @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -            public List&lt;Index&gt; index(Note note){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -                List&lt;Index&gt; indexes = new ArrayList&lt;Index&gt;();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -                if (note.isPinned()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -                    indexes.add(new Index(&quot;pinned&quot;, true));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  67 -                } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  68 -                    indexes.add(new Index(&quot;pinned&quot;, false));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  69 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  70 -                indexes.add(new Index(&quot;contentPreview&quot;, note.getContentPreview()));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  71 -                indexes.add(new Index(&quot;title&quot;, note.getTitle()));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  72 -                return indexes;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -        };</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  76 -        public String getRemoteName(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  77 -            return Note.BUCKET_NAME;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  78 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  79 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -		public Note build(String key, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -			Note note = new Note(key, properties);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -			return note;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  84 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -        public void update(Note note, Map&lt;String,Object&gt;properties){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -            note.properties = properties;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -            note.title = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -            note.contentPreview = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  90 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -    public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; noteBucket){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -        return noteBucket.query()</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -                .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  95 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  96 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  97 -    public static Query&lt;Note&gt; allDeleted(Bucket&lt;Note&gt; noteBucket){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  98 -        return noteBucket.query()</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  99 -                .where(&quot;deleted&quot;, ComparisonType.EQUAL_TO, true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 100 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 101 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 102 -    public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; noteBucket, String searchString){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 103 -        return noteBucket.query()</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 104 -                .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 105 -                .where(&quot;content&quot;, ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 106 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 107 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 108 -    public static Query&lt;Note&gt; allInTag(Bucket&lt;Note&gt; noteBucket, String tag){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 109 -        return noteBucket.query()</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 110 -                .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 111 -                .where(&quot;tags&quot;, ComparisonType.LIKE, tag);</span>





<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 112 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 113 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 114 -	public Note(String key, Map&lt;String,Object&gt;properties) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 115 -		super(key, properties);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 118 -    protected void updateTitleAndPreview(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 119 -        // try to bulid a title and preview property out of content</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 120 -        String content = getContent();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -        // title = &quot;Hello World&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -        // contentPreview = &quot;This is a preview&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 123 -        int location = -1;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 124 -        int lines = 0;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -        int content_lines = 0;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 126 -        int start = 0;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 127 -        boolean foundTitle = false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 128 -        boolean foundContent = false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 129 -        // loop until we&#x27;ve found all the new lines</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 130 -        do {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 131 -            start = location + 1;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 132 -            location = content.indexOf(NEW_LINE, start);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 133 -            if (location &gt; start + 1) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 134 -                String possible = content.substring(start, location);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 135 -                if (!foundTitle) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 136 -                    foundTitle = true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 137 -                    title = possible;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 138 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 139 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 140 -            lines ++;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 141 -        } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; !foundTitle);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 142 -        lines = 0;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 143 -        contentPreview = &quot;&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 144 -        do {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 145 -            start = location + 1;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 146 -            location = content.indexOf(NEW_LINE, start);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 147 -            if (location &gt; start + 1) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 148 -                String possible = content.substring(start, location);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 149 -                contentPreview = String.format(CONTENT_CONCAT_FORMAT, contentPreview, possible);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 150 -                if (contentPreview.length() &gt;= 300) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 151 -                    foundContent = true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 152 -                    contentPreview = contentPreview.substring(0, 300);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 153 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 154 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 155 -            lines ++;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 156 -        } while(location &gt;= 0 &amp;&amp; !foundContent);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -        if (!foundTitle) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 158 -            title = content;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 159 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 160 -        if (contentPreview.isEmpty()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 161 -            contentPreview = content;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 162 -        } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 163 -            contentPreview = contentPreview.trim();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 164 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 165 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 166 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -	public String getTitle() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 168 -        if (title == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 169 -            updateTitleAndPreview();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 170 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 171 -		return title;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 172 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 173 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 174 -    public String getTitle(String ifBlank){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 175 -        if (title == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 176 -            updateTitleAndPreview();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 177 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 178 -        if (title.trim().equals(&quot;&quot;)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 179 -            return ifBlank;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 180 -        } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 181 -            return title;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 182 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 183 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 184 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 185 -	public String getContent() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 186 -        Object content = getProperty(CONTENT_PROPERTY);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 187 -        if (content == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 188 -            return BLANK_CONTENT;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 189 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 190 -        return (String) content;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 191 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 192 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 193 -	public void setContent(String content) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 194 -        title = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 195 -        contentPreview = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 196 -        setProperty(CONTENT_PROPERTY, content);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 197 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 198 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 199 -	public String getContentPreview() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 200 -        if (contentPreview == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 201 -            updateTitleAndPreview();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 202 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 203 -		return contentPreview;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 204 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 205 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 206 -    public String getContentPreview(int lines){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 207 -        if (contentPreview == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 208 -            updateTitleAndPreview();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 209 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 210 -        return contentPreview;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 211 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 212 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 213 -	public Calendar getCreationDate() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 214 -        return numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 215 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 216 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 217 -	public void setCreationDate(Calendar creationDate) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 218 -        setProperty(CREATION_DATE_PROPERTY, creationDate.getTimeInMillis()/1000);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 219 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 220 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 221 -	public Calendar getModificationDate() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 222 -        return numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 223 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 224 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 225 -	public void setModificationDate(Calendar modificationDate) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 226 -        setProperty(MODIFICATION_DATE_PROPERTY, modificationDate.getTimeInMillis()/1000);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 227 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 228 -</span>








<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 229 -	public List&lt;String&gt; getTags() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 230 -        Object tags = getProperty(TAGS_PROPERTY);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 231 -        if (tags == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 232 -            return new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 233 -        } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 234 -            return (ArrayList&lt;String&gt;) tags;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 235 -        }</span>




<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 236 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 237 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 238 -	public void setTags(List&lt;String&gt; tags) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 239 -        setProperty(TAGS_PROPERTY, tags);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 240 -	}</span>
















































<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 241 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 242 -	public List&lt;String&gt; getSystemTags() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 243 -        Object tags = getProperty(SYSTEM_TAGS_PROPERTY);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 244 -        if (tags == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 245 -            return new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 246 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 247 -        return (List&lt;String&gt;) tags;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 248 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 249 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 250 -	public Boolean isDeleted() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 251 -        Object deleted = getProperty(DELETED_PROPERTY);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 252 -        if (deleted == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 253 -            return false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 254 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 255 -		if (deleted instanceof Boolean) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 256 -			return (Boolean) deleted;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 257 -		} else if (deleted instanceof Number) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 258 -			return ((Number)deleted).intValue() == 0 ? false : true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 259 -        } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 260 -            return false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 261 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 262 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 263 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 264 -	public void setDeleted(boolean deleted) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 265 -		setProperty(DELETED_PROPERTY, deleted);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 266 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 267 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 268 -	public boolean isPinned() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 269 -        return getSystemTags().contains(PINNED_TAG);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 270 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 271 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 272 -	public void setPinned(boolean isPinned) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 273 -        if (isPinned &amp;&amp; !isPinned()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 274 -            getSystemTags().add(PINNED_TAG);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 275 -        } else if (!isPinned &amp;&amp; isPinned()){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 276 -            getSystemTags().remove(PINNED_TAG);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 277 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 278 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 279 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 280 -    public static String dateString(Number time, boolean useShortFormat, Context context){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 281 -        Calendar c = numberToDate(time);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 282 -        return dateString(c, useShortFormat, context);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 283 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 284 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 285 -	public static String dateString(Calendar c, boolean useShortFormat, Context context) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 286 -		int year, month, day;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 287 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 288 -		String time, date, retVal;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 289 -		time = date = &quot;&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 290 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 291 -		Calendar diff = Calendar.getInstance();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 292 -		diff.setTimeInMillis(diff.getTimeInMillis() - c.getTimeInMillis());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 293 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 294 -		year = diff.get(Calendar.YEAR);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 295 -		month = diff.get(Calendar.MONTH);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 296 -		day = diff.get(Calendar.DAY_OF_MONTH);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 297 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 298 -		diff.setTimeInMillis(0); // starting time</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 299 -		time = DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 300 -		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(Calendar.DAY_OF_MONTH))) {"> 300 -		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(Calendar.DAY_OFðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 301 -			date = context.getResources().getString(R.string.today);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 302 -			if (useShortFormat)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 303 -				retVal = time;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 304 -			else</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 305 -				retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 306 -		} else if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == 1)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 307 -			date = context.getResources().getString(R.string.yesterday);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 308 -			if (useShortFormat)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 309 -				retVal = date;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 310 -			else</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 311 -				retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 312 -		} else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 313 -			date = new SimpleDateFormat(&quot;MMM dd&quot;, Locale.US).format(c.getTime());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 314 -			retVal = date + &quot;, &quot; + time;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 315 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 316 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 317 -		return retVal;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 318 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 319 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 320 -    protected Object getProperty(String key){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 321 -        return properties.get(key);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 322 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 323 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 324 -    protected void setProperty(String key, Object value){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 325 -        properties.put(key, value);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 326 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 327 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 328 -    public static Calendar numberToDate(Number time){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 329 -        Calendar date = Calendar.getInstance();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 330 -        if (time != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 331 -            date.setTimeInMillis(time.longValue()*1000);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 332 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 333 -        return date;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 334 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 335 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 336 -    /**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 337 -     * Check if the note has any changes</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 338 -     * @param content the new note content</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 339 -     * @param tags array of tags</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 340 -     * @param isPinned note is pinned</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 341 -     * @return true if note has changes, false if it is unchanged.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 342 -     */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 343 -    public boolean hasChanges(String content, List&lt;String&gt; tags, boolean isPinned) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 344 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 345 -        if (content.equals(this.getContent()) &amp;&amp; tags.equals(this.getTags()) &amp;&amp; this.isPinned() == isPinned)</span>



<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 346 -            return false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 347 -        else</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 348 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 349 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 350 -}</span></pre></td>
                            <td><pre>   1  package com.automattic.simplenote.models;
   2  
   3  import java.text.DateFormat;
   4  import java.text.SimpleDateFormat;
   5  import java.util.ArrayList;
   6  import java.util.Calendar;
   7  import java.util.HashMap;
   8  import java.util.Locale;
   9  import java.util.Map;
  10  import java.util.List;
  11  import java.util.ArrayList;
  12  
  13  import android.content.Context;
  14  import android.util.Log;
  15  
  16  import com.automattic.simplenote.R;
  17  
  18  import com.simperium.client.Bucket;
  19  import com.simperium.client.Query;
  20  import com.simperium.client.Query.ComparisonType;
  21  import com.simperium.client.Query.SortType;
  22  import com.simperium.client.BucketObject;
  23  import com.simperium.client.BucketSchema;
  24  import com.simperium.client.BucketSchema.Index;
  25  import com.simperium.client.BucketSchema.Indexer;
  26  
  27  public class Note extends BucketObject {
  28  
  29  	public static final String BUCKET_NAME=&quot;note&quot;;
  30      public static final String PINNED_TAG=&quot;pinned&quot;;
  31      public static final String NEW_LINE=&quot;\n&quot;;
  32  
  33      private static final String CONTENT_CONCAT_FORMAT=&quot;%s %s&quot;;
  34      private static final String BLANK_CONTENT=&quot;&quot;;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  35 +    private static final String SPACE = &quot; &quot;;</span>
  36  
  37      public static final String CONTENT_PROPERTY=&quot;content&quot;;
  38      public static final String TAGS_PROPERTY=&quot;tags&quot;;
  39      public static final String SYSTEM_TAGS_PROPERTY=&quot;systemTags&quot;;
  40      public static final String CREATION_DATE_PROPERTY=&quot;creationDate&quot;;
  41      public static final String MODIFICATION_DATE_PROPERTY=&quot;modificationDate&quot;;
  42      public static final String SHARE_URL_PROPERTY=&quot;shareURL&quot;;
  43      public static final String PUBLISH_URL_PROPERTY=&quot;publishURL&quot;;
  44      public static final String DELETED_PROPERTY=&quot;deleted&quot;;
  45  
  46  	protected String title = null;
  47  	protected String contentPreview = null;
  48  
  49  	public static class Schema extends BucketSchema&lt;Note&gt; {
  50  
  51          public Schema(){
  52              autoIndex();
  53              addIndex(noteIndexer);
  54              setDefault(CONTENT_PROPERTY, &quot;&quot;);
  55              setDefault(SYSTEM_TAGS_PROPERTY, new ArrayList&lt;Object&gt;());
  56              setDefault(TAGS_PROPERTY, new ArrayList&lt;Object&gt;());
  57              setDefault(DELETED_PROPERTY, false);
  58              setDefault(SHARE_URL_PROPERTY, &quot;&quot;);
  59              setDefault(PUBLISH_URL_PROPERTY, &quot;&quot;);
  60          }
  61  
  62          private Indexer noteIndexer = new Indexer&lt;Note&gt;(){
  63              @Override
  64              public List&lt;Index&gt; index(Note note){
  65                  List&lt;Index&gt; indexes = new ArrayList&lt;Index&gt;();
  66                  if (note.isPinned()) {
  67                      indexes.add(new Index(&quot;pinned&quot;, true));
  68                  } else {
  69                      indexes.add(new Index(&quot;pinned&quot;, false));
  70                  }
  71                  indexes.add(new Index(&quot;contentPreview&quot;, note.getContentPreview()));
  72                  indexes.add(new Index(&quot;title&quot;, note.getTitle()));
  73                  return indexes;
  74              }
  75          };
  76  
  77          public String getRemoteName(){
  78              return Note.BUCKET_NAME;
  79          }
  80  
  81  		public Note build(String key, Map&lt;String,Object&gt;properties){
  82  			Note note = new Note(key, properties);
  83  			return note;
  84  		}
  85  
  86          public void update(Note note, Map&lt;String,Object&gt;properties){
  87              note.properties = properties;
  88              note.title = null;
  89              note.contentPreview = null;
  90          }
  91  	}
  92  
  93      public static Query&lt;Note&gt; all(Bucket&lt;Note&gt; noteBucket){
  94          return noteBucket.query()
  95                  .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true);
  96      }
  97  
  98      public static Query&lt;Note&gt; allDeleted(Bucket&lt;Note&gt; noteBucket){
  99          return noteBucket.query()
 100                  .where(&quot;deleted&quot;, ComparisonType.EQUAL_TO, true);
 101      }
 102  
 103      public static Query&lt;Note&gt; search(Bucket&lt;Note&gt; noteBucket, String searchString){
 104          return noteBucket.query()
 105                  .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)
 106                  .where(&quot;content&quot;, ComparisonType.LIKE, &quot;%&quot; + searchString + &quot;%&quot;);
 107      }
 108  
 109      public static Query&lt;Note&gt; allInTag(Bucket&lt;Note&gt; noteBucket, String tag){
 110          return noteBucket.query()
 111                  .where(&quot;deleted&quot;, ComparisonType.NOT_EQUAL_TO, true)
 112                  .where(&quot;tags&quot;, ComparisonType.LIKE, tag);
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 115 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 116 +    public Note(String key){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +        super(key, new HashMap&lt;String,Object&gt;());</span>
 118      }
 119  
 120  	public Note(String key, Map&lt;String,Object&gt;properties) {
 121  		super(key, properties);
 122  	}
 123  
 124      protected void updateTitleAndPreview(){
 125          // try to bulid a title and preview property out of content
 126          String content = getContent();
 127          // title = &quot;Hello World&quot;;
 128          // contentPreview = &quot;This is a preview&quot;;
 129          int location = -1;
 130          int lines = 0;
 131          int content_lines = 0;
 132          int start = 0;
 133          boolean foundTitle = false;
 134          boolean foundContent = false;
 135          // loop until we&#x27;ve found all the new lines
 136          do {
 137              start = location + 1;
 138              location = content.indexOf(NEW_LINE, start);
 139              if (location &gt; start + 1) {
 140                  String possible = content.substring(start, location);
 141                  if (!foundTitle) {
 142                      foundTitle = true;
 143                      title = possible;
 144                  }
 145              }
 146              lines ++;
 147          } while(location &gt;= 0 &amp;&amp; lines &lt; 5 &amp;&amp; !foundTitle);
 148          lines = 0;
 149          contentPreview = &quot;&quot;;
 150          do {
 151              start = location + 1;
 152              location = content.indexOf(NEW_LINE, start);
 153              if (location &gt; start + 1) {
 154                  String possible = content.substring(start, location);
 155                  contentPreview = String.format(CONTENT_CONCAT_FORMAT, contentPreview, possible);
 156                  if (contentPreview.length() &gt;= 300) {
 157                      foundContent = true;
 158                      contentPreview = contentPreview.substring(0, 300);
 159                  }
 160              }
 161              lines ++;
 162          } while(location &gt;= 0 &amp;&amp; !foundContent);
 163          if (!foundTitle) {
 164              title = content;
 165          }
 166          if (contentPreview.isEmpty()) {
 167              contentPreview = content;
 168          } else {
 169              contentPreview = contentPreview.trim();
 170          }
 171      }
 172  
 173  	public String getTitle() {
 174          if (title == null) {
 175              updateTitleAndPreview();
 176          }
 177  		return title;
 178  	}
 179  
 180      public String getTitle(String ifBlank){
 181          if (title == null) {
 182              updateTitleAndPreview();
 183          }
 184          if (title.trim().equals(&quot;&quot;)) {
 185              return ifBlank;
 186          } else {
 187              return title;
 188          }
 189      }
 190  
 191  	public String getContent() {
 192          Object content = getProperty(CONTENT_PROPERTY);
 193          if (content == null) {
 194              return BLANK_CONTENT;
 195          }
 196          return (String) content;
 197  	}
 198  
 199  	public void setContent(String content) {
 200          title = null;
 201          contentPreview = null;
 202          setProperty(CONTENT_PROPERTY, content);
 203  	}
 204  
 205  	public String getContentPreview() {
 206          if (contentPreview == null) {
 207              updateTitleAndPreview();
 208          }
 209  		return contentPreview;
 210  	}
 211  
 212      public String getContentPreview(int lines){
 213          if (contentPreview == null) {
 214              updateTitleAndPreview();
 215          }
 216          return contentPreview;
 217      }
 218  
 219  	public Calendar getCreationDate() {
 220          return numberToDate((Number)getProperty(CREATION_DATE_PROPERTY));
 221  	}
 222  
 223  	public void setCreationDate(Calendar creationDate) {
 224          setProperty(CREATION_DATE_PROPERTY, creationDate.getTimeInMillis()/1000);
 225  	}
 226  
 227  	public Calendar getModificationDate() {
 228          return numberToDate((Number)getProperty(MODIFICATION_DATE_PROPERTY));
 229  	}
 230  
 231  	public void setModificationDate(Calendar modificationDate) {
 232          setProperty(MODIFICATION_DATE_PROPERTY, modificationDate.getTimeInMillis()/1000);
 233  	}
 234  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +    public boolean hasTag(Tag tag){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +        List&lt;String&gt; tags = getTags();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +        for (String tagKey : tags) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +            if (tag.getSimperiumKey().equals(tagKey)) return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 239 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +        return false;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +</span>
 243  	public List&lt;String&gt; getTags() {
 244          Object tags = getProperty(TAGS_PROPERTY);
 245          if (tags == null) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 246 -            return new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 247 -        } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 248 -            return (ArrayList&lt;String&gt;) tags;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 249 -        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +            tags = new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +            setProperty(TAGS_PROPERTY, tags);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +        return (ArrayList&lt;String&gt;) tags;</span>
 254  	}
 255  
 256  	public void setTags(List&lt;String&gt; tags) {
 257          setProperty(TAGS_PROPERTY, tags);
 258  	}
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 261 +     * String of tags delimited by a space</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 262 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 263 +    public CharSequence getTagString(){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 264 +        StringBuilder tagString = new StringBuilder();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 265 +        List&lt;String&gt; tags = getTags();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 266 +        for(String tag : tags){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 267 +            if (tagString.length() &gt; 0) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 268 +                tagString.append(SPACE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 269 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 270 +            tagString.append(tag);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 272 +        return tagString;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 273 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 274 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 275 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 276 +     * Sets the note&#x27;s tags by providing it with a {@link String} of space</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 277 +     * seperated tags. Filters out duplicate tags.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 278 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 279 +     * @param tagString a space delimited list of tags</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 280 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 281 +    public void setTagString(String tagString){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 282 +        List&lt;String&gt; tags = getTags();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 283 +        tags.clear();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 284 +        if (tagString == null) return;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 285 +        // for comparing case-insensitive strings, would like to find a way to</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 286 +        // do this without allocating a new list and strings</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 287 +        List&lt;String&gt; tagsUpperCase = new ArrayList&lt;String&gt;();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 288 +        // remove all current tags</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 289 +        int start = 0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 290 +        int next = -1;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 291 +        String possible;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +        String possibleUpperCase;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 293 +        // search tag string for space characters and pull out individual tags</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 294 +        do {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +            next = tagString.indexOf(SPACE, start);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +            if (next &gt; start) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +                possible = tagString.substring(start, next);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +                possibleUpperCase = possible.toUpperCase();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +                if (!possible.equals(SPACE) &amp;&amp; !tagsUpperCase.contains(possibleUpperCase)) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +                    tagsUpperCase.add(possibleUpperCase);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +                    tags.add(possible);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 302 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 303 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 304 +            start = next + 1;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 305 +        } while(next &gt; -1);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 306 +    }</span>
 307  
 308  	public List&lt;String&gt; getSystemTags() {
 309          Object tags = getProperty(SYSTEM_TAGS_PROPERTY);
 310          if (tags == null) {
 311              return new ArrayList&lt;String&gt;();
 312          }
 313          return (List&lt;String&gt;) tags;
 314  	}
 315  
 316  	public Boolean isDeleted() {
 317          Object deleted = getProperty(DELETED_PROPERTY);
 318          if (deleted == null) {
 319              return false;
 320          }
 321  		if (deleted instanceof Boolean) {
 322  			return (Boolean) deleted;
 323  		} else if (deleted instanceof Number) {
 324  			return ((Number)deleted).intValue() == 0 ? false : true;
 325          } else {
 326              return false;
 327          }
 328  	}
 329  
 330  	public void setDeleted(boolean deleted) {
 331  		setProperty(DELETED_PROPERTY, deleted);
 332  	}
 333  
 334  	public boolean isPinned() {
 335          return getSystemTags().contains(PINNED_TAG);
 336  	}
 337  
 338  	public void setPinned(boolean isPinned) {
 339          if (isPinned &amp;&amp; !isPinned()) {
 340              getSystemTags().add(PINNED_TAG);
 341          } else if (!isPinned &amp;&amp; isPinned()){
 342              getSystemTags().remove(PINNED_TAG);
 343          }
 344  	}
 345  
 346      public static String dateString(Number time, boolean useShortFormat, Context context){
 347          Calendar c = numberToDate(time);
 348          return dateString(c, useShortFormat, context);
 349      }
 350  
 351  	public static String dateString(Calendar c, boolean useShortFormat, Context context) {
 352  		int year, month, day;
 353  
 354  		String time, date, retVal;
 355  		time = date = &quot;&quot;;
 356  
 357  		Calendar diff = Calendar.getInstance();
 358  		diff.setTimeInMillis(diff.getTimeInMillis() - c.getTimeInMillis());
 359  
 360  		year = diff.get(Calendar.YEAR);
 361  		month = diff.get(Calendar.MONTH);
 362  		day = diff.get(Calendar.DAY_OF_MONTH);
 363  
 364  		diff.setTimeInMillis(0); // starting time
 365  		time = DateFormat.getTimeInstance(DateFormat.SHORT).format(c.getTime());
<abbr title=" 366  		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(Calendar.DAY_OF_MONTH))) {"> 366  		if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == diff.get(Calendar.DAY_OFðŸ”µ</abbr>
 367  			date = context.getResources().getString(R.string.today);
 368  			if (useShortFormat)
 369  				retVal = time;
 370  			else
 371  				retVal = date + &quot;, &quot; + time;
 372  		} else if ((year == diff.get(Calendar.YEAR)) &amp;&amp; (month == diff.get(Calendar.MONTH)) &amp;&amp; (day == 1)) {
 373  			date = context.getResources().getString(R.string.yesterday);
 374  			if (useShortFormat)
 375  				retVal = date;
 376  			else
 377  				retVal = date + &quot;, &quot; + time;
 378  		} else {
 379  			date = new SimpleDateFormat(&quot;MMM dd&quot;, Locale.US).format(c.getTime());
 380  			retVal = date + &quot;, &quot; + time;
 381  		}
 382  
 383  		return retVal;
 384  	}
 385  
 386      protected Object getProperty(String key){
 387          return properties.get(key);
 388      }
 389  
 390      protected void setProperty(String key, Object value){
 391          properties.put(key, value);
 392      }
 393  
 394      public static Calendar numberToDate(Number time){
 395          Calendar date = Calendar.getInstance();
 396          if (time != null) {
 397              date.setTimeInMillis(time.longValue()*1000);
 398          }
 399          return date;
 400      }
 401  
 402      /**
 403       * Check if the note has any changes
 404       * @param content the new note content
 405       * @param tags array of tags
 406       * @param isPinned note is pinned
 407       * @return true if note has changes, false if it is unchanged.
 408       */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 409 -    public boolean hasChanges(String content, List&lt;String&gt; tags, boolean isPinned) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 410 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 411 -        if (content.equals(this.getContent()) &amp;&amp; tags.equals(this.getTags()) &amp;&amp; this.isPinned() == isPinned)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 412 +    public boolean hasChanges(String content, boolean isPinned) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 413 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 414 +        if (content.equals(this.getContent()) &amp;&amp; this.isPinned() == isPinned)</span>
 415              return false;
 416          else
 417              return true;
 418      }
 419  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            