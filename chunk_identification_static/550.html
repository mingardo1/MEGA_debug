<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>550</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    550
                    <a href="549.html">prev</a>
                    <a href="551.html">next</a>
                    <a href="550_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_e83f8c3a3cbab21ecd8ceab223b0f3539be4b5fd_launcher/src/main/java/com/dtstack/flink/sql/launcher/ClusterClientFactory.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e83f8c3a3cbab21ecd8ceab223b0f3539be4b5fd:launcher/src/main/java/com/dtstack/flink/sql/launcher/ClusterClientFactory.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e83f8c3a3cbab21ecd8ceab223b0f3539be4b5fd^1:launcher/src/main/java/com/dtstack/flink/sql/launcher/ClusterClientFactory.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e83f8c3a3cbab21ecd8ceab223b0f3539be4b5fd^2:launcher/src/main/java/com/dtstack/flink/sql/launcher/ClusterClientFactory.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;55715c184d537500eff25ccea853833950100929:launcher/src/main/java/com/dtstack/flink/sql/launcher/ClusterClientFactory.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [bj], [s]], subset: [[b], [bsj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">   1 /**                                                                                                      </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">   9  * &lt;p&gt;                                                                                                   </span>
<span class="3430964305904514764" onmouseenter="enter('3430964305904514764');" onmouseout="out('3430964305904514764');" style="">  10  * http://www.apache.org/licenses/LICENSE-2.0                                                            </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  11  * &lt;p&gt;                                                                                                   </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span class="-4666348732459622550" onmouseenter="enter('-4666348732459622550');" onmouseout="out('-4666348732459622550');" style="">  19 package com.dtstack.flink.sql.launcher;                                                                  </span>
<span  style="">  20                                                                                                          </span>
<span class="4163183244871785745" onmouseenter="enter('4163183244871785745');" onmouseout="out('4163183244871785745');" style="">  21 import com.dtstack.flink.sql.enums.ClusterMode;                                                          </span>
<span class="6579778626253321963" onmouseenter="enter('6579778626253321963');" onmouseout="out('6579778626253321963');" style="">  22 import com.dtstack.flink.sql.option.Options;                                                             </span>
<span class="-3389130316234486348" onmouseenter="enter('-3389130316234486348');" onmouseout="out('-3389130316234486348');" style="">  23 import com.dtstack.flink.sql.util.PluginUtil;                                                            </span>
<span class="-8922236357512993475" onmouseenter="enter('-8922236357512993475');" onmouseout="out('-8922236357512993475');" style="">  24 import org.apache.commons.io.Charsets;                                                                   </span>
<span class="7952073036463698968" onmouseenter="enter('7952073036463698968');" onmouseout="out('7952073036463698968');" style="">  25 import org.apache.commons.lang.StringUtils;                                                              </span>
<span class="-5018311972488265281" onmouseenter="enter('-5018311972488265281');" onmouseout="out('-5018311972488265281');" style="">  26 import org.apache.flink.client.program.ClusterClient;                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  27 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="7739213985600208914" onmouseenter="enter('7739213985600208914');" onmouseout="out('7739213985600208914');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import org.apache.flink.client.program.MiniClusterClient;                                                </span>
<span class="-304847577149896806" onmouseenter="enter('-304847577149896806');" onmouseout="out('-304847577149896806');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import org.apache.flink.configuration.ConfigConstants;                                                   </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  30 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-5018311972488265281" onmouseenter="enter('-5018311972488265281');" onmouseout="out('-5018311972488265281');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import org.apache.flink.client.program.ClusterClient;                                                    </span>
<span class="7739213985600208914" onmouseenter="enter('7739213985600208914');" onmouseout="out('7739213985600208914');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import org.apache.flink.client.program.MiniClusterClient;                                                </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  34 =======                                                                                                  </span>
<span class="-2145364053946109621" onmouseenter="enter('-2145364053946109621');" onmouseout="out('-2145364053946109621');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  35 import org.apache.flink.client.program.rest.RestClusterClient;                                           </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  36 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  37 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="-5961957399886376486" onmouseenter="enter('-5961957399886376486');" onmouseout="out('-5961957399886376486');" style="">  38 import org.apache.flink.configuration.GlobalConfiguration;                                               </span>
<span class="-6310495642702641788" onmouseenter="enter('-6310495642702641788');" onmouseout="out('-6310495642702641788');" style="">  39 import org.apache.flink.configuration.JobManagerOptions;                                                 </span>
<span class="8609901781044162488" onmouseenter="enter('8609901781044162488');" onmouseout="out('8609901781044162488');" style="">  40 import org.apache.flink.core.fs.FileSystem;                                                              </span>
<span class="-2586613049287592313" onmouseenter="enter('-2586613049287592313');" onmouseout="out('-2586613049287592313');" style="">  41 import org.apache.flink.runtime.akka.AkkaUtils;                                                          </span>
<span class="2463804193477214615" onmouseenter="enter('2463804193477214615');" onmouseout="out('2463804193477214615');" style="">  42 import org.apache.flink.runtime.util.LeaderConnectionInfo;                                               </span>
<span class="2707853699459523291" onmouseenter="enter('2707853699459523291');" onmouseout="out('2707853699459523291');" style="">  43 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;                                              </span>
<span class="8677815094093511563" onmouseenter="enter('8677815094093511563');" onmouseout="out('8677815094093511563');" style="">  44 import org.apache.flink.yarn.YarnClusterDescriptor;                                                      </span>
<span class="8458556742018191597" onmouseenter="enter('8458556742018191597');" onmouseout="out('8458556742018191597');" style="">  45 import org.apache.hadoop.yarn.api.records.ApplicationId;                                                 </span>
<span class="4889670150256338446" onmouseenter="enter('4889670150256338446');" onmouseout="out('4889670150256338446');" style="">  46 import org.apache.hadoop.yarn.api.records.ApplicationReport;                                             </span>
<span class="-8519056337267772623" onmouseenter="enter('-8519056337267772623');" onmouseout="out('-8519056337267772623');" style="">  47 import org.apache.hadoop.yarn.api.records.YarnApplicationState;                                          </span>
<span class="-6331858862509679410" onmouseenter="enter('-6331858862509679410');" onmouseout="out('-6331858862509679410');" style="">  48 import org.apache.hadoop.yarn.client.api.YarnClient;                                                     </span>
<span class="-5883054148134480566" onmouseenter="enter('-5883054148134480566');" onmouseout="out('-5883054148134480566');" style="">  49 import org.apache.hadoop.yarn.conf.YarnConfiguration;                                                    </span>
<span class="-7343793280970510192" onmouseenter="enter('-7343793280970510192');" onmouseout="out('-7343793280970510192');" style="">  50 import org.apache.hadoop.yarn.util.StringHelper;                                                         </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  51 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  52 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  53                                                                                                          </span>
<span class="-5372229354663550968" onmouseenter="enter('-5372229354663550968');" onmouseout="out('-5372229354663550968');" style="">  54 import java.net.InetSocketAddress;                                                                       </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="">  55 import java.net.URLDecoder;                                                                              </span>
<span class="708245193883173442" onmouseenter="enter('708245193883173442');" onmouseout="out('708245193883173442');" style="">  56 import java.util.EnumSet;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  57 import java.util.HashSet;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  58 import java.util.Set;                                                                                    </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  59 import java.util.List;                                                                                   </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  60 import java.util.Properties;                                                                             </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  61 import java.util.Iterator;                                                                               </span>
<span  style="">  62                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  63 /**                                                                                                      </span>
<span class="-3971691924018094169" onmouseenter="enter('-3971691924018094169');" onmouseout="out('-3971691924018094169');" style="">  64  * @author sishu.yss                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  65  */                                                                                                      </span>
<span class="2987681938130092722" onmouseenter="enter('2987681938130092722');" onmouseout="out('2987681938130092722');" style="">  66 public class ClusterClientFactory {                                                                      </span>
<span  style="">  67                                                                                                          </span>
<span class="158955771696974218" onmouseenter="enter('158955771696974218');" onmouseout="out('158955771696974218');" style="">  68     private static final Logger LOG = LoggerFactory.getLogger(ClusterClientFactory.class);               </span>
<span  style="">  69                                                                                                          </span>
<span class="-814536110407258758" onmouseenter="enter('-814536110407258758');" onmouseout="out('-814536110407258758');" style="">  70     private static final String HA_CLUSTER_ID = &quot;high-availability.cluster-id&quot;;                          </span>
<span  style="">  71                                                                                                          </span>
<span class="-5284483266258366119" onmouseenter="enter('-5284483266258366119');" onmouseout="out('-5284483266258366119');" style="">  72     private static final String HIGH_AVAILABILITY = &quot;high-availability&quot;;                                 </span>
<span  style="">  73                                                                                                          </span>
<span class="6046766839872255303" onmouseenter="enter('6046766839872255303');" onmouseout="out('6046766839872255303');" style="">  74     private static final String NODE = &quot;NONE&quot;;                                                           </span>
<span  style="">  75                                                                                                          </span>
<span class="5793523754398446120" onmouseenter="enter('5793523754398446120');" onmouseout="out('5793523754398446120');" style="">  76     private static final String ZOOKEEPER = &quot;zookeeper&quot;;                                                 </span>
<span  style="">  77                                                                                                          </span>
<span class="-5534687535083206001" onmouseenter="enter('-5534687535083206001');" onmouseout="out('-5534687535083206001');" style="">  78     private static final String HADOOP_CONF = &quot;fs.hdfs.hadoopconf&quot;;                                      </span>
<span  style="">  79                                                                                                          </span>
<span class="9096170393674332782" onmouseenter="enter('9096170393674332782');" onmouseout="out('9096170393674332782');" style="">  80     public static ClusterClient createClusterClient(Options launcherOptions) throws Exception {          </span>
<span class="1580619527178340568" onmouseenter="enter('1580619527178340568');" onmouseout="out('1580619527178340568');" style="">  81         String mode = launcherOptions.getMode();                                                         </span>
<span class="3152003248099615816" onmouseenter="enter('3152003248099615816');" onmouseout="out('3152003248099615816');" style="">  82         if (mode.equals(ClusterMode.standalone.name())) {                                                </span>
<span class="-2673317197223310055" onmouseenter="enter('-2673317197223310055');" onmouseout="out('-2673317197223310055');" style="">  83             return createStandaloneClient(launcherOptions);                                              </span>
<span class="6048008447776154150" onmouseenter="enter('6048008447776154150');" onmouseout="out('6048008447776154150');" style="">  84         } else if (mode.equals(ClusterMode.yarn.name())) {                                               </span>
<span class="-7696015566091056231" onmouseenter="enter('-7696015566091056231');" onmouseout="out('-7696015566091056231');" style="">  85             return createYarnSessionClient(launcherOptions);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86         }                                                                                                </span>
<span class="-1110182490908431808" onmouseenter="enter('-1110182490908431808');" onmouseout="out('-1110182490908431808');" style="">  87         throw new IllegalArgumentException(&quot;Unsupported cluster client type: &quot;);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  88     }                                                                                                    </span>
<span  style="">  89                                                                                                          </span>
<span class="-802191291303526610" onmouseenter="enter('-802191291303526610');" onmouseout="out('-802191291303526610');" style="">  90     public static ClusterClient createStandaloneClient(Options launcherOptions) throws Exception {       </span>
<span class="1761492070997118793" onmouseenter="enter('1761492070997118793');" onmouseout="out('1761492070997118793');" style="">  91         String flinkConfDir = launcherOptions.getFlinkconf();                                            </span>
<span class="7816329497793558634" onmouseenter="enter('7816329497793558634');" onmouseout="out('7816329497793558634');" style="">  92         Configuration config = GlobalConfiguration.loadConfiguration(flinkConfDir);                      </span>
<span  style="">  93                                                                                                          </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style="">  94         LOG.info(&quot;------------config params-------------------------&quot;);                                  </span>
<span class="-1891084833916369881" onmouseenter="enter('-1891084833916369881');" onmouseout="out('-1891084833916369881');" style="">  95         config.toMap().forEach((key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                          </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style="">  96         LOG.info(&quot;-------------------------------------------&quot;);                                         </span>
<span  style="">  97                                                                                                          </span>
<span class="-2718724998192346216" onmouseenter="enter('-2718724998192346216');" onmouseout="out('-2718724998192346216');" style="">  98         RestClusterClient clusterClient = new RestClusterClient&lt;&gt;(config, &quot;clusterClient&quot;);              </span>
<span class="5460388504045041514" onmouseenter="enter('5460388504045041514');" onmouseout="out('5460388504045041514');" style="">  99         LeaderConnectionInfo connectionInfo = clusterClient.getClusterConnectionInfo();                  </span>
<span class="5152489928806645392" onmouseenter="enter('5152489928806645392');" onmouseout="out('5152489928806645392');" style=""><abbr title=" 100         InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());"> 100         InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress()ðŸ”µ</abbr></span>
<span class="6829588547509854341" onmouseenter="enter('6829588547509854341');" onmouseout="out('6829588547509854341');" style=""> 101         config.setString(JobManagerOptions.ADDRESS, address.getAddress().getHostName());                 </span>
<span class="9134688451588203149" onmouseenter="enter('9134688451588203149');" onmouseout="out('9134688451588203149');" style=""> 102         config.setInteger(JobManagerOptions.PORT, address.getPort());                                    </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 103         clusterClient.setDetached(true);                                                                 </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 104         return clusterClient;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105     }                                                                                                    </span>
<span  style=""> 106                                                                                                          </span>
<span class="-6427714043144307769" onmouseenter="enter('-6427714043144307769');" onmouseout="out('-6427714043144307769');" style=""> 107     public static ClusterClient createYarnSessionClient(Options launcherOptions) {                       </span>
<span class="-1817028274787323640" onmouseenter="enter('-1817028274787323640');" onmouseout="out('-1817028274787323640');" style=""><abbr title=" 108         String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.getFlinkconf();"> 108         String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.ðŸ”µ</abbr></span>
<span class="4635921604956969650" onmouseenter="enter('4635921604956969650');" onmouseout="out('4635921604956969650');" style=""><abbr title=" 109         Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguration.loadConfiguration(flinkConfDir);"> 109         Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguratðŸ”µ</abbr></span>
<span class="5386610166888514231" onmouseenter="enter('5386610166888514231');" onmouseout="out('5386610166888514231');" style=""> 110         String yarnConfDir = launcherOptions.getYarnconf();                                              </span>
<span  style=""> 111                                                                                                          </span>
<span class="5688737160066801667" onmouseenter="enter('5688737160066801667');" onmouseout="out('5688737160066801667');" style=""> 112         if (StringUtils.isNotBlank(yarnConfDir)) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 113             try {                                                                                        </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 114 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-2564123571596243167" onmouseenter="enter('-2564123571596243167');" onmouseout="out('-2564123571596243167');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 115                 config.setString(ConfigConstants.PATH_HADOOP_CONFIG, yarnConfDir);                       </span>
<span class="-3370155354983794031" onmouseenter="enter('-3370155354983794031');" onmouseout="out('-3370155354983794031');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 116                 FileSystem.initialize(config, null);                                                     </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 117 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="9044151009829571497" onmouseenter="enter('9044151009829571497');" onmouseout="out('9044151009829571497');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118                 FileSystem.initialize(config);                                                           </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119                                                                                                          </span>
<span class="-8309544538696184279" onmouseenter="enter('-8309544538696184279');" onmouseout="out('-8309544538696184279');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120                 YarnConfiguration yarnConf = YarnConfLoader.getYarnConf(yarnConfDir);                    </span>
<span class="-4294518192733428025" onmouseenter="enter('-4294518192733428025');" onmouseout="out('-4294518192733428025');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121                 YarnClient yarnClient = YarnClient.createYarnClient();                                   </span>
<span class="5472274627169264043" onmouseenter="enter('5472274627169264043');" onmouseout="out('5472274627169264043');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122                 yarnClient.init(yarnConf);                                                               </span>
<span class="6599374713362233892" onmouseenter="enter('6599374713362233892');" onmouseout="out('6599374713362233892');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123                 yarnClient.start();                                                                      </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124                 ApplicationId applicationId = null;                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125                                                                                                          </span>
<span class="-9176432362536668352" onmouseenter="enter('-9176432362536668352');" onmouseout="out('-9176432362536668352');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126                 String yarnSessionConf = launcherOptions.getYarnSessionConf();                           </span>
<span class="-127694460867817418" onmouseenter="enter('-127694460867817418');" onmouseout="out('-127694460867817418');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127                 yarnSessionConf = URLDecoder.decode(yarnSessionConf, Charsets.UTF_8.toString());         </span>
<span class="-859984515838945264" onmouseenter="enter('-859984515838945264');" onmouseout="out('-859984515838945264');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 128                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.class);"> 128                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, ProperðŸ”µ</abbr></span>
<span class="8863382991069320815" onmouseenter="enter('8863382991069320815');" onmouseout="out('8863382991069320815');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129                 Object yid = yarnSessionConfProperties.get(&quot;yid&quot;);                                       </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130                                                                                                          </span>
<span class="-8848781777370597992" onmouseenter="enter('-8848781777370597992');" onmouseout="out('-8848781777370597992');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131                 if (null != yid) {                                                                       </span>
<span class="-6322388926542920640" onmouseenter="enter('-6322388926542920640');" onmouseout="out('-6322388926542920640');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132                     applicationId = toApplicationId(yid.toString());                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133                 } else {                                                                                 </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 134 =======                                                                                                  </span>
<span class="-4375817209366726298" onmouseenter="enter('-4375817209366726298');" onmouseout="out('-4375817209366726298');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135                 boolean isHighAvailability;                                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136                                                                                                          </span>
<span class="-5377933620241534990" onmouseenter="enter('-5377933620241534990');" onmouseout="out('-5377933620241534990');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137                 config.setString(HADOOP_CONF, yarnConfDir);                                              </span>
<span class="9044151009829571497" onmouseenter="enter('9044151009829571497');" onmouseout="out('9044151009829571497');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138                 FileSystem.initialize(config);                                                           </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 139 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style=""> 140                                                                                                          </span>
<span class="-8309544538696184279" onmouseenter="enter('-8309544538696184279');" onmouseout="out('-8309544538696184279');" style=""> 141                 YarnConfiguration yarnConf = YarnConfLoader.getYarnConf(yarnConfDir);                    </span>
<span class="-4294518192733428025" onmouseenter="enter('-4294518192733428025');" onmouseout="out('-4294518192733428025');" style=""> 142                 YarnClient yarnClient = YarnClient.createYarnClient();                                   </span>
<span class="5472274627169264043" onmouseenter="enter('5472274627169264043');" onmouseout="out('5472274627169264043');" style=""> 143                 yarnClient.init(yarnConf);                                                               </span>
<span class="6599374713362233892" onmouseenter="enter('6599374713362233892');" onmouseout="out('6599374713362233892');" style=""> 144                 yarnClient.start();                                                                      </span>
<span class="-8174546465611380821" onmouseenter="enter('-8174546465611380821');" onmouseout="out('-8174546465611380821');" style=""> 145                 ApplicationId applicationId;                                                             </span>
<span  style=""> 146                                                                                                          </span>
<span class="-9176432362536668352" onmouseenter="enter('-9176432362536668352');" onmouseout="out('-9176432362536668352');" style=""> 147                 String yarnSessionConf = launcherOptions.getYarnSessionConf();                           </span>
<span class="-127694460867817418" onmouseenter="enter('-127694460867817418');" onmouseout="out('-127694460867817418');" style=""> 148                 yarnSessionConf = URLDecoder.decode(yarnSessionConf, Charsets.UTF_8.toString());         </span>
<span class="-859984515838945264" onmouseenter="enter('-859984515838945264');" onmouseout="out('-859984515838945264');" style=""><abbr title=" 149                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.class);"> 149                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, ProperðŸ”µ</abbr></span>
<span  style=""> 150                                                                                                          </span>
<span class="8863382991069320815" onmouseenter="enter('8863382991069320815');" onmouseout="out('8863382991069320815');" style=""> 151                 Object yid = yarnSessionConfProperties.get(&quot;yid&quot;);                                       </span>
<span  style=""> 152                                                                                                          </span>
<span class="-8848781777370597992" onmouseenter="enter('-8848781777370597992');" onmouseout="out('-8848781777370597992');" style=""> 153                 if (null != yid) {                                                                       </span>
<span class="-6322388926542920640" onmouseenter="enter('-6322388926542920640');" onmouseout="out('-6322388926542920640');" style=""> 154                     applicationId = toApplicationId(yid.toString());                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 155                 } else {                                                                                 </span>
<span class="-1125803419217936962" onmouseenter="enter('-1125803419217936962');" onmouseout="out('-1125803419217936962');" style=""> 156                     applicationId = getYarnClusterApplicationId(yarnClient);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                 }                                                                                        </span>
<span  style=""> 158                                                                                                          </span>
<span class="2782241111845053045" onmouseenter="enter('2782241111845053045');" onmouseout="out('2782241111845053045');" style=""> 159                 LOG.info(&quot;current applicationId = {}&quot;, applicationId.toString());                        </span>
<span  style=""> 160                                                                                                          </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style=""> 161                 if (StringUtils.isEmpty(applicationId.toString())) {                                     </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 162                     throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163                 }                                                                                        </span>
<span  style=""> 164                                                                                                          </span>
<span class="531036869131629996" onmouseenter="enter('531036869131629996');" onmouseout="out('531036869131629996');" style=""> 165                 isHighAvailability = config.getString(HIGH_AVAILABILITY, NODE).equals(ZOOKEEPER);        </span>
<span  style=""> 166                                                                                                          </span>
<span class="-4042001981978397381" onmouseenter="enter('-4042001981978397381');" onmouseout="out('-4042001981978397381');" style=""> 167                 if (isHighAvailability &amp;&amp; config.getString(HA_CLUSTER_ID, null) == null) {               </span>
<span class="1242336459937762287" onmouseenter="enter('1242336459937762287');" onmouseout="out('1242336459937762287');" style=""> 168                     config.setString(HA_CLUSTER_ID, applicationId.toString());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169                 }                                                                                        </span>
<span  style=""> 170                                                                                                          </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style=""> 171                 LOG.info(&quot;------------config params-------------------------&quot;);                          </span>
<span class="-1891084833916369881" onmouseenter="enter('-1891084833916369881');" onmouseout="out('-1891084833916369881');" style=""> 172                 config.toMap().forEach((key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                  </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style=""> 173                 LOG.info(&quot;-------------------------------------------&quot;);                                 </span>
<span  style=""> 174                                                                                                          </span>
<span class="-6816091760091632163" onmouseenter="enter('-6816091760091632163');" onmouseout="out('-6816091760091632163');" style=""><abbr title=" 175                 AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinkConfDir, yarnClient, false);"> 175                 AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnCðŸ”µ</abbr></span>
<span class="7284485832444382760" onmouseenter="enter('7284485832444382760');" onmouseout="out('7284485832444382760');" style=""> 176                 ClusterClient clusterClient = clusterDescriptor.retrieve(applicationId);                 </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 177                 clusterClient.setDetached(true);                                                         </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 178                 return clusterClient;                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 179             } catch (Exception e) {                                                                      </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 180                 throw new RuntimeException(e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 182         } else {                                                                                         </span>
<span class="-818626197127626055" onmouseenter="enter('-818626197127626055');" onmouseout="out('-818626197127626055');" style=""> 183             throw new RuntimeException(&quot;yarn mode must set param of &#x27;yarnconf&#x27;!!!&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185     }                                                                                                    </span>
<span  style=""> 186                                                                                                          </span>
<span  style=""> 187                                                                                                          </span>
<span class="4520585383857802787" onmouseenter="enter('4520585383857802787');" onmouseout="out('4520585383857802787');" style=""> 188     private static ApplicationId getYarnClusterApplicationId(YarnClient yarnClient) throws Exception {   </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style=""> 189         ApplicationId applicationId = null;                                                              </span>
<span  style=""> 190                                                                                                          </span>
<span class="-8169037907797863140" onmouseenter="enter('-8169037907797863140');" onmouseout="out('-8169037907797863140');" style=""> 191         Set&lt;String&gt; set = new HashSet&lt;&gt;();                                                               </span>
<span class="1611340247917691443" onmouseenter="enter('1611340247917691443');" onmouseout="out('1611340247917691443');" style=""> 192         set.add(&quot;Apache Flink&quot;);                                                                         </span>
<span class="5540355505413622998" onmouseenter="enter('5540355505413622998');" onmouseout="out('5540355505413622998');" style=""> 193         EnumSet&lt;YarnApplicationState&gt; enumSet = EnumSet.noneOf(YarnApplicationState.class);              </span>
<span class="4582984779835017200" onmouseenter="enter('4582984779835017200');" onmouseout="out('4582984779835017200');" style=""> 194         enumSet.add(YarnApplicationState.RUNNING);                                                       </span>
<span class="1830734000385452214" onmouseenter="enter('1830734000385452214');" onmouseout="out('1830734000385452214');" style=""> 195         List&lt;ApplicationReport&gt; reportList = yarnClient.getApplications(set, enumSet);                   </span>
<span  style=""> 196                                                                                                          </span>
<span class="-369447775955784899" onmouseenter="enter('-369447775955784899');" onmouseout="out('-369447775955784899');" style=""> 197         int maxMemory = -1;                                                                              </span>
<span class="-4846585872764251675" onmouseenter="enter('-4846585872764251675');" onmouseout="out('-4846585872764251675');" style=""> 198         int maxCores = -1;                                                                               </span>
<span class="6886164409438478920" onmouseenter="enter('6886164409438478920');" onmouseout="out('6886164409438478920');" style=""> 199         for (ApplicationReport report : reportList) {                                                    </span>
<span class="-424772390849256809" onmouseenter="enter('-424772390849256809');" onmouseout="out('-424772390849256809');" style=""> 200             if (!report.getName().startsWith(&quot;Flink session&quot;)) {                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 201                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202             }                                                                                            </span>
<span  style=""> 203                                                                                                          </span>
<span class="1235099662322490241" onmouseenter="enter('1235099662322490241');" onmouseout="out('1235099662322490241');" style=""> 204             if (!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) {                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 205                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206             }                                                                                            </span>
<span  style=""> 207                                                                                                          </span>
<span class="4956299878435728516" onmouseenter="enter('4956299878435728516');" onmouseout="out('4956299878435728516');" style=""> 208             int thisMemory = report.getApplicationResourceUsageReport().getNeededResources().getMemory();</span>
<span class="-1408027150422172031" onmouseenter="enter('-1408027150422172031');" onmouseout="out('-1408027150422172031');" style=""><abbr title=" 209             int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();"> 209             int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCorðŸ”µ</abbr></span>
<span class="5717156388718347421" onmouseenter="enter('5717156388718347421');" onmouseout="out('5717156388718347421');" style=""> 210             if (thisMemory &gt; maxMemory || thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) {             </span>
<span class="393893018308938162" onmouseenter="enter('393893018308938162');" onmouseout="out('393893018308938162');" style=""> 211                 maxMemory = thisMemory;                                                                  </span>
<span class="-6641939115520661476" onmouseenter="enter('-6641939115520661476');" onmouseout="out('-6641939115520661476');" style=""> 212                 maxCores = thisCores;                                                                    </span>
<span class="-2782692697137135125" onmouseenter="enter('-2782692697137135125');" onmouseout="out('-2782692697137135125');" style=""> 213                 applicationId = report.getApplicationId();                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214             }                                                                                            </span>
<span  style=""> 215                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216         }                                                                                                </span>
<span  style=""> 217                                                                                                          </span>
<span class="8874933916351401024" onmouseenter="enter('8874933916351401024');" onmouseout="out('8874933916351401024');" style=""> 218         if (applicationId == null || StringUtils.isEmpty(applicationId.toString())) {                    </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 219             throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220         }                                                                                                </span>
<span class="5985572316486027976" onmouseenter="enter('5985572316486027976');" onmouseout="out('5985572316486027976');" style=""> 221         return applicationId;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222     }                                                                                                    </span>
<span  style=""> 223                                                                                                          </span>
<span class="-4507162632467603669" onmouseenter="enter('-4507162632467603669');" onmouseout="out('-4507162632467603669');" style=""> 224     private static ApplicationId toApplicationId(String appIdStr) {                                      </span>
<span class="4229427001454084170" onmouseenter="enter('4229427001454084170');" onmouseout="out('4229427001454084170');" style=""> 225         Iterator&lt;String&gt; it = StringHelper._split(appIdStr).iterator();                                  </span>
<span class="5406390625905078860" onmouseenter="enter('5406390625905078860');" onmouseout="out('5406390625905078860');" style=""> 226         if (!&quot;application&quot;.equals(it.next())) {                                                          </span>
<span class="8668152551389785899" onmouseenter="enter('8668152551389785899');" onmouseout="out('8668152551389785899');" style=""><abbr title=" 227             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicationId should start with prefix &quot; + &quot;application&quot;);"> 227             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The validðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 228         } else {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 229             try {                                                                                        </span>
<span class="7789939610237528981" onmouseenter="enter('7789939610237528981');" onmouseout="out('7789939610237528981');" style=""> 230                 return toApplicationId(it);                                                              </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 231             } catch (NumberFormatException e) {                                                          </span>
<span class="1796865554742970225" onmouseenter="enter('1796865554742970225');" onmouseout="out('1796865554742970225');" style=""> 232                 throw new IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; + appIdStr, e);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235     }                                                                                                    </span>
<span  style=""> 236                                                                                                          </span>
<span class="1367086786860425516" onmouseenter="enter('1367086786860425516');" onmouseout="out('1367086786860425516');" style=""> 237     private static ApplicationId toApplicationId(Iterator&lt;String&gt; it) throws NumberFormatException {     </span>
<span class="-2928988115653544018" onmouseenter="enter('-2928988115653544018');" onmouseout="out('-2928988115653544018');" style=""> 238         return ApplicationId.newInstance(Long.parseLong(it.next()), Integer.parseInt(it.next()));        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 239     }                                                                                                    </span>
<span  style=""> 240                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 241 }                                                                                                        </span></pre></td>
                            <td><pre><span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">   1 /**                                                                                                      </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="3430964305904514764" onmouseenter="enter('3430964305904514764');" onmouseout="out('3430964305904514764');" style="">  10  * http://www.apache.org/licenses/LICENSE-2.0                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span class="-4666348732459622550" onmouseenter="enter('-4666348732459622550');" onmouseout="out('-4666348732459622550');" style="">  19 package com.dtstack.flink.sql.launcher;                                                                  </span>
<span  style="">  20                                                                                                          </span>
<span class="4163183244871785745" onmouseenter="enter('4163183244871785745');" onmouseout="out('4163183244871785745');" style="">  21 import com.dtstack.flink.sql.enums.ClusterMode;                                                          </span>
<span class="6579778626253321963" onmouseenter="enter('6579778626253321963');" onmouseout="out('6579778626253321963');" style="">  22 import com.dtstack.flink.sql.option.Options;                                                             </span>
<span class="-3389130316234486348" onmouseenter="enter('-3389130316234486348');" onmouseout="out('-3389130316234486348');" style="">  23 import com.dtstack.flink.sql.util.PluginUtil;                                                            </span>
<span class="-8922236357512993475" onmouseenter="enter('-8922236357512993475');" onmouseout="out('-8922236357512993475');" style="">  24 import org.apache.commons.io.Charsets;                                                                   </span>
<span class="7952073036463698968" onmouseenter="enter('7952073036463698968');" onmouseout="out('7952073036463698968');" style="">  25 import org.apache.commons.lang.StringUtils;                                                              </span>
<span class="-5018311972488265281" onmouseenter="enter('-5018311972488265281');" onmouseout="out('-5018311972488265281');" style="">  26 import org.apache.flink.client.program.ClusterClient;                                                    </span>
<span class="-304847577149896806" onmouseenter="enter('-304847577149896806');" onmouseout="out('-304847577149896806');" style="">  27 import org.apache.flink.configuration.ConfigConstants;                                                   </span>
<span class="-2145364053946109621" onmouseenter="enter('-2145364053946109621');" onmouseout="out('-2145364053946109621');" style="">  28 import org.apache.flink.client.program.rest.RestClusterClient;                                           </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  29 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="-5961957399886376486" onmouseenter="enter('-5961957399886376486');" onmouseout="out('-5961957399886376486');" style="">  30 import org.apache.flink.configuration.GlobalConfiguration;                                               </span>
<span class="-6310495642702641788" onmouseenter="enter('-6310495642702641788');" onmouseout="out('-6310495642702641788');" style="">  31 import org.apache.flink.configuration.JobManagerOptions;                                                 </span>
<span class="8609901781044162488" onmouseenter="enter('8609901781044162488');" onmouseout="out('8609901781044162488');" style="">  32 import org.apache.flink.core.fs.FileSystem;                                                              </span>
<span class="-2586613049287592313" onmouseenter="enter('-2586613049287592313');" onmouseout="out('-2586613049287592313');" style="">  33 import org.apache.flink.runtime.akka.AkkaUtils;                                                          </span>
<span class="2463804193477214615" onmouseenter="enter('2463804193477214615');" onmouseout="out('2463804193477214615');" style="">  34 import org.apache.flink.runtime.util.LeaderConnectionInfo;                                               </span>
<span class="2707853699459523291" onmouseenter="enter('2707853699459523291');" onmouseout="out('2707853699459523291');" style="">  35 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;                                              </span>
<span class="8677815094093511563" onmouseenter="enter('8677815094093511563');" onmouseout="out('8677815094093511563');" style="">  36 import org.apache.flink.yarn.YarnClusterDescriptor;                                                      </span>
<span class="8458556742018191597" onmouseenter="enter('8458556742018191597');" onmouseout="out('8458556742018191597');" style="">  37 import org.apache.hadoop.yarn.api.records.ApplicationId;                                                 </span>
<span class="4889670150256338446" onmouseenter="enter('4889670150256338446');" onmouseout="out('4889670150256338446');" style="">  38 import org.apache.hadoop.yarn.api.records.ApplicationReport;                                             </span>
<span class="-8519056337267772623" onmouseenter="enter('-8519056337267772623');" onmouseout="out('-8519056337267772623');" style="">  39 import org.apache.hadoop.yarn.api.records.YarnApplicationState;                                          </span>
<span class="-6331858862509679410" onmouseenter="enter('-6331858862509679410');" onmouseout="out('-6331858862509679410');" style="">  40 import org.apache.hadoop.yarn.client.api.YarnClient;                                                     </span>
<span class="-5883054148134480566" onmouseenter="enter('-5883054148134480566');" onmouseout="out('-5883054148134480566');" style="">  41 import org.apache.hadoop.yarn.conf.YarnConfiguration;                                                    </span>
<span class="-7343793280970510192" onmouseenter="enter('-7343793280970510192');" onmouseout="out('-7343793280970510192');" style="">  42 import org.apache.hadoop.yarn.util.StringHelper;                                                         </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  43 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  44 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  45                                                                                                          </span>
<span class="-5372229354663550968" onmouseenter="enter('-5372229354663550968');" onmouseout="out('-5372229354663550968');" style="">  46 import java.net.InetSocketAddress;                                                                       </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="">  47 import java.net.URLDecoder;                                                                              </span>
<span class="708245193883173442" onmouseenter="enter('708245193883173442');" onmouseout="out('708245193883173442');" style="">  48 import java.util.EnumSet;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  49 import java.util.HashSet;                                                                                </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  50 import java.util.Set;                                                                                    </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  51 import java.util.List;                                                                                   </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  52 import java.util.Properties;                                                                             </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  53 import java.util.Iterator;                                                                               </span>
<span  style="">  54                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55 /**                                                                                                      </span>
<span class="-3971691924018094169" onmouseenter="enter('-3971691924018094169');" onmouseout="out('-3971691924018094169');" style="">  56  * @author sishu.yss                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  57  */                                                                                                      </span>
<span class="2987681938130092722" onmouseenter="enter('2987681938130092722');" onmouseout="out('2987681938130092722');" style="">  58 public class ClusterClientFactory {                                                                      </span>
<span  style="">  59                                                                                                          </span>
<span class="158955771696974218" onmouseenter="enter('158955771696974218');" onmouseout="out('158955771696974218');" style="">  60     private static final Logger LOG = LoggerFactory.getLogger(ClusterClientFactory.class);               </span>
<span  style="">  61                                                                                                          </span>
<span class="-814536110407258758" onmouseenter="enter('-814536110407258758');" onmouseout="out('-814536110407258758');" style="">  62     private static final String HA_CLUSTER_ID = &quot;high-availability.cluster-id&quot;;                          </span>
<span  style="">  63                                                                                                          </span>
<span class="-5284483266258366119" onmouseenter="enter('-5284483266258366119');" onmouseout="out('-5284483266258366119');" style="">  64     private static final String HIGH_AVAILABILITY = &quot;high-availability&quot;;                                 </span>
<span  style="">  65                                                                                                          </span>
<span class="6046766839872255303" onmouseenter="enter('6046766839872255303');" onmouseout="out('6046766839872255303');" style="">  66     private static final String NODE = &quot;NONE&quot;;                                                           </span>
<span  style="">  67                                                                                                          </span>
<span class="5793523754398446120" onmouseenter="enter('5793523754398446120');" onmouseout="out('5793523754398446120');" style="">  68     private static final String ZOOKEEPER = &quot;zookeeper&quot;;                                                 </span>
<span  style="">  69                                                                                                          </span>
<span class="-5534687535083206001" onmouseenter="enter('-5534687535083206001');" onmouseout="out('-5534687535083206001');" style="">  70     private static final String HADOOP_CONF = &quot;fs.hdfs.hadoopconf&quot;;                                      </span>
<span  style="">  71                                                                                                          </span>
<span class="9096170393674332782" onmouseenter="enter('9096170393674332782');" onmouseout="out('9096170393674332782');" style="">  72     public static ClusterClient createClusterClient(Options launcherOptions) throws Exception {          </span>
<span class="1580619527178340568" onmouseenter="enter('1580619527178340568');" onmouseout="out('1580619527178340568');" style="">  73         String mode = launcherOptions.getMode();                                                         </span>
<span class="3152003248099615816" onmouseenter="enter('3152003248099615816');" onmouseout="out('3152003248099615816');" style="">  74         if (mode.equals(ClusterMode.standalone.name())) {                                                </span>
<span class="-2673317197223310055" onmouseenter="enter('-2673317197223310055');" onmouseout="out('-2673317197223310055');" style="">  75             return createStandaloneClient(launcherOptions);                                              </span>
<span class="6048008447776154150" onmouseenter="enter('6048008447776154150');" onmouseout="out('6048008447776154150');" style="">  76         } else if (mode.equals(ClusterMode.yarn.name())) {                                               </span>
<span class="-7696015566091056231" onmouseenter="enter('-7696015566091056231');" onmouseout="out('-7696015566091056231');" style="">  77             return createYarnSessionClient(launcherOptions);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78         }                                                                                                </span>
<span class="-1110182490908431808" onmouseenter="enter('-1110182490908431808');" onmouseout="out('-1110182490908431808');" style="">  79         throw new IllegalArgumentException(&quot;Unsupported cluster client type: &quot;);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  80     }                                                                                                    </span>
<span  style="">  81                                                                                                          </span>
<span class="-802191291303526610" onmouseenter="enter('-802191291303526610');" onmouseout="out('-802191291303526610');" style="">  82     public static ClusterClient createStandaloneClient(Options launcherOptions) throws Exception {       </span>
<span class="1761492070997118793" onmouseenter="enter('1761492070997118793');" onmouseout="out('1761492070997118793');" style="">  83         String flinkConfDir = launcherOptions.getFlinkconf();                                            </span>
<span class="7816329497793558634" onmouseenter="enter('7816329497793558634');" onmouseout="out('7816329497793558634');" style="">  84         Configuration config = GlobalConfiguration.loadConfiguration(flinkConfDir);                      </span>
<span  style="">  85                                                                                                          </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style="">  86         LOG.info(&quot;------------config params-------------------------&quot;);                                  </span>
<span class="-1891084833916369881" onmouseenter="enter('-1891084833916369881');" onmouseout="out('-1891084833916369881');" style="">  87         config.toMap().forEach((key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                          </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style="">  88         LOG.info(&quot;-------------------------------------------&quot;);                                         </span>
<span  style="">  89                                                                                                          </span>
<span class="-2718724998192346216" onmouseenter="enter('-2718724998192346216');" onmouseout="out('-2718724998192346216');" style="">  90         RestClusterClient clusterClient = new RestClusterClient&lt;&gt;(config, &quot;clusterClient&quot;);              </span>
<span class="5460388504045041514" onmouseenter="enter('5460388504045041514');" onmouseout="out('5460388504045041514');" style="">  91         LeaderConnectionInfo connectionInfo = clusterClient.getClusterConnectionInfo();                  </span>
<span class="5152489928806645392" onmouseenter="enter('5152489928806645392');" onmouseout="out('5152489928806645392');" style=""><abbr title="  92         InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());">  92         InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress()ðŸ”µ</abbr></span>
<span class="6829588547509854341" onmouseenter="enter('6829588547509854341');" onmouseout="out('6829588547509854341');" style="">  93         config.setString(JobManagerOptions.ADDRESS, address.getAddress().getHostName());                 </span>
<span class="9134688451588203149" onmouseenter="enter('9134688451588203149');" onmouseout="out('9134688451588203149');" style="">  94         config.setInteger(JobManagerOptions.PORT, address.getPort());                                    </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style="">  95         clusterClient.setDetached(true);                                                                 </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style="">  96         return clusterClient;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97     }                                                                                                    </span>
<span  style="">  98                                                                                                          </span>
<span class="-6427714043144307769" onmouseenter="enter('-6427714043144307769');" onmouseout="out('-6427714043144307769');" style="">  99     public static ClusterClient createYarnSessionClient(Options launcherOptions) {                       </span>
<span class="-1817028274787323640" onmouseenter="enter('-1817028274787323640');" onmouseout="out('-1817028274787323640');" style=""><abbr title=" 100         String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.getFlinkconf();"> 100         String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.ðŸ”µ</abbr></span>
<span class="4635921604956969650" onmouseenter="enter('4635921604956969650');" onmouseout="out('4635921604956969650');" style=""><abbr title=" 101         Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguration.loadConfiguration(flinkConfDir);"> 101         Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguratðŸ”µ</abbr></span>
<span class="5386610166888514231" onmouseenter="enter('5386610166888514231');" onmouseout="out('5386610166888514231');" style=""> 102         String yarnConfDir = launcherOptions.getYarnconf();                                              </span>
<span  style=""> 103                                                                                                          </span>
<span class="5688737160066801667" onmouseenter="enter('5688737160066801667');" onmouseout="out('5688737160066801667');" style=""> 104         if (StringUtils.isNotBlank(yarnConfDir)) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 105             try {                                                                                        </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 106 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-2564123571596243167" onmouseenter="enter('-2564123571596243167');" onmouseout="out('-2564123571596243167');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107                 config.setString(ConfigConstants.PATH_HADOOP_CONFIG, yarnConfDir);                       </span>
<span class="-3370155354983794031" onmouseenter="enter('-3370155354983794031');" onmouseout="out('-3370155354983794031');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108                 FileSystem.initialize(config, null);                                                     </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 109 ||||||| BASE                                                                                             </span>
<span class="819462190439601526" onmouseenter="enter('819462190439601526');" onmouseout="out('819462190439601526');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110                 config.setString(&quot;fs.hdfs.hadoopconf&quot;, yarnConfDir);                                     </span>
<span class="9044151009829571497" onmouseenter="enter('9044151009829571497');" onmouseout="out('9044151009829571497');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111                 FileSystem.initialize(config);                                                           </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112                                                                                                          </span>
<span class="-8309544538696184279" onmouseenter="enter('-8309544538696184279');" onmouseout="out('-8309544538696184279');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113                 YarnConfiguration yarnConf = YarnConfLoader.getYarnConf(yarnConfDir);                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 114 =======                                                                                                  </span>
<span class="-4375817209366726298" onmouseenter="enter('-4375817209366726298');" onmouseout="out('-4375817209366726298');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115                 boolean isHighAvailability;                                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116                                                                                                          </span>
<span class="-5377933620241534990" onmouseenter="enter('-5377933620241534990');" onmouseout="out('-5377933620241534990');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117                 config.setString(HADOOP_CONF, yarnConfDir);                                              </span>
<span class="9044151009829571497" onmouseenter="enter('9044151009829571497');" onmouseout="out('9044151009829571497');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118                 FileSystem.initialize(config);                                                           </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 119 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 120                                                                                                          </span>
<span class="-8309544538696184279" onmouseenter="enter('-8309544538696184279');" onmouseout="out('-8309544538696184279');" style=""> 121                 YarnConfiguration yarnConf = YarnConfLoader.getYarnConf(yarnConfDir);                    </span>
<span class="-4294518192733428025" onmouseenter="enter('-4294518192733428025');" onmouseout="out('-4294518192733428025');" style=""> 122                 YarnClient yarnClient = YarnClient.createYarnClient();                                   </span>
<span class="5472274627169264043" onmouseenter="enter('5472274627169264043');" onmouseout="out('5472274627169264043');" style=""> 123                 yarnClient.init(yarnConf);                                                               </span>
<span class="6599374713362233892" onmouseenter="enter('6599374713362233892');" onmouseout="out('6599374713362233892');" style=""> 124                 yarnClient.start();                                                                      </span>
<span class="-8174546465611380821" onmouseenter="enter('-8174546465611380821');" onmouseout="out('-8174546465611380821');" style=""> 125                 ApplicationId applicationId;                                                             </span>
<span  style=""> 126                                                                                                          </span>
<span class="-9176432362536668352" onmouseenter="enter('-9176432362536668352');" onmouseout="out('-9176432362536668352');" style=""> 127                 String yarnSessionConf = launcherOptions.getYarnSessionConf();                           </span>
<span class="-127694460867817418" onmouseenter="enter('-127694460867817418');" onmouseout="out('-127694460867817418');" style=""> 128                 yarnSessionConf = URLDecoder.decode(yarnSessionConf, Charsets.UTF_8.toString());         </span>
<span class="-859984515838945264" onmouseenter="enter('-859984515838945264');" onmouseout="out('-859984515838945264');" style=""><abbr title=" 129                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.class);"> 129                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, ProperðŸ”µ</abbr></span>
<span  style=""> 130                                                                                                          </span>
<span class="8863382991069320815" onmouseenter="enter('8863382991069320815');" onmouseout="out('8863382991069320815');" style=""> 131                 Object yid = yarnSessionConfProperties.get(&quot;yid&quot;);                                       </span>
<span  style=""> 132                                                                                                          </span>
<span class="-8848781777370597992" onmouseenter="enter('-8848781777370597992');" onmouseout="out('-8848781777370597992');" style=""> 133                 if (null != yid) {                                                                       </span>
<span class="-6322388926542920640" onmouseenter="enter('-6322388926542920640');" onmouseout="out('-6322388926542920640');" style=""> 134                     applicationId = toApplicationId(yid.toString());                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 135                 } else {                                                                                 </span>
<span class="-1125803419217936962" onmouseenter="enter('-1125803419217936962');" onmouseout="out('-1125803419217936962');" style=""> 136                     applicationId = getYarnClusterApplicationId(yarnClient);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137                 }                                                                                        </span>
<span  style=""> 138                                                                                                          </span>
<span class="2782241111845053045" onmouseenter="enter('2782241111845053045');" onmouseout="out('2782241111845053045');" style=""> 139                 LOG.info(&quot;current applicationId = {}&quot;, applicationId.toString());                        </span>
<span  style=""> 140                                                                                                          </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style=""> 141                 if (StringUtils.isEmpty(applicationId.toString())) {                                     </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 142                     throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                 }                                                                                        </span>
<span  style=""> 144                                                                                                          </span>
<span class="531036869131629996" onmouseenter="enter('531036869131629996');" onmouseout="out('531036869131629996');" style=""> 145                 isHighAvailability = config.getString(HIGH_AVAILABILITY, NODE).equals(ZOOKEEPER);        </span>
<span  style=""> 146                                                                                                          </span>
<span class="-4042001981978397381" onmouseenter="enter('-4042001981978397381');" onmouseout="out('-4042001981978397381');" style=""> 147                 if (isHighAvailability &amp;&amp; config.getString(HA_CLUSTER_ID, null) == null) {               </span>
<span class="1242336459937762287" onmouseenter="enter('1242336459937762287');" onmouseout="out('1242336459937762287');" style=""> 148                     config.setString(HA_CLUSTER_ID, applicationId.toString());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149                 }                                                                                        </span>
<span  style=""> 150                                                                                                          </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style=""> 151                 LOG.info(&quot;------------config params-------------------------&quot;);                          </span>
<span class="-1891084833916369881" onmouseenter="enter('-1891084833916369881');" onmouseout="out('-1891084833916369881');" style=""> 152                 config.toMap().forEach((key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                  </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style=""> 153                 LOG.info(&quot;-------------------------------------------&quot;);                                 </span>
<span  style=""> 154                                                                                                          </span>
<span class="-6816091760091632163" onmouseenter="enter('-6816091760091632163');" onmouseout="out('-6816091760091632163');" style=""><abbr title=" 155                 AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinkConfDir, yarnClient, false);"> 155                 AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnCðŸ”µ</abbr></span>
<span class="7284485832444382760" onmouseenter="enter('7284485832444382760');" onmouseout="out('7284485832444382760');" style=""> 156                 ClusterClient clusterClient = clusterDescriptor.retrieve(applicationId);                 </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 157                 clusterClient.setDetached(true);                                                         </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 158                 return clusterClient;                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 159             } catch (Exception e) {                                                                      </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 160                 throw new RuntimeException(e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161             }                                                                                            </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 162         }else{                                                                                           </span>
<span class="-818626197127626055" onmouseenter="enter('-818626197127626055');" onmouseout="out('-818626197127626055');" style=""> 163             throw new RuntimeException(&quot;yarn mode must set param of &#x27;yarnconf&#x27;!!!&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165     }                                                                                                    </span>
<span  style=""> 166                                                                                                          </span>
<span  style=""> 167                                                                                                          </span>
<span class="4520585383857802787" onmouseenter="enter('4520585383857802787');" onmouseout="out('4520585383857802787');" style=""> 168     private static ApplicationId getYarnClusterApplicationId(YarnClient yarnClient) throws Exception {   </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style=""> 169         ApplicationId applicationId = null;                                                              </span>
<span  style=""> 170                                                                                                          </span>
<span class="-8169037907797863140" onmouseenter="enter('-8169037907797863140');" onmouseout="out('-8169037907797863140');" style=""> 171         Set&lt;String&gt; set = new HashSet&lt;&gt;();                                                               </span>
<span class="1611340247917691443" onmouseenter="enter('1611340247917691443');" onmouseout="out('1611340247917691443');" style=""> 172         set.add(&quot;Apache Flink&quot;);                                                                         </span>
<span class="5540355505413622998" onmouseenter="enter('5540355505413622998');" onmouseout="out('5540355505413622998');" style=""> 173         EnumSet&lt;YarnApplicationState&gt; enumSet = EnumSet.noneOf(YarnApplicationState.class);              </span>
<span class="4582984779835017200" onmouseenter="enter('4582984779835017200');" onmouseout="out('4582984779835017200');" style=""> 174         enumSet.add(YarnApplicationState.RUNNING);                                                       </span>
<span class="1830734000385452214" onmouseenter="enter('1830734000385452214');" onmouseout="out('1830734000385452214');" style=""> 175         List&lt;ApplicationReport&gt; reportList = yarnClient.getApplications(set, enumSet);                   </span>
<span  style=""> 176                                                                                                          </span>
<span class="-369447775955784899" onmouseenter="enter('-369447775955784899');" onmouseout="out('-369447775955784899');" style=""> 177         int maxMemory = -1;                                                                              </span>
<span class="-4846585872764251675" onmouseenter="enter('-4846585872764251675');" onmouseout="out('-4846585872764251675');" style=""> 178         int maxCores = -1;                                                                               </span>
<span class="6886164409438478920" onmouseenter="enter('6886164409438478920');" onmouseout="out('6886164409438478920');" style=""> 179         for (ApplicationReport report : reportList) {                                                    </span>
<span class="-424772390849256809" onmouseenter="enter('-424772390849256809');" onmouseout="out('-424772390849256809');" style=""> 180             if (!report.getName().startsWith(&quot;Flink session&quot;)) {                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 181                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182             }                                                                                            </span>
<span  style=""> 183                                                                                                          </span>
<span class="1235099662322490241" onmouseenter="enter('1235099662322490241');" onmouseout="out('1235099662322490241');" style=""> 184             if (!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) {                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 185                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186             }                                                                                            </span>
<span  style=""> 187                                                                                                          </span>
<span class="4956299878435728516" onmouseenter="enter('4956299878435728516');" onmouseout="out('4956299878435728516');" style=""> 188             int thisMemory = report.getApplicationResourceUsageReport().getNeededResources().getMemory();</span>
<span class="-1408027150422172031" onmouseenter="enter('-1408027150422172031');" onmouseout="out('-1408027150422172031');" style=""><abbr title=" 189             int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();"> 189             int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCorðŸ”µ</abbr></span>
<span class="5717156388718347421" onmouseenter="enter('5717156388718347421');" onmouseout="out('5717156388718347421');" style=""> 190             if (thisMemory &gt; maxMemory || thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) {             </span>
<span class="393893018308938162" onmouseenter="enter('393893018308938162');" onmouseout="out('393893018308938162');" style=""> 191                 maxMemory = thisMemory;                                                                  </span>
<span class="-6641939115520661476" onmouseenter="enter('-6641939115520661476');" onmouseout="out('-6641939115520661476');" style=""> 192                 maxCores = thisCores;                                                                    </span>
<span class="-2782692697137135125" onmouseenter="enter('-2782692697137135125');" onmouseout="out('-2782692697137135125');" style=""> 193                 applicationId = report.getApplicationId();                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194             }                                                                                            </span>
<span  style=""> 195                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196         }                                                                                                </span>
<span  style=""> 197                                                                                                          </span>
<span class="8874933916351401024" onmouseenter="enter('8874933916351401024');" onmouseout="out('8874933916351401024');" style=""> 198         if (applicationId == null || StringUtils.isEmpty(applicationId.toString())) {                    </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 199             throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200         }                                                                                                </span>
<span class="5985572316486027976" onmouseenter="enter('5985572316486027976');" onmouseout="out('5985572316486027976');" style=""> 201         return applicationId;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202     }                                                                                                    </span>
<span  style=""> 203                                                                                                          </span>
<span class="-4507162632467603669" onmouseenter="enter('-4507162632467603669');" onmouseout="out('-4507162632467603669');" style=""> 204     private static ApplicationId toApplicationId(String appIdStr) {                                      </span>
<span class="4229427001454084170" onmouseenter="enter('4229427001454084170');" onmouseout="out('4229427001454084170');" style=""> 205         Iterator&lt;String&gt; it = StringHelper._split(appIdStr).iterator();                                  </span>
<span class="5406390625905078860" onmouseenter="enter('5406390625905078860');" onmouseout="out('5406390625905078860');" style=""> 206         if (!&quot;application&quot;.equals(it.next())) {                                                          </span>
<span class="8668152551389785899" onmouseenter="enter('8668152551389785899');" onmouseout="out('8668152551389785899');" style=""><abbr title=" 207             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicationId should start with prefix &quot; + &quot;application&quot;);"> 207             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The validðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 208         } else {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 209             try {                                                                                        </span>
<span class="7789939610237528981" onmouseenter="enter('7789939610237528981');" onmouseout="out('7789939610237528981');" style=""> 210                 return toApplicationId(it);                                                              </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 211             } catch (NumberFormatException e) {                                                          </span>
<span class="1796865554742970225" onmouseenter="enter('1796865554742970225');" onmouseout="out('1796865554742970225');" style=""> 212                 throw new IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; + appIdStr, e);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215     }                                                                                                    </span>
<span  style=""> 216                                                                                                          </span>
<span class="1367086786860425516" onmouseenter="enter('1367086786860425516');" onmouseout="out('1367086786860425516');" style=""> 217     private static ApplicationId toApplicationId(Iterator&lt;String&gt; it) throws NumberFormatException {     </span>
<span class="-2928988115653544018" onmouseenter="enter('-2928988115653544018');" onmouseout="out('-2928988115653544018');" style=""> 218         return ApplicationId.newInstance(Long.parseLong(it.next()), Integer.parseInt(it.next()));        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219     }                                                                                                    </span>
<span  style=""> 220                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221 }                                                                                                        </span>


















</pre></td>
                            <td><pre><span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">   1 /**                                                                                                      </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">   9  * &lt;p&gt;                                                                                                   </span>
<span class="3430964305904514764" onmouseenter="enter('3430964305904514764');" onmouseout="out('3430964305904514764');" style="">  10  * http://www.apache.org/licenses/LICENSE-2.0                                                            </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="">  11  * &lt;p&gt;                                                                                                   </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-4666348732459622550" onmouseenter="enter('-4666348732459622550');" onmouseout="out('-4666348732459622550');" style="">  18 package com.dtstack.flink.sql.launcher;                                                                  </span>
<span  style="">  19                                                                                                          </span>
<span class="4163183244871785745" onmouseenter="enter('4163183244871785745');" onmouseout="out('4163183244871785745');" style="">  20 import com.dtstack.flink.sql.enums.ClusterMode;                                                          </span>
<span class="6579778626253321963" onmouseenter="enter('6579778626253321963');" onmouseout="out('6579778626253321963');" style="">  21 import com.dtstack.flink.sql.option.Options;                                                             </span>
<span class="-3389130316234486348" onmouseenter="enter('-3389130316234486348');" onmouseout="out('-3389130316234486348');" style="">  22 import com.dtstack.flink.sql.util.PluginUtil;                                                            </span>
<span class="-5372229354663550968" onmouseenter="enter('-5372229354663550968');" onmouseout="out('-5372229354663550968');" style="">  23 import java.net.InetSocketAddress;                                                                       </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="">  24 import java.net.URLDecoder;                                                                              </span>
<span class="708245193883173442" onmouseenter="enter('708245193883173442');" onmouseout="out('708245193883173442');" style="">  25 import java.util.EnumSet;                                                                                </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  26 import java.util.HashSet;                                                                                </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  27 import java.util.Iterator;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  28 import java.util.List;                                                                                   </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  29 import java.util.Properties;                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  30 import java.util.Set;                                                                                    </span>
<span class="-8922236357512993475" onmouseenter="enter('-8922236357512993475');" onmouseout="out('-8922236357512993475');" style="">  31 import org.apache.commons.io.Charsets;                                                                   </span>
<span class="7952073036463698968" onmouseenter="enter('7952073036463698968');" onmouseout="out('7952073036463698968');" style="">  32 import org.apache.commons.lang.StringUtils;                                                              </span>
<span class="-5018311972488265281" onmouseenter="enter('-5018311972488265281');" onmouseout="out('-5018311972488265281');" style="">  33 import org.apache.flink.client.program.ClusterClient;                                                    </span>
<span class="-2145364053946109621" onmouseenter="enter('-2145364053946109621');" onmouseout="out('-2145364053946109621');" style="">  34 import org.apache.flink.client.program.rest.RestClusterClient;                                           </span>
<span class="-304847577149896806" onmouseenter="enter('-304847577149896806');" onmouseout="out('-304847577149896806');" style="">  35 import org.apache.flink.configuration.ConfigConstants;                                                   </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  36 import org.apache.flink.configuration.Configuration;                                                     </span>
<span class="-5961957399886376486" onmouseenter="enter('-5961957399886376486');" onmouseout="out('-5961957399886376486');" style="">  37 import org.apache.flink.configuration.GlobalConfiguration;                                               </span>
<span class="-6310495642702641788" onmouseenter="enter('-6310495642702641788');" onmouseout="out('-6310495642702641788');" style="">  38 import org.apache.flink.configuration.JobManagerOptions;                                                 </span>
<span class="8609901781044162488" onmouseenter="enter('8609901781044162488');" onmouseout="out('8609901781044162488');" style="">  39 import org.apache.flink.core.fs.FileSystem;                                                              </span>
<span class="-2586613049287592313" onmouseenter="enter('-2586613049287592313');" onmouseout="out('-2586613049287592313');" style="">  40 import org.apache.flink.runtime.akka.AkkaUtils;                                                          </span>
<span class="2463804193477214615" onmouseenter="enter('2463804193477214615');" onmouseout="out('2463804193477214615');" style="">  41 import org.apache.flink.runtime.util.LeaderConnectionInfo;                                               </span>
<span class="2707853699459523291" onmouseenter="enter('2707853699459523291');" onmouseout="out('2707853699459523291');" style="">  42 import org.apache.flink.yarn.AbstractYarnClusterDescriptor;                                              </span>
<span class="8677815094093511563" onmouseenter="enter('8677815094093511563');" onmouseout="out('8677815094093511563');" style="">  43 import org.apache.flink.yarn.YarnClusterDescriptor;                                                      </span>
<span class="8458556742018191597" onmouseenter="enter('8458556742018191597');" onmouseout="out('8458556742018191597');" style="">  44 import org.apache.hadoop.yarn.api.records.ApplicationId;                                                 </span>
<span class="4889670150256338446" onmouseenter="enter('4889670150256338446');" onmouseout="out('4889670150256338446');" style="">  45 import org.apache.hadoop.yarn.api.records.ApplicationReport;                                             </span>
<span class="-8519056337267772623" onmouseenter="enter('-8519056337267772623');" onmouseout="out('-8519056337267772623');" style="">  46 import org.apache.hadoop.yarn.api.records.YarnApplicationState;                                          </span>
<span class="-6331858862509679410" onmouseenter="enter('-6331858862509679410');" onmouseout="out('-6331858862509679410');" style="">  47 import org.apache.hadoop.yarn.client.api.YarnClient;                                                     </span>
<span class="-5883054148134480566" onmouseenter="enter('-5883054148134480566');" onmouseout="out('-5883054148134480566');" style="">  48 import org.apache.hadoop.yarn.conf.YarnConfiguration;                                                    </span>
<span class="-7343793280970510192" onmouseenter="enter('-7343793280970510192');" onmouseout="out('-7343793280970510192');" style="">  49 import org.apache.hadoop.yarn.util.StringHelper;                                                         </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  50 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  51 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  52                                                                                                          </span>
<span  style="">  53                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  54 /**                                                                                                      </span>
<span class="-3971691924018094169" onmouseenter="enter('-3971691924018094169');" onmouseout="out('-3971691924018094169');" style="">  55  * @author sishu.yss                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  56  */                                                                                                      </span>
<span class="2987681938130092722" onmouseenter="enter('2987681938130092722');" onmouseout="out('2987681938130092722');" style="">  57 public class ClusterClientFactory {                                                                      </span>
<span class="158955771696974218" onmouseenter="enter('158955771696974218');" onmouseout="out('158955771696974218');" style="">  58     private static final Logger LOG = LoggerFactory.getLogger(ClusterClientFactory.class);               </span>
<span  style="">  59                                                                                                          </span>
<span class="-814536110407258758" onmouseenter="enter('-814536110407258758');" onmouseout="out('-814536110407258758');" style="">  60     private static final String HA_CLUSTER_ID = &quot;high-availability.cluster-id&quot;;                          </span>
<span  style="">  61                                                                                                          </span>
<span class="-5284483266258366119" onmouseenter="enter('-5284483266258366119');" onmouseout="out('-5284483266258366119');" style="">  62     private static final String HIGH_AVAILABILITY = &quot;high-availability&quot;;                                 </span>
<span  style="">  63                                                                                                          </span>
<span class="6046766839872255303" onmouseenter="enter('6046766839872255303');" onmouseout="out('6046766839872255303');" style="">  64     private static final String NODE = &quot;NONE&quot;;                                                           </span>
<span  style="">  65                                                                                                          </span>
<span class="5793523754398446120" onmouseenter="enter('5793523754398446120');" onmouseout="out('5793523754398446120');" style="">  66     private static final String ZOOKEEPER = &quot;zookeeper&quot;;                                                 </span>
<span  style="">  67                                                                                                          </span>
<span class="-5534687535083206001" onmouseenter="enter('-5534687535083206001');" onmouseout="out('-5534687535083206001');" style="">  68     private static final String HADOOP_CONF = &quot;fs.hdfs.hadoopconf&quot;;                                      </span>
<span  style="">  69                                                                                                          </span>
<span class="9096170393674332782" onmouseenter="enter('9096170393674332782');" onmouseout="out('9096170393674332782');" style="">  70     public static ClusterClient createClusterClient(Options launcherOptions) throws Exception {          </span>
<span class="1580619527178340568" onmouseenter="enter('1580619527178340568');" onmouseout="out('1580619527178340568');" style="">  71         String mode = launcherOptions.getMode();                                                         </span>
<span class="3152003248099615816" onmouseenter="enter('3152003248099615816');" onmouseout="out('3152003248099615816');" style="">  72         if (mode.equals(ClusterMode.standalone.name())) {                                                </span>
<span class="-2673317197223310055" onmouseenter="enter('-2673317197223310055');" onmouseout="out('-2673317197223310055');" style="">  73             return createStandaloneClient(launcherOptions);                                              </span>
<span class="6048008447776154150" onmouseenter="enter('6048008447776154150');" onmouseout="out('6048008447776154150');" style="">  74         } else if (mode.equals(ClusterMode.yarn.name())) {                                               </span>
<span class="-7696015566091056231" onmouseenter="enter('-7696015566091056231');" onmouseout="out('-7696015566091056231');" style="">  75             return createYarnSessionClient(launcherOptions);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76         }                                                                                                </span>
<span class="-1110182490908431808" onmouseenter="enter('-1110182490908431808');" onmouseout="out('-1110182490908431808');" style="">  77         throw new IllegalArgumentException(&quot;Unsupported cluster client type: &quot;);                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78     }                                                                                                    </span>
<span  style="">  79                                                                                                          </span>
<span class="-802191291303526610" onmouseenter="enter('-802191291303526610');" onmouseout="out('-802191291303526610');" style="">  80     public static ClusterClient createStandaloneClient(Options launcherOptions) throws Exception {       </span>
<span class="1761492070997118793" onmouseenter="enter('1761492070997118793');" onmouseout="out('1761492070997118793');" style="">  81         String flinkConfDir = launcherOptions.getFlinkconf();                                            </span>
<span class="7816329497793558634" onmouseenter="enter('7816329497793558634');" onmouseout="out('7816329497793558634');" style="">  82         Configuration config = GlobalConfiguration.loadConfiguration(flinkConfDir);                      </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style="">  83         LOG.info(&quot;------------config params-------------------------&quot;);                                  </span>
<span class="2566798585666021691" onmouseenter="enter('2566798585666021691');" onmouseout="out('2566798585666021691');" style="">  84         config.toMap().forEach(( key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                         </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style="">  85         LOG.info(&quot;-------------------------------------------&quot;);                                         </span>
<span class="-2718724998192346216" onmouseenter="enter('-2718724998192346216');" onmouseout="out('-2718724998192346216');" style="">  86         RestClusterClient clusterClient = new RestClusterClient&lt;&gt;(config, &quot;clusterClient&quot;);              </span>
<span class="5460388504045041514" onmouseenter="enter('5460388504045041514');" onmouseout="out('5460388504045041514');" style="">  87         LeaderConnectionInfo connectionInfo = clusterClient.getClusterConnectionInfo();                  </span>
<span class="5152489928806645392" onmouseenter="enter('5152489928806645392');" onmouseout="out('5152489928806645392');" style=""><abbr title="  88         InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());">  88         InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress()ðŸ”µ</abbr></span>
<span class="6829588547509854341" onmouseenter="enter('6829588547509854341');" onmouseout="out('6829588547509854341');" style="">  89         config.setString(JobManagerOptions.ADDRESS, address.getAddress().getHostName());                 </span>
<span class="9134688451588203149" onmouseenter="enter('9134688451588203149');" onmouseout="out('9134688451588203149');" style="">  90         config.setInteger(JobManagerOptions.PORT, address.getPort());                                    </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style="">  91         clusterClient.setDetached(true);                                                                 </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style="">  92         return clusterClient;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93     }                                                                                                    </span>
<span  style="">  94                                                                                                          </span>
<span class="-6427714043144307769" onmouseenter="enter('-6427714043144307769');" onmouseout="out('-6427714043144307769');" style="">  95     public static ClusterClient createYarnSessionClient(Options launcherOptions) {                       </span>
<span class="8205855452126997644" onmouseenter="enter('8205855452126997644');" onmouseout="out('8205855452126997644');" style=""><abbr title="  96         String flinkConfDir = (StringUtils.isEmpty(launcherOptions.getFlinkconf())) ? &quot;&quot; : launcherOptions.getFlinkconf();">  96         String flinkConfDir = (StringUtils.isEmpty(launcherOptions.getFlinkconf())) ? &quot;&quot; : launcherOptionðŸ”µ</abbr></span>
<span class="1888923838990140221" onmouseenter="enter('1888923838990140221');" onmouseout="out('1888923838990140221');" style=""><abbr title="  97         Configuration config = (StringUtils.isEmpty(flinkConfDir)) ? new Configuration() : GlobalConfiguration.loadConfiguration(flinkConfDir);">  97         Configuration config = (StringUtils.isEmpty(flinkConfDir)) ? new Configuration() : GlobalConfigurðŸ”µ</abbr></span>
<span class="5386610166888514231" onmouseenter="enter('5386610166888514231');" onmouseout="out('5386610166888514231');" style="">  98         String yarnConfDir = launcherOptions.getYarnconf();                                              </span>
<span class="5688737160066801667" onmouseenter="enter('5688737160066801667');" onmouseout="out('5688737160066801667');" style="">  99         if (StringUtils.isNotBlank(yarnConfDir)) {                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 100             try {                                                                                        </span>
<span class="-4375817209366726298" onmouseenter="enter('-4375817209366726298');" onmouseout="out('-4375817209366726298');" style=""> 101                 boolean isHighAvailability;                                                              </span>
<span class="-8092579005363239153" onmouseenter="enter('-8092579005363239153');" onmouseout="out('-8092579005363239153');" style=""> 102                 config.setString(                                                                        </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 103 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-5685340763206881354" onmouseenter="enter('-5685340763206881354');" onmouseout="out('-5685340763206881354');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104 ConfigConstants.PATH_HADOOP_CONFIG                                                                       </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 105 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 106 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 106 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 107 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108                                                                                                          </span>
<span class="-7698848785112244129" onmouseenter="enter('-7698848785112244129');" onmouseout="out('-7698848785112244129');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109 HADOOP_CONF                                                                                              </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 110 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-6698544523565823224" onmouseenter="enter('-6698544523565823224');" onmouseout="out('-6698544523565823224');" style=""> 111                 , yarnConfDir);                                                                          </span>
<span class="-3370155354983794031" onmouseenter="enter('-3370155354983794031');" onmouseout="out('-3370155354983794031');" style=""> 112                 FileSystem.initialize(config, null);                                                     </span>
<span class="-8309544538696184279" onmouseenter="enter('-8309544538696184279');" onmouseout="out('-8309544538696184279');" style=""> 113                 YarnConfiguration yarnConf = YarnConfLoader.getYarnConf(yarnConfDir);                    </span>
<span class="-4294518192733428025" onmouseenter="enter('-4294518192733428025');" onmouseout="out('-4294518192733428025');" style=""> 114                 YarnClient yarnClient = YarnClient.createYarnClient();                                   </span>
<span class="5472274627169264043" onmouseenter="enter('5472274627169264043');" onmouseout="out('5472274627169264043');" style=""> 115                 yarnClient.init(yarnConf);                                                               </span>
<span class="6599374713362233892" onmouseenter="enter('6599374713362233892');" onmouseout="out('6599374713362233892');" style=""> 116                 yarnClient.start();                                                                      </span>
<span class="-8174546465611380821" onmouseenter="enter('-8174546465611380821');" onmouseout="out('-8174546465611380821');" style=""> 117                 ApplicationId applicationId;                                                             </span>
<span class="-9176432362536668352" onmouseenter="enter('-9176432362536668352');" onmouseout="out('-9176432362536668352');" style=""> 118                 String yarnSessionConf = launcherOptions.getYarnSessionConf();                           </span>
<span class="-127694460867817418" onmouseenter="enter('-127694460867817418');" onmouseout="out('-127694460867817418');" style=""> 119                 yarnSessionConf = URLDecoder.decode(yarnSessionConf, Charsets.UTF_8.toString());         </span>
<span class="-859984515838945264" onmouseenter="enter('-859984515838945264');" onmouseout="out('-859984515838945264');" style=""><abbr title=" 120                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.class);"> 120                 Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, ProperðŸ”µ</abbr></span>
<span class="8863382991069320815" onmouseenter="enter('8863382991069320815');" onmouseout="out('8863382991069320815');" style=""> 121                 Object yid = yarnSessionConfProperties.get(&quot;yid&quot;);                                       </span>
<span class="-8848781777370597992" onmouseenter="enter('-8848781777370597992');" onmouseout="out('-8848781777370597992');" style=""> 122                 if (null != yid) {                                                                       </span>
<span class="-6322388926542920640" onmouseenter="enter('-6322388926542920640');" onmouseout="out('-6322388926542920640');" style=""> 123                     applicationId = toApplicationId(yid.toString());                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 124                 } else {                                                                                 </span>
<span class="-1125803419217936962" onmouseenter="enter('-1125803419217936962');" onmouseout="out('-1125803419217936962');" style=""> 125                     applicationId = getYarnClusterApplicationId(yarnClient);                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126                 }                                                                                        </span>
<span class="2782241111845053045" onmouseenter="enter('2782241111845053045');" onmouseout="out('2782241111845053045');" style=""> 127                 LOG.info(&quot;current applicationId = {}&quot;, applicationId.toString());                        </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style=""> 128                 if (StringUtils.isEmpty(applicationId.toString())) {                                     </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 129                     throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130                 }                                                                                        </span>
<span class="531036869131629996" onmouseenter="enter('531036869131629996');" onmouseout="out('531036869131629996');" style=""> 131                 isHighAvailability = config.getString(HIGH_AVAILABILITY, NODE).equals(ZOOKEEPER);        </span>
<span class="738415864731919607" onmouseenter="enter('738415864731919607');" onmouseout="out('738415864731919607');" style=""> 132                 if (isHighAvailability &amp;&amp; (config.getString(HA_CLUSTER_ID, null) == null)) {             </span>
<span class="1242336459937762287" onmouseenter="enter('1242336459937762287');" onmouseout="out('1242336459937762287');" style=""> 133                     config.setString(HA_CLUSTER_ID, applicationId.toString());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134                 }                                                                                        </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style=""> 135                 LOG.info(&quot;------------config params-------------------------&quot;);                          </span>
<span class="2566798585666021691" onmouseenter="enter('2566798585666021691');" onmouseout="out('2566798585666021691');" style=""> 136                 config.toMap().forEach(( key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                 </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style=""> 137                 LOG.info(&quot;-------------------------------------------&quot;);                                 </span>
<span class="-6816091760091632163" onmouseenter="enter('-6816091760091632163');" onmouseout="out('-6816091760091632163');" style=""><abbr title=" 138                 AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinkConfDir, yarnClient, false);"> 138                 AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnCðŸ”µ</abbr></span>
<span class="7284485832444382760" onmouseenter="enter('7284485832444382760');" onmouseout="out('7284485832444382760');" style=""> 139                 ClusterClient clusterClient = clusterDescriptor.retrieve(applicationId);                 </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 140                 clusterClient.setDetached(true);                                                         </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 141                 return clusterClient;                                                                    </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 142             } catch (java.lang.Exception e) {                                                            </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 143                 throw new RuntimeException(e);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144             }                                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 145         } else {                                                                                         </span>
<span class="-818626197127626055" onmouseenter="enter('-818626197127626055');" onmouseout="out('-818626197127626055');" style=""> 146             throw new RuntimeException(&quot;yarn mode must set param of &#x27;yarnconf&#x27;!!!&quot;);                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148     }                                                                                                    </span>
<span  style=""> 149                                                                                                          </span>
<span class="4520585383857802787" onmouseenter="enter('4520585383857802787');" onmouseout="out('4520585383857802787');" style=""> 150     private static ApplicationId getYarnClusterApplicationId(YarnClient yarnClient) throws Exception {   </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style=""> 151         ApplicationId applicationId = null;                                                              </span>
<span class="-8169037907797863140" onmouseenter="enter('-8169037907797863140');" onmouseout="out('-8169037907797863140');" style=""> 152         Set&lt;String&gt; set = new HashSet&lt;&gt;();                                                               </span>
<span class="1611340247917691443" onmouseenter="enter('1611340247917691443');" onmouseout="out('1611340247917691443');" style=""> 153         set.add(&quot;Apache Flink&quot;);                                                                         </span>
<span class="5540355505413622998" onmouseenter="enter('5540355505413622998');" onmouseout="out('5540355505413622998');" style=""> 154         EnumSet&lt;YarnApplicationState&gt; enumSet = EnumSet.noneOf(YarnApplicationState.class);              </span>
<span class="4582984779835017200" onmouseenter="enter('4582984779835017200');" onmouseout="out('4582984779835017200');" style=""> 155         enumSet.add(YarnApplicationState.RUNNING);                                                       </span>
<span class="1830734000385452214" onmouseenter="enter('1830734000385452214');" onmouseout="out('1830734000385452214');" style=""> 156         List&lt;ApplicationReport&gt; reportList = yarnClient.getApplications(set, enumSet);                   </span>
<span class="-369447775955784899" onmouseenter="enter('-369447775955784899');" onmouseout="out('-369447775955784899');" style=""> 157         int maxMemory = -1;                                                                              </span>
<span class="-4846585872764251675" onmouseenter="enter('-4846585872764251675');" onmouseout="out('-4846585872764251675');" style=""> 158         int maxCores = -1;                                                                               </span>
<span class="6886164409438478920" onmouseenter="enter('6886164409438478920');" onmouseout="out('6886164409438478920');" style=""> 159         for (ApplicationReport report : reportList) {                                                    </span>
<span class="-424772390849256809" onmouseenter="enter('-424772390849256809');" onmouseout="out('-424772390849256809');" style=""> 160             if (!report.getName().startsWith(&quot;Flink session&quot;)) {                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 161                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162             }                                                                                            </span>
<span class="1235099662322490241" onmouseenter="enter('1235099662322490241');" onmouseout="out('1235099662322490241');" style=""> 163             if (!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) {                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 164                 continue;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165             }                                                                                            </span>
<span class="4956299878435728516" onmouseenter="enter('4956299878435728516');" onmouseout="out('4956299878435728516');" style=""> 166             int thisMemory = report.getApplicationResourceUsageReport().getNeededResources().getMemory();</span>
<span class="-1408027150422172031" onmouseenter="enter('-1408027150422172031');" onmouseout="out('-1408027150422172031');" style=""><abbr title=" 167             int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();"> 167             int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCorðŸ”µ</abbr></span>
<span class="5268332922863238533" onmouseenter="enter('5268332922863238533');" onmouseout="out('5268332922863238533');" style=""> 168             if ((thisMemory &gt; maxMemory) || ((thisMemory == maxMemory) &amp;&amp; (thisCores &gt; maxCores))) {     </span>
<span class="393893018308938162" onmouseenter="enter('393893018308938162');" onmouseout="out('393893018308938162');" style=""> 169                 maxMemory = thisMemory;                                                                  </span>
<span class="-6641939115520661476" onmouseenter="enter('-6641939115520661476');" onmouseout="out('-6641939115520661476');" style=""> 170                 maxCores = thisCores;                                                                    </span>
<span class="-2782692697137135125" onmouseenter="enter('-2782692697137135125');" onmouseout="out('-2782692697137135125');" style=""> 171                 applicationId = report.getApplicationId();                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173         }                                                                                                </span>
<span class="-3567425592873575512" onmouseenter="enter('-3567425592873575512');" onmouseout="out('-3567425592873575512');" style=""> 174         if ((applicationId == null) || StringUtils.isEmpty(applicationId.toString())) {                  </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 175             throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176         }                                                                                                </span>
<span class="5985572316486027976" onmouseenter="enter('5985572316486027976');" onmouseout="out('5985572316486027976');" style=""> 177         return applicationId;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178     }                                                                                                    </span>
<span  style=""> 179                                                                                                          </span>
<span class="-4507162632467603669" onmouseenter="enter('-4507162632467603669');" onmouseout="out('-4507162632467603669');" style=""> 180     private static ApplicationId toApplicationId(String appIdStr) {                                      </span>
<span class="4229427001454084170" onmouseenter="enter('4229427001454084170');" onmouseout="out('4229427001454084170');" style=""> 181         Iterator&lt;String&gt; it = StringHelper._split(appIdStr).iterator();                                  </span>
<span class="5406390625905078860" onmouseenter="enter('5406390625905078860');" onmouseout="out('5406390625905078860');" style=""> 182         if (!&quot;application&quot;.equals(it.next())) {                                                          </span>
<span class="8668152551389785899" onmouseenter="enter('8668152551389785899');" onmouseout="out('8668152551389785899');" style=""><abbr title=" 183             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicationId should start with prefix &quot; + &quot;application&quot;);"> 183             throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The validðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 184         } else {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 185             try {                                                                                        </span>
<span class="7789939610237528981" onmouseenter="enter('7789939610237528981');" onmouseout="out('7789939610237528981');" style=""> 186                 return toApplicationId(it);                                                              </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 187             } catch (NumberFormatException e) {                                                          </span>
<span class="1796865554742970225" onmouseenter="enter('1796865554742970225');" onmouseout="out('1796865554742970225');" style=""> 188                 throw new IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; + appIdStr, e);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191     }                                                                                                    </span>
<span  style=""> 192                                                                                                          </span>
<span class="1367086786860425516" onmouseenter="enter('1367086786860425516');" onmouseout="out('1367086786860425516');" style=""> 193     private static ApplicationId toApplicationId(Iterator&lt;String&gt; it) throws NumberFormatException {     </span>
<span class="-2928988115653544018" onmouseenter="enter('-2928988115653544018');" onmouseout="out('-2928988115653544018');" style=""> 194         return ApplicationId.newInstance(Long.parseLong(it.next()), Integer.parseInt(it.next()));        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196 }                                                                                                        </span>











































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">   1  /**                                                                                                               </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>

<span class="3430964305904514764" onmouseenter="enter('3430964305904514764');" onmouseout="out('3430964305904514764');" style="">  10   * http://www.apache.org/licenses/LICENSE-2.0                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>

<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span class="-4666348732459622550" onmouseenter="enter('-4666348732459622550');" onmouseout="out('-4666348732459622550');" style="">  19  package com.dtstack.flink.sql.launcher;                                                                           </span>
<span  style="">  20                                                                                                                    </span>
<span class="4163183244871785745" onmouseenter="enter('4163183244871785745');" onmouseout="out('4163183244871785745');" style="">  21  import com.dtstack.flink.sql.enums.ClusterMode;                                                                   </span>
<span class="6579778626253321963" onmouseenter="enter('6579778626253321963');" onmouseout="out('6579778626253321963');" style="">  22  import com.dtstack.flink.sql.option.Options;                                                                      </span>
<span class="-3389130316234486348" onmouseenter="enter('-3389130316234486348');" onmouseout="out('-3389130316234486348');" style="">  23  import com.dtstack.flink.sql.util.PluginUtil;                                                                     </span>
<span class="-1945462796058520247" onmouseenter="enter('-1945462796058520247');" onmouseout="out('-1945462796058520247');" style="">  24  import com.esotericsoftware.minlog.Log;                                                                           </span>
<span class="-8922236357512993475" onmouseenter="enter('-8922236357512993475');" onmouseout="out('-8922236357512993475');" style="">  25  import org.apache.commons.io.Charsets;                                                                            </span>
<span class="7952073036463698968" onmouseenter="enter('7952073036463698968');" onmouseout="out('7952073036463698968');" style="">  26  import org.apache.commons.lang.StringUtils;                                                                       </span>
<span class="-5018311972488265281" onmouseenter="enter('-5018311972488265281');" onmouseout="out('-5018311972488265281');" style="">  27  import org.apache.flink.client.program.ClusterClient;                                                             </span>
<span class="7739213985600208914" onmouseenter="enter('7739213985600208914');" onmouseout="out('7739213985600208914');" style="">  28  import org.apache.flink.client.program.MiniClusterClient;                                                         </span>
<span class="-304847577149896806" onmouseenter="enter('-304847577149896806');" onmouseout="out('-304847577149896806');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import org.apache.flink.configuration.ConfigConstants;                                                            </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  30  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="-5961957399886376486" onmouseenter="enter('-5961957399886376486');" onmouseout="out('-5961957399886376486');" style="">  31  import org.apache.flink.configuration.GlobalConfiguration;                                                        </span>
<span class="-6310495642702641788" onmouseenter="enter('-6310495642702641788');" onmouseout="out('-6310495642702641788');" style="">  32  import org.apache.flink.configuration.JobManagerOptions;                                                          </span>
<span class="8609901781044162488" onmouseenter="enter('8609901781044162488');" onmouseout="out('8609901781044162488');" style="">  33  import org.apache.flink.core.fs.FileSystem;                                                                       </span>
<span class="-2586613049287592313" onmouseenter="enter('-2586613049287592313');" onmouseout="out('-2586613049287592313');" style="">  34  import org.apache.flink.runtime.akka.AkkaUtils;                                                                   </span>
<span class="-2713113410259205994" onmouseenter="enter('-2713113410259205994');" onmouseout="out('-2713113410259205994');" style="">  35  import org.apache.flink.runtime.minicluster.MiniCluster;                                                          </span>
<span class="1583265242678797853" onmouseenter="enter('1583265242678797853');" onmouseout="out('1583265242678797853');" style="">  36  import org.apache.flink.runtime.minicluster.MiniClusterConfiguration;                                             </span>
<span class="2463804193477214615" onmouseenter="enter('2463804193477214615');" onmouseout="out('2463804193477214615');" style="">  37  import org.apache.flink.runtime.util.LeaderConnectionInfo;                                                        </span>
<span class="2707853699459523291" onmouseenter="enter('2707853699459523291');" onmouseout="out('2707853699459523291');" style="">  38  import org.apache.flink.yarn.AbstractYarnClusterDescriptor;                                                       </span>
<span class="8677815094093511563" onmouseenter="enter('8677815094093511563');" onmouseout="out('8677815094093511563');" style="">  39  import org.apache.flink.yarn.YarnClusterDescriptor;                                                               </span>
<span class="8458556742018191597" onmouseenter="enter('8458556742018191597');" onmouseout="out('8458556742018191597');" style="">  40  import org.apache.hadoop.yarn.api.records.ApplicationId;                                                          </span>
<span class="4889670150256338446" onmouseenter="enter('4889670150256338446');" onmouseout="out('4889670150256338446');" style="">  41  import org.apache.hadoop.yarn.api.records.ApplicationReport;                                                      </span>
<span class="-8519056337267772623" onmouseenter="enter('-8519056337267772623');" onmouseout="out('-8519056337267772623');" style="">  42  import org.apache.hadoop.yarn.api.records.YarnApplicationState;                                                   </span>
<span class="-6331858862509679410" onmouseenter="enter('-6331858862509679410');" onmouseout="out('-6331858862509679410');" style="">  43  import org.apache.hadoop.yarn.client.api.YarnClient;                                                              </span>
<span class="-5883054148134480566" onmouseenter="enter('-5883054148134480566');" onmouseout="out('-5883054148134480566');" style="">  44  import org.apache.hadoop.yarn.conf.YarnConfiguration;                                                             </span>
<span class="-7343793280970510192" onmouseenter="enter('-7343793280970510192');" onmouseout="out('-7343793280970510192');" style="">  45  import org.apache.hadoop.yarn.util.StringHelper;                                                                  </span>


<span  style="">  46                                                                                                                    </span>
<span class="-5372229354663550968" onmouseenter="enter('-5372229354663550968');" onmouseout="out('-5372229354663550968');" style="">  47  import java.net.InetSocketAddress;                                                                                </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="">  48  import java.net.URLDecoder;                                                                                       </span>
<span class="708245193883173442" onmouseenter="enter('708245193883173442');" onmouseout="out('708245193883173442');" style="">  49  import java.util.EnumSet;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  50  import java.util.HashSet;                                                                                         </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="">  51  import java.util.Iterator;                                                                                        </span>

<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  52  import java.util.List;                                                                                            </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  53  import java.util.Properties;                                                                                      </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  54  import java.util.Set;                                                                                             </span>

<span  style="">  55                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  56  /**                                                                                                               </span>
<span class="-3971691924018094169" onmouseenter="enter('-3971691924018094169');" onmouseout="out('-3971691924018094169');" style="">  57   * @author sishu.yss                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  58   */                                                                                                               </span>
<span class="2987681938130092722" onmouseenter="enter('2987681938130092722');" onmouseout="out('2987681938130092722');" style="">  59  public class ClusterClientFactory {                                                                               </span>












<span  style="">  60                                                                                                                    </span>
<span class="9096170393674332782" onmouseenter="enter('9096170393674332782');" onmouseout="out('9096170393674332782');" style="">  61      public static ClusterClient createClusterClient(Options launcherOptions) throws Exception {                   </span>
<span class="1580619527178340568" onmouseenter="enter('1580619527178340568');" onmouseout="out('1580619527178340568');" style="">  62          String mode = launcherOptions.getMode();                                                                  </span>
<span class="3152003248099615816" onmouseenter="enter('3152003248099615816');" onmouseout="out('3152003248099615816');" style="">  63          if (mode.equals(ClusterMode.standalone.name())) {                                                         </span>
<span class="-2673317197223310055" onmouseenter="enter('-2673317197223310055');" onmouseout="out('-2673317197223310055');" style="">  64              return createStandaloneClient(launcherOptions);                                                       </span>
<span class="6048008447776154150" onmouseenter="enter('6048008447776154150');" onmouseout="out('6048008447776154150');" style="">  65          } else if (mode.equals(ClusterMode.yarn.name())) {                                                        </span>
<span class="-7696015566091056231" onmouseenter="enter('-7696015566091056231');" onmouseout="out('-7696015566091056231');" style="">  66              return createYarnSessionClient(launcherOptions);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  67          }                                                                                                         </span>
<span class="-1110182490908431808" onmouseenter="enter('-1110182490908431808');" onmouseout="out('-1110182490908431808');" style="">  68          throw new IllegalArgumentException(&quot;Unsupported cluster client type: &quot;);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69      }                                                                                                             </span>
<span  style="">  70                                                                                                                    </span>
<span class="-802191291303526610" onmouseenter="enter('-802191291303526610');" onmouseout="out('-802191291303526610');" style="">  71      public static ClusterClient createStandaloneClient(Options launcherOptions) throws Exception {                </span>
<span class="1761492070997118793" onmouseenter="enter('1761492070997118793');" onmouseout="out('1761492070997118793');" style="">  72          String flinkConfDir = launcherOptions.getFlinkconf();                                                     </span>
<span class="7816329497793558634" onmouseenter="enter('7816329497793558634');" onmouseout="out('7816329497793558634');" style="">  73          Configuration config = GlobalConfiguration.loadConfiguration(flinkConfDir);                               </span>
<span class="-4067763610081958627" onmouseenter="enter('-4067763610081958627');" onmouseout="out('-4067763610081958627');" style="">  74          MiniClusterConfiguration.Builder configBuilder = new MiniClusterConfiguration.Builder();                  </span>
<span class="1773871932017020795" onmouseenter="enter('1773871932017020795');" onmouseout="out('1773871932017020795');" style="">  75          configBuilder.setConfiguration(config);                                                                   </span>
<span class="1652632586658336024" onmouseenter="enter('1652632586658336024');" onmouseout="out('1652632586658336024');" style="">  76          MiniCluster miniCluster = new MiniCluster(configBuilder.build());                                         </span>
<span class="6700237672426991131" onmouseenter="enter('6700237672426991131');" onmouseout="out('6700237672426991131');" style="">  77          MiniClusterClient clusterClient = new MiniClusterClient(config, miniCluster);                             </span>






<span class="5460388504045041514" onmouseenter="enter('5460388504045041514');" onmouseout="out('5460388504045041514');" style="">  78          LeaderConnectionInfo connectionInfo = clusterClient.getClusterConnectionInfo();                           </span>
<span class="5152489928806645392" onmouseenter="enter('5152489928806645392');" onmouseout="out('5152489928806645392');" style="">  79          InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());       </span>
<span class="6829588547509854341" onmouseenter="enter('6829588547509854341');" onmouseout="out('6829588547509854341');" style="">  80          config.setString(JobManagerOptions.ADDRESS, address.getAddress().getHostName());                          </span>
<span class="9134688451588203149" onmouseenter="enter('9134688451588203149');" onmouseout="out('9134688451588203149');" style="">  81          config.setInteger(JobManagerOptions.PORT, address.getPort());                                             </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style="">  82          clusterClient.setDetached(true);                                                                          </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style="">  83          return clusterClient;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84      }                                                                                                             </span>
<span  style="">  85                                                                                                                    </span>
<span class="-6427714043144307769" onmouseenter="enter('-6427714043144307769');" onmouseout="out('-6427714043144307769');" style="">  86      public static ClusterClient createYarnSessionClient(Options launcherOptions) {                                </span>
<span class="-1817028274787323640" onmouseenter="enter('-1817028274787323640');" onmouseout="out('-1817028274787323640');" style=""><abbr title="  87          String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.getFlinkconf();">  87          String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.getFlinkcðŸ”µ</abbr></span>
<span class="4635921604956969650" onmouseenter="enter('4635921604956969650');" onmouseout="out('4635921604956969650');" style=""><abbr title="  88          Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguration.loadConfiguration(flinkConfDir);">  88          Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguration.loadCðŸ”µ</abbr></span>
<span class="5386610166888514231" onmouseenter="enter('5386610166888514231');" onmouseout="out('5386610166888514231');" style="">  89          String yarnConfDir = launcherOptions.getYarnconf();                                                       </span>
<span  style="">  90                                                                                                                    </span>
<span class="5688737160066801667" onmouseenter="enter('5688737160066801667');" onmouseout="out('5688737160066801667');" style="">  91          if (StringUtils.isNotBlank(yarnConfDir)) {                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  92              try {                                                                                                 </span>
<span class="819462190439601526" onmouseenter="enter('819462190439601526');" onmouseout="out('819462190439601526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  93 -                config.setString(&quot;fs.hdfs.hadoopconf&quot;, yarnConfDir);                                              </span>



<span class="9044151009829571497" onmouseenter="enter('9044151009829571497');" onmouseout="out('9044151009829571497');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -                FileSystem.initialize(config);                                                                    </span>
<span class="-2564123571596243167" onmouseenter="enter('-2564123571596243167');" onmouseout="out('-2564123571596243167');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  95 +                config.setString(ConfigConstants.PATH_HADOOP_CONFIG, yarnConfDir);                                </span>
<span class="-3370155354983794031" onmouseenter="enter('-3370155354983794031');" onmouseout="out('-3370155354983794031');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +                FileSystem.initialize(config, null);                                                              </span>
<span  style="">  97                                                                                                                    </span>
<span class="-8309544538696184279" onmouseenter="enter('-8309544538696184279');" onmouseout="out('-8309544538696184279');" style="">  98                  YarnConfiguration yarnConf = YarnConfLoader.getYarnConf(yarnConfDir);                             </span>
<span class="-4294518192733428025" onmouseenter="enter('-4294518192733428025');" onmouseout="out('-4294518192733428025');" style="">  99                  YarnClient yarnClient = YarnClient.createYarnClient();                                            </span>
<span class="5472274627169264043" onmouseenter="enter('5472274627169264043');" onmouseout="out('5472274627169264043');" style=""> 100                  yarnClient.init(yarnConf);                                                                        </span>
<span class="6599374713362233892" onmouseenter="enter('6599374713362233892');" onmouseout="out('6599374713362233892');" style=""> 101                  yarnClient.start();                                                                               </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style=""> 102                  ApplicationId applicationId = null;                                                               </span>

<span  style=""> 103                                                                                                                    </span>
<span class="-9176432362536668352" onmouseenter="enter('-9176432362536668352');" onmouseout="out('-9176432362536668352');" style=""> 104                  String yarnSessionConf = launcherOptions.getYarnSessionConf();                                    </span>
<span class="-127694460867817418" onmouseenter="enter('-127694460867817418');" onmouseout="out('-127694460867817418');" style=""> 105                  yarnSessionConf = URLDecoder.decode(yarnSessionConf, Charsets.UTF_8.toString());                  </span>
<span class="-859984515838945264" onmouseenter="enter('-859984515838945264');" onmouseout="out('-859984515838945264');" style=""><abbr title=" 106                  Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.class);"> 106                  Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.clasðŸ”µ</abbr></span>

<span class="8863382991069320815" onmouseenter="enter('8863382991069320815');" onmouseout="out('8863382991069320815');" style=""> 107                  Object yid = yarnSessionConfProperties.get(&quot;yid&quot;);                                                </span>
<span  style=""> 108                                                                                                                    </span>
<span class="-8848781777370597992" onmouseenter="enter('-8848781777370597992');" onmouseout="out('-8848781777370597992');" style=""> 109                  if (null != yid) {                                                                                </span>
<span class="-6322388926542920640" onmouseenter="enter('-6322388926542920640');" onmouseout="out('-6322388926542920640');" style=""> 110                      applicationId = toApplicationId(yid.toString());                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 111                  } else {                                                                                          </span>
<span class="-1125803419217936962" onmouseenter="enter('-1125803419217936962');" onmouseout="out('-1125803419217936962');" style=""> 112                      applicationId = getYarnClusterApplicationId(yarnClient);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113                  }                                                                                                 </span>
<span  style=""> 114                                                                                                                    </span>
<span class="-6552011762599352522" onmouseenter="enter('-6552011762599352522');" onmouseout="out('-6552011762599352522');" style=""> 115                  Log.info(&quot;applicationId={}&quot;, applicationId.toString());                                           </span>

<span  style=""> 116                                                                                                                    </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style=""> 117                  if (StringUtils.isEmpty(applicationId.toString())) {                                              </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 118                      throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119                  }                                                                                                 </span>










<span  style=""> 120                                                                                                                    </span>
<span class="-6816091760091632163" onmouseenter="enter('-6816091760091632163');" onmouseout="out('-6816091760091632163');" style=""><abbr title=" 121                  AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinkConfDir, yarnClient, false);"> 121                  AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinðŸ”µ</abbr></span>
<span class="7284485832444382760" onmouseenter="enter('7284485832444382760');" onmouseout="out('7284485832444382760');" style=""> 122                  ClusterClient clusterClient = clusterDescriptor.retrieve(applicationId);                          </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 123                  clusterClient.setDetached(true);                                                                  </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 124                  return clusterClient;                                                                             </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 125              } catch (Exception e) {                                                                               </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 126                  throw new RuntimeException(e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127              }                                                                                                     </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 128          }else{                                                                                                    </span>

<span class="-818626197127626055" onmouseenter="enter('-818626197127626055');" onmouseout="out('-818626197127626055');" style=""> 129              throw new RuntimeException(&quot;yarn mode must set param of &#x27;yarnconf&#x27;!!!&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131      }                                                                                                             </span>
<span  style=""> 132                                                                                                                    </span>
<span  style=""> 133                                                                                                                    </span>
<span class="4520585383857802787" onmouseenter="enter('4520585383857802787');" onmouseout="out('4520585383857802787');" style=""> 134      private static ApplicationId getYarnClusterApplicationId(YarnClient yarnClient) throws Exception {            </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style=""> 135          ApplicationId applicationId = null;                                                                       </span>
<span  style=""> 136                                                                                                                    </span>
<span class="-8169037907797863140" onmouseenter="enter('-8169037907797863140');" onmouseout="out('-8169037907797863140');" style=""> 137          Set&lt;String&gt; set = new HashSet&lt;&gt;();                                                                        </span>
<span class="1611340247917691443" onmouseenter="enter('1611340247917691443');" onmouseout="out('1611340247917691443');" style=""> 138          set.add(&quot;Apache Flink&quot;);                                                                                  </span>
<span class="5540355505413622998" onmouseenter="enter('5540355505413622998');" onmouseout="out('5540355505413622998');" style=""> 139          EnumSet&lt;YarnApplicationState&gt; enumSet = EnumSet.noneOf(YarnApplicationState.class);                       </span>
<span class="4582984779835017200" onmouseenter="enter('4582984779835017200');" onmouseout="out('4582984779835017200');" style=""> 140          enumSet.add(YarnApplicationState.RUNNING);                                                                </span>
<span class="1830734000385452214" onmouseenter="enter('1830734000385452214');" onmouseout="out('1830734000385452214');" style=""> 141          List&lt;ApplicationReport&gt; reportList = yarnClient.getApplications(set, enumSet);                            </span>
<span  style=""> 142                                                                                                                    </span>
<span class="-369447775955784899" onmouseenter="enter('-369447775955784899');" onmouseout="out('-369447775955784899');" style=""> 143          int maxMemory = -1;                                                                                       </span>
<span class="-4846585872764251675" onmouseenter="enter('-4846585872764251675');" onmouseout="out('-4846585872764251675');" style=""> 144          int maxCores = -1;                                                                                        </span>
<span class="6886164409438478920" onmouseenter="enter('6886164409438478920');" onmouseout="out('6886164409438478920');" style=""> 145          for (ApplicationReport report : reportList) {                                                             </span>
<span class="-424772390849256809" onmouseenter="enter('-424772390849256809');" onmouseout="out('-424772390849256809');" style=""> 146              if (!report.getName().startsWith(&quot;Flink session&quot;)) {                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 147                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148              }                                                                                                     </span>
<span  style=""> 149                                                                                                                    </span>
<span class="1235099662322490241" onmouseenter="enter('1235099662322490241');" onmouseout="out('1235099662322490241');" style=""> 150              if (!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) {                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 151                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152              }                                                                                                     </span>
<span  style=""> 153                                                                                                                    </span>
<span class="4956299878435728516" onmouseenter="enter('4956299878435728516');" onmouseout="out('4956299878435728516');" style=""> 154              int thisMemory = report.getApplicationResourceUsageReport().getNeededResources().getMemory();         </span>
<span class="-1408027150422172031" onmouseenter="enter('-1408027150422172031');" onmouseout="out('-1408027150422172031');" style=""> 155              int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();    </span>
<span class="5717156388718347421" onmouseenter="enter('5717156388718347421');" onmouseout="out('5717156388718347421');" style=""> 156              if (thisMemory &gt; maxMemory || thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) {                      </span>
<span class="393893018308938162" onmouseenter="enter('393893018308938162');" onmouseout="out('393893018308938162');" style=""> 157                  maxMemory = thisMemory;                                                                           </span>
<span class="-6641939115520661476" onmouseenter="enter('-6641939115520661476');" onmouseout="out('-6641939115520661476');" style=""> 158                  maxCores = thisCores;                                                                             </span>
<span class="-2782692697137135125" onmouseenter="enter('-2782692697137135125');" onmouseout="out('-2782692697137135125');" style=""> 159                  applicationId = report.getApplicationId();                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160              }                                                                                                     </span>
<span  style=""> 161                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162          }                                                                                                         </span>
<span  style=""> 163                                                                                                                    </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style=""> 164          if (StringUtils.isEmpty(applicationId.toString())) {                                                      </span>

<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 165              throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166          }                                                                                                         </span>
<span class="5985572316486027976" onmouseenter="enter('5985572316486027976');" onmouseout="out('5985572316486027976');" style=""> 167          return applicationId;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168      }                                                                                                             </span>
<span  style=""> 169                                                                                                                    </span>
<span class="-4507162632467603669" onmouseenter="enter('-4507162632467603669');" onmouseout="out('-4507162632467603669');" style=""> 170      private static ApplicationId toApplicationId(String appIdStr) {                                               </span>
<span class="4229427001454084170" onmouseenter="enter('4229427001454084170');" onmouseout="out('4229427001454084170');" style=""> 171          Iterator&lt;String&gt; it = StringHelper._split(appIdStr).iterator();                                           </span>
<span class="5406390625905078860" onmouseenter="enter('5406390625905078860');" onmouseout="out('5406390625905078860');" style=""> 172          if (!&quot;application&quot;.equals(it.next())) {                                                                   </span>
<span class="8668152551389785899" onmouseenter="enter('8668152551389785899');" onmouseout="out('8668152551389785899');" style=""><abbr title=" 173              throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicationId should start with prefix &quot; + &quot;application&quot;);"> 173              throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicatðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 174          } else {                                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 175              try {                                                                                                 </span>
<span class="7789939610237528981" onmouseenter="enter('7789939610237528981');" onmouseout="out('7789939610237528981');" style=""> 176                  return toApplicationId(it);                                                                       </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 177              } catch (NumberFormatException e) {                                                                   </span>
<span class="1796865554742970225" onmouseenter="enter('1796865554742970225');" onmouseout="out('1796865554742970225');" style=""> 178                  throw new IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; + appIdStr, e);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181      }                                                                                                             </span>
<span  style=""> 182                                                                                                                    </span>
<span class="1367086786860425516" onmouseenter="enter('1367086786860425516');" onmouseout="out('1367086786860425516');" style=""> 183      private static ApplicationId toApplicationId(Iterator&lt;String&gt; it) throws NumberFormatException {              </span>
<span class="-2928988115653544018" onmouseenter="enter('-2928988115653544018');" onmouseout="out('-2928988115653544018');" style=""> 184          return ApplicationId.newInstance(Long.parseLong(it.next()), Integer.parseInt(it.next()));                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185      }                                                                                                             </span>
<span  style=""> 186                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">   1  /**                                                                                                               </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   9 - *                                                                                                                </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  10 + * &lt;p&gt;                                                                                                            </span>
<span class="3430964305904514764" onmouseenter="enter('3430964305904514764');" onmouseout="out('3430964305904514764');" style="">  11   * http://www.apache.org/licenses/LICENSE-2.0                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  12 - *                                                                                                                </span>
<span class="4169512172915751358" onmouseenter="enter('4169512172915751358');" onmouseout="out('4169512172915751358');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  13 + * &lt;p&gt;                                                                                                            </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  14   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  15   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  16   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  17   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  18   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  19   */                                                                                                               </span>
<span  style="">  20                                                                                                                    </span>
<span class="-4666348732459622550" onmouseenter="enter('-4666348732459622550');" onmouseout="out('-4666348732459622550');" style="">  21  package com.dtstack.flink.sql.launcher;                                                                           </span>
<span  style="">  22                                                                                                                    </span>
<span class="4163183244871785745" onmouseenter="enter('4163183244871785745');" onmouseout="out('4163183244871785745');" style="">  23  import com.dtstack.flink.sql.enums.ClusterMode;                                                                   </span>
<span class="6579778626253321963" onmouseenter="enter('6579778626253321963');" onmouseout="out('6579778626253321963');" style="">  24  import com.dtstack.flink.sql.option.Options;                                                                      </span>
<span class="-3389130316234486348" onmouseenter="enter('-3389130316234486348');" onmouseout="out('-3389130316234486348');" style="">  25  import com.dtstack.flink.sql.util.PluginUtil;                                                                     </span>
<span class="-1945462796058520247" onmouseenter="enter('-1945462796058520247');" onmouseout="out('-1945462796058520247');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -import com.esotericsoftware.minlog.Log;                                                                           </span>
<span class="-8922236357512993475" onmouseenter="enter('-8922236357512993475');" onmouseout="out('-8922236357512993475');" style="">  27  import org.apache.commons.io.Charsets;                                                                            </span>
<span class="7952073036463698968" onmouseenter="enter('7952073036463698968');" onmouseout="out('7952073036463698968');" style="">  28  import org.apache.commons.lang.StringUtils;                                                                       </span>
<span class="-5018311972488265281" onmouseenter="enter('-5018311972488265281');" onmouseout="out('-5018311972488265281');" style="">  29  import org.apache.flink.client.program.ClusterClient;                                                             </span>
<span class="7739213985600208914" onmouseenter="enter('7739213985600208914');" onmouseout="out('7739213985600208914');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  30 -import org.apache.flink.client.program.MiniClusterClient;                                                         </span>
<span class="-2145364053946109621" onmouseenter="enter('-2145364053946109621');" onmouseout="out('-2145364053946109621');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  31 +import org.apache.flink.client.program.rest.RestClusterClient;                                                    </span>
<span class="87671769792320379" onmouseenter="enter('87671769792320379');" onmouseout="out('87671769792320379');" style="">  32  import org.apache.flink.configuration.Configuration;                                                              </span>
<span class="-5961957399886376486" onmouseenter="enter('-5961957399886376486');" onmouseout="out('-5961957399886376486');" style="">  33  import org.apache.flink.configuration.GlobalConfiguration;                                                        </span>
<span class="-6310495642702641788" onmouseenter="enter('-6310495642702641788');" onmouseout="out('-6310495642702641788');" style="">  34  import org.apache.flink.configuration.JobManagerOptions;                                                          </span>
<span class="8609901781044162488" onmouseenter="enter('8609901781044162488');" onmouseout="out('8609901781044162488');" style="">  35  import org.apache.flink.core.fs.FileSystem;                                                                       </span>
<span class="-2586613049287592313" onmouseenter="enter('-2586613049287592313');" onmouseout="out('-2586613049287592313');" style="">  36  import org.apache.flink.runtime.akka.AkkaUtils;                                                                   </span>
<span class="-2713113410259205994" onmouseenter="enter('-2713113410259205994');" onmouseout="out('-2713113410259205994');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -import org.apache.flink.runtime.minicluster.MiniCluster;                                                          </span>
<span class="1583265242678797853" onmouseenter="enter('1583265242678797853');" onmouseout="out('1583265242678797853');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -import org.apache.flink.runtime.minicluster.MiniClusterConfiguration;                                             </span>
<span class="2463804193477214615" onmouseenter="enter('2463804193477214615');" onmouseout="out('2463804193477214615');" style="">  39  import org.apache.flink.runtime.util.LeaderConnectionInfo;                                                        </span>
<span class="2707853699459523291" onmouseenter="enter('2707853699459523291');" onmouseout="out('2707853699459523291');" style="">  40  import org.apache.flink.yarn.AbstractYarnClusterDescriptor;                                                       </span>
<span class="8677815094093511563" onmouseenter="enter('8677815094093511563');" onmouseout="out('8677815094093511563');" style="">  41  import org.apache.flink.yarn.YarnClusterDescriptor;                                                               </span>
<span class="8458556742018191597" onmouseenter="enter('8458556742018191597');" onmouseout="out('8458556742018191597');" style="">  42  import org.apache.hadoop.yarn.api.records.ApplicationId;                                                          </span>
<span class="4889670150256338446" onmouseenter="enter('4889670150256338446');" onmouseout="out('4889670150256338446');" style="">  43  import org.apache.hadoop.yarn.api.records.ApplicationReport;                                                      </span>
<span class="-8519056337267772623" onmouseenter="enter('-8519056337267772623');" onmouseout="out('-8519056337267772623');" style="">  44  import org.apache.hadoop.yarn.api.records.YarnApplicationState;                                                   </span>
<span class="-6331858862509679410" onmouseenter="enter('-6331858862509679410');" onmouseout="out('-6331858862509679410');" style="">  45  import org.apache.hadoop.yarn.client.api.YarnClient;                                                              </span>
<span class="-5883054148134480566" onmouseenter="enter('-5883054148134480566');" onmouseout="out('-5883054148134480566');" style="">  46  import org.apache.hadoop.yarn.conf.YarnConfiguration;                                                             </span>
<span class="-7343793280970510192" onmouseenter="enter('-7343793280970510192');" onmouseout="out('-7343793280970510192');" style="">  47  import org.apache.hadoop.yarn.util.StringHelper;                                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  48 +import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  49 +import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  50                                                                                                                    </span>
<span class="-5372229354663550968" onmouseenter="enter('-5372229354663550968');" onmouseout="out('-5372229354663550968');" style="">  51  import java.net.InetSocketAddress;                                                                                </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="">  52  import java.net.URLDecoder;                                                                                       </span>
<span class="708245193883173442" onmouseenter="enter('708245193883173442');" onmouseout="out('708245193883173442');" style="">  53  import java.util.EnumSet;                                                                                         </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="">  54  import java.util.HashSet;                                                                                         </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 -import java.util.Iterator;                                                                                        </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  56 +import java.util.Set;                                                                                             </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  57  import java.util.List;                                                                                            </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="">  58  import java.util.Properties;                                                                                      </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -import java.util.Set;                                                                                             </span>
<span class="7112180775387943933" onmouseenter="enter('7112180775387943933');" onmouseout="out('7112180775387943933');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  60 +import java.util.Iterator;                                                                                        </span>
<span  style="">  61                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  62  /**                                                                                                               </span>
<span class="-3971691924018094169" onmouseenter="enter('-3971691924018094169');" onmouseout="out('-3971691924018094169');" style="">  63   * @author sishu.yss                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  64   */                                                                                                               </span>
<span class="2987681938130092722" onmouseenter="enter('2987681938130092722');" onmouseout="out('2987681938130092722');" style="">  65  public class ClusterClientFactory {                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +                                                                                                                  </span>
<span class="158955771696974218" onmouseenter="enter('158955771696974218');" onmouseout="out('158955771696974218');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +    private static final Logger LOG = LoggerFactory.getLogger(ClusterClientFactory.class);                        </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +                                                                                                                  </span>
<span class="-814536110407258758" onmouseenter="enter('-814536110407258758');" onmouseout="out('-814536110407258758');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +    private static final String HA_CLUSTER_ID = &quot;high-availability.cluster-id&quot;;                                   </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +                                                                                                                  </span>
<span class="-5284483266258366119" onmouseenter="enter('-5284483266258366119');" onmouseout="out('-5284483266258366119');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  71 +    private static final String HIGH_AVAILABILITY = &quot;high-availability&quot;;                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +                                                                                                                  </span>
<span class="6046766839872255303" onmouseenter="enter('6046766839872255303');" onmouseout="out('6046766839872255303');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +    private static final String NODE = &quot;NONE&quot;;                                                                    </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +                                                                                                                  </span>
<span class="5793523754398446120" onmouseenter="enter('5793523754398446120');" onmouseout="out('5793523754398446120');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  75 +    private static final String ZOOKEEPER = &quot;zookeeper&quot;;                                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +                                                                                                                  </span>
<span class="-5534687535083206001" onmouseenter="enter('-5534687535083206001');" onmouseout="out('-5534687535083206001');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  77 +    private static final String HADOOP_CONF = &quot;fs.hdfs.hadoopconf&quot;;                                               </span>
<span  style="">  78                                                                                                                    </span>
<span class="9096170393674332782" onmouseenter="enter('9096170393674332782');" onmouseout="out('9096170393674332782');" style="">  79      public static ClusterClient createClusterClient(Options launcherOptions) throws Exception {                   </span>
<span class="1580619527178340568" onmouseenter="enter('1580619527178340568');" onmouseout="out('1580619527178340568');" style="">  80          String mode = launcherOptions.getMode();                                                                  </span>
<span class="3152003248099615816" onmouseenter="enter('3152003248099615816');" onmouseout="out('3152003248099615816');" style="">  81          if (mode.equals(ClusterMode.standalone.name())) {                                                         </span>
<span class="-2673317197223310055" onmouseenter="enter('-2673317197223310055');" onmouseout="out('-2673317197223310055');" style="">  82              return createStandaloneClient(launcherOptions);                                                       </span>
<span class="6048008447776154150" onmouseenter="enter('6048008447776154150');" onmouseout="out('6048008447776154150');" style="">  83          } else if (mode.equals(ClusterMode.yarn.name())) {                                                        </span>
<span class="-7696015566091056231" onmouseenter="enter('-7696015566091056231');" onmouseout="out('-7696015566091056231');" style="">  84              return createYarnSessionClient(launcherOptions);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85          }                                                                                                         </span>
<span class="-1110182490908431808" onmouseenter="enter('-1110182490908431808');" onmouseout="out('-1110182490908431808');" style="">  86          throw new IllegalArgumentException(&quot;Unsupported cluster client type: &quot;);                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87      }                                                                                                             </span>
<span  style="">  88                                                                                                                    </span>
<span class="-802191291303526610" onmouseenter="enter('-802191291303526610');" onmouseout="out('-802191291303526610');" style="">  89      public static ClusterClient createStandaloneClient(Options launcherOptions) throws Exception {                </span>
<span class="1761492070997118793" onmouseenter="enter('1761492070997118793');" onmouseout="out('1761492070997118793');" style="">  90          String flinkConfDir = launcherOptions.getFlinkconf();                                                     </span>
<span class="7816329497793558634" onmouseenter="enter('7816329497793558634');" onmouseout="out('7816329497793558634');" style="">  91          Configuration config = GlobalConfiguration.loadConfiguration(flinkConfDir);                               </span>
<span class="-4067763610081958627" onmouseenter="enter('-4067763610081958627');" onmouseout="out('-4067763610081958627');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  92 -        MiniClusterConfiguration.Builder configBuilder = new MiniClusterConfiguration.Builder();                  </span>
<span class="1773871932017020795" onmouseenter="enter('1773871932017020795');" onmouseout="out('1773871932017020795');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  93 -        configBuilder.setConfiguration(config);                                                                   </span>
<span class="1652632586658336024" onmouseenter="enter('1652632586658336024');" onmouseout="out('1652632586658336024');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -        MiniCluster miniCluster = new MiniCluster(configBuilder.build());                                         </span>
<span class="6700237672426991131" onmouseenter="enter('6700237672426991131');" onmouseout="out('6700237672426991131');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -        MiniClusterClient clusterClient = new MiniClusterClient(config, miniCluster);                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +                                                                                                                  </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +        LOG.info(&quot;------------config params-------------------------&quot;);                                           </span>
<span class="-1891084833916369881" onmouseenter="enter('-1891084833916369881');" onmouseout="out('-1891084833916369881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +        config.toMap().forEach((key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                                   </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +        LOG.info(&quot;-------------------------------------------&quot;);                                                  </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +                                                                                                                  </span>
<span class="-2718724998192346216" onmouseenter="enter('-2718724998192346216');" onmouseout="out('-2718724998192346216');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +        RestClusterClient clusterClient = new RestClusterClient&lt;&gt;(config, &quot;clusterClient&quot;);                       </span>
<span class="5460388504045041514" onmouseenter="enter('5460388504045041514');" onmouseout="out('5460388504045041514');" style=""> 102          LeaderConnectionInfo connectionInfo = clusterClient.getClusterConnectionInfo();                           </span>
<span class="5152489928806645392" onmouseenter="enter('5152489928806645392');" onmouseout="out('5152489928806645392');" style=""> 103          InetSocketAddress address = AkkaUtils.getInetSocketAddressFromAkkaURL(connectionInfo.getAddress());       </span>
<span class="6829588547509854341" onmouseenter="enter('6829588547509854341');" onmouseout="out('6829588547509854341');" style=""> 104          config.setString(JobManagerOptions.ADDRESS, address.getAddress().getHostName());                          </span>
<span class="9134688451588203149" onmouseenter="enter('9134688451588203149');" onmouseout="out('9134688451588203149');" style=""> 105          config.setInteger(JobManagerOptions.PORT, address.getPort());                                             </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 106          clusterClient.setDetached(true);                                                                          </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 107          return clusterClient;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108      }                                                                                                             </span>
<span  style=""> 109                                                                                                                    </span>
<span class="-6427714043144307769" onmouseenter="enter('-6427714043144307769');" onmouseout="out('-6427714043144307769');" style=""> 110      public static ClusterClient createYarnSessionClient(Options launcherOptions) {                                </span>
<span class="-1817028274787323640" onmouseenter="enter('-1817028274787323640');" onmouseout="out('-1817028274787323640');" style=""><abbr title=" 111          String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.getFlinkconf();"> 111          String flinkConfDir = StringUtils.isEmpty(launcherOptions.getFlinkconf()) ? &quot;&quot; : launcherOptions.getFlinkcðŸ”µ</abbr></span>
<span class="4635921604956969650" onmouseenter="enter('4635921604956969650');" onmouseout="out('4635921604956969650');" style=""><abbr title=" 112          Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguration.loadConfiguration(flinkConfDir);"> 112          Configuration config = StringUtils.isEmpty(flinkConfDir) ? new Configuration() : GlobalConfiguration.loadCðŸ”µ</abbr></span>
<span class="5386610166888514231" onmouseenter="enter('5386610166888514231');" onmouseout="out('5386610166888514231');" style=""> 113          String yarnConfDir = launcherOptions.getYarnconf();                                                       </span>
<span  style=""> 114                                                                                                                    </span>
<span class="5688737160066801667" onmouseenter="enter('5688737160066801667');" onmouseout="out('5688737160066801667');" style=""> 115          if (StringUtils.isNotBlank(yarnConfDir)) {                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 116              try {                                                                                                 </span>
<span class="819462190439601526" onmouseenter="enter('819462190439601526');" onmouseout="out('819462190439601526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -                config.setString(&quot;fs.hdfs.hadoopconf&quot;, yarnConfDir);                                              </span>
<span class="-4375817209366726298" onmouseenter="enter('-4375817209366726298');" onmouseout="out('-4375817209366726298');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 118 +                boolean isHighAvailability;                                                                       </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +                                                                                                                  </span>
<span class="-5377933620241534990" onmouseenter="enter('-5377933620241534990');" onmouseout="out('-5377933620241534990');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +                config.setString(HADOOP_CONF, yarnConfDir);                                                       </span>
<span class="9044151009829571497" onmouseenter="enter('9044151009829571497');" onmouseout="out('9044151009829571497');" style=""> 121                  FileSystem.initialize(config);                                                                    </span>


<span  style=""> 122                                                                                                                    </span>
<span class="-8309544538696184279" onmouseenter="enter('-8309544538696184279');" onmouseout="out('-8309544538696184279');" style=""> 123                  YarnConfiguration yarnConf = YarnConfLoader.getYarnConf(yarnConfDir);                             </span>
<span class="-4294518192733428025" onmouseenter="enter('-4294518192733428025');" onmouseout="out('-4294518192733428025');" style=""> 124                  YarnClient yarnClient = YarnClient.createYarnClient();                                            </span>
<span class="5472274627169264043" onmouseenter="enter('5472274627169264043');" onmouseout="out('5472274627169264043');" style=""> 125                  yarnClient.init(yarnConf);                                                                        </span>
<span class="6599374713362233892" onmouseenter="enter('6599374713362233892');" onmouseout="out('6599374713362233892');" style=""> 126                  yarnClient.start();                                                                               </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 127 -                ApplicationId applicationId = null;                                                               </span>
<span class="-8174546465611380821" onmouseenter="enter('-8174546465611380821');" onmouseout="out('-8174546465611380821');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +                ApplicationId applicationId;                                                                      </span>
<span  style=""> 129                                                                                                                    </span>
<span class="-9176432362536668352" onmouseenter="enter('-9176432362536668352');" onmouseout="out('-9176432362536668352');" style=""> 130                  String yarnSessionConf = launcherOptions.getYarnSessionConf();                                    </span>
<span class="-127694460867817418" onmouseenter="enter('-127694460867817418');" onmouseout="out('-127694460867817418');" style=""> 131                  yarnSessionConf = URLDecoder.decode(yarnSessionConf, Charsets.UTF_8.toString());                  </span>
<span class="-859984515838945264" onmouseenter="enter('-859984515838945264');" onmouseout="out('-859984515838945264');" style=""><abbr title=" 132                  Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.class);"> 132                  Properties yarnSessionConfProperties = PluginUtil.jsonStrToObject(yarnSessionConf, Properties.clasðŸ”µ</abbr></span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +                                                                                                                  </span>
<span class="8863382991069320815" onmouseenter="enter('8863382991069320815');" onmouseout="out('8863382991069320815');" style=""> 134                  Object yid = yarnSessionConfProperties.get(&quot;yid&quot;);                                                </span>
<span  style=""> 135                                                                                                                    </span>
<span class="-8848781777370597992" onmouseenter="enter('-8848781777370597992');" onmouseout="out('-8848781777370597992');" style=""> 136                  if (null != yid) {                                                                                </span>
<span class="-6322388926542920640" onmouseenter="enter('-6322388926542920640');" onmouseout="out('-6322388926542920640');" style=""> 137                      applicationId = toApplicationId(yid.toString());                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 138                  } else {                                                                                          </span>
<span class="-1125803419217936962" onmouseenter="enter('-1125803419217936962');" onmouseout="out('-1125803419217936962');" style=""> 139                      applicationId = getYarnClusterApplicationId(yarnClient);                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140                  }                                                                                                 </span>
<span  style=""> 141                                                                                                                    </span>
<span class="-6552011762599352522" onmouseenter="enter('-6552011762599352522');" onmouseout="out('-6552011762599352522');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 142 -                Log.info(&quot;applicationId={}&quot;, applicationId.toString());                                           </span>
<span class="2782241111845053045" onmouseenter="enter('2782241111845053045');" onmouseout="out('2782241111845053045');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +                LOG.info(&quot;current applicationId = {}&quot;, applicationId.toString());                                 </span>
<span  style=""> 144                                                                                                                    </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style=""> 145                  if (StringUtils.isEmpty(applicationId.toString())) {                                              </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 146                      throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147                  }                                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +                                                                                                                  </span>
<span class="531036869131629996" onmouseenter="enter('531036869131629996');" onmouseout="out('531036869131629996');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +                isHighAvailability = config.getString(HIGH_AVAILABILITY, NODE).equals(ZOOKEEPER);                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +                                                                                                                  </span>
<span class="-4042001981978397381" onmouseenter="enter('-4042001981978397381');" onmouseout="out('-4042001981978397381');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +                if (isHighAvailability &amp;&amp; config.getString(HA_CLUSTER_ID, null) == null) {                        </span>
<span class="1242336459937762287" onmouseenter="enter('1242336459937762287');" onmouseout="out('1242336459937762287');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +                    config.setString(HA_CLUSTER_ID, applicationId.toString());                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +                }                                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +                                                                                                                  </span>
<span class="-5970023754216306456" onmouseenter="enter('-5970023754216306456');" onmouseout="out('-5970023754216306456');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +                LOG.info(&quot;------------config params-------------------------&quot;);                                   </span>
<span class="-1891084833916369881" onmouseenter="enter('-1891084833916369881');" onmouseout="out('-1891084833916369881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +                config.toMap().forEach((key, value) -&gt; LOG.info(&quot;{}: {}&quot;, key, value));                           </span>
<span class="-5645378626787136229" onmouseenter="enter('-5645378626787136229');" onmouseout="out('-5645378626787136229');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 157 +                LOG.info(&quot;-------------------------------------------&quot;);                                          </span>
<span  style=""> 158                                                                                                                    </span>
<span class="-6816091760091632163" onmouseenter="enter('-6816091760091632163');" onmouseout="out('-6816091760091632163');" style=""><abbr title=" 159                  AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinkConfDir, yarnClient, false);"> 159                  AbstractYarnClusterDescriptor clusterDescriptor = new YarnClusterDescriptor(config, yarnConf, flinðŸ”µ</abbr></span>
<span class="7284485832444382760" onmouseenter="enter('7284485832444382760');" onmouseout="out('7284485832444382760');" style=""> 160                  ClusterClient clusterClient = clusterDescriptor.retrieve(applicationId);                          </span>
<span class="8856842810407623857" onmouseenter="enter('8856842810407623857');" onmouseout="out('8856842810407623857');" style=""> 161                  clusterClient.setDetached(true);                                                                  </span>
<span class="8761992775896305827" onmouseenter="enter('8761992775896305827');" onmouseout="out('8761992775896305827');" style=""> 162                  return clusterClient;                                                                             </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 163              } catch (Exception e) {                                                                               </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 164                  throw new RuntimeException(e);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165              }                                                                                                     </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -        }else{                                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +        } else {                                                                                                  </span>
<span class="-818626197127626055" onmouseenter="enter('-818626197127626055');" onmouseout="out('-818626197127626055');" style=""> 168              throw new RuntimeException(&quot;yarn mode must set param of &#x27;yarnconf&#x27;!!!&quot;);                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170      }                                                                                                             </span>
<span  style=""> 171                                                                                                                    </span>
<span  style=""> 172                                                                                                                    </span>
<span class="4520585383857802787" onmouseenter="enter('4520585383857802787');" onmouseout="out('4520585383857802787');" style=""> 173      private static ApplicationId getYarnClusterApplicationId(YarnClient yarnClient) throws Exception {            </span>
<span class="-1988801364953419650" onmouseenter="enter('-1988801364953419650');" onmouseout="out('-1988801364953419650');" style=""> 174          ApplicationId applicationId = null;                                                                       </span>
<span  style=""> 175                                                                                                                    </span>
<span class="-8169037907797863140" onmouseenter="enter('-8169037907797863140');" onmouseout="out('-8169037907797863140');" style=""> 176          Set&lt;String&gt; set = new HashSet&lt;&gt;();                                                                        </span>
<span class="1611340247917691443" onmouseenter="enter('1611340247917691443');" onmouseout="out('1611340247917691443');" style=""> 177          set.add(&quot;Apache Flink&quot;);                                                                                  </span>
<span class="5540355505413622998" onmouseenter="enter('5540355505413622998');" onmouseout="out('5540355505413622998');" style=""> 178          EnumSet&lt;YarnApplicationState&gt; enumSet = EnumSet.noneOf(YarnApplicationState.class);                       </span>
<span class="4582984779835017200" onmouseenter="enter('4582984779835017200');" onmouseout="out('4582984779835017200');" style=""> 179          enumSet.add(YarnApplicationState.RUNNING);                                                                </span>
<span class="1830734000385452214" onmouseenter="enter('1830734000385452214');" onmouseout="out('1830734000385452214');" style=""> 180          List&lt;ApplicationReport&gt; reportList = yarnClient.getApplications(set, enumSet);                            </span>
<span  style=""> 181                                                                                                                    </span>
<span class="-369447775955784899" onmouseenter="enter('-369447775955784899');" onmouseout="out('-369447775955784899');" style=""> 182          int maxMemory = -1;                                                                                       </span>
<span class="-4846585872764251675" onmouseenter="enter('-4846585872764251675');" onmouseout="out('-4846585872764251675');" style=""> 183          int maxCores = -1;                                                                                        </span>
<span class="6886164409438478920" onmouseenter="enter('6886164409438478920');" onmouseout="out('6886164409438478920');" style=""> 184          for (ApplicationReport report : reportList) {                                                             </span>
<span class="-424772390849256809" onmouseenter="enter('-424772390849256809');" onmouseout="out('-424772390849256809');" style=""> 185              if (!report.getName().startsWith(&quot;Flink session&quot;)) {                                                  </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 186                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187              }                                                                                                     </span>
<span  style=""> 188                                                                                                                    </span>
<span class="1235099662322490241" onmouseenter="enter('1235099662322490241');" onmouseout="out('1235099662322490241');" style=""> 189              if (!report.getYarnApplicationState().equals(YarnApplicationState.RUNNING)) {                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 190                  continue;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191              }                                                                                                     </span>
<span  style=""> 192                                                                                                                    </span>
<span class="4956299878435728516" onmouseenter="enter('4956299878435728516');" onmouseout="out('4956299878435728516');" style=""> 193              int thisMemory = report.getApplicationResourceUsageReport().getNeededResources().getMemory();         </span>
<span class="-1408027150422172031" onmouseenter="enter('-1408027150422172031');" onmouseout="out('-1408027150422172031');" style=""> 194              int thisCores = report.getApplicationResourceUsageReport().getNeededResources().getVirtualCores();    </span>
<span class="5717156388718347421" onmouseenter="enter('5717156388718347421');" onmouseout="out('5717156388718347421');" style=""> 195              if (thisMemory &gt; maxMemory || thisMemory == maxMemory &amp;&amp; thisCores &gt; maxCores) {                      </span>
<span class="393893018308938162" onmouseenter="enter('393893018308938162');" onmouseout="out('393893018308938162');" style=""> 196                  maxMemory = thisMemory;                                                                           </span>
<span class="-6641939115520661476" onmouseenter="enter('-6641939115520661476');" onmouseout="out('-6641939115520661476');" style=""> 197                  maxCores = thisCores;                                                                             </span>
<span class="-2782692697137135125" onmouseenter="enter('-2782692697137135125');" onmouseout="out('-2782692697137135125');" style=""> 198                  applicationId = report.getApplicationId();                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199              }                                                                                                     </span>
<span  style=""> 200                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201          }                                                                                                         </span>
<span  style=""> 202                                                                                                                    </span>
<span class="-1974314392375997958" onmouseenter="enter('-1974314392375997958');" onmouseout="out('-1974314392375997958');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 203 -        if (StringUtils.isEmpty(applicationId.toString())) {                                                      </span>
<span class="8874933916351401024" onmouseenter="enter('8874933916351401024');" onmouseout="out('8874933916351401024');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 204 +        if (applicationId == null || StringUtils.isEmpty(applicationId.toString())) {                             </span>
<span class="-4049138406935577989" onmouseenter="enter('-4049138406935577989');" onmouseout="out('-4049138406935577989');" style=""> 205              throw new RuntimeException(&quot;No flink session found on yarn cluster.&quot;);                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206          }                                                                                                         </span>
<span class="5985572316486027976" onmouseenter="enter('5985572316486027976');" onmouseout="out('5985572316486027976');" style=""> 207          return applicationId;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208      }                                                                                                             </span>
<span  style=""> 209                                                                                                                    </span>
<span class="-4507162632467603669" onmouseenter="enter('-4507162632467603669');" onmouseout="out('-4507162632467603669');" style=""> 210      private static ApplicationId toApplicationId(String appIdStr) {                                               </span>
<span class="4229427001454084170" onmouseenter="enter('4229427001454084170');" onmouseout="out('4229427001454084170');" style=""> 211          Iterator&lt;String&gt; it = StringHelper._split(appIdStr).iterator();                                           </span>
<span class="5406390625905078860" onmouseenter="enter('5406390625905078860');" onmouseout="out('5406390625905078860');" style=""> 212          if (!&quot;application&quot;.equals(it.next())) {                                                                   </span>
<span class="8668152551389785899" onmouseenter="enter('8668152551389785899');" onmouseout="out('8668152551389785899');" style=""><abbr title=" 213              throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicationId should start with prefix &quot; + &quot;application&quot;);"> 213              throw new IllegalArgumentException(&quot;Invalid ApplicationId prefix: &quot; + appIdStr + &quot;. The valid ApplicatðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 214          } else {                                                                                                  </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 215              try {                                                                                                 </span>
<span class="7789939610237528981" onmouseenter="enter('7789939610237528981');" onmouseout="out('7789939610237528981');" style=""> 216                  return toApplicationId(it);                                                                       </span>
<span class="7366941412324817508" onmouseenter="enter('7366941412324817508');" onmouseout="out('7366941412324817508');" style=""> 217              } catch (NumberFormatException e) {                                                                   </span>
<span class="1796865554742970225" onmouseenter="enter('1796865554742970225');" onmouseout="out('1796865554742970225');" style=""> 218                  throw new IllegalArgumentException(&quot;Invalid AppAttemptId: &quot; + appIdStr, e);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221      }                                                                                                             </span>
<span  style=""> 222                                                                                                                    </span>
<span class="1367086786860425516" onmouseenter="enter('1367086786860425516');" onmouseout="out('1367086786860425516');" style=""> 223      private static ApplicationId toApplicationId(Iterator&lt;String&gt; it) throws NumberFormatException {              </span>
<span class="-2928988115653544018" onmouseenter="enter('-2928988115653544018');" onmouseout="out('-2928988115653544018');" style=""> 224          return ApplicationId.newInstance(Long.parseLong(it.next()), Integer.parseInt(it.next()));                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225      }                                                                                                             </span>
<span  style=""> 226                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            