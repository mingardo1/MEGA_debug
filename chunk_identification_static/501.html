<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>501</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    501
                    <a href="500.html">prev</a>
                    <a href="502.html">next</a>
                    <a href="501_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    ElderDrivers/EdXposedManager_03dd1a70a539bc62e13e3ec63660edbb7695cd07_app/src/main/java/de/robv/android/xposed/installer/installation/StatusInstallerFragment.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\ElderDrivers\EdXposedManager show &quot;03dd1a70a539bc62e13e3ec63660edbb7695cd07:app/src/main/java/de/robv/android/xposed/installer/installation/StatusInstallerFragment.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\ElderDrivers\EdXposedManager show &quot;03dd1a70a539bc62e13e3ec63660edbb7695cd07^1:app/src/main/java/de/robv/android/xposed/installer/installation/StatusInstallerFragment.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\ElderDrivers\EdXposedManager show &quot;03dd1a70a539bc62e13e3ec63660edbb7695cd07^2:app/src/main/java/de/robv/android/xposed/installer/installation/StatusInstallerFragment.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\ElderDrivers\EdXposedManager show &quot;88b5afffedd6deced5705e63d0589926d888f6f8:app/src/main/java/de/robv/android/xposed/installer/installation/StatusInstallerFragment.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj]], subset: [[bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 package de.robv.android.xposed.installer.installation;
   2 
   3 import android.Manifest;
   4 import android.annotation.SuppressLint;
   5 import android.app.Activity;
   6 import android.content.Context;
   7 import android.content.Intent;
   8 import android.content.pm.PackageManager;
   9 import android.net.Uri;
  10 import android.os.Build;
  11 import android.os.Bundle;
  12 import android.os.Environment;
  13 import android.os.Handler;
  14 import android.support.annotation.NonNull;
  15 import android.support.annotation.Nullable;
  16 import android.support.design.widget.Snackbar;
  17 import android.support.v4.app.ActivityCompat;
  18 import android.support.v4.app.Fragment;
  19 import android.support.v7.widget.SwitchCompat;
  20 import android.text.Html;
  21 import android.util.Log;
  22 import android.view.LayoutInflater;
  23 import android.view.View;
  24 import android.view.ViewGroup;
  25 import android.widget.CompoundButton;
  26 import android.widget.ImageView;
  27 import android.widget.TextView;
  28 import android.widget.Toast;
  29 
  30 import com.afollestad.materialdialogs.DialogAction;
  31 import com.afollestad.materialdialogs.MaterialDialog;
  32 
  33 import java.io.BufferedReader;
  34 import java.io.File;
  35 import java.io.FileReader;
  36 import java.io.IOException;
  37 
  38 import de.robv.android.xposed.installer.R;
  39 import de.robv.android.xposed.installer.XposedApp;
  40 import de.robv.android.xposed.installer.util.DownloadsUtil;
  41 import de.robv.android.xposed.installer.util.NavUtil;
  42 
  43 import static de.robv.android.xposed.installer.XposedApp.WRITE_EXTERNAL_PERMISSION;
  44 
  45 public class StatusInstallerFragment extends Fragment {
  46 
  47     public static final File DISABLE_FILE = new File(XposedApp.BASE_DIR + &quot;conf/disabled&quot;);
  48     public static String ARCH = getArch();
  49     private static Activity sActivity;
  50     private static Fragment sFragment;
  51     private static String mUpdateLink;
  52     private static ImageView mErrorIcon;
  53     private static View mUpdateView;
  54     private static View mUpdateButton;
  55     private static TextView mErrorTv;
  56     private static boolean isXposedInstalled = false;
  57     private TextView txtKnownIssue;
  58 
  59     public static void setError(boolean connectionFailed, boolean noSdks) {
  60         if (!connectionFailed &amp;&amp; !noSdks) {
  61             if (isXposedInstalled) return;
  62             return;
  63         }
  64 
  65         mErrorTv.setVisibility(View.VISIBLE);
  66         mErrorIcon.setVisibility(View.VISIBLE);
  67         if (noSdks) {
<abbr title="  68             mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning_grey));">  68             mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning_grey))ðŸ”µ</abbr>
<abbr title="  69             mErrorTv.setText(String.format(sActivity.getString(R.string.phone_not_compatible), Build.VERSION.SDK_INT, Build.CPU_ABI));">  69             mErrorTv.setText(String.format(sActivity.getString(R.string.phone_not_compatible), Build.VERSðŸ”µ</abbr>
  70         }
  71         if (connectionFailed) {
<abbr title="  72             mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_no_connection));">  72             mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_no_connection)ðŸ”µ</abbr>
  73             mErrorTv.setText(sActivity.getString(R.string.loadingError));
  74         }
  75     }
  76 
  77     public static void setUpdate(final String link, final String changelog) {
  78         mUpdateLink = link;
  79 
  80         mUpdateView.setVisibility(View.VISIBLE);
  81         mUpdateButton.setVisibility(View.VISIBLE);
  82         mUpdateButton.setOnClickListener(new View.OnClickListener() {
  83             @Override
  84             public void onClick(View v) {
  85 
  86                 new MaterialDialog.Builder(sActivity)
  87                         .title(R.string.changes)
  88                         .content(Html.fromHtml(changelog))
  89                         .onPositive(new MaterialDialog.SingleButtonCallback() {
  90                             @Override
<abbr title="  91                             public void onClick(@NonNull MaterialDialog dialog, @NonNull DialogAction which) {">  91                             public void onClick(@NonNull MaterialDialog dialog, @NonNull DialogAction whiðŸ”µ</abbr>
  92                                 update();
  93                             }
  94                         })
  95                         .positiveText(R.string.update)
  96                         .negativeText(R.string.later).show();
  97             }
  98         });
  99     }
 100 
 101     private static void update() {
 102         if (checkPermissions()) return;
 103 
<abbr title=" 104         final String path = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/XposedInstaller/XposedInstaller_by_dvdandroid.apk&quot;;"> 104         final String path = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/XposedInstallðŸ”µ</abbr>
 105 
 106         new File(path).delete();
 107 
<abbr title=" 108         DownloadsUtil.add(sActivity, &quot;XposedInstaller_by_dvdandroid&quot;, mUpdateLink, new DownloadsUtil.DownloadFinishedCallback() {"> 108         DownloadsUtil.add(sActivity, &quot;XposedInstaller_by_dvdandroid&quot;, mUpdateLink, new DownloadsUtil.DownðŸ”µ</abbr>
 109             @Override
 110             public void onDownloadFinished(Context context, DownloadsUtil.DownloadInfo info) {
 111 
 112                 Intent intent = new Intent(Intent.ACTION_VIEW);
 113                 intent.setDataAndType(Uri.fromFile(new File(path)), DownloadsUtil.MIME_TYPE_APK);
 114                 intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
 115                 context.startActivity(intent);
 116             }
 117         }, DownloadsUtil.MIME_TYPES.APK, true);
 118     }
 119 
 120     private static boolean checkPermissions() {
 121         if (Build.VERSION.SDK_INT &lt; 23) return false;
 122 
<abbr title=" 123         if (ActivityCompat.checkSelfPermission(sActivity, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {"> 123         if (ActivityCompat.checkSelfPermission(sActivity, Manifest.permission.WRITE_EXTERNAL_STORAGE) != ðŸ”µ</abbr>
<abbr title=" 124             sFragment.requestPermissions(new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, WRITE_EXTERNAL_PERMISSION);"> 124             sFragment.requestPermissions(new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, WRITE_ðŸ”µ</abbr>
 125             return true;
 126         }
 127         return false;
 128     }
 129 
 130     private static boolean checkClassExists(String className) {
 131         try {
 132             Class.forName(className);
 133             return true;
 134         } catch (ClassNotFoundException e) {
 135             return false;
 136         }
 137     }
 138 
 139     private static String getCompleteArch() {
 140         String info = &quot;&quot;;
 141 
 142         try {
 143             FileReader fr = new FileReader(&quot;/proc/cpuinfo&quot;);
 144             BufferedReader br = new BufferedReader(fr);
 145             String text;
 146             while ((text = br.readLine()) != null) {
 147                 if (!text.startsWith(&quot;processor&quot;)) break;
 148             }
 149             br.close();
 150             String[] array = text != null ? text.split(&quot;:\\s+&quot;, 2) : new String[0];
 151             if (array.length &gt;= 2) {
 152                 info += array[1] + &quot; &quot;;
 153             }
 154         } catch (IOException ignored) {
 155         }
 156 
 157         if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
 158             info += Build.SUPPORTED_ABIS[0];
 159         } else {
 160             String arch = System.getenv(&quot;os.arch&quot;);
 161             if (arch != null) info += arch;
 162         }
 163         return info + &quot; (&quot; + getArch() + &quot;)&quot;;
 164     }
 165 
 166     @SuppressWarnings(&quot;deprecation&quot;)
 167     private static String getArch() {
 168         if (Build.CPU_ABI.equals(&quot;arm64-v8a&quot;)) {
 169             return &quot;arm64&quot;;
 170         } else if (Build.CPU_ABI.equals(&quot;x86_64&quot;)) {
 171             return &quot;x86_64&quot;;
 172         } else if (Build.CPU_ABI.equals(&quot;mips64&quot;)) {
 173             return &quot;mips64&quot;;
 174         } else if (Build.CPU_ABI.startsWith(&quot;x86&quot;) || Build.CPU_ABI2.startsWith(&quot;x86&quot;)) {
 175             return &quot;x86&quot;;
 176         } else if (Build.CPU_ABI.startsWith(&quot;mips&quot;)) {
 177             return &quot;mips&quot;;
 178         } else if (Build.CPU_ABI.startsWith(&quot;armeabi-v5&quot;) || Build.CPU_ABI.startsWith(&quot;armeabi-v6&quot;)) {
 179             return &quot;armv5&quot;;
 180         } else {
 181             return &quot;arm&quot;;
 182         }
 183     }
 184 
 185     @Override
 186     public void onCreate(@Nullable Bundle savedInstanceState) {
 187         super.onCreate(savedInstanceState);
 188 
 189         sActivity = getActivity();
 190         sFragment = this;
 191     }
 192 
 193     @Override
<abbr title=" 194     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {"> 194     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[]ðŸ”µ</abbr>
 195         super.onRequestPermissionsResult(requestCode, permissions, grantResults);
 196         if (requestCode == WRITE_EXTERNAL_PERMISSION) {
 197             if (grantResults.length == 1 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {
 198                 new Handler().postDelayed(new Runnable() {
 199                     @Override
 200                     public void run() {
 201                         update();
 202                     }
 203                 }, 500);
 204             } else {
 205                 Toast.makeText(getActivity(), R.string.permissionNotGranted, Toast.LENGTH_LONG).show();
 206             }
 207         }
 208     }
 209 
 210     @Override
<abbr title=" 211     public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {"> 211     public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savðŸ”µ</abbr>
 212         View v = inflater.inflate(R.layout.status_installer, container, false);
 213 
 214         mErrorIcon = v.findViewById(R.id.errorIcon);
 215         mErrorTv = v.findViewById(R.id.errorTv);
 216         mUpdateView = v.findViewById(R.id.updateView);
 217         mUpdateButton = v.findViewById(R.id.click_to_update);
 218 
 219         txtKnownIssue = v.findViewById(R.id.framework_known_issue);
 220 
 221         TextView txtInstallError = v.findViewById(R.id.framework_install_errors);
 222         View txtInstallContainer = v.findViewById(R.id.status_container);
 223         ImageView txtInstallIcon = v.findViewById(R.id.status_icon);
 224 
 225         String installedXposedVersion;
 226         try {
 227             installedXposedVersion= XposedApp.getXposedProp().getVersion();
 228         } catch (NullPointerException e) {
 229             installedXposedVersion = null;
 230         }
 231 
 232         View disableView = v.findViewById(R.id.disableView);
 233         final SwitchCompat xposedDisable = v.findViewById(R.id.disableSwitch);
 234 
 235         TextView androidSdk = v.findViewById(R.id.android_version);
 236         TextView manufacturer = v.findViewById(R.id.ic_manufacturer);
 237         TextView cpu = v.findViewById(R.id.cpu);
 238 
 239 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
 240 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241         TextView androidSdk = (TextView) v.findViewById(R.id.android_version);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242         TextView manufacturer = (TextView) v.findViewById(R.id.ic_manufacturer);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243         TextView cpu = (TextView) v.findViewById(R.id.cpu);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245         mHintContainer = v.findViewById(R.id.hint_container);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246         mHint = (TextView) v.findViewById(R.id.hint);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247 </span>
 248 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249         mHintContainer = v.findViewById(R.id.hint_container);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250         mHint = v.findViewById(R.id.hint);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251 </span>
 252 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 253         if (Build.VERSION.SDK_INT &gt;= 21) {
 254             if (installedXposedVersion != null) {
 255                 int installedXposedVersionInt = extractIntPart(installedXposedVersion);
 256                 if (installedXposedVersionInt == XposedApp.getXposedVersion()) {
<abbr title=" 257                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, installedXposedVersion));"> 257                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, installedXpoðŸ”µ</abbr>
<abbr title=" 258                     txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green));"> 258                     txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green))ðŸ”µ</abbr>
<abbr title=" 259                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_green));"> 259                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darkðŸ”µ</abbr>
<abbr title=" 260                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_circle));"> 260                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_chðŸ”µ</abbr>
 261                     isXposedInstalled = true;
 262                 } else {
<abbr title=" 263                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, installedXposedVersion));"> 263                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, insðŸ”µ</abbr>
 264                     txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.amber_500));
<abbr title=" 265                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.amber_500));"> 265                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.ambeðŸ”µ</abbr>
<abbr title=" 266                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning));"> 266                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_waðŸ”µ</abbr>
 267                 }
 268             } else {
 269                 txtInstallError.setText(R.string.not_installed_no_lollipop);
 270                 txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.warning));
<abbr title=" 271                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning));"> 271                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning)ðŸ”µ</abbr>
<abbr title=" 272                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error));"> 272                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error)ðŸ”µ</abbr>
 273                 xposedDisable.setVisibility(View.GONE);
 274                 disableView.setVisibility(View.GONE);
 275             }
 276         } else {
 277             int installedXposedVersionInt = XposedApp.getXposedVersion();
 278             if (installedXposedVersionInt != 0) {
<abbr title=" 279                 txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, &quot;&quot; + installedXposedVersionInt));"> 279                 txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, &quot;&quot; + installedXpðŸ”µ</abbr>
 280                 txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green));
<abbr title=" 281                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_green));"> 281                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_gðŸ”µ</abbr>
<abbr title=" 282                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_circle));"> 282                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_ðŸ”µ</abbr>
 283                 isXposedInstalled = true;
 284                 if (DISABLE_FILE.exists()) {
<abbr title=" 285                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, &quot;&quot; + installedXposedVersionInt));"> 285                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, &quot;&quot; ðŸ”µ</abbr>
 286                     txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.amber_500));
<abbr title=" 287                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.amber_500));"> 287                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.ambeðŸ”µ</abbr>
<abbr title=" 288                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning));"> 288                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_waðŸ”µ</abbr>
 289                 }
 290             } else {
 291                 txtInstallError.setText(sActivity.getString(R.string.not_installed_no_lollipop));
 292                 txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.warning));
<abbr title=" 293                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning));"> 293                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning)ðŸ”µ</abbr>
<abbr title=" 294                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error));"> 294                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error)ðŸ”µ</abbr>
 295                 xposedDisable.setVisibility(View.GONE);
 296                 disableView.setVisibility(View.GONE);
 297             }
 298         }
 299 
 300         xposedDisable.setChecked(!DISABLE_FILE.exists());
 301 
 302         xposedDisable.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
 303             @Override
 304             public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
 305                 if (DISABLE_FILE.exists()) {
 306                     DISABLE_FILE.delete();
<abbr title=" 307                     Snackbar.make(xposedDisable, R.string.xposed_on_next_reboot, Snackbar.LENGTH_LONG).show();"> 307                     Snackbar.make(xposedDisable, R.string.xposed_on_next_reboot, Snackbar.LENGTH_LONG).shðŸ”µ</abbr>
 308                 } else {
 309                     try {
 310                         DISABLE_FILE.createNewFile();
<abbr title=" 311                         Snackbar.make(xposedDisable, R.string.xposed_off_next_reboot, Snackbar.LENGTH_LONG).show();"> 311                         Snackbar.make(xposedDisable, R.string.xposed_off_next_reboot, Snackbar.LENGTH_LONðŸ”µ</abbr>
 312                     } catch (IOException e) {
 313                         Log.e(XposedApp.TAG, &quot;StatusInstallerFragment -&gt; &quot; + e.getMessage());
 314                     }
 315                 }
 316             }
 317         });
 318 
<abbr title=" 319         androidSdk.setText(getString(R.string.android_sdk, getAndroidVersion(), Build.VERSION.RELEASE, Build.VERSION.SDK_INT));"> 319         androidSdk.setText(getString(R.string.android_sdk, getAndroidVersion(), Build.VERSION.RELEASE, BuðŸ”µ</abbr>
 320         manufacturer.setText(getUIFramework());
 321         cpu.setText(getCompleteArch());
 322 
 323         refreshKnownIssue();
 324         return v;
 325     }
 326 
 327     @SuppressLint(&quot;StringFormatInvalid&quot;)
 328     private void refreshKnownIssue() {
 329         String issueName = null;
 330         String issueLink = null;
 331 
 332         if (new File(&quot;/system/framework/core.jar.jex&quot;).exists()) {
 333             issueName = &quot;Aliyun OS&quot;;
 334             issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52289793&amp;postcount=5&quot;;
 335 
<abbr title=" 336         } else if (new File(&quot;/data/miui/DexspyInstaller.jar&quot;).exists() || checkClassExists(&quot;miui.dexspy.DexspyInstaller&quot;)) {"> 336         } else if (new File(&quot;/data/miui/DexspyInstaller.jar&quot;).exists() || checkClassExists(&quot;miui.dexspy.DðŸ”µ</abbr>
 337             issueName = &quot;MIUI/Dexspy&quot;;
 338             issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52291098&amp;postcount=6&quot;;
 339 
 340         } else if (checkClassExists(&quot;com.huawei.android.content.res.ResourcesEx&quot;)
 341                 || checkClassExists(&quot;android.content.res.NubiaResources&quot;)) {
 342             issueName = &quot;Resources subclass&quot;;
 343             issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52801382&amp;postcount=8&quot;;
 344         }
 345 
 346         if (issueName != null) {
 347             final String issueLinkFinal = issueLink;
 348             txtKnownIssue.setText(getString(R.string.install_known_issue, issueName));
 349             txtKnownIssue.setVisibility(View.VISIBLE);
 350             txtKnownIssue.setOnClickListener(new View.OnClickListener() {
 351                 @Override
 352                 public void onClick(View v) {
 353                     NavUtil.startURL(getActivity(), issueLinkFinal);
 354                 }
 355             });
 356         } else {
 357             txtKnownIssue.setVisibility(View.GONE);
 358         }
 359     }
 360 
 361     private String getAndroidVersion() {
 362         switch (Build.VERSION.SDK_INT) {
 363             case 16:
 364             case 17:
 365             case 18:
 366                 return &quot;Jelly Bean&quot;;
 367             case 19:
 368                 return &quot;KitKat&quot;;
 369             case 21:
 370             case 22:
 371                 return &quot;Lollipop&quot;;
 372             case 23:
 373                 return &quot;Marshmallow&quot;;
 374             case 24:
 375             case 25:
 376                 return &quot;Nougat&quot;;
 377         }
 378         return &quot;&quot;;
 379     }
 380 
 381     private String getUIFramework() {
<abbr title=" 382         String manufacturer = Character.toUpperCase(Build.MANUFACTURER.charAt(0)) + Build.MANUFACTURER.substring(1);"> 382         String manufacturer = Character.toUpperCase(Build.MANUFACTURER.charAt(0)) + Build.MANUFACTURER.suðŸ”µ</abbr>
 383         if (!Build.BRAND.equals(Build.MANUFACTURER)) {
<abbr title=" 384             manufacturer += &quot; &quot; + Character.toUpperCase(Build.BRAND.charAt(0)) + Build.BRAND.substring(1);"> 384             manufacturer += &quot; &quot; + Character.toUpperCase(Build.BRAND.charAt(0)) + Build.BRAND.substring(1)ðŸ”µ</abbr>
 385         }
 386         manufacturer += &quot; &quot; + Build.MODEL + &quot; &quot;;
 387         if (manufacturer.contains(&quot;Samsung&quot;)) {
<abbr title=" 388             manufacturer += new File(&quot;/system/framework/twframework.jar&quot;).exists() ? &quot;(TouchWiz)&quot; : &quot;(AOSP-based ROM)&quot;;"> 388             manufacturer += new File(&quot;/system/framework/twframework.jar&quot;).exists() ? &quot;(TouchWiz)&quot; : &quot;(AOSðŸ”µ</abbr>
 389         } else if (manufacturer.contains(&quot;Xiaomi&quot;)) {
<abbr title=" 390             manufacturer += new File(&quot;/system/framework/framework-miui-res.apk&quot;).exists() ? &quot;(MIUI)&quot; : &quot;(AOSP-based ROM)&quot;;"> 390             manufacturer += new File(&quot;/system/framework/framework-miui-res.apk&quot;).exists() ? &quot;(MIUI)&quot; : &quot;(ðŸ”µ</abbr>
 391         }
 392         return manufacturer;
 393     }
 394 
 395     private int extractIntPart(String str) {
 396         int result = 0, length = str.length();
 397         for (int offset = 0; offset &lt; length; offset++) {
 398             char c = str.charAt(offset);
 399             if (&#x27;0&#x27; &lt;= c &amp;&amp; c &lt;= &#x27;9&#x27;)
 400                 result = result * 10 + (c - &#x27;0&#x27;);
 401             else
 402                 break;
 403         }
 404         return result;
 405     }
 406 }</pre></td>
                            <td><pre>   1 package de.robv.android.xposed.installer.installation;
   2 
   3 import android.Manifest;
   4 import android.annotation.SuppressLint;
   5 import android.app.Activity;
   6 import android.content.Context;
   7 import android.content.Intent;
   8 import android.content.pm.PackageManager;
   9 import android.net.Uri;
  10 import android.os.Build;
  11 import android.os.Bundle;
  12 import android.os.Environment;
  13 import android.os.Handler;
  14 import android.support.annotation.NonNull;
  15 import android.support.annotation.Nullable;
  16 import android.support.design.widget.Snackbar;
  17 import android.support.v4.app.ActivityCompat;
  18 import android.support.v4.app.Fragment;
  19 import android.support.v7.widget.SwitchCompat;
  20 import android.text.Html;
  21 import android.util.Log;
  22 import android.view.LayoutInflater;
  23 import android.view.View;
  24 import android.view.ViewGroup;
  25 import android.widget.CompoundButton;
  26 import android.widget.ImageView;
  27 import android.widget.TextView;
  28 import android.widget.Toast;
  29 
  30 import com.afollestad.materialdialogs.DialogAction;
  31 import com.afollestad.materialdialogs.MaterialDialog;
  32 
  33 import java.io.BufferedReader;
  34 import java.io.File;
  35 import java.io.FileReader;
  36 import java.io.IOException;
  37 
  38 import de.robv.android.xposed.installer.R;
  39 import de.robv.android.xposed.installer.XposedApp;
  40 import de.robv.android.xposed.installer.util.DownloadsUtil;
  41 import de.robv.android.xposed.installer.util.NavUtil;
  42 
  43 import static de.robv.android.xposed.installer.XposedApp.WRITE_EXTERNAL_PERMISSION;
  44 
  45 public class StatusInstallerFragment extends Fragment {
  46 
  47     public static final File DISABLE_FILE = new File(XposedApp.BASE_DIR + &quot;conf/disabled&quot;);
  48     public static String ARCH = getArch();
  49     private static Activity sActivity;
  50     private static Fragment sFragment;
  51     private static String mUpdateLink;
  52     private static ImageView mErrorIcon;
  53     private static View mUpdateView;
  54     private static View mUpdateButton;
  55     private static TextView mErrorTv;
  56     private static boolean isXposedInstalled = false;
  57     private TextView txtKnownIssue;
  58 
  59     public static void setError(boolean connectionFailed, boolean noSdks) {
  60         if (!connectionFailed &amp;&amp; !noSdks) {
  61             if (isXposedInstalled) return;
  62             return;
  63         }
  64 
  65         mErrorTv.setVisibility(View.VISIBLE);
  66         mErrorIcon.setVisibility(View.VISIBLE);
  67         if (noSdks) {
<abbr title="  68             mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning_grey));">  68             mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning_grey))ðŸ”µ</abbr>
<abbr title="  69             mErrorTv.setText(String.format(sActivity.getString(R.string.phone_not_compatible), Build.VERSION.SDK_INT, Build.CPU_ABI));">  69             mErrorTv.setText(String.format(sActivity.getString(R.string.phone_not_compatible), Build.VERSðŸ”µ</abbr>
  70         }
  71         if (connectionFailed) {
<abbr title="  72             mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_no_connection));">  72             mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_no_connection)ðŸ”µ</abbr>
  73             mErrorTv.setText(sActivity.getString(R.string.loadingError));
  74         }
  75     }
  76 
  77     public static void setUpdate(final String link, final String changelog) {
  78         mUpdateLink = link;
  79 
  80         mUpdateView.setVisibility(View.VISIBLE);
  81         mUpdateButton.setVisibility(View.VISIBLE);
  82         mUpdateButton.setOnClickListener(new View.OnClickListener() {
  83             @Override
  84             public void onClick(View v) {
  85 
  86                 new MaterialDialog.Builder(sActivity)
  87                         .title(R.string.changes)
  88                         .content(Html.fromHtml(changelog))
  89                         .onPositive(new MaterialDialog.SingleButtonCallback() {
  90                             @Override
<abbr title="  91                             public void onClick(@NonNull MaterialDialog dialog, @NonNull DialogAction which) {">  91                             public void onClick(@NonNull MaterialDialog dialog, @NonNull DialogAction whiðŸ”µ</abbr>
  92                                 update();
  93                             }
  94                         })
  95                         .positiveText(R.string.update)
  96                         .negativeText(R.string.later).show();
  97             }
  98         });
  99     }
 100 
 101     private static void update() {
 102         if (checkPermissions()) return;
 103 
<abbr title=" 104         final String path = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/XposedInstaller/XposedInstaller_by_dvdandroid.apk&quot;;"> 104         final String path = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/XposedInstallðŸ”µ</abbr>
 105 
 106         new File(path).delete();
 107 
<abbr title=" 108         DownloadsUtil.add(sActivity, &quot;XposedInstaller_by_dvdandroid&quot;, mUpdateLink, new DownloadsUtil.DownloadFinishedCallback() {"> 108         DownloadsUtil.add(sActivity, &quot;XposedInstaller_by_dvdandroid&quot;, mUpdateLink, new DownloadsUtil.DownðŸ”µ</abbr>
 109             @Override
 110             public void onDownloadFinished(Context context, DownloadsUtil.DownloadInfo info) {
 111 
 112                 Intent intent = new Intent(Intent.ACTION_VIEW);
 113                 intent.setDataAndType(Uri.fromFile(new File(path)), DownloadsUtil.MIME_TYPE_APK);
 114                 intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
 115                 context.startActivity(intent);
 116             }
 117         }, DownloadsUtil.MIME_TYPES.APK, true);
 118     }
 119 
 120     private static boolean checkPermissions() {
 121         if (Build.VERSION.SDK_INT &lt; 23) return false;
 122 
<abbr title=" 123         if (ActivityCompat.checkSelfPermission(sActivity, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {"> 123         if (ActivityCompat.checkSelfPermission(sActivity, Manifest.permission.WRITE_EXTERNAL_STORAGE) != ðŸ”µ</abbr>
<abbr title=" 124             sFragment.requestPermissions(new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, WRITE_EXTERNAL_PERMISSION);"> 124             sFragment.requestPermissions(new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, WRITE_ðŸ”µ</abbr>
 125             return true;
 126         }
 127         return false;
 128     }
 129 
 130     private static boolean checkClassExists(String className) {
 131         try {
 132             Class.forName(className);
 133             return true;
 134         } catch (ClassNotFoundException e) {
 135             return false;
 136         }
 137     }
 138 
 139     private static String getCompleteArch() {
 140         String info = &quot;&quot;;
 141 
 142         try {
 143             FileReader fr = new FileReader(&quot;/proc/cpuinfo&quot;);
 144             BufferedReader br = new BufferedReader(fr);
 145             String text;
 146             while ((text = br.readLine()) != null) {
 147                 if (!text.startsWith(&quot;processor&quot;)) break;
 148             }
 149             br.close();
 150             String[] array = text != null ? text.split(&quot;:\\s+&quot;, 2) : new String[0];
 151             if (array.length &gt;= 2) {
 152                 info += array[1] + &quot; &quot;;
 153             }
 154         } catch (IOException ignored) {
 155         }
 156 
 157         if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
 158             info += Build.SUPPORTED_ABIS[0];
 159         } else {
 160             String arch = System.getenv(&quot;os.arch&quot;);
 161             if (arch != null) info += arch;
 162         }
 163         return info + &quot; (&quot; + getArch() + &quot;)&quot;;
 164     }
 165 
 166     @SuppressWarnings(&quot;deprecation&quot;)
 167     private static String getArch() {
 168         if (Build.CPU_ABI.equals(&quot;arm64-v8a&quot;)) {
 169             return &quot;arm64&quot;;
 170         } else if (Build.CPU_ABI.equals(&quot;x86_64&quot;)) {
 171             return &quot;x86_64&quot;;
 172         } else if (Build.CPU_ABI.equals(&quot;mips64&quot;)) {
 173             return &quot;mips64&quot;;
 174         } else if (Build.CPU_ABI.startsWith(&quot;x86&quot;) || Build.CPU_ABI2.startsWith(&quot;x86&quot;)) {
 175             return &quot;x86&quot;;
 176         } else if (Build.CPU_ABI.startsWith(&quot;mips&quot;)) {
 177             return &quot;mips&quot;;
 178         } else if (Build.CPU_ABI.startsWith(&quot;armeabi-v5&quot;) || Build.CPU_ABI.startsWith(&quot;armeabi-v6&quot;)) {
 179             return &quot;armv5&quot;;
 180         } else {
 181             return &quot;arm&quot;;
 182         }
 183     }
 184 
 185     @Override
 186     public void onCreate(@Nullable Bundle savedInstanceState) {
 187         super.onCreate(savedInstanceState);
 188 
 189         sActivity = getActivity();
 190         sFragment = this;
 191     }
 192 
 193     @Override
<abbr title=" 194     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {"> 194     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[]ðŸ”µ</abbr>
 195         super.onRequestPermissionsResult(requestCode, permissions, grantResults);
 196         if (requestCode == WRITE_EXTERNAL_PERMISSION) {
 197             if (grantResults.length == 1 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {
 198                 new Handler().postDelayed(new Runnable() {
 199                     @Override
 200                     public void run() {
 201                         update();
 202                     }
 203                 }, 500);
 204             } else {
 205                 Toast.makeText(getActivity(), R.string.permissionNotGranted, Toast.LENGTH_LONG).show();
 206             }
 207         }
 208     }
 209 
 210     @Override
<abbr title=" 211     public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {"> 211     public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savðŸ”µ</abbr>
 212         View v = inflater.inflate(R.layout.status_installer, container, false);
 213 
 214         mErrorIcon = v.findViewById(R.id.errorIcon);
 215         mErrorTv = v.findViewById(R.id.errorTv);
 216         mUpdateView = v.findViewById(R.id.updateView);
 217         mUpdateButton = v.findViewById(R.id.click_to_update);
 218 
 219         txtKnownIssue = v.findViewById(R.id.framework_known_issue);
 220 
 221         TextView txtInstallError = v.findViewById(R.id.framework_install_errors);
 222         View txtInstallContainer = v.findViewById(R.id.status_container);
 223         ImageView txtInstallIcon = v.findViewById(R.id.status_icon);
 224 
 225         String installedXposedVersion;
 226         try {
 227             installedXposedVersion= XposedApp.getXposedProp().getVersion();
 228         } catch (NullPointerException e) {
 229             installedXposedVersion = null;
 230         }
 231 
 232         View disableView = v.findViewById(R.id.disableView);
 233         final SwitchCompat xposedDisable = v.findViewById(R.id.disableSwitch);
 234 
 235         TextView androidSdk = v.findViewById(R.id.android_version);
 236         TextView manufacturer = v.findViewById(R.id.ic_manufacturer);
 237         TextView cpu = v.findViewById(R.id.cpu);
 238 
 239 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
 240 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241         mHintContainer = v.findViewById(R.id.hint_container);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242         mHint = (TextView) v.findViewById(R.id.hint);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243 </span>
 244 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245         mHintContainer = v.findViewById(R.id.hint_container);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246         mHint = v.findViewById(R.id.hint);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247 </span>
 248 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS
 249         if (Build.VERSION.SDK_INT &gt;= 21) {
 250             if (installedXposedVersion != null) {
 251                 int installedXposedVersionInt = extractIntPart(installedXposedVersion);
 252                 if (installedXposedVersionInt == XposedApp.getXposedVersion()) {
<abbr title=" 253                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, installedXposedVersion));"> 253                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, installedXpoðŸ”µ</abbr>
<abbr title=" 254                     txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green));"> 254                     txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green))ðŸ”µ</abbr>
<abbr title=" 255                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_green));"> 255                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darkðŸ”µ</abbr>
<abbr title=" 256                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_circle));"> 256                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_chðŸ”µ</abbr>
 257                     isXposedInstalled = true;
 258                 } else {
<abbr title=" 259                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, installedXposedVersion));"> 259                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, insðŸ”µ</abbr>
 260                     txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.amber_500));
<abbr title=" 261                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.amber_500));"> 261                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.ambeðŸ”µ</abbr>
<abbr title=" 262                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning));"> 262                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_waðŸ”µ</abbr>
 263                 }
 264             } else {
 265                 txtInstallError.setText(R.string.not_installed_no_lollipop);
 266                 txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.warning));
<abbr title=" 267                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning));"> 267                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning)ðŸ”µ</abbr>
<abbr title=" 268                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error));"> 268                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error)ðŸ”µ</abbr>
 269                 xposedDisable.setVisibility(View.GONE);
 270                 disableView.setVisibility(View.GONE);
 271             }
 272         } else {
 273             int installedXposedVersionInt = XposedApp.getXposedVersion();
 274             if (installedXposedVersionInt != 0) {
<abbr title=" 275                 txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, &quot;&quot; + installedXposedVersionInt));"> 275                 txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, &quot;&quot; + installedXpðŸ”µ</abbr>
 276                 txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green));
<abbr title=" 277                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_green));"> 277                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_gðŸ”µ</abbr>
<abbr title=" 278                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_circle));"> 278                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_ðŸ”µ</abbr>
 279                 isXposedInstalled = true;
 280                 if (DISABLE_FILE.exists()) {
<abbr title=" 281                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, &quot;&quot; + installedXposedVersionInt));"> 281                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, &quot;&quot; ðŸ”µ</abbr>
 282                     txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.amber_500));
<abbr title=" 283                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.amber_500));"> 283                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.ambeðŸ”µ</abbr>
<abbr title=" 284                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning));"> 284                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_waðŸ”µ</abbr>
 285                 }
 286             } else {
 287                 txtInstallError.setText(sActivity.getString(R.string.not_installed_no_lollipop));
 288                 txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.warning));
<abbr title=" 289                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning));"> 289                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning)ðŸ”µ</abbr>
<abbr title=" 290                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error));"> 290                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error)ðŸ”µ</abbr>
 291                 xposedDisable.setVisibility(View.GONE);
 292                 disableView.setVisibility(View.GONE);
 293             }
 294         }
 295 
 296         xposedDisable.setChecked(!DISABLE_FILE.exists());
 297 
 298         xposedDisable.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
 299             @Override
 300             public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
 301                 if (DISABLE_FILE.exists()) {
 302                     DISABLE_FILE.delete();
<abbr title=" 303                     Snackbar.make(xposedDisable, R.string.xposed_on_next_reboot, Snackbar.LENGTH_LONG).show();"> 303                     Snackbar.make(xposedDisable, R.string.xposed_on_next_reboot, Snackbar.LENGTH_LONG).shðŸ”µ</abbr>
 304                 } else {
 305                     try {
 306                         DISABLE_FILE.createNewFile();
<abbr title=" 307                         Snackbar.make(xposedDisable, R.string.xposed_off_next_reboot, Snackbar.LENGTH_LONG).show();"> 307                         Snackbar.make(xposedDisable, R.string.xposed_off_next_reboot, Snackbar.LENGTH_LONðŸ”µ</abbr>
 308                     } catch (IOException e) {
 309                         Log.e(XposedApp.TAG, &quot;StatusInstallerFragment -&gt; &quot; + e.getMessage());
 310                     }
 311                 }
 312             }
 313         });
 314 
<abbr title=" 315         androidSdk.setText(getString(R.string.android_sdk, getAndroidVersion(), Build.VERSION.RELEASE, Build.VERSION.SDK_INT));"> 315         androidSdk.setText(getString(R.string.android_sdk, getAndroidVersion(), Build.VERSION.RELEASE, BuðŸ”µ</abbr>
 316         manufacturer.setText(getUIFramework());
 317         cpu.setText(getCompleteArch());
 318 
 319         refreshKnownIssue();
 320         return v;
 321     }
 322 
 323     @SuppressLint(&quot;StringFormatInvalid&quot;)
 324     private void refreshKnownIssue() {
 325         String issueName = null;
 326         String issueLink = null;
 327 
 328         if (new File(&quot;/system/framework/core.jar.jex&quot;).exists()) {
 329             issueName = &quot;Aliyun OS&quot;;
 330             issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52289793&amp;postcount=5&quot;;
 331 
<abbr title=" 332         } else if (new File(&quot;/data/miui/DexspyInstaller.jar&quot;).exists() || checkClassExists(&quot;miui.dexspy.DexspyInstaller&quot;)) {"> 332         } else if (new File(&quot;/data/miui/DexspyInstaller.jar&quot;).exists() || checkClassExists(&quot;miui.dexspy.DðŸ”µ</abbr>
 333             issueName = &quot;MIUI/Dexspy&quot;;
 334             issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52291098&amp;postcount=6&quot;;
 335 
 336         } else if (checkClassExists(&quot;com.huawei.android.content.res.ResourcesEx&quot;)
 337                 || checkClassExists(&quot;android.content.res.NubiaResources&quot;)) {
 338             issueName = &quot;Resources subclass&quot;;
 339             issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52801382&amp;postcount=8&quot;;
 340         }
 341 
 342         if (issueName != null) {
 343             final String issueLinkFinal = issueLink;
 344             txtKnownIssue.setText(getString(R.string.install_known_issue, issueName));
 345             txtKnownIssue.setVisibility(View.VISIBLE);
 346             txtKnownIssue.setOnClickListener(new View.OnClickListener() {
 347                 @Override
 348                 public void onClick(View v) {
 349                     NavUtil.startURL(getActivity(), issueLinkFinal);
 350                 }
 351             });
 352         } else {
 353             txtKnownIssue.setVisibility(View.GONE);
 354         }
 355     }
 356 
 357     private String getAndroidVersion() {
 358         switch (Build.VERSION.SDK_INT) {
 359             case 16:
 360             case 17:
 361             case 18:
 362                 return &quot;Jelly Bean&quot;;
 363             case 19:
 364                 return &quot;KitKat&quot;;
 365             case 21:
 366             case 22:
 367                 return &quot;Lollipop&quot;;
 368             case 23:
 369                 return &quot;Marshmallow&quot;;
 370             case 24:
 371             case 25:
 372                 return &quot;Nougat&quot;;
 373         }
 374         return &quot;&quot;;
 375     }
 376 
 377     private String getUIFramework() {
<abbr title=" 378         String manufacturer = Character.toUpperCase(Build.MANUFACTURER.charAt(0)) + Build.MANUFACTURER.substring(1);"> 378         String manufacturer = Character.toUpperCase(Build.MANUFACTURER.charAt(0)) + Build.MANUFACTURER.suðŸ”µ</abbr>
 379         if (!Build.BRAND.equals(Build.MANUFACTURER)) {
<abbr title=" 380             manufacturer += &quot; &quot; + Character.toUpperCase(Build.BRAND.charAt(0)) + Build.BRAND.substring(1);"> 380             manufacturer += &quot; &quot; + Character.toUpperCase(Build.BRAND.charAt(0)) + Build.BRAND.substring(1)ðŸ”µ</abbr>
 381         }
 382         manufacturer += &quot; &quot; + Build.MODEL + &quot; &quot;;
 383         if (manufacturer.contains(&quot;Samsung&quot;)) {
<abbr title=" 384             manufacturer += new File(&quot;/system/framework/twframework.jar&quot;).exists() ? &quot;(TouchWiz)&quot; : &quot;(AOSP-based ROM)&quot;;"> 384             manufacturer += new File(&quot;/system/framework/twframework.jar&quot;).exists() ? &quot;(TouchWiz)&quot; : &quot;(AOSðŸ”µ</abbr>
 385         } else if (manufacturer.contains(&quot;Xiaomi&quot;)) {
<abbr title=" 386             manufacturer += new File(&quot;/system/framework/framework-miui-res.apk&quot;).exists() ? &quot;(MIUI)&quot; : &quot;(AOSP-based ROM)&quot;;"> 386             manufacturer += new File(&quot;/system/framework/framework-miui-res.apk&quot;).exists() ? &quot;(MIUI)&quot; : &quot;(ðŸ”µ</abbr>
 387         }
 388         return manufacturer;
 389     }
 390 
 391     private int extractIntPart(String str) {
 392         int result = 0, length = str.length();
 393         for (int offset = 0; offset &lt; length; offset++) {
 394             char c = str.charAt(offset);
 395             if (&#x27;0&#x27; &lt;= c &amp;&amp; c &lt;= &#x27;9&#x27;)
 396                 result = result * 10 + (c - &#x27;0&#x27;);
 397             else
 398                 break;
 399         }
 400         return result;
 401     }
 402 }
 
 
 </pre></td>
                            <td><pre>   1 package de.robv.android.xposed.installer.installation;
   2 
   3 import android.Manifest;
   4 import android.annotation.SuppressLint;
   5 import android.app.Activity;
   6 import android.content.Context;
   7 import android.content.Intent;
   8 import android.content.pm.PackageManager;
   9 import android.net.Uri;
  10 import android.os.Build;
  11 import android.os.Bundle;
  12 import android.os.Environment;
  13 import android.os.Handler;
  14 import android.support.annotation.NonNull;
  15 import android.support.annotation.Nullable;
  16 import android.support.design.widget.Snackbar;
  17 import android.support.v4.app.ActivityCompat;
  18 import android.support.v4.app.Fragment;
  19 import android.support.v7.widget.SwitchCompat;
  20 import android.text.Html;
  21 import android.util.Log;
  22 import android.view.LayoutInflater;
  23 import android.view.View;
  24 import android.view.ViewGroup;
  25 import android.widget.CompoundButton;
  26 import android.widget.ImageView;
  27 import android.widget.TextView;
  28 import android.widget.Toast;
  29 import com.afollestad.materialdialogs.DialogAction;
  30 import com.afollestad.materialdialogs.MaterialDialog;
  31 import de.robv.android.xposed.installer.R;
  32 import de.robv.android.xposed.installer.XposedApp;
  33 import de.robv.android.xposed.installer.util.DownloadsUtil;
  34 import de.robv.android.xposed.installer.util.NavUtil;
  35 import java.io.BufferedReader;
  36 import java.io.File;
  37 import java.io.FileReader;
  38 import java.io.IOException;
  39 import static de.robv.android.xposed.installer.XposedApp.WRITE_EXTERNAL_PERMISSION;
  40 
  41 
  42 public class StatusInstallerFragment extends Fragment {
  43     public static final File DISABLE_FILE = new File(XposedApp.BASE_DIR + &quot;conf/disabled&quot;);
  44 
  45     public static String ARCH = getArch();
  46 
  47     private static Activity sActivity;
  48 
  49     private static Fragment sFragment;
  50 
  51     private static String mUpdateLink;
  52 
  53     private static ImageView mErrorIcon;
  54 
  55     private static View mUpdateView;
  56 
  57     private static View mUpdateButton;
  58 
  59     private static TextView mErrorTv;
  60 
  61     private static boolean isXposedInstalled = false;
  62 
  63     private TextView txtKnownIssue;
  64 
  65     public static void setError(boolean connectionFailed, boolean noSdks) {
  66         if ((!connectionFailed) &amp;&amp; (!noSdks)) {
  67             if (isXposedInstalled) {
  68                 return;
  69             }
  70             return;
  71         }
  72         mErrorTv.setVisibility(View.VISIBLE);
  73         mErrorIcon.setVisibility(View.VISIBLE);
  74         if (noSdks) {
<abbr title="  75             mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning_grey));">  75             mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning_grey))ðŸ”µ</abbr>
<abbr title="  76             mErrorTv.setText(String.format(sActivity.getString(R.string.phone_not_compatible), Build.VERSION.SDK_INT, Build.CPU_ABI));">  76             mErrorTv.setText(String.format(sActivity.getString(R.string.phone_not_compatible), Build.VERSðŸ”µ</abbr>
  77         }
  78         if (connectionFailed) {
<abbr title="  79             mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_no_connection));">  79             mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_no_connection)ðŸ”µ</abbr>
  80             mErrorTv.setText(sActivity.getString(R.string.loadingError));
  81         }
  82     }
  83 
  84     public static void setUpdate(final String link, final String changelog) {
  85         mUpdateLink = link;
  86 
  87         mUpdateView.setVisibility(View.VISIBLE);
  88         mUpdateButton.setVisibility(View.VISIBLE);
  89         mUpdateButton.setOnClickListener(new View.OnClickListener() {
  90             @Override
  91             public void onClick(View v) {
  92 
  93                 new MaterialDialog.Builder(sActivity)
  94                         .title(R.string.changes)
  95                         .content(Html.fromHtml(changelog))
  96                         .onPositive(new MaterialDialog.SingleButtonCallback() {
  97                             @Override
<abbr title="  98                             public void onClick(@NonNull MaterialDialog dialog, @NonNull DialogAction which) {">  98                             public void onClick(@NonNull MaterialDialog dialog, @NonNull DialogAction whiðŸ”µ</abbr>
  99                                 update();
 100                             }
 101                         })
 102                         .positiveText(R.string.update)
 103                         .negativeText(R.string.later).show();
 104             }
 105         });
 106     }
 107 
 108     private static void update() {
 109         if (checkPermissions()) return;
 110 
<abbr title=" 111         final String path = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/XposedInstaller/XposedInstaller_by_dvdandroid.apk&quot;;"> 111         final String path = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/XposedInstallðŸ”µ</abbr>
 112 
 113         new File(path).delete();
 114 
<abbr title=" 115         DownloadsUtil.add(sActivity, &quot;XposedInstaller_by_dvdandroid&quot;, mUpdateLink, new DownloadsUtil.DownloadFinishedCallback() {"> 115         DownloadsUtil.add(sActivity, &quot;XposedInstaller_by_dvdandroid&quot;, mUpdateLink, new DownloadsUtil.DownðŸ”µ</abbr>
 116             @Override
 117             public void onDownloadFinished(Context context, DownloadsUtil.DownloadInfo info) {
 118 
 119                 Intent intent = new Intent(Intent.ACTION_VIEW);
 120                 intent.setDataAndType(Uri.fromFile(new File(path)), DownloadsUtil.MIME_TYPE_APK);
 121                 intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
 122                 context.startActivity(intent);
 123             }
 124         }, DownloadsUtil.MIME_TYPES.APK, true);
 125     }
 126 
 127     private static boolean checkPermissions() {
 128         if (Build.VERSION.SDK_INT &lt; 23) return false;
 129 
<abbr title=" 130         if (ActivityCompat.checkSelfPermission(sActivity, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {"> 130         if (ActivityCompat.checkSelfPermission(sActivity, Manifest.permission.WRITE_EXTERNAL_STORAGE) != ðŸ”µ</abbr>
<abbr title=" 131             sFragment.requestPermissions(new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, WRITE_EXTERNAL_PERMISSION);"> 131             sFragment.requestPermissions(new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, WRITE_ðŸ”µ</abbr>
 132             return true;
 133         }
 134         return false;
 135     }
 136 
 137     private static boolean checkClassExists(String className) {
 138         try {
 139             Class.forName(className);
 140             return true;
 141         } catch (ClassNotFoundException e) {
 142             return false;
 143         }
 144     }
 145 
 146     private static String getCompleteArch() {
 147         String info = &quot;&quot;;
 148 
 149         try {
 150             FileReader fr = new FileReader(&quot;/proc/cpuinfo&quot;);
 151             BufferedReader br = new BufferedReader(fr);
 152             String text;
 153             while ((text = br.readLine()) != null) {
 154                 if (!text.startsWith(&quot;processor&quot;)) break;
 155             }
 156             br.close();
 157             String[] array = text != null ? text.split(&quot;:\\s+&quot;, 2) : new String[0];
 158             if (array.length &gt;= 2) {
 159                 info += array[1] + &quot; &quot;;
 160             }
 161         } catch (IOException ignored) {
 162         }
 163 
 164         if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
 165             info += Build.SUPPORTED_ABIS[0];
 166         } else {
 167             String arch = System.getenv(&quot;os.arch&quot;);
 168             if (arch != null) info += arch;
 169         }
 170         return info + &quot; (&quot; + getArch() + &quot;)&quot;;
 171     }
 172 
 173     @SuppressWarnings(&quot;deprecation&quot;)
 174     private static String getArch() {
 175         if (Build.CPU_ABI.equals(&quot;arm64-v8a&quot;)) {
 176             return &quot;arm64&quot;;
 177         } else if (Build.CPU_ABI.equals(&quot;x86_64&quot;)) {
 178             return &quot;x86_64&quot;;
 179         } else if (Build.CPU_ABI.equals(&quot;mips64&quot;)) {
 180             return &quot;mips64&quot;;
 181         } else if (Build.CPU_ABI.startsWith(&quot;x86&quot;) || Build.CPU_ABI2.startsWith(&quot;x86&quot;)) {
 182             return &quot;x86&quot;;
 183         } else if (Build.CPU_ABI.startsWith(&quot;mips&quot;)) {
 184             return &quot;mips&quot;;
 185         } else if (Build.CPU_ABI.startsWith(&quot;armeabi-v5&quot;) || Build.CPU_ABI.startsWith(&quot;armeabi-v6&quot;)) {
 186             return &quot;armv5&quot;;
 187         } else {
 188             return &quot;arm&quot;;
 189         }
 190     }
 191 
 192     @Override
 193     public void onCreate(@Nullable Bundle savedInstanceState) {
 194         super.onCreate(savedInstanceState);
 195 
 196         sActivity = getActivity();
 197         sFragment = this;
 198     }
 199 
 200     @Override
<abbr title=" 201     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {"> 201     public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[]ðŸ”µ</abbr>
 202         super.onRequestPermissionsResult(requestCode, permissions, grantResults);
 203         if (requestCode == WRITE_EXTERNAL_PERMISSION) {
 204             if (grantResults.length == 1 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {
 205                 new Handler().postDelayed(new Runnable() {
 206                     @Override
 207                     public void run() {
 208                         update();
 209                     }
 210                 }, 500);
 211             } else {
 212                 Toast.makeText(getActivity(), R.string.permissionNotGranted, Toast.LENGTH_LONG).show();
 213             }
 214         }
 215     }
 216 
 217     @Override
 218     public View onCreateView(LayoutInflater inflater, @Nullable
 219     ViewGroup container, @Nullable
 220     Bundle savedInstanceState) {
 221         View v = inflater.inflate(R.layout.status_installer, container, false);
 222         mErrorIcon = v.findViewById(R.id.errorIcon);
 223         mErrorTv = v.findViewById(R.id.errorTv);
 224         mUpdateView = v.findViewById(R.id.updateView);
 225         mUpdateButton = v.findViewById(R.id.click_to_update);
 226         txtKnownIssue = v.findViewById(R.id.framework_known_issue);
 227         TextView txtInstallError = v.findViewById(R.id.framework_install_errors);
 228         View txtInstallContainer = v.findViewById(R.id.status_container);
 229         ImageView txtInstallIcon = v.findViewById(R.id.status_icon);
 230         String installedXposedVersion;
 231         try {
 232             installedXposedVersion = XposedApp.getXposedProp().getVersion();
 233         } catch (java.lang.NullPointerException e) {
 234             installedXposedVersion = null;
 235         }
 236         View disableView = v.findViewById(R.id.disableView);
 237         final SwitchCompat xposedDisable = v.findViewById(R.id.disableSwitch);
 238         TextView androidSdk = v.findViewById(R.id.android_version);
 239         TextView manufacturer = v.findViewById(R.id.ic_manufacturer);
 240         TextView cpu = v.findViewById(R.id.cpu);
 241         if (Build.VERSION.SDK_INT &gt;= 21) {
 242             if (installedXposedVersion != null) {
 243                 int installedXposedVersionInt = extractIntPart(installedXposedVersion);
 244                 if (installedXposedVersionInt == XposedApp.getXposedVersion()) {
<abbr title=" 245                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, installedXposedVersion));"> 245                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, installedXpoðŸ”µ</abbr>
<abbr title=" 246                     txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green));"> 246                     txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green))ðŸ”µ</abbr>
<abbr title=" 247                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_green));"> 247                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darkðŸ”µ</abbr>
<abbr title=" 248                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_circle));"> 248                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_chðŸ”µ</abbr>
 249                     isXposedInstalled = true;
 250                 } else {
<abbr title=" 251                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, installedXposedVersion));"> 251                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, insðŸ”µ</abbr>
 252                     txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.amber_500));
<abbr title=" 253                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.amber_500));"> 253                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.ambeðŸ”µ</abbr>
<abbr title=" 254                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning));"> 254                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_waðŸ”µ</abbr>
 255                 }
 256             } else {
 257                 txtInstallError.setText(R.string.not_installed_no_lollipop);
 258                 txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.warning));
<abbr title=" 259                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning));"> 259                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning)ðŸ”µ</abbr>
<abbr title=" 260                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error));"> 260                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error)ðŸ”µ</abbr>
 261                 xposedDisable.setVisibility(View.GONE);
 262                 disableView.setVisibility(View.GONE);
 263             }
 264         } else {
 265             int installedXposedVersionInt = XposedApp.getXposedVersion();
 266             if (installedXposedVersionInt != 0) {
<abbr title=" 267                 txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, &quot;&quot; + installedXposedVersionInt));"> 267                 txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, &quot;&quot; + installedXpðŸ”µ</abbr>
 268                 txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green));
<abbr title=" 269                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_green));"> 269                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_gðŸ”µ</abbr>
<abbr title=" 270                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_circle));"> 270                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_ðŸ”µ</abbr>
 271                 isXposedInstalled = true;
 272                 if (DISABLE_FILE.exists()) {
<abbr title=" 273                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, &quot;&quot; + installedXposedVersionInt));"> 273                     txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, &quot;&quot; ðŸ”µ</abbr>
 274                     txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.amber_500));
<abbr title=" 275                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.amber_500));"> 275                     txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.ambeðŸ”µ</abbr>
<abbr title=" 276                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning));"> 276                     txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_waðŸ”µ</abbr>
 277                 }
 278             } else {
 279                 txtInstallError.setText(sActivity.getString(R.string.not_installed_no_lollipop));
 280                 txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.warning));
<abbr title=" 281                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning));"> 281                 txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning)ðŸ”µ</abbr>
<abbr title=" 282                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error));"> 282                 txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error)ðŸ”µ</abbr>
 283                 xposedDisable.setVisibility(View.GONE);
 284                 disableView.setVisibility(View.GONE);
 285             }
 286         }
 287         xposedDisable.setChecked(!DISABLE_FILE.exists());
 288         xposedDisable.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
 289             @Override
 290             public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
 291                 if (DISABLE_FILE.exists()) {
 292                     DISABLE_FILE.delete();
<abbr title=" 293                     Snackbar.make(xposedDisable, R.string.xposed_on_next_reboot, Snackbar.LENGTH_LONG).show();"> 293                     Snackbar.make(xposedDisable, R.string.xposed_on_next_reboot, Snackbar.LENGTH_LONG).shðŸ”µ</abbr>
 294                 } else {
 295                     try {
 296                         DISABLE_FILE.createNewFile();
<abbr title=" 297                         Snackbar.make(xposedDisable, R.string.xposed_off_next_reboot, Snackbar.LENGTH_LONG).show();"> 297                         Snackbar.make(xposedDisable, R.string.xposed_off_next_reboot, Snackbar.LENGTH_LONðŸ”µ</abbr>
 298                     } catch (IOException e) {
 299                         Log.e(XposedApp.TAG, &quot;StatusInstallerFragment -&gt; &quot; + e.getMessage());
 300                     }
 301                 }
 302             }
 303         });
<abbr title=" 304         androidSdk.setText(getString(R.string.android_sdk, getAndroidVersion(), Build.VERSION.RELEASE, Build.VERSION.SDK_INT));"> 304         androidSdk.setText(getString(R.string.android_sdk, getAndroidVersion(), Build.VERSION.RELEASE, BuðŸ”µ</abbr>
 305         manufacturer.setText(getUIFramework());
 306         cpu.setText(getCompleteArch());
 307         refreshKnownIssue();
 308         return v;
 309     }
 310 
 311     @SuppressLint(&quot;StringFormatInvalid&quot;)
 312     private void refreshKnownIssue() {
 313         String issueName = null;
 314         String issueLink = null;
 315 
 316         if (new File(&quot;/system/framework/core.jar.jex&quot;).exists()) {
 317             issueName = &quot;Aliyun OS&quot;;
 318             issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52289793&amp;postcount=5&quot;;
 319 
<abbr title=" 320         } else if (new File(&quot;/data/miui/DexspyInstaller.jar&quot;).exists() || checkClassExists(&quot;miui.dexspy.DexspyInstaller&quot;)) {"> 320         } else if (new File(&quot;/data/miui/DexspyInstaller.jar&quot;).exists() || checkClassExists(&quot;miui.dexspy.DðŸ”µ</abbr>
 321             issueName = &quot;MIUI/Dexspy&quot;;
 322             issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52291098&amp;postcount=6&quot;;
 323 
 324         } else if (checkClassExists(&quot;com.huawei.android.content.res.ResourcesEx&quot;)
 325                 || checkClassExists(&quot;android.content.res.NubiaResources&quot;)) {
 326             issueName = &quot;Resources subclass&quot;;
 327             issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52801382&amp;postcount=8&quot;;
 328         }
 329 
 330         if (issueName != null) {
 331             final String issueLinkFinal = issueLink;
 332             txtKnownIssue.setText(getString(R.string.install_known_issue, issueName));
 333             txtKnownIssue.setVisibility(View.VISIBLE);
 334             txtKnownIssue.setOnClickListener(new View.OnClickListener() {
 335                 @Override
 336                 public void onClick(View v) {
 337                     NavUtil.startURL(getActivity(), issueLinkFinal);
 338                 }
 339             });
 340         } else {
 341             txtKnownIssue.setVisibility(View.GONE);
 342         }
 343     }
 344 
 345     private String getAndroidVersion() {
 346         switch (Build.VERSION.SDK_INT) {
 347             case 16:
 348             case 17:
 349             case 18:
 350                 return &quot;Jelly Bean&quot;;
 351             case 19:
 352                 return &quot;KitKat&quot;;
 353             case 21:
 354             case 22:
 355                 return &quot;Lollipop&quot;;
 356             case 23:
 357                 return &quot;Marshmallow&quot;;
 358             case 24:
 359             case 25:
 360                 return &quot;Nougat&quot;;
 361         }
 362         return &quot;&quot;;
 363     }
 364 
 365     private String getUIFramework() {
<abbr title=" 366         String manufacturer = Character.toUpperCase(Build.MANUFACTURER.charAt(0)) + Build.MANUFACTURER.substring(1);"> 366         String manufacturer = Character.toUpperCase(Build.MANUFACTURER.charAt(0)) + Build.MANUFACTURER.suðŸ”µ</abbr>
 367         if (!Build.BRAND.equals(Build.MANUFACTURER)) {
<abbr title=" 368             manufacturer += &quot; &quot; + Character.toUpperCase(Build.BRAND.charAt(0)) + Build.BRAND.substring(1);"> 368             manufacturer += &quot; &quot; + Character.toUpperCase(Build.BRAND.charAt(0)) + Build.BRAND.substring(1)ðŸ”µ</abbr>
 369         }
 370         manufacturer += &quot; &quot; + Build.MODEL + &quot; &quot;;
 371         if (manufacturer.contains(&quot;Samsung&quot;)) {
<abbr title=" 372             manufacturer += new File(&quot;/system/framework/twframework.jar&quot;).exists() ? &quot;(TouchWiz)&quot; : &quot;(AOSP-based ROM)&quot;;"> 372             manufacturer += new File(&quot;/system/framework/twframework.jar&quot;).exists() ? &quot;(TouchWiz)&quot; : &quot;(AOSðŸ”µ</abbr>
 373         } else if (manufacturer.contains(&quot;Xiaomi&quot;)) {
<abbr title=" 374             manufacturer += new File(&quot;/system/framework/framework-miui-res.apk&quot;).exists() ? &quot;(MIUI)&quot; : &quot;(AOSP-based ROM)&quot;;"> 374             manufacturer += new File(&quot;/system/framework/framework-miui-res.apk&quot;).exists() ? &quot;(MIUI)&quot; : &quot;(ðŸ”µ</abbr>
 375         }
 376         return manufacturer;
 377     }
 378 
 379     private int extractIntPart(String str) {
 380         int result = 0, length = str.length();
 381         for (int offset = 0; offset &lt; length; offset++) {
 382             char c = str.charAt(offset);
 383             if (&#x27;0&#x27; &lt;= c &amp;&amp; c &lt;= &#x27;9&#x27;)
 384                 result = result * 10 + (c - &#x27;0&#x27;);
 385             else
 386                 break;
 387         }
 388         return result;
 389     }
 390 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  package de.robv.android.xposed.installer.installation;
   2  
   3  import android.Manifest;
   4  import android.annotation.SuppressLint;
   5  import android.app.Activity;
   6  import android.content.Context;
   7  import android.content.Intent;
   8  import android.content.pm.PackageManager;
   9  import android.net.Uri;
  10  import android.os.Build;
  11  import android.os.Bundle;
  12  import android.os.Environment;
  13  import android.os.Handler;
  14  import android.support.annotation.NonNull;
  15  import android.support.annotation.Nullable;
  16  import android.support.design.widget.Snackbar;
  17  import android.support.v4.app.ActivityCompat;
  18  import android.support.v4.app.Fragment;
  19  import android.support.v7.widget.SwitchCompat;
  20  import android.text.Html;
  21  import android.util.Log;
  22  import android.view.LayoutInflater;
  23  import android.view.View;
  24  import android.view.ViewGroup;
  25  import android.widget.CompoundButton;
  26  import android.widget.ImageView;
  27  import android.widget.TextView;
  28  import android.widget.Toast;
  29  
  30  import com.afollestad.materialdialogs.DialogAction;
  31  import com.afollestad.materialdialogs.MaterialDialog;
  32  
  33  import java.io.BufferedReader;
  34  import java.io.File;
  35  import java.io.FileReader;
  36  import java.io.IOException;
  37  
  38  import de.robv.android.xposed.installer.R;
  39  import de.robv.android.xposed.installer.XposedApp;
  40  import de.robv.android.xposed.installer.util.DownloadsUtil;
  41  import de.robv.android.xposed.installer.util.NavUtil;
  42  
  43  import static de.robv.android.xposed.installer.XposedApp.WRITE_EXTERNAL_PERMISSION;
  44  
  45  public class StatusInstallerFragment extends Fragment {
  46  
  47      public static final File DISABLE_FILE = new File(XposedApp.BASE_DIR + &quot;conf/disabled&quot;);
  48      public static String ARCH = getArch();
  49      private static Activity sActivity;
  50      private static Fragment sFragment;
  51      private static String mUpdateLink;
  52      private static ImageView mErrorIcon;
  53      private static View mUpdateView;
  54      private static View mUpdateButton;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -    private static View mHintContainer;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -    private static TextView mHint;</span>
  57      private static TextView mErrorTv;
  58      private static boolean isXposedInstalled = false;
  59      private TextView txtKnownIssue;
  60  
  61      public static void setError(boolean connectionFailed, boolean noSdks) {
  62          if (!connectionFailed &amp;&amp; !noSdks) {
  63              if (isXposedInstalled) return;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -            mHintContainer.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -            mHint.setText(mHint.getText() + &quot;\n&quot; + sActivity.getString(R.string.goto_framework));</span>
  66              return;
  67          }
  68  
  69          mErrorTv.setVisibility(View.VISIBLE);
  70          mErrorIcon.setVisibility(View.VISIBLE);
  71          if (noSdks) {
  72              mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning_grey));
<abbr title="  73              mErrorTv.setText(String.format(sActivity.getString(R.string.phone_not_compatible), Build.VERSION.SDK_INT, Build.CPU_ABI));">  73              mErrorTv.setText(String.format(sActivity.getString(R.string.phone_not_compatible), Build.VERSION.SDK_IðŸ”µ</abbr>
  74          }
  75          if (connectionFailed) {
  76              mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_no_connection));
  77              mErrorTv.setText(sActivity.getString(R.string.loadingError));
  78          }
  79      }
  80  
  81      public static void setUpdate(final String link, final String changelog) {
  82          mUpdateLink = link;
  83  
  84          mUpdateView.setVisibility(View.VISIBLE);
  85          mUpdateButton.setVisibility(View.VISIBLE);
  86          mUpdateButton.setOnClickListener(new View.OnClickListener() {
  87              @Override
  88              public void onClick(View v) {
  89  
  90                  new MaterialDialog.Builder(sActivity)
  91                          .title(R.string.changes)
  92                          .content(Html.fromHtml(changelog))
  93                          .onPositive(new MaterialDialog.SingleButtonCallback() {
  94                              @Override
  95                              public void onClick(@NonNull MaterialDialog dialog, @NonNull DialogAction which) {
  96                                  update();
  97                              }
  98                          })
  99                          .positiveText(R.string.update)
 100                          .negativeText(R.string.later).show();
 101              }
 102          });
 103      }
 104  
 105      private static void update() {
 106          if (checkPermissions()) return;
 107  
<abbr title=" 108          final String path = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/XposedInstaller/XposedInstaller_by_dvdandroid.apk&quot;;"> 108          final String path = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/XposedInstaller/XposedðŸ”µ</abbr>
 109  
 110          new File(path).delete();
 111  
<abbr title=" 112          DownloadsUtil.add(sActivity, &quot;XposedInstaller_by_dvdandroid&quot;, mUpdateLink, new DownloadsUtil.DownloadFinishedCallback() {"> 112          DownloadsUtil.add(sActivity, &quot;XposedInstaller_by_dvdandroid&quot;, mUpdateLink, new DownloadsUtil.DownloadFinisðŸ”µ</abbr>
 113              @Override
 114              public void onDownloadFinished(Context context, DownloadsUtil.DownloadInfo info) {
 115  
 116                  Intent intent = new Intent(Intent.ACTION_VIEW);
 117                  intent.setDataAndType(Uri.fromFile(new File(path)), DownloadsUtil.MIME_TYPE_APK);
 118                  intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
 119                  context.startActivity(intent);
 120              }
 121          }, DownloadsUtil.MIME_TYPES.APK, true);
 122      }
 123  
 124      private static boolean checkPermissions() {
 125          if (Build.VERSION.SDK_INT &lt; 23) return false;
 126  
<abbr title=" 127          if (ActivityCompat.checkSelfPermission(sActivity, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {"> 127          if (ActivityCompat.checkSelfPermission(sActivity, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageMaðŸ”µ</abbr>
<abbr title=" 128              sFragment.requestPermissions(new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, WRITE_EXTERNAL_PERMISSION);"> 128              sFragment.requestPermissions(new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, WRITE_EXTERNAL_ðŸ”µ</abbr>
 129              return true;
 130          }
 131          return false;
 132      }
 133  
 134      private static boolean checkClassExists(String className) {
 135          try {
 136              Class.forName(className);
 137              return true;
 138          } catch (ClassNotFoundException e) {
 139              return false;
 140          }
 141      }
 142  
 143      private static String getCompleteArch() {
 144          String info = &quot;&quot;;
 145  
 146          try {
 147              FileReader fr = new FileReader(&quot;/proc/cpuinfo&quot;);
 148              BufferedReader br = new BufferedReader(fr);
 149              String text;
 150              while ((text = br.readLine()) != null) {
 151                  if (!text.startsWith(&quot;processor&quot;)) break;
 152              }
 153              br.close();
 154              String[] array = text != null ? text.split(&quot;:\\s+&quot;, 2) : new String[0];
 155              if (array.length &gt;= 2) {
 156                  info += array[1] + &quot; &quot;;
 157              }
 158          } catch (IOException ignored) {
 159          }
 160  
 161          if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
 162              info += Build.SUPPORTED_ABIS[0];
 163          } else {
 164              String arch = System.getenv(&quot;os.arch&quot;);
 165              if (arch != null) info += arch;
 166          }
 167          return info + &quot; (&quot; + getArch() + &quot;)&quot;;
 168      }
 169  
 170      @SuppressWarnings(&quot;deprecation&quot;)
 171      private static String getArch() {
 172          if (Build.CPU_ABI.equals(&quot;arm64-v8a&quot;)) {
 173              return &quot;arm64&quot;;
 174          } else if (Build.CPU_ABI.equals(&quot;x86_64&quot;)) {
 175              return &quot;x86_64&quot;;
 176          } else if (Build.CPU_ABI.equals(&quot;mips64&quot;)) {
 177              return &quot;mips64&quot;;
 178          } else if (Build.CPU_ABI.startsWith(&quot;x86&quot;) || Build.CPU_ABI2.startsWith(&quot;x86&quot;)) {
 179              return &quot;x86&quot;;
 180          } else if (Build.CPU_ABI.startsWith(&quot;mips&quot;)) {
 181              return &quot;mips&quot;;
 182          } else if (Build.CPU_ABI.startsWith(&quot;armeabi-v5&quot;) || Build.CPU_ABI.startsWith(&quot;armeabi-v6&quot;)) {
 183              return &quot;armv5&quot;;
 184          } else {
 185              return &quot;arm&quot;;
 186          }
 187      }
 188  
 189      @Override
 190      public void onCreate(@Nullable Bundle savedInstanceState) {
 191          super.onCreate(savedInstanceState);
 192  
 193          sActivity = getActivity();
 194          sFragment = this;
 195      }
 196  
 197      @Override
<abbr title=" 198      public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {"> 198      public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResðŸ”µ</abbr>
 199          super.onRequestPermissionsResult(requestCode, permissions, grantResults);
 200          if (requestCode == WRITE_EXTERNAL_PERMISSION) {
 201              if (grantResults.length == 1 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {
 202                  new Handler().postDelayed(new Runnable() {
 203                      @Override
 204                      public void run() {
 205                          update();
 206                      }
 207                  }, 500);
 208              } else {
 209                  Toast.makeText(getActivity(), R.string.permissionNotGranted, Toast.LENGTH_LONG).show();
 210              }
 211          }
 212      }
 213  
 214      @Override
<abbr title=" 215      public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {"> 215      public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstancðŸ”µ</abbr>
 216          View v = inflater.inflate(R.layout.status_installer, container, false);
 217  
 218          mErrorIcon = (ImageView) v.findViewById(R.id.errorIcon);
 219          mErrorTv = (TextView) v.findViewById(R.id.errorTv);


 220          mUpdateView = v.findViewById(R.id.updateView);
 221          mUpdateButton = v.findViewById(R.id.click_to_update);
 222  
 223          txtKnownIssue = (TextView) v.findViewById(R.id.framework_known_issue);
 224  
 225          TextView txtInstallError = (TextView) v.findViewById(R.id.framework_install_errors);



 226          View txtInstallContainer = v.findViewById(R.id.status_container);
 227          ImageView txtInstallIcon = (ImageView) v.findViewById(R.id.status_icon);

 228  
 229          String installedXposedVersion;
 230          try {
 231              installedXposedVersion= XposedApp.getXposedProp().getVersion();
 232          } catch (NullPointerException e) {
 233              installedXposedVersion = null;
 234          }
 235  
 236          View disableView = v.findViewById(R.id.disableView);
 237          final SwitchCompat xposedDisable = (SwitchCompat) v.findViewById(R.id.disableSwitch);
 238  
 239          TextView androidSdk = (TextView) v.findViewById(R.id.android_version);
 240          TextView manufacturer = (TextView) v.findViewById(R.id.ic_manufacturer);
 241          TextView cpu = (TextView) v.findViewById(R.id.cpu);





<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 242 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 243 -        mHintContainer = v.findViewById(R.id.hint_container);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 244 -        mHint = (TextView) v.findViewById(R.id.hint);</span>

 245  
 246          if (Build.VERSION.SDK_INT &gt;= 21) {
 247              if (installedXposedVersion != null) {
 248                  int installedXposedVersionInt = extractIntPart(installedXposedVersion);
 249                  if (installedXposedVersionInt == XposedApp.getXposedVersion()) {
<abbr title=" 250                      txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, installedXposedVersion));"> 250                      txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, installedXposedVersioðŸ”µ</abbr>
 251                      txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green));
<abbr title=" 252                      txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_green));"> 252                      txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_green)ðŸ”µ</abbr>
<abbr title=" 253                      txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_circle));"> 253                      txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_circlðŸ”µ</abbr>
 254                      isXposedInstalled = true;
 255                  } else {
<abbr title=" 256                      txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, installedXposedVersion));"> 256                      txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, installedXpoðŸ”µ</abbr>
 257                      txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.amber_500));
 258                      txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.amber_500));
 259                      txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning));
 260                  }
 261              } else {
 262                  txtInstallError.setText(R.string.not_installed_no_lollipop);
 263                  txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.warning));
 264                  txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning));
 265                  txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error));
 266                  xposedDisable.setVisibility(View.GONE);
 267                  disableView.setVisibility(View.GONE);
 268              }
 269          } else {
 270              int installedXposedVersionInt = XposedApp.getXposedVersion();
 271              if (installedXposedVersionInt != 0) {
<abbr title=" 272                  txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, &quot;&quot; + installedXposedVersionInt));"> 272                  txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, &quot;&quot; + installedXposedVersiðŸ”µ</abbr>
 273                  txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green));
 274                  txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_green));
 275                  txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_circle));
 276                  isXposedInstalled = true;
 277                  if (DISABLE_FILE.exists()) {
<abbr title=" 278                      txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, &quot;&quot; + installedXposedVersionInt));"> 278                      txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, &quot;&quot; + installðŸ”µ</abbr>
 279                      txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.amber_500));
 280                      txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.amber_500));
 281                      txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning));
 282                  }
 283              } else {
 284                  txtInstallError.setText(sActivity.getString(R.string.not_installed_no_lollipop));
 285                  txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.warning));
 286                  txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning));
 287                  txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error));
 288                  xposedDisable.setVisibility(View.GONE);
 289                  disableView.setVisibility(View.GONE);
 290              }
 291          }
 292  
 293          xposedDisable.setChecked(!DISABLE_FILE.exists());
 294  
 295          xposedDisable.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
 296              @Override
 297              public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
 298                  if (DISABLE_FILE.exists()) {
 299                      DISABLE_FILE.delete();
 300                      Snackbar.make(xposedDisable, R.string.xposed_on_next_reboot, Snackbar.LENGTH_LONG).show();
 301                  } else {
 302                      try {
 303                          DISABLE_FILE.createNewFile();
<abbr title=" 304                          Snackbar.make(xposedDisable, R.string.xposed_off_next_reboot, Snackbar.LENGTH_LONG).show();"> 304                          Snackbar.make(xposedDisable, R.string.xposed_off_next_reboot, Snackbar.LENGTH_LONG).show()ðŸ”µ</abbr>
 305                      } catch (IOException e) {
 306                          Log.e(XposedApp.TAG, &quot;StatusInstallerFragment -&gt; &quot; + e.getMessage());
 307                      }
 308                  }
 309              }
 310          });
 311  
<abbr title=" 312          androidSdk.setText(getString(R.string.android_sdk, getAndroidVersion(), Build.VERSION.RELEASE, Build.VERSION.SDK_INT));"> 312          androidSdk.setText(getString(R.string.android_sdk, getAndroidVersion(), Build.VERSION.RELEASE, Build.VERSIðŸ”µ</abbr>
 313          manufacturer.setText(getUIFramework());
 314          cpu.setText(getCompleteArch());
 315  
 316          refreshKnownIssue();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 317 -        setHint();</span>
 318          return v;
 319      }
 320  
 321      @SuppressLint(&quot;StringFormatInvalid&quot;)
 322      private void refreshKnownIssue() {
 323          String issueName = null;
 324          String issueLink = null;
 325  
 326          if (new File(&quot;/system/framework/core.jar.jex&quot;).exists()) {
 327              issueName = &quot;Aliyun OS&quot;;
 328              issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52289793&amp;postcount=5&quot;;
 329  
<abbr title=" 330          } else if (new File(&quot;/data/miui/DexspyInstaller.jar&quot;).exists() || checkClassExists(&quot;miui.dexspy.DexspyInstaller&quot;)) {"> 330          } else if (new File(&quot;/data/miui/DexspyInstaller.jar&quot;).exists() || checkClassExists(&quot;miui.dexspy.DexspyInstðŸ”µ</abbr>
 331              issueName = &quot;MIUI/Dexspy&quot;;
 332              issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52291098&amp;postcount=6&quot;;
 333  
 334          } else if (checkClassExists(&quot;com.huawei.android.content.res.ResourcesEx&quot;)
 335                  || checkClassExists(&quot;android.content.res.NubiaResources&quot;)) {
 336              issueName = &quot;Resources subclass&quot;;
 337              issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52801382&amp;postcount=8&quot;;
 338          }
 339  
 340          if (issueName != null) {
 341              final String issueLinkFinal = issueLink;
 342              txtKnownIssue.setText(getString(R.string.install_known_issue, issueName));
 343              txtKnownIssue.setVisibility(View.VISIBLE);
 344              txtKnownIssue.setOnClickListener(new View.OnClickListener() {
 345                  @Override
 346                  public void onClick(View v) {
 347                      NavUtil.startURL(getActivity(), issueLinkFinal);
 348                  }
 349              });
 350          } else {
 351              txtKnownIssue.setVisibility(View.GONE);
 352          }
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 353 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 354 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 355 -    private void setHint() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 356 -        String manufacturer = Build.MANUFACTURER.toLowerCase();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 357 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 358 -        File twFramework = new File(&quot;/system/framework/twframework.jar&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 359 -        File miuiFramework = new File(&quot;/system/framework/framework-miui-res.jar&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 360 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 361 -        String hint = getString(R.string.original_framework);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 362 -        int tab = 1;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 363 -        if (manufacturer.contains(&quot;samsung&quot;)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 364 -            if (twFramework.exists()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 365 -                hint = getString(R.string.device_own, &quot;Samsung&quot;, &quot;TouchWiz&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 366 -                tab = 3;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 367 -            } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 368 -                hint = getString(R.string.device_own, &quot;Samsung&quot;, &quot;AOSP-based&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 369 -                tab = 1;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 370 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 371 -        } else if (manufacturer.contains(&quot;xiaomi&quot;)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 372 -            if (miuiFramework.exists()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 373 -                hint = getString(R.string.device_own, &quot;Xiaomi&quot;, &quot;MIUI&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 374 -                tab = 4;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 375 -            } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 376 -                hint = getString(R.string.device_own, &quot;Xiaomi&quot;, &quot;AOSP-based&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 377 -                tab = 1;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 378 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 379 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 380 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 381 -        final int finalTab = tab;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 382 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 383 -        mHint.setText(hint);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 384 -        mHintContainer.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 385 -            @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 386 -            public void onClick(View v) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 387 -                AdvancedInstallerFragment.gotoPage(finalTab);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 388 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 389 -        });</span>
 390      }
 391  
 392      private String getAndroidVersion() {
 393          switch (Build.VERSION.SDK_INT) {
 394              case 16:
 395              case 17:
 396              case 18:
 397                  return &quot;Jelly Bean&quot;;
 398              case 19:
 399                  return &quot;KitKat&quot;;
 400              case 21:
 401              case 22:
 402                  return &quot;Lollipop&quot;;
 403              case 23:
 404                  return &quot;Marshmallow&quot;;
 405              case 24:
 406              case 25:
 407                  return &quot;Nougat&quot;;
 408          }
 409          return &quot;&quot;;
 410      }
 411  
 412      private String getUIFramework() {
<abbr title=" 413          String manufacturer = Character.toUpperCase(Build.MANUFACTURER.charAt(0)) + Build.MANUFACTURER.substring(1);"> 413          String manufacturer = Character.toUpperCase(Build.MANUFACTURER.charAt(0)) + Build.MANUFACTURER.substring(1ðŸ”µ</abbr>
 414          if (!Build.BRAND.equals(Build.MANUFACTURER)) {
 415              manufacturer += &quot; &quot; + Character.toUpperCase(Build.BRAND.charAt(0)) + Build.BRAND.substring(1);
 416          }
 417          manufacturer += &quot; &quot; + Build.MODEL + &quot; &quot;;
 418          if (manufacturer.contains(&quot;Samsung&quot;)) {
<abbr title=" 419              manufacturer += new File(&quot;/system/framework/twframework.jar&quot;).exists() ? &quot;(TouchWiz)&quot; : &quot;(AOSP-based ROM)&quot;;"> 419              manufacturer += new File(&quot;/system/framework/twframework.jar&quot;).exists() ? &quot;(TouchWiz)&quot; : &quot;(AOSP-based RðŸ”µ</abbr>
 420          } else if (manufacturer.contains(&quot;Xiaomi&quot;)) {
<abbr title=" 421              manufacturer += new File(&quot;/system/framework/framework-miui-res.apk&quot;).exists() ? &quot;(MIUI)&quot; : &quot;(AOSP-based ROM)&quot;;"> 421              manufacturer += new File(&quot;/system/framework/framework-miui-res.apk&quot;).exists() ? &quot;(MIUI)&quot; : &quot;(AOSP-baseðŸ”µ</abbr>
 422          }
 423          return manufacturer;
 424      }
 425  
 426      private int extractIntPart(String str) {
 427          int result = 0, length = str.length();
 428          for (int offset = 0; offset &lt; length; offset++) {
 429              char c = str.charAt(offset);
 430              if (&#x27;0&#x27; &lt;= c &amp;&amp; c &lt;= &#x27;9&#x27;)
 431                  result = result * 10 + (c - &#x27;0&#x27;);
 432              else
 433                  break;
 434          }
 435          return result;
 436      }
 437  }</pre></td>
                            <td><pre>   1  package de.robv.android.xposed.installer.installation;
   2  
   3  import android.Manifest;
   4  import android.annotation.SuppressLint;
   5  import android.app.Activity;
   6  import android.content.Context;
   7  import android.content.Intent;
   8  import android.content.pm.PackageManager;
   9  import android.net.Uri;
  10  import android.os.Build;
  11  import android.os.Bundle;
  12  import android.os.Environment;
  13  import android.os.Handler;
  14  import android.support.annotation.NonNull;
  15  import android.support.annotation.Nullable;
  16  import android.support.design.widget.Snackbar;
  17  import android.support.v4.app.ActivityCompat;
  18  import android.support.v4.app.Fragment;
  19  import android.support.v7.widget.SwitchCompat;
  20  import android.text.Html;
  21  import android.util.Log;
  22  import android.view.LayoutInflater;
  23  import android.view.View;
  24  import android.view.ViewGroup;
  25  import android.widget.CompoundButton;
  26  import android.widget.ImageView;
  27  import android.widget.TextView;
  28  import android.widget.Toast;
  29  
  30  import com.afollestad.materialdialogs.DialogAction;
  31  import com.afollestad.materialdialogs.MaterialDialog;
  32  
  33  import java.io.BufferedReader;
  34  import java.io.File;
  35  import java.io.FileReader;
  36  import java.io.IOException;
  37  
  38  import de.robv.android.xposed.installer.R;
  39  import de.robv.android.xposed.installer.XposedApp;
  40  import de.robv.android.xposed.installer.util.DownloadsUtil;
  41  import de.robv.android.xposed.installer.util.NavUtil;
  42  
  43  import static de.robv.android.xposed.installer.XposedApp.WRITE_EXTERNAL_PERMISSION;
  44  
  45  public class StatusInstallerFragment extends Fragment {
  46  
  47      public static final File DISABLE_FILE = new File(XposedApp.BASE_DIR + &quot;conf/disabled&quot;);
  48      public static String ARCH = getArch();
  49      private static Activity sActivity;
  50      private static Fragment sFragment;
  51      private static String mUpdateLink;
  52      private static ImageView mErrorIcon;
  53      private static View mUpdateView;
  54      private static View mUpdateButton;
  55      private static View mHintContainer;
  56      private static TextView mHint;
  57      private static TextView mErrorTv;
  58      private static boolean isXposedInstalled = false;
  59      private TextView txtKnownIssue;
  60  
  61      public static void setError(boolean connectionFailed, boolean noSdks) {
  62          if (!connectionFailed &amp;&amp; !noSdks) {
  63              if (isXposedInstalled) return;
  64              mHintContainer.setVisibility(View.VISIBLE);
  65              mHint.setText(mHint.getText() + &quot;\n&quot; + sActivity.getString(R.string.goto_framework));
  66              return;
  67          }
  68  
  69          mErrorTv.setVisibility(View.VISIBLE);
  70          mErrorIcon.setVisibility(View.VISIBLE);
  71          if (noSdks) {
  72              mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning_grey));
<abbr title="  73              mErrorTv.setText(String.format(sActivity.getString(R.string.phone_not_compatible), Build.VERSION.SDK_INT, Build.CPU_ABI));">  73              mErrorTv.setText(String.format(sActivity.getString(R.string.phone_not_compatible), Build.VERSION.SDK_IðŸ”µ</abbr>
  74          }
  75          if (connectionFailed) {
  76              mErrorIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_no_connection));
  77              mErrorTv.setText(sActivity.getString(R.string.loadingError));
  78          }
  79      }
  80  
  81      public static void setUpdate(final String link, final String changelog) {
  82          mUpdateLink = link;
  83  
  84          mUpdateView.setVisibility(View.VISIBLE);
  85          mUpdateButton.setVisibility(View.VISIBLE);
  86          mUpdateButton.setOnClickListener(new View.OnClickListener() {
  87              @Override
  88              public void onClick(View v) {
  89  
  90                  new MaterialDialog.Builder(sActivity)
  91                          .title(R.string.changes)
  92                          .content(Html.fromHtml(changelog))
  93                          .onPositive(new MaterialDialog.SingleButtonCallback() {
  94                              @Override
  95                              public void onClick(@NonNull MaterialDialog dialog, @NonNull DialogAction which) {
  96                                  update();
  97                              }
  98                          })
  99                          .positiveText(R.string.update)
 100                          .negativeText(R.string.later).show();
 101              }
 102          });
 103      }
 104  
 105      private static void update() {
 106          if (checkPermissions()) return;
 107  
<abbr title=" 108          final String path = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/XposedInstaller/XposedInstaller_by_dvdandroid.apk&quot;;"> 108          final String path = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/XposedInstaller/XposedðŸ”µ</abbr>
 109  
 110          new File(path).delete();
 111  
<abbr title=" 112          DownloadsUtil.add(sActivity, &quot;XposedInstaller_by_dvdandroid&quot;, mUpdateLink, new DownloadsUtil.DownloadFinishedCallback() {"> 112          DownloadsUtil.add(sActivity, &quot;XposedInstaller_by_dvdandroid&quot;, mUpdateLink, new DownloadsUtil.DownloadFinisðŸ”µ</abbr>
 113              @Override
 114              public void onDownloadFinished(Context context, DownloadsUtil.DownloadInfo info) {
 115  
 116                  Intent intent = new Intent(Intent.ACTION_VIEW);
 117                  intent.setDataAndType(Uri.fromFile(new File(path)), DownloadsUtil.MIME_TYPE_APK);
 118                  intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
 119                  context.startActivity(intent);
 120              }
 121          }, DownloadsUtil.MIME_TYPES.APK, true);
 122      }
 123  
 124      private static boolean checkPermissions() {
 125          if (Build.VERSION.SDK_INT &lt; 23) return false;
 126  
<abbr title=" 127          if (ActivityCompat.checkSelfPermission(sActivity, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {"> 127          if (ActivityCompat.checkSelfPermission(sActivity, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageMaðŸ”µ</abbr>
<abbr title=" 128              sFragment.requestPermissions(new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, WRITE_EXTERNAL_PERMISSION);"> 128              sFragment.requestPermissions(new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, WRITE_EXTERNAL_ðŸ”µ</abbr>
 129              return true;
 130          }
 131          return false;
 132      }
 133  
 134      private static boolean checkClassExists(String className) {
 135          try {
 136              Class.forName(className);
 137              return true;
 138          } catch (ClassNotFoundException e) {
 139              return false;
 140          }
 141      }
 142  
 143      private static String getCompleteArch() {
 144          String info = &quot;&quot;;
 145  
 146          try {
 147              FileReader fr = new FileReader(&quot;/proc/cpuinfo&quot;);
 148              BufferedReader br = new BufferedReader(fr);
 149              String text;
 150              while ((text = br.readLine()) != null) {
 151                  if (!text.startsWith(&quot;processor&quot;)) break;
 152              }
 153              br.close();
 154              String[] array = text != null ? text.split(&quot;:\\s+&quot;, 2) : new String[0];
 155              if (array.length &gt;= 2) {
 156                  info += array[1] + &quot; &quot;;
 157              }
 158          } catch (IOException ignored) {
 159          }
 160  
 161          if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
 162              info += Build.SUPPORTED_ABIS[0];
 163          } else {
 164              String arch = System.getenv(&quot;os.arch&quot;);
 165              if (arch != null) info += arch;
 166          }
 167          return info + &quot; (&quot; + getArch() + &quot;)&quot;;
 168      }
 169  
 170      @SuppressWarnings(&quot;deprecation&quot;)
 171      private static String getArch() {
 172          if (Build.CPU_ABI.equals(&quot;arm64-v8a&quot;)) {
 173              return &quot;arm64&quot;;
 174          } else if (Build.CPU_ABI.equals(&quot;x86_64&quot;)) {
 175              return &quot;x86_64&quot;;
 176          } else if (Build.CPU_ABI.equals(&quot;mips64&quot;)) {
 177              return &quot;mips64&quot;;
 178          } else if (Build.CPU_ABI.startsWith(&quot;x86&quot;) || Build.CPU_ABI2.startsWith(&quot;x86&quot;)) {
 179              return &quot;x86&quot;;
 180          } else if (Build.CPU_ABI.startsWith(&quot;mips&quot;)) {
 181              return &quot;mips&quot;;
 182          } else if (Build.CPU_ABI.startsWith(&quot;armeabi-v5&quot;) || Build.CPU_ABI.startsWith(&quot;armeabi-v6&quot;)) {
 183              return &quot;armv5&quot;;
 184          } else {
 185              return &quot;arm&quot;;
 186          }
 187      }
 188  
 189      @Override
 190      public void onCreate(@Nullable Bundle savedInstanceState) {
 191          super.onCreate(savedInstanceState);
 192  
 193          sActivity = getActivity();
 194          sFragment = this;
 195      }
 196  
 197      @Override
<abbr title=" 198      public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {"> 198      public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResðŸ”µ</abbr>
 199          super.onRequestPermissionsResult(requestCode, permissions, grantResults);
 200          if (requestCode == WRITE_EXTERNAL_PERMISSION) {
 201              if (grantResults.length == 1 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {
 202                  new Handler().postDelayed(new Runnable() {
 203                      @Override
 204                      public void run() {
 205                          update();
 206                      }
 207                  }, 500);
 208              } else {
 209                  Toast.makeText(getActivity(), R.string.permissionNotGranted, Toast.LENGTH_LONG).show();
 210              }
 211          }
 212      }
 213  
 214      @Override
<abbr title=" 215      public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {"> 215      public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstancðŸ”µ</abbr>
 216          View v = inflater.inflate(R.layout.status_installer, container, false);
 217  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 218 -        mErrorIcon = (ImageView) v.findViewById(R.id.errorIcon);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 219 -        mErrorTv = (TextView) v.findViewById(R.id.errorTv);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 220 +        mErrorIcon = v.findViewById(R.id.errorIcon);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 221 +        mErrorTv = v.findViewById(R.id.errorTv);</span>
 222          mUpdateView = v.findViewById(R.id.updateView);
 223          mUpdateButton = v.findViewById(R.id.click_to_update);
 224  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 225 -        txtKnownIssue = (TextView) v.findViewById(R.id.framework_known_issue);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 226 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 227 -        TextView txtInstallError = (TextView) v.findViewById(R.id.framework_install_errors);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 228 +        txtKnownIssue = v.findViewById(R.id.framework_known_issue);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +        TextView txtInstallError = v.findViewById(R.id.framework_install_errors);</span>
 231          View txtInstallContainer = v.findViewById(R.id.status_container);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 232 -        ImageView txtInstallIcon = (ImageView) v.findViewById(R.id.status_icon);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 233 +        ImageView txtInstallIcon = v.findViewById(R.id.status_icon);</span>
 234  
 235          String installedXposedVersion;
 236          try {
 237              installedXposedVersion= XposedApp.getXposedProp().getVersion();
 238          } catch (NullPointerException e) {
 239              installedXposedVersion = null;
 240          }
 241  
 242          View disableView = v.findViewById(R.id.disableView);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 243 -        final SwitchCompat xposedDisable = (SwitchCompat) v.findViewById(R.id.disableSwitch);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 244 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 245 -        TextView androidSdk = (TextView) v.findViewById(R.id.android_version);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 246 -        TextView manufacturer = (TextView) v.findViewById(R.id.ic_manufacturer);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 247 -        TextView cpu = (TextView) v.findViewById(R.id.cpu);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +        final SwitchCompat xposedDisable = v.findViewById(R.id.disableSwitch);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +        TextView androidSdk = v.findViewById(R.id.android_version);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +        TextView manufacturer = v.findViewById(R.id.ic_manufacturer);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +        TextView cpu = v.findViewById(R.id.cpu);</span>
 253  
 254          mHintContainer = v.findViewById(R.id.hint_container);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 255 -        mHint = (TextView) v.findViewById(R.id.hint);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +        mHint = v.findViewById(R.id.hint);</span>
 257  
 258          if (Build.VERSION.SDK_INT &gt;= 21) {
 259              if (installedXposedVersion != null) {
 260                  int installedXposedVersionInt = extractIntPart(installedXposedVersion);
 261                  if (installedXposedVersionInt == XposedApp.getXposedVersion()) {
<abbr title=" 262                      txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, installedXposedVersion));"> 262                      txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, installedXposedVersioðŸ”µ</abbr>
 263                      txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green));
<abbr title=" 264                      txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_green));"> 264                      txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_green)ðŸ”µ</abbr>
<abbr title=" 265                      txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_circle));"> 265                      txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_circlðŸ”µ</abbr>
 266                      isXposedInstalled = true;
 267                  } else {
<abbr title=" 268                      txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, installedXposedVersion));"> 268                      txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, installedXpoðŸ”µ</abbr>
 269                      txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.amber_500));
 270                      txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.amber_500));
 271                      txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning));
 272                  }
 273              } else {
 274                  txtInstallError.setText(R.string.not_installed_no_lollipop);
 275                  txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.warning));
 276                  txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning));
 277                  txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error));
 278                  xposedDisable.setVisibility(View.GONE);
 279                  disableView.setVisibility(View.GONE);
 280              }
 281          } else {
 282              int installedXposedVersionInt = XposedApp.getXposedVersion();
 283              if (installedXposedVersionInt != 0) {
<abbr title=" 284                  txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, &quot;&quot; + installedXposedVersionInt));"> 284                  txtInstallError.setText(sActivity.getString(R.string.installed_lollipop, &quot;&quot; + installedXposedVersiðŸ”µ</abbr>
 285                  txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.darker_green));
 286                  txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.darker_green));
 287                  txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_check_circle));
 288                  isXposedInstalled = true;
 289                  if (DISABLE_FILE.exists()) {
<abbr title=" 290                      txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, &quot;&quot; + installedXposedVersionInt));"> 290                      txtInstallError.setText(sActivity.getString(R.string.installed_lollipop_inactive, &quot;&quot; + installðŸ”µ</abbr>
 291                      txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.amber_500));
 292                      txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.amber_500));
 293                      txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_warning));
 294                  }
 295              } else {
 296                  txtInstallError.setText(sActivity.getString(R.string.not_installed_no_lollipop));
 297                  txtInstallError.setTextColor(sActivity.getResources().getColor(R.color.warning));
 298                  txtInstallContainer.setBackgroundColor(sActivity.getResources().getColor(R.color.warning));
 299                  txtInstallIcon.setImageDrawable(sActivity.getResources().getDrawable(R.drawable.ic_error));
 300                  xposedDisable.setVisibility(View.GONE);
 301                  disableView.setVisibility(View.GONE);
 302              }
 303          }
 304  
 305          xposedDisable.setChecked(!DISABLE_FILE.exists());
 306  
 307          xposedDisable.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
 308              @Override
 309              public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
 310                  if (DISABLE_FILE.exists()) {
 311                      DISABLE_FILE.delete();
 312                      Snackbar.make(xposedDisable, R.string.xposed_on_next_reboot, Snackbar.LENGTH_LONG).show();
 313                  } else {
 314                      try {
 315                          DISABLE_FILE.createNewFile();
<abbr title=" 316                          Snackbar.make(xposedDisable, R.string.xposed_off_next_reboot, Snackbar.LENGTH_LONG).show();"> 316                          Snackbar.make(xposedDisable, R.string.xposed_off_next_reboot, Snackbar.LENGTH_LONG).show()ðŸ”µ</abbr>
 317                      } catch (IOException e) {
 318                          Log.e(XposedApp.TAG, &quot;StatusInstallerFragment -&gt; &quot; + e.getMessage());
 319                      }
 320                  }
 321              }
 322          });
 323  
<abbr title=" 324          androidSdk.setText(getString(R.string.android_sdk, getAndroidVersion(), Build.VERSION.RELEASE, Build.VERSION.SDK_INT));"> 324          androidSdk.setText(getString(R.string.android_sdk, getAndroidVersion(), Build.VERSION.RELEASE, Build.VERSIðŸ”µ</abbr>
 325          manufacturer.setText(getUIFramework());
 326          cpu.setText(getCompleteArch());
 327  
 328          refreshKnownIssue();
 329          setHint();
 330          return v;
 331      }
 332  
 333      @SuppressLint(&quot;StringFormatInvalid&quot;)
 334      private void refreshKnownIssue() {
 335          String issueName = null;
 336          String issueLink = null;
 337  
 338          if (new File(&quot;/system/framework/core.jar.jex&quot;).exists()) {
 339              issueName = &quot;Aliyun OS&quot;;
 340              issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52289793&amp;postcount=5&quot;;
 341  
<abbr title=" 342          } else if (new File(&quot;/data/miui/DexspyInstaller.jar&quot;).exists() || checkClassExists(&quot;miui.dexspy.DexspyInstaller&quot;)) {"> 342          } else if (new File(&quot;/data/miui/DexspyInstaller.jar&quot;).exists() || checkClassExists(&quot;miui.dexspy.DexspyInstðŸ”µ</abbr>
 343              issueName = &quot;MIUI/Dexspy&quot;;
 344              issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52291098&amp;postcount=6&quot;;
 345  
 346          } else if (checkClassExists(&quot;com.huawei.android.content.res.ResourcesEx&quot;)
 347                  || checkClassExists(&quot;android.content.res.NubiaResources&quot;)) {
 348              issueName = &quot;Resources subclass&quot;;
 349              issueLink = &quot;http://forum.xda-developers.com/showpost.php?p=52801382&amp;postcount=8&quot;;
 350          }
 351  
 352          if (issueName != null) {
 353              final String issueLinkFinal = issueLink;
 354              txtKnownIssue.setText(getString(R.string.install_known_issue, issueName));
 355              txtKnownIssue.setVisibility(View.VISIBLE);
 356              txtKnownIssue.setOnClickListener(new View.OnClickListener() {
 357                  @Override
 358                  public void onClick(View v) {
 359                      NavUtil.startURL(getActivity(), issueLinkFinal);
 360                  }
 361              });
 362          } else {
 363              txtKnownIssue.setVisibility(View.GONE);
 364          }
 365      }
 366  
 367      private void setHint() {
 368          String manufacturer = Build.MANUFACTURER.toLowerCase();
 369  
 370          File twFramework = new File(&quot;/system/framework/twframework.jar&quot;);
 371          File miuiFramework = new File(&quot;/system/framework/framework-miui-res.jar&quot;);
 372  
 373          String hint = getString(R.string.original_framework);
 374          int tab = 1;
 375          if (manufacturer.contains(&quot;samsung&quot;)) {
 376              if (twFramework.exists()) {
 377                  hint = getString(R.string.device_own, &quot;Samsung&quot;, &quot;TouchWiz&quot;);
 378                  tab = 3;
 379              } else {
 380                  hint = getString(R.string.device_own, &quot;Samsung&quot;, &quot;AOSP-based&quot;);
 381                  tab = 1;
 382              }
 383          } else if (manufacturer.contains(&quot;xiaomi&quot;)) {
 384              if (miuiFramework.exists()) {
 385                  hint = getString(R.string.device_own, &quot;Xiaomi&quot;, &quot;MIUI&quot;);
 386                  tab = 4;
 387              } else {
 388                  hint = getString(R.string.device_own, &quot;Xiaomi&quot;, &quot;AOSP-based&quot;);
 389                  tab = 1;
 390              }
 391          }
 392  
 393          final int finalTab = tab;
 394  
 395          mHint.setText(hint);
 396          mHintContainer.setOnClickListener(new View.OnClickListener() {
 397              @Override
 398              public void onClick(View v) {
 399                  AdvancedInstallerFragment.gotoPage(finalTab);
 400              }
 401          });
 402      }
 403  
 404      private String getAndroidVersion() {
 405          switch (Build.VERSION.SDK_INT) {
 406              case 16:
 407              case 17:
 408              case 18:
 409                  return &quot;Jelly Bean&quot;;
 410              case 19:
 411                  return &quot;KitKat&quot;;
 412              case 21:
 413              case 22:
 414                  return &quot;Lollipop&quot;;
 415              case 23:
 416                  return &quot;Marshmallow&quot;;
 417              case 24:
 418              case 25:
 419                  return &quot;Nougat&quot;;
 420          }
 421          return &quot;&quot;;
 422      }
 423  
 424      private String getUIFramework() {
<abbr title=" 425          String manufacturer = Character.toUpperCase(Build.MANUFACTURER.charAt(0)) + Build.MANUFACTURER.substring(1);"> 425          String manufacturer = Character.toUpperCase(Build.MANUFACTURER.charAt(0)) + Build.MANUFACTURER.substring(1ðŸ”µ</abbr>
 426          if (!Build.BRAND.equals(Build.MANUFACTURER)) {
 427              manufacturer += &quot; &quot; + Character.toUpperCase(Build.BRAND.charAt(0)) + Build.BRAND.substring(1);
 428          }
 429          manufacturer += &quot; &quot; + Build.MODEL + &quot; &quot;;
 430          if (manufacturer.contains(&quot;Samsung&quot;)) {
<abbr title=" 431              manufacturer += new File(&quot;/system/framework/twframework.jar&quot;).exists() ? &quot;(TouchWiz)&quot; : &quot;(AOSP-based ROM)&quot;;"> 431              manufacturer += new File(&quot;/system/framework/twframework.jar&quot;).exists() ? &quot;(TouchWiz)&quot; : &quot;(AOSP-based RðŸ”µ</abbr>
 432          } else if (manufacturer.contains(&quot;Xiaomi&quot;)) {
<abbr title=" 433              manufacturer += new File(&quot;/system/framework/framework-miui-res.apk&quot;).exists() ? &quot;(MIUI)&quot; : &quot;(AOSP-based ROM)&quot;;"> 433              manufacturer += new File(&quot;/system/framework/framework-miui-res.apk&quot;).exists() ? &quot;(MIUI)&quot; : &quot;(AOSP-baseðŸ”µ</abbr>
 434          }
 435          return manufacturer;
 436      }
 437  
 438      private int extractIntPart(String str) {
 439          int result = 0, length = str.length();
 440          for (int offset = 0; offset &lt; length; offset++) {
 441              char c = str.charAt(offset);
 442              if (&#x27;0&#x27; &lt;= c &amp;&amp; c &lt;= &#x27;9&#x27;)
 443                  result = result * 10 + (c - &#x27;0&#x27;);
 444              else
 445                  break;
 446          }
 447          return result;
 448      }
 449  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            