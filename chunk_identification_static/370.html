<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>370</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    370
                    <a href="369.html">prev</a>
                    <a href="371.html">next</a>
                    <a href="370_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_e408d12c730a7397701e361d52cac823c1694111_cassandra/cassandra-side/cassandra-all-side/src/main/java/com/dtstack/flink/sql/side/cassandra/CassandraAllReqRow.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e408d12c730a7397701e361d52cac823c1694111:cassandra/cassandra-side/cassandra-all-side/src/main/java/com/dtstack/flink/sql/side/cassandra/CassandraAllReqRow.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e408d12c730a7397701e361d52cac823c1694111^1:cassandra/cassandra-side/cassandra-all-side/src/main/java/com/dtstack/flink/sql/side/cassandra/CassandraAllReqRow.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e408d12c730a7397701e361d52cac823c1694111^2:cassandra/cassandra-side/cassandra-all-side/src/main/java/com/dtstack/flink/sql/side/cassandra/CassandraAllReqRow.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;09a8d23c2b8c9e6955f6f68bed4a2fe16cc7fbd3:cassandra/cassandra-side/cassandra-all-side/src/main/java/com/dtstack/flink/sql/side/cassandra/CassandraAllReqRow.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [j]], subset: [[b], [j]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span class="-167599954638689123" onmouseenter="enter('-167599954638689123');" onmouseout="out('-167599954638689123');" style="">  19 package com.dtstack.flink.sql.side.cassandra;                                                            </span>
<span  style="">  20                                                                                                          </span>
<span class="-1321606514279996521" onmouseenter="enter('-1321606514279996521');" onmouseout="out('-1321606514279996521');" style="">  21 import com.datastax.driver.core.*;                                                                       </span>
<span class="102554056665873953" onmouseenter="enter('102554056665873953');" onmouseout="out('102554056665873953');" style="">  22 import com.datastax.driver.core.policies.DowngradingConsistencyRetryPolicy;                              </span>
<span class="384780421342561763" onmouseenter="enter('384780421342561763');" onmouseout="out('384780421342561763');" style="">  23 import com.datastax.driver.core.policies.RetryPolicy;                                                    </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">  24 import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                 </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">  25 import com.dtstack.flink.sql.side.BaseAllReqRow;                                                         </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">  26 import com.dtstack.flink.sql.side.FieldInfo;                                                             </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">  27 import com.dtstack.flink.sql.side.JoinInfo;                                                              </span>
<span class="1325017007675469198" onmouseenter="enter('1325017007675469198');" onmouseout="out('1325017007675469198');" style="">  28 import com.dtstack.flink.sql.side.cassandra.table.CassandraSideTableInfo;                                </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="">  29 import com.dtstack.flink.sql.util.RowDataComplete;                                                       </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  30 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  31 import com.google.common.collect.Maps;                                                                   </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  32 import org.apache.calcite.sql.JoinType;                                                                  </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  33 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  34 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  35 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  36 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  37 import org.apache.flink.types.Row;                                                                       </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  38 import org.apache.flink.util.Collector;                                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  39 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  40 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  41                                                                                                          </span>
<span class="-5790770097715703577" onmouseenter="enter('-5790770097715703577');" onmouseout="out('-5790770097715703577');" style="">  42 import java.net.InetAddress;                                                                             </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  43 import java.sql.SQLException;                                                                            </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  44 import java.util.ArrayList;                                                                              </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  45 import java.util.Calendar;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  46 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  47 import java.util.Map;                                                                                    </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  48 import java.util.concurrent.atomic.AtomicReference;                                                      </span>
<span  style="">  49                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50 /**                                                                                                      </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  51  * Reason:                                                                                               </span>
<span class="-6869475929847104911" onmouseenter="enter('-6869475929847104911');" onmouseout="out('-6869475929847104911');" style="">  52  * Date: 2018/11/22                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  53  *                                                                                                       </span>
<span class="-3762428130562648" onmouseenter="enter('-3762428130562648');" onmouseout="out('-3762428130562648');" style="">  54  * @author xuqianjin                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  55  */                                                                                                      </span>
<span class="-6675566310149196216" onmouseenter="enter('-6675566310149196216');" onmouseout="out('-6675566310149196216');" style="">  56 public class CassandraAllReqRow extends BaseAllReqRow {                                                  </span>
<span  style="">  57                                                                                                          </span>
<span class="4439649471140456736" onmouseenter="enter('4439649471140456736');" onmouseout="out('4439649471140456736');" style="">  58     private static final long serialVersionUID = 54015343561288219L;                                     </span>
<span  style="">  59                                                                                                          </span>
<span class="-1268576216050451679" onmouseenter="enter('-1268576216050451679');" onmouseout="out('-1268576216050451679');" style="">  60     private static final Logger LOG = LoggerFactory.getLogger(CassandraAllReqRow.class);                 </span>
<span  style="">  61                                                                                                          </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  62     private static final int CONN_RETRY_NUM = 3;                                                         </span>
<span  style="">  63                                                                                                          </span>
<span class="-6477960095702488783" onmouseenter="enter('-6477960095702488783');" onmouseout="out('-6477960095702488783');" style="">  64     private static final int FETCH_SIZE = 1000;                                                          </span>
<span  style="">  65                                                                                                          </span>
<span class="-5403177446568963001" onmouseenter="enter('-5403177446568963001');" onmouseout="out('-5403177446568963001');" style="">  66     private transient Cluster cluster;                                                                   </span>
<span class="4255085420266776167" onmouseenter="enter('4255085420266776167');" onmouseout="out('4255085420266776167');" style="">  67     private transient Session session = null;                                                            </span>
<span  style="">  68                                                                                                          </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  69     private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();  </span>
<span  style="">  70                                                                                                          </span>
<span class="2177500233543861344" onmouseenter="enter('2177500233543861344');" onmouseout="out('2177500233543861344');" style=""><abbr title="  71     public CassandraAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  71     public CassandraAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoLis🔵</abbr></span>
<span class="-3254922457036187140" onmouseenter="enter('-3254922457036187140');" onmouseout="out('-3254922457036187140');" style=""><abbr title="  72         super(new com.dtstack.flink.sql.side.cassandra.CassandraAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));">  72         super(new com.dtstack.flink.sql.side.cassandra.CassandraAllSideInfo(rowTypeInfo, joinInfo, outFie🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  73     }                                                                                                    </span>
<span  style="">  74                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  75     @Override                                                                                            </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  76 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78         Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                 </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81             Object obj = input.getField(entry.getValue());                                               </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82             obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                    </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85                                                                                                          </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95     }                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97     @Override                                                                                            </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  98 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99                                                                                                          </span>
<span class="2177500233543861344" onmouseenter="enter('2177500233543861344');" onmouseout="out('2177500233543861344');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 100     public CassandraAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {"> 100     public CassandraAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoLis🔵</abbr></span>
<span class="-3254922457036187140" onmouseenter="enter('-3254922457036187140');" onmouseout="out('-3254922457036187140');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 101         super(new com.dtstack.flink.sql.side.cassandra.CassandraAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));"> 101         super(new com.dtstack.flink.sql.side.cassandra.CassandraAllSideInfo(rowTypeInfo, joinInfo, outFie🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104     @Override                                                                                            </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106         Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                 </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109             Object obj = input.getField(entry.getValue());                                               </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 110             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 110             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 112             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 112             //Type information for indicating event or processing time. However, it behaves like a regula🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114                 //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                            </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 115                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());"> 115                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime())🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117                                                                                                          </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119         }                                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 120 =======                                                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 121 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-5452513235343270061" onmouseenter="enter('-5452513235343270061');" onmouseout="out('-5452513235343270061');" style=""> 122     protected void initCache() throws SQLException {                                                     </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 123         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 124         cacheRef.set(newCache);                                                                          </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 125         loadData(newCache);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126     }                                                                                                    </span>
<span  style=""> 127                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 128     @Override                                                                                            </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 129     protected void reloadCache() {                                                                       </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 130         //reload cacheRef and replace to old cacheRef                                                    </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 131         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 132         try {                                                                                            </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 133             loadData(newCache);                                                                          </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style=""> 134         } catch (SQLException e) {                                                                       </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 135             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136         }                                                                                                </span>
<span  style=""> 137                                                                                                          </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 138         cacheRef.set(newCache);                                                                          </span>
<span class="6972180338294555519" onmouseenter="enter('6972180338294555519');" onmouseout="out('6972180338294555519');" style=""> 139         LOG.info(&quot;----- cassandra all cacheRef reload end:{}&quot;, Calendar.getInstance());                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140     }                                                                                                    </span>
<span  style=""> 141                                                                                                          </span>
<span  style=""> 142                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 143     @Override                                                                                            </span>
<span class="6843933761729718422" onmouseenter="enter('6843933761729718422');" onmouseout="out('6843933761729718422');" style=""> 144     public void flatMap(Row input, Collector&lt;BaseRow&gt; out) throws Exception {                            </span>
<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style=""> 145         List&lt;Object&gt; inputParams = Lists.newArrayList();                                                 </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style=""> 146         for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                        </span>
<span class="7582033886787525124" onmouseenter="enter('7582033886787525124');" onmouseout="out('7582033886787525124');" style=""> 147             Object equalObj = input.getField(conValIndex);                                               </span>
<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style=""> 148             if (equalObj == null) {                                                                      </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style=""> 149                 if (sideInfo.getJoinType() == JoinType.LEFT) {                                           </span>
<span class="-3752240759126097062" onmouseenter="enter('-3752240759126097062');" onmouseout="out('-3752240759126097062');" style=""> 150                     Row row = fillData(input, null);                                                     </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 151                     RowDataComplete.collectRow(out, row);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152                 }                                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 153                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154             }                                                                                            </span>
<span  style=""> 155                                                                                                          </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style=""> 156             inputParams.add(equalObj);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157         }                                                                                                </span>
<span  style=""> 158                                                                                                          </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style=""> 159         String key = buildKey(inputParams);                                                              </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style=""> 160         List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                   </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style=""> 161         if (CollectionUtils.isEmpty(cacheList)) {                                                        </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style=""> 162             if (sideInfo.getJoinType() == JoinType.LEFT) {                                               </span>
<span class="-3752240759126097062" onmouseenter="enter('-3752240759126097062');" onmouseout="out('-3752240759126097062');" style=""> 163                 Row row = fillData(input, null);                                                         </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 164                 RowDataComplete.collectRow(out, row);                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 165             } else {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 166                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167             }                                                                                            </span>
<span  style=""> 168                                                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 169             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170         }                                                                                                </span>
<span  style=""> 171                                                                                                          </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style=""> 172         for (Map&lt;String, Object&gt; one : cacheList) {                                                      </span>
<span class="-6006003971782103198" onmouseenter="enter('-6006003971782103198');" onmouseout="out('-6006003971782103198');" style=""> 173             Row row = fillData(input, one);                                                              </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 174             RowDataComplete.collectRow(out, row);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175         }                                                                                                </span>
<span  style=""> 176                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177     }                                                                                                    </span>
<span  style=""> 178                                                                                                          </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 179     private String buildKey(List&lt;Object&gt; equalValList) {                                                 </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 180         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 181         for (Object equalVal : equalValList) {                                                           </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 182             sb.append(equalVal).append(&quot;_&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183         }                                                                                                </span>
<span  style=""> 184                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 185         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186     }                                                                                                    </span>
<span  style=""> 187                                                                                                          </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 188     private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                      </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 189         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 190         for (String equalField : equalFieldList) {                                                       </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 191             sb.append(val.get(equalField)).append(&quot;_&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192         }                                                                                                </span>
<span  style=""> 193                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 194         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195     }                                                                                                    </span>
<span  style=""> 196                                                                                                          </span>
<span class="4019233468954892213" onmouseenter="enter('4019233468954892213');" onmouseout="out('4019233468954892213');" style=""> 197     private Session getConn(CassandraSideTableInfo tableInfo) {                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 198         try {                                                                                            </span>
<span class="417819926325380348" onmouseenter="enter('417819926325380348');" onmouseout="out('417819926325380348');" style=""> 199             if (session == null) {                                                                       </span>
<span class="-3605639280329188999" onmouseenter="enter('-3605639280329188999');" onmouseout="out('-3605639280329188999');" style=""> 200                 QueryOptions queryOptions = new QueryOptions();                                          </span>
<span class="5842973418300621663" onmouseenter="enter('5842973418300621663');" onmouseout="out('5842973418300621663');" style=""> 201                 //The default consistency level for queries: ConsistencyLevel.TWO.                       </span>
<span class="76010926262385906" onmouseenter="enter('76010926262385906');" onmouseout="out('76010926262385906');" style=""> 202                 queryOptions.setConsistencyLevel(ConsistencyLevel.QUORUM);                               </span>
<span class="-4388406259332422062" onmouseenter="enter('-4388406259332422062');" onmouseout="out('-4388406259332422062');" style=""><abbr title=" 203                 Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : tableInfo.getMaxRequestsPerConnection();"> 203                 Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : 🔵</abbr></span>
<span class="-6698153752588261803" onmouseenter="enter('-6698153752588261803');" onmouseout="out('-6698153752588261803');" style=""><abbr title=" 204                 Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tableInfo.getCoreConnectionsPerHost();"> 204                 Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tabl🔵</abbr></span>
<span class="3809961524454958986" onmouseenter="enter('3809961524454958986');" onmouseout="out('3809961524454958986');" style=""><abbr title=" 205                 Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : tableInfo.getMaxConnectionsPerHost();"> 205                 Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : ta🔵</abbr></span>
<span class="-3297929912963114654" onmouseenter="enter('-3297929912963114654');" onmouseout="out('-3297929912963114654');" style=""><abbr title=" 206                 Integer maxQueueSize = tableInfo.getMaxQueueSize() == null ? 100000 : tableInfo.getMaxQueueSize();"> 206                 Integer maxQueueSize = tableInfo.getMaxQueueSize() == null ? 100000 : tableInfo.getMaxQue🔵</abbr></span>
<span class="-1822015680936096661" onmouseenter="enter('-1822015680936096661');" onmouseout="out('-1822015680936096661');" style=""><abbr title=" 207                 Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.getReadTimeoutMillis();"> 207                 Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.🔵</abbr></span>
<span class="5588349030185896717" onmouseenter="enter('5588349030185896717');" onmouseout="out('5588349030185896717');" style=""><abbr title=" 208                 Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tableInfo.getConnectTimeoutMillis();"> 208                 Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tabl🔵</abbr></span>
<span class="5493190487826327243" onmouseenter="enter('5493190487826327243');" onmouseout="out('5493190487826327243');" style=""><abbr title=" 209                 Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.getPoolTimeoutMillis();"> 209                 Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.🔵</abbr></span>
<span class="-5259680847618191912" onmouseenter="enter('-5259680847618191912');" onmouseout="out('-5259680847618191912');" style=""> 210                 Integer cassandraPort = 0;                                                               </span>
<span class="-8848193911625825371" onmouseenter="enter('-8848193911625825371');" onmouseout="out('-8848193911625825371');" style=""> 211                 String address = tableInfo.getAddress();                                                 </span>
<span class="2950506038619853549" onmouseenter="enter('2950506038619853549');" onmouseout="out('2950506038619853549');" style=""> 212                 String userName = tableInfo.getUserName();                                               </span>
<span class="-4521409941966564293" onmouseenter="enter('-4521409941966564293');" onmouseout="out('-4521409941966564293');" style=""> 213                 String password = tableInfo.getPassword();                                               </span>
<span class="-6108815609943098672" onmouseenter="enter('-6108815609943098672');" onmouseout="out('-6108815609943098672');" style=""> 214                 String database = tableInfo.getDatabase();                                               </span>
<span  style=""> 215                                                                                                          </span>
<span class="6493913905304408918" onmouseenter="enter('6493913905304408918');" onmouseout="out('6493913905304408918');" style=""> 216                 ArrayList serversList = new ArrayList();                                                 </span>
<span class="5423738273364037419" onmouseenter="enter('5423738273364037419');" onmouseout="out('5423738273364037419');" style=""> 217                 //Read timeout or connection timeout Settings                                            </span>
<span class="-1651403584650918350" onmouseenter="enter('-1651403584650918350');" onmouseout="out('-1651403584650918350');" style=""> 218                 SocketOptions so = new SocketOptions()                                                   </span>
<span class="-6143815205992723671" onmouseenter="enter('-6143815205992723671');" onmouseout="out('-6143815205992723671');" style=""> 219                         .setReadTimeoutMillis(readTimeoutMillis)                                         </span>
<span class="-7477024419561329894" onmouseenter="enter('-7477024419561329894');" onmouseout="out('-7477024419561329894');" style=""> 220                         .setConnectTimeoutMillis(connectTimeoutMillis);                                  </span>
<span  style=""> 221                                                                                                          </span>
<span class="36776837264098679" onmouseenter="enter('36776837264098679');" onmouseout="out('36776837264098679');" style=""> 222                 //The cluster USES hostdistance.local in the same machine room                           </span>
<span class="-4067753854505755618" onmouseenter="enter('-4067753854505755618');" onmouseout="out('-4067753854505755618');" style=""> 223                 //Hostdistance. REMOTE is used for different machine rooms                               </span>
<span class="-1239540897477970915" onmouseenter="enter('-1239540897477970915');" onmouseout="out('-1239540897477970915');" style=""> 224                 //Ignore use HostDistance. IGNORED                                                       </span>
<span class="7507936330523201209" onmouseenter="enter('7507936330523201209');" onmouseout="out('7507936330523201209');" style=""> 225                 PoolingOptions poolingOptions = new PoolingOptions()                                     </span>
<span class="4173548347137079648" onmouseenter="enter('4173548347137079648');" onmouseout="out('4173548347137079648');" style=""> 226                         //Each connection allows a maximum of 64 concurrent requests                     </span>
<span class="6109267905237967219" onmouseenter="enter('6109267905237967219');" onmouseout="out('6109267905237967219');" style=""> 227                         .setMaxRequestsPerConnection(HostDistance.LOCAL, maxRequestsPerConnection)       </span>
<span class="-8245292782127165862" onmouseenter="enter('-8245292782127165862');" onmouseout="out('-8245292782127165862');" style=""> 228                         //Have at least two connections to each machine in the cluster                   </span>
<span class="7216166406224594146" onmouseenter="enter('7216166406224594146');" onmouseout="out('7216166406224594146');" style=""> 229                         .setCoreConnectionsPerHost(HostDistance.LOCAL, coreConnectionsPerHost)           </span>
<span class="-1358272374234048070" onmouseenter="enter('-1358272374234048070');" onmouseout="out('-1358272374234048070');" style=""> 230                         //There are up to eight connections to each machine in the cluster               </span>
<span class="-1698869078338541686" onmouseenter="enter('-1698869078338541686');" onmouseout="out('-1698869078338541686');" style=""> 231                         .setMaxConnectionsPerHost(HostDistance.LOCAL, maxConnectionsPerHost)             </span>
<span class="1548703418514968406" onmouseenter="enter('1548703418514968406');" onmouseout="out('1548703418514968406');" style=""> 232                         .setMaxQueueSize(maxQueueSize)                                                   </span>
<span class="3524981482635418824" onmouseenter="enter('3524981482635418824');" onmouseout="out('3524981482635418824');" style=""> 233                         .setPoolTimeoutMillis(poolTimeoutMillis);                                        </span>
<span class="-3027653360277295120" onmouseenter="enter('-3027653360277295120');" onmouseout="out('-3027653360277295120');" style=""> 234                 //重试策略                                                                                   </span>
<span class="-2500245183701794239" onmouseenter="enter('-2500245183701794239');" onmouseout="out('-2500245183701794239');" style=""> 235                 RetryPolicy retryPolicy = DowngradingConsistencyRetryPolicy.INSTANCE;                    </span>
<span  style=""> 236                                                                                                          </span>
<span class="6634426984636856768" onmouseenter="enter('6634426984636856768');" onmouseout="out('6634426984636856768');" style=""> 237                 for (String server : StringUtils.split(address, &quot;,&quot;)) {                                  </span>
<span class="-4294448682063399613" onmouseenter="enter('-4294448682063399613');" onmouseout="out('-4294448682063399613');" style=""> 238                     cassandraPort = Integer.parseInt(StringUtils.split(server, &quot;:&quot;)[1]);                 </span>
<span class="7751295421103553875" onmouseenter="enter('7751295421103553875');" onmouseout="out('7751295421103553875');" style=""> 239                     serversList.add(InetAddress.getByName(StringUtils.split(server, &quot;:&quot;)[0]));           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240                 }                                                                                        </span>
<span  style=""> 241                                                                                                          </span>
<span class="3673717518338030181" onmouseenter="enter('3673717518338030181');" onmouseout="out('3673717518338030181');" style=""> 242                 if (userName == null || userName.isEmpty() || password == null || password.isEmpty()) {  </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""><abbr title=" 243                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)"> 243                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy🔵</abbr></span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 244                             .withPort(cassandraPort)                                                     </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 245                             .withPoolingOptions(poolingOptions).withSocketOptions(so)                    </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 246                             .withQueryOptions(queryOptions).build();                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 247                 } else {                                                                                 </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""><abbr title=" 248                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)"> 248                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy🔵</abbr></span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 249                             .withPort(cassandraPort)                                                     </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 250                             .withPoolingOptions(poolingOptions).withSocketOptions(so)                    </span>
<span class="-5038512354126172278" onmouseenter="enter('-5038512354126172278');" onmouseout="out('-5038512354126172278');" style=""> 251                             .withCredentials(userName, password)                                         </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 252                             .withQueryOptions(queryOptions).build();                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253                 }                                                                                        </span>
<span class="765464969334355038" onmouseenter="enter('765464969334355038');" onmouseout="out('765464969334355038');" style=""> 254                 // 建立连接 连接已存在的键空间                                                                        </span>
<span class="2858714417352384930" onmouseenter="enter('2858714417352384930');" onmouseout="out('2858714417352384930');" style=""> 255                 session = cluster.connect(database);                                                     </span>
<span class="8518739044679915590" onmouseenter="enter('8518739044679915590');" onmouseout="out('8518739044679915590');" style=""> 256                 LOG.info(&quot;connect cassandra is successed!&quot;);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 258         } catch (Exception e) {                                                                          </span>
<span class="7191685386448857101" onmouseenter="enter('7191685386448857101');" onmouseout="out('7191685386448857101');" style=""> 259             LOG.error(&quot;connect cassandra is error:&quot; + e.getMessage());                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 260         }                                                                                                </span>
<span class="7720471630782662993" onmouseenter="enter('7720471630782662993');" onmouseout="out('7720471630782662993');" style=""> 261         return session;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262     }                                                                                                    </span>
<span  style=""> 263                                                                                                          </span>
<span  style=""> 264                                                                                                          </span>
<span class="-6280115829611879826" onmouseenter="enter('-6280115829611879826');" onmouseout="out('-6280115829611879826');" style=""> 265     private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) throws SQLException {         </span>
<span class="-6391193908965303732" onmouseenter="enter('-6391193908965303732');" onmouseout="out('-6391193908965303732');" style=""> 266         CassandraSideTableInfo tableInfo = (CassandraSideTableInfo) sideInfo.getSideTableInfo();         </span>
<span class="-3023606661382789819" onmouseenter="enter('-3023606661382789819');" onmouseout="out('-3023606661382789819');" style=""> 267         Session session = null;                                                                          </span>
<span  style=""> 268                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 269         try {                                                                                            </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 270             for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 271                 try {                                                                                    </span>
<span class="-2308523158950278142" onmouseenter="enter('-2308523158950278142');" onmouseout="out('-2308523158950278142');" style=""> 272                     session = getConn(tableInfo);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 273                     break;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 274                 } catch (Exception e) {                                                                  </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 275                     if (i == CONN_RETRY_NUM - 1) {                                                       </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 276                         throw new RuntimeException(&quot;&quot;, e);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277                     }                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 278                     try {                                                                                </span>
<span class="-351091341770177564" onmouseenter="enter('-351091341770177564');" onmouseout="out('-351091341770177564');" style=""><abbr title=" 279                         String connInfo = &quot;address:&quot; + tableInfo.getAddress() + &quot;;userName:&quot; + tableInfo.getUserName()"> 279                         String connInfo = &quot;address:&quot; + tableInfo.getAddress() + &quot;;userName:&quot; + tableInfo.🔵</abbr></span>
<span class="9039417523603645611" onmouseenter="enter('9039417523603645611');" onmouseout="out('9039417523603645611');" style=""> 280                                 + &quot;,pwd:&quot; + tableInfo.getPassword();                                     </span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 281                         LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);   </span>
<span class="-399370949889032298" onmouseenter="enter('-399370949889032298');" onmouseout="out('-399370949889032298');" style=""> 282                         Thread.sleep(LOAD_DATA_ERROR_SLEEP_TIME);                                        </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 283                     } catch (InterruptedException e1) {                                                  </span>
<span class="8814860350844370078" onmouseenter="enter('8814860350844370078');" onmouseout="out('8814860350844370078');" style=""> 284                         LOG.error(&quot;&quot;, e1);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286                 }                                                                                        </span>
<span  style=""> 287                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288             }                                                                                            </span>
<span  style=""> 289                                                                                                          </span>
<span class="475138084615438717" onmouseenter="enter('475138084615438717');" onmouseout="out('475138084615438717');" style=""> 290             //load data from table                                                                       </span>
<span class="-1104953430559584261" onmouseenter="enter('-1104953430559584261');" onmouseout="out('-1104953430559584261');" style=""> 291             String sql = sideInfo.getSqlCondition() + &quot; limit &quot; + FETCH_SIZE;                            </span>
<span class="7174096590211324737" onmouseenter="enter('7174096590211324737');" onmouseout="out('7174096590211324737');" style=""> 292             ResultSet resultSet = session.execute(sql);                                                  </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 293             String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);            </span>
<span class="-8969977045023326611" onmouseenter="enter('-8969977045023326611');" onmouseout="out('-8969977045023326611');" style=""> 294             for (com.datastax.driver.core.Row row : resultSet) {                                         </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 295                 Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                          </span>
<span class="-587926084208094606" onmouseenter="enter('-587926084208094606');" onmouseout="out('-587926084208094606');" style=""> 296                 for (String fieldName : sideFieldNames) {                                                </span>
<span class="-7507266122996926506" onmouseenter="enter('-7507266122996926506');" onmouseout="out('-7507266122996926506');" style=""> 297                     oneRow.put(fieldName.trim(), row.getObject(fieldName.trim()));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298                 }                                                                                        </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 299                 String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                        </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""><abbr title=" 300                 List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList());"> 300                 List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArray🔵</abbr></span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 301                 list.add(oneRow);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 303         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 304             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 305         } finally {                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 306             try {                                                                                        </span>
<span class="-7143793951774237572" onmouseenter="enter('-7143793951774237572');" onmouseout="out('-7143793951774237572');" style=""> 307                 if (session != null) {                                                                   </span>
<span class="215842846359017500" onmouseenter="enter('215842846359017500');" onmouseout="out('215842846359017500');" style=""> 308                     session.close();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309                 }                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 310             } catch (Exception e) {                                                                      </span>
<span class="-6190899687770537846" onmouseenter="enter('-6190899687770537846');" onmouseout="out('-6190899687770537846');" style=""> 311                 LOG.error(&quot;Error while closing session.&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312             }                                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 313             try {                                                                                        </span>
<span class="7236775322084046720" onmouseenter="enter('7236775322084046720');" onmouseout="out('7236775322084046720');" style=""> 314                 if (cluster != null) {                                                                   </span>
<span class="-7802554339096083826" onmouseenter="enter('-7802554339096083826');" onmouseout="out('-7802554339096083826');" style=""> 315                     cluster.close();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316                 }                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 317             } catch (Exception e) {                                                                      </span>
<span class="-4991151540299943231" onmouseenter="enter('-4991151540299943231');" onmouseout="out('-4991151540299943231');" style=""> 318                 LOG.error(&quot;Error while closing cluster.&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322 }                                                                                                        </span>




</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span class="-167599954638689123" onmouseenter="enter('-167599954638689123');" onmouseout="out('-167599954638689123');" style="">  19 package com.dtstack.flink.sql.side.cassandra;                                                            </span>
<span  style="">  20                                                                                                          </span>
<span class="-1321606514279996521" onmouseenter="enter('-1321606514279996521');" onmouseout="out('-1321606514279996521');" style="">  21 import com.datastax.driver.core.*;                                                                       </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  22 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  23 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  24 import org.apache.flink.types.Row;                                                                       </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  25 import org.apache.flink.util.Collector;                                                                  </span>
<span class="102554056665873953" onmouseenter="enter('102554056665873953');" onmouseout="out('102554056665873953');" style="">  26 import com.datastax.driver.core.policies.DowngradingConsistencyRetryPolicy;                              </span>
<span class="384780421342561763" onmouseenter="enter('384780421342561763');" onmouseout="out('384780421342561763');" style="">  27 import com.datastax.driver.core.policies.RetryPolicy;                                                    </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">  28 import com.dtstack.flink.sql.side.BaseAllReqRow;                                                         </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">  29 import com.dtstack.flink.sql.side.FieldInfo;                                                             </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">  30 import com.dtstack.flink.sql.side.JoinInfo;                                                              </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">  31 import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                 </span>
<span class="1325017007675469198" onmouseenter="enter('1325017007675469198');" onmouseout="out('1325017007675469198');" style="">  32 import com.dtstack.flink.sql.side.cassandra.table.CassandraSideTableInfo;                                </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="">  33 import com.dtstack.flink.sql.util.RowDataComplete;                                                       </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  34 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  35 import com.google.common.collect.Maps;                                                                   </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  36 import org.apache.calcite.sql.JoinType;                                                                  </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  37 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  38 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  39 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  40 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  41                                                                                                          </span>
<span class="-5790770097715703577" onmouseenter="enter('-5790770097715703577');" onmouseout="out('-5790770097715703577');" style="">  42 import java.net.InetAddress;                                                                             </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  43 import java.sql.SQLException;                                                                            </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  44 import java.util.ArrayList;                                                                              </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  45 import java.util.Calendar;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  46 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  47 import java.util.Map;                                                                                    </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  48 import java.util.concurrent.atomic.AtomicReference;                                                      </span>
<span  style="">  49                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50 /**                                                                                                      </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  51  * Reason:                                                                                               </span>
<span class="-6869475929847104911" onmouseenter="enter('-6869475929847104911');" onmouseout="out('-6869475929847104911');" style="">  52  * Date: 2018/11/22                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  53  *                                                                                                       </span>
<span class="-3762428130562648" onmouseenter="enter('-3762428130562648');" onmouseout="out('-3762428130562648');" style="">  54  * @author xuqianjin                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  55  */                                                                                                      </span>
<span class="-6675566310149196216" onmouseenter="enter('-6675566310149196216');" onmouseout="out('-6675566310149196216');" style="">  56 public class CassandraAllReqRow extends BaseAllReqRow {                                                  </span>
<span  style="">  57                                                                                                          </span>
<span class="4439649471140456736" onmouseenter="enter('4439649471140456736');" onmouseout="out('4439649471140456736');" style="">  58     private static final long serialVersionUID = 54015343561288219L;                                     </span>
<span  style="">  59                                                                                                          </span>
<span class="-1268576216050451679" onmouseenter="enter('-1268576216050451679');" onmouseout="out('-1268576216050451679');" style="">  60     private static final Logger LOG = LoggerFactory.getLogger(CassandraAllReqRow.class);                 </span>
<span  style="">  61                                                                                                          </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  62     private static final int CONN_RETRY_NUM = 3;                                                         </span>
<span  style="">  63                                                                                                          </span>
<span class="-6477960095702488783" onmouseenter="enter('-6477960095702488783');" onmouseout="out('-6477960095702488783');" style="">  64     private static final int FETCH_SIZE = 1000;                                                          </span>
<span  style="">  65                                                                                                          </span>
<span class="-5403177446568963001" onmouseenter="enter('-5403177446568963001');" onmouseout="out('-5403177446568963001');" style="">  66     private transient Cluster cluster;                                                                   </span>
<span class="4255085420266776167" onmouseenter="enter('4255085420266776167');" onmouseout="out('4255085420266776167');" style="">  67     private transient Session session = null;                                                            </span>
<span  style="">  68                                                                                                          </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  69     private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();  </span>
<span  style="">  70                                                                                                          </span>
<span class="2177500233543861344" onmouseenter="enter('2177500233543861344');" onmouseout="out('2177500233543861344');" style=""><abbr title="  71     public CassandraAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  71     public CassandraAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoLis🔵</abbr></span>
<span class="-3254922457036187140" onmouseenter="enter('-3254922457036187140');" onmouseout="out('-3254922457036187140');" style=""><abbr title="  72         super(new com.dtstack.flink.sql.side.cassandra.CassandraAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));">  72         super(new com.dtstack.flink.sql.side.cassandra.CassandraAllSideInfo(rowTypeInfo, joinInfo, outFie🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  73     }                                                                                                    </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  74 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  75 @Override                                                                                                </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77         Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                 </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  78         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  79         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  80             Object obj = input.getField(entry.getValue());                                               </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  81             obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                    </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  82             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  83         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  84                                                                                                          </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  86             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  87                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  88             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  89                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  90             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  91         }                                                                                                </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  92                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  93         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  94     }                                                                                                    </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  95 ||||||| BASE                                                                                             </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96 @Override                                                                                                </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98         Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                 </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101             Object obj = input.getField(entry.getValue());                                               </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 102             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());"> 102             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 104             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 104             //Type information for indicating event or processing time. However, it behaves like a regula🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106                 //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                            </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 107                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());"> 107                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime())🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109                                                                                                          </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112                                                                                                          </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119         }                                                                                                </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 123 =======                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 124 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 125                                                                                                          </span>
<span  style=""> 126                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 127     @Override                                                                                            </span>
<span class="-5452513235343270061" onmouseenter="enter('-5452513235343270061');" onmouseout="out('-5452513235343270061');" style=""> 128     protected void initCache() throws SQLException {                                                     </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 129         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 130         cacheRef.set(newCache);                                                                          </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 131         loadData(newCache);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 132     }                                                                                                    </span>
<span  style=""> 133                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 134     @Override                                                                                            </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 135     protected void reloadCache() {                                                                       </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 136         //reload cacheRef and replace to old cacheRef                                                    </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 137         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 138         try {                                                                                            </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 139             loadData(newCache);                                                                          </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style=""> 140         } catch (SQLException e) {                                                                       </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 141             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142         }                                                                                                </span>
<span  style=""> 143                                                                                                          </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 144         cacheRef.set(newCache);                                                                          </span>
<span class="6972180338294555519" onmouseenter="enter('6972180338294555519');" onmouseout="out('6972180338294555519');" style=""> 145         LOG.info(&quot;----- cassandra all cacheRef reload end:{}&quot;, Calendar.getInstance());                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146     }                                                                                                    </span>
<span  style=""> 147                                                                                                          </span>
<span  style=""> 148                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 149     @Override                                                                                            </span>
<span class="6843933761729718422" onmouseenter="enter('6843933761729718422');" onmouseout="out('6843933761729718422');" style=""> 150     public void flatMap(Row input, Collector&lt;BaseRow&gt; out) throws Exception {                            </span>
<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style=""> 151         List&lt;Object&gt; inputParams = Lists.newArrayList();                                                 </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style=""> 152         for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                        </span>
<span class="7582033886787525124" onmouseenter="enter('7582033886787525124');" onmouseout="out('7582033886787525124');" style=""> 153             Object equalObj = input.getField(conValIndex);                                               </span>
<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style=""> 154             if (equalObj == null) {                                                                      </span>
<span class="-7689775219188827718" onmouseenter="enter('-7689775219188827718');" onmouseout="out('-7689775219188827718');" style=""> 155                 if(sideInfo.getJoinType() == JoinType.LEFT){                                             </span>
<span class="-3752240759126097062" onmouseenter="enter('-3752240759126097062');" onmouseout="out('-3752240759126097062');" style=""> 156                     Row row = fillData(input, null);                                                     </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 157                     RowDataComplete.collectRow(out, row);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158                 }                                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 159                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160             }                                                                                            </span>
<span  style=""> 161                                                                                                          </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style=""> 162             inputParams.add(equalObj);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163         }                                                                                                </span>
<span  style=""> 164                                                                                                          </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style=""> 165         String key = buildKey(inputParams);                                                              </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style=""> 166         List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                   </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style=""> 167         if (CollectionUtils.isEmpty(cacheList)) {                                                        </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style=""> 168             if (sideInfo.getJoinType() == JoinType.LEFT) {                                               </span>
<span class="-3752240759126097062" onmouseenter="enter('-3752240759126097062');" onmouseout="out('-3752240759126097062');" style=""> 169                 Row row = fillData(input, null);                                                         </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 170                 RowDataComplete.collectRow(out, row);                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 171             } else {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 172                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173             }                                                                                            </span>
<span  style=""> 174                                                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 175             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176         }                                                                                                </span>
<span  style=""> 177                                                                                                          </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style=""> 178         for (Map&lt;String, Object&gt; one : cacheList) {                                                      </span>
<span class="-6006003971782103198" onmouseenter="enter('-6006003971782103198');" onmouseout="out('-6006003971782103198');" style=""> 179             Row row = fillData(input, one);                                                              </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 180             RowDataComplete.collectRow(out, row);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181         }                                                                                                </span>
<span  style=""> 182                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183     }                                                                                                    </span>
<span  style=""> 184                                                                                                          </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 185     private String buildKey(List&lt;Object&gt; equalValList) {                                                 </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 186         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 187         for (Object equalVal : equalValList) {                                                           </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 188             sb.append(equalVal).append(&quot;_&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189         }                                                                                                </span>
<span  style=""> 190                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 191         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192     }                                                                                                    </span>
<span  style=""> 193                                                                                                          </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 194     private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                      </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 195         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 196         for (String equalField : equalFieldList) {                                                       </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 197             sb.append(val.get(equalField)).append(&quot;_&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198         }                                                                                                </span>
<span  style=""> 199                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 200         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201     }                                                                                                    </span>
<span  style=""> 202                                                                                                          </span>
<span class="4019233468954892213" onmouseenter="enter('4019233468954892213');" onmouseout="out('4019233468954892213');" style=""> 203     private Session getConn(CassandraSideTableInfo tableInfo) {                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 204         try {                                                                                            </span>
<span class="417819926325380348" onmouseenter="enter('417819926325380348');" onmouseout="out('417819926325380348');" style=""> 205             if (session == null) {                                                                       </span>
<span class="-3605639280329188999" onmouseenter="enter('-3605639280329188999');" onmouseout="out('-3605639280329188999');" style=""> 206                 QueryOptions queryOptions = new QueryOptions();                                          </span>
<span class="5842973418300621663" onmouseenter="enter('5842973418300621663');" onmouseout="out('5842973418300621663');" style=""> 207                 //The default consistency level for queries: ConsistencyLevel.TWO.                       </span>
<span class="76010926262385906" onmouseenter="enter('76010926262385906');" onmouseout="out('76010926262385906');" style=""> 208                 queryOptions.setConsistencyLevel(ConsistencyLevel.QUORUM);                               </span>
<span class="-4388406259332422062" onmouseenter="enter('-4388406259332422062');" onmouseout="out('-4388406259332422062');" style=""><abbr title=" 209                 Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : tableInfo.getMaxRequestsPerConnection();"> 209                 Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : 🔵</abbr></span>
<span class="-6698153752588261803" onmouseenter="enter('-6698153752588261803');" onmouseout="out('-6698153752588261803');" style=""><abbr title=" 210                 Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tableInfo.getCoreConnectionsPerHost();"> 210                 Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tabl🔵</abbr></span>
<span class="3809961524454958986" onmouseenter="enter('3809961524454958986');" onmouseout="out('3809961524454958986');" style=""><abbr title=" 211                 Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : tableInfo.getMaxConnectionsPerHost();"> 211                 Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : ta🔵</abbr></span>
<span class="-3297929912963114654" onmouseenter="enter('-3297929912963114654');" onmouseout="out('-3297929912963114654');" style=""><abbr title=" 212                 Integer maxQueueSize = tableInfo.getMaxQueueSize() == null ? 100000 : tableInfo.getMaxQueueSize();"> 212                 Integer maxQueueSize = tableInfo.getMaxQueueSize() == null ? 100000 : tableInfo.getMaxQue🔵</abbr></span>
<span class="-1822015680936096661" onmouseenter="enter('-1822015680936096661');" onmouseout="out('-1822015680936096661');" style=""><abbr title=" 213                 Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.getReadTimeoutMillis();"> 213                 Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.🔵</abbr></span>
<span class="5588349030185896717" onmouseenter="enter('5588349030185896717');" onmouseout="out('5588349030185896717');" style=""><abbr title=" 214                 Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tableInfo.getConnectTimeoutMillis();"> 214                 Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tabl🔵</abbr></span>
<span class="5493190487826327243" onmouseenter="enter('5493190487826327243');" onmouseout="out('5493190487826327243');" style=""><abbr title=" 215                 Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.getPoolTimeoutMillis();"> 215                 Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.🔵</abbr></span>
<span class="-5259680847618191912" onmouseenter="enter('-5259680847618191912');" onmouseout="out('-5259680847618191912');" style=""> 216                 Integer cassandraPort = 0;                                                               </span>
<span class="-8848193911625825371" onmouseenter="enter('-8848193911625825371');" onmouseout="out('-8848193911625825371');" style=""> 217                 String address = tableInfo.getAddress();                                                 </span>
<span class="2950506038619853549" onmouseenter="enter('2950506038619853549');" onmouseout="out('2950506038619853549');" style=""> 218                 String userName = tableInfo.getUserName();                                               </span>
<span class="-4521409941966564293" onmouseenter="enter('-4521409941966564293');" onmouseout="out('-4521409941966564293');" style=""> 219                 String password = tableInfo.getPassword();                                               </span>
<span class="-6108815609943098672" onmouseenter="enter('-6108815609943098672');" onmouseout="out('-6108815609943098672');" style=""> 220                 String database = tableInfo.getDatabase();                                               </span>
<span  style=""> 221                                                                                                          </span>
<span class="6493913905304408918" onmouseenter="enter('6493913905304408918');" onmouseout="out('6493913905304408918');" style=""> 222                 ArrayList serversList = new ArrayList();                                                 </span>
<span class="5423738273364037419" onmouseenter="enter('5423738273364037419');" onmouseout="out('5423738273364037419');" style=""> 223                 //Read timeout or connection timeout Settings                                            </span>
<span class="-1651403584650918350" onmouseenter="enter('-1651403584650918350');" onmouseout="out('-1651403584650918350');" style=""> 224                 SocketOptions so = new SocketOptions()                                                   </span>
<span class="-6143815205992723671" onmouseenter="enter('-6143815205992723671');" onmouseout="out('-6143815205992723671');" style=""> 225                         .setReadTimeoutMillis(readTimeoutMillis)                                         </span>
<span class="-7477024419561329894" onmouseenter="enter('-7477024419561329894');" onmouseout="out('-7477024419561329894');" style=""> 226                         .setConnectTimeoutMillis(connectTimeoutMillis);                                  </span>
<span  style=""> 227                                                                                                          </span>
<span class="36776837264098679" onmouseenter="enter('36776837264098679');" onmouseout="out('36776837264098679');" style=""> 228                 //The cluster USES hostdistance.local in the same machine room                           </span>
<span class="-4067753854505755618" onmouseenter="enter('-4067753854505755618');" onmouseout="out('-4067753854505755618');" style=""> 229                 //Hostdistance. REMOTE is used for different machine rooms                               </span>
<span class="-1239540897477970915" onmouseenter="enter('-1239540897477970915');" onmouseout="out('-1239540897477970915');" style=""> 230                 //Ignore use HostDistance. IGNORED                                                       </span>
<span class="7507936330523201209" onmouseenter="enter('7507936330523201209');" onmouseout="out('7507936330523201209');" style=""> 231                 PoolingOptions poolingOptions = new PoolingOptions()                                     </span>
<span class="4173548347137079648" onmouseenter="enter('4173548347137079648');" onmouseout="out('4173548347137079648');" style=""> 232                         //Each connection allows a maximum of 64 concurrent requests                     </span>
<span class="6109267905237967219" onmouseenter="enter('6109267905237967219');" onmouseout="out('6109267905237967219');" style=""> 233                         .setMaxRequestsPerConnection(HostDistance.LOCAL, maxRequestsPerConnection)       </span>
<span class="-8245292782127165862" onmouseenter="enter('-8245292782127165862');" onmouseout="out('-8245292782127165862');" style=""> 234                         //Have at least two connections to each machine in the cluster                   </span>
<span class="7216166406224594146" onmouseenter="enter('7216166406224594146');" onmouseout="out('7216166406224594146');" style=""> 235                         .setCoreConnectionsPerHost(HostDistance.LOCAL, coreConnectionsPerHost)           </span>
<span class="-1358272374234048070" onmouseenter="enter('-1358272374234048070');" onmouseout="out('-1358272374234048070');" style=""> 236                         //There are up to eight connections to each machine in the cluster               </span>
<span class="-1698869078338541686" onmouseenter="enter('-1698869078338541686');" onmouseout="out('-1698869078338541686');" style=""> 237                         .setMaxConnectionsPerHost(HostDistance.LOCAL, maxConnectionsPerHost)             </span>
<span class="1548703418514968406" onmouseenter="enter('1548703418514968406');" onmouseout="out('1548703418514968406');" style=""> 238                         .setMaxQueueSize(maxQueueSize)                                                   </span>
<span class="3524981482635418824" onmouseenter="enter('3524981482635418824');" onmouseout="out('3524981482635418824');" style=""> 239                         .setPoolTimeoutMillis(poolTimeoutMillis);                                        </span>
<span class="-3027653360277295120" onmouseenter="enter('-3027653360277295120');" onmouseout="out('-3027653360277295120');" style=""> 240                 //重试策略                                                                                   </span>
<span class="-2500245183701794239" onmouseenter="enter('-2500245183701794239');" onmouseout="out('-2500245183701794239');" style=""> 241                 RetryPolicy retryPolicy = DowngradingConsistencyRetryPolicy.INSTANCE;                    </span>
<span  style=""> 242                                                                                                          </span>
<span class="6634426984636856768" onmouseenter="enter('6634426984636856768');" onmouseout="out('6634426984636856768');" style=""> 243                 for (String server : StringUtils.split(address, &quot;,&quot;)) {                                  </span>
<span class="-4294448682063399613" onmouseenter="enter('-4294448682063399613');" onmouseout="out('-4294448682063399613');" style=""> 244                     cassandraPort = Integer.parseInt(StringUtils.split(server, &quot;:&quot;)[1]);                 </span>
<span class="7751295421103553875" onmouseenter="enter('7751295421103553875');" onmouseout="out('7751295421103553875');" style=""> 245                     serversList.add(InetAddress.getByName(StringUtils.split(server, &quot;:&quot;)[0]));           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246                 }                                                                                        </span>
<span  style=""> 247                                                                                                          </span>
<span class="3673717518338030181" onmouseenter="enter('3673717518338030181');" onmouseout="out('3673717518338030181');" style=""> 248                 if (userName == null || userName.isEmpty() || password == null || password.isEmpty()) {  </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""><abbr title=" 249                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)"> 249                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy🔵</abbr></span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 250                             .withPort(cassandraPort)                                                     </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 251                             .withPoolingOptions(poolingOptions).withSocketOptions(so)                    </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 252                             .withQueryOptions(queryOptions).build();                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 253                 } else {                                                                                 </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""><abbr title=" 254                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)"> 254                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy🔵</abbr></span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 255                             .withPort(cassandraPort)                                                     </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 256                             .withPoolingOptions(poolingOptions).withSocketOptions(so)                    </span>
<span class="-5038512354126172278" onmouseenter="enter('-5038512354126172278');" onmouseout="out('-5038512354126172278');" style=""> 257                             .withCredentials(userName, password)                                         </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 258                             .withQueryOptions(queryOptions).build();                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259                 }                                                                                        </span>
<span class="765464969334355038" onmouseenter="enter('765464969334355038');" onmouseout="out('765464969334355038');" style=""> 260                 // 建立连接 连接已存在的键空间                                                                        </span>
<span class="2858714417352384930" onmouseenter="enter('2858714417352384930');" onmouseout="out('2858714417352384930');" style=""> 261                 session = cluster.connect(database);                                                     </span>
<span class="8518739044679915590" onmouseenter="enter('8518739044679915590');" onmouseout="out('8518739044679915590');" style=""> 262                 LOG.info(&quot;connect cassandra is successed!&quot;);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 264         } catch (Exception e) {                                                                          </span>
<span class="7191685386448857101" onmouseenter="enter('7191685386448857101');" onmouseout="out('7191685386448857101');" style=""> 265             LOG.error(&quot;connect cassandra is error:&quot; + e.getMessage());                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266         }                                                                                                </span>
<span class="7720471630782662993" onmouseenter="enter('7720471630782662993');" onmouseout="out('7720471630782662993');" style=""> 267         return session;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268     }                                                                                                    </span>
<span  style=""> 269                                                                                                          </span>
<span  style=""> 270                                                                                                          </span>
<span class="-6280115829611879826" onmouseenter="enter('-6280115829611879826');" onmouseout="out('-6280115829611879826');" style=""> 271     private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) throws SQLException {         </span>
<span class="-6391193908965303732" onmouseenter="enter('-6391193908965303732');" onmouseout="out('-6391193908965303732');" style=""> 272         CassandraSideTableInfo tableInfo = (CassandraSideTableInfo) sideInfo.getSideTableInfo();         </span>
<span class="-3023606661382789819" onmouseenter="enter('-3023606661382789819');" onmouseout="out('-3023606661382789819');" style=""> 273         Session session = null;                                                                          </span>
<span  style=""> 274                                                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 275         try {                                                                                            </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 276             for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 277                 try {                                                                                    </span>
<span class="-2308523158950278142" onmouseenter="enter('-2308523158950278142');" onmouseout="out('-2308523158950278142');" style=""> 278                     session = getConn(tableInfo);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 279                     break;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 280                 } catch (Exception e) {                                                                  </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 281                     if (i == CONN_RETRY_NUM - 1) {                                                       </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 282                         throw new RuntimeException(&quot;&quot;, e);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283                     }                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 284                     try {                                                                                </span>
<span class="-351091341770177564" onmouseenter="enter('-351091341770177564');" onmouseout="out('-351091341770177564');" style=""><abbr title=" 285                         String connInfo = &quot;address:&quot; + tableInfo.getAddress() + &quot;;userName:&quot; + tableInfo.getUserName()"> 285                         String connInfo = &quot;address:&quot; + tableInfo.getAddress() + &quot;;userName:&quot; + tableInfo.🔵</abbr></span>
<span class="9039417523603645611" onmouseenter="enter('9039417523603645611');" onmouseout="out('9039417523603645611');" style=""> 286                                 + &quot;,pwd:&quot; + tableInfo.getPassword();                                     </span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 287                         LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);   </span>
<span class="-399370949889032298" onmouseenter="enter('-399370949889032298');" onmouseout="out('-399370949889032298');" style=""> 288                         Thread.sleep(LOAD_DATA_ERROR_SLEEP_TIME);                                        </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 289                     } catch (InterruptedException e1) {                                                  </span>
<span class="8814860350844370078" onmouseenter="enter('8814860350844370078');" onmouseout="out('8814860350844370078');" style=""> 290                         LOG.error(&quot;&quot;, e1);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 291                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292                 }                                                                                        </span>
<span  style=""> 293                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294             }                                                                                            </span>
<span  style=""> 295                                                                                                          </span>
<span class="475138084615438717" onmouseenter="enter('475138084615438717');" onmouseout="out('475138084615438717');" style=""> 296             //load data from table                                                                       </span>
<span class="-1104953430559584261" onmouseenter="enter('-1104953430559584261');" onmouseout="out('-1104953430559584261');" style=""> 297             String sql = sideInfo.getSqlCondition() + &quot; limit &quot; + FETCH_SIZE;                            </span>
<span class="7174096590211324737" onmouseenter="enter('7174096590211324737');" onmouseout="out('7174096590211324737');" style=""> 298             ResultSet resultSet = session.execute(sql);                                                  </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 299             String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);            </span>
<span class="-8969977045023326611" onmouseenter="enter('-8969977045023326611');" onmouseout="out('-8969977045023326611');" style=""> 300             for (com.datastax.driver.core.Row row : resultSet) {                                         </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 301                 Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                          </span>
<span class="-587926084208094606" onmouseenter="enter('-587926084208094606');" onmouseout="out('-587926084208094606');" style=""> 302                 for (String fieldName : sideFieldNames) {                                                </span>
<span class="-7507266122996926506" onmouseenter="enter('-7507266122996926506');" onmouseout="out('-7507266122996926506');" style=""> 303                     oneRow.put(fieldName.trim(), row.getObject(fieldName.trim()));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304                 }                                                                                        </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 305                 String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                        </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""><abbr title=" 306                 List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList());"> 306                 List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArray🔵</abbr></span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 307                 list.add(oneRow);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308             }                                                                                            </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 309         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 310             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 311         } finally {                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 312             try {                                                                                        </span>
<span class="-7143793951774237572" onmouseenter="enter('-7143793951774237572');" onmouseout="out('-7143793951774237572');" style=""> 313                 if (session != null) {                                                                   </span>
<span class="215842846359017500" onmouseenter="enter('215842846359017500');" onmouseout="out('215842846359017500');" style=""> 314                     session.close();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315                 }                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 316             } catch (Exception e) {                                                                      </span>
<span class="-6190899687770537846" onmouseenter="enter('-6190899687770537846');" onmouseout="out('-6190899687770537846');" style=""> 317                 LOG.error(&quot;Error while closing session.&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318             }                                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 319             try {                                                                                        </span>
<span class="7236775322084046720" onmouseenter="enter('7236775322084046720');" onmouseout="out('7236775322084046720');" style=""> 320                 if (cluster != null) {                                                                   </span>
<span class="-7802554339096083826" onmouseenter="enter('-7802554339096083826');" onmouseout="out('-7802554339096083826');" style=""> 321                     cluster.close();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322                 }                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 323             } catch (Exception e) {                                                                      </span>
<span class="-4991151540299943231" onmouseenter="enter('-4991151540299943231');" onmouseout="out('-4991151540299943231');" style=""> 324                 LOG.error(&quot;Error while closing cluster.&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="-167599954638689123" onmouseenter="enter('-167599954638689123');" onmouseout="out('-167599954638689123');" style="">  18 package com.dtstack.flink.sql.side.cassandra;                                                            </span>
<span  style="">  19                                                                                                          </span>
<span class="-1321606514279996521" onmouseenter="enter('-1321606514279996521');" onmouseout="out('-1321606514279996521');" style="">  20 import com.datastax.driver.core.*;                                                                       </span>
<span class="102554056665873953" onmouseenter="enter('102554056665873953');" onmouseout="out('102554056665873953');" style="">  21 import com.datastax.driver.core.policies.DowngradingConsistencyRetryPolicy;                              </span>
<span class="384780421342561763" onmouseenter="enter('384780421342561763');" onmouseout="out('384780421342561763');" style="">  22 import com.datastax.driver.core.policies.RetryPolicy;                                                    </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">  23 import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                 </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">  24 import com.dtstack.flink.sql.side.BaseAllReqRow;                                                         </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">  25 import com.dtstack.flink.sql.side.FieldInfo;                                                             </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">  26 import com.dtstack.flink.sql.side.JoinInfo;                                                              </span>
<span class="1325017007675469198" onmouseenter="enter('1325017007675469198');" onmouseout="out('1325017007675469198');" style="">  27 import com.dtstack.flink.sql.side.cassandra.table.CassandraSideTableInfo;                                </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="">  28 import com.dtstack.flink.sql.util.RowDataComplete;                                                       </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  29 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  30 import com.google.common.collect.Maps;                                                                   </span>
<span class="-5790770097715703577" onmouseenter="enter('-5790770097715703577');" onmouseout="out('-5790770097715703577');" style="">  31 import java.net.InetAddress;                                                                             </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  32 import java.sql.SQLException;                                                                            </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  33 import java.util.ArrayList;                                                                              </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  34 import java.util.Calendar;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  35 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  36 import java.util.Map;                                                                                    </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  37 import java.util.concurrent.atomic.AtomicReference;                                                      </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  38 import org.apache.calcite.sql.JoinType;                                                                  </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  39 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  40 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  41 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  42 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  43 import org.apache.flink.types.Row;                                                                       </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  44 import org.apache.flink.util.Collector;                                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  45 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  46 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  47                                                                                                          </span>
<span  style="">  48                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  49 /**                                                                                                      </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  50  * Reason:                                                                                               </span>
<span class="-6869475929847104911" onmouseenter="enter('-6869475929847104911');" onmouseout="out('-6869475929847104911');" style="">  51  * Date: 2018/11/22                                                                                      </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  52  *                                                                                                       </span>
<span class="-3762428130562648" onmouseenter="enter('-3762428130562648');" onmouseout="out('-3762428130562648');" style="">  53  * @author xuqianjin                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  54  */                                                                                                      </span>
<span class="-6675566310149196216" onmouseenter="enter('-6675566310149196216');" onmouseout="out('-6675566310149196216');" style="">  55 public class CassandraAllReqRow extends BaseAllReqRow {                                                  </span>
<span class="4439649471140456736" onmouseenter="enter('4439649471140456736');" onmouseout="out('4439649471140456736');" style="">  56     private static final long serialVersionUID = 54015343561288219L;                                     </span>
<span  style="">  57                                                                                                          </span>
<span class="-1268576216050451679" onmouseenter="enter('-1268576216050451679');" onmouseout="out('-1268576216050451679');" style="">  58     private static final Logger LOG = LoggerFactory.getLogger(CassandraAllReqRow.class);                 </span>
<span  style="">  59                                                                                                          </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  60     private static final int CONN_RETRY_NUM = 3;                                                         </span>
<span  style="">  61                                                                                                          </span>
<span class="-6477960095702488783" onmouseenter="enter('-6477960095702488783');" onmouseout="out('-6477960095702488783');" style="">  62     private static final int FETCH_SIZE = 1000;                                                          </span>
<span  style="">  63                                                                                                          </span>
<span class="-5403177446568963001" onmouseenter="enter('-5403177446568963001');" onmouseout="out('-5403177446568963001');" style="">  64     private transient Cluster cluster;                                                                   </span>
<span  style="">  65                                                                                                          </span>
<span class="4255085420266776167" onmouseenter="enter('4255085420266776167');" onmouseout="out('4255085420266776167');" style="">  66     private transient Session session = null;                                                            </span>
<span  style="">  67                                                                                                          </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  68     private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();  </span>
<span  style="">  69                                                                                                          </span>
<span class="2177500233543861344" onmouseenter="enter('2177500233543861344');" onmouseout="out('2177500233543861344');" style=""><abbr title="  70     public CassandraAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  70     public CassandraAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoLis🔵</abbr></span>
<span class="-8591720547957647884" onmouseenter="enter('-8591720547957647884');" onmouseout="out('-8591720547957647884');" style="">  71         super(new CassandraAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72     }                                                                                                    </span>
<span  style="">  73                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  74     @Override                                                                                            </span>
<span class="-5452513235343270061" onmouseenter="enter('-5452513235343270061');" onmouseout="out('-5452513235343270061');" style="">  75     protected void initCache() throws SQLException {                                                     </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style="">  76         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style="">  77         cacheRef.set(newCache);                                                                          </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style="">  78         loadData(newCache);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79     }                                                                                                    </span>
<span  style="">  80                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  81     @Override                                                                                            </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style="">  82     protected void reloadCache() {                                                                       </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style="">  83         //reload cacheRef and replace to old cacheRef                                                    </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style="">  84         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  85         try {                                                                                            </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style="">  86             loadData(newCache);                                                                          </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style="">  87         } catch (SQLException e) {                                                                       </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style="">  88             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89         }                                                                                                </span>
<span  style="">  90                                                                                                          </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style="">  91         cacheRef.set(newCache);                                                                          </span>
<span class="6972180338294555519" onmouseenter="enter('6972180338294555519');" onmouseout="out('6972180338294555519');" style="">  92         LOG.info(&quot;----- cassandra all cacheRef reload end:{}&quot;, Calendar.getInstance());                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93     }                                                                                                    </span>
<span  style="">  94                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  95     @Override                                                                                            </span>
<span class="6843933761729718422" onmouseenter="enter('6843933761729718422');" onmouseout="out('6843933761729718422');" style="">  96     public void flatMap(Row input, Collector&lt;BaseRow&gt; out) throws Exception {                            </span>
<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style="">  97         List&lt;Object&gt; inputParams = Lists.newArrayList();                                                 </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style="">  98         for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                        </span>
<span class="7582033886787525124" onmouseenter="enter('7582033886787525124');" onmouseout="out('7582033886787525124');" style="">  99             Object equalObj = input.getField(conValIndex);                                               </span>
<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style=""> 100             if (equalObj == null) {                                                                      </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style=""> 101                 if (sideInfo.getJoinType() == JoinType.LEFT) {                                           </span>
<span class="-3752240759126097062" onmouseenter="enter('-3752240759126097062');" onmouseout="out('-3752240759126097062');" style=""> 102                     Row row = fillData(input, null);                                                     </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 103                     RowDataComplete.collectRow(out, row);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104                 }                                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 105                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 106             }                                                                                            </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style=""> 107             inputParams.add(equalObj);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108         }                                                                                                </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style=""> 109         String key = buildKey(inputParams);                                                              </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style=""> 110         List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                   </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style=""> 111         if (CollectionUtils.isEmpty(cacheList)) {                                                        </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style=""> 112             if (sideInfo.getJoinType() == JoinType.LEFT) {                                               </span>
<span class="-3752240759126097062" onmouseenter="enter('-3752240759126097062');" onmouseout="out('-3752240759126097062');" style=""> 113                 Row row = fillData(input, null);                                                         </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 114                 RowDataComplete.collectRow(out, row);                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 115             } else {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 116                 return;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117             }                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 118             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119         }                                                                                                </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style=""> 120         for (Map&lt;String, Object&gt; one : cacheList) {                                                      </span>
<span class="-6006003971782103198" onmouseenter="enter('-6006003971782103198');" onmouseout="out('-6006003971782103198');" style=""> 121             Row row = fillData(input, one);                                                              </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 122             RowDataComplete.collectRow(out, row);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124     }                                                                                                    </span>
<span  style=""> 125                                                                                                          </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 126     private String buildKey(List&lt;Object&gt; equalValList) {                                                 </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 127         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 128         for (Object equalVal : equalValList) {                                                           </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 129             sb.append(equalVal).append(&quot;_&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130         }                                                                                                </span>
<span  style=""> 131                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 132         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 133     }                                                                                                    </span>
<span  style=""> 134                                                                                                          </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 135     private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                      </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 136         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 137         for (String equalField : equalFieldList) {                                                       </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 138             sb.append(val.get(equalField)).append(&quot;_&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139         }                                                                                                </span>
<span  style=""> 140                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 141         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142     }                                                                                                    </span>
<span  style=""> 143                                                                                                          </span>
<span class="4019233468954892213" onmouseenter="enter('4019233468954892213');" onmouseout="out('4019233468954892213');" style=""> 144     private Session getConn(CassandraSideTableInfo tableInfo) {                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 145         try {                                                                                            </span>
<span class="417819926325380348" onmouseenter="enter('417819926325380348');" onmouseout="out('417819926325380348');" style=""> 146             if (session == null) {                                                                       </span>
<span class="-3605639280329188999" onmouseenter="enter('-3605639280329188999');" onmouseout="out('-3605639280329188999');" style=""> 147                 QueryOptions queryOptions = new QueryOptions();                                          </span>
<span class="5842973418300621663" onmouseenter="enter('5842973418300621663');" onmouseout="out('5842973418300621663');" style=""> 148                 //The default consistency level for queries: ConsistencyLevel.TWO.                       </span>
<span class="76010926262385906" onmouseenter="enter('76010926262385906');" onmouseout="out('76010926262385906');" style=""> 149                 queryOptions.setConsistencyLevel(ConsistencyLevel.QUORUM);                               </span>
<span class="-4782430379426707011" onmouseenter="enter('-4782430379426707011');" onmouseout="out('-4782430379426707011');" style=""><abbr title=" 150                 Integer maxRequestsPerConnection = (tableInfo.getMaxRequestsPerConnection() == null) ? 1 : tableInfo.getMaxRequestsPerConnection();"> 150                 Integer maxRequestsPerConnection = (tableInfo.getMaxRequestsPerConnection() == null) ? 1 🔵</abbr></span>
<span class="-2959983233728834429" onmouseenter="enter('-2959983233728834429');" onmouseout="out('-2959983233728834429');" style=""><abbr title=" 151                 Integer coreConnectionsPerHost = (tableInfo.getCoreConnectionsPerHost() == null) ? 8 : tableInfo.getCoreConnectionsPerHost();"> 151                 Integer coreConnectionsPerHost = (tableInfo.getCoreConnectionsPerHost() == null) ? 8 : ta🔵</abbr></span>
<span class="8832744314563358603" onmouseenter="enter('8832744314563358603');" onmouseout="out('8832744314563358603');" style=""><abbr title=" 152                 Integer maxConnectionsPerHost = (tableInfo.getMaxConnectionsPerHost() == null) ? 32768 : tableInfo.getMaxConnectionsPerHost();"> 152                 Integer maxConnectionsPerHost = (tableInfo.getMaxConnectionsPerHost() == null) ? 32768 : 🔵</abbr></span>
<span class="3961503531158931197" onmouseenter="enter('3961503531158931197');" onmouseout="out('3961503531158931197');" style=""><abbr title=" 153                 Integer maxQueueSize = (tableInfo.getMaxQueueSize() == null) ? 100000 : tableInfo.getMaxQueueSize();"> 153                 Integer maxQueueSize = (tableInfo.getMaxQueueSize() == null) ? 100000 : tableInfo.getMaxQ🔵</abbr></span>
<span class="-6994348591486560076" onmouseenter="enter('-6994348591486560076');" onmouseout="out('-6994348591486560076');" style=""><abbr title=" 154                 Integer readTimeoutMillis = (tableInfo.getReadTimeoutMillis() == null) ? 60000 : tableInfo.getReadTimeoutMillis();"> 154                 Integer readTimeoutMillis = (tableInfo.getReadTimeoutMillis() == null) ? 60000 : tableInf🔵</abbr></span>
<span class="-3816562610310084202" onmouseenter="enter('-3816562610310084202');" onmouseout="out('-3816562610310084202');" style=""><abbr title=" 155                 Integer connectTimeoutMillis = (tableInfo.getConnectTimeoutMillis() == null) ? 60000 : tableInfo.getConnectTimeoutMillis();"> 155                 Integer connectTimeoutMillis = (tableInfo.getConnectTimeoutMillis() == null) ? 60000 : ta🔵</abbr></span>
<span class="-596580868946876650" onmouseenter="enter('-596580868946876650');" onmouseout="out('-596580868946876650');" style=""><abbr title=" 156                 Integer poolTimeoutMillis = (tableInfo.getPoolTimeoutMillis() == null) ? 60000 : tableInfo.getPoolTimeoutMillis();"> 156                 Integer poolTimeoutMillis = (tableInfo.getPoolTimeoutMillis() == null) ? 60000 : tableInf🔵</abbr></span>
<span class="-5259680847618191912" onmouseenter="enter('-5259680847618191912');" onmouseout="out('-5259680847618191912');" style=""> 157                 Integer cassandraPort = 0;                                                               </span>
<span class="-8848193911625825371" onmouseenter="enter('-8848193911625825371');" onmouseout="out('-8848193911625825371');" style=""> 158                 String address = tableInfo.getAddress();                                                 </span>
<span class="2950506038619853549" onmouseenter="enter('2950506038619853549');" onmouseout="out('2950506038619853549');" style=""> 159                 String userName = tableInfo.getUserName();                                               </span>
<span class="-4521409941966564293" onmouseenter="enter('-4521409941966564293');" onmouseout="out('-4521409941966564293');" style=""> 160                 String password = tableInfo.getPassword();                                               </span>
<span class="-6108815609943098672" onmouseenter="enter('-6108815609943098672');" onmouseout="out('-6108815609943098672');" style=""> 161                 String database = tableInfo.getDatabase();                                               </span>
<span class="6493913905304408918" onmouseenter="enter('6493913905304408918');" onmouseout="out('6493913905304408918');" style=""> 162                 ArrayList serversList = new ArrayList();                                                 </span>
<span class="5423738273364037419" onmouseenter="enter('5423738273364037419');" onmouseout="out('5423738273364037419');" style=""> 163                 //Read timeout or connection timeout Settings                                            </span>
<span class="6310702936913058326" onmouseenter="enter('6310702936913058326');" onmouseout="out('6310702936913058326');" style=""><abbr title=" 164                 SocketOptions so = new SocketOptions().setReadTimeoutMillis(readTimeoutMillis).setConnectTimeoutMillis(connectTimeoutMillis);"> 164                 SocketOptions so = new SocketOptions().setReadTimeoutMillis(readTimeoutMillis).setConnect🔵</abbr></span>
<span class="36776837264098679" onmouseenter="enter('36776837264098679');" onmouseout="out('36776837264098679');" style=""> 165                 //The cluster USES hostdistance.local in the same machine room                           </span>
<span class="-4067753854505755618" onmouseenter="enter('-4067753854505755618');" onmouseout="out('-4067753854505755618');" style=""> 166                 //Hostdistance. REMOTE is used for different machine rooms                               </span>
<span class="-1239540897477970915" onmouseenter="enter('-1239540897477970915');" onmouseout="out('-1239540897477970915');" style=""> 167                 //Ignore use HostDistance. IGNORED                                                       </span>
<span class="8986923449121229528" onmouseenter="enter('8986923449121229528');" onmouseout="out('8986923449121229528');" style=""><abbr title=" 168                 PoolingOptions poolingOptions = //There are up to eight connections to each machine in the cluster"> 168                 PoolingOptions poolingOptions = //There are up to eight connections to each machine in th🔵</abbr></span>
<span class="-8245292782127165862" onmouseenter="enter('-8245292782127165862');" onmouseout="out('-8245292782127165862');" style=""> 169                         //Have at least two connections to each machine in the cluster                   </span>
<span class="4173548347137079648" onmouseenter="enter('4173548347137079648');" onmouseout="out('4173548347137079648');" style=""> 170                         //Each connection allows a maximum of 64 concurrent requests                     </span>
<span class="-7470761056979998062" onmouseenter="enter('-7470761056979998062');" onmouseout="out('-7470761056979998062');" style=""><abbr title=" 171                 new PoolingOptions().setMaxRequestsPerConnection(HostDistance.LOCAL, maxRequestsPerConnection).setCoreConnectionsPerHost(HostDistance.LOCAL, coreConnectionsPerHost).setMaxConnectionsPerHost(HostDistance.LOCAL, maxConnectionsPerHost).setMaxQueueSize(maxQueueSize).setPoolTimeoutMillis(poolTimeoutMillis);"> 171                 new PoolingOptions().setMaxRequestsPerConnection(HostDistance.LOCAL, maxRequestsPerConnec🔵</abbr></span>
<span class="7009140327554883147" onmouseenter="enter('7009140327554883147');" onmouseout="out('7009140327554883147');" style=""> 172                 // 重试策略                                                                                  </span>
<span class="-2500245183701794239" onmouseenter="enter('-2500245183701794239');" onmouseout="out('-2500245183701794239');" style=""> 173                 RetryPolicy retryPolicy = DowngradingConsistencyRetryPolicy.INSTANCE;                    </span>
<span class="6634426984636856768" onmouseenter="enter('6634426984636856768');" onmouseout="out('6634426984636856768');" style=""> 174                 for (String server : StringUtils.split(address, &quot;,&quot;)) {                                  </span>
<span class="-4294448682063399613" onmouseenter="enter('-4294448682063399613');" onmouseout="out('-4294448682063399613');" style=""> 175                     cassandraPort = Integer.parseInt(StringUtils.split(server, &quot;:&quot;)[1]);                 </span>
<span class="7751295421103553875" onmouseenter="enter('7751295421103553875');" onmouseout="out('7751295421103553875');" style=""> 176                     serversList.add(InetAddress.getByName(StringUtils.split(server, &quot;:&quot;)[0]));           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177                 }                                                                                        </span>
<span class="991380888600756778" onmouseenter="enter('991380888600756778');" onmouseout="out('991380888600756778');" style=""><abbr title=" 178                 if ((((userName == null) || userName.isEmpty()) || (password == null)) || password.isEmpty()) {"> 178                 if ((((userName == null) || userName.isEmpty()) || (password == null)) || password.isEmpt🔵</abbr></span>
<span class="3802514815758396017" onmouseenter="enter('3802514815758396017');" onmouseout="out('3802514815758396017');" style=""><abbr title=" 179                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy).withPort(cassandraPort).withPoolingOptions(poolingOptions).withSocketOptions(so).withQueryOptions(queryOptions).build();"> 179                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy🔵</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 180                 } else {                                                                                 </span>
<span class="8825572864862900210" onmouseenter="enter('8825572864862900210');" onmouseout="out('8825572864862900210');" style=""><abbr title=" 181                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy).withPort(cassandraPort).withPoolingOptions(poolingOptions).withSocketOptions(so).withCredentials(userName, password).withQueryOptions(queryOptions).build();"> 181                     cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182                 }                                                                                        </span>
<span class="765464969334355038" onmouseenter="enter('765464969334355038');" onmouseout="out('765464969334355038');" style=""> 183                 // 建立连接 连接已存在的键空间                                                                        </span>
<span class="2858714417352384930" onmouseenter="enter('2858714417352384930');" onmouseout="out('2858714417352384930');" style=""> 184                 session = cluster.connect(database);                                                     </span>
<span class="8518739044679915590" onmouseenter="enter('8518739044679915590');" onmouseout="out('8518739044679915590');" style=""> 185                 LOG.info(&quot;connect cassandra is successed!&quot;);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186             }                                                                                            </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 187         } catch (java.lang.Exception e) {                                                                </span>
<span class="7191685386448857101" onmouseenter="enter('7191685386448857101');" onmouseout="out('7191685386448857101');" style=""> 188             LOG.error(&quot;connect cassandra is error:&quot; + e.getMessage());                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189         }                                                                                                </span>
<span class="7720471630782662993" onmouseenter="enter('7720471630782662993');" onmouseout="out('7720471630782662993');" style=""> 190         return session;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191     }                                                                                                    </span>
<span  style=""> 192                                                                                                          </span>
<span class="-6280115829611879826" onmouseenter="enter('-6280115829611879826');" onmouseout="out('-6280115829611879826');" style=""> 193     private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) throws SQLException {         </span>
<span class="-7211684128666996876" onmouseenter="enter('-7211684128666996876');" onmouseout="out('-7211684128666996876');" style=""> 194         CassandraSideTableInfo tableInfo = ((CassandraSideTableInfo) (sideInfo.getSideTableInfo()));     </span>
<span class="-3023606661382789819" onmouseenter="enter('-3023606661382789819');" onmouseout="out('-3023606661382789819');" style=""> 195         Session session = null;                                                                          </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 196         try {                                                                                            </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 197             for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 198                 try {                                                                                    </span>
<span class="-2308523158950278142" onmouseenter="enter('-2308523158950278142');" onmouseout="out('-2308523158950278142');" style=""> 199                     session = getConn(tableInfo);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 200                     break;                                                                               </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 201                 } catch (java.lang.Exception e) {                                                        </span>
<span class="6340170720019550349" onmouseenter="enter('6340170720019550349');" onmouseout="out('6340170720019550349');" style=""> 202                     if (i == (CONN_RETRY_NUM - 1)) {                                                     </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 203                         throw new RuntimeException(&quot;&quot;, e);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204                     }                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 205                     try {                                                                                </span>
<span class="6375450130648097458" onmouseenter="enter('6375450130648097458');" onmouseout="out('6375450130648097458');" style=""><abbr title=" 206                         String connInfo = ((((&quot;address:&quot; + tableInfo.getAddress()) + &quot;;userName:&quot;) + tableInfo.getUserName()) + &quot;,pwd:&quot;) + tableInfo.getPassword();"> 206                         String connInfo = ((((&quot;address:&quot; + tableInfo.getAddress()) + &quot;;userName:&quot;) + tabl🔵</abbr></span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 207                         LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);   </span>
<span class="-399370949889032298" onmouseenter="enter('-399370949889032298');" onmouseout="out('-399370949889032298');" style=""> 208                         Thread.sleep(LOAD_DATA_ERROR_SLEEP_TIME);                                        </span>
<span class="-6314961762158118538" onmouseenter="enter('-6314961762158118538');" onmouseout="out('-6314961762158118538');" style=""> 209                     } catch (java.lang.InterruptedException e1) {                                        </span>
<span class="8814860350844370078" onmouseenter="enter('8814860350844370078');" onmouseout="out('8814860350844370078');" style=""> 210                         LOG.error(&quot;&quot;, e1);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213             }                                                                                            </span>
<span class="-8423206762211538953" onmouseenter="enter('-8423206762211538953');" onmouseout="out('-8423206762211538953');" style=""> 214             // load data from table                                                                      </span>
<span class="-3312868900424639525" onmouseenter="enter('-3312868900424639525');" onmouseout="out('-3312868900424639525');" style=""> 215             String sql = (sideInfo.getSqlCondition() + &quot; limit &quot;) + FETCH_SIZE;                          </span>
<span class="7174096590211324737" onmouseenter="enter('7174096590211324737');" onmouseout="out('7174096590211324737');" style=""> 216             ResultSet resultSet = session.execute(sql);                                                  </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 217             String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);            </span>
<span class="1578439519882926566" onmouseenter="enter('1578439519882926566');" onmouseout="out('1578439519882926566');" style=""> 218             for (Row row : resultSet) {                                                                  </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 219                 Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                          </span>
<span class="-587926084208094606" onmouseenter="enter('-587926084208094606');" onmouseout="out('-587926084208094606');" style=""> 220                 for (String fieldName : sideFieldNames) {                                                </span>
<span class="-7507266122996926506" onmouseenter="enter('-7507266122996926506');" onmouseout="out('-7507266122996926506');" style=""> 221                     oneRow.put(fieldName.trim(), row.getObject(fieldName.trim()));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222                 }                                                                                        </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 223                 String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                        </span>
<span class="-2152826637090813313" onmouseenter="enter('-2152826637090813313');" onmouseout="out('-2152826637090813313');" style=""><abbr title=" 224                 List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, ( key) -&gt; Lists.newArrayList());"> 224                 List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, ( key) -&gt; Lists.newAr🔵</abbr></span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 225                 list.add(oneRow);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 226             }                                                                                            </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 227         } catch (java.lang.Exception e) {                                                                </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 228             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 229         } finally {                                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 230             try {                                                                                        </span>
<span class="-7143793951774237572" onmouseenter="enter('-7143793951774237572');" onmouseout="out('-7143793951774237572');" style=""> 231                 if (session != null) {                                                                   </span>
<span class="215842846359017500" onmouseenter="enter('215842846359017500');" onmouseout="out('215842846359017500');" style=""> 232                     session.close();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233                 }                                                                                        </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 234             } catch (java.lang.Exception e) {                                                            </span>
<span class="-6190899687770537846" onmouseenter="enter('-6190899687770537846');" onmouseout="out('-6190899687770537846');" style=""> 235                 LOG.error(&quot;Error while closing session.&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 236             }                                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 237             try {                                                                                        </span>
<span class="7236775322084046720" onmouseenter="enter('7236775322084046720');" onmouseout="out('7236775322084046720');" style=""> 238                 if (cluster != null) {                                                                   </span>
<span class="-7802554339096083826" onmouseenter="enter('-7802554339096083826');" onmouseout="out('-7802554339096083826');" style=""> 239                     cluster.close();                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240                 }                                                                                        </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style=""> 241             } catch (java.lang.Exception e) {                                                            </span>
<span class="-4991151540299943231" onmouseenter="enter('-4991151540299943231');" onmouseout="out('-4991151540299943231');" style=""> 242                 LOG.error(&quot;Error while closing cluster.&quot;, e);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246 }                                                                                                        </span>
















































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span class="-167599954638689123" onmouseenter="enter('-167599954638689123');" onmouseout="out('-167599954638689123');" style="">  19  package com.dtstack.flink.sql.side.cassandra;                                                                     </span>
<span  style="">  20                                                                                                                    </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  21 -import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="3883198981410010526" onmouseenter="enter('3883198981410010526');" onmouseout="out('3883198981410010526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -import org.apache.flink.table.runtime.types.CRow;                                                                 </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import org.apache.flink.types.Row;                                                                                </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import org.apache.flink.util.Collector;                                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -                                                                                                                  </span>
<span class="-4674624431842718354" onmouseenter="enter('-4674624431842718354');" onmouseout="out('-4674624431842718354');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  27 -import com.datastax.driver.core.Cluster;                                                                          </span>
<span class="4630389600773953361" onmouseenter="enter('4630389600773953361');" onmouseout="out('4630389600773953361');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  28 -import com.datastax.driver.core.ConsistencyLevel;                                                                 </span>
<span class="-5077913371267042181" onmouseenter="enter('-5077913371267042181');" onmouseout="out('-5077913371267042181');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import com.datastax.driver.core.HostDistance;                                                                     </span>
<span class="-8460078615292194921" onmouseenter="enter('-8460078615292194921');" onmouseout="out('-8460078615292194921');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  30 -import com.datastax.driver.core.PoolingOptions;                                                                   </span>
<span class="3500480560938999402" onmouseenter="enter('3500480560938999402');" onmouseout="out('3500480560938999402');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  31 -import com.datastax.driver.core.QueryOptions;                                                                     </span>
<span class="1295458347604392536" onmouseenter="enter('1295458347604392536');" onmouseout="out('1295458347604392536');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -import com.datastax.driver.core.ResultSet;                                                                        </span>
<span class="-2921924295373051715" onmouseenter="enter('-2921924295373051715');" onmouseout="out('-2921924295373051715');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -import com.datastax.driver.core.Session;                                                                          </span>
<span class="7536185860942072783" onmouseenter="enter('7536185860942072783');" onmouseout="out('7536185860942072783');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 -import com.datastax.driver.core.SocketOptions;                                                                    </span>
<span class="-1321606514279996521" onmouseenter="enter('-1321606514279996521');" onmouseout="out('-1321606514279996521');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  35 +import com.datastax.driver.core.*;                                                                                </span>
<span class="102554056665873953" onmouseenter="enter('102554056665873953');" onmouseout="out('102554056665873953');" style="">  36  import com.datastax.driver.core.policies.DowngradingConsistencyRetryPolicy;                                       </span>
<span class="384780421342561763" onmouseenter="enter('384780421342561763');" onmouseout="out('384780421342561763');" style="">  37  import com.datastax.driver.core.policies.RetryPolicy;                                                             </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  38 +import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                          </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">  39  import com.dtstack.flink.sql.side.BaseAllReqRow;                                                                  </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">  40  import com.dtstack.flink.sql.side.FieldInfo;                                                                      </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">  41  import com.dtstack.flink.sql.side.JoinInfo;                                                                       </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  42 -import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                          </span>
<span class="1325017007675469198" onmouseenter="enter('1325017007675469198');" onmouseout="out('1325017007675469198');" style="">  43  import com.dtstack.flink.sql.side.cassandra.table.CassandraSideTableInfo;                                         </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  44 +import com.dtstack.flink.sql.util.RowDataComplete;                                                                </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  45  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  46  import com.google.common.collect.Maps;                                                                            </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  47  import org.apache.calcite.sql.JoinType;                                                                           </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  48  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  49  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  50 +import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  51 +import org.apache.flink.table.dataformat.BaseRow;                                                                 </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  52 +import org.apache.flink.types.Row;                                                                                </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  53 +import org.apache.flink.util.Collector;                                                                           </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  54  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  55  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  56                                                                                                                    </span>
<span class="-5790770097715703577" onmouseenter="enter('-5790770097715703577');" onmouseout="out('-5790770097715703577');" style="">  57  import java.net.InetAddress;                                                                                      </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  58  import java.sql.SQLException;                                                                                     </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -import java.sql.Timestamp;                                                                                        </span>
<span class="196713859697444637" onmouseenter="enter('196713859697444637');" onmouseout="out('196713859697444637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  60 -import java.util.*;                                                                                               </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  61 +import java.util.ArrayList;                                                                                       </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  62 +import java.util.Calendar;                                                                                        </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +import java.util.Map;                                                                                             </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  65  import java.util.concurrent.atomic.AtomicReference;                                                               </span>
<span  style="">  66                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  67  /**                                                                                                               </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  68   * Reason:                                                                                                        </span>
<span class="-6869475929847104911" onmouseenter="enter('-6869475929847104911');" onmouseout="out('-6869475929847104911');" style="">  69   * Date: 2018/11/22                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  70   *                                                                                                                </span>
<span class="-3762428130562648" onmouseenter="enter('-3762428130562648');" onmouseout="out('-3762428130562648');" style="">  71   * @author xuqianjin                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  72   */                                                                                                               </span>
<span class="-6675566310149196216" onmouseenter="enter('-6675566310149196216');" onmouseout="out('-6675566310149196216');" style="">  73  public class CassandraAllReqRow extends BaseAllReqRow {                                                           </span>
<span  style="">  74                                                                                                                    </span>
<span class="4439649471140456736" onmouseenter="enter('4439649471140456736');" onmouseout="out('4439649471140456736');" style="">  75      private static final long serialVersionUID = 54015343561288219L;                                              </span>
<span  style="">  76                                                                                                                    </span>
<span class="-1268576216050451679" onmouseenter="enter('-1268576216050451679');" onmouseout="out('-1268576216050451679');" style="">  77      private static final Logger LOG = LoggerFactory.getLogger(CassandraAllReqRow.class);                          </span>
<span  style="">  78                                                                                                                    </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  79      private static final int CONN_RETRY_NUM = 3;                                                                  </span>
<span  style="">  80                                                                                                                    </span>
<span class="-6477960095702488783" onmouseenter="enter('-6477960095702488783');" onmouseout="out('-6477960095702488783');" style="">  81      private static final int FETCH_SIZE = 1000;                                                                   </span>
<span  style="">  82                                                                                                                    </span>
<span class="-5403177446568963001" onmouseenter="enter('-5403177446568963001');" onmouseout="out('-5403177446568963001');" style="">  83      private transient Cluster cluster;                                                                            </span>
<span class="4255085420266776167" onmouseenter="enter('4255085420266776167');" onmouseout="out('4255085420266776167');" style="">  84      private transient Session session = null;                                                                     </span>
<span  style="">  85                                                                                                                    </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  86      private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();           </span>
<span  style="">  87                                                                                                                    </span>
<span class="2177500233543861344" onmouseenter="enter('2177500233543861344');" onmouseout="out('2177500233543861344');" style=""><abbr title="  88      public CassandraAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  88      public CassandraAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, Abstra🔵</abbr></span>
<span class="-3254922457036187140" onmouseenter="enter('-3254922457036187140');" onmouseout="out('-3254922457036187140');" style=""><abbr title="  89          super(new com.dtstack.flink.sql.side.cassandra.CassandraAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));">  89          super(new com.dtstack.flink.sql.side.cassandra.CassandraAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoLis🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90      }                                                                                                             </span>
<span  style="">  91                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  92      @Override                                                                                                     </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="">  93      public Row fillData(Row input, Object sideInput) {                                                            </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="">  94          Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                          </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="">  95          Row row = new Row(sideInfo.getOutFieldInfoList().size());                                                 </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="">  96          for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                         </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="">  97              Object obj = input.getField(entry.getValue());                                                        </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  98 -            boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());">  98 -            boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo🔵</abbr></span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -                                                                                                                  </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title=" 100 -            //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long."> 100 -            //Type information for indicating event or processing time. However, it behaves like a regular SQL tim🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -            if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                            </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -                //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                                     </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -                obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -            }                                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 105 -                                                                                                                  </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +            obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                             </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style=""> 107              row.setField(entry.getKey(), obj);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108          }                                                                                                         </span>
<span  style=""> 109                                                                                                                    </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style=""> 110          for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {                    </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style=""> 111              if (cacheInfo == null) {                                                                              </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 112                  row.setField(entry.getKey(), null);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 113              } else {                                                                                              </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style=""> 114                  row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116          }                                                                                                         </span>
<span  style=""> 117                                                                                                                    </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 118          return row;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119      }                                                                                                             </span>
<span  style=""> 120                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 121      @Override                                                                                                     </span>
<span class="-5452513235343270061" onmouseenter="enter('-5452513235343270061');" onmouseout="out('-5452513235343270061');" style=""> 122      protected void initCache() throws SQLException {                                                              </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 123          Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                                </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 124          cacheRef.set(newCache);                                                                                   </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 125          loadData(newCache);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126      }                                                                                                             </span>
<span  style=""> 127                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 128      @Override                                                                                                     </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 129      protected void reloadCache() {                                                                                </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 130          //reload cacheRef and replace to old cacheRef                                                             </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 131          Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 132          try {                                                                                                     </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 133              loadData(newCache);                                                                                   </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style=""> 134          } catch (SQLException e) {                                                                                </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 135              LOG.error(&quot;&quot;, e);                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136          }                                                                                                         </span>
<span  style=""> 137                                                                                                                    </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 138          cacheRef.set(newCache);                                                                                   </span>
<span class="6972180338294555519" onmouseenter="enter('6972180338294555519');" onmouseout="out('6972180338294555519');" style=""> 139          LOG.info(&quot;----- cassandra all cacheRef reload end:{}&quot;, Calendar.getInstance());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140      }                                                                                                             </span>
<span  style=""> 141                                                                                                                    </span>
<span  style=""> 142                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 143      @Override                                                                                                     </span>
<span class="2657010695143174651" onmouseenter="enter('2657010695143174651');" onmouseout="out('2657010695143174651');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 144 -    public void flatMap(CRow input, Collector&lt;CRow&gt; out) throws Exception {                                       </span>
<span class="6843933761729718422" onmouseenter="enter('6843933761729718422');" onmouseout="out('6843933761729718422');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +    public void flatMap(Row input, Collector&lt;BaseRow&gt; out) throws Exception {                                     </span>
<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style=""> 146          List&lt;Object&gt; inputParams = Lists.newArrayList();                                                          </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style=""> 147          for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                                 </span>
<span class="-1571322702847153161" onmouseenter="enter('-1571322702847153161');" onmouseout="out('-1571322702847153161');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -            Object equalObj = input.row().getField(conValIndex);                                                  </span>
<span class="7582033886787525124" onmouseenter="enter('7582033886787525124');" onmouseout="out('7582033886787525124');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +            Object equalObj = input.getField(conValIndex);                                                        </span>
<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style=""> 150              if (equalObj == null) {                                                                               </span>
<span class="-7689775219188827718" onmouseenter="enter('-7689775219188827718');" onmouseout="out('-7689775219188827718');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -                if(sideInfo.getJoinType() == JoinType.LEFT){                                                      </span>
<span class="-8021403155411844466" onmouseenter="enter('-8021403155411844466');" onmouseout="out('-8021403155411844466');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -                    Row data = fillData(input.row(), null);                                                       </span>
<span class="-6323758209057265112" onmouseenter="enter('-6323758209057265112');" onmouseout="out('-6323758209057265112');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -                    out.collect(new CRow(data, input.change()));                                                  </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +                if (sideInfo.getJoinType() == JoinType.LEFT) {                                                    </span>
<span class="-3752240759126097062" onmouseenter="enter('-3752240759126097062');" onmouseout="out('-3752240759126097062');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +                    Row row = fillData(input, null);                                                              </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +                    RowDataComplete.collectRow(out, row);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                  }                                                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 158                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159              }                                                                                                     </span>
<span  style=""> 160                                                                                                                    </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style=""> 161              inputParams.add(equalObj);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162          }                                                                                                         </span>
<span  style=""> 163                                                                                                                    </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style=""> 164          String key = buildKey(inputParams);                                                                       </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style=""> 165          List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                            </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style=""> 166          if (CollectionUtils.isEmpty(cacheList)) {                                                                 </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style=""> 167              if (sideInfo.getJoinType() == JoinType.LEFT) {                                                        </span>
<span class="5500326757636101813" onmouseenter="enter('5500326757636101813');" onmouseout="out('5500326757636101813');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 168 -                Row row = fillData(input.row(), null);                                                            </span>
<span class="-1652121101976271273" onmouseenter="enter('-1652121101976271273');" onmouseout="out('-1652121101976271273');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -                out.collect(new CRow(row, input.change()));                                                       </span>
<span class="-3752240759126097062" onmouseenter="enter('-3752240759126097062');" onmouseout="out('-3752240759126097062');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +                Row row = fillData(input, null);                                                                  </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +                RowDataComplete.collectRow(out, row);                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 172              } else {                                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 173                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174              }                                                                                                     </span>
<span  style=""> 175                                                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 176              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177          }                                                                                                         </span>
<span  style=""> 178                                                                                                                    </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style=""> 179          for (Map&lt;String, Object&gt; one : cacheList) {                                                               </span>
<span class="-1129401162237110043" onmouseenter="enter('-1129401162237110043');" onmouseout="out('-1129401162237110043');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 180 -            out.collect(new CRow(fillData(input.row(), one), input.change()));                                    </span>
<span class="-6006003971782103198" onmouseenter="enter('-6006003971782103198');" onmouseout="out('-6006003971782103198');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +            Row row = fillData(input, one);                                                                       </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +            RowDataComplete.collectRow(out, row);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183          }                                                                                                         </span>
<span  style=""> 184                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185      }                                                                                                             </span>
<span  style=""> 186                                                                                                                    </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 187      private String buildKey(List&lt;Object&gt; equalValList) {                                                          </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 188          StringBuilder sb = new StringBuilder(&quot;&quot;);                                                                 </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 189          for (Object equalVal : equalValList) {                                                                    </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 190              sb.append(equalVal).append(&quot;_&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191          }                                                                                                         </span>
<span  style=""> 192                                                                                                                    </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 193          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194      }                                                                                                             </span>
<span  style=""> 195                                                                                                                    </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 196      private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                               </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 197          StringBuilder sb = new StringBuilder(&quot;&quot;);                                                                 </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 198          for (String equalField : equalFieldList) {                                                                </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 199              sb.append(val.get(equalField)).append(&quot;_&quot;);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200          }                                                                                                         </span>
<span  style=""> 201                                                                                                                    </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 202          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203      }                                                                                                             </span>
<span  style=""> 204                                                                                                                    </span>
<span class="4019233468954892213" onmouseenter="enter('4019233468954892213');" onmouseout="out('4019233468954892213');" style=""> 205      private Session getConn(CassandraSideTableInfo tableInfo) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 206          try {                                                                                                     </span>
<span class="417819926325380348" onmouseenter="enter('417819926325380348');" onmouseout="out('417819926325380348');" style=""> 207              if (session == null) {                                                                                </span>
<span class="-3605639280329188999" onmouseenter="enter('-3605639280329188999');" onmouseout="out('-3605639280329188999');" style=""> 208                  QueryOptions queryOptions = new QueryOptions();                                                   </span>
<span class="5842973418300621663" onmouseenter="enter('5842973418300621663');" onmouseout="out('5842973418300621663');" style=""> 209                  //The default consistency level for queries: ConsistencyLevel.TWO.                                </span>
<span class="76010926262385906" onmouseenter="enter('76010926262385906');" onmouseout="out('76010926262385906');" style=""> 210                  queryOptions.setConsistencyLevel(ConsistencyLevel.QUORUM);                                        </span>
<span class="-4388406259332422062" onmouseenter="enter('-4388406259332422062');" onmouseout="out('-4388406259332422062');" style=""><abbr title=" 211                  Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : tableInfo.getMaxRequestsPerConnection();"> 211                  Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : tableInfo🔵</abbr></span>
<span class="-6698153752588261803" onmouseenter="enter('-6698153752588261803');" onmouseout="out('-6698153752588261803');" style=""><abbr title=" 212                  Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tableInfo.getCoreConnectionsPerHost();"> 212                  Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tableInfo.get🔵</abbr></span>
<span class="3809961524454958986" onmouseenter="enter('3809961524454958986');" onmouseout="out('3809961524454958986');" style=""><abbr title=" 213                  Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : tableInfo.getMaxConnectionsPerHost();"> 213                  Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : tableInfo.g🔵</abbr></span>
<span class="-3297929912963114654" onmouseenter="enter('-3297929912963114654');" onmouseout="out('-3297929912963114654');" style=""> 214                  Integer maxQueueSize = tableInfo.getMaxQueueSize() == null ? 100000 : tableInfo.getMaxQueueSize();</span>
<span class="-1822015680936096661" onmouseenter="enter('-1822015680936096661');" onmouseout="out('-1822015680936096661');" style=""><abbr title=" 215                  Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.getReadTimeoutMillis();"> 215                  Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.getReadTi🔵</abbr></span>
<span class="5588349030185896717" onmouseenter="enter('5588349030185896717');" onmouseout="out('5588349030185896717');" style=""><abbr title=" 216                  Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tableInfo.getConnectTimeoutMillis();"> 216                  Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tableInfo.get🔵</abbr></span>
<span class="5493190487826327243" onmouseenter="enter('5493190487826327243');" onmouseout="out('5493190487826327243');" style=""><abbr title=" 217                  Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.getPoolTimeoutMillis();"> 217                  Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.getPoolTi🔵</abbr></span>
<span class="-5259680847618191912" onmouseenter="enter('-5259680847618191912');" onmouseout="out('-5259680847618191912');" style=""> 218                  Integer cassandraPort = 0;                                                                        </span>
<span class="-8848193911625825371" onmouseenter="enter('-8848193911625825371');" onmouseout="out('-8848193911625825371');" style=""> 219                  String address = tableInfo.getAddress();                                                          </span>
<span class="2950506038619853549" onmouseenter="enter('2950506038619853549');" onmouseout="out('2950506038619853549');" style=""> 220                  String userName = tableInfo.getUserName();                                                        </span>
<span class="-4521409941966564293" onmouseenter="enter('-4521409941966564293');" onmouseout="out('-4521409941966564293');" style=""> 221                  String password = tableInfo.getPassword();                                                        </span>
<span class="-6108815609943098672" onmouseenter="enter('-6108815609943098672');" onmouseout="out('-6108815609943098672');" style=""> 222                  String database = tableInfo.getDatabase();                                                        </span>
<span  style=""> 223                                                                                                                    </span>
<span class="6493913905304408918" onmouseenter="enter('6493913905304408918');" onmouseout="out('6493913905304408918');" style=""> 224                  ArrayList serversList = new ArrayList();                                                          </span>
<span class="5423738273364037419" onmouseenter="enter('5423738273364037419');" onmouseout="out('5423738273364037419');" style=""> 225                  //Read timeout or connection timeout Settings                                                     </span>
<span class="-1651403584650918350" onmouseenter="enter('-1651403584650918350');" onmouseout="out('-1651403584650918350');" style=""> 226                  SocketOptions so = new SocketOptions()                                                            </span>
<span class="-6143815205992723671" onmouseenter="enter('-6143815205992723671');" onmouseout="out('-6143815205992723671');" style=""> 227                          .setReadTimeoutMillis(readTimeoutMillis)                                                  </span>
<span class="-7477024419561329894" onmouseenter="enter('-7477024419561329894');" onmouseout="out('-7477024419561329894');" style=""> 228                          .setConnectTimeoutMillis(connectTimeoutMillis);                                           </span>
<span  style=""> 229                                                                                                                    </span>
<span class="36776837264098679" onmouseenter="enter('36776837264098679');" onmouseout="out('36776837264098679');" style=""> 230                  //The cluster USES hostdistance.local in the same machine room                                    </span>
<span class="-4067753854505755618" onmouseenter="enter('-4067753854505755618');" onmouseout="out('-4067753854505755618');" style=""> 231                  //Hostdistance. REMOTE is used for different machine rooms                                        </span>
<span class="-1239540897477970915" onmouseenter="enter('-1239540897477970915');" onmouseout="out('-1239540897477970915');" style=""> 232                  //Ignore use HostDistance. IGNORED                                                                </span>
<span class="7507936330523201209" onmouseenter="enter('7507936330523201209');" onmouseout="out('7507936330523201209');" style=""> 233                  PoolingOptions poolingOptions = new PoolingOptions()                                              </span>
<span class="4173548347137079648" onmouseenter="enter('4173548347137079648');" onmouseout="out('4173548347137079648');" style=""> 234                          //Each connection allows a maximum of 64 concurrent requests                              </span>
<span class="6109267905237967219" onmouseenter="enter('6109267905237967219');" onmouseout="out('6109267905237967219');" style=""> 235                          .setMaxRequestsPerConnection(HostDistance.LOCAL, maxRequestsPerConnection)                </span>
<span class="-8245292782127165862" onmouseenter="enter('-8245292782127165862');" onmouseout="out('-8245292782127165862');" style=""> 236                          //Have at least two connections to each machine in the cluster                            </span>
<span class="7216166406224594146" onmouseenter="enter('7216166406224594146');" onmouseout="out('7216166406224594146');" style=""> 237                          .setCoreConnectionsPerHost(HostDistance.LOCAL, coreConnectionsPerHost)                    </span>
<span class="-1358272374234048070" onmouseenter="enter('-1358272374234048070');" onmouseout="out('-1358272374234048070');" style=""> 238                          //There are up to eight connections to each machine in the cluster                        </span>
<span class="-1698869078338541686" onmouseenter="enter('-1698869078338541686');" onmouseout="out('-1698869078338541686');" style=""> 239                          .setMaxConnectionsPerHost(HostDistance.LOCAL, maxConnectionsPerHost)                      </span>
<span class="1548703418514968406" onmouseenter="enter('1548703418514968406');" onmouseout="out('1548703418514968406');" style=""> 240                          .setMaxQueueSize(maxQueueSize)                                                            </span>
<span class="3524981482635418824" onmouseenter="enter('3524981482635418824');" onmouseout="out('3524981482635418824');" style=""> 241                          .setPoolTimeoutMillis(poolTimeoutMillis);                                                 </span>
<span class="-3027653360277295120" onmouseenter="enter('-3027653360277295120');" onmouseout="out('-3027653360277295120');" style=""> 242                  //重试策略                                                                                            </span>
<span class="-2500245183701794239" onmouseenter="enter('-2500245183701794239');" onmouseout="out('-2500245183701794239');" style=""> 243                  RetryPolicy retryPolicy = DowngradingConsistencyRetryPolicy.INSTANCE;                             </span>
<span  style=""> 244                                                                                                                    </span>
<span class="6634426984636856768" onmouseenter="enter('6634426984636856768');" onmouseout="out('6634426984636856768');" style=""> 245                  for (String server : StringUtils.split(address, &quot;,&quot;)) {                                           </span>
<span class="-4294448682063399613" onmouseenter="enter('-4294448682063399613');" onmouseout="out('-4294448682063399613');" style=""> 246                      cassandraPort = Integer.parseInt(StringUtils.split(server, &quot;:&quot;)[1]);                          </span>
<span class="7751295421103553875" onmouseenter="enter('7751295421103553875');" onmouseout="out('7751295421103553875');" style=""> 247                      serversList.add(InetAddress.getByName(StringUtils.split(server, &quot;:&quot;)[0]));                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 248                  }                                                                                                 </span>
<span  style=""> 249                                                                                                                    </span>
<span class="3673717518338030181" onmouseenter="enter('3673717518338030181');" onmouseout="out('3673717518338030181');" style=""> 250                  if (userName == null || userName.isEmpty() || password == null || password.isEmpty()) {           </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""> 251                      cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)        </span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 252                              .withPort(cassandraPort)                                                              </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 253                              .withPoolingOptions(poolingOptions).withSocketOptions(so)                             </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 254                              .withQueryOptions(queryOptions).build();                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 255                  } else {                                                                                          </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""> 256                      cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)        </span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 257                              .withPort(cassandraPort)                                                              </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 258                              .withPoolingOptions(poolingOptions).withSocketOptions(so)                             </span>
<span class="-5038512354126172278" onmouseenter="enter('-5038512354126172278');" onmouseout="out('-5038512354126172278');" style=""> 259                              .withCredentials(userName, password)                                                  </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 260                              .withQueryOptions(queryOptions).build();                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261                  }                                                                                                 </span>
<span class="765464969334355038" onmouseenter="enter('765464969334355038');" onmouseout="out('765464969334355038');" style=""> 262                  // 建立连接 连接已存在的键空间                                                                                 </span>
<span class="2858714417352384930" onmouseenter="enter('2858714417352384930');" onmouseout="out('2858714417352384930');" style=""> 263                  session = cluster.connect(database);                                                              </span>
<span class="8518739044679915590" onmouseenter="enter('8518739044679915590');" onmouseout="out('8518739044679915590');" style=""> 264                  LOG.info(&quot;connect cassandra is successed!&quot;);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 266          } catch (Exception e) {                                                                                   </span>
<span class="7191685386448857101" onmouseenter="enter('7191685386448857101');" onmouseout="out('7191685386448857101');" style=""> 267              LOG.error(&quot;connect cassandra is error:&quot; + e.getMessage());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268          }                                                                                                         </span>
<span class="7720471630782662993" onmouseenter="enter('7720471630782662993');" onmouseout="out('7720471630782662993');" style=""> 269          return session;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 270      }                                                                                                             </span>
<span  style=""> 271                                                                                                                    </span>
<span  style=""> 272                                                                                                                    </span>
<span class="-6280115829611879826" onmouseenter="enter('-6280115829611879826');" onmouseout="out('-6280115829611879826');" style=""> 273      private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) throws SQLException {                  </span>
<span class="-6391193908965303732" onmouseenter="enter('-6391193908965303732');" onmouseout="out('-6391193908965303732');" style=""> 274          CassandraSideTableInfo tableInfo = (CassandraSideTableInfo) sideInfo.getSideTableInfo();                  </span>
<span class="-3023606661382789819" onmouseenter="enter('-3023606661382789819');" onmouseout="out('-3023606661382789819');" style=""> 275          Session session = null;                                                                                   </span>
<span  style=""> 276                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 277          try {                                                                                                     </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 278              for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 279                  try {                                                                                             </span>
<span class="-2308523158950278142" onmouseenter="enter('-2308523158950278142');" onmouseout="out('-2308523158950278142');" style=""> 280                      session = getConn(tableInfo);                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 281                      break;                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 282                  } catch (Exception e) {                                                                           </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 283                      if (i == CONN_RETRY_NUM - 1) {                                                                </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 284                          throw new RuntimeException(&quot;&quot;, e);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285                      }                                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 286                      try {                                                                                         </span>
<span class="-351091341770177564" onmouseenter="enter('-351091341770177564');" onmouseout="out('-351091341770177564');" style=""><abbr title=" 287                          String connInfo = &quot;address:&quot; + tableInfo.getAddress() + &quot;;userName:&quot; + tableInfo.getUserName()"> 287                          String connInfo = &quot;address:&quot; + tableInfo.getAddress() + &quot;;userName:&quot; + tableInfo.getUserNa🔵</abbr></span>
<span class="9039417523603645611" onmouseenter="enter('9039417523603645611');" onmouseout="out('9039417523603645611');" style=""> 288                                  + &quot;,pwd:&quot; + tableInfo.getPassword();                                              </span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 289                          LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);            </span>
<span class="-399370949889032298" onmouseenter="enter('-399370949889032298');" onmouseout="out('-399370949889032298');" style=""> 290                          Thread.sleep(LOAD_DATA_ERROR_SLEEP_TIME);                                                 </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 291                      } catch (InterruptedException e1) {                                                           </span>
<span class="8814860350844370078" onmouseenter="enter('8814860350844370078');" onmouseout="out('8814860350844370078');" style=""> 292                          LOG.error(&quot;&quot;, e1);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 294                  }                                                                                                 </span>
<span  style=""> 295                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296              }                                                                                                     </span>
<span  style=""> 297                                                                                                                    </span>
<span class="475138084615438717" onmouseenter="enter('475138084615438717');" onmouseout="out('475138084615438717');" style=""> 298              //load data from table                                                                                </span>
<span class="-1104953430559584261" onmouseenter="enter('-1104953430559584261');" onmouseout="out('-1104953430559584261');" style=""> 299              String sql = sideInfo.getSqlCondition() + &quot; limit &quot; + FETCH_SIZE;                                     </span>
<span class="7174096590211324737" onmouseenter="enter('7174096590211324737');" onmouseout="out('7174096590211324737');" style=""> 300              ResultSet resultSet = session.execute(sql);                                                           </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 301              String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                     </span>
<span class="-8969977045023326611" onmouseenter="enter('-8969977045023326611');" onmouseout="out('-8969977045023326611');" style=""> 302              for (com.datastax.driver.core.Row row : resultSet) {                                                  </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 303                  Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                                   </span>
<span class="-587926084208094606" onmouseenter="enter('-587926084208094606');" onmouseout="out('-587926084208094606');" style=""> 304                  for (String fieldName : sideFieldNames) {                                                         </span>
<span class="-7507266122996926506" onmouseenter="enter('-7507266122996926506');" onmouseout="out('-7507266122996926506');" style=""> 305                      oneRow.put(fieldName.trim(), row.getObject(fieldName.trim()));                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306                  }                                                                                                 </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 307                  String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                                 </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""> 308                  List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList()); </span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 309                  list.add(oneRow);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 310              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 311          } catch (Exception e) {                                                                                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 312              LOG.error(&quot;&quot;, e);                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 313          } finally {                                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 314              try {                                                                                                 </span>
<span class="-7143793951774237572" onmouseenter="enter('-7143793951774237572');" onmouseout="out('-7143793951774237572');" style=""> 315                  if (session != null) {                                                                            </span>
<span class="215842846359017500" onmouseenter="enter('215842846359017500');" onmouseout="out('215842846359017500');" style=""> 316                      session.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317                  }                                                                                                 </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 318              } catch (Exception e) {                                                                               </span>
<span class="-6190899687770537846" onmouseenter="enter('-6190899687770537846');" onmouseout="out('-6190899687770537846');" style=""> 319                  LOG.error(&quot;Error while closing session.&quot;, e);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320              }                                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 321              try {                                                                                                 </span>
<span class="7236775322084046720" onmouseenter="enter('7236775322084046720');" onmouseout="out('7236775322084046720');" style=""> 322                  if (cluster != null) {                                                                            </span>
<span class="-7802554339096083826" onmouseenter="enter('-7802554339096083826');" onmouseout="out('-7802554339096083826');" style=""> 323                      cluster.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324                  }                                                                                                 </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 325              } catch (Exception e) {                                                                               </span>
<span class="-4991151540299943231" onmouseenter="enter('-4991151540299943231');" onmouseout="out('-4991151540299943231');" style=""> 326                  LOG.error(&quot;Error while closing cluster.&quot;, e);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span class="-167599954638689123" onmouseenter="enter('-167599954638689123');" onmouseout="out('-167599954638689123');" style="">  19  package com.dtstack.flink.sql.side.cassandra;                                                                     </span>
<span  style="">  20                                                                                                                    </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  21  import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="3883198981410010526" onmouseenter="enter('3883198981410010526');" onmouseout="out('3883198981410010526');" style="">  22  import org.apache.flink.table.runtime.types.CRow;                                                                 </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  23  import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  24  import org.apache.flink.types.Row;                                                                                </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  25  import org.apache.flink.util.Collector;                                                                           </span>
<span  style="">  26                                                                                                                    </span>
<span class="-4674624431842718354" onmouseenter="enter('-4674624431842718354');" onmouseout="out('-4674624431842718354');" style="">  27  import com.datastax.driver.core.Cluster;                                                                          </span>
<span class="4630389600773953361" onmouseenter="enter('4630389600773953361');" onmouseout="out('4630389600773953361');" style="">  28  import com.datastax.driver.core.ConsistencyLevel;                                                                 </span>
<span class="-5077913371267042181" onmouseenter="enter('-5077913371267042181');" onmouseout="out('-5077913371267042181');" style="">  29  import com.datastax.driver.core.HostDistance;                                                                     </span>
<span class="-8460078615292194921" onmouseenter="enter('-8460078615292194921');" onmouseout="out('-8460078615292194921');" style="">  30  import com.datastax.driver.core.PoolingOptions;                                                                   </span>
<span class="3500480560938999402" onmouseenter="enter('3500480560938999402');" onmouseout="out('3500480560938999402');" style="">  31  import com.datastax.driver.core.QueryOptions;                                                                     </span>
<span class="1295458347604392536" onmouseenter="enter('1295458347604392536');" onmouseout="out('1295458347604392536');" style="">  32  import com.datastax.driver.core.ResultSet;                                                                        </span>
<span class="-2921924295373051715" onmouseenter="enter('-2921924295373051715');" onmouseout="out('-2921924295373051715');" style="">  33  import com.datastax.driver.core.Session;                                                                          </span>
<span class="7536185860942072783" onmouseenter="enter('7536185860942072783');" onmouseout="out('7536185860942072783');" style="">  34  import com.datastax.driver.core.SocketOptions;                                                                    </span>

<span class="102554056665873953" onmouseenter="enter('102554056665873953');" onmouseout="out('102554056665873953');" style="">  35  import com.datastax.driver.core.policies.DowngradingConsistencyRetryPolicy;                                       </span>
<span class="384780421342561763" onmouseenter="enter('384780421342561763');" onmouseout="out('384780421342561763');" style="">  36  import com.datastax.driver.core.policies.RetryPolicy;                                                             </span>

<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">  37  import com.dtstack.flink.sql.side.BaseAllReqRow;                                                                  </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">  38  import com.dtstack.flink.sql.side.FieldInfo;                                                                      </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">  39  import com.dtstack.flink.sql.side.JoinInfo;                                                                       </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">  40  import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                          </span>
<span class="1325017007675469198" onmouseenter="enter('1325017007675469198');" onmouseout="out('1325017007675469198');" style="">  41  import com.dtstack.flink.sql.side.cassandra.table.CassandraSideTableInfo;                                         </span>

<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  42  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  43  import com.google.common.collect.Maps;                                                                            </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  44  import org.apache.calcite.sql.JoinType;                                                                           </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  45  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  46  import org.apache.commons.lang3.StringUtils;                                                                      </span>




<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  47  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  48  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  49                                                                                                                    </span>
<span class="-5790770097715703577" onmouseenter="enter('-5790770097715703577');" onmouseout="out('-5790770097715703577');" style="">  50  import java.net.InetAddress;                                                                                      </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  51  import java.sql.SQLException;                                                                                     </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  52  import java.sql.Timestamp;                                                                                        </span>
<span class="196713859697444637" onmouseenter="enter('196713859697444637');" onmouseout="out('196713859697444637');" style="">  53  import java.util.*;                                                                                               </span>




<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  54  import java.util.concurrent.atomic.AtomicReference;                                                               </span>
<span  style="">  55                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  56  /**                                                                                                               </span>
<span class="-8405822225249706226" onmouseenter="enter('-8405822225249706226');" onmouseout="out('-8405822225249706226');" style="">  57   * Reason:                                                                                                        </span>
<span class="-6869475929847104911" onmouseenter="enter('-6869475929847104911');" onmouseout="out('-6869475929847104911');" style="">  58   * Date: 2018/11/22                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  59   *                                                                                                                </span>
<span class="-3762428130562648" onmouseenter="enter('-3762428130562648');" onmouseout="out('-3762428130562648');" style="">  60   * @author xuqianjin                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  61   */                                                                                                               </span>
<span class="-6675566310149196216" onmouseenter="enter('-6675566310149196216');" onmouseout="out('-6675566310149196216');" style="">  62  public class CassandraAllReqRow extends BaseAllReqRow {                                                           </span>
<span  style="">  63                                                                                                                    </span>
<span class="4439649471140456736" onmouseenter="enter('4439649471140456736');" onmouseout="out('4439649471140456736');" style="">  64      private static final long serialVersionUID = 54015343561288219L;                                              </span>
<span  style="">  65                                                                                                                    </span>
<span class="-1268576216050451679" onmouseenter="enter('-1268576216050451679');" onmouseout="out('-1268576216050451679');" style="">  66      private static final Logger LOG = LoggerFactory.getLogger(CassandraAllReqRow.class);                          </span>
<span  style="">  67                                                                                                                    </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  68      private static final int CONN_RETRY_NUM = 3;                                                                  </span>
<span  style="">  69                                                                                                                    </span>
<span class="-6477960095702488783" onmouseenter="enter('-6477960095702488783');" onmouseout="out('-6477960095702488783');" style="">  70      private static final int FETCH_SIZE = 1000;                                                                   </span>
<span  style="">  71                                                                                                                    </span>
<span class="-5403177446568963001" onmouseenter="enter('-5403177446568963001');" onmouseout="out('-5403177446568963001');" style="">  72      private transient Cluster cluster;                                                                            </span>
<span class="4255085420266776167" onmouseenter="enter('4255085420266776167');" onmouseout="out('4255085420266776167');" style="">  73      private transient Session session = null;                                                                     </span>
<span  style="">  74                                                                                                                    </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  75      private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();           </span>
<span  style="">  76                                                                                                                    </span>
<span class="2177500233543861344" onmouseenter="enter('2177500233543861344');" onmouseout="out('2177500233543861344');" style=""><abbr title="  77      public CassandraAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  77      public CassandraAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, Abstra🔵</abbr></span>
<span class="-3254922457036187140" onmouseenter="enter('-3254922457036187140');" onmouseout="out('-3254922457036187140');" style=""><abbr title="  78          super(new com.dtstack.flink.sql.side.cassandra.CassandraAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));">  78          super(new com.dtstack.flink.sql.side.cassandra.CassandraAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoLis🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79      }                                                                                                             </span>
<span  style="">  80                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  81      @Override                                                                                                     </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  82 -    public Row fillData(Row input, Object sideInput) {                                                            </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  83 -        Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                          </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  84 -        Row row = new Row(sideInfo.getOutFieldInfoList().size());                                                 </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  85 -        for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                         </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  86 -            Object obj = input.getField(entry.getValue());                                                        </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  87 -            boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());">  87 -            boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo🔵</abbr></span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  88 -                                                                                                                  </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  89 -            //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long.">  89 -            //Type information for indicating event or processing time. However, it behaves like a regular SQL tim🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  90 -            if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                            </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  91 -                //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                                     </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  92 -                obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  93 -            }                                                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -                                                                                                                  </span>

<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -            row.setField(entry.getKey(), obj);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -                                                                                                                  </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -        for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {                    </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -            if (cacheInfo == null) {                                                                              </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -                row.setField(entry.getKey(), null);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -            } else {                                                                                              </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -                row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -        }                                                                                                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 105 -                                                                                                                  </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 106 -        return row;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 107 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 108 -                                                                                                                  </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 109 -    @Override                                                                                                     </span>
<span class="-5452513235343270061" onmouseenter="enter('-5452513235343270061');" onmouseout="out('-5452513235343270061');" style=""> 110      protected void initCache() throws SQLException {                                                              </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 111          Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                                </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 112          cacheRef.set(newCache);                                                                                   </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 113          loadData(newCache);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114      }                                                                                                             </span>
<span  style=""> 115                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 116      @Override                                                                                                     </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 117      protected void reloadCache() {                                                                                </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 118          //reload cacheRef and replace to old cacheRef                                                             </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 119          Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 120          try {                                                                                                     </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 121              loadData(newCache);                                                                                   </span>
<span class="2505888527841761400" onmouseenter="enter('2505888527841761400');" onmouseout="out('2505888527841761400');" style=""> 122          } catch (SQLException e) {                                                                                </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 123              LOG.error(&quot;&quot;, e);                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124          }                                                                                                         </span>
<span  style=""> 125                                                                                                                    </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 126          cacheRef.set(newCache);                                                                                   </span>
<span class="6972180338294555519" onmouseenter="enter('6972180338294555519');" onmouseout="out('6972180338294555519');" style=""> 127          LOG.info(&quot;----- cassandra all cacheRef reload end:{}&quot;, Calendar.getInstance());                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128      }                                                                                                             </span>
<span  style=""> 129                                                                                                                    </span>
<span  style=""> 130                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 131      @Override                                                                                                     </span>
<span class="2657010695143174651" onmouseenter="enter('2657010695143174651');" onmouseout="out('2657010695143174651');" style=""> 132      public void flatMap(CRow input, Collector&lt;CRow&gt; out) throws Exception {                                       </span>

<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style=""> 133          List&lt;Object&gt; inputParams = Lists.newArrayList();                                                          </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style=""> 134          for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                                 </span>
<span class="-1571322702847153161" onmouseenter="enter('-1571322702847153161');" onmouseout="out('-1571322702847153161');" style=""> 135              Object equalObj = input.row().getField(conValIndex);                                                  </span>

<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style=""> 136              if (equalObj == null) {                                                                               </span>
<span class="-7689775219188827718" onmouseenter="enter('-7689775219188827718');" onmouseout="out('-7689775219188827718');" style=""> 137                  if(sideInfo.getJoinType() == JoinType.LEFT){                                                      </span>
<span class="-8021403155411844466" onmouseenter="enter('-8021403155411844466');" onmouseout="out('-8021403155411844466');" style=""> 138                      Row data = fillData(input.row(), null);                                                       </span>
<span class="-6323758209057265112" onmouseenter="enter('-6323758209057265112');" onmouseout="out('-6323758209057265112');" style=""> 139                      out.collect(new CRow(data, input.change()));                                                  </span>



<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140                  }                                                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 141                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142              }                                                                                                     </span>
<span  style=""> 143                                                                                                                    </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style=""> 144              inputParams.add(equalObj);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145          }                                                                                                         </span>
<span  style=""> 146                                                                                                                    </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style=""> 147          String key = buildKey(inputParams);                                                                       </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style=""> 148          List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                            </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style=""> 149          if (CollectionUtils.isEmpty(cacheList)) {                                                                 </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style=""> 150              if (sideInfo.getJoinType() == JoinType.LEFT) {                                                        </span>
<span class="5500326757636101813" onmouseenter="enter('5500326757636101813');" onmouseout="out('5500326757636101813');" style=""> 151                  Row row = fillData(input.row(), null);                                                            </span>
<span class="-1652121101976271273" onmouseenter="enter('-1652121101976271273');" onmouseout="out('-1652121101976271273');" style=""> 152                  out.collect(new CRow(row, input.change()));                                                       </span>


<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 153              } else {                                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 154                  return;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155              }                                                                                                     </span>
<span  style=""> 156                                                                                                                    </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 157              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158          }                                                                                                         </span>
<span  style=""> 159                                                                                                                    </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style=""> 160          for (Map&lt;String, Object&gt; one : cacheList) {                                                               </span>
<span class="-1129401162237110043" onmouseenter="enter('-1129401162237110043');" onmouseout="out('-1129401162237110043');" style=""> 161              out.collect(new CRow(fillData(input.row(), one), input.change()));                                    </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162          }                                                                                                         </span>
<span  style=""> 163                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164      }                                                                                                             </span>
<span  style=""> 165                                                                                                                    </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 166      private String buildKey(List&lt;Object&gt; equalValList) {                                                          </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 167          StringBuilder sb = new StringBuilder(&quot;&quot;);                                                                 </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 168          for (Object equalVal : equalValList) {                                                                    </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 169              sb.append(equalVal).append(&quot;_&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170          }                                                                                                         </span>
<span  style=""> 171                                                                                                                    </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 172          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173      }                                                                                                             </span>
<span  style=""> 174                                                                                                                    </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 175      private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                               </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 176          StringBuilder sb = new StringBuilder(&quot;&quot;);                                                                 </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 177          for (String equalField : equalFieldList) {                                                                </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 178              sb.append(val.get(equalField)).append(&quot;_&quot;);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179          }                                                                                                         </span>
<span  style=""> 180                                                                                                                    </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 181          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182      }                                                                                                             </span>
<span  style=""> 183                                                                                                                    </span>
<span class="4019233468954892213" onmouseenter="enter('4019233468954892213');" onmouseout="out('4019233468954892213');" style=""> 184      private Session getConn(CassandraSideTableInfo tableInfo) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 185          try {                                                                                                     </span>
<span class="417819926325380348" onmouseenter="enter('417819926325380348');" onmouseout="out('417819926325380348');" style=""> 186              if (session == null) {                                                                                </span>
<span class="-3605639280329188999" onmouseenter="enter('-3605639280329188999');" onmouseout="out('-3605639280329188999');" style=""> 187                  QueryOptions queryOptions = new QueryOptions();                                                   </span>
<span class="5842973418300621663" onmouseenter="enter('5842973418300621663');" onmouseout="out('5842973418300621663');" style=""> 188                  //The default consistency level for queries: ConsistencyLevel.TWO.                                </span>
<span class="76010926262385906" onmouseenter="enter('76010926262385906');" onmouseout="out('76010926262385906');" style=""> 189                  queryOptions.setConsistencyLevel(ConsistencyLevel.QUORUM);                                        </span>
<span class="-4388406259332422062" onmouseenter="enter('-4388406259332422062');" onmouseout="out('-4388406259332422062');" style=""><abbr title=" 190                  Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : tableInfo.getMaxRequestsPerConnection();"> 190                  Integer maxRequestsPerConnection = tableInfo.getMaxRequestsPerConnection() == null ? 1 : tableInfo🔵</abbr></span>
<span class="-6698153752588261803" onmouseenter="enter('-6698153752588261803');" onmouseout="out('-6698153752588261803');" style=""><abbr title=" 191                  Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tableInfo.getCoreConnectionsPerHost();"> 191                  Integer coreConnectionsPerHost = tableInfo.getCoreConnectionsPerHost() == null ? 8 : tableInfo.get🔵</abbr></span>
<span class="3809961524454958986" onmouseenter="enter('3809961524454958986');" onmouseout="out('3809961524454958986');" style=""><abbr title=" 192                  Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : tableInfo.getMaxConnectionsPerHost();"> 192                  Integer maxConnectionsPerHost = tableInfo.getMaxConnectionsPerHost() == null ? 32768 : tableInfo.g🔵</abbr></span>
<span class="-3297929912963114654" onmouseenter="enter('-3297929912963114654');" onmouseout="out('-3297929912963114654');" style=""> 193                  Integer maxQueueSize = tableInfo.getMaxQueueSize() == null ? 100000 : tableInfo.getMaxQueueSize();</span>
<span class="-1822015680936096661" onmouseenter="enter('-1822015680936096661');" onmouseout="out('-1822015680936096661');" style=""><abbr title=" 194                  Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.getReadTimeoutMillis();"> 194                  Integer readTimeoutMillis = tableInfo.getReadTimeoutMillis() == null ? 60000 : tableInfo.getReadTi🔵</abbr></span>
<span class="5588349030185896717" onmouseenter="enter('5588349030185896717');" onmouseout="out('5588349030185896717');" style=""><abbr title=" 195                  Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tableInfo.getConnectTimeoutMillis();"> 195                  Integer connectTimeoutMillis = tableInfo.getConnectTimeoutMillis() == null ? 60000 : tableInfo.get🔵</abbr></span>
<span class="5493190487826327243" onmouseenter="enter('5493190487826327243');" onmouseout="out('5493190487826327243');" style=""><abbr title=" 196                  Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.getPoolTimeoutMillis();"> 196                  Integer poolTimeoutMillis = tableInfo.getPoolTimeoutMillis() == null ? 60000 : tableInfo.getPoolTi🔵</abbr></span>
<span class="-5259680847618191912" onmouseenter="enter('-5259680847618191912');" onmouseout="out('-5259680847618191912');" style=""> 197                  Integer cassandraPort = 0;                                                                        </span>
<span class="-8848193911625825371" onmouseenter="enter('-8848193911625825371');" onmouseout="out('-8848193911625825371');" style=""> 198                  String address = tableInfo.getAddress();                                                          </span>
<span class="2950506038619853549" onmouseenter="enter('2950506038619853549');" onmouseout="out('2950506038619853549');" style=""> 199                  String userName = tableInfo.getUserName();                                                        </span>
<span class="-4521409941966564293" onmouseenter="enter('-4521409941966564293');" onmouseout="out('-4521409941966564293');" style=""> 200                  String password = tableInfo.getPassword();                                                        </span>
<span class="-6108815609943098672" onmouseenter="enter('-6108815609943098672');" onmouseout="out('-6108815609943098672');" style=""> 201                  String database = tableInfo.getDatabase();                                                        </span>
<span  style=""> 202                                                                                                                    </span>
<span class="6493913905304408918" onmouseenter="enter('6493913905304408918');" onmouseout="out('6493913905304408918');" style=""> 203                  ArrayList serversList = new ArrayList();                                                          </span>
<span class="5423738273364037419" onmouseenter="enter('5423738273364037419');" onmouseout="out('5423738273364037419');" style=""> 204                  //Read timeout or connection timeout Settings                                                     </span>
<span class="-1651403584650918350" onmouseenter="enter('-1651403584650918350');" onmouseout="out('-1651403584650918350');" style=""> 205                  SocketOptions so = new SocketOptions()                                                            </span>
<span class="-6143815205992723671" onmouseenter="enter('-6143815205992723671');" onmouseout="out('-6143815205992723671');" style=""> 206                          .setReadTimeoutMillis(readTimeoutMillis)                                                  </span>
<span class="-7477024419561329894" onmouseenter="enter('-7477024419561329894');" onmouseout="out('-7477024419561329894');" style=""> 207                          .setConnectTimeoutMillis(connectTimeoutMillis);                                           </span>
<span  style=""> 208                                                                                                                    </span>
<span class="36776837264098679" onmouseenter="enter('36776837264098679');" onmouseout="out('36776837264098679');" style=""> 209                  //The cluster USES hostdistance.local in the same machine room                                    </span>
<span class="-4067753854505755618" onmouseenter="enter('-4067753854505755618');" onmouseout="out('-4067753854505755618');" style=""> 210                  //Hostdistance. REMOTE is used for different machine rooms                                        </span>
<span class="-1239540897477970915" onmouseenter="enter('-1239540897477970915');" onmouseout="out('-1239540897477970915');" style=""> 211                  //Ignore use HostDistance. IGNORED                                                                </span>
<span class="7507936330523201209" onmouseenter="enter('7507936330523201209');" onmouseout="out('7507936330523201209');" style=""> 212                  PoolingOptions poolingOptions = new PoolingOptions()                                              </span>
<span class="4173548347137079648" onmouseenter="enter('4173548347137079648');" onmouseout="out('4173548347137079648');" style=""> 213                          //Each connection allows a maximum of 64 concurrent requests                              </span>
<span class="6109267905237967219" onmouseenter="enter('6109267905237967219');" onmouseout="out('6109267905237967219');" style=""> 214                          .setMaxRequestsPerConnection(HostDistance.LOCAL, maxRequestsPerConnection)                </span>
<span class="-8245292782127165862" onmouseenter="enter('-8245292782127165862');" onmouseout="out('-8245292782127165862');" style=""> 215                          //Have at least two connections to each machine in the cluster                            </span>
<span class="7216166406224594146" onmouseenter="enter('7216166406224594146');" onmouseout="out('7216166406224594146');" style=""> 216                          .setCoreConnectionsPerHost(HostDistance.LOCAL, coreConnectionsPerHost)                    </span>
<span class="-1358272374234048070" onmouseenter="enter('-1358272374234048070');" onmouseout="out('-1358272374234048070');" style=""> 217                          //There are up to eight connections to each machine in the cluster                        </span>
<span class="-1698869078338541686" onmouseenter="enter('-1698869078338541686');" onmouseout="out('-1698869078338541686');" style=""> 218                          .setMaxConnectionsPerHost(HostDistance.LOCAL, maxConnectionsPerHost)                      </span>
<span class="1548703418514968406" onmouseenter="enter('1548703418514968406');" onmouseout="out('1548703418514968406');" style=""> 219                          .setMaxQueueSize(maxQueueSize)                                                            </span>
<span class="3524981482635418824" onmouseenter="enter('3524981482635418824');" onmouseout="out('3524981482635418824');" style=""> 220                          .setPoolTimeoutMillis(poolTimeoutMillis);                                                 </span>
<span class="-3027653360277295120" onmouseenter="enter('-3027653360277295120');" onmouseout="out('-3027653360277295120');" style=""> 221                  //重试策略                                                                                            </span>
<span class="-2500245183701794239" onmouseenter="enter('-2500245183701794239');" onmouseout="out('-2500245183701794239');" style=""> 222                  RetryPolicy retryPolicy = DowngradingConsistencyRetryPolicy.INSTANCE;                             </span>
<span  style=""> 223                                                                                                                    </span>
<span class="6634426984636856768" onmouseenter="enter('6634426984636856768');" onmouseout="out('6634426984636856768');" style=""> 224                  for (String server : StringUtils.split(address, &quot;,&quot;)) {                                           </span>
<span class="-4294448682063399613" onmouseenter="enter('-4294448682063399613');" onmouseout="out('-4294448682063399613');" style=""> 225                      cassandraPort = Integer.parseInt(StringUtils.split(server, &quot;:&quot;)[1]);                          </span>
<span class="7751295421103553875" onmouseenter="enter('7751295421103553875');" onmouseout="out('7751295421103553875');" style=""> 226                      serversList.add(InetAddress.getByName(StringUtils.split(server, &quot;:&quot;)[0]));                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227                  }                                                                                                 </span>
<span  style=""> 228                                                                                                                    </span>
<span class="3673717518338030181" onmouseenter="enter('3673717518338030181');" onmouseout="out('3673717518338030181');" style=""> 229                  if (userName == null || userName.isEmpty() || password == null || password.isEmpty()) {           </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""> 230                      cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)        </span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 231                              .withPort(cassandraPort)                                                              </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 232                              .withPoolingOptions(poolingOptions).withSocketOptions(so)                             </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 233                              .withQueryOptions(queryOptions).build();                                              </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 234                  } else {                                                                                          </span>
<span class="5486080567663732369" onmouseenter="enter('5486080567663732369');" onmouseout="out('5486080567663732369');" style=""> 235                      cluster = Cluster.builder().addContactPoints(serversList).withRetryPolicy(retryPolicy)        </span>
<span class="-6421464908155171330" onmouseenter="enter('-6421464908155171330');" onmouseout="out('-6421464908155171330');" style=""> 236                              .withPort(cassandraPort)                                                              </span>
<span class="-2049534510411973309" onmouseenter="enter('-2049534510411973309');" onmouseout="out('-2049534510411973309');" style=""> 237                              .withPoolingOptions(poolingOptions).withSocketOptions(so)                             </span>
<span class="-5038512354126172278" onmouseenter="enter('-5038512354126172278');" onmouseout="out('-5038512354126172278');" style=""> 238                              .withCredentials(userName, password)                                                  </span>
<span class="8900053983828360449" onmouseenter="enter('8900053983828360449');" onmouseout="out('8900053983828360449');" style=""> 239                              .withQueryOptions(queryOptions).build();                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240                  }                                                                                                 </span>
<span class="765464969334355038" onmouseenter="enter('765464969334355038');" onmouseout="out('765464969334355038');" style=""> 241                  // 建立连接 连接已存在的键空间                                                                                 </span>
<span class="2858714417352384930" onmouseenter="enter('2858714417352384930');" onmouseout="out('2858714417352384930');" style=""> 242                  session = cluster.connect(database);                                                              </span>
<span class="8518739044679915590" onmouseenter="enter('8518739044679915590');" onmouseout="out('8518739044679915590');" style=""> 243                  LOG.info(&quot;connect cassandra is successed!&quot;);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 245          } catch (Exception e) {                                                                                   </span>
<span class="7191685386448857101" onmouseenter="enter('7191685386448857101');" onmouseout="out('7191685386448857101');" style=""> 246              LOG.error(&quot;connect cassandra is error:&quot; + e.getMessage());                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 247          }                                                                                                         </span>
<span class="7720471630782662993" onmouseenter="enter('7720471630782662993');" onmouseout="out('7720471630782662993');" style=""> 248          return session;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249      }                                                                                                             </span>
<span  style=""> 250                                                                                                                    </span>
<span  style=""> 251                                                                                                                    </span>
<span class="-6280115829611879826" onmouseenter="enter('-6280115829611879826');" onmouseout="out('-6280115829611879826');" style=""> 252      private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) throws SQLException {                  </span>
<span class="-6391193908965303732" onmouseenter="enter('-6391193908965303732');" onmouseout="out('-6391193908965303732');" style=""> 253          CassandraSideTableInfo tableInfo = (CassandraSideTableInfo) sideInfo.getSideTableInfo();                  </span>
<span class="-3023606661382789819" onmouseenter="enter('-3023606661382789819');" onmouseout="out('-3023606661382789819');" style=""> 254          Session session = null;                                                                                   </span>
<span  style=""> 255                                                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 256          try {                                                                                                     </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 257              for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 258                  try {                                                                                             </span>
<span class="-2308523158950278142" onmouseenter="enter('-2308523158950278142');" onmouseout="out('-2308523158950278142');" style=""> 259                      session = getConn(tableInfo);                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 260                      break;                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 261                  } catch (Exception e) {                                                                           </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 262                      if (i == CONN_RETRY_NUM - 1) {                                                                </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 263                          throw new RuntimeException(&quot;&quot;, e);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264                      }                                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 265                      try {                                                                                         </span>
<span class="-351091341770177564" onmouseenter="enter('-351091341770177564');" onmouseout="out('-351091341770177564');" style=""><abbr title=" 266                          String connInfo = &quot;address:&quot; + tableInfo.getAddress() + &quot;;userName:&quot; + tableInfo.getUserName()"> 266                          String connInfo = &quot;address:&quot; + tableInfo.getAddress() + &quot;;userName:&quot; + tableInfo.getUserNa🔵</abbr></span>
<span class="9039417523603645611" onmouseenter="enter('9039417523603645611');" onmouseout="out('9039417523603645611');" style=""> 267                                  + &quot;,pwd:&quot; + tableInfo.getPassword();                                              </span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 268                          LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);            </span>
<span class="-399370949889032298" onmouseenter="enter('-399370949889032298');" onmouseout="out('-399370949889032298');" style=""> 269                          Thread.sleep(LOAD_DATA_ERROR_SLEEP_TIME);                                                 </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 270                      } catch (InterruptedException e1) {                                                           </span>
<span class="8814860350844370078" onmouseenter="enter('8814860350844370078');" onmouseout="out('8814860350844370078');" style=""> 271                          LOG.error(&quot;&quot;, e1);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 273                  }                                                                                                 </span>
<span  style=""> 274                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 275              }                                                                                                     </span>
<span  style=""> 276                                                                                                                    </span>
<span class="475138084615438717" onmouseenter="enter('475138084615438717');" onmouseout="out('475138084615438717');" style=""> 277              //load data from table                                                                                </span>
<span class="-1104953430559584261" onmouseenter="enter('-1104953430559584261');" onmouseout="out('-1104953430559584261');" style=""> 278              String sql = sideInfo.getSqlCondition() + &quot; limit &quot; + FETCH_SIZE;                                     </span>
<span class="7174096590211324737" onmouseenter="enter('7174096590211324737');" onmouseout="out('7174096590211324737');" style=""> 279              ResultSet resultSet = session.execute(sql);                                                           </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 280              String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                     </span>
<span class="-8969977045023326611" onmouseenter="enter('-8969977045023326611');" onmouseout="out('-8969977045023326611');" style=""> 281              for (com.datastax.driver.core.Row row : resultSet) {                                                  </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 282                  Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                                   </span>
<span class="-587926084208094606" onmouseenter="enter('-587926084208094606');" onmouseout="out('-587926084208094606');" style=""> 283                  for (String fieldName : sideFieldNames) {                                                         </span>
<span class="-7507266122996926506" onmouseenter="enter('-7507266122996926506');" onmouseout="out('-7507266122996926506');" style=""> 284                      oneRow.put(fieldName.trim(), row.getObject(fieldName.trim()));                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285                  }                                                                                                 </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 286                  String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                                 </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""> 287                  List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList()); </span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 288                  list.add(oneRow);                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289              }                                                                                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 290          } catch (Exception e) {                                                                                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 291              LOG.error(&quot;&quot;, e);                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 292          } finally {                                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 293              try {                                                                                                 </span>
<span class="-7143793951774237572" onmouseenter="enter('-7143793951774237572');" onmouseout="out('-7143793951774237572');" style=""> 294                  if (session != null) {                                                                            </span>
<span class="215842846359017500" onmouseenter="enter('215842846359017500');" onmouseout="out('215842846359017500');" style=""> 295                      session.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296                  }                                                                                                 </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 297              } catch (Exception e) {                                                                               </span>
<span class="-6190899687770537846" onmouseenter="enter('-6190899687770537846');" onmouseout="out('-6190899687770537846');" style=""> 298                  LOG.error(&quot;Error while closing session.&quot;, e);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299              }                                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 300              try {                                                                                                 </span>
<span class="7236775322084046720" onmouseenter="enter('7236775322084046720');" onmouseout="out('7236775322084046720');" style=""> 301                  if (cluster != null) {                                                                            </span>
<span class="-7802554339096083826" onmouseenter="enter('-7802554339096083826');" onmouseout="out('-7802554339096083826');" style=""> 302                      cluster.close();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303                  }                                                                                                 </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 304              } catch (Exception e) {                                                                               </span>
<span class="-4991151540299943231" onmouseenter="enter('-4991151540299943231');" onmouseout="out('-4991151540299943231');" style=""> 305                  LOG.error(&quot;Error while closing cluster.&quot;, e);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            