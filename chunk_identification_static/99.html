<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>99</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    99
                    <a href="98.html">prev</a>
                    <a href="100.html">next</a>
                    <a href="99_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_72a9a4e9dfa438ca1540c22c9254af8e66507e49_core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/catalog/service/ProductDuplicateModifier.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;72a9a4e9dfa438ca1540c22c9254af8e66507e49:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/catalog/service/ProductDuplicateModifier.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;72a9a4e9dfa438ca1540c22c9254af8e66507e49^1:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/catalog/service/ProductDuplicateModifier.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;72a9a4e9dfa438ca1540c22c9254af8e66507e49^2:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/catalog/service/ProductDuplicateModifier.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;71daf3b1e15a8ce4593b747732610cd22ec2371e:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/catalog/service/ProductDuplicateModifier.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bsj], [b], [j]], subset: [[bsj], [b], [j]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="-2825526294831967874" onmouseenter="enter('-2825526294831967874');" onmouseout="out('-2825526294831967874');" style="">   5  * Copyright (C) 2009 - 2021 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2215023364393609539" onmouseenter="enter('2215023364393609539');" onmouseout="out('2215023364393609539');" style="">  18 package org.broadleafcommerce.core.catalog.service;                                                      </span>
<span  style="">  19                                                                                                          </span>
<span class="-5990894140160044043" onmouseenter="enter('-5990894140160044043');" onmouseout="out('-5990894140160044043');" style="">  20 import lombok.SneakyThrows;                                                                              </span>
<span class="-7920683081016957682" onmouseenter="enter('-7920683081016957682');" onmouseout="out('-7920683081016957682');" style="">  21 import org.broadleafcommerce.common.copy.MultiTenantCloneable;                                           </span>
<span class="-2722313635088289633" onmouseenter="enter('-2722313635088289633');" onmouseout="out('-2722313635088289633');" style="">  22 import org.broadleafcommerce.common.copy.MultiTenantCopyContext;                                         </span>
<span class="-7911969485500261220" onmouseenter="enter('-7911969485500261220');" onmouseout="out('-7911969485500261220');" style="">  23 import org.broadleafcommerce.common.extension.ExtensionResultHolder;                                     </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  24 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                 </span>
<span class="5173114780001024059" onmouseenter="enter('5173114780001024059');" onmouseout="out('5173114780001024059');" style="">  25 import org.broadleafcommerce.common.persistence.AbstractEntityDuplicationHelper;                         </span>
<span class="-6498279518455725690" onmouseenter="enter('-6498279518455725690');" onmouseout="out('-6498279518455725690');" style="">  26 import org.broadleafcommerce.common.persistence.EntityDuplicatorExtensionManager;                        </span>
<span class="-1492144387614747576" onmouseenter="enter('-1492144387614747576');" onmouseout="out('-1492144387614747576');" style="">  27 import org.broadleafcommerce.common.service.GenericEntityService;                                        </span>
<span class="-684463979217480005" onmouseenter="enter('-684463979217480005');" onmouseout="out('-684463979217480005');" style="">  28 import org.broadleafcommerce.core.catalog.domain.Category;                                               </span>
<span class="4115133761608674822" onmouseenter="enter('4115133761608674822');" onmouseout="out('4115133761608674822');" style="">  29 import org.broadleafcommerce.core.catalog.domain.CategoryImpl;                                           </span>
<span class="1679321519234537526" onmouseenter="enter('1679321519234537526');" onmouseout="out('1679321519234537526');" style="">  30 import org.broadleafcommerce.core.catalog.domain.CategoryProductXref;                                    </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  31 import org.broadleafcommerce.core.catalog.domain.Product;                                                </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  32 import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                            </span>
<span class="6224071758335975205" onmouseenter="enter('6224071758335975205');" onmouseout="out('6224071758335975205');" style="">  33 import org.broadleafcommerce.core.catalog.domain.ProductOption;                                          </span>
<span class="-6385470104782105538" onmouseenter="enter('-6385470104782105538');" onmouseout="out('-6385470104782105538');" style="">  34 import org.broadleafcommerce.core.catalog.domain.ProductOptionImpl;                                      </span>
<span class="-1867014672206342142" onmouseenter="enter('-1867014672206342142');" onmouseout="out('-1867014672206342142');" style="">  35 import org.broadleafcommerce.core.catalog.domain.ProductOptionXref;                                      </span>
<span class="-7697368242610247635" onmouseenter="enter('-7697368242610247635');" onmouseout="out('-7697368242610247635');" style="">  36 import org.broadleafcommerce.core.catalog.service.extension.ProductUrlDuplicatorExtensionManager;        </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  37 import org.springframework.beans.factory.annotation.Autowired;                                           </span>
<span class="2802840430073505079" onmouseenter="enter('2802840430073505079');" onmouseout="out('2802840430073505079');" style="">  38 import org.springframework.core.env.Environment;                                                         </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  39 import org.springframework.stereotype.Component;                                                         </span>
<span  style="">  40                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  41 import java.util.ArrayList;                                                                              </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  42 import java.util.Calendar;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  43 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  44 import java.util.Map;                                                                                    </span>
<span  style="">  45                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  46 import javax.annotation.Resource;                                                                        </span>
<span  style="">  47                                                                                                          </span>
<span class="-3271663854459851578" onmouseenter="enter('-3271663854459851578');" onmouseout="out('-3271663854459851578');" style="">  48 import static org.broadleafcommerce.common.copy.MultiTenantCopyContext.PROPAGATION;                      </span>
<span  style="">  49                                                                                                          </span>
<span class="-6917218188848753665" onmouseenter="enter('-6917218188848753665');" onmouseout="out('-6917218188848753665');" style="">  50 @Component(&quot;blProductDuplicateModifier&quot;)                                                                 </span>
<span class="8974675253655953202" onmouseenter="enter('8974675253655953202');" onmouseout="out('8974675253655953202');" style="">  51 public class ProductDuplicateModifier extends AbstractEntityDuplicationHelper&lt;Product&gt; {                 </span>
<span  style="">  52                                                                                                          </span>
<span class="-8607229485929501191" onmouseenter="enter('-8607229485929501191');" onmouseout="out('-8607229485929501191');" style="">  53     private static final String COPY_NUMBER_SEPARATOR = &quot;#&quot;;                                             </span>
<span  style="">  54                                                                                                          </span>
<span class="-4551546742095689549" onmouseenter="enter('-4551546742095689549');" onmouseout="out('-4551546742095689549');" style="">  55     @Resource(name = &quot;blEntityDuplicatorExtensionManager&quot;)                                               </span>
<span class="3148259255053138984" onmouseenter="enter('3148259255053138984');" onmouseout="out('3148259255053138984');" style="">  56     protected EntityDuplicatorExtensionManager extensionManager;                                         </span>
<span  style="">  57                                                                                                          </span>
<span class="2258512980686044159" onmouseenter="enter('2258512980686044159');" onmouseout="out('2258512980686044159');" style="">  58     @Resource(name = &quot;blGenericEntityService&quot;)                                                           </span>
<span class="7024198528514174971" onmouseenter="enter('7024198528514174971');" onmouseout="out('7024198528514174971');" style="">  59     protected GenericEntityService genericEntityService;                                                 </span>
<span  style="">  60                                                                                                          </span>
<span class="266539146502924876" onmouseenter="enter('266539146502924876');" onmouseout="out('266539146502924876');" style="">  61     @Resource(name = &quot;blProductUrlDuplicatorExtensionManager&quot;)                                           </span>
<span class="-6549810645412623894" onmouseenter="enter('-6549810645412623894');" onmouseout="out('-6549810645412623894');" style="">  62     protected ProductUrlDuplicatorExtensionManager productUrlDuplicatorExtensionManager;                 </span>
<span  style="">  63                                                                                                          </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="">  64     @Autowired                                                                                           </span>
<span class="6555782048000475693" onmouseenter="enter('6555782048000475693');" onmouseout="out('6555782048000475693');" style="">  65     public ProductDuplicateModifier(final Environment environment) {                                     </span>
<span  style="">  66                                                                                                          </span>
<span class="7931153115695641156" onmouseenter="enter('7931153115695641156');" onmouseout="out('7931153115695641156');" style="">  67         super(environment);                                                                              </span>
<span  style="">  68                                                                                                          </span>
<span class="-8835372487739925673" onmouseenter="enter('-8835372487739925673');" onmouseout="out('-8835372487739925673');" style="">  69         addCopyHint(ProductImpl.EXCLUDE_PRODUCT_CODE_COPY_HINT, Boolean.TRUE.toString());                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70     }                                                                                                    </span>
<span  style="">  71                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  72     @Override                                                                                            </span>
<span class="446527456378649796" onmouseenter="enter('446527456378649796');" onmouseout="out('446527456378649796');" style="">  73     public boolean canHandle(final MultiTenantCloneable candidate) {                                     </span>
<span class="-949915953170201414" onmouseenter="enter('-949915953170201414');" onmouseout="out('-949915953170201414');" style="">  74         return Product.class.isAssignableFrom(candidate.getClass());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75     }                                                                                                    </span>
<span  style="">  76                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  77     @Override                                                                                            </span>
<span class="1652707743093680525" onmouseenter="enter('1652707743093680525');" onmouseout="out('1652707743093680525');" style=""><abbr title="  78     public void modifyInitialDuplicateState(final Product original, final Product copy, final MultiTenantCopyContext context) throws CloneNotSupportedException {">  78     public void modifyInitialDuplicateState(final Product original, final Product copy, final MultiTenantðŸ”µ</abbr></span>
<span class="8648914132537267816" onmouseenter="enter('8648914132537267816');" onmouseout="out('8648914132537267816');" style=""><abbr title="  79         if(context.getCopyHints().get(PROPAGATION)!=null &amp;&amp; &quot;TRUE&quot;.equalsIgnoreCase(context.getCopyHints().get(PROPAGATION))){">  79         if(context.getCopyHints().get(PROPAGATION)!=null &amp;&amp; &quot;TRUE&quot;.equalsIgnoreCase(context.getCopyHints(ðŸ”µ</abbr></span>
<span class="6956233641105045547" onmouseenter="enter('6956233641105045547');" onmouseout="out('6956233641105045547');" style="">  80             for (CategoryProductXref allParentCategoryXref : original.getAllParentCategoryXrefs()) {     </span>
<span class="6518731427589379526" onmouseenter="enter('6518731427589379526');" onmouseout="out('6518731427589379526');" style=""><abbr title="  81                 final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).getClone();">  81                 final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(contðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style="">  82                 clone.setProduct(copy);                                                                  </span>
<span class="184950461855665097" onmouseenter="enter('184950461855665097');" onmouseout="out('184950461855665097');" style=""><abbr title="  83                 ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHolder&lt;&gt;();">  83                 ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHoldeðŸ”µ</abbr></span>
<span class="-6988054647366021606" onmouseenter="enter('-6988054647366021606');" onmouseout="out('-6988054647366021606');" style="">  84                 Long categoryId = clone.getCategory().getId();                                           </span>
<span class="1112346227885214257" onmouseenter="enter('1112346227885214257');" onmouseout="out('1112346227885214257');" style="">  85                 extensionManager.getClonesByCatalogs(&quot;BLC_CATEGORY&quot;, categoryId, context, resultHolder); </span>
<span class="-4208588666663337584" onmouseenter="enter('-4208588666663337584');" onmouseout="out('-4208588666663337584');" style=""><abbr title="  86                 Long aLong = resultHolder.getResult().get(categoryId).get(context.getToCatalog().getId());">  86                 Long aLong = resultHolder.getResult().get(categoryId).get(context.getToCatalog().getId())ðŸ”µ</abbr></span>
<span class="8933254465875048132" onmouseenter="enter('8933254465875048132');" onmouseout="out('8933254465875048132');" style=""><abbr title="  87                 Category category = (Category) genericEntityService.readGenericEntity(genericEntityService.getCeilingImplClass(CategoryImpl.class.getName()), aLong);">  87                 Category category = (Category) genericEntityService.readGenericEntity(genericEntityServicðŸ”µ</abbr></span>
<span class="7987400571614512900" onmouseenter="enter('7987400571614512900');" onmouseout="out('7987400571614512900');" style="">  88                 clone.setCategory(category);                                                             </span>
<span class="-8596829076539712901" onmouseenter="enter('-8596829076539712901');" onmouseout="out('-8596829076539712901');" style="">  89                 copy.getAllParentCategoryXrefs().add(clone);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90             }                                                                                            </span>
<span class="-1780851162438308290" onmouseenter="enter('-1780851162438308290');" onmouseout="out('-1780851162438308290');" style="">  91             List&lt;ProductOptionXref&gt; productOptionXrefs = new ArrayList&lt;&gt;();                              </span>
<span class="6272751032386654097" onmouseenter="enter('6272751032386654097');" onmouseout="out('6272751032386654097');" style="">  92             for (ProductOptionXref productOptionXref : original.getProductOptionXrefs()) {               </span>
<span class="823853853763794990" onmouseenter="enter('823853853763794990');" onmouseout="out('823853853763794990');" style=""><abbr title="  93                 final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getClone();">  93                 final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).gðŸ”µ</abbr></span>
<span class="184950461855665097" onmouseenter="enter('184950461855665097');" onmouseout="out('184950461855665097');" style=""><abbr title="  94                 ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHolder&lt;&gt;();">  94                 ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHoldeðŸ”µ</abbr></span>
<span class="-1545327613104529430" onmouseenter="enter('-1545327613104529430');" onmouseout="out('-1545327613104529430');" style="">  95                 Long optionId = clone.getProductOption().getId();                                        </span>
<span class="6672244368168956873" onmouseenter="enter('6672244368168956873');" onmouseout="out('6672244368168956873');" style=""><abbr title="  96                 extensionManager.getClonesByCatalogs(&quot;BLC_PRODUCT_OPTION&quot;, optionId, context, resultHolder);">  96                 extensionManager.getClonesByCatalogs(&quot;BLC_PRODUCT_OPTION&quot;, optionId, context, resultHoldeðŸ”µ</abbr></span>
<span class="6328519375554714191" onmouseenter="enter('6328519375554714191');" onmouseout="out('6328519375554714191');" style="">  97                 Long aLong = resultHolder.getResult().get(optionId).get(context.getToCatalog().getId()); </span>
<span class="4491220048535300812" onmouseenter="enter('4491220048535300812');" onmouseout="out('4491220048535300812');" style=""><abbr title="  98                 ProductOption productOption = (ProductOption) genericEntityService.readGenericEntity(genericEntityService.getCeilingImplClass(ProductOptionImpl.class.getName()), aLong);">  98                 ProductOption productOption = (ProductOption) genericEntityService.readGenericEntity(geneðŸ”µ</abbr></span>
<span class="-7180231804982597632" onmouseenter="enter('-7180231804982597632');" onmouseout="out('-7180231804982597632');" style="">  99                 clone.setProductOption(productOption);                                                   </span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style=""> 100                 clone.setProduct(copy);                                                                  </span>
<span class="8281820314612240967" onmouseenter="enter('8281820314612240967');" onmouseout="out('8281820314612240967');" style=""> 101                 productOptionXrefs.add(clone);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102             }                                                                                            </span>
<span class="-1079944092852296738" onmouseenter="enter('-1079944092852296738');" onmouseout="out('-1079944092852296738');" style=""> 103             copy.setProductOptionXrefs(productOptionXrefs);                                              </span>
<span  style=""> 104                                                                                                          </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 105         }else {                                                                                          </span>
<span class="3732538349305505523" onmouseenter="enter('3732538349305505523');" onmouseout="out('3732538349305505523');" style=""> 106             if(!context.getToCatalog().getId().equals(context.getFromCatalog().getId())){                </span>
<span class="1395859253657604654" onmouseenter="enter('1395859253657604654');" onmouseout="out('1395859253657604654');" style=""> 107                 copy.setAllParentCategoryXrefs(new ArrayList&lt;&gt;());                                       </span>
<span class="5170213168308734345" onmouseenter="enter('5170213168308734345');" onmouseout="out('5170213168308734345');" style=""> 108                 copy.setProductOptionXrefs(new ArrayList&lt;&gt;());                                           </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 109             }else {                                                                                      </span>
<span class="6956233641105045547" onmouseenter="enter('6956233641105045547');" onmouseout="out('6956233641105045547');" style=""> 110                 for (CategoryProductXref allParentCategoryXref : original.getAllParentCategoryXrefs()) { </span>
<span class="6518731427589379526" onmouseenter="enter('6518731427589379526');" onmouseout="out('6518731427589379526');" style=""><abbr title=" 111                     final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).getClone();"> 111                     final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(ðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style=""> 112                     clone.setProduct(copy);                                                              </span>
<span class="-8596829076539712901" onmouseenter="enter('-8596829076539712901');" onmouseout="out('-8596829076539712901');" style=""> 113                     copy.getAllParentCategoryXrefs().add(clone);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114                 }                                                                                        </span>
<span class="-1780851162438308290" onmouseenter="enter('-1780851162438308290');" onmouseout="out('-1780851162438308290');" style=""> 115                 List&lt;ProductOptionXref&gt; productOptionXrefs = new ArrayList&lt;&gt;();                          </span>
<span class="6272751032386654097" onmouseenter="enter('6272751032386654097');" onmouseout="out('6272751032386654097');" style=""> 116                 for (ProductOptionXref productOptionXref : original.getProductOptionXrefs()) {           </span>
<span class="823853853763794990" onmouseenter="enter('823853853763794990');" onmouseout="out('823853853763794990');" style=""><abbr title=" 117                     final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getClone();"> 117                     final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(contexðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style=""> 118                     clone.setProduct(copy);                                                              </span>
<span class="8281820314612240967" onmouseenter="enter('8281820314612240967');" onmouseout="out('8281820314612240967');" style=""> 119                     productOptionXrefs.add(clone);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120                 }                                                                                        </span>
<span class="-1079944092852296738" onmouseenter="enter('-1079944092852296738');" onmouseout="out('-1079944092852296738');" style=""> 121                 copy.setProductOptionXrefs(productOptionXrefs);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123         }                                                                                                </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 124 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-4159500731581343573" onmouseenter="enter('-4159500731581343573');" onmouseout="out('-4159500731581343573');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125         Calendar instance = Calendar.getInstance();                                                      </span>
<span class="-1463355520464218968" onmouseenter="enter('-1463355520464218968');" onmouseout="out('-1463355520464218968');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126         instance.add(Calendar.YEAR, 1);                                                                  </span>
<span class="796889316202561288" onmouseenter="enter('796889316202561288');" onmouseout="out('796889316202561288');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127         instance.set(Calendar.MILLISECOND, 0);                                                           </span>
<span class="-5080976734564394418" onmouseenter="enter('-5080976734564394418');" onmouseout="out('-5080976734564394418');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128         instance.set(Calendar.SECOND, 0);                                                                </span>
<span class="-4510309069457560446" onmouseenter="enter('-4510309069457560446');" onmouseout="out('-4510309069457560446');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129         instance.set(Calendar.MINUTE, 0);                                                                </span>
<span class="6052929848750419807" onmouseenter="enter('6052929848750419807');" onmouseout="out('6052929848750419807');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130         instance.set(Calendar.HOUR, 0);                                                                  </span>
<span class="3399061077188625342" onmouseenter="enter('3399061077188625342');" onmouseout="out('3399061077188625342');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131         copy.setActiveStartDate(instance.getTime());                                                     </span>
<span class="6517959846654057962" onmouseenter="enter('6517959846654057962');" onmouseout="out('6517959846654057962');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132         copy.setActiveEndDate(null);                                                                     </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 133 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-4159500731581343573" onmouseenter="enter('-4159500731581343573');" onmouseout="out('-4159500731581343573');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134         Calendar instance = Calendar.getInstance();                                                      </span>
<span class="-1463355520464218968" onmouseenter="enter('-1463355520464218968');" onmouseout="out('-1463355520464218968');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135         instance.add(Calendar.YEAR, 1);                                                                  </span>
<span class="3399061077188625342" onmouseenter="enter('3399061077188625342');" onmouseout="out('3399061077188625342');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136         copy.setActiveStartDate(instance.getTime());                                                     </span>
<span class="6517959846654057962" onmouseenter="enter('6517959846654057962');" onmouseout="out('6517959846654057962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137         copy.setActiveEndDate(null);                                                                     </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138                                                                                                          </span>
<span class="-3556686116820053688" onmouseenter="enter('-3556686116820053688');" onmouseout="out('-3556686116820053688');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139         setNameAndUrl(copy);                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142                                                                                                          </span>
<span class="7424065498910823588" onmouseenter="enter('7424065498910823588');" onmouseout="out('7424065498910823588');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143     private void setNameAndUrl(Product copy) {                                                           </span>
<span class="-4183917068124784034" onmouseenter="enter('-4183917068124784034');" onmouseout="out('-4183917068124784034');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144         String suffix = getCopySuffix();                                                                 </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 145 =======                                                                                                  </span>
<span class="-2920613297714124185" onmouseenter="enter('-2920613297714124185');" onmouseout="out('-2920613297714124185');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146         final Date currentDate = new Date();                                                             </span>
<span class="-2589668407157783500" onmouseenter="enter('-2589668407157783500');" onmouseout="out('-2589668407157783500');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147         copy.setActiveStartDate(currentDate);                                                            </span>
<span class="8090853935057450498" onmouseenter="enter('8090853935057450498');" onmouseout="out('8090853935057450498');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148         copy.setActiveEndDate(currentDate);                                                              </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 149 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style=""> 150                                                                                                          </span>
<span class="8433585810021872094" onmouseenter="enter('8433585810021872094');" onmouseout="out('8433585810021872094');" style=""> 151         setNameAndUrl(copy, context);                                                                    </span>
<span  style=""> 152                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153     }                                                                                                    </span>
<span  style=""> 154                                                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 155 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="7494049451365478344" onmouseenter="enter('7494049451365478344');" onmouseout="out('7494049451365478344');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 156     protected void setNameAndUrl(Product copy, MultiTenantCopyContext context) {                         </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 157 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158                                                                                                          </span>
<span class="7424065498910823588" onmouseenter="enter('7424065498910823588');" onmouseout="out('7424065498910823588');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159     private void setNameAndUrl(Product copy) {                                                           </span>
<span class="-4183917068124784034" onmouseenter="enter('-4183917068124784034');" onmouseout="out('-4183917068124784034');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160         String suffix = getCopySuffix();                                                                 </span>
<span class="-1164592558858150214" onmouseenter="enter('-1164592558858150214');" onmouseout="out('-1164592558858150214');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161         String name = copy.getName();                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162                                                                                                          </span>
<span class="7799468414260617041" onmouseenter="enter('7799468414260617041');" onmouseout="out('7799468414260617041');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163         if (name.contains(suffix)) {                                                                     </span>
<span class="-557468731681044400" onmouseenter="enter('-557468731681044400');" onmouseout="out('-557468731681044400');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164             if (name.contains(COPY_NUMBER_SEPARATOR)) {                                                  </span>
<span class="5265091127466895965" onmouseenter="enter('5265091127466895965');" onmouseout="out('5265091127466895965');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165                 final String copyNumber = name.split(suffix)[1];                                         </span>
<span class="3692208177937520781" onmouseenter="enter('3692208177937520781');" onmouseout="out('3692208177937520781');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 166                 suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1]) + 1);"> 166                 suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1]) +ðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 167 =======                                                                                                  </span>
<span class="-7168618954374015900" onmouseenter="enter('-7168618954374015900');" onmouseout="out('-7168618954374015900');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168     protected void setNameAndUrl(Product copy) {                                                         </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 169 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-4183917068124784034" onmouseenter="enter('-4183917068124784034');" onmouseout="out('-4183917068124784034');" style=""> 170         String suffix = getCopySuffix();                                                                 </span>
<span class="-1164592558858150214" onmouseenter="enter('-1164592558858150214');" onmouseout="out('-1164592558858150214');" style=""> 171         String name = copy.getName();                                                                    </span>
<span class="-5019140226346682666" onmouseenter="enter('-5019140226346682666');" onmouseout="out('-5019140226346682666');" style=""> 172         if(!context.getCopyHints().containsKey(&quot;PROPAGATION&quot;)) {                                         </span>
<span class="7424479410662112456" onmouseenter="enter('7424479410662112456');" onmouseout="out('7424479410662112456');" style=""> 173             int index = 0;                                                                               </span>
<span class="7799468414260617041" onmouseenter="enter('7799468414260617041');" onmouseout="out('7799468414260617041');" style=""> 174             if (name.contains(suffix)) {                                                                 </span>
<span class="-8819198241730468435" onmouseenter="enter('-8819198241730468435');" onmouseout="out('-8819198241730468435');" style=""> 175                 index = name.indexOf(COPY_NUMBER_SEPARATOR);                                             </span>
<span class="4448083491101292888" onmouseenter="enter('4448083491101292888');" onmouseout="out('4448083491101292888');" style=""> 176                 if (index &gt; 0) {                                                                         </span>
<span class="5265091127466895965" onmouseenter="enter('5265091127466895965');" onmouseout="out('5265091127466895965');" style=""> 177                     final String copyNumber = name.split(suffix)[1];                                     </span>
<span class="3692208177937520781" onmouseenter="enter('3692208177937520781');" onmouseout="out('3692208177937520781');" style=""><abbr title=" 178                     suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1]) + 1);"> 178                     suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 179                 } else {                                                                                 </span>
<span class="4910590996512931869" onmouseenter="enter('4910590996512931869');" onmouseout="out('4910590996512931869');" style=""> 180                     suffix = COPY_NUMBER_SEPARATOR + 1;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181                 }                                                                                        </span>
<span class="-4626961313859336413" onmouseenter="enter('-4626961313859336413');" onmouseout="out('-4626961313859336413');" style=""> 182                 if(index&gt;0) {                                                                            </span>
<span class="-1522519490275505250" onmouseenter="enter('-1522519490275505250');" onmouseout="out('-1522519490275505250');" style=""> 183                     name = name.substring(0, index+1) + suffix;                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 184                 }else{                                                                                   </span>
<span class="6766494649896187315" onmouseenter="enter('6766494649896187315');" onmouseout="out('6766494649896187315');" style=""> 185                     name = name + suffix;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 187             } else {                                                                                     </span>
<span class="6766494649896187315" onmouseenter="enter('6766494649896187315');" onmouseout="out('6766494649896187315');" style=""> 188                 name = name + suffix;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 190         }                                                                                                </span>
<span class="9127691374345581935" onmouseenter="enter('9127691374345581935');" onmouseout="out('9127691374345581935');" style=""> 191         copy.setName(name);                                                                              </span>
<span class="3211357851563736968" onmouseenter="enter('3211357851563736968');" onmouseout="out('3211357851563736968');" style=""><abbr title=" 192         String url = &quot;/&quot; + copy.getName().replace(&quot;-&quot;, &quot;&quot;).replace(&quot; &quot;, &quot;-&quot;).replace(&quot;#&quot;,&quot;_&quot;).toLowerCase();"> 192         String url = &quot;/&quot; + copy.getName().replace(&quot;-&quot;, &quot;&quot;).replace(&quot; &quot;, &quot;-&quot;).replace(&quot;#&quot;,&quot;_&quot;).toLowerCaseðŸ”µ</abbr></span>
<span class="-5292178609617666180" onmouseenter="enter('-5292178609617666180');" onmouseout="out('-5292178609617666180');" style=""><abbr title=" 193         ExtensionResultStatusType extensionResultStatusType = productUrlDuplicatorExtensionManager.getProxy().modifyUrl(url, copy, new ExtensionResultHolder&lt;&gt;());"> 193         ExtensionResultStatusType extensionResultStatusType = productUrlDuplicatorExtensionManager.getProðŸ”µ</abbr></span>
<span class="7850961961964313288" onmouseenter="enter('7850961961964313288');" onmouseout="out('7850961961964313288');" style=""> 194         if(extensionResultStatusType == ExtensionResultStatusType.NOT_HANDLED) {                         </span>
<span class="6264097036253801080" onmouseenter="enter('6264097036253801080');" onmouseout="out('6264097036253801080');" style=""> 195             copy.setUrl(url);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198 }                                                                                                        </span>






















</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="-2825526294831967874" onmouseenter="enter('-2825526294831967874');" onmouseout="out('-2825526294831967874');" style="">   5  * Copyright (C) 2009 - 2021 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2215023364393609539" onmouseenter="enter('2215023364393609539');" onmouseout="out('2215023364393609539');" style="">  18 package org.broadleafcommerce.core.catalog.service;                                                      </span>
<span  style="">  19                                                                                                          </span>
<span class="-5990894140160044043" onmouseenter="enter('-5990894140160044043');" onmouseout="out('-5990894140160044043');" style="">  20 import lombok.SneakyThrows;                                                                              </span>
<span class="-7920683081016957682" onmouseenter="enter('-7920683081016957682');" onmouseout="out('-7920683081016957682');" style="">  21 import org.broadleafcommerce.common.copy.MultiTenantCloneable;                                           </span>
<span class="-2722313635088289633" onmouseenter="enter('-2722313635088289633');" onmouseout="out('-2722313635088289633');" style="">  22 import org.broadleafcommerce.common.copy.MultiTenantCopyContext;                                         </span>
<span class="-7911969485500261220" onmouseenter="enter('-7911969485500261220');" onmouseout="out('-7911969485500261220');" style="">  23 import org.broadleafcommerce.common.extension.ExtensionResultHolder;                                     </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  24 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                 </span>
<span class="5173114780001024059" onmouseenter="enter('5173114780001024059');" onmouseout="out('5173114780001024059');" style="">  25 import org.broadleafcommerce.common.persistence.AbstractEntityDuplicationHelper;                         </span>
<span class="-6498279518455725690" onmouseenter="enter('-6498279518455725690');" onmouseout="out('-6498279518455725690');" style="">  26 import org.broadleafcommerce.common.persistence.EntityDuplicatorExtensionManager;                        </span>
<span class="-1492144387614747576" onmouseenter="enter('-1492144387614747576');" onmouseout="out('-1492144387614747576');" style="">  27 import org.broadleafcommerce.common.service.GenericEntityService;                                        </span>
<span class="-684463979217480005" onmouseenter="enter('-684463979217480005');" onmouseout="out('-684463979217480005');" style="">  28 import org.broadleafcommerce.core.catalog.domain.Category;                                               </span>
<span class="4115133761608674822" onmouseenter="enter('4115133761608674822');" onmouseout="out('4115133761608674822');" style="">  29 import org.broadleafcommerce.core.catalog.domain.CategoryImpl;                                           </span>
<span class="1679321519234537526" onmouseenter="enter('1679321519234537526');" onmouseout="out('1679321519234537526');" style="">  30 import org.broadleafcommerce.core.catalog.domain.CategoryProductXref;                                    </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  31 import org.broadleafcommerce.core.catalog.domain.Product;                                                </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  32 import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                            </span>
<span class="6224071758335975205" onmouseenter="enter('6224071758335975205');" onmouseout="out('6224071758335975205');" style="">  33 import org.broadleafcommerce.core.catalog.domain.ProductOption;                                          </span>
<span class="-6385470104782105538" onmouseenter="enter('-6385470104782105538');" onmouseout="out('-6385470104782105538');" style="">  34 import org.broadleafcommerce.core.catalog.domain.ProductOptionImpl;                                      </span>
<span class="-1867014672206342142" onmouseenter="enter('-1867014672206342142');" onmouseout="out('-1867014672206342142');" style="">  35 import org.broadleafcommerce.core.catalog.domain.ProductOptionXref;                                      </span>
<span class="-7697368242610247635" onmouseenter="enter('-7697368242610247635');" onmouseout="out('-7697368242610247635');" style="">  36 import org.broadleafcommerce.core.catalog.service.extension.ProductUrlDuplicatorExtensionManager;        </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  37 import org.springframework.beans.factory.annotation.Autowired;                                           </span>
<span class="2802840430073505079" onmouseenter="enter('2802840430073505079');" onmouseout="out('2802840430073505079');" style="">  38 import org.springframework.core.env.Environment;                                                         </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  39 import org.springframework.stereotype.Component;                                                         </span>
<span  style="">  40                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  41 import java.util.ArrayList;                                                                              </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  42 import java.util.Calendar;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  43 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  44 import java.util.Map;                                                                                    </span>
<span  style="">  45                                                                                                          </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  46 import javax.annotation.Resource;                                                                        </span>
<span  style="">  47                                                                                                          </span>
<span class="-3271663854459851578" onmouseenter="enter('-3271663854459851578');" onmouseout="out('-3271663854459851578');" style="">  48 import static org.broadleafcommerce.common.copy.MultiTenantCopyContext.PROPAGATION;                      </span>
<span  style="">  49                                                                                                          </span>
<span class="-6917218188848753665" onmouseenter="enter('-6917218188848753665');" onmouseout="out('-6917218188848753665');" style="">  50 @Component(&quot;blProductDuplicateModifier&quot;)                                                                 </span>
<span class="8974675253655953202" onmouseenter="enter('8974675253655953202');" onmouseout="out('8974675253655953202');" style="">  51 public class ProductDuplicateModifier extends AbstractEntityDuplicationHelper&lt;Product&gt; {                 </span>
<span  style="">  52                                                                                                          </span>
<span class="-8607229485929501191" onmouseenter="enter('-8607229485929501191');" onmouseout="out('-8607229485929501191');" style="">  53     private static final String COPY_NUMBER_SEPARATOR = &quot;#&quot;;                                             </span>
<span  style="">  54                                                                                                          </span>
<span class="-4551546742095689549" onmouseenter="enter('-4551546742095689549');" onmouseout="out('-4551546742095689549');" style="">  55     @Resource(name = &quot;blEntityDuplicatorExtensionManager&quot;)                                               </span>
<span class="3148259255053138984" onmouseenter="enter('3148259255053138984');" onmouseout="out('3148259255053138984');" style="">  56     protected EntityDuplicatorExtensionManager extensionManager;                                         </span>
<span  style="">  57                                                                                                          </span>
<span class="2258512980686044159" onmouseenter="enter('2258512980686044159');" onmouseout="out('2258512980686044159');" style="">  58     @Resource(name = &quot;blGenericEntityService&quot;)                                                           </span>
<span class="7024198528514174971" onmouseenter="enter('7024198528514174971');" onmouseout="out('7024198528514174971');" style="">  59     protected GenericEntityService genericEntityService;                                                 </span>
<span  style="">  60                                                                                                          </span>
<span class="266539146502924876" onmouseenter="enter('266539146502924876');" onmouseout="out('266539146502924876');" style="">  61     @Resource(name = &quot;blProductUrlDuplicatorExtensionManager&quot;)                                           </span>
<span class="-6549810645412623894" onmouseenter="enter('-6549810645412623894');" onmouseout="out('-6549810645412623894');" style="">  62     protected ProductUrlDuplicatorExtensionManager productUrlDuplicatorExtensionManager;                 </span>
<span  style="">  63                                                                                                          </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="">  64     @Autowired                                                                                           </span>
<span class="6555782048000475693" onmouseenter="enter('6555782048000475693');" onmouseout="out('6555782048000475693');" style="">  65     public ProductDuplicateModifier(final Environment environment) {                                     </span>
<span  style="">  66                                                                                                          </span>
<span class="7931153115695641156" onmouseenter="enter('7931153115695641156');" onmouseout="out('7931153115695641156');" style="">  67         super(environment);                                                                              </span>
<span  style="">  68                                                                                                          </span>
<span class="-8835372487739925673" onmouseenter="enter('-8835372487739925673');" onmouseout="out('-8835372487739925673');" style="">  69         addCopyHint(ProductImpl.EXCLUDE_PRODUCT_CODE_COPY_HINT, Boolean.TRUE.toString());                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70     }                                                                                                    </span>
<span  style="">  71                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  72     @Override                                                                                            </span>
<span class="446527456378649796" onmouseenter="enter('446527456378649796');" onmouseout="out('446527456378649796');" style="">  73     public boolean canHandle(final MultiTenantCloneable candidate) {                                     </span>
<span class="-949915953170201414" onmouseenter="enter('-949915953170201414');" onmouseout="out('-949915953170201414');" style="">  74         return Product.class.isAssignableFrom(candidate.getClass());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75     }                                                                                                    </span>
<span  style="">  76                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  77         @Override                                                                                        </span>
<span class="1652707743093680525" onmouseenter="enter('1652707743093680525');" onmouseout="out('1652707743093680525');" style=""><abbr title="  78     public void modifyInitialDuplicateState(final Product original, final Product copy, final MultiTenantCopyContext context) throws CloneNotSupportedException {">  78     public void modifyInitialDuplicateState(final Product original, final Product copy, final MultiTenantðŸ”µ</abbr></span>
<span class="8648914132537267816" onmouseenter="enter('8648914132537267816');" onmouseout="out('8648914132537267816');" style=""><abbr title="  79         if(context.getCopyHints().get(PROPAGATION)!=null &amp;&amp; &quot;TRUE&quot;.equalsIgnoreCase(context.getCopyHints().get(PROPAGATION))){">  79         if(context.getCopyHints().get(PROPAGATION)!=null &amp;&amp; &quot;TRUE&quot;.equalsIgnoreCase(context.getCopyHints(ðŸ”µ</abbr></span>
<span class="6956233641105045547" onmouseenter="enter('6956233641105045547');" onmouseout="out('6956233641105045547');" style="">  80             for (CategoryProductXref allParentCategoryXref : original.getAllParentCategoryXrefs()) {     </span>
<span class="6518731427589379526" onmouseenter="enter('6518731427589379526');" onmouseout="out('6518731427589379526');" style=""><abbr title="  81                 final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).getClone();">  81                 final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(contðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style="">  82                 clone.setProduct(copy);                                                                  </span>
<span class="184950461855665097" onmouseenter="enter('184950461855665097');" onmouseout="out('184950461855665097');" style=""><abbr title="  83                 ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHolder&lt;&gt;();">  83                 ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHoldeðŸ”µ</abbr></span>
<span class="-6988054647366021606" onmouseenter="enter('-6988054647366021606');" onmouseout="out('-6988054647366021606');" style="">  84                 Long categoryId = clone.getCategory().getId();                                           </span>
<span class="1112346227885214257" onmouseenter="enter('1112346227885214257');" onmouseout="out('1112346227885214257');" style="">  85                 extensionManager.getClonesByCatalogs(&quot;BLC_CATEGORY&quot;, categoryId, context, resultHolder); </span>
<span class="-4208588666663337584" onmouseenter="enter('-4208588666663337584');" onmouseout="out('-4208588666663337584');" style=""><abbr title="  86                 Long aLong = resultHolder.getResult().get(categoryId).get(context.getToCatalog().getId());">  86                 Long aLong = resultHolder.getResult().get(categoryId).get(context.getToCatalog().getId())ðŸ”µ</abbr></span>
<span class="8933254465875048132" onmouseenter="enter('8933254465875048132');" onmouseout="out('8933254465875048132');" style=""><abbr title="  87                 Category category = (Category) genericEntityService.readGenericEntity(genericEntityService.getCeilingImplClass(CategoryImpl.class.getName()), aLong);">  87                 Category category = (Category) genericEntityService.readGenericEntity(genericEntityServicðŸ”µ</abbr></span>
<span class="7987400571614512900" onmouseenter="enter('7987400571614512900');" onmouseout="out('7987400571614512900');" style="">  88                 clone.setCategory(category);                                                             </span>
<span class="-8596829076539712901" onmouseenter="enter('-8596829076539712901');" onmouseout="out('-8596829076539712901');" style="">  89                 copy.getAllParentCategoryXrefs().add(clone);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90             }                                                                                            </span>
<span class="-1780851162438308290" onmouseenter="enter('-1780851162438308290');" onmouseout="out('-1780851162438308290');" style="">  91             List&lt;ProductOptionXref&gt; productOptionXrefs = new ArrayList&lt;&gt;();                              </span>
<span class="6272751032386654097" onmouseenter="enter('6272751032386654097');" onmouseout="out('6272751032386654097');" style="">  92             for (ProductOptionXref productOptionXref : original.getProductOptionXrefs()) {               </span>
<span class="823853853763794990" onmouseenter="enter('823853853763794990');" onmouseout="out('823853853763794990');" style=""><abbr title="  93                 final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getClone();">  93                 final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).gðŸ”µ</abbr></span>
<span class="184950461855665097" onmouseenter="enter('184950461855665097');" onmouseout="out('184950461855665097');" style=""><abbr title="  94                 ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHolder&lt;&gt;();">  94                 ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHoldeðŸ”µ</abbr></span>
<span class="-1545327613104529430" onmouseenter="enter('-1545327613104529430');" onmouseout="out('-1545327613104529430');" style="">  95                 Long optionId = clone.getProductOption().getId();                                        </span>
<span class="6672244368168956873" onmouseenter="enter('6672244368168956873');" onmouseout="out('6672244368168956873');" style=""><abbr title="  96                 extensionManager.getClonesByCatalogs(&quot;BLC_PRODUCT_OPTION&quot;, optionId, context, resultHolder);">  96                 extensionManager.getClonesByCatalogs(&quot;BLC_PRODUCT_OPTION&quot;, optionId, context, resultHoldeðŸ”µ</abbr></span>
<span class="6328519375554714191" onmouseenter="enter('6328519375554714191');" onmouseout="out('6328519375554714191');" style="">  97                 Long aLong = resultHolder.getResult().get(optionId).get(context.getToCatalog().getId()); </span>
<span class="4491220048535300812" onmouseenter="enter('4491220048535300812');" onmouseout="out('4491220048535300812');" style=""><abbr title="  98                 ProductOption productOption = (ProductOption) genericEntityService.readGenericEntity(genericEntityService.getCeilingImplClass(ProductOptionImpl.class.getName()), aLong);">  98                 ProductOption productOption = (ProductOption) genericEntityService.readGenericEntity(geneðŸ”µ</abbr></span>
<span class="-7180231804982597632" onmouseenter="enter('-7180231804982597632');" onmouseout="out('-7180231804982597632');" style="">  99                 clone.setProductOption(productOption);                                                   </span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style=""> 100                 clone.setProduct(copy);                                                                  </span>
<span class="8281820314612240967" onmouseenter="enter('8281820314612240967');" onmouseout="out('8281820314612240967');" style=""> 101                 productOptionXrefs.add(clone);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102             }                                                                                            </span>
<span class="-1079944092852296738" onmouseenter="enter('-1079944092852296738');" onmouseout="out('-1079944092852296738');" style=""> 103             copy.setProductOptionXrefs(productOptionXrefs);                                              </span>
<span  style=""> 104                                                                                                          </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 105         }else {                                                                                          </span>
<span class="3732538349305505523" onmouseenter="enter('3732538349305505523');" onmouseout="out('3732538349305505523');" style=""> 106             if(!context.getToCatalog().getId().equals(context.getFromCatalog().getId())){                </span>
<span class="1395859253657604654" onmouseenter="enter('1395859253657604654');" onmouseout="out('1395859253657604654');" style=""> 107                 copy.setAllParentCategoryXrefs(new ArrayList&lt;&gt;());                                       </span>
<span class="5170213168308734345" onmouseenter="enter('5170213168308734345');" onmouseout="out('5170213168308734345');" style=""> 108                 copy.setProductOptionXrefs(new ArrayList&lt;&gt;());                                           </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 109             }else {                                                                                      </span>
<span class="6956233641105045547" onmouseenter="enter('6956233641105045547');" onmouseout="out('6956233641105045547');" style=""> 110                 for (CategoryProductXref allParentCategoryXref : original.getAllParentCategoryXrefs()) { </span>
<span class="6518731427589379526" onmouseenter="enter('6518731427589379526');" onmouseout="out('6518731427589379526');" style=""><abbr title=" 111                     final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).getClone();"> 111                     final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(ðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style=""> 112                     clone.setProduct(copy);                                                              </span>
<span class="-8596829076539712901" onmouseenter="enter('-8596829076539712901');" onmouseout="out('-8596829076539712901');" style=""> 113                     copy.getAllParentCategoryXrefs().add(clone);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114                 }                                                                                        </span>
<span class="-1780851162438308290" onmouseenter="enter('-1780851162438308290');" onmouseout="out('-1780851162438308290');" style=""> 115                 List&lt;ProductOptionXref&gt; productOptionXrefs = new ArrayList&lt;&gt;();                          </span>
<span class="6272751032386654097" onmouseenter="enter('6272751032386654097');" onmouseout="out('6272751032386654097');" style=""> 116                 for (ProductOptionXref productOptionXref : original.getProductOptionXrefs()) {           </span>
<span class="823853853763794990" onmouseenter="enter('823853853763794990');" onmouseout="out('823853853763794990');" style=""><abbr title=" 117                     final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getClone();"> 117                     final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(contexðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style=""> 118                     clone.setProduct(copy);                                                              </span>
<span class="8281820314612240967" onmouseenter="enter('8281820314612240967');" onmouseout="out('8281820314612240967');" style=""> 119                     productOptionXrefs.add(clone);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120                 }                                                                                        </span>
<span class="-1079944092852296738" onmouseenter="enter('-1079944092852296738');" onmouseout="out('-1079944092852296738');" style=""> 121                 copy.setProductOptionXrefs(productOptionXrefs);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123         }                                                                                                </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 124 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-4159500731581343573" onmouseenter="enter('-4159500731581343573');" onmouseout="out('-4159500731581343573');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 125         Calendar instance = Calendar.getInstance();                                                      </span>
<span class="-1463355520464218968" onmouseenter="enter('-1463355520464218968');" onmouseout="out('-1463355520464218968');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 126         instance.add(Calendar.YEAR, 1);                                                                  </span>
<span class="796889316202561288" onmouseenter="enter('796889316202561288');" onmouseout="out('796889316202561288');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 127         instance.set(Calendar.MILLISECOND, 0);                                                           </span>
<span class="-5080976734564394418" onmouseenter="enter('-5080976734564394418');" onmouseout="out('-5080976734564394418');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 128         instance.set(Calendar.SECOND, 0);                                                                </span>
<span class="-4510309069457560446" onmouseenter="enter('-4510309069457560446');" onmouseout="out('-4510309069457560446');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 129         instance.set(Calendar.MINUTE, 0);                                                                </span>
<span class="6052929848750419807" onmouseenter="enter('6052929848750419807');" onmouseout="out('6052929848750419807');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 130         instance.set(Calendar.HOUR, 0);                                                                  </span>
<span class="3399061077188625342" onmouseenter="enter('3399061077188625342');" onmouseout="out('3399061077188625342');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 131         copy.setActiveStartDate(instance.getTime());                                                     </span>
<span class="6517959846654057962" onmouseenter="enter('6517959846654057962');" onmouseout="out('6517959846654057962');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132         copy.setActiveEndDate(null);                                                                     </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 133 ||||||| BASE                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134         }                                                                                                </span>
<span class="-4159500731581343573" onmouseenter="enter('-4159500731581343573');" onmouseout="out('-4159500731581343573');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135         Calendar instance = Calendar.getInstance();                                                      </span>
<span class="-1463355520464218968" onmouseenter="enter('-1463355520464218968');" onmouseout="out('-1463355520464218968');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136         instance.add(Calendar.YEAR, 1);                                                                  </span>
<span class="3399061077188625342" onmouseenter="enter('3399061077188625342');" onmouseout="out('3399061077188625342');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137         copy.setActiveStartDate(instance.getTime());                                                     </span>
<span class="6517959846654057962" onmouseenter="enter('6517959846654057962');" onmouseout="out('6517959846654057962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138         copy.setActiveEndDate(null);                                                                     </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139                                                                                                          </span>
<span class="-3556686116820053688" onmouseenter="enter('-3556686116820053688');" onmouseout="out('-3556686116820053688');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140         setNameAndUrl(copy);                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 142 =======                                                                                                  </span>
<span class="-2920613297714124185" onmouseenter="enter('-2920613297714124185');" onmouseout="out('-2920613297714124185');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143         final Date currentDate = new Date();                                                             </span>
<span class="-2589668407157783500" onmouseenter="enter('-2589668407157783500');" onmouseout="out('-2589668407157783500');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144         copy.setActiveStartDate(currentDate);                                                            </span>
<span class="8090853935057450498" onmouseenter="enter('8090853935057450498');" onmouseout="out('8090853935057450498');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145         copy.setActiveEndDate(currentDate);                                                              </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 146 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 147                                                                                                          </span>
<span class="8433585810021872094" onmouseenter="enter('8433585810021872094');" onmouseout="out('8433585810021872094');" style=""> 148         setNameAndUrl(copy, context);                                                                    </span>
<span  style=""> 149                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150     }                                                                                                    </span>
<span  style=""> 151                                                                                                          </span>
<span class="7494049451365478344" onmouseenter="enter('7494049451365478344');" onmouseout="out('7494049451365478344');" style=""> 152     protected void setNameAndUrl(Product copy, MultiTenantCopyContext context) {                         </span>
<span class="-4183917068124784034" onmouseenter="enter('-4183917068124784034');" onmouseout="out('-4183917068124784034');" style=""> 153         String suffix = getCopySuffix();                                                                 </span>
<span class="-1164592558858150214" onmouseenter="enter('-1164592558858150214');" onmouseout="out('-1164592558858150214');" style=""> 154         String name = copy.getName();                                                                    </span>
<span class="-5019140226346682666" onmouseenter="enter('-5019140226346682666');" onmouseout="out('-5019140226346682666');" style=""> 155         if(!context.getCopyHints().containsKey(&quot;PROPAGATION&quot;)) {                                         </span>
<span class="7424479410662112456" onmouseenter="enter('7424479410662112456');" onmouseout="out('7424479410662112456');" style=""> 156             int index = 0;                                                                               </span>
<span class="7799468414260617041" onmouseenter="enter('7799468414260617041');" onmouseout="out('7799468414260617041');" style=""> 157             if (name.contains(suffix)) {                                                                 </span>
<span class="-8819198241730468435" onmouseenter="enter('-8819198241730468435');" onmouseout="out('-8819198241730468435');" style=""> 158                 index = name.indexOf(COPY_NUMBER_SEPARATOR);                                             </span>
<span class="4448083491101292888" onmouseenter="enter('4448083491101292888');" onmouseout="out('4448083491101292888');" style=""> 159                 if (index &gt; 0) {                                                                         </span>
<span class="5265091127466895965" onmouseenter="enter('5265091127466895965');" onmouseout="out('5265091127466895965');" style=""> 160                     final String copyNumber = name.split(suffix)[1];                                     </span>
<span class="3692208177937520781" onmouseenter="enter('3692208177937520781');" onmouseout="out('3692208177937520781');" style=""><abbr title=" 161                     suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1]) + 1);"> 161                     suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 162                 } else {                                                                                 </span>
<span class="4910590996512931869" onmouseenter="enter('4910590996512931869');" onmouseout="out('4910590996512931869');" style=""> 163                     suffix = COPY_NUMBER_SEPARATOR + 1;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164                 }                                                                                        </span>
<span class="-4626961313859336413" onmouseenter="enter('-4626961313859336413');" onmouseout="out('-4626961313859336413');" style=""> 165                 if(index&gt;0) {                                                                            </span>
<span class="-1522519490275505250" onmouseenter="enter('-1522519490275505250');" onmouseout="out('-1522519490275505250');" style=""> 166                     name = name.substring(0, index+1) + suffix;                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 167                 }else{                                                                                   </span>
<span class="6766494649896187315" onmouseenter="enter('6766494649896187315');" onmouseout="out('6766494649896187315');" style=""> 168                     name = name + suffix;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 170             } else {                                                                                     </span>
<span class="6766494649896187315" onmouseenter="enter('6766494649896187315');" onmouseout="out('6766494649896187315');" style=""> 171                 name = name + suffix;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173         }                                                                                                </span>
<span class="9127691374345581935" onmouseenter="enter('9127691374345581935');" onmouseout="out('9127691374345581935');" style=""> 174         copy.setName(name);                                                                              </span>
<span class="3211357851563736968" onmouseenter="enter('3211357851563736968');" onmouseout="out('3211357851563736968');" style=""><abbr title=" 175         String url = &quot;/&quot; + copy.getName().replace(&quot;-&quot;, &quot;&quot;).replace(&quot; &quot;, &quot;-&quot;).replace(&quot;#&quot;,&quot;_&quot;).toLowerCase();"> 175         String url = &quot;/&quot; + copy.getName().replace(&quot;-&quot;, &quot;&quot;).replace(&quot; &quot;, &quot;-&quot;).replace(&quot;#&quot;,&quot;_&quot;).toLowerCaseðŸ”µ</abbr></span>
<span class="-5292178609617666180" onmouseenter="enter('-5292178609617666180');" onmouseout="out('-5292178609617666180');" style=""><abbr title=" 176         ExtensionResultStatusType extensionResultStatusType = productUrlDuplicatorExtensionManager.getProxy().modifyUrl(url, copy, new ExtensionResultHolder&lt;&gt;());"> 176         ExtensionResultStatusType extensionResultStatusType = productUrlDuplicatorExtensionManager.getProðŸ”µ</abbr></span>
<span class="7850961961964313288" onmouseenter="enter('7850961961964313288');" onmouseout="out('7850961961964313288');" style=""> 177         if(extensionResultStatusType == ExtensionResultStatusType.NOT_HANDLED) {                         </span>
<span class="6264097036253801080" onmouseenter="enter('6264097036253801080');" onmouseout="out('6264097036253801080');" style=""> 178             copy.setUrl(url);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180     }                                                                                                    </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 181 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 182 ||||||| BASE                                                                                             </span>
<span class="7424065498910823588" onmouseenter="enter('7424065498910823588');" onmouseout="out('7424065498910823588');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183 private void setNameAndUrl(Product copy) {                                                               </span>
<span class="-4183917068124784034" onmouseenter="enter('-4183917068124784034');" onmouseout="out('-4183917068124784034');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184         String suffix = getCopySuffix();                                                                 </span>
<span class="-1164592558858150214" onmouseenter="enter('-1164592558858150214');" onmouseout="out('-1164592558858150214');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185         String name = copy.getName();                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186                                                                                                          </span>
<span class="7799468414260617041" onmouseenter="enter('7799468414260617041');" onmouseout="out('7799468414260617041');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187         if (name.contains(suffix)) {                                                                     </span>
<span class="-557468731681044400" onmouseenter="enter('-557468731681044400');" onmouseout="out('-557468731681044400');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188             if (name.contains(COPY_NUMBER_SEPARATOR)) {                                                  </span>
<span class="5265091127466895965" onmouseenter="enter('5265091127466895965');" onmouseout="out('5265091127466895965');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189                 final String copyNumber = name.split(suffix)[1];                                         </span>
<span class="3692208177937520781" onmouseenter="enter('3692208177937520781');" onmouseout="out('3692208177937520781');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 190                 suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1]) + 1);"> 190                 suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1]) +ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191             } else {                                                                                     </span>
<span class="4910590996512931869" onmouseenter="enter('4910590996512931869');" onmouseout="out('4910590996512931869');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192                 suffix = COPY_NUMBER_SEPARATOR + 1;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193             }                                                                                            </span>
<span class="5961549808481341518" onmouseenter="enter('5961549808481341518');" onmouseout="out('5961549808481341518');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194             name = name.substring(0, name.length() - 1) + suffix;                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195         } else {                                                                                         </span>
<span class="6766494649896187315" onmouseenter="enter('6766494649896187315');" onmouseout="out('6766494649896187315');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196             name = name + suffix;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197         }                                                                                                </span>
<span class="9127691374345581935" onmouseenter="enter('9127691374345581935');" onmouseout="out('9127691374345581935');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198         copy.setName(name);                                                                              </span>
<span class="1357636088908081838" onmouseenter="enter('1357636088908081838');" onmouseout="out('1357636088908081838');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199         copy.setUrl(&quot;/&quot; + copy.getName().replace(&quot;-&quot;, &quot;&quot;).replace(&quot; &quot;, &quot;-&quot;).toLowerCase());              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200     }                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 201 =======                                                                                                  </span>
<span class="-7168618954374015900" onmouseenter="enter('-7168618954374015900');" onmouseout="out('-7168618954374015900');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202 protected void setNameAndUrl(Product copy) {                                                             </span>
<span class="-4183917068124784034" onmouseenter="enter('-4183917068124784034');" onmouseout="out('-4183917068124784034');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203         String suffix = getCopySuffix();                                                                 </span>
<span class="-1164592558858150214" onmouseenter="enter('-1164592558858150214');" onmouseout="out('-1164592558858150214');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204         String name = copy.getName();                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205                                                                                                          </span>
<span class="7799468414260617041" onmouseenter="enter('7799468414260617041');" onmouseout="out('7799468414260617041');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206         if (name.contains(suffix)) {                                                                     </span>
<span class="-557468731681044400" onmouseenter="enter('-557468731681044400');" onmouseout="out('-557468731681044400');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207             if (name.contains(COPY_NUMBER_SEPARATOR)) {                                                  </span>
<span class="5265091127466895965" onmouseenter="enter('5265091127466895965');" onmouseout="out('5265091127466895965');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208                 final String copyNumber = name.split(suffix)[1];                                         </span>
<span class="3692208177937520781" onmouseenter="enter('3692208177937520781');" onmouseout="out('3692208177937520781');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 209                 suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1]) + 1);"> 209                 suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1]) +ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210             } else {                                                                                     </span>
<span class="4910590996512931869" onmouseenter="enter('4910590996512931869');" onmouseout="out('4910590996512931869');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211                 suffix = COPY_NUMBER_SEPARATOR + 1;                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212             }                                                                                            </span>
<span class="5961549808481341518" onmouseenter="enter('5961549808481341518');" onmouseout="out('5961549808481341518');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213             name = name.substring(0, name.length() - 1) + suffix;                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214         } else {                                                                                         </span>
<span class="6766494649896187315" onmouseenter="enter('6766494649896187315');" onmouseout="out('6766494649896187315');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215             name = name + suffix;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216         }                                                                                                </span>
<span class="9127691374345581935" onmouseenter="enter('9127691374345581935');" onmouseout="out('9127691374345581935');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217         copy.setName(name);                                                                              </span>
<span class="1357636088908081838" onmouseenter="enter('1357636088908081838');" onmouseout="out('1357636088908081838');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218         copy.setUrl(&quot;/&quot; + copy.getName().replace(&quot;-&quot;, &quot;&quot;).replace(&quot; &quot;, &quot;-&quot;).toLowerCase());              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219     }                                                                                                    </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 220 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 221                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2  * #%L                                                                                                   </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3  * BroadleafCommerce Framework                                                                           </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4  * %%                                                                                                    </span>
<span class="-2825526294831967874" onmouseenter="enter('-2825526294831967874');" onmouseout="out('-2825526294831967874');" style="">   5  * Copyright (C) 2009 - 2021 Broadleaf Commerce                                                          </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6  * %%                                                                                                    </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                  </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)    </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case    </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10  * the Broadleaf End User License Agreement (EULA), Version 1.1                                          </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt) </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12  * shall apply.                                                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13  *                                                                                                       </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style=""><abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr></span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16  * #L%                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="2215023364393609539" onmouseenter="enter('2215023364393609539');" onmouseout="out('2215023364393609539');" style="">  18 package org.broadleafcommerce.core.catalog.service;                                                      </span>
<span  style="">  19                                                                                                          </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  20 import java.util.ArrayList;                                                                              </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  21 import java.util.Calendar;                                                                               </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  22 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  23 import java.util.Map;                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  24 import javax.annotation.Resource;                                                                        </span>
<span class="-5990894140160044043" onmouseenter="enter('-5990894140160044043');" onmouseout="out('-5990894140160044043');" style="">  25 import lombok.SneakyThrows;                                                                              </span>
<span class="-7920683081016957682" onmouseenter="enter('-7920683081016957682');" onmouseout="out('-7920683081016957682');" style="">  26 import org.broadleafcommerce.common.copy.MultiTenantCloneable;                                           </span>
<span class="-2722313635088289633" onmouseenter="enter('-2722313635088289633');" onmouseout="out('-2722313635088289633');" style="">  27 import org.broadleafcommerce.common.copy.MultiTenantCopyContext;                                         </span>
<span class="-7911969485500261220" onmouseenter="enter('-7911969485500261220');" onmouseout="out('-7911969485500261220');" style="">  28 import org.broadleafcommerce.common.extension.ExtensionResultHolder;                                     </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="">  29 import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                 </span>
<span class="5173114780001024059" onmouseenter="enter('5173114780001024059');" onmouseout="out('5173114780001024059');" style="">  30 import org.broadleafcommerce.common.persistence.AbstractEntityDuplicationHelper;                         </span>
<span class="-6498279518455725690" onmouseenter="enter('-6498279518455725690');" onmouseout="out('-6498279518455725690');" style="">  31 import org.broadleafcommerce.common.persistence.EntityDuplicatorExtensionManager;                        </span>
<span class="-1492144387614747576" onmouseenter="enter('-1492144387614747576');" onmouseout="out('-1492144387614747576');" style="">  32 import org.broadleafcommerce.common.service.GenericEntityService;                                        </span>
<span class="-684463979217480005" onmouseenter="enter('-684463979217480005');" onmouseout="out('-684463979217480005');" style="">  33 import org.broadleafcommerce.core.catalog.domain.Category;                                               </span>
<span class="4115133761608674822" onmouseenter="enter('4115133761608674822');" onmouseout="out('4115133761608674822');" style="">  34 import org.broadleafcommerce.core.catalog.domain.CategoryImpl;                                           </span>
<span class="1679321519234537526" onmouseenter="enter('1679321519234537526');" onmouseout="out('1679321519234537526');" style="">  35 import org.broadleafcommerce.core.catalog.domain.CategoryProductXref;                                    </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  36 import org.broadleafcommerce.core.catalog.domain.Product;                                                </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  37 import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                            </span>
<span class="6224071758335975205" onmouseenter="enter('6224071758335975205');" onmouseout="out('6224071758335975205');" style="">  38 import org.broadleafcommerce.core.catalog.domain.ProductOption;                                          </span>
<span class="-6385470104782105538" onmouseenter="enter('-6385470104782105538');" onmouseout="out('-6385470104782105538');" style="">  39 import org.broadleafcommerce.core.catalog.domain.ProductOptionImpl;                                      </span>
<span class="-1867014672206342142" onmouseenter="enter('-1867014672206342142');" onmouseout="out('-1867014672206342142');" style="">  40 import org.broadleafcommerce.core.catalog.domain.ProductOptionXref;                                      </span>
<span class="-7697368242610247635" onmouseenter="enter('-7697368242610247635');" onmouseout="out('-7697368242610247635');" style="">  41 import org.broadleafcommerce.core.catalog.service.extension.ProductUrlDuplicatorExtensionManager;        </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  42 import org.springframework.beans.factory.annotation.Autowired;                                           </span>
<span class="2802840430073505079" onmouseenter="enter('2802840430073505079');" onmouseout="out('2802840430073505079');" style="">  43 import org.springframework.core.env.Environment;                                                         </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  44 import org.springframework.stereotype.Component;                                                         </span>
<span class="-3271663854459851578" onmouseenter="enter('-3271663854459851578');" onmouseout="out('-3271663854459851578');" style="">  45 import static org.broadleafcommerce.common.copy.MultiTenantCopyContext.PROPAGATION;                      </span>
<span  style="">  46                                                                                                          </span>
<span  style="">  47                                                                                                          </span>
<span class="-6917218188848753665" onmouseenter="enter('-6917218188848753665');" onmouseout="out('-6917218188848753665');" style="">  48 @Component(&quot;blProductDuplicateModifier&quot;)                                                                 </span>
<span class="8974675253655953202" onmouseenter="enter('8974675253655953202');" onmouseout="out('8974675253655953202');" style="">  49 public class ProductDuplicateModifier extends AbstractEntityDuplicationHelper&lt;Product&gt; {                 </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  50     @Override                                                                                            </span>
<span class="1652707743093680525" onmouseenter="enter('1652707743093680525');" onmouseout="out('1652707743093680525');" style=""><abbr title="  51     public void modifyInitialDuplicateState(final Product original, final Product copy, final MultiTenantCopyContext context) throws CloneNotSupportedException {">  51     public void modifyInitialDuplicateState(final Product original, final Product copy, final MultiTenantðŸ”µ</abbr></span>
<span class="8648914132537267816" onmouseenter="enter('8648914132537267816');" onmouseout="out('8648914132537267816');" style=""><abbr title="  52         if(context.getCopyHints().get(PROPAGATION)!=null &amp;&amp; &quot;TRUE&quot;.equalsIgnoreCase(context.getCopyHints().get(PROPAGATION))){">  52         if(context.getCopyHints().get(PROPAGATION)!=null &amp;&amp; &quot;TRUE&quot;.equalsIgnoreCase(context.getCopyHints(ðŸ”µ</abbr></span>
<span class="6956233641105045547" onmouseenter="enter('6956233641105045547');" onmouseout="out('6956233641105045547');" style="">  53             for (CategoryProductXref allParentCategoryXref : original.getAllParentCategoryXrefs()) {     </span>
<span class="6518731427589379526" onmouseenter="enter('6518731427589379526');" onmouseout="out('6518731427589379526');" style=""><abbr title="  54                 final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).getClone();">  54                 final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(contðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style="">  55                 clone.setProduct(copy);                                                                  </span>
<span class="184950461855665097" onmouseenter="enter('184950461855665097');" onmouseout="out('184950461855665097');" style=""><abbr title="  56                 ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHolder&lt;&gt;();">  56                 ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHoldeðŸ”µ</abbr></span>
<span class="-6988054647366021606" onmouseenter="enter('-6988054647366021606');" onmouseout="out('-6988054647366021606');" style="">  57                 Long categoryId = clone.getCategory().getId();                                           </span>
<span class="1112346227885214257" onmouseenter="enter('1112346227885214257');" onmouseout="out('1112346227885214257');" style="">  58                 extensionManager.getClonesByCatalogs(&quot;BLC_CATEGORY&quot;, categoryId, context, resultHolder); </span>
<span class="-4208588666663337584" onmouseenter="enter('-4208588666663337584');" onmouseout="out('-4208588666663337584');" style=""><abbr title="  59                 Long aLong = resultHolder.getResult().get(categoryId).get(context.getToCatalog().getId());">  59                 Long aLong = resultHolder.getResult().get(categoryId).get(context.getToCatalog().getId())ðŸ”µ</abbr></span>
<span class="8933254465875048132" onmouseenter="enter('8933254465875048132');" onmouseout="out('8933254465875048132');" style=""><abbr title="  60                 Category category = (Category) genericEntityService.readGenericEntity(genericEntityService.getCeilingImplClass(CategoryImpl.class.getName()), aLong);">  60                 Category category = (Category) genericEntityService.readGenericEntity(genericEntityServicðŸ”µ</abbr></span>
<span class="7987400571614512900" onmouseenter="enter('7987400571614512900');" onmouseout="out('7987400571614512900');" style="">  61                 clone.setCategory(category);                                                             </span>
<span class="-8596829076539712901" onmouseenter="enter('-8596829076539712901');" onmouseout="out('-8596829076539712901');" style="">  62                 copy.getAllParentCategoryXrefs().add(clone);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  63             }                                                                                            </span>
<span class="-1780851162438308290" onmouseenter="enter('-1780851162438308290');" onmouseout="out('-1780851162438308290');" style="">  64             List&lt;ProductOptionXref&gt; productOptionXrefs = new ArrayList&lt;&gt;();                              </span>
<span class="6272751032386654097" onmouseenter="enter('6272751032386654097');" onmouseout="out('6272751032386654097');" style="">  65             for (ProductOptionXref productOptionXref : original.getProductOptionXrefs()) {               </span>
<span class="823853853763794990" onmouseenter="enter('823853853763794990');" onmouseout="out('823853853763794990');" style=""><abbr title="  66                 final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getClone();">  66                 final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).gðŸ”µ</abbr></span>
<span class="184950461855665097" onmouseenter="enter('184950461855665097');" onmouseout="out('184950461855665097');" style=""><abbr title="  67                 ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHolder&lt;&gt;();">  67                 ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHoldeðŸ”µ</abbr></span>
<span class="-1545327613104529430" onmouseenter="enter('-1545327613104529430');" onmouseout="out('-1545327613104529430');" style="">  68                 Long optionId = clone.getProductOption().getId();                                        </span>
<span class="6672244368168956873" onmouseenter="enter('6672244368168956873');" onmouseout="out('6672244368168956873');" style=""><abbr title="  69                 extensionManager.getClonesByCatalogs(&quot;BLC_PRODUCT_OPTION&quot;, optionId, context, resultHolder);">  69                 extensionManager.getClonesByCatalogs(&quot;BLC_PRODUCT_OPTION&quot;, optionId, context, resultHoldeðŸ”µ</abbr></span>
<span class="6328519375554714191" onmouseenter="enter('6328519375554714191');" onmouseout="out('6328519375554714191');" style="">  70                 Long aLong = resultHolder.getResult().get(optionId).get(context.getToCatalog().getId()); </span>
<span class="4491220048535300812" onmouseenter="enter('4491220048535300812');" onmouseout="out('4491220048535300812');" style=""><abbr title="  71                 ProductOption productOption = (ProductOption) genericEntityService.readGenericEntity(genericEntityService.getCeilingImplClass(ProductOptionImpl.class.getName()), aLong);">  71                 ProductOption productOption = (ProductOption) genericEntityService.readGenericEntity(geneðŸ”µ</abbr></span>
<span class="-7180231804982597632" onmouseenter="enter('-7180231804982597632');" onmouseout="out('-7180231804982597632');" style="">  72                 clone.setProductOption(productOption);                                                   </span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style="">  73                 clone.setProduct(copy);                                                                  </span>
<span class="8281820314612240967" onmouseenter="enter('8281820314612240967');" onmouseout="out('8281820314612240967');" style="">  74                 productOptionXrefs.add(clone);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75             }                                                                                            </span>
<span class="-1079944092852296738" onmouseenter="enter('-1079944092852296738');" onmouseout="out('-1079944092852296738');" style="">  76             copy.setProductOptionXrefs(productOptionXrefs);                                              </span>
<span  style="">  77                                                                                                          </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style="">  78         }else {                                                                                          </span>
<span class="3732538349305505523" onmouseenter="enter('3732538349305505523');" onmouseout="out('3732538349305505523');" style="">  79             if(!context.getToCatalog().getId().equals(context.getFromCatalog().getId())){                </span>
<span class="1395859253657604654" onmouseenter="enter('1395859253657604654');" onmouseout="out('1395859253657604654');" style="">  80                 copy.setAllParentCategoryXrefs(new ArrayList&lt;&gt;());                                       </span>
<span class="5170213168308734345" onmouseenter="enter('5170213168308734345');" onmouseout="out('5170213168308734345');" style="">  81                 copy.setProductOptionXrefs(new ArrayList&lt;&gt;());                                           </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style="">  82             }else {                                                                                      </span>
<span class="6956233641105045547" onmouseenter="enter('6956233641105045547');" onmouseout="out('6956233641105045547');" style="">  83                 for (CategoryProductXref allParentCategoryXref : original.getAllParentCategoryXrefs()) { </span>
<span class="6518731427589379526" onmouseenter="enter('6518731427589379526');" onmouseout="out('6518731427589379526');" style=""><abbr title="  84                     final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).getClone();">  84                     final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(ðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style="">  85                     clone.setProduct(copy);                                                              </span>
<span class="-8596829076539712901" onmouseenter="enter('-8596829076539712901');" onmouseout="out('-8596829076539712901');" style="">  86                     copy.getAllParentCategoryXrefs().add(clone);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87                 }                                                                                        </span>
<span class="-1780851162438308290" onmouseenter="enter('-1780851162438308290');" onmouseout="out('-1780851162438308290');" style="">  88                 List&lt;ProductOptionXref&gt; productOptionXrefs = new ArrayList&lt;&gt;();                          </span>
<span class="6272751032386654097" onmouseenter="enter('6272751032386654097');" onmouseout="out('6272751032386654097');" style="">  89                 for (ProductOptionXref productOptionXref : original.getProductOptionXrefs()) {           </span>
<span class="823853853763794990" onmouseenter="enter('823853853763794990');" onmouseout="out('823853853763794990');" style=""><abbr title="  90                     final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getClone();">  90                     final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(contexðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style="">  91                     clone.setProduct(copy);                                                              </span>
<span class="8281820314612240967" onmouseenter="enter('8281820314612240967');" onmouseout="out('8281820314612240967');" style="">  92                     productOptionXrefs.add(clone);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93                 }                                                                                        </span>
<span class="-1079944092852296738" onmouseenter="enter('-1079944092852296738');" onmouseout="out('-1079944092852296738');" style="">  94                 copy.setProductOptionXrefs(productOptionXrefs);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  95             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96         }                                                                                                </span>
<span  style="">  97                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style="">  98 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-4159500731581343573" onmouseenter="enter('-4159500731581343573');" onmouseout="out('-4159500731581343573');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99         Calendar instance = Calendar.getInstance();                                                      </span>
<span class="-1463355520464218968" onmouseenter="enter('-1463355520464218968');" onmouseout="out('-1463355520464218968');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100         instance.add(Calendar.YEAR, 1);                                                                  </span>
<span class="796889316202561288" onmouseenter="enter('796889316202561288');" onmouseout="out('796889316202561288');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101         instance.set(Calendar.MILLISECOND, 0);                                                           </span>
<span class="-5080976734564394418" onmouseenter="enter('-5080976734564394418');" onmouseout="out('-5080976734564394418');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102         instance.set(Calendar.SECOND, 0);                                                                </span>
<span class="-4510309069457560446" onmouseenter="enter('-4510309069457560446');" onmouseout="out('-4510309069457560446');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103         instance.set(Calendar.MINUTE, 0);                                                                </span>
<span class="6052929848750419807" onmouseenter="enter('6052929848750419807');" onmouseout="out('6052929848750419807');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104         instance.set(Calendar.HOUR, 0);                                                                  </span>
<span class="3399061077188625342" onmouseenter="enter('3399061077188625342');" onmouseout="out('3399061077188625342');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105         copy.setActiveStartDate(instance.getTime());                                                     </span>
<span class="6517959846654057962" onmouseenter="enter('6517959846654057962');" onmouseout="out('6517959846654057962');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106         copy.setActiveEndDate(null);                                                                     </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 108 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 109 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 109 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 110 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111                                                                                                          </span>
<span class="-2920613297714124185" onmouseenter="enter('-2920613297714124185');" onmouseout="out('-2920613297714124185');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112         final Date currentDate = new Date();                                                             </span>
<span class="-2589668407157783500" onmouseenter="enter('-2589668407157783500');" onmouseout="out('-2589668407157783500');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113         copy.setActiveStartDate(currentDate);                                                            </span>
<span class="8090853935057450498" onmouseenter="enter('8090853935057450498');" onmouseout="out('8090853935057450498');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114         copy.setActiveEndDate(currentDate);                                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 116 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style=""> 117                                                                                                          </span>
<span class="8433585810021872094" onmouseenter="enter('8433585810021872094');" onmouseout="out('8433585810021872094');" style=""> 118         setNameAndUrl(copy, context);                                                                    </span>
<span  style=""> 119                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120     }                                                                                                    </span>
<span  style=""> 121                                                                                                          </span>
<span class="-8607229485929501191" onmouseenter="enter('-8607229485929501191');" onmouseout="out('-8607229485929501191');" style=""> 122     private static final String COPY_NUMBER_SEPARATOR = &quot;#&quot;;                                             </span>
<span  style=""> 123                                                                                                          </span>
<span class="-4551546742095689549" onmouseenter="enter('-4551546742095689549');" onmouseout="out('-4551546742095689549');" style=""> 124     @Resource(name = &quot;blEntityDuplicatorExtensionManager&quot;)                                               </span>
<span class="3148259255053138984" onmouseenter="enter('3148259255053138984');" onmouseout="out('3148259255053138984');" style=""> 125     protected EntityDuplicatorExtensionManager extensionManager;                                         </span>
<span  style=""> 126                                                                                                          </span>
<span class="2258512980686044159" onmouseenter="enter('2258512980686044159');" onmouseout="out('2258512980686044159');" style=""> 127     @Resource(name = &quot;blGenericEntityService&quot;)                                                           </span>
<span class="7024198528514174971" onmouseenter="enter('7024198528514174971');" onmouseout="out('7024198528514174971');" style=""> 128     protected GenericEntityService genericEntityService;                                                 </span>
<span  style=""> 129                                                                                                          </span>
<span class="266539146502924876" onmouseenter="enter('266539146502924876');" onmouseout="out('266539146502924876');" style=""> 130     @Resource(name = &quot;blProductUrlDuplicatorExtensionManager&quot;)                                           </span>
<span class="-6549810645412623894" onmouseenter="enter('-6549810645412623894');" onmouseout="out('-6549810645412623894');" style=""> 131     protected ProductUrlDuplicatorExtensionManager productUrlDuplicatorExtensionManager;                 </span>
<span  style=""> 132                                                                                                          </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style=""> 133     @Autowired                                                                                           </span>
<span class="6555782048000475693" onmouseenter="enter('6555782048000475693');" onmouseout="out('6555782048000475693');" style=""> 134     public ProductDuplicateModifier(final Environment environment) {                                     </span>
<span class="7931153115695641156" onmouseenter="enter('7931153115695641156');" onmouseout="out('7931153115695641156');" style=""> 135         super(environment);                                                                              </span>
<span class="-8835372487739925673" onmouseenter="enter('-8835372487739925673');" onmouseout="out('-8835372487739925673');" style=""> 136         addCopyHint(ProductImpl.EXCLUDE_PRODUCT_CODE_COPY_HINT, Boolean.TRUE.toString());                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137     }                                                                                                    </span>
<span  style=""> 138                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 139     @Override                                                                                            </span>
<span class="446527456378649796" onmouseenter="enter('446527456378649796');" onmouseout="out('446527456378649796');" style=""> 140     public boolean canHandle(final MultiTenantCloneable candidate) {                                     </span>
<span class="-949915953170201414" onmouseenter="enter('-949915953170201414');" onmouseout="out('-949915953170201414');" style=""> 141         return Product.class.isAssignableFrom(candidate.getClass());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142     }                                                                                                    </span>
<span  style=""> 143                                                                                                          </span>
<span class="7494049451365478344" onmouseenter="enter('7494049451365478344');" onmouseout="out('7494049451365478344');" style=""> 144     protected void setNameAndUrl(Product copy, MultiTenantCopyContext context) {                         </span>
<span class="-4183917068124784034" onmouseenter="enter('-4183917068124784034');" onmouseout="out('-4183917068124784034');" style=""> 145         String suffix = getCopySuffix();                                                                 </span>
<span class="-1164592558858150214" onmouseenter="enter('-1164592558858150214');" onmouseout="out('-1164592558858150214');" style=""> 146         String name = copy.getName();                                                                    </span>
<span class="-8492373400121037416" onmouseenter="enter('-8492373400121037416');" onmouseout="out('-8492373400121037416');" style=""> 147         if (!context.getCopyHints().containsKey(&quot;PROPAGATION&quot;)) {                                        </span>
<span class="7424479410662112456" onmouseenter="enter('7424479410662112456');" onmouseout="out('7424479410662112456');" style=""> 148             int index = 0;                                                                               </span>
<span class="7799468414260617041" onmouseenter="enter('7799468414260617041');" onmouseout="out('7799468414260617041');" style=""> 149             if (name.contains(suffix)) {                                                                 </span>
<span class="-8819198241730468435" onmouseenter="enter('-8819198241730468435');" onmouseout="out('-8819198241730468435');" style=""> 150                 index = name.indexOf(COPY_NUMBER_SEPARATOR);                                             </span>
<span class="4448083491101292888" onmouseenter="enter('4448083491101292888');" onmouseout="out('4448083491101292888');" style=""> 151                 if (index &gt; 0) {                                                                         </span>
<span class="5265091127466895965" onmouseenter="enter('5265091127466895965');" onmouseout="out('5265091127466895965');" style=""> 152                     final String copyNumber = name.split(suffix)[1];                                     </span>
<span class="3692208177937520781" onmouseenter="enter('3692208177937520781');" onmouseout="out('3692208177937520781');" style=""><abbr title=" 153                     suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1]) + 1);"> 153                     suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1ðŸ”µ</abbr></span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 154                 } else {                                                                                 </span>
<span class="4910590996512931869" onmouseenter="enter('4910590996512931869');" onmouseout="out('4910590996512931869');" style=""> 155                     suffix = COPY_NUMBER_SEPARATOR + 1;                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156                 }                                                                                        </span>
<span class="4448083491101292888" onmouseenter="enter('4448083491101292888');" onmouseout="out('4448083491101292888');" style=""> 157                 if (index &gt; 0) {                                                                         </span>
<span class="-1322547414053970530" onmouseenter="enter('-1322547414053970530');" onmouseout="out('-1322547414053970530');" style=""> 158                     name = name.substring(0, index + 1) + suffix;                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 159                 } else {                                                                                 </span>
<span class="6766494649896187315" onmouseenter="enter('6766494649896187315');" onmouseout="out('6766494649896187315');" style=""> 160                     name = name + suffix;                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161                 }                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 162             } else {                                                                                     </span>
<span class="6766494649896187315" onmouseenter="enter('6766494649896187315');" onmouseout="out('6766494649896187315');" style=""> 163                 name = name + suffix;                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165         }                                                                                                </span>
<span class="9127691374345581935" onmouseenter="enter('9127691374345581935');" onmouseout="out('9127691374345581935');" style=""> 166         copy.setName(name);                                                                              </span>
<span class="1008139571866133859" onmouseenter="enter('1008139571866133859');" onmouseout="out('1008139571866133859');" style=""><abbr title=" 167         String url = &quot;/&quot; + copy.getName().replace(&quot;-&quot;, &quot;&quot;).replace(&quot; &quot;, &quot;-&quot;).replace(&quot;#&quot;, &quot;_&quot;).toLowerCase();"> 167         String url = &quot;/&quot; + copy.getName().replace(&quot;-&quot;, &quot;&quot;).replace(&quot; &quot;, &quot;-&quot;).replace(&quot;#&quot;, &quot;_&quot;).toLowerCasðŸ”µ</abbr></span>
<span class="-5292178609617666180" onmouseenter="enter('-5292178609617666180');" onmouseout="out('-5292178609617666180');" style=""><abbr title=" 168         ExtensionResultStatusType extensionResultStatusType = productUrlDuplicatorExtensionManager.getProxy().modifyUrl(url, copy, new ExtensionResultHolder&lt;&gt;());"> 168         ExtensionResultStatusType extensionResultStatusType = productUrlDuplicatorExtensionManager.getProðŸ”µ</abbr></span>
<span class="8440101159629101403" onmouseenter="enter('8440101159629101403');" onmouseout="out('8440101159629101403');" style=""> 169         if (extensionResultStatusType == ExtensionResultStatusType.NOT_HANDLED) {                        </span>
<span class="6264097036253801080" onmouseenter="enter('6264097036253801080');" onmouseout="out('6264097036253801080');" style=""> 170             copy.setUrl(url);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173 }                                                                                                        </span>















































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3   * BroadleafCommerce Framework                                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="-2825526294831967874" onmouseenter="enter('-2825526294831967874');" onmouseout="out('-2825526294831967874');" style="">   5   * Copyright (C) 2009 - 2021 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="2215023364393609539" onmouseenter="enter('2215023364393609539');" onmouseout="out('2215023364393609539');" style="">  18  package org.broadleafcommerce.core.catalog.service;                                                               </span>
<span  style="">  19                                                                                                                    </span>
<span class="-5990894140160044043" onmouseenter="enter('-5990894140160044043');" onmouseout="out('-5990894140160044043');" style="">  20  import lombok.SneakyThrows;                                                                                       </span>
<span class="-7920683081016957682" onmouseenter="enter('-7920683081016957682');" onmouseout="out('-7920683081016957682');" style="">  21  import org.broadleafcommerce.common.copy.MultiTenantCloneable;                                                    </span>
<span class="-2722313635088289633" onmouseenter="enter('-2722313635088289633');" onmouseout="out('-2722313635088289633');" style="">  22  import org.broadleafcommerce.common.copy.MultiTenantCopyContext;                                                  </span>
<span class="-7911969485500261220" onmouseenter="enter('-7911969485500261220');" onmouseout="out('-7911969485500261220');" style="">  23  import org.broadleafcommerce.common.extension.ExtensionResultHolder;                                              </span>
<span class="-8339254235515724670" onmouseenter="enter('-8339254235515724670');" onmouseout="out('-8339254235515724670');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  24 +import org.broadleafcommerce.common.extension.ExtensionResultStatusType;                                          </span>
<span class="5173114780001024059" onmouseenter="enter('5173114780001024059');" onmouseout="out('5173114780001024059');" style="">  25  import org.broadleafcommerce.common.persistence.AbstractEntityDuplicationHelper;                                  </span>
<span class="-6498279518455725690" onmouseenter="enter('-6498279518455725690');" onmouseout="out('-6498279518455725690');" style="">  26  import org.broadleafcommerce.common.persistence.EntityDuplicatorExtensionManager;                                 </span>
<span class="-1492144387614747576" onmouseenter="enter('-1492144387614747576');" onmouseout="out('-1492144387614747576');" style="">  27  import org.broadleafcommerce.common.service.GenericEntityService;                                                 </span>
<span class="-684463979217480005" onmouseenter="enter('-684463979217480005');" onmouseout="out('-684463979217480005');" style="">  28  import org.broadleafcommerce.core.catalog.domain.Category;                                                        </span>
<span class="4115133761608674822" onmouseenter="enter('4115133761608674822');" onmouseout="out('4115133761608674822');" style="">  29  import org.broadleafcommerce.core.catalog.domain.CategoryImpl;                                                    </span>
<span class="1679321519234537526" onmouseenter="enter('1679321519234537526');" onmouseout="out('1679321519234537526');" style="">  30  import org.broadleafcommerce.core.catalog.domain.CategoryProductXref;                                             </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  31  import org.broadleafcommerce.core.catalog.domain.Product;                                                         </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  32  import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                                     </span>
<span class="6224071758335975205" onmouseenter="enter('6224071758335975205');" onmouseout="out('6224071758335975205');" style="">  33  import org.broadleafcommerce.core.catalog.domain.ProductOption;                                                   </span>
<span class="-6385470104782105538" onmouseenter="enter('-6385470104782105538');" onmouseout="out('-6385470104782105538');" style="">  34  import org.broadleafcommerce.core.catalog.domain.ProductOptionImpl;                                               </span>
<span class="-1867014672206342142" onmouseenter="enter('-1867014672206342142');" onmouseout="out('-1867014672206342142');" style="">  35  import org.broadleafcommerce.core.catalog.domain.ProductOptionXref;                                               </span>
<span class="-7697368242610247635" onmouseenter="enter('-7697368242610247635');" onmouseout="out('-7697368242610247635');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  36 +import org.broadleafcommerce.core.catalog.service.extension.ProductUrlDuplicatorExtensionManager;                 </span>
<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  37  import org.springframework.beans.factory.annotation.Autowired;                                                    </span>
<span class="2802840430073505079" onmouseenter="enter('2802840430073505079');" onmouseout="out('2802840430073505079');" style="">  38  import org.springframework.core.env.Environment;                                                                  </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  39  import org.springframework.stereotype.Component;                                                                  </span>
<span  style="">  40                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  41  import java.util.ArrayList;                                                                                       </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  42  import java.util.Calendar;                                                                                        </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  43 -import java.util.Date;                                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  44  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  45  import java.util.Map;                                                                                             </span>
<span  style="">  46                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  47  import javax.annotation.Resource;                                                                                 </span>
<span  style="">  48                                                                                                                    </span>
<span class="-3271663854459851578" onmouseenter="enter('-3271663854459851578');" onmouseout="out('-3271663854459851578');" style="">  49  import static org.broadleafcommerce.common.copy.MultiTenantCopyContext.PROPAGATION;                               </span>
<span  style="">  50                                                                                                                    </span>
<span class="-6917218188848753665" onmouseenter="enter('-6917218188848753665');" onmouseout="out('-6917218188848753665');" style="">  51  @Component(&quot;blProductDuplicateModifier&quot;)                                                                          </span>
<span class="8974675253655953202" onmouseenter="enter('8974675253655953202');" onmouseout="out('8974675253655953202');" style="">  52  public class ProductDuplicateModifier extends AbstractEntityDuplicationHelper&lt;Product&gt; {                          </span>
<span  style="">  53                                                                                                                    </span>
<span class="-8607229485929501191" onmouseenter="enter('-8607229485929501191');" onmouseout="out('-8607229485929501191');" style="">  54      private static final String COPY_NUMBER_SEPARATOR = &quot;#&quot;;                                                      </span>
<span  style="">  55                                                                                                                    </span>
<span class="-4551546742095689549" onmouseenter="enter('-4551546742095689549');" onmouseout="out('-4551546742095689549');" style="">  56      @Resource(name = &quot;blEntityDuplicatorExtensionManager&quot;)                                                        </span>
<span class="3148259255053138984" onmouseenter="enter('3148259255053138984');" onmouseout="out('3148259255053138984');" style="">  57      protected EntityDuplicatorExtensionManager extensionManager;                                                  </span>
<span  style="">  58                                                                                                                    </span>
<span class="2258512980686044159" onmouseenter="enter('2258512980686044159');" onmouseout="out('2258512980686044159');" style="">  59      @Resource(name = &quot;blGenericEntityService&quot;)                                                                    </span>
<span class="7024198528514174971" onmouseenter="enter('7024198528514174971');" onmouseout="out('7024198528514174971');" style="">  60      protected GenericEntityService genericEntityService;                                                          </span>
<span  style="">  61                                                                                                                    </span>
<span class="266539146502924876" onmouseenter="enter('266539146502924876');" onmouseout="out('266539146502924876');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  62 +    @Resource(name = &quot;blProductUrlDuplicatorExtensionManager&quot;)                                                    </span>
<span class="-6549810645412623894" onmouseenter="enter('-6549810645412623894');" onmouseout="out('-6549810645412623894');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +    protected ProductUrlDuplicatorExtensionManager productUrlDuplicatorExtensionManager;                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +                                                                                                                  </span>
<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="">  65      @Autowired                                                                                                    </span>
<span class="6555782048000475693" onmouseenter="enter('6555782048000475693');" onmouseout="out('6555782048000475693');" style="">  66      public ProductDuplicateModifier(final Environment environment) {                                              </span>
<span  style="">  67                                                                                                                    </span>
<span class="7931153115695641156" onmouseenter="enter('7931153115695641156');" onmouseout="out('7931153115695641156');" style="">  68          super(environment);                                                                                       </span>
<span  style="">  69                                                                                                                    </span>
<span class="-8835372487739925673" onmouseenter="enter('-8835372487739925673');" onmouseout="out('-8835372487739925673');" style="">  70          addCopyHint(ProductImpl.EXCLUDE_PRODUCT_CODE_COPY_HINT, Boolean.TRUE.toString());                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  71      }                                                                                                             </span>
<span  style="">  72                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  73      @Override                                                                                                     </span>
<span class="446527456378649796" onmouseenter="enter('446527456378649796');" onmouseout="out('446527456378649796');" style="">  74      public boolean canHandle(final MultiTenantCloneable candidate) {                                              </span>
<span class="-949915953170201414" onmouseenter="enter('-949915953170201414');" onmouseout="out('-949915953170201414');" style="">  75          return Product.class.isAssignableFrom(candidate.getClass());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76      }                                                                                                             </span>
<span  style="">  77                                                                                                                    </span>
<span class="-1743236843918612510" onmouseenter="enter('-1743236843918612510');" onmouseout="out('-1743236843918612510');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  78 -    @SneakyThrows                                                                                                 </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  79      @Override                                                                                                     </span>
<span class="-676822139828809102" onmouseenter="enter('-676822139828809102');" onmouseout="out('-676822139828809102');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  80 -    public void modifyInitialDuplicateState(final Product original, final Product copy, final MultiTenantCopyContext context) {">  80 -    public void modifyInitialDuplicateState(final Product original, final Product copy, final MultiTenantCopyConteðŸ”µ</abbr></span>
<span class="1652707743093680525" onmouseenter="enter('1652707743093680525');" onmouseout="out('1652707743093680525');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title="  81 +    public void modifyInitialDuplicateState(final Product original, final Product copy, final MultiTenantCopyContext context) throws CloneNotSupportedException {">  81 +    public void modifyInitialDuplicateState(final Product original, final Product copy, final MultiTenantCopyConteðŸ”µ</abbr></span>
<span class="8648914132537267816" onmouseenter="enter('8648914132537267816');" onmouseout="out('8648914132537267816');" style=""><abbr title="  82          if(context.getCopyHints().get(PROPAGATION)!=null &amp;&amp; &quot;TRUE&quot;.equalsIgnoreCase(context.getCopyHints().get(PROPAGATION))){">  82          if(context.getCopyHints().get(PROPAGATION)!=null &amp;&amp; &quot;TRUE&quot;.equalsIgnoreCase(context.getCopyHints().get(PROðŸ”µ</abbr></span>
<span class="6956233641105045547" onmouseenter="enter('6956233641105045547');" onmouseout="out('6956233641105045547');" style="">  83              for (CategoryProductXref allParentCategoryXref : original.getAllParentCategoryXrefs()) {              </span>
<span class="6518731427589379526" onmouseenter="enter('6518731427589379526');" onmouseout="out('6518731427589379526');" style=""><abbr title="  84                  final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).getClone();">  84                  final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).getCðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style="">  85                  clone.setProduct(copy);                                                                           </span>
<span class="184950461855665097" onmouseenter="enter('184950461855665097');" onmouseout="out('184950461855665097');" style="">  86                  ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHolder&lt;&gt;();   </span>
<span class="-6988054647366021606" onmouseenter="enter('-6988054647366021606');" onmouseout="out('-6988054647366021606');" style="">  87                  Long categoryId = clone.getCategory().getId();                                                    </span>
<span class="1112346227885214257" onmouseenter="enter('1112346227885214257');" onmouseout="out('1112346227885214257');" style="">  88                  extensionManager.getClonesByCatalogs(&quot;BLC_CATEGORY&quot;, categoryId, context, resultHolder);          </span>
<span class="-4208588666663337584" onmouseenter="enter('-4208588666663337584');" onmouseout="out('-4208588666663337584');" style="">  89                  Long aLong = resultHolder.getResult().get(categoryId).get(context.getToCatalog().getId());        </span>
<span class="8933254465875048132" onmouseenter="enter('8933254465875048132');" onmouseout="out('8933254465875048132');" style=""><abbr title="  90                  Category category = (Category) genericEntityService.readGenericEntity(genericEntityService.getCeilingImplClass(CategoryImpl.class.getName()), aLong);">  90                  Category category = (Category) genericEntityService.readGenericEntity(genericEntityService.getCeilðŸ”µ</abbr></span>
<span class="7987400571614512900" onmouseenter="enter('7987400571614512900');" onmouseout="out('7987400571614512900');" style="">  91                  clone.setCategory(category);                                                                      </span>
<span class="-8596829076539712901" onmouseenter="enter('-8596829076539712901');" onmouseout="out('-8596829076539712901');" style="">  92                  copy.getAllParentCategoryXrefs().add(clone);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93              }                                                                                                     </span>
<span class="-1780851162438308290" onmouseenter="enter('-1780851162438308290');" onmouseout="out('-1780851162438308290');" style="">  94              List&lt;ProductOptionXref&gt; productOptionXrefs = new ArrayList&lt;&gt;();                                       </span>
<span class="6272751032386654097" onmouseenter="enter('6272751032386654097');" onmouseout="out('6272751032386654097');" style="">  95              for (ProductOptionXref productOptionXref : original.getProductOptionXrefs()) {                        </span>
<span class="823853853763794990" onmouseenter="enter('823853853763794990');" onmouseout="out('823853853763794990');" style=""><abbr title="  96                  final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getClone();">  96                  final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getClone()ðŸ”µ</abbr></span>
<span class="184950461855665097" onmouseenter="enter('184950461855665097');" onmouseout="out('184950461855665097');" style="">  97                  ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHolder&lt;&gt;();   </span>
<span class="-1545327613104529430" onmouseenter="enter('-1545327613104529430');" onmouseout="out('-1545327613104529430');" style="">  98                  Long optionId = clone.getProductOption().getId();                                                 </span>
<span class="6672244368168956873" onmouseenter="enter('6672244368168956873');" onmouseout="out('6672244368168956873');" style="">  99                  extensionManager.getClonesByCatalogs(&quot;BLC_PRODUCT_OPTION&quot;, optionId, context, resultHolder);      </span>
<span class="6328519375554714191" onmouseenter="enter('6328519375554714191');" onmouseout="out('6328519375554714191');" style=""> 100                  Long aLong = resultHolder.getResult().get(optionId).get(context.getToCatalog().getId());          </span>
<span class="4491220048535300812" onmouseenter="enter('4491220048535300812');" onmouseout="out('4491220048535300812');" style=""><abbr title=" 101                  ProductOption productOption = (ProductOption) genericEntityService.readGenericEntity(genericEntityService.getCeilingImplClass(ProductOptionImpl.class.getName()), aLong);"> 101                  ProductOption productOption = (ProductOption) genericEntityService.readGenericEntity(genericEntityðŸ”µ</abbr></span>
<span class="-7180231804982597632" onmouseenter="enter('-7180231804982597632');" onmouseout="out('-7180231804982597632');" style=""> 102                  clone.setProductOption(productOption);                                                            </span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style=""> 103                  clone.setProduct(copy);                                                                           </span>
<span class="8281820314612240967" onmouseenter="enter('8281820314612240967');" onmouseout="out('8281820314612240967');" style=""> 104                  productOptionXrefs.add(clone);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105              }                                                                                                     </span>
<span class="-1079944092852296738" onmouseenter="enter('-1079944092852296738');" onmouseout="out('-1079944092852296738');" style=""> 106              copy.setProductOptionXrefs(productOptionXrefs);                                                       </span>
<span  style=""> 107                                                                                                                    </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 108          }else {                                                                                                   </span>
<span class="3732538349305505523" onmouseenter="enter('3732538349305505523');" onmouseout="out('3732538349305505523');" style=""> 109              if(!context.getToCatalog().getId().equals(context.getFromCatalog().getId())){                         </span>
<span class="1395859253657604654" onmouseenter="enter('1395859253657604654');" onmouseout="out('1395859253657604654');" style=""> 110                  copy.setAllParentCategoryXrefs(new ArrayList&lt;&gt;());                                                </span>
<span class="5170213168308734345" onmouseenter="enter('5170213168308734345');" onmouseout="out('5170213168308734345');" style=""> 111                  copy.setProductOptionXrefs(new ArrayList&lt;&gt;());                                                    </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 112              }else {                                                                                               </span>
<span class="6956233641105045547" onmouseenter="enter('6956233641105045547');" onmouseout="out('6956233641105045547');" style=""> 113                  for (CategoryProductXref allParentCategoryXref : original.getAllParentCategoryXrefs()) {          </span>
<span class="6518731427589379526" onmouseenter="enter('6518731427589379526');" onmouseout="out('6518731427589379526');" style=""><abbr title=" 114                      final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).getClone();"> 114                      final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).ðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style=""> 115                      clone.setProduct(copy);                                                                       </span>
<span class="-8596829076539712901" onmouseenter="enter('-8596829076539712901');" onmouseout="out('-8596829076539712901');" style=""> 116                      copy.getAllParentCategoryXrefs().add(clone);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117                  }                                                                                                 </span>
<span class="-1780851162438308290" onmouseenter="enter('-1780851162438308290');" onmouseout="out('-1780851162438308290');" style=""> 118                  List&lt;ProductOptionXref&gt; productOptionXrefs = new ArrayList&lt;&gt;();                                   </span>
<span class="6272751032386654097" onmouseenter="enter('6272751032386654097');" onmouseout="out('6272751032386654097');" style=""> 119                  for (ProductOptionXref productOptionXref : original.getProductOptionXrefs()) {                    </span>
<span class="823853853763794990" onmouseenter="enter('823853853763794990');" onmouseout="out('823853853763794990');" style=""><abbr title=" 120                      final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getClone();"> 120                      final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getCloðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style=""> 121                      clone.setProduct(copy);                                                                       </span>
<span class="8281820314612240967" onmouseenter="enter('8281820314612240967');" onmouseout="out('8281820314612240967');" style=""> 122                      productOptionXrefs.add(clone);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123                  }                                                                                                 </span>
<span class="-1079944092852296738" onmouseenter="enter('-1079944092852296738');" onmouseout="out('-1079944092852296738');" style=""> 124                  copy.setProductOptionXrefs(productOptionXrefs);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126          }                                                                                                         </span>
<span class="-4159500731581343573" onmouseenter="enter('-4159500731581343573');" onmouseout="out('-4159500731581343573');" style=""> 127          Calendar instance = Calendar.getInstance();                                                               </span>
<span class="-1463355520464218968" onmouseenter="enter('-1463355520464218968');" onmouseout="out('-1463355520464218968');" style=""> 128          instance.add(Calendar.YEAR, 1);                                                                           </span>
<span class="796889316202561288" onmouseenter="enter('796889316202561288');" onmouseout="out('796889316202561288');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +        instance.set(Calendar.MILLISECOND, 0);                                                                    </span>
<span class="-5080976734564394418" onmouseenter="enter('-5080976734564394418');" onmouseout="out('-5080976734564394418');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +        instance.set(Calendar.SECOND, 0);                                                                         </span>
<span class="-4510309069457560446" onmouseenter="enter('-4510309069457560446');" onmouseout="out('-4510309069457560446');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +        instance.set(Calendar.MINUTE, 0);                                                                         </span>
<span class="6052929848750419807" onmouseenter="enter('6052929848750419807');" onmouseout="out('6052929848750419807');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +        instance.set(Calendar.HOUR, 0);                                                                           </span>
<span class="3399061077188625342" onmouseenter="enter('3399061077188625342');" onmouseout="out('3399061077188625342');" style=""> 133          copy.setActiveStartDate(instance.getTime());                                                              </span>
<span class="6517959846654057962" onmouseenter="enter('6517959846654057962');" onmouseout="out('6517959846654057962');" style=""> 134          copy.setActiveEndDate(null);                                                                              </span>



<span  style=""> 135                                                                                                                    </span>
<span class="-3556686116820053688" onmouseenter="enter('-3556686116820053688');" onmouseout="out('-3556686116820053688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -        setNameAndUrl(copy);                                                                                      </span>
<span class="8433585810021872094" onmouseenter="enter('8433585810021872094');" onmouseout="out('8433585810021872094');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +        setNameAndUrl(copy, context);                                                                             </span>
<span  style=""> 138                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139      }                                                                                                             </span>
<span  style=""> 140                                                                                                                    </span>
<span class="7424065498910823588" onmouseenter="enter('7424065498910823588');" onmouseout="out('7424065498910823588');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 141 -    private void setNameAndUrl(Product copy) {                                                                    </span>
<span class="7494049451365478344" onmouseenter="enter('7494049451365478344');" onmouseout="out('7494049451365478344');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +    protected void setNameAndUrl(Product copy, MultiTenantCopyContext context) {                                  </span>
<span class="-4183917068124784034" onmouseenter="enter('-4183917068124784034');" onmouseout="out('-4183917068124784034');" style=""> 143          String suffix = getCopySuffix();                                                                          </span>
<span class="-1164592558858150214" onmouseenter="enter('-1164592558858150214');" onmouseout="out('-1164592558858150214');" style=""> 144          String name = copy.getName();                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 145 -                                                                                                                  </span>
<span class="7799468414260617041" onmouseenter="enter('7799468414260617041');" onmouseout="out('7799468414260617041');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 146 -        if (name.contains(suffix)) {                                                                              </span>
<span class="-557468731681044400" onmouseenter="enter('-557468731681044400');" onmouseout="out('-557468731681044400');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 147 -            if (name.contains(COPY_NUMBER_SEPARATOR)) {                                                           </span>
<span class="5265091127466895965" onmouseenter="enter('5265091127466895965');" onmouseout="out('5265091127466895965');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -                final String copyNumber = name.split(suffix)[1];                                                  </span>
<span class="3692208177937520781" onmouseenter="enter('3692208177937520781');" onmouseout="out('3692208177937520781');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 149 -                suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1]) + 1);     </span>
<span class="-5019140226346682666" onmouseenter="enter('-5019140226346682666');" onmouseout="out('-5019140226346682666');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +        if(!context.getCopyHints().containsKey(&quot;PROPAGATION&quot;)) {                                                  </span>
<span class="7424479410662112456" onmouseenter="enter('7424479410662112456');" onmouseout="out('7424479410662112456');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +            int index = 0;                                                                                        </span>
<span class="7799468414260617041" onmouseenter="enter('7799468414260617041');" onmouseout="out('7799468414260617041');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +            if (name.contains(suffix)) {                                                                          </span>
<span class="-8819198241730468435" onmouseenter="enter('-8819198241730468435');" onmouseout="out('-8819198241730468435');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +                index = name.indexOf(COPY_NUMBER_SEPARATOR);                                                      </span>
<span class="4448083491101292888" onmouseenter="enter('4448083491101292888');" onmouseout="out('4448083491101292888');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +                if (index &gt; 0) {                                                                                  </span>
<span class="5265091127466895965" onmouseenter="enter('5265091127466895965');" onmouseout="out('5265091127466895965');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +                    final String copyNumber = name.split(suffix)[1];                                              </span>
<span class="3692208177937520781" onmouseenter="enter('3692208177937520781');" onmouseout="out('3692208177937520781');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +                    suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1]) + 1); </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 157 +                } else {                                                                                          </span>
<span class="4910590996512931869" onmouseenter="enter('4910590996512931869');" onmouseout="out('4910590996512931869');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 158 +                    suffix = COPY_NUMBER_SEPARATOR + 1;                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 159 +                }                                                                                                 </span>
<span class="-4626961313859336413" onmouseenter="enter('-4626961313859336413');" onmouseout="out('-4626961313859336413');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +                if(index&gt;0) {                                                                                     </span>
<span class="-1522519490275505250" onmouseenter="enter('-1522519490275505250');" onmouseout="out('-1522519490275505250');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +                    name = name.substring(0, index+1) + suffix;                                                   </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +                }else{                                                                                            </span>
<span class="6766494649896187315" onmouseenter="enter('6766494649896187315');" onmouseout="out('6766494649896187315');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +                    name = name + suffix;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +                }                                                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 165              } else {                                                                                              </span>
<span class="4910590996512931869" onmouseenter="enter('4910590996512931869');" onmouseout="out('4910590996512931869');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -                suffix = COPY_NUMBER_SEPARATOR + 1;                                                               </span>
<span class="6766494649896187315" onmouseenter="enter('6766494649896187315');" onmouseout="out('6766494649896187315');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +                name = name + suffix;                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168              }                                                                                                     </span>
<span class="5961549808481341518" onmouseenter="enter('5961549808481341518');" onmouseout="out('5961549808481341518');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -            name = name.substring(0, name.length() - 1) + suffix;                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 170 -        } else {                                                                                                  </span>
<span class="6766494649896187315" onmouseenter="enter('6766494649896187315');" onmouseout="out('6766494649896187315');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 171 -            name = name + suffix;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172          }                                                                                                         </span>
<span class="9127691374345581935" onmouseenter="enter('9127691374345581935');" onmouseout="out('9127691374345581935');" style=""> 173          copy.setName(name);                                                                                       </span>
<span class="1357636088908081838" onmouseenter="enter('1357636088908081838');" onmouseout="out('1357636088908081838');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -        copy.setUrl(&quot;/&quot; + copy.getName().replace(&quot;-&quot;, &quot;&quot;).replace(&quot; &quot;, &quot;-&quot;).toLowerCase());                       </span>
<span class="3211357851563736968" onmouseenter="enter('3211357851563736968');" onmouseout="out('3211357851563736968');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +        String url = &quot;/&quot; + copy.getName().replace(&quot;-&quot;, &quot;&quot;).replace(&quot; &quot;, &quot;-&quot;).replace(&quot;#&quot;,&quot;_&quot;).toLowerCase();      </span>
<span class="-5292178609617666180" onmouseenter="enter('-5292178609617666180');" onmouseout="out('-5292178609617666180');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 176 +        ExtensionResultStatusType extensionResultStatusType = productUrlDuplicatorExtensionManager.getProxy().modifyUrl(url, copy, new ExtensionResultHolder&lt;&gt;());"> 176 +        ExtensionResultStatusType extensionResultStatusType = productUrlDuplicatorExtensionManager.getProxy().modiðŸ”µ</abbr></span>
<span class="7850961961964313288" onmouseenter="enter('7850961961964313288');" onmouseout="out('7850961961964313288');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +        if(extensionResultStatusType == ExtensionResultStatusType.NOT_HANDLED) {                                  </span>
<span class="6264097036253801080" onmouseenter="enter('6264097036253801080');" onmouseout="out('6264097036253801080');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +            copy.setUrl(url);                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="7283730021202772321" onmouseenter="enter('7283730021202772321');" onmouseout="out('7283730021202772321');" style="">   2   * #%L                                                                                                            </span>
<span class="-5062573030309236877" onmouseenter="enter('-5062573030309236877');" onmouseout="out('-5062573030309236877');" style="">   3   * BroadleafCommerce Framework                                                                                    </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   4   * %%                                                                                                             </span>
<span class="-2825526294831967874" onmouseenter="enter('-2825526294831967874');" onmouseout="out('-2825526294831967874');" style="">   5   * Copyright (C) 2009 - 2021 Broadleaf Commerce                                                                   </span>
<span class="305149960078729975" onmouseenter="enter('305149960078729975');" onmouseout="out('305149960078729975');" style="">   6   * %%                                                                                                             </span>
<span class="4430451662992926684" onmouseenter="enter('4430451662992926684');" onmouseout="out('4430451662992926684');" style="">   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0                                           </span>
<span class="8206099442596739681" onmouseenter="enter('8206099442596739681');" onmouseout="out('8206099442596739681');" style="">   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)             </span>
<span class="-4338570431005413339" onmouseenter="enter('-4338570431005413339');" onmouseout="out('-4338570431005413339');" style="">   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case             </span>
<span class="-5739615313038505012" onmouseenter="enter('-5739615313038505012');" onmouseout="out('-5739615313038505012');" style="">  10   * the Broadleaf End User License Agreement (EULA), Version 1.1                                                   </span>
<span class="-196756316119086558" onmouseenter="enter('-196756316119086558');" onmouseout="out('-196756316119086558');" style="">  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)          </span>
<span class="-3691518077331372763" onmouseenter="enter('-3691518077331372763');" onmouseout="out('-3691518077331372763');" style="">  12   * shall apply.                                                                                                   </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  13   *                                                                                                                </span>
<span class="-3333434530440420199" onmouseenter="enter('-3333434530440420199');" onmouseout="out('-3333434530440420199');" style=""><abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr></span>
<span class="-2556272520656899284" onmouseenter="enter('-2556272520656899284');" onmouseout="out('-2556272520656899284');" style="">  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.</span>
<span class="3739716589509259313" onmouseenter="enter('3739716589509259313');" onmouseout="out('3739716589509259313');" style="">  16   * #L%                                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span class="2215023364393609539" onmouseenter="enter('2215023364393609539');" onmouseout="out('2215023364393609539');" style="">  18  package org.broadleafcommerce.core.catalog.service;                                                               </span>
<span  style="">  19                                                                                                                    </span>
<span class="-5990894140160044043" onmouseenter="enter('-5990894140160044043');" onmouseout="out('-5990894140160044043');" style="">  20  import lombok.SneakyThrows;                                                                                       </span>
<span class="-7920683081016957682" onmouseenter="enter('-7920683081016957682');" onmouseout="out('-7920683081016957682');" style="">  21  import org.broadleafcommerce.common.copy.MultiTenantCloneable;                                                    </span>
<span class="-2722313635088289633" onmouseenter="enter('-2722313635088289633');" onmouseout="out('-2722313635088289633');" style="">  22  import org.broadleafcommerce.common.copy.MultiTenantCopyContext;                                                  </span>
<span class="-7911969485500261220" onmouseenter="enter('-7911969485500261220');" onmouseout="out('-7911969485500261220');" style="">  23  import org.broadleafcommerce.common.extension.ExtensionResultHolder;                                              </span>

<span class="5173114780001024059" onmouseenter="enter('5173114780001024059');" onmouseout="out('5173114780001024059');" style="">  24  import org.broadleafcommerce.common.persistence.AbstractEntityDuplicationHelper;                                  </span>
<span class="-6498279518455725690" onmouseenter="enter('-6498279518455725690');" onmouseout="out('-6498279518455725690');" style="">  25  import org.broadleafcommerce.common.persistence.EntityDuplicatorExtensionManager;                                 </span>
<span class="-1492144387614747576" onmouseenter="enter('-1492144387614747576');" onmouseout="out('-1492144387614747576');" style="">  26  import org.broadleafcommerce.common.service.GenericEntityService;                                                 </span>
<span class="-684463979217480005" onmouseenter="enter('-684463979217480005');" onmouseout="out('-684463979217480005');" style="">  27  import org.broadleafcommerce.core.catalog.domain.Category;                                                        </span>
<span class="4115133761608674822" onmouseenter="enter('4115133761608674822');" onmouseout="out('4115133761608674822');" style="">  28  import org.broadleafcommerce.core.catalog.domain.CategoryImpl;                                                    </span>
<span class="1679321519234537526" onmouseenter="enter('1679321519234537526');" onmouseout="out('1679321519234537526');" style="">  29  import org.broadleafcommerce.core.catalog.domain.CategoryProductXref;                                             </span>
<span class="425392860705941540" onmouseenter="enter('425392860705941540');" onmouseout="out('425392860705941540');" style="">  30  import org.broadleafcommerce.core.catalog.domain.Product;                                                         </span>
<span class="-85811185251521902" onmouseenter="enter('-85811185251521902');" onmouseout="out('-85811185251521902');" style="">  31  import org.broadleafcommerce.core.catalog.domain.ProductImpl;                                                     </span>
<span class="6224071758335975205" onmouseenter="enter('6224071758335975205');" onmouseout="out('6224071758335975205');" style="">  32  import org.broadleafcommerce.core.catalog.domain.ProductOption;                                                   </span>
<span class="-6385470104782105538" onmouseenter="enter('-6385470104782105538');" onmouseout="out('-6385470104782105538');" style="">  33  import org.broadleafcommerce.core.catalog.domain.ProductOptionImpl;                                               </span>
<span class="-1867014672206342142" onmouseenter="enter('-1867014672206342142');" onmouseout="out('-1867014672206342142');" style="">  34  import org.broadleafcommerce.core.catalog.domain.ProductOptionXref;                                               </span>

<span class="-6148326362900055524" onmouseenter="enter('-6148326362900055524');" onmouseout="out('-6148326362900055524');" style="">  35  import org.springframework.beans.factory.annotation.Autowired;                                                    </span>
<span class="2802840430073505079" onmouseenter="enter('2802840430073505079');" onmouseout="out('2802840430073505079');" style="">  36  import org.springframework.core.env.Environment;                                                                  </span>
<span class="8406454220154166073" onmouseenter="enter('8406454220154166073');" onmouseout="out('8406454220154166073');" style="">  37  import org.springframework.stereotype.Component;                                                                  </span>
<span  style="">  38                                                                                                                    </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="">  39  import java.util.ArrayList;                                                                                       </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  40  import java.util.Calendar;                                                                                        </span>
<span class="1748005127055838442" onmouseenter="enter('1748005127055838442');" onmouseout="out('1748005127055838442');" style="">  41  import java.util.Date;                                                                                            </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  42  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  43  import java.util.Map;                                                                                             </span>
<span  style="">  44                                                                                                                    </span>
<span class="-5292076237369528758" onmouseenter="enter('-5292076237369528758');" onmouseout="out('-5292076237369528758');" style="">  45  import javax.annotation.Resource;                                                                                 </span>
<span  style="">  46                                                                                                                    </span>
<span class="-3271663854459851578" onmouseenter="enter('-3271663854459851578');" onmouseout="out('-3271663854459851578');" style="">  47  import static org.broadleafcommerce.common.copy.MultiTenantCopyContext.PROPAGATION;                               </span>
<span  style="">  48                                                                                                                    </span>
<span class="-6917218188848753665" onmouseenter="enter('-6917218188848753665');" onmouseout="out('-6917218188848753665');" style="">  49  @Component(&quot;blProductDuplicateModifier&quot;)                                                                          </span>
<span class="8974675253655953202" onmouseenter="enter('8974675253655953202');" onmouseout="out('8974675253655953202');" style="">  50  public class ProductDuplicateModifier extends AbstractEntityDuplicationHelper&lt;Product&gt; {                          </span>
<span  style="">  51                                                                                                                    </span>
<span class="-8607229485929501191" onmouseenter="enter('-8607229485929501191');" onmouseout="out('-8607229485929501191');" style="">  52      private static final String COPY_NUMBER_SEPARATOR = &quot;#&quot;;                                                      </span>
<span  style="">  53                                                                                                                    </span>
<span class="-4551546742095689549" onmouseenter="enter('-4551546742095689549');" onmouseout="out('-4551546742095689549');" style="">  54      @Resource(name = &quot;blEntityDuplicatorExtensionManager&quot;)                                                        </span>
<span class="3148259255053138984" onmouseenter="enter('3148259255053138984');" onmouseout="out('3148259255053138984');" style="">  55      protected EntityDuplicatorExtensionManager extensionManager;                                                  </span>
<span  style="">  56                                                                                                                    </span>
<span class="2258512980686044159" onmouseenter="enter('2258512980686044159');" onmouseout="out('2258512980686044159');" style="">  57      @Resource(name = &quot;blGenericEntityService&quot;)                                                                    </span>
<span class="7024198528514174971" onmouseenter="enter('7024198528514174971');" onmouseout="out('7024198528514174971');" style="">  58      protected GenericEntityService genericEntityService;                                                          </span>
<span  style="">  59                                                                                                                    </span>



<span class="5554564923016007608" onmouseenter="enter('5554564923016007608');" onmouseout="out('5554564923016007608');" style="">  60      @Autowired                                                                                                    </span>
<span class="6555782048000475693" onmouseenter="enter('6555782048000475693');" onmouseout="out('6555782048000475693');" style="">  61      public ProductDuplicateModifier(final Environment environment) {                                              </span>
<span  style="">  62                                                                                                                    </span>
<span class="7931153115695641156" onmouseenter="enter('7931153115695641156');" onmouseout="out('7931153115695641156');" style="">  63          super(environment);                                                                                       </span>
<span  style="">  64                                                                                                                    </span>
<span class="-8835372487739925673" onmouseenter="enter('-8835372487739925673');" onmouseout="out('-8835372487739925673');" style="">  65          addCopyHint(ProductImpl.EXCLUDE_PRODUCT_CODE_COPY_HINT, Boolean.TRUE.toString());                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  66      }                                                                                                             </span>
<span  style="">  67                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  68      @Override                                                                                                     </span>
<span class="446527456378649796" onmouseenter="enter('446527456378649796');" onmouseout="out('446527456378649796');" style="">  69      public boolean canHandle(final MultiTenantCloneable candidate) {                                              </span>
<span class="-949915953170201414" onmouseenter="enter('-949915953170201414');" onmouseout="out('-949915953170201414');" style="">  70          return Product.class.isAssignableFrom(candidate.getClass());                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  71      }                                                                                                             </span>
<span  style="">  72                                                                                                                    </span>
<span class="-1743236843918612510" onmouseenter="enter('-1743236843918612510');" onmouseout="out('-1743236843918612510');" style="">  73      @SneakyThrows                                                                                                 </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  74      @Override                                                                                                     </span>
<span class="-676822139828809102" onmouseenter="enter('-676822139828809102');" onmouseout="out('-676822139828809102');" style=""><abbr title="  75      public void modifyInitialDuplicateState(final Product original, final Product copy, final MultiTenantCopyContext context) {">  75      public void modifyInitialDuplicateState(final Product original, final Product copy, final MultiTenantCopyConteðŸ”µ</abbr></span>

<span class="8648914132537267816" onmouseenter="enter('8648914132537267816');" onmouseout="out('8648914132537267816');" style=""><abbr title="  76          if(context.getCopyHints().get(PROPAGATION)!=null &amp;&amp; &quot;TRUE&quot;.equalsIgnoreCase(context.getCopyHints().get(PROPAGATION))){">  76          if(context.getCopyHints().get(PROPAGATION)!=null &amp;&amp; &quot;TRUE&quot;.equalsIgnoreCase(context.getCopyHints().get(PROðŸ”µ</abbr></span>
<span class="6956233641105045547" onmouseenter="enter('6956233641105045547');" onmouseout="out('6956233641105045547');" style="">  77              for (CategoryProductXref allParentCategoryXref : original.getAllParentCategoryXrefs()) {              </span>
<span class="6518731427589379526" onmouseenter="enter('6518731427589379526');" onmouseout="out('6518731427589379526');" style=""><abbr title="  78                  final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).getClone();">  78                  final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).getCðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style="">  79                  clone.setProduct(copy);                                                                           </span>
<span class="184950461855665097" onmouseenter="enter('184950461855665097');" onmouseout="out('184950461855665097');" style="">  80                  ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHolder&lt;&gt;();   </span>
<span class="-6988054647366021606" onmouseenter="enter('-6988054647366021606');" onmouseout="out('-6988054647366021606');" style="">  81                  Long categoryId = clone.getCategory().getId();                                                    </span>
<span class="1112346227885214257" onmouseenter="enter('1112346227885214257');" onmouseout="out('1112346227885214257');" style="">  82                  extensionManager.getClonesByCatalogs(&quot;BLC_CATEGORY&quot;, categoryId, context, resultHolder);          </span>
<span class="-4208588666663337584" onmouseenter="enter('-4208588666663337584');" onmouseout="out('-4208588666663337584');" style="">  83                  Long aLong = resultHolder.getResult().get(categoryId).get(context.getToCatalog().getId());        </span>
<span class="8933254465875048132" onmouseenter="enter('8933254465875048132');" onmouseout="out('8933254465875048132');" style=""><abbr title="  84                  Category category = (Category) genericEntityService.readGenericEntity(genericEntityService.getCeilingImplClass(CategoryImpl.class.getName()), aLong);">  84                  Category category = (Category) genericEntityService.readGenericEntity(genericEntityService.getCeilðŸ”µ</abbr></span>
<span class="7987400571614512900" onmouseenter="enter('7987400571614512900');" onmouseout="out('7987400571614512900');" style="">  85                  clone.setCategory(category);                                                                      </span>
<span class="-8596829076539712901" onmouseenter="enter('-8596829076539712901');" onmouseout="out('-8596829076539712901');" style="">  86                  copy.getAllParentCategoryXrefs().add(clone);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87              }                                                                                                     </span>
<span class="-1780851162438308290" onmouseenter="enter('-1780851162438308290');" onmouseout="out('-1780851162438308290');" style="">  88              List&lt;ProductOptionXref&gt; productOptionXrefs = new ArrayList&lt;&gt;();                                       </span>
<span class="6272751032386654097" onmouseenter="enter('6272751032386654097');" onmouseout="out('6272751032386654097');" style="">  89              for (ProductOptionXref productOptionXref : original.getProductOptionXrefs()) {                        </span>
<span class="823853853763794990" onmouseenter="enter('823853853763794990');" onmouseout="out('823853853763794990');" style=""><abbr title="  90                  final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getClone();">  90                  final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getClone()ðŸ”µ</abbr></span>
<span class="184950461855665097" onmouseenter="enter('184950461855665097');" onmouseout="out('184950461855665097');" style="">  91                  ExtensionResultHolder&lt;Map&lt;Long, Map&lt;Long, Long&gt;&gt;&gt; resultHolder = new ExtensionResultHolder&lt;&gt;();   </span>
<span class="-1545327613104529430" onmouseenter="enter('-1545327613104529430');" onmouseout="out('-1545327613104529430');" style="">  92                  Long optionId = clone.getProductOption().getId();                                                 </span>
<span class="6672244368168956873" onmouseenter="enter('6672244368168956873');" onmouseout="out('6672244368168956873');" style="">  93                  extensionManager.getClonesByCatalogs(&quot;BLC_PRODUCT_OPTION&quot;, optionId, context, resultHolder);      </span>
<span class="6328519375554714191" onmouseenter="enter('6328519375554714191');" onmouseout="out('6328519375554714191');" style="">  94                  Long aLong = resultHolder.getResult().get(optionId).get(context.getToCatalog().getId());          </span>
<span class="4491220048535300812" onmouseenter="enter('4491220048535300812');" onmouseout="out('4491220048535300812');" style=""><abbr title="  95                  ProductOption productOption = (ProductOption) genericEntityService.readGenericEntity(genericEntityService.getCeilingImplClass(ProductOptionImpl.class.getName()), aLong);">  95                  ProductOption productOption = (ProductOption) genericEntityService.readGenericEntity(genericEntityðŸ”µ</abbr></span>
<span class="-7180231804982597632" onmouseenter="enter('-7180231804982597632');" onmouseout="out('-7180231804982597632');" style="">  96                  clone.setProductOption(productOption);                                                            </span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style="">  97                  clone.setProduct(copy);                                                                           </span>
<span class="8281820314612240967" onmouseenter="enter('8281820314612240967');" onmouseout="out('8281820314612240967');" style="">  98                  productOptionXrefs.add(clone);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99              }                                                                                                     </span>
<span class="-1079944092852296738" onmouseenter="enter('-1079944092852296738');" onmouseout="out('-1079944092852296738');" style=""> 100              copy.setProductOptionXrefs(productOptionXrefs);                                                       </span>
<span  style=""> 101                                                                                                                    </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 102          }else {                                                                                                   </span>
<span class="3732538349305505523" onmouseenter="enter('3732538349305505523');" onmouseout="out('3732538349305505523');" style=""> 103              if(!context.getToCatalog().getId().equals(context.getFromCatalog().getId())){                         </span>
<span class="1395859253657604654" onmouseenter="enter('1395859253657604654');" onmouseout="out('1395859253657604654');" style=""> 104                  copy.setAllParentCategoryXrefs(new ArrayList&lt;&gt;());                                                </span>
<span class="5170213168308734345" onmouseenter="enter('5170213168308734345');" onmouseout="out('5170213168308734345');" style=""> 105                  copy.setProductOptionXrefs(new ArrayList&lt;&gt;());                                                    </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 106              }else {                                                                                               </span>
<span class="6956233641105045547" onmouseenter="enter('6956233641105045547');" onmouseout="out('6956233641105045547');" style=""> 107                  for (CategoryProductXref allParentCategoryXref : original.getAllParentCategoryXrefs()) {          </span>
<span class="6518731427589379526" onmouseenter="enter('6518731427589379526');" onmouseout="out('6518731427589379526');" style=""><abbr title=" 108                      final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).getClone();"> 108                      final CategoryProductXref clone = allParentCategoryXref.createOrRetrieveCopyInstance(context).ðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style=""> 109                      clone.setProduct(copy);                                                                       </span>
<span class="-8596829076539712901" onmouseenter="enter('-8596829076539712901');" onmouseout="out('-8596829076539712901');" style=""> 110                      copy.getAllParentCategoryXrefs().add(clone);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111                  }                                                                                                 </span>
<span class="-1780851162438308290" onmouseenter="enter('-1780851162438308290');" onmouseout="out('-1780851162438308290');" style=""> 112                  List&lt;ProductOptionXref&gt; productOptionXrefs = new ArrayList&lt;&gt;();                                   </span>
<span class="6272751032386654097" onmouseenter="enter('6272751032386654097');" onmouseout="out('6272751032386654097');" style=""> 113                  for (ProductOptionXref productOptionXref : original.getProductOptionXrefs()) {                    </span>
<span class="823853853763794990" onmouseenter="enter('823853853763794990');" onmouseout="out('823853853763794990');" style=""><abbr title=" 114                      final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getClone();"> 114                      final ProductOptionXref clone = productOptionXref.createOrRetrieveCopyInstance(context).getCloðŸ”µ</abbr></span>
<span class="-8041886317652887736" onmouseenter="enter('-8041886317652887736');" onmouseout="out('-8041886317652887736');" style=""> 115                      clone.setProduct(copy);                                                                       </span>
<span class="8281820314612240967" onmouseenter="enter('8281820314612240967');" onmouseout="out('8281820314612240967');" style=""> 116                      productOptionXrefs.add(clone);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117                  }                                                                                                 </span>
<span class="-1079944092852296738" onmouseenter="enter('-1079944092852296738');" onmouseout="out('-1079944092852296738');" style=""> 118                  copy.setProductOptionXrefs(productOptionXrefs);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120          }                                                                                                         </span>
<span class="-4159500731581343573" onmouseenter="enter('-4159500731581343573');" onmouseout="out('-4159500731581343573');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 121 -        Calendar instance = Calendar.getInstance();                                                               </span>
<span class="-1463355520464218968" onmouseenter="enter('-1463355520464218968');" onmouseout="out('-1463355520464218968');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 122 -        instance.add(Calendar.YEAR, 1);                                                                           </span>




<span class="3399061077188625342" onmouseenter="enter('3399061077188625342');" onmouseout="out('3399061077188625342');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 123 -        copy.setActiveStartDate(instance.getTime());                                                              </span>
<span class="6517959846654057962" onmouseenter="enter('6517959846654057962');" onmouseout="out('6517959846654057962');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 124 -        copy.setActiveEndDate(null);                                                                              </span>
<span class="-2920613297714124185" onmouseenter="enter('-2920613297714124185');" onmouseout="out('-2920613297714124185');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +        final Date currentDate = new Date();                                                                      </span>
<span class="-2589668407157783500" onmouseenter="enter('-2589668407157783500');" onmouseout="out('-2589668407157783500');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +        copy.setActiveStartDate(currentDate);                                                                     </span>
<span class="8090853935057450498" onmouseenter="enter('8090853935057450498');" onmouseout="out('8090853935057450498');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +        copy.setActiveEndDate(currentDate);                                                                       </span>
<span  style=""> 128                                                                                                                    </span>
<span class="-3556686116820053688" onmouseenter="enter('-3556686116820053688');" onmouseout="out('-3556686116820053688');" style=""> 129          setNameAndUrl(copy);                                                                                      </span>

<span  style=""> 130                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131      }                                                                                                             </span>
<span  style=""> 132                                                                                                                    </span>
<span class="7424065498910823588" onmouseenter="enter('7424065498910823588');" onmouseout="out('7424065498910823588');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 133 -    private void setNameAndUrl(Product copy) {                                                                    </span>
<span class="-7168618954374015900" onmouseenter="enter('-7168618954374015900');" onmouseout="out('-7168618954374015900');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 134 +    protected void setNameAndUrl(Product copy) {                                                                  </span>
<span class="-4183917068124784034" onmouseenter="enter('-4183917068124784034');" onmouseout="out('-4183917068124784034');" style=""> 135          String suffix = getCopySuffix();                                                                          </span>
<span class="-1164592558858150214" onmouseenter="enter('-1164592558858150214');" onmouseout="out('-1164592558858150214');" style=""> 136          String name = copy.getName();                                                                             </span>
<span  style=""> 137                                                                                                                    </span>
<span class="7799468414260617041" onmouseenter="enter('7799468414260617041');" onmouseout="out('7799468414260617041');" style=""> 138          if (name.contains(suffix)) {                                                                              </span>
<span class="-557468731681044400" onmouseenter="enter('-557468731681044400');" onmouseout="out('-557468731681044400');" style=""> 139              if (name.contains(COPY_NUMBER_SEPARATOR)) {                                                           </span>
<span class="5265091127466895965" onmouseenter="enter('5265091127466895965');" onmouseout="out('5265091127466895965');" style=""> 140                  final String copyNumber = name.split(suffix)[1];                                                  </span>
<span class="3692208177937520781" onmouseenter="enter('3692208177937520781');" onmouseout="out('3692208177937520781');" style=""> 141                  suffix = String.format(&quot;%d&quot;, Long.parseLong(copyNumber.split(COPY_NUMBER_SEPARATOR)[1]) + 1);     </span>















<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 142              } else {                                                                                              </span>
<span class="4910590996512931869" onmouseenter="enter('4910590996512931869');" onmouseout="out('4910590996512931869');" style=""> 143                  suffix = COPY_NUMBER_SEPARATOR + 1;                                                               </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144              }                                                                                                     </span>
<span class="5961549808481341518" onmouseenter="enter('5961549808481341518');" onmouseout="out('5961549808481341518');" style=""> 145              name = name.substring(0, name.length() - 1) + suffix;                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 146          } else {                                                                                                  </span>
<span class="6766494649896187315" onmouseenter="enter('6766494649896187315');" onmouseout="out('6766494649896187315');" style=""> 147              name = name + suffix;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148          }                                                                                                         </span>
<span class="9127691374345581935" onmouseenter="enter('9127691374345581935');" onmouseout="out('9127691374345581935');" style=""> 149          copy.setName(name);                                                                                       </span>
<span class="1357636088908081838" onmouseenter="enter('1357636088908081838');" onmouseout="out('1357636088908081838');" style=""> 150          copy.setUrl(&quot;/&quot; + copy.getName().replace(&quot;-&quot;, &quot;&quot;).replace(&quot; &quot;, &quot;-&quot;).toLowerCase());                       </span>





<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            