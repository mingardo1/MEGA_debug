<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>5</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    5
                    <a href="4.html">prev</a>
                    <a href="6.html">next</a>
                    <a href="5_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_102d3ba0f641e26d0a6e82b0506f600ea40244dd_HttpComponent/src/main/java/com/arialyy/aria/http/HttpFileInfoThread.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;102d3ba0f641e26d0a6e82b0506f600ea40244dd:HttpComponent/src/main/java/com/arialyy/aria/http/HttpFileInfoThread.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;102d3ba0f641e26d0a6e82b0506f600ea40244dd^1:HttpComponent/src/main/java/com/arialyy/aria/http/HttpFileInfoThread.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;102d3ba0f641e26d0a6e82b0506f600ea40244dd^2:HttpComponent/src/main/java/com/arialyy/aria/http/HttpFileInfoThread.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;0cb5d3e68461842509c569f76610654b8d5e6298:HttpComponent/src/main/java/com/arialyy/aria/http/HttpFileInfoThread.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bsj]], subset: [[bsj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">   2 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17  */                                                                                                      </span>
<span class="-7236899369024788297" onmouseenter="enter('-7236899369024788297');" onmouseout="out('-7236899369024788297');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 package com.arialyy.aria.http;                                                                           </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19                                                                                                          </span>
<span class="-6390350725830347024" onmouseenter="enter('-6390350725830347024');" onmouseout="out('-6390350725830347024');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 import android.net.TrafficStats;                                                                         </span>
<span class="-8750621697125156872" onmouseenter="enter('-8750621697125156872');" onmouseout="out('-8750621697125156872');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import android.net.Uri;                                                                                  </span>
<span class="3485143652294101472" onmouseenter="enter('3485143652294101472');" onmouseout="out('3485143652294101472');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import android.os.Process;                                                                               </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import android.text.TextUtils;                                                                           </span>
<span class="8153369258057528270" onmouseenter="enter('8153369258057528270');" onmouseout="out('8153369258057528270');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import com.arialyy.aria.core.AriaConfig;                                                                 </span>
<span class="5028823532254250595" onmouseenter="enter('5028823532254250595');" onmouseout="out('5028823532254250595');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import com.arialyy.aria.core.common.CompleteInfo;                                                        </span>
<span class="7716102167634407665" onmouseenter="enter('7716102167634407665');" onmouseout="out('7716102167634407665');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import com.arialyy.aria.core.common.RequestEnum;                                                         </span>
<span class="-3497740022528182602" onmouseenter="enter('-3497740022528182602');" onmouseout="out('-3497740022528182602');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import com.arialyy.aria.core.download.DTaskWrapper;                                                      </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import com.arialyy.aria.core.download.DownloadEntity;                                                    </span>
<span class="-5825121975347398532" onmouseenter="enter('-5825121975347398532');" onmouseout="out('-5825121975347398532');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import com.arialyy.aria.core.inf.OnFileInfoCallback;                                                     </span>
<span class="-5191825800443458517" onmouseenter="enter('-5191825800443458517');" onmouseout="out('-5191825800443458517');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import com.arialyy.aria.core.processor.IHttpFileLenAdapter;                                              </span>
<span class="6359380642632041098" onmouseenter="enter('6359380642632041098');" onmouseout="out('6359380642632041098');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import com.arialyy.aria.exception.AriaIOException;                                                       </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import com.arialyy.aria.exception.BaseException;                                                         </span>
<span class="-5001091348570971924" onmouseenter="enter('-5001091348570971924');" onmouseout="out('-5001091348570971924');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import com.arialyy.aria.exception.TaskException;                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import com.arialyy.aria.util.CheckUtil;                                                                  </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import com.arialyy.aria.util.FileUtil;                                                                   </span>
<span class="-969957896094278671" onmouseenter="enter('-969957896094278671');" onmouseout="out('-969957896094278671');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 import com.arialyy.aria.util.RecordUtil;                                                                 </span>
<span class="-4738630423427876475" onmouseenter="enter('-4738630423427876475');" onmouseout="out('-4738630423427876475');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39 import java.io.BufferedReader;                                                                           </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 import java.io.IOException;                                                                              </span>
<span class="-5152338856474932575" onmouseenter="enter('-5152338856474932575');" onmouseout="out('-5152338856474932575');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42 import java.io.InputStreamReader;                                                                        </span>
<span class="3835172898968420800" onmouseenter="enter('3835172898968420800');" onmouseout="out('3835172898968420800');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43 import java.io.OutputStreamWriter;                                                                       </span>
<span class="8256805395213692609" onmouseenter="enter('8256805395213692609');" onmouseout="out('8256805395213692609');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44 import java.io.UnsupportedEncodingException;                                                             </span>
<span class="7759739624588802903" onmouseenter="enter('7759739624588802903');" onmouseout="out('7759739624588802903');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45 import java.net.CookieManager;                                                                           </span>
<span class="-5584619311424941805" onmouseenter="enter('-5584619311424941805');" onmouseout="out('-5584619311424941805');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46 import java.net.HttpCookie;                                                                              </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 import java.net.URL;                                                                                     </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 import java.net.URLDecoder;                                                                              </span>
<span class="302463665162759210" onmouseenter="enter('302463665162759210');" onmouseout="out('302463665162759210');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 import java.net.URLEncoder;                                                                              </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53 import java.util.Set;                                                                                    </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54 import java.util.UUID;                                                                                   </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56 /**                                                                                                      </span>
<span class="-1733864505168931106" onmouseenter="enter('-1733864505168931106');" onmouseout="out('-1733864505168931106');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57  * 下载文件信息获取                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58  */                                                                                                      </span>
<span class="-8507874378969942466" onmouseenter="enter('-8507874378969942466');" onmouseout="out('-8507874378969942466');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 public class HttpFileInfoThread implements Runnable {                                                    </span>
<span class="-960543327724144855" onmouseenter="enter('-960543327724144855');" onmouseout="out('-960543327724144855');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60   private static final String TAG = &quot;HttpFileInfoThread&quot;;                                                </span>
<span class="-7151375780097547664" onmouseenter="enter('-7151375780097547664');" onmouseout="out('-7151375780097547664');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61   private DownloadEntity mEntity;                                                                        </span>
<span class="-3857309927385466618" onmouseenter="enter('-3857309927385466618');" onmouseout="out('-3857309927385466618');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62   private DTaskWrapper mTaskWrapper;                                                                     </span>
<span class="8600882525060240313" onmouseenter="enter('8600882525060240313');" onmouseout="out('8600882525060240313');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63   private int mConnectTimeOut;                                                                           </span>
<span class="-6824755283282820235" onmouseenter="enter('-6824755283282820235');" onmouseout="out('-6824755283282820235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64   private OnFileInfoCallback onFileInfoCallback;                                                         </span>
<span class="6827268874849985533" onmouseenter="enter('6827268874849985533');" onmouseout="out('6827268874849985533');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65   private HttpTaskOption taskOption;                                                                     </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66                                                                                                          </span>
<span class="-5652336240759927020" onmouseenter="enter('-5652336240759927020');" onmouseout="out('-5652336240759927020');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67   public HttpFileInfoThread(DTaskWrapper taskWrapper, OnFileInfoCallback callback) {                     </span>
<span class="-3805550036651318371" onmouseenter="enter('-3805550036651318371');" onmouseout="out('-3805550036651318371');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68     this.mTaskWrapper = taskWrapper;                                                                     </span>
<span class="-170355754520114419" onmouseenter="enter('-170355754520114419');" onmouseout="out('-170355754520114419');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69     mEntity = taskWrapper.getEntity();                                                                   </span>
<span class="2572452400414830057" onmouseenter="enter('2572452400414830057');" onmouseout="out('2572452400414830057');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70     mConnectTimeOut = AriaConfig.getInstance().getDConfig().getConnectTimeOut();                         </span>
<span class="1217537359294132674" onmouseenter="enter('1217537359294132674');" onmouseout="out('1217537359294132674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71     onFileInfoCallback = callback;                                                                       </span>
<span class="6933673676495207920" onmouseenter="enter('6933673676495207920');" onmouseout="out('6933673676495207920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72     taskOption = (HttpTaskOption) taskWrapper.getTaskOption();                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75   @Override public void run() {                                                                          </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76     Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                       </span>
<span class="-1851318291295515457" onmouseenter="enter('-1851318291295515457');" onmouseout="out('-1851318291295515457');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77     TrafficStats.setThreadStatsTag(UUID.randomUUID().toString().hashCode());                             </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78     HttpURLConnection conn = null;                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79     try {                                                                                                </span>
<span class="7954771811613007401" onmouseenter="enter('7954771811613007401');" onmouseout="out('7954771811613007401');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80       URL url = ConnectionHelp.handleUrl(mEntity.getUrl(), taskOption);                                  </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81       conn = ConnectionHelp.handleConnection(url, taskOption);                                           </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82       ConnectionHelp.setConnectParam(taskOption, conn);                                                  </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83       conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                              </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84       conn.setConnectTimeout(mConnectTimeOut);                                                           </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85       conn.connect();                                                                                    </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86       handleConnect(conn);                                                                               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87     } catch (IOException e) {                                                                            </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88       e.printStackTrace();                                                                               </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="-4053293382299681633" onmouseenter="enter('-4053293382299681633');" onmouseout="out('-4053293382299681633');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90               String.format(&quot;下载失败，filePath: %s, url: %s&quot;, mEntity.getDownloadPath(), mEntity.getUrl())), </span>
<span class="-159362617709534437" onmouseenter="enter('-159362617709534437');" onmouseout="out('-159362617709534437');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91           true);                                                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92     } finally {                                                                                          </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93       if (conn != null) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94         try {                                                                                            </span>
<span class="-8686251500819757648" onmouseenter="enter('-8686251500819757648');" onmouseout="out('-8686251500819757648');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95           conn.getInputStream().close();                                                                 </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96         } catch (IOException e) {                                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97           e.printStackTrace();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98         }                                                                                                </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99         conn.disconnect();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103                                                                                                          </span>
<span class="7469915187822843170" onmouseenter="enter('7469915187822843170');" onmouseout="out('7469915187822843170');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104   private void handleConnect(HttpURLConnection conn) throws IOException {                                </span>
<span class="-5135480308665977678" onmouseenter="enter('-5135480308665977678');" onmouseout="out('-5135480308665977678');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105     if (taskOption.getRequestEnum() == RequestEnum.POST) {                                               </span>
<span class="-5476217355085156421" onmouseenter="enter('-5476217355085156421');" onmouseout="out('-5476217355085156421');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106       Map&lt;String, String&gt; params = taskOption.getParams();                                               </span>
<span class="3157859291963549592" onmouseenter="enter('3157859291963549592');" onmouseout="out('3157859291963549592');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107       if (params != null) {                                                                              </span>
<span class="1177673060067921781" onmouseenter="enter('1177673060067921781');" onmouseout="out('1177673060067921781');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         OutputStreamWriter dos = new OutputStreamWriter(conn.getOutputStream());                         </span>
<span class="-2461846026114443284" onmouseenter="enter('-2461846026114443284');" onmouseout="out('-2461846026114443284');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109         Set&lt;String&gt; keys = params.keySet();                                                              </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111         for (String key : keys) {                                                                        </span>
<span class="-378086891984466400" onmouseenter="enter('-378086891984466400');" onmouseout="out('-378086891984466400');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112           sb.append(key).append(&quot;=&quot;).append(URLEncoder.encode(params.get(key))).append(&quot;&amp;&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113         }                                                                                                </span>
<span class="-1170631941621929173" onmouseenter="enter('-1170631941621929173');" onmouseout="out('-1170631941621929173');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114         String url = sb.toString();                                                                      </span>
<span class="-2854610904289092260" onmouseenter="enter('-2854610904289092260');" onmouseout="out('-2854610904289092260');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115         url = url.substring(0, url.length() - 1);                                                        </span>
<span class="-412821746973687146" onmouseenter="enter('-412821746973687146');" onmouseout="out('-412821746973687146');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116         dos.write(url);                                                                                  </span>
<span class="-6320099346663956498" onmouseenter="enter('-6320099346663956498');" onmouseout="out('-6320099346663956498');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117         dos.flush();                                                                                     </span>
<span class="1568727060082909957" onmouseenter="enter('1568727060082909957');" onmouseout="out('1568727060082909957');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118         dos.close();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121                                                                                                          </span>
<span class="831227310872116523" onmouseenter="enter('831227310872116523');" onmouseout="out('831227310872116523');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122     IHttpFileLenAdapter lenAdapter = taskOption.getFileLenAdapter();                                     </span>
<span class="5196440776228873073" onmouseenter="enter('5196440776228873073');" onmouseout="out('5196440776228873073');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123     if (lenAdapter == null) {                                                                            </span>
<span class="7197457532950740585" onmouseenter="enter('7197457532950740585');" onmouseout="out('7197457532950740585');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124       lenAdapter = new FileLenAdapter();                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125     } else {                                                                                             </span>
<span class="-2288407285072363665" onmouseenter="enter('-2288407285072363665');" onmouseout="out('-2288407285072363665');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126       ALog.d(TAG, &quot;使用自定义adapter&quot;);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127     }                                                                                                    </span>
<span class="-3117441631991498996" onmouseenter="enter('-3117441631991498996');" onmouseout="out('-3117441631991498996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128     long len = lenAdapter.handleFileLen(conn.getHeaderFields());                                         </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129                                                                                                          </span>
<span class="-1607077255181731471" onmouseenter="enter('-1607077255181731471');" onmouseout="out('-1607077255181731471');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130     if (!FileUtil.checkSDMemorySpace(mEntity.getFilePath(), len)) {                                      </span>
<span class="-1675602595326094546" onmouseenter="enter('-1675602595326094546');" onmouseout="out('-1675602595326094546');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131       failDownload(new TaskException(TAG,                                                                </span>
<span class="380344701162823709" onmouseenter="enter('380344701162823709');" onmouseout="out('380344701162823709');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132           String.format(&quot;下载失败，内存空间不足；filePath: %s, url: %s&quot;, mEntity.getDownloadPath(),                  </span>
<span class="3748007250659926415" onmouseenter="enter('3748007250659926415');" onmouseout="out('3748007250659926415');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133               mEntity.getUrl())), false);                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136                                                                                                          </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137     int code = conn.getResponseCode();                                                                   </span>
<span class="243612440262257064" onmouseenter="enter('243612440262257064');" onmouseout="out('243612440262257064');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138     boolean end = false;                                                                                 </span>
<span class="3661527496298260626" onmouseenter="enter('3661527496298260626');" onmouseout="out('3661527496298260626');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139     if (TextUtils.isEmpty(mEntity.getMd5Code())) {                                                       </span>
<span class="6175847651720741920" onmouseenter="enter('6175847651720741920');" onmouseout="out('6175847651720741920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140       String md5Code = conn.getHeaderField(&quot;Content-MD5&quot;);                                               </span>
<span class="3841984198412482104" onmouseenter="enter('3841984198412482104');" onmouseout="out('3841984198412482104');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141       mEntity.setMd5Code(md5Code);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143                                                                                                          </span>
<span class="-9137345962727529427" onmouseenter="enter('-9137345962727529427');" onmouseout="out('-9137345962727529427');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144     boolean isChunked = false;                                                                           </span>
<span class="-8116968388415792268" onmouseenter="enter('-8116968388415792268');" onmouseout="out('-8116968388415792268');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145     final String str = conn.getHeaderField(&quot;Transfer-Encoding&quot;);                                         </span>
<span class="-6629832129461298046" onmouseenter="enter('-6629832129461298046');" onmouseout="out('-6629832129461298046');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146     if (!TextUtils.isEmpty(str) &amp;&amp; str.equals(&quot;chunked&quot;)) {                                              </span>
<span class="268583664719475207" onmouseenter="enter('268583664719475207');" onmouseout="out('268583664719475207');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147       isChunked = true;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148     }                                                                                                    </span>
<span class="8180254556269969385" onmouseenter="enter('8180254556269969385');" onmouseout="out('8180254556269969385');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149     Map&lt;String, List&lt;String&gt;&gt; headers = conn.getHeaderFields();                                          </span>
<span class="8122923533236748969" onmouseenter="enter('8122923533236748969');" onmouseout="out('8122923533236748969');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150     String disposition = conn.getHeaderField(&quot;Content-Disposition&quot;);                                     </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151                                                                                                          </span>
<span class="-3052400857632215863" onmouseenter="enter('-3052400857632215863');" onmouseout="out('-3052400857632215863');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152     if (taskOption.isUseServerFileName()) {                                                              </span>
<span class="9149723838126995721" onmouseenter="enter('9149723838126995721');" onmouseout="out('9149723838126995721');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153       if (!TextUtils.isEmpty(disposition)) {                                                             </span>
<span class="3142217124074067362" onmouseenter="enter('3142217124074067362');" onmouseout="out('3142217124074067362');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154         mEntity.setDisposition(CommonUtil.encryptBASE64(disposition));                                   </span>
<span class="8894179749774343207" onmouseenter="enter('8894179749774343207');" onmouseout="out('8894179749774343207');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155         handleContentDisposition(disposition);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156       } else {                                                                                           </span>
<span class="6725831659311340657" onmouseenter="enter('6725831659311340657');" onmouseout="out('6725831659311340657');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157         ALog.w(TAG, &quot;Content-Disposition对于端字段为空，使用服务器端文件名失败&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159     }                                                                                                    </span>
<span class="3131612029960887116" onmouseenter="enter('3131612029960887116');" onmouseout="out('3131612029960887116');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160     CookieManager msCookieManager = new CookieManager();                                                 </span>
<span class="6317541366742429029" onmouseenter="enter('6317541366742429029');" onmouseout="out('6317541366742429029');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161     List&lt;String&gt; cookiesHeader = headers.get(&quot;Set-Cookie&quot;);                                              </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162                                                                                                          </span>
<span class="-3711800334805746628" onmouseenter="enter('-3711800334805746628');" onmouseout="out('-3711800334805746628');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163     if (cookiesHeader != null) {                                                                         </span>
<span class="50137583020384401" onmouseenter="enter('50137583020384401');" onmouseout="out('50137583020384401');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164       for (String cookie : cookiesHeader) {                                                              </span>
<span class="-5052850978727150914" onmouseenter="enter('-5052850978727150914');" onmouseout="out('-5052850978727150914');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165         msCookieManager.getCookieStore().add(null, HttpCookie.parse(cookie).get(0));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166       }                                                                                                  </span>
<span class="-6061807114007929519" onmouseenter="enter('-6061807114007929519');" onmouseout="out('-6061807114007929519');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167       taskOption.setCookieManager(msCookieManager);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169                                                                                                          </span>
<span class="-5434227081099310624" onmouseenter="enter('-5434227081099310624');" onmouseout="out('-5434227081099310624');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170     mTaskWrapper.setCode(code);                                                                          </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171     if (code == HttpURLConnection.HTTP_PARTIAL) {                                                        </span>
<span class="3476352595280537016" onmouseenter="enter('3476352595280537016');" onmouseout="out('3476352595280537016');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172       if (!checkLen(len) &amp;&amp; !isChunked) {                                                                </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173         if (len &lt; 0) {                                                                                   </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174           failDownload(                                                                                  </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175               new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),      </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176               false);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177         }                                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179       }                                                                                                  </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180       mEntity.setFileSize(len);                                                                          </span>
<span class="4333195157428278321" onmouseenter="enter('4333195157428278321');" onmouseout="out('4333195157428278321');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181       mTaskWrapper.setSupportBP(true);                                                                   </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182       end = true;                                                                                        </span>
<span class="2496770639447193327" onmouseenter="enter('2496770639447193327');" onmouseout="out('2496770639447193327');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183     } else if (code == HttpURLConnection.HTTP_OK) {                                                      </span>
<span class="-998567010505343674" onmouseenter="enter('-998567010505343674');" onmouseout="out('-998567010505343674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184       String contentType = conn.getHeaderField(&quot;Content-Type&quot;);                                          </span>
<span class="201076292918755336" onmouseenter="enter('201076292918755336');" onmouseout="out('201076292918755336');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185       if (TextUtils.isEmpty(contentType)) {                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187       }                                                                                                  </span>
<span class="8927907009918172915" onmouseenter="enter('8927907009918172915');" onmouseout="out('8927907009918172915');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188       if (contentType.equals(&quot;text/html&quot;)) {                                                             </span>
<span class="8342413994542158594" onmouseenter="enter('8342413994542158594');" onmouseout="out('8342413994542158594');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189         BufferedReader reader =                                                                          </span>
<span class="-7427210485489972460" onmouseenter="enter('-7427210485489972460');" onmouseout="out('-7427210485489972460');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190             new BufferedReader(new InputStreamReader(ConnectionHelp.convertInputStream(conn)));          </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="6431556981547329060" onmouseenter="enter('6431556981547329060');" onmouseout="out('6431556981547329060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192         String line;                                                                                     </span>
<span class="4058321022246549205" onmouseenter="enter('4058321022246549205');" onmouseout="out('4058321022246549205');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193         while ((line = reader.readLine()) != null) {                                                     </span>
<span class="-6213624305830265937" onmouseenter="enter('-6213624305830265937');" onmouseout="out('-6213624305830265937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194           sb.append(line);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195         }                                                                                                </span>
<span class="8277398435538005537" onmouseenter="enter('8277398435538005537');" onmouseout="out('8277398435538005537');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196         reader.close();                                                                                  </span>
<span class="8311106050401029529" onmouseenter="enter('8311106050401029529');" onmouseout="out('8311106050401029529');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197         handleUrlReTurn(conn, CommonUtil.getWindowReplaceUrl(sb.toString()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198         return;                                                                                          </span>
<span class="-4432363278840297326" onmouseenter="enter('-4432363278840297326');" onmouseout="out('-4432363278840297326');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199       } else if (!checkLen(len) &amp;&amp; !isChunked) {                                                         </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200         if (len &lt; 0) {                                                                                   </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201           failDownload(                                                                                  </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202               new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),      </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203               false);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204         }                                                                                                </span>
<span class="1925321240779458317" onmouseenter="enter('1925321240779458317');" onmouseout="out('1925321240779458317');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205         ALog.d(TAG, &quot;len &lt; 0&quot;);                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207       }                                                                                                  </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208       mEntity.setFileSize(len);                                                                          </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209       mTaskWrapper.setNewTask(true);                                                                     </span>
<span class="9157524552034725227" onmouseenter="enter('9157524552034725227');" onmouseout="out('9157524552034725227');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210       mTaskWrapper.setSupportBP(false);                                                                  </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211       end = true;                                                                                        </span>
<span class="1848064821034278655" onmouseenter="enter('1848064821034278655');" onmouseout="out('1848064821034278655');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212     } else if (code == HttpURLConnection.HTTP_NOT_FOUND) {                                               </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="-2250251533714311872" onmouseenter="enter('-2250251533714311872');" onmouseout="out('-2250251533714311872');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214           String.format(&quot;任务下载失败，errorCode：404, url: %s&quot;, mEntity.getUrl())), true);                      </span>
<span class="7269465454949275689" onmouseenter="enter('7269465454949275689');" onmouseout="out('7269465454949275689');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215     } else if (code == HttpURLConnection.HTTP_MOVED_TEMP                                                 </span>
<span class="-6032747441450584852" onmouseenter="enter('-6032747441450584852');" onmouseout="out('-6032747441450584852');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216         || code == HttpURLConnection.HTTP_MOVED_PERM                                                     </span>
<span class="6529484345882801441" onmouseenter="enter('6529484345882801441');" onmouseout="out('6529484345882801441');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217         || code == HttpURLConnection.HTTP_SEE_OTHER                                                      </span>
<span class="-5614885484106173463" onmouseenter="enter('-5614885484106173463');" onmouseout="out('-5614885484106173463');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218         || code == HttpURLConnection.HTTP_CREATED // 201 跳转                                              </span>
<span class="-1964089336962903701" onmouseenter="enter('-1964089336962903701');" onmouseout="out('-1964089336962903701');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219         || code == 307) {                                                                                </span>
<span class="582471876420463974" onmouseenter="enter('582471876420463974');" onmouseout="out('582471876420463974');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220       handleUrlReTurn(conn, conn.getHeaderField(&quot;Location&quot;));                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221     } else {                                                                                             </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="3458281120857355945" onmouseenter="enter('3458281120857355945');" onmouseout="out('3458281120857355945');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223           String.format(&quot;任务下载失败，errorCode：%s, errorMsg: %s, url: %s&quot;, code,                              </span>
<span class="-865670794746359823" onmouseenter="enter('-865670794746359823');" onmouseout="out('-865670794746359823');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224               conn.getResponseMessage(), mEntity.getUrl())), !CheckUtil.httpIsBadRequest(code));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225     }                                                                                                    </span>
<span class="-6801527756571482213" onmouseenter="enter('-6801527756571482213');" onmouseout="out('-6801527756571482213');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226     if (end) {                                                                                           </span>
<span class="-9049555213483660293" onmouseenter="enter('-9049555213483660293');" onmouseout="out('-9049555213483660293');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227       taskOption.setChunked(isChunked);                                                                  </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228       if (onFileInfoCallback != null) {                                                                  </span>
<span class="-3029323004951684182" onmouseenter="enter('-3029323004951684182');" onmouseout="out('-3029323004951684182');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229         CompleteInfo info = new CompleteInfo(code, mTaskWrapper);                                        </span>
<span class="1239392088731349048" onmouseenter="enter('1239392088731349048');" onmouseout="out('1239392088731349048');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230         onFileInfoCallback.onComplete(mEntity.getUrl(), info);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231       }                                                                                                  </span>
<span class="-2332174823472847291" onmouseenter="enter('-2332174823472847291');" onmouseout="out('-2332174823472847291');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232       mEntity.update();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236   /**                                                                                                    </span>
<span class="-2847240885661455178" onmouseenter="enter('-2847240885661455178');" onmouseout="out('-2847240885661455178');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237    * 处理&quot;Content-Disposition&quot;参数                                                                           </span>
<span class="8881865652474859794" onmouseenter="enter('8881865652474859794');" onmouseout="out('8881865652474859794');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238    * &lt;a href=https://cloud.tencent.com/developer/section/1189916&gt;Content-Disposition&lt;/a&gt;&lt;/&gt;              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239    *                                                                                                     </span>
<span class="-7776712758593145643" onmouseenter="enter('-7776712758593145643');" onmouseout="out('-7776712758593145643');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240    * @throws UnsupportedEncodingException                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241    */                                                                                                    </span>
<span class="-8608321373459550338" onmouseenter="enter('-8608321373459550338');" onmouseout="out('-8608321373459550338');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242   private void handleContentDisposition(String disposition) throws UnsupportedEncodingException {        </span>
<span class="8299914696584334305" onmouseenter="enter('8299914696584334305');" onmouseout="out('8299914696584334305');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243     if (disposition.contains(&quot;;&quot;)) {                                                                     </span>
<span class="-8249279439551045927" onmouseenter="enter('-8249279439551045927');" onmouseout="out('-8249279439551045927');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244       String[] infos = disposition.split(&quot;;&quot;);                                                           </span>
<span class="2055683922126838823" onmouseenter="enter('2055683922126838823');" onmouseout="out('2055683922126838823');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245       if (infos[0].equals(&quot;attachment&quot;)) {                                                               </span>
<span class="-6108489956922562466" onmouseenter="enter('-6108489956922562466');" onmouseout="out('-6108489956922562466');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246         for (String info : infos) {                                                                      </span>
<span class="-3445363461731907777" onmouseenter="enter('-3445363461731907777');" onmouseout="out('-3445363461731907777');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247           if (info.startsWith(&quot;filename&quot;) &amp;&amp; info.contains(&quot;=&quot;)) {                                       </span>
<span class="3695771658612668290" onmouseenter="enter('3695771658612668290');" onmouseout="out('3695771658612668290');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248             String[] temp = info.split(&quot;=&quot;);                                                             </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249             if (temp.length &gt; 1) {                                                                       </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250               String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                 </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251               mEntity.setServerFileName(newName);                                                        </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252               renameFile(newName);                                                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253               break;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256         }                                                                                                </span>
<span class="6794164660951287492" onmouseenter="enter('6794164660951287492');" onmouseout="out('6794164660951287492');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257       } else if (infos[0].equals(&quot;form-data&quot;) &amp;&amp; infos.length &gt; 2) {                                     </span>
<span class="-8905252974632201641" onmouseenter="enter('-8905252974632201641');" onmouseout="out('-8905252974632201641');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258         String[] temp = infos[2].split(&quot;=&quot;);                                                             </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259         if (temp.length &gt; 1) {                                                                           </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260           String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                     </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261           mEntity.setServerFileName(newName);                                                            </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262           renameFile(newName);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264       } else {                                                                                           </span>
<span class="7479053829749492027" onmouseenter="enter('7479053829749492027');" onmouseout="out('7479053829749492027');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265         ALog.w(TAG, &quot;不识别的Content-Disposition参数&quot;);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270   /**                                                                                                    </span>
<span class="-5538524699876672002" onmouseenter="enter('-5538524699876672002');" onmouseout="out('-5538524699876672002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271    * 重命名文件                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272    */                                                                                                    </span>
<span class="-7899950182898562290" onmouseenter="enter('-7899950182898562290');" onmouseout="out('-7899950182898562290');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273   private void renameFile(String newName) {                                                              </span>
<span class="4040095654750429587" onmouseenter="enter('4040095654750429587');" onmouseout="out('4040095654750429587');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274     if (TextUtils.isEmpty(newName)) {                                                                    </span>
<span class="7746921739080291575" onmouseenter="enter('7746921739080291575');" onmouseout="out('7746921739080291575');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275       ALog.w(TAG, &quot;重命名失败【服务器返回的文件名为空】&quot;);                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277     }                                                                                                    </span>
<span class="-897821573073116237" onmouseenter="enter('-897821573073116237');" onmouseout="out('-897821573073116237');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278     ALog.d(TAG, String.format(&quot;文件重命名为：%s&quot;, newName));                                                    </span>
<span class="3112348380249890188" onmouseenter="enter('3112348380249890188');" onmouseout="out('3112348380249890188');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279     File oldFile = new File(mEntity.getFilePath());                                                      </span>
<span class="6384479286325830175" onmouseenter="enter('6384479286325830175');" onmouseout="out('6384479286325830175');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280     String newPath = oldFile.getParent() + &quot;/&quot; + newName;                                                </span>
<span class="-8664365027300439044" onmouseenter="enter('-8664365027300439044');" onmouseout="out('-8664365027300439044');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281     if (oldFile.exists()) {                                                                              </span>
<span class="-2839507751750912779" onmouseenter="enter('-2839507751750912779');" onmouseout="out('-2839507751750912779');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282       boolean b = oldFile.renameTo(new File(newPath));                                                   </span>
<span class="1440136229140496041" onmouseenter="enter('1440136229140496041');" onmouseout="out('1440136229140496041');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283       ALog.d(TAG, String.format(&quot;文件重命名%s&quot;, b ? &quot;成功&quot; : &quot;失败&quot;));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284     }                                                                                                    </span>
<span class="-3962615333140495301" onmouseenter="enter('-3962615333140495301');" onmouseout="out('-3962615333140495301');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285     mEntity.setFileName(newName);                                                                        </span>
<span class="5260470821929213762" onmouseenter="enter('5260470821929213762');" onmouseout="out('5260470821929213762');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286     mEntity.setFilePath(newPath);                                                                        </span>
<span class="552132236643695604" onmouseenter="enter('552132236643695604');" onmouseout="out('552132236643695604');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287     RecordUtil.modifyTaskRecord(oldFile.getPath(), newPath, mEntity.getTaskType());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290   /**                                                                                                    </span>
<span class="-761470207976407479" onmouseenter="enter('-761470207976407479');" onmouseout="out('-761470207976407479');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291    * 处理30x跳转                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292    */                                                                                                    </span>
<span class="5556617621352975519" onmouseenter="enter('5556617621352975519');" onmouseout="out('5556617621352975519');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293   private void handleUrlReTurn(HttpURLConnection conn, String newUrl) throws IOException {               </span>
<span class="9112975487181986733" onmouseenter="enter('9112975487181986733');" onmouseout="out('9112975487181986733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294     ALog.d(TAG, &quot;30x跳转，新url为【&quot; + newUrl + &quot;】&quot;);                                                          </span>
<span class="-3187267727779732659" onmouseenter="enter('-3187267727779732659');" onmouseout="out('-3187267727779732659');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295     if (TextUtils.isEmpty(newUrl) || newUrl.equalsIgnoreCase(&quot;null&quot;)) {                                  </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296       if (onFileInfoCallback != null) {                                                                  </span>
<span class="7265698984710319788" onmouseenter="enter('7265698984710319788');" onmouseout="out('7265698984710319788');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297         onFileInfoCallback.onFail(mEntity, new TaskException(TAG, &quot;获取重定向链接失败&quot;), false);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298       }                                                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300     }                                                                                                    </span>
<span class="-4691236730005429135" onmouseenter="enter('-4691236730005429135');" onmouseout="out('-4691236730005429135');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301     if (newUrl.startsWith(&quot;/&quot;)) {                                                                        </span>
<span class="-7947437880890249902" onmouseenter="enter('-7947437880890249902');" onmouseout="out('-7947437880890249902');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302       Uri uri = Uri.parse(mEntity.getUrl());                                                             </span>
<span class="-159008217290066182" onmouseenter="enter('-159008217290066182');" onmouseout="out('-159008217290066182');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303       newUrl = uri.getHost() + newUrl;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305                                                                                                          </span>
<span class="-4197272966192810800" onmouseenter="enter('-4197272966192810800');" onmouseout="out('-4197272966192810800');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306     if (!CheckUtil.checkUrl(newUrl)) {                                                                   </span>
<span class="8671661921003868184" onmouseenter="enter('8671661921003868184');" onmouseout="out('8671661921003868184');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307       failDownload(new TaskException(TAG, &quot;下载失败，重定向url错误&quot;), false);                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309     }                                                                                                    </span>
<span class="2121195664546392305" onmouseenter="enter('2121195664546392305');" onmouseout="out('2121195664546392305');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310     taskOption.setRedirectUrl(newUrl);                                                                   </span>
<span class="-7202069996221856390" onmouseenter="enter('-7202069996221856390');" onmouseout="out('-7202069996221856390');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311     mEntity.setRedirect(true);                                                                           </span>
<span class="3562634937094117088" onmouseenter="enter('3562634937094117088');" onmouseout="out('3562634937094117088');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312     mEntity.setRedirectUrl(newUrl);                                                                      </span>
<span class="-6439352303300997905" onmouseenter="enter('-6439352303300997905');" onmouseout="out('-6439352303300997905');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313     String cookies = conn.getHeaderField(&quot;Set-Cookie&quot;);                                                  </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314     conn.disconnect();                                                                                   </span>
<span class="7827815028692387267" onmouseenter="enter('7827815028692387267');" onmouseout="out('7827815028692387267');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315     URL url = ConnectionHelp.handleUrl(newUrl, taskOption);                                              </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316     conn = ConnectionHelp.handleConnection(url, taskOption);                                             </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317     ConnectionHelp.setConnectParam(taskOption, conn);                                                    </span>
<span class="-9082472095175979719" onmouseenter="enter('-9082472095175979719');" onmouseout="out('-9082472095175979719');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318     conn.setRequestProperty(&quot;Cookie&quot;, cookies);                                                          </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319     conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                                </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320     conn.setConnectTimeout(mConnectTimeOut);                                                             </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321     conn.connect();                                                                                      </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322     handleConnect(conn);                                                                                 </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323     conn.disconnect();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326   /**                                                                                                    </span>
<span class="8188732119885086451" onmouseenter="enter('8188732119885086451');" onmouseout="out('8188732119885086451');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327    * 检查长度是否合法，并且检查新获取的文件长度是否和数据库的文件长度一直，如果不一致，则表示该任务为新任务                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328    *                                                                                                     </span>
<span class="7508607167277684618" onmouseenter="enter('7508607167277684618');" onmouseout="out('7508607167277684618');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329    * @param len 从服务器获取的文件长度                                                                              </span>
<span class="2269811577157119944" onmouseenter="enter('2269811577157119944');" onmouseout="out('2269811577157119944');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330    * @return {@code true}合法                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331    */                                                                                                    </span>
<span class="226943708538926451" onmouseenter="enter('226943708538926451');" onmouseout="out('226943708538926451');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332   private boolean checkLen(long len) {                                                                   </span>
<span class="-6834276917361274338" onmouseenter="enter('-6834276917361274338');" onmouseout="out('-6834276917361274338');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333     if (len != mEntity.getFileSize()) {                                                                  </span>
<span class="7031409428945889302" onmouseenter="enter('7031409428945889302');" onmouseout="out('7031409428945889302');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334       ALog.d(TAG, &quot;长度不一致，任务为新任务&quot;);                                                                       </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335       mTaskWrapper.setNewTask(true);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339                                                                                                          </span>
<span class="-4015346071016137178" onmouseenter="enter('-4015346071016137178');" onmouseout="out('-4015346071016137178');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340   private void failDownload(BaseException e, boolean needRetry) {                                        </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341     if (onFileInfoCallback != null) {                                                                    </span>
<span class="-3744805558345201426" onmouseenter="enter('-3744805558345201426');" onmouseout="out('-3744805558345201426');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342       onFileInfoCallback.onFail(mEntity, e, needRetry);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345                                                                                                          </span>
<span class="-306327811626166304" onmouseenter="enter('-306327811626166304');" onmouseout="out('-306327811626166304');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346   private static class FileLenAdapter implements IHttpFileLenAdapter {                                   </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347                                                                                                          </span>
<span class="-4968473764170008746" onmouseenter="enter('-4968473764170008746');" onmouseout="out('-4968473764170008746');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348     @Override public long handleFileLen(Map&lt;String, List&lt;String&gt;&gt; headers) {                             </span>
<span class="-3703403373407617525" onmouseenter="enter('-3703403373407617525');" onmouseout="out('-3703403373407617525');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349       if (headers == null || headers.isEmpty()) {                                                        </span>
<span class="7978066123796535188" onmouseenter="enter('7978066123796535188');" onmouseout="out('7978066123796535188');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350         ALog.e(TAG, &quot;header为空，获取文件长度失败&quot;);                                                                </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351         return -1;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352       }                                                                                                  </span>
<span class="-3327040667133742279" onmouseenter="enter('-3327040667133742279');" onmouseout="out('-3327040667133742279');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353       List&lt;String&gt; sLength = headers.get(&quot;Content-Length&quot;);                                              </span>
<span class="-5638961086111332224" onmouseenter="enter('-5638961086111332224');" onmouseout="out('-5638961086111332224');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354       if (sLength == null || sLength.isEmpty()) {                                                        </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355         return -1;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356       }                                                                                                  </span>
<span class="1006906766372690526" onmouseenter="enter('1006906766372690526');" onmouseout="out('1006906766372690526');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357       String temp = sLength.get(0);                                                                      </span>
<span class="-859592945496577082" onmouseenter="enter('-859592945496577082');" onmouseout="out('-859592945496577082');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358       long len = TextUtils.isEmpty(temp) ? -1 : Long.parseLong(temp);                                    </span>
<span class="-3482859616975282364" onmouseenter="enter('-3482859616975282364');" onmouseout="out('-3482859616975282364');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359       // 某些服务，如果设置了conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                 </span>
<span class="-2343886357485900465" onmouseenter="enter('-2343886357485900465');" onmouseout="out('-2343886357485900465');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360       // 会返回 Content-Range: bytes 0-225427911/225427913                                                  </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361       if (len &lt; 0) {                                                                                     </span>
<span class="-5449604609323133496" onmouseenter="enter('-5449604609323133496');" onmouseout="out('-5449604609323133496');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362         List&lt;String&gt; sRange = headers.get(&quot;Content-Range&quot;);                                              </span>
<span class="-939726222710114379" onmouseenter="enter('-939726222710114379');" onmouseout="out('-939726222710114379');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363         if (sRange == null || sRange.isEmpty()) {                                                        </span>
<span class="-428304200248281464" onmouseenter="enter('-428304200248281464');" onmouseout="out('-428304200248281464');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364           len = -1;                                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365         } else {                                                                                         </span>
<span class="-552616904450344700" onmouseenter="enter('-552616904450344700');" onmouseout="out('-552616904450344700');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366           int start = temp.indexOf(&quot;/&quot;);                                                                 </span>
<span class="6692102738649716212" onmouseenter="enter('6692102738649716212');" onmouseout="out('6692102738649716212');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367           len = Long.parseLong(temp.substring(start + 1));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369       }                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370                                                                                                          </span>
<span class="7701238698032811091" onmouseenter="enter('7701238698032811091');" onmouseout="out('7701238698032811091');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371       return len;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 374 }                                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 375 =======                                                                                                  </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390  */                                                                                                      </span>
<span class="-7236899369024788297" onmouseenter="enter('-7236899369024788297');" onmouseout="out('-7236899369024788297');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391 package com.arialyy.aria.http;                                                                           </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392                                                                                                          </span>
<span class="-6390350725830347024" onmouseenter="enter('-6390350725830347024');" onmouseout="out('-6390350725830347024');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393 import android.net.TrafficStats;                                                                         </span>
<span class="-8750621697125156872" onmouseenter="enter('-8750621697125156872');" onmouseout="out('-8750621697125156872');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394 import android.net.Uri;                                                                                  </span>
<span class="3485143652294101472" onmouseenter="enter('3485143652294101472');" onmouseout="out('3485143652294101472');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395 import android.os.Process;                                                                               </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 396 import android.text.TextUtils;                                                                           </span>
<span class="8153369258057528270" onmouseenter="enter('8153369258057528270');" onmouseout="out('8153369258057528270');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 397 import com.arialyy.aria.core.AriaConfig;                                                                 </span>
<span class="5028823532254250595" onmouseenter="enter('5028823532254250595');" onmouseout="out('5028823532254250595');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398 import com.arialyy.aria.core.common.CompleteInfo;                                                        </span>
<span class="7716102167634407665" onmouseenter="enter('7716102167634407665');" onmouseout="out('7716102167634407665');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399 import com.arialyy.aria.core.common.RequestEnum;                                                         </span>
<span class="-3497740022528182602" onmouseenter="enter('-3497740022528182602');" onmouseout="out('-3497740022528182602');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 400 import com.arialyy.aria.core.download.DTaskWrapper;                                                      </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 401 import com.arialyy.aria.core.download.DownloadEntity;                                                    </span>
<span class="-5825121975347398532" onmouseenter="enter('-5825121975347398532');" onmouseout="out('-5825121975347398532');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402 import com.arialyy.aria.core.inf.OnFileInfoCallback;                                                     </span>
<span class="-5191825800443458517" onmouseenter="enter('-5191825800443458517');" onmouseout="out('-5191825800443458517');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403 import com.arialyy.aria.core.processor.IHttpFileLenAdapter;                                              </span>
<span class="6359380642632041098" onmouseenter="enter('6359380642632041098');" onmouseout="out('6359380642632041098');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404 import com.arialyy.aria.exception.AriaIOException;                                                       </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405 import com.arialyy.aria.exception.BaseException;                                                         </span>
<span class="-5001091348570971924" onmouseenter="enter('-5001091348570971924');" onmouseout="out('-5001091348570971924');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406 import com.arialyy.aria.exception.TaskException;                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 407 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 408 import com.arialyy.aria.util.CheckUtil;                                                                  </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410 import com.arialyy.aria.util.FileUtil;                                                                   </span>
<span class="-969957896094278671" onmouseenter="enter('-969957896094278671');" onmouseout="out('-969957896094278671');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411 import com.arialyy.aria.util.RecordUtil;                                                                 </span>
<span class="-4738630423427876475" onmouseenter="enter('-4738630423427876475');" onmouseout="out('-4738630423427876475');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412 import java.io.BufferedReader;                                                                           </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414 import java.io.IOException;                                                                              </span>
<span class="-5152338856474932575" onmouseenter="enter('-5152338856474932575');" onmouseout="out('-5152338856474932575');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 415 import java.io.InputStreamReader;                                                                        </span>
<span class="3835172898968420800" onmouseenter="enter('3835172898968420800');" onmouseout="out('3835172898968420800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416 import java.io.OutputStreamWriter;                                                                       </span>
<span class="8256805395213692609" onmouseenter="enter('8256805395213692609');" onmouseout="out('8256805395213692609');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417 import java.io.UnsupportedEncodingException;                                                             </span>
<span class="7759739624588802903" onmouseenter="enter('7759739624588802903');" onmouseout="out('7759739624588802903');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418 import java.net.CookieManager;                                                                           </span>
<span class="-5584619311424941805" onmouseenter="enter('-5584619311424941805');" onmouseout="out('-5584619311424941805');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419 import java.net.HttpCookie;                                                                              </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 421 import java.net.URL;                                                                                     </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422 import java.net.URLDecoder;                                                                              </span>
<span class="302463665162759210" onmouseenter="enter('302463665162759210');" onmouseout="out('302463665162759210');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423 import java.net.URLEncoder;                                                                              </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 426 import java.util.Set;                                                                                    </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427 import java.util.UUID;                                                                                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 428                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429 /**                                                                                                      </span>
<span class="-1733864505168931106" onmouseenter="enter('-1733864505168931106');" onmouseout="out('-1733864505168931106');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430  * 下载文件信息获取                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431  */                                                                                                      </span>
<span class="-8507874378969942466" onmouseenter="enter('-8507874378969942466');" onmouseout="out('-8507874378969942466');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432 public class HttpFileInfoThread implements Runnable {                                                    </span>
<span class="-960543327724144855" onmouseenter="enter('-960543327724144855');" onmouseout="out('-960543327724144855');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433   private static final String TAG = &quot;HttpFileInfoThread&quot;;                                                </span>
<span class="-7151375780097547664" onmouseenter="enter('-7151375780097547664');" onmouseout="out('-7151375780097547664');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434   private DownloadEntity mEntity;                                                                        </span>
<span class="-3857309927385466618" onmouseenter="enter('-3857309927385466618');" onmouseout="out('-3857309927385466618');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435   private DTaskWrapper mTaskWrapper;                                                                     </span>
<span class="8600882525060240313" onmouseenter="enter('8600882525060240313');" onmouseout="out('8600882525060240313');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436   private int mConnectTimeOut;                                                                           </span>
<span class="-6824755283282820235" onmouseenter="enter('-6824755283282820235');" onmouseout="out('-6824755283282820235');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437   private OnFileInfoCallback onFileInfoCallback;                                                         </span>
<span class="6827268874849985533" onmouseenter="enter('6827268874849985533');" onmouseout="out('6827268874849985533');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438   private HttpTaskOption taskOption;                                                                     </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439                                                                                                          </span>
<span class="-5652336240759927020" onmouseenter="enter('-5652336240759927020');" onmouseout="out('-5652336240759927020');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440   public HttpFileInfoThread(DTaskWrapper taskWrapper, OnFileInfoCallback callback) {                     </span>
<span class="-3805550036651318371" onmouseenter="enter('-3805550036651318371');" onmouseout="out('-3805550036651318371');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441     this.mTaskWrapper = taskWrapper;                                                                     </span>
<span class="-170355754520114419" onmouseenter="enter('-170355754520114419');" onmouseout="out('-170355754520114419');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442     mEntity = taskWrapper.getEntity();                                                                   </span>
<span class="2572452400414830057" onmouseenter="enter('2572452400414830057');" onmouseout="out('2572452400414830057');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443     mConnectTimeOut = AriaConfig.getInstance().getDConfig().getConnectTimeOut();                         </span>
<span class="1217537359294132674" onmouseenter="enter('1217537359294132674');" onmouseout="out('1217537359294132674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444     onFileInfoCallback = callback;                                                                       </span>
<span class="6933673676495207920" onmouseenter="enter('6933673676495207920');" onmouseout="out('6933673676495207920');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 445     taskOption = (HttpTaskOption) taskWrapper.getTaskOption();                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 446   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 447                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 448   @Override public void run() {                                                                          </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 449     Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                       </span>
<span class="-1851318291295515457" onmouseenter="enter('-1851318291295515457');" onmouseout="out('-1851318291295515457');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 450     TrafficStats.setThreadStatsTag(UUID.randomUUID().toString().hashCode());                             </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 451     HttpURLConnection conn = null;                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 452     try {                                                                                                </span>
<span class="7954771811613007401" onmouseenter="enter('7954771811613007401');" onmouseout="out('7954771811613007401');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 453       URL url = ConnectionHelp.handleUrl(mEntity.getUrl(), taskOption);                                  </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 454       conn = ConnectionHelp.handleConnection(url, taskOption);                                           </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 455       ConnectionHelp.setConnectParam(taskOption, conn);                                                  </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 456       conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                              </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 457       conn.setConnectTimeout(mConnectTimeOut);                                                           </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 458       conn.connect();                                                                                    </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 459       handleConnect(conn);                                                                               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 460     } catch (IOException e) {                                                                            </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 461       e.printStackTrace();                                                                               </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 462       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="-4053293382299681633" onmouseenter="enter('-4053293382299681633');" onmouseout="out('-4053293382299681633');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 463               String.format(&quot;下载失败，filePath: %s, url: %s&quot;, mEntity.getDownloadPath(), mEntity.getUrl())), </span>
<span class="-159362617709534437" onmouseenter="enter('-159362617709534437');" onmouseout="out('-159362617709534437');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 464           true);                                                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 465     } finally {                                                                                          </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 466       if (conn != null) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 467         try {                                                                                            </span>
<span class="-8686251500819757648" onmouseenter="enter('-8686251500819757648');" onmouseout="out('-8686251500819757648');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 468           conn.getInputStream().close();                                                                 </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 469         } catch (IOException e) {                                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 470           e.printStackTrace();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 471         }                                                                                                </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 472         conn.disconnect();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 473       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 474     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 475   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 476                                                                                                          </span>
<span class="7469915187822843170" onmouseenter="enter('7469915187822843170');" onmouseout="out('7469915187822843170');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 477   private void handleConnect(HttpURLConnection conn) throws IOException {                                </span>
<span class="-5135480308665977678" onmouseenter="enter('-5135480308665977678');" onmouseout="out('-5135480308665977678');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 478     if (taskOption.getRequestEnum() == RequestEnum.POST) {                                               </span>
<span class="-5476217355085156421" onmouseenter="enter('-5476217355085156421');" onmouseout="out('-5476217355085156421');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 479       Map&lt;String, String&gt; params = taskOption.getParams();                                               </span>
<span class="3157859291963549592" onmouseenter="enter('3157859291963549592');" onmouseout="out('3157859291963549592');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 480       if (params != null) {                                                                              </span>
<span class="1177673060067921781" onmouseenter="enter('1177673060067921781');" onmouseout="out('1177673060067921781');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 481         OutputStreamWriter dos = new OutputStreamWriter(conn.getOutputStream());                         </span>
<span class="-2461846026114443284" onmouseenter="enter('-2461846026114443284');" onmouseout="out('-2461846026114443284');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 482         Set&lt;String&gt; keys = params.keySet();                                                              </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 483         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 484         for (String key : keys) {                                                                        </span>
<span class="-378086891984466400" onmouseenter="enter('-378086891984466400');" onmouseout="out('-378086891984466400');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 485           sb.append(key).append(&quot;=&quot;).append(URLEncoder.encode(params.get(key))).append(&quot;&amp;&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 486         }                                                                                                </span>
<span class="-1170631941621929173" onmouseenter="enter('-1170631941621929173');" onmouseout="out('-1170631941621929173');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 487         String url = sb.toString();                                                                      </span>
<span class="-2854610904289092260" onmouseenter="enter('-2854610904289092260');" onmouseout="out('-2854610904289092260');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 488         url = url.substring(0, url.length() - 1);                                                        </span>
<span class="-412821746973687146" onmouseenter="enter('-412821746973687146');" onmouseout="out('-412821746973687146');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 489         dos.write(url);                                                                                  </span>
<span class="-6320099346663956498" onmouseenter="enter('-6320099346663956498');" onmouseout="out('-6320099346663956498');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 490         dos.flush();                                                                                     </span>
<span class="1568727060082909957" onmouseenter="enter('1568727060082909957');" onmouseout="out('1568727060082909957');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 491         dos.close();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 492       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 493     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 494                                                                                                          </span>
<span class="831227310872116523" onmouseenter="enter('831227310872116523');" onmouseout="out('831227310872116523');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 495     IHttpFileLenAdapter lenAdapter = taskOption.getFileLenAdapter();                                     </span>
<span class="5196440776228873073" onmouseenter="enter('5196440776228873073');" onmouseout="out('5196440776228873073');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 496     if (lenAdapter == null) {                                                                            </span>
<span class="7197457532950740585" onmouseenter="enter('7197457532950740585');" onmouseout="out('7197457532950740585');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 497       lenAdapter = new FileLenAdapter();                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 498     } else {                                                                                             </span>
<span class="-2288407285072363665" onmouseenter="enter('-2288407285072363665');" onmouseout="out('-2288407285072363665');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 499       ALog.d(TAG, &quot;使用自定义adapter&quot;);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 500     }                                                                                                    </span>
<span class="-3117441631991498996" onmouseenter="enter('-3117441631991498996');" onmouseout="out('-3117441631991498996');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 501     long len = lenAdapter.handleFileLen(conn.getHeaderFields());                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 502                                                                                                          </span>
<span class="57392966174497577" onmouseenter="enter('57392966174497577');" onmouseout="out('57392966174497577');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 503     if (!FileUtil.checkMemorySpace(mEntity.getFilePath(), len)) {                                        </span>
<span class="-1675602595326094546" onmouseenter="enter('-1675602595326094546');" onmouseout="out('-1675602595326094546');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 504       failDownload(new TaskException(TAG,                                                                </span>
<span class="380344701162823709" onmouseenter="enter('380344701162823709');" onmouseout="out('380344701162823709');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505           String.format(&quot;下载失败，内存空间不足；filePath: %s, url: %s&quot;, mEntity.getDownloadPath(),                  </span>
<span class="3748007250659926415" onmouseenter="enter('3748007250659926415');" onmouseout="out('3748007250659926415');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506               mEntity.getUrl())), false);                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509                                                                                                          </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510     int code = conn.getResponseCode();                                                                   </span>
<span class="243612440262257064" onmouseenter="enter('243612440262257064');" onmouseout="out('243612440262257064');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511     boolean end = false;                                                                                 </span>
<span class="3661527496298260626" onmouseenter="enter('3661527496298260626');" onmouseout="out('3661527496298260626');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512     if (TextUtils.isEmpty(mEntity.getMd5Code())) {                                                       </span>
<span class="6175847651720741920" onmouseenter="enter('6175847651720741920');" onmouseout="out('6175847651720741920');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513       String md5Code = conn.getHeaderField(&quot;Content-MD5&quot;);                                               </span>
<span class="3841984198412482104" onmouseenter="enter('3841984198412482104');" onmouseout="out('3841984198412482104');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514       mEntity.setMd5Code(md5Code);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516                                                                                                          </span>
<span class="-9137345962727529427" onmouseenter="enter('-9137345962727529427');" onmouseout="out('-9137345962727529427');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517     boolean isChunked = false;                                                                           </span>
<span class="-8116968388415792268" onmouseenter="enter('-8116968388415792268');" onmouseout="out('-8116968388415792268');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518     final String str = conn.getHeaderField(&quot;Transfer-Encoding&quot;);                                         </span>
<span class="-6629832129461298046" onmouseenter="enter('-6629832129461298046');" onmouseout="out('-6629832129461298046');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519     if (!TextUtils.isEmpty(str) &amp;&amp; str.equals(&quot;chunked&quot;)) {                                              </span>
<span class="268583664719475207" onmouseenter="enter('268583664719475207');" onmouseout="out('268583664719475207');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520       isChunked = true;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521     }                                                                                                    </span>
<span class="8180254556269969385" onmouseenter="enter('8180254556269969385');" onmouseout="out('8180254556269969385');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522     Map&lt;String, List&lt;String&gt;&gt; headers = conn.getHeaderFields();                                          </span>
<span class="8122923533236748969" onmouseenter="enter('8122923533236748969');" onmouseout="out('8122923533236748969');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523     String disposition = conn.getHeaderField(&quot;Content-Disposition&quot;);                                     </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524                                                                                                          </span>
<span class="-3052400857632215863" onmouseenter="enter('-3052400857632215863');" onmouseout="out('-3052400857632215863');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525     if (taskOption.isUseServerFileName()) {                                                              </span>
<span class="9149723838126995721" onmouseenter="enter('9149723838126995721');" onmouseout="out('9149723838126995721');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526       if (!TextUtils.isEmpty(disposition)) {                                                             </span>
<span class="3142217124074067362" onmouseenter="enter('3142217124074067362');" onmouseout="out('3142217124074067362');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527         mEntity.setDisposition(CommonUtil.encryptBASE64(disposition));                                   </span>
<span class="8894179749774343207" onmouseenter="enter('8894179749774343207');" onmouseout="out('8894179749774343207');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528         handleContentDisposition(disposition);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529       } else {                                                                                           </span>
<span class="6725831659311340657" onmouseenter="enter('6725831659311340657');" onmouseout="out('6725831659311340657');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530         ALog.w(TAG, &quot;Content-Disposition对于端字段为空，使用服务器端文件名失败&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532     }                                                                                                    </span>
<span class="3131612029960887116" onmouseenter="enter('3131612029960887116');" onmouseout="out('3131612029960887116');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533     CookieManager msCookieManager = new CookieManager();                                                 </span>
<span class="6317541366742429029" onmouseenter="enter('6317541366742429029');" onmouseout="out('6317541366742429029');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534     List&lt;String&gt; cookiesHeader = headers.get(&quot;Set-Cookie&quot;);                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535                                                                                                          </span>
<span class="-3711800334805746628" onmouseenter="enter('-3711800334805746628');" onmouseout="out('-3711800334805746628');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 536     if (cookiesHeader != null) {                                                                         </span>
<span class="50137583020384401" onmouseenter="enter('50137583020384401');" onmouseout="out('50137583020384401');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 537       for (String cookie : cookiesHeader) {                                                              </span>
<span class="-5052850978727150914" onmouseenter="enter('-5052850978727150914');" onmouseout="out('-5052850978727150914');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 538         msCookieManager.getCookieStore().add(null, HttpCookie.parse(cookie).get(0));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 539       }                                                                                                  </span>
<span class="-6061807114007929519" onmouseenter="enter('-6061807114007929519');" onmouseout="out('-6061807114007929519');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 540       taskOption.setCookieManager(msCookieManager);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 541     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542                                                                                                          </span>
<span class="-5434227081099310624" onmouseenter="enter('-5434227081099310624');" onmouseout="out('-5434227081099310624');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543     mTaskWrapper.setCode(code);                                                                          </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544     if (code == HttpURLConnection.HTTP_PARTIAL) {                                                        </span>
<span class="3476352595280537016" onmouseenter="enter('3476352595280537016');" onmouseout="out('3476352595280537016');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545       if (!checkLen(len) &amp;&amp; !isChunked) {                                                                </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 546         if (len &lt; 0) {                                                                                   </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 547           failDownload(                                                                                  </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 548               new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),      </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 549               false);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550         }                                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 552       }                                                                                                  </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 553       mEntity.setFileSize(len);                                                                          </span>
<span class="4333195157428278321" onmouseenter="enter('4333195157428278321');" onmouseout="out('4333195157428278321');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 554       mTaskWrapper.setSupportBP(true);                                                                   </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 555       end = true;                                                                                        </span>
<span class="2496770639447193327" onmouseenter="enter('2496770639447193327');" onmouseout="out('2496770639447193327');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 556     } else if (code == HttpURLConnection.HTTP_OK) {                                                      </span>
<span class="-998567010505343674" onmouseenter="enter('-998567010505343674');" onmouseout="out('-998567010505343674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 557       String contentType = conn.getHeaderField(&quot;Content-Type&quot;);                                          </span>
<span class="201076292918755336" onmouseenter="enter('201076292918755336');" onmouseout="out('201076292918755336');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 558       if (TextUtils.isEmpty(contentType)) {                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 559         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 560       }                                                                                                  </span>
<span class="8927907009918172915" onmouseenter="enter('8927907009918172915');" onmouseout="out('8927907009918172915');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 561       if (contentType.equals(&quot;text/html&quot;)) {                                                             </span>
<span class="8342413994542158594" onmouseenter="enter('8342413994542158594');" onmouseout="out('8342413994542158594');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 562         BufferedReader reader =                                                                          </span>
<span class="-7427210485489972460" onmouseenter="enter('-7427210485489972460');" onmouseout="out('-7427210485489972460');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 563             new BufferedReader(new InputStreamReader(ConnectionHelp.convertInputStream(conn)));          </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 564         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="6431556981547329060" onmouseenter="enter('6431556981547329060');" onmouseout="out('6431556981547329060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 565         String line;                                                                                     </span>
<span class="4058321022246549205" onmouseenter="enter('4058321022246549205');" onmouseout="out('4058321022246549205');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 566         while ((line = reader.readLine()) != null) {                                                     </span>
<span class="-6213624305830265937" onmouseenter="enter('-6213624305830265937');" onmouseout="out('-6213624305830265937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 567           sb.append(line);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 568         }                                                                                                </span>
<span class="8277398435538005537" onmouseenter="enter('8277398435538005537');" onmouseout="out('8277398435538005537');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 569         reader.close();                                                                                  </span>
<span class="8311106050401029529" onmouseenter="enter('8311106050401029529');" onmouseout="out('8311106050401029529');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 570         handleUrlReTurn(conn, CommonUtil.getWindowReplaceUrl(sb.toString()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 571         return;                                                                                          </span>
<span class="-4432363278840297326" onmouseenter="enter('-4432363278840297326');" onmouseout="out('-4432363278840297326');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 572       } else if (!checkLen(len) &amp;&amp; !isChunked) {                                                         </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 573         if (len &lt; 0) {                                                                                   </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 574           failDownload(                                                                                  </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 575               new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),      </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 576               false);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 577         }                                                                                                </span>
<span class="1925321240779458317" onmouseenter="enter('1925321240779458317');" onmouseout="out('1925321240779458317');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 578         ALog.d(TAG, &quot;len &lt; 0&quot;);                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 579         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 580       }                                                                                                  </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 581       mEntity.setFileSize(len);                                                                          </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 582       mTaskWrapper.setNewTask(true);                                                                     </span>
<span class="9157524552034725227" onmouseenter="enter('9157524552034725227');" onmouseout="out('9157524552034725227');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 583       mTaskWrapper.setSupportBP(false);                                                                  </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 584       end = true;                                                                                        </span>
<span class="1848064821034278655" onmouseenter="enter('1848064821034278655');" onmouseout="out('1848064821034278655');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 585     } else if (code == HttpURLConnection.HTTP_NOT_FOUND) {                                               </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 586       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="-2250251533714311872" onmouseenter="enter('-2250251533714311872');" onmouseout="out('-2250251533714311872');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 587           String.format(&quot;任务下载失败，errorCode：404, url: %s&quot;, mEntity.getUrl())), true);                      </span>
<span class="7269465454949275689" onmouseenter="enter('7269465454949275689');" onmouseout="out('7269465454949275689');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 588     } else if (code == HttpURLConnection.HTTP_MOVED_TEMP                                                 </span>
<span class="-6032747441450584852" onmouseenter="enter('-6032747441450584852');" onmouseout="out('-6032747441450584852');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 589         || code == HttpURLConnection.HTTP_MOVED_PERM                                                     </span>
<span class="6529484345882801441" onmouseenter="enter('6529484345882801441');" onmouseout="out('6529484345882801441');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 590         || code == HttpURLConnection.HTTP_SEE_OTHER                                                      </span>
<span class="-5614885484106173463" onmouseenter="enter('-5614885484106173463');" onmouseout="out('-5614885484106173463');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 591         || code == HttpURLConnection.HTTP_CREATED // 201 跳转                                              </span>
<span class="-1964089336962903701" onmouseenter="enter('-1964089336962903701');" onmouseout="out('-1964089336962903701');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 592         || code == 307) {                                                                                </span>
<span class="582471876420463974" onmouseenter="enter('582471876420463974');" onmouseout="out('582471876420463974');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 593       handleUrlReTurn(conn, conn.getHeaderField(&quot;Location&quot;));                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 594     } else {                                                                                             </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 595       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="3458281120857355945" onmouseenter="enter('3458281120857355945');" onmouseout="out('3458281120857355945');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 596           String.format(&quot;任务下载失败，errorCode：%s, errorMsg: %s, url: %s&quot;, code,                              </span>
<span class="-865670794746359823" onmouseenter="enter('-865670794746359823');" onmouseout="out('-865670794746359823');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 597               conn.getResponseMessage(), mEntity.getUrl())), !CheckUtil.httpIsBadRequest(code));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 598     }                                                                                                    </span>
<span class="-6801527756571482213" onmouseenter="enter('-6801527756571482213');" onmouseout="out('-6801527756571482213');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 599     if (end) {                                                                                           </span>
<span class="-9049555213483660293" onmouseenter="enter('-9049555213483660293');" onmouseout="out('-9049555213483660293');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 600       taskOption.setChunked(isChunked);                                                                  </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 601       if (onFileInfoCallback != null) {                                                                  </span>
<span class="-3029323004951684182" onmouseenter="enter('-3029323004951684182');" onmouseout="out('-3029323004951684182');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 602         CompleteInfo info = new CompleteInfo(code, mTaskWrapper);                                        </span>
<span class="1239392088731349048" onmouseenter="enter('1239392088731349048');" onmouseout="out('1239392088731349048');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 603         onFileInfoCallback.onComplete(mEntity.getUrl(), info);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 604       }                                                                                                  </span>
<span class="-2332174823472847291" onmouseenter="enter('-2332174823472847291');" onmouseout="out('-2332174823472847291');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 605       mEntity.update();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 606     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 607   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 608                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 609   /**                                                                                                    </span>
<span class="-2847240885661455178" onmouseenter="enter('-2847240885661455178');" onmouseout="out('-2847240885661455178');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 610    * 处理&quot;Content-Disposition&quot;参数                                                                           </span>
<span class="8881865652474859794" onmouseenter="enter('8881865652474859794');" onmouseout="out('8881865652474859794');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 611    * &lt;a href=https://cloud.tencent.com/developer/section/1189916&gt;Content-Disposition&lt;/a&gt;&lt;/&gt;              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 612    *                                                                                                     </span>
<span class="-7776712758593145643" onmouseenter="enter('-7776712758593145643');" onmouseout="out('-7776712758593145643');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 613    * @throws UnsupportedEncodingException                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 614    */                                                                                                    </span>
<span class="-8608321373459550338" onmouseenter="enter('-8608321373459550338');" onmouseout="out('-8608321373459550338');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 615   private void handleContentDisposition(String disposition) throws UnsupportedEncodingException {        </span>
<span class="8299914696584334305" onmouseenter="enter('8299914696584334305');" onmouseout="out('8299914696584334305');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 616     if (disposition.contains(&quot;;&quot;)) {                                                                     </span>
<span class="-8249279439551045927" onmouseenter="enter('-8249279439551045927');" onmouseout="out('-8249279439551045927');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 617       String[] infos = disposition.split(&quot;;&quot;);                                                           </span>
<span class="2055683922126838823" onmouseenter="enter('2055683922126838823');" onmouseout="out('2055683922126838823');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 618       if (infos[0].equals(&quot;attachment&quot;)) {                                                               </span>
<span class="-6108489956922562466" onmouseenter="enter('-6108489956922562466');" onmouseout="out('-6108489956922562466');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 619         for (String info : infos) {                                                                      </span>
<span class="-3445363461731907777" onmouseenter="enter('-3445363461731907777');" onmouseout="out('-3445363461731907777');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 620           if (info.startsWith(&quot;filename&quot;) &amp;&amp; info.contains(&quot;=&quot;)) {                                       </span>
<span class="3695771658612668290" onmouseenter="enter('3695771658612668290');" onmouseout="out('3695771658612668290');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 621             String[] temp = info.split(&quot;=&quot;);                                                             </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 622             if (temp.length &gt; 1) {                                                                       </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 623               String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                 </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 624               mEntity.setServerFileName(newName);                                                        </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 625               renameFile(newName);                                                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 626               break;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 627             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 628           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 629         }                                                                                                </span>
<span class="6794164660951287492" onmouseenter="enter('6794164660951287492');" onmouseout="out('6794164660951287492');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 630       } else if (infos[0].equals(&quot;form-data&quot;) &amp;&amp; infos.length &gt; 2) {                                     </span>
<span class="-8905252974632201641" onmouseenter="enter('-8905252974632201641');" onmouseout="out('-8905252974632201641');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 631         String[] temp = infos[2].split(&quot;=&quot;);                                                             </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 632         if (temp.length &gt; 1) {                                                                           </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 633           String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                     </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 634           mEntity.setServerFileName(newName);                                                            </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 635           renameFile(newName);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 636         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 637       } else {                                                                                           </span>
<span class="7479053829749492027" onmouseenter="enter('7479053829749492027');" onmouseout="out('7479053829749492027');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 638         ALog.w(TAG, &quot;不识别的Content-Disposition参数&quot;);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 639       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 640     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 641   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 642                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 643   /**                                                                                                    </span>
<span class="-5538524699876672002" onmouseenter="enter('-5538524699876672002');" onmouseout="out('-5538524699876672002');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 644    * 重命名文件                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 645    */                                                                                                    </span>
<span class="-7899950182898562290" onmouseenter="enter('-7899950182898562290');" onmouseout="out('-7899950182898562290');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 646   private void renameFile(String newName) {                                                              </span>
<span class="4040095654750429587" onmouseenter="enter('4040095654750429587');" onmouseout="out('4040095654750429587');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 647     if (TextUtils.isEmpty(newName)) {                                                                    </span>
<span class="7746921739080291575" onmouseenter="enter('7746921739080291575');" onmouseout="out('7746921739080291575');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 648       ALog.w(TAG, &quot;重命名失败【服务器返回的文件名为空】&quot;);                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 649       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 650     }                                                                                                    </span>
<span class="-897821573073116237" onmouseenter="enter('-897821573073116237');" onmouseout="out('-897821573073116237');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 651     ALog.d(TAG, String.format(&quot;文件重命名为：%s&quot;, newName));                                                    </span>
<span class="3112348380249890188" onmouseenter="enter('3112348380249890188');" onmouseout="out('3112348380249890188');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 652     File oldFile = new File(mEntity.getFilePath());                                                      </span>
<span class="6384479286325830175" onmouseenter="enter('6384479286325830175');" onmouseout="out('6384479286325830175');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 653     String newPath = oldFile.getParent() + &quot;/&quot; + newName;                                                </span>
<span class="-8664365027300439044" onmouseenter="enter('-8664365027300439044');" onmouseout="out('-8664365027300439044');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 654     if (oldFile.exists()) {                                                                              </span>
<span class="-2839507751750912779" onmouseenter="enter('-2839507751750912779');" onmouseout="out('-2839507751750912779');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 655       boolean b = oldFile.renameTo(new File(newPath));                                                   </span>
<span class="1440136229140496041" onmouseenter="enter('1440136229140496041');" onmouseout="out('1440136229140496041');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 656       ALog.d(TAG, String.format(&quot;文件重命名%s&quot;, b ? &quot;成功&quot; : &quot;失败&quot;));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 657     }                                                                                                    </span>
<span class="-3962615333140495301" onmouseenter="enter('-3962615333140495301');" onmouseout="out('-3962615333140495301');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 658     mEntity.setFileName(newName);                                                                        </span>
<span class="5260470821929213762" onmouseenter="enter('5260470821929213762');" onmouseout="out('5260470821929213762');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 659     mEntity.setFilePath(newPath);                                                                        </span>
<span class="552132236643695604" onmouseenter="enter('552132236643695604');" onmouseout="out('552132236643695604');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 660     RecordUtil.modifyTaskRecord(oldFile.getPath(), newPath, mEntity.getTaskType());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 661   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 662                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 663   /**                                                                                                    </span>
<span class="-761470207976407479" onmouseenter="enter('-761470207976407479');" onmouseout="out('-761470207976407479');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 664    * 处理30x跳转                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 665    */                                                                                                    </span>
<span class="5556617621352975519" onmouseenter="enter('5556617621352975519');" onmouseout="out('5556617621352975519');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 666   private void handleUrlReTurn(HttpURLConnection conn, String newUrl) throws IOException {               </span>
<span class="9112975487181986733" onmouseenter="enter('9112975487181986733');" onmouseout="out('9112975487181986733');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 667     ALog.d(TAG, &quot;30x跳转，新url为【&quot; + newUrl + &quot;】&quot;);                                                          </span>
<span class="-3187267727779732659" onmouseenter="enter('-3187267727779732659');" onmouseout="out('-3187267727779732659');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 668     if (TextUtils.isEmpty(newUrl) || newUrl.equalsIgnoreCase(&quot;null&quot;)) {                                  </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 669       if (onFileInfoCallback != null) {                                                                  </span>
<span class="7265698984710319788" onmouseenter="enter('7265698984710319788');" onmouseout="out('7265698984710319788');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 670         onFileInfoCallback.onFail(mEntity, new TaskException(TAG, &quot;获取重定向链接失败&quot;), false);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 671       }                                                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 672       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 673     }                                                                                                    </span>
<span class="-4691236730005429135" onmouseenter="enter('-4691236730005429135');" onmouseout="out('-4691236730005429135');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 674     if (newUrl.startsWith(&quot;/&quot;)) {                                                                        </span>
<span class="-7947437880890249902" onmouseenter="enter('-7947437880890249902');" onmouseout="out('-7947437880890249902');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 675       Uri uri = Uri.parse(mEntity.getUrl());                                                             </span>
<span class="-159008217290066182" onmouseenter="enter('-159008217290066182');" onmouseout="out('-159008217290066182');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 676       newUrl = uri.getHost() + newUrl;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 677     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 678                                                                                                          </span>
<span class="-4197272966192810800" onmouseenter="enter('-4197272966192810800');" onmouseout="out('-4197272966192810800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 679     if (!CheckUtil.checkUrl(newUrl)) {                                                                   </span>
<span class="8671661921003868184" onmouseenter="enter('8671661921003868184');" onmouseout="out('8671661921003868184');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 680       failDownload(new TaskException(TAG, &quot;下载失败，重定向url错误&quot;), false);                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 681       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 682     }                                                                                                    </span>
<span class="2121195664546392305" onmouseenter="enter('2121195664546392305');" onmouseout="out('2121195664546392305');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 683     taskOption.setRedirectUrl(newUrl);                                                                   </span>
<span class="-7202069996221856390" onmouseenter="enter('-7202069996221856390');" onmouseout="out('-7202069996221856390');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 684     mEntity.setRedirect(true);                                                                           </span>
<span class="3562634937094117088" onmouseenter="enter('3562634937094117088');" onmouseout="out('3562634937094117088');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 685     mEntity.setRedirectUrl(newUrl);                                                                      </span>
<span class="-6439352303300997905" onmouseenter="enter('-6439352303300997905');" onmouseout="out('-6439352303300997905');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 686     String cookies = conn.getHeaderField(&quot;Set-Cookie&quot;);                                                  </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 687     conn.disconnect();                                                                                   </span>
<span class="7827815028692387267" onmouseenter="enter('7827815028692387267');" onmouseout="out('7827815028692387267');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 688     URL url = ConnectionHelp.handleUrl(newUrl, taskOption);                                              </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 689     conn = ConnectionHelp.handleConnection(url, taskOption);                                             </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 690     ConnectionHelp.setConnectParam(taskOption, conn);                                                    </span>
<span class="-9082472095175979719" onmouseenter="enter('-9082472095175979719');" onmouseout="out('-9082472095175979719');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 691     conn.setRequestProperty(&quot;Cookie&quot;, cookies);                                                          </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 692     conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                                </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 693     conn.setConnectTimeout(mConnectTimeOut);                                                             </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 694     conn.connect();                                                                                      </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 695     handleConnect(conn);                                                                                 </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 696     conn.disconnect();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 697   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 698                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 699   /**                                                                                                    </span>
<span class="8188732119885086451" onmouseenter="enter('8188732119885086451');" onmouseout="out('8188732119885086451');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 700    * 检查长度是否合法，并且检查新获取的文件长度是否和数据库的文件长度一直，如果不一致，则表示该任务为新任务                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 701    *                                                                                                     </span>
<span class="7508607167277684618" onmouseenter="enter('7508607167277684618');" onmouseout="out('7508607167277684618');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 702    * @param len 从服务器获取的文件长度                                                                              </span>
<span class="2269811577157119944" onmouseenter="enter('2269811577157119944');" onmouseout="out('2269811577157119944');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 703    * @return {@code true}合法                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 704    */                                                                                                    </span>
<span class="226943708538926451" onmouseenter="enter('226943708538926451');" onmouseout="out('226943708538926451');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 705   private boolean checkLen(long len) {                                                                   </span>
<span class="-6834276917361274338" onmouseenter="enter('-6834276917361274338');" onmouseout="out('-6834276917361274338');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 706     if (len != mEntity.getFileSize()) {                                                                  </span>
<span class="7031409428945889302" onmouseenter="enter('7031409428945889302');" onmouseout="out('7031409428945889302');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 707       ALog.d(TAG, &quot;长度不一致，任务为新任务&quot;);                                                                       </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 708       mTaskWrapper.setNewTask(true);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 709     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 710     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712                                                                                                          </span>
<span class="-4015346071016137178" onmouseenter="enter('-4015346071016137178');" onmouseout="out('-4015346071016137178');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 713   private void failDownload(BaseException e, boolean needRetry) {                                        </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 714     if (onFileInfoCallback != null) {                                                                    </span>
<span class="-3744805558345201426" onmouseenter="enter('-3744805558345201426');" onmouseout="out('-3744805558345201426');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 715       onFileInfoCallback.onFail(mEntity, e, needRetry);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 716     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 717   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 718                                                                                                          </span>
<span class="-306327811626166304" onmouseenter="enter('-306327811626166304');" onmouseout="out('-306327811626166304');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 719   private static class FileLenAdapter implements IHttpFileLenAdapter {                                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 720                                                                                                          </span>
<span class="-4968473764170008746" onmouseenter="enter('-4968473764170008746');" onmouseout="out('-4968473764170008746');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 721     @Override public long handleFileLen(Map&lt;String, List&lt;String&gt;&gt; headers) {                             </span>
<span class="-3703403373407617525" onmouseenter="enter('-3703403373407617525');" onmouseout="out('-3703403373407617525');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 722       if (headers == null || headers.isEmpty()) {                                                        </span>
<span class="7978066123796535188" onmouseenter="enter('7978066123796535188');" onmouseout="out('7978066123796535188');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 723         ALog.e(TAG, &quot;header为空，获取文件长度失败&quot;);                                                                </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 724         return -1;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 725       }                                                                                                  </span>
<span class="-3327040667133742279" onmouseenter="enter('-3327040667133742279');" onmouseout="out('-3327040667133742279');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 726       List&lt;String&gt; sLength = headers.get(&quot;Content-Length&quot;);                                              </span>
<span class="-5638961086111332224" onmouseenter="enter('-5638961086111332224');" onmouseout="out('-5638961086111332224');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 727       if (sLength == null || sLength.isEmpty()) {                                                        </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 728         return -1;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 729       }                                                                                                  </span>
<span class="1006906766372690526" onmouseenter="enter('1006906766372690526');" onmouseout="out('1006906766372690526');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 730       String temp = sLength.get(0);                                                                      </span>
<span class="-859592945496577082" onmouseenter="enter('-859592945496577082');" onmouseout="out('-859592945496577082');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 731       long len = TextUtils.isEmpty(temp) ? -1 : Long.parseLong(temp);                                    </span>
<span class="-3482859616975282364" onmouseenter="enter('-3482859616975282364');" onmouseout="out('-3482859616975282364');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 732       // 某些服务，如果设置了conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                 </span>
<span class="-2343886357485900465" onmouseenter="enter('-2343886357485900465');" onmouseout="out('-2343886357485900465');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 733       // 会返回 Content-Range: bytes 0-225427911/225427913                                                  </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 734       if (len &lt; 0) {                                                                                     </span>
<span class="-5449604609323133496" onmouseenter="enter('-5449604609323133496');" onmouseout="out('-5449604609323133496');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 735         List&lt;String&gt; sRange = headers.get(&quot;Content-Range&quot;);                                              </span>
<span class="-939726222710114379" onmouseenter="enter('-939726222710114379');" onmouseout="out('-939726222710114379');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 736         if (sRange == null || sRange.isEmpty()) {                                                        </span>
<span class="-428304200248281464" onmouseenter="enter('-428304200248281464');" onmouseout="out('-428304200248281464');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 737           len = -1;                                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 738         } else {                                                                                         </span>
<span class="-552616904450344700" onmouseenter="enter('-552616904450344700');" onmouseout="out('-552616904450344700');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 739           int start = temp.indexOf(&quot;/&quot;);                                                                 </span>
<span class="6692102738649716212" onmouseenter="enter('6692102738649716212');" onmouseout="out('6692102738649716212');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 740           len = Long.parseLong(temp.substring(start + 1));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 741         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 742       }                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 743                                                                                                          </span>
<span class="7701238698032811091" onmouseenter="enter('7701238698032811091');" onmouseout="out('7701238698032811091');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 744       return len;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 745     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 746   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 747 }                                                                                                        </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 748 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span></pre></td>
                            <td><pre><span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">   2 ||||||| BASE                                                                                             </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17  */                                                                                                      </span>
<span class="-7236899369024788297" onmouseenter="enter('-7236899369024788297');" onmouseout="out('-7236899369024788297');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 package com.arialyy.aria.http;                                                                           </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19                                                                                                          </span>
<span class="-6390350725830347024" onmouseenter="enter('-6390350725830347024');" onmouseout="out('-6390350725830347024');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 import android.net.TrafficStats;                                                                         </span>
<span class="-8750621697125156872" onmouseenter="enter('-8750621697125156872');" onmouseout="out('-8750621697125156872');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import android.net.Uri;                                                                                  </span>
<span class="3485143652294101472" onmouseenter="enter('3485143652294101472');" onmouseout="out('3485143652294101472');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import android.os.Process;                                                                               </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import android.text.TextUtils;                                                                           </span>
<span class="8153369258057528270" onmouseenter="enter('8153369258057528270');" onmouseout="out('8153369258057528270');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import com.arialyy.aria.core.AriaConfig;                                                                 </span>
<span class="5028823532254250595" onmouseenter="enter('5028823532254250595');" onmouseout="out('5028823532254250595');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import com.arialyy.aria.core.common.CompleteInfo;                                                        </span>
<span class="7716102167634407665" onmouseenter="enter('7716102167634407665');" onmouseout="out('7716102167634407665');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import com.arialyy.aria.core.common.RequestEnum;                                                         </span>
<span class="-3497740022528182602" onmouseenter="enter('-3497740022528182602');" onmouseout="out('-3497740022528182602');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import com.arialyy.aria.core.download.DTaskWrapper;                                                      </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import com.arialyy.aria.core.download.DownloadEntity;                                                    </span>
<span class="-5825121975347398532" onmouseenter="enter('-5825121975347398532');" onmouseout="out('-5825121975347398532');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import com.arialyy.aria.core.inf.OnFileInfoCallback;                                                     </span>
<span class="-5191825800443458517" onmouseenter="enter('-5191825800443458517');" onmouseout="out('-5191825800443458517');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import com.arialyy.aria.core.processor.IHttpFileLenAdapter;                                              </span>
<span class="6359380642632041098" onmouseenter="enter('6359380642632041098');" onmouseout="out('6359380642632041098');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import com.arialyy.aria.exception.AriaIOException;                                                       </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import com.arialyy.aria.exception.BaseException;                                                         </span>
<span class="-5001091348570971924" onmouseenter="enter('-5001091348570971924');" onmouseout="out('-5001091348570971924');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import com.arialyy.aria.exception.TaskException;                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import com.arialyy.aria.util.CheckUtil;                                                                  </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import com.arialyy.aria.util.FileUtil;                                                                   </span>
<span class="-969957896094278671" onmouseenter="enter('-969957896094278671');" onmouseout="out('-969957896094278671');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 import com.arialyy.aria.util.RecordUtil;                                                                 </span>
<span class="-4738630423427876475" onmouseenter="enter('-4738630423427876475');" onmouseout="out('-4738630423427876475');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39 import java.io.BufferedReader;                                                                           </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 import java.io.IOException;                                                                              </span>
<span class="-5152338856474932575" onmouseenter="enter('-5152338856474932575');" onmouseout="out('-5152338856474932575');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42 import java.io.InputStreamReader;                                                                        </span>
<span class="3835172898968420800" onmouseenter="enter('3835172898968420800');" onmouseout="out('3835172898968420800');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43 import java.io.OutputStreamWriter;                                                                       </span>
<span class="8256805395213692609" onmouseenter="enter('8256805395213692609');" onmouseout="out('8256805395213692609');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44 import java.io.UnsupportedEncodingException;                                                             </span>
<span class="7759739624588802903" onmouseenter="enter('7759739624588802903');" onmouseout="out('7759739624588802903');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45 import java.net.CookieManager;                                                                           </span>
<span class="-5584619311424941805" onmouseenter="enter('-5584619311424941805');" onmouseout="out('-5584619311424941805');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46 import java.net.HttpCookie;                                                                              </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 import java.net.URL;                                                                                     </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 import java.net.URLDecoder;                                                                              </span>
<span class="302463665162759210" onmouseenter="enter('302463665162759210');" onmouseout="out('302463665162759210');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 import java.net.URLEncoder;                                                                              </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53 import java.util.Set;                                                                                    </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54 import java.util.UUID;                                                                                   </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56 /**                                                                                                      </span>
<span class="-1733864505168931106" onmouseenter="enter('-1733864505168931106');" onmouseout="out('-1733864505168931106');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57  * 下载文件信息获取                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58  */                                                                                                      </span>
<span class="-8507874378969942466" onmouseenter="enter('-8507874378969942466');" onmouseout="out('-8507874378969942466');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 public class HttpFileInfoThread implements Runnable {                                                    </span>
<span class="-960543327724144855" onmouseenter="enter('-960543327724144855');" onmouseout="out('-960543327724144855');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60   private static final String TAG = &quot;HttpFileInfoThread&quot;;                                                </span>
<span class="-7151375780097547664" onmouseenter="enter('-7151375780097547664');" onmouseout="out('-7151375780097547664');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61   private DownloadEntity mEntity;                                                                        </span>
<span class="-3857309927385466618" onmouseenter="enter('-3857309927385466618');" onmouseout="out('-3857309927385466618');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62   private DTaskWrapper mTaskWrapper;                                                                     </span>
<span class="8600882525060240313" onmouseenter="enter('8600882525060240313');" onmouseout="out('8600882525060240313');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63   private int mConnectTimeOut;                                                                           </span>
<span class="-6824755283282820235" onmouseenter="enter('-6824755283282820235');" onmouseout="out('-6824755283282820235');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64   private OnFileInfoCallback onFileInfoCallback;                                                         </span>
<span class="6827268874849985533" onmouseenter="enter('6827268874849985533');" onmouseout="out('6827268874849985533');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65   private HttpTaskOption taskOption;                                                                     </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66                                                                                                          </span>
<span class="-5652336240759927020" onmouseenter="enter('-5652336240759927020');" onmouseout="out('-5652336240759927020');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67   public HttpFileInfoThread(DTaskWrapper taskWrapper, OnFileInfoCallback callback) {                     </span>
<span class="-3805550036651318371" onmouseenter="enter('-3805550036651318371');" onmouseout="out('-3805550036651318371');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68     this.mTaskWrapper = taskWrapper;                                                                     </span>
<span class="-170355754520114419" onmouseenter="enter('-170355754520114419');" onmouseout="out('-170355754520114419');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69     mEntity = taskWrapper.getEntity();                                                                   </span>
<span class="2572452400414830057" onmouseenter="enter('2572452400414830057');" onmouseout="out('2572452400414830057');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70     mConnectTimeOut = AriaConfig.getInstance().getDConfig().getConnectTimeOut();                         </span>
<span class="1217537359294132674" onmouseenter="enter('1217537359294132674');" onmouseout="out('1217537359294132674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71     onFileInfoCallback = callback;                                                                       </span>
<span class="6933673676495207920" onmouseenter="enter('6933673676495207920');" onmouseout="out('6933673676495207920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72     taskOption = (HttpTaskOption) taskWrapper.getTaskOption();                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75   @Override public void run() {                                                                          </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76     Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                       </span>
<span class="-1851318291295515457" onmouseenter="enter('-1851318291295515457');" onmouseout="out('-1851318291295515457');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77     TrafficStats.setThreadStatsTag(UUID.randomUUID().toString().hashCode());                             </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78     HttpURLConnection conn = null;                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79     try {                                                                                                </span>
<span class="7954771811613007401" onmouseenter="enter('7954771811613007401');" onmouseout="out('7954771811613007401');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80       URL url = ConnectionHelp.handleUrl(mEntity.getUrl(), taskOption);                                  </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81       conn = ConnectionHelp.handleConnection(url, taskOption);                                           </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82       ConnectionHelp.setConnectParam(taskOption, conn);                                                  </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83       conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                              </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84       conn.setConnectTimeout(mConnectTimeOut);                                                           </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85       conn.connect();                                                                                    </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86       handleConnect(conn);                                                                               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87     } catch (IOException e) {                                                                            </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88       e.printStackTrace();                                                                               </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="-4053293382299681633" onmouseenter="enter('-4053293382299681633');" onmouseout="out('-4053293382299681633');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90               String.format(&quot;下载失败，filePath: %s, url: %s&quot;, mEntity.getDownloadPath(), mEntity.getUrl())), </span>
<span class="-159362617709534437" onmouseenter="enter('-159362617709534437');" onmouseout="out('-159362617709534437');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91           true);                                                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92     } finally {                                                                                          </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93       if (conn != null) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94         try {                                                                                            </span>
<span class="-8686251500819757648" onmouseenter="enter('-8686251500819757648');" onmouseout="out('-8686251500819757648');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95           conn.getInputStream().close();                                                                 </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96         } catch (IOException e) {                                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97           e.printStackTrace();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98         }                                                                                                </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99         conn.disconnect();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103                                                                                                          </span>
<span class="7469915187822843170" onmouseenter="enter('7469915187822843170');" onmouseout="out('7469915187822843170');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104   private void handleConnect(HttpURLConnection conn) throws IOException {                                </span>
<span class="-5135480308665977678" onmouseenter="enter('-5135480308665977678');" onmouseout="out('-5135480308665977678');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105     if (taskOption.getRequestEnum() == RequestEnum.POST) {                                               </span>
<span class="-5476217355085156421" onmouseenter="enter('-5476217355085156421');" onmouseout="out('-5476217355085156421');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106       Map&lt;String, String&gt; params = taskOption.getParams();                                               </span>
<span class="3157859291963549592" onmouseenter="enter('3157859291963549592');" onmouseout="out('3157859291963549592');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107       if (params != null) {                                                                              </span>
<span class="1177673060067921781" onmouseenter="enter('1177673060067921781');" onmouseout="out('1177673060067921781');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         OutputStreamWriter dos = new OutputStreamWriter(conn.getOutputStream());                         </span>
<span class="-2461846026114443284" onmouseenter="enter('-2461846026114443284');" onmouseout="out('-2461846026114443284');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109         Set&lt;String&gt; keys = params.keySet();                                                              </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111         for (String key : keys) {                                                                        </span>
<span class="-378086891984466400" onmouseenter="enter('-378086891984466400');" onmouseout="out('-378086891984466400');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112           sb.append(key).append(&quot;=&quot;).append(URLEncoder.encode(params.get(key))).append(&quot;&amp;&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113         }                                                                                                </span>
<span class="-1170631941621929173" onmouseenter="enter('-1170631941621929173');" onmouseout="out('-1170631941621929173');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114         String url = sb.toString();                                                                      </span>
<span class="-2854610904289092260" onmouseenter="enter('-2854610904289092260');" onmouseout="out('-2854610904289092260');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115         url = url.substring(0, url.length() - 1);                                                        </span>
<span class="-412821746973687146" onmouseenter="enter('-412821746973687146');" onmouseout="out('-412821746973687146');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116         dos.write(url);                                                                                  </span>
<span class="-6320099346663956498" onmouseenter="enter('-6320099346663956498');" onmouseout="out('-6320099346663956498');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117         dos.flush();                                                                                     </span>
<span class="1568727060082909957" onmouseenter="enter('1568727060082909957');" onmouseout="out('1568727060082909957');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118         dos.close();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121                                                                                                          </span>
<span class="831227310872116523" onmouseenter="enter('831227310872116523');" onmouseout="out('831227310872116523');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122     IHttpFileLenAdapter lenAdapter = taskOption.getFileLenAdapter();                                     </span>
<span class="5196440776228873073" onmouseenter="enter('5196440776228873073');" onmouseout="out('5196440776228873073');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123     if (lenAdapter == null) {                                                                            </span>
<span class="7197457532950740585" onmouseenter="enter('7197457532950740585');" onmouseout="out('7197457532950740585');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124       lenAdapter = new FileLenAdapter();                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125     } else {                                                                                             </span>
<span class="-2288407285072363665" onmouseenter="enter('-2288407285072363665');" onmouseout="out('-2288407285072363665');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126       ALog.d(TAG, &quot;使用自定义adapter&quot;);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127     }                                                                                                    </span>
<span class="-3117441631991498996" onmouseenter="enter('-3117441631991498996');" onmouseout="out('-3117441631991498996');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128     long len = lenAdapter.handleFileLen(conn.getHeaderFields());                                         </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129                                                                                                          </span>
<span class="-1607077255181731471" onmouseenter="enter('-1607077255181731471');" onmouseout="out('-1607077255181731471');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130     if (!FileUtil.checkSDMemorySpace(mEntity.getFilePath(), len)) {                                      </span>
<span class="-1675602595326094546" onmouseenter="enter('-1675602595326094546');" onmouseout="out('-1675602595326094546');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131       failDownload(new TaskException(TAG,                                                                </span>
<span class="380344701162823709" onmouseenter="enter('380344701162823709');" onmouseout="out('380344701162823709');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132           String.format(&quot;下载失败，内存空间不足；filePath: %s, url: %s&quot;, mEntity.getDownloadPath(),                  </span>
<span class="3748007250659926415" onmouseenter="enter('3748007250659926415');" onmouseout="out('3748007250659926415');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133               mEntity.getUrl())), false);                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136                                                                                                          </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137     int code = conn.getResponseCode();                                                                   </span>
<span class="243612440262257064" onmouseenter="enter('243612440262257064');" onmouseout="out('243612440262257064');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138     boolean end = false;                                                                                 </span>
<span class="3661527496298260626" onmouseenter="enter('3661527496298260626');" onmouseout="out('3661527496298260626');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139     if (TextUtils.isEmpty(mEntity.getMd5Code())) {                                                       </span>
<span class="6175847651720741920" onmouseenter="enter('6175847651720741920');" onmouseout="out('6175847651720741920');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140       String md5Code = conn.getHeaderField(&quot;Content-MD5&quot;);                                               </span>
<span class="3841984198412482104" onmouseenter="enter('3841984198412482104');" onmouseout="out('3841984198412482104');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141       mEntity.setMd5Code(md5Code);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143                                                                                                          </span>
<span class="-9137345962727529427" onmouseenter="enter('-9137345962727529427');" onmouseout="out('-9137345962727529427');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144     boolean isChunked = false;                                                                           </span>
<span class="-8116968388415792268" onmouseenter="enter('-8116968388415792268');" onmouseout="out('-8116968388415792268');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145     final String str = conn.getHeaderField(&quot;Transfer-Encoding&quot;);                                         </span>
<span class="-6629832129461298046" onmouseenter="enter('-6629832129461298046');" onmouseout="out('-6629832129461298046');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146     if (!TextUtils.isEmpty(str) &amp;&amp; str.equals(&quot;chunked&quot;)) {                                              </span>
<span class="268583664719475207" onmouseenter="enter('268583664719475207');" onmouseout="out('268583664719475207');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147       isChunked = true;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148     }                                                                                                    </span>
<span class="8180254556269969385" onmouseenter="enter('8180254556269969385');" onmouseout="out('8180254556269969385');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149     Map&lt;String, List&lt;String&gt;&gt; headers = conn.getHeaderFields();                                          </span>
<span class="8122923533236748969" onmouseenter="enter('8122923533236748969');" onmouseout="out('8122923533236748969');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150     String disposition = conn.getHeaderField(&quot;Content-Disposition&quot;);                                     </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151                                                                                                          </span>
<span class="-3052400857632215863" onmouseenter="enter('-3052400857632215863');" onmouseout="out('-3052400857632215863');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152     if (taskOption.isUseServerFileName()) {                                                              </span>
<span class="9149723838126995721" onmouseenter="enter('9149723838126995721');" onmouseout="out('9149723838126995721');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153       if (!TextUtils.isEmpty(disposition)) {                                                             </span>
<span class="3142217124074067362" onmouseenter="enter('3142217124074067362');" onmouseout="out('3142217124074067362');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154         mEntity.setDisposition(CommonUtil.encryptBASE64(disposition));                                   </span>
<span class="8894179749774343207" onmouseenter="enter('8894179749774343207');" onmouseout="out('8894179749774343207');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155         handleContentDisposition(disposition);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156       } else {                                                                                           </span>
<span class="6725831659311340657" onmouseenter="enter('6725831659311340657');" onmouseout="out('6725831659311340657');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157         ALog.w(TAG, &quot;Content-Disposition对于端字段为空，使用服务器端文件名失败&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159     }                                                                                                    </span>
<span class="3131612029960887116" onmouseenter="enter('3131612029960887116');" onmouseout="out('3131612029960887116');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160     CookieManager msCookieManager = new CookieManager();                                                 </span>
<span class="6317541366742429029" onmouseenter="enter('6317541366742429029');" onmouseout="out('6317541366742429029');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161     List&lt;String&gt; cookiesHeader = headers.get(&quot;Set-Cookie&quot;);                                              </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162                                                                                                          </span>
<span class="-3711800334805746628" onmouseenter="enter('-3711800334805746628');" onmouseout="out('-3711800334805746628');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163     if (cookiesHeader != null) {                                                                         </span>
<span class="50137583020384401" onmouseenter="enter('50137583020384401');" onmouseout="out('50137583020384401');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164       for (String cookie : cookiesHeader) {                                                              </span>
<span class="-5052850978727150914" onmouseenter="enter('-5052850978727150914');" onmouseout="out('-5052850978727150914');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165         msCookieManager.getCookieStore().add(null, HttpCookie.parse(cookie).get(0));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166       }                                                                                                  </span>
<span class="-6061807114007929519" onmouseenter="enter('-6061807114007929519');" onmouseout="out('-6061807114007929519');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167       taskOption.setCookieManager(msCookieManager);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169                                                                                                          </span>
<span class="-5434227081099310624" onmouseenter="enter('-5434227081099310624');" onmouseout="out('-5434227081099310624');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170     mTaskWrapper.setCode(code);                                                                          </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171     if (code == HttpURLConnection.HTTP_PARTIAL) {                                                        </span>
<span class="3476352595280537016" onmouseenter="enter('3476352595280537016');" onmouseout="out('3476352595280537016');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172       if (!checkLen(len) &amp;&amp; !isChunked) {                                                                </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173         if (len &lt; 0) {                                                                                   </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174           failDownload(                                                                                  </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175               new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),      </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176               false);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177         }                                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179       }                                                                                                  </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180       mEntity.setFileSize(len);                                                                          </span>
<span class="4333195157428278321" onmouseenter="enter('4333195157428278321');" onmouseout="out('4333195157428278321');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181       mTaskWrapper.setSupportBP(true);                                                                   </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182       end = true;                                                                                        </span>
<span class="2496770639447193327" onmouseenter="enter('2496770639447193327');" onmouseout="out('2496770639447193327');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183     } else if (code == HttpURLConnection.HTTP_OK) {                                                      </span>
<span class="-998567010505343674" onmouseenter="enter('-998567010505343674');" onmouseout="out('-998567010505343674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184       String contentType = conn.getHeaderField(&quot;Content-Type&quot;);                                          </span>
<span class="201076292918755336" onmouseenter="enter('201076292918755336');" onmouseout="out('201076292918755336');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185       if (TextUtils.isEmpty(contentType)) {                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187       }                                                                                                  </span>
<span class="8927907009918172915" onmouseenter="enter('8927907009918172915');" onmouseout="out('8927907009918172915');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188       if (contentType.equals(&quot;text/html&quot;)) {                                                             </span>
<span class="8342413994542158594" onmouseenter="enter('8342413994542158594');" onmouseout="out('8342413994542158594');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189         BufferedReader reader =                                                                          </span>
<span class="-7427210485489972460" onmouseenter="enter('-7427210485489972460');" onmouseout="out('-7427210485489972460');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190             new BufferedReader(new InputStreamReader(ConnectionHelp.convertInputStream(conn)));          </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="6431556981547329060" onmouseenter="enter('6431556981547329060');" onmouseout="out('6431556981547329060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192         String line;                                                                                     </span>
<span class="4058321022246549205" onmouseenter="enter('4058321022246549205');" onmouseout="out('4058321022246549205');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193         while ((line = reader.readLine()) != null) {                                                     </span>
<span class="-6213624305830265937" onmouseenter="enter('-6213624305830265937');" onmouseout="out('-6213624305830265937');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194           sb.append(line);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195         }                                                                                                </span>
<span class="8277398435538005537" onmouseenter="enter('8277398435538005537');" onmouseout="out('8277398435538005537');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196         reader.close();                                                                                  </span>
<span class="8311106050401029529" onmouseenter="enter('8311106050401029529');" onmouseout="out('8311106050401029529');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197         handleUrlReTurn(conn, CommonUtil.getWindowReplaceUrl(sb.toString()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198         return;                                                                                          </span>
<span class="-4432363278840297326" onmouseenter="enter('-4432363278840297326');" onmouseout="out('-4432363278840297326');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199       } else if (!checkLen(len) &amp;&amp; !isChunked) {                                                         </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200         if (len &lt; 0) {                                                                                   </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201           failDownload(                                                                                  </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202               new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),      </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203               false);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204         }                                                                                                </span>
<span class="1925321240779458317" onmouseenter="enter('1925321240779458317');" onmouseout="out('1925321240779458317');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205         ALog.d(TAG, &quot;len &lt; 0&quot;);                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207       }                                                                                                  </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208       mEntity.setFileSize(len);                                                                          </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209       mTaskWrapper.setNewTask(true);                                                                     </span>
<span class="9157524552034725227" onmouseenter="enter('9157524552034725227');" onmouseout="out('9157524552034725227');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210       mTaskWrapper.setSupportBP(false);                                                                  </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211       end = true;                                                                                        </span>
<span class="1848064821034278655" onmouseenter="enter('1848064821034278655');" onmouseout="out('1848064821034278655');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212     } else if (code == HttpURLConnection.HTTP_NOT_FOUND) {                                               </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="-2250251533714311872" onmouseenter="enter('-2250251533714311872');" onmouseout="out('-2250251533714311872');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214           String.format(&quot;任务下载失败，errorCode：404, url: %s&quot;, mEntity.getUrl())), true);                      </span>
<span class="7269465454949275689" onmouseenter="enter('7269465454949275689');" onmouseout="out('7269465454949275689');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215     } else if (code == HttpURLConnection.HTTP_MOVED_TEMP                                                 </span>
<span class="-6032747441450584852" onmouseenter="enter('-6032747441450584852');" onmouseout="out('-6032747441450584852');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216         || code == HttpURLConnection.HTTP_MOVED_PERM                                                     </span>
<span class="6529484345882801441" onmouseenter="enter('6529484345882801441');" onmouseout="out('6529484345882801441');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217         || code == HttpURLConnection.HTTP_SEE_OTHER                                                      </span>
<span class="-5614885484106173463" onmouseenter="enter('-5614885484106173463');" onmouseout="out('-5614885484106173463');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218         || code == HttpURLConnection.HTTP_CREATED // 201 跳转                                              </span>
<span class="-1964089336962903701" onmouseenter="enter('-1964089336962903701');" onmouseout="out('-1964089336962903701');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219         || code == 307) {                                                                                </span>
<span class="582471876420463974" onmouseenter="enter('582471876420463974');" onmouseout="out('582471876420463974');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220       handleUrlReTurn(conn, conn.getHeaderField(&quot;Location&quot;));                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221     } else {                                                                                             </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="3458281120857355945" onmouseenter="enter('3458281120857355945');" onmouseout="out('3458281120857355945');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223           String.format(&quot;任务下载失败，errorCode：%s, errorMsg: %s, url: %s&quot;, code,                              </span>
<span class="-865670794746359823" onmouseenter="enter('-865670794746359823');" onmouseout="out('-865670794746359823');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224               conn.getResponseMessage(), mEntity.getUrl())), !CheckUtil.httpIsBadRequest(code));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225     }                                                                                                    </span>
<span class="-6801527756571482213" onmouseenter="enter('-6801527756571482213');" onmouseout="out('-6801527756571482213');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226     if (end) {                                                                                           </span>
<span class="-9049555213483660293" onmouseenter="enter('-9049555213483660293');" onmouseout="out('-9049555213483660293');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227       taskOption.setChunked(isChunked);                                                                  </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228       if (onFileInfoCallback != null) {                                                                  </span>
<span class="-3029323004951684182" onmouseenter="enter('-3029323004951684182');" onmouseout="out('-3029323004951684182');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229         CompleteInfo info = new CompleteInfo(code, mTaskWrapper);                                        </span>
<span class="1239392088731349048" onmouseenter="enter('1239392088731349048');" onmouseout="out('1239392088731349048');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230         onFileInfoCallback.onComplete(mEntity.getUrl(), info);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231       }                                                                                                  </span>
<span class="-2332174823472847291" onmouseenter="enter('-2332174823472847291');" onmouseout="out('-2332174823472847291');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232       mEntity.update();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236   /**                                                                                                    </span>
<span class="-2847240885661455178" onmouseenter="enter('-2847240885661455178');" onmouseout="out('-2847240885661455178');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237    * 处理&quot;Content-Disposition&quot;参数                                                                           </span>
<span class="8881865652474859794" onmouseenter="enter('8881865652474859794');" onmouseout="out('8881865652474859794');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238    * &lt;a href=https://cloud.tencent.com/developer/section/1189916&gt;Content-Disposition&lt;/a&gt;&lt;/&gt;              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239    *                                                                                                     </span>
<span class="-7776712758593145643" onmouseenter="enter('-7776712758593145643');" onmouseout="out('-7776712758593145643');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240    * @throws UnsupportedEncodingException                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241    */                                                                                                    </span>
<span class="-8608321373459550338" onmouseenter="enter('-8608321373459550338');" onmouseout="out('-8608321373459550338');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242   private void handleContentDisposition(String disposition) throws UnsupportedEncodingException {        </span>
<span class="8299914696584334305" onmouseenter="enter('8299914696584334305');" onmouseout="out('8299914696584334305');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243     if (disposition.contains(&quot;;&quot;)) {                                                                     </span>
<span class="-8249279439551045927" onmouseenter="enter('-8249279439551045927');" onmouseout="out('-8249279439551045927');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244       String[] infos = disposition.split(&quot;;&quot;);                                                           </span>
<span class="2055683922126838823" onmouseenter="enter('2055683922126838823');" onmouseout="out('2055683922126838823');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245       if (infos[0].equals(&quot;attachment&quot;)) {                                                               </span>
<span class="-6108489956922562466" onmouseenter="enter('-6108489956922562466');" onmouseout="out('-6108489956922562466');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246         for (String info : infos) {                                                                      </span>
<span class="-3445363461731907777" onmouseenter="enter('-3445363461731907777');" onmouseout="out('-3445363461731907777');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247           if (info.startsWith(&quot;filename&quot;) &amp;&amp; info.contains(&quot;=&quot;)) {                                       </span>
<span class="3695771658612668290" onmouseenter="enter('3695771658612668290');" onmouseout="out('3695771658612668290');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248             String[] temp = info.split(&quot;=&quot;);                                                             </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249             if (temp.length &gt; 1) {                                                                       </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250               String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                 </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251               mEntity.setServerFileName(newName);                                                        </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252               renameFile(newName);                                                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253               break;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256         }                                                                                                </span>
<span class="6794164660951287492" onmouseenter="enter('6794164660951287492');" onmouseout="out('6794164660951287492');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257       } else if (infos[0].equals(&quot;form-data&quot;) &amp;&amp; infos.length &gt; 2) {                                     </span>
<span class="-8905252974632201641" onmouseenter="enter('-8905252974632201641');" onmouseout="out('-8905252974632201641');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258         String[] temp = infos[2].split(&quot;=&quot;);                                                             </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259         if (temp.length &gt; 1) {                                                                           </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260           String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                     </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261           mEntity.setServerFileName(newName);                                                            </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262           renameFile(newName);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264       } else {                                                                                           </span>
<span class="7479053829749492027" onmouseenter="enter('7479053829749492027');" onmouseout="out('7479053829749492027');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265         ALog.w(TAG, &quot;不识别的Content-Disposition参数&quot;);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270   /**                                                                                                    </span>
<span class="-5538524699876672002" onmouseenter="enter('-5538524699876672002');" onmouseout="out('-5538524699876672002');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271    * 重命名文件                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272    */                                                                                                    </span>
<span class="-7899950182898562290" onmouseenter="enter('-7899950182898562290');" onmouseout="out('-7899950182898562290');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273   private void renameFile(String newName) {                                                              </span>
<span class="4040095654750429587" onmouseenter="enter('4040095654750429587');" onmouseout="out('4040095654750429587');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274     if (TextUtils.isEmpty(newName)) {                                                                    </span>
<span class="7746921739080291575" onmouseenter="enter('7746921739080291575');" onmouseout="out('7746921739080291575');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275       ALog.w(TAG, &quot;重命名失败【服务器返回的文件名为空】&quot;);                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277     }                                                                                                    </span>
<span class="-897821573073116237" onmouseenter="enter('-897821573073116237');" onmouseout="out('-897821573073116237');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278     ALog.d(TAG, String.format(&quot;文件重命名为：%s&quot;, newName));                                                    </span>
<span class="3112348380249890188" onmouseenter="enter('3112348380249890188');" onmouseout="out('3112348380249890188');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279     File oldFile = new File(mEntity.getFilePath());                                                      </span>
<span class="6384479286325830175" onmouseenter="enter('6384479286325830175');" onmouseout="out('6384479286325830175');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280     String newPath = oldFile.getParent() + &quot;/&quot; + newName;                                                </span>
<span class="-8664365027300439044" onmouseenter="enter('-8664365027300439044');" onmouseout="out('-8664365027300439044');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281     if (oldFile.exists()) {                                                                              </span>
<span class="-2839507751750912779" onmouseenter="enter('-2839507751750912779');" onmouseout="out('-2839507751750912779');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282       boolean b = oldFile.renameTo(new File(newPath));                                                   </span>
<span class="1440136229140496041" onmouseenter="enter('1440136229140496041');" onmouseout="out('1440136229140496041');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283       ALog.d(TAG, String.format(&quot;文件重命名%s&quot;, b ? &quot;成功&quot; : &quot;失败&quot;));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284     }                                                                                                    </span>
<span class="-3962615333140495301" onmouseenter="enter('-3962615333140495301');" onmouseout="out('-3962615333140495301');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285     mEntity.setFileName(newName);                                                                        </span>
<span class="5260470821929213762" onmouseenter="enter('5260470821929213762');" onmouseout="out('5260470821929213762');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286     mEntity.setFilePath(newPath);                                                                        </span>
<span class="552132236643695604" onmouseenter="enter('552132236643695604');" onmouseout="out('552132236643695604');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287     RecordUtil.modifyTaskRecord(oldFile.getPath(), newPath, mEntity.getTaskType());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290   /**                                                                                                    </span>
<span class="-761470207976407479" onmouseenter="enter('-761470207976407479');" onmouseout="out('-761470207976407479');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291    * 处理30x跳转                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292    */                                                                                                    </span>
<span class="5556617621352975519" onmouseenter="enter('5556617621352975519');" onmouseout="out('5556617621352975519');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293   private void handleUrlReTurn(HttpURLConnection conn, String newUrl) throws IOException {               </span>
<span class="9112975487181986733" onmouseenter="enter('9112975487181986733');" onmouseout="out('9112975487181986733');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294     ALog.d(TAG, &quot;30x跳转，新url为【&quot; + newUrl + &quot;】&quot;);                                                          </span>
<span class="-3187267727779732659" onmouseenter="enter('-3187267727779732659');" onmouseout="out('-3187267727779732659');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295     if (TextUtils.isEmpty(newUrl) || newUrl.equalsIgnoreCase(&quot;null&quot;)) {                                  </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296       if (onFileInfoCallback != null) {                                                                  </span>
<span class="7265698984710319788" onmouseenter="enter('7265698984710319788');" onmouseout="out('7265698984710319788');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297         onFileInfoCallback.onFail(mEntity, new TaskException(TAG, &quot;获取重定向链接失败&quot;), false);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298       }                                                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300     }                                                                                                    </span>
<span class="-4691236730005429135" onmouseenter="enter('-4691236730005429135');" onmouseout="out('-4691236730005429135');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301     if (newUrl.startsWith(&quot;/&quot;)) {                                                                        </span>
<span class="-7947437880890249902" onmouseenter="enter('-7947437880890249902');" onmouseout="out('-7947437880890249902');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302       Uri uri = Uri.parse(mEntity.getUrl());                                                             </span>
<span class="-159008217290066182" onmouseenter="enter('-159008217290066182');" onmouseout="out('-159008217290066182');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303       newUrl = uri.getHost() + newUrl;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305                                                                                                          </span>
<span class="-4197272966192810800" onmouseenter="enter('-4197272966192810800');" onmouseout="out('-4197272966192810800');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306     if (!CheckUtil.checkUrl(newUrl)) {                                                                   </span>
<span class="8671661921003868184" onmouseenter="enter('8671661921003868184');" onmouseout="out('8671661921003868184');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307       failDownload(new TaskException(TAG, &quot;下载失败，重定向url错误&quot;), false);                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309     }                                                                                                    </span>
<span class="2121195664546392305" onmouseenter="enter('2121195664546392305');" onmouseout="out('2121195664546392305');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310     taskOption.setRedirectUrl(newUrl);                                                                   </span>
<span class="-7202069996221856390" onmouseenter="enter('-7202069996221856390');" onmouseout="out('-7202069996221856390');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311     mEntity.setRedirect(true);                                                                           </span>
<span class="3562634937094117088" onmouseenter="enter('3562634937094117088');" onmouseout="out('3562634937094117088');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312     mEntity.setRedirectUrl(newUrl);                                                                      </span>
<span class="-6439352303300997905" onmouseenter="enter('-6439352303300997905');" onmouseout="out('-6439352303300997905');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313     String cookies = conn.getHeaderField(&quot;Set-Cookie&quot;);                                                  </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314     conn.disconnect();                                                                                   </span>
<span class="7827815028692387267" onmouseenter="enter('7827815028692387267');" onmouseout="out('7827815028692387267');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315     URL url = ConnectionHelp.handleUrl(newUrl, taskOption);                                              </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316     conn = ConnectionHelp.handleConnection(url, taskOption);                                             </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317     ConnectionHelp.setConnectParam(taskOption, conn);                                                    </span>
<span class="-9082472095175979719" onmouseenter="enter('-9082472095175979719');" onmouseout="out('-9082472095175979719');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318     conn.setRequestProperty(&quot;Cookie&quot;, cookies);                                                          </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319     conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                                </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320     conn.setConnectTimeout(mConnectTimeOut);                                                             </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321     conn.connect();                                                                                      </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322     handleConnect(conn);                                                                                 </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323     conn.disconnect();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326   /**                                                                                                    </span>
<span class="8188732119885086451" onmouseenter="enter('8188732119885086451');" onmouseout="out('8188732119885086451');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327    * 检查长度是否合法，并且检查新获取的文件长度是否和数据库的文件长度一直，如果不一致，则表示该任务为新任务                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328    *                                                                                                     </span>
<span class="7508607167277684618" onmouseenter="enter('7508607167277684618');" onmouseout="out('7508607167277684618');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329    * @param len 从服务器获取的文件长度                                                                              </span>
<span class="2269811577157119944" onmouseenter="enter('2269811577157119944');" onmouseout="out('2269811577157119944');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330    * @return {@code true}合法                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331    */                                                                                                    </span>
<span class="226943708538926451" onmouseenter="enter('226943708538926451');" onmouseout="out('226943708538926451');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332   private boolean checkLen(long len) {                                                                   </span>
<span class="-6834276917361274338" onmouseenter="enter('-6834276917361274338');" onmouseout="out('-6834276917361274338');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333     if (len != mEntity.getFileSize()) {                                                                  </span>
<span class="7031409428945889302" onmouseenter="enter('7031409428945889302');" onmouseout="out('7031409428945889302');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334       ALog.d(TAG, &quot;长度不一致，任务为新任务&quot;);                                                                       </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335       mTaskWrapper.setNewTask(true);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339                                                                                                          </span>
<span class="-4015346071016137178" onmouseenter="enter('-4015346071016137178');" onmouseout="out('-4015346071016137178');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340   private void failDownload(BaseException e, boolean needRetry) {                                        </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341     if (onFileInfoCallback != null) {                                                                    </span>
<span class="-3744805558345201426" onmouseenter="enter('-3744805558345201426');" onmouseout="out('-3744805558345201426');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342       onFileInfoCallback.onFail(mEntity, e, needRetry);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345                                                                                                          </span>
<span class="-306327811626166304" onmouseenter="enter('-306327811626166304');" onmouseout="out('-306327811626166304');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346   private static class FileLenAdapter implements IHttpFileLenAdapter {                                   </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347                                                                                                          </span>
<span class="-4968473764170008746" onmouseenter="enter('-4968473764170008746');" onmouseout="out('-4968473764170008746');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348     @Override public long handleFileLen(Map&lt;String, List&lt;String&gt;&gt; headers) {                             </span>
<span class="-3703403373407617525" onmouseenter="enter('-3703403373407617525');" onmouseout="out('-3703403373407617525');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349       if (headers == null || headers.isEmpty()) {                                                        </span>
<span class="7978066123796535188" onmouseenter="enter('7978066123796535188');" onmouseout="out('7978066123796535188');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350         ALog.e(TAG, &quot;header为空，获取文件长度失败&quot;);                                                                </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351         return -1;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352       }                                                                                                  </span>
<span class="-3327040667133742279" onmouseenter="enter('-3327040667133742279');" onmouseout="out('-3327040667133742279');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353       List&lt;String&gt; sLength = headers.get(&quot;Content-Length&quot;);                                              </span>
<span class="-5638961086111332224" onmouseenter="enter('-5638961086111332224');" onmouseout="out('-5638961086111332224');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354       if (sLength == null || sLength.isEmpty()) {                                                        </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355         return -1;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356       }                                                                                                  </span>
<span class="1006906766372690526" onmouseenter="enter('1006906766372690526');" onmouseout="out('1006906766372690526');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357       String temp = sLength.get(0);                                                                      </span>
<span class="-859592945496577082" onmouseenter="enter('-859592945496577082');" onmouseout="out('-859592945496577082');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358       long len = TextUtils.isEmpty(temp) ? -1 : Long.parseLong(temp);                                    </span>
<span class="-3482859616975282364" onmouseenter="enter('-3482859616975282364');" onmouseout="out('-3482859616975282364');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359       // 某些服务，如果设置了conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                 </span>
<span class="-2343886357485900465" onmouseenter="enter('-2343886357485900465');" onmouseout="out('-2343886357485900465');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360       // 会返回 Content-Range: bytes 0-225427911/225427913                                                  </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361       if (len &lt; 0) {                                                                                     </span>
<span class="-5449604609323133496" onmouseenter="enter('-5449604609323133496');" onmouseout="out('-5449604609323133496');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362         List&lt;String&gt; sRange = headers.get(&quot;Content-Range&quot;);                                              </span>
<span class="-939726222710114379" onmouseenter="enter('-939726222710114379');" onmouseout="out('-939726222710114379');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363         if (sRange == null || sRange.isEmpty()) {                                                        </span>
<span class="-428304200248281464" onmouseenter="enter('-428304200248281464');" onmouseout="out('-428304200248281464');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364           len = -1;                                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365         } else {                                                                                         </span>
<span class="-552616904450344700" onmouseenter="enter('-552616904450344700');" onmouseout="out('-552616904450344700');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366           int start = temp.indexOf(&quot;/&quot;);                                                                 </span>
<span class="6692102738649716212" onmouseenter="enter('6692102738649716212');" onmouseout="out('6692102738649716212');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367           len = Long.parseLong(temp.substring(start + 1));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369       }                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370                                                                                                          </span>
<span class="7701238698032811091" onmouseenter="enter('7701238698032811091');" onmouseout="out('7701238698032811091');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371       return len;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 374 }                                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 375 =======                                                                                                  </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390  */                                                                                                      </span>
<span class="-7236899369024788297" onmouseenter="enter('-7236899369024788297');" onmouseout="out('-7236899369024788297');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391 package com.arialyy.aria.http;                                                                           </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392                                                                                                          </span>
<span class="-6390350725830347024" onmouseenter="enter('-6390350725830347024');" onmouseout="out('-6390350725830347024');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393 import android.net.TrafficStats;                                                                         </span>
<span class="-8750621697125156872" onmouseenter="enter('-8750621697125156872');" onmouseout="out('-8750621697125156872');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394 import android.net.Uri;                                                                                  </span>
<span class="3485143652294101472" onmouseenter="enter('3485143652294101472');" onmouseout="out('3485143652294101472');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395 import android.os.Process;                                                                               </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 396 import android.text.TextUtils;                                                                           </span>
<span class="8153369258057528270" onmouseenter="enter('8153369258057528270');" onmouseout="out('8153369258057528270');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 397 import com.arialyy.aria.core.AriaConfig;                                                                 </span>
<span class="5028823532254250595" onmouseenter="enter('5028823532254250595');" onmouseout="out('5028823532254250595');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398 import com.arialyy.aria.core.common.CompleteInfo;                                                        </span>
<span class="7716102167634407665" onmouseenter="enter('7716102167634407665');" onmouseout="out('7716102167634407665');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399 import com.arialyy.aria.core.common.RequestEnum;                                                         </span>
<span class="-3497740022528182602" onmouseenter="enter('-3497740022528182602');" onmouseout="out('-3497740022528182602');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 400 import com.arialyy.aria.core.download.DTaskWrapper;                                                      </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 401 import com.arialyy.aria.core.download.DownloadEntity;                                                    </span>
<span class="-5825121975347398532" onmouseenter="enter('-5825121975347398532');" onmouseout="out('-5825121975347398532');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402 import com.arialyy.aria.core.inf.OnFileInfoCallback;                                                     </span>
<span class="-5191825800443458517" onmouseenter="enter('-5191825800443458517');" onmouseout="out('-5191825800443458517');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403 import com.arialyy.aria.core.processor.IHttpFileLenAdapter;                                              </span>
<span class="6359380642632041098" onmouseenter="enter('6359380642632041098');" onmouseout="out('6359380642632041098');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404 import com.arialyy.aria.exception.AriaIOException;                                                       </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405 import com.arialyy.aria.exception.BaseException;                                                         </span>
<span class="-5001091348570971924" onmouseenter="enter('-5001091348570971924');" onmouseout="out('-5001091348570971924');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406 import com.arialyy.aria.exception.TaskException;                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 407 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 408 import com.arialyy.aria.util.CheckUtil;                                                                  </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410 import com.arialyy.aria.util.FileUtil;                                                                   </span>
<span class="-969957896094278671" onmouseenter="enter('-969957896094278671');" onmouseout="out('-969957896094278671');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411 import com.arialyy.aria.util.RecordUtil;                                                                 </span>
<span class="-4738630423427876475" onmouseenter="enter('-4738630423427876475');" onmouseout="out('-4738630423427876475');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412 import java.io.BufferedReader;                                                                           </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414 import java.io.IOException;                                                                              </span>
<span class="-5152338856474932575" onmouseenter="enter('-5152338856474932575');" onmouseout="out('-5152338856474932575');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 415 import java.io.InputStreamReader;                                                                        </span>
<span class="3835172898968420800" onmouseenter="enter('3835172898968420800');" onmouseout="out('3835172898968420800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416 import java.io.OutputStreamWriter;                                                                       </span>
<span class="8256805395213692609" onmouseenter="enter('8256805395213692609');" onmouseout="out('8256805395213692609');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417 import java.io.UnsupportedEncodingException;                                                             </span>
<span class="7759739624588802903" onmouseenter="enter('7759739624588802903');" onmouseout="out('7759739624588802903');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418 import java.net.CookieManager;                                                                           </span>
<span class="-5584619311424941805" onmouseenter="enter('-5584619311424941805');" onmouseout="out('-5584619311424941805');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419 import java.net.HttpCookie;                                                                              </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 421 import java.net.URL;                                                                                     </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422 import java.net.URLDecoder;                                                                              </span>
<span class="302463665162759210" onmouseenter="enter('302463665162759210');" onmouseout="out('302463665162759210');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423 import java.net.URLEncoder;                                                                              </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 426 import java.util.Set;                                                                                    </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427 import java.util.UUID;                                                                                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 428                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429 /**                                                                                                      </span>
<span class="-1733864505168931106" onmouseenter="enter('-1733864505168931106');" onmouseout="out('-1733864505168931106');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430  * 下载文件信息获取                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431  */                                                                                                      </span>
<span class="-8507874378969942466" onmouseenter="enter('-8507874378969942466');" onmouseout="out('-8507874378969942466');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432 public class HttpFileInfoThread implements Runnable {                                                    </span>
<span class="-960543327724144855" onmouseenter="enter('-960543327724144855');" onmouseout="out('-960543327724144855');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433   private static final String TAG = &quot;HttpFileInfoThread&quot;;                                                </span>
<span class="-7151375780097547664" onmouseenter="enter('-7151375780097547664');" onmouseout="out('-7151375780097547664');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434   private DownloadEntity mEntity;                                                                        </span>
<span class="-3857309927385466618" onmouseenter="enter('-3857309927385466618');" onmouseout="out('-3857309927385466618');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435   private DTaskWrapper mTaskWrapper;                                                                     </span>
<span class="8600882525060240313" onmouseenter="enter('8600882525060240313');" onmouseout="out('8600882525060240313');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436   private int mConnectTimeOut;                                                                           </span>
<span class="-6824755283282820235" onmouseenter="enter('-6824755283282820235');" onmouseout="out('-6824755283282820235');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437   private OnFileInfoCallback onFileInfoCallback;                                                         </span>
<span class="6827268874849985533" onmouseenter="enter('6827268874849985533');" onmouseout="out('6827268874849985533');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438   private HttpTaskOption taskOption;                                                                     </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439                                                                                                          </span>
<span class="-5652336240759927020" onmouseenter="enter('-5652336240759927020');" onmouseout="out('-5652336240759927020');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440   public HttpFileInfoThread(DTaskWrapper taskWrapper, OnFileInfoCallback callback) {                     </span>
<span class="-3805550036651318371" onmouseenter="enter('-3805550036651318371');" onmouseout="out('-3805550036651318371');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441     this.mTaskWrapper = taskWrapper;                                                                     </span>
<span class="-170355754520114419" onmouseenter="enter('-170355754520114419');" onmouseout="out('-170355754520114419');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442     mEntity = taskWrapper.getEntity();                                                                   </span>
<span class="2572452400414830057" onmouseenter="enter('2572452400414830057');" onmouseout="out('2572452400414830057');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443     mConnectTimeOut = AriaConfig.getInstance().getDConfig().getConnectTimeOut();                         </span>
<span class="1217537359294132674" onmouseenter="enter('1217537359294132674');" onmouseout="out('1217537359294132674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444     onFileInfoCallback = callback;                                                                       </span>
<span class="6933673676495207920" onmouseenter="enter('6933673676495207920');" onmouseout="out('6933673676495207920');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 445     taskOption = (HttpTaskOption) taskWrapper.getTaskOption();                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 446   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 447                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 448   @Override public void run() {                                                                          </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 449     Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                       </span>
<span class="-1851318291295515457" onmouseenter="enter('-1851318291295515457');" onmouseout="out('-1851318291295515457');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 450     TrafficStats.setThreadStatsTag(UUID.randomUUID().toString().hashCode());                             </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 451     HttpURLConnection conn = null;                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 452     try {                                                                                                </span>
<span class="7954771811613007401" onmouseenter="enter('7954771811613007401');" onmouseout="out('7954771811613007401');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 453       URL url = ConnectionHelp.handleUrl(mEntity.getUrl(), taskOption);                                  </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 454       conn = ConnectionHelp.handleConnection(url, taskOption);                                           </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 455       ConnectionHelp.setConnectParam(taskOption, conn);                                                  </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 456       conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                              </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 457       conn.setConnectTimeout(mConnectTimeOut);                                                           </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 458       conn.connect();                                                                                    </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 459       handleConnect(conn);                                                                               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 460     } catch (IOException e) {                                                                            </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 461       e.printStackTrace();                                                                               </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 462       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="-4053293382299681633" onmouseenter="enter('-4053293382299681633');" onmouseout="out('-4053293382299681633');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 463               String.format(&quot;下载失败，filePath: %s, url: %s&quot;, mEntity.getDownloadPath(), mEntity.getUrl())), </span>
<span class="-159362617709534437" onmouseenter="enter('-159362617709534437');" onmouseout="out('-159362617709534437');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 464           true);                                                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 465     } finally {                                                                                          </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 466       if (conn != null) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 467         try {                                                                                            </span>
<span class="-8686251500819757648" onmouseenter="enter('-8686251500819757648');" onmouseout="out('-8686251500819757648');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 468           conn.getInputStream().close();                                                                 </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 469         } catch (IOException e) {                                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 470           e.printStackTrace();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 471         }                                                                                                </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 472         conn.disconnect();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 473       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 474     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 475   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 476                                                                                                          </span>
<span class="7469915187822843170" onmouseenter="enter('7469915187822843170');" onmouseout="out('7469915187822843170');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 477   private void handleConnect(HttpURLConnection conn) throws IOException {                                </span>
<span class="-5135480308665977678" onmouseenter="enter('-5135480308665977678');" onmouseout="out('-5135480308665977678');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 478     if (taskOption.getRequestEnum() == RequestEnum.POST) {                                               </span>
<span class="-5476217355085156421" onmouseenter="enter('-5476217355085156421');" onmouseout="out('-5476217355085156421');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 479       Map&lt;String, String&gt; params = taskOption.getParams();                                               </span>
<span class="3157859291963549592" onmouseenter="enter('3157859291963549592');" onmouseout="out('3157859291963549592');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 480       if (params != null) {                                                                              </span>
<span class="1177673060067921781" onmouseenter="enter('1177673060067921781');" onmouseout="out('1177673060067921781');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 481         OutputStreamWriter dos = new OutputStreamWriter(conn.getOutputStream());                         </span>
<span class="-2461846026114443284" onmouseenter="enter('-2461846026114443284');" onmouseout="out('-2461846026114443284');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 482         Set&lt;String&gt; keys = params.keySet();                                                              </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 483         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 484         for (String key : keys) {                                                                        </span>
<span class="-378086891984466400" onmouseenter="enter('-378086891984466400');" onmouseout="out('-378086891984466400');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 485           sb.append(key).append(&quot;=&quot;).append(URLEncoder.encode(params.get(key))).append(&quot;&amp;&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 486         }                                                                                                </span>
<span class="-1170631941621929173" onmouseenter="enter('-1170631941621929173');" onmouseout="out('-1170631941621929173');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 487         String url = sb.toString();                                                                      </span>
<span class="-2854610904289092260" onmouseenter="enter('-2854610904289092260');" onmouseout="out('-2854610904289092260');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 488         url = url.substring(0, url.length() - 1);                                                        </span>
<span class="-412821746973687146" onmouseenter="enter('-412821746973687146');" onmouseout="out('-412821746973687146');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 489         dos.write(url);                                                                                  </span>
<span class="-6320099346663956498" onmouseenter="enter('-6320099346663956498');" onmouseout="out('-6320099346663956498');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 490         dos.flush();                                                                                     </span>
<span class="1568727060082909957" onmouseenter="enter('1568727060082909957');" onmouseout="out('1568727060082909957');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 491         dos.close();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 492       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 493     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 494                                                                                                          </span>
<span class="831227310872116523" onmouseenter="enter('831227310872116523');" onmouseout="out('831227310872116523');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 495     IHttpFileLenAdapter lenAdapter = taskOption.getFileLenAdapter();                                     </span>
<span class="5196440776228873073" onmouseenter="enter('5196440776228873073');" onmouseout="out('5196440776228873073');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 496     if (lenAdapter == null) {                                                                            </span>
<span class="7197457532950740585" onmouseenter="enter('7197457532950740585');" onmouseout="out('7197457532950740585');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 497       lenAdapter = new FileLenAdapter();                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 498     } else {                                                                                             </span>
<span class="-2288407285072363665" onmouseenter="enter('-2288407285072363665');" onmouseout="out('-2288407285072363665');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 499       ALog.d(TAG, &quot;使用自定义adapter&quot;);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 500     }                                                                                                    </span>
<span class="-3117441631991498996" onmouseenter="enter('-3117441631991498996');" onmouseout="out('-3117441631991498996');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 501     long len = lenAdapter.handleFileLen(conn.getHeaderFields());                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 502                                                                                                          </span>
<span class="57392966174497577" onmouseenter="enter('57392966174497577');" onmouseout="out('57392966174497577');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 503     if (!FileUtil.checkMemorySpace(mEntity.getFilePath(), len)) {                                        </span>
<span class="-1675602595326094546" onmouseenter="enter('-1675602595326094546');" onmouseout="out('-1675602595326094546');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 504       failDownload(new TaskException(TAG,                                                                </span>
<span class="380344701162823709" onmouseenter="enter('380344701162823709');" onmouseout="out('380344701162823709');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505           String.format(&quot;下载失败，内存空间不足；filePath: %s, url: %s&quot;, mEntity.getDownloadPath(),                  </span>
<span class="3748007250659926415" onmouseenter="enter('3748007250659926415');" onmouseout="out('3748007250659926415');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506               mEntity.getUrl())), false);                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509                                                                                                          </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510     int code = conn.getResponseCode();                                                                   </span>
<span class="243612440262257064" onmouseenter="enter('243612440262257064');" onmouseout="out('243612440262257064');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511     boolean end = false;                                                                                 </span>
<span class="3661527496298260626" onmouseenter="enter('3661527496298260626');" onmouseout="out('3661527496298260626');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512     if (TextUtils.isEmpty(mEntity.getMd5Code())) {                                                       </span>
<span class="6175847651720741920" onmouseenter="enter('6175847651720741920');" onmouseout="out('6175847651720741920');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513       String md5Code = conn.getHeaderField(&quot;Content-MD5&quot;);                                               </span>
<span class="3841984198412482104" onmouseenter="enter('3841984198412482104');" onmouseout="out('3841984198412482104');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514       mEntity.setMd5Code(md5Code);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516                                                                                                          </span>
<span class="-9137345962727529427" onmouseenter="enter('-9137345962727529427');" onmouseout="out('-9137345962727529427');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517     boolean isChunked = false;                                                                           </span>
<span class="-8116968388415792268" onmouseenter="enter('-8116968388415792268');" onmouseout="out('-8116968388415792268');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518     final String str = conn.getHeaderField(&quot;Transfer-Encoding&quot;);                                         </span>
<span class="-6629832129461298046" onmouseenter="enter('-6629832129461298046');" onmouseout="out('-6629832129461298046');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519     if (!TextUtils.isEmpty(str) &amp;&amp; str.equals(&quot;chunked&quot;)) {                                              </span>
<span class="268583664719475207" onmouseenter="enter('268583664719475207');" onmouseout="out('268583664719475207');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520       isChunked = true;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521     }                                                                                                    </span>
<span class="8180254556269969385" onmouseenter="enter('8180254556269969385');" onmouseout="out('8180254556269969385');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522     Map&lt;String, List&lt;String&gt;&gt; headers = conn.getHeaderFields();                                          </span>
<span class="8122923533236748969" onmouseenter="enter('8122923533236748969');" onmouseout="out('8122923533236748969');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523     String disposition = conn.getHeaderField(&quot;Content-Disposition&quot;);                                     </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524                                                                                                          </span>
<span class="-3052400857632215863" onmouseenter="enter('-3052400857632215863');" onmouseout="out('-3052400857632215863');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525     if (taskOption.isUseServerFileName()) {                                                              </span>
<span class="9149723838126995721" onmouseenter="enter('9149723838126995721');" onmouseout="out('9149723838126995721');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526       if (!TextUtils.isEmpty(disposition)) {                                                             </span>
<span class="3142217124074067362" onmouseenter="enter('3142217124074067362');" onmouseout="out('3142217124074067362');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527         mEntity.setDisposition(CommonUtil.encryptBASE64(disposition));                                   </span>
<span class="8894179749774343207" onmouseenter="enter('8894179749774343207');" onmouseout="out('8894179749774343207');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528         handleContentDisposition(disposition);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529       } else {                                                                                           </span>
<span class="6725831659311340657" onmouseenter="enter('6725831659311340657');" onmouseout="out('6725831659311340657');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530         ALog.w(TAG, &quot;Content-Disposition对于端字段为空，使用服务器端文件名失败&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532     }                                                                                                    </span>
<span class="3131612029960887116" onmouseenter="enter('3131612029960887116');" onmouseout="out('3131612029960887116');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533     CookieManager msCookieManager = new CookieManager();                                                 </span>
<span class="6317541366742429029" onmouseenter="enter('6317541366742429029');" onmouseout="out('6317541366742429029');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534     List&lt;String&gt; cookiesHeader = headers.get(&quot;Set-Cookie&quot;);                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535                                                                                                          </span>
<span class="-3711800334805746628" onmouseenter="enter('-3711800334805746628');" onmouseout="out('-3711800334805746628');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 536     if (cookiesHeader != null) {                                                                         </span>
<span class="50137583020384401" onmouseenter="enter('50137583020384401');" onmouseout="out('50137583020384401');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 537       for (String cookie : cookiesHeader) {                                                              </span>
<span class="-5052850978727150914" onmouseenter="enter('-5052850978727150914');" onmouseout="out('-5052850978727150914');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 538         msCookieManager.getCookieStore().add(null, HttpCookie.parse(cookie).get(0));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 539       }                                                                                                  </span>
<span class="-6061807114007929519" onmouseenter="enter('-6061807114007929519');" onmouseout="out('-6061807114007929519');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 540       taskOption.setCookieManager(msCookieManager);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 541     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542                                                                                                          </span>
<span class="-5434227081099310624" onmouseenter="enter('-5434227081099310624');" onmouseout="out('-5434227081099310624');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543     mTaskWrapper.setCode(code);                                                                          </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544     if (code == HttpURLConnection.HTTP_PARTIAL) {                                                        </span>
<span class="3476352595280537016" onmouseenter="enter('3476352595280537016');" onmouseout="out('3476352595280537016');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545       if (!checkLen(len) &amp;&amp; !isChunked) {                                                                </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 546         if (len &lt; 0) {                                                                                   </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 547           failDownload(                                                                                  </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 548               new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),      </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 549               false);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550         }                                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 552       }                                                                                                  </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 553       mEntity.setFileSize(len);                                                                          </span>
<span class="4333195157428278321" onmouseenter="enter('4333195157428278321');" onmouseout="out('4333195157428278321');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 554       mTaskWrapper.setSupportBP(true);                                                                   </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 555       end = true;                                                                                        </span>
<span class="2496770639447193327" onmouseenter="enter('2496770639447193327');" onmouseout="out('2496770639447193327');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 556     } else if (code == HttpURLConnection.HTTP_OK) {                                                      </span>
<span class="-998567010505343674" onmouseenter="enter('-998567010505343674');" onmouseout="out('-998567010505343674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 557       String contentType = conn.getHeaderField(&quot;Content-Type&quot;);                                          </span>
<span class="201076292918755336" onmouseenter="enter('201076292918755336');" onmouseout="out('201076292918755336');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 558       if (TextUtils.isEmpty(contentType)) {                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 559         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 560       }                                                                                                  </span>
<span class="8927907009918172915" onmouseenter="enter('8927907009918172915');" onmouseout="out('8927907009918172915');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 561       if (contentType.equals(&quot;text/html&quot;)) {                                                             </span>
<span class="8342413994542158594" onmouseenter="enter('8342413994542158594');" onmouseout="out('8342413994542158594');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 562         BufferedReader reader =                                                                          </span>
<span class="-7427210485489972460" onmouseenter="enter('-7427210485489972460');" onmouseout="out('-7427210485489972460');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 563             new BufferedReader(new InputStreamReader(ConnectionHelp.convertInputStream(conn)));          </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 564         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="6431556981547329060" onmouseenter="enter('6431556981547329060');" onmouseout="out('6431556981547329060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 565         String line;                                                                                     </span>
<span class="4058321022246549205" onmouseenter="enter('4058321022246549205');" onmouseout="out('4058321022246549205');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 566         while ((line = reader.readLine()) != null) {                                                     </span>
<span class="-6213624305830265937" onmouseenter="enter('-6213624305830265937');" onmouseout="out('-6213624305830265937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 567           sb.append(line);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 568         }                                                                                                </span>
<span class="8277398435538005537" onmouseenter="enter('8277398435538005537');" onmouseout="out('8277398435538005537');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 569         reader.close();                                                                                  </span>
<span class="8311106050401029529" onmouseenter="enter('8311106050401029529');" onmouseout="out('8311106050401029529');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 570         handleUrlReTurn(conn, CommonUtil.getWindowReplaceUrl(sb.toString()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 571         return;                                                                                          </span>
<span class="-4432363278840297326" onmouseenter="enter('-4432363278840297326');" onmouseout="out('-4432363278840297326');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 572       } else if (!checkLen(len) &amp;&amp; !isChunked) {                                                         </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 573         if (len &lt; 0) {                                                                                   </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 574           failDownload(                                                                                  </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 575               new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),      </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 576               false);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 577         }                                                                                                </span>
<span class="1925321240779458317" onmouseenter="enter('1925321240779458317');" onmouseout="out('1925321240779458317');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 578         ALog.d(TAG, &quot;len &lt; 0&quot;);                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 579         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 580       }                                                                                                  </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 581       mEntity.setFileSize(len);                                                                          </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 582       mTaskWrapper.setNewTask(true);                                                                     </span>
<span class="9157524552034725227" onmouseenter="enter('9157524552034725227');" onmouseout="out('9157524552034725227');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 583       mTaskWrapper.setSupportBP(false);                                                                  </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 584       end = true;                                                                                        </span>
<span class="1848064821034278655" onmouseenter="enter('1848064821034278655');" onmouseout="out('1848064821034278655');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 585     } else if (code == HttpURLConnection.HTTP_NOT_FOUND) {                                               </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 586       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="-2250251533714311872" onmouseenter="enter('-2250251533714311872');" onmouseout="out('-2250251533714311872');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 587           String.format(&quot;任务下载失败，errorCode：404, url: %s&quot;, mEntity.getUrl())), true);                      </span>
<span class="7269465454949275689" onmouseenter="enter('7269465454949275689');" onmouseout="out('7269465454949275689');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 588     } else if (code == HttpURLConnection.HTTP_MOVED_TEMP                                                 </span>
<span class="-6032747441450584852" onmouseenter="enter('-6032747441450584852');" onmouseout="out('-6032747441450584852');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 589         || code == HttpURLConnection.HTTP_MOVED_PERM                                                     </span>
<span class="6529484345882801441" onmouseenter="enter('6529484345882801441');" onmouseout="out('6529484345882801441');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 590         || code == HttpURLConnection.HTTP_SEE_OTHER                                                      </span>
<span class="-5614885484106173463" onmouseenter="enter('-5614885484106173463');" onmouseout="out('-5614885484106173463');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 591         || code == HttpURLConnection.HTTP_CREATED // 201 跳转                                              </span>
<span class="-1964089336962903701" onmouseenter="enter('-1964089336962903701');" onmouseout="out('-1964089336962903701');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 592         || code == 307) {                                                                                </span>
<span class="582471876420463974" onmouseenter="enter('582471876420463974');" onmouseout="out('582471876420463974');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 593       handleUrlReTurn(conn, conn.getHeaderField(&quot;Location&quot;));                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 594     } else {                                                                                             </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 595       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="3458281120857355945" onmouseenter="enter('3458281120857355945');" onmouseout="out('3458281120857355945');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 596           String.format(&quot;任务下载失败，errorCode：%s, errorMsg: %s, url: %s&quot;, code,                              </span>
<span class="-865670794746359823" onmouseenter="enter('-865670794746359823');" onmouseout="out('-865670794746359823');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 597               conn.getResponseMessage(), mEntity.getUrl())), !CheckUtil.httpIsBadRequest(code));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 598     }                                                                                                    </span>
<span class="-6801527756571482213" onmouseenter="enter('-6801527756571482213');" onmouseout="out('-6801527756571482213');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 599     if (end) {                                                                                           </span>
<span class="-9049555213483660293" onmouseenter="enter('-9049555213483660293');" onmouseout="out('-9049555213483660293');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 600       taskOption.setChunked(isChunked);                                                                  </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 601       if (onFileInfoCallback != null) {                                                                  </span>
<span class="-3029323004951684182" onmouseenter="enter('-3029323004951684182');" onmouseout="out('-3029323004951684182');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 602         CompleteInfo info = new CompleteInfo(code, mTaskWrapper);                                        </span>
<span class="1239392088731349048" onmouseenter="enter('1239392088731349048');" onmouseout="out('1239392088731349048');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 603         onFileInfoCallback.onComplete(mEntity.getUrl(), info);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 604       }                                                                                                  </span>
<span class="-2332174823472847291" onmouseenter="enter('-2332174823472847291');" onmouseout="out('-2332174823472847291');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 605       mEntity.update();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 606     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 607   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 608                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 609   /**                                                                                                    </span>
<span class="-2847240885661455178" onmouseenter="enter('-2847240885661455178');" onmouseout="out('-2847240885661455178');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 610    * 处理&quot;Content-Disposition&quot;参数                                                                           </span>
<span class="8881865652474859794" onmouseenter="enter('8881865652474859794');" onmouseout="out('8881865652474859794');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 611    * &lt;a href=https://cloud.tencent.com/developer/section/1189916&gt;Content-Disposition&lt;/a&gt;&lt;/&gt;              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 612    *                                                                                                     </span>
<span class="-7776712758593145643" onmouseenter="enter('-7776712758593145643');" onmouseout="out('-7776712758593145643');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 613    * @throws UnsupportedEncodingException                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 614    */                                                                                                    </span>
<span class="-8608321373459550338" onmouseenter="enter('-8608321373459550338');" onmouseout="out('-8608321373459550338');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 615   private void handleContentDisposition(String disposition) throws UnsupportedEncodingException {        </span>
<span class="8299914696584334305" onmouseenter="enter('8299914696584334305');" onmouseout="out('8299914696584334305');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 616     if (disposition.contains(&quot;;&quot;)) {                                                                     </span>
<span class="-8249279439551045927" onmouseenter="enter('-8249279439551045927');" onmouseout="out('-8249279439551045927');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 617       String[] infos = disposition.split(&quot;;&quot;);                                                           </span>
<span class="2055683922126838823" onmouseenter="enter('2055683922126838823');" onmouseout="out('2055683922126838823');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 618       if (infos[0].equals(&quot;attachment&quot;)) {                                                               </span>
<span class="-6108489956922562466" onmouseenter="enter('-6108489956922562466');" onmouseout="out('-6108489956922562466');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 619         for (String info : infos) {                                                                      </span>
<span class="-3445363461731907777" onmouseenter="enter('-3445363461731907777');" onmouseout="out('-3445363461731907777');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 620           if (info.startsWith(&quot;filename&quot;) &amp;&amp; info.contains(&quot;=&quot;)) {                                       </span>
<span class="3695771658612668290" onmouseenter="enter('3695771658612668290');" onmouseout="out('3695771658612668290');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 621             String[] temp = info.split(&quot;=&quot;);                                                             </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 622             if (temp.length &gt; 1) {                                                                       </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 623               String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                 </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 624               mEntity.setServerFileName(newName);                                                        </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 625               renameFile(newName);                                                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 626               break;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 627             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 628           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 629         }                                                                                                </span>
<span class="6794164660951287492" onmouseenter="enter('6794164660951287492');" onmouseout="out('6794164660951287492');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 630       } else if (infos[0].equals(&quot;form-data&quot;) &amp;&amp; infos.length &gt; 2) {                                     </span>
<span class="-8905252974632201641" onmouseenter="enter('-8905252974632201641');" onmouseout="out('-8905252974632201641');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 631         String[] temp = infos[2].split(&quot;=&quot;);                                                             </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 632         if (temp.length &gt; 1) {                                                                           </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 633           String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                     </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 634           mEntity.setServerFileName(newName);                                                            </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 635           renameFile(newName);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 636         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 637       } else {                                                                                           </span>
<span class="7479053829749492027" onmouseenter="enter('7479053829749492027');" onmouseout="out('7479053829749492027');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 638         ALog.w(TAG, &quot;不识别的Content-Disposition参数&quot;);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 639       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 640     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 641   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 642                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 643   /**                                                                                                    </span>
<span class="-5538524699876672002" onmouseenter="enter('-5538524699876672002');" onmouseout="out('-5538524699876672002');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 644    * 重命名文件                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 645    */                                                                                                    </span>
<span class="-7899950182898562290" onmouseenter="enter('-7899950182898562290');" onmouseout="out('-7899950182898562290');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 646   private void renameFile(String newName) {                                                              </span>
<span class="4040095654750429587" onmouseenter="enter('4040095654750429587');" onmouseout="out('4040095654750429587');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 647     if (TextUtils.isEmpty(newName)) {                                                                    </span>
<span class="7746921739080291575" onmouseenter="enter('7746921739080291575');" onmouseout="out('7746921739080291575');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 648       ALog.w(TAG, &quot;重命名失败【服务器返回的文件名为空】&quot;);                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 649       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 650     }                                                                                                    </span>
<span class="-897821573073116237" onmouseenter="enter('-897821573073116237');" onmouseout="out('-897821573073116237');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 651     ALog.d(TAG, String.format(&quot;文件重命名为：%s&quot;, newName));                                                    </span>
<span class="3112348380249890188" onmouseenter="enter('3112348380249890188');" onmouseout="out('3112348380249890188');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 652     File oldFile = new File(mEntity.getFilePath());                                                      </span>
<span class="6384479286325830175" onmouseenter="enter('6384479286325830175');" onmouseout="out('6384479286325830175');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 653     String newPath = oldFile.getParent() + &quot;/&quot; + newName;                                                </span>
<span class="-8664365027300439044" onmouseenter="enter('-8664365027300439044');" onmouseout="out('-8664365027300439044');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 654     if (oldFile.exists()) {                                                                              </span>
<span class="-2839507751750912779" onmouseenter="enter('-2839507751750912779');" onmouseout="out('-2839507751750912779');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 655       boolean b = oldFile.renameTo(new File(newPath));                                                   </span>
<span class="1440136229140496041" onmouseenter="enter('1440136229140496041');" onmouseout="out('1440136229140496041');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 656       ALog.d(TAG, String.format(&quot;文件重命名%s&quot;, b ? &quot;成功&quot; : &quot;失败&quot;));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 657     }                                                                                                    </span>
<span class="-3962615333140495301" onmouseenter="enter('-3962615333140495301');" onmouseout="out('-3962615333140495301');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 658     mEntity.setFileName(newName);                                                                        </span>
<span class="5260470821929213762" onmouseenter="enter('5260470821929213762');" onmouseout="out('5260470821929213762');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 659     mEntity.setFilePath(newPath);                                                                        </span>
<span class="552132236643695604" onmouseenter="enter('552132236643695604');" onmouseout="out('552132236643695604');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 660     RecordUtil.modifyTaskRecord(oldFile.getPath(), newPath, mEntity.getTaskType());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 661   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 662                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 663   /**                                                                                                    </span>
<span class="-761470207976407479" onmouseenter="enter('-761470207976407479');" onmouseout="out('-761470207976407479');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 664    * 处理30x跳转                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 665    */                                                                                                    </span>
<span class="5556617621352975519" onmouseenter="enter('5556617621352975519');" onmouseout="out('5556617621352975519');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 666   private void handleUrlReTurn(HttpURLConnection conn, String newUrl) throws IOException {               </span>
<span class="9112975487181986733" onmouseenter="enter('9112975487181986733');" onmouseout="out('9112975487181986733');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 667     ALog.d(TAG, &quot;30x跳转，新url为【&quot; + newUrl + &quot;】&quot;);                                                          </span>
<span class="-3187267727779732659" onmouseenter="enter('-3187267727779732659');" onmouseout="out('-3187267727779732659');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 668     if (TextUtils.isEmpty(newUrl) || newUrl.equalsIgnoreCase(&quot;null&quot;)) {                                  </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 669       if (onFileInfoCallback != null) {                                                                  </span>
<span class="7265698984710319788" onmouseenter="enter('7265698984710319788');" onmouseout="out('7265698984710319788');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 670         onFileInfoCallback.onFail(mEntity, new TaskException(TAG, &quot;获取重定向链接失败&quot;), false);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 671       }                                                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 672       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 673     }                                                                                                    </span>
<span class="-4691236730005429135" onmouseenter="enter('-4691236730005429135');" onmouseout="out('-4691236730005429135');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 674     if (newUrl.startsWith(&quot;/&quot;)) {                                                                        </span>
<span class="-7947437880890249902" onmouseenter="enter('-7947437880890249902');" onmouseout="out('-7947437880890249902');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 675       Uri uri = Uri.parse(mEntity.getUrl());                                                             </span>
<span class="-159008217290066182" onmouseenter="enter('-159008217290066182');" onmouseout="out('-159008217290066182');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 676       newUrl = uri.getHost() + newUrl;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 677     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 678                                                                                                          </span>
<span class="-4197272966192810800" onmouseenter="enter('-4197272966192810800');" onmouseout="out('-4197272966192810800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 679     if (!CheckUtil.checkUrl(newUrl)) {                                                                   </span>
<span class="8671661921003868184" onmouseenter="enter('8671661921003868184');" onmouseout="out('8671661921003868184');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 680       failDownload(new TaskException(TAG, &quot;下载失败，重定向url错误&quot;), false);                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 681       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 682     }                                                                                                    </span>
<span class="2121195664546392305" onmouseenter="enter('2121195664546392305');" onmouseout="out('2121195664546392305');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 683     taskOption.setRedirectUrl(newUrl);                                                                   </span>
<span class="-7202069996221856390" onmouseenter="enter('-7202069996221856390');" onmouseout="out('-7202069996221856390');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 684     mEntity.setRedirect(true);                                                                           </span>
<span class="3562634937094117088" onmouseenter="enter('3562634937094117088');" onmouseout="out('3562634937094117088');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 685     mEntity.setRedirectUrl(newUrl);                                                                      </span>
<span class="-6439352303300997905" onmouseenter="enter('-6439352303300997905');" onmouseout="out('-6439352303300997905');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 686     String cookies = conn.getHeaderField(&quot;Set-Cookie&quot;);                                                  </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 687     conn.disconnect();                                                                                   </span>
<span class="7827815028692387267" onmouseenter="enter('7827815028692387267');" onmouseout="out('7827815028692387267');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 688     URL url = ConnectionHelp.handleUrl(newUrl, taskOption);                                              </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 689     conn = ConnectionHelp.handleConnection(url, taskOption);                                             </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 690     ConnectionHelp.setConnectParam(taskOption, conn);                                                    </span>
<span class="-9082472095175979719" onmouseenter="enter('-9082472095175979719');" onmouseout="out('-9082472095175979719');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 691     conn.setRequestProperty(&quot;Cookie&quot;, cookies);                                                          </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 692     conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                                </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 693     conn.setConnectTimeout(mConnectTimeOut);                                                             </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 694     conn.connect();                                                                                      </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 695     handleConnect(conn);                                                                                 </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 696     conn.disconnect();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 697   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 698                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 699   /**                                                                                                    </span>
<span class="8188732119885086451" onmouseenter="enter('8188732119885086451');" onmouseout="out('8188732119885086451');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 700    * 检查长度是否合法，并且检查新获取的文件长度是否和数据库的文件长度一直，如果不一致，则表示该任务为新任务                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 701    *                                                                                                     </span>
<span class="7508607167277684618" onmouseenter="enter('7508607167277684618');" onmouseout="out('7508607167277684618');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 702    * @param len 从服务器获取的文件长度                                                                              </span>
<span class="2269811577157119944" onmouseenter="enter('2269811577157119944');" onmouseout="out('2269811577157119944');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 703    * @return {@code true}合法                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 704    */                                                                                                    </span>
<span class="226943708538926451" onmouseenter="enter('226943708538926451');" onmouseout="out('226943708538926451');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 705   private boolean checkLen(long len) {                                                                   </span>
<span class="-6834276917361274338" onmouseenter="enter('-6834276917361274338');" onmouseout="out('-6834276917361274338');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 706     if (len != mEntity.getFileSize()) {                                                                  </span>
<span class="7031409428945889302" onmouseenter="enter('7031409428945889302');" onmouseout="out('7031409428945889302');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 707       ALog.d(TAG, &quot;长度不一致，任务为新任务&quot;);                                                                       </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 708       mTaskWrapper.setNewTask(true);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 709     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 710     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712                                                                                                          </span>
<span class="-4015346071016137178" onmouseenter="enter('-4015346071016137178');" onmouseout="out('-4015346071016137178');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 713   private void failDownload(BaseException e, boolean needRetry) {                                        </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 714     if (onFileInfoCallback != null) {                                                                    </span>
<span class="-3744805558345201426" onmouseenter="enter('-3744805558345201426');" onmouseout="out('-3744805558345201426');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 715       onFileInfoCallback.onFail(mEntity, e, needRetry);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 716     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 717   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 718                                                                                                          </span>
<span class="-306327811626166304" onmouseenter="enter('-306327811626166304');" onmouseout="out('-306327811626166304');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 719   private static class FileLenAdapter implements IHttpFileLenAdapter {                                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 720                                                                                                          </span>
<span class="-4968473764170008746" onmouseenter="enter('-4968473764170008746');" onmouseout="out('-4968473764170008746');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 721     @Override public long handleFileLen(Map&lt;String, List&lt;String&gt;&gt; headers) {                             </span>
<span class="-3703403373407617525" onmouseenter="enter('-3703403373407617525');" onmouseout="out('-3703403373407617525');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 722       if (headers == null || headers.isEmpty()) {                                                        </span>
<span class="7978066123796535188" onmouseenter="enter('7978066123796535188');" onmouseout="out('7978066123796535188');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 723         ALog.e(TAG, &quot;header为空，获取文件长度失败&quot;);                                                                </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 724         return -1;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 725       }                                                                                                  </span>
<span class="-3327040667133742279" onmouseenter="enter('-3327040667133742279');" onmouseout="out('-3327040667133742279');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 726       List&lt;String&gt; sLength = headers.get(&quot;Content-Length&quot;);                                              </span>
<span class="-5638961086111332224" onmouseenter="enter('-5638961086111332224');" onmouseout="out('-5638961086111332224');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 727       if (sLength == null || sLength.isEmpty()) {                                                        </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 728         return -1;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 729       }                                                                                                  </span>
<span class="1006906766372690526" onmouseenter="enter('1006906766372690526');" onmouseout="out('1006906766372690526');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 730       String temp = sLength.get(0);                                                                      </span>
<span class="-859592945496577082" onmouseenter="enter('-859592945496577082');" onmouseout="out('-859592945496577082');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 731       long len = TextUtils.isEmpty(temp) ? -1 : Long.parseLong(temp);                                    </span>
<span class="-3482859616975282364" onmouseenter="enter('-3482859616975282364');" onmouseout="out('-3482859616975282364');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 732       // 某些服务，如果设置了conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                 </span>
<span class="-2343886357485900465" onmouseenter="enter('-2343886357485900465');" onmouseout="out('-2343886357485900465');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 733       // 会返回 Content-Range: bytes 0-225427911/225427913                                                  </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 734       if (len &lt; 0) {                                                                                     </span>
<span class="-5449604609323133496" onmouseenter="enter('-5449604609323133496');" onmouseout="out('-5449604609323133496');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 735         List&lt;String&gt; sRange = headers.get(&quot;Content-Range&quot;);                                              </span>
<span class="-939726222710114379" onmouseenter="enter('-939726222710114379');" onmouseout="out('-939726222710114379');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 736         if (sRange == null || sRange.isEmpty()) {                                                        </span>
<span class="-428304200248281464" onmouseenter="enter('-428304200248281464');" onmouseout="out('-428304200248281464');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 737           len = -1;                                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 738         } else {                                                                                         </span>
<span class="-552616904450344700" onmouseenter="enter('-552616904450344700');" onmouseout="out('-552616904450344700');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 739           int start = temp.indexOf(&quot;/&quot;);                                                                 </span>
<span class="6692102738649716212" onmouseenter="enter('6692102738649716212');" onmouseout="out('6692102738649716212');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 740           len = Long.parseLong(temp.substring(start + 1));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 741         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 742       }                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 743                                                                                                          </span>
<span class="7701238698032811091" onmouseenter="enter('7701238698032811091');" onmouseout="out('7701238698032811091');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 744       return len;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 745     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 746   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 747 }                                                                                                        </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 748 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span></pre></td>
                            <td><pre><span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style="">   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">   2 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">   4 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   5                                                                                                          </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   6 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   7  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   8  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   9  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  10  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  11  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  12  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  13  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  14  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  15  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  16  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  17  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  18  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  19  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  20  */                                                                                                      </span>
<span class="-7236899369024788297" onmouseenter="enter('-7236899369024788297');" onmouseout="out('-7236899369024788297');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  21 package com.arialyy.aria.http;                                                                           </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  22                                                                                                          </span>
<span class="-6390350725830347024" onmouseenter="enter('-6390350725830347024');" onmouseout="out('-6390350725830347024');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23 import android.net.TrafficStats;                                                                         </span>
<span class="-8750621697125156872" onmouseenter="enter('-8750621697125156872');" onmouseout="out('-8750621697125156872');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  24 import android.net.Uri;                                                                                  </span>
<span class="3485143652294101472" onmouseenter="enter('3485143652294101472');" onmouseout="out('3485143652294101472');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  25 import android.os.Process;                                                                               </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  26 import android.text.TextUtils;                                                                           </span>
<span class="8153369258057528270" onmouseenter="enter('8153369258057528270');" onmouseout="out('8153369258057528270');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  27 import com.arialyy.aria.core.AriaConfig;                                                                 </span>
<span class="5028823532254250595" onmouseenter="enter('5028823532254250595');" onmouseout="out('5028823532254250595');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  28 import com.arialyy.aria.core.common.CompleteInfo;                                                        </span>
<span class="7716102167634407665" onmouseenter="enter('7716102167634407665');" onmouseout="out('7716102167634407665');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  29 import com.arialyy.aria.core.common.RequestEnum;                                                         </span>
<span class="-3497740022528182602" onmouseenter="enter('-3497740022528182602');" onmouseout="out('-3497740022528182602');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  30 import com.arialyy.aria.core.download.DTaskWrapper;                                                      </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  31 import com.arialyy.aria.core.download.DownloadEntity;                                                    </span>
<span class="-5825121975347398532" onmouseenter="enter('-5825121975347398532');" onmouseout="out('-5825121975347398532');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  32 import com.arialyy.aria.core.inf.OnFileInfoCallback;                                                     </span>
<span class="-5191825800443458517" onmouseenter="enter('-5191825800443458517');" onmouseout="out('-5191825800443458517');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  33 import com.arialyy.aria.core.processor.IHttpFileLenAdapter;                                              </span>
<span class="6359380642632041098" onmouseenter="enter('6359380642632041098');" onmouseout="out('6359380642632041098');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  34 import com.arialyy.aria.exception.AriaIOException;                                                       </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  35 import com.arialyy.aria.exception.BaseException;                                                         </span>
<span class="-5001091348570971924" onmouseenter="enter('-5001091348570971924');" onmouseout="out('-5001091348570971924');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36 import com.arialyy.aria.exception.TaskException;                                                         </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38 import com.arialyy.aria.util.CheckUtil;                                                                  </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  39 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  40 import com.arialyy.aria.util.FileUtil;                                                                   </span>
<span class="-969957896094278671" onmouseenter="enter('-969957896094278671');" onmouseout="out('-969957896094278671');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  41 import com.arialyy.aria.util.RecordUtil;                                                                 </span>
<span class="-4738630423427876475" onmouseenter="enter('-4738630423427876475');" onmouseout="out('-4738630423427876475');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  42 import java.io.BufferedReader;                                                                           </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  43 import java.io.File;                                                                                     </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  44 import java.io.IOException;                                                                              </span>
<span class="-5152338856474932575" onmouseenter="enter('-5152338856474932575');" onmouseout="out('-5152338856474932575');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  45 import java.io.InputStreamReader;                                                                        </span>
<span class="3835172898968420800" onmouseenter="enter('3835172898968420800');" onmouseout="out('3835172898968420800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  46 import java.io.OutputStreamWriter;                                                                       </span>
<span class="8256805395213692609" onmouseenter="enter('8256805395213692609');" onmouseout="out('8256805395213692609');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  47 import java.io.UnsupportedEncodingException;                                                             </span>
<span class="7759739624588802903" onmouseenter="enter('7759739624588802903');" onmouseout="out('7759739624588802903');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  48 import java.net.CookieManager;                                                                           </span>
<span class="-5584619311424941805" onmouseenter="enter('-5584619311424941805');" onmouseout="out('-5584619311424941805');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  49 import java.net.HttpCookie;                                                                              </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50 import java.net.HttpURLConnection;                                                                       </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51 import java.net.URL;                                                                                     </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52 import java.net.URLDecoder;                                                                              </span>
<span class="302463665162759210" onmouseenter="enter('302463665162759210');" onmouseout="out('302463665162759210');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53 import java.net.URLEncoder;                                                                              </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  55 import java.util.Map;                                                                                    </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  56 import java.util.Set;                                                                                    </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57 import java.util.UUID;                                                                                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59 /**                                                                                                      </span>
<span class="-1733864505168931106" onmouseenter="enter('-1733864505168931106');" onmouseout="out('-1733864505168931106');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60  * 下载文件信息获取                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61  */                                                                                                      </span>
<span class="-8507874378969942466" onmouseenter="enter('-8507874378969942466');" onmouseout="out('-8507874378969942466');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62 public class HttpFileInfoThread implements Runnable {                                                    </span>
<span class="-960543327724144855" onmouseenter="enter('-960543327724144855');" onmouseout="out('-960543327724144855');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63   private static final String TAG = &quot;HttpFileInfoThread&quot;;                                                </span>
<span class="-7151375780097547664" onmouseenter="enter('-7151375780097547664');" onmouseout="out('-7151375780097547664');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64   private DownloadEntity mEntity;                                                                        </span>
<span class="-3857309927385466618" onmouseenter="enter('-3857309927385466618');" onmouseout="out('-3857309927385466618');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65   private DTaskWrapper mTaskWrapper;                                                                     </span>
<span class="8600882525060240313" onmouseenter="enter('8600882525060240313');" onmouseout="out('8600882525060240313');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66   private int mConnectTimeOut;                                                                           </span>
<span class="-6824755283282820235" onmouseenter="enter('-6824755283282820235');" onmouseout="out('-6824755283282820235');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67   private OnFileInfoCallback onFileInfoCallback;                                                         </span>
<span class="6827268874849985533" onmouseenter="enter('6827268874849985533');" onmouseout="out('6827268874849985533');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68   private HttpTaskOption taskOption;                                                                     </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69                                                                                                          </span>
<span class="-5652336240759927020" onmouseenter="enter('-5652336240759927020');" onmouseout="out('-5652336240759927020');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  70   public HttpFileInfoThread(DTaskWrapper taskWrapper, OnFileInfoCallback callback) {                     </span>
<span class="-3805550036651318371" onmouseenter="enter('-3805550036651318371');" onmouseout="out('-3805550036651318371');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71     this.mTaskWrapper = taskWrapper;                                                                     </span>
<span class="-170355754520114419" onmouseenter="enter('-170355754520114419');" onmouseout="out('-170355754520114419');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72     mEntity = taskWrapper.getEntity();                                                                   </span>
<span class="2572452400414830057" onmouseenter="enter('2572452400414830057');" onmouseout="out('2572452400414830057');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73     mConnectTimeOut = AriaConfig.getInstance().getDConfig().getConnectTimeOut();                         </span>
<span class="1217537359294132674" onmouseenter="enter('1217537359294132674');" onmouseout="out('1217537359294132674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74     onFileInfoCallback = callback;                                                                       </span>
<span class="6933673676495207920" onmouseenter="enter('6933673676495207920');" onmouseout="out('6933673676495207920');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75     taskOption = (HttpTaskOption) taskWrapper.getTaskOption();                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78   @Override public void run() {                                                                          </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79     Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                       </span>
<span class="-1851318291295515457" onmouseenter="enter('-1851318291295515457');" onmouseout="out('-1851318291295515457');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  80     TrafficStats.setThreadStatsTag(UUID.randomUUID().toString().hashCode());                             </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81     HttpURLConnection conn = null;                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82     try {                                                                                                </span>
<span class="7954771811613007401" onmouseenter="enter('7954771811613007401');" onmouseout="out('7954771811613007401');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83       URL url = ConnectionHelp.handleUrl(mEntity.getUrl(), taskOption);                                  </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84       conn = ConnectionHelp.handleConnection(url, taskOption);                                           </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85       ConnectionHelp.setConnectParam(taskOption, conn);                                                  </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86       conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                              </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87       conn.setConnectTimeout(mConnectTimeOut);                                                           </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88       conn.connect();                                                                                    </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89       handleConnect(conn);                                                                               </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90     } catch (IOException e) {                                                                            </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91       e.printStackTrace();                                                                               </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="-4053293382299681633" onmouseenter="enter('-4053293382299681633');" onmouseout="out('-4053293382299681633');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93               String.format(&quot;下载失败，filePath: %s, url: %s&quot;, mEntity.getDownloadPath(), mEntity.getUrl())), </span>
<span class="-159362617709534437" onmouseenter="enter('-159362617709534437');" onmouseout="out('-159362617709534437');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94           true);                                                                                         </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95     } finally {                                                                                          </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96       if (conn != null) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97         try {                                                                                            </span>
<span class="-8686251500819757648" onmouseenter="enter('-8686251500819757648');" onmouseout="out('-8686251500819757648');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98           conn.getInputStream().close();                                                                 </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99         } catch (IOException e) {                                                                        </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100           e.printStackTrace();                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101         }                                                                                                </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102         conn.disconnect();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106                                                                                                          </span>
<span class="7469915187822843170" onmouseenter="enter('7469915187822843170');" onmouseout="out('7469915187822843170');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107   private void handleConnect(HttpURLConnection conn) throws IOException {                                </span>
<span class="-5135480308665977678" onmouseenter="enter('-5135480308665977678');" onmouseout="out('-5135480308665977678');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108     if (taskOption.getRequestEnum() == RequestEnum.POST) {                                               </span>
<span class="-5476217355085156421" onmouseenter="enter('-5476217355085156421');" onmouseout="out('-5476217355085156421');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109       Map&lt;String, String&gt; params = taskOption.getParams();                                               </span>
<span class="3157859291963549592" onmouseenter="enter('3157859291963549592');" onmouseout="out('3157859291963549592');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110       if (params != null) {                                                                              </span>
<span class="1177673060067921781" onmouseenter="enter('1177673060067921781');" onmouseout="out('1177673060067921781');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111         OutputStreamWriter dos = new OutputStreamWriter(conn.getOutputStream());                         </span>
<span class="-2461846026114443284" onmouseenter="enter('-2461846026114443284');" onmouseout="out('-2461846026114443284');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112         Set&lt;String&gt; keys = params.keySet();                                                              </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114         for (String key : keys) {                                                                        </span>
<span class="-378086891984466400" onmouseenter="enter('-378086891984466400');" onmouseout="out('-378086891984466400');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115           sb.append(key).append(&quot;=&quot;).append(URLEncoder.encode(params.get(key))).append(&quot;&amp;&quot;);             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116         }                                                                                                </span>
<span class="-1170631941621929173" onmouseenter="enter('-1170631941621929173');" onmouseout="out('-1170631941621929173');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117         String url = sb.toString();                                                                      </span>
<span class="-2854610904289092260" onmouseenter="enter('-2854610904289092260');" onmouseout="out('-2854610904289092260');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118         url = url.substring(0, url.length() - 1);                                                        </span>
<span class="-412821746973687146" onmouseenter="enter('-412821746973687146');" onmouseout="out('-412821746973687146');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119         dos.write(url);                                                                                  </span>
<span class="-6320099346663956498" onmouseenter="enter('-6320099346663956498');" onmouseout="out('-6320099346663956498');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120         dos.flush();                                                                                     </span>
<span class="1568727060082909957" onmouseenter="enter('1568727060082909957');" onmouseout="out('1568727060082909957');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121         dos.close();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124                                                                                                          </span>
<span class="831227310872116523" onmouseenter="enter('831227310872116523');" onmouseout="out('831227310872116523');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125     IHttpFileLenAdapter lenAdapter = taskOption.getFileLenAdapter();                                     </span>
<span class="5196440776228873073" onmouseenter="enter('5196440776228873073');" onmouseout="out('5196440776228873073');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126     if (lenAdapter == null) {                                                                            </span>
<span class="7197457532950740585" onmouseenter="enter('7197457532950740585');" onmouseout="out('7197457532950740585');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127       lenAdapter = new FileLenAdapter();                                                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128     } else {                                                                                             </span>
<span class="-2288407285072363665" onmouseenter="enter('-2288407285072363665');" onmouseout="out('-2288407285072363665');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129       ALog.d(TAG, &quot;使用自定义adapter&quot;);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130     }                                                                                                    </span>
<span class="-3117441631991498996" onmouseenter="enter('-3117441631991498996');" onmouseout="out('-3117441631991498996');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131     long len = lenAdapter.handleFileLen(conn.getHeaderFields());                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132                                                                                                          </span>
<span class="57392966174497577" onmouseenter="enter('57392966174497577');" onmouseout="out('57392966174497577');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133     if (!FileUtil.checkMemorySpace(mEntity.getFilePath(), len)) {                                        </span>
<span class="-1675602595326094546" onmouseenter="enter('-1675602595326094546');" onmouseout="out('-1675602595326094546');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134       failDownload(new TaskException(TAG,                                                                </span>
<span class="380344701162823709" onmouseenter="enter('380344701162823709');" onmouseout="out('380344701162823709');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135           String.format(&quot;下载失败，内存空间不足；filePath: %s, url: %s&quot;, mEntity.getDownloadPath(),                  </span>
<span class="3748007250659926415" onmouseenter="enter('3748007250659926415');" onmouseout="out('3748007250659926415');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136               mEntity.getUrl())), false);                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139                                                                                                          </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140     int code = conn.getResponseCode();                                                                   </span>
<span class="243612440262257064" onmouseenter="enter('243612440262257064');" onmouseout="out('243612440262257064');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141     boolean end = false;                                                                                 </span>
<span class="3661527496298260626" onmouseenter="enter('3661527496298260626');" onmouseout="out('3661527496298260626');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142     if (TextUtils.isEmpty(mEntity.getMd5Code())) {                                                       </span>
<span class="6175847651720741920" onmouseenter="enter('6175847651720741920');" onmouseout="out('6175847651720741920');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143       String md5Code = conn.getHeaderField(&quot;Content-MD5&quot;);                                               </span>
<span class="3841984198412482104" onmouseenter="enter('3841984198412482104');" onmouseout="out('3841984198412482104');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144       mEntity.setMd5Code(md5Code);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146                                                                                                          </span>
<span class="-9137345962727529427" onmouseenter="enter('-9137345962727529427');" onmouseout="out('-9137345962727529427');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147     boolean isChunked = false;                                                                           </span>
<span class="-8116968388415792268" onmouseenter="enter('-8116968388415792268');" onmouseout="out('-8116968388415792268');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148     final String str = conn.getHeaderField(&quot;Transfer-Encoding&quot;);                                         </span>
<span class="-6629832129461298046" onmouseenter="enter('-6629832129461298046');" onmouseout="out('-6629832129461298046');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149     if (!TextUtils.isEmpty(str) &amp;&amp; str.equals(&quot;chunked&quot;)) {                                              </span>
<span class="268583664719475207" onmouseenter="enter('268583664719475207');" onmouseout="out('268583664719475207');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150       isChunked = true;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151     }                                                                                                    </span>
<span class="8180254556269969385" onmouseenter="enter('8180254556269969385');" onmouseout="out('8180254556269969385');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152     Map&lt;String, List&lt;String&gt;&gt; headers = conn.getHeaderFields();                                          </span>
<span class="8122923533236748969" onmouseenter="enter('8122923533236748969');" onmouseout="out('8122923533236748969');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153     String disposition = conn.getHeaderField(&quot;Content-Disposition&quot;);                                     </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154                                                                                                          </span>
<span class="-3052400857632215863" onmouseenter="enter('-3052400857632215863');" onmouseout="out('-3052400857632215863');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155     if (taskOption.isUseServerFileName()) {                                                              </span>
<span class="9149723838126995721" onmouseenter="enter('9149723838126995721');" onmouseout="out('9149723838126995721');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156       if (!TextUtils.isEmpty(disposition)) {                                                             </span>
<span class="3142217124074067362" onmouseenter="enter('3142217124074067362');" onmouseout="out('3142217124074067362');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157         mEntity.setDisposition(CommonUtil.encryptBASE64(disposition));                                   </span>
<span class="8894179749774343207" onmouseenter="enter('8894179749774343207');" onmouseout="out('8894179749774343207');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158         handleContentDisposition(disposition);                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159       } else {                                                                                           </span>
<span class="6725831659311340657" onmouseenter="enter('6725831659311340657');" onmouseout="out('6725831659311340657');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160         ALog.w(TAG, &quot;Content-Disposition对于端字段为空，使用服务器端文件名失败&quot;);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162     }                                                                                                    </span>
<span class="3131612029960887116" onmouseenter="enter('3131612029960887116');" onmouseout="out('3131612029960887116');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163     CookieManager msCookieManager = new CookieManager();                                                 </span>
<span class="6317541366742429029" onmouseenter="enter('6317541366742429029');" onmouseout="out('6317541366742429029');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164     List&lt;String&gt; cookiesHeader = headers.get(&quot;Set-Cookie&quot;);                                              </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165                                                                                                          </span>
<span class="-3711800334805746628" onmouseenter="enter('-3711800334805746628');" onmouseout="out('-3711800334805746628');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166     if (cookiesHeader != null) {                                                                         </span>
<span class="50137583020384401" onmouseenter="enter('50137583020384401');" onmouseout="out('50137583020384401');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167       for (String cookie : cookiesHeader) {                                                              </span>
<span class="-5052850978727150914" onmouseenter="enter('-5052850978727150914');" onmouseout="out('-5052850978727150914');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168         msCookieManager.getCookieStore().add(null, HttpCookie.parse(cookie).get(0));                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169       }                                                                                                  </span>
<span class="-6061807114007929519" onmouseenter="enter('-6061807114007929519');" onmouseout="out('-6061807114007929519');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170       taskOption.setCookieManager(msCookieManager);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172                                                                                                          </span>
<span class="-5434227081099310624" onmouseenter="enter('-5434227081099310624');" onmouseout="out('-5434227081099310624');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173     mTaskWrapper.setCode(code);                                                                          </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174     if (code == HttpURLConnection.HTTP_PARTIAL) {                                                        </span>
<span class="3476352595280537016" onmouseenter="enter('3476352595280537016');" onmouseout="out('3476352595280537016');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175       if (!checkLen(len) &amp;&amp; !isChunked) {                                                                </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176         if (len &lt; 0) {                                                                                   </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177           failDownload(                                                                                  </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178               new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),      </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179               false);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180         }                                                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182       }                                                                                                  </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183       mEntity.setFileSize(len);                                                                          </span>
<span class="4333195157428278321" onmouseenter="enter('4333195157428278321');" onmouseout="out('4333195157428278321');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184       mTaskWrapper.setSupportBP(true);                                                                   </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185       end = true;                                                                                        </span>
<span class="2496770639447193327" onmouseenter="enter('2496770639447193327');" onmouseout="out('2496770639447193327');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186     } else if (code == HttpURLConnection.HTTP_OK) {                                                      </span>
<span class="-998567010505343674" onmouseenter="enter('-998567010505343674');" onmouseout="out('-998567010505343674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187       String contentType = conn.getHeaderField(&quot;Content-Type&quot;);                                          </span>
<span class="201076292918755336" onmouseenter="enter('201076292918755336');" onmouseout="out('201076292918755336');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188       if (TextUtils.isEmpty(contentType)) {                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190       }                                                                                                  </span>
<span class="8927907009918172915" onmouseenter="enter('8927907009918172915');" onmouseout="out('8927907009918172915');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191       if (contentType.equals(&quot;text/html&quot;)) {                                                             </span>
<span class="8342413994542158594" onmouseenter="enter('8342413994542158594');" onmouseout="out('8342413994542158594');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192         BufferedReader reader =                                                                          </span>
<span class="-7427210485489972460" onmouseenter="enter('-7427210485489972460');" onmouseout="out('-7427210485489972460');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193             new BufferedReader(new InputStreamReader(ConnectionHelp.convertInputStream(conn)));          </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194         StringBuilder sb = new StringBuilder();                                                          </span>
<span class="6431556981547329060" onmouseenter="enter('6431556981547329060');" onmouseout="out('6431556981547329060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195         String line;                                                                                     </span>
<span class="4058321022246549205" onmouseenter="enter('4058321022246549205');" onmouseout="out('4058321022246549205');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196         while ((line = reader.readLine()) != null) {                                                     </span>
<span class="-6213624305830265937" onmouseenter="enter('-6213624305830265937');" onmouseout="out('-6213624305830265937');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197           sb.append(line);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198         }                                                                                                </span>
<span class="8277398435538005537" onmouseenter="enter('8277398435538005537');" onmouseout="out('8277398435538005537');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199         reader.close();                                                                                  </span>
<span class="8311106050401029529" onmouseenter="enter('8311106050401029529');" onmouseout="out('8311106050401029529');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200         handleUrlReTurn(conn, CommonUtil.getWindowReplaceUrl(sb.toString()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201         return;                                                                                          </span>
<span class="-4432363278840297326" onmouseenter="enter('-4432363278840297326');" onmouseout="out('-4432363278840297326');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202       } else if (!checkLen(len) &amp;&amp; !isChunked) {                                                         </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203         if (len &lt; 0) {                                                                                   </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204           failDownload(                                                                                  </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205               new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),      </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206               false);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207         }                                                                                                </span>
<span class="1925321240779458317" onmouseenter="enter('1925321240779458317');" onmouseout="out('1925321240779458317');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208         ALog.d(TAG, &quot;len &lt; 0&quot;);                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210       }                                                                                                  </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211       mEntity.setFileSize(len);                                                                          </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212       mTaskWrapper.setNewTask(true);                                                                     </span>
<span class="9157524552034725227" onmouseenter="enter('9157524552034725227');" onmouseout="out('9157524552034725227');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213       mTaskWrapper.setSupportBP(false);                                                                  </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214       end = true;                                                                                        </span>
<span class="1848064821034278655" onmouseenter="enter('1848064821034278655');" onmouseout="out('1848064821034278655');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215     } else if (code == HttpURLConnection.HTTP_NOT_FOUND) {                                               </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="-2250251533714311872" onmouseenter="enter('-2250251533714311872');" onmouseout="out('-2250251533714311872');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217           String.format(&quot;任务下载失败，errorCode：404, url: %s&quot;, mEntity.getUrl())), true);                      </span>
<span class="7269465454949275689" onmouseenter="enter('7269465454949275689');" onmouseout="out('7269465454949275689');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218     } else if (code == HttpURLConnection.HTTP_MOVED_TEMP                                                 </span>
<span class="-6032747441450584852" onmouseenter="enter('-6032747441450584852');" onmouseout="out('-6032747441450584852');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219         || code == HttpURLConnection.HTTP_MOVED_PERM                                                     </span>
<span class="6529484345882801441" onmouseenter="enter('6529484345882801441');" onmouseout="out('6529484345882801441');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220         || code == HttpURLConnection.HTTP_SEE_OTHER                                                      </span>
<span class="-5614885484106173463" onmouseenter="enter('-5614885484106173463');" onmouseout="out('-5614885484106173463');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221         || code == HttpURLConnection.HTTP_CREATED // 201 跳转                                              </span>
<span class="-1964089336962903701" onmouseenter="enter('-1964089336962903701');" onmouseout="out('-1964089336962903701');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222         || code == 307) {                                                                                </span>
<span class="582471876420463974" onmouseenter="enter('582471876420463974');" onmouseout="out('582471876420463974');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223       handleUrlReTurn(conn, conn.getHeaderField(&quot;Location&quot;));                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224     } else {                                                                                             </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225       failDownload(new AriaIOException(TAG,                                                              </span>
<span class="3458281120857355945" onmouseenter="enter('3458281120857355945');" onmouseout="out('3458281120857355945');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226           String.format(&quot;任务下载失败，errorCode：%s, errorMsg: %s, url: %s&quot;, code,                              </span>
<span class="-865670794746359823" onmouseenter="enter('-865670794746359823');" onmouseout="out('-865670794746359823');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227               conn.getResponseMessage(), mEntity.getUrl())), !CheckUtil.httpIsBadRequest(code));         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228     }                                                                                                    </span>
<span class="-6801527756571482213" onmouseenter="enter('-6801527756571482213');" onmouseout="out('-6801527756571482213');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229     if (end) {                                                                                           </span>
<span class="-9049555213483660293" onmouseenter="enter('-9049555213483660293');" onmouseout="out('-9049555213483660293');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230       taskOption.setChunked(isChunked);                                                                  </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231       if (onFileInfoCallback != null) {                                                                  </span>
<span class="-3029323004951684182" onmouseenter="enter('-3029323004951684182');" onmouseout="out('-3029323004951684182');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232         CompleteInfo info = new CompleteInfo(code, mTaskWrapper);                                        </span>
<span class="1239392088731349048" onmouseenter="enter('1239392088731349048');" onmouseout="out('1239392088731349048');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233         onFileInfoCallback.onComplete(mEntity.getUrl(), info);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234       }                                                                                                  </span>
<span class="-2332174823472847291" onmouseenter="enter('-2332174823472847291');" onmouseout="out('-2332174823472847291');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235       mEntity.update();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239   /**                                                                                                    </span>
<span class="-2847240885661455178" onmouseenter="enter('-2847240885661455178');" onmouseout="out('-2847240885661455178');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240    * 处理&quot;Content-Disposition&quot;参数                                                                           </span>
<span class="8881865652474859794" onmouseenter="enter('8881865652474859794');" onmouseout="out('8881865652474859794');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241    * &lt;a href=https://cloud.tencent.com/developer/section/1189916&gt;Content-Disposition&lt;/a&gt;&lt;/&gt;              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242    *                                                                                                     </span>
<span class="-7776712758593145643" onmouseenter="enter('-7776712758593145643');" onmouseout="out('-7776712758593145643');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243    * @throws UnsupportedEncodingException                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244    */                                                                                                    </span>
<span class="-8608321373459550338" onmouseenter="enter('-8608321373459550338');" onmouseout="out('-8608321373459550338');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245   private void handleContentDisposition(String disposition) throws UnsupportedEncodingException {        </span>
<span class="8299914696584334305" onmouseenter="enter('8299914696584334305');" onmouseout="out('8299914696584334305');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246     if (disposition.contains(&quot;;&quot;)) {                                                                     </span>
<span class="-8249279439551045927" onmouseenter="enter('-8249279439551045927');" onmouseout="out('-8249279439551045927');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247       String[] infos = disposition.split(&quot;;&quot;);                                                           </span>
<span class="2055683922126838823" onmouseenter="enter('2055683922126838823');" onmouseout="out('2055683922126838823');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248       if (infos[0].equals(&quot;attachment&quot;)) {                                                               </span>
<span class="-6108489956922562466" onmouseenter="enter('-6108489956922562466');" onmouseout="out('-6108489956922562466');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249         for (String info : infos) {                                                                      </span>
<span class="-3445363461731907777" onmouseenter="enter('-3445363461731907777');" onmouseout="out('-3445363461731907777');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250           if (info.startsWith(&quot;filename&quot;) &amp;&amp; info.contains(&quot;=&quot;)) {                                       </span>
<span class="3695771658612668290" onmouseenter="enter('3695771658612668290');" onmouseout="out('3695771658612668290');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251             String[] temp = info.split(&quot;=&quot;);                                                             </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252             if (temp.length &gt; 1) {                                                                       </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253               String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                 </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254               mEntity.setServerFileName(newName);                                                        </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255               renameFile(newName);                                                                       </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256               break;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258           }                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259         }                                                                                                </span>
<span class="6794164660951287492" onmouseenter="enter('6794164660951287492');" onmouseout="out('6794164660951287492');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260       } else if (infos[0].equals(&quot;form-data&quot;) &amp;&amp; infos.length &gt; 2) {                                     </span>
<span class="-8905252974632201641" onmouseenter="enter('-8905252974632201641');" onmouseout="out('-8905252974632201641');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261         String[] temp = infos[2].split(&quot;=&quot;);                                                             </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262         if (temp.length &gt; 1) {                                                                           </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263           String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                     </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264           mEntity.setServerFileName(newName);                                                            </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265           renameFile(newName);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266         }                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267       } else {                                                                                           </span>
<span class="7479053829749492027" onmouseenter="enter('7479053829749492027');" onmouseout="out('7479053829749492027');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268         ALog.w(TAG, &quot;不识别的Content-Disposition参数&quot;);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273   /**                                                                                                    </span>
<span class="-5538524699876672002" onmouseenter="enter('-5538524699876672002');" onmouseout="out('-5538524699876672002');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274    * 重命名文件                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275    */                                                                                                    </span>
<span class="-7899950182898562290" onmouseenter="enter('-7899950182898562290');" onmouseout="out('-7899950182898562290');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276   private void renameFile(String newName) {                                                              </span>
<span class="4040095654750429587" onmouseenter="enter('4040095654750429587');" onmouseout="out('4040095654750429587');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277     if (TextUtils.isEmpty(newName)) {                                                                    </span>
<span class="7746921739080291575" onmouseenter="enter('7746921739080291575');" onmouseout="out('7746921739080291575');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278       ALog.w(TAG, &quot;重命名失败【服务器返回的文件名为空】&quot;);                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280     }                                                                                                    </span>
<span class="-897821573073116237" onmouseenter="enter('-897821573073116237');" onmouseout="out('-897821573073116237');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281     ALog.d(TAG, String.format(&quot;文件重命名为：%s&quot;, newName));                                                    </span>
<span class="3112348380249890188" onmouseenter="enter('3112348380249890188');" onmouseout="out('3112348380249890188');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282     File oldFile = new File(mEntity.getFilePath());                                                      </span>
<span class="6384479286325830175" onmouseenter="enter('6384479286325830175');" onmouseout="out('6384479286325830175');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283     String newPath = oldFile.getParent() + &quot;/&quot; + newName;                                                </span>
<span class="-8664365027300439044" onmouseenter="enter('-8664365027300439044');" onmouseout="out('-8664365027300439044');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284     if (oldFile.exists()) {                                                                              </span>
<span class="-2839507751750912779" onmouseenter="enter('-2839507751750912779');" onmouseout="out('-2839507751750912779');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285       boolean b = oldFile.renameTo(new File(newPath));                                                   </span>
<span class="1440136229140496041" onmouseenter="enter('1440136229140496041');" onmouseout="out('1440136229140496041');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286       ALog.d(TAG, String.format(&quot;文件重命名%s&quot;, b ? &quot;成功&quot; : &quot;失败&quot;));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287     }                                                                                                    </span>
<span class="-3962615333140495301" onmouseenter="enter('-3962615333140495301');" onmouseout="out('-3962615333140495301');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288     mEntity.setFileName(newName);                                                                        </span>
<span class="5260470821929213762" onmouseenter="enter('5260470821929213762');" onmouseout="out('5260470821929213762');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289     mEntity.setFilePath(newPath);                                                                        </span>
<span class="552132236643695604" onmouseenter="enter('552132236643695604');" onmouseout="out('552132236643695604');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290     RecordUtil.modifyTaskRecord(oldFile.getPath(), newPath, mEntity.getTaskType());                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293   /**                                                                                                    </span>
<span class="-761470207976407479" onmouseenter="enter('-761470207976407479');" onmouseout="out('-761470207976407479');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294    * 处理30x跳转                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295    */                                                                                                    </span>
<span class="5556617621352975519" onmouseenter="enter('5556617621352975519');" onmouseout="out('5556617621352975519');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296   private void handleUrlReTurn(HttpURLConnection conn, String newUrl) throws IOException {               </span>
<span class="9112975487181986733" onmouseenter="enter('9112975487181986733');" onmouseout="out('9112975487181986733');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297     ALog.d(TAG, &quot;30x跳转，新url为【&quot; + newUrl + &quot;】&quot;);                                                          </span>
<span class="-3187267727779732659" onmouseenter="enter('-3187267727779732659');" onmouseout="out('-3187267727779732659');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298     if (TextUtils.isEmpty(newUrl) || newUrl.equalsIgnoreCase(&quot;null&quot;)) {                                  </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299       if (onFileInfoCallback != null) {                                                                  </span>
<span class="7265698984710319788" onmouseenter="enter('7265698984710319788');" onmouseout="out('7265698984710319788');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300         onFileInfoCallback.onFail(mEntity, new TaskException(TAG, &quot;获取重定向链接失败&quot;), false);                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301       }                                                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 303     }                                                                                                    </span>
<span class="-4691236730005429135" onmouseenter="enter('-4691236730005429135');" onmouseout="out('-4691236730005429135');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304     if (newUrl.startsWith(&quot;/&quot;)) {                                                                        </span>
<span class="-7947437880890249902" onmouseenter="enter('-7947437880890249902');" onmouseout="out('-7947437880890249902');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305       Uri uri = Uri.parse(mEntity.getUrl());                                                             </span>
<span class="-159008217290066182" onmouseenter="enter('-159008217290066182');" onmouseout="out('-159008217290066182');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306       newUrl = uri.getHost() + newUrl;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308                                                                                                          </span>
<span class="-4197272966192810800" onmouseenter="enter('-4197272966192810800');" onmouseout="out('-4197272966192810800');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309     if (!CheckUtil.checkUrl(newUrl)) {                                                                   </span>
<span class="8671661921003868184" onmouseenter="enter('8671661921003868184');" onmouseout="out('8671661921003868184');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310       failDownload(new TaskException(TAG, &quot;下载失败，重定向url错误&quot;), false);                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312     }                                                                                                    </span>
<span class="2121195664546392305" onmouseenter="enter('2121195664546392305');" onmouseout="out('2121195664546392305');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313     taskOption.setRedirectUrl(newUrl);                                                                   </span>
<span class="-7202069996221856390" onmouseenter="enter('-7202069996221856390');" onmouseout="out('-7202069996221856390');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314     mEntity.setRedirect(true);                                                                           </span>
<span class="3562634937094117088" onmouseenter="enter('3562634937094117088');" onmouseout="out('3562634937094117088');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315     mEntity.setRedirectUrl(newUrl);                                                                      </span>
<span class="-6439352303300997905" onmouseenter="enter('-6439352303300997905');" onmouseout="out('-6439352303300997905');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316     String cookies = conn.getHeaderField(&quot;Set-Cookie&quot;);                                                  </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317     conn.disconnect();                                                                                   </span>
<span class="7827815028692387267" onmouseenter="enter('7827815028692387267');" onmouseout="out('7827815028692387267');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318     URL url = ConnectionHelp.handleUrl(newUrl, taskOption);                                              </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 319     conn = ConnectionHelp.handleConnection(url, taskOption);                                             </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320     ConnectionHelp.setConnectParam(taskOption, conn);                                                    </span>
<span class="-9082472095175979719" onmouseenter="enter('-9082472095175979719');" onmouseout="out('-9082472095175979719');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 321     conn.setRequestProperty(&quot;Cookie&quot;, cookies);                                                          </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 322     conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                                </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 323     conn.setConnectTimeout(mConnectTimeOut);                                                             </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 324     conn.connect();                                                                                      </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 325     handleConnect(conn);                                                                                 </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 326     conn.disconnect();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 327   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 328                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 329   /**                                                                                                    </span>
<span class="8188732119885086451" onmouseenter="enter('8188732119885086451');" onmouseout="out('8188732119885086451');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 330    * 检查长度是否合法，并且检查新获取的文件长度是否和数据库的文件长度一直，如果不一致，则表示该任务为新任务                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 331    *                                                                                                     </span>
<span class="7508607167277684618" onmouseenter="enter('7508607167277684618');" onmouseout="out('7508607167277684618');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 332    * @param len 从服务器获取的文件长度                                                                              </span>
<span class="2269811577157119944" onmouseenter="enter('2269811577157119944');" onmouseout="out('2269811577157119944');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 333    * @return {@code true}合法                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 334    */                                                                                                    </span>
<span class="226943708538926451" onmouseenter="enter('226943708538926451');" onmouseout="out('226943708538926451');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 335   private boolean checkLen(long len) {                                                                   </span>
<span class="-6834276917361274338" onmouseenter="enter('-6834276917361274338');" onmouseout="out('-6834276917361274338');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 336     if (len != mEntity.getFileSize()) {                                                                  </span>
<span class="7031409428945889302" onmouseenter="enter('7031409428945889302');" onmouseout="out('7031409428945889302');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 337       ALog.d(TAG, &quot;长度不一致，任务为新任务&quot;);                                                                       </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 338       mTaskWrapper.setNewTask(true);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 339     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 340     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 341   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 342                                                                                                          </span>
<span class="-4015346071016137178" onmouseenter="enter('-4015346071016137178');" onmouseout="out('-4015346071016137178');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 343   private void failDownload(BaseException e, boolean needRetry) {                                        </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 344     if (onFileInfoCallback != null) {                                                                    </span>
<span class="-3744805558345201426" onmouseenter="enter('-3744805558345201426');" onmouseout="out('-3744805558345201426');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 345       onFileInfoCallback.onFail(mEntity, e, needRetry);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 346     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 347   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 348                                                                                                          </span>
<span class="-306327811626166304" onmouseenter="enter('-306327811626166304');" onmouseout="out('-306327811626166304');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 349   private static class FileLenAdapter implements IHttpFileLenAdapter {                                   </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 350                                                                                                          </span>
<span class="-4968473764170008746" onmouseenter="enter('-4968473764170008746');" onmouseout="out('-4968473764170008746');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 351     @Override public long handleFileLen(Map&lt;String, List&lt;String&gt;&gt; headers) {                             </span>
<span class="-3703403373407617525" onmouseenter="enter('-3703403373407617525');" onmouseout="out('-3703403373407617525');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 352       if (headers == null || headers.isEmpty()) {                                                        </span>
<span class="7978066123796535188" onmouseenter="enter('7978066123796535188');" onmouseout="out('7978066123796535188');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353         ALog.e(TAG, &quot;header为空，获取文件长度失败&quot;);                                                                </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354         return -1;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355       }                                                                                                  </span>
<span class="-3327040667133742279" onmouseenter="enter('-3327040667133742279');" onmouseout="out('-3327040667133742279');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356       List&lt;String&gt; sLength = headers.get(&quot;Content-Length&quot;);                                              </span>
<span class="-5638961086111332224" onmouseenter="enter('-5638961086111332224');" onmouseout="out('-5638961086111332224');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357       if (sLength == null || sLength.isEmpty()) {                                                        </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358         return -1;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359       }                                                                                                  </span>
<span class="1006906766372690526" onmouseenter="enter('1006906766372690526');" onmouseout="out('1006906766372690526');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360       String temp = sLength.get(0);                                                                      </span>
<span class="-859592945496577082" onmouseenter="enter('-859592945496577082');" onmouseout="out('-859592945496577082');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361       long len = TextUtils.isEmpty(temp) ? -1 : Long.parseLong(temp);                                    </span>
<span class="-3482859616975282364" onmouseenter="enter('-3482859616975282364');" onmouseout="out('-3482859616975282364');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362       // 某些服务，如果设置了conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                 </span>
<span class="-2343886357485900465" onmouseenter="enter('-2343886357485900465');" onmouseout="out('-2343886357485900465');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363       // 会返回 Content-Range: bytes 0-225427911/225427913                                                  </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364       if (len &lt; 0) {                                                                                     </span>
<span class="-5449604609323133496" onmouseenter="enter('-5449604609323133496');" onmouseout="out('-5449604609323133496');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365         List&lt;String&gt; sRange = headers.get(&quot;Content-Range&quot;);                                              </span>
<span class="-939726222710114379" onmouseenter="enter('-939726222710114379');" onmouseout="out('-939726222710114379');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366         if (sRange == null || sRange.isEmpty()) {                                                        </span>
<span class="-428304200248281464" onmouseenter="enter('-428304200248281464');" onmouseout="out('-428304200248281464');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367           len = -1;                                                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368         } else {                                                                                         </span>
<span class="-552616904450344700" onmouseenter="enter('-552616904450344700');" onmouseout="out('-552616904450344700');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369           int start = temp.indexOf(&quot;/&quot;);                                                                 </span>
<span class="6692102738649716212" onmouseenter="enter('6692102738649716212');" onmouseout="out('6692102738649716212');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370           len = Long.parseLong(temp.substring(start + 1));                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372       }                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373                                                                                                          </span>
<span class="7701238698032811091" onmouseenter="enter('7701238698032811091');" onmouseout="out('7701238698032811091');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374       return len;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377 }                                                                                                        </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 378 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
















































































































































































































































































































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   1 -/*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   2 - * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   3 - *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   4 - * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   5 - * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   6 - * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   7 - *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   8 - *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">   9 - *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  10 - * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  11 - * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  12 - * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  13 - * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  14 - * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  15 - */                                                                                                               </span>
<span class="-7236899369024788297" onmouseenter="enter('-7236899369024788297');" onmouseout="out('-7236899369024788297');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  16 -package com.arialyy.aria.http;                                                                                    </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  17 -                                                                                                                  </span>
<span class="-6390350725830347024" onmouseenter="enter('-6390350725830347024');" onmouseout="out('-6390350725830347024');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  18 -import android.net.TrafficStats;                                                                                  </span>
<span class="-8750621697125156872" onmouseenter="enter('-8750621697125156872');" onmouseout="out('-8750621697125156872');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  19 -import android.net.Uri;                                                                                           </span>
<span class="3485143652294101472" onmouseenter="enter('3485143652294101472');" onmouseout="out('3485143652294101472');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  20 -import android.os.Process;                                                                                        </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  21 -import android.text.TextUtils;                                                                                    </span>
<span class="8153369258057528270" onmouseenter="enter('8153369258057528270');" onmouseout="out('8153369258057528270');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -import com.arialyy.aria.core.AriaConfig;                                                                          </span>
<span class="5028823532254250595" onmouseenter="enter('5028823532254250595');" onmouseout="out('5028823532254250595');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import com.arialyy.aria.core.common.CompleteInfo;                                                                 </span>
<span class="7716102167634407665" onmouseenter="enter('7716102167634407665');" onmouseout="out('7716102167634407665');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import com.arialyy.aria.core.common.RequestEnum;                                                                  </span>
<span class="-3497740022528182602" onmouseenter="enter('-3497740022528182602');" onmouseout="out('-3497740022528182602');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import com.arialyy.aria.core.download.DTaskWrapper;                                                               </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -import com.arialyy.aria.core.download.DownloadEntity;                                                             </span>
<span class="-5825121975347398532" onmouseenter="enter('-5825121975347398532');" onmouseout="out('-5825121975347398532');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  27 -import com.arialyy.aria.core.inf.OnFileInfoCallback;                                                              </span>
<span class="-5191825800443458517" onmouseenter="enter('-5191825800443458517');" onmouseout="out('-5191825800443458517');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  28 -import com.arialyy.aria.core.processor.IHttpFileLenAdapter;                                                       </span>
<span class="6359380642632041098" onmouseenter="enter('6359380642632041098');" onmouseout="out('6359380642632041098');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import com.arialyy.aria.exception.AriaIOException;                                                                </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  30 -import com.arialyy.aria.exception.BaseException;                                                                  </span>
<span class="-5001091348570971924" onmouseenter="enter('-5001091348570971924');" onmouseout="out('-5001091348570971924');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  31 -import com.arialyy.aria.exception.TaskException;                                                                  </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  32 -import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -import com.arialyy.aria.util.CheckUtil;                                                                           </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 -import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  35 -import com.arialyy.aria.util.FileUtil;                                                                            </span>
<span class="-969957896094278671" onmouseenter="enter('-969957896094278671');" onmouseout="out('-969957896094278671');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -import com.arialyy.aria.util.RecordUtil;                                                                          </span>
<span class="-4738630423427876475" onmouseenter="enter('-4738630423427876475');" onmouseout="out('-4738630423427876475');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -import java.io.BufferedReader;                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  39 -import java.io.IOException;                                                                                       </span>
<span class="-5152338856474932575" onmouseenter="enter('-5152338856474932575');" onmouseout="out('-5152338856474932575');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  40 -import java.io.InputStreamReader;                                                                                 </span>
<span class="3835172898968420800" onmouseenter="enter('3835172898968420800');" onmouseout="out('3835172898968420800');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  41 -import java.io.OutputStreamWriter;                                                                                </span>
<span class="8256805395213692609" onmouseenter="enter('8256805395213692609');" onmouseout="out('8256805395213692609');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  42 -import java.io.UnsupportedEncodingException;                                                                      </span>
<span class="7759739624588802903" onmouseenter="enter('7759739624588802903');" onmouseout="out('7759739624588802903');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  43 -import java.net.CookieManager;                                                                                    </span>
<span class="-5584619311424941805" onmouseenter="enter('-5584619311424941805');" onmouseout="out('-5584619311424941805');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  44 -import java.net.HttpCookie;                                                                                       </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  45 -import java.net.HttpURLConnection;                                                                                </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  46 -import java.net.URL;                                                                                              </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  47 -import java.net.URLDecoder;                                                                                       </span>
<span class="302463665162759210" onmouseenter="enter('302463665162759210');" onmouseout="out('302463665162759210');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  48 -import java.net.URLEncoder;                                                                                       </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  49 -import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  50 -import java.util.Map;                                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  51 -import java.util.Set;                                                                                             </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  52 -import java.util.UUID;                                                                                            </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  53 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  54 -/**                                                                                                               </span>
<span class="-1733864505168931106" onmouseenter="enter('-1733864505168931106');" onmouseout="out('-1733864505168931106');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 - * 下载文件信息获取                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  56 - */                                                                                                               </span>
<span class="-8507874378969942466" onmouseenter="enter('-8507874378969942466');" onmouseout="out('-8507874378969942466');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  57 -public class HttpFileInfoThread implements Runnable {                                                             </span>
<span class="-960543327724144855" onmouseenter="enter('-960543327724144855');" onmouseout="out('-960543327724144855');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  58 -  private static final String TAG = &quot;HttpFileInfoThread&quot;;                                                         </span>
<span class="-7151375780097547664" onmouseenter="enter('-7151375780097547664');" onmouseout="out('-7151375780097547664');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -  private DownloadEntity mEntity;                                                                                 </span>
<span class="-3857309927385466618" onmouseenter="enter('-3857309927385466618');" onmouseout="out('-3857309927385466618');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  60 -  private DTaskWrapper mTaskWrapper;                                                                              </span>
<span class="8600882525060240313" onmouseenter="enter('8600882525060240313');" onmouseout="out('8600882525060240313');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  61 -  private int mConnectTimeOut;                                                                                    </span>
<span class="-6824755283282820235" onmouseenter="enter('-6824755283282820235');" onmouseout="out('-6824755283282820235');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  62 -  private OnFileInfoCallback onFileInfoCallback;                                                                  </span>
<span class="6827268874849985533" onmouseenter="enter('6827268874849985533');" onmouseout="out('6827268874849985533');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  63 -  private HttpTaskOption taskOption;                                                                              </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  64 -                                                                                                                  </span>
<span class="-5652336240759927020" onmouseenter="enter('-5652336240759927020');" onmouseout="out('-5652336240759927020');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  65 -  public HttpFileInfoThread(DTaskWrapper taskWrapper, OnFileInfoCallback callback) {                              </span>
<span class="-3805550036651318371" onmouseenter="enter('-3805550036651318371');" onmouseout="out('-3805550036651318371');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  66 -    this.mTaskWrapper = taskWrapper;                                                                              </span>
<span class="-170355754520114419" onmouseenter="enter('-170355754520114419');" onmouseout="out('-170355754520114419');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  67 -    mEntity = taskWrapper.getEntity();                                                                            </span>
<span class="2572452400414830057" onmouseenter="enter('2572452400414830057');" onmouseout="out('2572452400414830057');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  68 -    mConnectTimeOut = AriaConfig.getInstance().getDConfig().getConnectTimeOut();                                  </span>
<span class="1217537359294132674" onmouseenter="enter('1217537359294132674');" onmouseout="out('1217537359294132674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  69 -    onFileInfoCallback = callback;                                                                                </span>
<span class="6933673676495207920" onmouseenter="enter('6933673676495207920');" onmouseout="out('6933673676495207920');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  70 -    taskOption = (HttpTaskOption) taskWrapper.getTaskOption();                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  71 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  72 -                                                                                                                  </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  73 -  @Override public void run() {                                                                                   </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  74 -    Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                                </span>
<span class="-1851318291295515457" onmouseenter="enter('-1851318291295515457');" onmouseout="out('-1851318291295515457');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  75 -    TrafficStats.setThreadStatsTag(UUID.randomUUID().toString().hashCode());                                      </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  76 -    HttpURLConnection conn = null;                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  77 -    try {                                                                                                         </span>
<span class="7954771811613007401" onmouseenter="enter('7954771811613007401');" onmouseout="out('7954771811613007401');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  78 -      URL url = ConnectionHelp.handleUrl(mEntity.getUrl(), taskOption);                                           </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  79 -      conn = ConnectionHelp.handleConnection(url, taskOption);                                                    </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  80 -      ConnectionHelp.setConnectParam(taskOption, conn);                                                           </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  81 -      conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                                       </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  82 -      conn.setConnectTimeout(mConnectTimeOut);                                                                    </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  83 -      conn.connect();                                                                                             </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  84 -      handleConnect(conn);                                                                                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  85 -    } catch (IOException e) {                                                                                     </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  86 -      e.printStackTrace();                                                                                        </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  87 -      failDownload(new AriaIOException(TAG,                                                                       </span>
<span class="-4053293382299681633" onmouseenter="enter('-4053293382299681633');" onmouseout="out('-4053293382299681633');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  88 -              String.format(&quot;下载失败，filePath: %s, url: %s&quot;, mEntity.getDownloadPath(), mEntity.getUrl())),          </span>
<span class="-159362617709534437" onmouseenter="enter('-159362617709534437');" onmouseout="out('-159362617709534437');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  89 -          true);                                                                                                  </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  90 -    } finally {                                                                                                   </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  91 -      if (conn != null) {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  92 -        try {                                                                                                     </span>
<span class="-8686251500819757648" onmouseenter="enter('-8686251500819757648');" onmouseout="out('-8686251500819757648');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  93 -          conn.getInputStream().close();                                                                          </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -        } catch (IOException e) {                                                                                 </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -          e.printStackTrace();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -        }                                                                                                         </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -        conn.disconnect();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -                                                                                                                  </span>
<span class="7469915187822843170" onmouseenter="enter('7469915187822843170');" onmouseout="out('7469915187822843170');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -  private void handleConnect(HttpURLConnection conn) throws IOException {                                         </span>
<span class="-5135480308665977678" onmouseenter="enter('-5135480308665977678');" onmouseout="out('-5135480308665977678');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -    if (taskOption.getRequestEnum() == RequestEnum.POST) {                                                        </span>
<span class="-5476217355085156421" onmouseenter="enter('-5476217355085156421');" onmouseout="out('-5476217355085156421');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -      Map&lt;String, String&gt; params = taskOption.getParams();                                                        </span>
<span class="3157859291963549592" onmouseenter="enter('3157859291963549592');" onmouseout="out('3157859291963549592');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 105 -      if (params != null) {                                                                                       </span>
<span class="1177673060067921781" onmouseenter="enter('1177673060067921781');" onmouseout="out('1177673060067921781');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 106 -        OutputStreamWriter dos = new OutputStreamWriter(conn.getOutputStream());                                  </span>
<span class="-2461846026114443284" onmouseenter="enter('-2461846026114443284');" onmouseout="out('-2461846026114443284');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 107 -        Set&lt;String&gt; keys = params.keySet();                                                                       </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 108 -        StringBuilder sb = new StringBuilder();                                                                   </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 109 -        for (String key : keys) {                                                                                 </span>
<span class="-378086891984466400" onmouseenter="enter('-378086891984466400');" onmouseout="out('-378086891984466400');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 110 -          sb.append(key).append(&quot;=&quot;).append(URLEncoder.encode(params.get(key))).append(&quot;&amp;&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 111 -        }                                                                                                         </span>
<span class="-1170631941621929173" onmouseenter="enter('-1170631941621929173');" onmouseout="out('-1170631941621929173');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 112 -        String url = sb.toString();                                                                               </span>
<span class="-2854610904289092260" onmouseenter="enter('-2854610904289092260');" onmouseout="out('-2854610904289092260');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 113 -        url = url.substring(0, url.length() - 1);                                                                 </span>
<span class="-412821746973687146" onmouseenter="enter('-412821746973687146');" onmouseout="out('-412821746973687146');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 114 -        dos.write(url);                                                                                           </span>
<span class="-6320099346663956498" onmouseenter="enter('-6320099346663956498');" onmouseout="out('-6320099346663956498');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 115 -        dos.flush();                                                                                              </span>
<span class="1568727060082909957" onmouseenter="enter('1568727060082909957');" onmouseout="out('1568727060082909957');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 116 -        dos.close();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 117 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 118 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 119 -                                                                                                                  </span>
<span class="831227310872116523" onmouseenter="enter('831227310872116523');" onmouseout="out('831227310872116523');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 120 -    IHttpFileLenAdapter lenAdapter = taskOption.getFileLenAdapter();                                              </span>
<span class="5196440776228873073" onmouseenter="enter('5196440776228873073');" onmouseout="out('5196440776228873073');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 121 -    if (lenAdapter == null) {                                                                                     </span>
<span class="7197457532950740585" onmouseenter="enter('7197457532950740585');" onmouseout="out('7197457532950740585');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 122 -      lenAdapter = new FileLenAdapter();                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 123 -    } else {                                                                                                      </span>
<span class="-2288407285072363665" onmouseenter="enter('-2288407285072363665');" onmouseout="out('-2288407285072363665');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 124 -      ALog.d(TAG, &quot;使用自定义adapter&quot;);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 125 -    }                                                                                                             </span>
<span class="-3117441631991498996" onmouseenter="enter('-3117441631991498996');" onmouseout="out('-3117441631991498996');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 126 -    long len = lenAdapter.handleFileLen(conn.getHeaderFields());                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 127 -                                                                                                                  </span>
<span class="-1607077255181731471" onmouseenter="enter('-1607077255181731471');" onmouseout="out('-1607077255181731471');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 128 -    if (!FileUtil.checkSDMemorySpace(mEntity.getFilePath(), len)) {                                               </span>

<span class="-1675602595326094546" onmouseenter="enter('-1675602595326094546');" onmouseout="out('-1675602595326094546');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 129 -      failDownload(new TaskException(TAG,                                                                         </span>
<span class="380344701162823709" onmouseenter="enter('380344701162823709');" onmouseout="out('380344701162823709');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 130 -          String.format(&quot;下载失败，内存空间不足；filePath: %s, url: %s&quot;, mEntity.getDownloadPath(),                           </span>
<span class="3748007250659926415" onmouseenter="enter('3748007250659926415');" onmouseout="out('3748007250659926415');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 131 -              mEntity.getUrl())), false);                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 132 -      return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 133 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 134 -                                                                                                                  </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 135 -    int code = conn.getResponseCode();                                                                            </span>
<span class="243612440262257064" onmouseenter="enter('243612440262257064');" onmouseout="out('243612440262257064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -    boolean end = false;                                                                                          </span>
<span class="3661527496298260626" onmouseenter="enter('3661527496298260626');" onmouseout="out('3661527496298260626');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 137 -    if (TextUtils.isEmpty(mEntity.getMd5Code())) {                                                                </span>
<span class="6175847651720741920" onmouseenter="enter('6175847651720741920');" onmouseout="out('6175847651720741920');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 138 -      String md5Code = conn.getHeaderField(&quot;Content-MD5&quot;);                                                        </span>
<span class="3841984198412482104" onmouseenter="enter('3841984198412482104');" onmouseout="out('3841984198412482104');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 139 -      mEntity.setMd5Code(md5Code);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 140 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 141 -                                                                                                                  </span>
<span class="-9137345962727529427" onmouseenter="enter('-9137345962727529427');" onmouseout="out('-9137345962727529427');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 142 -    boolean isChunked = false;                                                                                    </span>
<span class="-8116968388415792268" onmouseenter="enter('-8116968388415792268');" onmouseout="out('-8116968388415792268');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 143 -    final String str = conn.getHeaderField(&quot;Transfer-Encoding&quot;);                                                  </span>
<span class="-6629832129461298046" onmouseenter="enter('-6629832129461298046');" onmouseout="out('-6629832129461298046');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 144 -    if (!TextUtils.isEmpty(str) &amp;&amp; str.equals(&quot;chunked&quot;)) {                                                       </span>
<span class="268583664719475207" onmouseenter="enter('268583664719475207');" onmouseout="out('268583664719475207');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 145 -      isChunked = true;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 146 -    }                                                                                                             </span>
<span class="8180254556269969385" onmouseenter="enter('8180254556269969385');" onmouseout="out('8180254556269969385');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 147 -    Map&lt;String, List&lt;String&gt;&gt; headers = conn.getHeaderFields();                                                   </span>
<span class="8122923533236748969" onmouseenter="enter('8122923533236748969');" onmouseout="out('8122923533236748969');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -    String disposition = conn.getHeaderField(&quot;Content-Disposition&quot;);                                              </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 149 -                                                                                                                  </span>
<span class="-3052400857632215863" onmouseenter="enter('-3052400857632215863');" onmouseout="out('-3052400857632215863');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 150 -    if (taskOption.isUseServerFileName()) {                                                                       </span>
<span class="9149723838126995721" onmouseenter="enter('9149723838126995721');" onmouseout="out('9149723838126995721');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -      if (!TextUtils.isEmpty(disposition)) {                                                                      </span>
<span class="3142217124074067362" onmouseenter="enter('3142217124074067362');" onmouseout="out('3142217124074067362');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -        mEntity.setDisposition(CommonUtil.encryptBASE64(disposition));                                            </span>
<span class="8894179749774343207" onmouseenter="enter('8894179749774343207');" onmouseout="out('8894179749774343207');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -        handleContentDisposition(disposition);                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 154 -      } else {                                                                                                    </span>
<span class="6725831659311340657" onmouseenter="enter('6725831659311340657');" onmouseout="out('6725831659311340657');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 155 -        ALog.w(TAG, &quot;Content-Disposition对于端字段为空，使用服务器端文件名失败&quot;);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 156 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -    }                                                                                                             </span>
<span class="3131612029960887116" onmouseenter="enter('3131612029960887116');" onmouseout="out('3131612029960887116');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 158 -    CookieManager msCookieManager = new CookieManager();                                                          </span>
<span class="6317541366742429029" onmouseenter="enter('6317541366742429029');" onmouseout="out('6317541366742429029');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -    List&lt;String&gt; cookiesHeader = headers.get(&quot;Set-Cookie&quot;);                                                       </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 160 -                                                                                                                  </span>
<span class="-3711800334805746628" onmouseenter="enter('-3711800334805746628');" onmouseout="out('-3711800334805746628');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 161 -    if (cookiesHeader != null) {                                                                                  </span>
<span class="50137583020384401" onmouseenter="enter('50137583020384401');" onmouseout="out('50137583020384401');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 162 -      for (String cookie : cookiesHeader) {                                                                       </span>
<span class="-5052850978727150914" onmouseenter="enter('-5052850978727150914');" onmouseout="out('-5052850978727150914');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 163 -        msCookieManager.getCookieStore().add(null, HttpCookie.parse(cookie).get(0));                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 164 -      }                                                                                                           </span>
<span class="-6061807114007929519" onmouseenter="enter('-6061807114007929519');" onmouseout="out('-6061807114007929519');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 165 -      taskOption.setCookieManager(msCookieManager);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 167 -                                                                                                                  </span>
<span class="-5434227081099310624" onmouseenter="enter('-5434227081099310624');" onmouseout="out('-5434227081099310624');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 168 -    mTaskWrapper.setCode(code);                                                                                   </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -    if (code == HttpURLConnection.HTTP_PARTIAL) {                                                                 </span>
<span class="3476352595280537016" onmouseenter="enter('3476352595280537016');" onmouseout="out('3476352595280537016');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 170 -      if (!checkLen(len) &amp;&amp; !isChunked) {                                                                         </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 171 -        if (len &lt; 0) {                                                                                            </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 172 -          failDownload(                                                                                           </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 173 -              new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),               </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -              false);                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -        }                                                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 176 -        return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 177 -      }                                                                                                           </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 178 -      mEntity.setFileSize(len);                                                                                   </span>
<span class="4333195157428278321" onmouseenter="enter('4333195157428278321');" onmouseout="out('4333195157428278321');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 179 -      mTaskWrapper.setSupportBP(true);                                                                            </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 180 -      end = true;                                                                                                 </span>
<span class="2496770639447193327" onmouseenter="enter('2496770639447193327');" onmouseout="out('2496770639447193327');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 181 -    } else if (code == HttpURLConnection.HTTP_OK) {                                                               </span>
<span class="-998567010505343674" onmouseenter="enter('-998567010505343674');" onmouseout="out('-998567010505343674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 182 -      String contentType = conn.getHeaderField(&quot;Content-Type&quot;);                                                   </span>
<span class="201076292918755336" onmouseenter="enter('201076292918755336');" onmouseout="out('201076292918755336');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 183 -      if (TextUtils.isEmpty(contentType)) {                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 184 -        return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 185 -      }                                                                                                           </span>
<span class="8927907009918172915" onmouseenter="enter('8927907009918172915');" onmouseout="out('8927907009918172915');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 186 -      if (contentType.equals(&quot;text/html&quot;)) {                                                                      </span>
<span class="8342413994542158594" onmouseenter="enter('8342413994542158594');" onmouseout="out('8342413994542158594');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 187 -        BufferedReader reader =                                                                                   </span>
<span class="-7427210485489972460" onmouseenter="enter('-7427210485489972460');" onmouseout="out('-7427210485489972460');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 188 -            new BufferedReader(new InputStreamReader(ConnectionHelp.convertInputStream(conn)));                   </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 189 -        StringBuilder sb = new StringBuilder();                                                                   </span>
<span class="6431556981547329060" onmouseenter="enter('6431556981547329060');" onmouseout="out('6431556981547329060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 190 -        String line;                                                                                              </span>
<span class="4058321022246549205" onmouseenter="enter('4058321022246549205');" onmouseout="out('4058321022246549205');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 191 -        while ((line = reader.readLine()) != null) {                                                              </span>
<span class="-6213624305830265937" onmouseenter="enter('-6213624305830265937');" onmouseout="out('-6213624305830265937');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 192 -          sb.append(line);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 193 -        }                                                                                                         </span>
<span class="8277398435538005537" onmouseenter="enter('8277398435538005537');" onmouseout="out('8277398435538005537');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 194 -        reader.close();                                                                                           </span>
<span class="8311106050401029529" onmouseenter="enter('8311106050401029529');" onmouseout="out('8311106050401029529');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 195 -        handleUrlReTurn(conn, CommonUtil.getWindowReplaceUrl(sb.toString()));                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 196 -        return;                                                                                                   </span>
<span class="-4432363278840297326" onmouseenter="enter('-4432363278840297326');" onmouseout="out('-4432363278840297326');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 197 -      } else if (!checkLen(len) &amp;&amp; !isChunked) {                                                                  </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 198 -        if (len &lt; 0) {                                                                                            </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 199 -          failDownload(                                                                                           </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 200 -              new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),               </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 201 -              false);                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 202 -        }                                                                                                         </span>
<span class="1925321240779458317" onmouseenter="enter('1925321240779458317');" onmouseout="out('1925321240779458317');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 203 -        ALog.d(TAG, &quot;len &lt; 0&quot;);                                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 204 -        return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 205 -      }                                                                                                           </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 206 -      mEntity.setFileSize(len);                                                                                   </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 207 -      mTaskWrapper.setNewTask(true);                                                                              </span>
<span class="9157524552034725227" onmouseenter="enter('9157524552034725227');" onmouseout="out('9157524552034725227');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 208 -      mTaskWrapper.setSupportBP(false);                                                                           </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 209 -      end = true;                                                                                                 </span>
<span class="1848064821034278655" onmouseenter="enter('1848064821034278655');" onmouseout="out('1848064821034278655');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 210 -    } else if (code == HttpURLConnection.HTTP_NOT_FOUND) {                                                        </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 211 -      failDownload(new AriaIOException(TAG,                                                                       </span>
<span class="-2250251533714311872" onmouseenter="enter('-2250251533714311872');" onmouseout="out('-2250251533714311872');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 212 -          String.format(&quot;任务下载失败，errorCode：404, url: %s&quot;, mEntity.getUrl())), true);                               </span>
<span class="7269465454949275689" onmouseenter="enter('7269465454949275689');" onmouseout="out('7269465454949275689');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 213 -    } else if (code == HttpURLConnection.HTTP_MOVED_TEMP                                                          </span>
<span class="-6032747441450584852" onmouseenter="enter('-6032747441450584852');" onmouseout="out('-6032747441450584852');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 214 -        || code == HttpURLConnection.HTTP_MOVED_PERM                                                              </span>
<span class="6529484345882801441" onmouseenter="enter('6529484345882801441');" onmouseout="out('6529484345882801441');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 215 -        || code == HttpURLConnection.HTTP_SEE_OTHER                                                               </span>
<span class="-5614885484106173463" onmouseenter="enter('-5614885484106173463');" onmouseout="out('-5614885484106173463');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 216 -        || code == HttpURLConnection.HTTP_CREATED // 201 跳转                                                       </span>
<span class="-1964089336962903701" onmouseenter="enter('-1964089336962903701');" onmouseout="out('-1964089336962903701');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 217 -        || code == 307) {                                                                                         </span>
<span class="582471876420463974" onmouseenter="enter('582471876420463974');" onmouseout="out('582471876420463974');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 218 -      handleUrlReTurn(conn, conn.getHeaderField(&quot;Location&quot;));                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 219 -    } else {                                                                                                      </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 220 -      failDownload(new AriaIOException(TAG,                                                                       </span>
<span class="3458281120857355945" onmouseenter="enter('3458281120857355945');" onmouseout="out('3458281120857355945');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 221 -          String.format(&quot;任务下载失败，errorCode：%s, errorMsg: %s, url: %s&quot;, code,                                       </span>
<span class="-865670794746359823" onmouseenter="enter('-865670794746359823');" onmouseout="out('-865670794746359823');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 222 -              conn.getResponseMessage(), mEntity.getUrl())), !CheckUtil.httpIsBadRequest(code));                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 223 -    }                                                                                                             </span>
<span class="-6801527756571482213" onmouseenter="enter('-6801527756571482213');" onmouseout="out('-6801527756571482213');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 224 -    if (end) {                                                                                                    </span>
<span class="-9049555213483660293" onmouseenter="enter('-9049555213483660293');" onmouseout="out('-9049555213483660293');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 225 -      taskOption.setChunked(isChunked);                                                                           </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 226 -      if (onFileInfoCallback != null) {                                                                           </span>
<span class="-3029323004951684182" onmouseenter="enter('-3029323004951684182');" onmouseout="out('-3029323004951684182');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 227 -        CompleteInfo info = new CompleteInfo(code, mTaskWrapper);                                                 </span>
<span class="1239392088731349048" onmouseenter="enter('1239392088731349048');" onmouseout="out('1239392088731349048');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -        onFileInfoCallback.onComplete(mEntity.getUrl(), info);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 229 -      }                                                                                                           </span>
<span class="-2332174823472847291" onmouseenter="enter('-2332174823472847291');" onmouseout="out('-2332174823472847291');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 230 -      mEntity.update();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 231 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 232 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 233 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 234 -  /**                                                                                                             </span>
<span class="-2847240885661455178" onmouseenter="enter('-2847240885661455178');" onmouseout="out('-2847240885661455178');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 235 -   * 处理&quot;Content-Disposition&quot;参数                                                                                    </span>
<span class="8881865652474859794" onmouseenter="enter('8881865652474859794');" onmouseout="out('8881865652474859794');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 236 -   * &lt;a href=https://cloud.tencent.com/developer/section/1189916&gt;Content-Disposition&lt;/a&gt;&lt;/&gt;                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 237 -   *                                                                                                              </span>
<span class="-7776712758593145643" onmouseenter="enter('-7776712758593145643');" onmouseout="out('-7776712758593145643');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 238 -   * @throws UnsupportedEncodingException                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 239 -   */                                                                                                             </span>
<span class="-8608321373459550338" onmouseenter="enter('-8608321373459550338');" onmouseout="out('-8608321373459550338');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 240 -  private void handleContentDisposition(String disposition) throws UnsupportedEncodingException {                 </span>
<span class="8299914696584334305" onmouseenter="enter('8299914696584334305');" onmouseout="out('8299914696584334305');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 241 -    if (disposition.contains(&quot;;&quot;)) {                                                                              </span>
<span class="-8249279439551045927" onmouseenter="enter('-8249279439551045927');" onmouseout="out('-8249279439551045927');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 242 -      String[] infos = disposition.split(&quot;;&quot;);                                                                    </span>
<span class="2055683922126838823" onmouseenter="enter('2055683922126838823');" onmouseout="out('2055683922126838823');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 243 -      if (infos[0].equals(&quot;attachment&quot;)) {                                                                        </span>
<span class="-6108489956922562466" onmouseenter="enter('-6108489956922562466');" onmouseout="out('-6108489956922562466');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 244 -        for (String info : infos) {                                                                               </span>
<span class="-3445363461731907777" onmouseenter="enter('-3445363461731907777');" onmouseout="out('-3445363461731907777');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 245 -          if (info.startsWith(&quot;filename&quot;) &amp;&amp; info.contains(&quot;=&quot;)) {                                                </span>
<span class="3695771658612668290" onmouseenter="enter('3695771658612668290');" onmouseout="out('3695771658612668290');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 246 -            String[] temp = info.split(&quot;=&quot;);                                                                      </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 247 -            if (temp.length &gt; 1) {                                                                                </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 248 -              String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                          </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 249 -              mEntity.setServerFileName(newName);                                                                 </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 250 -              renameFile(newName);                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 251 -              break;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 252 -            }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 253 -          }                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 254 -        }                                                                                                         </span>
<span class="6794164660951287492" onmouseenter="enter('6794164660951287492');" onmouseout="out('6794164660951287492');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 255 -      } else if (infos[0].equals(&quot;form-data&quot;) &amp;&amp; infos.length &gt; 2) {                                              </span>
<span class="-8905252974632201641" onmouseenter="enter('-8905252974632201641');" onmouseout="out('-8905252974632201641');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 256 -        String[] temp = infos[2].split(&quot;=&quot;);                                                                      </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 257 -        if (temp.length &gt; 1) {                                                                                    </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 258 -          String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                              </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 259 -          mEntity.setServerFileName(newName);                                                                     </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 260 -          renameFile(newName);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 261 -        }                                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 262 -      } else {                                                                                                    </span>
<span class="7479053829749492027" onmouseenter="enter('7479053829749492027');" onmouseout="out('7479053829749492027');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 263 -        ALog.w(TAG, &quot;不识别的Content-Disposition参数&quot;);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 264 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 265 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 266 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 267 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 268 -  /**                                                                                                             </span>
<span class="-5538524699876672002" onmouseenter="enter('-5538524699876672002');" onmouseout="out('-5538524699876672002');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 269 -   * 重命名文件                                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 270 -   */                                                                                                             </span>
<span class="-7899950182898562290" onmouseenter="enter('-7899950182898562290');" onmouseout="out('-7899950182898562290');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 271 -  private void renameFile(String newName) {                                                                       </span>
<span class="4040095654750429587" onmouseenter="enter('4040095654750429587');" onmouseout="out('4040095654750429587');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 272 -    if (TextUtils.isEmpty(newName)) {                                                                             </span>
<span class="7746921739080291575" onmouseenter="enter('7746921739080291575');" onmouseout="out('7746921739080291575');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 273 -      ALog.w(TAG, &quot;重命名失败【服务器返回的文件名为空】&quot;);                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 274 -      return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 275 -    }                                                                                                             </span>
<span class="-897821573073116237" onmouseenter="enter('-897821573073116237');" onmouseout="out('-897821573073116237');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 276 -    ALog.d(TAG, String.format(&quot;文件重命名为：%s&quot;, newName));                                                             </span>
<span class="3112348380249890188" onmouseenter="enter('3112348380249890188');" onmouseout="out('3112348380249890188');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 277 -    File oldFile = new File(mEntity.getFilePath());                                                               </span>
<span class="6384479286325830175" onmouseenter="enter('6384479286325830175');" onmouseout="out('6384479286325830175');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 278 -    String newPath = oldFile.getParent() + &quot;/&quot; + newName;                                                         </span>
<span class="-8664365027300439044" onmouseenter="enter('-8664365027300439044');" onmouseout="out('-8664365027300439044');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 279 -    if (oldFile.exists()) {                                                                                       </span>
<span class="-2839507751750912779" onmouseenter="enter('-2839507751750912779');" onmouseout="out('-2839507751750912779');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 280 -      boolean b = oldFile.renameTo(new File(newPath));                                                            </span>
<span class="1440136229140496041" onmouseenter="enter('1440136229140496041');" onmouseout="out('1440136229140496041');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 281 -      ALog.d(TAG, String.format(&quot;文件重命名%s&quot;, b ? &quot;成功&quot; : &quot;失败&quot;));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 282 -    }                                                                                                             </span>
<span class="-3962615333140495301" onmouseenter="enter('-3962615333140495301');" onmouseout="out('-3962615333140495301');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 283 -    mEntity.setFileName(newName);                                                                                 </span>
<span class="5260470821929213762" onmouseenter="enter('5260470821929213762');" onmouseout="out('5260470821929213762');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 284 -    mEntity.setFilePath(newPath);                                                                                 </span>
<span class="552132236643695604" onmouseenter="enter('552132236643695604');" onmouseout="out('552132236643695604');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 285 -    RecordUtil.modifyTaskRecord(oldFile.getPath(), newPath, mEntity.getTaskType());                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 286 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 287 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 288 -  /**                                                                                                             </span>
<span class="-761470207976407479" onmouseenter="enter('-761470207976407479');" onmouseout="out('-761470207976407479');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 289 -   * 处理30x跳转                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 290 -   */                                                                                                             </span>
<span class="5556617621352975519" onmouseenter="enter('5556617621352975519');" onmouseout="out('5556617621352975519');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 291 -  private void handleUrlReTurn(HttpURLConnection conn, String newUrl) throws IOException {                        </span>
<span class="9112975487181986733" onmouseenter="enter('9112975487181986733');" onmouseout="out('9112975487181986733');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 292 -    ALog.d(TAG, &quot;30x跳转，新url为【&quot; + newUrl + &quot;】&quot;);                                                                   </span>
<span class="-3187267727779732659" onmouseenter="enter('-3187267727779732659');" onmouseout="out('-3187267727779732659');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 293 -    if (TextUtils.isEmpty(newUrl) || newUrl.equalsIgnoreCase(&quot;null&quot;)) {                                           </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 294 -      if (onFileInfoCallback != null) {                                                                           </span>
<span class="7265698984710319788" onmouseenter="enter('7265698984710319788');" onmouseout="out('7265698984710319788');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 295 -        onFileInfoCallback.onFail(mEntity, new TaskException(TAG, &quot;获取重定向链接失败&quot;), false);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 296 -      }                                                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 297 -      return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 298 -    }                                                                                                             </span>
<span class="-4691236730005429135" onmouseenter="enter('-4691236730005429135');" onmouseout="out('-4691236730005429135');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 299 -    if (newUrl.startsWith(&quot;/&quot;)) {                                                                                 </span>
<span class="-7947437880890249902" onmouseenter="enter('-7947437880890249902');" onmouseout="out('-7947437880890249902');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 300 -      Uri uri = Uri.parse(mEntity.getUrl());                                                                      </span>
<span class="-159008217290066182" onmouseenter="enter('-159008217290066182');" onmouseout="out('-159008217290066182');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 301 -      newUrl = uri.getHost() + newUrl;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 302 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 303 -                                                                                                                  </span>
<span class="-4197272966192810800" onmouseenter="enter('-4197272966192810800');" onmouseout="out('-4197272966192810800');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 304 -    if (!CheckUtil.checkUrl(newUrl)) {                                                                            </span>
<span class="8671661921003868184" onmouseenter="enter('8671661921003868184');" onmouseout="out('8671661921003868184');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 305 -      failDownload(new TaskException(TAG, &quot;下载失败，重定向url错误&quot;), false);                                               </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 306 -      return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 307 -    }                                                                                                             </span>
<span class="2121195664546392305" onmouseenter="enter('2121195664546392305');" onmouseout="out('2121195664546392305');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -    taskOption.setRedirectUrl(newUrl);                                                                            </span>
<span class="-7202069996221856390" onmouseenter="enter('-7202069996221856390');" onmouseout="out('-7202069996221856390');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -    mEntity.setRedirect(true);                                                                                    </span>
<span class="3562634937094117088" onmouseenter="enter('3562634937094117088');" onmouseout="out('3562634937094117088');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 310 -    mEntity.setRedirectUrl(newUrl);                                                                               </span>
<span class="-6439352303300997905" onmouseenter="enter('-6439352303300997905');" onmouseout="out('-6439352303300997905');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 311 -    String cookies = conn.getHeaderField(&quot;Set-Cookie&quot;);                                                           </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 312 -    conn.disconnect();                                                                                            </span>
<span class="7827815028692387267" onmouseenter="enter('7827815028692387267');" onmouseout="out('7827815028692387267');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 313 -    URL url = ConnectionHelp.handleUrl(newUrl, taskOption);                                                       </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 314 -    conn = ConnectionHelp.handleConnection(url, taskOption);                                                      </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 315 -    ConnectionHelp.setConnectParam(taskOption, conn);                                                             </span>
<span class="-9082472095175979719" onmouseenter="enter('-9082472095175979719');" onmouseout="out('-9082472095175979719');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 316 -    conn.setRequestProperty(&quot;Cookie&quot;, cookies);                                                                   </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 317 -    conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                                         </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 318 -    conn.setConnectTimeout(mConnectTimeOut);                                                                      </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 319 -    conn.connect();                                                                                               </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 320 -    handleConnect(conn);                                                                                          </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 321 -    conn.disconnect();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 322 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 323 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 324 -  /**                                                                                                             </span>
<span class="8188732119885086451" onmouseenter="enter('8188732119885086451');" onmouseout="out('8188732119885086451');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 325 -   * 检查长度是否合法，并且检查新获取的文件长度是否和数据库的文件长度一直，如果不一致，则表示该任务为新任务                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 326 -   *                                                                                                              </span>
<span class="7508607167277684618" onmouseenter="enter('7508607167277684618');" onmouseout="out('7508607167277684618');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 327 -   * @param len 从服务器获取的文件长度                                                                                       </span>
<span class="2269811577157119944" onmouseenter="enter('2269811577157119944');" onmouseout="out('2269811577157119944');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 328 -   * @return {@code true}合法                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 329 -   */                                                                                                             </span>
<span class="226943708538926451" onmouseenter="enter('226943708538926451');" onmouseout="out('226943708538926451');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 330 -  private boolean checkLen(long len) {                                                                            </span>
<span class="-6834276917361274338" onmouseenter="enter('-6834276917361274338');" onmouseout="out('-6834276917361274338');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 331 -    if (len != mEntity.getFileSize()) {                                                                           </span>
<span class="7031409428945889302" onmouseenter="enter('7031409428945889302');" onmouseout="out('7031409428945889302');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 332 -      ALog.d(TAG, &quot;长度不一致，任务为新任务&quot;);                                                                                </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 333 -      mTaskWrapper.setNewTask(true);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 334 -    }                                                                                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 335 -    return true;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 336 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 337 -                                                                                                                  </span>
<span class="-4015346071016137178" onmouseenter="enter('-4015346071016137178');" onmouseout="out('-4015346071016137178');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 338 -  private void failDownload(BaseException e, boolean needRetry) {                                                 </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 339 -    if (onFileInfoCallback != null) {                                                                             </span>
<span class="-3744805558345201426" onmouseenter="enter('-3744805558345201426');" onmouseout="out('-3744805558345201426');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 340 -      onFileInfoCallback.onFail(mEntity, e, needRetry);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 341 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 342 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 343 -                                                                                                                  </span>
<span class="-306327811626166304" onmouseenter="enter('-306327811626166304');" onmouseout="out('-306327811626166304');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 344 -  private static class FileLenAdapter implements IHttpFileLenAdapter {                                            </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 345 -                                                                                                                  </span>
<span class="-4968473764170008746" onmouseenter="enter('-4968473764170008746');" onmouseout="out('-4968473764170008746');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 346 -    @Override public long handleFileLen(Map&lt;String, List&lt;String&gt;&gt; headers) {                                      </span>
<span class="-3703403373407617525" onmouseenter="enter('-3703403373407617525');" onmouseout="out('-3703403373407617525');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 347 -      if (headers == null || headers.isEmpty()) {                                                                 </span>
<span class="7978066123796535188" onmouseenter="enter('7978066123796535188');" onmouseout="out('7978066123796535188');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 348 -        ALog.e(TAG, &quot;header为空，获取文件长度失败&quot;);                                                                         </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 349 -        return -1;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 350 -      }                                                                                                           </span>
<span class="-3327040667133742279" onmouseenter="enter('-3327040667133742279');" onmouseout="out('-3327040667133742279');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 351 -      List&lt;String&gt; sLength = headers.get(&quot;Content-Length&quot;);                                                       </span>
<span class="-5638961086111332224" onmouseenter="enter('-5638961086111332224');" onmouseout="out('-5638961086111332224');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 352 -      if (sLength == null || sLength.isEmpty()) {                                                                 </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 353 -        return -1;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 354 -      }                                                                                                           </span>
<span class="1006906766372690526" onmouseenter="enter('1006906766372690526');" onmouseout="out('1006906766372690526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 355 -      String temp = sLength.get(0);                                                                               </span>
<span class="-859592945496577082" onmouseenter="enter('-859592945496577082');" onmouseout="out('-859592945496577082');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 356 -      long len = TextUtils.isEmpty(temp) ? -1 : Long.parseLong(temp);                                             </span>
<span class="-3482859616975282364" onmouseenter="enter('-3482859616975282364');" onmouseout="out('-3482859616975282364');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 357 -      // 某些服务，如果设置了conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                          </span>
<span class="-2343886357485900465" onmouseenter="enter('-2343886357485900465');" onmouseout="out('-2343886357485900465');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 358 -      // 会返回 Content-Range: bytes 0-225427911/225427913                                                           </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 359 -      if (len &lt; 0) {                                                                                              </span>
<span class="-5449604609323133496" onmouseenter="enter('-5449604609323133496');" onmouseout="out('-5449604609323133496');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 360 -        List&lt;String&gt; sRange = headers.get(&quot;Content-Range&quot;);                                                       </span>
<span class="-939726222710114379" onmouseenter="enter('-939726222710114379');" onmouseout="out('-939726222710114379');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 361 -        if (sRange == null || sRange.isEmpty()) {                                                                 </span>
<span class="-428304200248281464" onmouseenter="enter('-428304200248281464');" onmouseout="out('-428304200248281464');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 362 -          len = -1;                                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 363 -        } else {                                                                                                  </span>
<span class="-552616904450344700" onmouseenter="enter('-552616904450344700');" onmouseout="out('-552616904450344700');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 364 -          int start = temp.indexOf(&quot;/&quot;);                                                                          </span>
<span class="6692102738649716212" onmouseenter="enter('6692102738649716212');" onmouseout="out('6692102738649716212');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 365 -          len = Long.parseLong(temp.substring(start + 1));                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 366 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 367 -      }                                                                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 368 -                                                                                                                  </span>
<span class="7701238698032811091" onmouseenter="enter('7701238698032811091');" onmouseout="out('7701238698032811091');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 369 -      return len;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 370 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 371 -  }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 372 -}                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="-7236899369024788297" onmouseenter="enter('-7236899369024788297');" onmouseout="out('-7236899369024788297');" style="">  16  package com.arialyy.aria.http;                                                                                    </span>
<span  style="">  17                                                                                                                    </span>
<span class="-6390350725830347024" onmouseenter="enter('-6390350725830347024');" onmouseout="out('-6390350725830347024');" style="">  18  import android.net.TrafficStats;                                                                                  </span>
<span class="-8750621697125156872" onmouseenter="enter('-8750621697125156872');" onmouseout="out('-8750621697125156872');" style="">  19  import android.net.Uri;                                                                                           </span>
<span class="3485143652294101472" onmouseenter="enter('3485143652294101472');" onmouseout="out('3485143652294101472');" style="">  20  import android.os.Process;                                                                                        </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  21  import android.text.TextUtils;                                                                                    </span>
<span class="8153369258057528270" onmouseenter="enter('8153369258057528270');" onmouseout="out('8153369258057528270');" style="">  22  import com.arialyy.aria.core.AriaConfig;                                                                          </span>
<span class="5028823532254250595" onmouseenter="enter('5028823532254250595');" onmouseout="out('5028823532254250595');" style="">  23  import com.arialyy.aria.core.common.CompleteInfo;                                                                 </span>
<span class="7716102167634407665" onmouseenter="enter('7716102167634407665');" onmouseout="out('7716102167634407665');" style="">  24  import com.arialyy.aria.core.common.RequestEnum;                                                                  </span>
<span class="-3497740022528182602" onmouseenter="enter('-3497740022528182602');" onmouseout="out('-3497740022528182602');" style="">  25  import com.arialyy.aria.core.download.DTaskWrapper;                                                               </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="">  26  import com.arialyy.aria.core.download.DownloadEntity;                                                             </span>
<span class="-5825121975347398532" onmouseenter="enter('-5825121975347398532');" onmouseout="out('-5825121975347398532');" style="">  27  import com.arialyy.aria.core.inf.OnFileInfoCallback;                                                              </span>
<span class="-5191825800443458517" onmouseenter="enter('-5191825800443458517');" onmouseout="out('-5191825800443458517');" style="">  28  import com.arialyy.aria.core.processor.IHttpFileLenAdapter;                                                       </span>
<span class="6359380642632041098" onmouseenter="enter('6359380642632041098');" onmouseout="out('6359380642632041098');" style="">  29  import com.arialyy.aria.exception.AriaIOException;                                                                </span>
<span class="-2677921716710306058" onmouseenter="enter('-2677921716710306058');" onmouseout="out('-2677921716710306058');" style="">  30  import com.arialyy.aria.exception.BaseException;                                                                  </span>
<span class="-5001091348570971924" onmouseenter="enter('-5001091348570971924');" onmouseout="out('-5001091348570971924');" style="">  31  import com.arialyy.aria.exception.TaskException;                                                                  </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  32  import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="">  33  import com.arialyy.aria.util.CheckUtil;                                                                           </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  34  import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-563266023018163236" onmouseenter="enter('-563266023018163236');" onmouseout="out('-563266023018163236');" style="">  35  import com.arialyy.aria.util.FileUtil;                                                                            </span>
<span class="-969957896094278671" onmouseenter="enter('-969957896094278671');" onmouseout="out('-969957896094278671');" style="">  36  import com.arialyy.aria.util.RecordUtil;                                                                          </span>
<span class="-4738630423427876475" onmouseenter="enter('-4738630423427876475');" onmouseout="out('-4738630423427876475');" style="">  37  import java.io.BufferedReader;                                                                                    </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  38  import java.io.File;                                                                                              </span>
<span class="103340661636203254" onmouseenter="enter('103340661636203254');" onmouseout="out('103340661636203254');" style="">  39  import java.io.IOException;                                                                                       </span>
<span class="-5152338856474932575" onmouseenter="enter('-5152338856474932575');" onmouseout="out('-5152338856474932575');" style="">  40  import java.io.InputStreamReader;                                                                                 </span>
<span class="3835172898968420800" onmouseenter="enter('3835172898968420800');" onmouseout="out('3835172898968420800');" style="">  41  import java.io.OutputStreamWriter;                                                                                </span>
<span class="8256805395213692609" onmouseenter="enter('8256805395213692609');" onmouseout="out('8256805395213692609');" style="">  42  import java.io.UnsupportedEncodingException;                                                                      </span>
<span class="7759739624588802903" onmouseenter="enter('7759739624588802903');" onmouseout="out('7759739624588802903');" style="">  43  import java.net.CookieManager;                                                                                    </span>
<span class="-5584619311424941805" onmouseenter="enter('-5584619311424941805');" onmouseout="out('-5584619311424941805');" style="">  44  import java.net.HttpCookie;                                                                                       </span>
<span class="6306455673576093831" onmouseenter="enter('6306455673576093831');" onmouseout="out('6306455673576093831');" style="">  45  import java.net.HttpURLConnection;                                                                                </span>
<span class="-5598187278321027129" onmouseenter="enter('-5598187278321027129');" onmouseout="out('-5598187278321027129');" style="">  46  import java.net.URL;                                                                                              </span>
<span class="600097467176667378" onmouseenter="enter('600097467176667378');" onmouseout="out('600097467176667378');" style="">  47  import java.net.URLDecoder;                                                                                       </span>
<span class="302463665162759210" onmouseenter="enter('302463665162759210');" onmouseout="out('302463665162759210');" style="">  48  import java.net.URLEncoder;                                                                                       </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  49  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  50  import java.util.Map;                                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="">  51  import java.util.Set;                                                                                             </span>
<span class="2390503830490498598" onmouseenter="enter('2390503830490498598');" onmouseout="out('2390503830490498598');" style="">  52  import java.util.UUID;                                                                                            </span>
<span  style="">  53                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  54  /**                                                                                                               </span>
<span class="-1733864505168931106" onmouseenter="enter('-1733864505168931106');" onmouseout="out('-1733864505168931106');" style="">  55   * 下载文件信息获取                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  56   */                                                                                                               </span>
<span class="-8507874378969942466" onmouseenter="enter('-8507874378969942466');" onmouseout="out('-8507874378969942466');" style="">  57  public class HttpFileInfoThread implements Runnable {                                                             </span>
<span class="-960543327724144855" onmouseenter="enter('-960543327724144855');" onmouseout="out('-960543327724144855');" style="">  58    private static final String TAG = &quot;HttpFileInfoThread&quot;;                                                         </span>
<span class="-7151375780097547664" onmouseenter="enter('-7151375780097547664');" onmouseout="out('-7151375780097547664');" style="">  59    private DownloadEntity mEntity;                                                                                 </span>
<span class="-3857309927385466618" onmouseenter="enter('-3857309927385466618');" onmouseout="out('-3857309927385466618');" style="">  60    private DTaskWrapper mTaskWrapper;                                                                              </span>
<span class="8600882525060240313" onmouseenter="enter('8600882525060240313');" onmouseout="out('8600882525060240313');" style="">  61    private int mConnectTimeOut;                                                                                    </span>
<span class="-6824755283282820235" onmouseenter="enter('-6824755283282820235');" onmouseout="out('-6824755283282820235');" style="">  62    private OnFileInfoCallback onFileInfoCallback;                                                                  </span>
<span class="6827268874849985533" onmouseenter="enter('6827268874849985533');" onmouseout="out('6827268874849985533');" style="">  63    private HttpTaskOption taskOption;                                                                              </span>
<span  style="">  64                                                                                                                    </span>
<span class="-5652336240759927020" onmouseenter="enter('-5652336240759927020');" onmouseout="out('-5652336240759927020');" style="">  65    public HttpFileInfoThread(DTaskWrapper taskWrapper, OnFileInfoCallback callback) {                              </span>
<span class="-3805550036651318371" onmouseenter="enter('-3805550036651318371');" onmouseout="out('-3805550036651318371');" style="">  66      this.mTaskWrapper = taskWrapper;                                                                              </span>
<span class="-170355754520114419" onmouseenter="enter('-170355754520114419');" onmouseout="out('-170355754520114419');" style="">  67      mEntity = taskWrapper.getEntity();                                                                            </span>
<span class="2572452400414830057" onmouseenter="enter('2572452400414830057');" onmouseout="out('2572452400414830057');" style="">  68      mConnectTimeOut = AriaConfig.getInstance().getDConfig().getConnectTimeOut();                                  </span>
<span class="1217537359294132674" onmouseenter="enter('1217537359294132674');" onmouseout="out('1217537359294132674');" style="">  69      onFileInfoCallback = callback;                                                                                </span>
<span class="6933673676495207920" onmouseenter="enter('6933673676495207920');" onmouseout="out('6933673676495207920');" style="">  70      taskOption = (HttpTaskOption) taskWrapper.getTaskOption();                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  71    }                                                                                                               </span>
<span  style="">  72                                                                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style="">  73    @Override public void run() {                                                                                   </span>
<span class="5651368089415780099" onmouseenter="enter('5651368089415780099');" onmouseout="out('5651368089415780099');" style="">  74      Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);                                                </span>
<span class="-1851318291295515457" onmouseenter="enter('-1851318291295515457');" onmouseout="out('-1851318291295515457');" style="">  75      TrafficStats.setThreadStatsTag(UUID.randomUUID().toString().hashCode());                                      </span>
<span class="-7517769077594778350" onmouseenter="enter('-7517769077594778350');" onmouseout="out('-7517769077594778350');" style="">  76      HttpURLConnection conn = null;                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  77      try {                                                                                                         </span>
<span class="7954771811613007401" onmouseenter="enter('7954771811613007401');" onmouseout="out('7954771811613007401');" style="">  78        URL url = ConnectionHelp.handleUrl(mEntity.getUrl(), taskOption);                                           </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style="">  79        conn = ConnectionHelp.handleConnection(url, taskOption);                                                    </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style="">  80        ConnectionHelp.setConnectParam(taskOption, conn);                                                           </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style="">  81        conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                                       </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style="">  82        conn.setConnectTimeout(mConnectTimeOut);                                                                    </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style="">  83        conn.connect();                                                                                             </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style="">  84        handleConnect(conn);                                                                                        </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">  85      } catch (IOException e) {                                                                                     </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="">  86        e.printStackTrace();                                                                                        </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style="">  87        failDownload(new AriaIOException(TAG,                                                                       </span>
<span class="-4053293382299681633" onmouseenter="enter('-4053293382299681633');" onmouseout="out('-4053293382299681633');" style="">  88                String.format(&quot;下载失败，filePath: %s, url: %s&quot;, mEntity.getDownloadPath(), mEntity.getUrl())),          </span>
<span class="-159362617709534437" onmouseenter="enter('-159362617709534437');" onmouseout="out('-159362617709534437');" style="">  89            true);                                                                                                  </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style="">  90      } finally {                                                                                                   </span>
<span class="7836975569817200666" onmouseenter="enter('7836975569817200666');" onmouseout="out('7836975569817200666');" style="">  91        if (conn != null) {                                                                                         </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  92          try {                                                                                                     </span>
<span class="-8686251500819757648" onmouseenter="enter('-8686251500819757648');" onmouseout="out('-8686251500819757648');" style="">  93            conn.getInputStream().close();                                                                          </span>
<span class="7080241092423381085" onmouseenter="enter('7080241092423381085');" onmouseout="out('7080241092423381085');" style="">  94          } catch (IOException e) {                                                                                 </span>
<span class="4090663313211582937" onmouseenter="enter('4090663313211582937');" onmouseout="out('4090663313211582937');" style="">  95            e.printStackTrace();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96          }                                                                                                         </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style="">  97          conn.disconnect();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 100    }                                                                                                               </span>
<span  style=""> 101                                                                                                                    </span>
<span class="7469915187822843170" onmouseenter="enter('7469915187822843170');" onmouseout="out('7469915187822843170');" style=""> 102    private void handleConnect(HttpURLConnection conn) throws IOException {                                         </span>
<span class="-5135480308665977678" onmouseenter="enter('-5135480308665977678');" onmouseout="out('-5135480308665977678');" style=""> 103      if (taskOption.getRequestEnum() == RequestEnum.POST) {                                                        </span>
<span class="-5476217355085156421" onmouseenter="enter('-5476217355085156421');" onmouseout="out('-5476217355085156421');" style=""> 104        Map&lt;String, String&gt; params = taskOption.getParams();                                                        </span>
<span class="3157859291963549592" onmouseenter="enter('3157859291963549592');" onmouseout="out('3157859291963549592');" style=""> 105        if (params != null) {                                                                                       </span>
<span class="1177673060067921781" onmouseenter="enter('1177673060067921781');" onmouseout="out('1177673060067921781');" style=""> 106          OutputStreamWriter dos = new OutputStreamWriter(conn.getOutputStream());                                  </span>
<span class="-2461846026114443284" onmouseenter="enter('-2461846026114443284');" onmouseout="out('-2461846026114443284');" style=""> 107          Set&lt;String&gt; keys = params.keySet();                                                                       </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 108          StringBuilder sb = new StringBuilder();                                                                   </span>
<span class="-5841525186174834007" onmouseenter="enter('-5841525186174834007');" onmouseout="out('-5841525186174834007');" style=""> 109          for (String key : keys) {                                                                                 </span>
<span class="-378086891984466400" onmouseenter="enter('-378086891984466400');" onmouseout="out('-378086891984466400');" style=""> 110            sb.append(key).append(&quot;=&quot;).append(URLEncoder.encode(params.get(key))).append(&quot;&amp;&quot;);                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111          }                                                                                                         </span>
<span class="-1170631941621929173" onmouseenter="enter('-1170631941621929173');" onmouseout="out('-1170631941621929173');" style=""> 112          String url = sb.toString();                                                                               </span>
<span class="-2854610904289092260" onmouseenter="enter('-2854610904289092260');" onmouseout="out('-2854610904289092260');" style=""> 113          url = url.substring(0, url.length() - 1);                                                                 </span>
<span class="-412821746973687146" onmouseenter="enter('-412821746973687146');" onmouseout="out('-412821746973687146');" style=""> 114          dos.write(url);                                                                                           </span>
<span class="-6320099346663956498" onmouseenter="enter('-6320099346663956498');" onmouseout="out('-6320099346663956498');" style=""> 115          dos.flush();                                                                                              </span>
<span class="1568727060082909957" onmouseenter="enter('1568727060082909957');" onmouseout="out('1568727060082909957');" style=""> 116          dos.close();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118      }                                                                                                             </span>
<span  style=""> 119                                                                                                                    </span>
<span class="831227310872116523" onmouseenter="enter('831227310872116523');" onmouseout="out('831227310872116523');" style=""> 120      IHttpFileLenAdapter lenAdapter = taskOption.getFileLenAdapter();                                              </span>
<span class="5196440776228873073" onmouseenter="enter('5196440776228873073');" onmouseout="out('5196440776228873073');" style=""> 121      if (lenAdapter == null) {                                                                                     </span>
<span class="7197457532950740585" onmouseenter="enter('7197457532950740585');" onmouseout="out('7197457532950740585');" style=""> 122        lenAdapter = new FileLenAdapter();                                                                          </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 123      } else {                                                                                                      </span>
<span class="-2288407285072363665" onmouseenter="enter('-2288407285072363665');" onmouseout="out('-2288407285072363665');" style=""> 124        ALog.d(TAG, &quot;使用自定义adapter&quot;);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125      }                                                                                                             </span>
<span class="-3117441631991498996" onmouseenter="enter('-3117441631991498996');" onmouseout="out('-3117441631991498996');" style=""> 126      long len = lenAdapter.handleFileLen(conn.getHeaderFields());                                                  </span>
<span  style=""> 127                                                                                                                    </span>
<span class="-1607077255181731471" onmouseenter="enter('-1607077255181731471');" onmouseout="out('-1607077255181731471');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 128 -    if (!FileUtil.checkSDMemorySpace(mEntity.getFilePath(), len)) {                                               </span>
<span class="57392966174497577" onmouseenter="enter('57392966174497577');" onmouseout="out('57392966174497577');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +    if (!FileUtil.checkMemorySpace(mEntity.getFilePath(), len)) {                                                 </span>
<span class="-1675602595326094546" onmouseenter="enter('-1675602595326094546');" onmouseout="out('-1675602595326094546');" style=""> 130        failDownload(new TaskException(TAG,                                                                         </span>
<span class="380344701162823709" onmouseenter="enter('380344701162823709');" onmouseout="out('380344701162823709');" style=""> 131            String.format(&quot;下载失败，内存空间不足；filePath: %s, url: %s&quot;, mEntity.getDownloadPath(),                           </span>
<span class="3748007250659926415" onmouseenter="enter('3748007250659926415');" onmouseout="out('3748007250659926415');" style=""> 132                mEntity.getUrl())), false);                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 133        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134      }                                                                                                             </span>
<span  style=""> 135                                                                                                                    </span>
<span class="-5653376755036700146" onmouseenter="enter('-5653376755036700146');" onmouseout="out('-5653376755036700146');" style=""> 136      int code = conn.getResponseCode();                                                                            </span>
<span class="243612440262257064" onmouseenter="enter('243612440262257064');" onmouseout="out('243612440262257064');" style=""> 137      boolean end = false;                                                                                          </span>
<span class="3661527496298260626" onmouseenter="enter('3661527496298260626');" onmouseout="out('3661527496298260626');" style=""> 138      if (TextUtils.isEmpty(mEntity.getMd5Code())) {                                                                </span>
<span class="6175847651720741920" onmouseenter="enter('6175847651720741920');" onmouseout="out('6175847651720741920');" style=""> 139        String md5Code = conn.getHeaderField(&quot;Content-MD5&quot;);                                                        </span>
<span class="3841984198412482104" onmouseenter="enter('3841984198412482104');" onmouseout="out('3841984198412482104');" style=""> 140        mEntity.setMd5Code(md5Code);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141      }                                                                                                             </span>
<span  style=""> 142                                                                                                                    </span>
<span class="-9137345962727529427" onmouseenter="enter('-9137345962727529427');" onmouseout="out('-9137345962727529427');" style=""> 143      boolean isChunked = false;                                                                                    </span>
<span class="-8116968388415792268" onmouseenter="enter('-8116968388415792268');" onmouseout="out('-8116968388415792268');" style=""> 144      final String str = conn.getHeaderField(&quot;Transfer-Encoding&quot;);                                                  </span>
<span class="-6629832129461298046" onmouseenter="enter('-6629832129461298046');" onmouseout="out('-6629832129461298046');" style=""> 145      if (!TextUtils.isEmpty(str) &amp;&amp; str.equals(&quot;chunked&quot;)) {                                                       </span>
<span class="268583664719475207" onmouseenter="enter('268583664719475207');" onmouseout="out('268583664719475207');" style=""> 146        isChunked = true;                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147      }                                                                                                             </span>
<span class="8180254556269969385" onmouseenter="enter('8180254556269969385');" onmouseout="out('8180254556269969385');" style=""> 148      Map&lt;String, List&lt;String&gt;&gt; headers = conn.getHeaderFields();                                                   </span>
<span class="8122923533236748969" onmouseenter="enter('8122923533236748969');" onmouseout="out('8122923533236748969');" style=""> 149      String disposition = conn.getHeaderField(&quot;Content-Disposition&quot;);                                              </span>
<span  style=""> 150                                                                                                                    </span>
<span class="-3052400857632215863" onmouseenter="enter('-3052400857632215863');" onmouseout="out('-3052400857632215863');" style=""> 151      if (taskOption.isUseServerFileName()) {                                                                       </span>
<span class="9149723838126995721" onmouseenter="enter('9149723838126995721');" onmouseout="out('9149723838126995721');" style=""> 152        if (!TextUtils.isEmpty(disposition)) {                                                                      </span>
<span class="3142217124074067362" onmouseenter="enter('3142217124074067362');" onmouseout="out('3142217124074067362');" style=""> 153          mEntity.setDisposition(CommonUtil.encryptBASE64(disposition));                                            </span>
<span class="8894179749774343207" onmouseenter="enter('8894179749774343207');" onmouseout="out('8894179749774343207');" style=""> 154          handleContentDisposition(disposition);                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 155        } else {                                                                                                    </span>
<span class="6725831659311340657" onmouseenter="enter('6725831659311340657');" onmouseout="out('6725831659311340657');" style=""> 156          ALog.w(TAG, &quot;Content-Disposition对于端字段为空，使用服务器端文件名失败&quot;);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158      }                                                                                                             </span>
<span class="3131612029960887116" onmouseenter="enter('3131612029960887116');" onmouseout="out('3131612029960887116');" style=""> 159      CookieManager msCookieManager = new CookieManager();                                                          </span>
<span class="6317541366742429029" onmouseenter="enter('6317541366742429029');" onmouseout="out('6317541366742429029');" style=""> 160      List&lt;String&gt; cookiesHeader = headers.get(&quot;Set-Cookie&quot;);                                                       </span>
<span  style=""> 161                                                                                                                    </span>
<span class="-3711800334805746628" onmouseenter="enter('-3711800334805746628');" onmouseout="out('-3711800334805746628');" style=""> 162      if (cookiesHeader != null) {                                                                                  </span>
<span class="50137583020384401" onmouseenter="enter('50137583020384401');" onmouseout="out('50137583020384401');" style=""> 163        for (String cookie : cookiesHeader) {                                                                       </span>
<span class="-5052850978727150914" onmouseenter="enter('-5052850978727150914');" onmouseout="out('-5052850978727150914');" style=""> 164          msCookieManager.getCookieStore().add(null, HttpCookie.parse(cookie).get(0));                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165        }                                                                                                           </span>
<span class="-6061807114007929519" onmouseenter="enter('-6061807114007929519');" onmouseout="out('-6061807114007929519');" style=""> 166        taskOption.setCookieManager(msCookieManager);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167      }                                                                                                             </span>
<span  style=""> 168                                                                                                                    </span>
<span class="-5434227081099310624" onmouseenter="enter('-5434227081099310624');" onmouseout="out('-5434227081099310624');" style=""> 169      mTaskWrapper.setCode(code);                                                                                   </span>
<span class="5260656878663172399" onmouseenter="enter('5260656878663172399');" onmouseout="out('5260656878663172399');" style=""> 170      if (code == HttpURLConnection.HTTP_PARTIAL) {                                                                 </span>
<span class="3476352595280537016" onmouseenter="enter('3476352595280537016');" onmouseout="out('3476352595280537016');" style=""> 171        if (!checkLen(len) &amp;&amp; !isChunked) {                                                                         </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style=""> 172          if (len &lt; 0) {                                                                                            </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style=""> 173            failDownload(                                                                                           </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style=""> 174                new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),               </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style=""> 175                false);                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176          }                                                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 177          return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 178        }                                                                                                           </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style=""> 179        mEntity.setFileSize(len);                                                                                   </span>
<span class="4333195157428278321" onmouseenter="enter('4333195157428278321');" onmouseout="out('4333195157428278321');" style=""> 180        mTaskWrapper.setSupportBP(true);                                                                            </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style=""> 181        end = true;                                                                                                 </span>
<span class="2496770639447193327" onmouseenter="enter('2496770639447193327');" onmouseout="out('2496770639447193327');" style=""> 182      } else if (code == HttpURLConnection.HTTP_OK) {                                                               </span>
<span class="-998567010505343674" onmouseenter="enter('-998567010505343674');" onmouseout="out('-998567010505343674');" style=""> 183        String contentType = conn.getHeaderField(&quot;Content-Type&quot;);                                                   </span>
<span class="201076292918755336" onmouseenter="enter('201076292918755336');" onmouseout="out('201076292918755336');" style=""> 184        if (TextUtils.isEmpty(contentType)) {                                                                       </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 185          return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186        }                                                                                                           </span>
<span class="8927907009918172915" onmouseenter="enter('8927907009918172915');" onmouseout="out('8927907009918172915');" style=""> 187        if (contentType.equals(&quot;text/html&quot;)) {                                                                      </span>
<span class="8342413994542158594" onmouseenter="enter('8342413994542158594');" onmouseout="out('8342413994542158594');" style=""> 188          BufferedReader reader =                                                                                   </span>
<span class="-7427210485489972460" onmouseenter="enter('-7427210485489972460');" onmouseout="out('-7427210485489972460');" style=""> 189              new BufferedReader(new InputStreamReader(ConnectionHelp.convertInputStream(conn)));                   </span>
<span class="-8642289478502472483" onmouseenter="enter('-8642289478502472483');" onmouseout="out('-8642289478502472483');" style=""> 190          StringBuilder sb = new StringBuilder();                                                                   </span>
<span class="6431556981547329060" onmouseenter="enter('6431556981547329060');" onmouseout="out('6431556981547329060');" style=""> 191          String line;                                                                                              </span>
<span class="4058321022246549205" onmouseenter="enter('4058321022246549205');" onmouseout="out('4058321022246549205');" style=""> 192          while ((line = reader.readLine()) != null) {                                                              </span>
<span class="-6213624305830265937" onmouseenter="enter('-6213624305830265937');" onmouseout="out('-6213624305830265937');" style=""> 193            sb.append(line);                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194          }                                                                                                         </span>
<span class="8277398435538005537" onmouseenter="enter('8277398435538005537');" onmouseout="out('8277398435538005537');" style=""> 195          reader.close();                                                                                           </span>
<span class="8311106050401029529" onmouseenter="enter('8311106050401029529');" onmouseout="out('8311106050401029529');" style=""> 196          handleUrlReTurn(conn, CommonUtil.getWindowReplaceUrl(sb.toString()));                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 197          return;                                                                                                   </span>
<span class="-4432363278840297326" onmouseenter="enter('-4432363278840297326');" onmouseout="out('-4432363278840297326');" style=""> 198        } else if (!checkLen(len) &amp;&amp; !isChunked) {                                                                  </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style=""> 199          if (len &lt; 0) {                                                                                            </span>
<span class="-8475907920116536407" onmouseenter="enter('-8475907920116536407');" onmouseout="out('-8475907920116536407');" style=""> 200            failDownload(                                                                                           </span>
<span class="-3449365806255849112" onmouseenter="enter('-3449365806255849112');" onmouseout="out('-3449365806255849112');" style=""> 201                new AriaIOException(TAG, String.format(&quot;任务下载失败，文件长度小于0， url: %s&quot;, mEntity.getUrl())),               </span>
<span class="9106099237950392606" onmouseenter="enter('9106099237950392606');" onmouseout="out('9106099237950392606');" style=""> 202                false);                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203          }                                                                                                         </span>
<span class="1925321240779458317" onmouseenter="enter('1925321240779458317');" onmouseout="out('1925321240779458317');" style=""> 204          ALog.d(TAG, &quot;len &lt; 0&quot;);                                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 205          return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 206        }                                                                                                           </span>
<span class="5331140130840219484" onmouseenter="enter('5331140130840219484');" onmouseout="out('5331140130840219484');" style=""> 207        mEntity.setFileSize(len);                                                                                   </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style=""> 208        mTaskWrapper.setNewTask(true);                                                                              </span>
<span class="9157524552034725227" onmouseenter="enter('9157524552034725227');" onmouseout="out('9157524552034725227');" style=""> 209        mTaskWrapper.setSupportBP(false);                                                                           </span>
<span class="5062607581591217542" onmouseenter="enter('5062607581591217542');" onmouseout="out('5062607581591217542');" style=""> 210        end = true;                                                                                                 </span>
<span class="1848064821034278655" onmouseenter="enter('1848064821034278655');" onmouseout="out('1848064821034278655');" style=""> 211      } else if (code == HttpURLConnection.HTTP_NOT_FOUND) {                                                        </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style=""> 212        failDownload(new AriaIOException(TAG,                                                                       </span>
<span class="-2250251533714311872" onmouseenter="enter('-2250251533714311872');" onmouseout="out('-2250251533714311872');" style=""> 213            String.format(&quot;任务下载失败，errorCode：404, url: %s&quot;, mEntity.getUrl())), true);                               </span>
<span class="7269465454949275689" onmouseenter="enter('7269465454949275689');" onmouseout="out('7269465454949275689');" style=""> 214      } else if (code == HttpURLConnection.HTTP_MOVED_TEMP                                                          </span>
<span class="-6032747441450584852" onmouseenter="enter('-6032747441450584852');" onmouseout="out('-6032747441450584852');" style=""> 215          || code == HttpURLConnection.HTTP_MOVED_PERM                                                              </span>
<span class="6529484345882801441" onmouseenter="enter('6529484345882801441');" onmouseout="out('6529484345882801441');" style=""> 216          || code == HttpURLConnection.HTTP_SEE_OTHER                                                               </span>
<span class="-5614885484106173463" onmouseenter="enter('-5614885484106173463');" onmouseout="out('-5614885484106173463');" style=""> 217          || code == HttpURLConnection.HTTP_CREATED // 201 跳转                                                       </span>
<span class="-1964089336962903701" onmouseenter="enter('-1964089336962903701');" onmouseout="out('-1964089336962903701');" style=""> 218          || code == 307) {                                                                                         </span>
<span class="582471876420463974" onmouseenter="enter('582471876420463974');" onmouseout="out('582471876420463974');" style=""> 219        handleUrlReTurn(conn, conn.getHeaderField(&quot;Location&quot;));                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 220      } else {                                                                                                      </span>
<span class="3181422533940334449" onmouseenter="enter('3181422533940334449');" onmouseout="out('3181422533940334449');" style=""> 221        failDownload(new AriaIOException(TAG,                                                                       </span>
<span class="3458281120857355945" onmouseenter="enter('3458281120857355945');" onmouseout="out('3458281120857355945');" style=""> 222            String.format(&quot;任务下载失败，errorCode：%s, errorMsg: %s, url: %s&quot;, code,                                       </span>
<span class="-865670794746359823" onmouseenter="enter('-865670794746359823');" onmouseout="out('-865670794746359823');" style=""> 223                conn.getResponseMessage(), mEntity.getUrl())), !CheckUtil.httpIsBadRequest(code));                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224      }                                                                                                             </span>
<span class="-6801527756571482213" onmouseenter="enter('-6801527756571482213');" onmouseout="out('-6801527756571482213');" style=""> 225      if (end) {                                                                                                    </span>
<span class="-9049555213483660293" onmouseenter="enter('-9049555213483660293');" onmouseout="out('-9049555213483660293');" style=""> 226        taskOption.setChunked(isChunked);                                                                           </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style=""> 227        if (onFileInfoCallback != null) {                                                                           </span>
<span class="-3029323004951684182" onmouseenter="enter('-3029323004951684182');" onmouseout="out('-3029323004951684182');" style=""> 228          CompleteInfo info = new CompleteInfo(code, mTaskWrapper);                                                 </span>
<span class="1239392088731349048" onmouseenter="enter('1239392088731349048');" onmouseout="out('1239392088731349048');" style=""> 229          onFileInfoCallback.onComplete(mEntity.getUrl(), info);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230        }                                                                                                           </span>
<span class="-2332174823472847291" onmouseenter="enter('-2332174823472847291');" onmouseout="out('-2332174823472847291');" style=""> 231        mEntity.update();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 232      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 233    }                                                                                                               </span>
<span  style=""> 234                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 235    /**                                                                                                             </span>
<span class="-2847240885661455178" onmouseenter="enter('-2847240885661455178');" onmouseout="out('-2847240885661455178');" style=""> 236     * 处理&quot;Content-Disposition&quot;参数                                                                                    </span>
<span class="8881865652474859794" onmouseenter="enter('8881865652474859794');" onmouseout="out('8881865652474859794');" style=""> 237     * &lt;a href=https://cloud.tencent.com/developer/section/1189916&gt;Content-Disposition&lt;/a&gt;&lt;/&gt;                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 238     *                                                                                                              </span>
<span class="-7776712758593145643" onmouseenter="enter('-7776712758593145643');" onmouseout="out('-7776712758593145643');" style=""> 239     * @throws UnsupportedEncodingException                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 240     */                                                                                                             </span>
<span class="-8608321373459550338" onmouseenter="enter('-8608321373459550338');" onmouseout="out('-8608321373459550338');" style=""> 241    private void handleContentDisposition(String disposition) throws UnsupportedEncodingException {                 </span>
<span class="8299914696584334305" onmouseenter="enter('8299914696584334305');" onmouseout="out('8299914696584334305');" style=""> 242      if (disposition.contains(&quot;;&quot;)) {                                                                              </span>
<span class="-8249279439551045927" onmouseenter="enter('-8249279439551045927');" onmouseout="out('-8249279439551045927');" style=""> 243        String[] infos = disposition.split(&quot;;&quot;);                                                                    </span>
<span class="2055683922126838823" onmouseenter="enter('2055683922126838823');" onmouseout="out('2055683922126838823');" style=""> 244        if (infos[0].equals(&quot;attachment&quot;)) {                                                                        </span>
<span class="-6108489956922562466" onmouseenter="enter('-6108489956922562466');" onmouseout="out('-6108489956922562466');" style=""> 245          for (String info : infos) {                                                                               </span>
<span class="-3445363461731907777" onmouseenter="enter('-3445363461731907777');" onmouseout="out('-3445363461731907777');" style=""> 246            if (info.startsWith(&quot;filename&quot;) &amp;&amp; info.contains(&quot;=&quot;)) {                                                </span>
<span class="3695771658612668290" onmouseenter="enter('3695771658612668290');" onmouseout="out('3695771658612668290');" style=""> 247              String[] temp = info.split(&quot;=&quot;);                                                                      </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style=""> 248              if (temp.length &gt; 1) {                                                                                </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style=""> 249                String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                          </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style=""> 250                mEntity.setServerFileName(newName);                                                                 </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style=""> 251                renameFile(newName);                                                                                </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 252                break;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 254            }                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255          }                                                                                                         </span>
<span class="6794164660951287492" onmouseenter="enter('6794164660951287492');" onmouseout="out('6794164660951287492');" style=""> 256        } else if (infos[0].equals(&quot;form-data&quot;) &amp;&amp; infos.length &gt; 2) {                                              </span>
<span class="-8905252974632201641" onmouseenter="enter('-8905252974632201641');" onmouseout="out('-8905252974632201641');" style=""> 257          String[] temp = infos[2].split(&quot;=&quot;);                                                                      </span>
<span class="-3080810689306301469" onmouseenter="enter('-3080810689306301469');" onmouseout="out('-3080810689306301469');" style=""> 258          if (temp.length &gt; 1) {                                                                                    </span>
<span class="1357838445082171789" onmouseenter="enter('1357838445082171789');" onmouseout="out('1357838445082171789');" style=""> 259            String newName = URLDecoder.decode(temp[1], &quot;utf-8&quot;).replaceAll(&quot;\&quot;&quot;, &quot;&quot;);                              </span>
<span class="1500861597373872121" onmouseenter="enter('1500861597373872121');" onmouseout="out('1500861597373872121');" style=""> 260            mEntity.setServerFileName(newName);                                                                     </span>
<span class="-1295738853423344690" onmouseenter="enter('-1295738853423344690');" onmouseout="out('-1295738853423344690');" style=""> 261            renameFile(newName);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262          }                                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 263        } else {                                                                                                    </span>
<span class="7479053829749492027" onmouseenter="enter('7479053829749492027');" onmouseout="out('7479053829749492027');" style=""> 264          ALog.w(TAG, &quot;不识别的Content-Disposition参数&quot;);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 266      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 267    }                                                                                                               </span>
<span  style=""> 268                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 269    /**                                                                                                             </span>
<span class="-5538524699876672002" onmouseenter="enter('-5538524699876672002');" onmouseout="out('-5538524699876672002');" style=""> 270     * 重命名文件                                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 271     */                                                                                                             </span>
<span class="-7899950182898562290" onmouseenter="enter('-7899950182898562290');" onmouseout="out('-7899950182898562290');" style=""> 272    private void renameFile(String newName) {                                                                       </span>
<span class="4040095654750429587" onmouseenter="enter('4040095654750429587');" onmouseout="out('4040095654750429587');" style=""> 273      if (TextUtils.isEmpty(newName)) {                                                                             </span>
<span class="7746921739080291575" onmouseenter="enter('7746921739080291575');" onmouseout="out('7746921739080291575');" style=""> 274        ALog.w(TAG, &quot;重命名失败【服务器返回的文件名为空】&quot;);                                                                          </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 275        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276      }                                                                                                             </span>
<span class="-897821573073116237" onmouseenter="enter('-897821573073116237');" onmouseout="out('-897821573073116237');" style=""> 277      ALog.d(TAG, String.format(&quot;文件重命名为：%s&quot;, newName));                                                             </span>
<span class="3112348380249890188" onmouseenter="enter('3112348380249890188');" onmouseout="out('3112348380249890188');" style=""> 278      File oldFile = new File(mEntity.getFilePath());                                                               </span>
<span class="6384479286325830175" onmouseenter="enter('6384479286325830175');" onmouseout="out('6384479286325830175');" style=""> 279      String newPath = oldFile.getParent() + &quot;/&quot; + newName;                                                         </span>
<span class="-8664365027300439044" onmouseenter="enter('-8664365027300439044');" onmouseout="out('-8664365027300439044');" style=""> 280      if (oldFile.exists()) {                                                                                       </span>
<span class="-2839507751750912779" onmouseenter="enter('-2839507751750912779');" onmouseout="out('-2839507751750912779');" style=""> 281        boolean b = oldFile.renameTo(new File(newPath));                                                            </span>
<span class="1440136229140496041" onmouseenter="enter('1440136229140496041');" onmouseout="out('1440136229140496041');" style=""> 282        ALog.d(TAG, String.format(&quot;文件重命名%s&quot;, b ? &quot;成功&quot; : &quot;失败&quot;));                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283      }                                                                                                             </span>
<span class="-3962615333140495301" onmouseenter="enter('-3962615333140495301');" onmouseout="out('-3962615333140495301');" style=""> 284      mEntity.setFileName(newName);                                                                                 </span>
<span class="5260470821929213762" onmouseenter="enter('5260470821929213762');" onmouseout="out('5260470821929213762');" style=""> 285      mEntity.setFilePath(newPath);                                                                                 </span>
<span class="552132236643695604" onmouseenter="enter('552132236643695604');" onmouseout="out('552132236643695604');" style=""> 286      RecordUtil.modifyTaskRecord(oldFile.getPath(), newPath, mEntity.getTaskType());                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287    }                                                                                                               </span>
<span  style=""> 288                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 289    /**                                                                                                             </span>
<span class="-761470207976407479" onmouseenter="enter('-761470207976407479');" onmouseout="out('-761470207976407479');" style=""> 290     * 处理30x跳转                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 291     */                                                                                                             </span>
<span class="5556617621352975519" onmouseenter="enter('5556617621352975519');" onmouseout="out('5556617621352975519');" style=""> 292    private void handleUrlReTurn(HttpURLConnection conn, String newUrl) throws IOException {                        </span>
<span class="9112975487181986733" onmouseenter="enter('9112975487181986733');" onmouseout="out('9112975487181986733');" style=""> 293      ALog.d(TAG, &quot;30x跳转，新url为【&quot; + newUrl + &quot;】&quot;);                                                                   </span>
<span class="-3187267727779732659" onmouseenter="enter('-3187267727779732659');" onmouseout="out('-3187267727779732659');" style=""> 294      if (TextUtils.isEmpty(newUrl) || newUrl.equalsIgnoreCase(&quot;null&quot;)) {                                           </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style=""> 295        if (onFileInfoCallback != null) {                                                                           </span>
<span class="7265698984710319788" onmouseenter="enter('7265698984710319788');" onmouseout="out('7265698984710319788');" style=""> 296          onFileInfoCallback.onFail(mEntity, new TaskException(TAG, &quot;获取重定向链接失败&quot;), false);                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297        }                                                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 298        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299      }                                                                                                             </span>
<span class="-4691236730005429135" onmouseenter="enter('-4691236730005429135');" onmouseout="out('-4691236730005429135');" style=""> 300      if (newUrl.startsWith(&quot;/&quot;)) {                                                                                 </span>
<span class="-7947437880890249902" onmouseenter="enter('-7947437880890249902');" onmouseout="out('-7947437880890249902');" style=""> 301        Uri uri = Uri.parse(mEntity.getUrl());                                                                      </span>
<span class="-159008217290066182" onmouseenter="enter('-159008217290066182');" onmouseout="out('-159008217290066182');" style=""> 302        newUrl = uri.getHost() + newUrl;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 303      }                                                                                                             </span>
<span  style=""> 304                                                                                                                    </span>
<span class="-4197272966192810800" onmouseenter="enter('-4197272966192810800');" onmouseout="out('-4197272966192810800');" style=""> 305      if (!CheckUtil.checkUrl(newUrl)) {                                                                            </span>
<span class="8671661921003868184" onmouseenter="enter('8671661921003868184');" onmouseout="out('8671661921003868184');" style=""> 306        failDownload(new TaskException(TAG, &quot;下载失败，重定向url错误&quot;), false);                                               </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 307        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308      }                                                                                                             </span>
<span class="2121195664546392305" onmouseenter="enter('2121195664546392305');" onmouseout="out('2121195664546392305');" style=""> 309      taskOption.setRedirectUrl(newUrl);                                                                            </span>
<span class="-7202069996221856390" onmouseenter="enter('-7202069996221856390');" onmouseout="out('-7202069996221856390');" style=""> 310      mEntity.setRedirect(true);                                                                                    </span>
<span class="3562634937094117088" onmouseenter="enter('3562634937094117088');" onmouseout="out('3562634937094117088');" style=""> 311      mEntity.setRedirectUrl(newUrl);                                                                               </span>
<span class="-6439352303300997905" onmouseenter="enter('-6439352303300997905');" onmouseout="out('-6439352303300997905');" style=""> 312      String cookies = conn.getHeaderField(&quot;Set-Cookie&quot;);                                                           </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style=""> 313      conn.disconnect();                                                                                            </span>
<span class="7827815028692387267" onmouseenter="enter('7827815028692387267');" onmouseout="out('7827815028692387267');" style=""> 314      URL url = ConnectionHelp.handleUrl(newUrl, taskOption);                                                       </span>
<span class="-3265279555057502261" onmouseenter="enter('-3265279555057502261');" onmouseout="out('-3265279555057502261');" style=""> 315      conn = ConnectionHelp.handleConnection(url, taskOption);                                                      </span>
<span class="-2608041019150866913" onmouseenter="enter('-2608041019150866913');" onmouseout="out('-2608041019150866913');" style=""> 316      ConnectionHelp.setConnectParam(taskOption, conn);                                                             </span>
<span class="-9082472095175979719" onmouseenter="enter('-9082472095175979719');" onmouseout="out('-9082472095175979719');" style=""> 317      conn.setRequestProperty(&quot;Cookie&quot;, cookies);                                                                   </span>
<span class="7244372287797714253" onmouseenter="enter('7244372287797714253');" onmouseout="out('7244372287797714253');" style=""> 318      conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                                         </span>
<span class="2217645776032783544" onmouseenter="enter('2217645776032783544');" onmouseout="out('2217645776032783544');" style=""> 319      conn.setConnectTimeout(mConnectTimeOut);                                                                      </span>
<span class="-6151817699943892257" onmouseenter="enter('-6151817699943892257');" onmouseout="out('-6151817699943892257');" style=""> 320      conn.connect();                                                                                               </span>
<span class="925302150404581075" onmouseenter="enter('925302150404581075');" onmouseout="out('925302150404581075');" style=""> 321      handleConnect(conn);                                                                                          </span>
<span class="-5779149918180640008" onmouseenter="enter('-5779149918180640008');" onmouseout="out('-5779149918180640008');" style=""> 322      conn.disconnect();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323    }                                                                                                               </span>
<span  style=""> 324                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 325    /**                                                                                                             </span>
<span class="8188732119885086451" onmouseenter="enter('8188732119885086451');" onmouseout="out('8188732119885086451');" style=""> 326     * 检查长度是否合法，并且检查新获取的文件长度是否和数据库的文件长度一直，如果不一致，则表示该任务为新任务                                                          </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 327     *                                                                                                              </span>
<span class="7508607167277684618" onmouseenter="enter('7508607167277684618');" onmouseout="out('7508607167277684618');" style=""> 328     * @param len 从服务器获取的文件长度                                                                                       </span>
<span class="2269811577157119944" onmouseenter="enter('2269811577157119944');" onmouseout="out('2269811577157119944');" style=""> 329     * @return {@code true}合法                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 330     */                                                                                                             </span>
<span class="226943708538926451" onmouseenter="enter('226943708538926451');" onmouseout="out('226943708538926451');" style=""> 331    private boolean checkLen(long len) {                                                                            </span>
<span class="-6834276917361274338" onmouseenter="enter('-6834276917361274338');" onmouseout="out('-6834276917361274338');" style=""> 332      if (len != mEntity.getFileSize()) {                                                                           </span>
<span class="7031409428945889302" onmouseenter="enter('7031409428945889302');" onmouseout="out('7031409428945889302');" style=""> 333        ALog.d(TAG, &quot;长度不一致，任务为新任务&quot;);                                                                                </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style=""> 334        mTaskWrapper.setNewTask(true);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335      }                                                                                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 336      return true;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337    }                                                                                                               </span>
<span  style=""> 338                                                                                                                    </span>
<span class="-4015346071016137178" onmouseenter="enter('-4015346071016137178');" onmouseout="out('-4015346071016137178');" style=""> 339    private void failDownload(BaseException e, boolean needRetry) {                                                 </span>
<span class="-8037905862258945711" onmouseenter="enter('-8037905862258945711');" onmouseout="out('-8037905862258945711');" style=""> 340      if (onFileInfoCallback != null) {                                                                             </span>
<span class="-3744805558345201426" onmouseenter="enter('-3744805558345201426');" onmouseout="out('-3744805558345201426');" style=""> 341        onFileInfoCallback.onFail(mEntity, e, needRetry);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 343    }                                                                                                               </span>
<span  style=""> 344                                                                                                                    </span>
<span class="-306327811626166304" onmouseenter="enter('-306327811626166304');" onmouseout="out('-306327811626166304');" style=""> 345    private static class FileLenAdapter implements IHttpFileLenAdapter {                                            </span>
<span  style=""> 346                                                                                                                    </span>
<span class="-4968473764170008746" onmouseenter="enter('-4968473764170008746');" onmouseout="out('-4968473764170008746');" style=""> 347      @Override public long handleFileLen(Map&lt;String, List&lt;String&gt;&gt; headers) {                                      </span>
<span class="-3703403373407617525" onmouseenter="enter('-3703403373407617525');" onmouseout="out('-3703403373407617525');" style=""> 348        if (headers == null || headers.isEmpty()) {                                                                 </span>
<span class="7978066123796535188" onmouseenter="enter('7978066123796535188');" onmouseout="out('7978066123796535188');" style=""> 349          ALog.e(TAG, &quot;header为空，获取文件长度失败&quot;);                                                                         </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style=""> 350          return -1;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351        }                                                                                                           </span>
<span class="-3327040667133742279" onmouseenter="enter('-3327040667133742279');" onmouseout="out('-3327040667133742279');" style=""> 352        List&lt;String&gt; sLength = headers.get(&quot;Content-Length&quot;);                                                       </span>
<span class="-5638961086111332224" onmouseenter="enter('-5638961086111332224');" onmouseout="out('-5638961086111332224');" style=""> 353        if (sLength == null || sLength.isEmpty()) {                                                                 </span>
<span class="7311380543145824752" onmouseenter="enter('7311380543145824752');" onmouseout="out('7311380543145824752');" style=""> 354          return -1;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 355        }                                                                                                           </span>
<span class="1006906766372690526" onmouseenter="enter('1006906766372690526');" onmouseout="out('1006906766372690526');" style=""> 356        String temp = sLength.get(0);                                                                               </span>
<span class="-859592945496577082" onmouseenter="enter('-859592945496577082');" onmouseout="out('-859592945496577082');" style=""> 357        long len = TextUtils.isEmpty(temp) ? -1 : Long.parseLong(temp);                                             </span>
<span class="-3482859616975282364" onmouseenter="enter('-3482859616975282364');" onmouseout="out('-3482859616975282364');" style=""> 358        // 某些服务，如果设置了conn.setRequestProperty(&quot;Range&quot;, &quot;bytes=&quot; + 0 + &quot;-&quot;);                                          </span>
<span class="-2343886357485900465" onmouseenter="enter('-2343886357485900465');" onmouseout="out('-2343886357485900465');" style=""> 359        // 会返回 Content-Range: bytes 0-225427911/225427913                                                           </span>
<span class="8069144415665918022" onmouseenter="enter('8069144415665918022');" onmouseout="out('8069144415665918022');" style=""> 360        if (len &lt; 0) {                                                                                              </span>
<span class="-5449604609323133496" onmouseenter="enter('-5449604609323133496');" onmouseout="out('-5449604609323133496');" style=""> 361          List&lt;String&gt; sRange = headers.get(&quot;Content-Range&quot;);                                                       </span>
<span class="-939726222710114379" onmouseenter="enter('-939726222710114379');" onmouseout="out('-939726222710114379');" style=""> 362          if (sRange == null || sRange.isEmpty()) {                                                                 </span>
<span class="-428304200248281464" onmouseenter="enter('-428304200248281464');" onmouseout="out('-428304200248281464');" style=""> 363            len = -1;                                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 364          } else {                                                                                                  </span>
<span class="-552616904450344700" onmouseenter="enter('-552616904450344700');" onmouseout="out('-552616904450344700');" style=""> 365            int start = temp.indexOf(&quot;/&quot;);                                                                          </span>
<span class="6692102738649716212" onmouseenter="enter('6692102738649716212');" onmouseout="out('6692102738649716212');" style=""> 366            len = Long.parseLong(temp.substring(start + 1));                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 367          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 368        }                                                                                                           </span>
<span  style=""> 369                                                                                                                    </span>
<span class="7701238698032811091" onmouseenter="enter('7701238698032811091');" onmouseout="out('7701238698032811091');" style=""> 370        return len;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 371      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 372    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            