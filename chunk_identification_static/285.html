<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>285</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    285
                    <a href="284.html">prev</a>
                    <a href="286.html">next</a>
                    <a href="285_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_2dba13ed70429d82aeb4928f597d6e8fc622bed6_core/broadleaf-profile/src/main/java/org/broadleafcommerce/profile/core/domain/CustomerImpl.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;2dba13ed70429d82aeb4928f597d6e8fc622bed6:core/broadleaf-profile/src/main/java/org/broadleafcommerce/profile/core/domain/CustomerImpl.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;2dba13ed70429d82aeb4928f597d6e8fc622bed6^1:core/broadleaf-profile/src/main/java/org/broadleafcommerce/profile/core/domain/CustomerImpl.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;2dba13ed70429d82aeb4928f597d6e8fc622bed6^2:core/broadleaf-profile/src/main/java/org/broadleafcommerce/profile/core/domain/CustomerImpl.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;60e51975ae7406b8fe23dc528c233868e977b595:core/broadleaf-profile/src/main/java/org/broadleafcommerce/profile/core/domain/CustomerImpl.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * #%L
   3  * BroadleafCommerce Profile
   4  * %%
   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6  * %%
   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10  * the Broadleaf End User License Agreement (EULA), Version 1.1
  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12  * shall apply.
  13  * 
<abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr>
<abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr>
  16  * #L%
  17  */
  18 
  19 package org.broadleafcommerce.profile.core.domain;
  20 
  21 import org.apache.commons.lang3.BooleanUtils;
  22 import org.apache.commons.lang3.StringUtils;
  23 import org.broadleafcommerce.common.admin.domain.AdminMainEntity;
  24 import org.broadleafcommerce.common.audit.Auditable;
  25 import org.broadleafcommerce.common.audit.AuditableListener;
  26 import org.broadleafcommerce.common.audit.AuditExcludeFieldValue;
  27 import org.broadleafcommerce.common.copy.CreateResponse;
  28 import org.broadleafcommerce.common.copy.MultiTenantCopyContext;
  29 import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransform;
  30 import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransformMember;
  31 import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransformTypes;
  32 import org.broadleafcommerce.common.locale.domain.Locale;
  33 import org.broadleafcommerce.common.locale.domain.LocaleImpl;
  34 import org.broadleafcommerce.common.persistence.PreviewStatus;
  35 import org.broadleafcommerce.common.persistence.Previewable;
  36 import org.broadleafcommerce.common.presentation.AdminPresentation;
  37 import org.broadleafcommerce.common.presentation.AdminPresentationCollection;
  38 import org.broadleafcommerce.common.presentation.AdminPresentationMap;
  39 import org.broadleafcommerce.common.presentation.RequiredOverride;
  40 import org.broadleafcommerce.common.presentation.client.AddMethodType;
  41 import org.broadleafcommerce.common.presentation.client.VisibilityEnum;
  42 import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeEntry;
  43 import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeOverride;
  44 import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeOverrides;
  45 import org.broadleafcommerce.common.presentation.override.PropertyType;
  46 import org.hibernate.annotations.BatchSize;
  47 import org.hibernate.annotations.Cache;
  48 import org.hibernate.annotations.CacheConcurrencyStrategy;
  49 import org.hibernate.annotations.Cascade;
  50 import org.hibernate.annotations.Index;
  51 import org.hibernate.annotations.Where;
  52 
  53 import java.util.ArrayList;
  54 import java.util.HashMap;
  55 import java.util.List;
  56 import java.util.Map;
  57 
  58 import javax.persistence.CascadeType;
  59 import javax.persistence.Column;
  60 import javax.persistence.Embedded;
  61 import javax.persistence.Entity;
  62 import javax.persistence.EntityListeners;
  63 import javax.persistence.FetchType;
  64 import javax.persistence.Id;
  65 import javax.persistence.Inheritance;
  66 import javax.persistence.InheritanceType;
  67 import javax.persistence.JoinColumn;
  68 import javax.persistence.ManyToOne;
  69 import javax.persistence.MapKey;
  70 import javax.persistence.OneToMany;
  71 import javax.persistence.Table;
  72 import javax.persistence.Transient;
  73 
  74 @Entity
  75 @EntityListeners(value = { AuditableListener.class, CustomerPersistedEntityListener.class })
  76 @Inheritance(strategy = InheritanceType.JOINED)
  77 @Table(name = &quot;BLC_CUSTOMER&quot;)
  78 @Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE, region = &quot;blCustomerElements&quot;)
  79 @AdminPresentationMergeOverrides(
  80     {
  81         @AdminPresentationMergeOverride(name = &quot;auditable.dateCreated&quot;, mergeEntries =
<abbr title="  82             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)),">  82             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValðŸ”µ</abbr>
  83         @AdminPresentationMergeOverride(name = &quot;auditable.createdBy&quot;, mergeEntries =
<abbr title="  84             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)),">  84             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValðŸ”µ</abbr>
  85         @AdminPresentationMergeOverride(name = &quot;auditable.dateUpdated&quot;, mergeEntries =
<abbr title="  86             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)),">  86             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValðŸ”µ</abbr>
  87         @AdminPresentationMergeOverride(name = &quot;auditable.updatedBy&quot;, mergeEntries =
<abbr title="  88             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit))">  88             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValðŸ”µ</abbr>
  89     }
  90 )
  91 @DirectCopyTransform({
  92         @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.PREVIEW),
  93         @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.MULTITENANT_SITE),
  94         @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.ARCHIVE_ONLY)
  95 })
  96 public class CustomerImpl implements Customer, AdminMainEntity, Previewable, CustomerAdminPresentation {
  97 
  98     private static final long serialVersionUID = 1L;
  99 
 100     @Id
 101     @Column(name = &quot;CUSTOMER_ID&quot;)
 102     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Id&quot;, visibility = VisibilityEnum.HIDDEN_ALL)
 103     protected Long id;
 104 
 105     @Embedded
 106     protected Auditable auditable = new Auditable();
 107 
 108     @Embedded
 109     protected PreviewStatus previewable = new PreviewStatus();
 110 
 111     @Column(name = &quot;USER_NAME&quot;)
 112     @AdminPresentation(friendlyName = &quot;CustomerImpl_UserName&quot;,
 113             group = GroupName.Customer, order = FieldOrder.USERNAME,
 114             requiredOverride = RequiredOverride.REQUIRED)
 115     protected String username;
 116 
 117     @Column(name = &quot;PASSWORD&quot;)
 118     @AdminPresentation(excluded = true)
 119     @AuditExcludeFieldValue
 120     protected String password;
 121 
 122     @Column(name = &quot;EMAIL_ADDRESS&quot;)
 123     @Index(name = &quot;CUSTOMER_EMAIL_INDEX&quot;, columnNames = { &quot;EMAIL_ADDRESS&quot; })
 124     @AdminPresentation(friendlyName = &quot;CustomerImpl_Email_Address&quot;,
 125             group = GroupName.Customer, order = FieldOrder.EMAIL,
 126             prominent = true, gridOrder = 1000)
 127     protected String emailAddress;
 128 
 129     @Column(name = &quot;FIRST_NAME&quot;)
 130     @AdminPresentation(friendlyName = &quot;CustomerImpl_First_Name&quot;,
 131             group = GroupName.Customer, order = FieldOrder.FIRST_NAME,
 132             prominent = true, gridOrder = 2000)
 133     protected String firstName;
 134 
 135     @Column(name = &quot;LAST_NAME&quot;)
 136     @AdminPresentation(friendlyName = &quot;CustomerImpl_Last_Name&quot;,
 137             group = GroupName.Customer, order = FieldOrder.LAST_NAME,
 138             prominent = true, gridOrder = 3000)
 139     protected String lastName;
 140 
 141 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 142     @Column(name = &quot;EXTERNAL_ID&quot;)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 143     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_ExternalId&quot;,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 144             group = GroupName.Customer, order = FieldOrder.EXTERNAL_ID,</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 145             visibility = VisibilityEnum.GRID_HIDDEN)</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146     protected String externalId;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 147 </span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 148     @ManyToOne(targetEntity = ChallengeQuestionImpl.class)</span>
 149 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150     @ManyToOne(targetEntity = ChallengeQuestionImpl.class)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151     @JoinColumn(name = &quot;CHALLENGE_QUESTION_ID&quot;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152     @Index(name = &quot;CUSTOMER_CHALLENGE_INDEX&quot;, columnNames = { &quot;CHALLENGE_QUESTION_ID&quot; })</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153     @AdminPresentation(friendlyName = &quot;CustomerImpl_Challenge_Question&quot;,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154             excluded = true)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155     protected ChallengeQuestion challengeQuestion;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156 </span>
 157 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158     @ManyToOne(targetEntity = ChallengeQuestionImpl.class, fetch = FetchType.LAZY)</span>
 159 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
 160     @JoinColumn(name = &quot;CHALLENGE_QUESTION_ID&quot;)
 161     @Index(name = &quot;CUSTOMER_CHALLENGE_INDEX&quot;, columnNames = { &quot;CHALLENGE_QUESTION_ID&quot; })
 162     @AdminPresentation(friendlyName = &quot;CustomerImpl_Challenge_Question&quot;,
 163             excluded = true)
 164     protected ChallengeQuestion challengeQuestion;
 165 
 166     @Column(name = &quot;CHALLENGE_ANSWER&quot;)
 167     @AdminPresentation(friendlyName = &quot;CustomerImpl_Challenge_Answer&quot;,
 168             excluded = true)
 169     protected String challengeAnswer;
 170 
 171     /**
 172      * &lt;p&gt;
 173      *     If true, this customer must go through a reset password flow.
 174      * &lt;/p&gt;
 175      * &lt;p&gt;
 176      *     During a site conversion or security breach or a matter of routine security policy, 
 177      *     it may be necessary to require users to change their password. This property will 
 178      *     not allow a user whose credentials are managed within Broadleaf to login until 
 179      *     they have reset their password. 
 180      * &lt;/p&gt;
 181      * &lt;p&gt;
 182      *     Used by blUserDetailsService.
 183      * &lt;/p&gt;
 184      */
 185     @Column(name = &quot;PASSWORD_CHANGE_REQUIRED&quot;)
 186     @AdminPresentation(excluded = true)
 187     protected Boolean passwordChangeRequired = false;
 188 
 189     @Column(name = &quot;RECEIVE_EMAIL&quot;)
 190     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Receive_Email&quot;,
 191             group = GroupName.QualificationOptions, order = FieldOrder.RECIEVE_EMAIL)
 192     protected Boolean receiveEmail = false;
 193 
 194     @Column(name = &quot;IS_REGISTERED&quot;)
 195     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Registered&quot;,
 196             group = GroupName.QualificationOptions, order = FieldOrder.REGISTERED,
 197             prominent = true, gridOrder = 4000)
 198     protected Boolean registered = false;
 199 
 200     @Column(name = &quot;DEACTIVATED&quot;)
 201     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Deactivated&quot;,
 202             group = GroupName.QualificationOptions, order = FieldOrder.DEACTIVATED)
 203     protected Boolean deactivated = false;
 204 
 205     @ManyToOne(targetEntity = LocaleImpl.class)
 206     @JoinColumn(name = &quot;LOCALE_CODE&quot;)
 207     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Locale&quot;,
 208         excluded = true, visibility = VisibilityEnum.GRID_HIDDEN)
 209     protected Locale customerLocale;
 210 
<abbr title=" 211     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAttributeImpl.class, cascade = { CascadeType.ALL }, orphanRemoval = true)"> 211     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAttributeImpl.class, cascade = { CascadeTypeðŸ”µ</abbr>
 212     @Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE, region = &quot;blStandardElements&quot;)
 213     @MapKey(name = &quot;name&quot;)
 214     @BatchSize(size = 50)
 215     @AdminPresentationMap(friendlyName = &quot;CustomerAttributeImpl_Attribute_Name&quot;,
 216             tab = CustomerAdminPresentation.TabName.General,
 217             deleteEntityUponRemove = true, forceFreeFormKeys = true,
 218             keyPropertyFriendlyName = &quot;ProductAttributeImpl_Attribute_Name&quot;)
 219     protected Map&lt;String, CustomerAttribute&gt; customerAttributes = new HashMap&lt;&gt;();
 220 
<abbr title=" 221     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAddressImpl.class, cascade = { CascadeType.ALL })"> 221     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAddressImpl.class, cascade = { CascadeType.AðŸ”µ</abbr>
<abbr title=" 222     @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPHAN })"> 222     @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DðŸ”µ</abbr>
 223     @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 224     @Where(clause = &quot;archived != &#x27;Y&#x27;&quot;)
 225     @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Addresses&quot;,
 226             group = GroupName.ContactInfo, order = FieldOrder.ADDRESSES,
 227             addType = AddMethodType.PERSIST)
 228     protected List&lt;CustomerAddress&gt; customerAddresses = new ArrayList&lt;&gt;();
 229 
<abbr title=" 230     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPhoneImpl.class, cascade = { CascadeType.ALL })"> 230     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPhoneImpl.class, cascade = { CascadeType.ALLðŸ”µ</abbr>
<abbr title=" 231     @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPHAN })"> 231     @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DðŸ”µ</abbr>
 232     @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 233     @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Phones&quot;,
 234             group = GroupName.ContactInfo, order = FieldOrder.PHONES,
 235             addType = AddMethodType.PERSIST)
 236     protected List&lt;CustomerPhone&gt; customerPhones = new ArrayList&lt;&gt;();
 237 
<abbr title=" 238     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPaymentImpl.class, cascade = { CascadeType.ALL })"> 238     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPaymentImpl.class, cascade = { CascadeType.AðŸ”µ</abbr>
<abbr title=" 239     @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPHAN })"> 239     @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DðŸ”µ</abbr>
 240     @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 241     @BatchSize(size = 50)
 242     @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Payments&quot;,
 243             tab = TabName.PaymentMethods, order = 1000,
 244             addType = AddMethodType.PERSIST,
 245             readOnly = true)
 246     protected List&lt;CustomerPayment&gt; customerPayments = new ArrayList&lt;&gt;();
 247 
 248     @Column(name = &quot;IS_TAX_EXEMPT&quot;)
 249     @AdminPresentation(friendlyName = &quot;CustomerImpl_Is_Tax_Exempt&quot;,
 250             group = GroupName.Pricing, order = FieldOrder.IS_TAX_EXEMPT,
 251             defaultValue = &quot;false&quot;)
 252     protected Boolean isTaxExempt = false;
 253 
 254     @Column(name = &quot;TAX_EXEMPTION_CODE&quot;)
 255     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_TaxExemptCode&quot;,
 256             group = GroupName.Pricing, order = FieldOrder.TAX_EXEMPTION_CODE,
 257             visibility = VisibilityEnum.GRID_HIDDEN)
 258     protected String taxExemptionCode;
 259 
 260     @Transient
 261     protected String unencodedPassword;
 262 
 263     @Transient
 264     protected String unencodedChallengeAnswer;
 265 
 266     @Transient
 267     protected boolean anonymous;
 268 
 269     @Transient
 270     protected boolean cookied;
 271 
 272     @Transient
 273     protected boolean loggedIn;
 274 
 275     @Transient
 276     protected Map&lt;String, Object&gt; transientProperties = new HashMap&lt;String, Object&gt;();
 277 
 278     @Override
 279     public Long getId() {
 280         return id;
 281     }
 282 
 283     @Override
 284     public void setId(Long id) {
 285         this.id = id;
 286     }
 287 
 288     @Override
 289     public String getUsername() {
 290         return username;
 291     }
 292 
 293     @Override
 294     public void setUsername(String username) {
 295         this.username = username;
 296     }
 297 
 298     @Override
 299     public String getPassword() {
 300         return password;
 301     }
 302 
 303     @Override
 304     public void setPassword(String password) {
 305         this.password = password;
 306     }
 307 
 308     @Override
 309     public boolean isPasswordChangeRequired() {
 310         return BooleanUtils.toBoolean(passwordChangeRequired);
 311     }
 312 
 313     @Override
 314     public void setPasswordChangeRequired(boolean passwordChangeRequired) {
 315         this.passwordChangeRequired = Boolean.valueOf(passwordChangeRequired);
 316     }
 317 
 318     @Override
 319     public String getFirstName() {
 320         return firstName;
 321     }
 322 
 323     @Override
 324     public void setFirstName(String firstName) {
 325         this.firstName = firstName;
 326     }
 327 
 328     @Override
 329     public String getLastName() {
 330         return lastName;
 331     }
 332 
 333     @Override
 334     public void setLastName(String lastName) {
 335         this.lastName = lastName;
 336     }
 337 
 338     @Override
 339     public String getEmailAddress() {
 340         return emailAddress;
 341     }
 342 
 343     @Override
 344     public void setEmailAddress(String emailAddress) {
 345         this.emailAddress = emailAddress;
 346     }
 347 
 348     @Override
 349     public String getExternalId() {
 350         return externalId;
 351     }
 352 
 353     @Override
 354     public void setExternalId(String externalId) {
 355         this.externalId = externalId;
 356     }
 357 
 358     @Override
 359     public ChallengeQuestion getChallengeQuestion() {
 360         return challengeQuestion;
 361     }
 362 
 363     @Override
 364     public void setChallengeQuestion(ChallengeQuestion challengeQuestion) {
 365         this.challengeQuestion = challengeQuestion;
 366     }
 367 
 368     @Override
 369     public String getChallengeAnswer() {
 370         return challengeAnswer;
 371     }
 372 
 373     @Override
 374     public void setChallengeAnswer(String challengeAnswer) {
 375         this.challengeAnswer = challengeAnswer;
 376     }
 377 
 378     @Override
 379     public String getUnencodedPassword() {
 380         return unencodedPassword;
 381     }
 382 
 383     @Override
 384     public void setUnencodedPassword(String unencodedPassword) {
 385         this.unencodedPassword = unencodedPassword;
 386     }
 387 
 388     @Override
 389     public boolean isReceiveEmail() {
 390         return BooleanUtils.toBoolean(receiveEmail);
 391     }
 392 
 393     @Override
 394     public void setReceiveEmail(boolean receiveEmail) {
 395         this.receiveEmail = Boolean.valueOf(receiveEmail);
 396     }
 397 
 398     @Override
 399     public boolean isRegistered() {
 400         return BooleanUtils.toBoolean(registered);
 401     }
 402 
 403     @Override
 404     public void setRegistered(boolean registered) {
 405         this.registered = Boolean.valueOf(registered);
 406     }
 407 
 408     @Override
 409     public String getUnencodedChallengeAnswer() {
 410         return unencodedChallengeAnswer;
 411     }
 412 
 413     @Override
 414     public void setUnencodedChallengeAnswer(String unencodedChallengeAnswer) {
 415         this.unencodedChallengeAnswer = unencodedChallengeAnswer;
 416     }
 417 
 418     @Override
 419     public Auditable getAuditable() {
 420         return auditable;
 421     }
 422 
 423     @Override
 424     public void setAuditable(Auditable auditable) {
 425         this.auditable = auditable;
 426     }
 427 
 428     @Override
 429     public boolean isAnonymous() {
 430         return anonymous;
 431     }
 432 
 433     @Override
 434     public boolean isCookied() {
 435         return cookied;
 436     }
 437 
 438     @Override
 439     public boolean isLoggedIn() {
 440         return loggedIn;
 441     }
 442 
 443     @Override
 444     public void setAnonymous(boolean anonymous) {
 445         this.anonymous = anonymous;
 446         if (anonymous) {
 447             cookied = false;
 448             loggedIn = false;
 449         }
 450     }
 451 
 452     @Override
 453     public void setCookied(boolean cookied) {
 454         this.cookied = cookied;
 455         if (cookied) {
 456             anonymous = false;
 457             loggedIn = false;
 458         }
 459     }
 460 
 461     @Override
 462     public void setLoggedIn(boolean loggedIn) {
 463         this.loggedIn = loggedIn;
 464         if (loggedIn) {
 465             anonymous = false;
 466             cookied = false;
 467         }
 468     }
 469 
 470     @Override
 471     public Locale getCustomerLocale() {
 472         return customerLocale;
 473     }
 474 
 475     @Override
 476     public void setCustomerLocale(Locale customerLocale) {
 477         this.customerLocale = customerLocale;
 478     }
 479 
 480     @Override
 481     public Map&lt;String, CustomerAttribute&gt; getCustomerAttributes() {
 482         return customerAttributes;
 483     }
 484 
 485     @Override
 486     public void setCustomerAttributes(Map&lt;String, CustomerAttribute&gt; customerAttributes) {
 487         this.customerAttributes = customerAttributes;
 488     }
 489 
 490     @Override
 491     public boolean isDeactivated() {
 492         return BooleanUtils.toBoolean(deactivated);
 493     }
 494 
 495     @Override
 496     public void setDeactivated(boolean deactivated) {
 497         this.deactivated = Boolean.valueOf(deactivated);
 498     }
 499 
 500     @Override
 501     public List&lt;CustomerAddress&gt; getCustomerAddresses() {
 502         return customerAddresses;
 503     }
 504 
 505     @Override
 506     public void setCustomerAddresses(List&lt;CustomerAddress&gt; customerAddresses) {
 507         this.customerAddresses = customerAddresses;
 508     }
 509 
 510     @Override
 511     public List&lt;CustomerPhone&gt; getCustomerPhones() {
 512         return customerPhones;
 513     }
 514 
 515     @Override
 516     public void setCustomerPhones(List&lt;CustomerPhone&gt; customerPhones) {
 517         this.customerPhones = customerPhones;
 518     }
 519 
 520     @Override
 521     public List&lt;CustomerPayment&gt; getCustomerPayments() {
 522         return customerPayments;
 523     }
 524 
 525     @Override
 526     public void setCustomerPayments(List&lt;CustomerPayment&gt; customerPayments) {
 527         this.customerPayments = customerPayments;
 528     }
 529 
 530     @Override
 531     public String getMainEntityName() {
 532         if (!StringUtils.isEmpty(getFirstName()) &amp;&amp; !StringUtils.isEmpty(getLastName())) {
 533             return getFirstName() + &quot; &quot; + getLastName();
 534         }
 535         if (!StringUtils.isEmpty(getUsername())) {
 536             return getUsername();
 537         }
 538         return String.valueOf(getId());
 539     }
 540 
 541     @Override
 542     public Boolean getPreview() {
 543         if (previewable == null) {
 544             previewable = new PreviewStatus();
 545         }
 546         return previewable.getPreview();
 547     }
 548 
 549     @Override
 550     public void setPreview(Boolean preview) {
 551         if (previewable == null) {
 552             previewable = new PreviewStatus();
 553         }
 554         previewable.setPreview(preview);
 555     }
 556 
 557     @Override
 558     public Map&lt;String, Object&gt; getTransientProperties() {
 559         return transientProperties;
 560     }
 561 
 562     @Override
 563     public boolean equals(Object obj) {
 564         if (this == obj) {
 565             return true;
 566         }
 567         if (obj == null) {
 568             return false;
 569         }
 570         if (!getClass().isAssignableFrom(obj.getClass())) {
 571             return false;
 572         }
 573         CustomerImpl other = (CustomerImpl) obj;
 574 
 575         if (id != null &amp;&amp; other.id != null) {
 576             return id.equals(other.id);
 577         }
 578 
 579         if (username == null) {
 580             if (other.username != null) {
 581                 return false;
 582             }
 583         } else if (!username.equals(other.username)) {
 584             return false;
 585         }
 586         return true;
 587     }
 588 
 589     @Override
 590     public int hashCode() {
 591         final int prime = 31;
 592         int result = 1;
 593         result = prime * result + ((username == null) ? 0 : username.hashCode());
 594         return result;
 595     }
 596 
 597     @Override
<abbr title=" 598     public &lt;G extends Customer&gt; CreateResponse&lt;G&gt; createOrRetrieveCopyInstance(MultiTenantCopyContext context) throws CloneNotSupportedException {"> 598     public &lt;G extends Customer&gt; CreateResponse&lt;G&gt; createOrRetrieveCopyInstance(MultiTenantCopyContext conðŸ”µ</abbr>
 599         CreateResponse&lt;G&gt; createResponse = context.createOrRetrieveCopyInstance(this);
 600         if (createResponse.isAlreadyPopulated()) {
 601             return createResponse;
 602         }
 603         Customer cloned = createResponse.getClone();
 604         cloned.setAnonymous(anonymous);
 605         cloned.setChallengeAnswer(challengeAnswer);
 606         cloned.setChallengeQuestion(challengeQuestion);
 607         cloned.setCookied(cookied);
 608         for (CustomerAddress entry : customerAddresses) {
 609             CustomerAddress clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 610             clonedEntry.setCustomer(cloned);
 611             cloned.getCustomerAddresses().add(clonedEntry);
 612 
 613         }
 614         for (Map.Entry&lt;String, CustomerAttribute&gt; entry : customerAttributes.entrySet()) {
<abbr title=" 615             CustomerAttribute clonedEntry = entry.getValue().createOrRetrieveCopyInstance(context).getClone();"> 615             CustomerAttribute clonedEntry = entry.getValue().createOrRetrieveCopyInstance(context).getCloðŸ”µ</abbr>
 616             clonedEntry.setCustomer(cloned);
 617             cloned.getCustomerAttributes().put(entry.getKey(), clonedEntry);
 618         }
 619         cloned.setLoggedIn(loggedIn);
 620         cloned.setUsername(username);
 621         cloned.setUnencodedPassword(unencodedPassword);
 622         cloned.setTaxExemptionCode(taxExemptionCode);
 623         cloned.setUnencodedChallengeAnswer(unencodedChallengeAnswer);
 624         cloned.setRegistered(registered);
 625         cloned.setReceiveEmail(receiveEmail);
 626         cloned.setPasswordChangeRequired(passwordChangeRequired);
 627         cloned.setPassword(password);
 628         cloned.setLastName(lastName);
 629         cloned.setFirstName(firstName);
 630         cloned.setEmailAddress(emailAddress);
 631         cloned.setDeactivated(deactivated);
 632         for (CustomerPayment entry : customerPayments) {
 633             CustomerPayment clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 634             clonedEntry.setCustomer(cloned);
 635             cloned.getCustomerPayments().add(clonedEntry);
 636         }
 637         for (CustomerPhone entry : customerPhones) {
 638             CustomerPhone clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 639             clonedEntry.setCustomer(cloned);
 640             cloned.getCustomerPhones().add(clonedEntry);
 641         }
 642         return createResponse;
 643     }
 644 
 645     @Override
 646     public String getTaxExemptionCode() {
 647         return this.taxExemptionCode;
 648     }
 649 
 650     @Override
 651     public void setTaxExemptionCode(String exemption) {
 652         this.taxExemptionCode = exemption;
 653 
 654         if (exemption != null) {
 655             this.isTaxExempt = true;
 656         }
 657     }
 658 
 659     @Override
 660     public boolean isTaxExempt() {
 661         return isTaxExempt != null &amp;&amp; isTaxExempt != false &amp;&amp;  StringUtils.isNotEmpty(taxExemptionCode);
 662     }
 663 
 664 }</pre></td>
                            <td><pre>   1 /*
   2  * #%L
   3  * BroadleafCommerce Profile
   4  * %%
   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6  * %%
   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10  * the Broadleaf End User License Agreement (EULA), Version 1.1
  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12  * shall apply.
  13  *
<abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr>
<abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr>
  16  * #L%
  17  */
  18 
  19 package org.broadleafcommerce.profile.core.domain;
  20 
  21 import org.apache.commons.lang3.BooleanUtils;
  22 import org.apache.commons.lang3.StringUtils;
  23 import org.broadleafcommerce.common.admin.domain.AdminMainEntity;
  24 import org.broadleafcommerce.common.audit.Auditable;
  25 import org.broadleafcommerce.common.audit.AuditableListener;
  26 import org.broadleafcommerce.common.audit.AuditExcludeFieldValue;
  27 import org.broadleafcommerce.common.copy.CreateResponse;
  28 import org.broadleafcommerce.common.copy.MultiTenantCopyContext;
  29 import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransform;
  30 import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransformMember;
  31 import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransformTypes;
  32 import org.broadleafcommerce.common.locale.domain.Locale;
  33 import org.broadleafcommerce.common.locale.domain.LocaleImpl;
  34 import org.broadleafcommerce.common.persistence.PreviewStatus;
  35 import org.broadleafcommerce.common.persistence.Previewable;
  36 import org.broadleafcommerce.common.presentation.AdminPresentation;
  37 import org.broadleafcommerce.common.presentation.AdminPresentationCollection;
  38 import org.broadleafcommerce.common.presentation.AdminPresentationMap;
  39 import org.broadleafcommerce.common.presentation.RequiredOverride;
  40 import org.broadleafcommerce.common.presentation.client.AddMethodType;
  41 import org.broadleafcommerce.common.presentation.client.VisibilityEnum;
  42 import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeEntry;
  43 import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeOverride;
  44 import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeOverrides;
  45 import org.broadleafcommerce.common.presentation.override.PropertyType;
  46 import org.hibernate.annotations.BatchSize;
  47 import org.hibernate.annotations.Cache;
  48 import org.hibernate.annotations.CacheConcurrencyStrategy;
  49 import org.hibernate.annotations.Cascade;
  50 import org.hibernate.annotations.Index;
  51 import org.hibernate.annotations.Where;
  52 
  53 import java.util.ArrayList;
  54 import java.util.HashMap;
  55 import java.util.List;
  56 import java.util.Map;
  57 
  58 import javax.persistence.CascadeType;
  59 import javax.persistence.Column;
  60 import javax.persistence.Embedded;
  61 import javax.persistence.Entity;
  62 import javax.persistence.EntityListeners;
  63 import javax.persistence.FetchType;
  64 import javax.persistence.Id;
  65 import javax.persistence.Inheritance;
  66 import javax.persistence.InheritanceType;
  67 import javax.persistence.JoinColumn;
  68 import javax.persistence.ManyToOne;
  69 import javax.persistence.MapKey;
  70 import javax.persistence.OneToMany;
  71 import javax.persistence.Table;
  72 import javax.persistence.Transient;
  73 
  74 @Entity
  75 @EntityListeners(value = { AuditableListener.class, CustomerPersistedEntityListener.class })
  76 @Inheritance(strategy = InheritanceType.JOINED)
  77 @Table(name = &quot;BLC_CUSTOMER&quot;)
  78 @Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE, region = &quot;blCustomerElements&quot;)
  79 @AdminPresentationMergeOverrides(
  80     {
  81         @AdminPresentationMergeOverride(name = &quot;auditable.dateCreated&quot;, mergeEntries =
<abbr title="  82             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)),">  82             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValðŸ”µ</abbr>
  83         @AdminPresentationMergeOverride(name = &quot;auditable.createdBy&quot;, mergeEntries =
<abbr title="  84             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)),">  84             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValðŸ”µ</abbr>
  85         @AdminPresentationMergeOverride(name = &quot;auditable.dateUpdated&quot;, mergeEntries =
<abbr title="  86             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)),">  86             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValðŸ”µ</abbr>
  87         @AdminPresentationMergeOverride(name = &quot;auditable.updatedBy&quot;, mergeEntries =
<abbr title="  88             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit))">  88             @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValðŸ”µ</abbr>
  89     }
  90 )
  91 @DirectCopyTransform({
  92         @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.PREVIEW),
  93         @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.MULTITENANT_SITE),
  94         @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.ARCHIVE_ONLY)
  95 })
  96 public class CustomerImpl implements Customer, AdminMainEntity, Previewable, CustomerAdminPresentation {
  97 
  98     private static final long serialVersionUID = 1L;
  99 
 100     @Id
 101     @Column(name = &quot;CUSTOMER_ID&quot;)
 102     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Id&quot;, visibility = VisibilityEnum.HIDDEN_ALL)
 103     protected Long id;
 104 
 105     @Embedded
 106     protected Auditable auditable = new Auditable();
 107 
 108     @Embedded
 109     protected PreviewStatus previewable = new PreviewStatus();
 110 
 111     @Column(name = &quot;USER_NAME&quot;)
 112     @AdminPresentation(friendlyName = &quot;CustomerImpl_UserName&quot;,
 113             group = GroupName.Customer, order = FieldOrder.USERNAME,
 114             requiredOverride = RequiredOverride.REQUIRED)
 115     protected String username;
 116 
 117     @Column(name = &quot;PASSWORD&quot;)
 118     @AdminPresentation(excluded = true)
 119     @AuditExcludeFieldValue
 120     protected String password;
 121 
 122     @Column(name = &quot;EMAIL_ADDRESS&quot;)
 123     @Index(name = &quot;CUSTOMER_EMAIL_INDEX&quot;, columnNames = { &quot;EMAIL_ADDRESS&quot; })
 124     @AdminPresentation(friendlyName = &quot;CustomerImpl_Email_Address&quot;,
 125             group = GroupName.Customer, order = FieldOrder.EMAIL,
 126             prominent = true, gridOrder = 1000)
 127     protected String emailAddress;
 128 
 129     @Column(name = &quot;FIRST_NAME&quot;)
 130     @AdminPresentation(friendlyName = &quot;CustomerImpl_First_Name&quot;,
 131             group = GroupName.Customer, order = FieldOrder.FIRST_NAME,
 132             prominent = true, gridOrder = 2000)
 133     protected String firstName;
 134 
 135     @Column(name = &quot;LAST_NAME&quot;)
 136     @AdminPresentation(friendlyName = &quot;CustomerImpl_Last_Name&quot;,
 137             group = GroupName.Customer, order = FieldOrder.LAST_NAME,
 138             prominent = true, gridOrder = 3000)
 139     protected String lastName;
 140 
 141     @Column(name = &quot;EXTERNAL_ID&quot;)
 142     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_ExternalId&quot;,
 143             group = GroupName.Customer, order = FieldOrder.EXTERNAL_ID,
 144             visibility = VisibilityEnum.GRID_HIDDEN)
 145     protected String externalId;
 146 
 147     @ManyToOne(targetEntity = ChallengeQuestionImpl.class, fetch = FetchType.LAZY)
 148     @JoinColumn(name = &quot;CHALLENGE_QUESTION_ID&quot;)
 149     @Index(name = &quot;CUSTOMER_CHALLENGE_INDEX&quot;, columnNames = { &quot;CHALLENGE_QUESTION_ID&quot; })
 150     @AdminPresentation(friendlyName = &quot;CustomerImpl_Challenge_Question&quot;,
 151             excluded = true)
 152     protected ChallengeQuestion challengeQuestion;
 153 
 154     @Column(name = &quot;CHALLENGE_ANSWER&quot;)
 155     @AdminPresentation(friendlyName = &quot;CustomerImpl_Challenge_Answer&quot;,
 156             excluded = true)
 157     protected String challengeAnswer;
 158 
 159     /**
 160      * &lt;p&gt;
 161      *     If true, this customer must go through a reset password flow.
 162      * &lt;/p&gt;
 163      * &lt;p&gt;
 164      *     During a site conversion or security breach or a matter of routine security policy,
 165      *     it may be necessary to require users to change their password. This property will
 166      *     not allow a user whose credentials are managed within Broadleaf to login until
 167      *     they have reset their password.
 168      * &lt;/p&gt;
 169      * &lt;p&gt;
 170      *     Used by blUserDetailsService.
 171      * &lt;/p&gt;
 172      */
 173     @Column(name = &quot;PASSWORD_CHANGE_REQUIRED&quot;)
 174     @AdminPresentation(excluded = true)
 175     protected Boolean passwordChangeRequired = false;
 176 
 177     @Column(name = &quot;RECEIVE_EMAIL&quot;)
 178     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Receive_Email&quot;,
 179             group = GroupName.QualificationOptions, order = FieldOrder.RECIEVE_EMAIL)
 180     protected Boolean receiveEmail = false;
 181 
 182     @Column(name = &quot;IS_REGISTERED&quot;)
 183     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Registered&quot;,
 184             group = GroupName.QualificationOptions, order = FieldOrder.REGISTERED,
 185             prominent = true, gridOrder = 4000)
 186     protected Boolean registered = false;
 187 
 188     @Column(name = &quot;DEACTIVATED&quot;)
 189     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Deactivated&quot;,
 190             group = GroupName.QualificationOptions, order = FieldOrder.DEACTIVATED)
 191     protected Boolean deactivated = false;
 192 
 193     @ManyToOne(targetEntity = LocaleImpl.class)
 194     @JoinColumn(name = &quot;LOCALE_CODE&quot;)
 195     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Locale&quot;,
 196         excluded = true, visibility = VisibilityEnum.GRID_HIDDEN)
 197     protected Locale customerLocale;
 198 
<abbr title=" 199     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAttributeImpl.class, cascade = { CascadeType.ALL }, orphanRemoval = true)"> 199     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAttributeImpl.class, cascade = { CascadeTypeðŸ”µ</abbr>
 200     @Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE, region = &quot;blStandardElements&quot;)
 201     @MapKey(name = &quot;name&quot;)
 202     @BatchSize(size = 50)
 203     @AdminPresentationMap(friendlyName = &quot;CustomerAttributeImpl_Attribute_Name&quot;,
 204             tab = CustomerAdminPresentation.TabName.General,
 205             deleteEntityUponRemove = true, forceFreeFormKeys = true,
 206             keyPropertyFriendlyName = &quot;ProductAttributeImpl_Attribute_Name&quot;)
 207     protected Map&lt;String, CustomerAttribute&gt; customerAttributes = new HashMap&lt;&gt;();
 208 
<abbr title=" 209     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAddressImpl.class, cascade = { CascadeType.ALL })"> 209     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAddressImpl.class, cascade = { CascadeType.AðŸ”µ</abbr>
<abbr title=" 210     @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPHAN })"> 210     @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DðŸ”µ</abbr>
 211     @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 212     @Where(clause = &quot;archived != &#x27;Y&#x27;&quot;)
 213     @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Addresses&quot;,
 214             group = GroupName.ContactInfo, order = FieldOrder.ADDRESSES,
 215             addType = AddMethodType.PERSIST)
 216     protected List&lt;CustomerAddress&gt; customerAddresses = new ArrayList&lt;&gt;();
 217 
<abbr title=" 218     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPhoneImpl.class, cascade = { CascadeType.ALL })"> 218     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPhoneImpl.class, cascade = { CascadeType.ALLðŸ”µ</abbr>
<abbr title=" 219     @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPHAN })"> 219     @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DðŸ”µ</abbr>
 220     @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 221     @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Phones&quot;,
 222             group = GroupName.ContactInfo, order = FieldOrder.PHONES,
 223             addType = AddMethodType.PERSIST)
 224     protected List&lt;CustomerPhone&gt; customerPhones = new ArrayList&lt;&gt;();
 225 
<abbr title=" 226     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPaymentImpl.class, cascade = { CascadeType.ALL })"> 226     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPaymentImpl.class, cascade = { CascadeType.AðŸ”µ</abbr>
<abbr title=" 227     @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPHAN })"> 227     @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DðŸ”µ</abbr>
 228     @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 229     @BatchSize(size = 50)
 230     @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Payments&quot;,
 231             tab = TabName.PaymentMethods, order = 1000,
 232             addType = AddMethodType.PERSIST,
 233             readOnly = true)
 234     protected List&lt;CustomerPayment&gt; customerPayments = new ArrayList&lt;&gt;();
 235 
 236     @Column(name = &quot;IS_TAX_EXEMPT&quot;)
 237     @AdminPresentation(friendlyName = &quot;CustomerImpl_Is_Tax_Exempt&quot;,
 238             group = GroupName.Pricing, order = FieldOrder.IS_TAX_EXEMPT,
 239             defaultValue = &quot;false&quot;)
 240     protected Boolean isTaxExempt = false;
 241 
 242     @Column(name = &quot;TAX_EXEMPTION_CODE&quot;)
 243     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_TaxExemptCode&quot;,
 244             group = GroupName.Pricing, order = FieldOrder.TAX_EXEMPTION_CODE,
 245             visibility = VisibilityEnum.GRID_HIDDEN)
 246     protected String taxExemptionCode;
 247 
 248     @Transient
 249     protected String unencodedPassword;
 250 
 251     @Transient
 252     protected String unencodedChallengeAnswer;
 253 
 254     @Transient
 255     protected boolean anonymous;
 256 
 257     @Transient
 258     protected boolean cookied;
 259 
 260     @Transient
 261     protected boolean loggedIn;
 262 
 263     @Transient
 264     protected Map&lt;String, Object&gt; transientProperties = new HashMap&lt;String, Object&gt;();
 265 
 266     @Override
 267     public Long getId() {
 268         return id;
 269     }
 270 
 271     @Override
 272     public void setId(Long id) {
 273         this.id = id;
 274     }
 275 
 276     @Override
 277     public String getUsername() {
 278         return username;
 279     }
 280 
 281     @Override
 282     public void setUsername(String username) {
 283         this.username = username;
 284     }
 285 
 286     @Override
 287     public String getPassword() {
 288         return password;
 289     }
 290 
 291     @Override
 292     public void setPassword(String password) {
 293         this.password = password;
 294     }
 295 
 296     @Override
 297     public boolean isPasswordChangeRequired() {
 298         return BooleanUtils.toBoolean(passwordChangeRequired);
 299     }
 300 
 301     @Override
 302     public void setPasswordChangeRequired(boolean passwordChangeRequired) {
 303         this.passwordChangeRequired = Boolean.valueOf(passwordChangeRequired);
 304     }
 305 
 306     @Override
 307     public String getFirstName() {
 308         return firstName;
 309     }
 310 
 311     @Override
 312     public void setFirstName(String firstName) {
 313         this.firstName = firstName;
 314     }
 315 
 316     @Override
 317     public String getLastName() {
 318         return lastName;
 319     }
 320 
 321     @Override
 322     public void setLastName(String lastName) {
 323         this.lastName = lastName;
 324     }
 325 
 326     @Override
 327     public String getEmailAddress() {
 328         return emailAddress;
 329     }
 330 
 331     @Override
 332     public void setEmailAddress(String emailAddress) {
 333         this.emailAddress = emailAddress;
 334     }
 335 
 336     @Override
 337     public String getExternalId() {
 338         return externalId;
 339     }
 340 
 341     @Override
 342     public void setExternalId(String externalId) {
 343         this.externalId = externalId;
 344     }
 345 
 346     @Override
 347     public ChallengeQuestion getChallengeQuestion() {
 348         return challengeQuestion;
 349     }
 350 
 351     @Override
 352     public void setChallengeQuestion(ChallengeQuestion challengeQuestion) {
 353         this.challengeQuestion = challengeQuestion;
 354     }
 355 
 356     @Override
 357     public String getChallengeAnswer() {
 358         return challengeAnswer;
 359     }
 360 
 361     @Override
 362     public void setChallengeAnswer(String challengeAnswer) {
 363         this.challengeAnswer = challengeAnswer;
 364     }
 365 
 366     @Override
 367     public String getUnencodedPassword() {
 368         return unencodedPassword;
 369     }
 370 
 371     @Override
 372     public void setUnencodedPassword(String unencodedPassword) {
 373         this.unencodedPassword = unencodedPassword;
 374     }
 375 
 376     @Override
 377     public boolean isReceiveEmail() {
 378         return BooleanUtils.toBoolean(receiveEmail);
 379     }
 380 
 381     @Override
 382     public void setReceiveEmail(boolean receiveEmail) {
 383         this.receiveEmail = Boolean.valueOf(receiveEmail);
 384     }
 385 
 386     @Override
 387     public boolean isRegistered() {
 388         return BooleanUtils.toBoolean(registered);
 389     }
 390 
 391     @Override
 392     public void setRegistered(boolean registered) {
 393         this.registered = Boolean.valueOf(registered);
 394     }
 395 
 396     @Override
 397     public String getUnencodedChallengeAnswer() {
 398         return unencodedChallengeAnswer;
 399     }
 400 
 401     @Override
 402     public void setUnencodedChallengeAnswer(String unencodedChallengeAnswer) {
 403         this.unencodedChallengeAnswer = unencodedChallengeAnswer;
 404     }
 405 
 406     @Override
 407     public Auditable getAuditable() {
 408         return auditable;
 409     }
 410 
 411     @Override
 412     public void setAuditable(Auditable auditable) {
 413         this.auditable = auditable;
 414     }
 415 
 416     @Override
 417     public boolean isAnonymous() {
 418         return anonymous;
 419     }
 420 
 421     @Override
 422     public boolean isCookied() {
 423         return cookied;
 424     }
 425 
 426     @Override
 427     public boolean isLoggedIn() {
 428         return loggedIn;
 429     }
 430 
 431     @Override
 432     public void setAnonymous(boolean anonymous) {
 433         this.anonymous = anonymous;
 434         if (anonymous) {
 435             cookied = false;
 436             loggedIn = false;
 437         }
 438     }
 439 
 440     @Override
 441     public void setCookied(boolean cookied) {
 442         this.cookied = cookied;
 443         if (cookied) {
 444             anonymous = false;
 445             loggedIn = false;
 446         }
 447     }
 448 
 449     @Override
 450     public void setLoggedIn(boolean loggedIn) {
 451         this.loggedIn = loggedIn;
 452         if (loggedIn) {
 453             anonymous = false;
 454             cookied = false;
 455         }
 456     }
 457 
 458     @Override
 459     public Locale getCustomerLocale() {
 460         return customerLocale;
 461     }
 462 
 463     @Override
 464     public void setCustomerLocale(Locale customerLocale) {
 465         this.customerLocale = customerLocale;
 466     }
 467 
 468     @Override
 469     public Map&lt;String, CustomerAttribute&gt; getCustomerAttributes() {
 470         return customerAttributes;
 471     }
 472 
 473     @Override
 474     public void setCustomerAttributes(Map&lt;String, CustomerAttribute&gt; customerAttributes) {
 475         this.customerAttributes = customerAttributes;
 476     }
 477 
 478     @Override
 479     public boolean isDeactivated() {
 480         return BooleanUtils.toBoolean(deactivated);
 481     }
 482 
 483     @Override
 484     public void setDeactivated(boolean deactivated) {
 485         this.deactivated = Boolean.valueOf(deactivated);
 486     }
 487 
 488     @Override
 489     public List&lt;CustomerAddress&gt; getCustomerAddresses() {
 490         return customerAddresses;
 491     }
 492 
 493     @Override
 494     public void setCustomerAddresses(List&lt;CustomerAddress&gt; customerAddresses) {
 495         this.customerAddresses = customerAddresses;
 496     }
 497 
 498     @Override
 499     public List&lt;CustomerPhone&gt; getCustomerPhones() {
 500         return customerPhones;
 501     }
 502 
 503     @Override
 504     public void setCustomerPhones(List&lt;CustomerPhone&gt; customerPhones) {
 505         this.customerPhones = customerPhones;
 506     }
 507 
 508     @Override
 509     public List&lt;CustomerPayment&gt; getCustomerPayments() {
 510         return customerPayments;
 511     }
 512 
 513     @Override
 514     public void setCustomerPayments(List&lt;CustomerPayment&gt; customerPayments) {
 515         this.customerPayments = customerPayments;
 516     }
 517 
 518     @Override
 519     public String getMainEntityName() {
 520         if (!StringUtils.isEmpty(getFirstName()) &amp;&amp; !StringUtils.isEmpty(getLastName())) {
 521             return getFirstName() + &quot; &quot; + getLastName();
 522         }
 523         if (!StringUtils.isEmpty(getUsername())) {
 524             return getUsername();
 525         }
 526         return String.valueOf(getId());
 527     }
 528 
 529     @Override
 530     public Boolean getPreview() {
 531         if (previewable == null) {
 532             previewable = new PreviewStatus();
 533         }
 534         return previewable.getPreview();
 535     }
 536 
 537     @Override
 538     public void setPreview(Boolean preview) {
 539         if (previewable == null) {
 540             previewable = new PreviewStatus();
 541         }
 542         previewable.setPreview(preview);
 543     }
 544 
 545     @Override
 546     public Map&lt;String, Object&gt; getTransientProperties() {
 547         return transientProperties;
 548     }
 549 
 550     @Override
 551     public boolean equals(Object obj) {
 552         if (this == obj) {
 553             return true;
 554         }
 555         if (obj == null) {
 556             return false;
 557         }
 558         if (!getClass().isAssignableFrom(obj.getClass())) {
 559             return false;
 560         }
 561         CustomerImpl other = (CustomerImpl) obj;
 562 
 563         if (id != null &amp;&amp; other.id != null) {
 564             return id.equals(other.id);
 565         }
 566 
 567         if (username == null) {
 568             if (other.username != null) {
 569                 return false;
 570             }
 571         } else if (!username.equals(other.username)) {
 572             return false;
 573         }
 574         return true;
 575     }
 576 
 577     @Override
 578     public int hashCode() {
 579         final int prime = 31;
 580         int result = 1;
 581         result = prime * result + ((username == null) ? 0 : username.hashCode());
 582         return result;
 583     }
 584 
 585     @Override
<abbr title=" 586     public &lt;G extends Customer&gt; CreateResponse&lt;G&gt; createOrRetrieveCopyInstance(MultiTenantCopyContext context) throws CloneNotSupportedException {"> 586     public &lt;G extends Customer&gt; CreateResponse&lt;G&gt; createOrRetrieveCopyInstance(MultiTenantCopyContext conðŸ”µ</abbr>
 587         CreateResponse&lt;G&gt; createResponse = context.createOrRetrieveCopyInstance(this);
 588         if (createResponse.isAlreadyPopulated()) {
 589             return createResponse;
 590         }
 591         Customer cloned = createResponse.getClone();
 592         cloned.setAnonymous(anonymous);
 593         cloned.setChallengeAnswer(challengeAnswer);
 594         cloned.setChallengeQuestion(challengeQuestion);
 595         cloned.setCookied(cookied);
 596         for (CustomerAddress entry : customerAddresses) {
 597             CustomerAddress clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 598             clonedEntry.setCustomer(cloned);
 599             cloned.getCustomerAddresses().add(clonedEntry);
 600 
 601         }
 602         for (Map.Entry&lt;String, CustomerAttribute&gt; entry : customerAttributes.entrySet()) {
<abbr title=" 603             CustomerAttribute clonedEntry = entry.getValue().createOrRetrieveCopyInstance(context).getClone();"> 603             CustomerAttribute clonedEntry = entry.getValue().createOrRetrieveCopyInstance(context).getCloðŸ”µ</abbr>
 604             clonedEntry.setCustomer(cloned);
 605             cloned.getCustomerAttributes().put(entry.getKey(), clonedEntry);
 606         }
 607         cloned.setLoggedIn(loggedIn);
 608         cloned.setUsername(username);
 609         cloned.setUnencodedPassword(unencodedPassword);
 610         cloned.setTaxExemptionCode(taxExemptionCode);
 611         cloned.setUnencodedChallengeAnswer(unencodedChallengeAnswer);
 612         cloned.setRegistered(registered);
 613         cloned.setReceiveEmail(receiveEmail);
 614         cloned.setPasswordChangeRequired(passwordChangeRequired);
 615         cloned.setPassword(password);
 616         cloned.setLastName(lastName);
 617         cloned.setFirstName(firstName);
 618         cloned.setEmailAddress(emailAddress);
 619         cloned.setDeactivated(deactivated);
 620         for (CustomerPayment entry : customerPayments) {
 621             CustomerPayment clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 622             clonedEntry.setCustomer(cloned);
 623             cloned.getCustomerPayments().add(clonedEntry);
 624         }
 625         for (CustomerPhone entry : customerPhones) {
 626             CustomerPhone clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 627             clonedEntry.setCustomer(cloned);
 628             cloned.getCustomerPhones().add(clonedEntry);
 629         }
 630         return createResponse;
 631     }
 632 
 633     @Override
 634     public String getTaxExemptionCode() {
 635         return this.taxExemptionCode;
 636     }
 637 
 638     @Override
 639     public void setTaxExemptionCode(String exemption) {
 640         this.taxExemptionCode = exemption;
 641 
 642         if (exemption != null) {
 643             this.isTaxExempt = true;
 644         }
 645     }
 646 
 647     @Override
 648     public boolean isTaxExempt() {
 649         return isTaxExempt != null &amp;&amp; isTaxExempt != false &amp;&amp;  StringUtils.isNotEmpty(taxExemptionCode);
 650     }
 651 
 652 }
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * #%L
   3  * BroadleafCommerce Profile
   4  * %%
   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6  * %%
   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10  * the Broadleaf End User License Agreement (EULA), Version 1.1
  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12  * shall apply.
  13  *
<abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr>
<abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr>
  16  * #L%
  17  */
  18 package org.broadleafcommerce.profile.core.domain;
  19 
  20 import java.util.ArrayList;
  21 import java.util.HashMap;
  22 import java.util.List;
  23 import java.util.Map;
  24 import javax.persistence.CascadeType;
  25 import javax.persistence.Column;
  26 import javax.persistence.Embedded;
  27 import javax.persistence.Entity;
  28 import javax.persistence.EntityListeners;
  29 import javax.persistence.FetchType;
  30 import javax.persistence.Id;
  31 import javax.persistence.Inheritance;
  32 import javax.persistence.InheritanceType;
  33 import javax.persistence.JoinColumn;
  34 import javax.persistence.ManyToOne;
  35 import javax.persistence.MapKey;
  36 import javax.persistence.OneToMany;
  37 import javax.persistence.Table;
  38 import javax.persistence.Transient;
  39 import org.apache.commons.lang3.BooleanUtils;
  40 import org.apache.commons.lang3.StringUtils;
  41 import org.broadleafcommerce.common.admin.domain.AdminMainEntity;
  42 import org.broadleafcommerce.common.audit.AuditExcludeFieldValue;
  43 import org.broadleafcommerce.common.audit.Auditable;
  44 import org.broadleafcommerce.common.audit.AuditableListener;
  45 import org.broadleafcommerce.common.copy.CreateResponse;
  46 import org.broadleafcommerce.common.copy.MultiTenantCopyContext;
  47 import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransform;
  48 import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransformMember;
  49 import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransformTypes;
  50 import org.broadleafcommerce.common.locale.domain.Locale;
  51 import org.broadleafcommerce.common.locale.domain.LocaleImpl;
  52 import org.broadleafcommerce.common.persistence.PreviewStatus;
  53 import org.broadleafcommerce.common.persistence.Previewable;
  54 import org.broadleafcommerce.common.presentation.AdminPresentation;
  55 import org.broadleafcommerce.common.presentation.AdminPresentationCollection;
  56 import org.broadleafcommerce.common.presentation.AdminPresentationMap;
  57 import org.broadleafcommerce.common.presentation.RequiredOverride;
  58 import org.broadleafcommerce.common.presentation.client.AddMethodType;
  59 import org.broadleafcommerce.common.presentation.client.VisibilityEnum;
  60 import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeEntry;
  61 import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeOverride;
  62 import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeOverrides;
  63 import org.broadleafcommerce.common.presentation.override.PropertyType;
  64 import org.hibernate.annotations.BatchSize;
  65 import org.hibernate.annotations.Cache;
  66 import org.hibernate.annotations.CacheConcurrencyStrategy;
  67 import org.hibernate.annotations.Cascade;
  68 import org.hibernate.annotations.Index;
  69 import org.hibernate.annotations.Where;
  70 
  71 
  72 @Entity
  73 @EntityListeners({ AuditableListener.class, CustomerPersistedEntityListener.class })
  74 @Inheritance(strategy = InheritanceType.JOINED)
  75 @Table(name = &quot;BLC_CUSTOMER&quot;)
  76 @Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE, region = &quot;blCustomerElements&quot;)
<abbr title="  77 @AdminPresentationMergeOverrides({ @AdminPresentationMergeOverride(name = &quot;auditable.dateCreated&quot;, mergeEntries = @AdminPresentationMergeEntry(propertyType = AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)), @AdminPresentationMergeOverride(name = &quot;auditable.createdBy&quot;, mergeEntries = @AdminPresentationMergeEntry(propertyType = AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)), @AdminPresentationMergeOverride(name = &quot;auditable.dateUpdated&quot;, mergeEntries = @AdminPresentationMergeEntry(propertyType = AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)), @AdminPresentationMergeOverride(name = &quot;auditable.updatedBy&quot;, mergeEntries = @AdminPresentationMergeEntry(propertyType = AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)) })">  77 @AdminPresentationMergeOverrides({ @AdminPresentationMergeOverride(name = &quot;auditable.dateCreated&quot;, mergeEðŸ”µ</abbr>
<abbr title="  78 @DirectCopyTransform({ @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.PREVIEW), @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.MULTITENANT_SITE), @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.ARCHIVE_ONLY) })">  78 @DirectCopyTransform({ @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.PREVIEW), @DiðŸ”µ</abbr>
<abbr title="  79 public class CustomerImpl implements Customer , AdminMainEntity , Previewable , CustomerAdminPresentation {">  79 public class CustomerImpl implements Customer , AdminMainEntity , Previewable , CustomerAdminPresentationðŸ”µ</abbr>
  80     private static final long serialVersionUID = 1L;
  81 
  82     @Id
  83     @Column(name = &quot;CUSTOMER_ID&quot;)
  84     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Id&quot;, visibility = VisibilityEnum.HIDDEN_ALL)
  85     protected Long id;
  86 
  87     @Embedded
  88     protected Auditable auditable = new Auditable();
  89 
  90     @Embedded
  91     protected PreviewStatus previewable = new PreviewStatus();
  92 
  93     @Column(name = &quot;USER_NAME&quot;)
<abbr title="  94     @AdminPresentation(friendlyName = &quot;CustomerImpl_UserName&quot;, group = GroupName.Customer, order = FieldOrder.USERNAME, requiredOverride = RequiredOverride.REQUIRED)">  94     @AdminPresentation(friendlyName = &quot;CustomerImpl_UserName&quot;, group = GroupName.Customer, order = FieldOðŸ”µ</abbr>
  95     protected String username;
  96 
  97     @Column(name = &quot;PASSWORD&quot;)
  98     @AdminPresentation(excluded = true)
  99     @AuditExcludeFieldValue
 100     protected String password;
 101 
 102     @Column(name = &quot;EMAIL_ADDRESS&quot;)
 103     @Index(name = &quot;CUSTOMER_EMAIL_INDEX&quot;, columnNames = { &quot;EMAIL_ADDRESS&quot; })
<abbr title=" 104     @AdminPresentation(friendlyName = &quot;CustomerImpl_Email_Address&quot;, group = GroupName.Customer, order = FieldOrder.EMAIL, prominent = true, gridOrder = 1000)"> 104     @AdminPresentation(friendlyName = &quot;CustomerImpl_Email_Address&quot;, group = GroupName.Customer, order = FðŸ”µ</abbr>
 105     protected String emailAddress;
 106 
 107     @Column(name = &quot;FIRST_NAME&quot;)
<abbr title=" 108     @AdminPresentation(friendlyName = &quot;CustomerImpl_First_Name&quot;, group = GroupName.Customer, order = FieldOrder.FIRST_NAME, prominent = true, gridOrder = 2000)"> 108     @AdminPresentation(friendlyName = &quot;CustomerImpl_First_Name&quot;, group = GroupName.Customer, order = FielðŸ”µ</abbr>
 109     protected String firstName;
 110 
 111     @Column(name = &quot;LAST_NAME&quot;)
<abbr title=" 112     @AdminPresentation(friendlyName = &quot;CustomerImpl_Last_Name&quot;, group = GroupName.Customer, order = FieldOrder.LAST_NAME, prominent = true, gridOrder = 3000)"> 112     @AdminPresentation(friendlyName = &quot;CustomerImpl_Last_Name&quot;, group = GroupName.Customer, order = FieldðŸ”µ</abbr>
 113     protected String lastName;
 114 
 115     @Column(name = &quot;EXTERNAL_ID&quot;)
<abbr title=" 116     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_ExternalId&quot;, group = GroupName.Customer, order = FieldOrder.EXTERNAL_ID, visibility = VisibilityEnum.GRID_HIDDEN)"> 116     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_ExternalId&quot;, group = GroupName.Customer, ordðŸ”µ</abbr>
 117     protected String externalId;
 118 
 119     @ManyToOne(targetEntity = ChallengeQuestionImpl.class, fetch = FetchType.LAZY)
 120     @JoinColumn(name = &quot;CHALLENGE_QUESTION_ID&quot;)
 121     @Index(name = &quot;CUSTOMER_CHALLENGE_INDEX&quot;, columnNames = { &quot;CHALLENGE_QUESTION_ID&quot; })
 122     @AdminPresentation(friendlyName = &quot;CustomerImpl_Challenge_Question&quot;, excluded = true)
 123     protected ChallengeQuestion challengeQuestion;
 124 
 125     @Column(name = &quot;CHALLENGE_ANSWER&quot;)
 126     @AdminPresentation(friendlyName = &quot;CustomerImpl_Challenge_Answer&quot;, excluded = true)
 127     protected String challengeAnswer;
 128 
 129     /**
 130      * &lt;p&gt;
 131      * If true, this customer must go through a reset password flow.
 132      * &lt;/p&gt;
 133      * &lt;p&gt;
 134      * During a site conversion or security breach or a matter of routine security policy,
 135      * it may be necessary to require users to change their password. This property will
 136      * not allow a user whose credentials are managed within Broadleaf to login until
 137      * they have reset their password.
 138      * &lt;/p&gt;
 139      * &lt;p&gt;
 140      * Used by blUserDetailsService.
 141      * &lt;/p&gt;
 142      */
 143     @Column(name = &quot;PASSWORD_CHANGE_REQUIRED&quot;)
 144     @AdminPresentation(excluded = true)
 145     protected Boolean passwordChangeRequired = false;
 146 
 147     @Column(name = &quot;RECEIVE_EMAIL&quot;)
<abbr title=" 148     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Receive_Email&quot;, group = GroupName.QualificationOptions, order = FieldOrder.RECIEVE_EMAIL)"> 148     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Receive_Email&quot;, group = GroupName.QualificatðŸ”µ</abbr>
 149     protected Boolean receiveEmail = false;
 150 
 151     @Column(name = &quot;IS_REGISTERED&quot;)
<abbr title=" 152     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Registered&quot;, group = GroupName.QualificationOptions, order = FieldOrder.REGISTERED, prominent = true, gridOrder = 4000)"> 152     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Registered&quot;, group = GroupName.QualificationðŸ”µ</abbr>
 153     protected Boolean registered = false;
 154 
 155     @Column(name = &quot;DEACTIVATED&quot;)
<abbr title=" 156     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Deactivated&quot;, group = GroupName.QualificationOptions, order = FieldOrder.DEACTIVATED)"> 156     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Deactivated&quot;, group = GroupName.QualificatioðŸ”µ</abbr>
 157     protected Boolean deactivated = false;
 158 
 159     @ManyToOne(targetEntity = LocaleImpl.class)
 160     @JoinColumn(name = &quot;LOCALE_CODE&quot;)
<abbr title=" 161     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Locale&quot;, excluded = true, visibility = VisibilityEnum.GRID_HIDDEN)"> 161     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Locale&quot;, excluded = true, visibility = VisibðŸ”µ</abbr>
 162     protected Locale customerLocale;
 163 
<abbr title=" 164     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAttributeImpl.class, cascade = { CascadeType.ALL }, orphanRemoval = true)"> 164     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAttributeImpl.class, cascade = { CascadeTypeðŸ”µ</abbr>
 165     @Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE, region = &quot;blStandardElements&quot;)
 166     @MapKey(name = &quot;name&quot;)
 167     @BatchSize(size = 50)
<abbr title=" 168     @AdminPresentationMap(friendlyName = &quot;CustomerAttributeImpl_Attribute_Name&quot;, tab = CustomerAdminPresentation.TabName.General, deleteEntityUponRemove = true, forceFreeFormKeys = true, keyPropertyFriendlyName = &quot;ProductAttributeImpl_Attribute_Name&quot;)"> 168     @AdminPresentationMap(friendlyName = &quot;CustomerAttributeImpl_Attribute_Name&quot;, tab = CustomerAdminPreseðŸ”µ</abbr>
 169     protected Map&lt;String, CustomerAttribute&gt; customerAttributes = new HashMap&lt;&gt;();
 170 
<abbr title=" 171     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAddressImpl.class, cascade = { CascadeType.ALL })"> 171     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAddressImpl.class, cascade = { CascadeType.AðŸ”µ</abbr>
 172     @Cascade({ CascadeType.ALL, CascadeType.DELETE_ORPHAN })
 173     @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 174     @Where(clause = &quot;archived != &#x27;Y&#x27;&quot;)
<abbr title=" 175     @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Addresses&quot;, group = GroupName.ContactInfo, order = FieldOrder.ADDRESSES, addType = AddMethodType.PERSIST)"> 175     @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Addresses&quot;, group = GroupName.ContðŸ”µ</abbr>
 176     protected List&lt;CustomerAddress&gt; customerAddresses = new ArrayList&lt;&gt;();
 177 
<abbr title=" 178     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPhoneImpl.class, cascade = { CascadeType.ALL })"> 178     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPhoneImpl.class, cascade = { CascadeType.ALLðŸ”µ</abbr>
 179     @Cascade({ CascadeType.ALL, CascadeType.DELETE_ORPHAN })
 180     @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
<abbr title=" 181     @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Phones&quot;, group = GroupName.ContactInfo, order = FieldOrder.PHONES, addType = AddMethodType.PERSIST)"> 181     @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Phones&quot;, group = GroupName.ContactðŸ”µ</abbr>
 182     protected List&lt;CustomerPhone&gt; customerPhones = new ArrayList&lt;&gt;();
 183 
<abbr title=" 184     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPaymentImpl.class, cascade = { CascadeType.ALL })"> 184     @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPaymentImpl.class, cascade = { CascadeType.AðŸ”µ</abbr>
 185     @Cascade({ CascadeType.ALL, CascadeType.DELETE_ORPHAN })
 186     @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 187     @BatchSize(size = 50)
<abbr title=" 188     @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Payments&quot;, tab = TabName.PaymentMethods, order = 1000, addType = AddMethodType.PERSIST, readOnly = true)"> 188     @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Payments&quot;, tab = TabName.PaymentMeðŸ”µ</abbr>
 189     protected List&lt;CustomerPayment&gt; customerPayments = new ArrayList&lt;&gt;();
 190 
 191     @Column(name = &quot;IS_TAX_EXEMPT&quot;)
<abbr title=" 192     @AdminPresentation(friendlyName = &quot;CustomerImpl_Is_Tax_Exempt&quot;, group = GroupName.Pricing, order = FieldOrder.IS_TAX_EXEMPT, defaultValue = &quot;false&quot;)"> 192     @AdminPresentation(friendlyName = &quot;CustomerImpl_Is_Tax_Exempt&quot;, group = GroupName.Pricing, order = FiðŸ”µ</abbr>
 193     protected Boolean isTaxExempt = false;
 194 
 195     @Column(name = &quot;TAX_EXEMPTION_CODE&quot;)
<abbr title=" 196     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_TaxExemptCode&quot;, group = GroupName.Pricing, order = FieldOrder.TAX_EXEMPTION_CODE, visibility = VisibilityEnum.GRID_HIDDEN)"> 196     @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_TaxExemptCode&quot;, group = GroupName.Pricing, oðŸ”µ</abbr>
 197     protected String taxExemptionCode;
 198 
 199     @Transient
 200     protected String unencodedPassword;
 201 
 202     @Transient
 203     protected String unencodedChallengeAnswer;
 204 
 205     @Transient
 206     protected boolean anonymous;
 207 
 208     @Transient
 209     protected boolean cookied;
 210 
 211     @Transient
 212     protected boolean loggedIn;
 213 
 214     @Transient
 215     protected Map&lt;String, Object&gt; transientProperties = new HashMap&lt;String, Object&gt;();
 216 
 217     @Override
 218     public Long getId() {
 219         return id;
 220     }
 221 
 222     @Override
 223     public void setId(Long id) {
 224         this.id = id;
 225     }
 226 
 227     @Override
 228     public String getUsername() {
 229         return username;
 230     }
 231 
 232     @Override
 233     public void setUsername(String username) {
 234         this.username = username;
 235     }
 236 
 237     @Override
 238     public String getPassword() {
 239         return password;
 240     }
 241 
 242     @Override
 243     public void setPassword(String password) {
 244         this.password = password;
 245     }
 246 
 247     @Override
 248     public boolean isPasswordChangeRequired() {
 249         return BooleanUtils.toBoolean(passwordChangeRequired);
 250     }
 251 
 252     @Override
 253     public void setPasswordChangeRequired(boolean passwordChangeRequired) {
 254         this.passwordChangeRequired = Boolean.valueOf(passwordChangeRequired);
 255     }
 256 
 257     @Override
 258     public String getFirstName() {
 259         return firstName;
 260     }
 261 
 262     @Override
 263     public void setFirstName(String firstName) {
 264         this.firstName = firstName;
 265     }
 266 
 267     @Override
 268     public String getLastName() {
 269         return lastName;
 270     }
 271 
 272     @Override
 273     public void setLastName(String lastName) {
 274         this.lastName = lastName;
 275     }
 276 
 277     @Override
 278     public String getEmailAddress() {
 279         return emailAddress;
 280     }
 281 
 282     @Override
 283     public void setEmailAddress(String emailAddress) {
 284         this.emailAddress = emailAddress;
 285     }
 286 
 287     @Override
 288     public String getExternalId() {
 289         return externalId;
 290     }
 291 
 292     @Override
 293     public void setExternalId(String externalId) {
 294         this.externalId = externalId;
 295     }
 296 
 297     @Override
 298     public ChallengeQuestion getChallengeQuestion() {
 299         return challengeQuestion;
 300     }
 301 
 302     @Override
 303     public void setChallengeQuestion(ChallengeQuestion challengeQuestion) {
 304         this.challengeQuestion = challengeQuestion;
 305     }
 306 
 307     @Override
 308     public String getChallengeAnswer() {
 309         return challengeAnswer;
 310     }
 311 
 312     @Override
 313     public void setChallengeAnswer(String challengeAnswer) {
 314         this.challengeAnswer = challengeAnswer;
 315     }
 316 
 317     @Override
 318     public String getUnencodedPassword() {
 319         return unencodedPassword;
 320     }
 321 
 322     @Override
 323     public void setUnencodedPassword(String unencodedPassword) {
 324         this.unencodedPassword = unencodedPassword;
 325     }
 326 
 327     @Override
 328     public boolean isReceiveEmail() {
 329         return BooleanUtils.toBoolean(receiveEmail);
 330     }
 331 
 332     @Override
 333     public void setReceiveEmail(boolean receiveEmail) {
 334         this.receiveEmail = Boolean.valueOf(receiveEmail);
 335     }
 336 
 337     @Override
 338     public boolean isRegistered() {
 339         return BooleanUtils.toBoolean(registered);
 340     }
 341 
 342     @Override
 343     public void setRegistered(boolean registered) {
 344         this.registered = Boolean.valueOf(registered);
 345     }
 346 
 347     @Override
 348     public String getUnencodedChallengeAnswer() {
 349         return unencodedChallengeAnswer;
 350     }
 351 
 352     @Override
 353     public void setUnencodedChallengeAnswer(String unencodedChallengeAnswer) {
 354         this.unencodedChallengeAnswer = unencodedChallengeAnswer;
 355     }
 356 
 357     @Override
 358     public Auditable getAuditable() {
 359         return auditable;
 360     }
 361 
 362     @Override
 363     public void setAuditable(Auditable auditable) {
 364         this.auditable = auditable;
 365     }
 366 
 367     @Override
 368     public boolean isAnonymous() {
 369         return anonymous;
 370     }
 371 
 372     @Override
 373     public boolean isCookied() {
 374         return cookied;
 375     }
 376 
 377     @Override
 378     public boolean isLoggedIn() {
 379         return loggedIn;
 380     }
 381 
 382     @Override
 383     public void setAnonymous(boolean anonymous) {
 384         this.anonymous = anonymous;
 385         if (anonymous) {
 386             cookied = false;
 387             loggedIn = false;
 388         }
 389     }
 390 
 391     @Override
 392     public void setCookied(boolean cookied) {
 393         this.cookied = cookied;
 394         if (cookied) {
 395             anonymous = false;
 396             loggedIn = false;
 397         }
 398     }
 399 
 400     @Override
 401     public void setLoggedIn(boolean loggedIn) {
 402         this.loggedIn = loggedIn;
 403         if (loggedIn) {
 404             anonymous = false;
 405             cookied = false;
 406         }
 407     }
 408 
 409     @Override
 410     public Locale getCustomerLocale() {
 411         return customerLocale;
 412     }
 413 
 414     @Override
 415     public void setCustomerLocale(Locale customerLocale) {
 416         this.customerLocale = customerLocale;
 417     }
 418 
 419     @Override
 420     public Map&lt;String, CustomerAttribute&gt; getCustomerAttributes() {
 421         return customerAttributes;
 422     }
 423 
 424     @Override
 425     public void setCustomerAttributes(Map&lt;String, CustomerAttribute&gt; customerAttributes) {
 426         this.customerAttributes = customerAttributes;
 427     }
 428 
 429     @Override
 430     public boolean isDeactivated() {
 431         return BooleanUtils.toBoolean(deactivated);
 432     }
 433 
 434     @Override
 435     public void setDeactivated(boolean deactivated) {
 436         this.deactivated = Boolean.valueOf(deactivated);
 437     }
 438 
 439     @Override
 440     public List&lt;CustomerAddress&gt; getCustomerAddresses() {
 441         return customerAddresses;
 442     }
 443 
 444     @Override
 445     public void setCustomerAddresses(List&lt;CustomerAddress&gt; customerAddresses) {
 446         this.customerAddresses = customerAddresses;
 447     }
 448 
 449     @Override
 450     public List&lt;CustomerPhone&gt; getCustomerPhones() {
 451         return customerPhones;
 452     }
 453 
 454     @Override
 455     public void setCustomerPhones(List&lt;CustomerPhone&gt; customerPhones) {
 456         this.customerPhones = customerPhones;
 457     }
 458 
 459     @Override
 460     public List&lt;CustomerPayment&gt; getCustomerPayments() {
 461         return customerPayments;
 462     }
 463 
 464     @Override
 465     public void setCustomerPayments(List&lt;CustomerPayment&gt; customerPayments) {
 466         this.customerPayments = customerPayments;
 467     }
 468 
 469     @Override
 470     public String getMainEntityName() {
 471         if (!StringUtils.isEmpty(getFirstName()) &amp;&amp; !StringUtils.isEmpty(getLastName())) {
 472             return getFirstName() + &quot; &quot; + getLastName();
 473         }
 474         if (!StringUtils.isEmpty(getUsername())) {
 475             return getUsername();
 476         }
 477         return String.valueOf(getId());
 478     }
 479 
 480     @Override
 481     public Boolean getPreview() {
 482         if (previewable == null) {
 483             previewable = new PreviewStatus();
 484         }
 485         return previewable.getPreview();
 486     }
 487 
 488     @Override
 489     public void setPreview(Boolean preview) {
 490         if (previewable == null) {
 491             previewable = new PreviewStatus();
 492         }
 493         previewable.setPreview(preview);
 494     }
 495 
 496     @Override
 497     public Map&lt;String, Object&gt; getTransientProperties() {
 498         return transientProperties;
 499     }
 500 
 501     @Override
 502     public boolean equals(Object obj) {
 503         if (this == obj) {
 504             return true;
 505         }
 506         if (obj == null) {
 507             return false;
 508         }
 509         if (!getClass().isAssignableFrom(obj.getClass())) {
 510             return false;
 511         }
 512         CustomerImpl other = (CustomerImpl) obj;
 513 
 514         if (id != null &amp;&amp; other.id != null) {
 515             return id.equals(other.id);
 516         }
 517 
 518         if (username == null) {
 519             if (other.username != null) {
 520                 return false;
 521             }
 522         } else if (!username.equals(other.username)) {
 523             return false;
 524         }
 525         return true;
 526     }
 527 
 528     @Override
 529     public int hashCode() {
 530         final int prime = 31;
 531         int result = 1;
 532         result = prime * result + ((username == null) ? 0 : username.hashCode());
 533         return result;
 534     }
 535 
 536     @Override
<abbr title=" 537     public &lt;G extends Customer&gt; CreateResponse&lt;G&gt; createOrRetrieveCopyInstance(MultiTenantCopyContext context) throws CloneNotSupportedException {"> 537     public &lt;G extends Customer&gt; CreateResponse&lt;G&gt; createOrRetrieveCopyInstance(MultiTenantCopyContext conðŸ”µ</abbr>
 538         CreateResponse&lt;G&gt; createResponse = context.createOrRetrieveCopyInstance(this);
 539         if (createResponse.isAlreadyPopulated()) {
 540             return createResponse;
 541         }
 542         Customer cloned = createResponse.getClone();
 543         cloned.setAnonymous(anonymous);
 544         cloned.setChallengeAnswer(challengeAnswer);
 545         cloned.setChallengeQuestion(challengeQuestion);
 546         cloned.setCookied(cookied);
 547         for (CustomerAddress entry : customerAddresses) {
 548             CustomerAddress clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 549             clonedEntry.setCustomer(cloned);
 550             cloned.getCustomerAddresses().add(clonedEntry);
 551 
 552         }
 553         for (Map.Entry&lt;String, CustomerAttribute&gt; entry : customerAttributes.entrySet()) {
<abbr title=" 554             CustomerAttribute clonedEntry = entry.getValue().createOrRetrieveCopyInstance(context).getClone();"> 554             CustomerAttribute clonedEntry = entry.getValue().createOrRetrieveCopyInstance(context).getCloðŸ”µ</abbr>
 555             clonedEntry.setCustomer(cloned);
 556             cloned.getCustomerAttributes().put(entry.getKey(), clonedEntry);
 557         }
 558         cloned.setLoggedIn(loggedIn);
 559         cloned.setUsername(username);
 560         cloned.setUnencodedPassword(unencodedPassword);
 561         cloned.setTaxExemptionCode(taxExemptionCode);
 562         cloned.setUnencodedChallengeAnswer(unencodedChallengeAnswer);
 563         cloned.setRegistered(registered);
 564         cloned.setReceiveEmail(receiveEmail);
 565         cloned.setPasswordChangeRequired(passwordChangeRequired);
 566         cloned.setPassword(password);
 567         cloned.setLastName(lastName);
 568         cloned.setFirstName(firstName);
 569         cloned.setEmailAddress(emailAddress);
 570         cloned.setDeactivated(deactivated);
 571         for (CustomerPayment entry : customerPayments) {
 572             CustomerPayment clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 573             clonedEntry.setCustomer(cloned);
 574             cloned.getCustomerPayments().add(clonedEntry);
 575         }
 576         for (CustomerPhone entry : customerPhones) {
 577             CustomerPhone clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 578             clonedEntry.setCustomer(cloned);
 579             cloned.getCustomerPhones().add(clonedEntry);
 580         }
 581         return createResponse;
 582     }
 583 
 584     @Override
 585     public String getTaxExemptionCode() {
 586         return this.taxExemptionCode;
 587     }
 588 
 589     @Override
 590     public void setTaxExemptionCode(String exemption) {
 591         this.taxExemptionCode = exemption;
 592 
 593         if (exemption != null) {
 594             this.isTaxExempt = true;
 595         }
 596     }
 597 
 598     @Override
 599     public boolean isTaxExempt() {
 600         return isTaxExempt != null &amp;&amp; isTaxExempt != false &amp;&amp;  StringUtils.isNotEmpty(taxExemptionCode);
 601     }
 602 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * #%L
   3   * BroadleafCommerce Profile
   4   * %%
   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6   * %%
   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10   * the Broadleaf End User License Agreement (EULA), Version 1.1
  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12   * shall apply.
  13   *
<abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr>
  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.
  16   * #L%
  17   */
  18  
  19  package org.broadleafcommerce.profile.core.domain;
  20  
  21  import org.apache.commons.lang3.BooleanUtils;
  22  import org.apache.commons.lang3.StringUtils;
  23  import org.broadleafcommerce.common.admin.domain.AdminMainEntity;
  24  import org.broadleafcommerce.common.audit.Auditable;
  25  import org.broadleafcommerce.common.audit.AuditableListener;
  26  import org.broadleafcommerce.common.audit.AuditExcludeFieldValue;
  27  import org.broadleafcommerce.common.copy.CreateResponse;
  28  import org.broadleafcommerce.common.copy.MultiTenantCopyContext;
  29  import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransform;
  30  import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransformMember;
  31  import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransformTypes;
  32  import org.broadleafcommerce.common.locale.domain.Locale;
  33  import org.broadleafcommerce.common.locale.domain.LocaleImpl;
  34  import org.broadleafcommerce.common.persistence.PreviewStatus;
  35  import org.broadleafcommerce.common.persistence.Previewable;
  36  import org.broadleafcommerce.common.presentation.AdminPresentation;
  37  import org.broadleafcommerce.common.presentation.AdminPresentationCollection;
  38  import org.broadleafcommerce.common.presentation.AdminPresentationMap;
  39  import org.broadleafcommerce.common.presentation.RequiredOverride;
  40  import org.broadleafcommerce.common.presentation.client.AddMethodType;
  41  import org.broadleafcommerce.common.presentation.client.VisibilityEnum;
  42  import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeEntry;
  43  import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeOverride;
  44  import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeOverrides;
  45  import org.broadleafcommerce.common.presentation.override.PropertyType;
  46  import org.hibernate.annotations.BatchSize;
  47  import org.hibernate.annotations.Cache;
  48  import org.hibernate.annotations.CacheConcurrencyStrategy;
  49  import org.hibernate.annotations.Cascade;
  50  import org.hibernate.annotations.Index;
  51  import org.hibernate.annotations.Where;
  52  
  53  import java.util.ArrayList;
  54  import java.util.HashMap;
  55  import java.util.List;
  56  import java.util.Map;
  57  
  58  import javax.persistence.CascadeType;
  59  import javax.persistence.Column;
  60  import javax.persistence.Embedded;
  61  import javax.persistence.Entity;
  62  import javax.persistence.EntityListeners;

  63  import javax.persistence.Id;
  64  import javax.persistence.Inheritance;
  65  import javax.persistence.InheritanceType;
  66  import javax.persistence.JoinColumn;
  67  import javax.persistence.ManyToOne;
  68  import javax.persistence.MapKey;
  69  import javax.persistence.OneToMany;
  70  import javax.persistence.Table;
  71  import javax.persistence.Transient;
  72  
  73  @Entity
  74  @EntityListeners(value = { AuditableListener.class, CustomerPersistedEntityListener.class })
  75  @Inheritance(strategy = InheritanceType.JOINED)
  76  @Table(name = &quot;BLC_CUSTOMER&quot;)
  77  @Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE, region = &quot;blCustomerElements&quot;)
  78  @AdminPresentationMergeOverrides(
  79      {
  80          @AdminPresentationMergeOverride(name = &quot;auditable.dateCreated&quot;, mergeEntries =
<abbr title="  81              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)),">  81              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustðŸ”µ</abbr>
  82          @AdminPresentationMergeOverride(name = &quot;auditable.createdBy&quot;, mergeEntries =
<abbr title="  83              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)),">  83              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustðŸ”µ</abbr>
  84          @AdminPresentationMergeOverride(name = &quot;auditable.dateUpdated&quot;, mergeEntries =
<abbr title="  85              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)),">  85              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustðŸ”µ</abbr>
  86          @AdminPresentationMergeOverride(name = &quot;auditable.updatedBy&quot;, mergeEntries =
<abbr title="  87              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit))">  87              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustðŸ”µ</abbr>
  88      }
  89  )
  90  @DirectCopyTransform({
  91          @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.PREVIEW),
  92          @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.MULTITENANT_SITE),
  93          @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.ARCHIVE_ONLY)
  94  })
  95  public class CustomerImpl implements Customer, AdminMainEntity, Previewable, CustomerAdminPresentation {
  96  
  97      private static final long serialVersionUID = 1L;
  98  
  99      @Id
 100      @Column(name = &quot;CUSTOMER_ID&quot;)
 101      @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Id&quot;, visibility = VisibilityEnum.HIDDEN_ALL)
 102      protected Long id;
 103  
 104      @Embedded
 105      protected Auditable auditable = new Auditable();
 106  
 107      @Embedded
 108      protected PreviewStatus previewable = new PreviewStatus();
 109  
 110      @Column(name = &quot;USER_NAME&quot;)
 111      @AdminPresentation(friendlyName = &quot;CustomerImpl_UserName&quot;,
 112              group = GroupName.Customer, order = FieldOrder.USERNAME,
 113              requiredOverride = RequiredOverride.REQUIRED)
 114      protected String username;
 115  
 116      @Column(name = &quot;PASSWORD&quot;)
 117      @AdminPresentation(excluded = true)
 118      @AuditExcludeFieldValue
 119      protected String password;
 120  
 121      @Column(name = &quot;EMAIL_ADDRESS&quot;)
 122      @Index(name = &quot;CUSTOMER_EMAIL_INDEX&quot;, columnNames = { &quot;EMAIL_ADDRESS&quot; })
 123      @AdminPresentation(friendlyName = &quot;CustomerImpl_Email_Address&quot;,
 124              group = GroupName.Customer, order = FieldOrder.EMAIL,
 125              prominent = true, gridOrder = 1000)
 126      protected String emailAddress;
 127  
 128      @Column(name = &quot;FIRST_NAME&quot;)
 129      @AdminPresentation(friendlyName = &quot;CustomerImpl_First_Name&quot;,
 130              group = GroupName.Customer, order = FieldOrder.FIRST_NAME,
 131              prominent = true, gridOrder = 2000)
 132      protected String firstName;
 133  
 134      @Column(name = &quot;LAST_NAME&quot;)
 135      @AdminPresentation(friendlyName = &quot;CustomerImpl_Last_Name&quot;,
 136              group = GroupName.Customer, order = FieldOrder.LAST_NAME,
 137              prominent = true, gridOrder = 3000)
 138      protected String lastName;
 139  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 140 +    @Column(name = &quot;EXTERNAL_ID&quot;)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +    @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_ExternalId&quot;,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +            group = GroupName.Customer, order = FieldOrder.EXTERNAL_ID,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +            visibility = VisibilityEnum.GRID_HIDDEN)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +    protected String externalId;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +</span>
 146      @ManyToOne(targetEntity = ChallengeQuestionImpl.class)

 147      @JoinColumn(name = &quot;CHALLENGE_QUESTION_ID&quot;)
 148      @Index(name = &quot;CUSTOMER_CHALLENGE_INDEX&quot;, columnNames = { &quot;CHALLENGE_QUESTION_ID&quot; })
 149      @AdminPresentation(friendlyName = &quot;CustomerImpl_Challenge_Question&quot;,
 150              excluded = true)
 151      protected ChallengeQuestion challengeQuestion;
 152  
 153      @Column(name = &quot;CHALLENGE_ANSWER&quot;)
 154      @AdminPresentation(friendlyName = &quot;CustomerImpl_Challenge_Answer&quot;,
 155              excluded = true)
 156      protected String challengeAnswer;
 157  
 158      /**
 159       * &lt;p&gt;
 160       *     If true, this customer must go through a reset password flow.
 161       * &lt;/p&gt;
 162       * &lt;p&gt;
 163       *     During a site conversion or security breach or a matter of routine security policy,
 164       *     it may be necessary to require users to change their password. This property will
 165       *     not allow a user whose credentials are managed within Broadleaf to login until
 166       *     they have reset their password.
 167       * &lt;/p&gt;
 168       * &lt;p&gt;
 169       *     Used by blUserDetailsService.
 170       * &lt;/p&gt;
 171       */
 172      @Column(name = &quot;PASSWORD_CHANGE_REQUIRED&quot;)
 173      @AdminPresentation(excluded = true)
 174      protected Boolean passwordChangeRequired = false;
 175  
 176      @Column(name = &quot;RECEIVE_EMAIL&quot;)
 177      @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Receive_Email&quot;,
 178              group = GroupName.QualificationOptions, order = FieldOrder.RECIEVE_EMAIL)
 179      protected Boolean receiveEmail = false;
 180  
 181      @Column(name = &quot;IS_REGISTERED&quot;)
 182      @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Registered&quot;,
 183              group = GroupName.QualificationOptions, order = FieldOrder.REGISTERED,
 184              prominent = true, gridOrder = 4000)
 185      protected Boolean registered = false;
 186  
 187      @Column(name = &quot;DEACTIVATED&quot;)
 188      @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Deactivated&quot;,
 189              group = GroupName.QualificationOptions, order = FieldOrder.DEACTIVATED)
 190      protected Boolean deactivated = false;
 191  
 192      @ManyToOne(targetEntity = LocaleImpl.class)
 193      @JoinColumn(name = &quot;LOCALE_CODE&quot;)
 194      @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Locale&quot;,
 195          excluded = true, visibility = VisibilityEnum.GRID_HIDDEN)
 196      protected Locale customerLocale;
 197  
<abbr title=" 198      @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAttributeImpl.class, cascade = { CascadeType.ALL }, orphanRemoval = true)"> 198      @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAttributeImpl.class, cascade = { CascadeType.ALL }, oðŸ”µ</abbr>
 199      @Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE, region = &quot;blStandardElements&quot;)
 200      @MapKey(name = &quot;name&quot;)
 201      @BatchSize(size = 50)
 202      @AdminPresentationMap(friendlyName = &quot;CustomerAttributeImpl_Attribute_Name&quot;,
 203              tab = CustomerAdminPresentation.TabName.General,
 204              deleteEntityUponRemove = true, forceFreeFormKeys = true,
 205              keyPropertyFriendlyName = &quot;ProductAttributeImpl_Attribute_Name&quot;)
 206      protected Map&lt;String, CustomerAttribute&gt; customerAttributes = new HashMap&lt;&gt;();
 207  
 208      @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAddressImpl.class, cascade = { CascadeType.ALL })
<abbr title=" 209      @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPHAN })"> 209      @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPðŸ”µ</abbr>
 210      @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 211      @Where(clause = &quot;archived != &#x27;Y&#x27;&quot;)
 212      @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Addresses&quot;,
 213              group = GroupName.ContactInfo, order = FieldOrder.ADDRESSES,
 214              addType = AddMethodType.PERSIST)
 215      protected List&lt;CustomerAddress&gt; customerAddresses = new ArrayList&lt;&gt;();
 216  
 217      @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPhoneImpl.class, cascade = { CascadeType.ALL })
<abbr title=" 218      @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPHAN })"> 218      @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPðŸ”µ</abbr>
 219      @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 220      @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Phones&quot;,
 221              group = GroupName.ContactInfo, order = FieldOrder.PHONES,
 222              addType = AddMethodType.PERSIST)
 223      protected List&lt;CustomerPhone&gt; customerPhones = new ArrayList&lt;&gt;();
 224  
 225      @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPaymentImpl.class, cascade = { CascadeType.ALL })
<abbr title=" 226      @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPHAN })"> 226      @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPðŸ”µ</abbr>
 227      @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 228      @BatchSize(size = 50)
 229      @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Payments&quot;,
 230              tab = TabName.PaymentMethods, order = 1000,
 231              addType = AddMethodType.PERSIST,
 232              readOnly = true)
 233      protected List&lt;CustomerPayment&gt; customerPayments = new ArrayList&lt;&gt;();
 234  
 235      @Column(name = &quot;IS_TAX_EXEMPT&quot;)
 236      @AdminPresentation(friendlyName = &quot;CustomerImpl_Is_Tax_Exempt&quot;,
 237              group = GroupName.Pricing, order = FieldOrder.IS_TAX_EXEMPT,
 238              defaultValue = &quot;false&quot;)
 239      protected Boolean isTaxExempt = false;
 240  
 241      @Column(name = &quot;TAX_EXEMPTION_CODE&quot;)
 242      @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_TaxExemptCode&quot;,
 243              group = GroupName.Pricing, order = FieldOrder.TAX_EXEMPTION_CODE,
 244              visibility = VisibilityEnum.GRID_HIDDEN)
 245      protected String taxExemptionCode;
 246  
 247      @Transient
 248      protected String unencodedPassword;
 249  
 250      @Transient
 251      protected String unencodedChallengeAnswer;
 252  
 253      @Transient
 254      protected boolean anonymous;
 255  
 256      @Transient
 257      protected boolean cookied;
 258  
 259      @Transient
 260      protected boolean loggedIn;
 261  
 262      @Transient
 263      protected Map&lt;String, Object&gt; transientProperties = new HashMap&lt;String, Object&gt;();
 264  
 265      @Override
 266      public Long getId() {
 267          return id;
 268      }
 269  
 270      @Override
 271      public void setId(Long id) {
 272          this.id = id;
 273      }
 274  
 275      @Override
 276      public String getUsername() {
 277          return username;
 278      }
 279  
 280      @Override
 281      public void setUsername(String username) {
 282          this.username = username;
 283      }
 284  
 285      @Override
 286      public String getPassword() {
 287          return password;
 288      }
 289  
 290      @Override
 291      public void setPassword(String password) {
 292          this.password = password;
 293      }
 294  
 295      @Override
 296      public boolean isPasswordChangeRequired() {
 297          return BooleanUtils.toBoolean(passwordChangeRequired);
 298      }
 299  
 300      @Override
 301      public void setPasswordChangeRequired(boolean passwordChangeRequired) {
 302          this.passwordChangeRequired = Boolean.valueOf(passwordChangeRequired);
 303      }
 304  
 305      @Override
 306      public String getFirstName() {
 307          return firstName;
 308      }
 309  
 310      @Override
 311      public void setFirstName(String firstName) {
 312          this.firstName = firstName;
 313      }
 314  
 315      @Override
 316      public String getLastName() {
 317          return lastName;
 318      }
 319  
 320      @Override
 321      public void setLastName(String lastName) {
 322          this.lastName = lastName;
 323      }
 324  
 325      @Override
 326      public String getEmailAddress() {
 327          return emailAddress;
 328      }
 329  
 330      @Override
 331      public void setEmailAddress(String emailAddress) {
 332          this.emailAddress = emailAddress;
 333      }
 334  
 335      @Override
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 336 +    public String getExternalId() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 337 +        return externalId;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 338 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 339 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 340 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 341 +    public void setExternalId(String externalId) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 342 +        this.externalId = externalId;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 343 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 344 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 345 +    @Override</span>
 346      public ChallengeQuestion getChallengeQuestion() {
 347          return challengeQuestion;
 348      }
 349  
 350      @Override
 351      public void setChallengeQuestion(ChallengeQuestion challengeQuestion) {
 352          this.challengeQuestion = challengeQuestion;
 353      }
 354  
 355      @Override
 356      public String getChallengeAnswer() {
 357          return challengeAnswer;
 358      }
 359  
 360      @Override
 361      public void setChallengeAnswer(String challengeAnswer) {
 362          this.challengeAnswer = challengeAnswer;
 363      }
 364  
 365      @Override
 366      public String getUnencodedPassword() {
 367          return unencodedPassword;
 368      }
 369  
 370      @Override
 371      public void setUnencodedPassword(String unencodedPassword) {
 372          this.unencodedPassword = unencodedPassword;
 373      }
 374  
 375      @Override
 376      public boolean isReceiveEmail() {
 377          return BooleanUtils.toBoolean(receiveEmail);
 378      }
 379  
 380      @Override
 381      public void setReceiveEmail(boolean receiveEmail) {
 382          this.receiveEmail = Boolean.valueOf(receiveEmail);
 383      }
 384  
 385      @Override
 386      public boolean isRegistered() {
 387          return BooleanUtils.toBoolean(registered);
 388      }
 389  
 390      @Override
 391      public void setRegistered(boolean registered) {
 392          this.registered = Boolean.valueOf(registered);
 393      }
 394  
 395      @Override
 396      public String getUnencodedChallengeAnswer() {
 397          return unencodedChallengeAnswer;
 398      }
 399  
 400      @Override
 401      public void setUnencodedChallengeAnswer(String unencodedChallengeAnswer) {
 402          this.unencodedChallengeAnswer = unencodedChallengeAnswer;
 403      }
 404  
 405      @Override
 406      public Auditable getAuditable() {
 407          return auditable;
 408      }
 409  
 410      @Override
 411      public void setAuditable(Auditable auditable) {
 412          this.auditable = auditable;
 413      }
 414  
 415      @Override
 416      public boolean isAnonymous() {
 417          return anonymous;
 418      }
 419  
 420      @Override
 421      public boolean isCookied() {
 422          return cookied;
 423      }
 424  
 425      @Override
 426      public boolean isLoggedIn() {
 427          return loggedIn;
 428      }
 429  
 430      @Override
 431      public void setAnonymous(boolean anonymous) {
 432          this.anonymous = anonymous;
 433          if (anonymous) {
 434              cookied = false;
 435              loggedIn = false;
 436          }
 437      }
 438  
 439      @Override
 440      public void setCookied(boolean cookied) {
 441          this.cookied = cookied;
 442          if (cookied) {
 443              anonymous = false;
 444              loggedIn = false;
 445          }
 446      }
 447  
 448      @Override
 449      public void setLoggedIn(boolean loggedIn) {
 450          this.loggedIn = loggedIn;
 451          if (loggedIn) {
 452              anonymous = false;
 453              cookied = false;
 454          }
 455      }
 456  
 457      @Override
 458      public Locale getCustomerLocale() {
 459          return customerLocale;
 460      }
 461  
 462      @Override
 463      public void setCustomerLocale(Locale customerLocale) {
 464          this.customerLocale = customerLocale;
 465      }
 466  
 467      @Override
 468      public Map&lt;String, CustomerAttribute&gt; getCustomerAttributes() {
 469          return customerAttributes;
 470      }
 471  
 472      @Override
 473      public void setCustomerAttributes(Map&lt;String, CustomerAttribute&gt; customerAttributes) {
 474          this.customerAttributes = customerAttributes;
 475      }
 476  
 477      @Override
 478      public boolean isDeactivated() {
 479          return BooleanUtils.toBoolean(deactivated);
 480      }
 481  
 482      @Override
 483      public void setDeactivated(boolean deactivated) {
 484          this.deactivated = Boolean.valueOf(deactivated);
 485      }
 486  
 487      @Override
 488      public List&lt;CustomerAddress&gt; getCustomerAddresses() {
 489          return customerAddresses;
 490      }
 491  
 492      @Override
 493      public void setCustomerAddresses(List&lt;CustomerAddress&gt; customerAddresses) {
 494          this.customerAddresses = customerAddresses;
 495      }
 496  
 497      @Override
 498      public List&lt;CustomerPhone&gt; getCustomerPhones() {
 499          return customerPhones;
 500      }
 501  
 502      @Override
 503      public void setCustomerPhones(List&lt;CustomerPhone&gt; customerPhones) {
 504          this.customerPhones = customerPhones;
 505      }
 506  
 507      @Override
 508      public List&lt;CustomerPayment&gt; getCustomerPayments() {
 509          return customerPayments;
 510      }
 511  
 512      @Override
 513      public void setCustomerPayments(List&lt;CustomerPayment&gt; customerPayments) {
 514          this.customerPayments = customerPayments;
 515      }
 516  
 517      @Override
 518      public String getMainEntityName() {
 519          if (!StringUtils.isEmpty(getFirstName()) &amp;&amp; !StringUtils.isEmpty(getLastName())) {
 520              return getFirstName() + &quot; &quot; + getLastName();
 521          }
 522          if (!StringUtils.isEmpty(getUsername())) {
 523              return getUsername();
 524          }
 525          return String.valueOf(getId());
 526      }
 527  
 528      @Override
 529      public Boolean getPreview() {
 530          if (previewable == null) {
 531              previewable = new PreviewStatus();
 532          }
 533          return previewable.getPreview();
 534      }
 535  
 536      @Override
 537      public void setPreview(Boolean preview) {
 538          if (previewable == null) {
 539              previewable = new PreviewStatus();
 540          }
 541          previewable.setPreview(preview);
 542      }
 543  
 544      @Override
 545      public Map&lt;String, Object&gt; getTransientProperties() {
 546          return transientProperties;
 547      }
 548  
 549      @Override
 550      public boolean equals(Object obj) {
 551          if (this == obj) {
 552              return true;
 553          }
 554          if (obj == null) {
 555              return false;
 556          }
 557          if (!getClass().isAssignableFrom(obj.getClass())) {
 558              return false;
 559          }
 560          CustomerImpl other = (CustomerImpl) obj;
 561  
 562          if (id != null &amp;&amp; other.id != null) {
 563              return id.equals(other.id);
 564          }
 565  
 566          if (username == null) {
 567              if (other.username != null) {
 568                  return false;
 569              }
 570          } else if (!username.equals(other.username)) {
 571              return false;
 572          }
 573          return true;
 574      }
 575  
 576      @Override
 577      public int hashCode() {
 578          final int prime = 31;
 579          int result = 1;
 580          result = prime * result + ((username == null) ? 0 : username.hashCode());
 581          return result;
 582      }
 583  
 584      @Override
<abbr title=" 585      public &lt;G extends Customer&gt; CreateResponse&lt;G&gt; createOrRetrieveCopyInstance(MultiTenantCopyContext context) throws CloneNotSupportedException {"> 585      public &lt;G extends Customer&gt; CreateResponse&lt;G&gt; createOrRetrieveCopyInstance(MultiTenantCopyContext context) thrðŸ”µ</abbr>
 586          CreateResponse&lt;G&gt; createResponse = context.createOrRetrieveCopyInstance(this);
 587          if (createResponse.isAlreadyPopulated()) {
 588              return createResponse;
 589          }
 590          Customer cloned = createResponse.getClone();
 591          cloned.setAnonymous(anonymous);
 592          cloned.setChallengeAnswer(challengeAnswer);
 593          cloned.setChallengeQuestion(challengeQuestion);
 594          cloned.setCookied(cookied);
 595          for (CustomerAddress entry : customerAddresses) {
 596              CustomerAddress clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 597              clonedEntry.setCustomer(cloned);
 598              cloned.getCustomerAddresses().add(clonedEntry);
 599  
 600          }
 601          for (Map.Entry&lt;String, CustomerAttribute&gt; entry : customerAttributes.entrySet()) {
 602              CustomerAttribute clonedEntry = entry.getValue().createOrRetrieveCopyInstance(context).getClone();
 603              clonedEntry.setCustomer(cloned);
 604              cloned.getCustomerAttributes().put(entry.getKey(), clonedEntry);
 605          }
 606          cloned.setLoggedIn(loggedIn);
 607          cloned.setUsername(username);
 608          cloned.setUnencodedPassword(unencodedPassword);
 609          cloned.setTaxExemptionCode(taxExemptionCode);
 610          cloned.setUnencodedChallengeAnswer(unencodedChallengeAnswer);
 611          cloned.setRegistered(registered);
 612          cloned.setReceiveEmail(receiveEmail);
 613          cloned.setPasswordChangeRequired(passwordChangeRequired);
 614          cloned.setPassword(password);
 615          cloned.setLastName(lastName);
 616          cloned.setFirstName(firstName);
 617          cloned.setEmailAddress(emailAddress);
 618          cloned.setDeactivated(deactivated);
 619          for (CustomerPayment entry : customerPayments) {
 620              CustomerPayment clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 621              clonedEntry.setCustomer(cloned);
 622              cloned.getCustomerPayments().add(clonedEntry);
 623          }
 624          for (CustomerPhone entry : customerPhones) {
 625              CustomerPhone clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 626              clonedEntry.setCustomer(cloned);
 627              cloned.getCustomerPhones().add(clonedEntry);
 628          }
 629          return createResponse;
 630      }
 631  
 632      @Override
 633      public String getTaxExemptionCode() {
 634          return this.taxExemptionCode;
 635      }
 636  
 637      @Override
 638      public void setTaxExemptionCode(String exemption) {
 639          this.taxExemptionCode = exemption;
 640  
 641          if (exemption != null) {
 642              this.isTaxExempt = true;
 643          }
 644      }
 645  
 646      @Override
 647      public boolean isTaxExempt() {
 648          return isTaxExempt != null &amp;&amp; isTaxExempt != false &amp;&amp;  StringUtils.isNotEmpty(taxExemptionCode);
 649      }
 650  
 651  }</pre></td>
                            <td><pre>   1  /*
   2   * #%L
   3   * BroadleafCommerce Profile
   4   * %%
   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6   * %%
   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10   * the Broadleaf End User License Agreement (EULA), Version 1.1
  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12   * shall apply.
  13   *
<abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr>
  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.
  16   * #L%
  17   */
  18  
  19  package org.broadleafcommerce.profile.core.domain;
  20  
  21  import org.apache.commons.lang3.BooleanUtils;
  22  import org.apache.commons.lang3.StringUtils;
  23  import org.broadleafcommerce.common.admin.domain.AdminMainEntity;
  24  import org.broadleafcommerce.common.audit.Auditable;
  25  import org.broadleafcommerce.common.audit.AuditableListener;
  26  import org.broadleafcommerce.common.audit.AuditExcludeFieldValue;
  27  import org.broadleafcommerce.common.copy.CreateResponse;
  28  import org.broadleafcommerce.common.copy.MultiTenantCopyContext;
  29  import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransform;
  30  import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransformMember;
  31  import org.broadleafcommerce.common.extensibility.jpa.copy.DirectCopyTransformTypes;
  32  import org.broadleafcommerce.common.locale.domain.Locale;
  33  import org.broadleafcommerce.common.locale.domain.LocaleImpl;
  34  import org.broadleafcommerce.common.persistence.PreviewStatus;
  35  import org.broadleafcommerce.common.persistence.Previewable;
  36  import org.broadleafcommerce.common.presentation.AdminPresentation;
  37  import org.broadleafcommerce.common.presentation.AdminPresentationCollection;
  38  import org.broadleafcommerce.common.presentation.AdminPresentationMap;
  39  import org.broadleafcommerce.common.presentation.RequiredOverride;
  40  import org.broadleafcommerce.common.presentation.client.AddMethodType;
  41  import org.broadleafcommerce.common.presentation.client.VisibilityEnum;
  42  import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeEntry;
  43  import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeOverride;
  44  import org.broadleafcommerce.common.presentation.override.AdminPresentationMergeOverrides;
  45  import org.broadleafcommerce.common.presentation.override.PropertyType;
  46  import org.hibernate.annotations.BatchSize;
  47  import org.hibernate.annotations.Cache;
  48  import org.hibernate.annotations.CacheConcurrencyStrategy;
  49  import org.hibernate.annotations.Cascade;
  50  import org.hibernate.annotations.Index;
  51  import org.hibernate.annotations.Where;
  52  
  53  import java.util.ArrayList;
  54  import java.util.HashMap;
  55  import java.util.List;
  56  import java.util.Map;
  57  
  58  import javax.persistence.CascadeType;
  59  import javax.persistence.Column;
  60  import javax.persistence.Embedded;
  61  import javax.persistence.Entity;
  62  import javax.persistence.EntityListeners;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  63 +import javax.persistence.FetchType;</span>
  64  import javax.persistence.Id;
  65  import javax.persistence.Inheritance;
  66  import javax.persistence.InheritanceType;
  67  import javax.persistence.JoinColumn;
  68  import javax.persistence.ManyToOne;
  69  import javax.persistence.MapKey;
  70  import javax.persistence.OneToMany;
  71  import javax.persistence.Table;
  72  import javax.persistence.Transient;
  73  
  74  @Entity
  75  @EntityListeners(value = { AuditableListener.class, CustomerPersistedEntityListener.class })
  76  @Inheritance(strategy = InheritanceType.JOINED)
  77  @Table(name = &quot;BLC_CUSTOMER&quot;)
  78  @Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE, region = &quot;blCustomerElements&quot;)
  79  @AdminPresentationMergeOverrides(
  80      {
  81          @AdminPresentationMergeOverride(name = &quot;auditable.dateCreated&quot;, mergeEntries =
<abbr title="  82              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)),">  82              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustðŸ”µ</abbr>
  83          @AdminPresentationMergeOverride(name = &quot;auditable.createdBy&quot;, mergeEntries =
<abbr title="  84              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)),">  84              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustðŸ”µ</abbr>
  85          @AdminPresentationMergeOverride(name = &quot;auditable.dateUpdated&quot;, mergeEntries =
<abbr title="  86              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit)),">  86              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustðŸ”µ</abbr>
  87          @AdminPresentationMergeOverride(name = &quot;auditable.updatedBy&quot;, mergeEntries =
<abbr title="  88              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustomerAdminPresentation.GroupName.Audit))">  88              @AdminPresentationMergeEntry(propertyType = PropertyType.AdminPresentation.GROUP, overrideValue = CustðŸ”µ</abbr>
  89      }
  90  )
  91  @DirectCopyTransform({
  92          @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.PREVIEW),
  93          @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.MULTITENANT_SITE),
  94          @DirectCopyTransformMember(templateTokens = DirectCopyTransformTypes.ARCHIVE_ONLY)
  95  })
  96  public class CustomerImpl implements Customer, AdminMainEntity, Previewable, CustomerAdminPresentation {
  97  
  98      private static final long serialVersionUID = 1L;
  99  
 100      @Id
 101      @Column(name = &quot;CUSTOMER_ID&quot;)
 102      @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Id&quot;, visibility = VisibilityEnum.HIDDEN_ALL)
 103      protected Long id;
 104  
 105      @Embedded
 106      protected Auditable auditable = new Auditable();
 107  
 108      @Embedded
 109      protected PreviewStatus previewable = new PreviewStatus();
 110  
 111      @Column(name = &quot;USER_NAME&quot;)
 112      @AdminPresentation(friendlyName = &quot;CustomerImpl_UserName&quot;,
 113              group = GroupName.Customer, order = FieldOrder.USERNAME,
 114              requiredOverride = RequiredOverride.REQUIRED)
 115      protected String username;
 116  
 117      @Column(name = &quot;PASSWORD&quot;)
 118      @AdminPresentation(excluded = true)
 119      @AuditExcludeFieldValue
 120      protected String password;
 121  
 122      @Column(name = &quot;EMAIL_ADDRESS&quot;)
 123      @Index(name = &quot;CUSTOMER_EMAIL_INDEX&quot;, columnNames = { &quot;EMAIL_ADDRESS&quot; })
 124      @AdminPresentation(friendlyName = &quot;CustomerImpl_Email_Address&quot;,
 125              group = GroupName.Customer, order = FieldOrder.EMAIL,
 126              prominent = true, gridOrder = 1000)
 127      protected String emailAddress;
 128  
 129      @Column(name = &quot;FIRST_NAME&quot;)
 130      @AdminPresentation(friendlyName = &quot;CustomerImpl_First_Name&quot;,
 131              group = GroupName.Customer, order = FieldOrder.FIRST_NAME,
 132              prominent = true, gridOrder = 2000)
 133      protected String firstName;
 134  
 135      @Column(name = &quot;LAST_NAME&quot;)
 136      @AdminPresentation(friendlyName = &quot;CustomerImpl_Last_Name&quot;,
 137              group = GroupName.Customer, order = FieldOrder.LAST_NAME,
 138              prominent = true, gridOrder = 3000)
 139      protected String lastName;
 140  






<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 141 -    @ManyToOne(targetEntity = ChallengeQuestionImpl.class)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +    @ManyToOne(targetEntity = ChallengeQuestionImpl.class, fetch = FetchType.LAZY)</span>
 143      @JoinColumn(name = &quot;CHALLENGE_QUESTION_ID&quot;)
 144      @Index(name = &quot;CUSTOMER_CHALLENGE_INDEX&quot;, columnNames = { &quot;CHALLENGE_QUESTION_ID&quot; })
 145      @AdminPresentation(friendlyName = &quot;CustomerImpl_Challenge_Question&quot;,
 146              excluded = true)
 147      protected ChallengeQuestion challengeQuestion;
 148  
 149      @Column(name = &quot;CHALLENGE_ANSWER&quot;)
 150      @AdminPresentation(friendlyName = &quot;CustomerImpl_Challenge_Answer&quot;,
 151              excluded = true)
 152      protected String challengeAnswer;
 153  
 154      /**
 155       * &lt;p&gt;
 156       *     If true, this customer must go through a reset password flow.
 157       * &lt;/p&gt;
 158       * &lt;p&gt;
 159       *     During a site conversion or security breach or a matter of routine security policy,
 160       *     it may be necessary to require users to change their password. This property will
 161       *     not allow a user whose credentials are managed within Broadleaf to login until
 162       *     they have reset their password.
 163       * &lt;/p&gt;
 164       * &lt;p&gt;
 165       *     Used by blUserDetailsService.
 166       * &lt;/p&gt;
 167       */
 168      @Column(name = &quot;PASSWORD_CHANGE_REQUIRED&quot;)
 169      @AdminPresentation(excluded = true)
 170      protected Boolean passwordChangeRequired = false;
 171  
 172      @Column(name = &quot;RECEIVE_EMAIL&quot;)
 173      @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Receive_Email&quot;,
 174              group = GroupName.QualificationOptions, order = FieldOrder.RECIEVE_EMAIL)
 175      protected Boolean receiveEmail = false;
 176  
 177      @Column(name = &quot;IS_REGISTERED&quot;)
 178      @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Registered&quot;,
 179              group = GroupName.QualificationOptions, order = FieldOrder.REGISTERED,
 180              prominent = true, gridOrder = 4000)
 181      protected Boolean registered = false;
 182  
 183      @Column(name = &quot;DEACTIVATED&quot;)
 184      @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Deactivated&quot;,
 185              group = GroupName.QualificationOptions, order = FieldOrder.DEACTIVATED)
 186      protected Boolean deactivated = false;
 187  
 188      @ManyToOne(targetEntity = LocaleImpl.class)
 189      @JoinColumn(name = &quot;LOCALE_CODE&quot;)
 190      @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_Locale&quot;,
 191          excluded = true, visibility = VisibilityEnum.GRID_HIDDEN)
 192      protected Locale customerLocale;
 193  
<abbr title=" 194      @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAttributeImpl.class, cascade = { CascadeType.ALL }, orphanRemoval = true)"> 194      @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAttributeImpl.class, cascade = { CascadeType.ALL }, oðŸ”µ</abbr>
 195      @Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE, region = &quot;blStandardElements&quot;)
 196      @MapKey(name = &quot;name&quot;)
 197      @BatchSize(size = 50)
 198      @AdminPresentationMap(friendlyName = &quot;CustomerAttributeImpl_Attribute_Name&quot;,
 199              tab = CustomerAdminPresentation.TabName.General,
 200              deleteEntityUponRemove = true, forceFreeFormKeys = true,
 201              keyPropertyFriendlyName = &quot;ProductAttributeImpl_Attribute_Name&quot;)
 202      protected Map&lt;String, CustomerAttribute&gt; customerAttributes = new HashMap&lt;&gt;();
 203  
 204      @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerAddressImpl.class, cascade = { CascadeType.ALL })
<abbr title=" 205      @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPHAN })"> 205      @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPðŸ”µ</abbr>
 206      @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 207      @Where(clause = &quot;archived != &#x27;Y&#x27;&quot;)
 208      @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Addresses&quot;,
 209              group = GroupName.ContactInfo, order = FieldOrder.ADDRESSES,
 210              addType = AddMethodType.PERSIST)
 211      protected List&lt;CustomerAddress&gt; customerAddresses = new ArrayList&lt;&gt;();
 212  
 213      @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPhoneImpl.class, cascade = { CascadeType.ALL })
<abbr title=" 214      @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPHAN })"> 214      @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPðŸ”µ</abbr>
 215      @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 216      @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Phones&quot;,
 217              group = GroupName.ContactInfo, order = FieldOrder.PHONES,
 218              addType = AddMethodType.PERSIST)
 219      protected List&lt;CustomerPhone&gt; customerPhones = new ArrayList&lt;&gt;();
 220  
 221      @OneToMany(mappedBy = &quot;customer&quot;, targetEntity = CustomerPaymentImpl.class, cascade = { CascadeType.ALL })
<abbr title=" 222      @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPHAN })"> 222      @Cascade(value = { org.hibernate.annotations.CascadeType.ALL, org.hibernate.annotations.CascadeType.DELETE_ORPðŸ”µ</abbr>
 223      @Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = &quot;blStandardElements&quot;)
 224      @BatchSize(size = 50)
 225      @AdminPresentationCollection(friendlyName = &quot;CustomerImpl_Customer_Payments&quot;,
 226              tab = TabName.PaymentMethods, order = 1000,
 227              addType = AddMethodType.PERSIST,
 228              readOnly = true)
 229      protected List&lt;CustomerPayment&gt; customerPayments = new ArrayList&lt;&gt;();
 230  
 231      @Column(name = &quot;IS_TAX_EXEMPT&quot;)
 232      @AdminPresentation(friendlyName = &quot;CustomerImpl_Is_Tax_Exempt&quot;,
 233              group = GroupName.Pricing, order = FieldOrder.IS_TAX_EXEMPT,
 234              defaultValue = &quot;false&quot;)
 235      protected Boolean isTaxExempt = false;
 236  
 237      @Column(name = &quot;TAX_EXEMPTION_CODE&quot;)
 238      @AdminPresentation(friendlyName = &quot;CustomerImpl_Customer_TaxExemptCode&quot;,
 239              group = GroupName.Pricing, order = FieldOrder.TAX_EXEMPTION_CODE,
 240              visibility = VisibilityEnum.GRID_HIDDEN)
 241      protected String taxExemptionCode;
 242  
 243      @Transient
 244      protected String unencodedPassword;
 245  
 246      @Transient
 247      protected String unencodedChallengeAnswer;
 248  
 249      @Transient
 250      protected boolean anonymous;
 251  
 252      @Transient
 253      protected boolean cookied;
 254  
 255      @Transient
 256      protected boolean loggedIn;
 257  
 258      @Transient
 259      protected Map&lt;String, Object&gt; transientProperties = new HashMap&lt;String, Object&gt;();
 260  
 261      @Override
 262      public Long getId() {
 263          return id;
 264      }
 265  
 266      @Override
 267      public void setId(Long id) {
 268          this.id = id;
 269      }
 270  
 271      @Override
 272      public String getUsername() {
 273          return username;
 274      }
 275  
 276      @Override
 277      public void setUsername(String username) {
 278          this.username = username;
 279      }
 280  
 281      @Override
 282      public String getPassword() {
 283          return password;
 284      }
 285  
 286      @Override
 287      public void setPassword(String password) {
 288          this.password = password;
 289      }
 290  
 291      @Override
 292      public boolean isPasswordChangeRequired() {
 293          return BooleanUtils.toBoolean(passwordChangeRequired);
 294      }
 295  
 296      @Override
 297      public void setPasswordChangeRequired(boolean passwordChangeRequired) {
 298          this.passwordChangeRequired = Boolean.valueOf(passwordChangeRequired);
 299      }
 300  
 301      @Override
 302      public String getFirstName() {
 303          return firstName;
 304      }
 305  
 306      @Override
 307      public void setFirstName(String firstName) {
 308          this.firstName = firstName;
 309      }
 310  
 311      @Override
 312      public String getLastName() {
 313          return lastName;
 314      }
 315  
 316      @Override
 317      public void setLastName(String lastName) {
 318          this.lastName = lastName;
 319      }
 320  
 321      @Override
 322      public String getEmailAddress() {
 323          return emailAddress;
 324      }
 325  
 326      @Override
 327      public void setEmailAddress(String emailAddress) {
 328          this.emailAddress = emailAddress;
 329      }
 330  
 331      @Override










 332      public ChallengeQuestion getChallengeQuestion() {
 333          return challengeQuestion;
 334      }
 335  
 336      @Override
 337      public void setChallengeQuestion(ChallengeQuestion challengeQuestion) {
 338          this.challengeQuestion = challengeQuestion;
 339      }
 340  
 341      @Override
 342      public String getChallengeAnswer() {
 343          return challengeAnswer;
 344      }
 345  
 346      @Override
 347      public void setChallengeAnswer(String challengeAnswer) {
 348          this.challengeAnswer = challengeAnswer;
 349      }
 350  
 351      @Override
 352      public String getUnencodedPassword() {
 353          return unencodedPassword;
 354      }
 355  
 356      @Override
 357      public void setUnencodedPassword(String unencodedPassword) {
 358          this.unencodedPassword = unencodedPassword;
 359      }
 360  
 361      @Override
 362      public boolean isReceiveEmail() {
 363          return BooleanUtils.toBoolean(receiveEmail);
 364      }
 365  
 366      @Override
 367      public void setReceiveEmail(boolean receiveEmail) {
 368          this.receiveEmail = Boolean.valueOf(receiveEmail);
 369      }
 370  
 371      @Override
 372      public boolean isRegistered() {
 373          return BooleanUtils.toBoolean(registered);
 374      }
 375  
 376      @Override
 377      public void setRegistered(boolean registered) {
 378          this.registered = Boolean.valueOf(registered);
 379      }
 380  
 381      @Override
 382      public String getUnencodedChallengeAnswer() {
 383          return unencodedChallengeAnswer;
 384      }
 385  
 386      @Override
 387      public void setUnencodedChallengeAnswer(String unencodedChallengeAnswer) {
 388          this.unencodedChallengeAnswer = unencodedChallengeAnswer;
 389      }
 390  
 391      @Override
 392      public Auditable getAuditable() {
 393          return auditable;
 394      }
 395  
 396      @Override
 397      public void setAuditable(Auditable auditable) {
 398          this.auditable = auditable;
 399      }
 400  
 401      @Override
 402      public boolean isAnonymous() {
 403          return anonymous;
 404      }
 405  
 406      @Override
 407      public boolean isCookied() {
 408          return cookied;
 409      }
 410  
 411      @Override
 412      public boolean isLoggedIn() {
 413          return loggedIn;
 414      }
 415  
 416      @Override
 417      public void setAnonymous(boolean anonymous) {
 418          this.anonymous = anonymous;
 419          if (anonymous) {
 420              cookied = false;
 421              loggedIn = false;
 422          }
 423      }
 424  
 425      @Override
 426      public void setCookied(boolean cookied) {
 427          this.cookied = cookied;
 428          if (cookied) {
 429              anonymous = false;
 430              loggedIn = false;
 431          }
 432      }
 433  
 434      @Override
 435      public void setLoggedIn(boolean loggedIn) {
 436          this.loggedIn = loggedIn;
 437          if (loggedIn) {
 438              anonymous = false;
 439              cookied = false;
 440          }
 441      }
 442  
 443      @Override
 444      public Locale getCustomerLocale() {
 445          return customerLocale;
 446      }
 447  
 448      @Override
 449      public void setCustomerLocale(Locale customerLocale) {
 450          this.customerLocale = customerLocale;
 451      }
 452  
 453      @Override
 454      public Map&lt;String, CustomerAttribute&gt; getCustomerAttributes() {
 455          return customerAttributes;
 456      }
 457  
 458      @Override
 459      public void setCustomerAttributes(Map&lt;String, CustomerAttribute&gt; customerAttributes) {
 460          this.customerAttributes = customerAttributes;
 461      }
 462  
 463      @Override
 464      public boolean isDeactivated() {
 465          return BooleanUtils.toBoolean(deactivated);
 466      }
 467  
 468      @Override
 469      public void setDeactivated(boolean deactivated) {
 470          this.deactivated = Boolean.valueOf(deactivated);
 471      }
 472  
 473      @Override
 474      public List&lt;CustomerAddress&gt; getCustomerAddresses() {
 475          return customerAddresses;
 476      }
 477  
 478      @Override
 479      public void setCustomerAddresses(List&lt;CustomerAddress&gt; customerAddresses) {
 480          this.customerAddresses = customerAddresses;
 481      }
 482  
 483      @Override
 484      public List&lt;CustomerPhone&gt; getCustomerPhones() {
 485          return customerPhones;
 486      }
 487  
 488      @Override
 489      public void setCustomerPhones(List&lt;CustomerPhone&gt; customerPhones) {
 490          this.customerPhones = customerPhones;
 491      }
 492  
 493      @Override
 494      public List&lt;CustomerPayment&gt; getCustomerPayments() {
 495          return customerPayments;
 496      }
 497  
 498      @Override
 499      public void setCustomerPayments(List&lt;CustomerPayment&gt; customerPayments) {
 500          this.customerPayments = customerPayments;
 501      }
 502  
 503      @Override
 504      public String getMainEntityName() {
 505          if (!StringUtils.isEmpty(getFirstName()) &amp;&amp; !StringUtils.isEmpty(getLastName())) {
 506              return getFirstName() + &quot; &quot; + getLastName();
 507          }
 508          if (!StringUtils.isEmpty(getUsername())) {
 509              return getUsername();
 510          }
 511          return String.valueOf(getId());
 512      }
 513  
 514      @Override
 515      public Boolean getPreview() {
 516          if (previewable == null) {
 517              previewable = new PreviewStatus();
 518          }
 519          return previewable.getPreview();
 520      }
 521  
 522      @Override
 523      public void setPreview(Boolean preview) {
 524          if (previewable == null) {
 525              previewable = new PreviewStatus();
 526          }
 527          previewable.setPreview(preview);
 528      }
 529  
 530      @Override
 531      public Map&lt;String, Object&gt; getTransientProperties() {
 532          return transientProperties;
 533      }
 534  
 535      @Override
 536      public boolean equals(Object obj) {
 537          if (this == obj) {
 538              return true;
 539          }
 540          if (obj == null) {
 541              return false;
 542          }
 543          if (!getClass().isAssignableFrom(obj.getClass())) {
 544              return false;
 545          }
 546          CustomerImpl other = (CustomerImpl) obj;
 547  
 548          if (id != null &amp;&amp; other.id != null) {
 549              return id.equals(other.id);
 550          }
 551  
 552          if (username == null) {
 553              if (other.username != null) {
 554                  return false;
 555              }
 556          } else if (!username.equals(other.username)) {
 557              return false;
 558          }
 559          return true;
 560      }
 561  
 562      @Override
 563      public int hashCode() {
 564          final int prime = 31;
 565          int result = 1;
 566          result = prime * result + ((username == null) ? 0 : username.hashCode());
 567          return result;
 568      }
 569  
 570      @Override
<abbr title=" 571      public &lt;G extends Customer&gt; CreateResponse&lt;G&gt; createOrRetrieveCopyInstance(MultiTenantCopyContext context) throws CloneNotSupportedException {"> 571      public &lt;G extends Customer&gt; CreateResponse&lt;G&gt; createOrRetrieveCopyInstance(MultiTenantCopyContext context) thrðŸ”µ</abbr>
 572          CreateResponse&lt;G&gt; createResponse = context.createOrRetrieveCopyInstance(this);
 573          if (createResponse.isAlreadyPopulated()) {
 574              return createResponse;
 575          }
 576          Customer cloned = createResponse.getClone();
 577          cloned.setAnonymous(anonymous);
 578          cloned.setChallengeAnswer(challengeAnswer);
 579          cloned.setChallengeQuestion(challengeQuestion);
 580          cloned.setCookied(cookied);
 581          for (CustomerAddress entry : customerAddresses) {
 582              CustomerAddress clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 583              clonedEntry.setCustomer(cloned);
 584              cloned.getCustomerAddresses().add(clonedEntry);
 585  
 586          }
 587          for (Map.Entry&lt;String, CustomerAttribute&gt; entry : customerAttributes.entrySet()) {
 588              CustomerAttribute clonedEntry = entry.getValue().createOrRetrieveCopyInstance(context).getClone();
 589              clonedEntry.setCustomer(cloned);
 590              cloned.getCustomerAttributes().put(entry.getKey(), clonedEntry);
 591          }
 592          cloned.setLoggedIn(loggedIn);
 593          cloned.setUsername(username);
 594          cloned.setUnencodedPassword(unencodedPassword);
 595          cloned.setTaxExemptionCode(taxExemptionCode);
 596          cloned.setUnencodedChallengeAnswer(unencodedChallengeAnswer);
 597          cloned.setRegistered(registered);
 598          cloned.setReceiveEmail(receiveEmail);
 599          cloned.setPasswordChangeRequired(passwordChangeRequired);
 600          cloned.setPassword(password);
 601          cloned.setLastName(lastName);
 602          cloned.setFirstName(firstName);
 603          cloned.setEmailAddress(emailAddress);
 604          cloned.setDeactivated(deactivated);
 605          for (CustomerPayment entry : customerPayments) {
 606              CustomerPayment clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 607              clonedEntry.setCustomer(cloned);
 608              cloned.getCustomerPayments().add(clonedEntry);
 609          }
 610          for (CustomerPhone entry : customerPhones) {
 611              CustomerPhone clonedEntry = entry.createOrRetrieveCopyInstance(context).getClone();
 612              clonedEntry.setCustomer(cloned);
 613              cloned.getCustomerPhones().add(clonedEntry);
 614          }
 615          return createResponse;
 616      }
 617  
 618      @Override
 619      public String getTaxExemptionCode() {
 620          return this.taxExemptionCode;
 621      }
 622  
 623      @Override
 624      public void setTaxExemptionCode(String exemption) {
 625          this.taxExemptionCode = exemption;
 626  
 627          if (exemption != null) {
 628              this.isTaxExempt = true;
 629          }
 630      }
 631  
 632      @Override
 633      public boolean isTaxExempt() {
 634          return isTaxExempt != null &amp;&amp; isTaxExempt != false &amp;&amp;  StringUtils.isNotEmpty(taxExemptionCode);
 635      }
 636  
 637  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            