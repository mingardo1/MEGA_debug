<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>28</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    28
                    <a href="27.html">prev</a>
                    <a href="29.html">next</a>
                    <a href="28_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_1469ca1ceaae9c691eee7790de89a3ee1f571403_Aria/src/main/java/com/arialyy/aria/core/common/AbsFileer.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;1469ca1ceaae9c691eee7790de89a3ee1f571403:Aria/src/main/java/com/arialyy/aria/core/common/AbsFileer.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;1469ca1ceaae9c691eee7790de89a3ee1f571403^1:Aria/src/main/java/com/arialyy/aria/core/common/AbsFileer.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;1469ca1ceaae9c691eee7790de89a3ee1f571403^2:Aria/src/main/java/com/arialyy/aria/core/common/AbsFileer.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;39a43c836d3309cbbf82de6d51309fe71fc25292:Aria/src/main/java/com/arialyy/aria/core/common/AbsFileer.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b], [b], [b], [bs], [bs], [bs], [bs], [bsj], [bsj], [bsj], [bsj], [bs], [bs], [bs], [j], [j], [j], [j], [j], [j]], subset: [[b], [b], [b], [bs], [bs], [bsj], [bsj], [bsj], [bsj], [bsj], [bs], [bsj], [bsj], [j], [j]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16 package com.arialyy.aria.core.common;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  18 import android.content.Context;                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  19 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  20 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import android.util.SparseArray;                                                                         </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  22 =======                                                                                                  </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23 import android.os.Handler;                                                                               </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  24 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  25 import android.os.Looper;                                                                                </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  26 import android.util.SparseArray;                                                                         </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  27 import com.arialyy.aria.core.AriaManager;                                                                </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  28 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  29 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import com.arialyy.aria.core.download.DownloadEntity;                                                    </span>
<span class="-3497740022528182602" onmouseenter="enter('-3497740022528182602');" onmouseout="out('-3497740022528182602');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import com.arialyy.aria.core.download.DTaskWrapper;                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  32 =======                                                                                                  </span>
<span class="1502558042605946501" onmouseenter="enter('1502558042605946501');" onmouseout="out('1502558042605946501');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  33 import com.arialyy.aria.core.download.BaseDListener;                                                     </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  34 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  35 import com.arialyy.aria.core.inf.AbsNormalEntity;                                                        </span>
<span class="8472156907075048576" onmouseenter="enter('8472156907075048576');" onmouseout="out('8472156907075048576');" style="">  36 import com.arialyy.aria.core.inf.AbsTaskWrapper;                                                         </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  37 import com.arialyy.aria.core.inf.IEventListener;                                                         </span>
<span class="5965657858743993748" onmouseenter="enter('5965657858743993748');" onmouseout="out('5965657858743993748');" style="">  38 import com.arialyy.aria.core.manager.ThreadTaskManager;                                                  </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  39 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  40 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  42 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="5965657858743993748" onmouseenter="enter('5965657858743993748');" onmouseout="out('5965657858743993748');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43 import com.arialyy.aria.core.manager.ThreadTaskManager;                                                  </span>
<span class="-5831681804875068292" onmouseenter="enter('-5831681804875068292');" onmouseout="out('-5831681804875068292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44 import com.arialyy.aria.core.upload.UploadEntity;                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  45 =======                                                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  46 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  47 import java.io.File;                                                                                     </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  48 import java.util.concurrent.ScheduledThreadPoolExecutor;                                                 </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  49 import java.util.concurrent.TimeUnit;                                                                    </span>
<span  style="">  50                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  51 /**                                                                                                      </span>
<span class="6972081778092176351" onmouseenter="enter('6972081778092176351');" onmouseout="out('6972081778092176351');" style="">  52  * Created by AriaL on 2017/7/1.                                                                         </span>
<span class="6054556736689943041" onmouseenter="enter('6054556736689943041');" onmouseout="out('6054556736689943041');" style="">  53  * 控制线程任务状态，如：开始，停止，取消，重试                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  54  */                                                                                                      </span>
<span class="4153941248862822664" onmouseenter="enter('4153941248862822664');" onmouseout="out('4153941248862822664');" style=""><abbr title="  55 public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTITY&gt;&gt;">  55 public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTIT🔵</abbr></span>
<span class="4792287397525923935" onmouseenter="enter('4792287397525923935');" onmouseout="out('4792287397525923935');" style="">  56     implements Runnable {                                                                                </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  57 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-2630115597350149305" onmouseenter="enter('-2630115597350149305');" onmouseout="out('-2630115597350149305');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  58   protected final String TAG;                                                                            </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  59 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60 import java.util.Set;                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  61 =======                                                                                                  </span>
<span class="7185037452507187216" onmouseenter="enter('7185037452507187216');" onmouseout="out('7185037452507187216');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62   private final String TAG = &quot;AbsFileer&quot;;                                                                </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  63 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="">  64   protected IEventListener mListener;                                                                    </span>
<span class="4507751527304947270" onmouseenter="enter('4507751527304947270');" onmouseout="out('4507751527304947270');" style="">  65   protected TASK_WRAPPER mTaskWrapper;                                                                   </span>
<span class="8904454574412257163" onmouseenter="enter('8904454574412257163');" onmouseout="out('8904454574412257163');" style="">  66   protected ENTITY mEntity;                                                                              </span>
<span class="-8914417138860252644" onmouseenter="enter('-8914417138860252644');" onmouseout="out('-8914417138860252644');" style="">  67   protected Context mContext;                                                                            </span>
<span class="3740841846621187936" onmouseenter="enter('3740841846621187936');" onmouseout="out('3740841846621187936');" style="">  68   protected File mTempFile; //文件                                                                         </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  69 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  70 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71  */                                                                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  72 =======                                                                                                  </span>
<span class="7749320607782706378" onmouseenter="enter('7749320607782706378');" onmouseout="out('7749320607782706378');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73   protected int mTotalThreadNum; //总线程数                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  74 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style="">  75                                                                                                          </span>
<span class="-4844420720547991856" onmouseenter="enter('-4844420720547991856');" onmouseout="out('-4844420720547991856');" style="">  76   private SparseArray&lt;AbsThreadTask&gt; mTask = new SparseArray&lt;&gt;();                                        </span>
<span class="8927193311925096133" onmouseenter="enter('8927193311925096133');" onmouseout="out('8927193311925096133');" style="">  77   private ScheduledThreadPoolExecutor mTimer;                                                            </span>
<span  style="">  78                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  79   /**                                                                                                    </span>
<span class="7539908978715582123" onmouseenter="enter('7539908978715582123');" onmouseout="out('7539908978715582123');" style="">  80    * 进度刷新间隔                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  81    */                                                                                                    </span>
<span class="3897731617107507824" onmouseenter="enter('3897731617107507824');" onmouseout="out('3897731617107507824');" style="">  82   private long mUpdateInterval = 1000;                                                                   </span>
<span class="-3206802593496103666" onmouseenter="enter('-3206802593496103666');" onmouseout="out('-3206802593496103666');" style="">  83   protected TaskRecord mRecord;                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  84 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="4056767467165783866" onmouseenter="enter('4056767467165783866');" onmouseout="out('4056767467165783866');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85   private IThreadState mStateManager;                                                                    </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  86 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87   /**                                                                                                    </span>
<span class="-1980722710912279499" onmouseenter="enter('-1980722710912279499');" onmouseout="out('-1980722710912279499');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88    * 小于1m的文件不启用多线程                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89    */                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  90 =======                                                                                                  </span>
<span class="-6621654726952641912" onmouseenter="enter('-6621654726952641912');" onmouseout="out('-6621654726952641912');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91   private ThreadStateManager mStateManager;                                                              </span>
<span class="8505538020780181250" onmouseenter="enter('8505538020780181250');" onmouseout="out('8505538020780181250');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92   private Handler mStateHandler;                                                                         </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  93 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-1193305157002570511" onmouseenter="enter('-1193305157002570511');" onmouseout="out('-1193305157002570511');" style="">  94   private boolean isCancel = false, isStop = false;                                                      </span>
<span  style="">  95                                                                                                          </span>
<span class="4983484047732255541" onmouseenter="enter('4983484047732255541');" onmouseout="out('4983484047732255541');" style="">  96   protected AbsFileer(IEventListener listener, TASK_WRAPPER wrapper) {                                   </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  97     mListener = listener;                                                                                </span>
<span class="-4483703319181095288" onmouseenter="enter('-4483703319181095288');" onmouseout="out('-4483703319181095288');" style="">  98     mTaskWrapper = wrapper;                                                                              </span>
<span class="-7408997685265206061" onmouseenter="enter('-7408997685265206061');" onmouseout="out('-7408997685265206061');" style="">  99     mEntity = mTaskWrapper.getEntity();                                                                  </span>
<span class="1002707508041764251" onmouseenter="enter('1002707508041764251');" onmouseout="out('1002707508041764251');" style=""> 100     mContext = AriaManager.APP;                                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 101 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-6219919440297129241" onmouseenter="enter('-6219919440297129241');" onmouseout="out('-6219919440297129241');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102     TAG = CommonUtil.getClassName(getClass());                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104                                                                                                          </span>
<span class="-7037004339700598290" onmouseenter="enter('-7037004339700598290');" onmouseout="out('-7037004339700598290');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 105   protected abstract IThreadState getStateManager(Looper looper);                                        </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 106                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 107   /**                                                                                                    </span>
<span class="4265495595238076168" onmouseenter="enter('4265495595238076168');" onmouseout="out('4265495595238076168');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 108    * 处理任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 109    */                                                                                                    </span>
<span class="5239937503155095401" onmouseenter="enter('5239937503155095401');" onmouseout="out('5239937503155095401');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 110   protected abstract void handleTask();                                                                  </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 111 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112   protected IEventListener mListener;                                                                    </span>
<span class="4507751527304947270" onmouseenter="enter('4507751527304947270');" onmouseout="out('4507751527304947270');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113   protected TASK_WRAPPER mTaskWrapper;                                                                   </span>
<span class="8904454574412257163" onmouseenter="enter('8904454574412257163');" onmouseout="out('8904454574412257163');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114   protected ENTITY mEntity;                                                                              </span>
<span class="-8914417138860252644" onmouseenter="enter('-8914417138860252644');" onmouseout="out('-8914417138860252644');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115   protected Context mContext;                                                                            </span>
<span class="3740841846621187936" onmouseenter="enter('3740841846621187936');" onmouseout="out('3740841846621187936');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116   protected File mTempFile; //文件                                                                         </span>
<span class="-5211593385781091233" onmouseenter="enter('-5211593385781091233');" onmouseout="out('-5211593385781091233');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117   protected StateConstance mConstance;                                                                   </span>
<span class="-7729852228955968495" onmouseenter="enter('-7729852228955968495');" onmouseout="out('-7729852228955968495');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118   //总线程数                                                                                                 </span>
<span class="8506024364762319503" onmouseenter="enter('8506024364762319503');" onmouseout="out('8506024364762319503');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119   protected int mTotalThreadNum;                                                                         </span>
<span class="6869677327514827795" onmouseenter="enter('6869677327514827795');" onmouseout="out('6869677327514827795');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120   //已完成的线程数                                                                                              </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 121 =======                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122   }                                                                                                      </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 123 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span  style=""> 124                                                                                                          </span>
<span class="1570397235639520239" onmouseenter="enter('1570397235639520239');" onmouseout="out('1570397235639520239');" style=""> 125   public String getKey() {                                                                               </span>
<span class="-4424845466408855162" onmouseenter="enter('-4424845466408855162');" onmouseout="out('-4424845466408855162');" style=""> 126     return mTaskWrapper.getKey();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127   }                                                                                                      </span>
<span  style=""> 128                                                                                                          </span>
<span class="-8770398782889209035" onmouseenter="enter('-8770398782889209035');" onmouseout="out('-8770398782889209035');" style=""> 129   public ENTITY getEntity() {                                                                            </span>
<span class="-2978486956956616380" onmouseenter="enter('-2978486956956616380');" onmouseout="out('-2978486956956616380');" style=""> 130     return mEntity;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131   }                                                                                                      </span>
<span  style=""> 132                                                                                                          </span>
<span class="-5640948235258648086" onmouseenter="enter('-5640948235258648086');" onmouseout="out('-5640948235258648086');" style=""> 133   public SparseArray&lt;AbsThreadTask&gt; getTaskList() {                                                      </span>
<span class="4274533672597507440" onmouseenter="enter('4274533672597507440');" onmouseout="out('4274533672597507440');" style=""> 134     return mTask;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135   }                                                                                                      </span>
<span  style=""> 136                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 137   /**                                                                                                    </span>
<span class="5501330737777447325" onmouseenter="enter('5501330737777447325');" onmouseout="out('5501330737777447325');" style=""> 138    * 重置任务状态                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 139    */                                                                                                    </span>
<span class="769592541207569755" onmouseenter="enter('769592541207569755');" onmouseout="out('769592541207569755');" style=""> 140   private void resetState() {                                                                            </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 141     closeTimer();                                                                                        </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 142 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 143 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144                                                                                                          </span>
<span class="-189617012144926713" onmouseenter="enter('-189617012144926713');" onmouseout="out('-189617012144926713');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145   protected abstract int getType();                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146                                                                                                          </span>
<span class="-8210434580109369245" onmouseenter="enter('-8210434580109369245');" onmouseout="out('-8210434580109369245');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147   public void setNewTask(boolean newTask) {                                                              </span>
<span class="3866179170323161252" onmouseenter="enter('3866179170323161252');" onmouseout="out('3866179170323161252');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148     mTaskWrapper.setNewTask(newTask);                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 149 =======                                                                                                  </span>
<span class="-7538891183274876048" onmouseenter="enter('-7538891183274876048');" onmouseout="out('-7538891183274876048');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150     mTotalThreadNum = 0;                                                                                 </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 151 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="86382318944182160" onmouseenter="enter('86382318944182160');" onmouseout="out('86382318944182160');" style=""> 152     if (mTask != null &amp;&amp; mTask.size() != 0) {                                                            </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 153       for (int i = 0; i &lt; mTask.size(); i++) {                                                           </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 154         AbsThreadTask task = mTask.get(i);                                                               </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 155         if (task != null) {                                                                              </span>
<span class="4672639676050941541" onmouseenter="enter('4672639676050941541');" onmouseout="out('4672639676050941541');" style=""> 156           task.breakTask();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 158       }                                                                                                  </span>
<span class="-5745867061804924715" onmouseenter="enter('-5745867061804924715');" onmouseout="out('-5745867061804924715');" style=""> 159       mTask.clear();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161   }                                                                                                      </span>
<span  style=""> 162                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 163   /**                                                                                                    </span>
<span class="-8036989040377605484" onmouseenter="enter('-8036989040377605484');" onmouseout="out('-8036989040377605484');" style=""> 164    * 开始流程                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 165    */                                                                                                    </span>
<span class="2659446283962947526" onmouseenter="enter('2659446283962947526');" onmouseout="out('2659446283962947526');" style=""> 166   private void startFlow() {                                                                             </span>
<span class="-8163448594027824981" onmouseenter="enter('-8163448594027824981');" onmouseout="out('-8163448594027824981');" style=""> 167     if (isBreak()) {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 168       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169     }                                                                                                    </span>
<span class="-4000252108766936273" onmouseenter="enter('-4000252108766936273');" onmouseout="out('-4000252108766936273');" style=""> 170     resetState();                                                                                        </span>
<span class="2108596284974852159" onmouseenter="enter('2108596284974852159');" onmouseout="out('2108596284974852159');" style=""> 171     mRecord = new RecordHandler(mTaskWrapper).getRecord();                                               </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 172 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-6826246836562616350" onmouseenter="enter('-6826246836562616350');" onmouseout="out('-6826246836562616350');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 173     Looper.prepare();                                                                                    </span>
<span class="5149694805992184581" onmouseenter="enter('5149694805992184581');" onmouseout="out('5149694805992184581');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174     Looper looper = Looper.myLooper();                                                                   </span>
<span class="-3253896924586580699" onmouseenter="enter('-3253896924586580699');" onmouseout="out('-3253896924586580699');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 175     mStateManager = getStateManager(looper);                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 176 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="6059729822356905089" onmouseenter="enter('6059729822356905089');" onmouseout="out('6059729822356905089');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177   public void setMaxSpeed(int maxSpeed) {                                                                </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180       if (task != null) {                                                                                </span>
<span class="8974054037700404915" onmouseenter="enter('8974054037700404915');" onmouseout="out('8974054037700404915');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181         task.setMaxSpeed(maxSpeed);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186   /**                                                                                                    </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 187 =======                                                                                                  </span>
<span class="5383386817121006275" onmouseenter="enter('5383386817121006275');" onmouseout="out('5383386817121006275');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188     mTotalThreadNum = mRecord.threadNum;                                                                 </span>
<span class="-6826246836562616350" onmouseenter="enter('-6826246836562616350');" onmouseout="out('-6826246836562616350');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189     Looper.prepare();                                                                                    </span>
<span class="5149694805992184581" onmouseenter="enter('5149694805992184581');" onmouseout="out('5149694805992184581');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190     Looper looper = Looper.myLooper();                                                                   </span>
<span class="7030077118020735892" onmouseenter="enter('7030077118020735892');" onmouseout="out('7030077118020735892');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191     mStateManager = new ThreadStateManager(looper, mRecord, mListener);                                  </span>
<span class="-9214273580559083386" onmouseenter="enter('-9214273580559083386');" onmouseout="out('-9214273580559083386');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192     mStateHandler = new Handler(looper, mStateManager);                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 193 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="6344410794906613415" onmouseenter="enter('6344410794906613415');" onmouseout="out('6344410794906613415');" style=""> 194     onPostPre();                                                                                         </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 195 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 196 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="8974054037700404915" onmouseenter="enter('8974054037700404915');" onmouseout="out('8974054037700404915');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197         task.setMaxSpeed(maxSpeed);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202   /**                                                                                                    </span>
<span class="5501330737777447325" onmouseenter="enter('5501330737777447325');" onmouseout="out('5501330737777447325');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203    * 重置任务状态                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204    */                                                                                                    </span>
<span class="769592541207569755" onmouseenter="enter('769592541207569755');" onmouseout="out('769592541207569755');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205   private void resetState() {                                                                            </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206     closeTimer();                                                                                        </span>
<span class="-8079256701752176328" onmouseenter="enter('-8079256701752176328');" onmouseout="out('-8079256701752176328');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207     mCompleteThreadNum = 0;                                                                              </span>
<span class="-7538891183274876048" onmouseenter="enter('-7538891183274876048');" onmouseout="out('-7538891183274876048');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208     mTotalThreadNum = 0;                                                                                 </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 209 =======                                                                                                  </span>
<span class="5989254615436994150" onmouseenter="enter('5989254615436994150');" onmouseout="out('5989254615436994150');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210     if (!mTaskWrapper.isSupportBP()) {                                                                   </span>
<span class="-6182854007095635032" onmouseenter="enter('-6182854007095635032');" onmouseout="out('-6182854007095635032');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211       handleNoSupportBP();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212     } else {                                                                                             </span>
<span class="304482857231090385" onmouseenter="enter('304482857231090385');" onmouseout="out('304482857231090385');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213       handleBreakpoint();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214     }                                                                                                    </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 215 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="-7724548171203838725" onmouseenter="enter('-7724548171203838725');" onmouseout="out('-7724548171203838725');" style=""> 216     startTimer();                                                                                        </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 217 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-5346338694472503069" onmouseenter="enter('-5346338694472503069');" onmouseout="out('-5346338694472503069');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 218     handleTask();                                                                                        </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 219 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224   /**                                                                                                    </span>
<span class="5501330737777447325" onmouseenter="enter('5501330737777447325');" onmouseout="out('5501330737777447325');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225    * 重置任务状态                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226    */                                                                                                    </span>
<span class="769592541207569755" onmouseenter="enter('769592541207569755');" onmouseout="out('769592541207569755');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227   private void resetState() {                                                                            </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228     closeTimer();                                                                                        </span>
<span class="-8079256701752176328" onmouseenter="enter('-8079256701752176328');" onmouseout="out('-8079256701752176328');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229     mCompleteThreadNum = 0;                                                                              </span>
<span class="-7538891183274876048" onmouseenter="enter('-7538891183274876048');" onmouseout="out('-7538891183274876048');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230     mTotalThreadNum = 0;                                                                                 </span>
<span class="86382318944182160" onmouseenter="enter('86382318944182160');" onmouseout="out('86382318944182160');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231     if (mTask != null &amp;&amp; mTask.size() != 0) {                                                            </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 232 =======                                                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 233 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="7341795500457488125" onmouseenter="enter('7341795500457488125');" onmouseout="out('7341795500457488125');" style=""> 234     Looper.loop();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 235   }                                                                                                      </span>
<span  style=""> 236                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 237   @Override public void run() {                                                                          </span>
<span class="6651633619385263409" onmouseenter="enter('6651633619385263409');" onmouseout="out('6651633619385263409');" style=""> 238     if (isRunning()) {                                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 239       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240     }                                                                                                    </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 241     startFlow();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 242   }                                                                                                      </span>
<span  style=""> 243                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 244   /**                                                                                                    </span>
<span class="4044787794494402505" onmouseenter="enter('4044787794494402505');" onmouseout="out('4044787794494402505');" style=""> 245    * 预处理完成                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 246    */                                                                                                    </span>
<span class="-5125657304217005566" onmouseenter="enter('-5125657304217005566');" onmouseout="out('-5125657304217005566');" style=""> 247   protected void onPostPre() {                                                                           </span>
<span  style=""> 248                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249   }                                                                                                      </span>
<span  style=""> 250                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 251   /**                                                                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 252 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-8327624174212830499" onmouseenter="enter('-8327624174212830499');" onmouseout="out('-8327624174212830499');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 253    * 延迟启动定时器                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 254    */                                                                                                    </span>
<span class="2707724463201796910" onmouseenter="enter('2707724463201796910');" onmouseout="out('2707724463201796910');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 255   protected long delayTimer() {                                                                          </span>
<span class="-5665804692852603146" onmouseenter="enter('-5665804692852603146');" onmouseout="out('-5665804692852603146');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 256     return 1000;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 257   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 258                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 259   /**                                                                                                    </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 260 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264   /**                                                                                                    </span>
<span class="-8036989040377605484" onmouseenter="enter('-8036989040377605484');" onmouseout="out('-8036989040377605484');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265    * 开始流程                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266    */                                                                                                    </span>
<span class="2659446283962947526" onmouseenter="enter('2659446283962947526');" onmouseout="out('2659446283962947526');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267   private void startFlow() {                                                                             </span>
<span class="-8163448594027824981" onmouseenter="enter('-8163448594027824981');" onmouseout="out('-8163448594027824981');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268     if (isBreak()) {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270     }                                                                                                    </span>
<span class="-4000252108766936273" onmouseenter="enter('-4000252108766936273');" onmouseout="out('-4000252108766936273');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271     resetState();                                                                                        </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 272 =======                                                                                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 273 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="4041581137177203435" onmouseenter="enter('4041581137177203435');" onmouseout="out('4041581137177203435');" style=""> 274    * 启动进度获取定时器                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 275    */                                                                                                    </span>
<span class="1702258376619356446" onmouseenter="enter('1702258376619356446');" onmouseout="out('1702258376619356446');" style=""> 276   private synchronized void startTimer() {                                                               </span>
<span class="8615364800642373101" onmouseenter="enter('8615364800642373101');" onmouseout="out('8615364800642373101');" style=""> 277     ALog.d(TAG, &quot;启动定时器&quot;);                                                                                </span>
<span class="-9160623214484912914" onmouseenter="enter('-9160623214484912914');" onmouseout="out('-9160623214484912914');" style=""> 278     mTimer = new ScheduledThreadPoolExecutor(1);                                                         </span>
<span class="4344341468621605861" onmouseenter="enter('4344341468621605861');" onmouseout="out('4344341468621605861');" style=""> 279     mTimer.scheduleWithFixedDelay(new Runnable() {                                                       </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 280       @Override public void run() {                                                                      </span>
<span class="-2600099651056425109" onmouseenter="enter('-2600099651056425109');" onmouseout="out('-2600099651056425109');" style=""> 281         if (mStateManager.isComplete()                                                                   </span>
<span class="242988333280989926" onmouseenter="enter('242988333280989926');" onmouseout="out('242988333280989926');" style=""> 282             || mStateManager.isStop()                                                                    </span>
<span class="-9217646883186463915" onmouseenter="enter('-9217646883186463915');" onmouseout="out('-9217646883186463915');" style=""> 283             || mStateManager.isCancel()                                                                  </span>
<span class="-6792138316084162201" onmouseenter="enter('-6792138316084162201');" onmouseout="out('-6792138316084162201');" style=""> 284             || mStateManager.isFail()                                                                    </span>
<span class="1045872412985382023" onmouseenter="enter('1045872412985382023');" onmouseout="out('1045872412985382023');" style=""> 285             || !isRunning()) {                                                                           </span>
<span class="3103159404811065674" onmouseenter="enter('3103159404811065674');" onmouseout="out('3103159404811065674');" style=""> 286           if (mStateManager.isComplete() || mStateManager.isFail()) {                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 287             ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 288           }                                                                                              </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 289           closeTimer();                                                                                  </span>
<span class="-8976455106279635226" onmouseenter="enter('-8976455106279635226');" onmouseout="out('-8976455106279635226');" style=""> 290         } else if (mStateManager.getCurrentProgress() &gt;= 0) {                                            </span>
<span class="-7130682954514056925" onmouseenter="enter('-7130682954514056925');" onmouseout="out('-7130682954514056925');" style=""> 291           mListener.onProgress(mStateManager.getCurrentProgress());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293       }                                                                                                  </span>
<span class="4986548728620604588" onmouseenter="enter('4986548728620604588');" onmouseout="out('4986548728620604588');" style=""> 294     }, delayTimer(), mUpdateInterval, TimeUnit.MILLISECONDS);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295   }                                                                                                      </span>
<span  style=""> 296                                                                                                          </span>
<span class="3982752692275613073" onmouseenter="enter('3982752692275613073');" onmouseout="out('3982752692275613073');" style=""> 297   public synchronized void closeTimer() {                                                                </span>
<span class="-7001663665090653782" onmouseenter="enter('-7001663665090653782');" onmouseout="out('-7001663665090653782');" style=""> 298     ALog.d(TAG, &quot;关闭定时器&quot;);                                                                                </span>
<span class="-1268142752100378972" onmouseenter="enter('-1268142752100378972');" onmouseout="out('-1268142752100378972');" style=""> 299     if (mTimer != null &amp;&amp; !mTimer.isShutdown()) {                                                        </span>
<span class="4837418556669337408" onmouseenter="enter('4837418556669337408');" onmouseout="out('4837418556669337408');" style=""> 300       mTimer.shutdown();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302   }                                                                                                      </span>
<span  style=""> 303                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 304   /**                                                                                                    </span>
<span class="3310122691908792895" onmouseenter="enter('3310122691908792895');" onmouseout="out('3310122691908792895');" style=""> 305    * 设置定时器更新间隔                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 306    *                                                                                                     </span>
<span class="5926421498368036592" onmouseenter="enter('5926421498368036592');" onmouseout="out('5926421498368036592');" style=""> 307    * @param interval 单位毫秒，不能小于0                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 308    */                                                                                                    </span>
<span class="-6143371944494222779" onmouseenter="enter('-6143371944494222779');" onmouseout="out('-6143371944494222779');" style=""> 309   protected void setUpdateInterval(long interval) {                                                      </span>
<span class="-1051498944097002766" onmouseenter="enter('-1051498944097002766');" onmouseout="out('-1051498944097002766');" style=""> 310     if (interval &lt; 0) {                                                                                  </span>
<span class="3000915396455271078" onmouseenter="enter('3000915396455271078');" onmouseout="out('3000915396455271078');" style=""> 311       ALog.w(TAG, &quot;更新间隔不能小于0，默认为1000毫秒&quot;);                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 312       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 313     }                                                                                                    </span>
<span class="-3431322530378656562" onmouseenter="enter('-3431322530378656562');" onmouseout="out('-3431322530378656562');" style=""> 314     mUpdateInterval = interval;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315   }                                                                                                      </span>
<span  style=""> 316                                                                                                          </span>
<span class="-5758762106788202116" onmouseenter="enter('-5758762106788202116');" onmouseout="out('-5758762106788202116');" style=""> 317   public long getFileSize() {                                                                            </span>
<span class="-7902485770489300682" onmouseenter="enter('-7902485770489300682');" onmouseout="out('-7902485770489300682');" style=""> 318     return mEntity.getFileSize();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319   }                                                                                                      </span>
<span  style=""> 320                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 321   /**                                                                                                    </span>
<span class="-7288086523564906780" onmouseenter="enter('-7288086523564906780');" onmouseout="out('-7288086523564906780');" style=""> 322    * 获取当前任务位置                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 323    */                                                                                                    </span>
<span class="3656547772237643757" onmouseenter="enter('3656547772237643757');" onmouseout="out('3656547772237643757');" style=""> 324   public long getCurrentLocation() {                                                                     </span>
<span class="-4293580056549457" onmouseenter="enter('-4293580056549457');" onmouseout="out('-4293580056549457');" style=""> 325     return mStateManager.getCurrentProgress();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 326   }                                                                                                      </span>
<span  style=""> 327                                                                                                          </span>
<span class="430507706356584401" onmouseenter="enter('430507706356584401');" onmouseout="out('430507706356584401');" style=""> 328   public synchronized boolean isRunning() {                                                              </span>
<span class="-3888627988187341127" onmouseenter="enter('-3888627988187341127');" onmouseout="out('-3888627988187341127');" style=""> 329     boolean b = ThreadTaskManager.getInstance().taskIsRunning(mTaskWrapper.getKey());                    </span>
<span class="-4055314358126237867" onmouseenter="enter('-4055314358126237867');" onmouseout="out('-4055314358126237867');" style=""> 330     //ALog.d(TAG, &quot;isRunning = &quot; + b);                                                                   </span>
<span class="936248907371687111" onmouseenter="enter('936248907371687111');" onmouseout="out('936248907371687111');" style=""> 331     return b;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 332   }                                                                                                      </span>
<span  style=""> 333                                                                                                          </span>
<span class="7466876458085224213" onmouseenter="enter('7466876458085224213');" onmouseout="out('7466876458085224213');" style=""> 334   public synchronized void cancel() {                                                                    </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 335     if (isCancel) {                                                                                      </span>
<span class="-5322688094560357059" onmouseenter="enter('-5322688094560357059');" onmouseout="out('-5322688094560357059');" style=""> 336       ALog.d(TAG, String.format(&quot;任务【%s】正在删除，删除任务失败&quot;, mTaskWrapper.getKey()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 337       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338     }                                                                                                    </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 339     closeTimer();                                                                                        </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style=""> 340     isCancel = true;                                                                                     </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 341     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 342       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 343       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style=""> 344         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 346     }                                                                                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 347     ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348   }                                                                                                      </span>
<span  style=""> 349                                                                                                          </span>
<span class="8656523468118489646" onmouseenter="enter('8656523468118489646');" onmouseout="out('8656523468118489646');" style=""> 350   public synchronized void stop() {                                                                      </span>
<span class="7677583571575855110" onmouseenter="enter('7677583571575855110');" onmouseout="out('7677583571575855110');" style=""> 351     if (isStop) {                                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 352       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353     }                                                                                                    </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 354     closeTimer();                                                                                        </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style=""> 355     isStop = true;                                                                                       </span>
<span class="-7122141514229488110" onmouseenter="enter('-7122141514229488110');" onmouseout="out('-7122141514229488110');" style=""> 356     if (mStateManager.isComplete()) return;                                                              </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 357     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 358       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="-6295419555080725627" onmouseenter="enter('-6295419555080725627');" onmouseout="out('-6295419555080725627');" style=""> 359       if (task != null &amp;&amp; !task.isThreadComplete()) {                                                    </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style=""> 360         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 361       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 362     }                                                                                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 363     ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 364   }                                                                                                      </span>
<span  style=""> 365                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 366   /**                                                                                                    </span>
<span class="-7218687507933415946" onmouseenter="enter('-7218687507933415946');" onmouseout="out('-7218687507933415946');" style=""> 367    * 直接调用的时候会自动启动线程执行                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 368    */                                                                                                    </span>
<span class="-7265432148414046744" onmouseenter="enter('-7265432148414046744');" onmouseout="out('-7265432148414046744');" style=""> 369   public synchronized void start() {                                                                     </span>
<span class="6651633619385263409" onmouseenter="enter('6651633619385263409');" onmouseout="out('6651633619385263409');" style=""> 370     if (isRunning()) {                                                                                   </span>
<span class="4391999858354318805" onmouseenter="enter('4391999858354318805');" onmouseout="out('4391999858354318805');" style=""> 371       ALog.d(TAG, String.format(&quot;任务【%s】正在执行，启动任务失败&quot;, mTaskWrapper.getKey()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 372       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 373     }                                                                                                    </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style=""> 374     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 375   }                                                                                                      </span>
<span  style=""> 376                                                                                                          </span>
<span class="5993373674998630219" onmouseenter="enter('5993373674998630219');" onmouseout="out('5993373674998630219');" style=""> 377   public void resume() {                                                                                 </span>
<span class="-6183578153083367222" onmouseenter="enter('-6183578153083367222');" onmouseout="out('-6183578153083367222');" style=""> 378     start();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 379   }                                                                                                      </span>
<span  style=""> 380                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 381   /**                                                                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 382 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 383 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386   /**                                                                                                    </span>
<span class="-7288086523564906780" onmouseenter="enter('-7288086523564906780');" onmouseout="out('-7288086523564906780');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387    * 获取当前任务位置                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388    */                                                                                                    </span>
<span class="3656547772237643757" onmouseenter="enter('3656547772237643757');" onmouseout="out('3656547772237643757');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389   public long getCurrentLocation() {                                                                     </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390     return mConstance.CURRENT_LOCATION;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392                                                                                                          </span>
<span class="430507706356584401" onmouseenter="enter('430507706356584401');" onmouseout="out('430507706356584401');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393   public synchronized boolean isRunning() {                                                              </span>
<span class="-7600400715455113368" onmouseenter="enter('-7600400715455113368');" onmouseout="out('-7600400715455113368');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394     return ThreadTaskManager.getInstance().taskIsRunning(mTaskWrapper.getKey());                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396                                                                                                          </span>
<span class="7466876458085224213" onmouseenter="enter('7466876458085224213');" onmouseout="out('7466876458085224213');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397   public synchronized void cancel() {                                                                    </span>
<span class="-3806794828534168829" onmouseenter="enter('-3806794828534168829');" onmouseout="out('-3806794828534168829');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398     ALog.d(TAG, &quot;constance hash: &quot; + mConstance.hashCode());                                             </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399     if (mConstance.isCancel) {                                                                           </span>
<span class="-5322688094560357059" onmouseenter="enter('-5322688094560357059');" onmouseout="out('-5322688094560357059');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400       ALog.d(TAG, String.format(&quot;任务【%s】正在删除，删除任务失败&quot;, mTaskWrapper.getKey()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402     }                                                                                                    </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403     closeTimer();                                                                                        </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404     mConstance.isCancel = true;                                                                          </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410     }                                                                                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411     ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413                                                                                                          </span>
<span class="8656523468118489646" onmouseenter="enter('8656523468118489646');" onmouseout="out('8656523468118489646');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414   public synchronized void stop() {                                                                      </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415     if (mConstance.isStop) {                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417     }                                                                                                    </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418     closeTimer();                                                                                        </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419     mConstance.isStop = true;                                                                            </span>
<span class="8402005296375476854" onmouseenter="enter('8402005296375476854');" onmouseout="out('8402005296375476854');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420     if (mConstance.isComplete()) return;                                                                 </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="-6295419555080725627" onmouseenter="enter('-6295419555080725627');" onmouseout="out('-6295419555080725627');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423       if (task != null &amp;&amp; !task.isThreadComplete()) {                                                    </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426     }                                                                                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427     ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430   /**                                                                                                    </span>
<span class="-7218687507933415946" onmouseenter="enter('-7218687507933415946');" onmouseout="out('-7218687507933415946');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431    * 直接调用的时候会自动启动线程执行                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432    */                                                                                                    </span>
<span class="-7265432148414046744" onmouseenter="enter('-7265432148414046744');" onmouseout="out('-7265432148414046744');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433   public synchronized void start() {                                                                     </span>
<span class="6651633619385263409" onmouseenter="enter('6651633619385263409');" onmouseout="out('6651633619385263409');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434     if (isRunning()) {                                                                                   </span>
<span class="4391999858354318805" onmouseenter="enter('4391999858354318805');" onmouseout="out('4391999858354318805');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435       ALog.d(TAG, String.format(&quot;任务【%s】正在执行，启动任务失败&quot;, mTaskWrapper.getKey()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437     }                                                                                                    </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440                                                                                                          </span>
<span class="5993373674998630219" onmouseenter="enter('5993373674998630219');" onmouseout="out('5993373674998630219');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441   public void resume() {                                                                                 </span>
<span class="-6183578153083367222" onmouseenter="enter('-6183578153083367222');" onmouseout="out('-6183578153083367222');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442     start();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445   /**                                                                                                    </span>
<span class="3333036234618128246" onmouseenter="enter('3333036234618128246');" onmouseout="out('3333036234618128246');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446    * 检查记录 对于分块任务： 子分块不存在或被删除，子线程将重新下载 对于普通任务： 预下载文件不存在，则任务任务呗删除                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447    */                                                                                                    </span>
<span class="-3226254244315569492" onmouseenter="enter('-3226254244315569492');" onmouseout="out('-3226254244315569492');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448   private void checkRecord() {                                                                           </span>
<span class="-5297450492380711808" onmouseenter="enter('-5297450492380711808');" onmouseout="out('-5297450492380711808');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449     mConfigFile = new File(CommonUtil.getFileConfigPath(false, mEntity.getFileName()));                  </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450     if (mConfigFile.exists()) {                                                                          </span>
<span class="7932310618145443523" onmouseenter="enter('7932310618145443523');" onmouseout="out('7932310618145443523');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451       convertDb();                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452     } else {                                                                                             </span>
<span class="4647489036124418098" onmouseenter="enter('4647489036124418098');" onmouseout="out('4647489036124418098');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453       mRecord = DbDataHelper.getTaskRecord(getFilePath());                                               </span>
<span class="-3299415613061807412" onmouseenter="enter('-3299415613061807412');" onmouseout="out('-3299415613061807412');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454       if (mRecord == null) {                                                                             </span>
<span class="-6736410795519637054" onmouseenter="enter('-6736410795519637054');" onmouseout="out('-6736410795519637054');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455         initRecord(true);                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456       } else {                                                                                           </span>
<span class="-7168613097949101282" onmouseenter="enter('-7168613097949101282');" onmouseout="out('-7168613097949101282');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457         if (mRecord.threadRecords == null || mRecord.threadRecords.isEmpty()) {                          </span>
<span class="-6736410795519637054" onmouseenter="enter('-6736410795519637054');" onmouseout="out('-6736410795519637054');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458           initRecord(true);                                                                              </span>
<span class="-5520464134160599469" onmouseenter="enter('-5520464134160599469');" onmouseout="out('-5520464134160599469');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459         } else if (mRecord.isBlock) {                                                                    </span>
<span class="4499191396384356607" onmouseenter="enter('4499191396384356607');" onmouseout="out('4499191396384356607');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460           handleBlockRecord();                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461         } else {                                                                                         </span>
<span class="-7429038303426788124" onmouseenter="enter('-7429038303426788124');" onmouseout="out('-7429038303426788124');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462           handleNormalRecord();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468   /**                                                                                                    </span>
<span class="-6732733519809936602" onmouseenter="enter('-6732733519809936602');" onmouseout="out('-6732733519809936602');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469    * 处理普通任务的记录                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470    */                                                                                                    </span>
<span class="2040790615597773652" onmouseenter="enter('2040790615597773652');" onmouseout="out('2040790615597773652');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471   private void handleNormalRecord() {                                                                    </span>
<span class="3630450282049316686" onmouseenter="enter('3630450282049316686');" onmouseout="out('3630450282049316686');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472     File file = new File(mRecord.filePath);                                                              </span>
<span class="4133240422546463755" onmouseenter="enter('4133240422546463755');" onmouseout="out('4133240422546463755');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473     if (!file.exists()) {                                                                                </span>
<span class="-573220915101280348" onmouseenter="enter('-573220915101280348');" onmouseout="out('-573220915101280348');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474       ALog.w(TAG, String.format(&quot;文件【%s】不存在，任务将重新开始&quot;, file.getPath()));                                   </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475       mRecord.deleteData();                                                                              </span>
<span class="-6736410795519637054" onmouseenter="enter('-6736410795519637054');" onmouseout="out('-6736410795519637054');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476       initRecord(true);                                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477       return;                                                                                            </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 478 =======                                                                                                  </span>
<span class="8881300510663389339" onmouseenter="enter('8881300510663389339');" onmouseout="out('8881300510663389339');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 479    * 启动断点任务时，创建单线程任务                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 480    *                                                                                                     </span>
<span class="-262599314844690395" onmouseenter="enter('-262599314844690395');" onmouseout="out('-262599314844690395');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 481    * @param record 线程记录                                                                                  </span>
<span class="4692865644996389482" onmouseenter="enter('4692865644996389482');" onmouseout="out('4692865644996389482');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 482    * @param startNum 启动的线程数                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 483    */                                                                                                    </span>
<span class="6288283959573381778" onmouseenter="enter('6288283959573381778');" onmouseout="out('6288283959573381778');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 484   private AbsThreadTask createSingThreadTask(ThreadRecord record, int startNum) {                        </span>
<span class="619060527413120496" onmouseenter="enter('619060527413120496');" onmouseout="out('619060527413120496');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 485     SubThreadConfig&lt;TASK_WRAPPER&gt; config = new SubThreadConfig&lt;&gt;();                                      </span>
<span class="1383183623969437207" onmouseenter="enter('1383183623969437207');" onmouseout="out('1383183623969437207');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 486     config.url = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                     </span>
<span class="-2180512157664708444" onmouseenter="enter('-2180512157664708444');" onmouseout="out('-2180512157664708444');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 487     config.tempFile =                                                                                    </span>
<span class="4786837782358626319" onmouseenter="enter('4786837782358626319');" onmouseout="out('4786837782358626319');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 488         mRecord.isBlock ? new File(                                                                      </span>
<span class="-928238364642114529" onmouseenter="enter('-928238364642114529');" onmouseout="out('-928238364642114529');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 489             String.format(RecordHandler.SUB_PATH, mTempFile.getPath(), record.threadId))                 </span>
<span class="-2755374302005590951" onmouseenter="enter('-2755374302005590951');" onmouseout="out('-2755374302005590951');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 490             : mTempFile;                                                                                 </span>
<span class="-3873105131765266571" onmouseenter="enter('-3873105131765266571');" onmouseout="out('-3873105131765266571');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 491     config.isBlock = mRecord.isBlock;                                                                    </span>
<span class="2125632838406943587" onmouseenter="enter('2125632838406943587');" onmouseout="out('2125632838406943587');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 492     config.isOpenDynamicFile = mRecord.isOpenDynamicFile;                                                </span>
<span class="6114090202926236086" onmouseenter="enter('6114090202926236086');" onmouseout="out('6114090202926236086');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 493     config.startThreadNum = startNum;                                                                    </span>
<span class="-4242804732746281982" onmouseenter="enter('-4242804732746281982');" onmouseout="out('-4242804732746281982');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 494     config.taskWrapper = mTaskWrapper;                                                                   </span>
<span class="-4639824013167552343" onmouseenter="enter('-4639824013167552343');" onmouseout="out('-4639824013167552343');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 495     config.record = record;                                                                              </span>
<span class="5396523329299846357" onmouseenter="enter('5396523329299846357');" onmouseout="out('5396523329299846357');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 496     config.stateHandler = mStateHandler;                                                                 </span>
<span class="-3921818352268167442" onmouseenter="enter('-3921818352268167442');" onmouseout="out('-3921818352268167442');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 497     return selectThreadTask(config);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 498   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 499                                                                                                          </span>
<span class="6532423587840407518" onmouseenter="enter('6532423587840407518');" onmouseout="out('6532423587840407518');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 500   private void handleBreakpoint() {                                                                      </span>
<span class="-4822982872266026601" onmouseenter="enter('-4822982872266026601');" onmouseout="out('-4822982872266026601');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 501     long fileLength = mEntity.getFileSize();                                                             </span>
<span class="-23207299311678828" onmouseenter="enter('-23207299311678828');" onmouseout="out('-23207299311678828');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 502     long blockSize = fileLength / mTotalThreadNum;                                                       </span>
<span class="-5411942018384313216" onmouseenter="enter('-5411942018384313216');" onmouseout="out('-5411942018384313216');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 503     long currentProgress = 0;                                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 504                                                                                                          </span>
<span class="575574520788079541" onmouseenter="enter('575574520788079541');" onmouseout="out('575574520788079541');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505     mRecord.fileLength = fileLength;                                                                     </span>
<span class="-8044703341086541865" onmouseenter="enter('-8044703341086541865');" onmouseout="out('-8044703341086541865');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506     if (mTaskWrapper.isNewTask() &amp;&amp; !handleNewTask()) {                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509                                                                                                          </span>
<span class="-4848901962459716543" onmouseenter="enter('-4848901962459716543');" onmouseout="out('-4848901962459716543');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510     int startNum = mRecord.threadNum;                                                                    </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511     for (ThreadRecord tr : mRecord.threadRecords) {                                                      </span>
<span class="23428130114285890" onmouseenter="enter('23428130114285890');" onmouseout="out('23428130114285890');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512       if (!tr.isComplete) {                                                                              </span>
<span class="-4061668182787110636" onmouseenter="enter('-4061668182787110636');" onmouseout="out('-4061668182787110636');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513         startNum++;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516                                                                                                          </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518       long startL = i * blockSize, endL = (i + 1) * blockSize;                                           </span>
<span class="4424666519135617916" onmouseenter="enter('4424666519135617916');" onmouseout="out('4424666519135617916');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519       ThreadRecord tr = mRecord.threadRecords.get(i);                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520                                                                                                          </span>
<span class="-973014210831854259" onmouseenter="enter('-973014210831854259');" onmouseout="out('-973014210831854259');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521       if (tr.isComplete) {//该线程已经完成                                                                      </span>
<span class="180590181413857803" onmouseenter="enter('180590181413857803');" onmouseout="out('180590181413857803');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522         currentProgress += endL - startL;                                                                </span>
<span class="-536040810321338414" onmouseenter="enter('-536040810321338414');" onmouseout="out('-536040810321338414');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523         ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__已完成&quot;, mTaskWrapper.getEntity().getFileName(), i));      </span>
<span class="1740477104282149859" onmouseenter="enter('1740477104282149859');" onmouseout="out('1740477104282149859');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524         mStateHandler.obtainMessage(ThreadStateManager.STATE_COMPLETE).sendToTarget();                   </span>
<span class="2369831997717445711" onmouseenter="enter('2369831997717445711');" onmouseout="out('2369831997717445711');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525         if (mStateManager.isComplete()) {                                                                </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526           mRecord.deleteData();                                                                          </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527           mListener.onComplete();                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529         }                                                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530         continue;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531       }                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532                                                                                                          </span>
<span class="1183688269285295822" onmouseenter="enter('1183688269285295822');" onmouseout="out('1183688269285295822');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533       //如果有记录，则恢复任务                                                                                      </span>
<span class="2244216797309960275" onmouseenter="enter('2244216797309960275');" onmouseout="out('2244216797309960275');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534       long r = tr.startLocation;                                                                         </span>
<span class="-7915611879357930899" onmouseenter="enter('-7915611879357930899');" onmouseout="out('-7915611879357930899');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535       //记录的位置需要在线程区间中                                                                                    </span>
<span class="-3706404109465135132" onmouseenter="enter('-3706404109465135132');" onmouseout="out('-3706404109465135132');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 536       if (startL &lt; r &amp;&amp; r &lt;= (i == (mTotalThreadNum - 1) ? fileLength : endL)) {                         </span>
<span class="9212684671908260751" onmouseenter="enter('9212684671908260751');" onmouseout="out('9212684671908260751');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 537         currentProgress += r - startL;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 538       }                                                                                                  </span>
<span class="5845990765500507783" onmouseenter="enter('5845990765500507783');" onmouseout="out('5845990765500507783');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 539       ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__恢复任务&quot;, mEntity.getFileName(), i));                        </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 540                                                                                                          </span>
<span class="-4760110330380665779" onmouseenter="enter('-4760110330380665779');" onmouseout="out('-4760110330380665779');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 541       AbsThreadTask task = createSingThreadTask(tr, startNum);                                           </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542       if (task == null) return;                                                                          </span>
<span class="7333602866274972902" onmouseenter="enter('7333602866274972902');" onmouseout="out('7333602866274972902');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543       mTask.put(tr.threadId, task);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544     }                                                                                                    </span>
<span class="7288210074172932222" onmouseenter="enter('7288210074172932222');" onmouseout="out('7288210074172932222');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545     if (currentProgress != 0 &amp;&amp; currentProgress != mEntity.getCurrentProgress()) {                       </span>
<span class="4971627158329011933" onmouseenter="enter('4971627158329011933');" onmouseout="out('4971627158329011933');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 546       ALog.d(TAG, String.format(&quot;进度修正，当前进度：%s&quot;, currentProgress));                                       </span>
<span class="5257240383095204746" onmouseenter="enter('5257240383095204746');" onmouseout="out('5257240383095204746');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 547       mEntity.setCurrentProgress(currentProgress);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 548     }                                                                                                    </span>
<span class="-1549239735956086188" onmouseenter="enter('-1549239735956086188');" onmouseout="out('-1549239735956086188');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 549     mStateHandler.obtainMessage(ThreadStateManager.STATE_UPDATE_PROGRESS, currentProgress)               </span>
<span class="543169677106967816" onmouseenter="enter('543169677106967816');" onmouseout="out('543169677106967816');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550         .sendToTarget();                                                                                 </span>
<span class="5226311560826554017" onmouseenter="enter('5226311560826554017');" onmouseout="out('5226311560826554017');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551     startThreadTask();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 552   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 553                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 554   /**                                                                                                    </span>
<span class="3352756078121499684" onmouseenter="enter('3352756078121499684');" onmouseout="out('3352756078121499684');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 555    * 启动单线程任务                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 556    */                                                                                                    </span>
<span class="3368331307598775889" onmouseenter="enter('3368331307598775889');" onmouseout="out('3368331307598775889');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 557   private void startThreadTask() {                                                                       </span>
<span class="-8163448594027824981" onmouseenter="enter('-8163448594027824981');" onmouseout="out('-8163448594027824981');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 558     if (isBreak()) {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 559       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 560     }                                                                                                    </span>
<span class="7098753117484412935" onmouseenter="enter('7098753117484412935');" onmouseout="out('7098753117484412935');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 561     if (mStateManager.getCurrentProgress() &gt; 0) {                                                        </span>
<span class="6109786906910873721" onmouseenter="enter('6109786906910873721');" onmouseout="out('6109786906910873721');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 562       mListener.onResume(mStateManager.getCurrentProgress());                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 563     } else {                                                                                             </span>
<span class="7813115435309058360" onmouseenter="enter('7813115435309058360');" onmouseout="out('7813115435309058360');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 564       mListener.onStart(mStateManager.getCurrentProgress());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 565     }                                                                                                    </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 566     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="-9098026151212374592" onmouseenter="enter('-9098026151212374592');" onmouseout="out('-9098026151212374592');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 567       ThreadTaskManager.getInstance().startThread(mTaskWrapper.getKey(), mTask.get(i));                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 568     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 569   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 570                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 571   /**                                                                                                    </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 572 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="5483762406760822984" onmouseenter="enter('5483762406760822984');" onmouseout="out('5483762406760822984');" style=""> 573    * 重试任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 574    */                                                                                                    </span>
<span class="3179155293949549674" onmouseenter="enter('3179155293949549674');" onmouseout="out('3179155293949549674');" style=""> 575   public void retryTask() {                                                                              </span>
<span class="5921009668313525105" onmouseenter="enter('5921009668313525105');" onmouseout="out('5921009668313525105');" style=""> 576     ALog.w(TAG, String.format(&quot;任务【%s】开始重试&quot;, mEntity.getFileName()));                                     </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 577     startFlow();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 578   }                                                                                                      </span>
<span  style=""> 579                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 580   /**                                                                                                    </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 581 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 582 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 583                                                                                                          </span>
<span class="430507706356584401" onmouseenter="enter('430507706356584401');" onmouseout="out('430507706356584401');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 584   public synchronized boolean isRunning() {                                                              </span>
<span class="-7600400715455113368" onmouseenter="enter('-7600400715455113368');" onmouseout="out('-7600400715455113368');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 585     return ThreadTaskManager.getInstance().taskIsRunning(mTaskWrapper.getKey());                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 586   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 587                                                                                                          </span>
<span class="7466876458085224213" onmouseenter="enter('7466876458085224213');" onmouseout="out('7466876458085224213');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 588   public synchronized void cancel() {                                                                    </span>
<span class="-3806794828534168829" onmouseenter="enter('-3806794828534168829');" onmouseout="out('-3806794828534168829');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 589     ALog.d(TAG, &quot;constance hash: &quot; + mConstance.hashCode());                                             </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 590     if (mConstance.isCancel) {                                                                           </span>
<span class="-5322688094560357059" onmouseenter="enter('-5322688094560357059');" onmouseout="out('-5322688094560357059');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 591       ALog.d(TAG, String.format(&quot;任务【%s】正在删除，删除任务失败&quot;, mTaskWrapper.getKey()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 592       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 593     }                                                                                                    </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 594     closeTimer();                                                                                        </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 595     mConstance.isCancel = true;                                                                          </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 596     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 597       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 598       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 599         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 600       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 601     }                                                                                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 602     ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 603   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 604                                                                                                          </span>
<span class="8656523468118489646" onmouseenter="enter('8656523468118489646');" onmouseout="out('8656523468118489646');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 605   public synchronized void stop() {                                                                      </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 606     if (mConstance.isStop) {                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 607       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 608     }                                                                                                    </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 609     closeTimer();                                                                                        </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 610     mConstance.isStop = true;                                                                            </span>
<span class="8402005296375476854" onmouseenter="enter('8402005296375476854');" onmouseout="out('8402005296375476854');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 611     if (mConstance.isComplete()) return;                                                                 </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 612     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 613       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="-6295419555080725627" onmouseenter="enter('-6295419555080725627');" onmouseout="out('-6295419555080725627');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 614       if (task != null &amp;&amp; !task.isThreadComplete()) {                                                    </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 615         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 616       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 617     }                                                                                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 618     ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 619   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 620                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 621   /**                                                                                                    </span>
<span class="-7218687507933415946" onmouseenter="enter('-7218687507933415946');" onmouseout="out('-7218687507933415946');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 622    * 直接调用的时候会自动启动线程执行                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 623    */                                                                                                    </span>
<span class="-7265432148414046744" onmouseenter="enter('-7265432148414046744');" onmouseout="out('-7265432148414046744');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 624   public synchronized void start() {                                                                     </span>
<span class="6651633619385263409" onmouseenter="enter('6651633619385263409');" onmouseout="out('6651633619385263409');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 625     if (isRunning()) {                                                                                   </span>
<span class="4391999858354318805" onmouseenter="enter('4391999858354318805');" onmouseout="out('4391999858354318805');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 626       ALog.d(TAG, String.format(&quot;任务【%s】正在执行，启动任务失败&quot;, mTaskWrapper.getKey()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 627       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 628     }                                                                                                    </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 629     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 630   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 631                                                                                                          </span>
<span class="5993373674998630219" onmouseenter="enter('5993373674998630219');" onmouseout="out('5993373674998630219');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 632   public void resume() {                                                                                 </span>
<span class="-6183578153083367222" onmouseenter="enter('-6183578153083367222');" onmouseout="out('-6183578153083367222');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 633     start();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 634   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 635                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 636   /**                                                                                                    </span>
<span class="3333036234618128246" onmouseenter="enter('3333036234618128246');" onmouseout="out('3333036234618128246');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 637    * 检查记录 对于分块任务： 子分块不存在或被删除，子线程将重新下载 对于普通任务： 预下载文件不存在，则任务任务呗删除                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 638    */                                                                                                    </span>
<span class="-3226254244315569492" onmouseenter="enter('-3226254244315569492');" onmouseout="out('-3226254244315569492');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 639   private void checkRecord() {                                                                           </span>
<span class="-5297450492380711808" onmouseenter="enter('-5297450492380711808');" onmouseout="out('-5297450492380711808');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 640     mConfigFile = new File(CommonUtil.getFileConfigPath(false, mEntity.getFileName()));                  </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 641     if (mConfigFile.exists()) {                                                                          </span>
<span class="7932310618145443523" onmouseenter="enter('7932310618145443523');" onmouseout="out('7932310618145443523');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 642       convertDb();                                                                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 643     } else {                                                                                             </span>
<span class="4647489036124418098" onmouseenter="enter('4647489036124418098');" onmouseout="out('4647489036124418098');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 644       mRecord = DbDataHelper.getTaskRecord(getFilePath());                                               </span>
<span class="-3299415613061807412" onmouseenter="enter('-3299415613061807412');" onmouseout="out('-3299415613061807412');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 645       if (mRecord == null) {                                                                             </span>
<span class="-6736410795519637054" onmouseenter="enter('-6736410795519637054');" onmouseout="out('-6736410795519637054');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 646         initRecord(true);                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 647       } else {                                                                                           </span>
<span class="-7168613097949101282" onmouseenter="enter('-7168613097949101282');" onmouseout="out('-7168613097949101282');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 648         if (mRecord.threadRecords == null || mRecord.threadRecords.isEmpty()) {                          </span>
<span class="-6736410795519637054" onmouseenter="enter('-6736410795519637054');" onmouseout="out('-6736410795519637054');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 649           initRecord(true);                                                                              </span>
<span class="-5520464134160599469" onmouseenter="enter('-5520464134160599469');" onmouseout="out('-5520464134160599469');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 650         } else if (mRecord.isBlock) {                                                                    </span>
<span class="4499191396384356607" onmouseenter="enter('4499191396384356607');" onmouseout="out('4499191396384356607');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 651           handleBlockRecord();                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 652         } else {                                                                                         </span>
<span class="-7429038303426788124" onmouseenter="enter('-7429038303426788124');" onmouseout="out('-7429038303426788124');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 653           handleNormalRecord();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 654         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 655       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 656     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 657   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 658                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 659   /**                                                                                                    </span>
<span class="-6732733519809936602" onmouseenter="enter('-6732733519809936602');" onmouseout="out('-6732733519809936602');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 660    * 处理普通任务的记录                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 661    */                                                                                                    </span>
<span class="2040790615597773652" onmouseenter="enter('2040790615597773652');" onmouseout="out('2040790615597773652');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 662   private void handleNormalRecord() {                                                                    </span>
<span class="3630450282049316686" onmouseenter="enter('3630450282049316686');" onmouseout="out('3630450282049316686');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 663     File file = new File(mRecord.filePath);                                                              </span>
<span class="4133240422546463755" onmouseenter="enter('4133240422546463755');" onmouseout="out('4133240422546463755');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 664     if (!file.exists()) {                                                                                </span>
<span class="-573220915101280348" onmouseenter="enter('-573220915101280348');" onmouseout="out('-573220915101280348');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 665       ALog.w(TAG, String.format(&quot;文件【%s】不存在，任务将重新开始&quot;, file.getPath()));                                   </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 666       mRecord.deleteData();                                                                              </span>
<span class="-6736410795519637054" onmouseenter="enter('-6736410795519637054');" onmouseout="out('-6736410795519637054');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 667       initRecord(true);                                                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 668       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 669     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 670                                                                                                          </span>
<span class="-5277098832070231051" onmouseenter="enter('-5277098832070231051');" onmouseout="out('-5277098832070231051');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 671     if (mRecord.isOpenDynamicFile) {                                                                     </span>
<span class="2008386981860280225" onmouseenter="enter('2008386981860280225');" onmouseout="out('2008386981860280225');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 672       ThreadRecord tr = mRecord.threadRecords.get(0);                                                    </span>
<span class="8432511455550217781" onmouseenter="enter('8432511455550217781');" onmouseout="out('8432511455550217781');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 673       if (tr == null) {                                                                                  </span>
<span class="4148181859028624217" onmouseenter="enter('4148181859028624217');" onmouseout="out('4148181859028624217');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 674         ALog.d(TAG, &quot;线程记录为空，任务为新任务&quot;);                                                                    </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 675         mTaskWrapper.setNewTask(true);                                                                   </span>
<span class="-7445970306128807043" onmouseenter="enter('-7445970306128807043');" onmouseout="out('-7445970306128807043');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 676         mTotalThreadNum = 1;                                                                             </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 677         return;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 678       }                                                                                                  </span>
<span class="3490117773955769870" onmouseenter="enter('3490117773955769870');" onmouseout="out('3490117773955769870');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 679       if (file.length() &gt; mEntity.getFileSize()) {                                                       </span>
<span class="-282245710257793553" onmouseenter="enter('-282245710257793553');" onmouseout="out('-282245710257793553');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 680         ALog.i(TAG, String.format(&quot;文件【%s】错误，任务重新开始&quot;, file.getPath()));                                   </span>
<span class="1841259700134023722" onmouseenter="enter('1841259700134023722');" onmouseout="out('1841259700134023722');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 681         file.delete();                                                                                   </span>
<span class="1028121270302202149" onmouseenter="enter('1028121270302202149');" onmouseout="out('1028121270302202149');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 682         tr.startLocation = 0;                                                                            </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 683         tr.isComplete = false;                                                                           </span>
<span class="6462437329823623234" onmouseenter="enter('6462437329823623234');" onmouseout="out('6462437329823623234');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 684         tr.endLocation = mEntity.getFileSize();                                                          </span>
<span class="7176785819267604956" onmouseenter="enter('7176785819267604956');" onmouseout="out('7176785819267604956');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 685       } else if (file.length() == mEntity.getFileSize()) {                                               </span>
<span class="6364817192610155634" onmouseenter="enter('6364817192610155634');" onmouseout="out('6364817192610155634');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 686         tr.isComplete = true;                                                                            </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 687         mCompleteThreadNum++;                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 688       } else {                                                                                           </span>
<span class="-3426671339714424" onmouseenter="enter('-3426671339714424');" onmouseout="out('-3426671339714424');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 689         if (file.length() != tr.startLocation) {                                                         </span>
<span class="2922121341147867007" onmouseenter="enter('2922121341147867007');" onmouseout="out('2922121341147867007');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 690           ALog.i(TAG, String.format(&quot;修正【%s】的进度记录为：%s&quot;, file.getPath(), file.length()));                  </span>
<span class="1238856845335327056" onmouseenter="enter('1238856845335327056');" onmouseout="out('1238856845335327056');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 691           tr.startLocation = file.length();                                                              </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 692           tr.isComplete = false;                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 693         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 694       }                                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 695     } else {                                                                                             </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 696       for (ThreadRecord tr : mRecord.threadRecords) {                                                    </span>
<span class="-6249885869558348483" onmouseenter="enter('-6249885869558348483');" onmouseout="out('-6249885869558348483');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 697         if (tr.isComplete) {                                                                             </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 698           mCompleteThreadNum++;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 699         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 700       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 701     }                                                                                                    </span>
<span class="-4812553014330515673" onmouseenter="enter('-4812553014330515673');" onmouseout="out('-4812553014330515673');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 702     mTotalThreadNum = mRecord.threadRecords.size();                                                      </span>
<span class="7955340223234605" onmouseenter="enter('7955340223234605');" onmouseout="out('7955340223234605');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 703     mTaskWrapper.setNewTask(false);                                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 704 =======                                                                                                  </span>
<span class="3489882028140634260" onmouseenter="enter('3489882028140634260');" onmouseout="out('3489882028140634260');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 705    * 处理新任务                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 706    *                                                                                                     </span>
<span class="8941769692798326625" onmouseenter="enter('8941769692798326625');" onmouseout="out('8941769692798326625');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 707    * @return {@code true}创建新任务失败                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 708    */                                                                                                    </span>
<span class="3897453149098456479" onmouseenter="enter('3897453149098456479');" onmouseout="out('3897453149098456479');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 709   protected abstract boolean handleNewTask();                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 710                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711   /**                                                                                                    </span>
<span class="-4404408971562231280" onmouseenter="enter('-4404408971562231280');" onmouseout="out('-4404408971562231280');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712    * 处理不支持断点的任务                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 713    */                                                                                                    </span>
<span class="-8792279366871913220" onmouseenter="enter('-8792279366871913220');" onmouseout="out('-8792279366871913220');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 714   private void handleNoSupportBP() {                                                                     </span>
<span class="33131000937493775" onmouseenter="enter('33131000937493775');" onmouseout="out('33131000937493775');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 715     if (mListener instanceof BaseDListener) {                                                            </span>
<span class="-4047803046141878594" onmouseenter="enter('-4047803046141878594');" onmouseout="out('-4047803046141878594');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 716       ((BaseDListener) mListener).supportBreakpoint(false);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 717     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 718                                                                                                          </span>
<span class="-1616430852182163073" onmouseenter="enter('-1616430852182163073');" onmouseout="out('-1616430852182163073');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 719     AbsThreadTask task = createSingThreadTask(mRecord.threadRecords.get(0), 1);                          </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 720     if (task == null) return;                                                                            </span>
<span class="8048363116921461760" onmouseenter="enter('8048363116921461760');" onmouseout="out('8048363116921461760');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 721     mTask.put(0, task);                                                                                  </span>
<span class="4018208315746033194" onmouseenter="enter('4018208315746033194');" onmouseout="out('4018208315746033194');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 722     ThreadTaskManager.getInstance().startThread(mTaskWrapper.getKey(), task);                            </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 723     mListener.onStart(0);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 724   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 725                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 726   /**                                                                                                    </span>
<span class="5502854491504205724" onmouseenter="enter('5502854491504205724');" onmouseout="out('5502854491504205724');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 727    * 选择单任务线程的类型                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 728    */                                                                                                    </span>
<span class="-6182858214188596124" onmouseenter="enter('-6182858214188596124');" onmouseout="out('-6182858214188596124');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 729   protected abstract AbsThreadTask selectThreadTask(SubThreadConfig&lt;TASK_WRAPPER&gt; config);               </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 730                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 731   /**                                                                                                    </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 732 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="1743516648458284983" onmouseenter="enter('1743516648458284983');" onmouseout="out('1743516648458284983');" style=""> 733    * 任务是否已经中断                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 734    *                                                                                                     </span>
<span class="1049148427197526624" onmouseenter="enter('1049148427197526624');" onmouseout="out('1049148427197526624');" style=""> 735    * @return {@code true}中断                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 736    */                                                                                                    </span>
<span class="-5185153522657566835" onmouseenter="enter('-5185153522657566835');" onmouseout="out('-5185153522657566835');" style=""> 737   public boolean isBreak() {                                                                             </span>
<span class="-1760408404888214576" onmouseenter="enter('-1760408404888214576');" onmouseout="out('-1760408404888214576');" style=""> 738     if (isCancel || isStop) {                                                                            </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 739       closeTimer();                                                                                      </span>
<span class="-93553338069535680" onmouseenter="enter('-93553338069535680');" onmouseout="out('-93553338069535680');" style=""> 740       ALog.d(TAG, String.format(&quot;任务【%s】已停止或取消了&quot;, mEntity.getFileName()));                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 741       return true;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 742     }                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 743     return false;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 744   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 745 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16 package com.arialyy.aria.core.common;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  18 import android.content.Context;                                                                          </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="">  19 import android.os.Handler;                                                                               </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  20 import android.os.Looper;                                                                                </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  21 import android.util.SparseArray;                                                                         </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  22 import com.arialyy.aria.core.AriaManager;                                                                </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  23 import com.arialyy.aria.core.inf.AbsNormalEntity;                                                        </span>
<span class="8472156907075048576" onmouseenter="enter('8472156907075048576');" onmouseout="out('8472156907075048576');" style="">  24 import com.arialyy.aria.core.inf.AbsTaskWrapper;                                                         </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  25 import com.arialyy.aria.core.inf.IEventListener;                                                         </span>
<span class="5965657858743993748" onmouseenter="enter('5965657858743993748');" onmouseout="out('5965657858743993748');" style="">  26 import com.arialyy.aria.core.manager.ThreadTaskManager;                                                  </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  27 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  28 import java.io.File;                                                                                     </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  29 import java.util.concurrent.ScheduledThreadPoolExecutor;                                                 </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  30 import java.util.concurrent.TimeUnit;                                                                    </span>
<span  style="">  31                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  32 /**                                                                                                      </span>
<span class="6972081778092176351" onmouseenter="enter('6972081778092176351');" onmouseout="out('6972081778092176351');" style="">  33  * Created by AriaL on 2017/7/1.                                                                         </span>
<span class="6054556736689943041" onmouseenter="enter('6054556736689943041');" onmouseout="out('6054556736689943041');" style="">  34  * 控制线程任务状态，如：开始，停止，取消，重试                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  35  */                                                                                                      </span>
<span class="4153941248862822664" onmouseenter="enter('4153941248862822664');" onmouseout="out('4153941248862822664');" style=""><abbr title="  36 public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTITY&gt;&gt;">  36 public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTIT🔵</abbr></span>
<span class="4792287397525923935" onmouseenter="enter('4792287397525923935');" onmouseout="out('4792287397525923935');" style="">  37     implements Runnable {                                                                                </span>
<span class="-2630115597350149305" onmouseenter="enter('-2630115597350149305');" onmouseout="out('-2630115597350149305');" style="">  38   protected final String TAG;                                                                            </span>
<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="">  39   protected IEventListener mListener;                                                                    </span>
<span class="4507751527304947270" onmouseenter="enter('4507751527304947270');" onmouseout="out('4507751527304947270');" style="">  40   protected TASK_WRAPPER mTaskWrapper;                                                                   </span>
<span class="8904454574412257163" onmouseenter="enter('8904454574412257163');" onmouseout="out('8904454574412257163');" style="">  41   protected ENTITY mEntity;                                                                              </span>
<span class="-8914417138860252644" onmouseenter="enter('-8914417138860252644');" onmouseout="out('-8914417138860252644');" style="">  42   protected Context mContext;                                                                            </span>
<span class="-2000654363294193028" onmouseenter="enter('-2000654363294193028');" onmouseout="out('-2000654363294193028');" style="">  43   protected File mTempFile;                                                                              </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  44 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  45 ||||||| BASE                                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46                                                                                                          </span>
<span class="-7729852228955968495" onmouseenter="enter('-7729852228955968495');" onmouseout="out('-7729852228955968495');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47   //总线程数                                                                                                 </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  49 =======                                                                                                  </span>
<span class="1387987755988337068" onmouseenter="enter('1387987755988337068');" onmouseout="out('1387987755988337068');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50  //文件                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51                                                                                                          </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style="">  52 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  53 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="1387987755988337068" onmouseenter="enter('1387987755988337068');" onmouseout="out('1387987755988337068');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  54  //文件                                                                                                    </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  55 ||||||| BASE                                                                                             </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  57 =======                                                                                                  </span>
<span class="-7729852228955968495" onmouseenter="enter('-7729852228955968495');" onmouseout="out('-7729852228955968495');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58  //总线程数                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style="">  59 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style="">  60                                                                                                          </span>
<span class="-4844420720547991856" onmouseenter="enter('-4844420720547991856');" onmouseout="out('-4844420720547991856');" style="">  61   private SparseArray&lt;AbsThreadTask&gt; mTask = new SparseArray&lt;&gt;();                                        </span>
<span class="8927193311925096133" onmouseenter="enter('8927193311925096133');" onmouseout="out('8927193311925096133');" style="">  62   private ScheduledThreadPoolExecutor mTimer;                                                            </span>
<span  style="">  63                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  64   /**                                                                                                    </span>
<span class="7539908978715582123" onmouseenter="enter('7539908978715582123');" onmouseout="out('7539908978715582123');" style="">  65    * 进度刷新间隔                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  66    */                                                                                                    </span>
<span class="3897731617107507824" onmouseenter="enter('3897731617107507824');" onmouseout="out('3897731617107507824');" style="">  67   private long mUpdateInterval = 1000;                                                                   </span>
<span class="-3206802593496103666" onmouseenter="enter('-3206802593496103666');" onmouseout="out('-3206802593496103666');" style="">  68   protected TaskRecord mRecord;                                                                          </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  69 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="4056767467165783866" onmouseenter="enter('4056767467165783866');" onmouseout="out('4056767467165783866');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  70 private IThreadState mStateManager;                                                                      </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  71 ||||||| BASE                                                                                             </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  72 =======                                                                                                  </span>
<span class="-6621654726952641912" onmouseenter="enter('-6621654726952641912');" onmouseout="out('-6621654726952641912');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73 private ThreadStateManager mStateManager;                                                                </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style="">  74 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style="">  75                                                                                                          </span>
<span class="8505538020780181250" onmouseenter="enter('8505538020780181250');" onmouseout="out('8505538020780181250');" style="">  76   private Handler mStateHandler;                                                                         </span>
<span class="-1193305157002570511" onmouseenter="enter('-1193305157002570511');" onmouseout="out('-1193305157002570511');" style="">  77   private boolean isCancel = false, isStop = false;                                                      </span>
<span  style="">  78                                                                                                          </span>
<span class="4983484047732255541" onmouseenter="enter('4983484047732255541');" onmouseout="out('4983484047732255541');" style="">  79   protected AbsFileer(IEventListener listener, TASK_WRAPPER wrapper) {                                   </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  80     mListener = listener;                                                                                </span>
<span class="-4483703319181095288" onmouseenter="enter('-4483703319181095288');" onmouseout="out('-4483703319181095288');" style="">  81     mTaskWrapper = wrapper;                                                                              </span>
<span class="-7408997685265206061" onmouseenter="enter('-7408997685265206061');" onmouseout="out('-7408997685265206061');" style="">  82     mEntity = mTaskWrapper.getEntity();                                                                  </span>
<span class="1002707508041764251" onmouseenter="enter('1002707508041764251');" onmouseout="out('1002707508041764251');" style="">  83     mContext = AriaManager.APP;                                                                          </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  84 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-6219919440297129241" onmouseenter="enter('-6219919440297129241');" onmouseout="out('-6219919440297129241');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  85     TAG = CommonUtil.getClassName(getClass());                                                           </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  86 ||||||| BASE                                                                                             </span>
<span class="-3948532274682189145" onmouseenter="enter('-3948532274682189145');" onmouseout="out('-3948532274682189145');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87     mConstance = new StateConstance();                                                                   </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  88 =======                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style="">  89 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90   }                                                                                                      </span>
<span  style="">  91                                                                                                          </span>
<span class="-7037004339700598290" onmouseenter="enter('-7037004339700598290');" onmouseout="out('-7037004339700598290');" style="">  92   protected abstract IThreadState getStateManager(Looper looper);                                        </span>
<span  style="">  93                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  94   /**                                                                                                    </span>
<span class="4265495595238076168" onmouseenter="enter('4265495595238076168');" onmouseout="out('4265495595238076168');" style="">  95    * 处理任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  96    */                                                                                                    </span>
<span class="5239937503155095401" onmouseenter="enter('5239937503155095401');" onmouseout="out('5239937503155095401');" style="">  97   protected abstract void handleTask();                                                                  </span>
<span  style="">  98                                                                                                          </span>
<span class="-8770398782889209035" onmouseenter="enter('-8770398782889209035');" onmouseout="out('-8770398782889209035');" style="">  99   public ENTITY getEntity() {                                                                            </span>
<span class="-2978486956956616380" onmouseenter="enter('-2978486956956616380');" onmouseout="out('-2978486956956616380');" style=""> 100     return mEntity;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101   }                                                                                                      </span>
<span  style=""> 102                                                                                                          </span>
<span class="-5640948235258648086" onmouseenter="enter('-5640948235258648086');" onmouseout="out('-5640948235258648086');" style=""> 103   public SparseArray&lt;AbsThreadTask&gt; getTaskList() {                                                      </span>
<span class="4274533672597507440" onmouseenter="enter('4274533672597507440');" onmouseout="out('4274533672597507440');" style=""> 104     return mTask;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105   }                                                                                                      </span>
<span  style=""> 106                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 107   /**                                                                                                    </span>
<span class="5501330737777447325" onmouseenter="enter('5501330737777447325');" onmouseout="out('5501330737777447325');" style=""> 108    * 重置任务状态                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 109    */                                                                                                    </span>
<span class="769592541207569755" onmouseenter="enter('769592541207569755');" onmouseout="out('769592541207569755');" style=""> 110   private void resetState() {                                                                            </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 111     closeTimer();                                                                                        </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 112 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 113 ||||||| BASE                                                                                             </span>
<span class="-8079256701752176328" onmouseenter="enter('-8079256701752176328');" onmouseout="out('-8079256701752176328');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114     mCompleteThreadNum = 0;                                                                              </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 115 =======                                                                                                  </span>
<span class="-7538891183274876048" onmouseenter="enter('-7538891183274876048');" onmouseout="out('-7538891183274876048');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116     mTotalThreadNum = 0;                                                                                 </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 117 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="86382318944182160" onmouseenter="enter('86382318944182160');" onmouseout="out('86382318944182160');" style=""> 118     if (mTask != null &amp;&amp; mTask.size() != 0) {                                                            </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 119       for (int i = 0; i &lt; mTask.size(); i++) {                                                           </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 120         AbsThreadTask task = mTask.get(i);                                                               </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 121         if (task != null) {                                                                              </span>
<span class="4672639676050941541" onmouseenter="enter('4672639676050941541');" onmouseout="out('4672639676050941541');" style=""> 122           task.breakTask();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124       }                                                                                                  </span>
<span class="-5745867061804924715" onmouseenter="enter('-5745867061804924715');" onmouseout="out('-5745867061804924715');" style=""> 125       mTask.clear();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127   }                                                                                                      </span>
<span  style=""> 128                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 129   /**                                                                                                    </span>
<span class="-8036989040377605484" onmouseenter="enter('-8036989040377605484');" onmouseout="out('-8036989040377605484');" style=""> 130    * 开始流程                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 131    */                                                                                                    </span>
<span class="2659446283962947526" onmouseenter="enter('2659446283962947526');" onmouseout="out('2659446283962947526');" style=""> 132   private void startFlow() {                                                                             </span>
<span class="-8163448594027824981" onmouseenter="enter('-8163448594027824981');" onmouseout="out('-8163448594027824981');" style=""> 133     if (isBreak()) {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 134       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135     }                                                                                                    </span>
<span class="-4000252108766936273" onmouseenter="enter('-4000252108766936273');" onmouseout="out('-4000252108766936273');" style=""> 136     resetState();                                                                                        </span>
<span class="2108596284974852159" onmouseenter="enter('2108596284974852159');" onmouseout="out('2108596284974852159');" style=""> 137     mRecord = new RecordHandler(mTaskWrapper).getRecord();                                               </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 138 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-6826246836562616350" onmouseenter="enter('-6826246836562616350');" onmouseout="out('-6826246836562616350');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 139     Looper.prepare();                                                                                    </span>
<span class="5149694805992184581" onmouseenter="enter('5149694805992184581');" onmouseout="out('5149694805992184581');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 140     Looper looper = Looper.myLooper();                                                                   </span>
<span class="-3253896924586580699" onmouseenter="enter('-3253896924586580699');" onmouseout="out('-3253896924586580699');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 141     mStateManager = getStateManager(looper);                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 142 ||||||| BASE                                                                                             </span>
<span class="-5970803377387365231" onmouseenter="enter('-5970803377387365231');" onmouseout="out('-5970803377387365231');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143     ALog.d(TAG, &quot;path: &quot; + getFilePath());                                                               </span>
<span class="4297169302122369497" onmouseenter="enter('4297169302122369497');" onmouseout="out('4297169302122369497');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144     checkRecord();                                                                                       </span>
<span class="6200019808906550914" onmouseenter="enter('6200019808906550914');" onmouseout="out('6200019808906550914');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145     mConstance.TASK_RECORD = mRecord;                                                                    </span>
<span class="6047746770171298765" onmouseenter="enter('6047746770171298765');" onmouseout="out('6047746770171298765');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146     if (!mTaskWrapper.isSupportBP() || mTaskWrapper.asHttp().isChunked()) {                              </span>
<span class="-7445970306128807043" onmouseenter="enter('-7445970306128807043');" onmouseout="out('-7445970306128807043');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147       mTotalThreadNum = 1;                                                                               </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 148 =======                                                                                                  </span>
<span class="5383386817121006275" onmouseenter="enter('5383386817121006275');" onmouseout="out('5383386817121006275');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149     mTotalThreadNum = mRecord.threadNum;                                                                 </span>
<span class="-6826246836562616350" onmouseenter="enter('-6826246836562616350');" onmouseout="out('-6826246836562616350');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150     Looper.prepare();                                                                                    </span>
<span class="5149694805992184581" onmouseenter="enter('5149694805992184581');" onmouseout="out('5149694805992184581');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151     Looper looper = Looper.myLooper();                                                                   </span>
<span class="7030077118020735892" onmouseenter="enter('7030077118020735892');" onmouseout="out('7030077118020735892');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152     mStateManager = new ThreadStateManager(looper, mRecord, mListener);                                  </span>
<span class="-9214273580559083386" onmouseenter="enter('-9214273580559083386');" onmouseout="out('-9214273580559083386');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153     mStateHandler = new Handler(looper, mStateManager);                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 154 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="6344410794906613415" onmouseenter="enter('6344410794906613415');" onmouseout="out('6344410794906613415');" style=""> 155     onPostPre();                                                                                         </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 156 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 157 ||||||| BASE                                                                                             </span>
<span class="-7445970306128807043" onmouseenter="enter('-7445970306128807043');" onmouseout="out('-7445970306128807043');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158       mTotalThreadNum = 1;                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159     } else {                                                                                             </span>
<span class="-2662097366456595872" onmouseenter="enter('-2662097366456595872');" onmouseout="out('-2662097366456595872');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160       mTotalThreadNum =                                                                                  </span>
<span class="-3369577057112693246" onmouseenter="enter('-3369577057112693246');" onmouseout="out('-3369577057112693246');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161           mTaskWrapper.isNewTask() ? setNewTaskThreadNum() : mTotalThreadNum;                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162     }                                                                                                    </span>
<span class="-5070363508518577757" onmouseenter="enter('-5070363508518577757');" onmouseout="out('-5070363508518577757');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163     mConstance.START_THREAD_NUM = mTotalThreadNum;                                                       </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164                                                                                                          </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 165 =======                                                                                                  </span>
<span class="5989254615436994150" onmouseenter="enter('5989254615436994150');" onmouseout="out('5989254615436994150');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166     if (!mTaskWrapper.isSupportBP()) {                                                                   </span>
<span class="-6182854007095635032" onmouseenter="enter('-6182854007095635032');" onmouseout="out('-6182854007095635032');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167       handleNoSupportBP();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168     } else {                                                                                             </span>
<span class="304482857231090385" onmouseenter="enter('304482857231090385');" onmouseout="out('304482857231090385');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169       handleBreakpoint();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170     }                                                                                                    </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 171 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="-7724548171203838725" onmouseenter="enter('-7724548171203838725');" onmouseout="out('-7724548171203838725');" style=""> 172     startTimer();                                                                                        </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 173 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-5346338694472503069" onmouseenter="enter('-5346338694472503069');" onmouseout="out('-5346338694472503069');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 174     handleTask();                                                                                        </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 175 ||||||| BASE                                                                                             </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176     } else {                                                                                             </span>
<span class="-2662097366456595872" onmouseenter="enter('-2662097366456595872');" onmouseout="out('-2662097366456595872');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177       mTotalThreadNum =                                                                                  </span>
<span class="-3369577057112693246" onmouseenter="enter('-3369577057112693246');" onmouseout="out('-3369577057112693246');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178           mTaskWrapper.isNewTask() ? setNewTaskThreadNum() : mTotalThreadNum;                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179     }                                                                                                    </span>
<span class="-5070363508518577757" onmouseenter="enter('-5070363508518577757');" onmouseout="out('-5070363508518577757');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180     mConstance.START_THREAD_NUM = mTotalThreadNum;                                                       </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181                                                                                                          </span>
<span class="4024149497083933587" onmouseenter="enter('4024149497083933587');" onmouseout="out('4024149497083933587');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182     // 处理分块和动态文件参数                                                                                       </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 183 =======                                                                                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 184 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="7341795500457488125" onmouseenter="enter('7341795500457488125');" onmouseout="out('7341795500457488125');" style=""> 185     Looper.loop();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186   }                                                                                                      </span>
<span  style=""> 187                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 188   @Override public void run() {                                                                          </span>
<span class="6651633619385263409" onmouseenter="enter('6651633619385263409');" onmouseout="out('6651633619385263409');" style=""> 189     if (isRunning()) {                                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 190       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191     }                                                                                                    </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 192     startFlow();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193   }                                                                                                      </span>
<span  style=""> 194                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 195   /**                                                                                                    </span>
<span class="4044787794494402505" onmouseenter="enter('4044787794494402505');" onmouseout="out('4044787794494402505');" style=""> 196    * 预处理完成                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 197    */                                                                                                    </span>
<span class="-5125657304217005566" onmouseenter="enter('-5125657304217005566');" onmouseout="out('-5125657304217005566');" style=""> 198   protected void onPostPre() {                                                                           </span>
<span  style=""> 199                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200   }                                                                                                      </span>
<span  style=""> 201                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 202   /**                                                                                                    </span>
<span class="-8327624174212830499" onmouseenter="enter('-8327624174212830499');" onmouseout="out('-8327624174212830499');" style=""> 203    * 延迟启动定时器                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 204    */                                                                                                    </span>
<span class="2707724463201796910" onmouseenter="enter('2707724463201796910');" onmouseout="out('2707724463201796910');" style=""> 205   protected long delayTimer() {                                                                          </span>
<span class="-5665804692852603146" onmouseenter="enter('-5665804692852603146');" onmouseout="out('-5665804692852603146');" style=""> 206     return 1000;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207   }                                                                                                      </span>
<span  style=""> 208                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 209   /**                                                                                                    </span>
<span class="4041581137177203435" onmouseenter="enter('4041581137177203435');" onmouseout="out('4041581137177203435');" style=""> 210    * 启动进度获取定时器                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 211    */                                                                                                    </span>
<span class="1702258376619356446" onmouseenter="enter('1702258376619356446');" onmouseout="out('1702258376619356446');" style=""> 212   private synchronized void startTimer() {                                                               </span>
<span class="8615364800642373101" onmouseenter="enter('8615364800642373101');" onmouseout="out('8615364800642373101');" style=""> 213     ALog.d(TAG, &quot;启动定时器&quot;);                                                                                </span>
<span class="-9160623214484912914" onmouseenter="enter('-9160623214484912914');" onmouseout="out('-9160623214484912914');" style=""> 214     mTimer = new ScheduledThreadPoolExecutor(1);                                                         </span>
<span class="4344341468621605861" onmouseenter="enter('4344341468621605861');" onmouseout="out('4344341468621605861');" style=""> 215     mTimer.scheduleWithFixedDelay(new Runnable() {                                                       </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 216       @Override public void run() {                                                                      </span>
<span class="-2600099651056425109" onmouseenter="enter('-2600099651056425109');" onmouseout="out('-2600099651056425109');" style=""> 217         if (mStateManager.isComplete()                                                                   </span>
<span class="242988333280989926" onmouseenter="enter('242988333280989926');" onmouseout="out('242988333280989926');" style=""> 218             || mStateManager.isStop()                                                                    </span>
<span class="-9217646883186463915" onmouseenter="enter('-9217646883186463915');" onmouseout="out('-9217646883186463915');" style=""> 219             || mStateManager.isCancel()                                                                  </span>
<span class="-6792138316084162201" onmouseenter="enter('-6792138316084162201');" onmouseout="out('-6792138316084162201');" style=""> 220             || mStateManager.isFail()                                                                    </span>
<span class="1045872412985382023" onmouseenter="enter('1045872412985382023');" onmouseout="out('1045872412985382023');" style=""> 221             || !isRunning()) {                                                                           </span>
<span class="3103159404811065674" onmouseenter="enter('3103159404811065674');" onmouseout="out('3103159404811065674');" style=""> 222           if (mStateManager.isComplete() || mStateManager.isFail()) {                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 223             ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224           }                                                                                              </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 225           closeTimer();                                                                                  </span>
<span class="-8976455106279635226" onmouseenter="enter('-8976455106279635226');" onmouseout="out('-8976455106279635226');" style=""> 226         } else if (mStateManager.getCurrentProgress() &gt;= 0) {                                            </span>
<span class="-7130682954514056925" onmouseenter="enter('-7130682954514056925');" onmouseout="out('-7130682954514056925');" style=""> 227           mListener.onProgress(mStateManager.getCurrentProgress());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 229       }                                                                                                  </span>
<span class="4986548728620604588" onmouseenter="enter('4986548728620604588');" onmouseout="out('4986548728620604588');" style=""> 230     }, delayTimer(), mUpdateInterval, TimeUnit.MILLISECONDS);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 231   }                                                                                                      </span>
<span  style=""> 232                                                                                                          </span>
<span class="3982752692275613073" onmouseenter="enter('3982752692275613073');" onmouseout="out('3982752692275613073');" style=""> 233   public synchronized void closeTimer() {                                                                </span>
<span class="-7001663665090653782" onmouseenter="enter('-7001663665090653782');" onmouseout="out('-7001663665090653782');" style=""> 234     ALog.d(TAG, &quot;关闭定时器&quot;);                                                                                </span>
<span class="-1268142752100378972" onmouseenter="enter('-1268142752100378972');" onmouseout="out('-1268142752100378972');" style=""> 235     if (mTimer != null &amp;&amp; !mTimer.isShutdown()) {                                                        </span>
<span class="4837418556669337408" onmouseenter="enter('4837418556669337408');" onmouseout="out('4837418556669337408');" style=""> 236       mTimer.shutdown();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238   }                                                                                                      </span>
<span  style=""> 239                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 240   /**                                                                                                    </span>
<span class="3310122691908792895" onmouseenter="enter('3310122691908792895');" onmouseout="out('3310122691908792895');" style=""> 241    * 设置定时器更新间隔                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 242    *                                                                                                     </span>
<span class="5926421498368036592" onmouseenter="enter('5926421498368036592');" onmouseout="out('5926421498368036592');" style=""> 243    * @param interval 单位毫秒，不能小于0                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 244    */                                                                                                    </span>
<span class="-6143371944494222779" onmouseenter="enter('-6143371944494222779');" onmouseout="out('-6143371944494222779');" style=""> 245   protected void setUpdateInterval(long interval) {                                                      </span>
<span class="-1051498944097002766" onmouseenter="enter('-1051498944097002766');" onmouseout="out('-1051498944097002766');" style=""> 246     if (interval &lt; 0) {                                                                                  </span>
<span class="3000915396455271078" onmouseenter="enter('3000915396455271078');" onmouseout="out('3000915396455271078');" style=""> 247       ALog.w(TAG, &quot;更新间隔不能小于0，默认为1000毫秒&quot;);                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 248       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249     }                                                                                                    </span>
<span class="-3431322530378656562" onmouseenter="enter('-3431322530378656562');" onmouseout="out('-3431322530378656562');" style=""> 250     mUpdateInterval = interval;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251   }                                                                                                      </span>
<span  style=""> 252                                                                                                          </span>
<span class="-5758762106788202116" onmouseenter="enter('-5758762106788202116');" onmouseout="out('-5758762106788202116');" style=""> 253   public long getFileSize() {                                                                            </span>
<span class="-7902485770489300682" onmouseenter="enter('-7902485770489300682');" onmouseout="out('-7902485770489300682');" style=""> 254     return mEntity.getFileSize();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255   }                                                                                                      </span>
<span  style=""> 256                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 257   /**                                                                                                    </span>
<span class="-7288086523564906780" onmouseenter="enter('-7288086523564906780');" onmouseout="out('-7288086523564906780');" style=""> 258    * 获取当前任务位置                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 259    */                                                                                                    </span>
<span class="3656547772237643757" onmouseenter="enter('3656547772237643757');" onmouseout="out('3656547772237643757');" style=""> 260   public long getCurrentLocation() {                                                                     </span>
<span class="-4293580056549457" onmouseenter="enter('-4293580056549457');" onmouseout="out('-4293580056549457');" style=""> 261     return mStateManager.getCurrentProgress();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262   }                                                                                                      </span>
<span  style=""> 263                                                                                                          </span>
<span class="430507706356584401" onmouseenter="enter('430507706356584401');" onmouseout="out('430507706356584401');" style=""> 264   public synchronized boolean isRunning() {                                                              </span>
<span class="-3888627988187341127" onmouseenter="enter('-3888627988187341127');" onmouseout="out('-3888627988187341127');" style=""> 265     boolean b = ThreadTaskManager.getInstance().taskIsRunning(mTaskWrapper.getKey());                    </span>
<span class="-4055314358126237867" onmouseenter="enter('-4055314358126237867');" onmouseout="out('-4055314358126237867');" style=""> 266     //ALog.d(TAG, &quot;isRunning = &quot; + b);                                                                   </span>
<span class="936248907371687111" onmouseenter="enter('936248907371687111');" onmouseout="out('936248907371687111');" style=""> 267     return b;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268   }                                                                                                      </span>
<span  style=""> 269                                                                                                          </span>
<span class="7466876458085224213" onmouseenter="enter('7466876458085224213');" onmouseout="out('7466876458085224213');" style=""> 270   public synchronized void cancel() {                                                                    </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 271     if (isCancel) {                                                                                      </span>
<span class="-5322688094560357059" onmouseenter="enter('-5322688094560357059');" onmouseout="out('-5322688094560357059');" style=""> 272       ALog.d(TAG, String.format(&quot;任务【%s】正在删除，删除任务失败&quot;, mTaskWrapper.getKey()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 273       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 274     }                                                                                                    </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 275     closeTimer();                                                                                        </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style=""> 276     isCancel = true;                                                                                     </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 277     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 278       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 279       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style=""> 280         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282     }                                                                                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 283     ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284   }                                                                                                      </span>
<span  style=""> 285                                                                                                          </span>
<span class="8656523468118489646" onmouseenter="enter('8656523468118489646');" onmouseout="out('8656523468118489646');" style=""> 286   public synchronized void stop() {                                                                      </span>
<span class="7677583571575855110" onmouseenter="enter('7677583571575855110');" onmouseout="out('7677583571575855110');" style=""> 287     if (isStop) {                                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 288       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289     }                                                                                                    </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 290     closeTimer();                                                                                        </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style=""> 291     isStop = true;                                                                                       </span>
<span class="-7122141514229488110" onmouseenter="enter('-7122141514229488110');" onmouseout="out('-7122141514229488110');" style=""> 292     if (mStateManager.isComplete()) return;                                                              </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 293     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 294       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="-6295419555080725627" onmouseenter="enter('-6295419555080725627');" onmouseout="out('-6295419555080725627');" style=""> 295       if (task != null &amp;&amp; !task.isThreadComplete()) {                                                    </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style=""> 296         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298     }                                                                                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 299     ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300   }                                                                                                      </span>
<span  style=""> 301                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 302   /**                                                                                                    </span>
<span class="-7218687507933415946" onmouseenter="enter('-7218687507933415946');" onmouseout="out('-7218687507933415946');" style=""> 303    * 直接调用的时候会自动启动线程执行                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 304    */                                                                                                    </span>
<span class="-7265432148414046744" onmouseenter="enter('-7265432148414046744');" onmouseout="out('-7265432148414046744');" style=""> 305   public synchronized void start() {                                                                     </span>
<span class="6651633619385263409" onmouseenter="enter('6651633619385263409');" onmouseout="out('6651633619385263409');" style=""> 306     if (isRunning()) {                                                                                   </span>
<span class="4391999858354318805" onmouseenter="enter('4391999858354318805');" onmouseout="out('4391999858354318805');" style=""> 307       ALog.d(TAG, String.format(&quot;任务【%s】正在执行，启动任务失败&quot;, mTaskWrapper.getKey()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 308       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309     }                                                                                                    </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style=""> 310     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311   }                                                                                                      </span>
<span  style=""> 312                                                                                                          </span>
<span class="5993373674998630219" onmouseenter="enter('5993373674998630219');" onmouseout="out('5993373674998630219');" style=""> 313   public void resume() {                                                                                 </span>
<span class="-6183578153083367222" onmouseenter="enter('-6183578153083367222');" onmouseout="out('-6183578153083367222');" style=""> 314     start();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315   }                                                                                                      </span>
<span  style=""> 316                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 317   /**                                                                                                    </span>
<span class="8881300510663389339" onmouseenter="enter('8881300510663389339');" onmouseout="out('8881300510663389339');" style=""> 318    * 启动断点任务时，创建单线程任务                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 319    *                                                                                                     </span>
<span class="-262599314844690395" onmouseenter="enter('-262599314844690395');" onmouseout="out('-262599314844690395');" style=""> 320    * @param record 线程记录                                                                                  </span>
<span class="4692865644996389482" onmouseenter="enter('4692865644996389482');" onmouseout="out('4692865644996389482');" style=""> 321    * @param startNum 启动的线程数                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 322    */                                                                                                    </span>
<span class="6288283959573381778" onmouseenter="enter('6288283959573381778');" onmouseout="out('6288283959573381778');" style=""> 323   private AbsThreadTask createSingThreadTask(ThreadRecord record, int startNum) {                        </span>
<span class="619060527413120496" onmouseenter="enter('619060527413120496');" onmouseout="out('619060527413120496');" style=""> 324     SubThreadConfig&lt;TASK_WRAPPER&gt; config = new SubThreadConfig&lt;&gt;();                                      </span>
<span class="1383183623969437207" onmouseenter="enter('1383183623969437207');" onmouseout="out('1383183623969437207');" style=""> 325     config.url = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                     </span>
<span class="-2180512157664708444" onmouseenter="enter('-2180512157664708444');" onmouseout="out('-2180512157664708444');" style=""> 326     config.tempFile =                                                                                    </span>
<span class="4786837782358626319" onmouseenter="enter('4786837782358626319');" onmouseout="out('4786837782358626319');" style=""> 327         mRecord.isBlock ? new File(                                                                      </span>
<span class="-928238364642114529" onmouseenter="enter('-928238364642114529');" onmouseout="out('-928238364642114529');" style=""> 328             String.format(RecordHandler.SUB_PATH, mTempFile.getPath(), record.threadId))                 </span>
<span class="-2755374302005590951" onmouseenter="enter('-2755374302005590951');" onmouseout="out('-2755374302005590951');" style=""> 329             : mTempFile;                                                                                 </span>
<span class="-3873105131765266571" onmouseenter="enter('-3873105131765266571');" onmouseout="out('-3873105131765266571');" style=""> 330     config.isBlock = mRecord.isBlock;                                                                    </span>
<span class="2125632838406943587" onmouseenter="enter('2125632838406943587');" onmouseout="out('2125632838406943587');" style=""> 331     config.isOpenDynamicFile = mRecord.isOpenDynamicFile;                                                </span>
<span class="6114090202926236086" onmouseenter="enter('6114090202926236086');" onmouseout="out('6114090202926236086');" style=""> 332     config.startThreadNum = startNum;                                                                    </span>
<span class="-4242804732746281982" onmouseenter="enter('-4242804732746281982');" onmouseout="out('-4242804732746281982');" style=""> 333     config.taskWrapper = mTaskWrapper;                                                                   </span>
<span class="-4639824013167552343" onmouseenter="enter('-4639824013167552343');" onmouseout="out('-4639824013167552343');" style=""> 334     config.record = record;                                                                              </span>
<span class="5396523329299846357" onmouseenter="enter('5396523329299846357');" onmouseout="out('5396523329299846357');" style=""> 335     config.stateHandler = mStateHandler;                                                                 </span>
<span class="-3921818352268167442" onmouseenter="enter('-3921818352268167442');" onmouseout="out('-3921818352268167442');" style=""> 336     return selectThreadTask(config);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 337   }                                                                                                      </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 338 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 339 ||||||| BASE                                                                                             </span>
<span class="6532423587840407518" onmouseenter="enter('6532423587840407518');" onmouseout="out('6532423587840407518');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340 private void handleBreakpoint() {                                                                        </span>
<span class="-4822982872266026601" onmouseenter="enter('-4822982872266026601');" onmouseout="out('-4822982872266026601');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341     long fileLength = mEntity.getFileSize();                                                             </span>
<span class="-23207299311678828" onmouseenter="enter('-23207299311678828');" onmouseout="out('-23207299311678828');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342     long blockSize = fileLength / mTotalThreadNum;                                                       </span>
<span class="-3393480437861582877" onmouseenter="enter('-3393480437861582877');" onmouseout="out('-3393480437861582877');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343     Set&lt;Integer&gt; threads = new HashSet&lt;&gt;();                                                              </span>
<span class="-5777658456236299795" onmouseenter="enter('-5777658456236299795');" onmouseout="out('-5777658456236299795');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344     //// 如果是新任务，检查下历史记录，如果有遗留的记录，删除并删除分块文件                                                               </span>
<span class="-4510395139998187778" onmouseenter="enter('-4510395139998187778');" onmouseout="out('-4510395139998187778');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345     //if (mTaskWrapper.isNewTask()) {                                                                    </span>
<span class="6756926677054436789" onmouseenter="enter('6756926677054436789');" onmouseout="out('6756926677054436789');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346     //  CommonUtil.delTaskRecord(getFilePath(), 1, true);                                                </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347     //}                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348                                                                                                          </span>
<span class="575574520788079541" onmouseenter="enter('575574520788079541');" onmouseout="out('575574520788079541');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349     mRecord.fileLength = fileLength;                                                                     </span>
<span class="-8044703341086541865" onmouseenter="enter('-8044703341086541865');" onmouseout="out('-8044703341086541865');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350     if (mTaskWrapper.isNewTask() &amp;&amp; !handleNewTask()) {                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352     }                                                                                                    </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354       long startL = i * blockSize, endL = (i + 1) * blockSize;                                           </span>
<span class="5090177735693834127" onmouseenter="enter('5090177735693834127');" onmouseout="out('5090177735693834127');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355       ThreadRecord tr;                                                                                   </span>
<span class="-7836453111996726628" onmouseenter="enter('-7836453111996726628');" onmouseout="out('-7836453111996726628');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356       boolean isNewTr = false;  // 是否是新的线程记录                                                             </span>
<span class="-4795094782878764344" onmouseenter="enter('-4795094782878764344');" onmouseout="out('-4795094782878764344');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357       if (mTaskWrapper.isNewTask()) {                                                                    </span>
<span class="-1372101013715036968" onmouseenter="enter('-1372101013715036968');" onmouseout="out('-1372101013715036968');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358         tr = new ThreadRecord();                                                                         </span>
<span class="3917749081996930633" onmouseenter="enter('3917749081996930633');" onmouseout="out('3917749081996930633');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359         tr.key = mRecord.filePath;                                                                       </span>
<span class="-7575886392361997801" onmouseenter="enter('-7575886392361997801');" onmouseout="out('-7575886392361997801');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360         tr.threadId = i;                                                                                 </span>
<span class="3085824084899250864" onmouseenter="enter('3085824084899250864');" onmouseout="out('3085824084899250864');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361         isNewTr = true;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362       } else {                                                                                           </span>
<span class="-548726359565759652" onmouseenter="enter('-548726359565759652');" onmouseout="out('-548726359565759652');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363         tr = mRecord.threadRecords.get(i);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364       }                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365                                                                                                          </span>
<span class="-9126208292322323685" onmouseenter="enter('-9126208292322323685');" onmouseout="out('-9126208292322323685');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366       if (tr.blockLen == 0) {                                                                            </span>
<span class="-4142305526048218013" onmouseenter="enter('-4142305526048218013');" onmouseout="out('-4142305526048218013');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367         tr.blockLen = CommonUtil.getBlockLen(fileLength, i, mTotalThreadNum);                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368       }                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369                                                                                                          </span>
<span class="-973014210831854259" onmouseenter="enter('-973014210831854259');" onmouseout="out('-973014210831854259');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370       if (tr.isComplete) {//该线程已经完成                                                                      </span>
<span class="5189294880655919692" onmouseenter="enter('5189294880655919692');" onmouseout="out('5189294880655919692');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371         if (resumeRecordLocation(i, startL, endL)) return;                                               </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372         continue;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373       }                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 374                                                                                                          </span>
<span class="1183688269285295822" onmouseenter="enter('1183688269285295822');" onmouseout="out('1183688269285295822');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 375       //如果有记录，则恢复任务                                                                                      </span>
<span class="-9174570816963057194" onmouseenter="enter('-9174570816963057194');" onmouseout="out('-9174570816963057194');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 376       if (tr.startLocation &gt; 0) {                                                                        </span>
<span class="2244216797309960275" onmouseenter="enter('2244216797309960275');" onmouseout="out('2244216797309960275');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377         long r = tr.startLocation;                                                                       </span>
<span class="-7915611879357930899" onmouseenter="enter('-7915611879357930899');" onmouseout="out('-7915611879357930899');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 378         //记录的位置需要在线程区间中                                                                                  </span>
<span class="-3706404109465135132" onmouseenter="enter('-3706404109465135132');" onmouseout="out('-3706404109465135132');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379         if (startL &lt; r &amp;&amp; r &lt;= (i == (mTotalThreadNum - 1) ? fileLength : endL)) {                       </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 380           mConstance.CURRENT_LOCATION += r - startL;                                                     </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 381           startL = r;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382         }                                                                                                </span>
<span class="5845990765500507783" onmouseenter="enter('5845990765500507783');" onmouseout="out('5845990765500507783');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383         ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__恢复任务&quot;, mEntity.getFileName(), i));                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384       } else {                                                                                           </span>
<span class="635736622332337160" onmouseenter="enter('635736622332337160');" onmouseout="out('635736622332337160');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385         tr.startLocation = startL;                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386       }                                                                                                  </span>
<span class="7194952027883197425" onmouseenter="enter('7194952027883197425');" onmouseout="out('7194952027883197425');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387       //最后一个线程的结束位置即为文件的总长度                                                                              </span>
<span class="-5942950699866528890" onmouseenter="enter('-5942950699866528890');" onmouseout="out('-5942950699866528890');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388       if (i == (mTotalThreadNum - 1)) {                                                                  </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389         endL = fileLength;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390       }                                                                                                  </span>
<span class="9008536478346595299" onmouseenter="enter('9008536478346595299');" onmouseout="out('9008536478346595299');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391       if (tr.endLocation &lt;= 0) {                                                                         </span>
<span class="-8820011367691672414" onmouseenter="enter('-8820011367691672414');" onmouseout="out('-8820011367691672414');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392         tr.endLocation = endL;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393       }                                                                                                  </span>
<span class="-5584934139293502444" onmouseenter="enter('-5584934139293502444');" onmouseout="out('-5584934139293502444');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394       if (isNewTr) {                                                                                     </span>
<span class="7750338393456465672" onmouseenter="enter('7750338393456465672');" onmouseout="out('7750338393456465672');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395         mRecord.threadRecords.add(tr);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396       }                                                                                                  </span>
<span class="-7040830845063557440" onmouseenter="enter('-7040830845063557440');" onmouseout="out('-7040830845063557440');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397       //ALog.d(TAG, String.format(&quot;创建任务线程：%s，线程总数：%s&quot;, i, mTotalThreadNum));                             </span>
<span class="6319026600890011419" onmouseenter="enter('6319026600890011419');" onmouseout="out('6319026600890011419');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398       AbsThreadTask task = createSingThreadTask(i, startL, endL, fileLength, tr);                        </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399       if (task == null) return;                                                                          </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400       mTask.put(i, task);                                                                                </span>
<span class="4583095755176113317" onmouseenter="enter('4583095755176113317');" onmouseout="out('4583095755176113317');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401       threads.add(i);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402     }                                                                                                    </span>
<span class="290274778352054232" onmouseenter="enter('290274778352054232');" onmouseout="out('290274778352054232');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403     if (mConstance.CURRENT_LOCATION != 0                                                                 </span>
<span class="8899125546582658120" onmouseenter="enter('8899125546582658120');" onmouseout="out('8899125546582658120');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404         &amp;&amp; mConstance.CURRENT_LOCATION != mEntity.getCurrentProgress()) {                                </span>
<span class="-6641501506845691208" onmouseenter="enter('-6641501506845691208');" onmouseout="out('-6641501506845691208');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405       ALog.d(TAG, String.format(&quot;进度修正，当前进度：%s&quot;, mConstance.CURRENT_LOCATION));                           </span>
<span class="480370803854164555" onmouseenter="enter('480370803854164555');" onmouseout="out('480370803854164555');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406       mEntity.setCurrentProgress(mConstance.CURRENT_LOCATION);                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407     }                                                                                                    </span>
<span class="-4447853798640415053" onmouseenter="enter('-4447853798640415053');" onmouseout="out('-4447853798640415053');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408     saveRecord();                                                                                        </span>
<span class="520458791074877981" onmouseenter="enter('520458791074877981');" onmouseout="out('520458791074877981');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409     startThreadTask(threads);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410   }                                                                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 411 =======                                                                                                  </span>
<span class="6532423587840407518" onmouseenter="enter('6532423587840407518');" onmouseout="out('6532423587840407518');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412 private void handleBreakpoint() {                                                                        </span>
<span class="-4822982872266026601" onmouseenter="enter('-4822982872266026601');" onmouseout="out('-4822982872266026601');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413     long fileLength = mEntity.getFileSize();                                                             </span>
<span class="-23207299311678828" onmouseenter="enter('-23207299311678828');" onmouseout="out('-23207299311678828');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414     long blockSize = fileLength / mTotalThreadNum;                                                       </span>
<span class="-5411942018384313216" onmouseenter="enter('-5411942018384313216');" onmouseout="out('-5411942018384313216');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 415     long currentProgress = 0;                                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416                                                                                                          </span>
<span class="575574520788079541" onmouseenter="enter('575574520788079541');" onmouseout="out('575574520788079541');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417     mRecord.fileLength = fileLength;                                                                     </span>
<span class="-8044703341086541865" onmouseenter="enter('-8044703341086541865');" onmouseout="out('-8044703341086541865');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418     if (mTaskWrapper.isNewTask() &amp;&amp; !handleNewTask()) {                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 421                                                                                                          </span>
<span class="-4848901962459716543" onmouseenter="enter('-4848901962459716543');" onmouseout="out('-4848901962459716543');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422     int startNum = mRecord.threadNum;                                                                    </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423     for (ThreadRecord tr : mRecord.threadRecords) {                                                      </span>
<span class="23428130114285890" onmouseenter="enter('23428130114285890');" onmouseout="out('23428130114285890');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424       if (!tr.isComplete) {                                                                              </span>
<span class="-4061668182787110636" onmouseenter="enter('-4061668182787110636');" onmouseout="out('-4061668182787110636');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425         startNum++;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 426       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 428                                                                                                          </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430       long startL = i * blockSize, endL = (i + 1) * blockSize;                                           </span>
<span class="4424666519135617916" onmouseenter="enter('4424666519135617916');" onmouseout="out('4424666519135617916');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431       ThreadRecord tr = mRecord.threadRecords.get(i);                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432                                                                                                          </span>
<span class="-973014210831854259" onmouseenter="enter('-973014210831854259');" onmouseout="out('-973014210831854259');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433       if (tr.isComplete) {//该线程已经完成                                                                      </span>
<span class="180590181413857803" onmouseenter="enter('180590181413857803');" onmouseout="out('180590181413857803');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434         currentProgress += endL - startL;                                                                </span>
<span class="-536040810321338414" onmouseenter="enter('-536040810321338414');" onmouseout="out('-536040810321338414');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435         ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__已完成&quot;, mTaskWrapper.getEntity().getFileName(), i));      </span>
<span class="1740477104282149859" onmouseenter="enter('1740477104282149859');" onmouseout="out('1740477104282149859');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436         mStateHandler.obtainMessage(ThreadStateManager.STATE_COMPLETE).sendToTarget();                   </span>
<span class="2369831997717445711" onmouseenter="enter('2369831997717445711');" onmouseout="out('2369831997717445711');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437         if (mStateManager.isComplete()) {                                                                </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438           mRecord.deleteData();                                                                          </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439           mListener.onComplete();                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441         }                                                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442         continue;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443       }                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444                                                                                                          </span>
<span class="1183688269285295822" onmouseenter="enter('1183688269285295822');" onmouseout="out('1183688269285295822');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 445       //如果有记录，则恢复任务                                                                                      </span>
<span class="2244216797309960275" onmouseenter="enter('2244216797309960275');" onmouseout="out('2244216797309960275');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 446       long r = tr.startLocation;                                                                         </span>
<span class="-7915611879357930899" onmouseenter="enter('-7915611879357930899');" onmouseout="out('-7915611879357930899');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 447       //记录的位置需要在线程区间中                                                                                    </span>
<span class="-3706404109465135132" onmouseenter="enter('-3706404109465135132');" onmouseout="out('-3706404109465135132');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 448       if (startL &lt; r &amp;&amp; r &lt;= (i == (mTotalThreadNum - 1) ? fileLength : endL)) {                         </span>
<span class="9212684671908260751" onmouseenter="enter('9212684671908260751');" onmouseout="out('9212684671908260751');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 449         currentProgress += r - startL;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 450       }                                                                                                  </span>
<span class="5845990765500507783" onmouseenter="enter('5845990765500507783');" onmouseout="out('5845990765500507783');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 451       ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__恢复任务&quot;, mEntity.getFileName(), i));                        </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 452                                                                                                          </span>
<span class="-4760110330380665779" onmouseenter="enter('-4760110330380665779');" onmouseout="out('-4760110330380665779');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 453       AbsThreadTask task = createSingThreadTask(tr, startNum);                                           </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 454       if (task == null) return;                                                                          </span>
<span class="7333602866274972902" onmouseenter="enter('7333602866274972902');" onmouseout="out('7333602866274972902');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 455       mTask.put(tr.threadId, task);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 456     }                                                                                                    </span>
<span class="7288210074172932222" onmouseenter="enter('7288210074172932222');" onmouseout="out('7288210074172932222');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 457     if (currentProgress != 0 &amp;&amp; currentProgress != mEntity.getCurrentProgress()) {                       </span>
<span class="4971627158329011933" onmouseenter="enter('4971627158329011933');" onmouseout="out('4971627158329011933');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 458       ALog.d(TAG, String.format(&quot;进度修正，当前进度：%s&quot;, currentProgress));                                       </span>
<span class="5257240383095204746" onmouseenter="enter('5257240383095204746');" onmouseout="out('5257240383095204746');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 459       mEntity.setCurrentProgress(currentProgress);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 460     }                                                                                                    </span>
<span class="-1549239735956086188" onmouseenter="enter('-1549239735956086188');" onmouseout="out('-1549239735956086188');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 461     mStateHandler.obtainMessage(ThreadStateManager.STATE_UPDATE_PROGRESS, currentProgress)               </span>
<span class="543169677106967816" onmouseenter="enter('543169677106967816');" onmouseout="out('543169677106967816');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 462         .sendToTarget();                                                                                 </span>
<span class="5226311560826554017" onmouseenter="enter('5226311560826554017');" onmouseout="out('5226311560826554017');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 463     startThreadTask();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 464   }                                                                                                      </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 465 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 466                                                                                                          </span>
<span  style=""> 467                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 468   /**                                                                                                    </span>
<span class="3352756078121499684" onmouseenter="enter('3352756078121499684');" onmouseout="out('3352756078121499684');" style=""> 469    * 启动单线程任务                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 470    */                                                                                                    </span>
<span class="3368331307598775889" onmouseenter="enter('3368331307598775889');" onmouseout="out('3368331307598775889');" style=""> 471   private void startThreadTask() {                                                                       </span>
<span class="-8163448594027824981" onmouseenter="enter('-8163448594027824981');" onmouseout="out('-8163448594027824981');" style=""> 472     if (isBreak()) {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 473       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 474     }                                                                                                    </span>
<span class="7098753117484412935" onmouseenter="enter('7098753117484412935');" onmouseout="out('7098753117484412935');" style=""> 475     if (mStateManager.getCurrentProgress() &gt; 0) {                                                        </span>
<span class="6109786906910873721" onmouseenter="enter('6109786906910873721');" onmouseout="out('6109786906910873721');" style=""> 476       mListener.onResume(mStateManager.getCurrentProgress());                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 477     } else {                                                                                             </span>
<span class="7813115435309058360" onmouseenter="enter('7813115435309058360');" onmouseout="out('7813115435309058360');" style=""> 478       mListener.onStart(mStateManager.getCurrentProgress());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 479     }                                                                                                    </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 480     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="-9098026151212374592" onmouseenter="enter('-9098026151212374592');" onmouseout="out('-9098026151212374592');" style=""> 481       ThreadTaskManager.getInstance().startThread(mTaskWrapper.getKey(), mTask.get(i));                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 482     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 483   }                                                                                                      </span>
<span  style=""> 484                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 485   /**                                                                                                    </span>
<span class="5483762406760822984" onmouseenter="enter('5483762406760822984');" onmouseout="out('5483762406760822984');" style=""> 486    * 重试任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 487    */                                                                                                    </span>
<span class="3179155293949549674" onmouseenter="enter('3179155293949549674');" onmouseout="out('3179155293949549674');" style=""> 488   public void retryTask() {                                                                              </span>
<span class="5921009668313525105" onmouseenter="enter('5921009668313525105');" onmouseout="out('5921009668313525105');" style=""> 489     ALog.w(TAG, String.format(&quot;任务【%s】开始重试&quot;, mEntity.getFileName()));                                     </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 490     startFlow();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 491   }                                                                                                      </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 492 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 493 ||||||| BASE                                                                                             </span>
<span class="-8792279366871913220" onmouseenter="enter('-8792279366871913220');" onmouseout="out('-8792279366871913220');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 494 private void handleNoSupportBP() {                                                                       </span>
<span class="33131000937493775" onmouseenter="enter('33131000937493775');" onmouseout="out('33131000937493775');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 495     if (mListener instanceof BaseDListener) {                                                            </span>
<span class="-4047803046141878594" onmouseenter="enter('-4047803046141878594');" onmouseout="out('-4047803046141878594');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 496       ((BaseDListener) mListener).supportBreakpoint(false);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497     }                                                                                                    </span>
<span class="619060527413120496" onmouseenter="enter('619060527413120496');" onmouseout="out('619060527413120496');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498     SubThreadConfig&lt;TASK_WRAPPER&gt; config = new SubThreadConfig&lt;&gt;();                                      </span>
<span class="5914737473662302802" onmouseenter="enter('5914737473662302802');" onmouseout="out('5914737473662302802');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499     config.TOTAL_FILE_SIZE = mEntity.getFileSize();                                                      </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500     config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                     </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501     config.TEMP_FILE = mTempFile;                                                                        </span>
<span class="-5899809357890352135" onmouseenter="enter('-5899809357890352135');" onmouseout="out('-5899809357890352135');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 502     config.THREAD_ID = 0;                                                                                </span>
<span class="7958711547477559333" onmouseenter="enter('7958711547477559333');" onmouseout="out('7958711547477559333');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 503     config.START_LOCATION = 0;                                                                           </span>
<span class="747053779851311386" onmouseenter="enter('747053779851311386');" onmouseout="out('747053779851311386');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 504     config.END_LOCATION = config.TOTAL_FILE_SIZE;                                                        </span>
<span class="6707181570367944829" onmouseenter="enter('6707181570367944829');" onmouseout="out('6707181570367944829');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 505     config.SUPPORT_BP = mTaskWrapper.isSupportBP();                                                      </span>
<span class="-4458980325189718812" onmouseenter="enter('-4458980325189718812');" onmouseout="out('-4458980325189718812');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 506     config.TASK_WRAPPER = mTaskWrapper;                                                                  </span>
<span class="8051738883997329022" onmouseenter="enter('8051738883997329022');" onmouseout="out('8051738883997329022');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 507     ThreadRecord record = DbEntity.findFirst(ThreadRecord.class, &quot;key=?&quot;, mRecord.filePath);             </span>
<span class="2652986304939921073" onmouseenter="enter('2652986304939921073');" onmouseout="out('2652986304939921073');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 508     if (record != null) {                                                                                </span>
<span class="7377969291689599090" onmouseenter="enter('7377969291689599090');" onmouseout="out('7377969291689599090');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 509       record.deleteData();                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 510     }                                                                                                    </span>
<span class="3763585654065879367" onmouseenter="enter('3763585654065879367');" onmouseout="out('3763585654065879367');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 511     record = new ThreadRecord();                                                                         </span>
<span class="8888392257982082951" onmouseenter="enter('8888392257982082951');" onmouseout="out('8888392257982082951');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 512     record.startLocation = 0;                                                                            </span>
<span class="-7637475387427293760" onmouseenter="enter('-7637475387427293760');" onmouseout="out('-7637475387427293760');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 513     record.endLocation = config.TOTAL_FILE_SIZE;                                                         </span>
<span class="3029329660257706333" onmouseenter="enter('3029329660257706333');" onmouseout="out('3029329660257706333');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 514     record.key = mTempFile.getPath();                                                                    </span>
<span class="2907574057970886296" onmouseenter="enter('2907574057970886296');" onmouseout="out('2907574057970886296');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 515     mRecord.threadRecords.add(record);                                                                   </span>
<span class="-4817448612298280426" onmouseenter="enter('-4817448612298280426');" onmouseout="out('-4817448612298280426');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 516     config.THREAD_RECORD = record;                                                                       </span>
<span class="-5296271627358693026" onmouseenter="enter('-5296271627358693026');" onmouseout="out('-5296271627358693026');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 517     AbsThreadTask task = selectThreadTask(config);                                                       </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 518     if (task == null) return;                                                                            </span>
<span class="8048363116921461760" onmouseenter="enter('8048363116921461760');" onmouseout="out('8048363116921461760');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 519     mTask.put(0, task);                                                                                  </span>
<span class="-4447853798640415053" onmouseenter="enter('-4447853798640415053');" onmouseout="out('-4447853798640415053');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 520     saveRecord();                                                                                        </span>
<span class="4018208315746033194" onmouseenter="enter('4018208315746033194');" onmouseout="out('4018208315746033194');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 521     ThreadTaskManager.getInstance().startThread(mTaskWrapper.getKey(), task);                            </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 522     mListener.onStart(0);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 523   }                                                                                                      </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 524 =======                                                                                                  </span>
<span class="-8792279366871913220" onmouseenter="enter('-8792279366871913220');" onmouseout="out('-8792279366871913220');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525 private void handleNoSupportBP() {                                                                       </span>
<span class="33131000937493775" onmouseenter="enter('33131000937493775');" onmouseout="out('33131000937493775');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526     if (mListener instanceof BaseDListener) {                                                            </span>
<span class="-4047803046141878594" onmouseenter="enter('-4047803046141878594');" onmouseout="out('-4047803046141878594');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527       ((BaseDListener) mListener).supportBreakpoint(false);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529                                                                                                          </span>
<span class="-1616430852182163073" onmouseenter="enter('-1616430852182163073');" onmouseout="out('-1616430852182163073');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530     AbsThreadTask task = createSingThreadTask(mRecord.threadRecords.get(0), 1);                          </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531     if (task == null) return;                                                                            </span>
<span class="8048363116921461760" onmouseenter="enter('8048363116921461760');" onmouseout="out('8048363116921461760');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532     mTask.put(0, task);                                                                                  </span>
<span class="4018208315746033194" onmouseenter="enter('4018208315746033194');" onmouseout="out('4018208315746033194');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533     ThreadTaskManager.getInstance().startThread(mTaskWrapper.getKey(), task);                            </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534     mListener.onStart(0);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535   }                                                                                                      </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 536 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span  style=""> 537                                                                                                          </span>
<span  style=""> 538                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 539   /**                                                                                                    </span>
<span class="1743516648458284983" onmouseenter="enter('1743516648458284983');" onmouseout="out('1743516648458284983');" style=""> 540    * 任务是否已经中断                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 541    *                                                                                                     </span>
<span class="1049148427197526624" onmouseenter="enter('1049148427197526624');" onmouseout="out('1049148427197526624');" style=""> 542    * @return {@code true}中断                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 543    */                                                                                                    </span>
<span class="-5185153522657566835" onmouseenter="enter('-5185153522657566835');" onmouseout="out('-5185153522657566835');" style=""> 544   public boolean isBreak() {                                                                             </span>
<span class="-1760408404888214576" onmouseenter="enter('-1760408404888214576');" onmouseout="out('-1760408404888214576');" style=""> 545     if (isCancel || isStop) {                                                                            </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 546       closeTimer();                                                                                      </span>
<span class="-93553338069535680" onmouseenter="enter('-93553338069535680');" onmouseout="out('-93553338069535680');" style=""> 547       ALog.d(TAG, String.format(&quot;任务【%s】已停止或取消了&quot;, mEntity.getFileName()));                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 548       return true;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 549     }                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 550     return false;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 551   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 552 }                                                                                                        </span>































































































































































































</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16 package com.arialyy.aria.core.common;                                                                    </span>
<span  style="">  17                                                                                                          </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  18 import android.content.Context;                                                                          </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="">  19 import android.os.Handler;                                                                               </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="">  20 import android.os.Looper;                                                                                </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  21 import android.util.SparseArray;                                                                         </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  22 import com.arialyy.aria.core.AriaManager;                                                                </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  23 import com.arialyy.aria.core.inf.AbsNormalEntity;                                                        </span>
<span class="8472156907075048576" onmouseenter="enter('8472156907075048576');" onmouseout="out('8472156907075048576');" style="">  24 import com.arialyy.aria.core.inf.AbsTaskWrapper;                                                         </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  25 import com.arialyy.aria.core.inf.IEventListener;                                                         </span>
<span class="5965657858743993748" onmouseenter="enter('5965657858743993748');" onmouseout="out('5965657858743993748');" style="">  26 import com.arialyy.aria.core.manager.ThreadTaskManager;                                                  </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  27 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  28 import java.io.File;                                                                                     </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  29 import java.util.concurrent.ScheduledThreadPoolExecutor;                                                 </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  30 import java.util.concurrent.TimeUnit;                                                                    </span>
<span  style="">  31                                                                                                          </span>
<span  style="">  32                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  33 /**                                                                                                      </span>
<span class="6972081778092176351" onmouseenter="enter('6972081778092176351');" onmouseout="out('6972081778092176351');" style="">  34  * Created by AriaL on 2017/7/1.                                                                         </span>
<span class="6054556736689943041" onmouseenter="enter('6054556736689943041');" onmouseout="out('6054556736689943041');" style="">  35  * 控制线程任务状态，如：开始，停止，取消，重试                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  36  */                                                                                                      </span>
<span class="4153941248862822664" onmouseenter="enter('4153941248862822664');" onmouseout="out('4153941248862822664');" style=""><abbr title="  37 public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTITY&gt;&gt;">  37 public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTIT🔵</abbr></span>
<span class="4792287397525923935" onmouseenter="enter('4792287397525923935');" onmouseout="out('4792287397525923935');" style="">  38     implements Runnable {                                                                                </span>
<span  style="">  39                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style="">  40 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-2630115597350149305" onmouseenter="enter('-2630115597350149305');" onmouseout="out('-2630115597350149305');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  41   protected final String TAG;                                                                            </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  42                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  43 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  44 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">  44 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  45 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  46                                                                                                          </span>
<span class="7185037452507187216" onmouseenter="enter('7185037452507187216');" onmouseout="out('7185037452507187216');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  47   private final String TAG = &quot;AbsFileer&quot;;                                                                </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  48                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style="">  49 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="">  50   protected IEventListener mListener;                                                                    </span>
<span class="4507751527304947270" onmouseenter="enter('4507751527304947270');" onmouseout="out('4507751527304947270');" style="">  51   protected TASK_WRAPPER mTaskWrapper;                                                                   </span>
<span class="8904454574412257163" onmouseenter="enter('8904454574412257163');" onmouseout="out('8904454574412257163');" style="">  52   protected ENTITY mEntity;                                                                              </span>
<span class="-8914417138860252644" onmouseenter="enter('-8914417138860252644');" onmouseout="out('-8914417138860252644');" style="">  53   protected Context mContext;                                                                            </span>
<span class="3740841846621187936" onmouseenter="enter('3740841846621187936');" onmouseout="out('3740841846621187936');" style="">  54   protected File mTempFile; //文件                                                                         </span>
<span  style="">  55                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style="">  56 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  57                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  58 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  59 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">  59 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  60 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61                                                                                                          </span>
<span class="7749320607782706378" onmouseenter="enter('7749320607782706378');" onmouseout="out('7749320607782706378');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62   protected int mTotalThreadNum; //总线程数                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style="">  64 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style="">  65                                                                                                          </span>
<span class="-4844420720547991856" onmouseenter="enter('-4844420720547991856');" onmouseout="out('-4844420720547991856');" style="">  66   private SparseArray&lt;AbsThreadTask&gt; mTask = new SparseArray&lt;&gt;();                                        </span>
<span class="8927193311925096133" onmouseenter="enter('8927193311925096133');" onmouseout="out('8927193311925096133');" style="">  67   private ScheduledThreadPoolExecutor mTimer;                                                            </span>
<span  style="">  68                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  69   /**                                                                                                    </span>
<span class="7539908978715582123" onmouseenter="enter('7539908978715582123');" onmouseout="out('7539908978715582123');" style="">  70    * 进度刷新间隔                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  71    */                                                                                                    </span>
<span class="3897731617107507824" onmouseenter="enter('3897731617107507824');" onmouseout="out('3897731617107507824');" style="">  72   private long mUpdateInterval = 1000;                                                                   </span>
<span class="-3206802593496103666" onmouseenter="enter('-3206802593496103666');" onmouseout="out('-3206802593496103666');" style="">  73   protected TaskRecord mRecord;                                                                          </span>
<span  style="">  74                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style="">  75 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="4056767467165783866" onmouseenter="enter('4056767467165783866');" onmouseout="out('4056767467165783866');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76   private IThreadState mStateManager;                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  77                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  78 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  79 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">  79 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  80 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81                                                                                                          </span>
<span class="-6621654726952641912" onmouseenter="enter('-6621654726952641912');" onmouseout="out('-6621654726952641912');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82   private ThreadStateManager mStateManager;                                                              </span>
<span class="8505538020780181250" onmouseenter="enter('8505538020780181250');" onmouseout="out('8505538020780181250');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83   private Handler mStateHandler;                                                                         </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style="">  85 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-1193305157002570511" onmouseenter="enter('-1193305157002570511');" onmouseout="out('-1193305157002570511');" style="">  86   private boolean isCancel = false, isStop = false;                                                      </span>
<span  style="">  87                                                                                                          </span>
<span class="4983484047732255541" onmouseenter="enter('4983484047732255541');" onmouseout="out('4983484047732255541');" style="">  88   protected AbsFileer(IEventListener listener, TASK_WRAPPER wrapper) {                                   </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  89     mListener = listener;                                                                                </span>
<span class="-4483703319181095288" onmouseenter="enter('-4483703319181095288');" onmouseout="out('-4483703319181095288');" style="">  90     mTaskWrapper = wrapper;                                                                              </span>
<span class="-7408997685265206061" onmouseenter="enter('-7408997685265206061');" onmouseout="out('-7408997685265206061');" style="">  91     mEntity = mTaskWrapper.getEntity();                                                                  </span>
<span class="1002707508041764251" onmouseenter="enter('1002707508041764251');" onmouseout="out('1002707508041764251');" style="">  92     mContext = AriaManager.APP;                                                                          </span>
<span  style="">  93                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style="">  94 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-6219919440297129241" onmouseenter="enter('-6219919440297129241');" onmouseout="out('-6219919440297129241');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  95     TAG = CommonUtil.getClassName(getClass());                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  96   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  97                                                                                                          </span>
<span class="-7037004339700598290" onmouseenter="enter('-7037004339700598290');" onmouseout="out('-7037004339700598290');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  98   protected abstract IThreadState getStateManager(Looper looper);                                        </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  99                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 100   /**                                                                                                    </span>
<span class="4265495595238076168" onmouseenter="enter('4265495595238076168');" onmouseout="out('4265495595238076168');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 101    * 处理任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 102    */                                                                                                    </span>
<span class="5239937503155095401" onmouseenter="enter('5239937503155095401');" onmouseout="out('5239937503155095401');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 103   protected abstract void handleTask();                                                                  </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 104                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 105 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 106 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 106 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 107 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 111 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span  style=""> 112                                                                                                          </span>
<span class="1570397235639520239" onmouseenter="enter('1570397235639520239');" onmouseout="out('1570397235639520239');" style=""> 113   public String getKey() {                                                                               </span>
<span class="-4424845466408855162" onmouseenter="enter('-4424845466408855162');" onmouseout="out('-4424845466408855162');" style=""> 114     return mTaskWrapper.getKey();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115   }                                                                                                      </span>
<span  style=""> 116                                                                                                          </span>
<span class="-8770398782889209035" onmouseenter="enter('-8770398782889209035');" onmouseout="out('-8770398782889209035');" style=""> 117   public ENTITY getEntity() {                                                                            </span>
<span class="-2978486956956616380" onmouseenter="enter('-2978486956956616380');" onmouseout="out('-2978486956956616380');" style=""> 118     return mEntity;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 119   }                                                                                                      </span>
<span  style=""> 120                                                                                                          </span>
<span class="-5640948235258648086" onmouseenter="enter('-5640948235258648086');" onmouseout="out('-5640948235258648086');" style=""> 121   public SparseArray&lt;AbsThreadTask&gt; getTaskList() {                                                      </span>
<span class="4274533672597507440" onmouseenter="enter('4274533672597507440');" onmouseout="out('4274533672597507440');" style=""> 122     return mTask;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123   }                                                                                                      </span>
<span  style=""> 124                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 125   /**                                                                                                    </span>
<span class="5501330737777447325" onmouseenter="enter('5501330737777447325');" onmouseout="out('5501330737777447325');" style=""> 126    * 重置任务状态                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 127    */                                                                                                    </span>
<span class="769592541207569755" onmouseenter="enter('769592541207569755');" onmouseout="out('769592541207569755');" style=""> 128   private void resetState() {                                                                            </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 129     closeTimer();                                                                                        </span>
<span  style=""> 130                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 131 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 132                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 133 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 134 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 134 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 135 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136                                                                                                          </span>
<span class="-7538891183274876048" onmouseenter="enter('-7538891183274876048');" onmouseout="out('-7538891183274876048');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137     mTotalThreadNum = 0;                                                                                 </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 139 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="86382318944182160" onmouseenter="enter('86382318944182160');" onmouseout="out('86382318944182160');" style=""> 140     if (mTask != null &amp;&amp; mTask.size() != 0) {                                                            </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 141       for (int i = 0; i &lt; mTask.size(); i++) {                                                           </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 142         AbsThreadTask task = mTask.get(i);                                                               </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 143         if (task != null) {                                                                              </span>
<span class="4672639676050941541" onmouseenter="enter('4672639676050941541');" onmouseout="out('4672639676050941541');" style=""> 144           task.breakTask();                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146       }                                                                                                  </span>
<span class="-5745867061804924715" onmouseenter="enter('-5745867061804924715');" onmouseout="out('-5745867061804924715');" style=""> 147       mTask.clear();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149   }                                                                                                      </span>
<span  style=""> 150                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 151   /**                                                                                                    </span>
<span class="-8036989040377605484" onmouseenter="enter('-8036989040377605484');" onmouseout="out('-8036989040377605484');" style=""> 152    * 开始流程                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 153    */                                                                                                    </span>
<span class="2659446283962947526" onmouseenter="enter('2659446283962947526');" onmouseout="out('2659446283962947526');" style=""> 154   private void startFlow() {                                                                             </span>
<span class="-8163448594027824981" onmouseenter="enter('-8163448594027824981');" onmouseout="out('-8163448594027824981');" style=""> 155     if (isBreak()) {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 156       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157     }                                                                                                    </span>
<span class="-4000252108766936273" onmouseenter="enter('-4000252108766936273');" onmouseout="out('-4000252108766936273');" style=""> 158     resetState();                                                                                        </span>
<span class="2108596284974852159" onmouseenter="enter('2108596284974852159');" onmouseout="out('2108596284974852159');" style=""> 159     mRecord = new RecordHandler(mTaskWrapper).getRecord();                                               </span>
<span  style=""> 160                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 161 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-6826246836562616350" onmouseenter="enter('-6826246836562616350');" onmouseout="out('-6826246836562616350');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 162     Looper.prepare();                                                                                    </span>
<span class="5149694805992184581" onmouseenter="enter('5149694805992184581');" onmouseout="out('5149694805992184581');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 163     Looper looper = Looper.myLooper();                                                                   </span>
<span class="-3253896924586580699" onmouseenter="enter('-3253896924586580699');" onmouseout="out('-3253896924586580699');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 164     mStateManager = getStateManager(looper);                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 165                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 166 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 167 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 167 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 168 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169                                                                                                          </span>
<span class="5383386817121006275" onmouseenter="enter('5383386817121006275');" onmouseout="out('5383386817121006275');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170     mTotalThreadNum = mRecord.threadNum;                                                                 </span>
<span class="-6826246836562616350" onmouseenter="enter('-6826246836562616350');" onmouseout="out('-6826246836562616350');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171     Looper.prepare();                                                                                    </span>
<span class="5149694805992184581" onmouseenter="enter('5149694805992184581');" onmouseout="out('5149694805992184581');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172     Looper looper = Looper.myLooper();                                                                   </span>
<span class="7030077118020735892" onmouseenter="enter('7030077118020735892');" onmouseout="out('7030077118020735892');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173     mStateManager = new ThreadStateManager(looper, mRecord, mListener);                                  </span>
<span class="-9214273580559083386" onmouseenter="enter('-9214273580559083386');" onmouseout="out('-9214273580559083386');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174     mStateHandler = new Handler(looper, mStateManager);                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 176 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="6344410794906613415" onmouseenter="enter('6344410794906613415');" onmouseout="out('6344410794906613415');" style=""> 177     onPostPre();                                                                                         </span>
<span  style=""> 178                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 179 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 180                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 181 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 182 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 182 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 183 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184                                                                                                          </span>
<span class="5989254615436994150" onmouseenter="enter('5989254615436994150');" onmouseout="out('5989254615436994150');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185     if (!mTaskWrapper.isSupportBP()) {                                                                   </span>
<span class="-6182854007095635032" onmouseenter="enter('-6182854007095635032');" onmouseout="out('-6182854007095635032');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186       handleNoSupportBP();                                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187     } else {                                                                                             </span>
<span class="304482857231090385" onmouseenter="enter('304482857231090385');" onmouseout="out('304482857231090385');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188       handleBreakpoint();                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 191 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="-7724548171203838725" onmouseenter="enter('-7724548171203838725');" onmouseout="out('-7724548171203838725');" style=""> 192     startTimer();                                                                                        </span>
<span  style=""> 193                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 194 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-5346338694472503069" onmouseenter="enter('-5346338694472503069');" onmouseout="out('-5346338694472503069');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 195     handleTask();                                                                                        </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 196                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 197 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 198 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 198 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 199 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 202 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="7341795500457488125" onmouseenter="enter('7341795500457488125');" onmouseout="out('7341795500457488125');" style=""> 203     Looper.loop();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204   }                                                                                                      </span>
<span  style=""> 205                                                                                                          </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 206   @Override public void run() {                                                                          </span>
<span class="6651633619385263409" onmouseenter="enter('6651633619385263409');" onmouseout="out('6651633619385263409');" style=""> 207     if (isRunning()) {                                                                                   </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 208       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209     }                                                                                                    </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 210     startFlow();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211   }                                                                                                      </span>
<span  style=""> 212                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 213   /**                                                                                                    </span>
<span class="4044787794494402505" onmouseenter="enter('4044787794494402505');" onmouseout="out('4044787794494402505');" style=""> 214    * 预处理完成                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 215    */                                                                                                    </span>
<span class="-5125657304217005566" onmouseenter="enter('-5125657304217005566');" onmouseout="out('-5125657304217005566');" style=""> 216   protected void onPostPre() {                                                                           </span>
<span  style=""> 217                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218   }                                                                                                      </span>
<span  style=""> 219                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 220   /**                                                                                                    </span>
<span  style=""> 221                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 222 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span class="-8327624174212830499" onmouseenter="enter('-8327624174212830499');" onmouseout="out('-8327624174212830499');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 223    * 延迟启动定时器                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 224    */                                                                                                    </span>
<span class="2707724463201796910" onmouseenter="enter('2707724463201796910');" onmouseout="out('2707724463201796910');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 225   protected long delayTimer() {                                                                          </span>
<span class="-5665804692852603146" onmouseenter="enter('-5665804692852603146');" onmouseout="out('-5665804692852603146');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 226     return 1000;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 227   }                                                                                                      </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 228                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 229   /**                                                                                                    </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 230                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 231 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 232 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 232 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 233 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234                                                                                                          </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 236 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="4041581137177203435" onmouseenter="enter('4041581137177203435');" onmouseout="out('4041581137177203435');" style=""> 237    * 启动进度获取定时器                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 238    */                                                                                                    </span>
<span class="1702258376619356446" onmouseenter="enter('1702258376619356446');" onmouseout="out('1702258376619356446');" style=""> 239   private synchronized void startTimer() {                                                               </span>
<span class="8615364800642373101" onmouseenter="enter('8615364800642373101');" onmouseout="out('8615364800642373101');" style=""> 240     ALog.d(TAG, &quot;启动定时器&quot;);                                                                                </span>
<span class="-9160623214484912914" onmouseenter="enter('-9160623214484912914');" onmouseout="out('-9160623214484912914');" style=""> 241     mTimer = new ScheduledThreadPoolExecutor(1);                                                         </span>
<span class="4344341468621605861" onmouseenter="enter('4344341468621605861');" onmouseout="out('4344341468621605861');" style=""> 242     mTimer.scheduleWithFixedDelay(new Runnable() {                                                       </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 243       @Override public void run() {                                                                      </span>
<span class="-2600099651056425109" onmouseenter="enter('-2600099651056425109');" onmouseout="out('-2600099651056425109');" style=""> 244         if (mStateManager.isComplete()                                                                   </span>
<span class="242988333280989926" onmouseenter="enter('242988333280989926');" onmouseout="out('242988333280989926');" style=""> 245             || mStateManager.isStop()                                                                    </span>
<span class="-9217646883186463915" onmouseenter="enter('-9217646883186463915');" onmouseout="out('-9217646883186463915');" style=""> 246             || mStateManager.isCancel()                                                                  </span>
<span class="-6792138316084162201" onmouseenter="enter('-6792138316084162201');" onmouseout="out('-6792138316084162201');" style=""> 247             || mStateManager.isFail()                                                                    </span>
<span class="1045872412985382023" onmouseenter="enter('1045872412985382023');" onmouseout="out('1045872412985382023');" style=""> 248             || !isRunning()) {                                                                           </span>
<span class="3103159404811065674" onmouseenter="enter('3103159404811065674');" onmouseout="out('3103159404811065674');" style=""> 249           if (mStateManager.isComplete() || mStateManager.isFail()) {                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 250             ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251           }                                                                                              </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 252           closeTimer();                                                                                  </span>
<span class="-8976455106279635226" onmouseenter="enter('-8976455106279635226');" onmouseout="out('-8976455106279635226');" style=""> 253         } else if (mStateManager.getCurrentProgress() &gt;= 0) {                                            </span>
<span class="-7130682954514056925" onmouseenter="enter('-7130682954514056925');" onmouseout="out('-7130682954514056925');" style=""> 254           mListener.onProgress(mStateManager.getCurrentProgress());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 256       }                                                                                                  </span>
<span class="4986548728620604588" onmouseenter="enter('4986548728620604588');" onmouseout="out('4986548728620604588');" style=""> 257     }, delayTimer(), mUpdateInterval, TimeUnit.MILLISECONDS);                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258   }                                                                                                      </span>
<span  style=""> 259                                                                                                          </span>
<span class="3982752692275613073" onmouseenter="enter('3982752692275613073');" onmouseout="out('3982752692275613073');" style=""> 260   public synchronized void closeTimer() {                                                                </span>
<span class="-7001663665090653782" onmouseenter="enter('-7001663665090653782');" onmouseout="out('-7001663665090653782');" style=""> 261     ALog.d(TAG, &quot;关闭定时器&quot;);                                                                                </span>
<span class="-1268142752100378972" onmouseenter="enter('-1268142752100378972');" onmouseout="out('-1268142752100378972');" style=""> 262     if (mTimer != null &amp;&amp; !mTimer.isShutdown()) {                                                        </span>
<span class="4837418556669337408" onmouseenter="enter('4837418556669337408');" onmouseout="out('4837418556669337408');" style=""> 263       mTimer.shutdown();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265   }                                                                                                      </span>
<span  style=""> 266                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 267   /**                                                                                                    </span>
<span class="3310122691908792895" onmouseenter="enter('3310122691908792895');" onmouseout="out('3310122691908792895');" style=""> 268    * 设置定时器更新间隔                                                                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 269    *                                                                                                     </span>
<span class="5926421498368036592" onmouseenter="enter('5926421498368036592');" onmouseout="out('5926421498368036592');" style=""> 270    * @param interval 单位毫秒，不能小于0                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 271    */                                                                                                    </span>
<span class="-6143371944494222779" onmouseenter="enter('-6143371944494222779');" onmouseout="out('-6143371944494222779');" style=""> 272   protected void setUpdateInterval(long interval) {                                                      </span>
<span class="-1051498944097002766" onmouseenter="enter('-1051498944097002766');" onmouseout="out('-1051498944097002766');" style=""> 273     if (interval &lt; 0) {                                                                                  </span>
<span class="3000915396455271078" onmouseenter="enter('3000915396455271078');" onmouseout="out('3000915396455271078');" style=""> 274       ALog.w(TAG, &quot;更新间隔不能小于0，默认为1000毫秒&quot;);                                                                </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 275       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276     }                                                                                                    </span>
<span class="-3431322530378656562" onmouseenter="enter('-3431322530378656562');" onmouseout="out('-3431322530378656562');" style=""> 277     mUpdateInterval = interval;                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278   }                                                                                                      </span>
<span  style=""> 279                                                                                                          </span>
<span class="-5758762106788202116" onmouseenter="enter('-5758762106788202116');" onmouseout="out('-5758762106788202116');" style=""> 280   public long getFileSize() {                                                                            </span>
<span class="-7902485770489300682" onmouseenter="enter('-7902485770489300682');" onmouseout="out('-7902485770489300682');" style=""> 281     return mEntity.getFileSize();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 282   }                                                                                                      </span>
<span  style=""> 283                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 284   /**                                                                                                    </span>
<span class="-7288086523564906780" onmouseenter="enter('-7288086523564906780');" onmouseout="out('-7288086523564906780');" style=""> 285    * 获取当前任务位置                                                                                            </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 286    */                                                                                                    </span>
<span class="3656547772237643757" onmouseenter="enter('3656547772237643757');" onmouseout="out('3656547772237643757');" style=""> 287   public long getCurrentLocation() {                                                                     </span>
<span class="-4293580056549457" onmouseenter="enter('-4293580056549457');" onmouseout="out('-4293580056549457');" style=""> 288     return mStateManager.getCurrentProgress();                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289   }                                                                                                      </span>
<span  style=""> 290                                                                                                          </span>
<span class="430507706356584401" onmouseenter="enter('430507706356584401');" onmouseout="out('430507706356584401');" style=""> 291   public synchronized boolean isRunning() {                                                              </span>
<span class="-3888627988187341127" onmouseenter="enter('-3888627988187341127');" onmouseout="out('-3888627988187341127');" style=""> 292     boolean b = ThreadTaskManager.getInstance().taskIsRunning(mTaskWrapper.getKey());                    </span>
<span class="-4055314358126237867" onmouseenter="enter('-4055314358126237867');" onmouseout="out('-4055314358126237867');" style=""> 293     //ALog.d(TAG, &quot;isRunning = &quot; + b);                                                                   </span>
<span class="936248907371687111" onmouseenter="enter('936248907371687111');" onmouseout="out('936248907371687111');" style=""> 294     return b;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295   }                                                                                                      </span>
<span  style=""> 296                                                                                                          </span>
<span class="7466876458085224213" onmouseenter="enter('7466876458085224213');" onmouseout="out('7466876458085224213');" style=""> 297   public synchronized void cancel() {                                                                    </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style=""> 298     if (isCancel) {                                                                                      </span>
<span class="-5322688094560357059" onmouseenter="enter('-5322688094560357059');" onmouseout="out('-5322688094560357059');" style=""> 299       ALog.d(TAG, String.format(&quot;任务【%s】正在删除，删除任务失败&quot;, mTaskWrapper.getKey()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 300       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301     }                                                                                                    </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 302     closeTimer();                                                                                        </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style=""> 303     isCancel = true;                                                                                     </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 304     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 305       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 306       if (task != null) {                                                                                </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style=""> 307         task.cancel();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 309     }                                                                                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 310     ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 311   }                                                                                                      </span>
<span  style=""> 312                                                                                                          </span>
<span class="8656523468118489646" onmouseenter="enter('8656523468118489646');" onmouseout="out('8656523468118489646');" style=""> 313   public synchronized void stop() {                                                                      </span>
<span class="7677583571575855110" onmouseenter="enter('7677583571575855110');" onmouseout="out('7677583571575855110');" style=""> 314     if (isStop) {                                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 315       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316     }                                                                                                    </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 317     closeTimer();                                                                                        </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style=""> 318     isStop = true;                                                                                       </span>
<span class="-7122141514229488110" onmouseenter="enter('-7122141514229488110');" onmouseout="out('-7122141514229488110');" style=""> 319     if (mStateManager.isComplete()) return;                                                              </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 320     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 321       AbsThreadTask task = mTask.get(i);                                                                 </span>
<span class="-6295419555080725627" onmouseenter="enter('-6295419555080725627');" onmouseout="out('-6295419555080725627');" style=""> 322       if (task != null &amp;&amp; !task.isThreadComplete()) {                                                    </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style=""> 323         task.stop();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 325     }                                                                                                    </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 326     ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327   }                                                                                                      </span>
<span  style=""> 328                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 329   /**                                                                                                    </span>
<span class="-7218687507933415946" onmouseenter="enter('-7218687507933415946');" onmouseout="out('-7218687507933415946');" style=""> 330    * 直接调用的时候会自动启动线程执行                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 331    */                                                                                                    </span>
<span class="-7265432148414046744" onmouseenter="enter('-7265432148414046744');" onmouseout="out('-7265432148414046744');" style=""> 332   public synchronized void start() {                                                                     </span>
<span class="6651633619385263409" onmouseenter="enter('6651633619385263409');" onmouseout="out('6651633619385263409');" style=""> 333     if (isRunning()) {                                                                                   </span>
<span class="4391999858354318805" onmouseenter="enter('4391999858354318805');" onmouseout="out('4391999858354318805');" style=""> 334       ALog.d(TAG, String.format(&quot;任务【%s】正在执行，启动任务失败&quot;, mTaskWrapper.getKey()));                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 335       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336     }                                                                                                    </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style=""> 337     new Thread(this).start();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 338   }                                                                                                      </span>
<span  style=""> 339                                                                                                          </span>
<span class="5993373674998630219" onmouseenter="enter('5993373674998630219');" onmouseout="out('5993373674998630219');" style=""> 340   public void resume() {                                                                                 </span>
<span class="-6183578153083367222" onmouseenter="enter('-6183578153083367222');" onmouseout="out('-6183578153083367222');" style=""> 341     start();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342   }                                                                                                      </span>
<span  style=""> 343                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 344   /**                                                                                                    </span>
<span  style=""> 345                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 346 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 347                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 348 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 349 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 349 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 350 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 351                                                                                                          </span>
<span class="8881300510663389339" onmouseenter="enter('8881300510663389339');" onmouseout="out('8881300510663389339');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 352    * 启动断点任务时，创建单线程任务                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353    *                                                                                                     </span>
<span class="-262599314844690395" onmouseenter="enter('-262599314844690395');" onmouseout="out('-262599314844690395');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354    * @param record 线程记录                                                                                  </span>
<span class="4692865644996389482" onmouseenter="enter('4692865644996389482');" onmouseout="out('4692865644996389482');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355    * @param startNum 启动的线程数                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356    */                                                                                                    </span>
<span class="6288283959573381778" onmouseenter="enter('6288283959573381778');" onmouseout="out('6288283959573381778');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357   private AbsThreadTask createSingThreadTask(ThreadRecord record, int startNum) {                        </span>
<span class="619060527413120496" onmouseenter="enter('619060527413120496');" onmouseout="out('619060527413120496');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358     SubThreadConfig&lt;TASK_WRAPPER&gt; config = new SubThreadConfig&lt;&gt;();                                      </span>
<span class="1383183623969437207" onmouseenter="enter('1383183623969437207');" onmouseout="out('1383183623969437207');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359     config.url = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                     </span>
<span class="-2180512157664708444" onmouseenter="enter('-2180512157664708444');" onmouseout="out('-2180512157664708444');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360     config.tempFile =                                                                                    </span>
<span class="4786837782358626319" onmouseenter="enter('4786837782358626319');" onmouseout="out('4786837782358626319');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361         mRecord.isBlock ? new File(                                                                      </span>
<span class="-928238364642114529" onmouseenter="enter('-928238364642114529');" onmouseout="out('-928238364642114529');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362             String.format(RecordHandler.SUB_PATH, mTempFile.getPath(), record.threadId))                 </span>
<span class="-2755374302005590951" onmouseenter="enter('-2755374302005590951');" onmouseout="out('-2755374302005590951');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363             : mTempFile;                                                                                 </span>
<span class="-3873105131765266571" onmouseenter="enter('-3873105131765266571');" onmouseout="out('-3873105131765266571');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364     config.isBlock = mRecord.isBlock;                                                                    </span>
<span class="2125632838406943587" onmouseenter="enter('2125632838406943587');" onmouseout="out('2125632838406943587');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365     config.isOpenDynamicFile = mRecord.isOpenDynamicFile;                                                </span>
<span class="6114090202926236086" onmouseenter="enter('6114090202926236086');" onmouseout="out('6114090202926236086');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366     config.startThreadNum = startNum;                                                                    </span>
<span class="-4242804732746281982" onmouseenter="enter('-4242804732746281982');" onmouseout="out('-4242804732746281982');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367     config.taskWrapper = mTaskWrapper;                                                                   </span>
<span class="-4639824013167552343" onmouseenter="enter('-4639824013167552343');" onmouseout="out('-4639824013167552343');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368     config.record = record;                                                                              </span>
<span class="5396523329299846357" onmouseenter="enter('5396523329299846357');" onmouseout="out('5396523329299846357');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369     config.stateHandler = mStateHandler;                                                                 </span>
<span class="-3921818352268167442" onmouseenter="enter('-3921818352268167442');" onmouseout="out('-3921818352268167442');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370     return selectThreadTask(config);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372                                                                                                          </span>
<span class="6532423587840407518" onmouseenter="enter('6532423587840407518');" onmouseout="out('6532423587840407518');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373   private void handleBreakpoint() {                                                                      </span>
<span class="-4822982872266026601" onmouseenter="enter('-4822982872266026601');" onmouseout="out('-4822982872266026601');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374     long fileLength = mEntity.getFileSize();                                                             </span>
<span class="-23207299311678828" onmouseenter="enter('-23207299311678828');" onmouseout="out('-23207299311678828');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375     long blockSize = fileLength / mTotalThreadNum;                                                       </span>
<span class="-5411942018384313216" onmouseenter="enter('-5411942018384313216');" onmouseout="out('-5411942018384313216');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376     long currentProgress = 0;                                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377                                                                                                          </span>
<span class="575574520788079541" onmouseenter="enter('575574520788079541');" onmouseout="out('575574520788079541');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378     mRecord.fileLength = fileLength;                                                                     </span>
<span class="-8044703341086541865" onmouseenter="enter('-8044703341086541865');" onmouseout="out('-8044703341086541865');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379     if (mTaskWrapper.isNewTask() &amp;&amp; !handleNewTask()) {                                                  </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382                                                                                                          </span>
<span class="-4848901962459716543" onmouseenter="enter('-4848901962459716543');" onmouseout="out('-4848901962459716543');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383     int startNum = mRecord.threadNum;                                                                    </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384     for (ThreadRecord tr : mRecord.threadRecords) {                                                      </span>
<span class="23428130114285890" onmouseenter="enter('23428130114285890');" onmouseout="out('23428130114285890');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385       if (!tr.isComplete) {                                                                              </span>
<span class="-4061668182787110636" onmouseenter="enter('-4061668182787110636');" onmouseout="out('-4061668182787110636');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386         startNum++;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389                                                                                                          </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390     for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                          </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391       long startL = i * blockSize, endL = (i + 1) * blockSize;                                           </span>
<span class="4424666519135617916" onmouseenter="enter('4424666519135617916');" onmouseout="out('4424666519135617916');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392       ThreadRecord tr = mRecord.threadRecords.get(i);                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393                                                                                                          </span>
<span class="-973014210831854259" onmouseenter="enter('-973014210831854259');" onmouseout="out('-973014210831854259');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394       if (tr.isComplete) {//该线程已经完成                                                                      </span>
<span class="180590181413857803" onmouseenter="enter('180590181413857803');" onmouseout="out('180590181413857803');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395         currentProgress += endL - startL;                                                                </span>
<span class="-536040810321338414" onmouseenter="enter('-536040810321338414');" onmouseout="out('-536040810321338414');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 396         ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__已完成&quot;, mTaskWrapper.getEntity().getFileName(), i));      </span>
<span class="1740477104282149859" onmouseenter="enter('1740477104282149859');" onmouseout="out('1740477104282149859');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 397         mStateHandler.obtainMessage(ThreadStateManager.STATE_COMPLETE).sendToTarget();                   </span>
<span class="2369831997717445711" onmouseenter="enter('2369831997717445711');" onmouseout="out('2369831997717445711');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398         if (mStateManager.isComplete()) {                                                                </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399           mRecord.deleteData();                                                                          </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 400           mListener.onComplete();                                                                        </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 401           return;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402         }                                                                                                </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403         continue;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404       }                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405                                                                                                          </span>
<span class="1183688269285295822" onmouseenter="enter('1183688269285295822');" onmouseout="out('1183688269285295822');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406       //如果有记录，则恢复任务                                                                                      </span>
<span class="2244216797309960275" onmouseenter="enter('2244216797309960275');" onmouseout="out('2244216797309960275');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 407       long r = tr.startLocation;                                                                         </span>
<span class="-7915611879357930899" onmouseenter="enter('-7915611879357930899');" onmouseout="out('-7915611879357930899');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 408       //记录的位置需要在线程区间中                                                                                    </span>
<span class="-3706404109465135132" onmouseenter="enter('-3706404109465135132');" onmouseout="out('-3706404109465135132');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409       if (startL &lt; r &amp;&amp; r &lt;= (i == (mTotalThreadNum - 1) ? fileLength : endL)) {                         </span>
<span class="9212684671908260751" onmouseenter="enter('9212684671908260751');" onmouseout="out('9212684671908260751');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410         currentProgress += r - startL;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411       }                                                                                                  </span>
<span class="5845990765500507783" onmouseenter="enter('5845990765500507783');" onmouseout="out('5845990765500507783');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412       ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__恢复任务&quot;, mEntity.getFileName(), i));                        </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413                                                                                                          </span>
<span class="-4760110330380665779" onmouseenter="enter('-4760110330380665779');" onmouseout="out('-4760110330380665779');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414       AbsThreadTask task = createSingThreadTask(tr, startNum);                                           </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 415       if (task == null) return;                                                                          </span>
<span class="7333602866274972902" onmouseenter="enter('7333602866274972902');" onmouseout="out('7333602866274972902');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416       mTask.put(tr.threadId, task);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417     }                                                                                                    </span>
<span class="7288210074172932222" onmouseenter="enter('7288210074172932222');" onmouseout="out('7288210074172932222');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418     if (currentProgress != 0 &amp;&amp; currentProgress != mEntity.getCurrentProgress()) {                       </span>
<span class="4971627158329011933" onmouseenter="enter('4971627158329011933');" onmouseout="out('4971627158329011933');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419       ALog.d(TAG, String.format(&quot;进度修正，当前进度：%s&quot;, currentProgress));                                       </span>
<span class="5257240383095204746" onmouseenter="enter('5257240383095204746');" onmouseout="out('5257240383095204746');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420       mEntity.setCurrentProgress(currentProgress);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 421     }                                                                                                    </span>
<span class="-1549239735956086188" onmouseenter="enter('-1549239735956086188');" onmouseout="out('-1549239735956086188');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422     mStateHandler.obtainMessage(ThreadStateManager.STATE_UPDATE_PROGRESS, currentProgress)               </span>
<span class="543169677106967816" onmouseenter="enter('543169677106967816');" onmouseout="out('543169677106967816');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423         .sendToTarget();                                                                                 </span>
<span class="5226311560826554017" onmouseenter="enter('5226311560826554017');" onmouseout="out('5226311560826554017');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424     startThreadTask();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 426                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427   /**                                                                                                    </span>
<span class="3352756078121499684" onmouseenter="enter('3352756078121499684');" onmouseout="out('3352756078121499684');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 428    * 启动单线程任务                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429    */                                                                                                    </span>
<span class="3368331307598775889" onmouseenter="enter('3368331307598775889');" onmouseout="out('3368331307598775889');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430   private void startThreadTask() {                                                                       </span>
<span class="-8163448594027824981" onmouseenter="enter('-8163448594027824981');" onmouseout="out('-8163448594027824981');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431     if (isBreak()) {                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432       return;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433     }                                                                                                    </span>
<span class="7098753117484412935" onmouseenter="enter('7098753117484412935');" onmouseout="out('7098753117484412935');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434     if (mStateManager.getCurrentProgress() &gt; 0) {                                                        </span>
<span class="6109786906910873721" onmouseenter="enter('6109786906910873721');" onmouseout="out('6109786906910873721');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435       mListener.onResume(mStateManager.getCurrentProgress());                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436     } else {                                                                                             </span>
<span class="7813115435309058360" onmouseenter="enter('7813115435309058360');" onmouseout="out('7813115435309058360');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437       mListener.onStart(mStateManager.getCurrentProgress());                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438     }                                                                                                    </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439     for (int i = 0; i &lt; mTask.size(); i++) {                                                             </span>
<span class="-9098026151212374592" onmouseenter="enter('-9098026151212374592');" onmouseout="out('-9098026151212374592');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440       ThreadTaskManager.getInstance().startThread(mTaskWrapper.getKey(), mTask.get(i));                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444   /**                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 445                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 446 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="5483762406760822984" onmouseenter="enter('5483762406760822984');" onmouseout="out('5483762406760822984');" style=""> 447    * 重试任务                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 448    */                                                                                                    </span>
<span class="3179155293949549674" onmouseenter="enter('3179155293949549674');" onmouseout="out('3179155293949549674');" style=""> 449   public void retryTask() {                                                                              </span>
<span class="5921009668313525105" onmouseenter="enter('5921009668313525105');" onmouseout="out('5921009668313525105');" style=""> 450     ALog.w(TAG, String.format(&quot;任务【%s】开始重试&quot;, mEntity.getFileName()));                                     </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 451     startFlow();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 452   }                                                                                                      </span>
<span  style=""> 453                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 454   /**                                                                                                    </span>
<span  style=""> 455                                                                                                          </span>
<span class="-6681681893462133916" onmouseenter="enter('-6681681893462133916');" onmouseout="out('-6681681893462133916');" style=""> 456 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT                                                                                             </span>
<span  style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 457                                                                                                          </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 458 ||||||| BASE                                                                                             </span>
<span class="-3639349873877828882" onmouseenter="enter('-3639349873877828882');" onmouseout="out('-3639349873877828882');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 459 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/"> 459 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kw🔵</abbr></span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 460 =======                                                                                                  </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 461                                                                                                          </span>
<span class="3489882028140634260" onmouseenter="enter('3489882028140634260');" onmouseout="out('3489882028140634260');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 462    * 处理新任务                                                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 463    *                                                                                                     </span>
<span class="8941769692798326625" onmouseenter="enter('8941769692798326625');" onmouseout="out('8941769692798326625');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 464    * @return {@code true}创建新任务失败                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 465    */                                                                                                    </span>
<span class="3897453149098456479" onmouseenter="enter('3897453149098456479');" onmouseout="out('3897453149098456479');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 466   protected abstract boolean handleNewTask();                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 467                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 468   /**                                                                                                    </span>
<span class="-4404408971562231280" onmouseenter="enter('-4404408971562231280');" onmouseout="out('-4404408971562231280');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 469    * 处理不支持断点的任务                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 470    */                                                                                                    </span>
<span class="-8792279366871913220" onmouseenter="enter('-8792279366871913220');" onmouseout="out('-8792279366871913220');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 471   private void handleNoSupportBP() {                                                                     </span>
<span class="33131000937493775" onmouseenter="enter('33131000937493775');" onmouseout="out('33131000937493775');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 472     if (mListener instanceof BaseDListener) {                                                            </span>
<span class="-4047803046141878594" onmouseenter="enter('-4047803046141878594');" onmouseout="out('-4047803046141878594');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 473       ((BaseDListener) mListener).supportBreakpoint(false);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 474     }                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 475                                                                                                          </span>
<span class="-1616430852182163073" onmouseenter="enter('-1616430852182163073');" onmouseout="out('-1616430852182163073');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 476     AbsThreadTask task = createSingThreadTask(mRecord.threadRecords.get(0), 1);                          </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 477     if (task == null) return;                                                                            </span>
<span class="8048363116921461760" onmouseenter="enter('8048363116921461760');" onmouseout="out('8048363116921461760');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 478     mTask.put(0, task);                                                                                  </span>
<span class="4018208315746033194" onmouseenter="enter('4018208315746033194');" onmouseout="out('4018208315746033194');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 479     ThreadTaskManager.getInstance().startThread(mTaskWrapper.getKey(), task);                            </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 480     mListener.onStart(0);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 481   }                                                                                                      </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 482                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 483   /**                                                                                                    </span>
<span class="5502854491504205724" onmouseenter="enter('5502854491504205724');" onmouseout="out('5502854491504205724');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 484    * 选择单任务线程的类型                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 485    */                                                                                                    </span>
<span class="-6182858214188596124" onmouseenter="enter('-6182858214188596124');" onmouseout="out('-6182858214188596124');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 486   protected abstract AbsThreadTask selectThreadTask(SubThreadConfig&lt;TASK_WRAPPER&gt; config);               </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 487                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 488   /**                                                                                                    </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 489                                                                                                          </span>
<span class="-1814092468913316143" onmouseenter="enter('-1814092468913316143');" onmouseout="out('-1814092468913316143');" style=""> 490 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT                                                                                            </span>
<span class="1743516648458284983" onmouseenter="enter('1743516648458284983');" onmouseout="out('1743516648458284983');" style=""> 491    * 任务是否已经中断                                                                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 492    *                                                                                                     </span>
<span class="1049148427197526624" onmouseenter="enter('1049148427197526624');" onmouseout="out('1049148427197526624');" style=""> 493    * @return {@code true}中断                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 494    */                                                                                                    </span>
<span class="-5185153522657566835" onmouseenter="enter('-5185153522657566835');" onmouseout="out('-5185153522657566835');" style=""> 495   public boolean isBreak() {                                                                             </span>
<span class="-1760408404888214576" onmouseenter="enter('-1760408404888214576');" onmouseout="out('-1760408404888214576');" style=""> 496     if (isCancel || isStop) {                                                                            </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 497       closeTimer();                                                                                      </span>
<span class="-93553338069535680" onmouseenter="enter('-93553338069535680');" onmouseout="out('-93553338069535680');" style=""> 498       ALog.d(TAG, String.format(&quot;任务【%s】已停止或取消了&quot;, mEntity.getFileName()));                                </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 499       return true;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 500     }                                                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 501     return false;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 502   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 503 }                                                                                                        </span>
















































































































































































































































</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16  package com.arialyy.aria.core.common;                                                                             </span>
<span  style="">  17                                                                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  18  import android.content.Context;                                                                                   </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  19 +import android.os.Looper;                                                                                         </span>

<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  20  import android.util.SparseArray;                                                                                  </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  21  import com.arialyy.aria.core.AriaManager;                                                                         </span>
<span class="1502558042605946501" onmouseenter="enter('1502558042605946501');" onmouseout="out('1502558042605946501');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  22 -import com.arialyy.aria.core.download.BaseDListener;                                                              </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  23 -import com.arialyy.aria.core.download.DownloadEntity;                                                             </span>
<span class="-3497740022528182602" onmouseenter="enter('-3497740022528182602');" onmouseout="out('-3497740022528182602');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import com.arialyy.aria.core.download.DTaskWrapper;                                                               </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  25  import com.arialyy.aria.core.inf.AbsNormalEntity;                                                                 </span>
<span class="8472156907075048576" onmouseenter="enter('8472156907075048576');" onmouseout="out('8472156907075048576');" style="">  26  import com.arialyy.aria.core.inf.AbsTaskWrapper;                                                                  </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  27  import com.arialyy.aria.core.inf.IEventListener;                                                                  </span>
<span class="5965657858743993748" onmouseenter="enter('5965657858743993748');" onmouseout="out('5965657858743993748');" style="">  28  import com.arialyy.aria.core.manager.ThreadTaskManager;                                                           </span>
<span class="-5831681804875068292" onmouseenter="enter('-5831681804875068292');" onmouseout="out('-5831681804875068292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import com.arialyy.aria.core.upload.UploadEntity;                                                                 </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  30 -import com.arialyy.aria.orm.DbEntity;                                                                             </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  31  import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  32  import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-5216410147421847074" onmouseenter="enter('-5216410147421847074');" onmouseout="out('-5216410147421847074');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -import com.arialyy.aria.util.DbDataHelper;                                                                        </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  34  import java.io.File;                                                                                              </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  35 -import java.util.ArrayList;                                                                                       </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -import java.util.HashSet;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -import java.util.List;                                                                                            </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -import java.util.Properties;                                                                                      </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  39 -import java.util.Set;                                                                                             </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  40  import java.util.concurrent.ScheduledThreadPoolExecutor;                                                          </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  41  import java.util.concurrent.TimeUnit;                                                                             </span>
<span  style="">  42                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  43  /**                                                                                                               </span>
<span class="-1694841151883282501" onmouseenter="enter('-1694841151883282501');" onmouseout="out('-1694841151883282501');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  44 - * Created by AriaL on 2017/7/1. 任务处理器                                                                            </span>
<span class="6972081778092176351" onmouseenter="enter('6972081778092176351');" onmouseout="out('6972081778092176351');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 + * Created by AriaL on 2017/7/1.                                                                                  </span>
<span class="6054556736689943041" onmouseenter="enter('6054556736689943041');" onmouseout="out('6054556736689943041');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 + * 控制线程任务状态，如：开始，停止，取消，重试                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  47   */                                                                                                               </span>
<span class="4153941248862822664" onmouseenter="enter('4153941248862822664');" onmouseout="out('4153941248862822664');" style="">  48  public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTITY&gt;&gt;      </span>
<span class="4792287397525923935" onmouseenter="enter('4792287397525923935');" onmouseout="out('4792287397525923935');" style="">  49      implements Runnable {                                                                                         </span>
<span class="8962793429617957612" onmouseenter="enter('8962793429617957612');" onmouseout="out('8962793429617957612');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  50 -  private static final String STATE = &quot;_state_&quot;;                                                                  </span>
<span class="4155209368239822413" onmouseenter="enter('4155209368239822413');" onmouseout="out('4155209368239822413');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  51 -  private static final String RECORD = &quot;_record_&quot;;                                                                </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  52 -  /**                                                                                                             </span>
<span class="338455206860706823" onmouseenter="enter('338455206860706823');" onmouseout="out('338455206860706823');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  53 -   * 分块文件路径                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  54 -   */                                                                                                             </span>
<span class="749748772523516571" onmouseenter="enter('749748772523516571');" onmouseout="out('749748772523516571');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 -  public static final String SUB_PATH = &quot;%s.%s.part&quot;;                                                             </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  56 -  /**                                                                                                             </span>
<span class="-1980722710912279499" onmouseenter="enter('-1980722710912279499');" onmouseout="out('-1980722710912279499');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  57 -   * 小于1m的文件不启用多线程                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  58 -   */                                                                                                             </span>
<span class="-5660290514964746700" onmouseenter="enter('-5660290514964746700');" onmouseout="out('-5660290514964746700');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -  protected static final long SUB_LEN = 1024 * 1024;                                                              </span>
<span class="-3405758267261636342" onmouseenter="enter('-3405758267261636342');" onmouseout="out('-3405758267261636342');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  60 -  protected static final int DOWNLOAD = 0x1;                                                                      </span>
<span class="-4795256183805637382" onmouseenter="enter('-4795256183805637382');" onmouseout="out('-4795256183805637382');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  61 -  protected static final int UPLOAD = 0x2;                                                                        </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  62 -                                                                                                                  </span>
<span class="7185037452507187216" onmouseenter="enter('7185037452507187216');" onmouseout="out('7185037452507187216');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  63 -  private final String TAG = &quot;AbsFileer&quot;;                                                                         </span>
<span class="-2630115597350149305" onmouseenter="enter('-2630115597350149305');" onmouseout="out('-2630115597350149305');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  64 +  protected final String TAG;                                                                                     </span>
<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="">  65    protected IEventListener mListener;                                                                             </span>
<span class="4507751527304947270" onmouseenter="enter('4507751527304947270');" onmouseout="out('4507751527304947270');" style="">  66    protected TASK_WRAPPER mTaskWrapper;                                                                            </span>
<span class="8904454574412257163" onmouseenter="enter('8904454574412257163');" onmouseout="out('8904454574412257163');" style="">  67    protected ENTITY mEntity;                                                                                       </span>
<span class="-8914417138860252644" onmouseenter="enter('-8914417138860252644');" onmouseout="out('-8914417138860252644');" style="">  68    protected Context mContext;                                                                                     </span>
<span class="3740841846621187936" onmouseenter="enter('3740841846621187936');" onmouseout="out('3740841846621187936');" style="">  69    protected File mTempFile; //文件                                                                                  </span>
<span class="-5211593385781091233" onmouseenter="enter('-5211593385781091233');" onmouseout="out('-5211593385781091233');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  70 -  protected StateConstance mConstance;                                                                            </span>
<span class="-7729852228955968495" onmouseenter="enter('-7729852228955968495');" onmouseout="out('-7729852228955968495');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  71 -  //总线程数                                                                                                          </span>
<span class="8506024364762319503" onmouseenter="enter('8506024364762319503');" onmouseout="out('8506024364762319503');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  72 -  protected int mTotalThreadNum;                                                                                  </span>
<span class="6869677327514827795" onmouseenter="enter('6869677327514827795');" onmouseout="out('6869677327514827795');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  73 -  //已完成的线程数                                                                                                       </span>
<span class="8146256445432145550" onmouseenter="enter('8146256445432145550');" onmouseout="out('8146256445432145550');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  74 -  private int mCompleteThreadNum;                                                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  75 +                                                                                                                  </span>

<span class="-4844420720547991856" onmouseenter="enter('-4844420720547991856');" onmouseout="out('-4844420720547991856');" style="">  76    private SparseArray&lt;AbsThreadTask&gt; mTask = new SparseArray&lt;&gt;();                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  77 -                                                                                                                  </span>
<span class="8927193311925096133" onmouseenter="enter('8927193311925096133');" onmouseout="out('8927193311925096133');" style="">  78    private ScheduledThreadPoolExecutor mTimer;                                                                     </span>
<span class="-6913167534336436900" onmouseenter="enter('-6913167534336436900');" onmouseout="out('-6913167534336436900');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  79 -  @Deprecated private File mConfigFile;                                                                           </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  80 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  81    /**                                                                                                             </span>
<span class="7539908978715582123" onmouseenter="enter('7539908978715582123');" onmouseout="out('7539908978715582123');" style="">  82     * 进度刷新间隔                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  83     */                                                                                                             </span>
<span class="3897731617107507824" onmouseenter="enter('3897731617107507824');" onmouseout="out('3897731617107507824');" style="">  84    private long mUpdateInterval = 1000;                                                                            </span>
<span class="-3206802593496103666" onmouseenter="enter('-3206802593496103666');" onmouseout="out('-3206802593496103666');" style="">  85    protected TaskRecord mRecord;                                                                                   </span>



<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  86 -                                                                                                                  </span>
<span class="-2726807651166998305" onmouseenter="enter('-2726807651166998305');" onmouseout="out('-2726807651166998305');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  87 -  protected AbsFileer(IEventListener listener, TASK_WRAPPER taskEntity) {                                         </span>
<span class="4056767467165783866" onmouseenter="enter('4056767467165783866');" onmouseout="out('4056767467165783866');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +  private IThreadState mStateManager;                                                                             </span>
<span class="-1193305157002570511" onmouseenter="enter('-1193305157002570511');" onmouseout="out('-1193305157002570511');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  89 +  private boolean isCancel = false, isStop = false;                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +                                                                                                                  </span>
<span class="4983484047732255541" onmouseenter="enter('4983484047732255541');" onmouseout="out('4983484047732255541');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  91 +  protected AbsFileer(IEventListener listener, TASK_WRAPPER wrapper) {                                            </span>
<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  92      mListener = listener;                                                                                         </span>
<span class="7942307664062314277" onmouseenter="enter('7942307664062314277');" onmouseout="out('7942307664062314277');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  93 -    mTaskWrapper = taskEntity;                                                                                    </span>
<span class="-4483703319181095288" onmouseenter="enter('-4483703319181095288');" onmouseout="out('-4483703319181095288');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  94 +    mTaskWrapper = wrapper;                                                                                       </span>
<span class="-7408997685265206061" onmouseenter="enter('-7408997685265206061');" onmouseout="out('-7408997685265206061');" style="">  95      mEntity = mTaskWrapper.getEntity();                                                                           </span>
<span class="1002707508041764251" onmouseenter="enter('1002707508041764251');" onmouseout="out('1002707508041764251');" style="">  96      mContext = AriaManager.APP;                                                                                   </span>
<span class="-3948532274682189145" onmouseenter="enter('-3948532274682189145');" onmouseout="out('-3948532274682189145');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -    mConstance = new StateConstance();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -                                                                                                                  </span>
<span class="-189617012144926713" onmouseenter="enter('-189617012144926713');" onmouseout="out('-189617012144926713');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -  protected abstract int getType();                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 101 -                                                                                                                  </span>
<span class="-8210434580109369245" onmouseenter="enter('-8210434580109369245');" onmouseout="out('-8210434580109369245');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 102 -  public void setNewTask(boolean newTask) {                                                                       </span>
<span class="3866179170323161252" onmouseenter="enter('3866179170323161252');" onmouseout="out('3866179170323161252');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 103 -    mTaskWrapper.setNewTask(newTask);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 104 -  }                                                                                                               </span>
<span class="-6219919440297129241" onmouseenter="enter('-6219919440297129241');" onmouseout="out('-6219919440297129241');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +    TAG = CommonUtil.getClassName(getClass());                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +  }                                                                                                               </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +                                                                                                                  </span>
<span class="-7037004339700598290" onmouseenter="enter('-7037004339700598290');" onmouseout="out('-7037004339700598290');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +  protected abstract IThreadState getStateManager(Looper looper);                                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +  /**                                                                                                             </span>
<span class="4265495595238076168" onmouseenter="enter('4265495595238076168');" onmouseout="out('4265495595238076168');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +   * 处理任务                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 112 +   */                                                                                                             </span>
<span class="5239937503155095401" onmouseenter="enter('5239937503155095401');" onmouseout="out('5239937503155095401');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +  protected abstract void handleTask();                                                                           </span>
<span  style=""> 114                                                                                                                    </span>
<span class="1570397235639520239" onmouseenter="enter('1570397235639520239');" onmouseout="out('1570397235639520239');" style=""> 115    public String getKey() {                                                                                        </span>
<span class="-4424845466408855162" onmouseenter="enter('-4424845466408855162');" onmouseout="out('-4424845466408855162');" style=""> 116      return mTaskWrapper.getKey();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 117    }                                                                                                               </span>
<span  style=""> 118                                                                                                                    </span>
<span class="-8770398782889209035" onmouseenter="enter('-8770398782889209035');" onmouseout="out('-8770398782889209035');" style=""> 119    public ENTITY getEntity() {                                                                                     </span>
<span class="-2978486956956616380" onmouseenter="enter('-2978486956956616380');" onmouseout="out('-2978486956956616380');" style=""> 120      return mEntity;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121    }                                                                                                               </span>
<span  style=""> 122                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 123 -  /**                                                                                                             </span>
<span class="8556703894505980538" onmouseenter="enter('8556703894505980538');" onmouseout="out('8556703894505980538');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 124 -   * 设置最大下载/上传速度                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 125 -   *                                                                                                              </span>
<span class="-7122826048258576762" onmouseenter="enter('-7122826048258576762');" onmouseout="out('-7122826048258576762');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 126 -   * @param maxSpeed 单位为：kb                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 127 -   */                                                                                                             </span>
<span class="6059729822356905089" onmouseenter="enter('6059729822356905089');" onmouseout="out('6059729822356905089');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 128 -  public void setMaxSpeed(int maxSpeed) {                                                                         </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 129 -    for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                                   </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 130 -      AbsThreadTask task = mTask.get(i);                                                                          </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 131 -      if (task != null) {                                                                                         </span>
<span class="8974054037700404915" onmouseenter="enter('8974054037700404915');" onmouseout="out('8974054037700404915');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 132 -        task.setMaxSpeed(maxSpeed);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 133 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 134 -    }                                                                                                             </span>
<span class="-5640948235258648086" onmouseenter="enter('-5640948235258648086');" onmouseout="out('-5640948235258648086');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 135 +  public SparseArray&lt;AbsThreadTask&gt; getTaskList() {                                                               </span>
<span class="4274533672597507440" onmouseenter="enter('4274533672597507440');" onmouseout="out('4274533672597507440');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 136 +    return mTask;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137    }                                                                                                               </span>
<span  style=""> 138                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 139    /**                                                                                                             </span>
<span class="5501330737777447325" onmouseenter="enter('5501330737777447325');" onmouseout="out('5501330737777447325');" style=""> 140     * 重置任务状态                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 141     */                                                                                                             </span>
<span class="769592541207569755" onmouseenter="enter('769592541207569755');" onmouseout="out('769592541207569755');" style=""> 142    private void resetState() {                                                                                     </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 143      closeTimer();                                                                                                 </span>
<span class="-8079256701752176328" onmouseenter="enter('-8079256701752176328');" onmouseout="out('-8079256701752176328');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 144 -    mCompleteThreadNum = 0;                                                                                       </span>
<span class="-7538891183274876048" onmouseenter="enter('-7538891183274876048');" onmouseout="out('-7538891183274876048');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 145 -    mTotalThreadNum = 0;                                                                                          </span>
<span class="86382318944182160" onmouseenter="enter('86382318944182160');" onmouseout="out('86382318944182160');" style=""> 146      if (mTask != null &amp;&amp; mTask.size() != 0) {                                                                     </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 147        for (int i = 0; i &lt; mTask.size(); i++) {                                                                    </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 148          AbsThreadTask task = mTask.get(i);                                                                        </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 149          if (task != null) {                                                                                       </span>
<span class="4672639676050941541" onmouseenter="enter('4672639676050941541');" onmouseout="out('4672639676050941541');" style=""> 150            task.breakTask();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152        }                                                                                                           </span>
<span class="-5745867061804924715" onmouseenter="enter('-5745867061804924715');" onmouseout="out('-5745867061804924715');" style=""> 153        mTask.clear();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155    }                                                                                                               </span>
<span  style=""> 156                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 157    /**                                                                                                             </span>
<span class="-8036989040377605484" onmouseenter="enter('-8036989040377605484');" onmouseout="out('-8036989040377605484');" style=""> 158     * 开始流程                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 159     */                                                                                                             </span>
<span class="2659446283962947526" onmouseenter="enter('2659446283962947526');" onmouseout="out('2659446283962947526');" style=""> 160    private void startFlow() {                                                                                      </span>
<span class="-8163448594027824981" onmouseenter="enter('-8163448594027824981');" onmouseout="out('-8163448594027824981');" style=""> 161      if (isBreak()) {                                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 162        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163      }                                                                                                             </span>
<span class="-4000252108766936273" onmouseenter="enter('-4000252108766936273');" onmouseout="out('-4000252108766936273');" style=""> 164      resetState();                                                                                                 </span>
<span class="619404821214964502" onmouseenter="enter('619404821214964502');" onmouseout="out('619404821214964502');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 165 -    mConstance.resetState();                                                                                      </span>
<span class="-5970803377387365231" onmouseenter="enter('-5970803377387365231');" onmouseout="out('-5970803377387365231');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -    ALog.d(TAG, &quot;path: &quot; + getFilePath());                                                                        </span>
<span class="4297169302122369497" onmouseenter="enter('4297169302122369497');" onmouseout="out('4297169302122369497');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 167 -    checkRecord();                                                                                                </span>
<span class="6200019808906550914" onmouseenter="enter('6200019808906550914');" onmouseout="out('6200019808906550914');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 168 -    mConstance.TASK_RECORD = mRecord;                                                                             </span>
<span class="6047746770171298765" onmouseenter="enter('6047746770171298765');" onmouseout="out('6047746770171298765');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -    if (!mTaskWrapper.isSupportBP() || mTaskWrapper.asHttp().isChunked()) {                                       </span>
<span class="-7445970306128807043" onmouseenter="enter('-7445970306128807043');" onmouseout="out('-7445970306128807043');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 170 -      mTotalThreadNum = 1;                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 171 -    } else {                                                                                                      </span>
<span class="-2662097366456595872" onmouseenter="enter('-2662097366456595872');" onmouseout="out('-2662097366456595872');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 172 -      mTotalThreadNum =                                                                                           </span>
<span class="-3369577057112693246" onmouseenter="enter('-3369577057112693246');" onmouseout="out('-3369577057112693246');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 173 -          mTaskWrapper.isNewTask() ? setNewTaskThreadNum() : mTotalThreadNum;                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -    }                                                                                                             </span>
<span class="-5070363508518577757" onmouseenter="enter('-5070363508518577757');" onmouseout="out('-5070363508518577757');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -    mConstance.START_THREAD_NUM = mTotalThreadNum;                                                                </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 176 -                                                                                                                  </span>
<span class="4024149497083933587" onmouseenter="enter('4024149497083933587');" onmouseout="out('4024149497083933587');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 177 -    // 处理分块和动态文件参数                                                                                                </span>
<span class="-451816026666018417" onmouseenter="enter('-451816026666018417');" onmouseout="out('-451816026666018417');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 178 -    if (mTaskWrapper.isNewTask() &amp;&amp; mTaskWrapper instanceof DTaskWrapper) {                                       </span>
<span class="2770339381721664913" onmouseenter="enter('2770339381721664913');" onmouseout="out('2770339381721664913');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 179 -      AriaManager manager = AriaManager.getInstance(AriaManager.APP);                                             </span>
<span class="-2154459154886390887" onmouseenter="enter('-2154459154886390887');" onmouseout="out('-2154459154886390887');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 180 -      mRecord.isBlock = mTotalThreadNum &gt; 1 &amp;&amp; manager.getDownloadConfig().isUseBlock();                          </span>
<span class="-2540449873456748154" onmouseenter="enter('-2540449873456748154');" onmouseout="out('-2540449873456748154');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 181 -      // 线程数不等1并且没有使用块下载，则认为没有使用动态文件                                                                              </span>
<span class="-5904206368083695991" onmouseenter="enter('-5904206368083695991');" onmouseout="out('-5904206368083695991');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 182 -      mRecord.isOpenDynamicFile = mTotalThreadNum == 1 || mRecord.isBlock;                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 183 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 184 -                                                                                                                  </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 185 -    /*                                                                                                            </span>
<span class="-5495719390615277007" onmouseenter="enter('-5495719390615277007');" onmouseout="out('-5495719390615277007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 186 -     * mTaskWrapper.getEntity().getFileSize() != mTempFile.length()为兼容以前老版本代码                                     </span>
<span class="-5520474084619660394" onmouseenter="enter('-5520474084619660394');" onmouseout="out('-5520474084619660394');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 187 -     * 动态长度条件：                                                                                                    </span>
<span class="6678836087239710153" onmouseenter="enter('6678836087239710153');" onmouseout="out('6678836087239710153');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 188 -     * 1、总线程数为1，并且是新任务                                                                                            </span>
<span class="-8594380126502433751" onmouseenter="enter('-8594380126502433751');" onmouseout="out('-8594380126502433751');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 189 -     * 2、总线程数为1，不是新任务，但是长度不是文件全长度                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 190 -     */                                                                                                           </span>
<span class="3942500449895906903" onmouseenter="enter('3942500449895906903');" onmouseout="out('3942500449895906903');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 191 -    if (mTotalThreadNum == 1 &amp;&amp; (mTaskWrapper.getEntity().getFileSize() != mTempFile.length())) {                 </span>
<span class="-9210146412762468806" onmouseenter="enter('-9210146412762468806');" onmouseout="out('-9210146412762468806');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 192 -      mRecord.isOpenDynamicFile = true;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 193 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 194 -                                                                                                                  </span>
<span class="2108596284974852159" onmouseenter="enter('2108596284974852159');" onmouseout="out('2108596284974852159');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +    mRecord = new RecordHandler(mTaskWrapper).getRecord();                                                        </span>
<span class="-6826246836562616350" onmouseenter="enter('-6826246836562616350');" onmouseout="out('-6826246836562616350');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +    Looper.prepare();                                                                                             </span>
<span class="5149694805992184581" onmouseenter="enter('5149694805992184581');" onmouseout="out('5149694805992184581');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +    Looper looper = Looper.myLooper();                                                                            </span>
<span class="-3253896924586580699" onmouseenter="enter('-3253896924586580699');" onmouseout="out('-3253896924586580699');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +    mStateManager = getStateManager(looper);                                                                      </span>


<span class="6344410794906613415" onmouseenter="enter('6344410794906613415');" onmouseout="out('6344410794906613415');" style=""> 199      onPostPre();                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 200 -                                                                                                                  </span>
<span class="5989254615436994150" onmouseenter="enter('5989254615436994150');" onmouseout="out('5989254615436994150');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 201 -    if (!mTaskWrapper.isSupportBP()) {                                                                            </span>
<span class="-6182854007095635032" onmouseenter="enter('-6182854007095635032');" onmouseout="out('-6182854007095635032');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 202 -      handleNoSupportBP();                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 203 -    } else {                                                                                                      </span>
<span class="304482857231090385" onmouseenter="enter('304482857231090385');" onmouseout="out('304482857231090385');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 204 -      handleBreakpoint();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 205 -    }                                                                                                             </span>
<span class="-7724548171203838725" onmouseenter="enter('-7724548171203838725');" onmouseout="out('-7724548171203838725');" style=""> 206      startTimer();                                                                                                 </span>
<span class="-5346338694472503069" onmouseenter="enter('-5346338694472503069');" onmouseout="out('-5346338694472503069');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +    handleTask();                                                                                                 </span>
<span class="7341795500457488125" onmouseenter="enter('7341795500457488125');" onmouseout="out('7341795500457488125');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +    Looper.loop();                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209    }                                                                                                               </span>
<span  style=""> 210                                                                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 211    @Override public void run() {                                                                                   </span>
<span class="6651633619385263409" onmouseenter="enter('6651633619385263409');" onmouseout="out('6651633619385263409');" style=""> 212      if (isRunning()) {                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 213        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214      }                                                                                                             </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 215      startFlow();                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216    }                                                                                                               </span>
<span  style=""> 217                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 218    /**                                                                                                             </span>
<span class="4044787794494402505" onmouseenter="enter('4044787794494402505');" onmouseout="out('4044787794494402505');" style=""> 219     * 预处理完成                                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 220     */                                                                                                             </span>
<span class="-5125657304217005566" onmouseenter="enter('-5125657304217005566');" onmouseout="out('-5125657304217005566');" style=""> 221    protected void onPostPre() {                                                                                    </span>
<span  style=""> 222                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223    }                                                                                                               </span>
<span  style=""> 224                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 225    /**                                                                                                             </span>
<span class="-5386582613838574396" onmouseenter="enter('-5386582613838574396');" onmouseout="out('-5386582613838574396');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 226 -   * 设置新任务的最大线程数                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 227 -   */                                                                                                             </span>
<span class="-6137859098551091137" onmouseenter="enter('-6137859098551091137');" onmouseout="out('-6137859098551091137');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -  protected abstract int setNewTaskThreadNum();                                                                   </span>
<span class="-8327624174212830499" onmouseenter="enter('-8327624174212830499');" onmouseout="out('-8327624174212830499');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +   * 延迟启动定时器                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +   */                                                                                                             </span>
<span class="2707724463201796910" onmouseenter="enter('2707724463201796910');" onmouseout="out('2707724463201796910');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +  protected long delayTimer() {                                                                                   </span>
<span class="-5665804692852603146" onmouseenter="enter('-5665804692852603146');" onmouseout="out('-5665804692852603146');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +    return 1000;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 233 +  }                                                                                                               </span>
<span  style=""> 234                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 235    /**                                                                                                             </span>
<span class="4041581137177203435" onmouseenter="enter('4041581137177203435');" onmouseout="out('4041581137177203435');" style=""> 236     * 启动进度获取定时器                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 237     */                                                                                                             </span>
<span class="1702258376619356446" onmouseenter="enter('1702258376619356446');" onmouseout="out('1702258376619356446');" style=""> 238    private synchronized void startTimer() {                                                                        </span>
<span class="8615364800642373101" onmouseenter="enter('8615364800642373101');" onmouseout="out('8615364800642373101');" style=""> 239      ALog.d(TAG, &quot;启动定时器&quot;);                                                                                         </span>
<span class="-9160623214484912914" onmouseenter="enter('-9160623214484912914');" onmouseout="out('-9160623214484912914');" style=""> 240      mTimer = new ScheduledThreadPoolExecutor(1);                                                                  </span>
<span class="4344341468621605861" onmouseenter="enter('4344341468621605861');" onmouseout="out('4344341468621605861');" style=""> 241      mTimer.scheduleWithFixedDelay(new Runnable() {                                                                </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 242        @Override public void run() {                                                                               </span>
<span class="5257678828672457716" onmouseenter="enter('5257678828672457716');" onmouseout="out('5257678828672457716');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 243 -        if (mConstance.isComplete()                                                                               </span>
<span class="334343515162691172" onmouseenter="enter('334343515162691172');" onmouseout="out('334343515162691172');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 244 -            || mConstance.isStop()                                                                                </span>
<span class="3923616872544648792" onmouseenter="enter('3923616872544648792');" onmouseout="out('3923616872544648792');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 245 -            || mConstance.isCancel()                                                                              </span>
<span class="-190933482997272097" onmouseenter="enter('-190933482997272097');" onmouseout="out('-190933482997272097');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 246 -            || mConstance.isFail()                                                                                </span>
<span class="-2600099651056425109" onmouseenter="enter('-2600099651056425109');" onmouseout="out('-2600099651056425109');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +        if (mStateManager.isComplete()                                                                            </span>
<span class="242988333280989926" onmouseenter="enter('242988333280989926');" onmouseout="out('242988333280989926');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +            || mStateManager.isStop()                                                                             </span>
<span class="-9217646883186463915" onmouseenter="enter('-9217646883186463915');" onmouseout="out('-9217646883186463915');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +            || mStateManager.isCancel()                                                                           </span>
<span class="-6792138316084162201" onmouseenter="enter('-6792138316084162201');" onmouseout="out('-6792138316084162201');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +            || mStateManager.isFail()                                                                             </span>
<span class="1045872412985382023" onmouseenter="enter('1045872412985382023');" onmouseout="out('1045872412985382023');" style=""> 251              || !isRunning()) {                                                                                    </span>
<span class="4052633304465856948" onmouseenter="enter('4052633304465856948');" onmouseout="out('4052633304465856948');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 252 -          if (mConstance.isComplete() || mConstance.isFail()) {                                                   </span>
<span class="3103159404811065674" onmouseenter="enter('3103159404811065674');" onmouseout="out('3103159404811065674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +          if (mStateManager.isComplete() || mStateManager.isFail()) {                                             </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 254              ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255            }                                                                                                       </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 256            closeTimer();                                                                                           </span>
<span class="5358021077686010059" onmouseenter="enter('5358021077686010059');" onmouseout="out('5358021077686010059');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 257 -        } else if (mConstance.CURRENT_LOCATION &gt;= 0) {                                                            </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 258 -          mListener.onProgress(mConstance.CURRENT_LOCATION);                                                      </span>
<span class="-8976455106279635226" onmouseenter="enter('-8976455106279635226');" onmouseout="out('-8976455106279635226');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +        } else if (mStateManager.getCurrentProgress() &gt;= 0) {                                                     </span>
<span class="-7130682954514056925" onmouseenter="enter('-7130682954514056925');" onmouseout="out('-7130682954514056925');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +          mListener.onProgress(mStateManager.getCurrentProgress());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 261          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262        }                                                                                                           </span>
<span class="-3114269409936550487" onmouseenter="enter('-3114269409936550487');" onmouseout="out('-3114269409936550487');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 263 -    }, 0, mUpdateInterval, TimeUnit.MILLISECONDS);                                                                </span>
<span class="4986548728620604588" onmouseenter="enter('4986548728620604588');" onmouseout="out('4986548728620604588');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 264 +    }, delayTimer(), mUpdateInterval, TimeUnit.MILLISECONDS);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265    }                                                                                                               </span>
<span  style=""> 266                                                                                                                    </span>
<span class="3982752692275613073" onmouseenter="enter('3982752692275613073');" onmouseout="out('3982752692275613073');" style=""> 267    public synchronized void closeTimer() {                                                                         </span>
<span class="-7001663665090653782" onmouseenter="enter('-7001663665090653782');" onmouseout="out('-7001663665090653782');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 268 +    ALog.d(TAG, &quot;关闭定时器&quot;);                                                                                         </span>
<span class="-1268142752100378972" onmouseenter="enter('-1268142752100378972');" onmouseout="out('-1268142752100378972');" style=""> 269      if (mTimer != null &amp;&amp; !mTimer.isShutdown()) {                                                                 </span>
<span class="4837418556669337408" onmouseenter="enter('4837418556669337408');" onmouseout="out('4837418556669337408');" style=""> 270        mTimer.shutdown();                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 271      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 272    }                                                                                                               </span>
<span  style=""> 273                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 274    /**                                                                                                             </span>
<span class="3310122691908792895" onmouseenter="enter('3310122691908792895');" onmouseout="out('3310122691908792895');" style=""> 275     * 设置定时器更新间隔                                                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 276     *                                                                                                              </span>
<span class="5926421498368036592" onmouseenter="enter('5926421498368036592');" onmouseout="out('5926421498368036592');" style=""> 277     * @param interval 单位毫秒，不能小于0                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 278     */                                                                                                             </span>
<span class="-6143371944494222779" onmouseenter="enter('-6143371944494222779');" onmouseout="out('-6143371944494222779');" style=""> 279    protected void setUpdateInterval(long interval) {                                                               </span>
<span class="-1051498944097002766" onmouseenter="enter('-1051498944097002766');" onmouseout="out('-1051498944097002766');" style=""> 280      if (interval &lt; 0) {                                                                                           </span>
<span class="3000915396455271078" onmouseenter="enter('3000915396455271078');" onmouseout="out('3000915396455271078');" style=""> 281        ALog.w(TAG, &quot;更新间隔不能小于0，默认为1000毫秒&quot;);                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 282        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 283      }                                                                                                             </span>
<span class="-3431322530378656562" onmouseenter="enter('-3431322530378656562');" onmouseout="out('-3431322530378656562');" style=""> 284      mUpdateInterval = interval;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 285    }                                                                                                               </span>
<span  style=""> 286                                                                                                                    </span>
<span class="-5758762106788202116" onmouseenter="enter('-5758762106788202116');" onmouseout="out('-5758762106788202116');" style=""> 287    public long getFileSize() {                                                                                     </span>
<span class="-7902485770489300682" onmouseenter="enter('-7902485770489300682');" onmouseout="out('-7902485770489300682');" style=""> 288      return mEntity.getFileSize();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289    }                                                                                                               </span>
<span  style=""> 290                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 291    /**                                                                                                             </span>
<span class="-7288086523564906780" onmouseenter="enter('-7288086523564906780');" onmouseout="out('-7288086523564906780');" style=""> 292     * 获取当前任务位置                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 293     */                                                                                                             </span>
<span class="3656547772237643757" onmouseenter="enter('3656547772237643757');" onmouseout="out('3656547772237643757');" style=""> 294    public long getCurrentLocation() {                                                                              </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 295 -    return mConstance.CURRENT_LOCATION;                                                                           </span>
<span class="-4293580056549457" onmouseenter="enter('-4293580056549457');" onmouseout="out('-4293580056549457');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +    return mStateManager.getCurrentProgress();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297    }                                                                                                               </span>
<span  style=""> 298                                                                                                                    </span>
<span class="430507706356584401" onmouseenter="enter('430507706356584401');" onmouseout="out('430507706356584401');" style=""> 299    public synchronized boolean isRunning() {                                                                       </span>
<span class="-7600400715455113368" onmouseenter="enter('-7600400715455113368');" onmouseout="out('-7600400715455113368');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 300 -    return ThreadTaskManager.getInstance().taskIsRunning(mTaskWrapper.getKey());                                  </span>
<span class="-3888627988187341127" onmouseenter="enter('-3888627988187341127');" onmouseout="out('-3888627988187341127');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +    boolean b = ThreadTaskManager.getInstance().taskIsRunning(mTaskWrapper.getKey());                             </span>
<span class="-4055314358126237867" onmouseenter="enter('-4055314358126237867');" onmouseout="out('-4055314358126237867');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 302 +    //ALog.d(TAG, &quot;isRunning = &quot; + b);                                                                            </span>
<span class="936248907371687111" onmouseenter="enter('936248907371687111');" onmouseout="out('936248907371687111');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 303 +    return b;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304    }                                                                                                               </span>
<span  style=""> 305                                                                                                                    </span>
<span class="7466876458085224213" onmouseenter="enter('7466876458085224213');" onmouseout="out('7466876458085224213');" style=""> 306    public synchronized void cancel() {                                                                             </span>
<span class="-3806794828534168829" onmouseenter="enter('-3806794828534168829');" onmouseout="out('-3806794828534168829');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 307 -    ALog.d(TAG, &quot;constance hash: &quot; + mConstance.hashCode());                                                      </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -    if (mConstance.isCancel) {                                                                                    </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 309 +    if (isCancel) {                                                                                               </span>
<span class="-5322688094560357059" onmouseenter="enter('-5322688094560357059');" onmouseout="out('-5322688094560357059');" style=""> 310        ALog.d(TAG, String.format(&quot;任务【%s】正在删除，删除任务失败&quot;, mTaskWrapper.getKey()));                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 311        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312      }                                                                                                             </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 313      closeTimer();                                                                                                 </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 314 -    mConstance.isCancel = true;                                                                                   </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 315 +    isCancel = true;                                                                                              </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 316      for (int i = 0; i &lt; mTask.size(); i++) {                                                                      </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 317        AbsThreadTask task = mTask.get(i);                                                                          </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 318        if (task != null) {                                                                                         </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style=""> 319          task.cancel();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321      }                                                                                                             </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 322      ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 323    }                                                                                                               </span>
<span  style=""> 324                                                                                                                    </span>
<span class="8656523468118489646" onmouseenter="enter('8656523468118489646');" onmouseout="out('8656523468118489646');" style=""> 325    public synchronized void stop() {                                                                               </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 326 -    if (mConstance.isStop) {                                                                                      </span>
<span class="7677583571575855110" onmouseenter="enter('7677583571575855110');" onmouseout="out('7677583571575855110');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 327 +    if (isStop) {                                                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 328        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 329      }                                                                                                             </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 330      closeTimer();                                                                                                 </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 331 -    mConstance.isStop = true;                                                                                     </span>
<span class="8402005296375476854" onmouseenter="enter('8402005296375476854');" onmouseout="out('8402005296375476854');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 332 -    if (mConstance.isComplete()) return;                                                                          </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 333 +    isStop = true;                                                                                                </span>
<span class="-7122141514229488110" onmouseenter="enter('-7122141514229488110');" onmouseout="out('-7122141514229488110');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 334 +    if (mStateManager.isComplete()) return;                                                                       </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 335      for (int i = 0; i &lt; mTask.size(); i++) {                                                                      </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 336        AbsThreadTask task = mTask.get(i);                                                                          </span>
<span class="-6295419555080725627" onmouseenter="enter('-6295419555080725627');" onmouseout="out('-6295419555080725627');" style=""> 337        if (task != null &amp;&amp; !task.isThreadComplete()) {                                                             </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style=""> 338          task.stop();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340      }                                                                                                             </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 341      ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342    }                                                                                                               </span>
<span  style=""> 343                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 344    /**                                                                                                             </span>
<span class="-7218687507933415946" onmouseenter="enter('-7218687507933415946');" onmouseout="out('-7218687507933415946');" style=""> 345     * 直接调用的时候会自动启动线程执行                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 346     */                                                                                                             </span>
<span class="-7265432148414046744" onmouseenter="enter('-7265432148414046744');" onmouseout="out('-7265432148414046744');" style=""> 347    public synchronized void start() {                                                                              </span>
<span class="6651633619385263409" onmouseenter="enter('6651633619385263409');" onmouseout="out('6651633619385263409');" style=""> 348      if (isRunning()) {                                                                                            </span>
<span class="4391999858354318805" onmouseenter="enter('4391999858354318805');" onmouseout="out('4391999858354318805');" style=""> 349        ALog.d(TAG, String.format(&quot;任务【%s】正在执行，启动任务失败&quot;, mTaskWrapper.getKey()));                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 350        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 351      }                                                                                                             </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style=""> 352      new Thread(this).start();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 353    }                                                                                                               </span>
<span  style=""> 354                                                                                                                    </span>
<span class="5993373674998630219" onmouseenter="enter('5993373674998630219');" onmouseout="out('5993373674998630219');" style=""> 355    public void resume() {                                                                                          </span>
<span class="-6183578153083367222" onmouseenter="enter('-6183578153083367222');" onmouseout="out('-6183578153083367222');" style=""> 356      start();                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 357    }                                                                                                               </span>
<span  style=""> 358                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 359    /**                                                                                                             </span>
<span class="3333036234618128246" onmouseenter="enter('3333036234618128246');" onmouseout="out('3333036234618128246');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 360 -   * 检查记录 对于分块任务： 子分块不存在或被删除，子线程将重新下载 对于普通任务： 预下载文件不存在，则任务任务呗删除                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 361 -   */                                                                                                             </span>
<span class="-3226254244315569492" onmouseenter="enter('-3226254244315569492');" onmouseout="out('-3226254244315569492');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 362 -  private void checkRecord() {                                                                                    </span>
<span class="-5297450492380711808" onmouseenter="enter('-5297450492380711808');" onmouseout="out('-5297450492380711808');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 363 -    mConfigFile = new File(CommonUtil.getFileConfigPath(false, mEntity.getFileName()));                           </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 364 -    if (mConfigFile.exists()) {                                                                                   </span>
<span class="7932310618145443523" onmouseenter="enter('7932310618145443523');" onmouseout="out('7932310618145443523');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 365 -      convertDb();                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 366 -    } else {                                                                                                      </span>
<span class="4647489036124418098" onmouseenter="enter('4647489036124418098');" onmouseout="out('4647489036124418098');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 367 -      mRecord = DbDataHelper.getTaskRecord(getFilePath());                                                        </span>
<span class="-3299415613061807412" onmouseenter="enter('-3299415613061807412');" onmouseout="out('-3299415613061807412');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 368 -      if (mRecord == null) {                                                                                      </span>
<span class="-6736410795519637054" onmouseenter="enter('-6736410795519637054');" onmouseout="out('-6736410795519637054');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 369 -        initRecord(true);                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 370 -      } else {                                                                                                    </span>
<span class="-7168613097949101282" onmouseenter="enter('-7168613097949101282');" onmouseout="out('-7168613097949101282');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 371 -        if (mRecord.threadRecords == null || mRecord.threadRecords.isEmpty()) {                                   </span>
<span class="-6736410795519637054" onmouseenter="enter('-6736410795519637054');" onmouseout="out('-6736410795519637054');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 372 -          initRecord(true);                                                                                       </span>
<span class="-5520464134160599469" onmouseenter="enter('-5520464134160599469');" onmouseout="out('-5520464134160599469');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 373 -        } else if (mRecord.isBlock) {                                                                             </span>
<span class="4499191396384356607" onmouseenter="enter('4499191396384356607');" onmouseout="out('4499191396384356607');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 374 -          handleBlockRecord();                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 375 -        } else {                                                                                                  </span>
<span class="-7429038303426788124" onmouseenter="enter('-7429038303426788124');" onmouseout="out('-7429038303426788124');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 376 -          handleNormalRecord();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 377 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 378 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 379 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 380 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 381 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 382 -  /**                                                                                                             </span>
<span class="-6732733519809936602" onmouseenter="enter('-6732733519809936602');" onmouseout="out('-6732733519809936602');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 383 -   * 处理普通任务的记录                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 384 -   */                                                                                                             </span>
<span class="2040790615597773652" onmouseenter="enter('2040790615597773652');" onmouseout="out('2040790615597773652');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 385 -  private void handleNormalRecord() {                                                                             </span>
<span class="3630450282049316686" onmouseenter="enter('3630450282049316686');" onmouseout="out('3630450282049316686');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 386 -    File file = new File(mRecord.filePath);                                                                       </span>
<span class="4133240422546463755" onmouseenter="enter('4133240422546463755');" onmouseout="out('4133240422546463755');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 387 -    if (!file.exists()) {                                                                                         </span>
<span class="-573220915101280348" onmouseenter="enter('-573220915101280348');" onmouseout="out('-573220915101280348');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 388 -      ALog.w(TAG, String.format(&quot;文件【%s】不存在，任务将重新开始&quot;, file.getPath()));                                            </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 389 -      mRecord.deleteData();                                                                                       </span>
<span class="-6736410795519637054" onmouseenter="enter('-6736410795519637054');" onmouseout="out('-6736410795519637054');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 390 -      initRecord(true);                                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 391 -      return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 392 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 393 -                                                                                                                  </span>
<span class="-5277098832070231051" onmouseenter="enter('-5277098832070231051');" onmouseout="out('-5277098832070231051');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 394 -    if (mRecord.isOpenDynamicFile) {                                                                              </span>
<span class="2008386981860280225" onmouseenter="enter('2008386981860280225');" onmouseout="out('2008386981860280225');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 395 -      ThreadRecord tr = mRecord.threadRecords.get(0);                                                             </span>
<span class="8432511455550217781" onmouseenter="enter('8432511455550217781');" onmouseout="out('8432511455550217781');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 396 -      if (tr == null) {                                                                                           </span>
<span class="4148181859028624217" onmouseenter="enter('4148181859028624217');" onmouseout="out('4148181859028624217');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 397 -        ALog.d(TAG, &quot;线程记录为空，任务为新任务&quot;);                                                                             </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 398 -        mTaskWrapper.setNewTask(true);                                                                            </span>
<span class="-7445970306128807043" onmouseenter="enter('-7445970306128807043');" onmouseout="out('-7445970306128807043');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 399 -        mTotalThreadNum = 1;                                                                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 400 -        return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 401 -      }                                                                                                           </span>
<span class="3490117773955769870" onmouseenter="enter('3490117773955769870');" onmouseout="out('3490117773955769870');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 402 -      if (file.length() &gt; mEntity.getFileSize()) {                                                                </span>
<span class="-282245710257793553" onmouseenter="enter('-282245710257793553');" onmouseout="out('-282245710257793553');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 403 -        ALog.i(TAG, String.format(&quot;文件【%s】错误，任务重新开始&quot;, file.getPath()));                                            </span>
<span class="1841259700134023722" onmouseenter="enter('1841259700134023722');" onmouseout="out('1841259700134023722');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 404 -        file.delete();                                                                                            </span>
<span class="1028121270302202149" onmouseenter="enter('1028121270302202149');" onmouseout="out('1028121270302202149');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 405 -        tr.startLocation = 0;                                                                                     </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 406 -        tr.isComplete = false;                                                                                    </span>
<span class="6462437329823623234" onmouseenter="enter('6462437329823623234');" onmouseout="out('6462437329823623234');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 407 -        tr.endLocation = mEntity.getFileSize();                                                                   </span>
<span class="7176785819267604956" onmouseenter="enter('7176785819267604956');" onmouseout="out('7176785819267604956');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 408 -      } else if (file.length() == mEntity.getFileSize()) {                                                        </span>
<span class="6364817192610155634" onmouseenter="enter('6364817192610155634');" onmouseout="out('6364817192610155634');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 409 -        tr.isComplete = true;                                                                                     </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 410 -        mCompleteThreadNum++;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 411 -      } else {                                                                                                    </span>
<span class="-3426671339714424" onmouseenter="enter('-3426671339714424');" onmouseout="out('-3426671339714424');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 412 -        if (file.length() != tr.startLocation) {                                                                  </span>
<span class="2922121341147867007" onmouseenter="enter('2922121341147867007');" onmouseout="out('2922121341147867007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 413 -          ALog.i(TAG, String.format(&quot;修正【%s】的进度记录为：%s&quot;, file.getPath(), file.length()));                           </span>
<span class="1238856845335327056" onmouseenter="enter('1238856845335327056');" onmouseout="out('1238856845335327056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 414 -          tr.startLocation = file.length();                                                                       </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 415 -          tr.isComplete = false;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 416 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 417 -      }                                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 418 -    } else {                                                                                                      </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 419 -      for (ThreadRecord tr : mRecord.threadRecords) {                                                             </span>
<span class="-6249885869558348483" onmouseenter="enter('-6249885869558348483');" onmouseout="out('-6249885869558348483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 420 -        if (tr.isComplete) {                                                                                      </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 421 -          mCompleteThreadNum++;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 422 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 423 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 424 -    }                                                                                                             </span>
<span class="-4812553014330515673" onmouseenter="enter('-4812553014330515673');" onmouseout="out('-4812553014330515673');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 425 -    mTotalThreadNum = mRecord.threadRecords.size();                                                               </span>
<span class="7955340223234605" onmouseenter="enter('7955340223234605');" onmouseout="out('7955340223234605');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 426 -    mTaskWrapper.setNewTask(false);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 427 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 428 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 429 -  /**                                                                                                             </span>
<span class="-1504497308241871367" onmouseenter="enter('-1504497308241871367');" onmouseout="out('-1504497308241871367');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 430 -   * 处理分块任务的记录，分块文件（blockFileLen）长度必须需要小于等于线程区间（threadRectLen）的长度                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 431 -   */                                                                                                             </span>
<span class="2850638396080836255" onmouseenter="enter('2850638396080836255');" onmouseout="out('2850638396080836255');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 432 -  private void handleBlockRecord() {                                                                              </span>
<span class="-6754358035051648935" onmouseenter="enter('-6754358035051648935');" onmouseout="out('-6754358035051648935');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 433 -    // 默认线程分块长度                                                                                                   </span>
<span class="7954826708259222" onmouseenter="enter('7954826708259222');" onmouseout="out('7954826708259222');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 434 -    long normalRectLen = mEntity.getFileSize() / mRecord.threadRecords.size();                                    </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 435 -    for (ThreadRecord tr : mRecord.threadRecords) {                                                               </span>
<span class="965474740392839629" onmouseenter="enter('965474740392839629');" onmouseout="out('965474740392839629');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 436 -      long threadRect = tr.blockLen;                                                                              </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 437 -                                                                                                                  </span>
<span class="1783305833880375310" onmouseenter="enter('1783305833880375310');" onmouseout="out('1783305833880375310');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 438 -      File temp = new File(String.format(SUB_PATH, mRecord.filePath, tr.threadId));                               </span>
<span class="-2809861036487449932" onmouseenter="enter('-2809861036487449932');" onmouseout="out('-2809861036487449932');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 439 -      if (!temp.exists()) {                                                                                       </span>
<span class="-8428377895201906885" onmouseenter="enter('-8428377895201906885');" onmouseout="out('-8428377895201906885');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 440 -        ALog.i(TAG, String.format(&quot;分块文件【%s】不存在，该分块将重新开始&quot;, temp.getPath()));                                       </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 441 -        tr.isComplete = false;                                                                                    </span>
<span class="-7212380725645212688" onmouseenter="enter('-7212380725645212688');" onmouseout="out('-7212380725645212688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 442 -        tr.startLocation = -1;                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 443 -      } else {                                                                                                    </span>
<span class="-6249885869558348483" onmouseenter="enter('-6249885869558348483');" onmouseout="out('-6249885869558348483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 444 -        if (tr.isComplete) {                                                                                      </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 445 -          mCompleteThreadNum++;                                                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 446 -        } else {                                                                                                  </span>
<span class="67760423539567228" onmouseenter="enter('67760423539567228');" onmouseout="out('67760423539567228');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 447 -          ALog.i(TAG, String.format(                                                                              </span>
<span class="3005157305258750727" onmouseenter="enter('3005157305258750727');" onmouseout="out('3005157305258750727');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 448 -              &quot;startLocation = %s; endLocation = %s; block = %s; tempLen = %s; threadId = %s&quot;,                    </span>
<span class="557123456234898856" onmouseenter="enter('557123456234898856');" onmouseout="out('557123456234898856');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 449 -              tr.startLocation, tr.endLocation, threadRect, temp.length(), tr.threadId));                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 450 -                                                                                                                  </span>
<span class="-793137946029070789" onmouseenter="enter('-793137946029070789');" onmouseout="out('-793137946029070789');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 451 -          long blockFileLen = temp.length(); // 磁盘中的分块文件长度                                                        </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 452 -          /*                                                                                                      </span>
<span class="3457188544010136028" onmouseenter="enter('3457188544010136028');" onmouseout="out('3457188544010136028');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 453 -           * 检查磁盘中的分块文件                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 454 -           */                                                                                                     </span>
<span class="7157771772038955316" onmouseenter="enter('7157771772038955316');" onmouseout="out('7157771772038955316');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 455 -          if (blockFileLen &gt; threadRect) {                                                                        </span>
<span class="-3960295116545159248" onmouseenter="enter('-3960295116545159248');" onmouseout="out('-3960295116545159248');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 456 -            ALog.i(TAG, String.format(&quot;分块【%s】错误，分块长度【%s】 &gt; 线程区间长度【%s】，将重新开始该分块&quot;,                                  </span>
<span class="-6060651799112635756" onmouseenter="enter('-6060651799112635756');" onmouseout="out('-6060651799112635756');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 457 -                tr.threadId, blockFileLen, threadRect));                                                          </span>
<span class="-2826646494613153676" onmouseenter="enter('-2826646494613153676');" onmouseout="out('-2826646494613153676');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 458 -            temp.delete();                                                                                        </span>
<span class="8640140040149112263" onmouseenter="enter('8640140040149112263');" onmouseout="out('8640140040149112263');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 459 -            tr.startLocation = tr.threadId * threadRect;                                                          </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 460 -            continue;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 461 -          }                                                                                                       </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 462 -                                                                                                                  </span>
<span class="1282738932104176357" onmouseenter="enter('1282738932104176357');" onmouseout="out('1282738932104176357');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 463 -          long realLocation =                                                                                     </span>
<span class="-6413770924091570394" onmouseenter="enter('-6413770924091570394');" onmouseout="out('-6413770924091570394');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 464 -              tr.threadId * normalRectLen + blockFileLen; //正常情况下，该线程的startLocation的位置                            </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 465 -          /*                                                                                                      </span>
<span class="-3196943470889273987" onmouseenter="enter('-3196943470889273987');" onmouseout="out('-3196943470889273987');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 466 -           * 检查记录文件                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 467 -           */                                                                                                     </span>
<span class="-7365986240976322143" onmouseenter="enter('-7365986240976322143');" onmouseout="out('-7365986240976322143');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 468 -          if (blockFileLen == threadRect) {                                                                       </span>
<span class="-3715847581530045195" onmouseenter="enter('-3715847581530045195');" onmouseout="out('-3715847581530045195');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 469 -            ALog.i(TAG, String.format(&quot;分块【%s】已完成，更新记录&quot;, temp.getPath()));                                         </span>
<span class="1152086888298905021" onmouseenter="enter('1152086888298905021');" onmouseout="out('1152086888298905021');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 470 -            tr.startLocation = blockFileLen;                                                                      </span>
<span class="6364817192610155634" onmouseenter="enter('6364817192610155634');" onmouseout="out('6364817192610155634');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 471 -            tr.isComplete = true;                                                                                 </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 472 -            mCompleteThreadNum++;                                                                                 </span>
<span class="-5838140850326599069" onmouseenter="enter('-5838140850326599069');" onmouseout="out('-5838140850326599069');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 473 -          } else if (tr.startLocation != realLocation) { // 处理记录小于分块文件长度的情况                                       </span>
<span class="2932557069165298429" onmouseenter="enter('2932557069165298429');" onmouseout="out('2932557069165298429');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 474 -            ALog.i(TAG, String.format(&quot;修正分块【%s】的进度记录为：%s&quot;, temp.getPath(), realLocation));                        </span>
<span class="4676730033229053821" onmouseenter="enter('4676730033229053821');" onmouseout="out('4676730033229053821');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 475 -            tr.startLocation = realLocation;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 476 -          }                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 477 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 478 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 479 -    }                                                                                                             </span>
<span class="-4812553014330515673" onmouseenter="enter('-4812553014330515673');" onmouseout="out('-4812553014330515673');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 480 -    mTotalThreadNum = mRecord.threadRecords.size();                                                               </span>
<span class="7955340223234605" onmouseenter="enter('7955340223234605');" onmouseout="out('7955340223234605');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 481 -    mTaskWrapper.setNewTask(false);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 482 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 483 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 484 -  /**                                                                                                             </span>
<span class="4426545154492852727" onmouseenter="enter('4426545154492852727');" onmouseout="out('4426545154492852727');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 485 -   * convertDb 是兼容性代码 从3.4.1开始，线程配置信息将存储在数据库中。 将配置文件的内容复制到数据库中，并将配置文件删除                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 486 -   */                                                                                                             </span>
<span class="14298455509427519" onmouseenter="enter('14298455509427519');" onmouseout="out('14298455509427519');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 487 -  private void convertDb() {                                                                                      </span>
<span class="-4598298306615401010" onmouseenter="enter('-4598298306615401010');" onmouseout="out('-4598298306615401010');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 488 -    List&lt;RecordWrapper&gt; records =                                                                                 </span>
<span class="-4738968014729726274" onmouseenter="enter('-4738968014729726274');" onmouseout="out('-4738968014729726274');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 489 -        DbEntity.findRelationData(RecordWrapper.class, &quot;TaskRecord.filePath=?&quot;,                                   </span>
<span class="1664646851824584272" onmouseenter="enter('1664646851824584272');" onmouseout="out('1664646851824584272');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 490 -            getFilePath());                                                                                       </span>
<span class="-376648440877788579" onmouseenter="enter('-376648440877788579');" onmouseout="out('-376648440877788579');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 491 -    if (records == null || records.size() == 0) {                                                                 </span>
<span class="7274393295178915569" onmouseenter="enter('7274393295178915569');" onmouseout="out('7274393295178915569');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 492 -      Properties pro = CommonUtil.loadConfig(mConfigFile);                                                        </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 493 -      if (pro.isEmpty()) {                                                                                        </span>
<span class="6270101186355835075" onmouseenter="enter('6270101186355835075');" onmouseout="out('6270101186355835075');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 494 -        ALog.d(TAG, &quot;老版本的线程记录为空，任务为新任务&quot;);                                                                         </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 495 -        mTaskWrapper.setNewTask(true);                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 496 -        return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 497 -      }                                                                                                           </span>
<span class="-3891780371452029435" onmouseenter="enter('-3891780371452029435');" onmouseout="out('-3891780371452029435');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 498 -      initRecord(false);                                                                                          </span>
<span class="-4092719147494026286" onmouseenter="enter('-4092719147494026286');" onmouseout="out('-4092719147494026286');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 499 -      Set&lt;Object&gt; keys = pro.keySet();                                                                            </span>
<span class="7117164647387083506" onmouseenter="enter('7117164647387083506');" onmouseout="out('7117164647387083506');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 500 -      // 老版本记录是5s存一次，但是5s中内，如果线程执行完成，record记录是没有的，只有state记录...                                                    </span>
<span class="8442347856216504710" onmouseenter="enter('8442347856216504710');" onmouseout="out('8442347856216504710');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 501 -      // 第一步应该是record 和 state去重取正确的线程数                                                                            </span>
<span class="3880560860847601414" onmouseenter="enter('3880560860847601414');" onmouseout="out('3880560860847601414');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 502 -      Set&lt;Integer&gt; set = new HashSet&lt;&gt;();                                                                         </span>
<span class="-5644624400733519290" onmouseenter="enter('-5644624400733519290');" onmouseout="out('-5644624400733519290');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 503 -      for (Object key : keys) {                                                                                   </span>
<span class="-90111359741489740" onmouseenter="enter('-90111359741489740');" onmouseout="out('-90111359741489740');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 504 -        String str = String.valueOf(key);                                                                         </span>
<span class="5431713397557299419" onmouseenter="enter('5431713397557299419');" onmouseout="out('5431713397557299419');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 505 -        int i = Integer.parseInt(str.substring(str.length() - 1, str.length()));                                  </span>
<span class="5139166377005733880" onmouseenter="enter('5139166377005733880');" onmouseout="out('5139166377005733880');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 506 -        set.add(i);                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 507 -      }                                                                                                           </span>
<span class="1773727540275693887" onmouseenter="enter('1773727540275693887');" onmouseout="out('1773727540275693887');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 508 -      int threadNum = set.size();                                                                                 </span>
<span class="1658307869252768908" onmouseenter="enter('1658307869252768908');" onmouseout="out('1658307869252768908');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 509 -      if (threadNum == 0) {                                                                                       </span>
<span class="1148319986505262760" onmouseenter="enter('1148319986505262760');" onmouseout="out('1148319986505262760');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 510 -        ALog.d(TAG, &quot;线程数为空，任务为新任务&quot;);                                                                              </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 511 -        mTaskWrapper.setNewTask(true);                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 512 -        return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 513 -      }                                                                                                           </span>
<span class="8980547023143351106" onmouseenter="enter('8980547023143351106');" onmouseout="out('8980547023143351106');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 514 -      mRecord.threadNum = threadNum;                                                                              </span>
<span class="1082026445239340300" onmouseenter="enter('1082026445239340300');" onmouseout="out('1082026445239340300');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 515 -      mTotalThreadNum = threadNum;                                                                                </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 516 -                                                                                                                  </span>
<span class="92058997093189211" onmouseenter="enter('92058997093189211');" onmouseout="out('92058997093189211');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 517 -      for (int i = 0; i &lt; threadNum; i++) {                                                                       </span>
<span class="1846142719149590893" onmouseenter="enter('1846142719149590893');" onmouseout="out('1846142719149590893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 518 -        ThreadRecord tRecord = new ThreadRecord();                                                                </span>
<span class="-543854586085341709" onmouseenter="enter('-543854586085341709');" onmouseout="out('-543854586085341709');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 519 -        tRecord.key = mRecord.filePath;                                                                           </span>
<span class="-1285896534897014429" onmouseenter="enter('-1285896534897014429');" onmouseout="out('-1285896534897014429');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 520 -        Object state = pro.getProperty(mTempFile.getName() + STATE + i);                                          </span>
<span class="7744986855104654034" onmouseenter="enter('7744986855104654034');" onmouseout="out('7744986855104654034');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 521 -        Object record = pro.getProperty(mTempFile.getName() + RECORD + i);                                        </span>
<span class="-1417732743646819816" onmouseenter="enter('-1417732743646819816');" onmouseout="out('-1417732743646819816');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 522 -        if (state != null &amp;&amp; Integer.parseInt(String.valueOf(state)) == 1) {                                      </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 523 -          mCompleteThreadNum++;                                                                                   </span>
<span class="-5900743039323389312" onmouseenter="enter('-5900743039323389312');" onmouseout="out('-5900743039323389312');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 524 -          tRecord.isComplete = true;                                                                              </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 525 -          continue;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 526 -        }                                                                                                         </span>
<span class="2652986304939921073" onmouseenter="enter('2652986304939921073');" onmouseout="out('2652986304939921073');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 527 -        if (record != null) {                                                                                     </span>
<span class="7355303051831508853" onmouseenter="enter('7355303051831508853');" onmouseout="out('7355303051831508853');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 528 -          long temp = Long.parseLong(String.valueOf(record));                                                     </span>
<span class="6949017848225026676" onmouseenter="enter('6949017848225026676');" onmouseout="out('6949017848225026676');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 529 -          tRecord.startLocation = temp &gt; 0 ? temp : 0;                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 530 -        } else {                                                                                                  </span>
<span class="-2463924567028920967" onmouseenter="enter('-2463924567028920967');" onmouseout="out('-2463924567028920967');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 531 -          tRecord.startLocation = 0;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 532 -        }                                                                                                         </span>
<span class="8450336720909475026" onmouseenter="enter('8450336720909475026');" onmouseout="out('8450336720909475026');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 533 -        mRecord.threadRecords.add(tRecord);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 534 -      }                                                                                                           </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 535 -      mConfigFile.delete();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 536 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 537 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 538 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 539 -  /**                                                                                                             </span>
<span class="-671827589422898020" onmouseenter="enter('-671827589422898020');" onmouseout="out('-671827589422898020');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 540 -   * 初始化记录                                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 541 -   */                                                                                                             </span>
<span class="-2906418018028154375" onmouseenter="enter('-2906418018028154375');" onmouseout="out('-2906418018028154375');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 542 -  private void initRecord(boolean isNewTask) {                                                                    </span>
<span class="1363226846886967285" onmouseenter="enter('1363226846886967285');" onmouseout="out('1363226846886967285');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 543 -    mRecord = new TaskRecord();                                                                                   </span>
<span class="-5083582960729315317" onmouseenter="enter('-5083582960729315317');" onmouseout="out('-5083582960729315317');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 544 -    mRecord.fileName = mEntity.getFileName();                                                                     </span>
<span class="-7985468931740615125" onmouseenter="enter('-7985468931740615125');" onmouseout="out('-7985468931740615125');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 545 -    mRecord.filePath = getFilePath();                                                                             </span>
<span class="-4117247167556656758" onmouseenter="enter('-4117247167556656758');" onmouseout="out('-4117247167556656758');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 546 -    mRecord.threadRecords = new ArrayList&lt;&gt;();                                                                    </span>
<span class="-836005293351845064" onmouseenter="enter('-836005293351845064');" onmouseout="out('-836005293351845064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 547 -    mRecord.isGroupRecord = mTaskWrapper.getEntity().isGroupChild();                                              </span>
<span class="8800687954183002826" onmouseenter="enter('8800687954183002826');" onmouseout="out('8800687954183002826');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 548 -    if (mRecord.isGroupRecord) {                                                                                  </span>
<span class="-2142257617502598183" onmouseenter="enter('-2142257617502598183');" onmouseout="out('-2142257617502598183');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 549 -      if (mTaskWrapper.getEntity() instanceof DownloadEntity) {                                                   </span>
<span class="7369297745882463144" onmouseenter="enter('7369297745882463144');" onmouseout="out('7369297745882463144');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 550 -        mRecord.dGroupHash = ((DownloadEntity) mTaskWrapper.getEntity()).getGroupHash();                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 551 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 552 -    }                                                                                                             </span>
<span class="5292161376259483255" onmouseenter="enter('5292161376259483255');" onmouseout="out('5292161376259483255');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 553 -    ALog.d(TAG, String.format(&quot;初始化记录，任务为%s任务&quot;, isNewTask ? &quot;新&quot; : &quot;旧&quot;));                                           </span>
<span class="-6248689121619565411" onmouseenter="enter('-6248689121619565411');" onmouseout="out('-6248689121619565411');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 554 -    mTaskWrapper.setNewTask(isNewTask);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 555 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 556 -                                                                                                                  </span>
<span class="-8326432688154281329" onmouseenter="enter('-8326432688154281329');" onmouseout="out('-8326432688154281329');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 557 -  private String getFilePath() {                                                                                  </span>
<span class="-6837435483425150362" onmouseenter="enter('-6837435483425150362');" onmouseout="out('-6837435483425150362');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 558 -    if (getType() == DOWNLOAD) {                                                                                  </span>
<span class="-5130089930686560901" onmouseenter="enter('-5130089930686560901');" onmouseout="out('-5130089930686560901');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 559 -      return ((DownloadEntity) mTaskWrapper.getEntity()).getDownloadPath();                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 560 -    } else {                                                                                                      </span>
<span class="-2519282598545089845" onmouseenter="enter('-2519282598545089845');" onmouseout="out('-2519282598545089845');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 561 -      return ((UploadEntity) mTaskWrapper.getEntity()).getFilePath();                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 562 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 563 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 564 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 565 -  /**                                                                                                             </span>
<span class="-8991940256279851469" onmouseenter="enter('-8991940256279851469');" onmouseout="out('-8991940256279851469');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 566 -   * 保存任务记录                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 567 -   */                                                                                                             </span>
<span class="1188287987342183098" onmouseenter="enter('1188287987342183098');" onmouseout="out('1188287987342183098');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 568 -  private void saveRecord() {                                                                                     </span>
<span class="-6872584921755914518" onmouseenter="enter('-6872584921755914518');" onmouseout="out('-6872584921755914518');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 569 -    mRecord.threadNum = mRecord.threadRecords.size();                                                             </span>
<span class="-3343791891312496302" onmouseenter="enter('-3343791891312496302');" onmouseout="out('-3343791891312496302');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 570 -    mRecord.save();                                                                                               </span>
<span class="-5403271851700040427" onmouseenter="enter('-5403271851700040427');" onmouseout="out('-5403271851700040427');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 571 -    ALog.d(TAG, String.format(&quot;保存记录，线程记录数：%s&quot;, mRecord.threadRecords.size()));                                    </span>
<span class="-5558090595010223508" onmouseenter="enter('-5558090595010223508');" onmouseout="out('-5558090595010223508');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 572 -    DbEntity.saveAll(mRecord.threadRecords);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 573 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 574 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 575 -  /**                                                                                                             </span>
<span class="7661061719912178382" onmouseenter="enter('7661061719912178382');" onmouseout="out('7661061719912178382');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 576 -   * 恢复记录地址                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 577 -   *                                                                                                              </span>
<span class="-1706428464808283045" onmouseenter="enter('-1706428464808283045');" onmouseout="out('-1706428464808283045');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 578 -   * @return {@code true}任务已完成                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 579 -   */                                                                                                             </span>
<span class="423019558917313706" onmouseenter="enter('423019558917313706');" onmouseout="out('423019558917313706');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 580 -  private boolean resumeRecordLocation(int i, long startL, long endL) {                                           </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 581 -    mConstance.CURRENT_LOCATION += endL - startL;                                                                 </span>
<span class="-536040810321338414" onmouseenter="enter('-536040810321338414');" onmouseout="out('-536040810321338414');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 582 -    ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__已完成&quot;, mTaskWrapper.getEntity().getFileName(), i));                   </span>
<span class="3932130165010443212" onmouseenter="enter('3932130165010443212');" onmouseout="out('3932130165010443212');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 583 -    mConstance.COMPLETE_THREAD_NUM = mCompleteThreadNum;                                                          </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 584 -    mConstance.STOP_NUM++;                                                                                        </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 585 -    mConstance.CANCEL_NUM++;                                                                                      </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 586 -    if (mConstance.isComplete()) {                                                                                </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 587 -      mRecord.deleteData();                                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 588 -      mListener.onComplete();                                                                                     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 589 -      return true;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 590 -    }                                                                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 591 -    return false;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 592 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 593 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 594 -  /**                                                                                                             </span>
<span class="8881300510663389339" onmouseenter="enter('8881300510663389339');" onmouseout="out('8881300510663389339');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 595 -   * 启动断点任务时，创建单线程任务                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 596 -   *                                                                                                              </span>
<span class="4311889051397531831" onmouseenter="enter('4311889051397531831');" onmouseout="out('4311889051397531831');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 597 -   * @param i 线程id                                                                                                </span>
<span class="1230174220176038900" onmouseenter="enter('1230174220176038900');" onmouseout="out('1230174220176038900');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 598 -   * @param startL 该任务起始位置                                                                                        </span>
<span class="1858994332528537357" onmouseenter="enter('1858994332528537357');" onmouseout="out('1858994332528537357');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 599 -   * @param endL 该任务结束位置                                                                                          </span>
<span class="4908980689327331914" onmouseenter="enter('4908980689327331914');" onmouseout="out('4908980689327331914');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 600 -   * @param fileLength 该任务需要处理的文件长度                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 601 -   */                                                                                                             </span>
<span class="8417307416647678377" onmouseenter="enter('8417307416647678377');" onmouseout="out('8417307416647678377');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 602 -  private AbsThreadTask createSingThreadTask(int i, long startL, long endL, long fileLength,                      </span>
<span class="-2934306509623024164" onmouseenter="enter('-2934306509623024164');" onmouseout="out('-2934306509623024164');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 603 -      ThreadRecord record) {                                                                                      </span>




<span class="619060527413120496" onmouseenter="enter('619060527413120496');" onmouseout="out('619060527413120496');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 604 -    SubThreadConfig&lt;TASK_WRAPPER&gt; config = new SubThreadConfig&lt;&gt;();                                               </span>
<span class="3695278979318197874" onmouseenter="enter('3695278979318197874');" onmouseout="out('3695278979318197874');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 605 -    config.TOTAL_FILE_SIZE = fileLength;                                                                          </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 606 -    config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                              </span>
<span class="8163353749053363911" onmouseenter="enter('8163353749053363911');" onmouseout="out('8163353749053363911');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 607 -    config.TEMP_FILE =                                                                                            </span>
<span class="8812115108936854999" onmouseenter="enter('8812115108936854999');" onmouseout="out('8812115108936854999');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 608 -        mRecord.isBlock ? new File(String.format(SUB_PATH, mTempFile.getPath(), i)) : mTempFile;                  </span>
<span class="-8589974584258899309" onmouseenter="enter('-8589974584258899309');" onmouseout="out('-8589974584258899309');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 609 -    config.THREAD_ID = i;                                                                                         </span>
<span class="-423990566973150114" onmouseenter="enter('-423990566973150114');" onmouseout="out('-423990566973150114');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 610 -    config.START_LOCATION = startL;                                                                               </span>
<span class="7030036366591044852" onmouseenter="enter('7030036366591044852');" onmouseout="out('7030036366591044852');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 611 -    config.END_LOCATION = endL;                                                                                   </span>
<span class="6707181570367944829" onmouseenter="enter('6707181570367944829');" onmouseout="out('6707181570367944829');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 612 -    config.SUPPORT_BP = mTaskWrapper.isSupportBP();                                                               </span>
<span class="-4458980325189718812" onmouseenter="enter('-4458980325189718812');" onmouseout="out('-4458980325189718812');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 613 -    config.TASK_WRAPPER = mTaskWrapper;                                                                           </span>
<span class="-4817448612298280426" onmouseenter="enter('-4817448612298280426');" onmouseout="out('-4817448612298280426');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 614 -    config.THREAD_RECORD = record;                                                                                </span>











<span class="-3921818352268167442" onmouseenter="enter('-3921818352268167442');" onmouseout="out('-3921818352268167442');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 615 -    return selectThreadTask(config);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 616 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 617 -                                                                                                                  </span>
<span class="6532423587840407518" onmouseenter="enter('6532423587840407518');" onmouseout="out('6532423587840407518');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 618 -  private void handleBreakpoint() {                                                                               </span>
<span class="-4822982872266026601" onmouseenter="enter('-4822982872266026601');" onmouseout="out('-4822982872266026601');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 619 -    long fileLength = mEntity.getFileSize();                                                                      </span>
<span class="-23207299311678828" onmouseenter="enter('-23207299311678828');" onmouseout="out('-23207299311678828');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 620 -    long blockSize = fileLength / mTotalThreadNum;                                                                </span>
<span class="-3393480437861582877" onmouseenter="enter('-3393480437861582877');" onmouseout="out('-3393480437861582877');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 621 -    Set&lt;Integer&gt; threads = new HashSet&lt;&gt;();                                                                       </span>
<span class="-5777658456236299795" onmouseenter="enter('-5777658456236299795');" onmouseout="out('-5777658456236299795');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 622 -    //// 如果是新任务，检查下历史记录，如果有遗留的记录，删除并删除分块文件                                                                        </span>
<span class="-4510395139998187778" onmouseenter="enter('-4510395139998187778');" onmouseout="out('-4510395139998187778');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 623 -    //if (mTaskWrapper.isNewTask()) {                                                                             </span>
<span class="6756926677054436789" onmouseenter="enter('6756926677054436789');" onmouseout="out('6756926677054436789');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 624 -    //  CommonUtil.delTaskRecord(getFilePath(), 1, true);                                                         </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 625 -    //}                                                                                                           </span>

<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 626 -                                                                                                                  </span>
<span class="575574520788079541" onmouseenter="enter('575574520788079541');" onmouseout="out('575574520788079541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 627 -    mRecord.fileLength = fileLength;                                                                              </span>
<span class="-8044703341086541865" onmouseenter="enter('-8044703341086541865');" onmouseout="out('-8044703341086541865');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 628 -    if (mTaskWrapper.isNewTask() &amp;&amp; !handleNewTask()) {                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 629 -      return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 630 -    }                                                                                                             </span>








<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 631 -    for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                                   </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 632 -      long startL = i * blockSize, endL = (i + 1) * blockSize;                                                    </span>
<span class="5090177735693834127" onmouseenter="enter('5090177735693834127');" onmouseout="out('5090177735693834127');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 633 -      ThreadRecord tr;                                                                                            </span>
<span class="-7836453111996726628" onmouseenter="enter('-7836453111996726628');" onmouseout="out('-7836453111996726628');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 634 -      boolean isNewTr = false;  // 是否是新的线程记录                                                                      </span>
<span class="-4795094782878764344" onmouseenter="enter('-4795094782878764344');" onmouseout="out('-4795094782878764344');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 635 -      if (mTaskWrapper.isNewTask()) {                                                                             </span>
<span class="-1372101013715036968" onmouseenter="enter('-1372101013715036968');" onmouseout="out('-1372101013715036968');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 636 -        tr = new ThreadRecord();                                                                                  </span>
<span class="3917749081996930633" onmouseenter="enter('3917749081996930633');" onmouseout="out('3917749081996930633');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 637 -        tr.key = mRecord.filePath;                                                                                </span>
<span class="-7575886392361997801" onmouseenter="enter('-7575886392361997801');" onmouseout="out('-7575886392361997801');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 638 -        tr.threadId = i;                                                                                          </span>
<span class="3085824084899250864" onmouseenter="enter('3085824084899250864');" onmouseout="out('3085824084899250864');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 639 -        isNewTr = true;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 640 -      } else {                                                                                                    </span>
<span class="-548726359565759652" onmouseenter="enter('-548726359565759652');" onmouseout="out('-548726359565759652');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 641 -        tr = mRecord.threadRecords.get(i);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 642 -      }                                                                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 643 -                                                                                                                  </span>
<span class="-9126208292322323685" onmouseenter="enter('-9126208292322323685');" onmouseout="out('-9126208292322323685');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 644 -      if (tr.blockLen == 0) {                                                                                     </span>
<span class="-4142305526048218013" onmouseenter="enter('-4142305526048218013');" onmouseout="out('-4142305526048218013');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 645 -        tr.blockLen = CommonUtil.getBlockLen(fileLength, i, mTotalThreadNum);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 646 -      }                                                                                                           </span>

<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 647 -                                                                                                                  </span>
<span class="-973014210831854259" onmouseenter="enter('-973014210831854259');" onmouseout="out('-973014210831854259');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 648 -      if (tr.isComplete) {//该线程已经完成                                                                               </span>
<span class="5189294880655919692" onmouseenter="enter('5189294880655919692');" onmouseout="out('5189294880655919692');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 649 -        if (resumeRecordLocation(i, startL, endL)) return;                                                        </span>








<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 650 -        continue;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 651 -      }                                                                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 652 -                                                                                                                  </span>
<span class="1183688269285295822" onmouseenter="enter('1183688269285295822');" onmouseout="out('1183688269285295822');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 653 -      //如果有记录，则恢复任务                                                                                               </span>
<span class="-9174570816963057194" onmouseenter="enter('-9174570816963057194');" onmouseout="out('-9174570816963057194');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 654 -      if (tr.startLocation &gt; 0) {                                                                                 </span>
<span class="2244216797309960275" onmouseenter="enter('2244216797309960275');" onmouseout="out('2244216797309960275');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 655 -        long r = tr.startLocation;                                                                                </span>
<span class="-7915611879357930899" onmouseenter="enter('-7915611879357930899');" onmouseout="out('-7915611879357930899');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 656 -        //记录的位置需要在线程区间中                                                                                           </span>
<span class="-3706404109465135132" onmouseenter="enter('-3706404109465135132');" onmouseout="out('-3706404109465135132');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 657 -        if (startL &lt; r &amp;&amp; r &lt;= (i == (mTotalThreadNum - 1) ? fileLength : endL)) {                                </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 658 -          mConstance.CURRENT_LOCATION += r - startL;                                                              </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 659 -          startL = r;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 660 -        }                                                                                                         </span>
<span class="5845990765500507783" onmouseenter="enter('5845990765500507783');" onmouseout="out('5845990765500507783');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 661 -        ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__恢复任务&quot;, mEntity.getFileName(), i));                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 662 -      } else {                                                                                                    </span>
<span class="635736622332337160" onmouseenter="enter('635736622332337160');" onmouseout="out('635736622332337160');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 663 -        tr.startLocation = startL;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 664 -      }                                                                                                           </span>
<span class="7194952027883197425" onmouseenter="enter('7194952027883197425');" onmouseout="out('7194952027883197425');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 665 -      //最后一个线程的结束位置即为文件的总长度                                                                                       </span>
<span class="-5942950699866528890" onmouseenter="enter('-5942950699866528890');" onmouseout="out('-5942950699866528890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 666 -      if (i == (mTotalThreadNum - 1)) {                                                                           </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 667 -        endL = fileLength;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 668 -      }                                                                                                           </span>
<span class="9008536478346595299" onmouseenter="enter('9008536478346595299');" onmouseout="out('9008536478346595299');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 669 -      if (tr.endLocation &lt;= 0) {                                                                                  </span>
<span class="-8820011367691672414" onmouseenter="enter('-8820011367691672414');" onmouseout="out('-8820011367691672414');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 670 -        tr.endLocation = endL;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 671 -      }                                                                                                           </span>
<span class="-5584934139293502444" onmouseenter="enter('-5584934139293502444');" onmouseout="out('-5584934139293502444');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 672 -      if (isNewTr) {                                                                                              </span>
<span class="7750338393456465672" onmouseenter="enter('7750338393456465672');" onmouseout="out('7750338393456465672');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 673 -        mRecord.threadRecords.add(tr);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 674 -      }                                                                                                           </span>
<span class="-7040830845063557440" onmouseenter="enter('-7040830845063557440');" onmouseout="out('-7040830845063557440');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 675 -      //ALog.d(TAG, String.format(&quot;创建任务线程：%s，线程总数：%s&quot;, i, mTotalThreadNum));                                      </span>
<span class="6319026600890011419" onmouseenter="enter('6319026600890011419');" onmouseout="out('6319026600890011419');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 676 -      AbsThreadTask task = createSingThreadTask(i, startL, endL, fileLength, tr);                                 </span>








<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 677 -      if (task == null) return;                                                                                   </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 678 -      mTask.put(i, task);                                                                                         </span>
<span class="4583095755176113317" onmouseenter="enter('4583095755176113317');" onmouseout="out('4583095755176113317');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 679 -      threads.add(i);                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 680 -    }                                                                                                             </span>
<span class="290274778352054232" onmouseenter="enter('290274778352054232');" onmouseout="out('290274778352054232');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 681 -    if (mConstance.CURRENT_LOCATION != 0                                                                          </span>
<span class="8899125546582658120" onmouseenter="enter('8899125546582658120');" onmouseout="out('8899125546582658120');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 682 -        &amp;&amp; mConstance.CURRENT_LOCATION != mEntity.getCurrentProgress()) {                                         </span>
<span class="-6641501506845691208" onmouseenter="enter('-6641501506845691208');" onmouseout="out('-6641501506845691208');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 683 -      ALog.d(TAG, String.format(&quot;进度修正，当前进度：%s&quot;, mConstance.CURRENT_LOCATION));                                    </span>
<span class="480370803854164555" onmouseenter="enter('480370803854164555');" onmouseout="out('480370803854164555');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 684 -      mEntity.setCurrentProgress(mConstance.CURRENT_LOCATION);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 685 -    }                                                                                                             </span>
<span class="-4447853798640415053" onmouseenter="enter('-4447853798640415053');" onmouseout="out('-4447853798640415053');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 686 -    saveRecord();                                                                                                 </span>
<span class="520458791074877981" onmouseenter="enter('520458791074877981');" onmouseout="out('520458791074877981');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 687 -    startThreadTask(threads);                                                                                     </span>









<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 688 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 689 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 690 -  /**                                                                                                             </span>
<span class="3352756078121499684" onmouseenter="enter('3352756078121499684');" onmouseout="out('3352756078121499684');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 691 -   * 启动单线程任务                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 692 -   */                                                                                                             </span>
<span class="2474728297875420615" onmouseenter="enter('2474728297875420615');" onmouseout="out('2474728297875420615');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 693 -  private void startThreadTask(Set&lt;Integer&gt; recordL) {                                                            </span>

<span class="-8163448594027824981" onmouseenter="enter('-8163448594027824981');" onmouseout="out('-8163448594027824981');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 694 -    if (isBreak()) {                                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 695 -      return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 696 -    }                                                                                                             </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 697 -    if (mConstance.CURRENT_LOCATION &gt; 0) {                                                                        </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 698 -      mListener.onResume(mConstance.CURRENT_LOCATION);                                                            </span>


<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 699 -    } else {                                                                                                      </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 700 -      mListener.onStart(mConstance.CURRENT_LOCATION);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 701 -    }                                                                                                             </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 702 -    for (int l : recordL) {                                                                                       </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 703 -      if (l == -1) continue;                                                                                      </span>
<span class="405951857149259261" onmouseenter="enter('405951857149259261');" onmouseout="out('405951857149259261');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 704 -      ThreadTaskManager.getInstance().startThread(mTaskWrapper.getKey(), mTask.get(l));                           </span>




<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 705 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 706 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 707 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 708 -  /**                                                                                                             </span>
<span class="5483762406760822984" onmouseenter="enter('5483762406760822984');" onmouseout="out('5483762406760822984');" style=""> 709     * 重试任务                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 710     */                                                                                                             </span>
<span class="3179155293949549674" onmouseenter="enter('3179155293949549674');" onmouseout="out('3179155293949549674');" style=""> 711    public void retryTask() {                                                                                       </span>
<span class="5921009668313525105" onmouseenter="enter('5921009668313525105');" onmouseout="out('5921009668313525105');" style=""> 712      ALog.w(TAG, String.format(&quot;任务【%s】开始重试&quot;, mEntity.getFileName()));                                              </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 713      startFlow();                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 714    }                                                                                                               </span>
<span  style=""> 715                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 716    /**                                                                                                             </span>
<span class="3489882028140634260" onmouseenter="enter('3489882028140634260');" onmouseout="out('3489882028140634260');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 717 -   * 处理新任务                                                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 718 -   *                                                                                                              </span>
<span class="8941769692798326625" onmouseenter="enter('8941769692798326625');" onmouseout="out('8941769692798326625');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 719 -   * @return {@code true}创建新任务失败                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 720 -   */                                                                                                             </span>
<span class="3897453149098456479" onmouseenter="enter('3897453149098456479');" onmouseout="out('3897453149098456479');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 721 -  protected abstract boolean handleNewTask();                                                                     </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 722 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 723 -  /**                                                                                                             </span>
<span class="-4404408971562231280" onmouseenter="enter('-4404408971562231280');" onmouseout="out('-4404408971562231280');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 724 -   * 处理不支持断点的任务                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 725 -   */                                                                                                             </span>
<span class="-8792279366871913220" onmouseenter="enter('-8792279366871913220');" onmouseout="out('-8792279366871913220');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 726 -  private void handleNoSupportBP() {                                                                              </span>
<span class="33131000937493775" onmouseenter="enter('33131000937493775');" onmouseout="out('33131000937493775');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 727 -    if (mListener instanceof BaseDListener) {                                                                     </span>
<span class="-4047803046141878594" onmouseenter="enter('-4047803046141878594');" onmouseout="out('-4047803046141878594');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 728 -      ((BaseDListener) mListener).supportBreakpoint(false);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 729 -    }                                                                                                             </span>
<span class="619060527413120496" onmouseenter="enter('619060527413120496');" onmouseout="out('619060527413120496');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 730 -    SubThreadConfig&lt;TASK_WRAPPER&gt; config = new SubThreadConfig&lt;&gt;();                                               </span>
<span class="5914737473662302802" onmouseenter="enter('5914737473662302802');" onmouseout="out('5914737473662302802');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 731 -    config.TOTAL_FILE_SIZE = mEntity.getFileSize();                                                               </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 732 -    config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                              </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 733 -    config.TEMP_FILE = mTempFile;                                                                                 </span>
<span class="-5899809357890352135" onmouseenter="enter('-5899809357890352135');" onmouseout="out('-5899809357890352135');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 734 -    config.THREAD_ID = 0;                                                                                         </span>
<span class="7958711547477559333" onmouseenter="enter('7958711547477559333');" onmouseout="out('7958711547477559333');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 735 -    config.START_LOCATION = 0;                                                                                    </span>
<span class="747053779851311386" onmouseenter="enter('747053779851311386');" onmouseout="out('747053779851311386');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 736 -    config.END_LOCATION = config.TOTAL_FILE_SIZE;                                                                 </span>
<span class="6707181570367944829" onmouseenter="enter('6707181570367944829');" onmouseout="out('6707181570367944829');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 737 -    config.SUPPORT_BP = mTaskWrapper.isSupportBP();                                                               </span>
<span class="-4458980325189718812" onmouseenter="enter('-4458980325189718812');" onmouseout="out('-4458980325189718812');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 738 -    config.TASK_WRAPPER = mTaskWrapper;                                                                           </span>
<span class="8051738883997329022" onmouseenter="enter('8051738883997329022');" onmouseout="out('8051738883997329022');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 739 -    ThreadRecord record = DbEntity.findFirst(ThreadRecord.class, &quot;key=?&quot;, mRecord.filePath);                      </span>
<span class="2652986304939921073" onmouseenter="enter('2652986304939921073');" onmouseout="out('2652986304939921073');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 740 -    if (record != null) {                                                                                         </span>
<span class="7377969291689599090" onmouseenter="enter('7377969291689599090');" onmouseout="out('7377969291689599090');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 741 -      record.deleteData();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 742 -    }                                                                                                             </span>
<span class="3763585654065879367" onmouseenter="enter('3763585654065879367');" onmouseout="out('3763585654065879367');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 743 -    record = new ThreadRecord();                                                                                  </span>
<span class="8888392257982082951" onmouseenter="enter('8888392257982082951');" onmouseout="out('8888392257982082951');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 744 -    record.startLocation = 0;                                                                                     </span>
<span class="-7637475387427293760" onmouseenter="enter('-7637475387427293760');" onmouseout="out('-7637475387427293760');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 745 -    record.endLocation = config.TOTAL_FILE_SIZE;                                                                  </span>
<span class="3029329660257706333" onmouseenter="enter('3029329660257706333');" onmouseout="out('3029329660257706333');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 746 -    record.key = mTempFile.getPath();                                                                             </span>
<span class="2907574057970886296" onmouseenter="enter('2907574057970886296');" onmouseout="out('2907574057970886296');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 747 -    mRecord.threadRecords.add(record);                                                                            </span>
<span class="-4817448612298280426" onmouseenter="enter('-4817448612298280426');" onmouseout="out('-4817448612298280426');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 748 -    config.THREAD_RECORD = record;                                                                                </span>
<span class="-5296271627358693026" onmouseenter="enter('-5296271627358693026');" onmouseout="out('-5296271627358693026');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 749 -    AbsThreadTask task = selectThreadTask(config);                                                                </span>


<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 750 -    if (task == null) return;                                                                                     </span>
<span class="8048363116921461760" onmouseenter="enter('8048363116921461760');" onmouseout="out('8048363116921461760');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 751 -    mTask.put(0, task);                                                                                           </span>
<span class="-4447853798640415053" onmouseenter="enter('-4447853798640415053');" onmouseout="out('-4447853798640415053');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 752 -    saveRecord();                                                                                                 </span>
<span class="4018208315746033194" onmouseenter="enter('4018208315746033194');" onmouseout="out('4018208315746033194');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 753 -    ThreadTaskManager.getInstance().startThread(mTaskWrapper.getKey(), task);                                     </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 754 -    mListener.onStart(0);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 755 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 756 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 757 -  /**                                                                                                             </span>
<span class="5502854491504205724" onmouseenter="enter('5502854491504205724');" onmouseout="out('5502854491504205724');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 758 -   * 选择单任务线程的类型                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 759 -   */                                                                                                             </span>
<span class="-6182858214188596124" onmouseenter="enter('-6182858214188596124');" onmouseout="out('-6182858214188596124');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 760 -  protected abstract AbsThreadTask selectThreadTask(SubThreadConfig&lt;TASK_WRAPPER&gt; config);                        </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 761 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 762 -  /**                                                                                                             </span>
<span class="1743516648458284983" onmouseenter="enter('1743516648458284983');" onmouseout="out('1743516648458284983');" style=""> 763     * 任务是否已经中断                                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 764     *                                                                                                              </span>
<span class="1049148427197526624" onmouseenter="enter('1049148427197526624');" onmouseout="out('1049148427197526624');" style=""> 765     * @return {@code true}中断                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 766     */                                                                                                             </span>
<span class="-5185153522657566835" onmouseenter="enter('-5185153522657566835');" onmouseout="out('-5185153522657566835');" style=""> 767    public boolean isBreak() {                                                                                      </span>
<span class="3017675825070527056" onmouseenter="enter('3017675825070527056');" onmouseout="out('3017675825070527056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 768 -    if (mConstance.isCancel || mConstance.isStop) {                                                               </span>
<span class="-1760408404888214576" onmouseenter="enter('-1760408404888214576');" onmouseout="out('-1760408404888214576');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 769 +    if (isCancel || isStop) {                                                                                     </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 770        closeTimer();                                                                                               </span>
<span class="-93553338069535680" onmouseenter="enter('-93553338069535680');" onmouseout="out('-93553338069535680');" style=""> 771        ALog.d(TAG, String.format(&quot;任务【%s】已停止或取消了&quot;, mEntity.getFileName()));                                         </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 772        return true;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 773      }                                                                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 774      return false;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 775    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 776  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="-5592048915404489240" onmouseenter="enter('-5592048915404489240');" onmouseout="out('-5592048915404489240');" style="">  16  package com.arialyy.aria.core.common;                                                                             </span>
<span  style="">  17                                                                                                                    </span>
<span class="5922045460006936195" onmouseenter="enter('5922045460006936195');" onmouseout="out('5922045460006936195');" style="">  18  import android.content.Context;                                                                                   </span>
<span class="-1086316590722027623" onmouseenter="enter('-1086316590722027623');" onmouseout="out('-1086316590722027623');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  19 +import android.os.Handler;                                                                                        </span>
<span class="1977486684720932232" onmouseenter="enter('1977486684720932232');" onmouseout="out('1977486684720932232');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  20 +import android.os.Looper;                                                                                         </span>
<span class="-1076320969941752510" onmouseenter="enter('-1076320969941752510');" onmouseout="out('-1076320969941752510');" style="">  21  import android.util.SparseArray;                                                                                  </span>
<span class="3973751924708272716" onmouseenter="enter('3973751924708272716');" onmouseout="out('3973751924708272716');" style="">  22  import com.arialyy.aria.core.AriaManager;                                                                         </span>
<span class="1502558042605946501" onmouseenter="enter('1502558042605946501');" onmouseout="out('1502558042605946501');" style="">  23  import com.arialyy.aria.core.download.BaseDListener;                                                              </span>
<span class="1932658903610588883" onmouseenter="enter('1932658903610588883');" onmouseout="out('1932658903610588883');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import com.arialyy.aria.core.download.DownloadEntity;                                                             </span>
<span class="-3497740022528182602" onmouseenter="enter('-3497740022528182602');" onmouseout="out('-3497740022528182602');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import com.arialyy.aria.core.download.DTaskWrapper;                                                               </span>
<span class="-6556605611720323781" onmouseenter="enter('-6556605611720323781');" onmouseout="out('-6556605611720323781');" style="">  26  import com.arialyy.aria.core.inf.AbsNormalEntity;                                                                 </span>
<span class="8472156907075048576" onmouseenter="enter('8472156907075048576');" onmouseout="out('8472156907075048576');" style="">  27  import com.arialyy.aria.core.inf.AbsTaskWrapper;                                                                  </span>
<span class="2933422270709567825" onmouseenter="enter('2933422270709567825');" onmouseout="out('2933422270709567825');" style="">  28  import com.arialyy.aria.core.inf.IEventListener;                                                                  </span>
<span class="5965657858743993748" onmouseenter="enter('5965657858743993748');" onmouseout="out('5965657858743993748');" style="">  29  import com.arialyy.aria.core.manager.ThreadTaskManager;                                                           </span>
<span class="-5831681804875068292" onmouseenter="enter('-5831681804875068292');" onmouseout="out('-5831681804875068292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  30 -import com.arialyy.aria.core.upload.UploadEntity;                                                                 </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  31 -import com.arialyy.aria.orm.DbEntity;                                                                             </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  32  import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-5216410147421847074" onmouseenter="enter('-5216410147421847074');" onmouseout="out('-5216410147421847074');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 -import com.arialyy.aria.util.DbDataHelper;                                                                        </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  35  import java.io.File;                                                                                              </span>
<span class="9191247685397773893" onmouseenter="enter('9191247685397773893');" onmouseout="out('9191247685397773893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  36 -import java.util.ArrayList;                                                                                       </span>
<span class="-1320562196372945707" onmouseenter="enter('-1320562196372945707');" onmouseout="out('-1320562196372945707');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  37 -import java.util.HashSet;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -import java.util.List;                                                                                            </span>
<span class="1689171550873420012" onmouseenter="enter('1689171550873420012');" onmouseout="out('1689171550873420012');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  39 -import java.util.Properties;                                                                                      </span>
<span class="3384353015976675773" onmouseenter="enter('3384353015976675773');" onmouseout="out('3384353015976675773');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  40 -import java.util.Set;                                                                                             </span>
<span class="-300443590434253982" onmouseenter="enter('-300443590434253982');" onmouseout="out('-300443590434253982');" style="">  41  import java.util.concurrent.ScheduledThreadPoolExecutor;                                                          </span>
<span class="-6356287537734540725" onmouseenter="enter('-6356287537734540725');" onmouseout="out('-6356287537734540725');" style="">  42  import java.util.concurrent.TimeUnit;                                                                             </span>
<span  style="">  43                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  44  /**                                                                                                               </span>
<span class="-1694841151883282501" onmouseenter="enter('-1694841151883282501');" onmouseout="out('-1694841151883282501');" style="">  45   * Created by AriaL on 2017/7/1. 任务处理器                                                                            </span>


<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  46   */                                                                                                               </span>
<span class="4153941248862822664" onmouseenter="enter('4153941248862822664');" onmouseout="out('4153941248862822664');" style="">  47  public abstract class AbsFileer&lt;ENTITY extends AbsNormalEntity, TASK_WRAPPER extends AbsTaskWrapper&lt;ENTITY&gt;&gt;      </span>
<span class="4792287397525923935" onmouseenter="enter('4792287397525923935');" onmouseout="out('4792287397525923935');" style="">  48      implements Runnable {                                                                                         </span>
<span class="8962793429617957612" onmouseenter="enter('8962793429617957612');" onmouseout="out('8962793429617957612');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  49 -  private static final String STATE = &quot;_state_&quot;;                                                                  </span>
<span class="4155209368239822413" onmouseenter="enter('4155209368239822413');" onmouseout="out('4155209368239822413');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  50 -  private static final String RECORD = &quot;_record_&quot;;                                                                </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  51 -  /**                                                                                                             </span>
<span class="338455206860706823" onmouseenter="enter('338455206860706823');" onmouseout="out('338455206860706823');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  52 -   * 分块文件路径                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  53 -   */                                                                                                             </span>
<span class="749748772523516571" onmouseenter="enter('749748772523516571');" onmouseout="out('749748772523516571');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  54 -  public static final String SUB_PATH = &quot;%s.%s.part&quot;;                                                             </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  55 -  /**                                                                                                             </span>
<span class="-1980722710912279499" onmouseenter="enter('-1980722710912279499');" onmouseout="out('-1980722710912279499');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  56 -   * 小于1m的文件不启用多线程                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  57 -   */                                                                                                             </span>
<span class="-5660290514964746700" onmouseenter="enter('-5660290514964746700');" onmouseout="out('-5660290514964746700');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  58 -  protected static final long SUB_LEN = 1024 * 1024;                                                              </span>
<span class="-3405758267261636342" onmouseenter="enter('-3405758267261636342');" onmouseout="out('-3405758267261636342');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  59 -  protected static final int DOWNLOAD = 0x1;                                                                      </span>
<span class="-4795256183805637382" onmouseenter="enter('-4795256183805637382');" onmouseout="out('-4795256183805637382');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  60 -  protected static final int UPLOAD = 0x2;                                                                        </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  61 -                                                                                                                  </span>
<span class="7185037452507187216" onmouseenter="enter('7185037452507187216');" onmouseout="out('7185037452507187216');" style="">  62    private final String TAG = &quot;AbsFileer&quot;;                                                                         </span>

<span class="7384412176173800741" onmouseenter="enter('7384412176173800741');" onmouseout="out('7384412176173800741');" style="">  63    protected IEventListener mListener;                                                                             </span>
<span class="4507751527304947270" onmouseenter="enter('4507751527304947270');" onmouseout="out('4507751527304947270');" style="">  64    protected TASK_WRAPPER mTaskWrapper;                                                                            </span>
<span class="8904454574412257163" onmouseenter="enter('8904454574412257163');" onmouseout="out('8904454574412257163');" style="">  65    protected ENTITY mEntity;                                                                                       </span>
<span class="-8914417138860252644" onmouseenter="enter('-8914417138860252644');" onmouseout="out('-8914417138860252644');" style="">  66    protected Context mContext;                                                                                     </span>
<span class="3740841846621187936" onmouseenter="enter('3740841846621187936');" onmouseout="out('3740841846621187936');" style="">  67    protected File mTempFile; //文件                                                                                  </span>
<span class="-5211593385781091233" onmouseenter="enter('-5211593385781091233');" onmouseout="out('-5211593385781091233');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  68 -  protected StateConstance mConstance;                                                                            </span>
<span class="-7729852228955968495" onmouseenter="enter('-7729852228955968495');" onmouseout="out('-7729852228955968495');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  69 -  //总线程数                                                                                                          </span>
<span class="8506024364762319503" onmouseenter="enter('8506024364762319503');" onmouseout="out('8506024364762319503');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  70 -  protected int mTotalThreadNum;                                                                                  </span>
<span class="6869677327514827795" onmouseenter="enter('6869677327514827795');" onmouseout="out('6869677327514827795');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  71 -  //已完成的线程数                                                                                                       </span>
<span class="8146256445432145550" onmouseenter="enter('8146256445432145550');" onmouseout="out('8146256445432145550');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  72 -  private int mCompleteThreadNum;                                                                                 </span>
<span class="7749320607782706378" onmouseenter="enter('7749320607782706378');" onmouseout="out('7749320607782706378');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  73 +  protected int mTotalThreadNum; //总线程数                                                                           </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  74 +                                                                                                                  </span>
<span class="-4844420720547991856" onmouseenter="enter('-4844420720547991856');" onmouseout="out('-4844420720547991856');" style="">  75    private SparseArray&lt;AbsThreadTask&gt; mTask = new SparseArray&lt;&gt;();                                                 </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  76 -                                                                                                                  </span>
<span class="8927193311925096133" onmouseenter="enter('8927193311925096133');" onmouseout="out('8927193311925096133');" style="">  77    private ScheduledThreadPoolExecutor mTimer;                                                                     </span>
<span class="-6913167534336436900" onmouseenter="enter('-6913167534336436900');" onmouseout="out('-6913167534336436900');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  78 -  @Deprecated private File mConfigFile;                                                                           </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  79 +                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  80    /**                                                                                                             </span>
<span class="7539908978715582123" onmouseenter="enter('7539908978715582123');" onmouseout="out('7539908978715582123');" style="">  81     * 进度刷新间隔                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  82     */                                                                                                             </span>
<span class="3897731617107507824" onmouseenter="enter('3897731617107507824');" onmouseout="out('3897731617107507824');" style="">  83    private long mUpdateInterval = 1000;                                                                            </span>
<span class="-3206802593496103666" onmouseenter="enter('-3206802593496103666');" onmouseout="out('-3206802593496103666');" style="">  84    protected TaskRecord mRecord;                                                                                   </span>
<span class="-6621654726952641912" onmouseenter="enter('-6621654726952641912');" onmouseout="out('-6621654726952641912');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +  private ThreadStateManager mStateManager;                                                                       </span>
<span class="8505538020780181250" onmouseenter="enter('8505538020780181250');" onmouseout="out('8505538020780181250');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  86 +  private Handler mStateHandler;                                                                                  </span>
<span class="-1193305157002570511" onmouseenter="enter('-1193305157002570511');" onmouseout="out('-1193305157002570511');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +  private boolean isCancel = false, isStop = false;                                                               </span>
<span  style="">  88                                                                                                                    </span>
<span class="-2726807651166998305" onmouseenter="enter('-2726807651166998305');" onmouseout="out('-2726807651166998305');" style="">  89    protected AbsFileer(IEventListener listener, TASK_WRAPPER taskEntity) {                                         </span>




<span class="9132236250678632099" onmouseenter="enter('9132236250678632099');" onmouseout="out('9132236250678632099');" style="">  90      mListener = listener;                                                                                         </span>
<span class="7942307664062314277" onmouseenter="enter('7942307664062314277');" onmouseout="out('7942307664062314277');" style="">  91      mTaskWrapper = taskEntity;                                                                                    </span>

<span class="-7408997685265206061" onmouseenter="enter('-7408997685265206061');" onmouseout="out('-7408997685265206061');" style="">  92      mEntity = mTaskWrapper.getEntity();                                                                           </span>
<span class="1002707508041764251" onmouseenter="enter('1002707508041764251');" onmouseout="out('1002707508041764251');" style="">  93      mContext = AriaManager.APP;                                                                                   </span>
<span class="-3948532274682189145" onmouseenter="enter('-3948532274682189145');" onmouseout="out('-3948532274682189145');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  94 -    mConstance = new StateConstance();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  95 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  96 -                                                                                                                  </span>
<span class="-189617012144926713" onmouseenter="enter('-189617012144926713');" onmouseout="out('-189617012144926713');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  97 -  protected abstract int getType();                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  98 -                                                                                                                  </span>
<span class="-8210434580109369245" onmouseenter="enter('-8210434580109369245');" onmouseout="out('-8210434580109369245');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  99 -  public void setNewTask(boolean newTask) {                                                                       </span>
<span class="3866179170323161252" onmouseenter="enter('3866179170323161252');" onmouseout="out('3866179170323161252');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 100 -    mTaskWrapper.setNewTask(newTask);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 101    }                                                                                                               </span>









<span  style=""> 102                                                                                                                    </span>
<span class="1570397235639520239" onmouseenter="enter('1570397235639520239');" onmouseout="out('1570397235639520239');" style=""> 103    public String getKey() {                                                                                        </span>
<span class="-4424845466408855162" onmouseenter="enter('-4424845466408855162');" onmouseout="out('-4424845466408855162');" style=""> 104      return mTaskWrapper.getKey();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105    }                                                                                                               </span>
<span  style=""> 106                                                                                                                    </span>
<span class="-8770398782889209035" onmouseenter="enter('-8770398782889209035');" onmouseout="out('-8770398782889209035');" style=""> 107    public ENTITY getEntity() {                                                                                     </span>
<span class="-2978486956956616380" onmouseenter="enter('-2978486956956616380');" onmouseout="out('-2978486956956616380');" style=""> 108      return mEntity;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109    }                                                                                                               </span>
<span  style=""> 110                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 111    /**                                                                                                             </span>
<span class="8556703894505980538" onmouseenter="enter('8556703894505980538');" onmouseout="out('8556703894505980538');" style=""> 112     * 设置最大下载/上传速度                                                                                                  </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 113     *                                                                                                              </span>
<span class="-7122826048258576762" onmouseenter="enter('-7122826048258576762');" onmouseout="out('-7122826048258576762');" style=""> 114     * @param maxSpeed 单位为：kb                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 115     */                                                                                                             </span>
<span class="6059729822356905089" onmouseenter="enter('6059729822356905089');" onmouseout="out('6059729822356905089');" style=""> 116    public void setMaxSpeed(int maxSpeed) {                                                                         </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 117      for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                                   </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 118        AbsThreadTask task = mTask.get(i);                                                                          </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 119        if (task != null) {                                                                                         </span>
<span class="8974054037700404915" onmouseenter="enter('8974054037700404915');" onmouseout="out('8974054037700404915');" style=""> 120          task.setMaxSpeed(maxSpeed);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122      }                                                                                                             </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123    }                                                                                                               </span>
<span  style=""> 124                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 125    /**                                                                                                             </span>
<span class="5501330737777447325" onmouseenter="enter('5501330737777447325');" onmouseout="out('5501330737777447325');" style=""> 126     * 重置任务状态                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 127     */                                                                                                             </span>
<span class="769592541207569755" onmouseenter="enter('769592541207569755');" onmouseout="out('769592541207569755');" style=""> 128    private void resetState() {                                                                                     </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 129      closeTimer();                                                                                                 </span>
<span class="-8079256701752176328" onmouseenter="enter('-8079256701752176328');" onmouseout="out('-8079256701752176328');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 130 -    mCompleteThreadNum = 0;                                                                                       </span>
<span class="-7538891183274876048" onmouseenter="enter('-7538891183274876048');" onmouseout="out('-7538891183274876048');" style=""> 131      mTotalThreadNum = 0;                                                                                          </span>
<span class="86382318944182160" onmouseenter="enter('86382318944182160');" onmouseout="out('86382318944182160');" style=""> 132      if (mTask != null &amp;&amp; mTask.size() != 0) {                                                                     </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 133        for (int i = 0; i &lt; mTask.size(); i++) {                                                                    </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 134          AbsThreadTask task = mTask.get(i);                                                                        </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 135          if (task != null) {                                                                                       </span>
<span class="4672639676050941541" onmouseenter="enter('4672639676050941541');" onmouseout="out('4672639676050941541');" style=""> 136            task.breakTask();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138        }                                                                                                           </span>
<span class="-5745867061804924715" onmouseenter="enter('-5745867061804924715');" onmouseout="out('-5745867061804924715');" style=""> 139        mTask.clear();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141    }                                                                                                               </span>
<span  style=""> 142                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 143    /**                                                                                                             </span>
<span class="-8036989040377605484" onmouseenter="enter('-8036989040377605484');" onmouseout="out('-8036989040377605484');" style=""> 144     * 开始流程                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 145     */                                                                                                             </span>
<span class="2659446283962947526" onmouseenter="enter('2659446283962947526');" onmouseout="out('2659446283962947526');" style=""> 146    private void startFlow() {                                                                                      </span>
<span class="-8163448594027824981" onmouseenter="enter('-8163448594027824981');" onmouseout="out('-8163448594027824981');" style=""> 147      if (isBreak()) {                                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 148        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149      }                                                                                                             </span>
<span class="-4000252108766936273" onmouseenter="enter('-4000252108766936273');" onmouseout="out('-4000252108766936273');" style=""> 150      resetState();                                                                                                 </span>
<span class="619404821214964502" onmouseenter="enter('619404821214964502');" onmouseout="out('619404821214964502');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 151 -    mConstance.resetState();                                                                                      </span>
<span class="-5970803377387365231" onmouseenter="enter('-5970803377387365231');" onmouseout="out('-5970803377387365231');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 152 -    ALog.d(TAG, &quot;path: &quot; + getFilePath());                                                                        </span>
<span class="4297169302122369497" onmouseenter="enter('4297169302122369497');" onmouseout="out('4297169302122369497');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 153 -    checkRecord();                                                                                                </span>
<span class="6200019808906550914" onmouseenter="enter('6200019808906550914');" onmouseout="out('6200019808906550914');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 154 -    mConstance.TASK_RECORD = mRecord;                                                                             </span>
<span class="6047746770171298765" onmouseenter="enter('6047746770171298765');" onmouseout="out('6047746770171298765');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 155 -    if (!mTaskWrapper.isSupportBP() || mTaskWrapper.asHttp().isChunked()) {                                       </span>
<span class="-7445970306128807043" onmouseenter="enter('-7445970306128807043');" onmouseout="out('-7445970306128807043');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 156 -      mTotalThreadNum = 1;                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 157 -    } else {                                                                                                      </span>
<span class="-2662097366456595872" onmouseenter="enter('-2662097366456595872');" onmouseout="out('-2662097366456595872');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 158 -      mTotalThreadNum =                                                                                           </span>
<span class="-3369577057112693246" onmouseenter="enter('-3369577057112693246');" onmouseout="out('-3369577057112693246');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -          mTaskWrapper.isNewTask() ? setNewTaskThreadNum() : mTotalThreadNum;                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 160 -    }                                                                                                             </span>
<span class="-5070363508518577757" onmouseenter="enter('-5070363508518577757');" onmouseout="out('-5070363508518577757');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 161 -    mConstance.START_THREAD_NUM = mTotalThreadNum;                                                                </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 162 -                                                                                                                  </span>
<span class="4024149497083933587" onmouseenter="enter('4024149497083933587');" onmouseout="out('4024149497083933587');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 163 -    // 处理分块和动态文件参数                                                                                                </span>
<span class="-451816026666018417" onmouseenter="enter('-451816026666018417');" onmouseout="out('-451816026666018417');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 164 -    if (mTaskWrapper.isNewTask() &amp;&amp; mTaskWrapper instanceof DTaskWrapper) {                                       </span>
<span class="2770339381721664913" onmouseenter="enter('2770339381721664913');" onmouseout="out('2770339381721664913');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 165 -      AriaManager manager = AriaManager.getInstance(AriaManager.APP);                                             </span>
<span class="-2154459154886390887" onmouseenter="enter('-2154459154886390887');" onmouseout="out('-2154459154886390887');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 166 -      mRecord.isBlock = mTotalThreadNum &gt; 1 &amp;&amp; manager.getDownloadConfig().isUseBlock();                          </span>
<span class="-2540449873456748154" onmouseenter="enter('-2540449873456748154');" onmouseout="out('-2540449873456748154');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 167 -      // 线程数不等1并且没有使用块下载，则认为没有使用动态文件                                                                              </span>
<span class="-5904206368083695991" onmouseenter="enter('-5904206368083695991');" onmouseout="out('-5904206368083695991');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 168 -      mRecord.isOpenDynamicFile = mTotalThreadNum == 1 || mRecord.isBlock;                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 169 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 170 -                                                                                                                  </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 171 -    /*                                                                                                            </span>
<span class="-5495719390615277007" onmouseenter="enter('-5495719390615277007');" onmouseout="out('-5495719390615277007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 172 -     * mTaskWrapper.getEntity().getFileSize() != mTempFile.length()为兼容以前老版本代码                                     </span>
<span class="-5520474084619660394" onmouseenter="enter('-5520474084619660394');" onmouseout="out('-5520474084619660394');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 173 -     * 动态长度条件：                                                                                                    </span>
<span class="6678836087239710153" onmouseenter="enter('6678836087239710153');" onmouseout="out('6678836087239710153');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 174 -     * 1、总线程数为1，并且是新任务                                                                                            </span>
<span class="-8594380126502433751" onmouseenter="enter('-8594380126502433751');" onmouseout="out('-8594380126502433751');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 175 -     * 2、总线程数为1，不是新任务，但是长度不是文件全长度                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 176 -     */                                                                                                           </span>
<span class="3942500449895906903" onmouseenter="enter('3942500449895906903');" onmouseout="out('3942500449895906903');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 177 -    if (mTotalThreadNum == 1 &amp;&amp; (mTaskWrapper.getEntity().getFileSize() != mTempFile.length())) {                 </span>
<span class="-9210146412762468806" onmouseenter="enter('-9210146412762468806');" onmouseout="out('-9210146412762468806');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 178 -      mRecord.isOpenDynamicFile = true;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 179 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 180 -                                                                                                                  </span>
<span class="2108596284974852159" onmouseenter="enter('2108596284974852159');" onmouseout="out('2108596284974852159');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +    mRecord = new RecordHandler(mTaskWrapper).getRecord();                                                        </span>
<span class="5383386817121006275" onmouseenter="enter('5383386817121006275');" onmouseout="out('5383386817121006275');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +    mTotalThreadNum = mRecord.threadNum;                                                                          </span>
<span class="-6826246836562616350" onmouseenter="enter('-6826246836562616350');" onmouseout="out('-6826246836562616350');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +    Looper.prepare();                                                                                             </span>
<span class="5149694805992184581" onmouseenter="enter('5149694805992184581');" onmouseout="out('5149694805992184581');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +    Looper looper = Looper.myLooper();                                                                            </span>
<span class="7030077118020735892" onmouseenter="enter('7030077118020735892');" onmouseout="out('7030077118020735892');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +    mStateManager = new ThreadStateManager(looper, mRecord, mListener);                                           </span>
<span class="-9214273580559083386" onmouseenter="enter('-9214273580559083386');" onmouseout="out('-9214273580559083386');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +    mStateHandler = new Handler(looper, mStateManager);                                                           </span>
<span class="6344410794906613415" onmouseenter="enter('6344410794906613415');" onmouseout="out('6344410794906613415');" style=""> 187      onPostPre();                                                                                                  </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 188 -                                                                                                                  </span>
<span class="5989254615436994150" onmouseenter="enter('5989254615436994150');" onmouseout="out('5989254615436994150');" style=""> 189      if (!mTaskWrapper.isSupportBP()) {                                                                            </span>
<span class="-6182854007095635032" onmouseenter="enter('-6182854007095635032');" onmouseout="out('-6182854007095635032');" style=""> 190        handleNoSupportBP();                                                                                        </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 191      } else {                                                                                                      </span>
<span class="304482857231090385" onmouseenter="enter('304482857231090385');" onmouseout="out('304482857231090385');" style=""> 192        handleBreakpoint();                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193      }                                                                                                             </span>
<span class="-7724548171203838725" onmouseenter="enter('-7724548171203838725');" onmouseout="out('-7724548171203838725');" style=""> 194      startTimer();                                                                                                 </span>
<span class="7341795500457488125" onmouseenter="enter('7341795500457488125');" onmouseout="out('7341795500457488125');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +    Looper.loop();                                                                                                </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196    }                                                                                                               </span>
<span  style=""> 197                                                                                                                    </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 198    @Override public void run() {                                                                                   </span>
<span class="6651633619385263409" onmouseenter="enter('6651633619385263409');" onmouseout="out('6651633619385263409');" style=""> 199      if (isRunning()) {                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 200        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201      }                                                                                                             </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 202      startFlow();                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203    }                                                                                                               </span>
<span  style=""> 204                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 205    /**                                                                                                             </span>
<span class="4044787794494402505" onmouseenter="enter('4044787794494402505');" onmouseout="out('4044787794494402505');" style=""> 206     * 预处理完成                                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 207     */                                                                                                             </span>
<span class="-5125657304217005566" onmouseenter="enter('-5125657304217005566');" onmouseout="out('-5125657304217005566');" style=""> 208    protected void onPostPre() {                                                                                    </span>
<span  style=""> 209                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210    }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 211 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 212 -  /**                                                                                                             </span>
<span class="-5386582613838574396" onmouseenter="enter('-5386582613838574396');" onmouseout="out('-5386582613838574396');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 213 -   * 设置新任务的最大线程数                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 214 -   */                                                                                                             </span>
<span class="-6137859098551091137" onmouseenter="enter('-6137859098551091137');" onmouseout="out('-6137859098551091137');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 215 -  protected abstract int setNewTaskThreadNum();                                                                   </span>





<span  style=""> 216                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 217    /**                                                                                                             </span>
<span class="4041581137177203435" onmouseenter="enter('4041581137177203435');" onmouseout="out('4041581137177203435');" style=""> 218     * 启动进度获取定时器                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 219     */                                                                                                             </span>
<span class="1702258376619356446" onmouseenter="enter('1702258376619356446');" onmouseout="out('1702258376619356446');" style=""> 220    private synchronized void startTimer() {                                                                        </span>
<span class="8615364800642373101" onmouseenter="enter('8615364800642373101');" onmouseout="out('8615364800642373101');" style=""> 221      ALog.d(TAG, &quot;启动定时器&quot;);                                                                                         </span>
<span class="-9160623214484912914" onmouseenter="enter('-9160623214484912914');" onmouseout="out('-9160623214484912914');" style=""> 222      mTimer = new ScheduledThreadPoolExecutor(1);                                                                  </span>
<span class="4344341468621605861" onmouseenter="enter('4344341468621605861');" onmouseout="out('4344341468621605861');" style=""> 223      mTimer.scheduleWithFixedDelay(new Runnable() {                                                                </span>
<span class="-6123742656848302920" onmouseenter="enter('-6123742656848302920');" onmouseout="out('-6123742656848302920');" style=""> 224        @Override public void run() {                                                                               </span>
<span class="5257678828672457716" onmouseenter="enter('5257678828672457716');" onmouseout="out('5257678828672457716');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 225 -        if (mConstance.isComplete()                                                                               </span>
<span class="334343515162691172" onmouseenter="enter('334343515162691172');" onmouseout="out('334343515162691172');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 226 -            || mConstance.isStop()                                                                                </span>
<span class="3923616872544648792" onmouseenter="enter('3923616872544648792');" onmouseout="out('3923616872544648792');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 227 -            || mConstance.isCancel()                                                                              </span>
<span class="-190933482997272097" onmouseenter="enter('-190933482997272097');" onmouseout="out('-190933482997272097');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 228 -            || mConstance.isFail()                                                                                </span>
<span class="-2600099651056425109" onmouseenter="enter('-2600099651056425109');" onmouseout="out('-2600099651056425109');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 229 +        if (mStateManager.isComplete()                                                                            </span>
<span class="242988333280989926" onmouseenter="enter('242988333280989926');" onmouseout="out('242988333280989926');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 230 +            || mStateManager.isStop()                                                                             </span>
<span class="-9217646883186463915" onmouseenter="enter('-9217646883186463915');" onmouseout="out('-9217646883186463915');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 231 +            || mStateManager.isCancel()                                                                           </span>
<span class="-6792138316084162201" onmouseenter="enter('-6792138316084162201');" onmouseout="out('-6792138316084162201');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 232 +            || mStateManager.isFail()                                                                             </span>
<span class="1045872412985382023" onmouseenter="enter('1045872412985382023');" onmouseout="out('1045872412985382023');" style=""> 233              || !isRunning()) {                                                                                    </span>
<span class="4052633304465856948" onmouseenter="enter('4052633304465856948');" onmouseout="out('4052633304465856948');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 234 -          if (mConstance.isComplete() || mConstance.isFail()) {                                                   </span>
<span class="3103159404811065674" onmouseenter="enter('3103159404811065674');" onmouseout="out('3103159404811065674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +          if (mStateManager.isComplete() || mStateManager.isFail()) {                                             </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 236              ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237            }                                                                                                       </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 238            closeTimer();                                                                                           </span>
<span class="5358021077686010059" onmouseenter="enter('5358021077686010059');" onmouseout="out('5358021077686010059');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 239 -        } else if (mConstance.CURRENT_LOCATION &gt;= 0) {                                                            </span>
<span class="-1283079058592611984" onmouseenter="enter('-1283079058592611984');" onmouseout="out('-1283079058592611984');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 240 -          mListener.onProgress(mConstance.CURRENT_LOCATION);                                                      </span>
<span class="-8976455106279635226" onmouseenter="enter('-8976455106279635226');" onmouseout="out('-8976455106279635226');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +        } else if (mStateManager.getCurrentProgress() &gt;= 0) {                                                     </span>
<span class="-7130682954514056925" onmouseenter="enter('-7130682954514056925');" onmouseout="out('-7130682954514056925');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +          mListener.onProgress(mStateManager.getCurrentProgress());                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244        }                                                                                                           </span>
<span class="-3114269409936550487" onmouseenter="enter('-3114269409936550487');" onmouseout="out('-3114269409936550487');" style=""> 245      }, 0, mUpdateInterval, TimeUnit.MILLISECONDS);                                                                </span>

<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246    }                                                                                                               </span>
<span  style=""> 247                                                                                                                    </span>
<span class="3982752692275613073" onmouseenter="enter('3982752692275613073');" onmouseout="out('3982752692275613073');" style=""> 248    public synchronized void closeTimer() {                                                                         </span>

<span class="-1268142752100378972" onmouseenter="enter('-1268142752100378972');" onmouseout="out('-1268142752100378972');" style=""> 249      if (mTimer != null &amp;&amp; !mTimer.isShutdown()) {                                                                 </span>
<span class="4837418556669337408" onmouseenter="enter('4837418556669337408');" onmouseout="out('4837418556669337408');" style=""> 250        mTimer.shutdown();                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252    }                                                                                                               </span>
<span  style=""> 253                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 254    /**                                                                                                             </span>
<span class="3310122691908792895" onmouseenter="enter('3310122691908792895');" onmouseout="out('3310122691908792895');" style=""> 255     * 设置定时器更新间隔                                                                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 256     *                                                                                                              </span>
<span class="5926421498368036592" onmouseenter="enter('5926421498368036592');" onmouseout="out('5926421498368036592');" style=""> 257     * @param interval 单位毫秒，不能小于0                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 258     */                                                                                                             </span>
<span class="-6143371944494222779" onmouseenter="enter('-6143371944494222779');" onmouseout="out('-6143371944494222779');" style=""> 259    protected void setUpdateInterval(long interval) {                                                               </span>
<span class="-1051498944097002766" onmouseenter="enter('-1051498944097002766');" onmouseout="out('-1051498944097002766');" style=""> 260      if (interval &lt; 0) {                                                                                           </span>
<span class="3000915396455271078" onmouseenter="enter('3000915396455271078');" onmouseout="out('3000915396455271078');" style=""> 261        ALog.w(TAG, &quot;更新间隔不能小于0，默认为1000毫秒&quot;);                                                                         </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 262        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 263      }                                                                                                             </span>
<span class="-3431322530378656562" onmouseenter="enter('-3431322530378656562');" onmouseout="out('-3431322530378656562');" style=""> 264      mUpdateInterval = interval;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265    }                                                                                                               </span>
<span  style=""> 266                                                                                                                    </span>
<span class="-5758762106788202116" onmouseenter="enter('-5758762106788202116');" onmouseout="out('-5758762106788202116');" style=""> 267    public long getFileSize() {                                                                                     </span>
<span class="-7902485770489300682" onmouseenter="enter('-7902485770489300682');" onmouseout="out('-7902485770489300682');" style=""> 268      return mEntity.getFileSize();                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 269    }                                                                                                               </span>
<span  style=""> 270                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 271    /**                                                                                                             </span>
<span class="-7288086523564906780" onmouseenter="enter('-7288086523564906780');" onmouseout="out('-7288086523564906780');" style=""> 272     * 获取当前任务位置                                                                                                     </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 273     */                                                                                                             </span>
<span class="3656547772237643757" onmouseenter="enter('3656547772237643757');" onmouseout="out('3656547772237643757');" style=""> 274    public long getCurrentLocation() {                                                                              </span>
<span class="2881215542099369319" onmouseenter="enter('2881215542099369319');" onmouseout="out('2881215542099369319');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 275 -    return mConstance.CURRENT_LOCATION;                                                                           </span>
<span class="-4293580056549457" onmouseenter="enter('-4293580056549457');" onmouseout="out('-4293580056549457');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 276 +    return mStateManager.getCurrentProgress();                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 277    }                                                                                                               </span>
<span  style=""> 278                                                                                                                    </span>
<span class="430507706356584401" onmouseenter="enter('430507706356584401');" onmouseout="out('430507706356584401');" style=""> 279    public synchronized boolean isRunning() {                                                                       </span>
<span class="-7600400715455113368" onmouseenter="enter('-7600400715455113368');" onmouseout="out('-7600400715455113368');" style=""> 280      return ThreadTaskManager.getInstance().taskIsRunning(mTaskWrapper.getKey());                                  </span>



<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281    }                                                                                                               </span>
<span  style=""> 282                                                                                                                    </span>
<span class="7466876458085224213" onmouseenter="enter('7466876458085224213');" onmouseout="out('7466876458085224213');" style=""> 283    public synchronized void cancel() {                                                                             </span>
<span class="-3806794828534168829" onmouseenter="enter('-3806794828534168829');" onmouseout="out('-3806794828534168829');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 284 -    ALog.d(TAG, &quot;constance hash: &quot; + mConstance.hashCode());                                                      </span>
<span class="-3020030988299471035" onmouseenter="enter('-3020030988299471035');" onmouseout="out('-3020030988299471035');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 285 -    if (mConstance.isCancel) {                                                                                    </span>
<span class="7209272461739709593" onmouseenter="enter('7209272461739709593');" onmouseout="out('7209272461739709593');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 286 +    if (isCancel) {                                                                                               </span>
<span class="-5322688094560357059" onmouseenter="enter('-5322688094560357059');" onmouseout="out('-5322688094560357059');" style=""> 287        ALog.d(TAG, String.format(&quot;任务【%s】正在删除，删除任务失败&quot;, mTaskWrapper.getKey()));                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 288        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 289      }                                                                                                             </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 290      closeTimer();                                                                                                 </span>
<span class="204250319841071761" onmouseenter="enter('204250319841071761');" onmouseout="out('204250319841071761');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 291 -    mConstance.isCancel = true;                                                                                   </span>
<span class="-2194996064944297118" onmouseenter="enter('-2194996064944297118');" onmouseout="out('-2194996064944297118');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 292 +    isCancel = true;                                                                                              </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 293      for (int i = 0; i &lt; mTask.size(); i++) {                                                                      </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 294        AbsThreadTask task = mTask.get(i);                                                                          </span>
<span class="5940588252354502453" onmouseenter="enter('5940588252354502453');" onmouseout="out('5940588252354502453');" style=""> 295        if (task != null) {                                                                                         </span>
<span class="-5957095363071667116" onmouseenter="enter('-5957095363071667116');" onmouseout="out('-5957095363071667116');" style=""> 296          task.cancel();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 297        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298      }                                                                                                             </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 299      ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 300    }                                                                                                               </span>
<span  style=""> 301                                                                                                                    </span>
<span class="8656523468118489646" onmouseenter="enter('8656523468118489646');" onmouseout="out('8656523468118489646');" style=""> 302    public synchronized void stop() {                                                                               </span>
<span class="6098002859693790355" onmouseenter="enter('6098002859693790355');" onmouseout="out('6098002859693790355');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 303 -    if (mConstance.isStop) {                                                                                      </span>
<span class="7677583571575855110" onmouseenter="enter('7677583571575855110');" onmouseout="out('7677583571575855110');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 304 +    if (isStop) {                                                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 305        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306      }                                                                                                             </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 307      closeTimer();                                                                                                 </span>
<span class="3914378059549813712" onmouseenter="enter('3914378059549813712');" onmouseout="out('3914378059549813712');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 308 -    mConstance.isStop = true;                                                                                     </span>
<span class="8402005296375476854" onmouseenter="enter('8402005296375476854');" onmouseout="out('8402005296375476854');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 309 -    if (mConstance.isComplete()) return;                                                                          </span>
<span class="-3475992533265949855" onmouseenter="enter('-3475992533265949855');" onmouseout="out('-3475992533265949855');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 310 +    isStop = true;                                                                                                </span>
<span class="-7122141514229488110" onmouseenter="enter('-7122141514229488110');" onmouseout="out('-7122141514229488110');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 311 +    if (mStateManager.isComplete()) return;                                                                       </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style=""> 312      for (int i = 0; i &lt; mTask.size(); i++) {                                                                      </span>
<span class="6848826705985440068" onmouseenter="enter('6848826705985440068');" onmouseout="out('6848826705985440068');" style=""> 313        AbsThreadTask task = mTask.get(i);                                                                          </span>
<span class="-6295419555080725627" onmouseenter="enter('-6295419555080725627');" onmouseout="out('-6295419555080725627');" style=""> 314        if (task != null &amp;&amp; !task.isThreadComplete()) {                                                             </span>
<span class="-1376316546356459284" onmouseenter="enter('-1376316546356459284');" onmouseout="out('-1376316546356459284');" style=""> 315          task.stop();                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 316        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317      }                                                                                                             </span>
<span class="14677655034980406" onmouseenter="enter('14677655034980406');" onmouseout="out('14677655034980406');" style=""> 318      ThreadTaskManager.getInstance().removeTaskThread(mTaskWrapper.getKey());                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319    }                                                                                                               </span>
<span  style=""> 320                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 321    /**                                                                                                             </span>
<span class="-7218687507933415946" onmouseenter="enter('-7218687507933415946');" onmouseout="out('-7218687507933415946');" style=""> 322     * 直接调用的时候会自动启动线程执行                                                                                             </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 323     */                                                                                                             </span>
<span class="-7265432148414046744" onmouseenter="enter('-7265432148414046744');" onmouseout="out('-7265432148414046744');" style=""> 324    public synchronized void start() {                                                                              </span>
<span class="6651633619385263409" onmouseenter="enter('6651633619385263409');" onmouseout="out('6651633619385263409');" style=""> 325      if (isRunning()) {                                                                                            </span>
<span class="4391999858354318805" onmouseenter="enter('4391999858354318805');" onmouseout="out('4391999858354318805');" style=""> 326        ALog.d(TAG, String.format(&quot;任务【%s】正在执行，启动任务失败&quot;, mTaskWrapper.getKey()));                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 327        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328      }                                                                                                             </span>
<span class="1705059822941742685" onmouseenter="enter('1705059822941742685');" onmouseout="out('1705059822941742685');" style=""> 329      new Thread(this).start();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330    }                                                                                                               </span>
<span  style=""> 331                                                                                                                    </span>
<span class="5993373674998630219" onmouseenter="enter('5993373674998630219');" onmouseout="out('5993373674998630219');" style=""> 332    public void resume() {                                                                                          </span>
<span class="-6183578153083367222" onmouseenter="enter('-6183578153083367222');" onmouseout="out('-6183578153083367222');" style=""> 333      start();                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334    }                                                                                                               </span>
<span  style=""> 335                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 336    /**                                                                                                             </span>
<span class="3333036234618128246" onmouseenter="enter('3333036234618128246');" onmouseout="out('3333036234618128246');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 337 -   * 检查记录 对于分块任务： 子分块不存在或被删除，子线程将重新下载 对于普通任务： 预下载文件不存在，则任务任务呗删除                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 338 -   */                                                                                                             </span>
<span class="-3226254244315569492" onmouseenter="enter('-3226254244315569492');" onmouseout="out('-3226254244315569492');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 339 -  private void checkRecord() {                                                                                    </span>
<span class="-5297450492380711808" onmouseenter="enter('-5297450492380711808');" onmouseout="out('-5297450492380711808');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 340 -    mConfigFile = new File(CommonUtil.getFileConfigPath(false, mEntity.getFileName()));                           </span>
<span class="4951157766975006439" onmouseenter="enter('4951157766975006439');" onmouseout="out('4951157766975006439');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 341 -    if (mConfigFile.exists()) {                                                                                   </span>
<span class="7932310618145443523" onmouseenter="enter('7932310618145443523');" onmouseout="out('7932310618145443523');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 342 -      convertDb();                                                                                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 343 -    } else {                                                                                                      </span>
<span class="4647489036124418098" onmouseenter="enter('4647489036124418098');" onmouseout="out('4647489036124418098');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 344 -      mRecord = DbDataHelper.getTaskRecord(getFilePath());                                                        </span>
<span class="-3299415613061807412" onmouseenter="enter('-3299415613061807412');" onmouseout="out('-3299415613061807412');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 345 -      if (mRecord == null) {                                                                                      </span>
<span class="-6736410795519637054" onmouseenter="enter('-6736410795519637054');" onmouseout="out('-6736410795519637054');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 346 -        initRecord(true);                                                                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 347 -      } else {                                                                                                    </span>
<span class="-7168613097949101282" onmouseenter="enter('-7168613097949101282');" onmouseout="out('-7168613097949101282');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 348 -        if (mRecord.threadRecords == null || mRecord.threadRecords.isEmpty()) {                                   </span>
<span class="-6736410795519637054" onmouseenter="enter('-6736410795519637054');" onmouseout="out('-6736410795519637054');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 349 -          initRecord(true);                                                                                       </span>
<span class="-5520464134160599469" onmouseenter="enter('-5520464134160599469');" onmouseout="out('-5520464134160599469');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 350 -        } else if (mRecord.isBlock) {                                                                             </span>
<span class="4499191396384356607" onmouseenter="enter('4499191396384356607');" onmouseout="out('4499191396384356607');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 351 -          handleBlockRecord();                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 352 -        } else {                                                                                                  </span>
<span class="-7429038303426788124" onmouseenter="enter('-7429038303426788124');" onmouseout="out('-7429038303426788124');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 353 -          handleNormalRecord();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 354 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 355 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 356 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 357 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 358 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 359 -  /**                                                                                                             </span>
<span class="-6732733519809936602" onmouseenter="enter('-6732733519809936602');" onmouseout="out('-6732733519809936602');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 360 -   * 处理普通任务的记录                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 361 -   */                                                                                                             </span>
<span class="2040790615597773652" onmouseenter="enter('2040790615597773652');" onmouseout="out('2040790615597773652');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 362 -  private void handleNormalRecord() {                                                                             </span>
<span class="3630450282049316686" onmouseenter="enter('3630450282049316686');" onmouseout="out('3630450282049316686');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 363 -    File file = new File(mRecord.filePath);                                                                       </span>
<span class="4133240422546463755" onmouseenter="enter('4133240422546463755');" onmouseout="out('4133240422546463755');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 364 -    if (!file.exists()) {                                                                                         </span>
<span class="-573220915101280348" onmouseenter="enter('-573220915101280348');" onmouseout="out('-573220915101280348');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 365 -      ALog.w(TAG, String.format(&quot;文件【%s】不存在，任务将重新开始&quot;, file.getPath()));                                            </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 366 -      mRecord.deleteData();                                                                                       </span>
<span class="-6736410795519637054" onmouseenter="enter('-6736410795519637054');" onmouseout="out('-6736410795519637054');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 367 -      initRecord(true);                                                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 368 -      return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 369 -    }                                                                                                             </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 370 -                                                                                                                  </span>
<span class="-5277098832070231051" onmouseenter="enter('-5277098832070231051');" onmouseout="out('-5277098832070231051');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 371 -    if (mRecord.isOpenDynamicFile) {                                                                              </span>
<span class="2008386981860280225" onmouseenter="enter('2008386981860280225');" onmouseout="out('2008386981860280225');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 372 -      ThreadRecord tr = mRecord.threadRecords.get(0);                                                             </span>
<span class="8432511455550217781" onmouseenter="enter('8432511455550217781');" onmouseout="out('8432511455550217781');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 373 -      if (tr == null) {                                                                                           </span>
<span class="4148181859028624217" onmouseenter="enter('4148181859028624217');" onmouseout="out('4148181859028624217');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 374 -        ALog.d(TAG, &quot;线程记录为空，任务为新任务&quot;);                                                                             </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 375 -        mTaskWrapper.setNewTask(true);                                                                            </span>
<span class="-7445970306128807043" onmouseenter="enter('-7445970306128807043');" onmouseout="out('-7445970306128807043');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 376 -        mTotalThreadNum = 1;                                                                                      </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 377 -        return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 378 -      }                                                                                                           </span>
<span class="3490117773955769870" onmouseenter="enter('3490117773955769870');" onmouseout="out('3490117773955769870');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 379 -      if (file.length() &gt; mEntity.getFileSize()) {                                                                </span>
<span class="-282245710257793553" onmouseenter="enter('-282245710257793553');" onmouseout="out('-282245710257793553');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 380 -        ALog.i(TAG, String.format(&quot;文件【%s】错误，任务重新开始&quot;, file.getPath()));                                            </span>
<span class="1841259700134023722" onmouseenter="enter('1841259700134023722');" onmouseout="out('1841259700134023722');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 381 -        file.delete();                                                                                            </span>
<span class="1028121270302202149" onmouseenter="enter('1028121270302202149');" onmouseout="out('1028121270302202149');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 382 -        tr.startLocation = 0;                                                                                     </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 383 -        tr.isComplete = false;                                                                                    </span>
<span class="6462437329823623234" onmouseenter="enter('6462437329823623234');" onmouseout="out('6462437329823623234');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 384 -        tr.endLocation = mEntity.getFileSize();                                                                   </span>
<span class="7176785819267604956" onmouseenter="enter('7176785819267604956');" onmouseout="out('7176785819267604956');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 385 -      } else if (file.length() == mEntity.getFileSize()) {                                                        </span>
<span class="6364817192610155634" onmouseenter="enter('6364817192610155634');" onmouseout="out('6364817192610155634');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 386 -        tr.isComplete = true;                                                                                     </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 387 -        mCompleteThreadNum++;                                                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 388 -      } else {                                                                                                    </span>
<span class="-3426671339714424" onmouseenter="enter('-3426671339714424');" onmouseout="out('-3426671339714424');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 389 -        if (file.length() != tr.startLocation) {                                                                  </span>
<span class="2922121341147867007" onmouseenter="enter('2922121341147867007');" onmouseout="out('2922121341147867007');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 390 -          ALog.i(TAG, String.format(&quot;修正【%s】的进度记录为：%s&quot;, file.getPath(), file.length()));                           </span>
<span class="1238856845335327056" onmouseenter="enter('1238856845335327056');" onmouseout="out('1238856845335327056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 391 -          tr.startLocation = file.length();                                                                       </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 392 -          tr.isComplete = false;                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 393 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 394 -      }                                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 395 -    } else {                                                                                                      </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 396 -      for (ThreadRecord tr : mRecord.threadRecords) {                                                             </span>
<span class="-6249885869558348483" onmouseenter="enter('-6249885869558348483');" onmouseout="out('-6249885869558348483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 397 -        if (tr.isComplete) {                                                                                      </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 398 -          mCompleteThreadNum++;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 399 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 400 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 401 -    }                                                                                                             </span>
<span class="-4812553014330515673" onmouseenter="enter('-4812553014330515673');" onmouseout="out('-4812553014330515673');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 402 -    mTotalThreadNum = mRecord.threadRecords.size();                                                               </span>
<span class="7955340223234605" onmouseenter="enter('7955340223234605');" onmouseout="out('7955340223234605');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 403 -    mTaskWrapper.setNewTask(false);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 404 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 405 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 406 -  /**                                                                                                             </span>
<span class="-1504497308241871367" onmouseenter="enter('-1504497308241871367');" onmouseout="out('-1504497308241871367');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 407 -   * 处理分块任务的记录，分块文件（blockFileLen）长度必须需要小于等于线程区间（threadRectLen）的长度                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 408 -   */                                                                                                             </span>
<span class="2850638396080836255" onmouseenter="enter('2850638396080836255');" onmouseout="out('2850638396080836255');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 409 -  private void handleBlockRecord() {                                                                              </span>
<span class="-6754358035051648935" onmouseenter="enter('-6754358035051648935');" onmouseout="out('-6754358035051648935');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 410 -    // 默认线程分块长度                                                                                                   </span>
<span class="7954826708259222" onmouseenter="enter('7954826708259222');" onmouseout="out('7954826708259222');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 411 -    long normalRectLen = mEntity.getFileSize() / mRecord.threadRecords.size();                                    </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 412 -    for (ThreadRecord tr : mRecord.threadRecords) {                                                               </span>
<span class="965474740392839629" onmouseenter="enter('965474740392839629');" onmouseout="out('965474740392839629');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 413 -      long threadRect = tr.blockLen;                                                                              </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 414 -                                                                                                                  </span>
<span class="1783305833880375310" onmouseenter="enter('1783305833880375310');" onmouseout="out('1783305833880375310');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 415 -      File temp = new File(String.format(SUB_PATH, mRecord.filePath, tr.threadId));                               </span>
<span class="-2809861036487449932" onmouseenter="enter('-2809861036487449932');" onmouseout="out('-2809861036487449932');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 416 -      if (!temp.exists()) {                                                                                       </span>
<span class="-8428377895201906885" onmouseenter="enter('-8428377895201906885');" onmouseout="out('-8428377895201906885');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 417 -        ALog.i(TAG, String.format(&quot;分块文件【%s】不存在，该分块将重新开始&quot;, temp.getPath()));                                       </span>
<span class="-7066714301015771912" onmouseenter="enter('-7066714301015771912');" onmouseout="out('-7066714301015771912');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 418 -        tr.isComplete = false;                                                                                    </span>
<span class="-7212380725645212688" onmouseenter="enter('-7212380725645212688');" onmouseout="out('-7212380725645212688');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 419 -        tr.startLocation = -1;                                                                                    </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 420 -      } else {                                                                                                    </span>
<span class="-6249885869558348483" onmouseenter="enter('-6249885869558348483');" onmouseout="out('-6249885869558348483');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 421 -        if (tr.isComplete) {                                                                                      </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 422 -          mCompleteThreadNum++;                                                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 423 -        } else {                                                                                                  </span>
<span class="67760423539567228" onmouseenter="enter('67760423539567228');" onmouseout="out('67760423539567228');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 424 -          ALog.i(TAG, String.format(                                                                              </span>
<span class="3005157305258750727" onmouseenter="enter('3005157305258750727');" onmouseout="out('3005157305258750727');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 425 -              &quot;startLocation = %s; endLocation = %s; block = %s; tempLen = %s; threadId = %s&quot;,                    </span>
<span class="557123456234898856" onmouseenter="enter('557123456234898856');" onmouseout="out('557123456234898856');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 426 -              tr.startLocation, tr.endLocation, threadRect, temp.length(), tr.threadId));                         </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 427 -                                                                                                                  </span>
<span class="-793137946029070789" onmouseenter="enter('-793137946029070789');" onmouseout="out('-793137946029070789');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 428 -          long blockFileLen = temp.length(); // 磁盘中的分块文件长度                                                        </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 429 -          /*                                                                                                      </span>
<span class="3457188544010136028" onmouseenter="enter('3457188544010136028');" onmouseout="out('3457188544010136028');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 430 -           * 检查磁盘中的分块文件                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 431 -           */                                                                                                     </span>
<span class="7157771772038955316" onmouseenter="enter('7157771772038955316');" onmouseout="out('7157771772038955316');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 432 -          if (blockFileLen &gt; threadRect) {                                                                        </span>
<span class="-3960295116545159248" onmouseenter="enter('-3960295116545159248');" onmouseout="out('-3960295116545159248');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 433 -            ALog.i(TAG, String.format(&quot;分块【%s】错误，分块长度【%s】 &gt; 线程区间长度【%s】，将重新开始该分块&quot;,                                  </span>
<span class="-6060651799112635756" onmouseenter="enter('-6060651799112635756');" onmouseout="out('-6060651799112635756');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 434 -                tr.threadId, blockFileLen, threadRect));                                                          </span>
<span class="-2826646494613153676" onmouseenter="enter('-2826646494613153676');" onmouseout="out('-2826646494613153676');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 435 -            temp.delete();                                                                                        </span>
<span class="8640140040149112263" onmouseenter="enter('8640140040149112263');" onmouseout="out('8640140040149112263');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 436 -            tr.startLocation = tr.threadId * threadRect;                                                          </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 437 -            continue;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 438 -          }                                                                                                       </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 439 -                                                                                                                  </span>
<span class="1282738932104176357" onmouseenter="enter('1282738932104176357');" onmouseout="out('1282738932104176357');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 440 -          long realLocation =                                                                                     </span>
<span class="-6413770924091570394" onmouseenter="enter('-6413770924091570394');" onmouseout="out('-6413770924091570394');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 441 -              tr.threadId * normalRectLen + blockFileLen; //正常情况下，该线程的startLocation的位置                            </span>
<span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 442 -          /*                                                                                                      </span>
<span class="-3196943470889273987" onmouseenter="enter('-3196943470889273987');" onmouseout="out('-3196943470889273987');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 443 -           * 检查记录文件                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 444 -           */                                                                                                     </span>
<span class="-7365986240976322143" onmouseenter="enter('-7365986240976322143');" onmouseout="out('-7365986240976322143');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 445 -          if (blockFileLen == threadRect) {                                                                       </span>
<span class="-3715847581530045195" onmouseenter="enter('-3715847581530045195');" onmouseout="out('-3715847581530045195');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 446 -            ALog.i(TAG, String.format(&quot;分块【%s】已完成，更新记录&quot;, temp.getPath()));                                         </span>
<span class="1152086888298905021" onmouseenter="enter('1152086888298905021');" onmouseout="out('1152086888298905021');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 447 -            tr.startLocation = blockFileLen;                                                                      </span>
<span class="6364817192610155634" onmouseenter="enter('6364817192610155634');" onmouseout="out('6364817192610155634');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 448 -            tr.isComplete = true;                                                                                 </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 449 -            mCompleteThreadNum++;                                                                                 </span>
<span class="-5838140850326599069" onmouseenter="enter('-5838140850326599069');" onmouseout="out('-5838140850326599069');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 450 -          } else if (tr.startLocation != realLocation) { // 处理记录小于分块文件长度的情况                                       </span>
<span class="2932557069165298429" onmouseenter="enter('2932557069165298429');" onmouseout="out('2932557069165298429');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 451 -            ALog.i(TAG, String.format(&quot;修正分块【%s】的进度记录为：%s&quot;, temp.getPath(), realLocation));                        </span>
<span class="4676730033229053821" onmouseenter="enter('4676730033229053821');" onmouseout="out('4676730033229053821');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 452 -            tr.startLocation = realLocation;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 453 -          }                                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 454 -        }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 455 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 456 -    }                                                                                                             </span>
<span class="-4812553014330515673" onmouseenter="enter('-4812553014330515673');" onmouseout="out('-4812553014330515673');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 457 -    mTotalThreadNum = mRecord.threadRecords.size();                                                               </span>
<span class="7955340223234605" onmouseenter="enter('7955340223234605');" onmouseout="out('7955340223234605');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 458 -    mTaskWrapper.setNewTask(false);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 459 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 460 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 461 -  /**                                                                                                             </span>
<span class="4426545154492852727" onmouseenter="enter('4426545154492852727');" onmouseout="out('4426545154492852727');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 462 -   * convertDb 是兼容性代码 从3.4.1开始，线程配置信息将存储在数据库中。 将配置文件的内容复制到数据库中，并将配置文件删除                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 463 -   */                                                                                                             </span>
<span class="14298455509427519" onmouseenter="enter('14298455509427519');" onmouseout="out('14298455509427519');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 464 -  private void convertDb() {                                                                                      </span>
<span class="-4598298306615401010" onmouseenter="enter('-4598298306615401010');" onmouseout="out('-4598298306615401010');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 465 -    List&lt;RecordWrapper&gt; records =                                                                                 </span>
<span class="-4738968014729726274" onmouseenter="enter('-4738968014729726274');" onmouseout="out('-4738968014729726274');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 466 -        DbEntity.findRelationData(RecordWrapper.class, &quot;TaskRecord.filePath=?&quot;,                                   </span>
<span class="1664646851824584272" onmouseenter="enter('1664646851824584272');" onmouseout="out('1664646851824584272');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 467 -            getFilePath());                                                                                       </span>
<span class="-376648440877788579" onmouseenter="enter('-376648440877788579');" onmouseout="out('-376648440877788579');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 468 -    if (records == null || records.size() == 0) {                                                                 </span>
<span class="7274393295178915569" onmouseenter="enter('7274393295178915569');" onmouseout="out('7274393295178915569');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 469 -      Properties pro = CommonUtil.loadConfig(mConfigFile);                                                        </span>
<span class="-681137634566379888" onmouseenter="enter('-681137634566379888');" onmouseout="out('-681137634566379888');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 470 -      if (pro.isEmpty()) {                                                                                        </span>
<span class="6270101186355835075" onmouseenter="enter('6270101186355835075');" onmouseout="out('6270101186355835075');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 471 -        ALog.d(TAG, &quot;老版本的线程记录为空，任务为新任务&quot;);                                                                         </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 472 -        mTaskWrapper.setNewTask(true);                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 473 -        return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 474 -      }                                                                                                           </span>
<span class="-3891780371452029435" onmouseenter="enter('-3891780371452029435');" onmouseout="out('-3891780371452029435');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 475 -      initRecord(false);                                                                                          </span>
<span class="-4092719147494026286" onmouseenter="enter('-4092719147494026286');" onmouseout="out('-4092719147494026286');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 476 -      Set&lt;Object&gt; keys = pro.keySet();                                                                            </span>
<span class="7117164647387083506" onmouseenter="enter('7117164647387083506');" onmouseout="out('7117164647387083506');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 477 -      // 老版本记录是5s存一次，但是5s中内，如果线程执行完成，record记录是没有的，只有state记录...                                                    </span>
<span class="8442347856216504710" onmouseenter="enter('8442347856216504710');" onmouseout="out('8442347856216504710');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 478 -      // 第一步应该是record 和 state去重取正确的线程数                                                                            </span>
<span class="3880560860847601414" onmouseenter="enter('3880560860847601414');" onmouseout="out('3880560860847601414');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 479 -      Set&lt;Integer&gt; set = new HashSet&lt;&gt;();                                                                         </span>
<span class="-5644624400733519290" onmouseenter="enter('-5644624400733519290');" onmouseout="out('-5644624400733519290');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 480 -      for (Object key : keys) {                                                                                   </span>
<span class="-90111359741489740" onmouseenter="enter('-90111359741489740');" onmouseout="out('-90111359741489740');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 481 -        String str = String.valueOf(key);                                                                         </span>
<span class="5431713397557299419" onmouseenter="enter('5431713397557299419');" onmouseout="out('5431713397557299419');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 482 -        int i = Integer.parseInt(str.substring(str.length() - 1, str.length()));                                  </span>
<span class="5139166377005733880" onmouseenter="enter('5139166377005733880');" onmouseout="out('5139166377005733880');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 483 -        set.add(i);                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 484 -      }                                                                                                           </span>
<span class="1773727540275693887" onmouseenter="enter('1773727540275693887');" onmouseout="out('1773727540275693887');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 485 -      int threadNum = set.size();                                                                                 </span>
<span class="1658307869252768908" onmouseenter="enter('1658307869252768908');" onmouseout="out('1658307869252768908');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 486 -      if (threadNum == 0) {                                                                                       </span>
<span class="1148319986505262760" onmouseenter="enter('1148319986505262760');" onmouseout="out('1148319986505262760');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 487 -        ALog.d(TAG, &quot;线程数为空，任务为新任务&quot;);                                                                              </span>
<span class="-1512381015788610352" onmouseenter="enter('-1512381015788610352');" onmouseout="out('-1512381015788610352');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 488 -        mTaskWrapper.setNewTask(true);                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 489 -        return;                                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 490 -      }                                                                                                           </span>
<span class="8980547023143351106" onmouseenter="enter('8980547023143351106');" onmouseout="out('8980547023143351106');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 491 -      mRecord.threadNum = threadNum;                                                                              </span>
<span class="1082026445239340300" onmouseenter="enter('1082026445239340300');" onmouseout="out('1082026445239340300');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 492 -      mTotalThreadNum = threadNum;                                                                                </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 493 -                                                                                                                  </span>
<span class="92058997093189211" onmouseenter="enter('92058997093189211');" onmouseout="out('92058997093189211');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 494 -      for (int i = 0; i &lt; threadNum; i++) {                                                                       </span>
<span class="1846142719149590893" onmouseenter="enter('1846142719149590893');" onmouseout="out('1846142719149590893');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 495 -        ThreadRecord tRecord = new ThreadRecord();                                                                </span>
<span class="-543854586085341709" onmouseenter="enter('-543854586085341709');" onmouseout="out('-543854586085341709');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 496 -        tRecord.key = mRecord.filePath;                                                                           </span>
<span class="-1285896534897014429" onmouseenter="enter('-1285896534897014429');" onmouseout="out('-1285896534897014429');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 497 -        Object state = pro.getProperty(mTempFile.getName() + STATE + i);                                          </span>
<span class="7744986855104654034" onmouseenter="enter('7744986855104654034');" onmouseout="out('7744986855104654034');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 498 -        Object record = pro.getProperty(mTempFile.getName() + RECORD + i);                                        </span>
<span class="-1417732743646819816" onmouseenter="enter('-1417732743646819816');" onmouseout="out('-1417732743646819816');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 499 -        if (state != null &amp;&amp; Integer.parseInt(String.valueOf(state)) == 1) {                                      </span>
<span class="1751681047060505637" onmouseenter="enter('1751681047060505637');" onmouseout="out('1751681047060505637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 500 -          mCompleteThreadNum++;                                                                                   </span>
<span class="-5900743039323389312" onmouseenter="enter('-5900743039323389312');" onmouseout="out('-5900743039323389312');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 501 -          tRecord.isComplete = true;                                                                              </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 502 -          continue;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 503 -        }                                                                                                         </span>
<span class="2652986304939921073" onmouseenter="enter('2652986304939921073');" onmouseout="out('2652986304939921073');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 504 -        if (record != null) {                                                                                     </span>
<span class="7355303051831508853" onmouseenter="enter('7355303051831508853');" onmouseout="out('7355303051831508853');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 505 -          long temp = Long.parseLong(String.valueOf(record));                                                     </span>
<span class="6949017848225026676" onmouseenter="enter('6949017848225026676');" onmouseout="out('6949017848225026676');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 506 -          tRecord.startLocation = temp &gt; 0 ? temp : 0;                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 507 -        } else {                                                                                                  </span>
<span class="-2463924567028920967" onmouseenter="enter('-2463924567028920967');" onmouseout="out('-2463924567028920967');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 508 -          tRecord.startLocation = 0;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 509 -        }                                                                                                         </span>
<span class="8450336720909475026" onmouseenter="enter('8450336720909475026');" onmouseout="out('8450336720909475026');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 510 -        mRecord.threadRecords.add(tRecord);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 511 -      }                                                                                                           </span>
<span class="-8106518526167482323" onmouseenter="enter('-8106518526167482323');" onmouseout="out('-8106518526167482323');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 512 -      mConfigFile.delete();                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 513 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 514 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 515 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 516 -  /**                                                                                                             </span>
<span class="-671827589422898020" onmouseenter="enter('-671827589422898020');" onmouseout="out('-671827589422898020');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 517 -   * 初始化记录                                                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 518 -   */                                                                                                             </span>
<span class="-2906418018028154375" onmouseenter="enter('-2906418018028154375');" onmouseout="out('-2906418018028154375');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 519 -  private void initRecord(boolean isNewTask) {                                                                    </span>
<span class="1363226846886967285" onmouseenter="enter('1363226846886967285');" onmouseout="out('1363226846886967285');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 520 -    mRecord = new TaskRecord();                                                                                   </span>
<span class="-5083582960729315317" onmouseenter="enter('-5083582960729315317');" onmouseout="out('-5083582960729315317');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 521 -    mRecord.fileName = mEntity.getFileName();                                                                     </span>
<span class="-7985468931740615125" onmouseenter="enter('-7985468931740615125');" onmouseout="out('-7985468931740615125');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 522 -    mRecord.filePath = getFilePath();                                                                             </span>
<span class="-4117247167556656758" onmouseenter="enter('-4117247167556656758');" onmouseout="out('-4117247167556656758');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 523 -    mRecord.threadRecords = new ArrayList&lt;&gt;();                                                                    </span>
<span class="-836005293351845064" onmouseenter="enter('-836005293351845064');" onmouseout="out('-836005293351845064');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 524 -    mRecord.isGroupRecord = mTaskWrapper.getEntity().isGroupChild();                                              </span>
<span class="8800687954183002826" onmouseenter="enter('8800687954183002826');" onmouseout="out('8800687954183002826');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 525 -    if (mRecord.isGroupRecord) {                                                                                  </span>
<span class="-2142257617502598183" onmouseenter="enter('-2142257617502598183');" onmouseout="out('-2142257617502598183');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 526 -      if (mTaskWrapper.getEntity() instanceof DownloadEntity) {                                                   </span>
<span class="7369297745882463144" onmouseenter="enter('7369297745882463144');" onmouseout="out('7369297745882463144');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 527 -        mRecord.dGroupHash = ((DownloadEntity) mTaskWrapper.getEntity()).getGroupHash();                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 528 -      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 529 -    }                                                                                                             </span>
<span class="5292161376259483255" onmouseenter="enter('5292161376259483255');" onmouseout="out('5292161376259483255');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 530 -    ALog.d(TAG, String.format(&quot;初始化记录，任务为%s任务&quot;, isNewTask ? &quot;新&quot; : &quot;旧&quot;));                                           </span>
<span class="-6248689121619565411" onmouseenter="enter('-6248689121619565411');" onmouseout="out('-6248689121619565411');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 531 -    mTaskWrapper.setNewTask(isNewTask);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 532 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 533 -                                                                                                                  </span>
<span class="-8326432688154281329" onmouseenter="enter('-8326432688154281329');" onmouseout="out('-8326432688154281329');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 534 -  private String getFilePath() {                                                                                  </span>
<span class="-6837435483425150362" onmouseenter="enter('-6837435483425150362');" onmouseout="out('-6837435483425150362');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 535 -    if (getType() == DOWNLOAD) {                                                                                  </span>
<span class="-5130089930686560901" onmouseenter="enter('-5130089930686560901');" onmouseout="out('-5130089930686560901');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 536 -      return ((DownloadEntity) mTaskWrapper.getEntity()).getDownloadPath();                                       </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 537 -    } else {                                                                                                      </span>
<span class="-2519282598545089845" onmouseenter="enter('-2519282598545089845');" onmouseout="out('-2519282598545089845');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 538 -      return ((UploadEntity) mTaskWrapper.getEntity()).getFilePath();                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 539 -    }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 540 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 541 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 542 -  /**                                                                                                             </span>
<span class="-8991940256279851469" onmouseenter="enter('-8991940256279851469');" onmouseout="out('-8991940256279851469');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 543 -   * 保存任务记录                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 544 -   */                                                                                                             </span>
<span class="1188287987342183098" onmouseenter="enter('1188287987342183098');" onmouseout="out('1188287987342183098');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 545 -  private void saveRecord() {                                                                                     </span>
<span class="-6872584921755914518" onmouseenter="enter('-6872584921755914518');" onmouseout="out('-6872584921755914518');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 546 -    mRecord.threadNum = mRecord.threadRecords.size();                                                             </span>
<span class="-3343791891312496302" onmouseenter="enter('-3343791891312496302');" onmouseout="out('-3343791891312496302');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 547 -    mRecord.save();                                                                                               </span>
<span class="-5403271851700040427" onmouseenter="enter('-5403271851700040427');" onmouseout="out('-5403271851700040427');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 548 -    ALog.d(TAG, String.format(&quot;保存记录，线程记录数：%s&quot;, mRecord.threadRecords.size()));                                    </span>
<span class="-5558090595010223508" onmouseenter="enter('-5558090595010223508');" onmouseout="out('-5558090595010223508');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 549 -    DbEntity.saveAll(mRecord.threadRecords);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 550 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 551 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 552 -  /**                                                                                                             </span>
<span class="7661061719912178382" onmouseenter="enter('7661061719912178382');" onmouseout="out('7661061719912178382');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 553 -   * 恢复记录地址                                                                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 554 -   *                                                                                                              </span>
<span class="-1706428464808283045" onmouseenter="enter('-1706428464808283045');" onmouseout="out('-1706428464808283045');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 555 -   * @return {@code true}任务已完成                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 556 -   */                                                                                                             </span>
<span class="423019558917313706" onmouseenter="enter('423019558917313706');" onmouseout="out('423019558917313706');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 557 -  private boolean resumeRecordLocation(int i, long startL, long endL) {                                           </span>
<span class="8742170387731029623" onmouseenter="enter('8742170387731029623');" onmouseout="out('8742170387731029623');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 558 -    mConstance.CURRENT_LOCATION += endL - startL;                                                                 </span>
<span class="-536040810321338414" onmouseenter="enter('-536040810321338414');" onmouseout="out('-536040810321338414');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 559 -    ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__已完成&quot;, mTaskWrapper.getEntity().getFileName(), i));                   </span>
<span class="3932130165010443212" onmouseenter="enter('3932130165010443212');" onmouseout="out('3932130165010443212');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 560 -    mConstance.COMPLETE_THREAD_NUM = mCompleteThreadNum;                                                          </span>
<span class="-9210577730054562738" onmouseenter="enter('-9210577730054562738');" onmouseout="out('-9210577730054562738');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 561 -    mConstance.STOP_NUM++;                                                                                        </span>
<span class="-3619958279020110018" onmouseenter="enter('-3619958279020110018');" onmouseout="out('-3619958279020110018');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 562 -    mConstance.CANCEL_NUM++;                                                                                      </span>
<span class="7782635320445246693" onmouseenter="enter('7782635320445246693');" onmouseout="out('7782635320445246693');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 563 -    if (mConstance.isComplete()) {                                                                                </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 564 -      mRecord.deleteData();                                                                                       </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 565 -      mListener.onComplete();                                                                                     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 566 -      return true;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 567 -    }                                                                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 568 -    return false;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 569 -  }                                                                                                               </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 570 -                                                                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 571 -  /**                                                                                                             </span>
<span class="8881300510663389339" onmouseenter="enter('8881300510663389339');" onmouseout="out('8881300510663389339');" style=""> 572     * 启动断点任务时，创建单线程任务                                                                                              </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 573     *                                                                                                              </span>
<span class="4311889051397531831" onmouseenter="enter('4311889051397531831');" onmouseout="out('4311889051397531831');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 574 -   * @param i 线程id                                                                                                </span>
<span class="1230174220176038900" onmouseenter="enter('1230174220176038900');" onmouseout="out('1230174220176038900');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 575 -   * @param startL 该任务起始位置                                                                                        </span>
<span class="1858994332528537357" onmouseenter="enter('1858994332528537357');" onmouseout="out('1858994332528537357');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 576 -   * @param endL 该任务结束位置                                                                                          </span>
<span class="4908980689327331914" onmouseenter="enter('4908980689327331914');" onmouseout="out('4908980689327331914');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 577 -   * @param fileLength 该任务需要处理的文件长度                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 578 -   */                                                                                                             </span>
<span class="8417307416647678377" onmouseenter="enter('8417307416647678377');" onmouseout="out('8417307416647678377');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 579 -  private AbsThreadTask createSingThreadTask(int i, long startL, long endL, long fileLength,                      </span>
<span class="-2934306509623024164" onmouseenter="enter('-2934306509623024164');" onmouseout="out('-2934306509623024164');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 580 -      ThreadRecord record) {                                                                                      </span>
<span class="-262599314844690395" onmouseenter="enter('-262599314844690395');" onmouseout="out('-262599314844690395');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 581 +   * @param record 线程记录                                                                                           </span>
<span class="4692865644996389482" onmouseenter="enter('4692865644996389482');" onmouseout="out('4692865644996389482');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 582 +   * @param startNum 启动的线程数                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 583 +   */                                                                                                             </span>
<span class="6288283959573381778" onmouseenter="enter('6288283959573381778');" onmouseout="out('6288283959573381778');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 584 +  private AbsThreadTask createSingThreadTask(ThreadRecord record, int startNum) {                                 </span>
<span class="619060527413120496" onmouseenter="enter('619060527413120496');" onmouseout="out('619060527413120496');" style=""> 585      SubThreadConfig&lt;TASK_WRAPPER&gt; config = new SubThreadConfig&lt;&gt;();                                               </span>
<span class="3695278979318197874" onmouseenter="enter('3695278979318197874');" onmouseout="out('3695278979318197874');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 586 -    config.TOTAL_FILE_SIZE = fileLength;                                                                          </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 587 -    config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                              </span>
<span class="8163353749053363911" onmouseenter="enter('8163353749053363911');" onmouseout="out('8163353749053363911');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 588 -    config.TEMP_FILE =                                                                                            </span>
<span class="8812115108936854999" onmouseenter="enter('8812115108936854999');" onmouseout="out('8812115108936854999');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 589 -        mRecord.isBlock ? new File(String.format(SUB_PATH, mTempFile.getPath(), i)) : mTempFile;                  </span>
<span class="-8589974584258899309" onmouseenter="enter('-8589974584258899309');" onmouseout="out('-8589974584258899309');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 590 -    config.THREAD_ID = i;                                                                                         </span>
<span class="-423990566973150114" onmouseenter="enter('-423990566973150114');" onmouseout="out('-423990566973150114');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 591 -    config.START_LOCATION = startL;                                                                               </span>
<span class="7030036366591044852" onmouseenter="enter('7030036366591044852');" onmouseout="out('7030036366591044852');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 592 -    config.END_LOCATION = endL;                                                                                   </span>
<span class="6707181570367944829" onmouseenter="enter('6707181570367944829');" onmouseout="out('6707181570367944829');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 593 -    config.SUPPORT_BP = mTaskWrapper.isSupportBP();                                                               </span>
<span class="-4458980325189718812" onmouseenter="enter('-4458980325189718812');" onmouseout="out('-4458980325189718812');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 594 -    config.TASK_WRAPPER = mTaskWrapper;                                                                           </span>
<span class="-4817448612298280426" onmouseenter="enter('-4817448612298280426');" onmouseout="out('-4817448612298280426');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 595 -    config.THREAD_RECORD = record;                                                                                </span>
<span class="1383183623969437207" onmouseenter="enter('1383183623969437207');" onmouseout="out('1383183623969437207');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 596 +    config.url = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                              </span>
<span class="-2180512157664708444" onmouseenter="enter('-2180512157664708444');" onmouseout="out('-2180512157664708444');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 597 +    config.tempFile =                                                                                             </span>
<span class="4786837782358626319" onmouseenter="enter('4786837782358626319');" onmouseout="out('4786837782358626319');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 598 +        mRecord.isBlock ? new File(                                                                               </span>
<span class="-928238364642114529" onmouseenter="enter('-928238364642114529');" onmouseout="out('-928238364642114529');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 599 +            String.format(RecordHandler.SUB_PATH, mTempFile.getPath(), record.threadId))                          </span>
<span class="-2755374302005590951" onmouseenter="enter('-2755374302005590951');" onmouseout="out('-2755374302005590951');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 600 +            : mTempFile;                                                                                          </span>
<span class="-3873105131765266571" onmouseenter="enter('-3873105131765266571');" onmouseout="out('-3873105131765266571');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 601 +    config.isBlock = mRecord.isBlock;                                                                             </span>
<span class="2125632838406943587" onmouseenter="enter('2125632838406943587');" onmouseout="out('2125632838406943587');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 602 +    config.isOpenDynamicFile = mRecord.isOpenDynamicFile;                                                         </span>
<span class="6114090202926236086" onmouseenter="enter('6114090202926236086');" onmouseout="out('6114090202926236086');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 603 +    config.startThreadNum = startNum;                                                                             </span>
<span class="-4242804732746281982" onmouseenter="enter('-4242804732746281982');" onmouseout="out('-4242804732746281982');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 604 +    config.taskWrapper = mTaskWrapper;                                                                            </span>
<span class="-4639824013167552343" onmouseenter="enter('-4639824013167552343');" onmouseout="out('-4639824013167552343');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 605 +    config.record = record;                                                                                       </span>
<span class="5396523329299846357" onmouseenter="enter('5396523329299846357');" onmouseout="out('5396523329299846357');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 606 +    config.stateHandler = mStateHandler;                                                                          </span>
<span class="-3921818352268167442" onmouseenter="enter('-3921818352268167442');" onmouseout="out('-3921818352268167442');" style=""> 607      return selectThreadTask(config);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 608    }                                                                                                               </span>
<span  style=""> 609                                                                                                                    </span>
<span class="6532423587840407518" onmouseenter="enter('6532423587840407518');" onmouseout="out('6532423587840407518');" style=""> 610    private void handleBreakpoint() {                                                                               </span>
<span class="-4822982872266026601" onmouseenter="enter('-4822982872266026601');" onmouseout="out('-4822982872266026601');" style=""> 611      long fileLength = mEntity.getFileSize();                                                                      </span>
<span class="-23207299311678828" onmouseenter="enter('-23207299311678828');" onmouseout="out('-23207299311678828');" style=""> 612      long blockSize = fileLength / mTotalThreadNum;                                                                </span>
<span class="-3393480437861582877" onmouseenter="enter('-3393480437861582877');" onmouseout="out('-3393480437861582877');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 613 -    Set&lt;Integer&gt; threads = new HashSet&lt;&gt;();                                                                       </span>
<span class="-5777658456236299795" onmouseenter="enter('-5777658456236299795');" onmouseout="out('-5777658456236299795');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 614 -    //// 如果是新任务，检查下历史记录，如果有遗留的记录，删除并删除分块文件                                                                        </span>
<span class="-4510395139998187778" onmouseenter="enter('-4510395139998187778');" onmouseout="out('-4510395139998187778');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 615 -    //if (mTaskWrapper.isNewTask()) {                                                                             </span>
<span class="6756926677054436789" onmouseenter="enter('6756926677054436789');" onmouseout="out('6756926677054436789');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 616 -    //  CommonUtil.delTaskRecord(getFilePath(), 1, true);                                                         </span>
<span class="-4740675746293055676" onmouseenter="enter('-4740675746293055676');" onmouseout="out('-4740675746293055676');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 617 -    //}                                                                                                           </span>
<span class="-5411942018384313216" onmouseenter="enter('-5411942018384313216');" onmouseout="out('-5411942018384313216');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 618 +    long currentProgress = 0;                                                                                     </span>
<span  style=""> 619                                                                                                                    </span>
<span class="575574520788079541" onmouseenter="enter('575574520788079541');" onmouseout="out('575574520788079541');" style=""> 620      mRecord.fileLength = fileLength;                                                                              </span>
<span class="-8044703341086541865" onmouseenter="enter('-8044703341086541865');" onmouseout="out('-8044703341086541865');" style=""> 621      if (mTaskWrapper.isNewTask() &amp;&amp; !handleNewTask()) {                                                           </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 622        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 623      }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 624 +                                                                                                                  </span>
<span class="-4848901962459716543" onmouseenter="enter('-4848901962459716543');" onmouseout="out('-4848901962459716543');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 625 +    int startNum = mRecord.threadNum;                                                                             </span>
<span class="-590857015481166061" onmouseenter="enter('-590857015481166061');" onmouseout="out('-590857015481166061');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 626 +    for (ThreadRecord tr : mRecord.threadRecords) {                                                               </span>
<span class="23428130114285890" onmouseenter="enter('23428130114285890');" onmouseout="out('23428130114285890');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 627 +      if (!tr.isComplete) {                                                                                       </span>
<span class="-4061668182787110636" onmouseenter="enter('-4061668182787110636');" onmouseout="out('-4061668182787110636');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 628 +        startNum++;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 629 +      }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 630 +    }                                                                                                             </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 631 +                                                                                                                  </span>
<span class="-4630408134485330966" onmouseenter="enter('-4630408134485330966');" onmouseout="out('-4630408134485330966');" style=""> 632      for (int i = 0; i &lt; mTotalThreadNum; i++) {                                                                   </span>
<span class="-2965725495076654490" onmouseenter="enter('-2965725495076654490');" onmouseout="out('-2965725495076654490');" style=""> 633        long startL = i * blockSize, endL = (i + 1) * blockSize;                                                    </span>
<span class="5090177735693834127" onmouseenter="enter('5090177735693834127');" onmouseout="out('5090177735693834127');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 634 -      ThreadRecord tr;                                                                                            </span>
<span class="-7836453111996726628" onmouseenter="enter('-7836453111996726628');" onmouseout="out('-7836453111996726628');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 635 -      boolean isNewTr = false;  // 是否是新的线程记录                                                                      </span>
<span class="-4795094782878764344" onmouseenter="enter('-4795094782878764344');" onmouseout="out('-4795094782878764344');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 636 -      if (mTaskWrapper.isNewTask()) {                                                                             </span>
<span class="-1372101013715036968" onmouseenter="enter('-1372101013715036968');" onmouseout="out('-1372101013715036968');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 637 -        tr = new ThreadRecord();                                                                                  </span>
<span class="3917749081996930633" onmouseenter="enter('3917749081996930633');" onmouseout="out('3917749081996930633');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 638 -        tr.key = mRecord.filePath;                                                                                </span>
<span class="-7575886392361997801" onmouseenter="enter('-7575886392361997801');" onmouseout="out('-7575886392361997801');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 639 -        tr.threadId = i;                                                                                          </span>
<span class="3085824084899250864" onmouseenter="enter('3085824084899250864');" onmouseout="out('3085824084899250864');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 640 -        isNewTr = true;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 641 -      } else {                                                                                                    </span>
<span class="-548726359565759652" onmouseenter="enter('-548726359565759652');" onmouseout="out('-548726359565759652');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 642 -        tr = mRecord.threadRecords.get(i);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 643 -      }                                                                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 644 -                                                                                                                  </span>
<span class="-9126208292322323685" onmouseenter="enter('-9126208292322323685');" onmouseout="out('-9126208292322323685');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 645 -      if (tr.blockLen == 0) {                                                                                     </span>
<span class="-4142305526048218013" onmouseenter="enter('-4142305526048218013');" onmouseout="out('-4142305526048218013');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 646 -        tr.blockLen = CommonUtil.getBlockLen(fileLength, i, mTotalThreadNum);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 647 -      }                                                                                                           </span>
<span class="4424666519135617916" onmouseenter="enter('4424666519135617916');" onmouseout="out('4424666519135617916');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 648 +      ThreadRecord tr = mRecord.threadRecords.get(i);                                                             </span>
<span  style=""> 649                                                                                                                    </span>
<span class="-973014210831854259" onmouseenter="enter('-973014210831854259');" onmouseout="out('-973014210831854259');" style=""> 650        if (tr.isComplete) {//该线程已经完成                                                                               </span>
<span class="5189294880655919692" onmouseenter="enter('5189294880655919692');" onmouseout="out('5189294880655919692');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 651 -        if (resumeRecordLocation(i, startL, endL)) return;                                                        </span>
<span class="180590181413857803" onmouseenter="enter('180590181413857803');" onmouseout="out('180590181413857803');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 652 +        currentProgress += endL - startL;                                                                         </span>
<span class="-536040810321338414" onmouseenter="enter('-536040810321338414');" onmouseout="out('-536040810321338414');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 653 +        ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__已完成&quot;, mTaskWrapper.getEntity().getFileName(), i));               </span>
<span class="1740477104282149859" onmouseenter="enter('1740477104282149859');" onmouseout="out('1740477104282149859');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 654 +        mStateHandler.obtainMessage(ThreadStateManager.STATE_COMPLETE).sendToTarget();                            </span>
<span class="2369831997717445711" onmouseenter="enter('2369831997717445711');" onmouseout="out('2369831997717445711');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 655 +        if (mStateManager.isComplete()) {                                                                         </span>
<span class="2220247792528591938" onmouseenter="enter('2220247792528591938');" onmouseout="out('2220247792528591938');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 656 +          mRecord.deleteData();                                                                                   </span>
<span class="-5488944763580208269" onmouseenter="enter('-5488944763580208269');" onmouseout="out('-5488944763580208269');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 657 +          mListener.onComplete();                                                                                 </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 658 +          return;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 659 +        }                                                                                                         </span>
<span class="-6362435147834875541" onmouseenter="enter('-6362435147834875541');" onmouseout="out('-6362435147834875541');" style=""> 660          continue;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 661        }                                                                                                           </span>
<span  style=""> 662                                                                                                                    </span>
<span class="1183688269285295822" onmouseenter="enter('1183688269285295822');" onmouseout="out('1183688269285295822');" style=""> 663        //如果有记录，则恢复任务                                                                                               </span>
<span class="-9174570816963057194" onmouseenter="enter('-9174570816963057194');" onmouseout="out('-9174570816963057194');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 664 -      if (tr.startLocation &gt; 0) {                                                                                 </span>
<span class="2244216797309960275" onmouseenter="enter('2244216797309960275');" onmouseout="out('2244216797309960275');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 665 -        long r = tr.startLocation;                                                                                </span>
<span class="-7915611879357930899" onmouseenter="enter('-7915611879357930899');" onmouseout="out('-7915611879357930899');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 666 -        //记录的位置需要在线程区间中                                                                                           </span>
<span class="-3706404109465135132" onmouseenter="enter('-3706404109465135132');" onmouseout="out('-3706404109465135132');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 667 -        if (startL &lt; r &amp;&amp; r &lt;= (i == (mTotalThreadNum - 1) ? fileLength : endL)) {                                </span>
<span class="1683054574044455381" onmouseenter="enter('1683054574044455381');" onmouseout="out('1683054574044455381');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 668 -          mConstance.CURRENT_LOCATION += r - startL;                                                              </span>
<span class="1542845345888554533" onmouseenter="enter('1542845345888554533');" onmouseout="out('1542845345888554533');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 669 -          startL = r;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 670 -        }                                                                                                         </span>
<span class="5845990765500507783" onmouseenter="enter('5845990765500507783');" onmouseout="out('5845990765500507783');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 671 -        ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__恢复任务&quot;, mEntity.getFileName(), i));                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 672 -      } else {                                                                                                    </span>
<span class="635736622332337160" onmouseenter="enter('635736622332337160');" onmouseout="out('635736622332337160');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 673 -        tr.startLocation = startL;                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 674 -      }                                                                                                           </span>
<span class="7194952027883197425" onmouseenter="enter('7194952027883197425');" onmouseout="out('7194952027883197425');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 675 -      //最后一个线程的结束位置即为文件的总长度                                                                                       </span>
<span class="-5942950699866528890" onmouseenter="enter('-5942950699866528890');" onmouseout="out('-5942950699866528890');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 676 -      if (i == (mTotalThreadNum - 1)) {                                                                           </span>
<span class="-2829184075463306484" onmouseenter="enter('-2829184075463306484');" onmouseout="out('-2829184075463306484');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 677 -        endL = fileLength;                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 678 -      }                                                                                                           </span>
<span class="9008536478346595299" onmouseenter="enter('9008536478346595299');" onmouseout="out('9008536478346595299');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 679 -      if (tr.endLocation &lt;= 0) {                                                                                  </span>
<span class="-8820011367691672414" onmouseenter="enter('-8820011367691672414');" onmouseout="out('-8820011367691672414');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 680 -        tr.endLocation = endL;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 681 -      }                                                                                                           </span>
<span class="-5584934139293502444" onmouseenter="enter('-5584934139293502444');" onmouseout="out('-5584934139293502444');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 682 -      if (isNewTr) {                                                                                              </span>
<span class="7750338393456465672" onmouseenter="enter('7750338393456465672');" onmouseout="out('7750338393456465672');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 683 -        mRecord.threadRecords.add(tr);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 684 -      }                                                                                                           </span>
<span class="-7040830845063557440" onmouseenter="enter('-7040830845063557440');" onmouseout="out('-7040830845063557440');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 685 -      //ALog.d(TAG, String.format(&quot;创建任务线程：%s，线程总数：%s&quot;, i, mTotalThreadNum));                                      </span>
<span class="6319026600890011419" onmouseenter="enter('6319026600890011419');" onmouseout="out('6319026600890011419');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 686 -      AbsThreadTask task = createSingThreadTask(i, startL, endL, fileLength, tr);                                 </span>
<span class="2244216797309960275" onmouseenter="enter('2244216797309960275');" onmouseout="out('2244216797309960275');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 687 +      long r = tr.startLocation;                                                                                  </span>
<span class="-7915611879357930899" onmouseenter="enter('-7915611879357930899');" onmouseout="out('-7915611879357930899');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 688 +      //记录的位置需要在线程区间中                                                                                             </span>
<span class="-3706404109465135132" onmouseenter="enter('-3706404109465135132');" onmouseout="out('-3706404109465135132');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 689 +      if (startL &lt; r &amp;&amp; r &lt;= (i == (mTotalThreadNum - 1) ? fileLength : endL)) {                                  </span>
<span class="9212684671908260751" onmouseenter="enter('9212684671908260751');" onmouseout="out('9212684671908260751');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 690 +        currentProgress += r - startL;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 691 +      }                                                                                                           </span>
<span class="5845990765500507783" onmouseenter="enter('5845990765500507783');" onmouseout="out('5845990765500507783');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 692 +      ALog.d(TAG, String.format(&quot;任务【%s】线程__%s__恢复任务&quot;, mEntity.getFileName(), i));                                 </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 693 +                                                                                                                  </span>
<span class="-4760110330380665779" onmouseenter="enter('-4760110330380665779');" onmouseout="out('-4760110330380665779');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 694 +      AbsThreadTask task = createSingThreadTask(tr, startNum);                                                    </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style=""> 695        if (task == null) return;                                                                                   </span>
<span class="-6012810893938815399" onmouseenter="enter('-6012810893938815399');" onmouseout="out('-6012810893938815399');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 696 -      mTask.put(i, task);                                                                                         </span>
<span class="4583095755176113317" onmouseenter="enter('4583095755176113317');" onmouseout="out('4583095755176113317');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 697 -      threads.add(i);                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 698 -    }                                                                                                             </span>
<span class="290274778352054232" onmouseenter="enter('290274778352054232');" onmouseout="out('290274778352054232');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 699 -    if (mConstance.CURRENT_LOCATION != 0                                                                          </span>
<span class="8899125546582658120" onmouseenter="enter('8899125546582658120');" onmouseout="out('8899125546582658120');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 700 -        &amp;&amp; mConstance.CURRENT_LOCATION != mEntity.getCurrentProgress()) {                                         </span>
<span class="-6641501506845691208" onmouseenter="enter('-6641501506845691208');" onmouseout="out('-6641501506845691208');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 701 -      ALog.d(TAG, String.format(&quot;进度修正，当前进度：%s&quot;, mConstance.CURRENT_LOCATION));                                    </span>
<span class="480370803854164555" onmouseenter="enter('480370803854164555');" onmouseout="out('480370803854164555');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 702 -      mEntity.setCurrentProgress(mConstance.CURRENT_LOCATION);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 703 -    }                                                                                                             </span>
<span class="-4447853798640415053" onmouseenter="enter('-4447853798640415053');" onmouseout="out('-4447853798640415053');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 704 -    saveRecord();                                                                                                 </span>
<span class="520458791074877981" onmouseenter="enter('520458791074877981');" onmouseout="out('520458791074877981');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 705 -    startThreadTask(threads);                                                                                     </span>
<span class="7333602866274972902" onmouseenter="enter('7333602866274972902');" onmouseout="out('7333602866274972902');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 706 +      mTask.put(tr.threadId, task);                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 707 +    }                                                                                                             </span>
<span class="7288210074172932222" onmouseenter="enter('7288210074172932222');" onmouseout="out('7288210074172932222');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 708 +    if (currentProgress != 0 &amp;&amp; currentProgress != mEntity.getCurrentProgress()) {                                </span>
<span class="4971627158329011933" onmouseenter="enter('4971627158329011933');" onmouseout="out('4971627158329011933');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 709 +      ALog.d(TAG, String.format(&quot;进度修正，当前进度：%s&quot;, currentProgress));                                                </span>
<span class="5257240383095204746" onmouseenter="enter('5257240383095204746');" onmouseout="out('5257240383095204746');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 710 +      mEntity.setCurrentProgress(currentProgress);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 711 +    }                                                                                                             </span>
<span class="-1549239735956086188" onmouseenter="enter('-1549239735956086188');" onmouseout="out('-1549239735956086188');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 712 +    mStateHandler.obtainMessage(ThreadStateManager.STATE_UPDATE_PROGRESS, currentProgress)                        </span>
<span class="543169677106967816" onmouseenter="enter('543169677106967816');" onmouseout="out('543169677106967816');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 713 +        .sendToTarget();                                                                                          </span>
<span class="5226311560826554017" onmouseenter="enter('5226311560826554017');" onmouseout="out('5226311560826554017');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 714 +    startThreadTask();                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 715    }                                                                                                               </span>
<span  style=""> 716                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 717    /**                                                                                                             </span>
<span class="3352756078121499684" onmouseenter="enter('3352756078121499684');" onmouseout="out('3352756078121499684');" style=""> 718     * 启动单线程任务                                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 719     */                                                                                                             </span>
<span class="2474728297875420615" onmouseenter="enter('2474728297875420615');" onmouseout="out('2474728297875420615');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 720 -  private void startThreadTask(Set&lt;Integer&gt; recordL) {                                                            </span>
<span class="3368331307598775889" onmouseenter="enter('3368331307598775889');" onmouseout="out('3368331307598775889');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 721 +  private void startThreadTask() {                                                                                </span>
<span class="-8163448594027824981" onmouseenter="enter('-8163448594027824981');" onmouseout="out('-8163448594027824981');" style=""> 722      if (isBreak()) {                                                                                              </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 723        return;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 724      }                                                                                                             </span>
<span class="-1061602448343886008" onmouseenter="enter('-1061602448343886008');" onmouseout="out('-1061602448343886008');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 725 -    if (mConstance.CURRENT_LOCATION &gt; 0) {                                                                        </span>
<span class="5187035189520501266" onmouseenter="enter('5187035189520501266');" onmouseout="out('5187035189520501266');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 726 -      mListener.onResume(mConstance.CURRENT_LOCATION);                                                            </span>
<span class="7098753117484412935" onmouseenter="enter('7098753117484412935');" onmouseout="out('7098753117484412935');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 727 +    if (mStateManager.getCurrentProgress() &gt; 0) {                                                                 </span>
<span class="6109786906910873721" onmouseenter="enter('6109786906910873721');" onmouseout="out('6109786906910873721');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 728 +      mListener.onResume(mStateManager.getCurrentProgress());                                                     </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 729      } else {                                                                                                      </span>
<span class="-2973471902048685805" onmouseenter="enter('-2973471902048685805');" onmouseout="out('-2973471902048685805');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 730 -      mListener.onStart(mConstance.CURRENT_LOCATION);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 731 -    }                                                                                                             </span>
<span class="1243235571055153612" onmouseenter="enter('1243235571055153612');" onmouseout="out('1243235571055153612');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 732 -    for (int l : recordL) {                                                                                       </span>
<span class="-7510837703317171619" onmouseenter="enter('-7510837703317171619');" onmouseout="out('-7510837703317171619');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 733 -      if (l == -1) continue;                                                                                      </span>
<span class="405951857149259261" onmouseenter="enter('405951857149259261');" onmouseout="out('405951857149259261');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 734 -      ThreadTaskManager.getInstance().startThread(mTaskWrapper.getKey(), mTask.get(l));                           </span>
<span class="7813115435309058360" onmouseenter="enter('7813115435309058360');" onmouseout="out('7813115435309058360');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 735 +      mListener.onStart(mStateManager.getCurrentProgress());                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 736 +    }                                                                                                             </span>
<span class="5971600522411109260" onmouseenter="enter('5971600522411109260');" onmouseout="out('5971600522411109260');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 737 +    for (int i = 0; i &lt; mTask.size(); i++) {                                                                      </span>
<span class="-9098026151212374592" onmouseenter="enter('-9098026151212374592');" onmouseout="out('-9098026151212374592');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 738 +      ThreadTaskManager.getInstance().startThread(mTaskWrapper.getKey(), mTask.get(i));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 739      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 740    }                                                                                                               </span>
<span  style=""> 741                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 742    /**                                                                                                             </span>
<span class="5483762406760822984" onmouseenter="enter('5483762406760822984');" onmouseout="out('5483762406760822984');" style=""> 743     * 重试任务                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 744     */                                                                                                             </span>
<span class="3179155293949549674" onmouseenter="enter('3179155293949549674');" onmouseout="out('3179155293949549674');" style=""> 745    public void retryTask() {                                                                                       </span>
<span class="5921009668313525105" onmouseenter="enter('5921009668313525105');" onmouseout="out('5921009668313525105');" style=""> 746      ALog.w(TAG, String.format(&quot;任务【%s】开始重试&quot;, mEntity.getFileName()));                                              </span>
<span class="-5779564282072536454" onmouseenter="enter('-5779564282072536454');" onmouseout="out('-5779564282072536454');" style=""> 747      startFlow();                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 748    }                                                                                                               </span>
<span  style=""> 749                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 750    /**                                                                                                             </span>
<span class="3489882028140634260" onmouseenter="enter('3489882028140634260');" onmouseout="out('3489882028140634260');" style=""> 751     * 处理新任务                                                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 752     *                                                                                                              </span>
<span class="8941769692798326625" onmouseenter="enter('8941769692798326625');" onmouseout="out('8941769692798326625');" style=""> 753     * @return {@code true}创建新任务失败                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 754     */                                                                                                             </span>
<span class="3897453149098456479" onmouseenter="enter('3897453149098456479');" onmouseout="out('3897453149098456479');" style=""> 755    protected abstract boolean handleNewTask();                                                                     </span>
<span  style=""> 756                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 757    /**                                                                                                             </span>
<span class="-4404408971562231280" onmouseenter="enter('-4404408971562231280');" onmouseout="out('-4404408971562231280');" style=""> 758     * 处理不支持断点的任务                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 759     */                                                                                                             </span>
<span class="-8792279366871913220" onmouseenter="enter('-8792279366871913220');" onmouseout="out('-8792279366871913220');" style=""> 760    private void handleNoSupportBP() {                                                                              </span>
<span class="33131000937493775" onmouseenter="enter('33131000937493775');" onmouseout="out('33131000937493775');" style=""> 761      if (mListener instanceof BaseDListener) {                                                                     </span>
<span class="-4047803046141878594" onmouseenter="enter('-4047803046141878594');" onmouseout="out('-4047803046141878594');" style=""> 762        ((BaseDListener) mListener).supportBreakpoint(false);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 763      }                                                                                                             </span>
<span class="619060527413120496" onmouseenter="enter('619060527413120496');" onmouseout="out('619060527413120496');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 764 -    SubThreadConfig&lt;TASK_WRAPPER&gt; config = new SubThreadConfig&lt;&gt;();                                               </span>
<span class="5914737473662302802" onmouseenter="enter('5914737473662302802');" onmouseout="out('5914737473662302802');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 765 -    config.TOTAL_FILE_SIZE = mEntity.getFileSize();                                                               </span>
<span class="7309035770151979670" onmouseenter="enter('7309035770151979670');" onmouseout="out('7309035770151979670');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 766 -    config.URL = mEntity.isRedirect() ? mEntity.getRedirectUrl() : mEntity.getUrl();                              </span>
<span class="2187212944586441874" onmouseenter="enter('2187212944586441874');" onmouseout="out('2187212944586441874');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 767 -    config.TEMP_FILE = mTempFile;                                                                                 </span>
<span class="-5899809357890352135" onmouseenter="enter('-5899809357890352135');" onmouseout="out('-5899809357890352135');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 768 -    config.THREAD_ID = 0;                                                                                         </span>
<span class="7958711547477559333" onmouseenter="enter('7958711547477559333');" onmouseout="out('7958711547477559333');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 769 -    config.START_LOCATION = 0;                                                                                    </span>
<span class="747053779851311386" onmouseenter="enter('747053779851311386');" onmouseout="out('747053779851311386');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 770 -    config.END_LOCATION = config.TOTAL_FILE_SIZE;                                                                 </span>
<span class="6707181570367944829" onmouseenter="enter('6707181570367944829');" onmouseout="out('6707181570367944829');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 771 -    config.SUPPORT_BP = mTaskWrapper.isSupportBP();                                                               </span>
<span class="-4458980325189718812" onmouseenter="enter('-4458980325189718812');" onmouseout="out('-4458980325189718812');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 772 -    config.TASK_WRAPPER = mTaskWrapper;                                                                           </span>
<span class="8051738883997329022" onmouseenter="enter('8051738883997329022');" onmouseout="out('8051738883997329022');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 773 -    ThreadRecord record = DbEntity.findFirst(ThreadRecord.class, &quot;key=?&quot;, mRecord.filePath);                      </span>
<span class="2652986304939921073" onmouseenter="enter('2652986304939921073');" onmouseout="out('2652986304939921073');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 774 -    if (record != null) {                                                                                         </span>
<span class="7377969291689599090" onmouseenter="enter('7377969291689599090');" onmouseout="out('7377969291689599090');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 775 -      record.deleteData();                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 776 -    }                                                                                                             </span>
<span class="3763585654065879367" onmouseenter="enter('3763585654065879367');" onmouseout="out('3763585654065879367');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 777 -    record = new ThreadRecord();                                                                                  </span>
<span class="8888392257982082951" onmouseenter="enter('8888392257982082951');" onmouseout="out('8888392257982082951');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 778 -    record.startLocation = 0;                                                                                     </span>
<span class="-7637475387427293760" onmouseenter="enter('-7637475387427293760');" onmouseout="out('-7637475387427293760');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 779 -    record.endLocation = config.TOTAL_FILE_SIZE;                                                                  </span>
<span class="3029329660257706333" onmouseenter="enter('3029329660257706333');" onmouseout="out('3029329660257706333');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 780 -    record.key = mTempFile.getPath();                                                                             </span>
<span class="2907574057970886296" onmouseenter="enter('2907574057970886296');" onmouseout="out('2907574057970886296');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 781 -    mRecord.threadRecords.add(record);                                                                            </span>
<span class="-4817448612298280426" onmouseenter="enter('-4817448612298280426');" onmouseout="out('-4817448612298280426');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 782 -    config.THREAD_RECORD = record;                                                                                </span>
<span class="-5296271627358693026" onmouseenter="enter('-5296271627358693026');" onmouseout="out('-5296271627358693026');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 783 -    AbsThreadTask task = selectThreadTask(config);                                                                </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 784 +                                                                                                                  </span>
<span class="-1616430852182163073" onmouseenter="enter('-1616430852182163073');" onmouseout="out('-1616430852182163073');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 785 +    AbsThreadTask task = createSingThreadTask(mRecord.threadRecords.get(0), 1);                                   </span>
<span class="-5621755332085026767" onmouseenter="enter('-5621755332085026767');" onmouseout="out('-5621755332085026767');" style=""> 786      if (task == null) return;                                                                                     </span>
<span class="8048363116921461760" onmouseenter="enter('8048363116921461760');" onmouseout="out('8048363116921461760');" style=""> 787      mTask.put(0, task);                                                                                           </span>
<span class="-4447853798640415053" onmouseenter="enter('-4447853798640415053');" onmouseout="out('-4447853798640415053');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 788 -    saveRecord();                                                                                                 </span>
<span class="4018208315746033194" onmouseenter="enter('4018208315746033194');" onmouseout="out('4018208315746033194');" style=""> 789      ThreadTaskManager.getInstance().startThread(mTaskWrapper.getKey(), task);                                     </span>
<span class="-2943780714290472761" onmouseenter="enter('-2943780714290472761');" onmouseout="out('-2943780714290472761');" style=""> 790      mListener.onStart(0);                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 791    }                                                                                                               </span>
<span  style=""> 792                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 793    /**                                                                                                             </span>
<span class="5502854491504205724" onmouseenter="enter('5502854491504205724');" onmouseout="out('5502854491504205724');" style=""> 794     * 选择单任务线程的类型                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 795     */                                                                                                             </span>
<span class="-6182858214188596124" onmouseenter="enter('-6182858214188596124');" onmouseout="out('-6182858214188596124');" style=""> 796    protected abstract AbsThreadTask selectThreadTask(SubThreadConfig&lt;TASK_WRAPPER&gt; config);                        </span>
<span  style=""> 797                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 798    /**                                                                                                             </span>
<span class="1743516648458284983" onmouseenter="enter('1743516648458284983');" onmouseout="out('1743516648458284983');" style=""> 799     * 任务是否已经中断                                                                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style=""> 800     *                                                                                                              </span>
<span class="1049148427197526624" onmouseenter="enter('1049148427197526624');" onmouseout="out('1049148427197526624');" style=""> 801     * @return {@code true}中断                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 802     */                                                                                                             </span>
<span class="-5185153522657566835" onmouseenter="enter('-5185153522657566835');" onmouseout="out('-5185153522657566835');" style=""> 803    public boolean isBreak() {                                                                                      </span>
<span class="3017675825070527056" onmouseenter="enter('3017675825070527056');" onmouseout="out('3017675825070527056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 804 -    if (mConstance.isCancel || mConstance.isStop) {                                                               </span>
<span class="-1760408404888214576" onmouseenter="enter('-1760408404888214576');" onmouseout="out('-1760408404888214576');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 805 +    if (isCancel || isStop) {                                                                                     </span>
<span class="-2335251262544278564" onmouseenter="enter('-2335251262544278564');" onmouseout="out('-2335251262544278564');" style=""> 806        closeTimer();                                                                                               </span>
<span class="-93553338069535680" onmouseenter="enter('-93553338069535680');" onmouseout="out('-93553338069535680');" style=""> 807        ALog.d(TAG, String.format(&quot;任务【%s】已停止或取消了&quot;, mEntity.getFileName()));                                         </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 808        return true;                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 809      }                                                                                                             </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 810      return false;                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 811    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 812  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            