<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>348</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    348
                    <a href="347.html">prev</a>
                    <a href="349.html">next</a>
                    <a href="348_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_5553ee5c6410a412ab4ed61d9499805adee8995a_core/src/main/java/com/dtstack/flink/sql/parser/CreateTmpTableParser.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;5553ee5c6410a412ab4ed61d9499805adee8995a:core/src/main/java/com/dtstack/flink/sql/parser/CreateTmpTableParser.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;5553ee5c6410a412ab4ed61d9499805adee8995a^1:core/src/main/java/com/dtstack/flink/sql/parser/CreateTmpTableParser.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;5553ee5c6410a412ab4ed61d9499805adee8995a^2:core/src/main/java/com/dtstack/flink/sql/parser/CreateTmpTableParser.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e0a10435dcb243a911c0405daebc6aa667d5119d:core/src/main/java/com/dtstack/flink/sql/parser/CreateTmpTableParser.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span  style="">  20                                                                                                          </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  21 package com.dtstack.flink.sql.parser;                                                                    </span>
<span  style="">  22                                                                                                          </span>
<span class="-898041479655512830" onmouseenter="enter('-898041479655512830');" onmouseout="out('-898041479655512830');" style="">  23 import com.dtstack.flink.sql.util.DtStringUtil;                                                          </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  24 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  25 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  26 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  27 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import org.apache.calcite.sql.SqlSelect;                                                                 </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  30 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="-2084905850329493825" onmouseenter="enter('-2084905850329493825');" onmouseout="out('-2084905850329493825');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import org.apache.calcite.config.Lex;                                                                    </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import org.apache.calcite.sql.SqlBasicCall;                                                              </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import org.apache.calcite.sql.SqlJoin;                                                                   </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import org.apache.calcite.sql.SqlKind;                                                                   </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import org.apache.calcite.sql.SqlNode;                                                                   </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  36 =======                                                                                                  </span>
<span class="-2084905850329493825" onmouseenter="enter('-2084905850329493825');" onmouseout="out('-2084905850329493825');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37 import org.apache.calcite.config.Lex;                                                                    </span>
<span class="5169042772451251702" onmouseenter="enter('5169042772451251702');" onmouseout="out('5169042772451251702');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38 import org.apache.calcite.sql.*;                                                                         </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  39 import org.apache.calcite.sql.parser.SqlParseException;                                                  </span>
<span class="1277226550340008522" onmouseenter="enter('1277226550340008522');" onmouseout="out('1277226550340008522');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  40 import org.apache.calcite.sql.parser.SqlParser;                                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  41 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  42 import com.google.common.collect.Lists;                                                                  </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  43 import java.util.List;                                                                                   </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  44 import java.util.regex.Matcher;                                                                          </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  45 import java.util.regex.Pattern;                                                                          </span>
<span  style="">  46                                                                                                          </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  47 import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                 </span>
<span  style="">  48                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  49 /**                                                                                                      </span>
<span class="4193963814460474034" onmouseenter="enter('4193963814460474034');" onmouseout="out('4193963814460474034');" style="">  50  * parser create tmp table sql                                                                           </span>
<span class="7455087124226002233" onmouseenter="enter('7455087124226002233');" onmouseout="out('7455087124226002233');" style="">  51  * Date: 2018/6/26                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  52  * Company: www.dtstack.com                                                                              </span>
<span class="7767094491324231202" onmouseenter="enter('7767094491324231202');" onmouseout="out('7767094491324231202');" style="">  53  * @author yanxi                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  54  */                                                                                                      </span>
<span class="-461613748658336188" onmouseenter="enter('-461613748658336188');" onmouseout="out('-461613748658336188');" style="">  55 public class CreateTmpTableParser implements IParser {                                                   </span>
<span  style="">  56                                                                                                          </span>
<span class="1692280875737006119" onmouseenter="enter('1692280875737006119');" onmouseout="out('1692280875737006119');" style="">  57     //select table tableName as select                                                                   </span>
<span class="-1271293401556749588" onmouseenter="enter('-1271293401556749588');" onmouseout="out('-1271293401556749588');" style="">  58     private static final String PATTERN_STR = &quot;(?i)create\\s+view\\s+([^\\s]+)\\s+as\\s+select\\s+(.*)&quot;; </span>
<span  style="">  59                                                                                                          </span>
<span class="-8315391035218956272" onmouseenter="enter('-8315391035218956272');" onmouseout="out('-8315391035218956272');" style="">  60     private static final String EMPTY_STR = &quot;(?i)^\\screate\\s+view\\s+(\\S+)\\s*\\((.+)\\)$&quot;;           </span>
<span  style="">  61                                                                                                          </span>
<span class="-3672370047386048632" onmouseenter="enter('-3672370047386048632');" onmouseout="out('-3672370047386048632');" style="">  62     private static final Pattern NONEMPTYVIEW = Pattern.compile(PATTERN_STR);                            </span>
<span  style="">  63                                                                                                          </span>
<span class="-1106484013591124828" onmouseenter="enter('-1106484013591124828');" onmouseout="out('-1106484013591124828');" style="">  64     private static final Pattern EMPTYVIEW = Pattern.compile(EMPTY_STR);                                 </span>
<span  style="">  65                                                                                                          </span>
<span class="7449713827178994474" onmouseenter="enter('7449713827178994474');" onmouseout="out('7449713827178994474');" style="">  66     private FlinkPlanner flinkPlanner = new FlinkPlanner();                                              </span>
<span  style="">  67                                                                                                          </span>
<span class="-4276582339515498619" onmouseenter="enter('-4276582339515498619');" onmouseout="out('-4276582339515498619');" style="">  68     public static CreateTmpTableParser newInstance(){                                                    </span>
<span class="47068879565730843" onmouseenter="enter('47068879565730843');" onmouseout="out('47068879565730843');" style="">  69         return new CreateTmpTableParser();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70     }                                                                                                    </span>
<span  style="">  71                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  72     @Override                                                                                            </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  73     public boolean verify(String sql) {                                                                  </span>
<span class="5080351063145353274" onmouseenter="enter('5080351063145353274');" onmouseout="out('5080351063145353274');" style="">  74         if (Pattern.compile(EMPTY_STR).matcher(sql).find()){                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">  75             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76         }                                                                                                </span>
<span class="-4171867442126805233" onmouseenter="enter('-4171867442126805233');" onmouseout="out('-4171867442126805233');" style="">  77         return NONEMPTYVIEW.matcher(sql).find();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  78     }                                                                                                    </span>
<span  style="">  79                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  80     @Override                                                                                            </span>
<span class="2434475561113814770" onmouseenter="enter('2434475561113814770');" onmouseout="out('2434475561113814770');" style="">  81     public void parseSql(String sql, SqlTree sqlTree) {                                                  </span>
<span class="-4232897884938138531" onmouseenter="enter('-4232897884938138531');" onmouseout="out('-4232897884938138531');" style="">  82         if (NONEMPTYVIEW.matcher(sql).find()){                                                           </span>
<span class="4868128867670798292" onmouseenter="enter('4868128867670798292');" onmouseout="out('4868128867670798292');" style="">  83             Matcher matcher = NONEMPTYVIEW.matcher(sql);                                                 </span>
<span class="-2149462964125051477" onmouseenter="enter('-2149462964125051477');" onmouseout="out('-2149462964125051477');" style="">  84             String tableName = null;                                                                     </span>
<span class="1176157296088413911" onmouseenter="enter('1176157296088413911');" onmouseout="out('1176157296088413911');" style="">  85             String selectSql = null;                                                                     </span>
<span class="-635862945794875415" onmouseenter="enter('-635862945794875415');" onmouseout="out('-635862945794875415');" style="">  86             if(matcher.find()) {                                                                         </span>
<span class="-7339253825834236980" onmouseenter="enter('-7339253825834236980');" onmouseout="out('-7339253825834236980');" style="">  87                 tableName = matcher.group(1);                                                            </span>
<span class="5719248077698739274" onmouseenter="enter('5719248077698739274');" onmouseout="out('5719248077698739274');" style="">  88                 selectSql = &quot;select &quot; + matcher.group(2);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89             }                                                                                            </span>
<span  style="">  90                                                                                                          </span>
<span class="-8058108881324857360" onmouseenter="enter('-8058108881324857360');" onmouseout="out('-8058108881324857360');" style="">  91             SqlNode sqlNode = null;                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  92             try {                                                                                        </span>
<span class="-481088827021766876" onmouseenter="enter('-481088827021766876');" onmouseout="out('-481088827021766876');" style="">  93                 sqlNode = flinkPlanner.getParser().parse(selectSql);                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="">  94             } catch (Exception e) {                                                                      </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style="">  95                 throw new RuntimeException(&quot;&quot;, e);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96             }                                                                                            </span>
<span  style="">  97                                                                                                          </span>
<span class="-6794803975475097361" onmouseenter="enter('-6794803975475097361');" onmouseout="out('-6794803975475097361');" style=""><abbr title="  98             CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResult();">  98             CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResul🔵</abbr></span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  99             parseNode(sqlNode, sqlParseResult);                                                          </span>
<span  style=""> 100                                                                                                          </span>
<span class="7413451772740865887" onmouseenter="enter('7413451772740865887');" onmouseout="out('7413451772740865887');" style=""> 101             sqlParseResult.setTableName(tableName);                                                      </span>
<span class="-7952612197475445252" onmouseenter="enter('-7952612197475445252');" onmouseout="out('-7952612197475445252');" style=""> 102             String transformSelectSql = DtStringUtil.replaceIgnoreQuota(sqlNode.toString(), &quot;`&quot;, &quot;&quot;);    </span>
<span class="59678813590501023" onmouseenter="enter('59678813590501023');" onmouseout="out('59678813590501023');" style=""> 103             sqlParseResult.setExecSql(transformSelectSql);                                               </span>
<span class="159740589241090380" onmouseenter="enter('159740589241090380');" onmouseout="out('159740589241090380');" style=""> 104             sqlTree.addTmpSql(sqlParseResult);                                                           </span>
<span class="-4480996658492912084" onmouseenter="enter('-4480996658492912084');" onmouseout="out('-4480996658492912084');" style=""> 105             sqlTree.addTmplTableInfo(tableName, sqlParseResult);                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 106         } else {                                                                                         </span>
<span class="519293395905078156" onmouseenter="enter('519293395905078156');" onmouseout="out('519293395905078156');" style=""> 107             if (EMPTYVIEW.matcher(sql).find())                                                           </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 108             {                                                                                            </span>
<span class="3420445309626970873" onmouseenter="enter('3420445309626970873');" onmouseout="out('3420445309626970873');" style=""> 109                 Matcher matcher = EMPTYVIEW.matcher(sql);                                                </span>
<span class="-2149462964125051477" onmouseenter="enter('-2149462964125051477');" onmouseout="out('-2149462964125051477');" style=""> 110                 String tableName = null;                                                                 </span>
<span class="501566961209766897" onmouseenter="enter('501566961209766897');" onmouseout="out('501566961209766897');" style=""> 111                 String fieldsInfoStr = null;                                                             </span>
<span class="4597453068386605197" onmouseenter="enter('4597453068386605197');" onmouseout="out('4597453068386605197');" style=""> 112                 if (matcher.find()){                                                                     </span>
<span class="-7339253825834236980" onmouseenter="enter('-7339253825834236980');" onmouseout="out('-7339253825834236980');" style=""> 113                     tableName = matcher.group(1);                                                        </span>
<span class="-785282600466434776" onmouseenter="enter('-785282600466434776');" onmouseout="out('-785282600466434776');" style=""> 114                     fieldsInfoStr = matcher.group(2);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115                 }                                                                                        </span>
<span class="-6794803975475097361" onmouseenter="enter('-6794803975475097361');" onmouseout="out('-6794803975475097361');" style=""><abbr title=" 116                 CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResult();"> 116                 CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserR🔵</abbr></span>
<span class="-3545780709276930333" onmouseenter="enter('-3545780709276930333');" onmouseout="out('-3545780709276930333');" style=""> 117                 sqlParseResult.setFieldsInfoStr(fieldsInfoStr);                                          </span>
<span class="7413451772740865887" onmouseenter="enter('7413451772740865887');" onmouseout="out('7413451772740865887');" style=""> 118                 sqlParseResult.setTableName(tableName);                                                  </span>
<span class="-4480996658492912084" onmouseenter="enter('-4480996658492912084');" onmouseout="out('-4480996658492912084');" style=""> 119                 sqlTree.addTmplTableInfo(tableName, sqlParseResult);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120             }                                                                                            </span>
<span  style=""> 121                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122         }                                                                                                </span>
<span  style=""> 123                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 124     }                                                                                                    </span>
<span  style=""> 125                                                                                                          </span>
<span class="-5053657052287600142" onmouseenter="enter('-5053657052287600142');" onmouseout="out('-5053657052287600142');" style=""> 126     private static void parseNode(SqlNode sqlNode, CreateTmpTableParser.SqlParserResult sqlParseResult){ </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 127         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style=""> 128         switch (sqlKind){                                                                                </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 129             case SELECT:                                                                                 </span>
<span class="-737340637367962148" onmouseenter="enter('-737340637367962148');" onmouseout="out('-737340637367962148');" style=""> 130                 SqlNode sqlFrom = ((SqlSelect)sqlNode).getFrom();                                        </span>
<span class="1877498908128044563" onmouseenter="enter('1877498908128044563');" onmouseout="out('1877498908128044563');" style=""> 131                 if(sqlFrom.getKind() == IDENTIFIER){                                                     </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style=""> 132                     sqlParseResult.addSourceTable(sqlFrom.toString());                                   </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 133                 }else{                                                                                   </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style=""> 134                     parseNode(sqlFrom, sqlParseResult);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 136                 break;                                                                                   </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 137             case JOIN:                                                                                   </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 138                 SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                         </span>
<span class="-6247618774659154031" onmouseenter="enter('-6247618774659154031');" onmouseout="out('-6247618774659154031');" style=""> 139                 SqlNode rightNode = ((SqlJoin)sqlNode).getRight();                                       </span>
<span  style=""> 140                                                                                                          </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 141                 if(leftNode.getKind() == IDENTIFIER){                                                    </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 142                     sqlParseResult.addSourceTable(leftNode.toString());                                  </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 143                 }else{                                                                                   </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 144                     parseNode(leftNode, sqlParseResult);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145                 }                                                                                        </span>
<span  style=""> 146                                                                                                          </span>
<span class="-5648840450336709152" onmouseenter="enter('-5648840450336709152');" onmouseout="out('-5648840450336709152');" style=""> 147                 if(rightNode.getKind() == IDENTIFIER){                                                   </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 148                     sqlParseResult.addSourceTable(rightNode.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 149                 }else{                                                                                   </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 150                     parseNode(rightNode, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 152                 break;                                                                                   </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 153             case AS:                                                                                     </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 154                 //不解析column,所以 as 相关的都是表                                                                 </span>
<span class="-5734921612668171253" onmouseenter="enter('-5734921612668171253');" onmouseout="out('-5734921612668171253');" style=""> 155                 SqlNode identifierNode = ((SqlBasicCall)sqlNode).getOperands()[0];                       </span>
<span class="-8687183585810485329" onmouseenter="enter('-8687183585810485329');" onmouseout="out('-8687183585810485329');" style=""> 156                 if(identifierNode.getKind() != IDENTIFIER){                                              </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 157                     parseNode(identifierNode, sqlParseResult);                                           </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 158                 }else {                                                                                  </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 159                     sqlParseResult.addSourceTable(identifierNode.toString());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 160                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 161                 break;                                                                                   </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 162             case UNION:                                                                                  </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 163                 SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                            </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 164                 SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                           </span>
<span class="3779552565426531876" onmouseenter="enter('3779552565426531876');" onmouseout="out('3779552565426531876');" style=""> 165                 if(unionLeft.getKind() == IDENTIFIER){                                                   </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 166                     sqlParseResult.addSourceTable(unionLeft.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 167                 }else{                                                                                   </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 168                     parseNode(unionLeft, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169                 }                                                                                        </span>
<span class="7065528519182980902" onmouseenter="enter('7065528519182980902');" onmouseout="out('7065528519182980902');" style=""> 170                 if(unionRight.getKind() == IDENTIFIER){                                                  </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 171                     sqlParseResult.addSourceTable(unionRight.toString());                                </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 172                 }else{                                                                                   </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 173                     parseNode(unionRight, sqlParseResult);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 175                 break;                                                                                   </span>
<span class="5889755648968358721" onmouseenter="enter('5889755648968358721');" onmouseout="out('5889755648968358721');" style=""> 176             case MATCH_RECOGNIZE:                                                                        </span>
<span class="1373643275810848474" onmouseenter="enter('1373643275810848474');" onmouseout="out('1373643275810848474');" style=""> 177                 SqlMatchRecognize node = (SqlMatchRecognize) sqlNode;                                    </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style=""> 178                 sqlParseResult.addSourceTable(node.getTableRef().toString());                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 179                 break;                                                                                   </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 180             default:                                                                                     </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 181                 //do nothing                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 182                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184     }                                                                                                    </span>
<span  style=""> 185                                                                                                          </span>
<span class="1640675281854442724" onmouseenter="enter('1640675281854442724');" onmouseout="out('1640675281854442724');" style=""> 186     public static class SqlParserResult {                                                                </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style=""> 187         private String tableName;                                                                        </span>
<span  style=""> 188                                                                                                          </span>
<span class="5785294141990237530" onmouseenter="enter('5785294141990237530');" onmouseout="out('5785294141990237530');" style=""> 189         private String fieldsInfoStr;                                                                    </span>
<span  style=""> 190                                                                                                          </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 191         private String execSql;                                                                          </span>
<span  style=""> 192                                                                                                          </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 193         private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                     </span>
<span  style=""> 194                                                                                                          </span>
<span class="5796947355340463495" onmouseenter="enter('5796947355340463495');" onmouseout="out('5796947355340463495');" style=""> 195         public String getTableName() {                                                                   </span>
<span class="7440436830317723056" onmouseenter="enter('7440436830317723056');" onmouseout="out('7440436830317723056');" style=""> 196             return tableName;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197         }                                                                                                </span>
<span  style=""> 198                                                                                                          </span>
<span class="107024788727095650" onmouseenter="enter('107024788727095650');" onmouseout="out('107024788727095650');" style=""> 199         public void setTableName(String tableName) {                                                     </span>
<span class="-2576382372206679378" onmouseenter="enter('-2576382372206679378');" onmouseout="out('-2576382372206679378');" style=""> 200             this.tableName = tableName;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201         }                                                                                                </span>
<span  style=""> 202                                                                                                          </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 203         public String getExecSql() {                                                                     </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 204             return execSql;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205         }                                                                                                </span>
<span  style=""> 206                                                                                                          </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 207         public void setExecSql(String execSql) {                                                         </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 208             this.execSql = execSql;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209         }                                                                                                </span>
<span  style=""> 210                                                                                                          </span>
<span class="-3640570397111550402" onmouseenter="enter('-3640570397111550402');" onmouseout="out('-3640570397111550402');" style=""> 211         public String getFieldsInfoStr() {                                                               </span>
<span class="-6491863098575137699" onmouseenter="enter('-6491863098575137699');" onmouseout="out('-6491863098575137699');" style=""> 212             return fieldsInfoStr;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213         }                                                                                                </span>
<span  style=""> 214                                                                                                          </span>
<span class="-5861241035079497190" onmouseenter="enter('-5861241035079497190');" onmouseout="out('-5861241035079497190');" style=""> 215         public void setFieldsInfoStr(String fieldsInfoStr) {                                             </span>
<span class="-7221077579441258936" onmouseenter="enter('-7221077579441258936');" onmouseout="out('-7221077579441258936');" style=""> 216             this.fieldsInfoStr = fieldsInfoStr;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217         }                                                                                                </span>
<span  style=""> 218                                                                                                          </span>
<span class="5144548036770890441" onmouseenter="enter('5144548036770890441');" onmouseout="out('5144548036770890441');" style=""> 219         public void addSourceTable(String sourceTable){                                                  </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 220             sourceTableList.add(sourceTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221         }                                                                                                </span>
<span  style=""> 222                                                                                                          </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 223         public List&lt;String&gt; getSourceTableList() {                                                       </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 224             return sourceTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 225         }                                                                                                </span>
<span  style=""> 226                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 227     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span  style="">  18                                                                                                          </span>
<span  style="">  19                                                                                                          </span>
<span  style="">  20                                                                                                          </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  21 package com.dtstack.flink.sql.parser;                                                                    </span>
<span  style="">  22                                                                                                          </span>
<span class="-898041479655512830" onmouseenter="enter('-898041479655512830');" onmouseout="out('-898041479655512830');" style="">  23 import com.dtstack.flink.sql.util.DtStringUtil;                                                          </span>
<span class="5169042772451251702" onmouseenter="enter('5169042772451251702');" onmouseout="out('5169042772451251702');" style="">  24 import org.apache.calcite.sql.*;                                                                         </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  25 import com.google.common.collect.Lists;                                                                  </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  26 import java.util.List;                                                                                   </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  27 import java.util.regex.Matcher;                                                                          </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  28 import java.util.regex.Pattern;                                                                          </span>
<span  style="">  29                                                                                                          </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  30 import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                 </span>
<span  style="">  31                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  32 /**                                                                                                      </span>
<span class="4193963814460474034" onmouseenter="enter('4193963814460474034');" onmouseout="out('4193963814460474034');" style="">  33  * parser create tmp table sql                                                                           </span>
<span class="7455087124226002233" onmouseenter="enter('7455087124226002233');" onmouseout="out('7455087124226002233');" style="">  34  * Date: 2018/6/26                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  35  * Company: www.dtstack.com                                                                              </span>
<span class="7767094491324231202" onmouseenter="enter('7767094491324231202');" onmouseout="out('7767094491324231202');" style="">  36  * @author yanxi                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  37  */                                                                                                      </span>
<span class="-461613748658336188" onmouseenter="enter('-461613748658336188');" onmouseout="out('-461613748658336188');" style="">  38 public class CreateTmpTableParser implements IParser {                                                   </span>
<span  style="">  39                                                                                                          </span>
<span class="1692280875737006119" onmouseenter="enter('1692280875737006119');" onmouseout="out('1692280875737006119');" style="">  40     //select table tableName as select                                                                   </span>
<span class="-1271293401556749588" onmouseenter="enter('-1271293401556749588');" onmouseout="out('-1271293401556749588');" style="">  41     private static final String PATTERN_STR = &quot;(?i)create\\s+view\\s+([^\\s]+)\\s+as\\s+select\\s+(.*)&quot;; </span>
<span  style="">  42                                                                                                          </span>
<span class="-8315391035218956272" onmouseenter="enter('-8315391035218956272');" onmouseout="out('-8315391035218956272');" style="">  43     private static final String EMPTY_STR = &quot;(?i)^\\screate\\s+view\\s+(\\S+)\\s*\\((.+)\\)$&quot;;           </span>
<span  style="">  44                                                                                                          </span>
<span class="-3672370047386048632" onmouseenter="enter('-3672370047386048632');" onmouseout="out('-3672370047386048632');" style="">  45     private static final Pattern NONEMPTYVIEW = Pattern.compile(PATTERN_STR);                            </span>
<span  style="">  46                                                                                                          </span>
<span class="-1106484013591124828" onmouseenter="enter('-1106484013591124828');" onmouseout="out('-1106484013591124828');" style="">  47     private static final Pattern EMPTYVIEW = Pattern.compile(EMPTY_STR);                                 </span>
<span  style="">  48                                                                                                          </span>
<span class="7449713827178994474" onmouseenter="enter('7449713827178994474');" onmouseout="out('7449713827178994474');" style="">  49     private FlinkPlanner flinkPlanner = new FlinkPlanner();                                              </span>
<span  style="">  50                                                                                                          </span>
<span class="-4276582339515498619" onmouseenter="enter('-4276582339515498619');" onmouseout="out('-4276582339515498619');" style="">  51     public static CreateTmpTableParser newInstance(){                                                    </span>
<span class="47068879565730843" onmouseenter="enter('47068879565730843');" onmouseout="out('47068879565730843');" style="">  52         return new CreateTmpTableParser();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  53     }                                                                                                    </span>
<span  style="">  54                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  55     @Override                                                                                            </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  56     public boolean verify(String sql) {                                                                  </span>
<span class="5080351063145353274" onmouseenter="enter('5080351063145353274');" onmouseout="out('5080351063145353274');" style="">  57         if (Pattern.compile(EMPTY_STR).matcher(sql).find()){                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">  58             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  59         }                                                                                                </span>
<span class="-4171867442126805233" onmouseenter="enter('-4171867442126805233');" onmouseout="out('-4171867442126805233');" style="">  60         return NONEMPTYVIEW.matcher(sql).find();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  61     }                                                                                                    </span>
<span  style="">  62                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  63     @Override                                                                                            </span>
<span class="2434475561113814770" onmouseenter="enter('2434475561113814770');" onmouseout="out('2434475561113814770');" style="">  64     public void parseSql(String sql, SqlTree sqlTree) {                                                  </span>
<span class="-4232897884938138531" onmouseenter="enter('-4232897884938138531');" onmouseout="out('-4232897884938138531');" style="">  65         if (NONEMPTYVIEW.matcher(sql).find()){                                                           </span>
<span class="4868128867670798292" onmouseenter="enter('4868128867670798292');" onmouseout="out('4868128867670798292');" style="">  66             Matcher matcher = NONEMPTYVIEW.matcher(sql);                                                 </span>
<span class="-2149462964125051477" onmouseenter="enter('-2149462964125051477');" onmouseout="out('-2149462964125051477');" style="">  67             String tableName = null;                                                                     </span>
<span class="1176157296088413911" onmouseenter="enter('1176157296088413911');" onmouseout="out('1176157296088413911');" style="">  68             String selectSql = null;                                                                     </span>
<span class="-635862945794875415" onmouseenter="enter('-635862945794875415');" onmouseout="out('-635862945794875415');" style="">  69             if(matcher.find()) {                                                                         </span>
<span class="-7339253825834236980" onmouseenter="enter('-7339253825834236980');" onmouseout="out('-7339253825834236980');" style="">  70                 tableName = matcher.group(1);                                                            </span>
<span class="5719248077698739274" onmouseenter="enter('5719248077698739274');" onmouseout="out('5719248077698739274');" style="">  71                 selectSql = &quot;select &quot; + matcher.group(2);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  72             }                                                                                            </span>
<span  style="">  73                                                                                                          </span>
<span class="-8058108881324857360" onmouseenter="enter('-8058108881324857360');" onmouseout="out('-8058108881324857360');" style="">  74             SqlNode sqlNode = null;                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  75             try {                                                                                        </span>
<span class="-481088827021766876" onmouseenter="enter('-481088827021766876');" onmouseout="out('-481088827021766876');" style="">  76                 sqlNode = flinkPlanner.getParser().parse(selectSql);                                     </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="">  77             } catch (Exception e) {                                                                      </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style="">  78                 throw new RuntimeException(&quot;&quot;, e);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  79             }                                                                                            </span>
<span  style="">  80                                                                                                          </span>
<span class="-6794803975475097361" onmouseenter="enter('-6794803975475097361');" onmouseout="out('-6794803975475097361');" style=""><abbr title="  81             CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResult();">  81             CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResul🔵</abbr></span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  82             parseNode(sqlNode, sqlParseResult);                                                          </span>
<span  style="">  83                                                                                                          </span>
<span class="7413451772740865887" onmouseenter="enter('7413451772740865887');" onmouseout="out('7413451772740865887');" style="">  84             sqlParseResult.setTableName(tableName);                                                      </span>
<span class="-7952612197475445252" onmouseenter="enter('-7952612197475445252');" onmouseout="out('-7952612197475445252');" style="">  85             String transformSelectSql = DtStringUtil.replaceIgnoreQuota(sqlNode.toString(), &quot;`&quot;, &quot;&quot;);    </span>
<span class="59678813590501023" onmouseenter="enter('59678813590501023');" onmouseout="out('59678813590501023');" style="">  86             sqlParseResult.setExecSql(transformSelectSql);                                               </span>
<span class="159740589241090380" onmouseenter="enter('159740589241090380');" onmouseout="out('159740589241090380');" style="">  87             sqlTree.addTmpSql(sqlParseResult);                                                           </span>
<span class="-4480996658492912084" onmouseenter="enter('-4480996658492912084');" onmouseout="out('-4480996658492912084');" style="">  88             sqlTree.addTmplTableInfo(tableName, sqlParseResult);                                         </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  89         } else {                                                                                         </span>
<span class="519293395905078156" onmouseenter="enter('519293395905078156');" onmouseout="out('519293395905078156');" style="">  90             if (EMPTYVIEW.matcher(sql).find())                                                           </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style="">  91             {                                                                                            </span>
<span class="3420445309626970873" onmouseenter="enter('3420445309626970873');" onmouseout="out('3420445309626970873');" style="">  92                 Matcher matcher = EMPTYVIEW.matcher(sql);                                                </span>
<span class="-2149462964125051477" onmouseenter="enter('-2149462964125051477');" onmouseout="out('-2149462964125051477');" style="">  93                 String tableName = null;                                                                 </span>
<span class="501566961209766897" onmouseenter="enter('501566961209766897');" onmouseout="out('501566961209766897');" style="">  94                 String fieldsInfoStr = null;                                                             </span>
<span class="4597453068386605197" onmouseenter="enter('4597453068386605197');" onmouseout="out('4597453068386605197');" style="">  95                 if (matcher.find()){                                                                     </span>
<span class="-7339253825834236980" onmouseenter="enter('-7339253825834236980');" onmouseout="out('-7339253825834236980');" style="">  96                     tableName = matcher.group(1);                                                        </span>
<span class="-785282600466434776" onmouseenter="enter('-785282600466434776');" onmouseout="out('-785282600466434776');" style="">  97                     fieldsInfoStr = matcher.group(2);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98                 }                                                                                        </span>
<span class="-6794803975475097361" onmouseenter="enter('-6794803975475097361');" onmouseout="out('-6794803975475097361');" style=""><abbr title="  99                 CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResult();">  99                 CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserR🔵</abbr></span>
<span class="-3545780709276930333" onmouseenter="enter('-3545780709276930333');" onmouseout="out('-3545780709276930333');" style=""> 100                 sqlParseResult.setFieldsInfoStr(fieldsInfoStr);                                          </span>
<span class="7413451772740865887" onmouseenter="enter('7413451772740865887');" onmouseout="out('7413451772740865887');" style=""> 101                 sqlParseResult.setTableName(tableName);                                                  </span>
<span class="-4480996658492912084" onmouseenter="enter('-4480996658492912084');" onmouseout="out('-4480996658492912084');" style=""> 102                 sqlTree.addTmplTableInfo(tableName, sqlParseResult);                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103             }                                                                                            </span>
<span  style=""> 104                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105         }                                                                                                </span>
<span  style=""> 106                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107     }                                                                                                    </span>
<span  style=""> 108                                                                                                          </span>
<span class="-5053657052287600142" onmouseenter="enter('-5053657052287600142');" onmouseout="out('-5053657052287600142');" style=""> 109     private static void parseNode(SqlNode sqlNode, CreateTmpTableParser.SqlParserResult sqlParseResult){ </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 110         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style=""> 111         switch (sqlKind){                                                                                </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 112             case SELECT:                                                                                 </span>
<span class="-737340637367962148" onmouseenter="enter('-737340637367962148');" onmouseout="out('-737340637367962148');" style=""> 113                 SqlNode sqlFrom = ((SqlSelect)sqlNode).getFrom();                                        </span>
<span class="1877498908128044563" onmouseenter="enter('1877498908128044563');" onmouseout="out('1877498908128044563');" style=""> 114                 if(sqlFrom.getKind() == IDENTIFIER){                                                     </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style=""> 115                     sqlParseResult.addSourceTable(sqlFrom.toString());                                   </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 116                 }else{                                                                                   </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style=""> 117                     parseNode(sqlFrom, sqlParseResult);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 119                 break;                                                                                   </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 120             case JOIN:                                                                                   </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 121                 SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                         </span>
<span class="-6247618774659154031" onmouseenter="enter('-6247618774659154031');" onmouseout="out('-6247618774659154031');" style=""> 122                 SqlNode rightNode = ((SqlJoin)sqlNode).getRight();                                       </span>
<span  style=""> 123                                                                                                          </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 124                 if(leftNode.getKind() == IDENTIFIER){                                                    </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 125                     sqlParseResult.addSourceTable(leftNode.toString());                                  </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 126                 }else{                                                                                   </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 127                     parseNode(leftNode, sqlParseResult);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128                 }                                                                                        </span>
<span  style=""> 129                                                                                                          </span>
<span class="-5648840450336709152" onmouseenter="enter('-5648840450336709152');" onmouseout="out('-5648840450336709152');" style=""> 130                 if(rightNode.getKind() == IDENTIFIER){                                                   </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 131                     sqlParseResult.addSourceTable(rightNode.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 132                 }else{                                                                                   </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 133                     parseNode(rightNode, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 135                 break;                                                                                   </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 136             case AS:                                                                                     </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 137                 //不解析column,所以 as 相关的都是表                                                                 </span>
<span class="-5734921612668171253" onmouseenter="enter('-5734921612668171253');" onmouseout="out('-5734921612668171253');" style=""> 138                 SqlNode identifierNode = ((SqlBasicCall)sqlNode).getOperands()[0];                       </span>
<span class="-8687183585810485329" onmouseenter="enter('-8687183585810485329');" onmouseout="out('-8687183585810485329');" style=""> 139                 if(identifierNode.getKind() != IDENTIFIER){                                              </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 140                     parseNode(identifierNode, sqlParseResult);                                           </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 141                 }else {                                                                                  </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 142                     sqlParseResult.addSourceTable(identifierNode.toString());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 144                 break;                                                                                   </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 145             case UNION:                                                                                  </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 146                 SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                            </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 147                 SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                           </span>
<span class="3779552565426531876" onmouseenter="enter('3779552565426531876');" onmouseout="out('3779552565426531876');" style=""> 148                 if(unionLeft.getKind() == IDENTIFIER){                                                   </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 149                     sqlParseResult.addSourceTable(unionLeft.toString());                                 </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 150                 }else{                                                                                   </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 151                     parseNode(unionLeft, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152                 }                                                                                        </span>
<span class="7065528519182980902" onmouseenter="enter('7065528519182980902');" onmouseout="out('7065528519182980902');" style=""> 153                 if(unionRight.getKind() == IDENTIFIER){                                                  </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 154                     sqlParseResult.addSourceTable(unionRight.toString());                                </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 155                 }else{                                                                                   </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 156                     parseNode(unionRight, sqlParseResult);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 157                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 158                 break;                                                                                   </span>
<span class="5889755648968358721" onmouseenter="enter('5889755648968358721');" onmouseout="out('5889755648968358721');" style=""> 159             case MATCH_RECOGNIZE:                                                                        </span>
<span class="1373643275810848474" onmouseenter="enter('1373643275810848474');" onmouseout="out('1373643275810848474');" style=""> 160                 SqlMatchRecognize node = (SqlMatchRecognize) sqlNode;                                    </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style=""> 161                 sqlParseResult.addSourceTable(node.getTableRef().toString());                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 162                 break;                                                                                   </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 163             default:                                                                                     </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 164                 //do nothing                                                                             </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 165                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167     }                                                                                                    </span>
<span  style=""> 168                                                                                                          </span>
<span class="1640675281854442724" onmouseenter="enter('1640675281854442724');" onmouseout="out('1640675281854442724');" style=""> 169     public static class SqlParserResult {                                                                </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style=""> 170         private String tableName;                                                                        </span>
<span  style=""> 171                                                                                                          </span>
<span class="5785294141990237530" onmouseenter="enter('5785294141990237530');" onmouseout="out('5785294141990237530');" style=""> 172         private String fieldsInfoStr;                                                                    </span>
<span  style=""> 173                                                                                                          </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 174         private String execSql;                                                                          </span>
<span  style=""> 175                                                                                                          </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 176         private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                     </span>
<span  style=""> 177                                                                                                          </span>
<span class="5796947355340463495" onmouseenter="enter('5796947355340463495');" onmouseout="out('5796947355340463495');" style=""> 178         public String getTableName() {                                                                   </span>
<span class="7440436830317723056" onmouseenter="enter('7440436830317723056');" onmouseout="out('7440436830317723056');" style=""> 179             return tableName;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180         }                                                                                                </span>
<span  style=""> 181                                                                                                          </span>
<span class="107024788727095650" onmouseenter="enter('107024788727095650');" onmouseout="out('107024788727095650');" style=""> 182         public void setTableName(String tableName) {                                                     </span>
<span class="-2576382372206679378" onmouseenter="enter('-2576382372206679378');" onmouseout="out('-2576382372206679378');" style=""> 183             this.tableName = tableName;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184         }                                                                                                </span>
<span  style=""> 185                                                                                                          </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 186         public String getExecSql() {                                                                     </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 187             return execSql;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 188         }                                                                                                </span>
<span  style=""> 189                                                                                                          </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 190         public void setExecSql(String execSql) {                                                         </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 191             this.execSql = execSql;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192         }                                                                                                </span>
<span  style=""> 193                                                                                                          </span>
<span class="-3640570397111550402" onmouseenter="enter('-3640570397111550402');" onmouseout="out('-3640570397111550402');" style=""> 194         public String getFieldsInfoStr() {                                                               </span>
<span class="-6491863098575137699" onmouseenter="enter('-6491863098575137699');" onmouseout="out('-6491863098575137699');" style=""> 195             return fieldsInfoStr;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196         }                                                                                                </span>
<span  style=""> 197                                                                                                          </span>
<span class="-5861241035079497190" onmouseenter="enter('-5861241035079497190');" onmouseout="out('-5861241035079497190');" style=""> 198         public void setFieldsInfoStr(String fieldsInfoStr) {                                             </span>
<span class="-7221077579441258936" onmouseenter="enter('-7221077579441258936');" onmouseout="out('-7221077579441258936');" style=""> 199             this.fieldsInfoStr = fieldsInfoStr;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 200         }                                                                                                </span>
<span  style=""> 201                                                                                                          </span>
<span class="5144548036770890441" onmouseenter="enter('5144548036770890441');" onmouseout="out('5144548036770890441');" style=""> 202         public void addSourceTable(String sourceTable){                                                  </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 203             sourceTableList.add(sourceTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204         }                                                                                                </span>
<span  style=""> 205                                                                                                          </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 206         public List&lt;String&gt; getSourceTableList() {                                                       </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 207             return sourceTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208         }                                                                                                </span>
<span  style=""> 209                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211 }                                                                                                        </span>















</pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2  * Licensed to the Apache Software Foundation (ASF) under one                                            </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3  * or more contributor license agreements.  See the NOTICE file                                          </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4  * distributed with this work for additional information                                                 </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5  * regarding copyright ownership.  The ASF licenses this file                                            </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6  * to you under the Apache License, Version 2.0 (the                                                     </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7  * &quot;License&quot;); you may not use this file except in compliance                                            </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8  * with the License.  You may obtain a copy of the License at                                            </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10  *     http://www.apache.org/licenses/LICENSE-2.0                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17  */                                                                                                      </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  18 package com.dtstack.flink.sql.parser;                                                                    </span>
<span  style="">  19                                                                                                          </span>
<span class="-898041479655512830" onmouseenter="enter('-898041479655512830');" onmouseout="out('-898041479655512830');" style="">  20 import com.dtstack.flink.sql.util.DtStringUtil;                                                          </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  21 import com.google.common.collect.Lists;                                                                  </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  22 import java.util.List;                                                                                   </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  23 import java.util.regex.Matcher;                                                                          </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  24 import java.util.regex.Pattern;                                                                          </span>
<span class="5169042772451251702" onmouseenter="enter('5169042772451251702');" onmouseout="out('5169042772451251702');" style="">  25 import org.apache.calcite.sql.*;                                                                         </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  26 import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                 </span>
<span  style="">  27                                                                                                          </span>
<span  style="">  28                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  29 /**                                                                                                      </span>
<span class="4193963814460474034" onmouseenter="enter('4193963814460474034');" onmouseout="out('4193963814460474034');" style="">  30  * parser create tmp table sql                                                                           </span>
<span class="7455087124226002233" onmouseenter="enter('7455087124226002233');" onmouseout="out('7455087124226002233');" style="">  31  * Date: 2018/6/26                                                                                       </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  32  * Company: www.dtstack.com                                                                              </span>
<span class="7767094491324231202" onmouseenter="enter('7767094491324231202');" onmouseout="out('7767094491324231202');" style="">  33  * @author yanxi                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  34  */                                                                                                      </span>
<span class="-461613748658336188" onmouseenter="enter('-461613748658336188');" onmouseout="out('-461613748658336188');" style="">  35 public class CreateTmpTableParser implements IParser {                                                   </span>
<span class="1692280875737006119" onmouseenter="enter('1692280875737006119');" onmouseout="out('1692280875737006119');" style="">  36     //select table tableName as select                                                                   </span>
<span class="1692280875737006119" onmouseenter="enter('1692280875737006119');" onmouseout="out('1692280875737006119');" style="">  37     //select table tableName as select                                                                   </span>
<span class="-1271293401556749588" onmouseenter="enter('-1271293401556749588');" onmouseout="out('-1271293401556749588');" style="">  38     private static final String PATTERN_STR = &quot;(?i)create\\s+view\\s+([^\\s]+)\\s+as\\s+select\\s+(.*)&quot;; </span>
<span  style="">  39                                                                                                          </span>
<span class="-8315391035218956272" onmouseenter="enter('-8315391035218956272');" onmouseout="out('-8315391035218956272');" style="">  40     private static final String EMPTY_STR = &quot;(?i)^\\screate\\s+view\\s+(\\S+)\\s*\\((.+)\\)$&quot;;           </span>
<span  style="">  41                                                                                                          </span>
<span class="-3672370047386048632" onmouseenter="enter('-3672370047386048632');" onmouseout="out('-3672370047386048632');" style="">  42     private static final Pattern NONEMPTYVIEW = Pattern.compile(PATTERN_STR);                            </span>
<span  style="">  43                                                                                                          </span>
<span class="-1106484013591124828" onmouseenter="enter('-1106484013591124828');" onmouseout="out('-1106484013591124828');" style="">  44     private static final Pattern EMPTYVIEW = Pattern.compile(EMPTY_STR);                                 </span>
<span  style="">  45                                                                                                          </span>
<span class="7449713827178994474" onmouseenter="enter('7449713827178994474');" onmouseout="out('7449713827178994474');" style="">  46     private FlinkPlanner flinkPlanner = new FlinkPlanner();                                              </span>
<span  style="">  47                                                                                                          </span>
<span class="-4276582339515498619" onmouseenter="enter('-4276582339515498619');" onmouseout="out('-4276582339515498619');" style="">  48     public static CreateTmpTableParser newInstance(){                                                    </span>
<span class="47068879565730843" onmouseenter="enter('47068879565730843');" onmouseout="out('47068879565730843');" style="">  49         return new CreateTmpTableParser();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  50     }                                                                                                    </span>
<span  style="">  51                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  52     @Override                                                                                            </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  53     public boolean verify(String sql) {                                                                  </span>
<span class="5080351063145353274" onmouseenter="enter('5080351063145353274');" onmouseout="out('5080351063145353274');" style="">  54         if (Pattern.compile(EMPTY_STR).matcher(sql).find()){                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">  55             return true;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  56         }                                                                                                </span>
<span class="-4171867442126805233" onmouseenter="enter('-4171867442126805233');" onmouseout="out('-4171867442126805233');" style="">  57         return NONEMPTYVIEW.matcher(sql).find();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  58     }                                                                                                    </span>
<span  style="">  59                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  60     @Override                                                                                            </span>
<span class="2434475561113814770" onmouseenter="enter('2434475561113814770');" onmouseout="out('2434475561113814770');" style="">  61     public void parseSql(String sql, SqlTree sqlTree) {                                                  </span>
<span class="2275566106842793481" onmouseenter="enter('2275566106842793481');" onmouseout="out('2275566106842793481');" style="">  62         if (NONEMPTYVIEW.matcher(sql).find()) {                                                          </span>
<span class="4868128867670798292" onmouseenter="enter('4868128867670798292');" onmouseout="out('4868128867670798292');" style="">  63             Matcher matcher = NONEMPTYVIEW.matcher(sql);                                                 </span>
<span class="-2149462964125051477" onmouseenter="enter('-2149462964125051477');" onmouseout="out('-2149462964125051477');" style="">  64             String tableName = null;                                                                     </span>
<span class="1176157296088413911" onmouseenter="enter('1176157296088413911');" onmouseout="out('1176157296088413911');" style="">  65             String selectSql = null;                                                                     </span>
<span class="3484832867986496608" onmouseenter="enter('3484832867986496608');" onmouseout="out('3484832867986496608');" style="">  66             if (matcher.find()) {                                                                        </span>
<span class="-7339253825834236980" onmouseenter="enter('-7339253825834236980');" onmouseout="out('-7339253825834236980');" style="">  67                 tableName = matcher.group(1);                                                            </span>
<span class="5719248077698739274" onmouseenter="enter('5719248077698739274');" onmouseout="out('5719248077698739274');" style="">  68                 selectSql = &quot;select &quot; + matcher.group(2);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69             }                                                                                            </span>
<span class="-8058108881324857360" onmouseenter="enter('-8058108881324857360');" onmouseout="out('-8058108881324857360');" style="">  70             SqlNode sqlNode = null;                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  71             try {                                                                                        </span>
<span class="-481088827021766876" onmouseenter="enter('-481088827021766876');" onmouseout="out('-481088827021766876');" style="">  72                 sqlNode = flinkPlanner.getParser().parse(selectSql);                                     </span>
<span class="-3589222456918676513" onmouseenter="enter('-3589222456918676513');" onmouseout="out('-3589222456918676513');" style="">  73             } catch (java.lang.Exception e) {                                                            </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style="">  74                 throw new RuntimeException(&quot;&quot;, e);                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75             }                                                                                            </span>
<span class="-6794803975475097361" onmouseenter="enter('-6794803975475097361');" onmouseout="out('-6794803975475097361');" style=""><abbr title="  76             CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResult();">  76             CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResul🔵</abbr></span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  77             parseNode(sqlNode, sqlParseResult);                                                          </span>
<span class="7413451772740865887" onmouseenter="enter('7413451772740865887');" onmouseout="out('7413451772740865887');" style="">  78             sqlParseResult.setTableName(tableName);                                                      </span>
<span class="-7952612197475445252" onmouseenter="enter('-7952612197475445252');" onmouseout="out('-7952612197475445252');" style="">  79             String transformSelectSql = DtStringUtil.replaceIgnoreQuota(sqlNode.toString(), &quot;`&quot;, &quot;&quot;);    </span>
<span class="59678813590501023" onmouseenter="enter('59678813590501023');" onmouseout="out('59678813590501023');" style="">  80             sqlParseResult.setExecSql(transformSelectSql);                                               </span>
<span class="159740589241090380" onmouseenter="enter('159740589241090380');" onmouseout="out('159740589241090380');" style="">  81             sqlTree.addTmpSql(sqlParseResult);                                                           </span>
<span class="-4480996658492912084" onmouseenter="enter('-4480996658492912084');" onmouseout="out('-4480996658492912084');" style="">  82             sqlTree.addTmplTableInfo(tableName, sqlParseResult);                                         </span>
<span class="7054274962401346923" onmouseenter="enter('7054274962401346923');" onmouseout="out('7054274962401346923');" style="">  83         } else if (EMPTYVIEW.matcher(sql).find()) {                                                      </span>
<span class="3420445309626970873" onmouseenter="enter('3420445309626970873');" onmouseout="out('3420445309626970873');" style="">  84             Matcher matcher = EMPTYVIEW.matcher(sql);                                                    </span>
<span class="-2149462964125051477" onmouseenter="enter('-2149462964125051477');" onmouseout="out('-2149462964125051477');" style="">  85             String tableName = null;                                                                     </span>
<span class="501566961209766897" onmouseenter="enter('501566961209766897');" onmouseout="out('501566961209766897');" style="">  86             String fieldsInfoStr = null;                                                                 </span>
<span class="3484832867986496608" onmouseenter="enter('3484832867986496608');" onmouseout="out('3484832867986496608');" style="">  87             if (matcher.find()) {                                                                        </span>
<span class="-7339253825834236980" onmouseenter="enter('-7339253825834236980');" onmouseout="out('-7339253825834236980');" style="">  88                 tableName = matcher.group(1);                                                            </span>
<span class="-785282600466434776" onmouseenter="enter('-785282600466434776');" onmouseout="out('-785282600466434776');" style="">  89                 fieldsInfoStr = matcher.group(2);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90             }                                                                                            </span>
<span class="-6794803975475097361" onmouseenter="enter('-6794803975475097361');" onmouseout="out('-6794803975475097361');" style=""><abbr title="  91             CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResult();">  91             CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResul🔵</abbr></span>
<span class="-3545780709276930333" onmouseenter="enter('-3545780709276930333');" onmouseout="out('-3545780709276930333');" style="">  92             sqlParseResult.setFieldsInfoStr(fieldsInfoStr);                                              </span>
<span class="7413451772740865887" onmouseenter="enter('7413451772740865887');" onmouseout="out('7413451772740865887');" style="">  93             sqlParseResult.setTableName(tableName);                                                      </span>
<span class="-4480996658492912084" onmouseenter="enter('-4480996658492912084');" onmouseout="out('-4480996658492912084');" style="">  94             sqlTree.addTmplTableInfo(tableName, sqlParseResult);                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  95         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  96     }                                                                                                    </span>
<span  style="">  97                                                                                                          </span>
<span class="-3235421367697124954" onmouseenter="enter('-3235421367697124954');" onmouseout="out('-3235421367697124954');" style="">  98     private static void parseNode(SqlNode sqlNode, CreateTmpTableParser.SqlParserResult sqlParseResult) {</span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style="">  99         SqlKind sqlKind = sqlNode.getKind();                                                             </span>
<span class="6693906737523976420" onmouseenter="enter('6693906737523976420');" onmouseout="out('6693906737523976420');" style=""> 100         switch (sqlKind) {                                                                               </span>
<span class="-3198951126756304146" onmouseenter="enter('-3198951126756304146');" onmouseout="out('-3198951126756304146');" style=""> 101             case SELECT :                                                                                </span>
<span class="-1459310299914917625" onmouseenter="enter('-1459310299914917625');" onmouseout="out('-1459310299914917625');" style=""> 102                 SqlNode sqlFrom = ((SqlSelect) (sqlNode)).getFrom();                                     </span>
<span class="6191253572730585832" onmouseenter="enter('6191253572730585832');" onmouseout="out('6191253572730585832');" style=""> 103                 if (sqlFrom.getKind() == IDENTIFIER) {                                                   </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style=""> 104                     sqlParseResult.addSourceTable(sqlFrom.toString());                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 105                 } else {                                                                                 </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style=""> 106                     parseNode(sqlFrom, sqlParseResult);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 108                 break;                                                                                   </span>
<span class="-6812790603264225102" onmouseenter="enter('-6812790603264225102');" onmouseout="out('-6812790603264225102');" style=""> 109             case JOIN :                                                                                  </span>
<span class="-4395251305376668835" onmouseenter="enter('-4395251305376668835');" onmouseout="out('-4395251305376668835');" style=""> 110                 SqlNode leftNode = ((SqlJoin) (sqlNode)).getLeft();                                      </span>
<span class="8050631472929284299" onmouseenter="enter('8050631472929284299');" onmouseout="out('8050631472929284299');" style=""> 111                 SqlNode rightNode = ((SqlJoin) (sqlNode)).getRight();                                    </span>
<span class="-7068116128484836160" onmouseenter="enter('-7068116128484836160');" onmouseout="out('-7068116128484836160');" style=""> 112                 if (leftNode.getKind() == IDENTIFIER) {                                                  </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 113                     sqlParseResult.addSourceTable(leftNode.toString());                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 114                 } else {                                                                                 </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 115                     parseNode(leftNode, sqlParseResult);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116                 }                                                                                        </span>
<span class="3756007340939565225" onmouseenter="enter('3756007340939565225');" onmouseout="out('3756007340939565225');" style=""> 117                 if (rightNode.getKind() == IDENTIFIER) {                                                 </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 118                     sqlParseResult.addSourceTable(rightNode.toString());                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 119                 } else {                                                                                 </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 120                     parseNode(rightNode, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 122                 break;                                                                                   </span>
<span class="-7603101237578294688" onmouseenter="enter('-7603101237578294688');" onmouseout="out('-7603101237578294688');" style=""> 123             case AS :                                                                                    </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 124                 //不解析column,所以 as 相关的都是表                                                                 </span>
<span class="-570332885351525475" onmouseenter="enter('-570332885351525475');" onmouseout="out('-570332885351525475');" style=""> 125                 SqlNode identifierNode = ((SqlBasicCall) (sqlNode)).getOperands()[0];                    </span>
<span class="-4220098490622996269" onmouseenter="enter('-4220098490622996269');" onmouseout="out('-4220098490622996269');" style=""> 126                 if (identifierNode.getKind() != IDENTIFIER) {                                            </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 127                     parseNode(identifierNode, sqlParseResult);                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 128                 } else {                                                                                 </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 129                     sqlParseResult.addSourceTable(identifierNode.toString());                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 130                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 131                 break;                                                                                   </span>
<span class="1238941309895419592" onmouseenter="enter('1238941309895419592');" onmouseout="out('1238941309895419592');" style=""> 132             case UNION :                                                                                 </span>
<span class="3847221911167009847" onmouseenter="enter('3847221911167009847');" onmouseout="out('3847221911167009847');" style=""> 133                 SqlNode unionLeft = ((SqlBasicCall) (sqlNode)).getOperands()[0];                         </span>
<span class="-4021192438573809697" onmouseenter="enter('-4021192438573809697');" onmouseout="out('-4021192438573809697');" style=""> 134                 SqlNode unionRight = ((SqlBasicCall) (sqlNode)).getOperands()[1];                        </span>
<span class="1880013034228131218" onmouseenter="enter('1880013034228131218');" onmouseout="out('1880013034228131218');" style=""> 135                 if (unionLeft.getKind() == IDENTIFIER) {                                                 </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 136                     sqlParseResult.addSourceTable(unionLeft.toString());                                 </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 137                 } else {                                                                                 </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 138                     parseNode(unionLeft, sqlParseResult);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139                 }                                                                                        </span>
<span class="25238980504787842" onmouseenter="enter('25238980504787842');" onmouseout="out('25238980504787842');" style=""> 140                 if (unionRight.getKind() == IDENTIFIER) {                                                </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 141                     sqlParseResult.addSourceTable(unionRight.toString());                                </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 142                 } else {                                                                                 </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 143                     parseNode(unionRight, sqlParseResult);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 144                 }                                                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 145                 break;                                                                                   </span>
<span class="4847728785269382503" onmouseenter="enter('4847728785269382503');" onmouseout="out('4847728785269382503');" style=""> 146             case MATCH_RECOGNIZE :                                                                       </span>
<span class="6938719457719113840" onmouseenter="enter('6938719457719113840');" onmouseout="out('6938719457719113840');" style=""> 147                 SqlMatchRecognize node = ((SqlMatchRecognize) (sqlNode));                                </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style=""> 148                 sqlParseResult.addSourceTable(node.getTableRef().toString());                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 149                 break;                                                                                   </span>
<span class="3050734735710613783" onmouseenter="enter('3050734735710613783');" onmouseout="out('3050734735710613783');" style=""> 150             default :                                                                                    </span>
<span class="-6802310387761368139" onmouseenter="enter('-6802310387761368139');" onmouseout="out('-6802310387761368139');" style=""> 151                 // do nothing                                                                            </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 152                 break;                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span class="1640675281854442724" onmouseenter="enter('1640675281854442724');" onmouseout="out('1640675281854442724');" style=""> 156     public static class SqlParserResult {                                                                </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style=""> 157         private String tableName;                                                                        </span>
<span  style=""> 158                                                                                                          </span>
<span class="5785294141990237530" onmouseenter="enter('5785294141990237530');" onmouseout="out('5785294141990237530');" style=""> 159         private String fieldsInfoStr;                                                                    </span>
<span  style=""> 160                                                                                                          </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 161         private String execSql;                                                                          </span>
<span  style=""> 162                                                                                                          </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 163         private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                     </span>
<span  style=""> 164                                                                                                          </span>
<span class="5796947355340463495" onmouseenter="enter('5796947355340463495');" onmouseout="out('5796947355340463495');" style=""> 165         public String getTableName() {                                                                   </span>
<span class="7440436830317723056" onmouseenter="enter('7440436830317723056');" onmouseout="out('7440436830317723056');" style=""> 166             return tableName;                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167         }                                                                                                </span>
<span  style=""> 168                                                                                                          </span>
<span class="107024788727095650" onmouseenter="enter('107024788727095650');" onmouseout="out('107024788727095650');" style=""> 169         public void setTableName(String tableName) {                                                     </span>
<span class="-2576382372206679378" onmouseenter="enter('-2576382372206679378');" onmouseout="out('-2576382372206679378');" style=""> 170             this.tableName = tableName;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171         }                                                                                                </span>
<span  style=""> 172                                                                                                          </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 173         public String getExecSql() {                                                                     </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 174             return execSql;                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175         }                                                                                                </span>
<span  style=""> 176                                                                                                          </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 177         public void setExecSql(String execSql) {                                                         </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 178             this.execSql = execSql;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 179         }                                                                                                </span>
<span  style=""> 180                                                                                                          </span>
<span class="-3640570397111550402" onmouseenter="enter('-3640570397111550402');" onmouseout="out('-3640570397111550402');" style=""> 181         public String getFieldsInfoStr() {                                                               </span>
<span class="-6491863098575137699" onmouseenter="enter('-6491863098575137699');" onmouseout="out('-6491863098575137699');" style=""> 182             return fieldsInfoStr;                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183         }                                                                                                </span>
<span  style=""> 184                                                                                                          </span>
<span class="-5861241035079497190" onmouseenter="enter('-5861241035079497190');" onmouseout="out('-5861241035079497190');" style=""> 185         public void setFieldsInfoStr(String fieldsInfoStr) {                                             </span>
<span class="-7221077579441258936" onmouseenter="enter('-7221077579441258936');" onmouseout="out('-7221077579441258936');" style=""> 186             this.fieldsInfoStr = fieldsInfoStr;                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187         }                                                                                                </span>
<span  style=""> 188                                                                                                          </span>
<span class="-2198483008967905672" onmouseenter="enter('-2198483008967905672');" onmouseout="out('-2198483008967905672');" style=""> 189         public void addSourceTable(String sourceTable) {                                                 </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 190             sourceTableList.add(sourceTable);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191         }                                                                                                </span>
<span  style=""> 192                                                                                                          </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 193         public List&lt;String&gt; getSourceTableList() {                                                       </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 194             return sourceTableList;                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197 }                                                                                                        </span>





























</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="">  20                                                                                                                    </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  21  package com.dtstack.flink.sql.parser;                                                                             </span>
<span  style="">  22                                                                                                                    </span>
<span class="-898041479655512830" onmouseenter="enter('-898041479655512830');" onmouseout="out('-898041479655512830');" style="">  23  import com.dtstack.flink.sql.util.DtStringUtil;                                                                   </span>
<span class="-2084905850329493825" onmouseenter="enter('-2084905850329493825');" onmouseout="out('-2084905850329493825');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  24 -import org.apache.calcite.config.Lex;                                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="">  25  import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="">  26  import org.apache.calcite.sql.SqlJoin;                                                                            </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="">  27  import org.apache.calcite.sql.SqlKind;                                                                            </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="">  28  import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="">  29  import org.apache.calcite.sql.SqlSelect;                                                                          </span>

<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  30 -import org.apache.calcite.sql.parser.SqlParseException;                                                           </span>
<span class="1277226550340008522" onmouseenter="enter('1277226550340008522');" onmouseout="out('1277226550340008522');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  31 -import org.apache.calcite.sql.parser.SqlParser;                                                                   </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  32  import com.google.common.collect.Lists;                                                                           </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  33 -import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                           </span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  34 -                                                                                                                  </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  35  import java.util.List;                                                                                            </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  36  import java.util.regex.Matcher;                                                                                   </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  37  import java.util.regex.Pattern;                                                                                   </span>
<span  style="">  38                                                                                                                    </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  39  import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                          </span>
<span  style="">  40                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  41  /**                                                                                                               </span>
<span class="4193963814460474034" onmouseenter="enter('4193963814460474034');" onmouseout="out('4193963814460474034');" style="">  42   * parser create tmp table sql                                                                                    </span>
<span class="7455087124226002233" onmouseenter="enter('7455087124226002233');" onmouseout="out('7455087124226002233');" style="">  43   * Date: 2018/6/26                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  44   * Company: www.dtstack.com                                                                                       </span>
<span class="7767094491324231202" onmouseenter="enter('7767094491324231202');" onmouseout="out('7767094491324231202');" style="">  45   * @author yanxi                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  46   */                                                                                                               </span>
<span class="-461613748658336188" onmouseenter="enter('-461613748658336188');" onmouseout="out('-461613748658336188');" style="">  47  public class CreateTmpTableParser implements IParser {                                                            </span>
<span  style="">  48                                                                                                                    </span>
<span class="1692280875737006119" onmouseenter="enter('1692280875737006119');" onmouseout="out('1692280875737006119');" style="">  49      //select table tableName as select                                                                            </span>
<span class="-1271293401556749588" onmouseenter="enter('-1271293401556749588');" onmouseout="out('-1271293401556749588');" style="">  50      private static final String PATTERN_STR = &quot;(?i)create\\s+view\\s+([^\\s]+)\\s+as\\s+select\\s+(.*)&quot;;          </span>
<span  style="">  51                                                                                                                    </span>
<span class="-8315391035218956272" onmouseenter="enter('-8315391035218956272');" onmouseout="out('-8315391035218956272');" style="">  52      private static final String EMPTY_STR = &quot;(?i)^\\screate\\s+view\\s+(\\S+)\\s*\\((.+)\\)$&quot;;                    </span>
<span  style="">  53                                                                                                                    </span>
<span class="-3672370047386048632" onmouseenter="enter('-3672370047386048632');" onmouseout="out('-3672370047386048632');" style="">  54      private static final Pattern NONEMPTYVIEW = Pattern.compile(PATTERN_STR);                                     </span>
<span  style="">  55                                                                                                                    </span>
<span class="-1106484013591124828" onmouseenter="enter('-1106484013591124828');" onmouseout="out('-1106484013591124828');" style="">  56      private static final Pattern EMPTYVIEW = Pattern.compile(EMPTY_STR);                                          </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  57 +                                                                                                                  </span>
<span class="7449713827178994474" onmouseenter="enter('7449713827178994474');" onmouseout="out('7449713827178994474');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +    private FlinkPlanner flinkPlanner = new FlinkPlanner();                                                       </span>
<span  style="">  59                                                                                                                    </span>
<span class="-4276582339515498619" onmouseenter="enter('-4276582339515498619');" onmouseout="out('-4276582339515498619');" style="">  60      public static CreateTmpTableParser newInstance(){                                                             </span>
<span class="47068879565730843" onmouseenter="enter('47068879565730843');" onmouseout="out('47068879565730843');" style="">  61          return new CreateTmpTableParser();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  62      }                                                                                                             </span>
<span  style="">  63                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  64      @Override                                                                                                     </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  65      public boolean verify(String sql) {                                                                           </span>
<span class="5080351063145353274" onmouseenter="enter('5080351063145353274');" onmouseout="out('5080351063145353274');" style="">  66          if (Pattern.compile(EMPTY_STR).matcher(sql).find()){                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">  67              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  68          }                                                                                                         </span>
<span class="-4171867442126805233" onmouseenter="enter('-4171867442126805233');" onmouseout="out('-4171867442126805233');" style="">  69          return NONEMPTYVIEW.matcher(sql).find();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70      }                                                                                                             </span>
<span  style="">  71                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  72      @Override                                                                                                     </span>
<span class="2434475561113814770" onmouseenter="enter('2434475561113814770');" onmouseout="out('2434475561113814770');" style="">  73      public void parseSql(String sql, SqlTree sqlTree) {                                                           </span>
<span class="-4232897884938138531" onmouseenter="enter('-4232897884938138531');" onmouseout="out('-4232897884938138531');" style="">  74          if (NONEMPTYVIEW.matcher(sql).find()){                                                                    </span>
<span class="4868128867670798292" onmouseenter="enter('4868128867670798292');" onmouseout="out('4868128867670798292');" style="">  75              Matcher matcher = NONEMPTYVIEW.matcher(sql);                                                          </span>
<span class="-2149462964125051477" onmouseenter="enter('-2149462964125051477');" onmouseout="out('-2149462964125051477');" style="">  76              String tableName = null;                                                                              </span>
<span class="1176157296088413911" onmouseenter="enter('1176157296088413911');" onmouseout="out('1176157296088413911');" style="">  77              String selectSql = null;                                                                              </span>
<span class="-635862945794875415" onmouseenter="enter('-635862945794875415');" onmouseout="out('-635862945794875415');" style="">  78              if(matcher.find()) {                                                                                  </span>
<span class="-7339253825834236980" onmouseenter="enter('-7339253825834236980');" onmouseout="out('-7339253825834236980');" style="">  79                  tableName = matcher.group(1);                                                                     </span>
<span class="5719248077698739274" onmouseenter="enter('5719248077698739274');" onmouseout="out('5719248077698739274');" style="">  80                  selectSql = &quot;select &quot; + matcher.group(2);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81              }                                                                                                     </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  82 -            FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                                       </span>
<span  style="">  83                                                                                                                    </span>
<span class="-8058108881324857360" onmouseenter="enter('-8058108881324857360');" onmouseout="out('-8058108881324857360');" style="">  84              SqlNode sqlNode = null;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  85              try {                                                                                                 </span>
<span class="-2692576850736529735" onmouseenter="enter('-2692576850736529735');" onmouseout="out('-2692576850736529735');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  86 -                sqlNode = flinkPlanner.parse(selectSql);                                                          </span>
<span class="-481088827021766876" onmouseenter="enter('-481088827021766876');" onmouseout="out('-481088827021766876');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  87 +                sqlNode = flinkPlanner.getParser().parse(selectSql);                                              </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="">  88              } catch (Exception e) {                                                                               </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style="">  89                  throw new RuntimeException(&quot;&quot;, e);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90              }                                                                                                     </span>
<span  style="">  91                                                                                                                    </span>
<span class="-6794803975475097361" onmouseenter="enter('-6794803975475097361');" onmouseout="out('-6794803975475097361');" style="">  92              CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResult();     </span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  93              parseNode(sqlNode, sqlParseResult);                                                                   </span>
<span  style="">  94                                                                                                                    </span>
<span class="7413451772740865887" onmouseenter="enter('7413451772740865887');" onmouseout="out('7413451772740865887');" style="">  95              sqlParseResult.setTableName(tableName);                                                               </span>
<span class="-7952612197475445252" onmouseenter="enter('-7952612197475445252');" onmouseout="out('-7952612197475445252');" style="">  96              String transformSelectSql = DtStringUtil.replaceIgnoreQuota(sqlNode.toString(), &quot;`&quot;, &quot;&quot;);             </span>
<span class="59678813590501023" onmouseenter="enter('59678813590501023');" onmouseout="out('59678813590501023');" style="">  97              sqlParseResult.setExecSql(transformSelectSql);                                                        </span>
<span class="159740589241090380" onmouseenter="enter('159740589241090380');" onmouseout="out('159740589241090380');" style="">  98              sqlTree.addTmpSql(sqlParseResult);                                                                    </span>
<span class="-4480996658492912084" onmouseenter="enter('-4480996658492912084');" onmouseout="out('-4480996658492912084');" style="">  99              sqlTree.addTmplTableInfo(tableName, sqlParseResult);                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 100          } else {                                                                                                  </span>
<span class="519293395905078156" onmouseenter="enter('519293395905078156');" onmouseout="out('519293395905078156');" style=""> 101              if (EMPTYVIEW.matcher(sql).find())                                                                    </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 102              {                                                                                                     </span>
<span class="3420445309626970873" onmouseenter="enter('3420445309626970873');" onmouseout="out('3420445309626970873');" style=""> 103                  Matcher matcher = EMPTYVIEW.matcher(sql);                                                         </span>
<span class="-2149462964125051477" onmouseenter="enter('-2149462964125051477');" onmouseout="out('-2149462964125051477');" style=""> 104                  String tableName = null;                                                                          </span>
<span class="501566961209766897" onmouseenter="enter('501566961209766897');" onmouseout="out('501566961209766897');" style=""> 105                  String fieldsInfoStr = null;                                                                      </span>
<span class="4597453068386605197" onmouseenter="enter('4597453068386605197');" onmouseout="out('4597453068386605197');" style=""> 106                  if (matcher.find()){                                                                              </span>
<span class="-7339253825834236980" onmouseenter="enter('-7339253825834236980');" onmouseout="out('-7339253825834236980');" style=""> 107                      tableName = matcher.group(1);                                                                 </span>
<span class="-785282600466434776" onmouseenter="enter('-785282600466434776');" onmouseout="out('-785282600466434776');" style=""> 108                      fieldsInfoStr = matcher.group(2);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 109                  }                                                                                                 </span>
<span class="-6794803975475097361" onmouseenter="enter('-6794803975475097361');" onmouseout="out('-6794803975475097361');" style=""> 110                  CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResult(); </span>
<span class="-3545780709276930333" onmouseenter="enter('-3545780709276930333');" onmouseout="out('-3545780709276930333');" style=""> 111                  sqlParseResult.setFieldsInfoStr(fieldsInfoStr);                                                   </span>
<span class="7413451772740865887" onmouseenter="enter('7413451772740865887');" onmouseout="out('7413451772740865887');" style=""> 112                  sqlParseResult.setTableName(tableName);                                                           </span>
<span class="-4480996658492912084" onmouseenter="enter('-4480996658492912084');" onmouseout="out('-4480996658492912084');" style=""> 113                  sqlTree.addTmplTableInfo(tableName, sqlParseResult);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114              }                                                                                                     </span>
<span  style=""> 115                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116          }                                                                                                         </span>
<span  style=""> 117                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 118      }                                                                                                             </span>
<span  style=""> 119                                                                                                                    </span>
<span class="-5053657052287600142" onmouseenter="enter('-5053657052287600142');" onmouseout="out('-5053657052287600142');" style=""> 120      private static void parseNode(SqlNode sqlNode, CreateTmpTableParser.SqlParserResult sqlParseResult){          </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 121          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style=""> 122          switch (sqlKind){                                                                                         </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 123              case SELECT:                                                                                          </span>
<span class="-737340637367962148" onmouseenter="enter('-737340637367962148');" onmouseout="out('-737340637367962148');" style=""> 124                  SqlNode sqlFrom = ((SqlSelect)sqlNode).getFrom();                                                 </span>
<span class="1877498908128044563" onmouseenter="enter('1877498908128044563');" onmouseout="out('1877498908128044563');" style=""> 125                  if(sqlFrom.getKind() == IDENTIFIER){                                                              </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style=""> 126                      sqlParseResult.addSourceTable(sqlFrom.toString());                                            </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 127                  }else{                                                                                            </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style=""> 128                      parseNode(sqlFrom, sqlParseResult);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 130                  break;                                                                                            </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 131              case JOIN:                                                                                            </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 132                  SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                                  </span>
<span class="-6247618774659154031" onmouseenter="enter('-6247618774659154031');" onmouseout="out('-6247618774659154031');" style=""> 133                  SqlNode rightNode = ((SqlJoin)sqlNode).getRight();                                                </span>
<span  style=""> 134                                                                                                                    </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 135                  if(leftNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 136                      sqlParseResult.addSourceTable(leftNode.toString());                                           </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 137                  }else{                                                                                            </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 138                      parseNode(leftNode, sqlParseResult);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139                  }                                                                                                 </span>
<span  style=""> 140                                                                                                                    </span>
<span class="-5648840450336709152" onmouseenter="enter('-5648840450336709152');" onmouseout="out('-5648840450336709152');" style=""> 141                  if(rightNode.getKind() == IDENTIFIER){                                                            </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 142                      sqlParseResult.addSourceTable(rightNode.toString());                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 143                  }else{                                                                                            </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 144                      parseNode(rightNode, sqlParseResult);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 146                  break;                                                                                            </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 147              case AS:                                                                                              </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 148                  //不解析column,所以 as 相关的都是表                                                                          </span>
<span class="-5734921612668171253" onmouseenter="enter('-5734921612668171253');" onmouseout="out('-5734921612668171253');" style=""> 149                  SqlNode identifierNode = ((SqlBasicCall)sqlNode).getOperands()[0];                                </span>
<span class="-8687183585810485329" onmouseenter="enter('-8687183585810485329');" onmouseout="out('-8687183585810485329');" style=""> 150                  if(identifierNode.getKind() != IDENTIFIER){                                                       </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 151                      parseNode(identifierNode, sqlParseResult);                                                    </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 152                  }else {                                                                                           </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 153                      sqlParseResult.addSourceTable(identifierNode.toString());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 155                  break;                                                                                            </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 156              case UNION:                                                                                           </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 157                  SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 158                  SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                                    </span>
<span class="3779552565426531876" onmouseenter="enter('3779552565426531876');" onmouseout="out('3779552565426531876');" style=""> 159                  if(unionLeft.getKind() == IDENTIFIER){                                                            </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 160                      sqlParseResult.addSourceTable(unionLeft.toString());                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 161                  }else{                                                                                            </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 162                      parseNode(unionLeft, sqlParseResult);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163                  }                                                                                                 </span>
<span class="7065528519182980902" onmouseenter="enter('7065528519182980902');" onmouseout="out('7065528519182980902');" style=""> 164                  if(unionRight.getKind() == IDENTIFIER){                                                           </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 165                      sqlParseResult.addSourceTable(unionRight.toString());                                         </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 166                  }else{                                                                                            </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 167                      parseNode(unionRight, sqlParseResult);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 169                  break;                                                                                            </span>




<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 170              default:                                                                                              </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 171                  //do nothing                                                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 172                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 173          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174      }                                                                                                             </span>
<span  style=""> 175                                                                                                                    </span>
<span class="1640675281854442724" onmouseenter="enter('1640675281854442724');" onmouseout="out('1640675281854442724');" style=""> 176      public static class SqlParserResult {                                                                         </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style=""> 177          private String tableName;                                                                                 </span>
<span  style=""> 178                                                                                                                    </span>
<span class="5785294141990237530" onmouseenter="enter('5785294141990237530');" onmouseout="out('5785294141990237530');" style=""> 179          private String fieldsInfoStr;                                                                             </span>
<span  style=""> 180                                                                                                                    </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 181          private String execSql;                                                                                   </span>
<span  style=""> 182                                                                                                                    </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 183          private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                              </span>
<span  style=""> 184                                                                                                                    </span>
<span class="5796947355340463495" onmouseenter="enter('5796947355340463495');" onmouseout="out('5796947355340463495');" style=""> 185          public String getTableName() {                                                                            </span>
<span class="7440436830317723056" onmouseenter="enter('7440436830317723056');" onmouseout="out('7440436830317723056');" style=""> 186              return tableName;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187          }                                                                                                         </span>
<span  style=""> 188                                                                                                                    </span>
<span class="107024788727095650" onmouseenter="enter('107024788727095650');" onmouseout="out('107024788727095650');" style=""> 189          public void setTableName(String tableName) {                                                              </span>
<span class="-2576382372206679378" onmouseenter="enter('-2576382372206679378');" onmouseout="out('-2576382372206679378');" style=""> 190              this.tableName = tableName;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191          }                                                                                                         </span>
<span  style=""> 192                                                                                                                    </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 193          public String getExecSql() {                                                                              </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 194              return execSql;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195          }                                                                                                         </span>
<span  style=""> 196                                                                                                                    </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 197          public void setExecSql(String execSql) {                                                                  </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 198              this.execSql = execSql;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199          }                                                                                                         </span>
<span  style=""> 200                                                                                                                    </span>
<span class="-3640570397111550402" onmouseenter="enter('-3640570397111550402');" onmouseout="out('-3640570397111550402');" style=""> 201          public String getFieldsInfoStr() {                                                                        </span>
<span class="-6491863098575137699" onmouseenter="enter('-6491863098575137699');" onmouseout="out('-6491863098575137699');" style=""> 202              return fieldsInfoStr;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203          }                                                                                                         </span>
<span  style=""> 204                                                                                                                    </span>
<span class="-5861241035079497190" onmouseenter="enter('-5861241035079497190');" onmouseout="out('-5861241035079497190');" style=""> 205          public void setFieldsInfoStr(String fieldsInfoStr) {                                                      </span>
<span class="-7221077579441258936" onmouseenter="enter('-7221077579441258936');" onmouseout="out('-7221077579441258936');" style=""> 206              this.fieldsInfoStr = fieldsInfoStr;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207          }                                                                                                         </span>
<span  style=""> 208                                                                                                                    </span>
<span class="5144548036770890441" onmouseenter="enter('5144548036770890441');" onmouseout="out('5144548036770890441');" style=""> 209          public void addSourceTable(String sourceTable){                                                           </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 210              sourceTableList.add(sourceTable);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211          }                                                                                                         </span>
<span  style=""> 212                                                                                                                    </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 213          public List&lt;String&gt; getSourceTableList() {                                                                </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 214              return sourceTableList;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215          }                                                                                                         </span>
<span  style=""> 216                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="3101153502889412828" onmouseenter="enter('3101153502889412828');" onmouseout="out('3101153502889412828');" style="">   2   * Licensed to the Apache Software Foundation (ASF) under one                                                     </span>
<span class="-6690800139350779170" onmouseenter="enter('-6690800139350779170');" onmouseout="out('-6690800139350779170');" style="">   3   * or more contributor license agreements.  See the NOTICE file                                                   </span>
<span class="4408648408749222780" onmouseenter="enter('4408648408749222780');" onmouseout="out('4408648408749222780');" style="">   4   * distributed with this work for additional information                                                          </span>
<span class="7440871955664702931" onmouseenter="enter('7440871955664702931');" onmouseout="out('7440871955664702931');" style="">   5   * regarding copyright ownership.  The ASF licenses this file                                                     </span>
<span class="-7748987699953482767" onmouseenter="enter('-7748987699953482767');" onmouseout="out('-7748987699953482767');" style="">   6   * to you under the Apache License, Version 2.0 (the                                                              </span>
<span class="-7532787339260984706" onmouseenter="enter('-7532787339260984706');" onmouseout="out('-7532787339260984706');" style="">   7   * &quot;License&quot;); you may not use this file except in compliance                                                     </span>
<span class="6072654417402056570" onmouseenter="enter('6072654417402056570');" onmouseout="out('6072654417402056570');" style="">   8   * with the License.  You may obtain a copy of the License at                                                     </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="-6984878691993713389" onmouseenter="enter('-6984878691993713389');" onmouseout="out('-6984878691993713389');" style="">  10   *     http://www.apache.org/licenses/LICENSE-2.0                                                                 </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">  11   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  12   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  13   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  14   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  15   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  16   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  17   */                                                                                                               </span>
<span  style="">  18                                                                                                                    </span>
<span  style="">  19                                                                                                                    </span>
<span  style="">  20                                                                                                                    </span>
<span class="1224993673552058858" onmouseenter="enter('1224993673552058858');" onmouseout="out('1224993673552058858');" style="">  21  package com.dtstack.flink.sql.parser;                                                                             </span>
<span  style="">  22                                                                                                                    </span>
<span class="-898041479655512830" onmouseenter="enter('-898041479655512830');" onmouseout="out('-898041479655512830');" style="">  23  import com.dtstack.flink.sql.util.DtStringUtil;                                                                   </span>
<span class="-2084905850329493825" onmouseenter="enter('-2084905850329493825');" onmouseout="out('-2084905850329493825');" style="">  24  import org.apache.calcite.config.Lex;                                                                             </span>
<span class="-2880165776056730027" onmouseenter="enter('-2880165776056730027');" onmouseout="out('-2880165776056730027');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  25 -import org.apache.calcite.sql.SqlBasicCall;                                                                       </span>
<span class="6040609180412894066" onmouseenter="enter('6040609180412894066');" onmouseout="out('6040609180412894066');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  26 -import org.apache.calcite.sql.SqlJoin;                                                                            </span>
<span class="5269832681984582353" onmouseenter="enter('5269832681984582353');" onmouseout="out('5269832681984582353');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  27 -import org.apache.calcite.sql.SqlKind;                                                                            </span>
<span class="-3220645246316502826" onmouseenter="enter('-3220645246316502826');" onmouseout="out('-3220645246316502826');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  28 -import org.apache.calcite.sql.SqlNode;                                                                            </span>
<span class="1429561171107518415" onmouseenter="enter('1429561171107518415');" onmouseout="out('1429561171107518415');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  29 -import org.apache.calcite.sql.SqlSelect;                                                                          </span>
<span class="5169042772451251702" onmouseenter="enter('5169042772451251702');" onmouseout="out('5169042772451251702');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  30 +import org.apache.calcite.sql.*;                                                                                  </span>
<span class="7194619065086523875" onmouseenter="enter('7194619065086523875');" onmouseout="out('7194619065086523875');" style="">  31  import org.apache.calcite.sql.parser.SqlParseException;                                                           </span>
<span class="1277226550340008522" onmouseenter="enter('1277226550340008522');" onmouseout="out('1277226550340008522');" style="">  32  import org.apache.calcite.sql.parser.SqlParser;                                                                   </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  33  import com.google.common.collect.Lists;                                                                           </span>
<span class="-3548577539000853351" onmouseenter="enter('-3548577539000853351');" onmouseout="out('-3548577539000853351');" style="">  34  import org.apache.flink.table.calcite.FlinkPlannerImpl;                                                           </span>
<span  style="">  35                                                                                                                    </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  36  import java.util.List;                                                                                            </span>
<span class="2159928926335330273" onmouseenter="enter('2159928926335330273');" onmouseout="out('2159928926335330273');" style="">  37  import java.util.regex.Matcher;                                                                                   </span>
<span class="1513108047920599059" onmouseenter="enter('1513108047920599059');" onmouseout="out('1513108047920599059');" style="">  38  import java.util.regex.Pattern;                                                                                   </span>
<span  style="">  39                                                                                                                    </span>
<span class="-2521262007515880622" onmouseenter="enter('-2521262007515880622');" onmouseout="out('-2521262007515880622');" style="">  40  import static org.apache.calcite.sql.SqlKind.IDENTIFIER;                                                          </span>
<span  style="">  41                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  42  /**                                                                                                               </span>
<span class="4193963814460474034" onmouseenter="enter('4193963814460474034');" onmouseout="out('4193963814460474034');" style="">  43   * parser create tmp table sql                                                                                    </span>
<span class="7455087124226002233" onmouseenter="enter('7455087124226002233');" onmouseout="out('7455087124226002233');" style="">  44   * Date: 2018/6/26                                                                                                </span>
<span class="8814254840422205931" onmouseenter="enter('8814254840422205931');" onmouseout="out('8814254840422205931');" style="">  45   * Company: www.dtstack.com                                                                                       </span>
<span class="7767094491324231202" onmouseenter="enter('7767094491324231202');" onmouseout="out('7767094491324231202');" style="">  46   * @author yanxi                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  47   */                                                                                                               </span>
<span class="-461613748658336188" onmouseenter="enter('-461613748658336188');" onmouseout="out('-461613748658336188');" style="">  48  public class CreateTmpTableParser implements IParser {                                                            </span>
<span  style="">  49                                                                                                                    </span>
<span class="1692280875737006119" onmouseenter="enter('1692280875737006119');" onmouseout="out('1692280875737006119');" style="">  50      //select table tableName as select                                                                            </span>
<span class="-1271293401556749588" onmouseenter="enter('-1271293401556749588');" onmouseout="out('-1271293401556749588');" style="">  51      private static final String PATTERN_STR = &quot;(?i)create\\s+view\\s+([^\\s]+)\\s+as\\s+select\\s+(.*)&quot;;          </span>
<span  style="">  52                                                                                                                    </span>
<span class="-8315391035218956272" onmouseenter="enter('-8315391035218956272');" onmouseout="out('-8315391035218956272');" style="">  53      private static final String EMPTY_STR = &quot;(?i)^\\screate\\s+view\\s+(\\S+)\\s*\\((.+)\\)$&quot;;                    </span>
<span  style="">  54                                                                                                                    </span>
<span class="-3672370047386048632" onmouseenter="enter('-3672370047386048632');" onmouseout="out('-3672370047386048632');" style="">  55      private static final Pattern NONEMPTYVIEW = Pattern.compile(PATTERN_STR);                                     </span>
<span  style="">  56                                                                                                                    </span>
<span class="-1106484013591124828" onmouseenter="enter('-1106484013591124828');" onmouseout="out('-1106484013591124828');" style="">  57      private static final Pattern EMPTYVIEW = Pattern.compile(EMPTY_STR);                                          </span>


<span  style="">  58                                                                                                                    </span>
<span class="-4276582339515498619" onmouseenter="enter('-4276582339515498619');" onmouseout="out('-4276582339515498619');" style="">  59      public static CreateTmpTableParser newInstance(){                                                             </span>
<span class="47068879565730843" onmouseenter="enter('47068879565730843');" onmouseout="out('47068879565730843');" style="">  60          return new CreateTmpTableParser();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  61      }                                                                                                             </span>
<span  style="">  62                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  63      @Override                                                                                                     </span>
<span class="2092801495564122916" onmouseenter="enter('2092801495564122916');" onmouseout="out('2092801495564122916');" style="">  64      public boolean verify(String sql) {                                                                           </span>
<span class="5080351063145353274" onmouseenter="enter('5080351063145353274');" onmouseout="out('5080351063145353274');" style="">  65          if (Pattern.compile(EMPTY_STR).matcher(sql).find()){                                                      </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style="">  66              return true;                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  67          }                                                                                                         </span>
<span class="-4171867442126805233" onmouseenter="enter('-4171867442126805233');" onmouseout="out('-4171867442126805233');" style="">  68          return NONEMPTYVIEW.matcher(sql).find();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69      }                                                                                                             </span>
<span  style="">  70                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  71      @Override                                                                                                     </span>
<span class="2434475561113814770" onmouseenter="enter('2434475561113814770');" onmouseout="out('2434475561113814770');" style="">  72      public void parseSql(String sql, SqlTree sqlTree) {                                                           </span>
<span class="-4232897884938138531" onmouseenter="enter('-4232897884938138531');" onmouseout="out('-4232897884938138531');" style="">  73          if (NONEMPTYVIEW.matcher(sql).find()){                                                                    </span>
<span class="4868128867670798292" onmouseenter="enter('4868128867670798292');" onmouseout="out('4868128867670798292');" style="">  74              Matcher matcher = NONEMPTYVIEW.matcher(sql);                                                          </span>
<span class="-2149462964125051477" onmouseenter="enter('-2149462964125051477');" onmouseout="out('-2149462964125051477');" style="">  75              String tableName = null;                                                                              </span>
<span class="1176157296088413911" onmouseenter="enter('1176157296088413911');" onmouseout="out('1176157296088413911');" style="">  76              String selectSql = null;                                                                              </span>
<span class="-635862945794875415" onmouseenter="enter('-635862945794875415');" onmouseout="out('-635862945794875415');" style="">  77              if(matcher.find()) {                                                                                  </span>
<span class="-7339253825834236980" onmouseenter="enter('-7339253825834236980');" onmouseout="out('-7339253825834236980');" style="">  78                  tableName = matcher.group(1);                                                                     </span>
<span class="5719248077698739274" onmouseenter="enter('5719248077698739274');" onmouseout="out('5719248077698739274');" style="">  79                  selectSql = &quot;select &quot; + matcher.group(2);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  80              }                                                                                                     </span>
<span class="-1075958635284917181" onmouseenter="enter('-1075958635284917181');" onmouseout="out('-1075958635284917181');" style="">  81              FlinkPlannerImpl flinkPlanner = FlinkPlanner.getFlinkPlanner();                                       </span>
<span  style="">  82                                                                                                                    </span>
<span class="-8058108881324857360" onmouseenter="enter('-8058108881324857360');" onmouseout="out('-8058108881324857360');" style="">  83              SqlNode sqlNode = null;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style="">  84              try {                                                                                                 </span>
<span class="-2692576850736529735" onmouseenter="enter('-2692576850736529735');" onmouseout="out('-2692576850736529735');" style="">  85                  sqlNode = flinkPlanner.parse(selectSql);                                                          </span>

<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style="">  86              } catch (Exception e) {                                                                               </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style="">  87                  throw new RuntimeException(&quot;&quot;, e);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  88              }                                                                                                     </span>
<span  style="">  89                                                                                                                    </span>
<span class="-6794803975475097361" onmouseenter="enter('-6794803975475097361');" onmouseout="out('-6794803975475097361');" style="">  90              CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResult();     </span>
<span class="-1557788009333318197" onmouseenter="enter('-1557788009333318197');" onmouseout="out('-1557788009333318197');" style="">  91              parseNode(sqlNode, sqlParseResult);                                                                   </span>
<span  style="">  92                                                                                                                    </span>
<span class="7413451772740865887" onmouseenter="enter('7413451772740865887');" onmouseout="out('7413451772740865887');" style="">  93              sqlParseResult.setTableName(tableName);                                                               </span>
<span class="-7952612197475445252" onmouseenter="enter('-7952612197475445252');" onmouseout="out('-7952612197475445252');" style="">  94              String transformSelectSql = DtStringUtil.replaceIgnoreQuota(sqlNode.toString(), &quot;`&quot;, &quot;&quot;);             </span>
<span class="59678813590501023" onmouseenter="enter('59678813590501023');" onmouseout="out('59678813590501023');" style="">  95              sqlParseResult.setExecSql(transformSelectSql);                                                        </span>
<span class="159740589241090380" onmouseenter="enter('159740589241090380');" onmouseout="out('159740589241090380');" style="">  96              sqlTree.addTmpSql(sqlParseResult);                                                                    </span>
<span class="-4480996658492912084" onmouseenter="enter('-4480996658492912084');" onmouseout="out('-4480996658492912084');" style="">  97              sqlTree.addTmplTableInfo(tableName, sqlParseResult);                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  98          } else {                                                                                                  </span>
<span class="519293395905078156" onmouseenter="enter('519293395905078156');" onmouseout="out('519293395905078156');" style="">  99              if (EMPTYVIEW.matcher(sql).find())                                                                    </span>
<span class="5677081435180812955" onmouseenter="enter('5677081435180812955');" onmouseout="out('5677081435180812955');" style=""> 100              {                                                                                                     </span>
<span class="3420445309626970873" onmouseenter="enter('3420445309626970873');" onmouseout="out('3420445309626970873');" style=""> 101                  Matcher matcher = EMPTYVIEW.matcher(sql);                                                         </span>
<span class="-2149462964125051477" onmouseenter="enter('-2149462964125051477');" onmouseout="out('-2149462964125051477');" style=""> 102                  String tableName = null;                                                                          </span>
<span class="501566961209766897" onmouseenter="enter('501566961209766897');" onmouseout="out('501566961209766897');" style=""> 103                  String fieldsInfoStr = null;                                                                      </span>
<span class="4597453068386605197" onmouseenter="enter('4597453068386605197');" onmouseout="out('4597453068386605197');" style=""> 104                  if (matcher.find()){                                                                              </span>
<span class="-7339253825834236980" onmouseenter="enter('-7339253825834236980');" onmouseout="out('-7339253825834236980');" style=""> 105                      tableName = matcher.group(1);                                                                 </span>
<span class="-785282600466434776" onmouseenter="enter('-785282600466434776');" onmouseout="out('-785282600466434776');" style=""> 106                      fieldsInfoStr = matcher.group(2);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 107                  }                                                                                                 </span>
<span class="-6794803975475097361" onmouseenter="enter('-6794803975475097361');" onmouseout="out('-6794803975475097361');" style=""> 108                  CreateTmpTableParser.SqlParserResult sqlParseResult = new CreateTmpTableParser.SqlParserResult(); </span>
<span class="-3545780709276930333" onmouseenter="enter('-3545780709276930333');" onmouseout="out('-3545780709276930333');" style=""> 109                  sqlParseResult.setFieldsInfoStr(fieldsInfoStr);                                                   </span>
<span class="7413451772740865887" onmouseenter="enter('7413451772740865887');" onmouseout="out('7413451772740865887');" style=""> 110                  sqlParseResult.setTableName(tableName);                                                           </span>
<span class="-4480996658492912084" onmouseenter="enter('-4480996658492912084');" onmouseout="out('-4480996658492912084');" style=""> 111                  sqlTree.addTmplTableInfo(tableName, sqlParseResult);                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 112              }                                                                                                     </span>
<span  style=""> 113                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114          }                                                                                                         </span>
<span  style=""> 115                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116      }                                                                                                             </span>
<span  style=""> 117                                                                                                                    </span>
<span class="-5053657052287600142" onmouseenter="enter('-5053657052287600142');" onmouseout="out('-5053657052287600142');" style=""> 118      private static void parseNode(SqlNode sqlNode, CreateTmpTableParser.SqlParserResult sqlParseResult){          </span>
<span class="-6576874451366454813" onmouseenter="enter('-6576874451366454813');" onmouseout="out('-6576874451366454813');" style=""> 119          SqlKind sqlKind = sqlNode.getKind();                                                                      </span>
<span class="2714387737819984732" onmouseenter="enter('2714387737819984732');" onmouseout="out('2714387737819984732');" style=""> 120          switch (sqlKind){                                                                                         </span>
<span class="3125052951420706002" onmouseenter="enter('3125052951420706002');" onmouseout="out('3125052951420706002');" style=""> 121              case SELECT:                                                                                          </span>
<span class="-737340637367962148" onmouseenter="enter('-737340637367962148');" onmouseout="out('-737340637367962148');" style=""> 122                  SqlNode sqlFrom = ((SqlSelect)sqlNode).getFrom();                                                 </span>
<span class="1877498908128044563" onmouseenter="enter('1877498908128044563');" onmouseout="out('1877498908128044563');" style=""> 123                  if(sqlFrom.getKind() == IDENTIFIER){                                                              </span>
<span class="8241530473190791640" onmouseenter="enter('8241530473190791640');" onmouseout="out('8241530473190791640');" style=""> 124                      sqlParseResult.addSourceTable(sqlFrom.toString());                                            </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 125                  }else{                                                                                            </span>
<span class="4128396176691967722" onmouseenter="enter('4128396176691967722');" onmouseout="out('4128396176691967722');" style=""> 126                      parseNode(sqlFrom, sqlParseResult);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 128                  break;                                                                                            </span>
<span class="7645440911590124448" onmouseenter="enter('7645440911590124448');" onmouseout="out('7645440911590124448');" style=""> 129              case JOIN:                                                                                            </span>
<span class="7698802261704662279" onmouseenter="enter('7698802261704662279');" onmouseout="out('7698802261704662279');" style=""> 130                  SqlNode leftNode = ((SqlJoin)sqlNode).getLeft();                                                  </span>
<span class="-6247618774659154031" onmouseenter="enter('-6247618774659154031');" onmouseout="out('-6247618774659154031');" style=""> 131                  SqlNode rightNode = ((SqlJoin)sqlNode).getRight();                                                </span>
<span  style=""> 132                                                                                                                    </span>
<span class="-8190917917216144958" onmouseenter="enter('-8190917917216144958');" onmouseout="out('-8190917917216144958');" style=""> 133                  if(leftNode.getKind() == IDENTIFIER){                                                             </span>
<span class="-307510795650094250" onmouseenter="enter('-307510795650094250');" onmouseout="out('-307510795650094250');" style=""> 134                      sqlParseResult.addSourceTable(leftNode.toString());                                           </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 135                  }else{                                                                                            </span>
<span class="4207242849825940624" onmouseenter="enter('4207242849825940624');" onmouseout="out('4207242849825940624');" style=""> 136                      parseNode(leftNode, sqlParseResult);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137                  }                                                                                                 </span>
<span  style=""> 138                                                                                                                    </span>
<span class="-5648840450336709152" onmouseenter="enter('-5648840450336709152');" onmouseout="out('-5648840450336709152');" style=""> 139                  if(rightNode.getKind() == IDENTIFIER){                                                            </span>
<span class="-7238435843855989440" onmouseenter="enter('-7238435843855989440');" onmouseout="out('-7238435843855989440');" style=""> 140                      sqlParseResult.addSourceTable(rightNode.toString());                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 141                  }else{                                                                                            </span>
<span class="-5366187044469072353" onmouseenter="enter('-5366187044469072353');" onmouseout="out('-5366187044469072353');" style=""> 142                      parseNode(rightNode, sqlParseResult);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 143                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 144                  break;                                                                                            </span>
<span class="2219038699300296021" onmouseenter="enter('2219038699300296021');" onmouseout="out('2219038699300296021');" style=""> 145              case AS:                                                                                              </span>
<span class="5826390168021483981" onmouseenter="enter('5826390168021483981');" onmouseout="out('5826390168021483981');" style=""> 146                  //不解析column,所以 as 相关的都是表                                                                          </span>
<span class="-5734921612668171253" onmouseenter="enter('-5734921612668171253');" onmouseout="out('-5734921612668171253');" style=""> 147                  SqlNode identifierNode = ((SqlBasicCall)sqlNode).getOperands()[0];                                </span>
<span class="-8687183585810485329" onmouseenter="enter('-8687183585810485329');" onmouseout="out('-8687183585810485329');" style=""> 148                  if(identifierNode.getKind() != IDENTIFIER){                                                       </span>
<span class="-4744022615262891158" onmouseenter="enter('-4744022615262891158');" onmouseout="out('-4744022615262891158');" style=""> 149                      parseNode(identifierNode, sqlParseResult);                                                    </span>
<span class="-6497049907687009769" onmouseenter="enter('-6497049907687009769');" onmouseout="out('-6497049907687009769');" style=""> 150                  }else {                                                                                           </span>
<span class="6305370846253658960" onmouseenter="enter('6305370846253658960');" onmouseout="out('6305370846253658960');" style=""> 151                      sqlParseResult.addSourceTable(identifierNode.toString());                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 152                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 153                  break;                                                                                            </span>
<span class="294695447128891592" onmouseenter="enter('294695447128891592');" onmouseout="out('294695447128891592');" style=""> 154              case UNION:                                                                                           </span>
<span class="-7477725012703906871" onmouseenter="enter('-7477725012703906871');" onmouseout="out('-7477725012703906871');" style=""> 155                  SqlNode unionLeft = ((SqlBasicCall)sqlNode).getOperands()[0];                                     </span>
<span class="-368480979530163649" onmouseenter="enter('-368480979530163649');" onmouseout="out('-368480979530163649');" style=""> 156                  SqlNode unionRight = ((SqlBasicCall)sqlNode).getOperands()[1];                                    </span>
<span class="3779552565426531876" onmouseenter="enter('3779552565426531876');" onmouseout="out('3779552565426531876');" style=""> 157                  if(unionLeft.getKind() == IDENTIFIER){                                                            </span>
<span class="-5358468360073063178" onmouseenter="enter('-5358468360073063178');" onmouseout="out('-5358468360073063178');" style=""> 158                      sqlParseResult.addSourceTable(unionLeft.toString());                                          </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 159                  }else{                                                                                            </span>
<span class="-2617274856762080939" onmouseenter="enter('-2617274856762080939');" onmouseout="out('-2617274856762080939');" style=""> 160                      parseNode(unionLeft, sqlParseResult);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161                  }                                                                                                 </span>
<span class="7065528519182980902" onmouseenter="enter('7065528519182980902');" onmouseout="out('7065528519182980902');" style=""> 162                  if(unionRight.getKind() == IDENTIFIER){                                                           </span>
<span class="-9060067906181874961" onmouseenter="enter('-9060067906181874961');" onmouseout="out('-9060067906181874961');" style=""> 163                      sqlParseResult.addSourceTable(unionRight.toString());                                         </span>
<span class="2918192000430827733" onmouseenter="enter('2918192000430827733');" onmouseout="out('2918192000430827733');" style=""> 164                  }else{                                                                                            </span>
<span class="-1718106092654689933" onmouseenter="enter('-1718106092654689933');" onmouseout="out('-1718106092654689933');" style=""> 165                      parseNode(unionRight, sqlParseResult);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166                  }                                                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 167                  break;                                                                                            </span>
<span class="5889755648968358721" onmouseenter="enter('5889755648968358721');" onmouseout="out('5889755648968358721');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +            case MATCH_RECOGNIZE:                                                                                 </span>
<span class="1373643275810848474" onmouseenter="enter('1373643275810848474');" onmouseout="out('1373643275810848474');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +                SqlMatchRecognize node = (SqlMatchRecognize) sqlNode;                                             </span>
<span class="8933858622159353818" onmouseenter="enter('8933858622159353818');" onmouseout="out('8933858622159353818');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +                sqlParseResult.addSourceTable(node.getTableRef().toString());                                     </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +                break;                                                                                            </span>
<span class="-8178136317704390296" onmouseenter="enter('-8178136317704390296');" onmouseout="out('-8178136317704390296');" style=""> 172              default:                                                                                              </span>
<span class="860828310248678739" onmouseenter="enter('860828310248678739');" onmouseout="out('860828310248678739');" style=""> 173                  //do nothing                                                                                      </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 174                  break;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176      }                                                                                                             </span>
<span  style=""> 177                                                                                                                    </span>
<span class="1640675281854442724" onmouseenter="enter('1640675281854442724');" onmouseout="out('1640675281854442724');" style=""> 178      public static class SqlParserResult {                                                                         </span>
<span class="774144980546385333" onmouseenter="enter('774144980546385333');" onmouseout="out('774144980546385333');" style=""> 179          private String tableName;                                                                                 </span>
<span  style=""> 180                                                                                                                    </span>
<span class="5785294141990237530" onmouseenter="enter('5785294141990237530');" onmouseout="out('5785294141990237530');" style=""> 181          private String fieldsInfoStr;                                                                             </span>
<span  style=""> 182                                                                                                                    </span>
<span class="8437363304882776179" onmouseenter="enter('8437363304882776179');" onmouseout="out('8437363304882776179');" style=""> 183          private String execSql;                                                                                   </span>
<span  style=""> 184                                                                                                                    </span>
<span class="1587904348878184014" onmouseenter="enter('1587904348878184014');" onmouseout="out('1587904348878184014');" style=""> 185          private List&lt;String&gt; sourceTableList = Lists.newArrayList();                                              </span>
<span  style=""> 186                                                                                                                    </span>
<span class="5796947355340463495" onmouseenter="enter('5796947355340463495');" onmouseout="out('5796947355340463495');" style=""> 187          public String getTableName() {                                                                            </span>
<span class="7440436830317723056" onmouseenter="enter('7440436830317723056');" onmouseout="out('7440436830317723056');" style=""> 188              return tableName;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189          }                                                                                                         </span>
<span  style=""> 190                                                                                                                    </span>
<span class="107024788727095650" onmouseenter="enter('107024788727095650');" onmouseout="out('107024788727095650');" style=""> 191          public void setTableName(String tableName) {                                                              </span>
<span class="-2576382372206679378" onmouseenter="enter('-2576382372206679378');" onmouseout="out('-2576382372206679378');" style=""> 192              this.tableName = tableName;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193          }                                                                                                         </span>
<span  style=""> 194                                                                                                                    </span>
<span class="7459959708918851119" onmouseenter="enter('7459959708918851119');" onmouseout="out('7459959708918851119');" style=""> 195          public String getExecSql() {                                                                              </span>
<span class="4154186148994399560" onmouseenter="enter('4154186148994399560');" onmouseout="out('4154186148994399560');" style=""> 196              return execSql;                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197          }                                                                                                         </span>
<span  style=""> 198                                                                                                                    </span>
<span class="7557197678911800826" onmouseenter="enter('7557197678911800826');" onmouseout="out('7557197678911800826');" style=""> 199          public void setExecSql(String execSql) {                                                                  </span>
<span class="5784569524175592813" onmouseenter="enter('5784569524175592813');" onmouseout="out('5784569524175592813');" style=""> 200              this.execSql = execSql;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201          }                                                                                                         </span>
<span  style=""> 202                                                                                                                    </span>
<span class="-3640570397111550402" onmouseenter="enter('-3640570397111550402');" onmouseout="out('-3640570397111550402');" style=""> 203          public String getFieldsInfoStr() {                                                                        </span>
<span class="-6491863098575137699" onmouseenter="enter('-6491863098575137699');" onmouseout="out('-6491863098575137699');" style=""> 204              return fieldsInfoStr;                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205          }                                                                                                         </span>
<span  style=""> 206                                                                                                                    </span>
<span class="-5861241035079497190" onmouseenter="enter('-5861241035079497190');" onmouseout="out('-5861241035079497190');" style=""> 207          public void setFieldsInfoStr(String fieldsInfoStr) {                                                      </span>
<span class="-7221077579441258936" onmouseenter="enter('-7221077579441258936');" onmouseout="out('-7221077579441258936');" style=""> 208              this.fieldsInfoStr = fieldsInfoStr;                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209          }                                                                                                         </span>
<span  style=""> 210                                                                                                                    </span>
<span class="5144548036770890441" onmouseenter="enter('5144548036770890441');" onmouseout="out('5144548036770890441');" style=""> 211          public void addSourceTable(String sourceTable){                                                           </span>
<span class="3920005572951608068" onmouseenter="enter('3920005572951608068');" onmouseout="out('3920005572951608068');" style=""> 212              sourceTableList.add(sourceTable);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213          }                                                                                                         </span>
<span  style=""> 214                                                                                                                    </span>
<span class="-7363026318680376964" onmouseenter="enter('-7363026318680376964');" onmouseout="out('-7363026318680376964');" style=""> 215          public List&lt;String&gt; getSourceTableList() {                                                                </span>
<span class="7081270282315381863" onmouseenter="enter('7081270282315381863');" onmouseout="out('7081270282315381863');" style=""> 216              return sourceTableList;                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 217          }                                                                                                         </span>
<span  style=""> 218                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            