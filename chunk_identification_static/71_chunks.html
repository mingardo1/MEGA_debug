<!DOCTYPE html>
<html lang="en">
          <head>
            <meta charset="utf-8">
            <title>71 chunks</title>
                <style>
                    #top {
                        height: 48vh;
                        overflow-y: auto;
                    }
                    #bottom {
                        height: 48vh;
                        overflow-y: auto;
                    }
                </style>
          </head>
          <body>
            <pre>[[{&#x27;eq&#x27;: [{&#x27;CHUNK_OURS&#x27;: &#x27;/*\n&#x27;
                         &#x27; * Copyright (C) 2016 &#x27;
                         &#x27;AriaLyy(https://github.com/AriaLyy/Aria)\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; * Licensed under the Apache License, Version 2.0 &#x27;
                         &#x27;(the &quot;License&quot;);\n&#x27;
                         &#x27; * you may not use this file except in compliance &#x27;
                         &#x27;with the License.\n&#x27;
                         &#x27; * You may obtain a copy of the License at\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; *      http://www.apache.org/licenses/LICENSE-2.0\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; * Unless required by applicable law or agreed to in &#x27;
                         &#x27;writing, software\n&#x27;
                         &#x27; * distributed under the License is distributed on &#x27;
                         &#x27;an &quot;AS IS&quot; BASIS,\n&#x27;
                         &#x27; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, &#x27;
                         &#x27;either express or implied.\n&#x27;
                         &#x27; * See the License for the specific language &#x27;
                         &#x27;governing permissions and\n&#x27;
                         &#x27; * limitations under the License.\n&#x27;
                         &#x27; */\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;package com.arialyy.simple.single_task;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;import android.content.BroadcastReceiver;\n&#x27;
                         &#x27;import android.content.Context;\n&#x27;
                         &#x27;import android.content.Intent;\n&#x27;
                         &#x27;import android.os.Bundle;\n&#x27;
                         &#x27;import android.os.Environment;\n&#x27;
                         &#x27;import android.os.Handler;\n&#x27;
                         &#x27;import android.os.Message;\n&#x27;
                         &#x27;import android.support.v7.widget.Toolbar;\n&#x27;
                         &#x27;import android.view.View;\n&#x27;
                         &#x27;import android.widget.Button;\n&#x27;
                         &#x27;import android.widget.ImageView;\n&#x27;
                         &#x27;import android.widget.TextView;\n&#x27;
                         &#x27;import android.widget.Toast;\n&#x27;
                         &#x27;import butterknife.Bind;\n&#x27;
                         &#x27;import com.arialyy.aria.core.AMTarget;\n&#x27;
                         &#x27;import com.arialyy.aria.core.Aria;\n&#x27;
                         &#x27;import com.arialyy.aria.core.DownloadEntity;\n&#x27;
                         &#x27;import com.arialyy.aria.core.task.DownloadUtil;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.aria.core.task.IDownloadListener;\n&#x27;
                         &#x27;import com.arialyy.aria.core.task.Task;\n&#x27;
                         &#x27;import com.arialyy.aria.util.CommonUtil;\n&#x27;
                         &#x27;import com.arialyy.frame.util.show.L;\n&#x27;
                         &#x27;import com.arialyy.simple.R;\n&#x27;
                         &#x27;import com.arialyy.simple.base.BaseActivity;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.simple.databinding.ActivitySingleBinding;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.simple.widget.HorizontalProgressBarWithNumber;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;public class SingleTaskActivity extends &#x27;
                         &#x27;BaseActivity&lt;ActivitySingleBinding&gt; {\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_PRE      = &#x27;
                         &#x27;0x01;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_STOP     = &#x27;
                         &#x27;0x02;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_FAILE    = &#x27;
                         &#x27;0x03;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_CANCEL   = &#x27;
                         &#x27;0x04;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_RESUME   = &#x27;
                         &#x27;0x05;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_COMPLETE = &#x27;
                         &#x27;0x06;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_RUNNING  = &#x27;
                         &#x27;0x07;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private static final String DOWNLOAD_URL      =\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;&quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;\n&#x27;
                         &#x27;  @Bind(R.id.progressBar) &#x27;
                         &#x27;HorizontalProgressBarWithNumber mPb;\n&#x27;
                         &#x27;  @Bind(R.id.start)       &#x27;
                         &#x27;Button                          mStart;\n&#x27;
                         &#x27;  @Bind(R.id.stop)        &#x27;
                         &#x27;Button                          mStop;\n&#x27;
                         &#x27;  @Bind(R.id.cancel)      &#x27;
                         &#x27;Button                          mCancel;\n&#x27;
                         &#x27;  @Bind(R.id.size)        &#x27;
                         &#x27;TextView                        mSize;\n&#x27;
                         &#x27;  @Bind(R.id.toolbar)     &#x27;
                         &#x27;Toolbar                         toolbar;\n&#x27;
                         &#x27;  @Bind(R.id.speed)       &#x27;
                         &#x27;TextView                        mSpeed;\n&#x27;
                         &#x27;  @Bind(R.id.img)         &#x27;
                         &#x27;ImageView                       mImg;\n&#x27;
                         &#x27;  private                 &#x27;
                         &#x27;DownloadEntity                  mEntity;\n&#x27;
                         &#x27;  private BroadcastReceiver mReceiver = new &#x27;
                         &#x27;BroadcastReceiver() {\n&#x27;
                         &#x27;    @Override public void onReceive(Context context, &#x27;
                         &#x27;Intent intent) {\n&#x27;
                         &#x27;      String action = intent.getAction();\n&#x27;
                         &#x27;      if (action.equals(Aria.ACTION_START)) {\n&#x27;
                         &#x27;        L.d(&quot;START&quot;);\n&#x27;
                         &#x27;      }\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  };\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private Handler mUpdateHandler = new Handler() {\n&#x27;
                         &#x27;    @Override public void handleMessage(Message msg) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      super.handleMessage(msg);\n&#x27;
                         &#x27;      switch (msg.what) {\n&#x27;
                         &#x27;        case DOWNLOAD_RUNNING:\n&#x27;
                         &#x27;          Task task = (Task) msg.obj;\n&#x27;
                         &#x27;          long current = task.getCurrentProgress();\n&#x27;
                         &#x27;          long len = task.getFileSize();\n&#x27;
                         &#x27;          if (len == 0) {\n&#x27;
                         &#x27;            mPb.setProgress(0);\n&#x27;
                         &#x27;          } else {\n&#x27;
                         &#x27;            mPb.setProgress((int) ((current * 100) / &#x27;
                         &#x27;len));\n&#x27;
                         &#x27;          }\n&#x27;
                         &#x27;          &#x27;
                         &#x27;mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) &#x27;
                         &#x27;+ &quot;/s&quot;);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_PRE:\n&#x27;
                         &#x27;          &#x27;
                         &#x27;mSize.setText(CommonUtil.formatFileSize((Long) &#x27;
                         &#x27;msg.obj));\n&#x27;
                         &#x27;          setBtState(false);\n&#x27;
                         &#x27;          //mStart.setText(&quot;暂停&quot;);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_FAILE:\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;下载失败&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_STOP:\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;恢复&quot;);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_CANCEL:\n&#x27;
                         &#x27;          mPb.setProgress(0);\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;取消下载&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;开始&quot;);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_RESUME:\n&#x27;
                         &#x27;          //Toast.makeText(SingleTaskActivity.this,\n&#x27;
                         &#x27;          //    &quot;恢复下载，恢复位置 ==&gt; &quot; + &#x27;
                         &#x27;CommonUtil.formatFileSize((Long) msg.obj), &#x27;
                         &#x27;Toast.LENGTH_SHORT)\n&#x27;
                         &#x27;          //    .show();\n&#x27;
                         &#x27;          mStart.setText(&quot;暂停&quot;);\n&#x27;
                         &#x27;          setBtState(false);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_COMPLETE:\n&#x27;
                         &#x27;          mPb.setProgress(100);\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;下载完成&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;重新开始？&quot;);\n&#x27;
                         &#x27;          mCancel.setEnabled(false);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;      }\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  };\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  /**\n&#x27;
                         &#x27;   * 设置start 和 stop 按钮状态\n&#x27;
                         &#x27;   */\n&#x27;
                         &#x27;  private void setBtState(boolean state) {\n&#x27;
                         &#x27;    mStart.setEnabled(state);\n&#x27;
                         &#x27;    mStop.setEnabled(!state);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onCreate(Bundle &#x27;
                         &#x27;savedInstanceState) {\n&#x27;
                         &#x27;    super.onCreate(savedInstanceState);\n&#x27;
                         &#x27;    init();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onResume() {\n&#x27;
                         &#x27;    super.onResume();\n&#x27;
                         &#x27;    Aria.whit(this).addSchedulerListener(new &#x27;
                         &#x27;MySchedulerListener());\n&#x27;
                         &#x27;    //registerReceiver(mReceiver, &#x27;
                         &#x27;getModule(DownloadModule.class).getDownloadFilter());\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onDestroy() {\n&#x27;
                         &#x27;    super.onDestroy();\n&#x27;
                         &#x27;    //unregisterReceiver(mReceiver);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected int setLayoutId() {\n&#x27;
                         &#x27;    return R.layout.activity_single;\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void init(Bundle &#x27;
                         &#x27;savedInstanceState) {\n&#x27;
                         &#x27;    super.init(savedInstanceState);\n&#x27;
                         &#x27;    setSupportActionBar(toolbar);\n&#x27;
                         &#x27;    toolbar.setTitle(&quot;单任务下载&quot;);\n&#x27;
                         &#x27;    init();\n&#x27;
                         &#x27;    Aria.get(this).openBroadcast(true);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void init() {\n&#x27;
                         &#x27;    if (Aria.get(this).taskExists(DOWNLOAD_URL)) {\n&#x27;
                         &#x27;      AMTarget target = &#x27;
                         &#x27;Aria.whit(this).load(DOWNLOAD_URL);\n&#x27;
                         &#x27;      int      p      = (int) &#x27;
                         &#x27;(target.getCurrentProgress() * 100 / &#x27;
                         &#x27;target.getFileSize());\n&#x27;
                         &#x27;      mPb.setProgress(p);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  public void onClick(View view) {\n&#x27;
                         &#x27;    switch (view.getId()) {\n&#x27;
                         &#x27;      case R.id.start:\n&#x27;
                         &#x27;        String text = ((TextView) &#x27;
                         &#x27;view).getText().toString();\n&#x27;
                         &#x27;        if (text.equals(&quot;重新开始？&quot;) || &#x27;
                         &#x27;text.equals(&quot;开始&quot;)) {\n&#x27;
                         &#x27;          start();\n&#x27;
                         &#x27;        } else if (text.equals(&quot;恢复&quot;)) {\n&#x27;
                         &#x27;          resume();\n&#x27;
                         &#x27;        }\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;      case R.id.stop:\n&#x27;
                         &#x27;        stop();\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;      case R.id.cancel:\n&#x27;
                         &#x27;        cancel();\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void resume() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).resume();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void start() {\n&#x27;
                         &#x27;    Aria.whit(this)\n&#x27;
                         &#x27;        .load(DOWNLOAD_URL)\n&#x27;
                         &#x27;        &#x27;
                         &#x27;.setDownloadPath(Environment.getExternalStorageDirectory().getPath() &#x27;
                         &#x27;+ &quot;/test.apk&quot;)\n&#x27;
                         &#x27;        .setDownloadName(&quot;test.apk&quot;)\n&#x27;
                         &#x27;        .start();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void stop() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).stop();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void cancel() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).cancel();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private class MySchedulerListener extends &#x27;
                         &#x27;Aria.SimpleSchedulerListener {\n&#x27;
                         &#x27;    @Override public void onTaskStart(Task task) {\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, &#x27;
                         &#x27;task.getDownloadEntity().getFileSize())\n&#x27;
                         &#x27;          .sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskResume(Task task) {\n&#x27;
                         &#x27;      super.onTaskResume(task);\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, &#x27;
                         &#x27;task.getFileSize()).sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskStop(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskCancel(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskFail(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskComplete(Task task) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskRunning(Task task) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, &#x27;
                         &#x27;task).sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;}\n&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;/*\n&#x27;
                         &#x27; * Copyright (C) 2016 &#x27;
                         &#x27;AriaLyy(https://github.com/AriaLyy/Aria)\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; * Licensed under the Apache License, Version 2.0 &#x27;
                         &#x27;(the &quot;License&quot;);\n&#x27;
                         &#x27; * you may not use this file except in compliance &#x27;
                         &#x27;with the License.\n&#x27;
                         &#x27; * You may obtain a copy of the License at\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; *      http://www.apache.org/licenses/LICENSE-2.0\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; * Unless required by applicable law or agreed to in &#x27;
                         &#x27;writing, software\n&#x27;
                         &#x27; * distributed under the License is distributed on &#x27;
                         &#x27;an &quot;AS IS&quot; BASIS,\n&#x27;
                         &#x27; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, &#x27;
                         &#x27;either express or implied.\n&#x27;
                         &#x27; * See the License for the specific language &#x27;
                         &#x27;governing permissions and\n&#x27;
                         &#x27; * limitations under the License.\n&#x27;
                         &#x27; */\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;package com.arialyy.simple.single_task;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;import android.content.BroadcastReceiver;\n&#x27;
                         &#x27;import android.content.Context;\n&#x27;
                         &#x27;import android.content.Intent;\n&#x27;
                         &#x27;import android.os.Bundle;\n&#x27;
                         &#x27;import android.os.Environment;\n&#x27;
                         &#x27;import android.os.Handler;\n&#x27;
                         &#x27;import android.os.Message;\n&#x27;
                         &#x27;import android.support.v7.widget.Toolbar;\n&#x27;
                         &#x27;import android.view.View;\n&#x27;
                         &#x27;import android.widget.Button;\n&#x27;
                         &#x27;import android.widget.ImageView;\n&#x27;
                         &#x27;import android.widget.TextView;\n&#x27;
                         &#x27;import android.widget.Toast;\n&#x27;
                         &#x27;import butterknife.Bind;\n&#x27;
                         &#x27;import com.arialyy.aria.core.AMTarget;\n&#x27;
                         &#x27;import com.arialyy.aria.core.Aria;\n&#x27;
                         &#x27;import com.arialyy.aria.core.DownloadEntity;\n&#x27;
                         &#x27;import com.arialyy.aria.core.task.DownloadUtil;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.aria.core.task.IDownloadListener;\n&#x27;
                         &#x27;import com.arialyy.aria.core.task.Task;\n&#x27;
                         &#x27;import com.arialyy.aria.util.CommonUtil;\n&#x27;
                         &#x27;import com.arialyy.frame.util.show.L;\n&#x27;
                         &#x27;import com.arialyy.simple.R;\n&#x27;
                         &#x27;import com.arialyy.simple.base.BaseActivity;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.simple.databinding.ActivitySingleBinding;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.simple.widget.HorizontalProgressBarWithNumber;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;public class SingleTaskActivity extends &#x27;
                         &#x27;BaseActivity&lt;ActivitySingleBinding&gt; {\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_PRE      = &#x27;
                         &#x27;0x01;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_STOP     = &#x27;
                         &#x27;0x02;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_FAILE    = &#x27;
                         &#x27;0x03;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_CANCEL   = &#x27;
                         &#x27;0x04;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_RESUME   = &#x27;
                         &#x27;0x05;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_COMPLETE = &#x27;
                         &#x27;0x06;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_RUNNING  = &#x27;
                         &#x27;0x07;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private static final String DOWNLOAD_URL      =\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;&quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;\n&#x27;
                         &#x27;  @Bind(R.id.progressBar) &#x27;
                         &#x27;HorizontalProgressBarWithNumber mPb;\n&#x27;
                         &#x27;  @Bind(R.id.start)       &#x27;
                         &#x27;Button                          mStart;\n&#x27;
                         &#x27;  @Bind(R.id.stop)        &#x27;
                         &#x27;Button                          mStop;\n&#x27;
                         &#x27;  @Bind(R.id.cancel)      &#x27;
                         &#x27;Button                          mCancel;\n&#x27;
                         &#x27;  @Bind(R.id.size)        &#x27;
                         &#x27;TextView                        mSize;\n&#x27;
                         &#x27;  @Bind(R.id.toolbar)     &#x27;
                         &#x27;Toolbar                         toolbar;\n&#x27;
                         &#x27;  @Bind(R.id.speed)       &#x27;
                         &#x27;TextView                        mSpeed;\n&#x27;
                         &#x27;  @Bind(R.id.img)         &#x27;
                         &#x27;ImageView                       mImg;\n&#x27;
                         &#x27;  private                 &#x27;
                         &#x27;DownloadEntity                  mEntity;\n&#x27;
                         &#x27;  private BroadcastReceiver mReceiver = new &#x27;
                         &#x27;BroadcastReceiver() {\n&#x27;
                         &#x27;    @Override public void onReceive(Context context, &#x27;
                         &#x27;Intent intent) {\n&#x27;
                         &#x27;      String action = intent.getAction();\n&#x27;
                         &#x27;      if (action.equals(Aria.ACTION_START)) {\n&#x27;
                         &#x27;        L.d(&quot;START&quot;);\n&#x27;
                         &#x27;      }\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  };\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private Handler mUpdateHandler = new Handler() {\n&#x27;
                         &#x27;    @Override public void handleMessage(Message msg) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      super.handleMessage(msg);\n&#x27;
                         &#x27;      switch (msg.what) {\n&#x27;
                         &#x27;        case DOWNLOAD_RUNNING:\n&#x27;
                         &#x27;          Task task = (Task) msg.obj;\n&#x27;
                         &#x27;          long current = task.getCurrentProgress();\n&#x27;
                         &#x27;          long len = task.getFileSize();\n&#x27;
                         &#x27;          if (len == 0) {\n&#x27;
                         &#x27;            mPb.setProgress(0);\n&#x27;
                         &#x27;          } else {\n&#x27;
                         &#x27;            mPb.setProgress((int) ((current * 100) / &#x27;
                         &#x27;len));\n&#x27;
                         &#x27;          }\n&#x27;
                         &#x27;          &#x27;
                         &#x27;mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) &#x27;
                         &#x27;+ &quot;/s&quot;);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_PRE:\n&#x27;
                         &#x27;          &#x27;
                         &#x27;mSize.setText(CommonUtil.formatFileSize((Long) &#x27;
                         &#x27;msg.obj));\n&#x27;
                         &#x27;          setBtState(false);\n&#x27;
                         &#x27;          //mStart.setText(&quot;暂停&quot;);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_FAILE:\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;下载失败&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_STOP:\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;恢复&quot;);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_CANCEL:\n&#x27;
                         &#x27;          mPb.setProgress(0);\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;取消下载&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;开始&quot;);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_RESUME:\n&#x27;
                         &#x27;          //Toast.makeText(SingleTaskActivity.this,\n&#x27;
                         &#x27;          //    &quot;恢复下载，恢复位置 ==&gt; &quot; + &#x27;
                         &#x27;CommonUtil.formatFileSize((Long) msg.obj), &#x27;
                         &#x27;Toast.LENGTH_SHORT)\n&#x27;
                         &#x27;          //    .show();\n&#x27;
                         &#x27;          mStart.setText(&quot;暂停&quot;);\n&#x27;
                         &#x27;          setBtState(false);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_COMPLETE:\n&#x27;
                         &#x27;          mPb.setProgress(100);\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;下载完成&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;重新开始？&quot;);\n&#x27;
                         &#x27;          mCancel.setEnabled(false);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;      }\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  };\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  /**\n&#x27;
                         &#x27;   * 设置start 和 stop 按钮状态\n&#x27;
                         &#x27;   */\n&#x27;
                         &#x27;  private void setBtState(boolean state) {\n&#x27;
                         &#x27;    mStart.setEnabled(state);\n&#x27;
                         &#x27;    mStop.setEnabled(!state);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onCreate(Bundle &#x27;
                         &#x27;savedInstanceState) {\n&#x27;
                         &#x27;    super.onCreate(savedInstanceState);\n&#x27;
                         &#x27;    init();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onResume() {\n&#x27;
                         &#x27;    super.onResume();\n&#x27;
                         &#x27;    Aria.whit(this).addSchedulerListener(new &#x27;
                         &#x27;MySchedulerListener());\n&#x27;
                         &#x27;    //registerReceiver(mReceiver, &#x27;
                         &#x27;getModule(DownloadModule.class).getDownloadFilter());\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onDestroy() {\n&#x27;
                         &#x27;    super.onDestroy();\n&#x27;
                         &#x27;    //unregisterReceiver(mReceiver);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected int setLayoutId() {\n&#x27;
                         &#x27;    return R.layout.activity_single;\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void init(Bundle &#x27;
                         &#x27;savedInstanceState) {\n&#x27;
                         &#x27;    super.init(savedInstanceState);\n&#x27;
                         &#x27;    setSupportActionBar(toolbar);\n&#x27;
                         &#x27;    toolbar.setTitle(&quot;单任务下载&quot;);\n&#x27;
                         &#x27;    init();\n&#x27;
                         &#x27;    Aria.get(this).openBroadcast(true);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void init() {\n&#x27;
                         &#x27;    if (Aria.get(this).taskExists(DOWNLOAD_URL)) {\n&#x27;
                         &#x27;      AMTarget target = &#x27;
                         &#x27;Aria.whit(this).load(DOWNLOAD_URL);\n&#x27;
                         &#x27;      int      p      = (int) &#x27;
                         &#x27;(target.getCurrentProgress() * 100 / &#x27;
                         &#x27;target.getFileSize());\n&#x27;
                         &#x27;      mPb.setProgress(p);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  public void onClick(View view) {\n&#x27;
                         &#x27;    switch (view.getId()) {\n&#x27;
                         &#x27;      case R.id.start:\n&#x27;
                         &#x27;        String text = ((TextView) &#x27;
                         &#x27;view).getText().toString();\n&#x27;
                         &#x27;        if (text.equals(&quot;重新开始？&quot;) || &#x27;
                         &#x27;text.equals(&quot;开始&quot;)) {\n&#x27;
                         &#x27;          start();\n&#x27;
                         &#x27;        } else if (text.equals(&quot;恢复&quot;)) {\n&#x27;
                         &#x27;          resume();\n&#x27;
                         &#x27;        }\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;      case R.id.stop:\n&#x27;
                         &#x27;        stop();\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;      case R.id.cancel:\n&#x27;
                         &#x27;        cancel();\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void resume() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).resume();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void start() {\n&#x27;
                         &#x27;    Aria.whit(this)\n&#x27;
                         &#x27;        .load(DOWNLOAD_URL)\n&#x27;
                         &#x27;        &#x27;
                         &#x27;.setDownloadPath(Environment.getExternalStorageDirectory().getPath() &#x27;
                         &#x27;+ &quot;/test.apk&quot;)\n&#x27;
                         &#x27;        .setDownloadName(&quot;test.apk&quot;)\n&#x27;
                         &#x27;        .start();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void stop() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).stop();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void cancel() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).cancel();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private class MySchedulerListener extends &#x27;
                         &#x27;Aria.SimpleSchedulerListener {\n&#x27;
                         &#x27;    @Override public void onTaskStart(Task task) {\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, &#x27;
                         &#x27;task.getDownloadEntity().getFileSize())\n&#x27;
                         &#x27;          .sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskResume(Task task) {\n&#x27;
                         &#x27;      super.onTaskResume(task);\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, &#x27;
                         &#x27;task.getFileSize()).sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskStop(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskCancel(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskFail(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskComplete(Task task) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskRunning(Task task) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, &#x27;
                         &#x27;task).sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;}\n&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;/*\n&#x27;
                         &#x27; * Copyright (C) 2016 &#x27;
                         &#x27;AriaLyy(https://github.com/AriaLyy/Aria)\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; * Licensed under the Apache License, Version 2.0 &#x27;
                         &#x27;(the &quot;License&quot;);\n&#x27;
                         &#x27; * you may not use this file except in compliance &#x27;
                         &#x27;with the License.\n&#x27;
                         &#x27; * You may obtain a copy of the License at\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; *      http://www.apache.org/licenses/LICENSE-2.0\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; * Unless required by applicable law or agreed to in &#x27;
                         &#x27;writing, software\n&#x27;
                         &#x27; * distributed under the License is distributed on &#x27;
                         &#x27;an &quot;AS IS&quot; BASIS,\n&#x27;
                         &#x27; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, &#x27;
                         &#x27;either express or implied.\n&#x27;
                         &#x27; * See the License for the specific language &#x27;
                         &#x27;governing permissions and\n&#x27;
                         &#x27; * limitations under the License.\n&#x27;
                         &#x27; */\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;package com.arialyy.simple.single_task;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;import android.content.BroadcastReceiver;\n&#x27;
                         &#x27;import android.content.Context;\n&#x27;
                         &#x27;import android.content.Intent;\n&#x27;
                         &#x27;import android.os.Bundle;\n&#x27;
                         &#x27;import android.os.Environment;\n&#x27;
                         &#x27;import android.os.Handler;\n&#x27;
                         &#x27;import android.os.Message;\n&#x27;
                         &#x27;import android.support.v7.widget.Toolbar;\n&#x27;
                         &#x27;import android.view.View;\n&#x27;
                         &#x27;import android.widget.Button;\n&#x27;
                         &#x27;import android.widget.ImageView;\n&#x27;
                         &#x27;import android.widget.TextView;\n&#x27;
                         &#x27;import android.widget.Toast;\n&#x27;
                         &#x27;import butterknife.Bind;\n&#x27;
                         &#x27;import com.arialyy.aria.core.AMTarget;\n&#x27;
                         &#x27;import com.arialyy.aria.core.Aria;\n&#x27;
                         &#x27;import com.arialyy.aria.core.DownloadEntity;\n&#x27;
                         &#x27;import com.arialyy.aria.core.task.DownloadUtil;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.aria.core.task.IDownloadListener;\n&#x27;
                         &#x27;import com.arialyy.aria.core.task.Task;\n&#x27;
                         &#x27;import com.arialyy.aria.util.CommonUtil;\n&#x27;
                         &#x27;import com.arialyy.frame.util.show.L;\n&#x27;
                         &#x27;import com.arialyy.simple.R;\n&#x27;
                         &#x27;import com.arialyy.simple.base.BaseActivity;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.simple.databinding.ActivitySingleBinding;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.simple.widget.HorizontalProgressBarWithNumber;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;public class SingleTaskActivity extends &#x27;
                         &#x27;BaseActivity&lt;ActivitySingleBinding&gt; {\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_PRE      = &#x27;
                         &#x27;0x01;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_STOP     = &#x27;
                         &#x27;0x02;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_FAILE    = &#x27;
                         &#x27;0x03;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_CANCEL   = &#x27;
                         &#x27;0x04;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_RESUME   = &#x27;
                         &#x27;0x05;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_COMPLETE = &#x27;
                         &#x27;0x06;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_RUNNING  = &#x27;
                         &#x27;0x07;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private static final String DOWNLOAD_URL      =\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;&quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;\n&#x27;
                         &#x27;  @Bind(R.id.progressBar) &#x27;
                         &#x27;HorizontalProgressBarWithNumber mPb;\n&#x27;
                         &#x27;  @Bind(R.id.start)       &#x27;
                         &#x27;Button                          mStart;\n&#x27;
                         &#x27;  @Bind(R.id.stop)        &#x27;
                         &#x27;Button                          mStop;\n&#x27;
                         &#x27;  @Bind(R.id.cancel)      &#x27;
                         &#x27;Button                          mCancel;\n&#x27;
                         &#x27;  @Bind(R.id.size)        &#x27;
                         &#x27;TextView                        mSize;\n&#x27;
                         &#x27;  @Bind(R.id.toolbar)     &#x27;
                         &#x27;Toolbar                         toolbar;\n&#x27;
                         &#x27;  @Bind(R.id.speed)       &#x27;
                         &#x27;TextView                        mSpeed;\n&#x27;
                         &#x27;  @Bind(R.id.img)         &#x27;
                         &#x27;ImageView                       mImg;\n&#x27;
                         &#x27;  private                 &#x27;
                         &#x27;DownloadEntity                  mEntity;\n&#x27;
                         &#x27;  private BroadcastReceiver mReceiver = new &#x27;
                         &#x27;BroadcastReceiver() {\n&#x27;
                         &#x27;    @Override public void onReceive(Context context, &#x27;
                         &#x27;Intent intent) {\n&#x27;
                         &#x27;      String action = intent.getAction();\n&#x27;
                         &#x27;      if (action.equals(Aria.ACTION_START)) {\n&#x27;
                         &#x27;        L.d(&quot;START&quot;);\n&#x27;
                         &#x27;      }\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  };\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private Handler mUpdateHandler = new Handler() {\n&#x27;
                         &#x27;    @Override public void handleMessage(Message msg) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      super.handleMessage(msg);\n&#x27;
                         &#x27;      switch (msg.what) {\n&#x27;
                         &#x27;        case DOWNLOAD_RUNNING:\n&#x27;
                         &#x27;          Task task = (Task) msg.obj;\n&#x27;
                         &#x27;          long current = task.getCurrentProgress();\n&#x27;
                         &#x27;          long len = task.getFileSize();\n&#x27;
                         &#x27;          if (len == 0) {\n&#x27;
                         &#x27;            mPb.setProgress(0);\n&#x27;
                         &#x27;          } else {\n&#x27;
                         &#x27;            mPb.setProgress((int) ((current * 100) / &#x27;
                         &#x27;len));\n&#x27;
                         &#x27;          }\n&#x27;
                         &#x27;          &#x27;
                         &#x27;mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) &#x27;
                         &#x27;+ &quot;/s&quot;);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_PRE:\n&#x27;
                         &#x27;          &#x27;
                         &#x27;mSize.setText(CommonUtil.formatFileSize((Long) &#x27;
                         &#x27;msg.obj));\n&#x27;
                         &#x27;          setBtState(false);\n&#x27;
                         &#x27;          //mStart.setText(&quot;暂停&quot;);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_FAILE:\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;下载失败&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_STOP:\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;恢复&quot;);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_CANCEL:\n&#x27;
                         &#x27;          mPb.setProgress(0);\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;取消下载&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;开始&quot;);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_RESUME:\n&#x27;
                         &#x27;          //Toast.makeText(SingleTaskActivity.this,\n&#x27;
                         &#x27;          //    &quot;恢复下载，恢复位置 ==&gt; &quot; + &#x27;
                         &#x27;CommonUtil.formatFileSize((Long) msg.obj), &#x27;
                         &#x27;Toast.LENGTH_SHORT)\n&#x27;
                         &#x27;          //    .show();\n&#x27;
                         &#x27;          mStart.setText(&quot;暂停&quot;);\n&#x27;
                         &#x27;          setBtState(false);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_COMPLETE:\n&#x27;
                         &#x27;          mPb.setProgress(100);\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;下载完成&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;重新开始？&quot;);\n&#x27;
                         &#x27;          mCancel.setEnabled(false);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;      }\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  };\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  /**\n&#x27;
                         &#x27;   * 设置start 和 stop 按钮状态\n&#x27;
                         &#x27;   */\n&#x27;
                         &#x27;  private void setBtState(boolean state) {\n&#x27;
                         &#x27;    mStart.setEnabled(state);\n&#x27;
                         &#x27;    mStop.setEnabled(!state);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onCreate(Bundle &#x27;
                         &#x27;savedInstanceState) {\n&#x27;
                         &#x27;    super.onCreate(savedInstanceState);\n&#x27;
                         &#x27;    init();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onResume() {\n&#x27;
                         &#x27;    super.onResume();\n&#x27;
                         &#x27;    Aria.whit(this).addSchedulerListener(new &#x27;
                         &#x27;MySchedulerListener());\n&#x27;
                         &#x27;    //registerReceiver(mReceiver, &#x27;
                         &#x27;getModule(DownloadModule.class).getDownloadFilter());\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onDestroy() {\n&#x27;
                         &#x27;    super.onDestroy();\n&#x27;
                         &#x27;    //unregisterReceiver(mReceiver);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected int setLayoutId() {\n&#x27;
                         &#x27;    return R.layout.activity_single;\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void init(Bundle &#x27;
                         &#x27;savedInstanceState) {\n&#x27;
                         &#x27;    super.init(savedInstanceState);\n&#x27;
                         &#x27;    setSupportActionBar(toolbar);\n&#x27;
                         &#x27;    toolbar.setTitle(&quot;单任务下载&quot;);\n&#x27;
                         &#x27;    init();\n&#x27;
                         &#x27;    Aria.get(this).openBroadcast(true);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void init() {\n&#x27;
                         &#x27;    if (Aria.get(this).taskExists(DOWNLOAD_URL)) {\n&#x27;
                         &#x27;      AMTarget target = &#x27;
                         &#x27;Aria.whit(this).load(DOWNLOAD_URL);\n&#x27;
                         &#x27;      int      p      = (int) &#x27;
                         &#x27;(target.getCurrentProgress() * 100 / &#x27;
                         &#x27;target.getFileSize());\n&#x27;
                         &#x27;      mPb.setProgress(p);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  public void onClick(View view) {\n&#x27;
                         &#x27;    switch (view.getId()) {\n&#x27;
                         &#x27;      case R.id.start:\n&#x27;
                         &#x27;        String text = ((TextView) &#x27;
                         &#x27;view).getText().toString();\n&#x27;
                         &#x27;        if (text.equals(&quot;重新开始？&quot;) || &#x27;
                         &#x27;text.equals(&quot;开始&quot;)) {\n&#x27;
                         &#x27;          start();\n&#x27;
                         &#x27;        } else if (text.equals(&quot;恢复&quot;)) {\n&#x27;
                         &#x27;          resume();\n&#x27;
                         &#x27;        }\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;      case R.id.stop:\n&#x27;
                         &#x27;        stop();\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;      case R.id.cancel:\n&#x27;
                         &#x27;        cancel();\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void resume() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).resume();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void start() {\n&#x27;
                         &#x27;    Aria.whit(this)\n&#x27;
                         &#x27;        .load(DOWNLOAD_URL)\n&#x27;
                         &#x27;        &#x27;
                         &#x27;.setDownloadPath(Environment.getExternalStorageDirectory().getPath() &#x27;
                         &#x27;+ &quot;/test.apk&quot;)\n&#x27;
                         &#x27;        .setDownloadName(&quot;test.apk&quot;)\n&#x27;
                         &#x27;        .start();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void stop() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).stop();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void cancel() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).cancel();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private class MySchedulerListener extends &#x27;
                         &#x27;Aria.SimpleSchedulerListener {\n&#x27;
                         &#x27;    @Override public void onTaskStart(Task task) {\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, &#x27;
                         &#x27;task.getDownloadEntity().getFileSize())\n&#x27;
                         &#x27;          .sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskResume(Task task) {\n&#x27;
                         &#x27;      super.onTaskResume(task);\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, &#x27;
                         &#x27;task.getFileSize()).sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskStop(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskCancel(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskFail(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskComplete(Task task) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskRunning(Task task) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, &#x27;
                         &#x27;task).sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;}\n&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;\n&#x27;}],
   &#x27;mergers&#x27;: {&#x27;baseline&#x27;, &#x27;spork&#x27;, &#x27;jfstmerge&#x27;}}],
 [{&#x27;eq&#x27;: [{&#x27;CHUNK_OURS&#x27;: &#x27;/*\n&#x27;
                         &#x27; * Copyright (C) 2016 &#x27;
                         &#x27;AriaLyy(https://github.com/AriaLyy/Aria)\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; * Licensed under the Apache License, Version 2.0 &#x27;
                         &#x27;(the &quot;License&quot;);\n&#x27;
                         &#x27; * you may not use this file except in compliance &#x27;
                         &#x27;with the License.\n&#x27;
                         &#x27; * You may obtain a copy of the License at\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; *      http://www.apache.org/licenses/LICENSE-2.0\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; * Unless required by applicable law or agreed to in &#x27;
                         &#x27;writing, software\n&#x27;
                         &#x27; * distributed under the License is distributed on &#x27;
                         &#x27;an &quot;AS IS&quot; BASIS,\n&#x27;
                         &#x27; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, &#x27;
                         &#x27;either express or implied.\n&#x27;
                         &#x27; * See the License for the specific language &#x27;
                         &#x27;governing permissions and\n&#x27;
                         &#x27; * limitations under the License.\n&#x27;
                         &#x27; */\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;package com.arialyy.simple.single_task;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;import android.content.BroadcastReceiver;\n&#x27;
                         &#x27;import android.content.Context;\n&#x27;
                         &#x27;import android.content.Intent;\n&#x27;
                         &#x27;import android.os.Bundle;\n&#x27;
                         &#x27;import android.os.Environment;\n&#x27;
                         &#x27;import android.os.Handler;\n&#x27;
                         &#x27;import android.os.Message;\n&#x27;
                         &#x27;import android.support.v7.widget.Toolbar;\n&#x27;
                         &#x27;import android.view.View;\n&#x27;
                         &#x27;import android.widget.Button;\n&#x27;
                         &#x27;import android.widget.ImageView;\n&#x27;
                         &#x27;import android.widget.TextView;\n&#x27;
                         &#x27;import android.widget.Toast;\n&#x27;
                         &#x27;import butterknife.Bind;\n&#x27;
                         &#x27;import com.arialyy.aria.core.AMTarget;\n&#x27;
                         &#x27;import com.arialyy.aria.core.Aria;\n&#x27;
                         &#x27;import com.arialyy.aria.core.DownloadEntity;\n&#x27;
                         &#x27;import com.arialyy.aria.core.task.DownloadUtil;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.aria.core.task.IDownloadListener;\n&#x27;
                         &#x27;import com.arialyy.aria.core.task.Task;\n&#x27;
                         &#x27;import com.arialyy.aria.util.CommonUtil;\n&#x27;
                         &#x27;import com.arialyy.frame.util.show.L;\n&#x27;
                         &#x27;import com.arialyy.simple.R;\n&#x27;
                         &#x27;import com.arialyy.simple.base.BaseActivity;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.simple.databinding.ActivitySingleBinding;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.simple.widget.HorizontalProgressBarWithNumber;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;public class SingleTaskActivity extends &#x27;
                         &#x27;BaseActivity&lt;ActivitySingleBinding&gt; {\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_PRE      = &#x27;
                         &#x27;0x01;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_STOP     = &#x27;
                         &#x27;0x02;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_FAILE    = &#x27;
                         &#x27;0x03;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_CANCEL   = &#x27;
                         &#x27;0x04;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_RESUME   = &#x27;
                         &#x27;0x05;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_COMPLETE = &#x27;
                         &#x27;0x06;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_RUNNING  = &#x27;
                         &#x27;0x07;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private static final String DOWNLOAD_URL      =\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;&quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;\n&#x27;
                         &#x27;  @Bind(R.id.progressBar) &#x27;
                         &#x27;HorizontalProgressBarWithNumber mPb;\n&#x27;
                         &#x27;  @Bind(R.id.start)       &#x27;
                         &#x27;Button                          mStart;\n&#x27;
                         &#x27;  @Bind(R.id.stop)        &#x27;
                         &#x27;Button                          mStop;\n&#x27;
                         &#x27;  @Bind(R.id.cancel)      &#x27;
                         &#x27;Button                          mCancel;\n&#x27;
                         &#x27;  @Bind(R.id.size)        &#x27;
                         &#x27;TextView                        mSize;\n&#x27;
                         &#x27;  @Bind(R.id.toolbar)     &#x27;
                         &#x27;Toolbar                         toolbar;\n&#x27;
                         &#x27;  @Bind(R.id.speed)       &#x27;
                         &#x27;TextView                        mSpeed;\n&#x27;
                         &#x27;  @Bind(R.id.img)         &#x27;
                         &#x27;ImageView                       mImg;\n&#x27;
                         &#x27;  private                 &#x27;
                         &#x27;DownloadEntity                  mEntity;\n&#x27;
                         &#x27;  private BroadcastReceiver mReceiver = new &#x27;
                         &#x27;BroadcastReceiver() {\n&#x27;
                         &#x27;    @Override public void onReceive(Context context, &#x27;
                         &#x27;Intent intent) {\n&#x27;
                         &#x27;      String action = intent.getAction();\n&#x27;
                         &#x27;      if (action.equals(Aria.ACTION_START)) {\n&#x27;
                         &#x27;        L.d(&quot;START&quot;);\n&#x27;
                         &#x27;      }\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  };\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private Handler mUpdateHandler = new Handler() {\n&#x27;
                         &#x27;    @Override public void handleMessage(Message msg) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      super.handleMessage(msg);\n&#x27;
                         &#x27;      switch (msg.what) {\n&#x27;
                         &#x27;        case DOWNLOAD_RUNNING:\n&#x27;
                         &#x27;          Task task = (Task) msg.obj;\n&#x27;
                         &#x27;          long current = task.getCurrentProgress();\n&#x27;
                         &#x27;          long len = task.getFileSize();\n&#x27;
                         &#x27;          if (len == 0) {\n&#x27;
                         &#x27;            mPb.setProgress(0);\n&#x27;
                         &#x27;          } else {\n&#x27;
                         &#x27;            mPb.setProgress((int) ((current * 100) / &#x27;
                         &#x27;len));\n&#x27;
                         &#x27;          }\n&#x27;
                         &#x27;          &#x27;
                         &#x27;mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) &#x27;
                         &#x27;+ &quot;/s&quot;);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_PRE:\n&#x27;
                         &#x27;          &#x27;
                         &#x27;mSize.setText(CommonUtil.formatFileSize((Long) &#x27;
                         &#x27;msg.obj));\n&#x27;
                         &#x27;          setBtState(false);\n&#x27;
                         &#x27;          //mStart.setText(&quot;暂停&quot;);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_FAILE:\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;下载失败&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_STOP:\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;恢复&quot;);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_CANCEL:\n&#x27;
                         &#x27;          mPb.setProgress(0);\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;取消下载&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;开始&quot;);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_RESUME:\n&#x27;
                         &#x27;          //Toast.makeText(SingleTaskActivity.this,\n&#x27;
                         &#x27;          //    &quot;恢复下载，恢复位置 ==&gt; &quot; + &#x27;
                         &#x27;CommonUtil.formatFileSize((Long) msg.obj), &#x27;
                         &#x27;Toast.LENGTH_SHORT)\n&#x27;
                         &#x27;          //    .show();\n&#x27;
                         &#x27;          mStart.setText(&quot;暂停&quot;);\n&#x27;
                         &#x27;          setBtState(false);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_COMPLETE:\n&#x27;
                         &#x27;          mPb.setProgress(100);\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;下载完成&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;重新开始？&quot;);\n&#x27;
                         &#x27;          mCancel.setEnabled(false);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;      }\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  };\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  /**\n&#x27;
                         &#x27;   * 设置start 和 stop 按钮状态\n&#x27;
                         &#x27;   */\n&#x27;
                         &#x27;  private void setBtState(boolean state) {\n&#x27;
                         &#x27;    mStart.setEnabled(state);\n&#x27;
                         &#x27;    mStop.setEnabled(!state);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onCreate(Bundle &#x27;
                         &#x27;savedInstanceState) {\n&#x27;
                         &#x27;    super.onCreate(savedInstanceState);\n&#x27;
                         &#x27;    init();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onResume() {\n&#x27;
                         &#x27;    super.onResume();\n&#x27;
                         &#x27;    Aria.whit(this).addSchedulerListener(new &#x27;
                         &#x27;MySchedulerListener());\n&#x27;
                         &#x27;    //registerReceiver(mReceiver, &#x27;
                         &#x27;getModule(DownloadModule.class).getDownloadFilter());\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onDestroy() {\n&#x27;
                         &#x27;    super.onDestroy();\n&#x27;
                         &#x27;    //unregisterReceiver(mReceiver);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected int setLayoutId() {\n&#x27;
                         &#x27;    return R.layout.activity_single;\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void init(Bundle &#x27;
                         &#x27;savedInstanceState) {\n&#x27;
                         &#x27;    super.init(savedInstanceState);\n&#x27;
                         &#x27;    setSupportActionBar(toolbar);\n&#x27;
                         &#x27;    toolbar.setTitle(&quot;单任务下载&quot;);\n&#x27;
                         &#x27;    init();\n&#x27;
                         &#x27;    Aria.get(this).openBroadcast(true);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void init() {\n&#x27;
                         &#x27;    if (Aria.get(this).taskExists(DOWNLOAD_URL)) {\n&#x27;
                         &#x27;      AMTarget target = &#x27;
                         &#x27;Aria.whit(this).load(DOWNLOAD_URL);\n&#x27;
                         &#x27;      int      p      = (int) &#x27;
                         &#x27;(target.getCurrentProgress() * 100 / &#x27;
                         &#x27;target.getFileSize());\n&#x27;
                         &#x27;      mPb.setProgress(p);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  public void onClick(View view) {\n&#x27;
                         &#x27;    switch (view.getId()) {\n&#x27;
                         &#x27;      case R.id.start:\n&#x27;
                         &#x27;        String text = ((TextView) &#x27;
                         &#x27;view).getText().toString();\n&#x27;
                         &#x27;        if (text.equals(&quot;重新开始？&quot;) || &#x27;
                         &#x27;text.equals(&quot;开始&quot;)) {\n&#x27;
                         &#x27;          start();\n&#x27;
                         &#x27;        } else if (text.equals(&quot;恢复&quot;)) {\n&#x27;
                         &#x27;          resume();\n&#x27;
                         &#x27;        }\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;      case R.id.stop:\n&#x27;
                         &#x27;        stop();\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;      case R.id.cancel:\n&#x27;
                         &#x27;        cancel();\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void resume() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).resume();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void start() {\n&#x27;
                         &#x27;    Aria.whit(this)\n&#x27;
                         &#x27;        .load(DOWNLOAD_URL)\n&#x27;
                         &#x27;        &#x27;
                         &#x27;.setDownloadPath(Environment.getExternalStorageDirectory().getPath() &#x27;
                         &#x27;+ &quot;/test.apk&quot;)\n&#x27;
                         &#x27;        .setDownloadName(&quot;test.apk&quot;)\n&#x27;
                         &#x27;        .start();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void stop() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).stop();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void cancel() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).cancel();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private class MySchedulerListener extends &#x27;
                         &#x27;Aria.SimpleSchedulerListener {\n&#x27;
                         &#x27;    @Override public void onTaskStart(Task task) {\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, &#x27;
                         &#x27;task.getDownloadEntity().getFileSize())\n&#x27;
                         &#x27;          .sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskResume(Task task) {\n&#x27;
                         &#x27;      super.onTaskResume(task);\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, &#x27;
                         &#x27;task.getFileSize()).sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskStop(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskCancel(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskFail(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskComplete(Task task) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskRunning(Task task) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, &#x27;
                         &#x27;task).sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;}\n&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;/*\n&#x27;
                         &#x27; * Copyright (C) 2016 &#x27;
                         &#x27;AriaLyy(https://github.com/AriaLyy/Aria)\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; * Licensed under the Apache License, Version 2.0 &#x27;
                         &#x27;(the &quot;License&quot;);\n&#x27;
                         &#x27; * you may not use this file except in compliance &#x27;
                         &#x27;with the License.\n&#x27;
                         &#x27; * You may obtain a copy of the License at\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; *      http://www.apache.org/licenses/LICENSE-2.0\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; * Unless required by applicable law or agreed to in &#x27;
                         &#x27;writing, software\n&#x27;
                         &#x27; * distributed under the License is distributed on &#x27;
                         &#x27;an &quot;AS IS&quot; BASIS,\n&#x27;
                         &#x27; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, &#x27;
                         &#x27;either express or implied.\n&#x27;
                         &#x27; * See the License for the specific language &#x27;
                         &#x27;governing permissions and\n&#x27;
                         &#x27; * limitations under the License.\n&#x27;
                         &#x27; */\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;package com.arialyy.simple.single_task;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;import android.content.BroadcastReceiver;\n&#x27;
                         &#x27;import android.content.Context;\n&#x27;
                         &#x27;import android.content.Intent;\n&#x27;
                         &#x27;import android.os.Bundle;\n&#x27;
                         &#x27;import android.os.Environment;\n&#x27;
                         &#x27;import android.os.Handler;\n&#x27;
                         &#x27;import android.os.Message;\n&#x27;
                         &#x27;import android.support.v7.widget.Toolbar;\n&#x27;
                         &#x27;import android.view.View;\n&#x27;
                         &#x27;import android.widget.Button;\n&#x27;
                         &#x27;import android.widget.ImageView;\n&#x27;
                         &#x27;import android.widget.TextView;\n&#x27;
                         &#x27;import android.widget.Toast;\n&#x27;
                         &#x27;import butterknife.Bind;\n&#x27;
                         &#x27;import com.arialyy.aria.core.AMTarget;\n&#x27;
                         &#x27;import com.arialyy.aria.core.Aria;\n&#x27;
                         &#x27;import com.arialyy.aria.core.DownloadEntity;\n&#x27;
                         &#x27;import com.arialyy.aria.core.task.DownloadUtil;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.aria.core.task.IDownloadListener;\n&#x27;
                         &#x27;import com.arialyy.aria.core.task.Task;\n&#x27;
                         &#x27;import com.arialyy.aria.util.CommonUtil;\n&#x27;
                         &#x27;import com.arialyy.frame.util.show.L;\n&#x27;
                         &#x27;import com.arialyy.simple.R;\n&#x27;
                         &#x27;import com.arialyy.simple.base.BaseActivity;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.simple.databinding.ActivitySingleBinding;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.simple.widget.HorizontalProgressBarWithNumber;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;public class SingleTaskActivity extends &#x27;
                         &#x27;BaseActivity&lt;ActivitySingleBinding&gt; {\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_PRE      = &#x27;
                         &#x27;0x01;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_STOP     = &#x27;
                         &#x27;0x02;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_FAILE    = &#x27;
                         &#x27;0x03;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_CANCEL   = &#x27;
                         &#x27;0x04;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_RESUME   = &#x27;
                         &#x27;0x05;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_COMPLETE = &#x27;
                         &#x27;0x06;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_RUNNING  = &#x27;
                         &#x27;0x07;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private static final String DOWNLOAD_URL      =\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;&quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;\n&#x27;
                         &#x27;  @Bind(R.id.progressBar) &#x27;
                         &#x27;HorizontalProgressBarWithNumber mPb;\n&#x27;
                         &#x27;  @Bind(R.id.start)       &#x27;
                         &#x27;Button                          mStart;\n&#x27;
                         &#x27;  @Bind(R.id.stop)        &#x27;
                         &#x27;Button                          mStop;\n&#x27;
                         &#x27;  @Bind(R.id.cancel)      &#x27;
                         &#x27;Button                          mCancel;\n&#x27;
                         &#x27;  @Bind(R.id.size)        &#x27;
                         &#x27;TextView                        mSize;\n&#x27;
                         &#x27;  @Bind(R.id.toolbar)     &#x27;
                         &#x27;Toolbar                         toolbar;\n&#x27;
                         &#x27;  @Bind(R.id.speed)       &#x27;
                         &#x27;TextView                        mSpeed;\n&#x27;
                         &#x27;  @Bind(R.id.img)         &#x27;
                         &#x27;ImageView                       mImg;\n&#x27;
                         &#x27;  private                 &#x27;
                         &#x27;DownloadEntity                  mEntity;\n&#x27;
                         &#x27;  private BroadcastReceiver mReceiver = new &#x27;
                         &#x27;BroadcastReceiver() {\n&#x27;
                         &#x27;    @Override public void onReceive(Context context, &#x27;
                         &#x27;Intent intent) {\n&#x27;
                         &#x27;      String action = intent.getAction();\n&#x27;
                         &#x27;      if (action.equals(Aria.ACTION_START)) {\n&#x27;
                         &#x27;        L.d(&quot;START&quot;);\n&#x27;
                         &#x27;      }\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  };\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private Handler mUpdateHandler = new Handler() {\n&#x27;
                         &#x27;    @Override public void handleMessage(Message msg) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      super.handleMessage(msg);\n&#x27;
                         &#x27;      switch (msg.what) {\n&#x27;
                         &#x27;        case DOWNLOAD_RUNNING:\n&#x27;
                         &#x27;          Task task = (Task) msg.obj;\n&#x27;
                         &#x27;          long current = task.getCurrentProgress();\n&#x27;
                         &#x27;          long len = task.getFileSize();\n&#x27;
                         &#x27;          if (len == 0) {\n&#x27;
                         &#x27;            mPb.setProgress(0);\n&#x27;
                         &#x27;          } else {\n&#x27;
                         &#x27;            mPb.setProgress((int) ((current * 100) / &#x27;
                         &#x27;len));\n&#x27;
                         &#x27;          }\n&#x27;
                         &#x27;          &#x27;
                         &#x27;mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) &#x27;
                         &#x27;+ &quot;/s&quot;);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_PRE:\n&#x27;
                         &#x27;          &#x27;
                         &#x27;mSize.setText(CommonUtil.formatFileSize((Long) &#x27;
                         &#x27;msg.obj));\n&#x27;
                         &#x27;          setBtState(false);\n&#x27;
                         &#x27;          //mStart.setText(&quot;暂停&quot;);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_FAILE:\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;下载失败&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_STOP:\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;恢复&quot;);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_CANCEL:\n&#x27;
                         &#x27;          mPb.setProgress(0);\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;取消下载&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;开始&quot;);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_RESUME:\n&#x27;
                         &#x27;          //Toast.makeText(SingleTaskActivity.this,\n&#x27;
                         &#x27;          //    &quot;恢复下载，恢复位置 ==&gt; &quot; + &#x27;
                         &#x27;CommonUtil.formatFileSize((Long) msg.obj), &#x27;
                         &#x27;Toast.LENGTH_SHORT)\n&#x27;
                         &#x27;          //    .show();\n&#x27;
                         &#x27;          mStart.setText(&quot;暂停&quot;);\n&#x27;
                         &#x27;          setBtState(false);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_COMPLETE:\n&#x27;
                         &#x27;          mPb.setProgress(100);\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;下载完成&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;重新开始？&quot;);\n&#x27;
                         &#x27;          mCancel.setEnabled(false);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;      }\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  };\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  /**\n&#x27;
                         &#x27;   * 设置start 和 stop 按钮状态\n&#x27;
                         &#x27;   */\n&#x27;
                         &#x27;  private void setBtState(boolean state) {\n&#x27;
                         &#x27;    mStart.setEnabled(state);\n&#x27;
                         &#x27;    mStop.setEnabled(!state);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onCreate(Bundle &#x27;
                         &#x27;savedInstanceState) {\n&#x27;
                         &#x27;    super.onCreate(savedInstanceState);\n&#x27;
                         &#x27;    init();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onResume() {\n&#x27;
                         &#x27;    super.onResume();\n&#x27;
                         &#x27;    Aria.whit(this).addSchedulerListener(new &#x27;
                         &#x27;MySchedulerListener());\n&#x27;
                         &#x27;    //registerReceiver(mReceiver, &#x27;
                         &#x27;getModule(DownloadModule.class).getDownloadFilter());\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onDestroy() {\n&#x27;
                         &#x27;    super.onDestroy();\n&#x27;
                         &#x27;    //unregisterReceiver(mReceiver);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected int setLayoutId() {\n&#x27;
                         &#x27;    return R.layout.activity_single;\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void init(Bundle &#x27;
                         &#x27;savedInstanceState) {\n&#x27;
                         &#x27;    super.init(savedInstanceState);\n&#x27;
                         &#x27;    setSupportActionBar(toolbar);\n&#x27;
                         &#x27;    toolbar.setTitle(&quot;单任务下载&quot;);\n&#x27;
                         &#x27;    init();\n&#x27;
                         &#x27;    Aria.get(this).openBroadcast(true);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void init() {\n&#x27;
                         &#x27;    if (Aria.get(this).taskExists(DOWNLOAD_URL)) {\n&#x27;
                         &#x27;      AMTarget target = &#x27;
                         &#x27;Aria.whit(this).load(DOWNLOAD_URL);\n&#x27;
                         &#x27;      int      p      = (int) &#x27;
                         &#x27;(target.getCurrentProgress() * 100 / &#x27;
                         &#x27;target.getFileSize());\n&#x27;
                         &#x27;      mPb.setProgress(p);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  public void onClick(View view) {\n&#x27;
                         &#x27;    switch (view.getId()) {\n&#x27;
                         &#x27;      case R.id.start:\n&#x27;
                         &#x27;        String text = ((TextView) &#x27;
                         &#x27;view).getText().toString();\n&#x27;
                         &#x27;        if (text.equals(&quot;重新开始？&quot;) || &#x27;
                         &#x27;text.equals(&quot;开始&quot;)) {\n&#x27;
                         &#x27;          start();\n&#x27;
                         &#x27;        } else if (text.equals(&quot;恢复&quot;)) {\n&#x27;
                         &#x27;          resume();\n&#x27;
                         &#x27;        }\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;      case R.id.stop:\n&#x27;
                         &#x27;        stop();\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;      case R.id.cancel:\n&#x27;
                         &#x27;        cancel();\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void resume() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).resume();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void start() {\n&#x27;
                         &#x27;    Aria.whit(this)\n&#x27;
                         &#x27;        .load(DOWNLOAD_URL)\n&#x27;
                         &#x27;        &#x27;
                         &#x27;.setDownloadPath(Environment.getExternalStorageDirectory().getPath() &#x27;
                         &#x27;+ &quot;/test.apk&quot;)\n&#x27;
                         &#x27;        .setDownloadName(&quot;test.apk&quot;)\n&#x27;
                         &#x27;        .start();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void stop() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).stop();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void cancel() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).cancel();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private class MySchedulerListener extends &#x27;
                         &#x27;Aria.SimpleSchedulerListener {\n&#x27;
                         &#x27;    @Override public void onTaskStart(Task task) {\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, &#x27;
                         &#x27;task.getDownloadEntity().getFileSize())\n&#x27;
                         &#x27;          .sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskResume(Task task) {\n&#x27;
                         &#x27;      super.onTaskResume(task);\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, &#x27;
                         &#x27;task.getFileSize()).sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskStop(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskCancel(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskFail(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskComplete(Task task) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskRunning(Task task) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, &#x27;
                         &#x27;task).sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;}\n&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;&#x27;},
          {&#x27;CHUNK_OURS&#x27;: &#x27;/*\n&#x27;
                         &#x27; * Copyright (C) 2016 &#x27;
                         &#x27;AriaLyy(https://github.com/AriaLyy/Aria)\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; * Licensed under the Apache License, Version 2.0 &#x27;
                         &#x27;(the &quot;License&quot;);\n&#x27;
                         &#x27; * you may not use this file except in compliance &#x27;
                         &#x27;with the License.\n&#x27;
                         &#x27; * You may obtain a copy of the License at\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; *      http://www.apache.org/licenses/LICENSE-2.0\n&#x27;
                         &#x27; *\n&#x27;
                         &#x27; * Unless required by applicable law or agreed to in &#x27;
                         &#x27;writing, software\n&#x27;
                         &#x27; * distributed under the License is distributed on &#x27;
                         &#x27;an &quot;AS IS&quot; BASIS,\n&#x27;
                         &#x27; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, &#x27;
                         &#x27;either express or implied.\n&#x27;
                         &#x27; * See the License for the specific language &#x27;
                         &#x27;governing permissions and\n&#x27;
                         &#x27; * limitations under the License.\n&#x27;
                         &#x27; */\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;package com.arialyy.simple.single_task;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;import android.content.BroadcastReceiver;\n&#x27;
                         &#x27;import android.content.Context;\n&#x27;
                         &#x27;import android.content.Intent;\n&#x27;
                         &#x27;import android.os.Bundle;\n&#x27;
                         &#x27;import android.os.Environment;\n&#x27;
                         &#x27;import android.os.Handler;\n&#x27;
                         &#x27;import android.os.Message;\n&#x27;
                         &#x27;import android.support.v7.widget.Toolbar;\n&#x27;
                         &#x27;import android.view.View;\n&#x27;
                         &#x27;import android.widget.Button;\n&#x27;
                         &#x27;import android.widget.ImageView;\n&#x27;
                         &#x27;import android.widget.TextView;\n&#x27;
                         &#x27;import android.widget.Toast;\n&#x27;
                         &#x27;import butterknife.Bind;\n&#x27;
                         &#x27;import com.arialyy.aria.core.AMTarget;\n&#x27;
                         &#x27;import com.arialyy.aria.core.Aria;\n&#x27;
                         &#x27;import com.arialyy.aria.core.DownloadEntity;\n&#x27;
                         &#x27;import com.arialyy.aria.core.task.DownloadUtil;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.aria.core.task.IDownloadListener;\n&#x27;
                         &#x27;import com.arialyy.aria.core.task.Task;\n&#x27;
                         &#x27;import com.arialyy.aria.util.CommonUtil;\n&#x27;
                         &#x27;import com.arialyy.frame.util.show.L;\n&#x27;
                         &#x27;import com.arialyy.simple.R;\n&#x27;
                         &#x27;import com.arialyy.simple.base.BaseActivity;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.simple.databinding.ActivitySingleBinding;\n&#x27;
                         &#x27;import &#x27;
                         &#x27;com.arialyy.simple.widget.HorizontalProgressBarWithNumber;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;public class SingleTaskActivity extends &#x27;
                         &#x27;BaseActivity&lt;ActivitySingleBinding&gt; {\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_PRE      = &#x27;
                         &#x27;0x01;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_STOP     = &#x27;
                         &#x27;0x02;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_FAILE    = &#x27;
                         &#x27;0x03;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_CANCEL   = &#x27;
                         &#x27;0x04;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_RESUME   = &#x27;
                         &#x27;0x05;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_COMPLETE = &#x27;
                         &#x27;0x06;\n&#x27;
                         &#x27;  public static final  int    DOWNLOAD_RUNNING  = &#x27;
                         &#x27;0x07;\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private static final String DOWNLOAD_URL      =\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;http://kotlinlang.org/docs/kotlin-docs.pdf&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;https://atom-installer.github.com/v1.13.0/AtomSetup.exe?s=1484074138&amp;ext=.exe&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;&quot;http://static.gaoshouyou.com/d/22/94/822260b849944492caadd2983f9bb624.apk&quot;;\n&#x27;
                         &#x27;      &#x27;
                         &#x27;//&quot;http://ox.konsung.net:5555/ksdc-web/download/downloadFile/?fileName=ksdc_1.0.2.apk&amp;rRange=0-&quot;;\n&#x27;
                         &#x27;  @Bind(R.id.progressBar) &#x27;
                         &#x27;HorizontalProgressBarWithNumber mPb;\n&#x27;
                         &#x27;  @Bind(R.id.start)       &#x27;
                         &#x27;Button                          mStart;\n&#x27;
                         &#x27;  @Bind(R.id.stop)        &#x27;
                         &#x27;Button                          mStop;\n&#x27;
                         &#x27;  @Bind(R.id.cancel)      &#x27;
                         &#x27;Button                          mCancel;\n&#x27;
                         &#x27;  @Bind(R.id.size)        &#x27;
                         &#x27;TextView                        mSize;\n&#x27;
                         &#x27;  @Bind(R.id.toolbar)     &#x27;
                         &#x27;Toolbar                         toolbar;\n&#x27;
                         &#x27;  @Bind(R.id.speed)       &#x27;
                         &#x27;TextView                        mSpeed;\n&#x27;
                         &#x27;  @Bind(R.id.img)         &#x27;
                         &#x27;ImageView                       mImg;\n&#x27;
                         &#x27;  private                 &#x27;
                         &#x27;DownloadEntity                  mEntity;\n&#x27;
                         &#x27;  private BroadcastReceiver mReceiver = new &#x27;
                         &#x27;BroadcastReceiver() {\n&#x27;
                         &#x27;    @Override public void onReceive(Context context, &#x27;
                         &#x27;Intent intent) {\n&#x27;
                         &#x27;      String action = intent.getAction();\n&#x27;
                         &#x27;      if (action.equals(Aria.ACTION_START)) {\n&#x27;
                         &#x27;        L.d(&quot;START&quot;);\n&#x27;
                         &#x27;      }\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  };\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private Handler mUpdateHandler = new Handler() {\n&#x27;
                         &#x27;    @Override public void handleMessage(Message msg) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      super.handleMessage(msg);\n&#x27;
                         &#x27;      switch (msg.what) {\n&#x27;
                         &#x27;        case DOWNLOAD_RUNNING:\n&#x27;
                         &#x27;          Task task = (Task) msg.obj;\n&#x27;
                         &#x27;          long current = task.getCurrentProgress();\n&#x27;
                         &#x27;          long len = task.getFileSize();\n&#x27;
                         &#x27;          if (len == 0) {\n&#x27;
                         &#x27;            mPb.setProgress(0);\n&#x27;
                         &#x27;          } else {\n&#x27;
                         &#x27;            mPb.setProgress((int) ((current * 100) / &#x27;
                         &#x27;len));\n&#x27;
                         &#x27;          }\n&#x27;
                         &#x27;          &#x27;
                         &#x27;mSpeed.setText(CommonUtil.formatFileSize(task.getSpeed()) &#x27;
                         &#x27;+ &quot;/s&quot;);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_PRE:\n&#x27;
                         &#x27;          &#x27;
                         &#x27;mSize.setText(CommonUtil.formatFileSize((Long) &#x27;
                         &#x27;msg.obj));\n&#x27;
                         &#x27;          setBtState(false);\n&#x27;
                         &#x27;          //mStart.setText(&quot;暂停&quot;);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_FAILE:\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;下载失败&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_STOP:\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;暂停下载&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;恢复&quot;);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_CANCEL:\n&#x27;
                         &#x27;          mPb.setProgress(0);\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;取消下载&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;开始&quot;);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_RESUME:\n&#x27;
                         &#x27;          //Toast.makeText(SingleTaskActivity.this,\n&#x27;
                         &#x27;          //    &quot;恢复下载，恢复位置 ==&gt; &quot; + &#x27;
                         &#x27;CommonUtil.formatFileSize((Long) msg.obj), &#x27;
                         &#x27;Toast.LENGTH_SHORT)\n&#x27;
                         &#x27;          //    .show();\n&#x27;
                         &#x27;          mStart.setText(&quot;暂停&quot;);\n&#x27;
                         &#x27;          setBtState(false);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;        case DOWNLOAD_COMPLETE:\n&#x27;
                         &#x27;          mPb.setProgress(100);\n&#x27;
                         &#x27;          Toast.makeText(SingleTaskActivity.this, &#x27;
                         &#x27;&quot;下载完成&quot;, Toast.LENGTH_SHORT).show();\n&#x27;
                         &#x27;          mStart.setText(&quot;重新开始？&quot;);\n&#x27;
                         &#x27;          mCancel.setEnabled(false);\n&#x27;
                         &#x27;          setBtState(true);\n&#x27;
                         &#x27;          break;\n&#x27;
                         &#x27;      }\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  };\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  /**\n&#x27;
                         &#x27;   * 设置start 和 stop 按钮状态\n&#x27;
                         &#x27;   */\n&#x27;
                         &#x27;  private void setBtState(boolean state) {\n&#x27;
                         &#x27;    mStart.setEnabled(state);\n&#x27;
                         &#x27;    mStop.setEnabled(!state);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onCreate(Bundle &#x27;
                         &#x27;savedInstanceState) {\n&#x27;
                         &#x27;    super.onCreate(savedInstanceState);\n&#x27;
                         &#x27;    init();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onResume() {\n&#x27;
                         &#x27;    super.onResume();\n&#x27;
                         &#x27;    Aria.whit(this).addSchedulerListener(new &#x27;
                         &#x27;MySchedulerListener());\n&#x27;
                         &#x27;    //registerReceiver(mReceiver, &#x27;
                         &#x27;getModule(DownloadModule.class).getDownloadFilter());\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void onDestroy() {\n&#x27;
                         &#x27;    super.onDestroy();\n&#x27;
                         &#x27;    //unregisterReceiver(mReceiver);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected int setLayoutId() {\n&#x27;
                         &#x27;    return R.layout.activity_single;\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  @Override protected void init(Bundle &#x27;
                         &#x27;savedInstanceState) {\n&#x27;
                         &#x27;    super.init(savedInstanceState);\n&#x27;
                         &#x27;    setSupportActionBar(toolbar);\n&#x27;
                         &#x27;    toolbar.setTitle(&quot;单任务下载&quot;);\n&#x27;
                         &#x27;    init();\n&#x27;
                         &#x27;    Aria.get(this).openBroadcast(true);\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void init() {\n&#x27;
                         &#x27;    if (Aria.get(this).taskExists(DOWNLOAD_URL)) {\n&#x27;
                         &#x27;      AMTarget target = &#x27;
                         &#x27;Aria.whit(this).load(DOWNLOAD_URL);\n&#x27;
                         &#x27;      int      p      = (int) &#x27;
                         &#x27;(target.getCurrentProgress() * 100 / &#x27;
                         &#x27;target.getFileSize());\n&#x27;
                         &#x27;      mPb.setProgress(p);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  public void onClick(View view) {\n&#x27;
                         &#x27;    switch (view.getId()) {\n&#x27;
                         &#x27;      case R.id.start:\n&#x27;
                         &#x27;        String text = ((TextView) &#x27;
                         &#x27;view).getText().toString();\n&#x27;
                         &#x27;        if (text.equals(&quot;重新开始？&quot;) || &#x27;
                         &#x27;text.equals(&quot;开始&quot;)) {\n&#x27;
                         &#x27;          start();\n&#x27;
                         &#x27;        } else if (text.equals(&quot;恢复&quot;)) {\n&#x27;
                         &#x27;          resume();\n&#x27;
                         &#x27;        }\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;      case R.id.stop:\n&#x27;
                         &#x27;        stop();\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;      case R.id.cancel:\n&#x27;
                         &#x27;        cancel();\n&#x27;
                         &#x27;        break;\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void resume() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).resume();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void start() {\n&#x27;
                         &#x27;    Aria.whit(this)\n&#x27;
                         &#x27;        .load(DOWNLOAD_URL)\n&#x27;
                         &#x27;        &#x27;
                         &#x27;.setDownloadPath(Environment.getExternalStorageDirectory().getPath() &#x27;
                         &#x27;+ &quot;/test.apk&quot;)\n&#x27;
                         &#x27;        .setDownloadName(&quot;test.apk&quot;)\n&#x27;
                         &#x27;        .start();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void stop() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).stop();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private void cancel() {\n&#x27;
                         &#x27;    Aria.whit(this).load(DOWNLOAD_URL).cancel();\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;  private class MySchedulerListener extends &#x27;
                         &#x27;Aria.SimpleSchedulerListener {\n&#x27;
                         &#x27;    @Override public void onTaskStart(Task task) {\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, &#x27;
                         &#x27;task.getDownloadEntity().getFileSize())\n&#x27;
                         &#x27;          .sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskResume(Task task) {\n&#x27;
                         &#x27;      super.onTaskResume(task);\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_PRE, &#x27;
                         &#x27;task.getFileSize()).sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskStop(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_STOP);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskCancel(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_CANCEL);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskFail(Task task) {\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_FAILE);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskComplete(Task task) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      &#x27;
                         &#x27;mUpdateHandler.sendEmptyMessage(DOWNLOAD_COMPLETE);\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;\n&#x27;
                         &#x27;    @Override public void onTaskRunning(Task task) &#x27;
                         &#x27;{\n&#x27;
                         &#x27;      mUpdateHandler.obtainMessage(DOWNLOAD_RUNNING, &#x27;
                         &#x27;task).sendToTarget();\n&#x27;
                         &#x27;    }\n&#x27;
                         &#x27;  }\n&#x27;
                         &#x27;}\n&#x27;,
           &#x27;CHUNK_THEIRS&#x27;: &#x27;\n&#x27;}],
   &#x27;mergers&#x27;: {&#x27;baseline&#x27;, &#x27;spork&#x27;, &#x27;jfstmerge&#x27;}}]]</pre>
          </body>
        </html>
        