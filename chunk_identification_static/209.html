<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>209</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    209
                    <a href="208.html">prev</a>
                    <a href="210.html">next</a>
                    <a href="209_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    BroadleafCommerce/BroadleafCommerce_47fec386683d4f12911413ae693bacd60e1538d7_core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexService.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;47fec386683d4f12911413ae693bacd60e1538d7:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexService.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;47fec386683d4f12911413ae693bacd60e1538d7^1:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexService.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;47fec386683d4f12911413ae693bacd60e1538d7^2:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexService.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\BroadleafCommerce\BroadleafCommerce show &quot;a996923be2b09711d11d2a5df4df667dc9a00b19:core/broadleaf-framework/src/main/java/org/broadleafcommerce/core/search/service/solr/index/SolrIndexService.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * #%L
   3  * BroadleafCommerce Framework
   4  * %%
   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6  * %%
   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10  * the Broadleaf End User License Agreement (EULA), Version 1.1
  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12  * shall apply.
  13  * 
<abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr>
<abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr>
  16  * #L%
  17  */
  18 package org.broadleafcommerce.core.search.service.solr.index;
  19 
  20 import org.apache.solr.client.solrj.SolrClient;
  21 import org.apache.solr.client.solrj.SolrServerException;
  22 import org.apache.solr.common.SolrInputDocument;
  23 import org.broadleafcommerce.common.exception.ServiceException;
  24 import org.broadleafcommerce.common.locale.domain.Locale;
  25 import org.broadleafcommerce.core.catalog.domain.Indexable;
  26 import org.broadleafcommerce.core.search.domain.IndexField;
  27 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  28 import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;</span>
<span style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  29 import org.broadleafcommerce.core.search.service.solr.indexer.CatalogSolrIndexUpdateService;</span>
  30 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import org.broadleafcommerce.core.catalog.domain.Sku;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import org.broadleafcommerce.core.search.domain.IndexField;</span>
  33 =======
  34 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  35 
  36 import java.io.IOException;
  37 import java.util.Collection;
  38 import java.util.List;
  39 
  40 /**
  41  * Service exposing several methods for creating a Solr index based on catalog product data.
  42  *
  43  * @see org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation
  44  * @author Andre Azzolini (apazzolini)
  45  * @author Jeff Fischer
  46  * @author Phillip Verheyden (phillipuniverse)
  47  */
  48 public interface SolrIndexService {
  49 
  50     /**
  51      * &lt;p&gt;
<abbr title="  52      * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and then swap">  52      * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collectiðŸ”µ</abbr>
<abbr title="  53      * out the active core/collection with the new version of the index (essentially replacing all documents that are">  53      * out the active core/collection with the new version of the index (essentially replacing all documeðŸ”µ</abbr>
  54      * currently in the index).
  55      * 
  56      * &lt;p&gt;
  57      * The order of methods that are apart of rebuilding the entire index:
  58      * &lt;ol&gt;
  59      *  &lt;li&gt;&lt;pre&gt;{@link #preBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  60      *  &lt;li&gt;&lt;pre&gt;{@link #buildIndex()}&lt;/pre&gt;&lt;/li&gt;
  61      *  &lt;li&gt;&lt;pre&gt;{@link #postBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  62      * &lt;/ol&gt;
  63      * 
  64      * 
  65      * @throws IOException 
  66      * @throws ServiceException
  67      */
  68     public void rebuildIndex() throws ServiceException, IOException;
  69 
  70     /**
<abbr title="  71      * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current index. This">  71      * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the cuðŸ”µ</abbr>
  72      * is called at the beginning of {@link #rebuildIndex()}
  73      *
  74      * @throws ServiceException
  75      */
  76     public void preBuildIndex() throws ServiceException;
  77 
  78     /**
  79      * &lt;p&gt;
<abbr title="  80      * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperation&#x27;s need to be">  80      * Handles all the document building for the current index rebuild. This is where all of the SolrIndeðŸ”µ</abbr>
  81      * created, executed and the documents built and added to the Solr index
  82      * 
  83      * &lt;p&gt;
<abbr title="  84      * This is the method that should be overridden to specify which operations should be run to build the correct index.">  84      * This is the method that should be overridden to specify which operations should be run to build thðŸ”µ</abbr>
  85      *
  86      * @throws IOException
  87      * @throws ServiceException
  88      * @see {@link #rebuildIndex()}
  89      * @see {@link #preBuildIndex()}
  90      */
  91     public void buildIndex() throws IOException, ServiceException;
  92 
  93     /**
<abbr title="  94      * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the index and swapping the cores.">  94      * Executed after we do any indexing when rebuilding the current index. Usually this handles optimiziðŸ”µ</abbr>
  95      *
  96      * @throws IOException
  97      * @throws ServiceException
  98      */
  99     public void postBuildIndex() throws IOException, ServiceException;
 100     
 101     /**
<abbr title=" 102      * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is the primary"> 102      * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. TðŸ”µ</abbr>
 103      * index operation used to rebuild the index.
 104      *
 105      * @return a SolrIndexOperation capable of rebuilding the current index
 106      */
 107     public SolrIndexOperation getReindexOperation();
 108 
 109     /**
 110      * Executes the given &lt;b&gt;operation&lt;/b&gt; in the correct method order
 111      *
 112      * @param operation the SolrIndexOperation that is to be executed
 113      * @throws ServiceException
 114      * @throws IOException
 115      */
<abbr title=" 116     public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOException;"> 116     public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOExceptðŸ”µ</abbr>
 117     
 118     /**
 119      * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 120      * @param collection The collection to be used for incremental indexing
 121      * @param indexables the list of items to index
<abbr title=" 122      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 122      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is nuðŸ”µ</abbr>
 123      * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
 124      *
 125      * @throws ServiceException
 126      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
 127      */
<abbr title=" 128     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 128     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends IndexablðŸ”µ</abbr>
 129 
 130     /**
 131      * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 132      * @param indexables the list of items to index
<abbr title=" 133      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 133      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is nuðŸ”µ</abbr>
 134      * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
 135      *
 136      * @throws ServiceException
 137      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
<abbr title=" 138      * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 138      * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the colleðŸ”µ</abbr>
 139      */
 140     @Deprecated
<abbr title=" 141     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 141     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrðŸ”µ</abbr>
 142 
 143     /**
 144      * Saves some global context that might be altered during indexing.
 145      * 
 146      * @return
 147      */
 148     public Object[] saveState();
 149 
 150     /**
 151      * Restores state that was saved prior to indexing that might have been altered.
 152      * 
 153      * @see #saveState()
 154      * @param pack
 155      */
 156     public void restoreState(Object[] pack);
 157 
 158     /**
<abbr title=" 159      * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 159      * Triggers the Solr optimize index function on the given server. This is typically called at the endðŸ”µ</abbr>
 160      * @param collection The collection to optimize
 161      * @param server The server to use to optimze the given collection
 162      *
 163      * @throws ServiceException
 164      * @throws IOException
 165      */
 166     public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException;
 167 
 168     /**
<abbr title=" 169      * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 169      * Triggers the Solr optimize index function on the given server. This is typically called at the endðŸ”µ</abbr>
 170      * @param server The server to use to optimze the default collection
 171      *
 172      * @throws ServiceException
 173      * @throws IOException
<abbr title=" 174      * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 174      * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s bðŸ”µ</abbr>
 175      */
 176     @Deprecated
 177     public void optimizeIndex(SolrClient server) throws ServiceException, IOException;
 178 
 179     /**
<abbr title=" 180      * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 180      * Allows a commit to be called.  By default, the details of the commit will depend on system propertðŸ”µ</abbr>
 181      * 
<abbr title=" 182      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 182      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) shðŸ”µ</abbr>
 183      * solr.index.softCommit - indicates if a soft commit should be performed
 184      * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 185      * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 186      * @param collection The collection to commit
 187      * @param server The server used to commit the specified collection
 188      *
 189      * @throws ServiceException
 190      * @throws IOException
 191      */
 192 
 193     public void commit(String collection, SolrClient server) throws ServiceException, IOException;
 194 
 195     /**
<abbr title=" 196      * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 196      * Allows a commit to be called.  By default, the details of the commit will depend on system propertðŸ”µ</abbr>
 197      *
<abbr title=" 198      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 198      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) shðŸ”µ</abbr>
 199      * solr.index.softCommit - indicates if a soft commit should be performed
 200      * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 201      * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 202      * @param server The server used to commit the default collection
 203      *
 204      * @throws ServiceException
 205      * @throws IOException
<abbr title=" 206      * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 206      * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being usðŸ”µ</abbr>
 207      */
 208     @Deprecated
 209     public void commit(SolrClient server) throws ServiceException, IOException;
 210 
 211     /**
 212      * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
<abbr title=" 213      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either "> 213      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, eitherðŸ”µ</abbr>
 214      * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 215      * 
 216      * Note that this method will force a commit even if solr.index.commit=false
 217      * @param collection The collection to commit
 218      * @param server - the SolrClient to use to commit the provided collection
<abbr title=" 219      * @param softCommit - soft commit is an efficient commit that does not write the data to the file system"> 219      * @param softCommit - soft commit is an efficient commit that does not write the data to the file syðŸ”µ</abbr>
 220      * @param waitSearcher - whether or not to wait for a new searcher to be created
 221      * @param waitFlush - whether or not to wait for a flush to disk.
 222      *
 223      * @throws ServiceException
 224      * @throws IOException
 225      */
<abbr title=" 226     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 226     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boðŸ”µ</abbr>
 227 
 228     /**
 229      * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 230      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 231      * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 232      *
 233      * Note that this method will force a commit even if solr.index.commit=false
 234      * @param server - the SolrClient to commit with
<abbr title=" 235      * @param softCommit - soft commit is an efficient commit that does not write the data to the file system"> 235      * @param softCommit - soft commit is an efficient commit that does not write the data to the file syðŸ”µ</abbr>
 236      * @param waitSearcher - whether or not to wait for a new searcher to be created
 237      * @param waitFlush - whether or not to wait for a flush to disk.
 238      *
 239      * @throws ServiceException
 240      * @throws IOException
<abbr title=" 241      * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 241      * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that theðŸ”µ</abbr>
 242      */
 243     @Deprecated
<abbr title=" 244     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 244     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) thðŸ”µ</abbr>
 245 
<abbr title=" 246     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceException;"> 246     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceExceptionðŸ”µ</abbr>
 247 
 248     /**
<abbr title=" 249      * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 249      * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the colleðŸ”µ</abbr>
 250      */
 251     @Deprecated
 252     public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException;
 253 
 254     public void deleteAllDocuments(String collection, SolrClient server) throws ServiceException;
 255 
 256     /**
<abbr title=" 257      * @deprecated Use {@link #deleteAllDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 257      * @deprecated Use {@link #deleteAllDocuments(String, SolrClient)} instead so that the collection thaðŸ”µ</abbr>
 258      */
 259     @Deprecated
 260     public void deleteAllDocuments(SolrClient server) throws ServiceException;
 261 
 262     /**
 263      * Prints out the docs to the trace logger
 264      * 
 265      * @param documents
 266      */
 267     public void logDocuments(Collection&lt;SolrInputDocument&gt; documents);
 268 
 269     /**
 270      * @return a list of all possible locale prefixes to consider
 271      */
 272     public List&lt;Locale&gt; getAllLocales();
 273 
 274     /**
<abbr title=" 275      * Given a product, fields that relate to that product, and a list of locales and pricelists, builds a "> 275      * Given a product, fields that relate to that product, and a list of locales and pricelists, builds ðŸ”µ</abbr>
 276      * SolrInputDocument to be added to the Solr index.
 277      * 
 278      * @param product
 279      * @param fields
 280      * @param locales
 281      * @return the document
 282      */
<abbr title=" 283     public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 283     public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locðŸ”µ</abbr>
 284 
 285     /**
 286      * SolrIndexService exposes {@link #buildIncrementalIndex(int, int, boolean)}.
<abbr title=" 287      * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation.CacheOperation},"> 287      * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.sðŸ”µ</abbr>
<abbr title=" 288      * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an example:"> 288      * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an examplðŸ”µ</abbr>
 289      * {@code
 290      *  performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {
 291      *        @Override
 292      *        public void execute() throws ServiceException {
 293      *            int page = 0;
 294      *            while ((page * pageSize) &lt; numProducts) {
 295      *                buildIncrementalIndex(page, pageSize);
 296      *                page++;
 297      *            }
 298      *        }
 299      *    });
 300      * }
<abbr title=" 301      * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessary to call performCacheOperation"> 301      * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not ðŸ”µ</abbr>
 302      * for calls to rebuildIndex().
 303      *
 304      * @param cacheOperation the block of code to perform using a single cache for best performance
 305      * @throws ServiceException
 306      */
<abbr title=" 307     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException;"> 307     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws SerðŸ”µ</abbr>
 308 
 309     /**
 310      * Iterates through the fields for this indexable and indexes any SearchField&#x27;s or SearchFacet&#x27;s.
 311      *  @param document
 312      * @param indexable
 313      * @param fields
 314      * @param locales
 315      */
<abbr title=" 316     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 316     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexðŸ”µ</abbr>
 317 
 318     void deleteByQuery(String deleteQuery) throws SolrServerException, IOException;
 319 
 320     void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException;
 321 
 322     void logDeleteQuery(String deleteQuery);
 323 
 324     /**
<abbr title=" 325      * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}. By default, this is driven by the property,"> 325      * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}ðŸ”µ</abbr>
 326      * &#x27;solr.catalog.useLegacySolrIndexer&#x27;, which defaults to true.
 327      *
 328      * @return
 329      */
 330     public boolean useLegacyIndexer();
 331 }
 332 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * #%L
   3  * BroadleafCommerce Framework
   4  * %%
   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6  * %%
   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10  * the Broadleaf End User License Agreement (EULA), Version 1.1
  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12  * shall apply.
  13  *
<abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr>
<abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr>
  16  * #L%
  17  */
  18 package org.broadleafcommerce.core.search.service.solr.index;
  19 
  20 import org.apache.solr.client.solrj.SolrClient;
  21 import org.apache.solr.client.solrj.SolrServerException;
  22 import org.apache.solr.common.SolrInputDocument;
  23 import org.broadleafcommerce.common.exception.ServiceException;
  24 import org.broadleafcommerce.common.locale.domain.Locale;
  25 import org.broadleafcommerce.core.catalog.domain.Indexable;
  26 import org.broadleafcommerce.core.search.domain.IndexField;
  27 import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;
  28 
  29 import java.io.IOException;
  30 import java.util.Collection;
  31 import java.util.List;
  32 
  33 /**
  34  * Service exposing several methods for creating a Solr index based on catalog product data.
  35  *
  36  * @see org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation
  37  * @author Andre Azzolini (apazzolini)
  38  * @author Jeff Fischer
  39  * @author Phillip Verheyden (phillipuniverse)
  40  */
  41 public interface SolrIndexService {
  42 
  43     /**
  44      * &lt;p&gt;
<abbr title="  45      * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and then swap">  45      * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collectiðŸ”µ</abbr>
<abbr title="  46      * out the active core/collection with the new version of the index (essentially replacing all documents that are">  46      * out the active core/collection with the new version of the index (essentially replacing all documeðŸ”µ</abbr>
  47      * currently in the index).
  48      *
  49      * &lt;p&gt;
  50      * The order of methods that are apart of rebuilding the entire index:
  51      * &lt;ol&gt;
  52      *  &lt;li&gt;&lt;pre&gt;{@link #preBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  53      *  &lt;li&gt;&lt;pre&gt;{@link #buildIndex()}&lt;/pre&gt;&lt;/li&gt;
  54      *  &lt;li&gt;&lt;pre&gt;{@link #postBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  55      * &lt;/ol&gt;
  56      *
  57      *
  58      * @throws IOException
  59      * @throws ServiceException
  60      */
  61     public void rebuildIndex() throws ServiceException, IOException;
  62 
  63     /**
<abbr title="  64      * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current index. This">  64      * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the cuðŸ”µ</abbr>
  65      * is called at the beginning of {@link #rebuildIndex()}
  66      *
  67      * @throws ServiceException
  68      */
  69     public void preBuildIndex() throws ServiceException;
  70 
  71     /**
  72      * &lt;p&gt;
<abbr title="  73      * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperation&#x27;s need to be">  73      * Handles all the document building for the current index rebuild. This is where all of the SolrIndeðŸ”µ</abbr>
  74      * created, executed and the documents built and added to the Solr index
  75      *
  76      * &lt;p&gt;
<abbr title="  77      * This is the method that should be overridden to specify which operations should be run to build the correct index.">  77      * This is the method that should be overridden to specify which operations should be run to build thðŸ”µ</abbr>
  78      *
  79      * @throws IOException
  80      * @throws ServiceException
  81      * @see {@link #rebuildIndex()}
  82      * @see {@link #preBuildIndex()}
  83      */
  84     public void buildIndex() throws IOException, ServiceException;
  85 
  86     /**
<abbr title="  87      * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the index and swapping the cores.">  87      * Executed after we do any indexing when rebuilding the current index. Usually this handles optimiziðŸ”µ</abbr>
  88      *
  89      * @throws IOException
  90      * @throws ServiceException
  91      */
  92     public void postBuildIndex() throws IOException, ServiceException;
  93 
  94     /**
<abbr title="  95      * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is the primary">  95      * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. TðŸ”µ</abbr>
  96      * index operation used to rebuild the index.
  97      *
  98      * @return a SolrIndexOperation capable of rebuilding the current index
  99      */
 100     public SolrIndexOperation getReindexOperation();
 101 
 102     /**
 103      * Executes the given &lt;b&gt;operation&lt;/b&gt; in the correct method order
 104      *
 105      * @param operation the SolrIndexOperation that is to be executed
 106      * @throws ServiceException
 107      * @throws IOException
 108      */
<abbr title=" 109     public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOException;"> 109     public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOExceptðŸ”µ</abbr>
 110 
 111     /**
 112      * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 113      * @param collection The collection to be used for incremental indexing
 114      * @param indexables the list of items to index
<abbr title=" 115      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 115      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is nuðŸ”µ</abbr>
 116      * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
 117      *
 118      * @throws ServiceException
 119      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
 120      */
<abbr title=" 121     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 121     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends IndexablðŸ”µ</abbr>
 122 
 123     /**
 124      * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 125      * @param indexables the list of items to index
<abbr title=" 126      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 126      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is nuðŸ”µ</abbr>
 127      * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
 128      *
 129      * @throws ServiceException
 130      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
<abbr title=" 131      * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 131      * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the colleðŸ”µ</abbr>
 132      */
 133     @Deprecated
<abbr title=" 134 public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 134 public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClieðŸ”µ</abbr>
 135 
 136     /**
 137      * Saves some global context that might be altered during indexing.
 138      *
 139      * @return
 140      */
 141     public Object[] saveState();
 142 
 143     /**
 144      * Restores state that was saved prior to indexing that might have been altered.
 145      *
 146      * @see #saveState()
 147      * @param pack
 148      */
 149     public void restoreState(Object[] pack);
 150 
 151     /**
<abbr title=" 152      * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 152      * Triggers the Solr optimize index function on the given server. This is typically called at the endðŸ”µ</abbr>
 153      * @param collection The collection to optimize
 154      * @param server The server to use to optimze the given collection
 155      *
 156      * @throws ServiceException
 157      * @throws IOException
 158      */
 159     public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException;
 160 
 161     /**
<abbr title=" 162      * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 162      * Triggers the Solr optimize index function on the given server. This is typically called at the endðŸ”µ</abbr>
 163      * @param server The server to use to optimze the default collection
 164      *
 165      * @throws ServiceException
 166      * @throws IOException
<abbr title=" 167      * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 167      * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s bðŸ”µ</abbr>
 168      */
 169     @Deprecated
 170 public void optimizeIndex(SolrClient server) throws ServiceException, IOException;
 171 
 172     /**
<abbr title=" 173      * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 173      * Allows a commit to be called.  By default, the details of the commit will depend on system propertðŸ”µ</abbr>
 174      *
<abbr title=" 175      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 175      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) shðŸ”µ</abbr>
 176      * solr.index.softCommit - indicates if a soft commit should be performed
 177      * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 178      * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 179      * @param collection The collection to commit
 180      * @param server The server used to commit the specified collection
 181      *
 182      * @throws ServiceException
 183      * @throws IOException
 184      */
 185 
 186     public void commit(String collection, SolrClient server) throws ServiceException, IOException;
 187 
 188     /**
<abbr title=" 189      * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 189      * Allows a commit to be called.  By default, the details of the commit will depend on system propertðŸ”µ</abbr>
 190      *
<abbr title=" 191      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 191      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) shðŸ”µ</abbr>
 192      * solr.index.softCommit - indicates if a soft commit should be performed
 193      * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 194      * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 195      * @param server The server used to commit the default collection
 196      *
 197      * @throws ServiceException
 198      * @throws IOException
<abbr title=" 199      * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 199      * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being usðŸ”µ</abbr>
 200      */
 201     @Deprecated
 202 public void commit(SolrClient server) throws ServiceException, IOException;
 203 
 204     /**
 205      * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 206      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 207      * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 208      *
 209      * Note that this method will force a commit even if solr.index.commit=false
 210      * @param collection The collection to commit
 211      * @param server - the SolrClient to use to commit the provided collection
<abbr title=" 212      * @param softCommit - soft commit is an efficient commit that does not write the data to the file system"> 212      * @param softCommit - soft commit is an efficient commit that does not write the data to the file syðŸ”µ</abbr>
 213      * @param waitSearcher - whether or not to wait for a new searcher to be created
 214      * @param waitFlush - whether or not to wait for a flush to disk.
 215      *
 216      * @throws ServiceException
 217      * @throws IOException
 218      */
<abbr title=" 219     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 219     public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boðŸ”µ</abbr>
 220 
 221     /**
 222      * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 223      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 224      * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 225      *
 226      * Note that this method will force a commit even if solr.index.commit=false
 227      * @param server - the SolrClient to commit with
<abbr title=" 228      * @param softCommit - soft commit is an efficient commit that does not write the data to the file system"> 228      * @param softCommit - soft commit is an efficient commit that does not write the data to the file syðŸ”µ</abbr>
 229      * @param waitSearcher - whether or not to wait for a new searcher to be created
 230      * @param waitFlush - whether or not to wait for a flush to disk.
 231      *
 232      * @throws ServiceException
 233      * @throws IOException
<abbr title=" 234      * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 234      * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that theðŸ”µ</abbr>
 235      */
 236     @Deprecated
<abbr title=" 237 public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 237 public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throwsðŸ”µ</abbr>
 238 
<abbr title=" 239     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceException;"> 239     public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceExceptionðŸ”µ</abbr>
 240 
 241     /**
<abbr title=" 242      * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 242      * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the colleðŸ”µ</abbr>
 243      */
 244     @Deprecated
 245 public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException;
 246 
 247     public void deleteAllDocuments(String collection, SolrClient server) throws ServiceException;
 248 
 249     /**
<abbr title=" 250      * @deprecated Use {@link #deleteAllDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 250      * @deprecated Use {@link #deleteAllDocuments(String, SolrClient)} instead so that the collection thaðŸ”µ</abbr>
 251      */
 252     @Deprecated
 253 public void deleteAllDocuments(SolrClient server) throws ServiceException;
 254 
 255     /**
 256      * Prints out the docs to the trace logger
 257      *
 258      * @param documents
 259      */
 260     public void logDocuments(Collection&lt;SolrInputDocument&gt; documents);
 261 
 262     /**
 263      * @return a list of all possible locale prefixes to consider
 264      */
 265     public List&lt;Locale&gt; getAllLocales();
 266 
 267     /**
<abbr title=" 268      * Given a product, fields that relate to that product, and a list of locales and pricelists, builds a"> 268      * Given a product, fields that relate to that product, and a list of locales and pricelists, builds ðŸ”µ</abbr>
 269      * SolrInputDocument to be added to the Solr index.
 270      *
 271      * @param product
 272      * @param fields
 273      * @param locales
 274      * @return the document
 275      */
<abbr title=" 276     public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 276     public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locðŸ”µ</abbr>
 277 
 278     /**
 279      * SolrIndexService exposes {@link #buildIncrementalIndex(int, int, boolean)}.
<abbr title=" 280      * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation.CacheOperation},"> 280      * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.sðŸ”µ</abbr>
<abbr title=" 281      * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an example:"> 281      * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an examplðŸ”µ</abbr>
 282      * {@code
 283      *  performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {
 284      *        @Override
 285      *        public void execute() throws ServiceException {
 286      *            int page = 0;
 287      *            while ((page * pageSize) &lt; numProducts) {
 288      *                buildIncrementalIndex(page, pageSize);
 289      *                page++;
 290      *            }
 291      *        }
 292      *    });
 293      * }
<abbr title=" 294      * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessary to call performCacheOperation"> 294      * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not ðŸ”µ</abbr>
 295      * for calls to rebuildIndex().
 296      *
 297      * @param cacheOperation the block of code to perform using a single cache for best performance
 298      * @throws ServiceException
 299      */
<abbr title=" 300     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException;"> 300     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws SerðŸ”µ</abbr>
 301 
 302     /**
 303      * Iterates through the fields for this indexable and indexes any SearchField&#x27;s or SearchFacet&#x27;s.
 304      *  @param document
 305      * @param indexable
 306      * @param fields
 307      * @param locales
 308      */
<abbr title=" 309     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 309     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexðŸ”µ</abbr>
 310 
 311     void deleteByQuery(String deleteQuery) throws SolrServerException, IOException;
 312 
 313     void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException;
 314 
 315     void logDeleteQuery(String deleteQuery);
 316 
 317     /**
<abbr title=" 318      * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}. By default, this is driven by the property,"> 318      * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}ðŸ”µ</abbr>
 319      * &#x27;solr.catalog.useLegacySolrIndexer&#x27;, which defaults to true.
 320      *
 321      * @return
 322      */
 323     public boolean useLegacyIndexer();
 324 }
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * #%L
   3  * BroadleafCommerce Framework
   4  * %%
   5  * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6  * %%
   7  * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8  * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9  * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10  * the Broadleaf End User License Agreement (EULA), Version 1.1
  11  * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12  * shall apply.
  13  *
<abbr title="  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14  * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;CustomðŸ”µ</abbr>
<abbr title="  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.">  15  * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicableðŸ”µ</abbr>
  16  * #L%
  17  */
  18 package org.broadleafcommerce.core.search.service.solr.index;
  19 
  20 import java.io.IOException;
  21 import java.util.Collection;
  22 import java.util.List;
  23 import org.apache.solr.client.solrj.SolrClient;
  24 import org.apache.solr.client.solrj.SolrServerException;
  25 import org.apache.solr.common.SolrInputDocument;
  26 import org.broadleafcommerce.common.exception.ServiceException;
  27 import org.broadleafcommerce.common.locale.domain.Locale;
  28 import org.broadleafcommerce.core.catalog.domain.Indexable;
  29 import org.broadleafcommerce.core.search.domain.IndexField;
  30 import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;
  31 
  32 
  33 /**
  34  * Service exposing several methods for creating a Solr index based on catalog product data.
  35  *
  36  * @see org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation
  37  * @author Andre Azzolini (apazzolini)
  38  * @author Jeff Fischer
  39  * @author Phillip Verheyden (phillipuniverse)
  40  */
  41 public interface SolrIndexService {
  42     /**
  43      * &lt;p&gt;
<abbr title="  44      * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and then swap">  44      * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collectiðŸ”µ</abbr>
<abbr title="  45      * out the active core/collection with the new version of the index (essentially replacing all documents that are">  45      * out the active core/collection with the new version of the index (essentially replacing all documeðŸ”µ</abbr>
  46      * currently in the index).
  47      *
  48      * &lt;p&gt;
  49      * The order of methods that are apart of rebuilding the entire index:
  50      * &lt;ol&gt;
  51      *  &lt;li&gt;&lt;pre&gt;{@link #preBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  52      *  &lt;li&gt;&lt;pre&gt;{@link #buildIndex()}&lt;/pre&gt;&lt;/li&gt;
  53      *  &lt;li&gt;&lt;pre&gt;{@link #postBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  54      * &lt;/ol&gt;
  55      *
  56      *
  57      * @throws IOException
  58      * @throws ServiceException
  59      */
  60     public void rebuildIndex() throws ServiceException, IOException;
  61 
  62     /**
<abbr title="  63      * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current index. This">  63      * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the cuðŸ”µ</abbr>
  64      * is called at the beginning of {@link #rebuildIndex()}
  65      *
  66      * @throws ServiceException
  67      */
  68     public void preBuildIndex() throws ServiceException;
  69 
  70     /**
  71      * &lt;p&gt;
<abbr title="  72      * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperation&#x27;s need to be">  72      * Handles all the document building for the current index rebuild. This is where all of the SolrIndeðŸ”µ</abbr>
  73      * created, executed and the documents built and added to the Solr index
  74      *
  75      * &lt;p&gt;
<abbr title="  76      * This is the method that should be overridden to specify which operations should be run to build the correct index.">  76      * This is the method that should be overridden to specify which operations should be run to build thðŸ”µ</abbr>
  77      *
  78      * @throws IOException
  79      * @throws ServiceException
  80      * @see {@link #rebuildIndex()}
  81      * @see {@link #preBuildIndex()}
  82      */
  83     public void buildIndex() throws IOException, ServiceException;
  84 
  85     /**
<abbr title="  86      * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the index and swapping the cores.">  86      * Executed after we do any indexing when rebuilding the current index. Usually this handles optimiziðŸ”µ</abbr>
  87      *
  88      * @throws IOException
  89      * @throws ServiceException
  90      */
  91     public void postBuildIndex() throws IOException, ServiceException;
  92 
  93     /**
<abbr title="  94      * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is the primary">  94      * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. TðŸ”µ</abbr>
  95      * index operation used to rebuild the index.
  96      *
  97      * @return a SolrIndexOperation capable of rebuilding the current index
  98      */
  99     public SolrIndexOperation getReindexOperation();
 100 
 101     /**
 102      * Executes the given &lt;b&gt;operation&lt;/b&gt; in the correct method order
 103      *
 104      * @param operation the SolrIndexOperation that is to be executed
 105      * @throws ServiceException
 106      * @throws IOException
 107      */
<abbr title=" 108     public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOException;"> 108     public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOExceptðŸ”µ</abbr>
 109 
 110     /**
 111      * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 112      *
 113      * @param indexables
 114      * 		the list of items to index
 115      * @param solrServer
 116      * 		if non-null, adds and commits the indexed documents to the server. If this is null, this will
 117      * 		simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
 118      * @throws ServiceException
 119      *
 120      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
 121      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
 122      */
<abbr title=" 123     public abstract Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 123     public abstract Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extendsðŸ”µ</abbr>
 124 
 125     /**
 126      * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 127      * @param indexables the list of items to index
<abbr title=" 128      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 128      * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is nuðŸ”µ</abbr>
 129      * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
 130      *
 131      * @throws ServiceException
 132      * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
<abbr title=" 133      * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 133      * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the colleðŸ”µ</abbr>
 134      */
 135     @Deprecated
<abbr title=" 136     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 136     public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrðŸ”µ</abbr>
 137 
 138     /**
 139      * Saves some global context that might be altered during indexing.
 140      *
 141      * @return
 142      */
 143     public Object[] saveState();
 144 
 145     /**
 146      * Restores state that was saved prior to indexing that might have been altered.
 147      *
 148      * @see #saveState()
 149      * @param pack
 150      */
 151     public void restoreState(Object[] pack);
 152 
 153     /**
<abbr title=" 154      * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 154      * Triggers the Solr optimize index function on the given server. This is typically called at the endðŸ”µ</abbr>
 155      *
 156      * @param server
 157      *
 158      * @throws ServiceException
 159      *
 160      * @throws IOException
 161      *
 162      * @throws IOException
 163      *
 164      */
<abbr title=" 165     public abstract void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException;"> 165     public abstract void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOEðŸ”µ</abbr>
 166 
 167     /**
<abbr title=" 168      * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 168      * Triggers the Solr optimize index function on the given server. This is typically called at the endðŸ”µ</abbr>
 169      * @param server The server to use to optimze the default collection
 170      *
 171      * @throws ServiceException
 172      * @throws IOException
<abbr title=" 173      * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 173      * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s bðŸ”µ</abbr>
 174      */
 175     @Deprecated
 176     public void optimizeIndex(SolrClient server) throws ServiceException, IOException;
 177 
 178     /**
<abbr title=" 179      * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 179      * Allows a commit to be called.  By default, the details of the commit will depend on system propertðŸ”µ</abbr>
 180      *
<abbr title=" 181      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 181      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) shðŸ”µ</abbr>
 182      * solr.index.softCommit - indicates if a soft commit should be performed
 183      * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 184      * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 185      *
 186      * @param server
 187      *
 188      * @throws ServiceException
 189      *
 190      * @throws IOException
 191      *
 192      * @throws IOException
 193      *
 194      */
<abbr title=" 195     public abstract void commit(String collection, SolrClient server) throws ServiceException, IOException;"> 195     public abstract void commit(String collection, SolrClient server) throws ServiceException, IOExceptioðŸ”µ</abbr>
 196 
 197     /**
<abbr title=" 198      * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 198      * Allows a commit to be called.  By default, the details of the commit will depend on system propertðŸ”µ</abbr>
 199      *
<abbr title=" 200      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 200      * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) shðŸ”µ</abbr>
 201      * solr.index.softCommit - indicates if a soft commit should be performed
 202      * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 203      * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 204      * @param server The server used to commit the default collection
 205      *
 206      * @throws ServiceException
 207      * @throws IOException
<abbr title=" 208      * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 208      * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being usðŸ”µ</abbr>
 209      */
 210     @Deprecated
 211     public void commit(SolrClient server) throws ServiceException, IOException;
 212 
 213     /**
 214      * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 215      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 216      * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 217      *
 218      * Note that this method will force a commit even if solr.index.commit=false
 219      *
 220      * @param server
 221      * 		- the SolrClient to update
 222      * @param softCommit
 223      * 		- soft commit is an efficient commit that does not write the data to the file system
 224      * @param waitSearcher
 225      * 		- whether or not to wait for a new searcher to be created
 226      * @param waitFlush
 227      * 		- whether or not to wait for a flush to disk.
 228      * @throws ServiceException
 229      *
 230      * @throws IOException
 231      *
 232      * @throws IOException
 233      *
 234      */
<abbr title=" 235     public abstract void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 235     public abstract void commit(String collection, SolrClient server, boolean softCommit, boolean waitSeaðŸ”µ</abbr>
 236 
 237     /**
 238      * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 239      * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 240      * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 241      *
 242      * Note that this method will force a commit even if solr.index.commit=false
 243      * @param server - the SolrClient to commit with
<abbr title=" 244      * @param softCommit - soft commit is an efficient commit that does not write the data to the file system"> 244      * @param softCommit - soft commit is an efficient commit that does not write the data to the file syðŸ”µ</abbr>
 245      * @param waitSearcher - whether or not to wait for a new searcher to be created
 246      * @param waitFlush - whether or not to wait for a flush to disk.
 247      *
 248      * @throws ServiceException
 249      * @throws IOException
<abbr title=" 250      * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 250      * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that theðŸ”µ</abbr>
 251      */
 252     @Deprecated
<abbr title=" 253     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 253     public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) thðŸ”µ</abbr>
 254 
<abbr title=" 255     public abstract void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceException;"> 255     public abstract void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceðŸ”µ</abbr>
 256 
 257     /**
<abbr title=" 258      * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 258      * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the colleðŸ”µ</abbr>
 259      */
 260     @Deprecated
 261     public abstract void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException;
 262 
<abbr title=" 263     public abstract void deleteAllDocuments(String collection, SolrClient server) throws ServiceException;"> 263     public abstract void deleteAllDocuments(String collection, SolrClient server) throws ServiceExceptionðŸ”µ</abbr>
 264 
 265     /**
 266      *
 267      *
 268      * @param skus
 269      *
 270      */
 271     @Deprecated
 272     public abstract void deleteAllDocuments(SolrClient server) throws ServiceException;
 273 
 274     /**
 275      * Prints out the docs to the trace logger
 276      *
 277      * @param documents
 278      */
 279     public void logDocuments(Collection&lt;SolrInputDocument&gt; documents);
 280 
 281     /**
 282      * @return a list of all possible locale prefixes to consider
 283      */
 284     public List&lt;Locale&gt; getAllLocales();
 285 
 286     /**
<abbr title=" 287      * Given a product, fields that relate to that product, and a list of locales and pricelists, builds a"> 287      * Given a product, fields that relate to that product, and a list of locales and pricelists, builds ðŸ”µ</abbr>
 288      * SolrInputDocument to be added to the Solr index.
 289      *
 290      * @param product
 291      * @param fields
 292      * @param locales
 293      * @return the document
 294      */
<abbr title=" 295     public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 295     public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locðŸ”µ</abbr>
 296 
 297     /**
 298      * SolrIndexService exposes {@link #buildIncrementalIndex(int, int, boolean)}.
<abbr title=" 299      * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation.CacheOperation},"> 299      * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.sðŸ”µ</abbr>
<abbr title=" 300      * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an example:"> 300      * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an examplðŸ”µ</abbr>
 301      * {@code
 302      *  performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {
 303      *        @Override
 304      *        public void execute() throws ServiceException {
 305      *            int page = 0;
 306      *            while ((page * pageSize) &lt; numProducts) {
 307      *                buildIncrementalIndex(page, pageSize);
 308      *                page++;
 309      *            }
 310      *        }
 311      *    });
 312      * }
<abbr title=" 313      * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessary to call performCacheOperation"> 313      * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not ðŸ”µ</abbr>
 314      * for calls to rebuildIndex().
 315      *
 316      * @param cacheOperation the block of code to perform using a single cache for best performance
 317      * @throws ServiceException
 318      */
<abbr title=" 319     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException;"> 319     public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws SerðŸ”µ</abbr>
 320 
 321     /**
 322      * Iterates through the fields for this indexable and indexes any SearchField&#x27;s or SearchFacet&#x27;s.
 323      *  @param document
 324      * @param indexable
 325      * @param fields
 326      * @param locales
 327      */
<abbr title=" 328     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 328     public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexðŸ”µ</abbr>
 329 
 330     void deleteByQuery(String deleteQuery) throws SolrServerException, IOException;
 331 
 332     void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException;
 333 
 334     void logDeleteQuery(String deleteQuery);
 335 
 336     /**
<abbr title=" 337      * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}. By default, this is driven by the property,"> 337      * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}ðŸ”µ</abbr>
 338      * &#x27;solr.catalog.useLegacySolrIndexer&#x27;, which defaults to true.
 339      *
 340      * @return
 341      */
 342     public boolean useLegacyIndexer();
 343 }</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * #%L
   3   * BroadleafCommerce Framework
   4   * %%
   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6   * %%
   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10   * the Broadleaf End User License Agreement (EULA), Version 1.1
  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12   * shall apply.
  13   *
<abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr>
  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.
  16   * #L%
  17   */
  18  package org.broadleafcommerce.core.search.service.solr.index;
  19  
  20  import org.apache.solr.client.solrj.SolrClient;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -import org.apache.solr.client.solrj.SolrServer;</span>
  22  import org.apache.solr.client.solrj.SolrServerException;
  23  import org.apache.solr.common.SolrInputDocument;
  24  import org.broadleafcommerce.common.exception.ServiceException;
  25  import org.broadleafcommerce.common.locale.domain.Locale;
  26  import org.broadleafcommerce.core.catalog.domain.Indexable;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -import org.broadleafcommerce.core.catalog.domain.Sku;</span>
  28  import org.broadleafcommerce.core.search.domain.IndexField;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +import org.broadleafcommerce.core.search.service.solr.SolrConfiguration;</span>
  30  import org.broadleafcommerce.core.search.service.solr.indexer.CatalogSolrIndexUpdateService;
  31  
  32  import java.io.IOException;
  33  import java.util.Collection;
  34  import java.util.List;
  35  
  36  /**
  37   * Service exposing several methods for creating a Solr index based on catalog product data.
  38   *
  39   * @see org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation
  40   * @author Andre Azzolini (apazzolini)
  41   * @author Jeff Fischer
  42   * @author Phillip Verheyden (phillipuniverse)
  43   */
  44  public interface SolrIndexService {
  45  
  46      /**
  47       * &lt;p&gt;
<abbr title="  48       * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and then swap">  48       * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and thðŸ”µ</abbr>
<abbr title="  49       * out the active core/collection with the new version of the index (essentially replacing all documents that are">  49       * out the active core/collection with the new version of the index (essentially replacing all documents that ðŸ”µ</abbr>
  50       * currently in the index).
  51       *
  52       * &lt;p&gt;
  53       * The order of methods that are apart of rebuilding the entire index:
  54       * &lt;ol&gt;
  55       *  &lt;li&gt;&lt;pre&gt;{@link #preBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  56       *  &lt;li&gt;&lt;pre&gt;{@link #buildIndex()}&lt;/pre&gt;&lt;/li&gt;
  57       *  &lt;li&gt;&lt;pre&gt;{@link #postBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  58       * &lt;/ol&gt;
  59       *
  60       *
  61       * @throws IOException
  62       * @throws ServiceException
  63       */
  64      public void rebuildIndex() throws ServiceException, IOException;
  65  
  66      /**
<abbr title="  67       * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current index. This">  67       * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current indðŸ”µ</abbr>
  68       * is called at the beginning of {@link #rebuildIndex()}
  69       *
  70       * @throws ServiceException
  71       */
  72      public void preBuildIndex() throws ServiceException;
  73  
  74      /**
  75       * &lt;p&gt;
<abbr title="  76       * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperation&#x27;s need to be">  76       * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperatioðŸ”µ</abbr>
  77       * created, executed and the documents built and added to the Solr index
  78       *
  79       * &lt;p&gt;
<abbr title="  80       * This is the method that should be overridden to specify which operations should be run to build the correct index.">  80       * This is the method that should be overridden to specify which operations should be run to build the correctðŸ”µ</abbr>
  81       *
  82       * @throws IOException
  83       * @throws ServiceException
  84       * @see {@link #rebuildIndex()}
  85       * @see {@link #preBuildIndex()}
  86       */
  87      public void buildIndex() throws IOException, ServiceException;
  88  
  89      /**
<abbr title="  90       * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the index and swapping the cores.">  90       * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the inðŸ”µ</abbr>
  91       *
  92       * @throws IOException
  93       * @throws ServiceException
  94       */
  95      public void postBuildIndex() throws IOException, ServiceException;
  96  
  97      /**
<abbr title="  98       * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is the primary">  98       * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is thðŸ”µ</abbr>
  99       * index operation used to rebuild the index.
 100       *
 101       * @return a SolrIndexOperation capable of rebuilding the current index
 102       */
 103      public SolrIndexOperation getReindexOperation();
 104  
 105      /**
 106       * Executes the given &lt;b&gt;operation&lt;/b&gt; in the correct method order
 107       *
 108       * @param operation the SolrIndexOperation that is to be executed
 109       * @throws ServiceException
 110       * @throws IOException
 111       */
 112      public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOException;
 113  
 114      /**
 115       * Builds a set of {@link Indexable}s against the given {@link SolrServer}
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 117 +     * @param collection The collection to be used for incremental indexing</span>
 118       * @param indexables the list of items to index
<abbr title=" 119       * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 119       * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this ðŸ”µ</abbr>
 120       * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +     *</span>
 122       * @throws ServiceException
 123       * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
 124       */
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 125 +    public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 125 +    public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(String collection, List&lt;? extends Indexable&gt; indexaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +     * Builds a set of {@link Indexable}s against the given {@link SolrServer}</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +     * @param indexables the list of items to index</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 130 +     * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 130 +     * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 131 +     * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 132 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 133 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 134 +     * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 135 +     * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 135 +     * @deprecated Use {@link #buildIncrementalIndex(String, List, SolrClient)} instead so that the collection thaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 136 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +    @Deprecated</span>
<abbr title=" 138      public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 138      public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient soðŸ”µ</abbr>
 139  
 140      /**
 141       * Saves some global context that might be altered during indexing.
 142       *
 143       * @return
 144       */
 145      public Object[] saveState();
 146  
 147      /**
 148       * Restores state that was saved prior to indexing that might have been altered.
 149       *
 150       * @see #saveState()
 151       * @param pack
 152       */
 153      public void restoreState(Object[] pack);
 154  
 155      /**
<abbr title=" 156       * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 156       * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@lðŸ”µ</abbr>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 158 -     * @param server</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 159 -     * @throws ServiceException</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 160 -     * @throws IOException</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 161 -     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +     * @param collection The collection to optimize</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +     * @param server The server to use to optimze the given collection</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 166 +     * @throws IOException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +    public void optimizeIndex(String collection, SolrClient server) throws ServiceException, IOException;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 171 +     * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 171 +     * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@lðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +     * @param server The server to use to optimze the default collection</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +     * @throws IOException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 176 +     * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 176 +     * @deprecated Use {@link #optimizeIndex(String, SolrClient)} instead so that the collection that&#x27;s being usedðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +    @Deprecated</span>
 179      public void optimizeIndex(SolrClient server) throws ServiceException, IOException;
 180  
 181      /**
<abbr title=" 182       * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 182       * Allows a commit to be called.  By default, the details of the commit will depend on system properties, inclðŸ”µ</abbr>
 183       *
<abbr title=" 184       * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 184       * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be cðŸ”µ</abbr>
 185       * solr.index.softCommit - indicates if a soft commit should be performed
 186       * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 187       * solr.index.waitFlush - indicates if the process should wait for a flush to disk
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 188 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 189 -     * @param server</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 190 -     * @throws ServiceException</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 191 -     * @throws IOException</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 192 -     */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 193 -</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 194 +     * @param collection The collection to commit</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 195 +     * @param server The server used to commit the specified collection</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 196 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +     * @throws IOException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +    public void commit(String collection, SolrClient server) throws ServiceException, IOException;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 204 +     * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 204 +     * Allows a commit to be called.  By default, the details of the commit will depend on system properties, inclðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 205 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 206 +     * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 206 +     * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be cðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 207 +     * solr.index.softCommit - indicates if a soft commit should be performed</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 208 +     * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 209 +     * solr.index.waitFlush - indicates if the process should wait for a flush to disk</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 210 +     * @param server The server used to commit the default collection</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 211 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +     * @throws IOException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 214 +     * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 214 +     * @deprecated Use {@link #commit(String, SolrClient)} instead so that the collection that&#x27;s being used can beðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +    @Deprecated</span>
 217      public void commit(SolrClient server) throws ServiceException, IOException;
 218  
 219      /**
 220       * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 221       * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 222       * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 223       *
 224       * Note that this method will force a commit even if solr.index.commit=false
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 225 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 226 -     * @param server - the SolrClient to update</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +     * @param collection The collection to commit</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 228 +     * @param server - the SolrClient to use to commit the provided collection</span>
 229       * @param softCommit - soft commit is an efficient commit that does not write the data to the file system
 230       * @param waitSearcher - whether or not to wait for a new searcher to be created
 231       * @param waitFlush - whether or not to wait for a flush to disk.
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 232 -     * @throws ServiceException</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 233 -     * @throws IOException</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 234 -     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 235 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 236 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 237 +     * @throws IOException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 238 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 239 +    public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 239 +    public void commit(String collection, SolrClient server, boolean softCommit, boolean waitSearcher, boolean waiðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 240 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 241 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 242 +     * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 243 +     * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +     * using autoCommit, or at the end of the commit process to flush the changes to the disk.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +     * Note that this method will force a commit even if solr.index.commit=false</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +     * @param server - the SolrClient to commit with</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +     * @param softCommit - soft commit is an efficient commit that does not write the data to the file system</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +     * @param waitSearcher - whether or not to wait for a new searcher to be created</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +     * @param waitFlush - whether or not to wait for a flush to disk.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +     *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +     * @throws ServiceException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +     * @throws IOException</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 254 +     * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 254 +     * @deprecated Use {@link #commit(String, SolrClient, boolean, boolean, boolean)} instead so that the collectiðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +    @Deprecated</span>
<abbr title=" 257      public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 257      public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServðŸ”µ</abbr>
 258  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +    public void deleteAllNamespaceDocuments(String collection, SolrClient server) throws ServiceException;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 261 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 262 +     * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 262 +     * @deprecated Use {@link #deleteAllNamespaceDocuments(String, SolrClient)} instead so that the collection thaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 263 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 264 +    @Deprecated</span>
 265      public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException;
 266  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 267 +    public void deleteAllDocuments(String collection, SolrClient server) throws ServiceException;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 268 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 269 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 270 +     * @deprecated Use {@link #deleteAllDocuments(String, SolrClient)} instead so that the collection that&#x27;s being used can be customized otherwise the default collection will always be used. Generally use {@link SolrConfiguration#getQueryCollectionName()} or {@link SolrConfiguration#getReindexCollectionName()}"> 270 +     * @deprecated Use {@link #deleteAllDocuments(String, SolrClient)} instead so that the collection that&#x27;s beingðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 271 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 272 +    @Deprecated</span>
 273      public void deleteAllDocuments(SolrClient server) throws ServiceException;
 274  
 275      /**
 276       * Prints out the docs to the trace logger
 277       *
 278       * @param documents
 279       */
 280      public void logDocuments(Collection&lt;SolrInputDocument&gt; documents);
 281  
 282      /**
 283       * @return a list of all possible locale prefixes to consider
 284       */
 285      public List&lt;Locale&gt; getAllLocales();
 286  
 287      /**
 288       * Given a product, fields that relate to that product, and a list of locales and pricelists, builds a
 289       * SolrInputDocument to be added to the Solr index.
 290       *
 291       * @param product
 292       * @param fields
 293       * @param locales
 294       * @return the document
 295       */
 296      public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);
 297  
 298      /**
 299       * SolrIndexService exposes {@link #buildIncrementalIndex(int, int, boolean)}.
<abbr title=" 300       * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation.CacheOperation},"> 300       * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.indexðŸ”µ</abbr>
 301       * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an example:
 302       * {@code
 303       *  performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {
 304       *        @Override
 305       *        public void execute() throws ServiceException {
 306       *            int page = 0;
 307       *            while ((page * pageSize) &lt; numProducts) {
 308       *                buildIncrementalIndex(page, pageSize);
 309       *                page++;
 310       *            }
 311       *        }
 312       *    });
 313       * }
<abbr title=" 314       * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessary to call performCacheOperation"> 314       * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessaryðŸ”µ</abbr>
 315       * for calls to rebuildIndex().
 316       *
 317       * @param cacheOperation the block of code to perform using a single cache for best performance
 318       * @throws ServiceException
 319       */
<abbr title=" 320      public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException;"> 320      public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceExcepðŸ”µ</abbr>
 321  
 322      /**
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 323 -     * &lt;p&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 324 -     * Filters out Skus that shouldn&#x27;t be indexed if any of the following are true:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 325 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 326 -     * &lt;p&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 327 -     * &lt;ol&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 328 -     *  &lt;li&gt;If it&#x27;s inactive&lt;/li&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 329 -     *  &lt;li&gt;If it&#x27;s a default Sku and shouldn&#x27;t be sold without product options&lt;/li&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 330 -     *  &lt;li&gt;If it&#x27;s a default Sku for a Product Bundle&lt;/li&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 331 -     * &lt;/ol&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 332 -     *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 333 -     * @param skus</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 334 -     * @return a new list based on the given set of &lt;b&gt;skus&lt;/b&gt; that only contains Skus that should be indexed</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 335 -     */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 336 -    public List&lt;Sku&gt; filterIndexableSkus(List&lt;Sku&gt; skus);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 337 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 338 -    /**</span>
 339       * Iterates through the fields for this indexable and indexes any SearchField&#x27;s or SearchFacet&#x27;s.
 340       *  @param document
 341       * @param indexable
 342       * @param fields
 343       * @param locales
 344       */
<abbr title=" 345      public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 345      public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fiðŸ”µ</abbr>
 346  
 347      void deleteByQuery(String deleteQuery) throws SolrServerException, IOException;
 348  
 349      void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException;
 350  
 351      void logDeleteQuery(String deleteQuery);
 352  
 353      /**
<abbr title=" 354       * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}. By default, this is driven by the property,"> 354       * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}. By defaðŸ”µ</abbr>
 355       * &#x27;solr.catalog.useLegacySolrIndexer&#x27;, which defaults to true.
 356       *
 357       * @return
 358       */
 359      public boolean useLegacyIndexer();
 360  }</pre></td>
                            <td><pre>   1  /*
   2   * #%L
   3   * BroadleafCommerce Framework
   4   * %%
   5   * Copyright (C) 2009 - 2016 Broadleaf Commerce
   6   * %%
   7   * Licensed under the Broadleaf Fair Use License Agreement, Version 1.0
   8   * (the &quot;Fair Use License&quot; located  at http://license.broadleafcommerce.org/fair_use_license-1.0.txt)
   9   * unless the restrictions on use therein are violated and require payment to Broadleaf in which case
  10   * the Broadleaf End User License Agreement (EULA), Version 1.1
  11   * (the &quot;Commercial License&quot; located at http://license.broadleafcommerce.org/commercial_license-1.1.txt)
  12   * shall apply.
  13   *
<abbr title="  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;)">  14   * Alternatively, the Commercial License may be replaced with a mutually agreed upon license (the &quot;Custom License&quot;ðŸ”µ</abbr>
  15   * between you and Broadleaf Commerce. You may not use this file except in compliance with the applicable license.
  16   * #L%
  17   */
  18  package org.broadleafcommerce.core.search.service.solr.index;
  19  
  20  import org.apache.solr.client.solrj.SolrClient;
  21  import org.apache.solr.client.solrj.SolrServer;
  22  import org.apache.solr.client.solrj.SolrServerException;
  23  import org.apache.solr.common.SolrInputDocument;
  24  import org.broadleafcommerce.common.exception.ServiceException;
  25  import org.broadleafcommerce.common.locale.domain.Locale;
  26  import org.broadleafcommerce.core.catalog.domain.Indexable;
  27  import org.broadleafcommerce.core.catalog.domain.Sku;
  28  import org.broadleafcommerce.core.search.domain.IndexField;

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -import org.broadleafcommerce.core.search.service.solr.indexer.CatalogSolrIndexUpdateService;</span>
  30  
  31  import java.io.IOException;
  32  import java.util.Collection;
  33  import java.util.List;
  34  
  35  /**
  36   * Service exposing several methods for creating a Solr index based on catalog product data.
  37   *
  38   * @see org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation
  39   * @author Andre Azzolini (apazzolini)
  40   * @author Jeff Fischer
  41   * @author Phillip Verheyden (phillipuniverse)
  42   */
  43  public interface SolrIndexService {
  44  
  45      /**
  46       * &lt;p&gt;
<abbr title="  47       * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and then swap">  47       * Executes a full rebuild of the Solr index. This will rebuild the index on a separate core/collection and thðŸ”µ</abbr>
<abbr title="  48       * out the active core/collection with the new version of the index (essentially replacing all documents that are">  48       * out the active core/collection with the new version of the index (essentially replacing all documents that ðŸ”µ</abbr>
  49       * currently in the index).
  50       *
  51       * &lt;p&gt;
  52       * The order of methods that are apart of rebuilding the entire index:
  53       * &lt;ol&gt;
  54       *  &lt;li&gt;&lt;pre&gt;{@link #preBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  55       *  &lt;li&gt;&lt;pre&gt;{@link #buildIndex()}&lt;/pre&gt;&lt;/li&gt;
  56       *  &lt;li&gt;&lt;pre&gt;{@link #postBuildIndex()}&lt;/pre&gt;&lt;/li&gt;
  57       * &lt;/ol&gt;
  58       *
  59       *
  60       * @throws IOException
  61       * @throws ServiceException
  62       */
  63      public void rebuildIndex() throws ServiceException, IOException;
  64  
  65      /**
<abbr title="  66       * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current index. This">  66       * Executed before we do any indexing when rebuilding the index. Usually this handles deleting the current indðŸ”µ</abbr>
  67       * is called at the beginning of {@link #rebuildIndex()}
  68       *
  69       * @throws ServiceException
  70       */
  71      public void preBuildIndex() throws ServiceException;
  72  
  73      /**
  74       * &lt;p&gt;
<abbr title="  75       * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperation&#x27;s need to be">  75       * Handles all the document building for the current index rebuild. This is where all of the SolrIndexOperatioðŸ”µ</abbr>
  76       * created, executed and the documents built and added to the Solr index
  77       *
  78       * &lt;p&gt;
<abbr title="  79       * This is the method that should be overridden to specify which operations should be run to build the correct index.">  79       * This is the method that should be overridden to specify which operations should be run to build the correctðŸ”µ</abbr>
  80       *
  81       * @throws IOException
  82       * @throws ServiceException
  83       * @see {@link #rebuildIndex()}
  84       * @see {@link #preBuildIndex()}
  85       */
  86      public void buildIndex() throws IOException, ServiceException;
  87  
  88      /**
<abbr title="  89       * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the index and swapping the cores.">  89       * Executed after we do any indexing when rebuilding the current index. Usually this handles optimizing the inðŸ”µ</abbr>
  90       *
  91       * @throws IOException
  92       * @throws ServiceException
  93       */
  94      public void postBuildIndex() throws IOException, ServiceException;
  95  
  96      /**
<abbr title="  97       * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is the primary">  97       * Creates the  SolrIndexOperation for rebuilding the current index, used by {@link #buildIndex()}. This is thðŸ”µ</abbr>
  98       * index operation used to rebuild the index.
  99       *
 100       * @return a SolrIndexOperation capable of rebuilding the current index
 101       */
 102      public SolrIndexOperation getReindexOperation();
 103  
 104      /**
 105       * Executes the given &lt;b&gt;operation&lt;/b&gt; in the correct method order
 106       *
 107       * @param operation the SolrIndexOperation that is to be executed
 108       * @throws ServiceException
 109       * @throws IOException
 110       */
 111      public void executeSolrIndexOperation(SolrIndexOperation operation) throws ServiceException, IOException;
 112  
 113      /**
 114       * Builds a set of {@link Indexable}s against the given {@link SolrServer}
 115       *

 116       * @param indexables the list of items to index
<abbr title=" 117       * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this will"> 117       * @param solrServer if non-null, adds and commits the indexed documents to the server. If this is null, this ðŸ”µ</abbr>
 118       * simply return the documents that were built from &lt;b&gt;indexables&lt;/b&gt;

 119       * @throws ServiceException
 120       * @return the {@link SolrInputDocument}s that were built from the given &lt;b&gt;indexables&lt;/b&gt;
 121       */













<abbr title=" 122      public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient solrServer) throws ServiceException;"> 122      public Collection&lt;SolrInputDocument&gt; buildIncrementalIndex(List&lt;? extends Indexable&gt; indexables, SolrClient soðŸ”µ</abbr>
 123  
 124      /**
 125       * Saves some global context that might be altered during indexing.
 126       *
 127       * @return
 128       */
 129      public Object[] saveState();
 130  
 131      /**
 132       * Restores state that was saved prior to indexing that might have been altered.
 133       *
 134       * @see #saveState()
 135       * @param pack
 136       */
 137      public void restoreState(Object[] pack);
 138  
 139      /**
<abbr title=" 140       * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@link #rebuildIndex()}"> 140       * Triggers the Solr optimize index function on the given server. This is typically called at the end of a {@lðŸ”µ</abbr>
 141       *
 142       * @param server
 143       * @throws ServiceException
 144       * @throws IOException
 145       */

















 146      public void optimizeIndex(SolrClient server) throws ServiceException, IOException;
 147  
 148      /**
<abbr title=" 149       * Allows a commit to be called.  By default, the details of the commit will depend on system properties, including:"> 149       * Allows a commit to be called.  By default, the details of the commit will depend on system properties, inclðŸ”µ</abbr>
 150       *
<abbr title=" 151       * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be configured in Solr."> 151       * solr.index.commit - if false, then no commit will be performed. autoCommit (and autoSoftCommit) should be cðŸ”µ</abbr>
 152       * solr.index.softCommit - indicates if a soft commit should be performed
 153       * solr.index.waitSearcher - indicates if the process should wait for a searcher to be configured
 154       * solr.index.waitFlush - indicates if the process should wait for a flush to disk
 155       *
 156       * @param server
 157       * @throws ServiceException
 158       * @throws IOException
 159       */
 160  























 161      public void commit(SolrClient server) throws ServiceException, IOException;
 162  
 163      /**
 164       * This allows an external caller to force a commit to the SolrClient.  See Solr Documentation for
 165       * additional details.  If using softCommit, you should ensure that a hardCommit is performed, either
 166       * using autoCommit, or at the end of the commit process to flush the changes to the disk.
 167       *
 168       * Note that this method will force a commit even if solr.index.commit=false
 169       *
 170       * @param server - the SolrClient to update


 171       * @param softCommit - soft commit is an efficient commit that does not write the data to the file system
 172       * @param waitSearcher - whether or not to wait for a new searcher to be created
 173       * @param waitFlush - whether or not to wait for a flush to disk.
 174       * @throws ServiceException
 175       * @throws IOException
 176       */






















<abbr title=" 177      public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServiceException, IOException;"> 177      public void commit(SolrClient server, boolean softCommit, boolean waitSearcher, boolean waitFlush) throws ServðŸ”µ</abbr>
 178  






 179      public void deleteAllNamespaceDocuments(SolrClient server) throws ServiceException;
 180  






 181      public void deleteAllDocuments(SolrClient server) throws ServiceException;
 182  
 183      /**
 184       * Prints out the docs to the trace logger
 185       *
 186       * @param documents
 187       */
 188      public void logDocuments(Collection&lt;SolrInputDocument&gt; documents);
 189  
 190      /**
 191       * @return a list of all possible locale prefixes to consider
 192       */
 193      public List&lt;Locale&gt; getAllLocales();
 194  
 195      /**
 196       * Given a product, fields that relate to that product, and a list of locales and pricelists, builds a
 197       * SolrInputDocument to be added to the Solr index.
 198       *
 199       * @param product
 200       * @param fields
 201       * @param locales
 202       * @return the document
 203       */
 204      public SolrInputDocument buildDocument(Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);
 205  
 206      /**
 207       * SolrIndexService exposes {@link #buildIncrementalIndex(int, int, boolean)}.
<abbr title=" 208       * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.index.SolrIndexCachedOperation.CacheOperation},"> 208       * By wrapping the call to this method inside of a {@link org.broadleafcommerce.core.search.service.solr.indexðŸ”µ</abbr>
 209       * a single cache will be used for all the contained calls to buildIncrementalIndex. Here&#x27;s an example:
 210       * {@code
 211       *  performCachedOperation(new SolrIndexCachedOperation.CacheOperation() {
 212       *        @Override
 213       *        public void execute() throws ServiceException {
 214       *            int page = 0;
 215       *            while ((page * pageSize) &lt; numProducts) {
 216       *                buildIncrementalIndex(page, pageSize);
 217       *                page++;
 218       *            }
 219       *        }
 220       *    });
 221       * }
<abbr title=" 222       * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessary to call performCacheOperation"> 222       * Note {@link #rebuildIndex()} already internally wraps its call using CacheOperation, so it is not necessaryðŸ”µ</abbr>
 223       * for calls to rebuildIndex().
 224       *
 225       * @param cacheOperation the block of code to perform using a single cache for best performance
 226       * @throws ServiceException
 227       */
<abbr title=" 228      public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceException;"> 228      public void performCachedOperation(SolrIndexCachedOperation.CacheOperation cacheOperation) throws ServiceExcepðŸ”µ</abbr>
 229  
 230      /**
 231       * &lt;p&gt;
 232       * Filters out Skus that shouldn&#x27;t be indexed if any of the following are true:
 233       *
 234       * &lt;p&gt;
 235       * &lt;ol&gt;
 236       *  &lt;li&gt;If it&#x27;s inactive&lt;/li&gt;
 237       *  &lt;li&gt;If it&#x27;s a default Sku and shouldn&#x27;t be sold without product options&lt;/li&gt;
 238       *  &lt;li&gt;If it&#x27;s a default Sku for a Product Bundle&lt;/li&gt;
 239       * &lt;/ol&gt;
 240       *
 241       * @param skus
 242       * @return a new list based on the given set of &lt;b&gt;skus&lt;/b&gt; that only contains Skus that should be indexed
 243       */
 244      public List&lt;Sku&gt; filterIndexableSkus(List&lt;Sku&gt; skus);
 245  
 246      /**
 247       * Iterates through the fields for this indexable and indexes any SearchField&#x27;s or SearchFacet&#x27;s.
 248       *  @param document
 249       * @param indexable
 250       * @param fields
 251       * @param locales
 252       */
<abbr title=" 253      public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fields, List&lt;Locale&gt; locales);"> 253      public void attachIndexableDocumentFields(SolrInputDocument document, Indexable indexable, List&lt;IndexField&gt; fiðŸ”µ</abbr>
 254  
 255      void deleteByQuery(String deleteQuery) throws SolrServerException, IOException;
 256  
 257      void addDocuments(Collection&lt;SolrInputDocument&gt; documents) throws IOException, SolrServerException;
 258  
 259      void logDeleteQuery(String deleteQuery);
 260  
 261      /**
<abbr title=" 262       * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}. By default, this is driven by the property,"> 262       * Indicates if this should be used.  The alternative is to use {@link CatalogSolrIndexUpdateService}. By defaðŸ”µ</abbr>
 263       * &#x27;solr.catalog.useLegacySolrIndexer&#x27;, which defaults to true.
 264       *
 265       * @return
 266       */
 267      public boolean useLegacyIndexer();
 268  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            