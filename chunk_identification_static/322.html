<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>322</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    322
                    <a href="321.html">prev</a>
                    <a href="323.html">next</a>
                    <a href="322_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Automattic/simplenote-android_6780311d33539eb86c4007a7d1993f6f1467a837_src/com/automattic/simplenote/NoteListFragment.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837:src/com/automattic/simplenote/NoteListFragment.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837^1:src/com/automattic/simplenote/NoteListFragment.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837^2:src/com/automattic/simplenote/NoteListFragment.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;20279c862696f156d42fbdab7ae10281f312fb27:src/com/automattic/simplenote/NoteListFragment.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[sbj]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
   2 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import android.app.ActionBar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import android.app.ListFragment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 import android.text.Html;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 import android.widget.ArrayAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 import android.widget.ImageView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import android.widget.SimpleCursorAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import android.widget.SpinnerAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import com.automattic.simplenote.models.Tag;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import com.automattic.simplenote.utils.PrefUtils;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import com.simperium.client.Bucket.OnSaveObjectListener;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import com.simperium.client.Bucket.OnDeleteObjectListener;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import com.simperium.client.Bucket.OnNetworkChangeListener;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import com.simperium.client.BucketObjectMissingException;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40  * A list fragment representing a list of Notes. This fragment also supports</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41  * tablet devices by allowing list items to be given an &#x27;activated&#x27; state upon</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42  * selection. This helps indicate which item is currently being viewed in a</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43  * {@link NoteEditorFragment}.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44  * &lt;p&gt;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45  * Activities containing this fragment MUST implement the {@link Callbacks}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46  * interface.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 public class NoteListFragment extends ListFragment implements ActionBar.OnNavigationListener {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50     private static final int NAVIGATION_ITEM_ALL_NOTES=0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51     private static final int NAVIGATION_ITEM_TRASH=1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53 	private NotesCursorAdapter mNotesAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54 	private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55 	private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56     private TextView mEmptyListTextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57 	private int mNumPreviewLines;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58 	private String[] mMenuItems;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59     private String mSelectedTag;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60     private String mSearchString;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 	private int mNavigationItem;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63 	 * The serialization (saved instance state) Bundle key representing the</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64 	 * activated item position. Only used on tablets.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66 	private static final String STATE_ACTIVATED_POSITION = &quot;activated_position&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69 	 * The fragment&#x27;s current callback object, which is notified of list item</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 	 * clicks.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72 	private Callbacks mCallbacks = sCallbacks;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75 	 * The current activated item position. Only used on tablets.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77 	private int mActivatedPosition = ListView.INVALID_POSITION;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80 	 * A callback interface that all activities containing this fragment must</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81 	 * implement. This mechanism allows activities to be notified of item</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 	 * selections.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84 	public interface Callbacks {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85 		/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 		 * Callback for when a note has been selected.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87 		 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88 		public void onNoteSelected(Note note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92 	 * A dummy implementation of the {@link Callbacks} interface that does</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93 	 * nothing. Used only when this fragment is not attached to an activity.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95 	private static Callbacks sCallbacks = new Callbacks() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96 		@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97 		public void onNoteSelected(Note note) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99 	};</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102 	 * Mandatory empty constructor for the fragment manager to instantiate the</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103 	 * fragment (e.g. upon screen orientation changes).</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105 	public NoteListFragment() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109 	public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110 		super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112 		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113 		mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114         mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116         ObjectCursor&lt;Note&gt; cursor = queryNotes();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117 		mNotesAdapter = new NotesCursorAdapter(getActivity().getBaseContext(), cursor, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118 		setListAdapter(mNotesAdapter);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123     public void onActivityCreated(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124         super.onActivityCreated(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128     // nbradbury - load values from preferences</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129 	protected void getPrefs() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130 		mNumPreviewLines = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_NUM_PREVIEW_LINES, 2);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134 	public void onViewCreated(View view, Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135 		super.onViewCreated(view, savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137         setListShown(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 139         mEmptyListTextView = (TextView)getActivity().getLayoutInflater().inflate(R.layout.empty_list, null);"> 139         mEmptyListTextView = (TextView)getActivity().getLayoutInflater().inflate(R.layout.empty_list, nulðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140         getListView().setEmptyView(mEmptyListTextView);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141         mEmptyListTextView.setVisibility(View.GONE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142         ((ViewGroup)getListView().getParent()).addView(mEmptyListTextView);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144 		// Restore the previously serialized activated item position.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145 		if (savedInstanceState != null &amp;&amp; savedInstanceState.containsKey(STATE_ACTIVATED_POSITION)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146 			setActivatedPosition(savedInstanceState.getInt(STATE_ACTIVATED_POSITION));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149         getListView().setDivider(getResources().getDrawable(R.drawable.list_divider));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150         getListView().setDividerHeight(2);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151         getListView().setBackgroundColor(getResources().getColor(R.color.white));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153         updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157 	public void onAttach(Activity activity) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158 		super.onAttach(activity);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160 		// Activities containing this fragment must implement its callbacks.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161 		if (!(activity instanceof Callbacks)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162 			throw new IllegalStateException(&quot;Activity must implement fragment&#x27;s callbacks.&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165 		mCallbacks = (Callbacks) activity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169 	public void onResume() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170 		super.onResume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171         getPrefs();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172         refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173         updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174         // update the view again</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175         mTagsBucket.addListener(mTagsMenuUpdater);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179     public void onPause(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180         super.onPause();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181         mTagsBucket.removeListener(mTagsMenuUpdater);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185 	public void onDetach() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186 		super.onDetach();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188 		// Reset the active callbacks interface to the dummy implementation.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189 		mCallbacks = sCallbacks;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193     public void onDestroy(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194         super.onDestroy();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198 	public void onListItemClick(ListView listView, View view, int position, long id) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199 		super.onListItemClick(listView, view, position, id);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201 		Note note = (Note)getListAdapter().getItem(position);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202         if (note != null)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203             mCallbacks.onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207 	public void onSaveInstanceState(Bundle outState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208 		super.onSaveInstanceState(outState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209 		if (mActivatedPosition != ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210 			// Serialize and persist the activated item position.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211 			outState.putInt(STATE_ACTIVATED_POSITION, mActivatedPosition);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216 	 * Turns on activate-on-click mode. When this mode is on, list items will be</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217 	 * given the &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219 	public void setActivateOnItemClick(boolean activateOnItemClick) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220 		// When setting CHOICE_MODE_SINGLE, ListView will automatically</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221 		// give items the &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 222 		getListView().setChoiceMode(activateOnItemClick ? ListView.CHOICE_MODE_SINGLE : ListView.CHOICE_MODE_NONE);"> 222 		getListView().setChoiceMode(activateOnItemClick ? ListView.CHOICE_MODE_SINGLE : ListView.CHOICE_MODE_NOðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224 		// Also select the first item by default</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225 		// TODO: persist the last selected item and restore that instead</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226 		if (!mNotesAdapter.isEmpty()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227 			View v = mNotesAdapter.getView(0, null, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228 			getListView().performItemClick(v, 0, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232 	private void setActivatedPosition(int position) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233         if (getListView() != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234             if (position == ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235                 getListView().setItemChecked(mActivatedPosition, false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236             } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237                 getListView().setItemChecked(position, true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240             mActivatedPosition = position;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244 	@SuppressWarnings(&quot;deprecation&quot;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245 	public void refreshList() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246 		Log.d(Simplenote.TAG, &quot;Refresh the list&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248 		mNotesAdapter.notifyDataSetChanged();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251     public ObjectCursor&lt;Note&gt; queryNotes(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252         Log.d(Simplenote.TAG, String.format(&quot;Querying %d %s&quot;, mNavigationItem, mSelectedTag));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253         Query&lt;Note&gt; query = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254         if (mSearchString != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255             query = Note.search(mNotesBucket, mSearchString);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256         } else if (mNavigationItem == NAVIGATION_ITEM_ALL_NOTES) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257 			// All notes</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258 			query = Note.all(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259 		} else if (mNavigationItem == NAVIGATION_ITEM_TRASH) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260 			// Trashed notes</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261 			query = Note.allDeleted(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262 		} else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263 			query = Note.allInTag(mNotesBucket, mSelectedTag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265         query.include(&quot;title&quot;, &quot;contentPreview&quot;, &quot;pinned&quot;, &quot;modificationDate&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266         sortNoteQuery(query);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267         return query.execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270 	private void updateMenuItems() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271 		// Update ActionBar menu</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272 		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273         Bucket&lt;Tag&gt; tagBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274         ObjectCursor&lt;Tag&gt; tagCursor = Tag.all(tagBucket).execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275 		String[] tags = new String[tagCursor.getCount()];</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276         while (tagCursor.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277             Tag tag = tagCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278             tags[tagCursor.getPosition()] = tag.getName();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280         tagCursor.close();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 281 		String[] topItems = { getResources().getString(R.string.notes), getResources().getString(R.string.trash) };"> 281 		String[] topItems = { getResources().getString(R.string.notes), getResources().getString(R.string.trashðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282 		mMenuItems = Arrays.copyOf(topItems, tags.length + 2);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283         ActionBar ab = getActivity().getActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284         ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285 		System.arraycopy(tags, 0, mMenuItems, 2, tags.length);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 286 		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_spinner_item, mMenuItems);"> 286 		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287         mSpinnerAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288 		ab.setListNavigationCallbacks(mSpinnerAdapter, this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289         if (mNavigationItem &lt; mMenuItems.length) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290             ab.setSelectedNavigationItem(mNavigationItem);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294 	public void addNote() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 295 		// TODO: nbradbury - creating &amp; saving a new note here causes an empty note to appear which doesn&#x27;t go away if user backs out"> 295 		// TODO: nbradbury - creating &amp; saving a new note here causes an empty note to appear which doesn&#x27;t go ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 296 		// of editing the note (iOS app suffers from the same problem) - instead NoteEditorFragment should be changed to handle new"> 296 		// of editing the note (iOS app suffers from the same problem) - instead NoteEditorFragment should be cðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297 		// note creation and only save the note if user has entered any content</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298 		</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299 		// create &amp; save new note</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300 		Simplenote simplenote = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301 		Bucket&lt;Note&gt; notesBucket = simplenote.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302 		Note note = notesBucket.newObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303         note.setCreationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304 		note.save(); </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305 		</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306 		// refresh listview so new note appears</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307 		refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308 		</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 309 		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not always select the correct note depending on user&#x27;s sort preference"> 309 		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not alðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310 		mCallbacks.onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311 		</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312 		// Select the new note</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313 		//View v = mNotesAdapter.getView(0, null, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314 		//getListView().performItemClick(v, 0, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317     public void setNoteSelected(Note selectedNote) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318         // Loop through notes and set note selected if found</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319         for(int i=0; i &lt; mNotesAdapter.getCount(); i++) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320             Note note = (Note)mNotesAdapter.getItem(i);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321             if (note.getSimperiumKey().equals(selectedNote.getSimperiumKey())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322                 setActivatedPosition(i);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323                 break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328 	public class NotesCursorAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329         private ObjectCursor&lt;Note&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330         public NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; c, int flags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331             super(context, c, flags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332             mCursor = c;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335         public void changeCursor(ObjectCursor&lt;Note&gt; cursor){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337             super.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341         public Note getItem(int position) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346         /*</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347         *  nbradbury - implemented &quot;holder pattern&quot; to boost performance with large note lists</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348         */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349 		@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350 		public View getView(int position, View view, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352 			NoteViewHolder holder;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353 			if (view == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354 				view = View.inflate(getActivity().getBaseContext(), R.layout.note_list_row, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355 				holder = new NoteViewHolder();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356 				holder.titleTextView = (TextView) view.findViewById(R.id.note_title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357 				holder.contentTextView = (TextView) view.findViewById(R.id.note_content);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358 				holder.pinImageView = (ImageView) view.findViewById(R.id.note_pin);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359 				view.setTag(holder);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360 			} else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361 				holder = (NoteViewHolder) view.getTag();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362 			}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364             // for performance reasons we are going to get indexed values</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365             // from the cursor instead of instantiating the entire bucket object</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366             holder.contentTextView.setMaxLines(mNumPreviewLines);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368             int pinned = mCursor.getInt(mCursor.getColumnIndex(&quot;pinned&quot;));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369             holder.pinImageView.setVisibility(pinned == 1 ? View.VISIBLE : View.GONE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371             String title = mCursor.getString(mCursor.getColumnIndex(&quot;title&quot;));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372             if (title == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373                 title = getString(R.string.new_note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 374             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 375             holder.titleTextView.setText(title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 376 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377             if (mNumPreviewLines &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 378                 holder.contentTextView.setText(mCursor.getString(mCursor.getColumnIndex(&quot;contentPreview&quot;)));"> 378                 holder.contentTextView.setText(mCursor.getString(mCursor.getColumnIndex(&quot;contentPreview&quot;)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 380 			</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 381 			return view;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385         public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386             return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390         public void bindView(View view, Context context, Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396 	// view holder for NotesCursorAdapter</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397 	private static class NoteViewHolder {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398 		TextView titleTextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399 		TextView contentTextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400 		ImageView pinImageView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401         private String mNoteId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403         public void setNoteId(String noteId) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404             mNoteId = noteId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407         public String getNoteId() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408             return mNoteId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412 	public void searchNotes(String searchString) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413         mSearchString = searchString;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414 		mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418      * Clear search and load all notes</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420     public void clearSearch() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421         mSearchString = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426 	public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427         Log.d(Simplenote.TAG, &quot;onNavigationItemSelected&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429         // Update empty list placeholder text</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430         if (mEmptyListTextView != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431             if (itemPosition == NAVIGATION_ITEM_TRASH)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432                 mEmptyListTextView.setText(Html.fromHtml(getString(R.string.trash_is_empty)));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433             else</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434                 mEmptyListTextView.setText(Html.fromHtml(getString(R.string.no_notes)));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437 		Query&lt;Note&gt; query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438 		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439         Bucket&lt;Note&gt; noteBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440 		mNavigationItem = itemPosition;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441         if (itemPosition &gt; 1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442             mSelectedTag = mMenuItems[itemPosition];</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444             mSelectedTag = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448         getActivity().invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449 		</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450 		return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453     public void sortNoteQuery(Query&lt;Note&gt; noteQuery){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454         noteQuery.order(&quot;pinned&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455 		int sortPref = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_SORT_ORDER);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456 		switch (sortPref) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457         case 0:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458             noteQuery.order(&quot;modificationDate&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459             break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460 		case 1:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461             // orderBy = &quot;creationDate DESC&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462             noteQuery.order(&quot;creationDate&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464 		case 2:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465             noteQuery.order(&quot;content&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467 		case 3:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468             noteQuery.order(&quot;modificationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470 		case 4:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471             noteQuery.order(&quot;creationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473 		case 5:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474             noteQuery.order(&quot;content&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480     private Bucket.Listener&lt;Tag&gt; mTagsMenuUpdater = new Bucket.Listener&lt;Tag&gt;(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481         void updateMenu(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482             getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483                 public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484                     updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 489         public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag tag){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 490             updateMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 491         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 492 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 493         public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag tag){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 494             updateMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 495         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 496 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497         public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498             updateMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500     };</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501 }</span>
 502 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 503 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 504 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505 import android.app.ActionBar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507 import android.app.ListFragment;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509 import android.content.SharedPreferences;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510 import android.content.res.Configuration;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513 import android.preference.PreferenceManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514 import android.text.Html;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519 import android.widget.AbsListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520 import android.widget.ArrayAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522 import android.widget.ImageView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523 import android.widget.LinearLayout;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528 import com.automattic.simplenote.models.Tag;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529 import com.automattic.simplenote.utils.PrefUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 536 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 537 import java.util.prefs.Preferences;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 538 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 539 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 540  * A list fragment representing a list of Notes. This fragment also supports</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 541  * tablet devices by allowing list items to be given an &#x27;activated&#x27; state upon</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542  * selection. This helps indicate which item is currently being viewed in a</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543  * {@link NoteEditorFragment}.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544  * &lt;p&gt;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545  * Activities containing this fragment MUST implement the {@link Callbacks}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 546  * interface.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 547  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 548 public class NoteListFragment extends ListFragment implements ActionBar.OnNavigationListener {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 549 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550     private static final int NAVIGATION_ITEM_ALL_NOTES=0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551     private static final int NAVIGATION_ITEM_TRASH=1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 552 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 553 	private NotesCursorAdapter mNotesAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 554 	private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 555 	private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 556     private TextView mEmptyListTextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 557     private LinearLayout mDividerShadow;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 558 	private int mNumPreviewLines;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 559 	private String[] mMenuItems;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 560     private String mSelectedTag;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 561     private String mSearchString;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 562 	private int mNavigationItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 563     private boolean mNavListLoaded;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 564 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 565 	 * The preferences key representing the activated item position. Only used on tablets.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 566 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 567 	private static final String STATE_ACTIVATED_POSITION = &quot;activated_position&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 568 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 569 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 570 	 * The fragment&#x27;s current callback object, which is notified of list item</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 571 	 * clicks.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 572 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 573 	private Callbacks mCallbacks = sCallbacks;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 574 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 575 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 576 	 * The current activated item position. Only used on tablets.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 577 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 578 	private int mActivatedPosition = ListView.INVALID_POSITION;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 579 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 580     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 581 	 * A callback interface that all activities containing this fragment must</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 582 	 * implement. This mechanism allows activities to be notified of item</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 583 	 * selections.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 584 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 585 	public interface Callbacks {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 586 		/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 587 		 * Callback for when a note has been selected.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 588 		 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 589 		public void onNoteSelected(Note note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 590 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 591 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 592 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 593 	 * A dummy implementation of the {@link Callbacks} interface that does</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 594 	 * nothing. Used only when this fragment is not attached to an activity.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 595 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 596 	private static Callbacks sCallbacks = new Callbacks() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 597 		@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 598 		public void onNoteSelected(Note note) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 599 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 600 	};</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 601 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 602 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 603 	 * Mandatory empty constructor for the fragment manager to instantiate the</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 604 	 * fragment (e.g. upon screen orientation changes).</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 605 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 606 	public NoteListFragment() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 607 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 608 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 609 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 610 	public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 611 		super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 612 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 613 		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 614 		mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 615         mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 616 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 617         ObjectCursor&lt;Note&gt; cursor = queryNotes();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 618 		mNotesAdapter = new NotesCursorAdapter(getActivity().getBaseContext(), cursor, 0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 619 		setListAdapter(mNotesAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 620 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 621 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 622 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 623     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 624     public void onActivityCreated(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 625         super.onActivityCreated(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 626 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 627     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 628 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 629     // nbradbury - load values from preferences</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 630 	protected void getPrefs() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 631 		mNumPreviewLines = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_NUM_PREVIEW_LINES, 2);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 632 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 633 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 634     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 635     public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 636     {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 637         View view = inflater.inflate(R.layout.notes_list, container, false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 638         return view;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 639     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 640 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 641 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 642 	public void onViewCreated(View view, Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 643 		super.onViewCreated(view, savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 644 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 645         NotesActivity notesActivity = (NotesActivity)getActivity();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 646 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 647         mEmptyListTextView = (TextView)view.findViewById(android.R.id.empty);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 648         mDividerShadow = (LinearLayout)view.findViewById(R.id.divider_shadow);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 649 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 650         if (notesActivity.isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 651             setActivateOnItemClick(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 652             mDividerShadow.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 653         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 654 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 655         getListView().setDivider(getResources().getDrawable(R.drawable.list_divider));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 656         getListView().setDividerHeight(2);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 657         getListView().setBackgroundColor(getResources().getColor(R.color.white));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 658 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 659         updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 660 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 661 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 662 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 663 	public void onAttach(Activity activity) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 664 		super.onAttach(activity);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 665 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 666 		// Activities containing this fragment must implement its callbacks.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 667 		if (!(activity instanceof Callbacks)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 668 			throw new IllegalStateException(&quot;Activity must implement fragment&#x27;s callbacks.&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 669 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 670 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 671 		mCallbacks = (Callbacks) activity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 672 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 673 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 674 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 675 	public void onResume() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 676 		super.onResume();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 677         mNavListLoaded = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 678         getPrefs();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 679         refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 680         updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 681         // update the view again</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 682         mTagsBucket.addListener(mTagsMenuUpdater);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 683 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 684 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 685     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 686     public void onPause(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 687         super.onPause();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 688         mTagsBucket.removeListener(mTagsMenuUpdater);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 689     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 690 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 691 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 692 	public void onDetach() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 693 		super.onDetach();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 694 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 695 		// Reset the active callbacks interface to the dummy implementation.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 696 		mCallbacks = sCallbacks;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 697 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 698 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 699     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 700     public void onDestroy(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 701         super.onDestroy();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 702     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 703 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 704 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 705 	public void onListItemClick(ListView listView, View view, int position, long id) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 706 		super.onListItemClick(listView, view, position, id);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 707 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 708 		Note note = (Note)getListAdapter().getItem(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 709         if (note != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 710             mCallbacks.onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712         mActivatedPosition = position;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 713 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 714 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 715     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 716      * Selects first row in the list if available</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 717      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 718     public void selectFirstNote() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 719         if (mNotesAdapter.getCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 720             Note selectedNote = mNotesAdapter.getItem(0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 721             mCallbacks.onNoteSelected(selectedNote);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 722         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 723     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 724 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 725     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 726     public void onSaveInstanceState(Bundle outState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 727         super.onSaveInstanceState(outState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 728         if (mActivatedPosition != ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 729             // Serialize and persist the activated item position.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 730             outState.putInt(STATE_ACTIVATED_POSITION, mActivatedPosition);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 731         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 732     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 733 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 734 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 735 	 * Turns on activate-on-click mode. When this mode is on, list items will be</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 736 	 * given the &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 737 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 738 	public void setActivateOnItemClick(boolean activateOnItemClick) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 739 		// When setting CHOICE_MODE_SINGLE, ListView will automatically</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 740 		// give items the &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 741 		getListView().setChoiceMode(activateOnItemClick ? ListView.CHOICE_MODE_SINGLE : ListView.CHOICE_MODE_NONE);"> 741 		getListView().setChoiceMode(activateOnItemClick ? ListView.CHOICE_MODE_SINGLE : ListView.CHOICE_MODE_NOðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 742 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 743 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 744 	private void setActivatedPosition(int position) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 745         if (getListView() != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 746             if (position == ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 747                 getListView().setItemChecked(mActivatedPosition, false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 748             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 749                 getListView().setItemChecked(position, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 750             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 751 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 752             mActivatedPosition = position;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 753         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 754 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 755 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 756     public void setDividerVisible(boolean visible) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 757         if (visible)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 758             mDividerShadow.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 759         else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 760             mDividerShadow.setVisibility(View.GONE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 761     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 762 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 763 	@SuppressWarnings(&quot;deprecation&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 764 	public void refreshList() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 765 		Log.d(Simplenote.TAG, &quot;Refresh the list&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 766         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 767 		mNotesAdapter.notifyDataSetChanged();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 768 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 769 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 770     public ObjectCursor&lt;Note&gt; queryNotes(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 771         Log.d(Simplenote.TAG, String.format(&quot;Querying %d %s&quot;, mNavigationItem, mSelectedTag));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 772         Query&lt;Note&gt; query = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 773         if (mSearchString != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 774             query = Note.search(mNotesBucket, mSearchString);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 775         } else if (mNavigationItem == NAVIGATION_ITEM_ALL_NOTES) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 776 			// All notes</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 777 			query = Note.all(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 778 		} else if (mNavigationItem == NAVIGATION_ITEM_TRASH) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 779 			// Trashed notes</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 780 			query = Note.allDeleted(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 781 		} else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 782 			query = Note.allInTag(mNotesBucket, mSelectedTag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 783 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 784         query.include(&quot;title&quot;, &quot;contentPreview&quot;, &quot;pinned&quot;, &quot;modificationDate&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 785         sortNoteQuery(query);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 786         return query.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 787     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 788 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 789 	private void updateMenuItems() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 790 		// Update ActionBar menu</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 791 		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 792         Bucket&lt;Tag&gt; tagBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 793         ObjectCursor&lt;Tag&gt; tagCursor = Tag.all(tagBucket).execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 794 		String[] tags = new String[tagCursor.getCount()];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 795         while (tagCursor.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 796             Tag tag = tagCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 797             tags[tagCursor.getPosition()] = tag.getName();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 798         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 799         tagCursor.close();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 800 		String[] topItems = { getResources().getString(R.string.notes), getResources().getString(R.string.trash) };"> 800 		String[] topItems = { getResources().getString(R.string.notes), getResources().getString(R.string.trashðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 801 		mMenuItems = Arrays.copyOf(topItems, tags.length + 2);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 802         ActionBar ab = getActivity().getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 803         ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 804 		System.arraycopy(tags, 0, mMenuItems, 2, tags.length);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 805 		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_spinner_item, mMenuItems);"> 805 		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 806         mSpinnerAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 807 		ab.setListNavigationCallbacks(mSpinnerAdapter, this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 808         if (mNavigationItem &lt; mMenuItems.length) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 809             ab.setSelectedNavigationItem(mNavigationItem);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 810         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 811 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 812 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 813 	public void addNote() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 814 		// create &amp; save new note</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 815 		Simplenote simplenote = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 816 		Bucket&lt;Note&gt; notesBucket = simplenote.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 817 		Note note = notesBucket.newObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 818         note.setCreationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 819 		note.save(); </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 820 		</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 821 		// refresh listview so new note appears</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 822 		refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 823 		</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 824 		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not always select the correct note depending on user&#x27;s sort preference"> 824 		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not alðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 825 		mCallbacks.onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 826 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 827 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 828     public void setNoteSelected(Note selectedNote) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 829         // Loop through notes and set note selected if found</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 830         for(int i=0; i &lt; mNotesAdapter.getCount(); i++) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 831             Note note = (Note)mNotesAdapter.getItem(i);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 832             if (note.getSimperiumKey().equals(selectedNote.getSimperiumKey())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 833                 setActivatedPosition(i);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 834                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 835             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 836         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 837     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 838 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 839 	public class NotesCursorAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 840         private ObjectCursor&lt;Note&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 841         public NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; c, int flags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 842             super(context, c, flags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 843             mCursor = c;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 844         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 845 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 846         public void changeCursor(ObjectCursor&lt;Note&gt; cursor){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 847             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 848             super.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 849         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 850 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 851         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 852         public Note getItem(int position) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 853             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 854             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 855         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 856 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 857         /*</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 858         *  nbradbury - implemented &quot;holder pattern&quot; to boost performance with large note lists</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 859         */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 860 		@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 861 		public View getView(int position, View view, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 862 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 863 			NoteViewHolder holder;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 864 			if (view == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 865 				view = View.inflate(getActivity().getBaseContext(), R.layout.note_list_row, null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 866 				holder = new NoteViewHolder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 867 				holder.titleTextView = (TextView) view.findViewById(R.id.note_title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 868 				holder.contentTextView = (TextView) view.findViewById(R.id.note_content);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 869 				holder.pinImageView = (ImageView) view.findViewById(R.id.note_pin);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 870 				view.setTag(holder);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 871 			} else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 872 				holder = (NoteViewHolder) view.getTag();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 873 			}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 874 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 875             if (position == getListView().getCheckedItemPosition())</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 876                 view.setActivated(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 877             else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 878                 view.setActivated(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 879 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 880             // for performance reasons we are going to get indexed values</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 881             // from the cursor instead of instantiating the entire bucket object</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 882             holder.contentTextView.setMaxLines(mNumPreviewLines);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 883             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 884             int pinned = mCursor.getInt(mCursor.getColumnIndex(&quot;pinned&quot;));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 885             holder.pinImageView.setVisibility(pinned == 1 ? View.VISIBLE : View.GONE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 886 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 887             String title = mCursor.getString(mCursor.getColumnIndex(&quot;title&quot;));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 888             if (title == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 889                 title = getString(R.string.new_note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 890             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 891             holder.titleTextView.setText(title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 892 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 893             if (mNumPreviewLines &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 894                 holder.contentTextView.setText(mCursor.getString(mCursor.getColumnIndex(&quot;contentPreview&quot;)));"> 894                 holder.contentTextView.setText(mCursor.getString(mCursor.getColumnIndex(&quot;contentPreview&quot;)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 895             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 896 			</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 897 			return view;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 898 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 899 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 900         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 901         public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 902             return null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 903         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 904 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 905         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 906         public void bindView(View view, Context context, Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 907 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 908         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 909 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 910 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 911 	</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 912 	// view holder for NotesCursorAdapter</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 913 	private static class NoteViewHolder {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 914 		TextView titleTextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 915 		TextView contentTextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 916 		ImageView pinImageView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 917         private String mNoteId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 918 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 919         public void setNoteId(String noteId) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 920             mNoteId = noteId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 921         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 922 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 923         public String getNoteId() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 924             return mNoteId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 925         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 926 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 927 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 928 	public void searchNotes(String searchString) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 929         mSearchString = searchString;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 930 		mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 931 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 932 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 933     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 934      * Clear search and load all notes</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 935      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 936     public void clearSearch() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 937         mSearchString = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 938         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 939     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 940 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 941 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 942 	public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 943         Log.d(Simplenote.TAG, &quot;onNavigationItemSelected&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 944 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 945         if (!mNavListLoaded) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 946             mNavListLoaded = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 947             return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 948         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 949 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 950         // Update empty list placeholder text</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 951         if (mEmptyListTextView != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 952             if (itemPosition == NAVIGATION_ITEM_TRASH)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 953                 mEmptyListTextView.setText(Html.fromHtml(getString(R.string.trash_is_empty)));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 954             else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 955                 mEmptyListTextView.setText(Html.fromHtml(getString(R.string.no_notes)));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 956         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 957 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 958         NotesActivity notesActivity = (NotesActivity)getActivity();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 959 		mNavigationItem = itemPosition;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 960         if (itemPosition &gt; 1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 961             mSelectedTag = mMenuItems[itemPosition];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 962         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 963             mSelectedTag = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 964         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 965         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 966 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 967         notesActivity.invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 968         if (notesActivity.isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 969             if (mNotesAdapter.getCount() == 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 970                 notesActivity.showDetailPlaceholder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 971             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 972                 // Select the first note</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 973                 Note firstNote = mNotesAdapter.getItem(0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 974                 mCallbacks.onNoteSelected(firstNote);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 975             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 976         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 977 		</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 978 		return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 979 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 980 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 981     public void sortNoteQuery(Query&lt;Note&gt; noteQuery){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 982         noteQuery.order(&quot;pinned&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 983 		int sortPref = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_SORT_ORDER);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 984 		switch (sortPref) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 985         case 0:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 986             noteQuery.order(&quot;modificationDate&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 987             break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 988 		case 1:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 989             noteQuery.order(&quot;modificationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 990 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 991 		case 2:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 992             noteQuery.order(&quot;creationDate&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 993 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 994 		case 3:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 995             noteQuery.order(&quot;creationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 996 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 997 		case 4:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 998             noteQuery.order(&quot;content&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 999 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1000 		case 5:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1001             noteQuery.order(&quot;content&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1002 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1003 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1004     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1005 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1006 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1007     private Bucket.Listener&lt;Tag&gt; mTagsMenuUpdater = new Bucket.Listener&lt;Tag&gt;(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1008         void updateMenu(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1009             getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1010                 public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1011                     updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1012                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1013             });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1014         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1015 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1016         public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag tag){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1017             updateMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1018         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1019 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1020         public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag tag){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1021             updateMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1022         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1023 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1024         public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1025             updateMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1026         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1027     };</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1028 }</span>
1029 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import android.app.ActionBar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import android.app.ListFragment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 import android.text.Html;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 import android.widget.ArrayAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 import android.widget.ImageView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import android.widget.SimpleCursorAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import android.widget.SpinnerAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import com.automattic.simplenote.models.Tag;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import com.automattic.simplenote.utils.PrefUtils;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import com.simperium.client.Bucket.OnSaveObjectListener;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import com.simperium.client.Bucket.OnDeleteObjectListener;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import com.simperium.client.Bucket.OnNetworkChangeListener;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import com.simperium.client.BucketObjectMissingException;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40  * A list fragment representing a list of Notes. This fragment also supports</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41  * tablet devices by allowing list items to be given an &#x27;activated&#x27; state upon</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42  * selection. This helps indicate which item is currently being viewed in a</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43  * {@link NoteEditorFragment}.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44  * &lt;p&gt;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45  * Activities containing this fragment MUST implement the {@link Callbacks}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46  * interface.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 public class NoteListFragment extends ListFragment implements ActionBar.OnNavigationListener {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50     private static final int NAVIGATION_ITEM_ALL_NOTES=0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51     private static final int NAVIGATION_ITEM_TRASH=1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53 	private NotesCursorAdapter mNotesAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54 	private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55 	private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56     private TextView mEmptyListTextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57 	private int mNumPreviewLines;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58 	private String[] mMenuItems;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59     private String mSelectedTag;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60     private String mSearchString;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 	private int mNavigationItem;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63 	 * The serialization (saved instance state) Bundle key representing the</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64 	 * activated item position. Only used on tablets.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66 	private static final String STATE_ACTIVATED_POSITION = &quot;activated_position&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69 	 * The fragment&#x27;s current callback object, which is notified of list item</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 	 * clicks.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72 	private Callbacks mCallbacks = sCallbacks;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75 	 * The current activated item position. Only used on tablets.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77 	private int mActivatedPosition = ListView.INVALID_POSITION;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80 	 * A callback interface that all activities containing this fragment must</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81 	 * implement. This mechanism allows activities to be notified of item</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 	 * selections.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84 	public interface Callbacks {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85 		/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 		 * Callback for when a note has been selected.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87 		 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88 		public void onNoteSelected(Note note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92 	 * A dummy implementation of the {@link Callbacks} interface that does</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93 	 * nothing. Used only when this fragment is not attached to an activity.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95 	private static Callbacks sCallbacks = new Callbacks() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96 		@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97 		public void onNoteSelected(Note note) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99 	};</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102 	 * Mandatory empty constructor for the fragment manager to instantiate the</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103 	 * fragment (e.g. upon screen orientation changes).</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105 	public NoteListFragment() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109 	public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110 		super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112 		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113 		mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114         mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116         ObjectCursor&lt;Note&gt; cursor = queryNotes();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117 		mNotesAdapter = new NotesCursorAdapter(getActivity().getBaseContext(), cursor, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118 		setListAdapter(mNotesAdapter);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123     public void onActivityCreated(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124         super.onActivityCreated(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128     // nbradbury - load values from preferences</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129 	protected void getPrefs() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130 		mNumPreviewLines = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_NUM_PREVIEW_LINES, 2);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134 	public void onViewCreated(View view, Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135 		super.onViewCreated(view, savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137         setListShown(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 139         mEmptyListTextView = (TextView)getActivity().getLayoutInflater().inflate(R.layout.empty_list, null);"> 139         mEmptyListTextView = (TextView)getActivity().getLayoutInflater().inflate(R.layout.empty_list, nulðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140         getListView().setEmptyView(mEmptyListTextView);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141         mEmptyListTextView.setVisibility(View.GONE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142         ((ViewGroup)getListView().getParent()).addView(mEmptyListTextView);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144 		// Restore the previously serialized activated item position.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145 		if (savedInstanceState != null &amp;&amp; savedInstanceState.containsKey(STATE_ACTIVATED_POSITION)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146 			setActivatedPosition(savedInstanceState.getInt(STATE_ACTIVATED_POSITION));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149         getListView().setDivider(getResources().getDrawable(R.drawable.list_divider));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150         getListView().setDividerHeight(2);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151         getListView().setBackgroundColor(getResources().getColor(R.color.white));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153         updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157 	public void onAttach(Activity activity) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158 		super.onAttach(activity);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160 		// Activities containing this fragment must implement its callbacks.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161 		if (!(activity instanceof Callbacks)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162 			throw new IllegalStateException(&quot;Activity must implement fragment&#x27;s callbacks.&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165 		mCallbacks = (Callbacks) activity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169 	public void onResume() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170 		super.onResume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171         getPrefs();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172         refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173         updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174         // update the view again</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175         mTagsBucket.addListener(mTagsMenuUpdater);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179     public void onPause(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180         super.onPause();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181         mTagsBucket.removeListener(mTagsMenuUpdater);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185 	public void onDetach() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186 		super.onDetach();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188 		// Reset the active callbacks interface to the dummy implementation.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189 		mCallbacks = sCallbacks;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193     public void onDestroy(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194         super.onDestroy();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198 	public void onListItemClick(ListView listView, View view, int position, long id) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199 		super.onListItemClick(listView, view, position, id);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201 		Note note = (Note)getListAdapter().getItem(position);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202         if (note != null)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203             mCallbacks.onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207 	public void onSaveInstanceState(Bundle outState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208 		super.onSaveInstanceState(outState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209 		if (mActivatedPosition != ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210 			// Serialize and persist the activated item position.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211 			outState.putInt(STATE_ACTIVATED_POSITION, mActivatedPosition);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216 	 * Turns on activate-on-click mode. When this mode is on, list items will be</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217 	 * given the &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219 	public void setActivateOnItemClick(boolean activateOnItemClick) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220 		// When setting CHOICE_MODE_SINGLE, ListView will automatically</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221 		// give items the &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 222 		getListView().setChoiceMode(activateOnItemClick ? ListView.CHOICE_MODE_SINGLE : ListView.CHOICE_MODE_NONE);"> 222 		getListView().setChoiceMode(activateOnItemClick ? ListView.CHOICE_MODE_SINGLE : ListView.CHOICE_MODE_NOðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224 		// Also select the first item by default</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225 		// TODO: persist the last selected item and restore that instead</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226 		if (!mNotesAdapter.isEmpty()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227 			View v = mNotesAdapter.getView(0, null, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228 			getListView().performItemClick(v, 0, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232 	private void setActivatedPosition(int position) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233         if (getListView() != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234             if (position == ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235                 getListView().setItemChecked(mActivatedPosition, false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236             } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237                 getListView().setItemChecked(position, true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240             mActivatedPosition = position;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244 	@SuppressWarnings(&quot;deprecation&quot;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245 	public void refreshList() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246 		Log.d(Simplenote.TAG, &quot;Refresh the list&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248 		mNotesAdapter.notifyDataSetChanged();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251     public ObjectCursor&lt;Note&gt; queryNotes(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252         Log.d(Simplenote.TAG, String.format(&quot;Querying %d %s&quot;, mNavigationItem, mSelectedTag));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253         Query&lt;Note&gt; query = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254         if (mSearchString != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255             query = Note.search(mNotesBucket, mSearchString);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256         } else if (mNavigationItem == NAVIGATION_ITEM_ALL_NOTES) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257 			// All notes</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258 			query = Note.all(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259 		} else if (mNavigationItem == NAVIGATION_ITEM_TRASH) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260 			// Trashed notes</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261 			query = Note.allDeleted(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262 		} else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263 			query = Note.allInTag(mNotesBucket, mSelectedTag);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265         query.include(&quot;title&quot;, &quot;contentPreview&quot;, &quot;pinned&quot;, &quot;modificationDate&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 266         sortNoteQuery(query);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267         return query.execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270 	private void updateMenuItems() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271 		// Update ActionBar menu</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272 		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273         Bucket&lt;Tag&gt; tagBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274         ObjectCursor&lt;Tag&gt; tagCursor = Tag.all(tagBucket).execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275 		String[] tags = new String[tagCursor.getCount()];</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276         while (tagCursor.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277             Tag tag = tagCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278             tags[tagCursor.getPosition()] = tag.getName();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280         tagCursor.close();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 281 		String[] topItems = { getResources().getString(R.string.notes), getResources().getString(R.string.trash) };"> 281 		String[] topItems = { getResources().getString(R.string.notes), getResources().getString(R.string.trashðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 282 		mMenuItems = Arrays.copyOf(topItems, tags.length + 2);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283         ActionBar ab = getActivity().getActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284         ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285 		System.arraycopy(tags, 0, mMenuItems, 2, tags.length);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 286 		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_spinner_item, mMenuItems);"> 286 		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287         mSpinnerAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288 		ab.setListNavigationCallbacks(mSpinnerAdapter, this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289         if (mNavigationItem &lt; mMenuItems.length) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290             ab.setSelectedNavigationItem(mNavigationItem);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294 	public void addNote() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 295 		// TODO: nbradbury - creating &amp; saving a new note here causes an empty note to appear which doesn&#x27;t go away if user backs out"> 295 		// TODO: nbradbury - creating &amp; saving a new note here causes an empty note to appear which doesn&#x27;t go ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 296 		// of editing the note (iOS app suffers from the same problem) - instead NoteEditorFragment should be changed to handle new"> 296 		// of editing the note (iOS app suffers from the same problem) - instead NoteEditorFragment should be cðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297 		// note creation and only save the note if user has entered any content</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299 		// create &amp; save new note</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300 		Simplenote simplenote = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301 		Bucket&lt;Note&gt; notesBucket = simplenote.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302 		Note note = notesBucket.newObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303         note.setCreationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304 		note.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306 		// refresh listview so new note appears</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307 		refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 309 		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not always select the correct note depending on user&#x27;s sort preference"> 309 		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not alðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310 		mCallbacks.onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312 		// Select the new note</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313 		//View v = mNotesAdapter.getView(0, null, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314 		//getListView().performItemClick(v, 0, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317     public void setNoteSelected(Note selectedNote) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318         // Loop through notes and set note selected if found</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319         for(int i=0; i &lt; mNotesAdapter.getCount(); i++) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320             Note note = (Note)mNotesAdapter.getItem(i);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321             if (note.getSimperiumKey().equals(selectedNote.getSimperiumKey())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322                 setActivatedPosition(i);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323                 break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328 	public class NotesCursorAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329         private ObjectCursor&lt;Note&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330         public NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; c, int flags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331             super(context, c, flags);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332             mCursor = c;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335         public void changeCursor(ObjectCursor&lt;Note&gt; cursor){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337             super.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341         public Note getItem(int position) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346         /*</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347         *  nbradbury - implemented &quot;holder pattern&quot; to boost performance with large note lists</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348         */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349 		@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350 		public View getView(int position, View view, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352 			NoteViewHolder holder;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353 			if (view == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354 				view = View.inflate(getActivity().getBaseContext(), R.layout.note_list_row, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355 				holder = new NoteViewHolder();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356 				holder.titleTextView = (TextView) view.findViewById(R.id.note_title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357 				holder.contentTextView = (TextView) view.findViewById(R.id.note_content);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358 				holder.pinImageView = (ImageView) view.findViewById(R.id.note_pin);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359 				view.setTag(holder);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360 			} else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361 				holder = (NoteViewHolder) view.getTag();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362 			}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364             // for performance reasons we are going to get indexed values</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365             // from the cursor instead of instantiating the entire bucket object</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366             holder.contentTextView.setMaxLines(mNumPreviewLines);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368             int pinned = mCursor.getInt(mCursor.getColumnIndex(&quot;pinned&quot;));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369             holder.pinImageView.setVisibility(pinned == 1 ? View.VISIBLE : View.GONE);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371             String title = mCursor.getString(mCursor.getColumnIndex(&quot;title&quot;));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372             if (title == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373                 title = getString(R.string.new_note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 374             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 375             holder.titleTextView.setText(title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 376 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377             if (mNumPreviewLines &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 378                 holder.contentTextView.setText(mCursor.getString(mCursor.getColumnIndex(&quot;contentPreview&quot;)));"> 378                 holder.contentTextView.setText(mCursor.getString(mCursor.getColumnIndex(&quot;contentPreview&quot;)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 380 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 381 			return view;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385         public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386             return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390         public void bindView(View view, Context context, Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396 	// view holder for NotesCursorAdapter</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397 	private static class NoteViewHolder {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398 		TextView titleTextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399 		TextView contentTextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400 		ImageView pinImageView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401         private String mNoteId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403         public void setNoteId(String noteId) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404             mNoteId = noteId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407         public String getNoteId() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408             return mNoteId;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412 	public void searchNotes(String searchString) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413         mSearchString = searchString;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414 		mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418      * Clear search and load all notes</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420     public void clearSearch() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421         mSearchString = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426 	public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427         Log.d(Simplenote.TAG, &quot;onNavigationItemSelected&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429         // Update empty list placeholder text</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430         if (mEmptyListTextView != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431             if (itemPosition == NAVIGATION_ITEM_TRASH)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432                 mEmptyListTextView.setText(Html.fromHtml(getString(R.string.trash_is_empty)));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433             else</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434                 mEmptyListTextView.setText(Html.fromHtml(getString(R.string.no_notes)));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437 		Query&lt;Note&gt; query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438 		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439         Bucket&lt;Note&gt; noteBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440 		mNavigationItem = itemPosition;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441         if (itemPosition &gt; 1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442             mSelectedTag = mMenuItems[itemPosition];</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444             mSelectedTag = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448         getActivity().invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450 		return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453     public void sortNoteQuery(Query&lt;Note&gt; noteQuery){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454         noteQuery.order(&quot;pinned&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455 		int sortPref = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_SORT_ORDER);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456 		switch (sortPref) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457         case 0:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458             noteQuery.order(&quot;modificationDate&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459             break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460 		case 1:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461             // orderBy = &quot;creationDate DESC&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462             noteQuery.order(&quot;creationDate&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464 		case 2:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465             noteQuery.order(&quot;content&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467 		case 3:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468             noteQuery.order(&quot;modificationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470 		case 4:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471             noteQuery.order(&quot;creationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473 		case 5:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474             noteQuery.order(&quot;content&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480     private Bucket.Listener&lt;Tag&gt; mTagsMenuUpdater = new Bucket.Listener&lt;Tag&gt;(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481         void updateMenu(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482             getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483                 public void run() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484                     updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 489         public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag tag){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 490             updateMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 491         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 492 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 493         public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag tag){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 494             updateMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 495         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 496 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497         public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498             updateMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500     };</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501 }</span>
 502 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 503 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 504 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505 import android.app.ActionBar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507 import android.app.ListFragment;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509 import android.content.SharedPreferences;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510 import android.content.res.Configuration;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513 import android.preference.PreferenceManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514 import android.text.Html;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519 import android.widget.AbsListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520 import android.widget.ArrayAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522 import android.widget.ImageView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523 import android.widget.LinearLayout;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528 import com.automattic.simplenote.models.Tag;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529 import com.automattic.simplenote.utils.PrefUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 536 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 537 import java.util.prefs.Preferences;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 538 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 539 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 540  * A list fragment representing a list of Notes. This fragment also supports</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 541  * tablet devices by allowing list items to be given an &#x27;activated&#x27; state upon</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542  * selection. This helps indicate which item is currently being viewed in a</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543  * {@link NoteEditorFragment}.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544  * &lt;p&gt;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545  * Activities containing this fragment MUST implement the {@link Callbacks}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 546  * interface.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 547  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 548 public class NoteListFragment extends ListFragment implements ActionBar.OnNavigationListener {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 549 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550     private static final int NAVIGATION_ITEM_ALL_NOTES=0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551     private static final int NAVIGATION_ITEM_TRASH=1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 552 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 553 	private NotesCursorAdapter mNotesAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 554 	private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 555 	private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 556     private TextView mEmptyListTextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 557     private LinearLayout mDividerShadow;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 558 	private int mNumPreviewLines;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 559 	private String[] mMenuItems;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 560     private String mSelectedTag;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 561     private String mSearchString;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 562 	private int mNavigationItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 563     private boolean mNavListLoaded;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 564 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 565 	 * The preferences key representing the activated item position. Only used on tablets.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 566 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 567 	private static final String STATE_ACTIVATED_POSITION = &quot;activated_position&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 568 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 569 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 570 	 * The fragment&#x27;s current callback object, which is notified of list item</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 571 	 * clicks.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 572 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 573 	private Callbacks mCallbacks = sCallbacks;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 574 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 575 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 576 	 * The current activated item position. Only used on tablets.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 577 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 578 	private int mActivatedPosition = ListView.INVALID_POSITION;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 579 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 580     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 581 	 * A callback interface that all activities containing this fragment must</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 582 	 * implement. This mechanism allows activities to be notified of item</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 583 	 * selections.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 584 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 585 	public interface Callbacks {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 586 		/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 587 		 * Callback for when a note has been selected.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 588 		 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 589 		public void onNoteSelected(Note note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 590 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 591 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 592 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 593 	 * A dummy implementation of the {@link Callbacks} interface that does</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 594 	 * nothing. Used only when this fragment is not attached to an activity.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 595 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 596 	private static Callbacks sCallbacks = new Callbacks() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 597 		@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 598 		public void onNoteSelected(Note note) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 599 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 600 	};</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 601 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 602 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 603 	 * Mandatory empty constructor for the fragment manager to instantiate the</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 604 	 * fragment (e.g. upon screen orientation changes).</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 605 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 606 	public NoteListFragment() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 607 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 608 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 609 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 610 	public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 611 		super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 612 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 613 		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 614 		mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 615         mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 616 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 617         ObjectCursor&lt;Note&gt; cursor = queryNotes();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 618 		mNotesAdapter = new NotesCursorAdapter(getActivity().getBaseContext(), cursor, 0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 619 		setListAdapter(mNotesAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 620 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 621 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 622 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 623     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 624     public void onActivityCreated(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 625         super.onActivityCreated(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 626 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 627     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 628 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 629     // nbradbury - load values from preferences</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 630 	protected void getPrefs() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 631 		mNumPreviewLines = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_NUM_PREVIEW_LINES, 2);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 632 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 633 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 634     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 635     public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 636     {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 637         View view = inflater.inflate(R.layout.notes_list, container, false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 638         return view;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 639     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 640 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 641 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 642 	public void onViewCreated(View view, Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 643 		super.onViewCreated(view, savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 644 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 645         NotesActivity notesActivity = (NotesActivity)getActivity();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 646 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 647         mEmptyListTextView = (TextView)view.findViewById(android.R.id.empty);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 648         mDividerShadow = (LinearLayout)view.findViewById(R.id.divider_shadow);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 649 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 650         if (notesActivity.isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 651             setActivateOnItemClick(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 652             mDividerShadow.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 653         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 654 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 655         getListView().setDivider(getResources().getDrawable(R.drawable.list_divider));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 656         getListView().setDividerHeight(2);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 657         getListView().setBackgroundColor(getResources().getColor(R.color.white));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 658 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 659         updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 660 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 661 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 662 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 663 	public void onAttach(Activity activity) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 664 		super.onAttach(activity);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 665 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 666 		// Activities containing this fragment must implement its callbacks.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 667 		if (!(activity instanceof Callbacks)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 668 			throw new IllegalStateException(&quot;Activity must implement fragment&#x27;s callbacks.&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 669 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 670 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 671 		mCallbacks = (Callbacks) activity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 672 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 673 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 674 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 675 	public void onResume() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 676 		super.onResume();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 677         mNavListLoaded = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 678         getPrefs();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 679         refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 680         updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 681         // update the view again</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 682         mTagsBucket.addListener(mTagsMenuUpdater);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 683 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 684 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 685     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 686     public void onPause(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 687         super.onPause();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 688         mTagsBucket.removeListener(mTagsMenuUpdater);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 689     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 690 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 691 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 692 	public void onDetach() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 693 		super.onDetach();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 694 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 695 		// Reset the active callbacks interface to the dummy implementation.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 696 		mCallbacks = sCallbacks;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 697 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 698 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 699     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 700     public void onDestroy(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 701         super.onDestroy();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 702     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 703 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 704 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 705 	public void onListItemClick(ListView listView, View view, int position, long id) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 706 		super.onListItemClick(listView, view, position, id);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 707 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 708 		Note note = (Note)getListAdapter().getItem(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 709         if (note != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 710             mCallbacks.onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712         mActivatedPosition = position;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 713 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 714 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 715     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 716      * Selects first row in the list if available</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 717      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 718     public void selectFirstNote() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 719         if (mNotesAdapter.getCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 720             Note selectedNote = mNotesAdapter.getItem(0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 721             mCallbacks.onNoteSelected(selectedNote);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 722         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 723     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 724 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 725     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 726     public void onSaveInstanceState(Bundle outState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 727         super.onSaveInstanceState(outState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 728         if (mActivatedPosition != ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 729             // Serialize and persist the activated item position.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 730             outState.putInt(STATE_ACTIVATED_POSITION, mActivatedPosition);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 731         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 732     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 733 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 734 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 735 	 * Turns on activate-on-click mode. When this mode is on, list items will be</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 736 	 * given the &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 737 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 738 	public void setActivateOnItemClick(boolean activateOnItemClick) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 739 		// When setting CHOICE_MODE_SINGLE, ListView will automatically</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 740 		// give items the &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 741 		getListView().setChoiceMode(activateOnItemClick ? ListView.CHOICE_MODE_SINGLE : ListView.CHOICE_MODE_NONE);"> 741 		getListView().setChoiceMode(activateOnItemClick ? ListView.CHOICE_MODE_SINGLE : ListView.CHOICE_MODE_NOðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 742 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 743 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 744 	private void setActivatedPosition(int position) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 745         if (getListView() != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 746             if (position == ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 747                 getListView().setItemChecked(mActivatedPosition, false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 748             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 749                 getListView().setItemChecked(position, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 750             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 751 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 752             mActivatedPosition = position;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 753         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 754 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 755 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 756     public void setDividerVisible(boolean visible) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 757         if (visible)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 758             mDividerShadow.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 759         else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 760             mDividerShadow.setVisibility(View.GONE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 761     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 762 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 763 	@SuppressWarnings(&quot;deprecation&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 764 	public void refreshList() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 765 		Log.d(Simplenote.TAG, &quot;Refresh the list&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 766         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 767 		mNotesAdapter.notifyDataSetChanged();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 768 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 769 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 770     public ObjectCursor&lt;Note&gt; queryNotes(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 771         Log.d(Simplenote.TAG, String.format(&quot;Querying %d %s&quot;, mNavigationItem, mSelectedTag));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 772         Query&lt;Note&gt; query = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 773         if (mSearchString != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 774             query = Note.search(mNotesBucket, mSearchString);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 775         } else if (mNavigationItem == NAVIGATION_ITEM_ALL_NOTES) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 776 			// All notes</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 777 			query = Note.all(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 778 		} else if (mNavigationItem == NAVIGATION_ITEM_TRASH) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 779 			// Trashed notes</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 780 			query = Note.allDeleted(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 781 		} else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 782 			query = Note.allInTag(mNotesBucket, mSelectedTag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 783 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 784         query.include(&quot;title&quot;, &quot;contentPreview&quot;, &quot;pinned&quot;, &quot;modificationDate&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 785         sortNoteQuery(query);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 786         return query.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 787     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 788 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 789 	private void updateMenuItems() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 790 		// Update ActionBar menu</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 791 		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 792         Bucket&lt;Tag&gt; tagBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 793         ObjectCursor&lt;Tag&gt; tagCursor = Tag.all(tagBucket).execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 794 		String[] tags = new String[tagCursor.getCount()];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 795         while (tagCursor.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 796             Tag tag = tagCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 797             tags[tagCursor.getPosition()] = tag.getName();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 798         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 799         tagCursor.close();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 800 		String[] topItems = { getResources().getString(R.string.notes), getResources().getString(R.string.trash) };"> 800 		String[] topItems = { getResources().getString(R.string.notes), getResources().getString(R.string.trashðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 801 		mMenuItems = Arrays.copyOf(topItems, tags.length + 2);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 802         ActionBar ab = getActivity().getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 803         ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 804 		System.arraycopy(tags, 0, mMenuItems, 2, tags.length);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 805 		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_spinner_item, mMenuItems);"> 805 		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 806         mSpinnerAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 807 		ab.setListNavigationCallbacks(mSpinnerAdapter, this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 808         if (mNavigationItem &lt; mMenuItems.length) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 809             ab.setSelectedNavigationItem(mNavigationItem);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 810         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 811 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 812 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 813 	public void addNote() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 814 		// create &amp; save new note</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 815 		Simplenote simplenote = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 816 		Bucket&lt;Note&gt; notesBucket = simplenote.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 817 		Note note = notesBucket.newObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 818         note.setCreationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 819 		note.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 820 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 821 		// refresh listview so new note appears</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 822 		refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 823 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 824 		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not always select the correct note depending on user&#x27;s sort preference"> 824 		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not alðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 825 		mCallbacks.onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 826 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 827 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 828     public void setNoteSelected(Note selectedNote) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 829         // Loop through notes and set note selected if found</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 830         for(int i=0; i &lt; mNotesAdapter.getCount(); i++) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 831             Note note = (Note)mNotesAdapter.getItem(i);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 832             if (note.getSimperiumKey().equals(selectedNote.getSimperiumKey())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 833                 setActivatedPosition(i);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 834                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 835             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 836         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 837     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 838 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 839 	public class NotesCursorAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 840         private ObjectCursor&lt;Note&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 841         public NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; c, int flags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 842             super(context, c, flags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 843             mCursor = c;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 844         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 845 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 846         public void changeCursor(ObjectCursor&lt;Note&gt; cursor){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 847             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 848             super.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 849         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 850 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 851         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 852         public Note getItem(int position) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 853             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 854             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 855         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 856 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 857         /*</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 858         *  nbradbury - implemented &quot;holder pattern&quot; to boost performance with large note lists</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 859         */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 860 		@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 861 		public View getView(int position, View view, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 862 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 863 			NoteViewHolder holder;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 864 			if (view == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 865 				view = View.inflate(getActivity().getBaseContext(), R.layout.note_list_row, null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 866 				holder = new NoteViewHolder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 867 				holder.titleTextView = (TextView) view.findViewById(R.id.note_title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 868 				holder.contentTextView = (TextView) view.findViewById(R.id.note_content);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 869 				holder.pinImageView = (ImageView) view.findViewById(R.id.note_pin);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 870 				view.setTag(holder);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 871 			} else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 872 				holder = (NoteViewHolder) view.getTag();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 873 			}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 874 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 875             if (position == getListView().getCheckedItemPosition())</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 876                 view.setActivated(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 877             else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 878                 view.setActivated(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 879 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 880             // for performance reasons we are going to get indexed values</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 881             // from the cursor instead of instantiating the entire bucket object</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 882             holder.contentTextView.setMaxLines(mNumPreviewLines);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 883             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 884             int pinned = mCursor.getInt(mCursor.getColumnIndex(&quot;pinned&quot;));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 885             holder.pinImageView.setVisibility(pinned == 1 ? View.VISIBLE : View.GONE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 886 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 887             String title = mCursor.getString(mCursor.getColumnIndex(&quot;title&quot;));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 888             if (title == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 889                 title = getString(R.string.new_note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 890             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 891             holder.titleTextView.setText(title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 892 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 893             if (mNumPreviewLines &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 894                 holder.contentTextView.setText(mCursor.getString(mCursor.getColumnIndex(&quot;contentPreview&quot;)));"> 894                 holder.contentTextView.setText(mCursor.getString(mCursor.getColumnIndex(&quot;contentPreview&quot;)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 895             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 896 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 897 			return view;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 898 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 899 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 900         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 901         public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 902             return null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 903         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 904 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 905         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 906         public void bindView(View view, Context context, Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 907 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 908         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 909 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 910 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 911 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 912 	// view holder for NotesCursorAdapter</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 913 	private static class NoteViewHolder {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 914 		TextView titleTextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 915 		TextView contentTextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 916 		ImageView pinImageView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 917         private String mNoteId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 918 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 919         public void setNoteId(String noteId) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 920             mNoteId = noteId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 921         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 922 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 923         public String getNoteId() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 924             return mNoteId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 925         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 926 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 927 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 928 	public void searchNotes(String searchString) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 929         mSearchString = searchString;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 930 		mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 931 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 932 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 933     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 934      * Clear search and load all notes</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 935      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 936     public void clearSearch() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 937         mSearchString = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 938         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 939     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 940 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 941 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 942 	public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 943         Log.d(Simplenote.TAG, &quot;onNavigationItemSelected&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 944 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 945         if (!mNavListLoaded) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 946             mNavListLoaded = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 947             return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 948         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 949 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 950         // Update empty list placeholder text</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 951         if (mEmptyListTextView != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 952             if (itemPosition == NAVIGATION_ITEM_TRASH)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 953                 mEmptyListTextView.setText(Html.fromHtml(getString(R.string.trash_is_empty)));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 954             else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 955                 mEmptyListTextView.setText(Html.fromHtml(getString(R.string.no_notes)));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 956         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 957 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 958         NotesActivity notesActivity = (NotesActivity)getActivity();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 959 		mNavigationItem = itemPosition;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 960         if (itemPosition &gt; 1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 961             mSelectedTag = mMenuItems[itemPosition];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 962         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 963             mSelectedTag = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 964         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 965         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 966 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 967         notesActivity.invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 968         if (notesActivity.isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 969             if (mNotesAdapter.getCount() == 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 970                 notesActivity.showDetailPlaceholder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 971             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 972                 // Select the first note</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 973                 Note firstNote = mNotesAdapter.getItem(0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 974                 mCallbacks.onNoteSelected(firstNote);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 975             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 976         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 977 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 978 		return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 979 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 980 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 981     public void sortNoteQuery(Query&lt;Note&gt; noteQuery){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 982         noteQuery.order(&quot;pinned&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 983 		int sortPref = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_SORT_ORDER);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 984 		switch (sortPref) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 985         case 0:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 986             noteQuery.order(&quot;modificationDate&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 987             break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 988 		case 1:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 989             noteQuery.order(&quot;modificationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 990 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 991 		case 2:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 992             noteQuery.order(&quot;creationDate&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 993 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 994 		case 3:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 995             noteQuery.order(&quot;creationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 996 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 997 		case 4:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 998             noteQuery.order(&quot;content&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 999 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1000 		case 5:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1001             noteQuery.order(&quot;content&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1002 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1003 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1004     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1005 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1006 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1007     private Bucket.Listener&lt;Tag&gt; mTagsMenuUpdater = new Bucket.Listener&lt;Tag&gt;(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1008         void updateMenu(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1009             getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1010                 public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1011                     updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1012                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1013             });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1014         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1015 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1016         public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag tag){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1017             updateMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1018         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1019 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1020         public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag tag){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1021             updateMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1022         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1023 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1024         public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1025             updateMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1026         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1027     };</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1028 }</span>
1029 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
   4 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   5 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   6 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   7 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   8 import android.app.ActionBar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   9 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  10 import android.app.ListFragment;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  11 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  12 import android.content.SharedPreferences;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  13 import android.content.res.Configuration;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  14 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  15 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  16 import android.preference.PreferenceManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  17 import android.text.Html;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  18 import android.util.Log;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  19 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  20 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  21 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  22 import android.widget.AbsListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23 import android.widget.ArrayAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  24 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  25 import android.widget.ImageView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  26 import android.widget.LinearLayout;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  27 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  28 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  29 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  30 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  31 import com.automattic.simplenote.models.Tag;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  32 import com.automattic.simplenote.utils.PrefUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  33 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  34 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  35 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36 import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38 import java.util.Arrays;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  39 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  40 import java.util.prefs.Preferences;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  41 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  42 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  43  * A list fragment representing a list of Notes. This fragment also supports</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  44  * tablet devices by allowing list items to be given an &#x27;activated&#x27; state upon</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  45  * selection. This helps indicate which item is currently being viewed in a</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  46  * {@link NoteEditorFragment}.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  47  * &lt;p&gt;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  48  * Activities containing this fragment MUST implement the {@link Callbacks}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  49  * interface.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51 public class NoteListFragment extends ListFragment implements ActionBar.OnNavigationListener {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53     private static final int NAVIGATION_ITEM_ALL_NOTES=0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54     private static final int NAVIGATION_ITEM_TRASH=1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  55 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  56 	private NotesCursorAdapter mNotesAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57 	private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58 	private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59     private TextView mEmptyListTextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60     private LinearLayout mDividerShadow;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61 	private int mNumPreviewLines;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62 	private String[] mMenuItems;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63     private String mSelectedTag;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64     private String mSearchString;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65 	private int mNavigationItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66     private boolean mNavListLoaded;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68 	 * The preferences key representing the activated item position. Only used on tablets.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  70 	private static final String STATE_ACTIVATED_POSITION = &quot;activated_position&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73 	 * The fragment&#x27;s current callback object, which is notified of list item</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74 	 * clicks.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76 	private Callbacks mCallbacks = sCallbacks;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79 	 * The current activated item position. Only used on tablets.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  80 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81 	private int mActivatedPosition = ListView.INVALID_POSITION;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84 	 * A callback interface that all activities containing this fragment must</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85 	 * implement. This mechanism allows activities to be notified of item</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86 	 * selections.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88 	public interface Callbacks {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89 		/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90 		 * Callback for when a note has been selected.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91 		 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92 		public void onNoteSelected(Note note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96 	 * A dummy implementation of the {@link Callbacks} interface that does</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97 	 * nothing. Used only when this fragment is not attached to an activity.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99 	private static Callbacks sCallbacks = new Callbacks() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100 		@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101 		public void onNoteSelected(Note note) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103 	};</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106 	 * Mandatory empty constructor for the fragment manager to instantiate the</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107 	 * fragment (e.g. upon screen orientation changes).</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109 	public NoteListFragment() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113 	public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114 		super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116 		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117 		mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118         mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120         ObjectCursor&lt;Note&gt; cursor = queryNotes();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121 		mNotesAdapter = new NotesCursorAdapter(getActivity().getBaseContext(), cursor, 0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122 		setListAdapter(mNotesAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127     public void onActivityCreated(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128         super.onActivityCreated(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132     // nbradbury - load values from preferences</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133 	protected void getPrefs() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134 		mNumPreviewLines = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_NUM_PREVIEW_LINES, 2);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138     public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139     {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140         View view = inflater.inflate(R.layout.notes_list, container, false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141         return view;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145 	public void onViewCreated(View view, Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146 		super.onViewCreated(view, savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148         NotesActivity notesActivity = (NotesActivity)getActivity();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150         mEmptyListTextView = (TextView)view.findViewById(android.R.id.empty);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151         mDividerShadow = (LinearLayout)view.findViewById(R.id.divider_shadow);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153         if (notesActivity.isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154             setActivateOnItemClick(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155             mDividerShadow.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158         getListView().setDivider(getResources().getDrawable(R.drawable.list_divider));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159         getListView().setDividerHeight(2);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160         getListView().setBackgroundColor(getResources().getColor(R.color.white));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162         updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166 	public void onAttach(Activity activity) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167 		super.onAttach(activity);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169 		// Activities containing this fragment must implement its callbacks.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170 		if (!(activity instanceof Callbacks)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171 			throw new IllegalStateException(&quot;Activity must implement fragment&#x27;s callbacks.&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174 		mCallbacks = (Callbacks) activity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178 	public void onResume() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179 		super.onResume();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180         mNavListLoaded = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181         getPrefs();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182         refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183         updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184         // update the view again</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185         mTagsBucket.addListener(mTagsMenuUpdater);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189     public void onPause(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190         super.onPause();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191         mTagsBucket.removeListener(mTagsMenuUpdater);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195 	public void onDetach() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196 		super.onDetach();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198 		// Reset the active callbacks interface to the dummy implementation.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199 		mCallbacks = sCallbacks;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203     public void onDestroy(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204         super.onDestroy();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208 	public void onListItemClick(ListView listView, View view, int position, long id) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209 		super.onListItemClick(listView, view, position, id);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211 		Note note = (Note)getListAdapter().getItem(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212         if (note != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213             mCallbacks.onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215         mActivatedPosition = position;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219      * Selects first row in the list if available</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221     public void selectFirstNote() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222         if (mNotesAdapter.getCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223             Note selectedNote = mNotesAdapter.getItem(0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224             mCallbacks.onNoteSelected(selectedNote);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229     public void onSaveInstanceState(Bundle outState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230         super.onSaveInstanceState(outState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231         if (mActivatedPosition != ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232             // Serialize and persist the activated item position.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233             outState.putInt(STATE_ACTIVATED_POSITION, mActivatedPosition);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237 	/**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238 	 * Turns on activate-on-click mode. When this mode is on, list items will be</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239 	 * given the &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240 	 */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241 	public void setActivateOnItemClick(boolean activateOnItemClick) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242 		// When setting CHOICE_MODE_SINGLE, ListView will automatically</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243 		// give items the &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 244 		getListView().setChoiceMode(activateOnItemClick ? ListView.CHOICE_MODE_SINGLE : ListView.CHOICE_MODE_NONE);"> 244 		getListView().setChoiceMode(activateOnItemClick ? ListView.CHOICE_MODE_SINGLE : ListView.CHOICE_MODE_NOðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247 	private void setActivatedPosition(int position) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248         if (getListView() != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249             if (position == ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250                 getListView().setItemChecked(mActivatedPosition, false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252                 getListView().setItemChecked(position, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255             mActivatedPosition = position;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259     public void setDividerVisible(boolean visible) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260         if (visible)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261             mDividerShadow.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262         else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263             mDividerShadow.setVisibility(View.GONE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266 	@SuppressWarnings(&quot;deprecation&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267 	public void refreshList() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268 		Log.d(Simplenote.TAG, &quot;Refresh the list&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270 		mNotesAdapter.notifyDataSetChanged();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273     public ObjectCursor&lt;Note&gt; queryNotes(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274         Log.d(Simplenote.TAG, String.format(&quot;Querying %d %s&quot;, mNavigationItem, mSelectedTag));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275         Query&lt;Note&gt; query = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276         if (mSearchString != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277             query = Note.search(mNotesBucket, mSearchString);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278         } else if (mNavigationItem == NAVIGATION_ITEM_ALL_NOTES) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279 			// All notes</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280 			query = Note.all(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281 		} else if (mNavigationItem == NAVIGATION_ITEM_TRASH) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282 			// Trashed notes</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283 			query = Note.allDeleted(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284 		} else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285 			query = Note.allInTag(mNotesBucket, mSelectedTag);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287         query.include(&quot;title&quot;, &quot;contentPreview&quot;, &quot;pinned&quot;, &quot;modificationDate&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288         sortNoteQuery(query);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289         return query.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292 	private void updateMenuItems() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293 		// Update ActionBar menu</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294 		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295         Bucket&lt;Tag&gt; tagBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296         ObjectCursor&lt;Tag&gt; tagCursor = Tag.all(tagBucket).execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297 		String[] tags = new String[tagCursor.getCount()];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298         while (tagCursor.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299             Tag tag = tagCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300             tags[tagCursor.getPosition()] = tag.getName();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302         tagCursor.close();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 303 		String[] topItems = { getResources().getString(R.string.notes), getResources().getString(R.string.trash) };"> 303 		String[] topItems = { getResources().getString(R.string.notes), getResources().getString(R.string.trashðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304 		mMenuItems = Arrays.copyOf(topItems, tags.length + 2);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305         ActionBar ab = getActivity().getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306         ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307 		System.arraycopy(tags, 0, mMenuItems, 2, tags.length);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 308 		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_spinner_item, mMenuItems);"> 308 		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309         mSpinnerAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310 		ab.setListNavigationCallbacks(mSpinnerAdapter, this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311         if (mNavigationItem &lt; mMenuItems.length) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312             ab.setSelectedNavigationItem(mNavigationItem);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316 	public void addNote() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317 		// create &amp; save new note</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318 		Simplenote simplenote = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 319 		Bucket&lt;Note&gt; notesBucket = simplenote.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320 		Note note = notesBucket.newObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 321         note.setCreationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 322 		note.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 323 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 324 		// refresh listview so new note appears</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 325 		refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 326 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 327 		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not always select the correct note depending on user&#x27;s sort preference"> 327 		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not alðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 328 		mCallbacks.onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 329 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 330 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 331     public void setNoteSelected(Note selectedNote) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 332         // Loop through notes and set note selected if found</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 333         for(int i=0; i &lt; mNotesAdapter.getCount(); i++) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 334             Note note = (Note)mNotesAdapter.getItem(i);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 335             if (note.getSimperiumKey().equals(selectedNote.getSimperiumKey())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 336                 setActivatedPosition(i);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 337                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 338             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 339         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 340     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 341 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 342 	public class NotesCursorAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 343         private ObjectCursor&lt;Note&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 344         public NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; c, int flags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 345             super(context, c, flags);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 346             mCursor = c;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 347         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 348 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 349         public void changeCursor(ObjectCursor&lt;Note&gt; cursor){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 350             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 351             super.changeCursor(cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 352         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355         public Note getItem(int position) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360         /*</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361         *  nbradbury - implemented &quot;holder pattern&quot; to boost performance with large note lists</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362         */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363 		@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364 		public View getView(int position, View view, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366 			NoteViewHolder holder;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367 			if (view == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368 				view = View.inflate(getActivity().getBaseContext(), R.layout.note_list_row, null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369 				holder = new NoteViewHolder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370 				holder.titleTextView = (TextView) view.findViewById(R.id.note_title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371 				holder.contentTextView = (TextView) view.findViewById(R.id.note_content);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372 				holder.pinImageView = (ImageView) view.findViewById(R.id.note_pin);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373 				view.setTag(holder);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374 			} else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375 				holder = (NoteViewHolder) view.getTag();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376 			}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378             if (position == getListView().getCheckedItemPosition())</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379                 view.setActivated(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380             else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381                 view.setActivated(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383             // for performance reasons we are going to get indexed values</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384             // from the cursor instead of instantiating the entire bucket object</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385             holder.contentTextView.setMaxLines(mNumPreviewLines);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387             int pinned = mCursor.getInt(mCursor.getColumnIndex(&quot;pinned&quot;));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388             holder.pinImageView.setVisibility(pinned == 1 ? View.VISIBLE : View.GONE);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390             String title = mCursor.getString(mCursor.getColumnIndex(&quot;title&quot;));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391             if (title == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392                 title = getString(R.string.new_note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394             holder.titleTextView.setText(title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 396             if (mNumPreviewLines &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 397                 holder.contentTextView.setText(mCursor.getString(mCursor.getColumnIndex(&quot;contentPreview&quot;)));"> 397                 holder.contentTextView.setText(mCursor.getString(mCursor.getColumnIndex(&quot;contentPreview&quot;)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 400 			return view;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 401 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404         public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405             return null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 407 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 408         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409         public void bindView(View view, Context context, Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 415 	// view holder for NotesCursorAdapter</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416 	private static class NoteViewHolder {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417 		TextView titleTextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418 		TextView contentTextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419 		ImageView pinImageView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420         private String mNoteId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 421 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422         public void setNoteId(String noteId) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423             mNoteId = noteId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 426         public String getNoteId() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427             return mNoteId;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 428         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431 	public void searchNotes(String searchString) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432         mSearchString = searchString;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433 		mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437      * Clear search and load all notes</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439     public void clearSearch() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440         mSearchString = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444 	@Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 445 	public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 446         Log.d(Simplenote.TAG, &quot;onNavigationItemSelected&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 447 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 448         if (!mNavListLoaded) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 449             mNavListLoaded = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 450             return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 451         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 452 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 453         // Update empty list placeholder text</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 454         if (mEmptyListTextView != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 455             if (itemPosition == NAVIGATION_ITEM_TRASH)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 456                 mEmptyListTextView.setText(Html.fromHtml(getString(R.string.trash_is_empty)));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 457             else</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 458                 mEmptyListTextView.setText(Html.fromHtml(getString(R.string.no_notes)));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 459         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 460 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 461         NotesActivity notesActivity = (NotesActivity)getActivity();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 462 		mNavigationItem = itemPosition;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 463         if (itemPosition &gt; 1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 464             mSelectedTag = mMenuItems[itemPosition];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 465         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 466             mSelectedTag = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 467         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 468         mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 469 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 470         notesActivity.invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 471         if (notesActivity.isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 472             if (mNotesAdapter.getCount() == 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 473                 notesActivity.showDetailPlaceholder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 474             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 475                 // Select the first note</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 476                 Note firstNote = mNotesAdapter.getItem(0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 477                 mCallbacks.onNoteSelected(firstNote);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 478             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 479         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 480 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 481 		return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 482 	}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 483 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 484     public void sortNoteQuery(Query&lt;Note&gt; noteQuery){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 485         noteQuery.order(&quot;pinned&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 486 		int sortPref = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_SORT_ORDER);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 487 		switch (sortPref) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 488         case 0:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 489             noteQuery.order(&quot;modificationDate&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 490             break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 491 		case 1:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 492             noteQuery.order(&quot;modificationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 493 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 494 		case 2:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 495             noteQuery.order(&quot;creationDate&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 496 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 497 		case 3:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 498             noteQuery.order(&quot;creationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 499 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 500 		case 4:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 501             noteQuery.order(&quot;content&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 502 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 503 		case 5:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 504             noteQuery.order(&quot;content&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505 			break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506 		}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510     private Bucket.Listener&lt;Tag&gt; mTagsMenuUpdater = new Bucket.Listener&lt;Tag&gt;(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511         void updateMenu(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512             getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513                 public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514                     updateMenuItems();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516             });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519         public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag tag){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520             updateMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523         public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag tag){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524             updateMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527         public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528             updateMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530     };</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531 }</span>
 532 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   1 -package com.automattic.simplenote;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   2 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   3 -import java.util.Arrays;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   4 -import java.util.Calendar;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   5 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   6 -import android.app.ActionBar;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   7 -import android.app.Activity;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   8 -import android.app.ListFragment;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   9 -import android.content.Context;</span>


<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  10 -import android.database.Cursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  11 -import android.os.Bundle;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  12 -import android.text.Html;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  13 -import android.util.Log;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  14 -import android.view.View;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  15 -import android.view.ViewGroup;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  16 -import android.widget.ArrayAdapter;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  17 -import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  18 -import android.widget.ImageView;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -import android.widget.ListView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -import android.widget.SimpleCursorAdapter;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -import android.widget.SpinnerAdapter;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -import android.widget.TextView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -import com.automattic.simplenote.models.Tag;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  26 -import com.automattic.simplenote.utils.PrefUtils;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  28 -import com.simperium.client.Bucket.OnSaveObjectListener;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -import com.simperium.client.Bucket.OnDeleteObjectListener;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 -import com.simperium.client.Bucket.OnNetworkChangeListener;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  31 -import com.simperium.client.Query;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 -import com.simperium.client.Query.SortType;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  35 -import com.simperium.client.BucketObjectMissingException;</span>




<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  37 -/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  38 - * A list fragment representing a list of Notes. This fragment also supports</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  39 - * tablet devices by allowing list items to be given an &#x27;activated&#x27; state upon</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 - * selection. This helps indicate which item is currently being viewed in a</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 - * {@link NoteEditorFragment}.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 - * &lt;p&gt;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 - * Activities containing this fragment MUST implement the {@link Callbacks}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 - * interface.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 - */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -public class NoteListFragment extends ListFragment implements ActionBar.OnNavigationListener {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -    private static final int NAVIGATION_ITEM_ALL_NOTES=0;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -    private static final int NAVIGATION_ITEM_TRASH=1;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  50 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -	private NotesCursorAdapter mNotesAdapter;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  52 -	private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  53 -	private Bucket&lt;Tag&gt; mTagsBucket;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -    private TextView mEmptyListTextView;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -	private int mNumPreviewLines;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -	private String[] mMenuItems;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -    private String mSelectedTag;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -    private String mSearchString;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -	private int mNavigationItem;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -	/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  61 -	 * The serialization (saved instance state) Bundle key representing the</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  62 -	 * activated item position. Only used on tablets.</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -	 */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -	private static final String STATE_ACTIVATED_POSITION = &quot;activated_position&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -	/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  67 -	 * The fragment&#x27;s current callback object, which is notified of list item</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  68 -	 * clicks.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  69 -	 */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  70 -	private Callbacks mCallbacks = sCallbacks;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  71 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  72 -	/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -	 * The current activated item position. Only used on tablets.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -	 */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -	private int mActivatedPosition = ListView.INVALID_POSITION;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  76 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  77 -	/**</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  78 -	 * A callback interface that all activities containing this fragment must</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  79 -	 * implement. This mechanism allows activities to be notified of item</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -	 * selections.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -	 */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -	public interface Callbacks {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -		/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  84 -		 * Callback for when a note has been selected.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -		 */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -		public void onNoteSelected(Note note);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -	/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  90 -	 * A dummy implementation of the {@link Callbacks} interface that does</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -	 * nothing. Used only when this fragment is not attached to an activity.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -	 */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -	private static Callbacks sCallbacks = new Callbacks() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -		@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  95 -		public void onNoteSelected(Note note) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  96 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  97 -	};</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  98 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  99 -	/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 100 -	 * Mandatory empty constructor for the fragment manager to instantiate the</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 101 -	 * fragment (e.g. upon screen orientation changes).</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 102 -	 */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 103 -	public NoteListFragment() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 104 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 105 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 106 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 107 -	public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 108 -		super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 109 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 110 -		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 111 -		mNotesBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 112 -        mTagsBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 113 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 114 -        ObjectCursor&lt;Note&gt; cursor = queryNotes();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 115 -		mNotesAdapter = new NotesCursorAdapter(getActivity().getBaseContext(), cursor, 0);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -		setListAdapter(mNotesAdapter);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 118 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 119 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 120 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -    public void onActivityCreated(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -        super.onActivityCreated(savedInstanceState);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 123 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 124 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 126 -    // nbradbury - load values from preferences</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 127 -	protected void getPrefs() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 128 -		mNumPreviewLines = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_NUM_PREVIEW_LINES, 2);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 129 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 130 -</span>







<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 131 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 132 -	public void onViewCreated(View view, Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 133 -		super.onViewCreated(view, savedInstanceState);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 134 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 135 -        setListShown(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 136 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 137 -        mEmptyListTextView = (TextView)getActivity().getLayoutInflater().inflate(R.layout.empty_list, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 138 -        getListView().setEmptyView(mEmptyListTextView);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 139 -        mEmptyListTextView.setVisibility(View.GONE);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 140 -        ((ViewGroup)getListView().getParent()).addView(mEmptyListTextView);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 141 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 142 -		// Restore the previously serialized activated item position.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 143 -		if (savedInstanceState != null &amp;&amp; savedInstanceState.containsKey(STATE_ACTIVATED_POSITION)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 144 -			setActivatedPosition(savedInstanceState.getInt(STATE_ACTIVATED_POSITION));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 145 -		}</span>









<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 146 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 147 -        getListView().setDivider(getResources().getDrawable(R.drawable.list_divider));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 148 -        getListView().setDividerHeight(2);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 149 -        getListView().setBackgroundColor(getResources().getColor(R.color.white));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 150 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 151 -        updateMenuItems();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 152 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 153 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 154 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 155 -	public void onAttach(Activity activity) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 156 -		super.onAttach(activity);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 158 -		// Activities containing this fragment must implement its callbacks.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 159 -		if (!(activity instanceof Callbacks)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 160 -			throw new IllegalStateException(&quot;Activity must implement fragment&#x27;s callbacks.&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 161 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 162 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 163 -		mCallbacks = (Callbacks) activity;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 164 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 165 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 166 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -	public void onResume() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 168 -		super.onResume();</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 169 -        getPrefs();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 170 -        refreshList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 171 -        updateMenuItems();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 172 -        // update the view again</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 173 -        mTagsBucket.addListener(mTagsMenuUpdater);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 174 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 175 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 176 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 177 -    public void onPause(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 178 -        super.onPause();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 179 -        mTagsBucket.removeListener(mTagsMenuUpdater);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 180 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 181 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 182 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 183 -	public void onDetach() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 184 -		super.onDetach();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 185 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 186 -		// Reset the active callbacks interface to the dummy implementation.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 187 -		mCallbacks = sCallbacks;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 188 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 189 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 190 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 191 -    public void onDestroy(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 192 -        super.onDestroy();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 193 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 194 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 195 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 196 -	public void onListItemClick(ListView listView, View view, int position, long id) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 197 -		super.onListItemClick(listView, view, position, id);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 198 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 199 -		Note note = (Note)getListAdapter().getItem(position);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 200 -        if (note != null)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 201 -            mCallbacks.onNoteSelected(note);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 202 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 203 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 204 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 205 -	public void onSaveInstanceState(Bundle outState) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 206 -		super.onSaveInstanceState(outState);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 207 -		if (mActivatedPosition != ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 208 -			// Serialize and persist the activated item position.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 209 -			outState.putInt(STATE_ACTIVATED_POSITION, mActivatedPosition);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 210 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 211 -	}</span>






















<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 212 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 213 -	/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 214 -	 * Turns on activate-on-click mode. When this mode is on, list items will be</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 215 -	 * given the &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 216 -	 */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 217 -	public void setActivateOnItemClick(boolean activateOnItemClick) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 218 -		// When setting CHOICE_MODE_SINGLE, ListView will automatically</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 219 -		// give items the &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 220 -		getListView().setChoiceMode(activateOnItemClick ? ListView.CHOICE_MODE_SINGLE : ListView.CHOICE_MODE_NONE);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 221 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 222 -		// Also select the first item by default</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 223 -		// TODO: persist the last selected item and restore that instead</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 224 -		if (!mNotesAdapter.isEmpty()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 225 -			View v = mNotesAdapter.getView(0, null, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 226 -			getListView().performItemClick(v, 0, 0);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 227 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 228 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 229 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 230 -	private void setActivatedPosition(int position) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 231 -        if (getListView() != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 232 -            if (position == ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 233 -                getListView().setItemChecked(mActivatedPosition, false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 234 -            } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 235 -                getListView().setItemChecked(position, true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 236 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 237 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 238 -            mActivatedPosition = position;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 239 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 240 -	}</span>







<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 241 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 242 -	@SuppressWarnings(&quot;deprecation&quot;)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 243 -	public void refreshList() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 244 -		Log.d(Simplenote.TAG, &quot;Refresh the list&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 245 -        mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 246 -		mNotesAdapter.notifyDataSetChanged();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 247 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 248 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 249 -    public ObjectCursor&lt;Note&gt; queryNotes(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 250 -        Log.d(Simplenote.TAG, String.format(&quot;Querying %d %s&quot;, mNavigationItem, mSelectedTag));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 251 -        Query&lt;Note&gt; query = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 252 -        if (mSearchString != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 253 -            query = Note.search(mNotesBucket, mSearchString);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 254 -        } else if (mNavigationItem == NAVIGATION_ITEM_ALL_NOTES) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 255 -			// All notes</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 256 -			query = Note.all(mNotesBucket);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 257 -		} else if (mNavigationItem == NAVIGATION_ITEM_TRASH) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 258 -			// Trashed notes</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 259 -			query = Note.allDeleted(mNotesBucket);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 260 -		} else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 261 -			query = Note.allInTag(mNotesBucket, mSelectedTag);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 262 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 263 -        query.include(&quot;title&quot;, &quot;contentPreview&quot;, &quot;pinned&quot;, &quot;modificationDate&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 264 -        sortNoteQuery(query);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 265 -        return query.execute();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 266 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 267 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 268 -	private void updateMenuItems() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 269 -		// Update ActionBar menu</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 270 -		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 271 -        Bucket&lt;Tag&gt; tagBucket = application.getTagsBucket();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 272 -        ObjectCursor&lt;Tag&gt; tagCursor = Tag.all(tagBucket).execute();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 273 -		String[] tags = new String[tagCursor.getCount()];</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 274 -        while (tagCursor.moveToNext()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 275 -            Tag tag = tagCursor.getObject();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 276 -            tags[tagCursor.getPosition()] = tag.getName();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 277 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 278 -        tagCursor.close();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 279 -		String[] topItems = { getResources().getString(R.string.notes), getResources().getString(R.string.trash) };</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 280 -		mMenuItems = Arrays.copyOf(topItems, tags.length + 2);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 281 -        ActionBar ab = getActivity().getActionBar();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 282 -        ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 283 -		System.arraycopy(tags, 0, mMenuItems, 2, tags.length);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 284 -		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_spinner_item, mMenuItems);"> 284 -		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_spinner_iðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 285 -        mSpinnerAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 286 -		ab.setListNavigationCallbacks(mSpinnerAdapter, this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 287 -        if (mNavigationItem &lt; mMenuItems.length) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 288 -            ab.setSelectedNavigationItem(mNavigationItem);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 289 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 290 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 291 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 292 -	public void addNote() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 293 -		// TODO: nbradbury - creating &amp; saving a new note here causes an empty note to appear which doesn&#x27;t go away if user backs out"> 293 -		// TODO: nbradbury - creating &amp; saving a new note here causes an empty note to appear which doesn&#x27;t go away if uðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 294 -		// of editing the note (iOS app suffers from the same problem) - instead NoteEditorFragment should be changed to handle new"> 294 -		// of editing the note (iOS app suffers from the same problem) - instead NoteEditorFragment should be changed toðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 295 -		// note creation and only save the note if user has entered any content</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 296 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 297 -		// create &amp; save new note</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 298 -		Simplenote simplenote = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 299 -		Bucket&lt;Note&gt; notesBucket = simplenote.getNotesBucket();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 300 -		Note note = notesBucket.newObject();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 301 -        note.setCreationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 302 -		note.save();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 303 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 304 -		// refresh listview so new note appears</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 305 -		refreshList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 306 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 307 -		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not always select the correct note depending on user&#x27;s sort preference"> 307 -		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not always seleðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 308 -		mCallbacks.onNoteSelected(note);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 309 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 310 -		// Select the new note</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 311 -		//View v = mNotesAdapter.getView(0, null, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 312 -		//getListView().performItemClick(v, 0, 0);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 313 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 314 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 315 -    public void setNoteSelected(Note selectedNote) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 316 -        // Loop through notes and set note selected if found</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 317 -        for(int i=0; i &lt; mNotesAdapter.getCount(); i++) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 318 -            Note note = (Note)mNotesAdapter.getItem(i);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 319 -            if (note.getSimperiumKey().equals(selectedNote.getSimperiumKey())) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 320 -                setActivatedPosition(i);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 321 -                break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 322 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 323 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 324 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 325 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 326 -	public class NotesCursorAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 327 -        private ObjectCursor&lt;Note&gt; mCursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 328 -        public NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; c, int flags) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 329 -            super(context, c, flags);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 330 -            mCursor = c;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 331 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 332 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 333 -        public void changeCursor(ObjectCursor&lt;Note&gt; cursor){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 334 -            mCursor = cursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 335 -            super.changeCursor(cursor);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 336 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 337 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 338 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 339 -        public Note getItem(int position) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 340 -            mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 341 -            return mCursor.getObject();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 342 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 343 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 344 -        /*</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 345 -        *  nbradbury - implemented &quot;holder pattern&quot; to boost performance with large note lists</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 346 -        */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 347 -		@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 348 -		public View getView(int position, View view, ViewGroup parent) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 349 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 350 -			NoteViewHolder holder;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 351 -			if (view == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 352 -				view = View.inflate(getActivity().getBaseContext(), R.layout.note_list_row, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 353 -				holder = new NoteViewHolder();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 354 -				holder.titleTextView = (TextView) view.findViewById(R.id.note_title);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 355 -				holder.contentTextView = (TextView) view.findViewById(R.id.note_content);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 356 -				holder.pinImageView = (ImageView) view.findViewById(R.id.note_pin);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 357 -				view.setTag(holder);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 358 -			} else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 359 -				holder = (NoteViewHolder) view.getTag();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 360 -			}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 361 -</span>





<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 362 -            // for performance reasons we are going to get indexed values</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 363 -            // from the cursor instead of instantiating the entire bucket object</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 364 -            holder.contentTextView.setMaxLines(mNumPreviewLines);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 365 -            mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 366 -            int pinned = mCursor.getInt(mCursor.getColumnIndex(&quot;pinned&quot;));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 367 -            holder.pinImageView.setVisibility(pinned == 1 ? View.VISIBLE : View.GONE);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 368 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 369 -            String title = mCursor.getString(mCursor.getColumnIndex(&quot;title&quot;));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 370 -            if (title == null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 371 -                title = getString(R.string.new_note);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 372 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 373 -            holder.titleTextView.setText(title);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 374 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 375 -            if (mNumPreviewLines &gt; 0) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 376 -                holder.contentTextView.setText(mCursor.getString(mCursor.getColumnIndex(&quot;contentPreview&quot;)));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 377 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 378 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 379 -			return view;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 380 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 381 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 382 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 383 -        public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 384 -            return null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 385 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 386 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 387 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 388 -        public void bindView(View view, Context context, Cursor cursor) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 389 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 390 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 391 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 392 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 393 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 394 -	// view holder for NotesCursorAdapter</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 395 -	private static class NoteViewHolder {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 396 -		TextView titleTextView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 397 -		TextView contentTextView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 398 -		ImageView pinImageView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 399 -        private String mNoteId;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 400 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 401 -        public void setNoteId(String noteId) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 402 -            mNoteId = noteId;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 403 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 404 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 405 -        public String getNoteId() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 406 -            return mNoteId;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 407 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 408 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 409 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 410 -	public void searchNotes(String searchString) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 411 -        mSearchString = searchString;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 412 -		mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 413 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 414 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 415 -    /**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 416 -     * Clear search and load all notes</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 417 -     */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 418 -    public void clearSearch() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 419 -        mSearchString = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 420 -        mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 421 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 422 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 423 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 424 -	public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 425 -        Log.d(Simplenote.TAG, &quot;onNavigationItemSelected&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 426 -</span>





<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 427 -        // Update empty list placeholder text</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 428 -        if (mEmptyListTextView != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 429 -            if (itemPosition == NAVIGATION_ITEM_TRASH)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 430 -                mEmptyListTextView.setText(Html.fromHtml(getString(R.string.trash_is_empty)));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 431 -            else</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 432 -                mEmptyListTextView.setText(Html.fromHtml(getString(R.string.no_notes)));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 433 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 434 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 435 -		Query&lt;Note&gt; query;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 436 -		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 437 -        Bucket&lt;Note&gt; noteBucket = application.getNotesBucket();</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 438 -		mNavigationItem = itemPosition;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 439 -        if (itemPosition &gt; 1) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 440 -            mSelectedTag = mMenuItems[itemPosition];</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 441 -        } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 442 -            mSelectedTag = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 443 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 444 -        mNotesAdapter.changeCursor(queryNotes());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 445 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 446 -        getActivity().invalidateOptionsMenu();</span>










<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 447 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 448 -		return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 449 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 450 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 451 -    public void sortNoteQuery(Query&lt;Note&gt; noteQuery){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 452 -        noteQuery.order(&quot;pinned&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 453 -		int sortPref = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_SORT_ORDER);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 454 -		switch (sortPref) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 455 -        case 0:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 456 -            noteQuery.order(&quot;modificationDate&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 457 -            break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 458 -		case 1:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 459 -            // orderBy = &quot;creationDate DESC&quot;;</span>



<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 460 -            noteQuery.order(&quot;creationDate&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 461 -			break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 462 -		case 2:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 463 -            noteQuery.order(&quot;content&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 464 -			break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 465 -		case 3:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 466 -            noteQuery.order(&quot;modificationDate&quot;, SortType.ASCENDING);</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 467 -			break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 468 -		case 4:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 469 -            noteQuery.order(&quot;creationDate&quot;, SortType.ASCENDING);</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 470 -			break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 471 -		case 5:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 472 -            noteQuery.order(&quot;content&quot;, SortType.DESCENDING);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 473 -			break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 474 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 475 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 476 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 477 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 478 -    private Bucket.Listener&lt;Tag&gt; mTagsMenuUpdater = new Bucket.Listener&lt;Tag&gt;(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 479 -        void updateMenu(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 480 -            getActivity().runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 481 -                public void run() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 482 -                    updateMenuItems();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 483 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 484 -            });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 485 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 486 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 487 -        public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag tag){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 488 -            updateMenu();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 489 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 490 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 491 -        public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag tag){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 492 -            updateMenu();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 493 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 494 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 495 -        public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 496 -            updateMenu();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 497 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 498 -    };</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 499 -}</span></pre></td>
                            <td><pre>   1  package com.automattic.simplenote;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   2 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   3 -import java.util.Arrays;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   4 -import java.util.Calendar;</span>
   5  
   6  import android.app.ActionBar;
   7  import android.app.Activity;
   8  import android.app.ListFragment;
   9  import android.content.Context;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  10 +import android.content.SharedPreferences;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  11 +import android.content.res.Configuration;</span>
  12  import android.database.Cursor;
  13  import android.os.Bundle;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  14 +import android.preference.PreferenceManager;</span>
  15  import android.text.Html;
  16  import android.util.Log;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  17 +import android.view.LayoutInflater;</span>
  18  import android.view.View;
  19  import android.view.ViewGroup;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  20 +import android.widget.AbsListView;</span>
  21  import android.widget.ArrayAdapter;
  22  import android.widget.CursorAdapter;
  23  import android.widget.ImageView;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  24 +import android.widget.LinearLayout;</span>
  25  import android.widget.ListView;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  26 -import android.widget.SimpleCursorAdapter;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -import android.widget.SpinnerAdapter;</span>
  28  import android.widget.TextView;
  29  
  30  import com.automattic.simplenote.models.Note;
  31  import com.automattic.simplenote.models.Tag;
  32  import com.automattic.simplenote.utils.PrefUtils;
  33  import com.simperium.client.Bucket;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -import com.simperium.client.Bucket.OnSaveObjectListener;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  35 -import com.simperium.client.Bucket.OnDeleteObjectListener;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 -import com.simperium.client.Bucket.OnNetworkChangeListener;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 +import com.simperium.client.Bucket.ObjectCursor;</span>
  38  import com.simperium.client.Query;
  39  import com.simperium.client.Query.SortType;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 -import com.simperium.client.Query.ComparisonType;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 -import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 -import com.simperium.client.BucketObjectMissingException;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  43 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  44 +import java.util.Arrays;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 +import java.util.Calendar;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +import java.util.prefs.Preferences;</span>
  47  
  48  /**
  49   * A list fragment representing a list of Notes. This fragment also supports
  50   * tablet devices by allowing list items to be given an &#x27;activated&#x27; state upon
  51   * selection. This helps indicate which item is currently being viewed in a
  52   * {@link NoteEditorFragment}.
  53   * &lt;p&gt;
  54   * Activities containing this fragment MUST implement the {@link Callbacks}
  55   * interface.
  56   */
  57  public class NoteListFragment extends ListFragment implements ActionBar.OnNavigationListener {
  58  
  59      private static final int NAVIGATION_ITEM_ALL_NOTES=0;
  60      private static final int NAVIGATION_ITEM_TRASH=1;
  61  
  62  	private NotesCursorAdapter mNotesAdapter;
  63  	private Bucket&lt;Note&gt; mNotesBucket;
  64  	private Bucket&lt;Tag&gt; mTagsBucket;
  65      private TextView mEmptyListTextView;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +    private LinearLayout mDividerShadow;</span>
  67  	private int mNumPreviewLines;
  68  	private String[] mMenuItems;
  69      private String mSelectedTag;
  70      private String mSearchString;
  71  	private int mNavigationItem;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  72 +    private boolean mNavListLoaded;</span>
  73  	/**
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -	 * The serialization (saved instance state) Bundle key representing the</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -	 * activated item position. Only used on tablets.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  76 +	 * The preferences key representing the activated item position. Only used on tablets.</span>
  77  	 */
  78  	private static final String STATE_ACTIVATED_POSITION = &quot;activated_position&quot;;
  79  
  80  	/**
  81  	 * The fragment&#x27;s current callback object, which is notified of list item
  82  	 * clicks.
  83  	 */
  84  	private Callbacks mCallbacks = sCallbacks;
  85  
  86  	/**
  87  	 * The current activated item position. Only used on tablets.
  88  	 */
  89  	private int mActivatedPosition = ListView.INVALID_POSITION;
  90  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -	/**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  92 +    /**</span>
  93  	 * A callback interface that all activities containing this fragment must
  94  	 * implement. This mechanism allows activities to be notified of item
  95  	 * selections.
  96  	 */
  97  	public interface Callbacks {
  98  		/**
  99  		 * Callback for when a note has been selected.
 100  		 */
 101  		public void onNoteSelected(Note note);
 102  	}
 103  
 104  	/**
 105  	 * A dummy implementation of the {@link Callbacks} interface that does
 106  	 * nothing. Used only when this fragment is not attached to an activity.
 107  	 */
 108  	private static Callbacks sCallbacks = new Callbacks() {
 109  		@Override
 110  		public void onNoteSelected(Note note) {
 111  		}
 112  	};
 113  
 114  	/**
 115  	 * Mandatory empty constructor for the fragment manager to instantiate the
 116  	 * fragment (e.g. upon screen orientation changes).
 117  	 */
 118  	public NoteListFragment() {
 119  	}
 120  
 121  	@Override
 122  	public void onCreate(Bundle savedInstanceState) {
 123  		super.onCreate(savedInstanceState);
 124  
 125  		Simplenote application = (Simplenote) getActivity().getApplication();
 126  		mNotesBucket = application.getNotesBucket();
 127          mTagsBucket = application.getTagsBucket();
 128  
 129          ObjectCursor&lt;Note&gt; cursor = queryNotes();
 130  		mNotesAdapter = new NotesCursorAdapter(getActivity().getBaseContext(), cursor, 0);
 131  		setListAdapter(mNotesAdapter);
 132  
 133  	}
 134  
 135      @Override
 136      public void onActivityCreated(Bundle savedInstanceState) {
 137          super.onActivityCreated(savedInstanceState);
 138  
 139      }
 140  
 141      // nbradbury - load values from preferences
 142  	protected void getPrefs() {
 143  		mNumPreviewLines = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_NUM_PREVIEW_LINES, 2);
 144  	}
 145  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +    {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +        View view = inflater.inflate(R.layout.notes_list, container, false);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +        return view;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 152 +</span>
 153  	@Override
 154  	public void onViewCreated(View view, Bundle savedInstanceState) {
 155  		super.onViewCreated(view, savedInstanceState);
 156  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -        setListShown(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 158 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 159 -        mEmptyListTextView = (TextView)getActivity().getLayoutInflater().inflate(R.layout.empty_list, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 160 -        getListView().setEmptyView(mEmptyListTextView);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 161 -        mEmptyListTextView.setVisibility(View.GONE);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 162 -        ((ViewGroup)getListView().getParent()).addView(mEmptyListTextView);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 163 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 164 -		// Restore the previously serialized activated item position.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 165 -		if (savedInstanceState != null &amp;&amp; savedInstanceState.containsKey(STATE_ACTIVATED_POSITION)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 166 -			setActivatedPosition(savedInstanceState.getInt(STATE_ACTIVATED_POSITION));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -		}</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +        NotesActivity notesActivity = (NotesActivity)getActivity();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +        mEmptyListTextView = (TextView)view.findViewById(android.R.id.empty);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +        mDividerShadow = (LinearLayout)view.findViewById(R.id.divider_shadow);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +        if (notesActivity.isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +            setActivateOnItemClick(true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +            mDividerShadow.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +        }</span>
 177  
 178          getListView().setDivider(getResources().getDrawable(R.drawable.list_divider));
 179          getListView().setDividerHeight(2);
 180          getListView().setBackgroundColor(getResources().getColor(R.color.white));
 181  
 182          updateMenuItems();
 183  	}
 184  
 185  	@Override
 186  	public void onAttach(Activity activity) {
 187  		super.onAttach(activity);
 188  
 189  		// Activities containing this fragment must implement its callbacks.
 190  		if (!(activity instanceof Callbacks)) {
 191  			throw new IllegalStateException(&quot;Activity must implement fragment&#x27;s callbacks.&quot;);
 192  		}
 193  
 194  		mCallbacks = (Callbacks) activity;
 195  	}
 196  
 197  	@Override
 198  	public void onResume() {
 199  		super.onResume();
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +        mNavListLoaded = false;</span>
 201          getPrefs();
 202          refreshList();
 203          updateMenuItems();
 204          // update the view again
 205          mTagsBucket.addListener(mTagsMenuUpdater);
 206  	}
 207  
 208      @Override
 209      public void onPause(){
 210          super.onPause();
 211          mTagsBucket.removeListener(mTagsMenuUpdater);
 212      }
 213  
 214  	@Override
 215  	public void onDetach() {
 216  		super.onDetach();
 217  
 218  		// Reset the active callbacks interface to the dummy implementation.
 219  		mCallbacks = sCallbacks;
 220  	}
 221  
 222      @Override
 223      public void onDestroy(){
 224          super.onDestroy();
 225      }
 226  
 227  	@Override
 228  	public void onListItemClick(ListView listView, View view, int position, long id) {
 229  		super.onListItemClick(listView, view, position, id);
 230  
 231  		Note note = (Note)getListAdapter().getItem(position);
 232          if (note != null)
 233              mCallbacks.onNoteSelected(note);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 234 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 235 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 236 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 237 -	public void onSaveInstanceState(Bundle outState) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 238 -		super.onSaveInstanceState(outState);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 239 -		if (mActivatedPosition != ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 240 -			// Serialize and persist the activated item position.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 241 -			outState.putInt(STATE_ACTIVATED_POSITION, mActivatedPosition);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 242 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 243 -	}</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 244 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +        mActivatedPosition = position;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +	}</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +     * Selects first row in the list if available</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +    public void selectFirstNote() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +        if (mNotesAdapter.getCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +            Note selectedNote = mNotesAdapter.getItem(0);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 254 +            mCallbacks.onNoteSelected(selectedNote);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 255 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 256 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 257 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 258 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 259 +    public void onSaveInstanceState(Bundle outState) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 260 +        super.onSaveInstanceState(outState);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 261 +        if (mActivatedPosition != ListView.INVALID_POSITION) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 262 +            // Serialize and persist the activated item position.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 263 +            outState.putInt(STATE_ACTIVATED_POSITION, mActivatedPosition);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 264 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 265 +    }</span>
 266  
 267  	/**
 268  	 * Turns on activate-on-click mode. When this mode is on, list items will be
 269  	 * given the &#x27;activated&#x27; state when touched.
 270  	 */
 271  	public void setActivateOnItemClick(boolean activateOnItemClick) {
 272  		// When setting CHOICE_MODE_SINGLE, ListView will automatically
 273  		// give items the &#x27;activated&#x27; state when touched.
 274  		getListView().setChoiceMode(activateOnItemClick ? ListView.CHOICE_MODE_SINGLE : ListView.CHOICE_MODE_NONE);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 275 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 276 -		// Also select the first item by default</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 277 -		// TODO: persist the last selected item and restore that instead</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 278 -		if (!mNotesAdapter.isEmpty()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 279 -			View v = mNotesAdapter.getView(0, null, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 280 -			getListView().performItemClick(v, 0, 0);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 281 -		}</span>
 282  	}
 283  
 284  	private void setActivatedPosition(int position) {
 285          if (getListView() != null) {
 286              if (position == ListView.INVALID_POSITION) {
 287                  getListView().setItemChecked(mActivatedPosition, false);
 288              } else {
 289                  getListView().setItemChecked(position, true);
 290              }
 291  
 292              mActivatedPosition = position;
 293          }
 294  	}
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 295 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 296 +    public void setDividerVisible(boolean visible) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 297 +        if (visible)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 298 +            mDividerShadow.setVisibility(View.VISIBLE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 299 +        else</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 300 +            mDividerShadow.setVisibility(View.GONE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +    }</span>
 302  
 303  	@SuppressWarnings(&quot;deprecation&quot;)
 304  	public void refreshList() {
 305  		Log.d(Simplenote.TAG, &quot;Refresh the list&quot;);
 306          mNotesAdapter.changeCursor(queryNotes());
 307  		mNotesAdapter.notifyDataSetChanged();
 308  	}
 309  
 310      public ObjectCursor&lt;Note&gt; queryNotes(){
 311          Log.d(Simplenote.TAG, String.format(&quot;Querying %d %s&quot;, mNavigationItem, mSelectedTag));
 312          Query&lt;Note&gt; query = null;
 313          if (mSearchString != null) {
 314              query = Note.search(mNotesBucket, mSearchString);
 315          } else if (mNavigationItem == NAVIGATION_ITEM_ALL_NOTES) {
 316  			// All notes
 317  			query = Note.all(mNotesBucket);
 318  		} else if (mNavigationItem == NAVIGATION_ITEM_TRASH) {
 319  			// Trashed notes
 320  			query = Note.allDeleted(mNotesBucket);
 321  		} else {
 322  			query = Note.allInTag(mNotesBucket, mSelectedTag);
 323  		}
 324          query.include(&quot;title&quot;, &quot;contentPreview&quot;, &quot;pinned&quot;, &quot;modificationDate&quot;);
 325          sortNoteQuery(query);
 326          return query.execute();
 327      }
 328  
 329  	private void updateMenuItems() {
 330  		// Update ActionBar menu
 331  		Simplenote application = (Simplenote) getActivity().getApplication();
 332          Bucket&lt;Tag&gt; tagBucket = application.getTagsBucket();
 333          ObjectCursor&lt;Tag&gt; tagCursor = Tag.all(tagBucket).execute();
 334  		String[] tags = new String[tagCursor.getCount()];
 335          while (tagCursor.moveToNext()) {
 336              Tag tag = tagCursor.getObject();
 337              tags[tagCursor.getPosition()] = tag.getName();
 338          }
 339          tagCursor.close();
 340  		String[] topItems = { getResources().getString(R.string.notes), getResources().getString(R.string.trash) };
 341  		mMenuItems = Arrays.copyOf(topItems, tags.length + 2);
 342          ActionBar ab = getActivity().getActionBar();
 343          ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);
 344  		System.arraycopy(tags, 0, mMenuItems, 2, tags.length);
<abbr title=" 345  		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_spinner_item, mMenuItems);"> 345  		ArrayAdapter mSpinnerAdapter = new ArrayAdapter&lt;String&gt;(ab.getThemedContext(), android.R.layout.simple_spinner_iðŸ”µ</abbr>
 346          mSpinnerAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
 347  		ab.setListNavigationCallbacks(mSpinnerAdapter, this);
 348          if (mNavigationItem &lt; mMenuItems.length) {
 349              ab.setSelectedNavigationItem(mNavigationItem);
 350          }
 351  	}
 352  
 353  	public void addNote() {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 354 -		// TODO: nbradbury - creating &amp; saving a new note here causes an empty note to appear which doesn&#x27;t go away if user backs out"> 354 -		// TODO: nbradbury - creating &amp; saving a new note here causes an empty note to appear which doesn&#x27;t go away if uðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 355 -		// of editing the note (iOS app suffers from the same problem) - instead NoteEditorFragment should be changed to handle new"> 355 -		// of editing the note (iOS app suffers from the same problem) - instead NoteEditorFragment should be changed toðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 356 -		// note creation and only save the note if user has entered any content</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 357 -</span>
 358  		// create &amp; save new note
 359  		Simplenote simplenote = (Simplenote) getActivity().getApplication();
 360  		Bucket&lt;Note&gt; notesBucket = simplenote.getNotesBucket();
 361  		Note note = notesBucket.newObject();
 362          note.setCreationDate(Calendar.getInstance());
 363  		note.save();
 364  
 365  		// refresh listview so new note appears
 366  		refreshList();
 367  
<abbr title=" 368  		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not always select the correct note depending on user&#x27;s sort preference"> 368  		// nbradbury - call onNoteSelected() directly rather than using code below, since code below may not always seleðŸ”µ</abbr>
 369  		mCallbacks.onNoteSelected(note);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 370 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 371 -		// Select the new note</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 372 -		//View v = mNotesAdapter.getView(0, null, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 373 -		//getListView().performItemClick(v, 0, 0);</span>
 374  	}
 375  
 376      public void setNoteSelected(Note selectedNote) {
 377          // Loop through notes and set note selected if found
 378          for(int i=0; i &lt; mNotesAdapter.getCount(); i++) {
 379              Note note = (Note)mNotesAdapter.getItem(i);
 380              if (note.getSimperiumKey().equals(selectedNote.getSimperiumKey())) {
 381                  setActivatedPosition(i);
 382                  break;
 383              }
 384          }
 385      }
 386  
 387  	public class NotesCursorAdapter extends CursorAdapter {
 388          private ObjectCursor&lt;Note&gt; mCursor;
 389          public NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; c, int flags) {
 390              super(context, c, flags);
 391              mCursor = c;
 392          }
 393  
 394          public void changeCursor(ObjectCursor&lt;Note&gt; cursor){
 395              mCursor = cursor;
 396              super.changeCursor(cursor);
 397          }
 398  
 399          @Override
 400          public Note getItem(int position) {
 401              mCursor.moveToPosition(position);
 402              return mCursor.getObject();
 403          }
 404  
 405          /*
 406          *  nbradbury - implemented &quot;holder pattern&quot; to boost performance with large note lists
 407          */
 408  		@Override
 409  		public View getView(int position, View view, ViewGroup parent) {
 410  
 411  			NoteViewHolder holder;
 412  			if (view == null) {
 413  				view = View.inflate(getActivity().getBaseContext(), R.layout.note_list_row, null);
 414  				holder = new NoteViewHolder();
 415  				holder.titleTextView = (TextView) view.findViewById(R.id.note_title);
 416  				holder.contentTextView = (TextView) view.findViewById(R.id.note_content);
 417  				holder.pinImageView = (ImageView) view.findViewById(R.id.note_pin);
 418  				view.setTag(holder);
 419  			} else {
 420  				holder = (NoteViewHolder) view.getTag();
 421  			}
 422  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 423 +            if (position == getListView().getCheckedItemPosition())</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 424 +                view.setActivated(true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 425 +            else</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 426 +                view.setActivated(false);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 427 +</span>
 428              // for performance reasons we are going to get indexed values
 429              // from the cursor instead of instantiating the entire bucket object
 430              holder.contentTextView.setMaxLines(mNumPreviewLines);
 431              mCursor.moveToPosition(position);
 432              int pinned = mCursor.getInt(mCursor.getColumnIndex(&quot;pinned&quot;));
 433              holder.pinImageView.setVisibility(pinned == 1 ? View.VISIBLE : View.GONE);
 434  
 435              String title = mCursor.getString(mCursor.getColumnIndex(&quot;title&quot;));
 436              if (title == null) {
 437                  title = getString(R.string.new_note);
 438              }
 439              holder.titleTextView.setText(title);
 440  
 441              if (mNumPreviewLines &gt; 0) {
 442                  holder.contentTextView.setText(mCursor.getString(mCursor.getColumnIndex(&quot;contentPreview&quot;)));
 443              }
 444  
 445  			return view;
 446  		}
 447  
 448          @Override
 449          public View newView(Context context, Cursor cursor, ViewGroup viewGroup) {
 450              return null;
 451          }
 452  
 453          @Override
 454          public void bindView(View view, Context context, Cursor cursor) {
 455  
 456          }
 457  
 458  	}
 459  
 460  	// view holder for NotesCursorAdapter
 461  	private static class NoteViewHolder {
 462  		TextView titleTextView;
 463  		TextView contentTextView;
 464  		ImageView pinImageView;
 465          private String mNoteId;
 466  
 467          public void setNoteId(String noteId) {
 468              mNoteId = noteId;
 469          }
 470  
 471          public String getNoteId() {
 472              return mNoteId;
 473          }
 474  	}
 475  
 476  	public void searchNotes(String searchString) {
 477          mSearchString = searchString;
 478  		mNotesAdapter.changeCursor(queryNotes());
 479  	}
 480  
 481      /**
 482       * Clear search and load all notes
 483       */
 484      public void clearSearch() {
 485          mSearchString = null;
 486          mNotesAdapter.changeCursor(queryNotes());
 487      }
 488  
 489  	@Override
 490  	public boolean onNavigationItemSelected(int itemPosition, long itemId) {
 491          Log.d(Simplenote.TAG, &quot;onNavigationItemSelected&quot;);
 492  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 493 +        if (!mNavListLoaded) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 494 +            mNavListLoaded = true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 495 +            return false;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 496 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 497 +</span>
 498          // Update empty list placeholder text
 499          if (mEmptyListTextView != null) {
 500              if (itemPosition == NAVIGATION_ITEM_TRASH)
 501                  mEmptyListTextView.setText(Html.fromHtml(getString(R.string.trash_is_empty)));
 502              else
 503                  mEmptyListTextView.setText(Html.fromHtml(getString(R.string.no_notes)));
 504          }
 505  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 506 -		Query&lt;Note&gt; query;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 507 -		Simplenote application = (Simplenote) getActivity().getApplication();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 508 -        Bucket&lt;Note&gt; noteBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 509 +        NotesActivity notesActivity = (NotesActivity)getActivity();</span>
 510  		mNavigationItem = itemPosition;
 511          if (itemPosition &gt; 1) {
 512              mSelectedTag = mMenuItems[itemPosition];
 513          } else {
 514              mSelectedTag = null;
 515          }
 516          mNotesAdapter.changeCursor(queryNotes());
 517  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 518 -        getActivity().invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 519 +        notesActivity.invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 520 +        if (notesActivity.isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 521 +            if (mNotesAdapter.getCount() == 0) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 522 +                notesActivity.showDetailPlaceholder();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 523 +            } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 524 +                // Select the first note</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 525 +                Note firstNote = mNotesAdapter.getItem(0);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 526 +                mCallbacks.onNoteSelected(firstNote);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 527 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 528 +        }</span>
 529  
 530  		return true;
 531  	}
 532  
 533      public void sortNoteQuery(Query&lt;Note&gt; noteQuery){
 534          noteQuery.order(&quot;pinned&quot;, SortType.DESCENDING);
 535  		int sortPref = PrefUtils.getIntPref(getActivity(), PrefUtils.PREF_SORT_ORDER);
 536  		switch (sortPref) {
 537          case 0:
 538              noteQuery.order(&quot;modificationDate&quot;, SortType.DESCENDING);
 539              break;
 540  		case 1:
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 541 -            // orderBy = &quot;creationDate DESC&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 542 +            noteQuery.order(&quot;modificationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 543 +			break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 544 +		case 2:</span>
 545              noteQuery.order(&quot;creationDate&quot;, SortType.DESCENDING);
 546  			break;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 547 -		case 2:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 548 -            noteQuery.order(&quot;content&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 549 -			break;</span>
 550  		case 3:
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 551 -            noteQuery.order(&quot;modificationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 552 +            noteQuery.order(&quot;creationDate&quot;, SortType.ASCENDING);</span>
 553  			break;
 554  		case 4:
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 555 -            noteQuery.order(&quot;creationDate&quot;, SortType.ASCENDING);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 556 +            noteQuery.order(&quot;content&quot;, SortType.ASCENDING);</span>
 557  			break;
 558  		case 5:
 559              noteQuery.order(&quot;content&quot;, SortType.DESCENDING);
 560  			break;
 561  		}
 562      }
 563  
 564  
 565      private Bucket.Listener&lt;Tag&gt; mTagsMenuUpdater = new Bucket.Listener&lt;Tag&gt;(){
 566          void updateMenu(){
 567              getActivity().runOnUiThread(new Runnable() {
 568                  public void run() {
 569                      updateMenuItems();
 570                  }
 571              });
 572          }
 573  
 574          public void onSaveObject(Bucket&lt;Tag&gt; bucket, Tag tag){
 575              updateMenu();
 576          }
 577  
 578          public void onDeleteObject(Bucket&lt;Tag&gt; bucket, Tag tag){
 579              updateMenu();
 580          }
 581  
 582          public void onChange(Bucket&lt;Tag&gt; bucket, Bucket.ChangeType type, String key){
 583              updateMenu();
 584          }
 585      };
 586  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            