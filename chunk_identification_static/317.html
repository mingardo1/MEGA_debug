<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>317</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    317
                    <a href="316.html">prev</a>
                    <a href="318.html">next</a>
                    <a href="317_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Automattic/simplenote-android_6780311d33539eb86c4007a7d1993f6f1467a837_src/com/automattic/simplenote/NotesActivity.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837:src/com/automattic/simplenote/NotesActivity.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837^1:src/com/automattic/simplenote/NotesActivity.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837^2:src/com/automattic/simplenote/NotesActivity.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;20279c862696f156d42fbdab7ae10281f312fb27:src/com/automattic/simplenote/NotesActivity.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[sbj]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
   2 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import android.app.ActionBar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 import android.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import android.app.FragmentManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import android.app.FragmentTransaction;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import android.content.Intent;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 import android.content.res.Configuration;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import android.os.AsyncTask;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import android.os.Parcelable;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 import android.view.Menu;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 import android.view.MenuInflater;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 import android.view.MenuItem;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 import android.widget.SearchView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import com.automattic.simplenote.utils.UndoBarController;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import com.simperium.Simperium;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import com.simperium.client.LoginActivity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import com.simperium.client.User;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32  * An activity representing a list of Notes.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33  * &lt;p&gt;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34  * The activity makes heavy use of fragments. The list of items is a</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35  * {@link NoteListFragment} and the item details (if present) is a</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36  * {@link NoteEditorFragment}.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37  * &lt;p&gt;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38  * This activity also implements the required {@link NoteListFragment.Callbacks}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39  * interface to listen for item selections.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 public class NotesActivity extends Activity implements</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42 		NoteListFragment.Callbacks, ActionBar.OnNavigationListener,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43         User.AuthenticationListener, UndoBarController.UndoListener,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44         FragmentManager.OnBackStackChangedListener, Bucket.Listener&lt;Note&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 	 * Whether or not the activity is in two-pane mode, i.e. running on a tablet</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 	 * device.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 	private boolean mTwoPane;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51     private UndoBarController mUndoBarController;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52     private SearchView mSearchView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53     private MenuItem mSearchMenuItem;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54     private NoteListFragment mNoteListFragment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55     private NoteEditorFragment mNoteEditorFragment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56     private Note mCurrentNote;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57     private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58     private int TRASH_SELECTED_ID = 1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 	protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 		super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63         Simplenote currentApp = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64         mNotesBucket = currentApp.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65 		setContentView(R.layout.activity_notes);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67 		int orientation = getResources().getConfiguration().orientation;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68 		if (getNoteEditorFragment() != null &amp;&amp; orientation == Configuration.ORIENTATION_LANDSCAPE ) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69 			mTwoPane = true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 			// In two-pane mode, list items should be given the</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71 			// &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  72             mNoteListFragment = ((NoteListFragment) getFragmentManager().findFragmentById(R.id.note_list));">  72             mNoteListFragment = ((NoteListFragment) getFragmentManager().findFragmentById(R.id.note_list)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73             mNoteListFragment.setActivateOnItemClick(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74             mNoteEditorFragment = getNoteEditorFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75 		} else if (savedInstanceState == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76             mNoteListFragment = new NoteListFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77             FragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78             fragmentTransaction.add(R.id.noteFragmentContainer, mNoteListFragment);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79             fragmentTransaction.commit();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  81             mNoteListFragment = (NoteListFragment)getFragmentManager().findFragmentById(R.id.noteFragmentContainer);">  81             mNoteListFragment = (NoteListFragment)getFragmentManager().findFragmentById(R.id.noteFragmentðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84         ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85         ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86         ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88         mUndoBarController = new UndoBarController(findViewById(R.id.undobar), this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90         getFragmentManager().addOnBackStackChangedListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  92 		if( currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAuthentication() ){">  92 		if( currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAuthenticatðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93 			startLoginActivity();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95 		currentApp.getSimperium().setAuthenticationListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97         if (Intent.ACTION_SEND.equals(getIntent().getAction())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98             // Check share action</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99             Intent intent = getIntent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100             String text = intent.getStringExtra(Intent.EXTRA_TEXT);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101             String title = intent.getStringExtra(Intent.EXTRA_SUBJECT);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102             if (text != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103                 Note note = mNotesBucket.newObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104                 note.setContent(text);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105                 note.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106                 onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112     protected void onResume() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113         super.onResume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115         mNotesBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116         mNotesBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117         mNotesBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119         configureActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124     protected void onPause(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125         super.onPause();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127         mNotesBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128         mNotesBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129         mNotesBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133     // received a change from the network, refresh the list and the editor</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135     public void onChange(Bucket&lt;Note&gt; bucket, Bucket.ChangeType type, String key){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136         final boolean resetEditor = mCurrentNote != null &amp;&amp; mCurrentNote.getSimperiumKey().equals(key);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137         runOnUiThread(new Runnable(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138             @Override public void run(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140                 if (!resetEditor) return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141                 if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142                     mNoteEditorFragment.refreshContent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149     public void onSaveObject(Bucket&lt;Note&gt; bucket, Note object){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150         runOnUiThread(new Runnable(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151             @Override public void run(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158     public void onDeleteObject(Bucket&lt;Note&gt; bucket, Note object){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159         runOnUiThread(new Runnable(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160             @Override public void run(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166     public boolean isTwoPane() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167         return mTwoPane;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170     // nbradbury 01-Apr-2013</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171 	private NoteListFragment getNoteListFragment() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172 		return mNoteListFragment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175     private NoteEditorFragment getNoteEditorFragment() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176         return ((NoteEditorFragment) getFragmentManager().findFragmentById(R.id.noteEditorFragment));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180 	public boolean onCreateOptionsMenu(Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181 		super.onCreateOptionsMenu(menu);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182 		MenuInflater inflater = getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183 		inflater.inflate(R.menu.notes_list, menu);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185         mSearchMenuItem = menu.findItem(R.id.menu_search);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186         mSearchView = (SearchView) mSearchMenuItem.getActionView();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187         mSearchView.setOnQueryTextListener(new SearchView.OnQueryTextListener( ) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189             public boolean onQueryTextChange(String newText) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190                 if (newText != null &amp;&amp; mSearchMenuItem.isActionViewExpanded())</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191                     getNoteListFragment().searchNotes(newText);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196             public boolean onQueryTextSubmit(String queryText) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197                 if (queryText != null)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198                     getNoteListFragment().searchNotes(queryText);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202         mSearchMenuItem.setOnActionExpandListener(new MenuItem.OnActionExpandListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204             public boolean onMenuItemActionExpand(MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209             public boolean onMenuItemActionCollapse(MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210                 // Show all notes again</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211                 getNoteListFragment().clearSearch();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217         if (fm.getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218             getActionBar().setDisplayHomeAsUpEnabled(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219             menu.findItem(R.id.menu_create_note).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220             menu.findItem(R.id.menu_search).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221             menu.findItem(R.id.menu_preferences).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222             menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223             menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224             if (mCurrentNote != null &amp;&amp; mCurrentNote.isDeleted())</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225                 menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226             menu.findItem(R.id.menu_edit_tags).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228         } else if (mTwoPane) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229             getActionBar().setDisplayHomeAsUpEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230             getActionBar().setHomeButtonEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231             menu.findItem(R.id.menu_create_note).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232             menu.findItem(R.id.menu_search).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233             menu.findItem(R.id.menu_preferences).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234             menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235             menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236             menu.findItem(R.id.menu_edit_tags).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239         } else  {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240             getActionBar().setDisplayHomeAsUpEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241             getActionBar().setHomeButtonEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242             menu.findItem(R.id.menu_create_note).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243             menu.findItem(R.id.menu_search).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244             menu.findItem(R.id.menu_preferences).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245             menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246             menu.findItem(R.id.menu_delete).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247             menu.findItem(R.id.menu_edit_tags).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251         // Are we looking at the trash? Adjust menu accordingly.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252         if (getActionBar().getSelectedNavigationIndex() == TRASH_SELECTED_ID) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253             menu.findItem(R.id.menu_empty_trash).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254             menu.findItem(R.id.menu_create_note).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255             menu.findItem(R.id.menu_search).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256             menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259 		return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263 	public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264 		switch (item.getItemId()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265 		case R.id.menu_preferences :</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 266 			// nbradbury - use startActivityForResult so onActivityResult can detect when user returns from preferences"> 266 			// nbradbury - use startActivityForResult so onActivityResult can detect when user returns from preferðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267 			Intent i = new Intent(this, PreferencesActivity.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268 			startActivityForResult(i, Simplenote.INTENT_PREFERENCES);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269 			return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270         case R.id.menu_edit_tags :</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271             Intent editTagsIntent = new Intent(this, TagsListActivity.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272             startActivity(editTagsIntent);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274 		case R.id.menu_create_note :</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275 			getNoteListFragment().addNote();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276 			return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277         case R.id.menu_share:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278             if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279                 Intent shareIntent = new Intent(android.content.Intent.ACTION_SEND);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280                 shareIntent.setType(&quot;text/plain&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281                 shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, mCurrentNote.getContent());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 282                 startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.share_note)));"> 282                 startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.share_nðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285         case R.id.menu_delete:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286             if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287                 if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288                     mCurrentNote.setDeleted(!mCurrentNote.isDeleted());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289                     mCurrentNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290                     mCurrentNote.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292                     if (mCurrentNote.isDeleted()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293                         mUndoBarController.setDeletedNote(mCurrentNote);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294                         mUndoBarController.showUndoBar(false, getString(R.string.note_deleted), null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297                 popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298                 NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299                 if (fragment!=null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300                     fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301                     fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305         case R.id.menu_empty_trash:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306             AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308             alert.setTitle(R.string.empty_trash);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309             alert.setMessage(R.string.confirm_empty_trash);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310             alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311                 public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312                     new emptyTrashTask().execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315             alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316                 public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317                     // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320             alert.show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322         case android.R.id.home:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323             popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324             invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326 		default :</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327 			return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331     protected void popNoteDetail() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332         mCurrentNote = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334         NoteEditorFragment f = (NoteEditorFragment) fm.findFragmentById(R.id.note_editor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335         if (f == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336             try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337                 fm.popBackStack();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338             } catch (Exception e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339                 e.printStackTrace();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345 	 * Callback method from {@link NoteListFragment.Callbacks} indicating that</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346 	 * the item with the given ID was selected.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349 	public void onNoteSelected(Note note) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351         if (mSearchMenuItem != null)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352             mSearchMenuItem.collapseActionView();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354         mCurrentNote = note;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355 		String noteKey = note == null ? &quot;none&quot; : note.getSimperiumKey();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358         NoteEditorFragment f = getNoteEditorFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360         if (f == null || !f.isInLayout()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362             ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363             ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365             // Create editor fragment</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366             Bundle arguments = new Bundle();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367             arguments.putString(NoteEditorFragment.ARG_ITEM_ID, noteKey);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368             f = new NoteEditorFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369             f.setArguments(arguments);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370             mNoteEditorFragment = f;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372             // Add editor fragment to stack</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373             FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 374             ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_and_fade, R.animator.slide_out);"> 374             ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 375             ft.replace(R.id.noteFragmentContainer, f);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 376             ft.addToBackStack(null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377             ft.commit();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 378             fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 380             f.setNote(note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 381             getNoteListFragment().setNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388 	public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389 		// TODO Auto-generated method stub</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390 		return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394 	public void onAuthenticationStatusChange(User.AuthenticationStatus status){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395 		if ( status == User.AuthenticationStatus.NOT_AUTHENTICATED ) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396 			startLoginActivity();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400 	public void startLoginActivity(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401 		Intent loginIntent = new Intent(this, LoginActivity.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402 		startActivityForResult(loginIntent, Simperium.SIGNUP_SIGNIN_REQUEST);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405 	</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407 	protected void onActivityResult(int requestCode, int resultCode, Intent data) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408 		super.onActivityResult(requestCode, resultCode, data);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409 		switch (requestCode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410 		case Simperium.SIGNUP_SIGNIN_REQUEST :</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411 			if (resultCode == RESULT_CANCELED) </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412 				 finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414 		case Simplenote.INTENT_PREFERENCES :</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415 			// nbradbury - refresh note list when user returns from preferences (in case they changed anything)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416 			NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417 			if (fragment!=null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418 				fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419 				fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420 			}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426     public void onUndo(Parcelable p) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427         if (mUndoBarController != null &amp;&amp; mUndoBarController.getDeletedNote() != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428             Note deletedNote = mUndoBarController.getDeletedNote();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429             if (deletedNote != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430                 deletedNote.setDeleted(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431                 deletedNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432                 deletedNote.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433                 NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434                 if (fragment!=null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435                     fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436                     fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443     public void onBackStackChanged() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445         configureActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450      * If a note is changed that is being displayed in the NoteEditorFragment, update its content</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451      * @param note</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453     public void onNoteChanged(Note note) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454         if (mCurrentNote != null &amp;&amp; mNoteEditorFragment != null &amp;&amp; mNoteEditorFragment.isVisible()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455             if (note.getSimperiumKey().equals(mCurrentNote.getSimperiumKey())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456                 if (note.isDeleted())</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457                     popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458                 else</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459                     mNoteEditorFragment.setNote(note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464     private void configureActionBar() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465         if (getFragmentManager().getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467             ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468             ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471             ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472             ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477     public void onConfigurationChanged(Configuration newConfig) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478         super.onConfigurationChanged(newConfig);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480         // If we are on a tablet, we will restart the activity to adjust the layout accordingly</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481         if ((getBaseContext().getResources().getConfiguration().screenLayout</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482                 &amp; Configuration.SCREENLAYOUT_SIZE_MASK)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483                 &gt;= Configuration.SCREENLAYOUT_SIZE_LARGE) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484             finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485             startActivity(getIntent());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 489     private class emptyTrashTask extends AsyncTask&lt;Void, Void, Void&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 490 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 491         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 492         protected Void doInBackground(Void... voids) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 493             Simplenote application = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 494             Bucket&lt;Note&gt; noteBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 495             Query&lt;Note&gt; query = Note.allDeleted(noteBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 496             Bucket.ObjectCursor c = query.execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497             while (c.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498                 c.getObject().delete();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500             return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 502     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 503 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 504 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 505 </span>
 506 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509 import android.app.ActionBar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511 import android.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512 import android.app.FragmentManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513 import android.app.FragmentTransaction;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515 import android.content.Intent;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516 import android.content.res.Configuration;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517 import android.os.AsyncTask;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519 import android.os.Parcelable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520 import android.view.Menu;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521 import android.view.MenuInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522 import android.view.MenuItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523 import android.widget.SearchView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526 import com.automattic.simplenote.utils.UndoBarController;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527 import com.simperium.Simperium;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529 import com.simperium.client.LoginActivity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531 import com.simperium.client.User;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 536  * An activity representing a list of Notes.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 537  * &lt;p/&gt;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 538  * The activity makes heavy use of fragments. The list of items is a</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 539  * {@link NoteListFragment} and the item details (if present) is a</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 540  * {@link NoteEditorFragment}.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 541  * &lt;p/&gt;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542  * This activity also implements the required {@link NoteListFragment.Callbacks}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543  * interface to listen for item selections.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545 public class NotesActivity extends Activity implements</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 546         NoteListFragment.Callbacks, ActionBar.OnNavigationListener,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 547         User.AuthenticationListener, UndoBarController.UndoListener,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 548         FragmentManager.OnBackStackChangedListener, Bucket.Listener&lt;Note&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 549 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550     private boolean mIsLargeScreen, mIsLandscape;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551     private UndoBarController mUndoBarController;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 552     private SearchView mSearchView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 553     private MenuItem mSearchMenuItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 554     private NoteListFragment mNoteListFragment;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 555     private NoteEditorFragment mNoteEditorFragment;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 556     private Note mCurrentNote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 557     private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 558     private int TRASH_SELECTED_ID = 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 559 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 560     public static String TAG_NOTE_LIST = &quot;noteList&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 561     public static String TAG_NOTE_EDITOR = &quot;noteEditor&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 562 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 563     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 564     protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 565         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 566         Simplenote currentApp = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 567         mNotesBucket = currentApp.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 568         setContentView(R.layout.activity_notes);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 569 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 570         if (savedInstanceState == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 571             mNoteListFragment = new NoteListFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 572             FragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 573             fragmentTransaction.add(R.id.noteFragmentContainer, mNoteListFragment, TAG_NOTE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 574             fragmentTransaction.commit();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 575         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 576             mNoteListFragment = (NoteListFragment) getFragmentManager().findFragmentByTag(TAG_NOTE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 577         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 578 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 579 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 580         Configuration config = getBaseContext().getResources().getConfiguration();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 581         if ((config.screenLayout</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 582                 &amp; Configuration.SCREENLAYOUT_SIZE_MASK)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 583                 &gt;= Configuration.SCREENLAYOUT_SIZE_LARGE) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 584             mIsLargeScreen = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 585 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 586             if (getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR) != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 587                 mNoteEditorFragment = (NoteEditorFragment) getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR);"> 587                 mNoteEditorFragment = (NoteEditorFragment) getFragmentManager().findFragmentByTag(TAG_NOTðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 588             } else if (config.orientation == Configuration.ORIENTATION_LANDSCAPE) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 589                 mIsLandscape = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 590                 addEditorFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 591             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 592         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 593 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 594         ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 595         ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 596         ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 597 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 598         mUndoBarController = new UndoBarController(findViewById(R.id.undobar), this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 599 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 600         getFragmentManager().addOnBackStackChangedListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 601 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 602         if (currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAuthentication()) {"> 602         if (currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAutheðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 603             startLoginActivity();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 604         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 605         currentApp.getSimperium().setAuthenticationListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 606 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 607         if (Intent.ACTION_SEND.equals(getIntent().getAction())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 608             // Check share action</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 609             Intent intent = getIntent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 610             String text = intent.getStringExtra(Intent.EXTRA_TEXT);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 611             if (text != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 612                 Note note = mNotesBucket.newObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 613                 note.setContent(text);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 614                 note.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 615                 onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 616             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 617         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 618     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 619 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 620     private void addEditorFragment() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 621         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 622         FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 623         mNoteEditorFragment = new NoteEditorFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 624         ft.add(R.id.noteFragmentContainer, mNoteEditorFragment, TAG_NOTE_EDITOR);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 625         ft.commit();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 626         fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 627     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 628 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 629     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 630     protected void onResume() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 631         super.onResume();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 632 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 633         mNotesBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 634         mNotesBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 635         mNotesBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 636 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 637         configureActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 638         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 639     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 640 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 641     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 642     protected void onPause() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 643         super.onPause();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 644 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 645         mNotesBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 646         mNotesBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 647         mNotesBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 648 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 649     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 650 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 651     // received a change from the network, refresh the list and the editor</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 652     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 653     public void onChange(Bucket&lt;Note&gt; bucket, Bucket.ChangeType type, String key) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 654         final boolean resetEditor = mCurrentNote != null &amp;&amp; mCurrentNote.getSimperiumKey().equals(key);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 655         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 656             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 657             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 658                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 659                 if (!resetEditor) return;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 660                 if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 661                     mNoteEditorFragment.refreshContent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 662                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 663             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 664         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 665     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 666 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 667     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 668     public void onSaveObject(Bucket&lt;Note&gt; bucket, Note object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 669         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 670             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 671             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 672                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 673             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 674         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 675     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 676 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 677     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 678     public void onDeleteObject(Bucket&lt;Note&gt; bucket, Note object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 679         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 680             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 681             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 682                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 683             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 684         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 685     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 686 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 687     public boolean isLargeScreen() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 688         return mIsLargeScreen;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 689     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 690 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 691     public boolean isLargeScreenLandscape() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 692         return mIsLargeScreen &amp;&amp; mIsLandscape;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 693     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 694 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 695     // nbradbury 01-Apr-2013</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 696     private NoteListFragment getNoteListFragment() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 697         return mNoteListFragment;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 698     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 699 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 700     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 701     public boolean onCreateOptionsMenu(Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 702         super.onCreateOptionsMenu(menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 703         MenuInflater inflater = getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 704         inflater.inflate(R.menu.notes_list, menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 705 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 706         mSearchMenuItem = menu.findItem(R.id.menu_search);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 707         mSearchView = (SearchView) mSearchMenuItem.getActionView();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 708         mSearchView.setOnQueryTextListener(new SearchView.OnQueryTextListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 709             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 710             public boolean onQueryTextChange(String newText) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711                 if (newText != null &amp;&amp; mSearchMenuItem.isActionViewExpanded())</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712                     getNoteListFragment().searchNotes(newText);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 713                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 714             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 715 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 716             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 717             public boolean onQueryTextSubmit(String queryText) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 718                 if (queryText != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 719                     getNoteListFragment().searchNotes(queryText);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 720                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 721             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 722         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 723         mSearchMenuItem.setOnActionExpandListener(new MenuItem.OnActionExpandListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 724             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 725             public boolean onMenuItemActionExpand(MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 726                 showDetailPlaceholder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 727                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 728             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 729 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 730             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 731             public boolean onMenuItemActionCollapse(MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 732                 // Show all notes again</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 733                 getNoteListFragment().clearSearch();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 734                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 735             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 736         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 737 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 738         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 739         if (fm.getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 740             getActionBar().setDisplayHomeAsUpEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 741             menu.findItem(R.id.menu_create_note).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 742             menu.findItem(R.id.menu_search).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 743             menu.findItem(R.id.menu_preferences).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 744             menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 745             menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 746             if (mCurrentNote != null &amp;&amp; mCurrentNote.isDeleted())</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 747                 menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 748             menu.findItem(R.id.menu_edit_tags).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 749             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 750         } else if (isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 751             getActionBar().setDisplayHomeAsUpEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 752             getActionBar().setHomeButtonEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 753             menu.findItem(R.id.menu_create_note).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 754             menu.findItem(R.id.menu_search).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 755             menu.findItem(R.id.menu_preferences).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 756             if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 757                 menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 758                 menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 759             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 760                 menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 761                 menu.findItem(R.id.menu_delete).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 762             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 763             menu.findItem(R.id.menu_edit_tags).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 764             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 765         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 766             getActionBar().setDisplayHomeAsUpEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 767             getActionBar().setHomeButtonEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 768             menu.findItem(R.id.menu_create_note).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 769             menu.findItem(R.id.menu_search).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 770             menu.findItem(R.id.menu_preferences).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 771             menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 772             menu.findItem(R.id.menu_delete).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 773             menu.findItem(R.id.menu_edit_tags).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 774             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 775         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 776 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 777         // Are we looking at the trash? Adjust menu accordingly.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 778         if (getActionBar().getSelectedNavigationIndex() == TRASH_SELECTED_ID) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 779             menu.findItem(R.id.menu_empty_trash).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 780             menu.findItem(R.id.menu_create_note).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 781             menu.findItem(R.id.menu_search).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 782             menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 783         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 784 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 785         return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 786     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 787 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 788     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 789     public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 790         switch (item.getItemId()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 791             case R.id.menu_preferences:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 792                 // nbradbury - use startActivityForResult so onActivityResult can detect when user returns from preferences"> 792                 // nbradbury - use startActivityForResult so onActivityResult can detect when user returnðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 793                 Intent i = new Intent(this, PreferencesActivity.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 794                 startActivityForResult(i, Simplenote.INTENT_PREFERENCES);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 795                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 796             case R.id.menu_edit_tags:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 797                 Intent editTagsIntent = new Intent(this, TagsListActivity.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 798                 startActivity(editTagsIntent);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 799                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 800             case R.id.menu_create_note:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 801                 getNoteListFragment().addNote();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 802                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 803             case R.id.menu_share:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 804                 if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 805                     Intent shareIntent = new Intent(android.content.Intent.ACTION_SEND);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 806                     shareIntent.setType(&quot;text/plain&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 807                     shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, mCurrentNote.getContent());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 808                     startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.share_note)));"> 808                     startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.shaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 809                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 810                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 811             case R.id.menu_delete:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 812                 if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 813                     if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 814                         mCurrentNote.setDeleted(!mCurrentNote.isDeleted());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 815                         mCurrentNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 816                         mCurrentNote.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 817 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 818                         if (mCurrentNote.isDeleted()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 819                             mUndoBarController.setDeletedNote(mCurrentNote);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 820                             mUndoBarController.showUndoBar(false, getString(R.string.note_deleted), null);"> 820                             mUndoBarController.showUndoBar(false, getString(R.string.note_deleted), null)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 821                         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 822                         showDetailPlaceholder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 823                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 824                     popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 825                     NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 826                     if (fragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 827                         fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 828                         fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 829                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 830                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 831                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 832             case R.id.menu_empty_trash:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 833                 AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 834 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 835                 alert.setTitle(R.string.empty_trash);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 836                 alert.setMessage(R.string.confirm_empty_trash);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 837                 alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 838                     public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 839                         new emptyTrashTask().execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 840                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 841                 });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 842                 alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 843                     public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 844                         // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 845                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 846                 });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 847                 alert.show();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 848                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 849             case android.R.id.home:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 850                 popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 851                 invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 852                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 853             default:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 854                 return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 855         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 856     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 857 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 858     protected void popNoteDetail() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 859         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 860         if (fm.getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 861             try {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 862                 fm.popBackStack();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 863             } catch (Exception e) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 864                 e.printStackTrace();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 865             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 866         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 867     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 868 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 869     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 870      * Callback method from {@link NoteListFragment.Callbacks} indicating that</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 871      * the item with the given ID was selected.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 872      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 873     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 874     public void onNoteSelected(Note note) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 875 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 876         if (mSearchMenuItem != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 877             mSearchMenuItem.collapseActionView();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 878 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 879         mCurrentNote = note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 880         String noteKey = note == null ? &quot;none&quot; : note.getSimperiumKey();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 881 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 882         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 883 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 884         if (!isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 885             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 886             ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 887             ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 888 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 889             // Create editor fragment</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 890             Bundle arguments = new Bundle();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 891             arguments.putString(NoteEditorFragment.ARG_ITEM_ID, noteKey);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 892             mNoteEditorFragment = new NoteEditorFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 893             mNoteEditorFragment.setArguments(arguments);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 894 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 895             // Add editor fragment to stack</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 896             FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 897             ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_and_fade, R.animator.slide_out);"> 897             ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 898             ft.replace(R.id.noteFragmentContainer, mNoteEditorFragment);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 899             ft.addToBackStack(null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 900             ft.commit();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 901             fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 902         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 903             mNoteEditorFragment.setNote(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 904             getNoteListFragment().setNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 905         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 906 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 907         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 908     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 909 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 910     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 911     public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 912         // TODO Auto-generated method stub</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 913         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 914     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 915 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 916 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 917     public void onAuthenticationStatusChange(User.AuthenticationStatus status) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 918         if (status == User.AuthenticationStatus.NOT_AUTHENTICATED) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 919             startLoginActivity();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 920         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 921     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 922 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 923     public void startLoginActivity() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 924         Intent loginIntent = new Intent(this, LoginActivity.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 925         startActivityForResult(loginIntent, Simperium.SIGNUP_SIGNIN_REQUEST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 926     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 927 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 928 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 929     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 930     protected void onActivityResult(int requestCode, int resultCode, Intent data) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 931         super.onActivityResult(requestCode, resultCode, data);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 932         switch (requestCode) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 933             case Simperium.SIGNUP_SIGNIN_REQUEST:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 934                 if (resultCode == RESULT_CANCELED)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 935                     finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 936                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 937             case Simplenote.INTENT_PREFERENCES:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 938                 // nbradbury - refresh note list when user returns from preferences (in case they changed anything)"> 938                 // nbradbury - refresh note list when user returns from preferences (in case they changedðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 939                 NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 940                 if (fragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 941                     fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 942                     fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 943                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 944                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 945         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 946     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 947 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 948     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 949     public void onUndo(Parcelable p) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 950         if (mUndoBarController != null &amp;&amp; mUndoBarController.getDeletedNote() != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 951             Note deletedNote = mUndoBarController.getDeletedNote();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 952             if (deletedNote != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 953                 deletedNote.setDeleted(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 954                 deletedNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 955                 deletedNote.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 956                 NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 957                 if (fragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 958                     fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 959                     fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 960                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 961             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 962         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 963     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 964 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 965     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 966     public void onBackStackChanged() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 967         configureActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 968         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 969     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 970 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 971     private void configureActionBar() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 972         if (getFragmentManager().getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 973             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 974             if (ab != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 975                 ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 976                 ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 977             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 978         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 979             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 980             if (ab != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 981                 ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 982                 ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 983             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 984         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 985     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 986 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 987     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 988     public void onConfigurationChanged(Configuration newConfig) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 989         super.onConfigurationChanged(newConfig);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 990 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 991         if (mIsLargeScreen) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 992             if (newConfig.orientation == Configuration.ORIENTATION_LANDSCAPE) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 993                 // Add the editor fragment</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 994                 mIsLandscape = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 995                 popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 996                 addEditorFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 997                 if (mNoteListFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 998                     mNoteListFragment.setActivateOnItemClick(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 999                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1000                 // Select the current note on a tablet</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1001                 if (mCurrentNote != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1002                     onNoteSelected(mCurrentNote);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1003                 invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="1004             } else if (newConfig.orientation == Configuration.ORIENTATION_PORTRAIT &amp;&amp; mNoteEditorFragment != null) {">1004             } else if (newConfig.orientation == Configuration.ORIENTATION_PORTRAIT &amp;&amp; mNoteEditorFragmentðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1005                 // Remove the editor fragment when rotating back to portrait</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1006                 mIsLandscape = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1007                 mCurrentNote = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1008                 if (mNoteListFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1009                     mNoteListFragment.setActivateOnItemClick(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1010                     mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1011                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1012                 FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1013                 FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1014                 ft.remove(mNoteEditorFragment);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1015                 mNoteEditorFragment = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1016                 ft.commit();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1017                 fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1018                 invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1019             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1020         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1021     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1022 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1023     public void showDetailPlaceholder() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1024         if (isLargeScreenLandscape() &amp;&amp; mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1025             mCurrentNote = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1026             invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1027             mNoteEditorFragment.setPlaceholderVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1028         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1029     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1030 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1031     private class emptyTrashTask extends AsyncTask&lt;Void, Void, Void&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1032 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1033         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1034         protected Void doInBackground(Void... voids) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1035             Simplenote application = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1036             Bucket&lt;Note&gt; noteBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1037             Query&lt;Note&gt; query = Note.allDeleted(noteBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1038             Bucket.ObjectCursor c = query.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1039             while (c.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1040                 c.getObject().delete();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1041             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1042             return null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1043         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1044     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1045 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1046 }</span>
1047 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import android.app.ActionBar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 import android.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import android.app.FragmentManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import android.app.FragmentTransaction;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import android.content.Intent;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 import android.content.res.Configuration;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import android.os.AsyncTask;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import android.os.Parcelable;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 import android.view.Menu;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 import android.view.MenuInflater;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 import android.view.MenuItem;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 import android.widget.SearchView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import com.automattic.simplenote.utils.UndoBarController;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import com.simperium.Simperium;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import com.simperium.client.LoginActivity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 import com.simperium.client.User;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32  * An activity representing a list of Notes.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33  * &lt;p&gt;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34  * The activity makes heavy use of fragments. The list of items is a</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35  * {@link NoteListFragment} and the item details (if present) is a</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36  * {@link NoteEditorFragment}.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37  * &lt;p&gt;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38  * This activity also implements the required {@link NoteListFragment.Callbacks}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39  * interface to listen for item selections.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40  */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 public class NotesActivity extends Activity implements</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42 		NoteListFragment.Callbacks, ActionBar.OnNavigationListener,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43         User.AuthenticationListener, UndoBarController.UndoListener,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44         FragmentManager.OnBackStackChangedListener, Bucket.Listener&lt;Note&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 	 * Whether or not the activity is in two-pane mode, i.e. running on a tablet</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48 	 * device.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50 	private boolean mTwoPane;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51     private UndoBarController mUndoBarController;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52     private SearchView mSearchView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53     private MenuItem mSearchMenuItem;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54     private NoteListFragment mNoteListFragment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55     private NoteEditorFragment mNoteEditorFragment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56     private Note mCurrentNote;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57     private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58     private int TRASH_SELECTED_ID = 1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 	protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62 		super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63         Simplenote currentApp = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64         mNotesBucket = currentApp.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65 		setContentView(R.layout.activity_notes);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67 		int orientation = getResources().getConfiguration().orientation;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68 		if (getNoteEditorFragment() != null &amp;&amp; orientation == Configuration.ORIENTATION_LANDSCAPE ) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69 			mTwoPane = true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70 			// In two-pane mode, list items should be given the</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71 			// &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  72             mNoteListFragment = ((NoteListFragment) getFragmentManager().findFragmentById(R.id.note_list));">  72             mNoteListFragment = ((NoteListFragment) getFragmentManager().findFragmentById(R.id.note_list)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73             mNoteListFragment.setActivateOnItemClick(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74             mNoteEditorFragment = getNoteEditorFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75 		} else if (savedInstanceState == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76             mNoteListFragment = new NoteListFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77             FragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78             fragmentTransaction.add(R.id.noteFragmentContainer, mNoteListFragment);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79             fragmentTransaction.commit();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  81             mNoteListFragment = (NoteListFragment)getFragmentManager().findFragmentById(R.id.noteFragmentContainer);">  81             mNoteListFragment = (NoteListFragment)getFragmentManager().findFragmentById(R.id.noteFragmentðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84         ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85         ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86         ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88         mUndoBarController = new UndoBarController(findViewById(R.id.undobar), this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90         getFragmentManager().addOnBackStackChangedListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  92 		if( currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAuthentication() ){">  92 		if( currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAuthenticatðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93 			startLoginActivity();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95 		currentApp.getSimperium().setAuthenticationListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97         if (Intent.ACTION_SEND.equals(getIntent().getAction())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98             // Check share action</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99             Intent intent = getIntent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100             String text = intent.getStringExtra(Intent.EXTRA_TEXT);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101             String title = intent.getStringExtra(Intent.EXTRA_SUBJECT);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102             if (text != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103                 Note note = mNotesBucket.newObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104                 note.setContent(text);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105                 note.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106                 onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112     protected void onResume() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113         super.onResume();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115         mNotesBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116         mNotesBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117         mNotesBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119         configureActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124     protected void onPause(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125         super.onPause();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127         mNotesBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128         mNotesBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129         mNotesBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133     // received a change from the network, refresh the list and the editor</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135     public void onChange(Bucket&lt;Note&gt; bucket, Bucket.ChangeType type, String key){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136         final boolean resetEditor = mCurrentNote != null &amp;&amp; mCurrentNote.getSimperiumKey().equals(key);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137         runOnUiThread(new Runnable(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138             @Override public void run(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140                 if (!resetEditor) return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141                 if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142                     mNoteEditorFragment.refreshContent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149     public void onSaveObject(Bucket&lt;Note&gt; bucket, Note object){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150         runOnUiThread(new Runnable(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151             @Override public void run(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158     public void onDeleteObject(Bucket&lt;Note&gt; bucket, Note object){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159         runOnUiThread(new Runnable(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160             @Override public void run(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166     public boolean isTwoPane() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167         return mTwoPane;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170     // nbradbury 01-Apr-2013</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171 	private NoteListFragment getNoteListFragment() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172 		return mNoteListFragment;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175     private NoteEditorFragment getNoteEditorFragment() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176         return ((NoteEditorFragment) getFragmentManager().findFragmentById(R.id.noteEditorFragment));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180 	public boolean onCreateOptionsMenu(Menu menu) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 181 		super.onCreateOptionsMenu(menu);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 182 		MenuInflater inflater = getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183 		inflater.inflate(R.menu.notes_list, menu);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185         mSearchMenuItem = menu.findItem(R.id.menu_search);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186         mSearchView = (SearchView) mSearchMenuItem.getActionView();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 187         mSearchView.setOnQueryTextListener(new SearchView.OnQueryTextListener( ) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189             public boolean onQueryTextChange(String newText) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190                 if (newText != null &amp;&amp; mSearchMenuItem.isActionViewExpanded())</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191                     getNoteListFragment().searchNotes(newText);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 193             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196             public boolean onQueryTextSubmit(String queryText) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197                 if (queryText != null)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198                     getNoteListFragment().searchNotes(queryText);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 199                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202         mSearchMenuItem.setOnActionExpandListener(new MenuItem.OnActionExpandListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 204             public boolean onMenuItemActionExpand(MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 206             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208             @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209             public boolean onMenuItemActionCollapse(MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210                 // Show all notes again</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211                 getNoteListFragment().clearSearch();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212                 return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214         });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217         if (fm.getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218             getActionBar().setDisplayHomeAsUpEnabled(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219             menu.findItem(R.id.menu_create_note).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 220             menu.findItem(R.id.menu_search).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 221             menu.findItem(R.id.menu_preferences).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 222             menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 223             menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 224             if (mCurrentNote != null &amp;&amp; mCurrentNote.isDeleted())</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 225                 menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 226             menu.findItem(R.id.menu_edit_tags).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 227             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 228         } else if (mTwoPane) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 229             getActionBar().setDisplayHomeAsUpEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 230             getActionBar().setHomeButtonEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 231             menu.findItem(R.id.menu_create_note).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 232             menu.findItem(R.id.menu_search).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 233             menu.findItem(R.id.menu_preferences).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 234             menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 235             menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 236             menu.findItem(R.id.menu_edit_tags).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 237             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 238 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 239         } else  {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 240             getActionBar().setDisplayHomeAsUpEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 241             getActionBar().setHomeButtonEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 242             menu.findItem(R.id.menu_create_note).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 243             menu.findItem(R.id.menu_search).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 244             menu.findItem(R.id.menu_preferences).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 245             menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 246             menu.findItem(R.id.menu_delete).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 247             menu.findItem(R.id.menu_edit_tags).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 248             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 249         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 250 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 251         // Are we looking at the trash? Adjust menu accordingly.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 252         if (getActionBar().getSelectedNavigationIndex() == TRASH_SELECTED_ID) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 253             menu.findItem(R.id.menu_empty_trash).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 254             menu.findItem(R.id.menu_create_note).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 255             menu.findItem(R.id.menu_search).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 256             menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 257         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 258 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 259 		return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 260 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 261 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 262 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 263 	public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 264 		switch (item.getItemId()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 265 		case R.id.menu_preferences :</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 266 			// nbradbury - use startActivityForResult so onActivityResult can detect when user returns from preferences"> 266 			// nbradbury - use startActivityForResult so onActivityResult can detect when user returns from preferðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 267 			Intent i = new Intent(this, PreferencesActivity.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 268 			startActivityForResult(i, Simplenote.INTENT_PREFERENCES);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 269 			return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 270         case R.id.menu_edit_tags :</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 271             Intent editTagsIntent = new Intent(this, TagsListActivity.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 272             startActivity(editTagsIntent);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 273             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 274 		case R.id.menu_create_note :</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 275 			getNoteListFragment().addNote();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 276 			return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 277         case R.id.menu_share:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 278             if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 279                 Intent shareIntent = new Intent(android.content.Intent.ACTION_SEND);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 280                 shareIntent.setType(&quot;text/plain&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 281                 shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, mCurrentNote.getContent());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 282                 startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.share_note)));"> 282                 startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.share_nðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 283             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 284             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 285         case R.id.menu_delete:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 286             if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 287                 if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 288                     mCurrentNote.setDeleted(!mCurrentNote.isDeleted());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 289                     mCurrentNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 290                     mCurrentNote.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 291 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 292                     if (mCurrentNote.isDeleted()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 293                         mUndoBarController.setDeletedNote(mCurrentNote);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 294                         mUndoBarController.showUndoBar(false, getString(R.string.note_deleted), null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 295                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 296                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 297                 popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 298                 NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 299                 if (fragment!=null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 300                     fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 301                     fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 302                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 303             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 304             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 305         case R.id.menu_empty_trash:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 306             AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 307 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 308             alert.setTitle(R.string.empty_trash);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 309             alert.setMessage(R.string.confirm_empty_trash);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 310             alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 311                 public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 312                     new emptyTrashTask().execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 313                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 314             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 315             alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 316                 public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 317                     // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 318                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 319             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 320             alert.show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 321             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 322         case android.R.id.home:</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 323             popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 324             invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 325             return true;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 326 		default :</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 327 			return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 328 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 329 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 330 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 331     protected void popNoteDetail() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 332         mCurrentNote = null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 333         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 334         NoteEditorFragment f = (NoteEditorFragment) fm.findFragmentById(R.id.note_editor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 335         if (f == null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 336             try {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 337                 fm.popBackStack();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 338             } catch (Exception e) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 339                 e.printStackTrace();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 340             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 341         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 342     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 343 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 344 	/**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 345 	 * Callback method from {@link NoteListFragment.Callbacks} indicating that</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 346 	 * the item with the given ID was selected.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 347 	 */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 348 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 349 	public void onNoteSelected(Note note) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 350 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 351         if (mSearchMenuItem != null)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 352             mSearchMenuItem.collapseActionView();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 353 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 354         mCurrentNote = note;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 355 		String noteKey = note == null ? &quot;none&quot; : note.getSimperiumKey();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 356 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 357         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 358         NoteEditorFragment f = getNoteEditorFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 359 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 360         if (f == null || !f.isInLayout()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 361             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 362             ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 363             ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 364 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 365             // Create editor fragment</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 366             Bundle arguments = new Bundle();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 367             arguments.putString(NoteEditorFragment.ARG_ITEM_ID, noteKey);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 368             f = new NoteEditorFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 369             f.setArguments(arguments);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 370             mNoteEditorFragment = f;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 371 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 372             // Add editor fragment to stack</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 373             FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 374             ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_and_fade, R.animator.slide_out);"> 374             ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 375             ft.replace(R.id.noteFragmentContainer, f);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 376             ft.addToBackStack(null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 377             ft.commit();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 378             fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 379         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 380             f.setNote(note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 381             getNoteListFragment().setNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 382         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 383 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 384         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 385 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 386 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 387 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 388 	public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 389 		// TODO Auto-generated method stub</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 390 		return false;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 391 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 392 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 393 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 394 	public void onAuthenticationStatusChange(User.AuthenticationStatus status){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 395 		if ( status == User.AuthenticationStatus.NOT_AUTHENTICATED ) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 396 			startLoginActivity();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 397 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 398 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 399 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 400 	public void startLoginActivity(){</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 401 		Intent loginIntent = new Intent(this, LoginActivity.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 402 		startActivityForResult(loginIntent, Simperium.SIGNUP_SIGNIN_REQUEST);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 403 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 404 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 405 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 406 	@Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 407 	protected void onActivityResult(int requestCode, int resultCode, Intent data) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 408 		super.onActivityResult(requestCode, resultCode, data);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 409 		switch (requestCode) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 410 		case Simperium.SIGNUP_SIGNIN_REQUEST :</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 411 			if (resultCode == RESULT_CANCELED)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 412 				 finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 413 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 414 		case Simplenote.INTENT_PREFERENCES :</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 415 			// nbradbury - refresh note list when user returns from preferences (in case they changed anything)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 416 			NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 417 			if (fragment!=null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 418 				fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 419 				fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 420 			}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 421 			break;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 422 		}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 423 	}</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 424 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 425     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 426     public void onUndo(Parcelable p) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 427         if (mUndoBarController != null &amp;&amp; mUndoBarController.getDeletedNote() != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 428             Note deletedNote = mUndoBarController.getDeletedNote();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 429             if (deletedNote != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 430                 deletedNote.setDeleted(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 431                 deletedNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 432                 deletedNote.save();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 433                 NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 434                 if (fragment!=null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 435                     fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 436                     fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 437                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 438             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 439         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 440     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 441 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 442     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 443     public void onBackStackChanged() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 444 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 445         configureActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 446         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 447     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 448 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 449     /**</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 450      * If a note is changed that is being displayed in the NoteEditorFragment, update its content</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 451      * @param note</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 452      */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 453     public void onNoteChanged(Note note) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 454         if (mCurrentNote != null &amp;&amp; mNoteEditorFragment != null &amp;&amp; mNoteEditorFragment.isVisible()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 455             if (note.getSimperiumKey().equals(mCurrentNote.getSimperiumKey())) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 456                 if (note.isDeleted())</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 457                     popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 458                 else</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 459                     mNoteEditorFragment.setNote(note);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 460             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 461         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 462     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 463 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 464     private void configureActionBar() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 465         if (getFragmentManager().getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 466             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 467             ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 468             ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 469         } else {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 470             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 471             ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 472             ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 473         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 474     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 475 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 476     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 477     public void onConfigurationChanged(Configuration newConfig) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 478         super.onConfigurationChanged(newConfig);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 479 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 480         // If we are on a tablet, we will restart the activity to adjust the layout accordingly</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 481         if ((getBaseContext().getResources().getConfiguration().screenLayout</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 482                 &amp; Configuration.SCREENLAYOUT_SIZE_MASK)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 483                 &gt;= Configuration.SCREENLAYOUT_SIZE_LARGE) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 484             finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 485             startActivity(getIntent());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 486         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 487     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 488 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 489     private class emptyTrashTask extends AsyncTask&lt;Void, Void, Void&gt; {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 490 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 491         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 492         protected Void doInBackground(Void... voids) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 493             Simplenote application = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 494             Bucket&lt;Note&gt; noteBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 495             Query&lt;Note&gt; query = Note.allDeleted(noteBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 496             Bucket.ObjectCursor c = query.execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 497             while (c.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 498                 c.getObject().delete();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 499             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 500             return null;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 501         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 502     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 503 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 504 }</span>
 505 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508 import android.app.ActionBar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510 import android.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511 import android.app.FragmentManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512 import android.app.FragmentTransaction;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514 import android.content.Intent;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515 import android.content.res.Configuration;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516 import android.os.AsyncTask;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518 import android.os.Parcelable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519 import android.view.Menu;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520 import android.view.MenuInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521 import android.view.MenuItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522 import android.widget.SearchView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525 import com.automattic.simplenote.utils.UndoBarController;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526 import com.simperium.Simperium;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528 import com.simperium.client.LoginActivity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530 import com.simperium.client.User;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535  * An activity representing a list of Notes.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 536  * &lt;p/&gt;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 537  * The activity makes heavy use of fragments. The list of items is a</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 538  * {@link NoteListFragment} and the item details (if present) is a</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 539  * {@link NoteEditorFragment}.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 540  * &lt;p/&gt;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 541  * This activity also implements the required {@link NoteListFragment.Callbacks}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542  * interface to listen for item selections.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544 public class NotesActivity extends Activity implements</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545         NoteListFragment.Callbacks, ActionBar.OnNavigationListener,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 546         User.AuthenticationListener, UndoBarController.UndoListener,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 547         FragmentManager.OnBackStackChangedListener, Bucket.Listener&lt;Note&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 548 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 549     private boolean mIsLargeScreen, mIsLandscape;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 550     private UndoBarController mUndoBarController;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 551     private SearchView mSearchView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 552     private MenuItem mSearchMenuItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 553     private NoteListFragment mNoteListFragment;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 554     private NoteEditorFragment mNoteEditorFragment;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 555     private Note mCurrentNote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 556     private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 557     private int TRASH_SELECTED_ID = 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 558 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 559     public static String TAG_NOTE_LIST = &quot;noteList&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 560     public static String TAG_NOTE_EDITOR = &quot;noteEditor&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 561 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 562     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 563     protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 564         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 565         Simplenote currentApp = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 566         mNotesBucket = currentApp.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 567         setContentView(R.layout.activity_notes);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 568 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 569         if (savedInstanceState == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 570             mNoteListFragment = new NoteListFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 571             FragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 572             fragmentTransaction.add(R.id.noteFragmentContainer, mNoteListFragment, TAG_NOTE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 573             fragmentTransaction.commit();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 574         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 575             mNoteListFragment = (NoteListFragment) getFragmentManager().findFragmentByTag(TAG_NOTE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 576         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 577 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 578 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 579         Configuration config = getBaseContext().getResources().getConfiguration();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 580         if ((config.screenLayout</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 581                 &amp; Configuration.SCREENLAYOUT_SIZE_MASK)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 582                 &gt;= Configuration.SCREENLAYOUT_SIZE_LARGE) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 583             mIsLargeScreen = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 584 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 585             if (getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR) != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 586                 mNoteEditorFragment = (NoteEditorFragment) getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR);"> 586                 mNoteEditorFragment = (NoteEditorFragment) getFragmentManager().findFragmentByTag(TAG_NOTðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 587             } else if (config.orientation == Configuration.ORIENTATION_LANDSCAPE) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 588                 mIsLandscape = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 589                 addEditorFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 590             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 591         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 592 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 593         ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 594         ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 595         ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 596 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 597         mUndoBarController = new UndoBarController(findViewById(R.id.undobar), this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 598 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 599         getFragmentManager().addOnBackStackChangedListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 600 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 601         if (currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAuthentication()) {"> 601         if (currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAutheðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 602             startLoginActivity();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 603         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 604         currentApp.getSimperium().setAuthenticationListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 605 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 606         if (Intent.ACTION_SEND.equals(getIntent().getAction())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 607             // Check share action</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 608             Intent intent = getIntent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 609             String text = intent.getStringExtra(Intent.EXTRA_TEXT);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 610             if (text != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 611                 Note note = mNotesBucket.newObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 612                 note.setContent(text);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 613                 note.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 614                 onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 615             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 616         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 617     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 618 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 619     private void addEditorFragment() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 620         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 621         FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 622         mNoteEditorFragment = new NoteEditorFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 623         ft.add(R.id.noteFragmentContainer, mNoteEditorFragment, TAG_NOTE_EDITOR);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 624         ft.commit();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 625         fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 626     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 627 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 628     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 629     protected void onResume() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 630         super.onResume();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 631 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 632         mNotesBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 633         mNotesBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 634         mNotesBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 635 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 636         configureActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 637         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 638     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 639 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 640     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 641     protected void onPause() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 642         super.onPause();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 643 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 644         mNotesBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 645         mNotesBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 646         mNotesBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 647 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 648     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 649 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 650     // received a change from the network, refresh the list and the editor</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 651     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 652     public void onChange(Bucket&lt;Note&gt; bucket, Bucket.ChangeType type, String key) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 653         final boolean resetEditor = mCurrentNote != null &amp;&amp; mCurrentNote.getSimperiumKey().equals(key);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 654         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 655             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 656             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 657                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 658                 if (!resetEditor) return;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 659                 if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 660                     mNoteEditorFragment.refreshContent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 661                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 662             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 663         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 664     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 665 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 666     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 667     public void onSaveObject(Bucket&lt;Note&gt; bucket, Note object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 668         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 669             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 670             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 671                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 672             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 673         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 674     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 675 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 676     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 677     public void onDeleteObject(Bucket&lt;Note&gt; bucket, Note object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 678         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 679             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 680             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 681                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 682             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 683         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 684     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 685 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 686     public boolean isLargeScreen() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 687         return mIsLargeScreen;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 688     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 689 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 690     public boolean isLargeScreenLandscape() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 691         return mIsLargeScreen &amp;&amp; mIsLandscape;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 692     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 693 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 694     // nbradbury 01-Apr-2013</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 695     private NoteListFragment getNoteListFragment() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 696         return mNoteListFragment;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 697     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 698 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 699     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 700     public boolean onCreateOptionsMenu(Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 701         super.onCreateOptionsMenu(menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 702         MenuInflater inflater = getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 703         inflater.inflate(R.menu.notes_list, menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 704 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 705         mSearchMenuItem = menu.findItem(R.id.menu_search);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 706         mSearchView = (SearchView) mSearchMenuItem.getActionView();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 707         mSearchView.setOnQueryTextListener(new SearchView.OnQueryTextListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 708             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 709             public boolean onQueryTextChange(String newText) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 710                 if (newText != null &amp;&amp; mSearchMenuItem.isActionViewExpanded())</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 711                     getNoteListFragment().searchNotes(newText);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 712                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 713             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 714 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 715             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 716             public boolean onQueryTextSubmit(String queryText) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 717                 if (queryText != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 718                     getNoteListFragment().searchNotes(queryText);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 719                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 720             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 721         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 722         mSearchMenuItem.setOnActionExpandListener(new MenuItem.OnActionExpandListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 723             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 724             public boolean onMenuItemActionExpand(MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 725                 showDetailPlaceholder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 726                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 727             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 728 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 729             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 730             public boolean onMenuItemActionCollapse(MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 731                 // Show all notes again</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 732                 getNoteListFragment().clearSearch();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 733                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 734             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 735         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 736 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 737         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 738         if (fm.getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 739             getActionBar().setDisplayHomeAsUpEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 740             menu.findItem(R.id.menu_create_note).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 741             menu.findItem(R.id.menu_search).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 742             menu.findItem(R.id.menu_preferences).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 743             menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 744             menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 745             if (mCurrentNote != null &amp;&amp; mCurrentNote.isDeleted())</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 746                 menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 747             menu.findItem(R.id.menu_edit_tags).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 748             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 749         } else if (isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 750             getActionBar().setDisplayHomeAsUpEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 751             getActionBar().setHomeButtonEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 752             menu.findItem(R.id.menu_create_note).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 753             menu.findItem(R.id.menu_search).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 754             menu.findItem(R.id.menu_preferences).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 755             if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 756                 menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 757                 menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 758             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 759                 menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 760                 menu.findItem(R.id.menu_delete).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 761             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 762             menu.findItem(R.id.menu_edit_tags).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 763             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 764         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 765             getActionBar().setDisplayHomeAsUpEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 766             getActionBar().setHomeButtonEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 767             menu.findItem(R.id.menu_create_note).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 768             menu.findItem(R.id.menu_search).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 769             menu.findItem(R.id.menu_preferences).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 770             menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 771             menu.findItem(R.id.menu_delete).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 772             menu.findItem(R.id.menu_edit_tags).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 773             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 774         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 775 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 776         // Are we looking at the trash? Adjust menu accordingly.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 777         if (getActionBar().getSelectedNavigationIndex() == TRASH_SELECTED_ID) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 778             menu.findItem(R.id.menu_empty_trash).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 779             menu.findItem(R.id.menu_create_note).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 780             menu.findItem(R.id.menu_search).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 781             menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 782         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 783 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 784         return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 785     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 786 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 787     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 788     public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 789         switch (item.getItemId()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 790             case R.id.menu_preferences:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 791                 // nbradbury - use startActivityForResult so onActivityResult can detect when user returns from preferences"> 791                 // nbradbury - use startActivityForResult so onActivityResult can detect when user returnðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 792                 Intent i = new Intent(this, PreferencesActivity.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 793                 startActivityForResult(i, Simplenote.INTENT_PREFERENCES);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 794                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 795             case R.id.menu_edit_tags:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 796                 Intent editTagsIntent = new Intent(this, TagsListActivity.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 797                 startActivity(editTagsIntent);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 798                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 799             case R.id.menu_create_note:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 800                 getNoteListFragment().addNote();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 801                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 802             case R.id.menu_share:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 803                 if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 804                     Intent shareIntent = new Intent(android.content.Intent.ACTION_SEND);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 805                     shareIntent.setType(&quot;text/plain&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 806                     shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, mCurrentNote.getContent());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 807                     startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.share_note)));"> 807                     startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.shaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 808                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 809                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 810             case R.id.menu_delete:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 811                 if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 812                     if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 813                         mCurrentNote.setDeleted(!mCurrentNote.isDeleted());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 814                         mCurrentNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 815                         mCurrentNote.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 816 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 817                         if (mCurrentNote.isDeleted()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 818                             mUndoBarController.setDeletedNote(mCurrentNote);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 819                             mUndoBarController.showUndoBar(false, getString(R.string.note_deleted), null);"> 819                             mUndoBarController.showUndoBar(false, getString(R.string.note_deleted), null)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 820                         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 821                         showDetailPlaceholder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 822                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 823                     popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 824                     NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 825                     if (fragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 826                         fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 827                         fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 828                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 829                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 830                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 831             case R.id.menu_empty_trash:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 832                 AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 833 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 834                 alert.setTitle(R.string.empty_trash);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 835                 alert.setMessage(R.string.confirm_empty_trash);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 836                 alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 837                     public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 838                         new emptyTrashTask().execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 839                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 840                 });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 841                 alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 842                     public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 843                         // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 844                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 845                 });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 846                 alert.show();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 847                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 848             case android.R.id.home:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 849                 popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 850                 invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 851                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 852             default:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 853                 return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 854         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 855     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 856 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 857     protected void popNoteDetail() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 858         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 859         if (fm.getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 860             try {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 861                 fm.popBackStack();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 862             } catch (Exception e) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 863                 e.printStackTrace();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 864             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 865         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 866     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 867 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 868     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 869      * Callback method from {@link NoteListFragment.Callbacks} indicating that</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 870      * the item with the given ID was selected.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 871      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 872     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 873     public void onNoteSelected(Note note) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 874 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 875         if (mSearchMenuItem != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 876             mSearchMenuItem.collapseActionView();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 877 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 878         mCurrentNote = note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 879         String noteKey = note == null ? &quot;none&quot; : note.getSimperiumKey();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 880 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 881         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 882 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 883         if (!isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 884             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 885             ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 886             ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 887 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 888             // Create editor fragment</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 889             Bundle arguments = new Bundle();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 890             arguments.putString(NoteEditorFragment.ARG_ITEM_ID, noteKey);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 891             mNoteEditorFragment = new NoteEditorFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 892             mNoteEditorFragment.setArguments(arguments);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 893 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 894             // Add editor fragment to stack</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 895             FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 896             ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_and_fade, R.animator.slide_out);"> 896             ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 897             ft.replace(R.id.noteFragmentContainer, mNoteEditorFragment);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 898             ft.addToBackStack(null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 899             ft.commit();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 900             fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 901         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 902             mNoteEditorFragment.setNote(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 903             getNoteListFragment().setNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 904         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 905 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 906         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 907     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 908 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 909     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 910     public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 911         // TODO Auto-generated method stub</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 912         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 913     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 914 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 915 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 916     public void onAuthenticationStatusChange(User.AuthenticationStatus status) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 917         if (status == User.AuthenticationStatus.NOT_AUTHENTICATED) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 918             startLoginActivity();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 919         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 920     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 921 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 922     public void startLoginActivity() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 923         Intent loginIntent = new Intent(this, LoginActivity.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 924         startActivityForResult(loginIntent, Simperium.SIGNUP_SIGNIN_REQUEST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 925     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 926 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 927 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 928     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 929     protected void onActivityResult(int requestCode, int resultCode, Intent data) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 930         super.onActivityResult(requestCode, resultCode, data);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 931         switch (requestCode) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 932             case Simperium.SIGNUP_SIGNIN_REQUEST:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 933                 if (resultCode == RESULT_CANCELED)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 934                     finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 935                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 936             case Simplenote.INTENT_PREFERENCES:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 937                 // nbradbury - refresh note list when user returns from preferences (in case they changed anything)"> 937                 // nbradbury - refresh note list when user returns from preferences (in case they changedðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 938                 NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 939                 if (fragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 940                     fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 941                     fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 942                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 943                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 944         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 945     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 946 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 947     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 948     public void onUndo(Parcelable p) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 949         if (mUndoBarController != null &amp;&amp; mUndoBarController.getDeletedNote() != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 950             Note deletedNote = mUndoBarController.getDeletedNote();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 951             if (deletedNote != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 952                 deletedNote.setDeleted(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 953                 deletedNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 954                 deletedNote.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 955                 NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 956                 if (fragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 957                     fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 958                     fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 959                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 960             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 961         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 962     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 963 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 964     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 965     public void onBackStackChanged() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 966         configureActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 967         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 968     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 969 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 970     private void configureActionBar() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 971         if (getFragmentManager().getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 972             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 973             if (ab != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 974                 ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 975                 ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 976             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 977         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 978             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 979             if (ab != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 980                 ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 981                 ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 982             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 983         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 984     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 985 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 986     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 987     public void onConfigurationChanged(Configuration newConfig) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 988         super.onConfigurationChanged(newConfig);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 989 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 990         if (mIsLargeScreen) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 991             if (newConfig.orientation == Configuration.ORIENTATION_LANDSCAPE) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 992                 // Add the editor fragment</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 993                 mIsLandscape = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 994                 popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 995                 addEditorFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 996                 if (mNoteListFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 997                     mNoteListFragment.setActivateOnItemClick(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 998                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 999                 // Select the current note on a tablet</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1000                 if (mCurrentNote != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1001                     onNoteSelected(mCurrentNote);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1002                 invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="1003             } else if (newConfig.orientation == Configuration.ORIENTATION_PORTRAIT &amp;&amp; mNoteEditorFragment != null) {">1003             } else if (newConfig.orientation == Configuration.ORIENTATION_PORTRAIT &amp;&amp; mNoteEditorFragmentðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1004                 // Remove the editor fragment when rotating back to portrait</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1005                 mIsLandscape = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1006                 mCurrentNote = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1007                 if (mNoteListFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1008                     mNoteListFragment.setActivateOnItemClick(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1009                     mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1010                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1011                 FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1012                 FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1013                 ft.remove(mNoteEditorFragment);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1014                 mNoteEditorFragment = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1015                 ft.commit();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1016                 fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1017                 invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1018             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1019         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1020     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1021 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1022     public void showDetailPlaceholder() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1023         if (isLargeScreenLandscape() &amp;&amp; mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1024             mCurrentNote = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1025             invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1026             mNoteEditorFragment.setPlaceholderVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1027         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1028     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1029 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1030     private class emptyTrashTask extends AsyncTask&lt;Void, Void, Void&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1031 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1032         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1033         protected Void doInBackground(Void... voids) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1034             Simplenote application = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1035             Bucket&lt;Note&gt; noteBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1036             Query&lt;Note&gt; query = Note.allDeleted(noteBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1037             Bucket.ObjectCursor c = query.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1038             while (c.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1039                 c.getObject().delete();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1040             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1041             return null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1042         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1043     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1044 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">1045 }</span>
1046 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
   4 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   5 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   6 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   7 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   8 import android.app.ActionBar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   9 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  10 import android.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  11 import android.app.FragmentManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  12 import android.app.FragmentTransaction;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  13 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  14 import android.content.Intent;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  15 import android.content.res.Configuration;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  16 import android.os.AsyncTask;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  17 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  18 import android.os.Parcelable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  19 import android.view.Menu;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  20 import android.view.MenuInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  21 import android.view.MenuItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  22 import android.widget.SearchView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  24 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  25 import com.automattic.simplenote.utils.UndoBarController;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  26 import com.simperium.Simperium;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  27 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  28 import com.simperium.client.LoginActivity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  29 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  30 import com.simperium.client.User;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  31 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  32 import java.util.Calendar;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  33 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  34 /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  35  * An activity representing a list of Notes.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36  * &lt;p/&gt;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37  * The activity makes heavy use of fragments. The list of items is a</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38  * {@link NoteListFragment} and the item details (if present) is a</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  39  * {@link NoteEditorFragment}.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  40  * &lt;p/&gt;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  41  * This activity also implements the required {@link NoteListFragment.Callbacks}</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  42  * interface to listen for item selections.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  43  */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  44 public class NotesActivity extends Activity implements</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  45         NoteListFragment.Callbacks, ActionBar.OnNavigationListener,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  46         User.AuthenticationListener, UndoBarController.UndoListener,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  47         FragmentManager.OnBackStackChangedListener, Bucket.Listener&lt;Note&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  48 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  49     private boolean mIsLargeScreen, mIsLandscape;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50     private UndoBarController mUndoBarController;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51     private SearchView mSearchView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52     private MenuItem mSearchMenuItem;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53     private NoteListFragment mNoteListFragment;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54     private NoteEditorFragment mNoteEditorFragment;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  55     private Note mCurrentNote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  56     private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57     private int TRASH_SELECTED_ID = 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59     public static String TAG_NOTE_LIST = &quot;noteList&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60     public static String TAG_NOTE_EDITOR = &quot;noteEditor&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63     protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65         Simplenote currentApp = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66         mNotesBucket = currentApp.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67         setContentView(R.layout.activity_notes);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69         if (savedInstanceState == null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  70             mNoteListFragment = new NoteListFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71             FragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72             fragmentTransaction.add(R.id.noteFragmentContainer, mNoteListFragment, TAG_NOTE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73             fragmentTransaction.commit();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75             mNoteListFragment = (NoteListFragment) getFragmentManager().findFragmentByTag(TAG_NOTE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79         Configuration config = getBaseContext().getResources().getConfiguration();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  80         if ((config.screenLayout</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81                 &amp; Configuration.SCREENLAYOUT_SIZE_MASK)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82                 &gt;= Configuration.SCREENLAYOUT_SIZE_LARGE) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83             mIsLargeScreen = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85             if (getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR) != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  86                 mNoteEditorFragment = (NoteEditorFragment) getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR);">  86                 mNoteEditorFragment = (NoteEditorFragment) getFragmentManager().findFragmentByTag(TAG_NOTðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87             } else if (config.orientation == Configuration.ORIENTATION_LANDSCAPE) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88                 mIsLandscape = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89                 addEditorFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93         ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94         ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95         ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97         mUndoBarController = new UndoBarController(findViewById(R.id.undobar), this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99         getFragmentManager().addOnBackStackChangedListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 101         if (currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAuthentication()) {"> 101         if (currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAutheðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102             startLoginActivity();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104         currentApp.getSimperium().setAuthenticationListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106         if (Intent.ACTION_SEND.equals(getIntent().getAction())) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107             // Check share action</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108             Intent intent = getIntent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109             String text = intent.getStringExtra(Intent.EXTRA_TEXT);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110             if (text != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111                 Note note = mNotesBucket.newObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112                 note.setContent(text);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113                 note.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114                 onNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119     private void addEditorFragment() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121         FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122         mNoteEditorFragment = new NoteEditorFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123         ft.add(R.id.noteFragmentContainer, mNoteEditorFragment, TAG_NOTE_EDITOR);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124         ft.commit();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125         fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129     protected void onResume() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130         super.onResume();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132         mNotesBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133         mNotesBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134         mNotesBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136         configureActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141     protected void onPause() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142         super.onPause();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144         mNotesBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145         mNotesBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146         mNotesBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150     // received a change from the network, refresh the list and the editor</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152     public void onChange(Bucket&lt;Note&gt; bucket, Bucket.ChangeType type, String key) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153         final boolean resetEditor = mCurrentNote != null &amp;&amp; mCurrentNote.getSimperiumKey().equals(key);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158                 if (!resetEditor) return;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159                 if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160                     mNoteEditorFragment.refreshContent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167     public void onSaveObject(Bucket&lt;Note&gt; bucket, Note object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177     public void onDeleteObject(Bucket&lt;Note&gt; bucket, Note object) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178         runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180             public void run() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181                 mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186     public boolean isLargeScreen() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187         return mIsLargeScreen;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190     public boolean isLargeScreenLandscape() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191         return mIsLargeScreen &amp;&amp; mIsLandscape;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194     // nbradbury 01-Apr-2013</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195     private NoteListFragment getNoteListFragment() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196         return mNoteListFragment;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200     public boolean onCreateOptionsMenu(Menu menu) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201         super.onCreateOptionsMenu(menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202         MenuInflater inflater = getMenuInflater();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203         inflater.inflate(R.menu.notes_list, menu);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205         mSearchMenuItem = menu.findItem(R.id.menu_search);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 206         mSearchView = (SearchView) mSearchMenuItem.getActionView();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207         mSearchView.setOnQueryTextListener(new SearchView.OnQueryTextListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209             public boolean onQueryTextChange(String newText) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210                 if (newText != null &amp;&amp; mSearchMenuItem.isActionViewExpanded())</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211                     getNoteListFragment().searchNotes(newText);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216             public boolean onQueryTextSubmit(String queryText) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217                 if (queryText != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218                     getNoteListFragment().searchNotes(queryText);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222         mSearchMenuItem.setOnActionExpandListener(new MenuItem.OnActionExpandListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224             public boolean onMenuItemActionExpand(MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225                 showDetailPlaceholder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229             @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230             public boolean onMenuItemActionCollapse(MenuItem menuItem) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231                 // Show all notes again</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232                 getNoteListFragment().clearSearch();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235         });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238         if (fm.getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239             getActionBar().setDisplayHomeAsUpEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240             menu.findItem(R.id.menu_create_note).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241             menu.findItem(R.id.menu_search).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242             menu.findItem(R.id.menu_preferences).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243             menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244             menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245             if (mCurrentNote != null &amp;&amp; mCurrentNote.isDeleted())</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246                 menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247             menu.findItem(R.id.menu_edit_tags).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249         } else if (isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250             getActionBar().setDisplayHomeAsUpEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251             getActionBar().setHomeButtonEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252             menu.findItem(R.id.menu_create_note).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253             menu.findItem(R.id.menu_search).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254             menu.findItem(R.id.menu_preferences).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255             if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256                 menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257                 menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258             } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259                 menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260                 menu.findItem(R.id.menu_delete).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262             menu.findItem(R.id.menu_edit_tags).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265             getActionBar().setDisplayHomeAsUpEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266             getActionBar().setHomeButtonEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267             menu.findItem(R.id.menu_create_note).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268             menu.findItem(R.id.menu_search).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269             menu.findItem(R.id.menu_preferences).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270             menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271             menu.findItem(R.id.menu_delete).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272             menu.findItem(R.id.menu_edit_tags).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273             menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276         // Are we looking at the trash? Adjust menu accordingly.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277         if (getActionBar().getSelectedNavigationIndex() == TRASH_SELECTED_ID) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278             menu.findItem(R.id.menu_empty_trash).setVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279             menu.findItem(R.id.menu_create_note).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280             menu.findItem(R.id.menu_search).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281             menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284         return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288     public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289         switch (item.getItemId()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290             case R.id.menu_preferences:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 291                 // nbradbury - use startActivityForResult so onActivityResult can detect when user returns from preferences"> 291                 // nbradbury - use startActivityForResult so onActivityResult can detect when user returnðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292                 Intent i = new Intent(this, PreferencesActivity.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293                 startActivityForResult(i, Simplenote.INTENT_PREFERENCES);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295             case R.id.menu_edit_tags:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296                 Intent editTagsIntent = new Intent(this, TagsListActivity.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297                 startActivity(editTagsIntent);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 298                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299             case R.id.menu_create_note:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300                 getNoteListFragment().addNote();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302             case R.id.menu_share:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 303                 if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304                     Intent shareIntent = new Intent(android.content.Intent.ACTION_SEND);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305                     shareIntent.setType(&quot;text/plain&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306                     shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, mCurrentNote.getContent());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 307                     startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.share_note)));"> 307                     startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.shaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310             case R.id.menu_delete:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311                 if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312                     if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313                         mCurrentNote.setDeleted(!mCurrentNote.isDeleted());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314                         mCurrentNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315                         mCurrentNote.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317                         if (mCurrentNote.isDeleted()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318                             mUndoBarController.setDeletedNote(mCurrentNote);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 319                             mUndoBarController.showUndoBar(false, getString(R.string.note_deleted), null);"> 319                             mUndoBarController.showUndoBar(false, getString(R.string.note_deleted), null)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320                         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 321                         showDetailPlaceholder();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 322                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 323                     popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 324                     NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 325                     if (fragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 326                         fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 327                         fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 328                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 329                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 330                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 331             case R.id.menu_empty_trash:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 332                 AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 333 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 334                 alert.setTitle(R.string.empty_trash);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 335                 alert.setMessage(R.string.confirm_empty_trash);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 336                 alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 337                     public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 338                         new emptyTrashTask().execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 339                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 340                 });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 341                 alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 342                     public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 343                         // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 344                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 345                 });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 346                 alert.show();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 347                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 348             case android.R.id.home:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 349                 popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 350                 invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 351                 return true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 352             default:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353                 return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357     protected void popNoteDetail() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359         if (fm.getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360             try {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361                 fm.popBackStack();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362             } catch (Exception e) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363                 e.printStackTrace();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368     /**</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369      * Callback method from {@link NoteListFragment.Callbacks} indicating that</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370      * the item with the given ID was selected.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371      */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373     public void onNoteSelected(Note note) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375         if (mSearchMenuItem != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376             mSearchMenuItem.collapseActionView();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378         mCurrentNote = note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379         String noteKey = note == null ? &quot;none&quot; : note.getSimperiumKey();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381         FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383         if (!isLargeScreenLandscape()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385             ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386             ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388             // Create editor fragment</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389             Bundle arguments = new Bundle();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390             arguments.putString(NoteEditorFragment.ARG_ITEM_ID, noteKey);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391             mNoteEditorFragment = new NoteEditorFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392             mNoteEditorFragment.setArguments(arguments);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394             // Add editor fragment to stack</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395             FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 396             ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_and_fade, R.animator.slide_out);"> 396             ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 397             ft.replace(R.id.noteFragmentContainer, mNoteEditorFragment);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398             ft.addToBackStack(null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399             ft.commit();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 400             fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 401         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402             mNoteEditorFragment.setNote(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403             getNoteListFragment().setNoteSelected(note);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 407     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 408 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410     public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411         // TODO Auto-generated method stub</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412         return false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 415 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416     public void onAuthenticationStatusChange(User.AuthenticationStatus status) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417         if (status == User.AuthenticationStatus.NOT_AUTHENTICATED) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418             startLoginActivity();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 421 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422     public void startLoginActivity() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423         Intent loginIntent = new Intent(this, LoginActivity.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424         startActivityForResult(loginIntent, Simperium.SIGNUP_SIGNIN_REQUEST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 426 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 428     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429     protected void onActivityResult(int requestCode, int resultCode, Intent data) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430         super.onActivityResult(requestCode, resultCode, data);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431         switch (requestCode) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432             case Simperium.SIGNUP_SIGNIN_REQUEST:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433                 if (resultCode == RESULT_CANCELED)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434                     finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436             case Simplenote.INTENT_PREFERENCES:</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 437                 // nbradbury - refresh note list when user returns from preferences (in case they changed anything)"> 437                 // nbradbury - refresh note list when user returns from preferences (in case they changedðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438                 NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439                 if (fragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440                     fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441                     fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 442                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 443                 break;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 444         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 445     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 446 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 447     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 448     public void onUndo(Parcelable p) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 449         if (mUndoBarController != null &amp;&amp; mUndoBarController.getDeletedNote() != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 450             Note deletedNote = mUndoBarController.getDeletedNote();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 451             if (deletedNote != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 452                 deletedNote.setDeleted(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 453                 deletedNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 454                 deletedNote.save();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 455                 NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 456                 if (fragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 457                     fragment.getPrefs();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 458                     fragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 459                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 460             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 461         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 462     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 463 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 464     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 465     public void onBackStackChanged() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 466         configureActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 467         invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 468     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 469 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 470     private void configureActionBar() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 471         if (getFragmentManager().getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 472             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 473             if (ab != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 474                 ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 475                 ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 476             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 477         } else {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 478             ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 479             if (ab != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 480                 ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 481                 ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 482             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 483         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 484     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 485 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 486     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 487     public void onConfigurationChanged(Configuration newConfig) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 488         super.onConfigurationChanged(newConfig);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 489 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 490         if (mIsLargeScreen) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 491             if (newConfig.orientation == Configuration.ORIENTATION_LANDSCAPE) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 492                 // Add the editor fragment</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 493                 mIsLandscape = true;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 494                 popNoteDetail();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 495                 addEditorFragment();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 496                 if (mNoteListFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 497                     mNoteListFragment.setActivateOnItemClick(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 498                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 499                 // Select the current note on a tablet</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 500                 if (mCurrentNote != null)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 501                     onNoteSelected(mCurrentNote);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 502                 invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 503             } else if (newConfig.orientation == Configuration.ORIENTATION_PORTRAIT &amp;&amp; mNoteEditorFragment != null) {"> 503             } else if (newConfig.orientation == Configuration.ORIENTATION_PORTRAIT &amp;&amp; mNoteEditorFragmentðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 504                 // Remove the editor fragment when rotating back to portrait</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 505                 mIsLandscape = false;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 506                 mCurrentNote = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 507                 if (mNoteListFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 508                     mNoteListFragment.setActivateOnItemClick(false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 509                     mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 510                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 511                 FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 512                 FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 513                 ft.remove(mNoteEditorFragment);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 514                 mNoteEditorFragment = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 515                 ft.commit();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 516                 fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 517                 invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 518             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 519         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 520     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 521 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 522     public void showDetailPlaceholder() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 523         if (isLargeScreenLandscape() &amp;&amp; mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 524             mCurrentNote = null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 525             invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 526             mNoteEditorFragment.setPlaceholderVisible(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 527         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 528     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 529 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 530     private class emptyTrashTask extends AsyncTask&lt;Void, Void, Void&gt; {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 531 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 532         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 533         protected Void doInBackground(Void... voids) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 534             Simplenote application = (Simplenote) getApplication();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 535             Bucket&lt;Note&gt; noteBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 536             Query&lt;Note&gt; query = Note.allDeleted(noteBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 537             Bucket.ObjectCursor c = query.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 538             while (c.moveToNext()) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 539                 c.getObject().delete();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 540             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 541             return null;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 542         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 543     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 544 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 545 }</span>
 546 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   1 -package com.automattic.simplenote;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   2 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   3 -import android.app.ActionBar;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   4 -import android.app.Activity;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   5 -import android.app.AlertDialog;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   6 -import android.app.FragmentManager;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   7 -import android.app.FragmentTransaction;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   8 -import android.content.DialogInterface;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   9 -import android.content.Intent;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  10 -import android.content.res.Configuration;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  11 -import android.os.AsyncTask;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  12 -import android.os.Bundle;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  13 -import android.os.Parcelable;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  14 -import android.view.Menu;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  15 -import android.view.MenuInflater;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  16 -import android.view.MenuItem;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  17 -import android.widget.SearchView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  18 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -import com.automattic.simplenote.utils.UndoBarController;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -import com.simperium.Simperium;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -import com.simperium.client.LoginActivity;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -import com.simperium.client.Query;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -import com.simperium.client.User;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  26 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -import java.util.Calendar;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  28 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 - * An activity representing a list of Notes.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  31 - * &lt;p&gt;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 - * The activity makes heavy use of fragments. The list of items is a</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 - * {@link NoteListFragment} and the item details (if present) is a</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 - * {@link NoteEditorFragment}.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  35 - * &lt;p&gt;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 - * This activity also implements the required {@link NoteListFragment.Callbacks}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  37 - * interface to listen for item selections.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  38 - */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  39 -public class NotesActivity extends Activity implements</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 -		NoteListFragment.Callbacks, ActionBar.OnNavigationListener,</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 -        User.AuthenticationListener, UndoBarController.UndoListener,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 -        FragmentManager.OnBackStackChangedListener, Bucket.Listener&lt;Note&gt; {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 -	/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 -	 * Whether or not the activity is in two-pane mode, i.e. running on a tablet</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -	 * device.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -	 */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -	private boolean mTwoPane;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -    private UndoBarController mUndoBarController;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  50 -    private SearchView mSearchView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -    private MenuItem mSearchMenuItem;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  52 -    private NoteListFragment mNoteListFragment;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  53 -    private NoteEditorFragment mNoteEditorFragment;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -    private Note mCurrentNote;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -    private Bucket&lt;Note&gt; mNotesBucket;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -    private int TRASH_SELECTED_ID = 1;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -	protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -		super.onCreate(savedInstanceState);</span>






<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  61 -        Simplenote currentApp = (Simplenote) getApplication();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  62 -        mNotesBucket = currentApp.getNotesBucket();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -		setContentView(R.layout.activity_notes);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -		int orientation = getResources().getConfiguration().orientation;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -		if (getNoteEditorFragment() != null &amp;&amp; orientation == Configuration.ORIENTATION_LANDSCAPE ) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  67 -			mTwoPane = true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  68 -			// In two-pane mode, list items should be given the</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  69 -			// &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  70 -            mNoteListFragment = ((NoteListFragment) getFragmentManager().findFragmentById(R.id.note_list));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  71 -            mNoteListFragment.setActivateOnItemClick(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  72 -            mNoteEditorFragment = getNoteEditorFragment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -		} else if (savedInstanceState == null) {</span>



<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -            mNoteListFragment = new NoteListFragment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -            FragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  76 -            fragmentTransaction.add(R.id.noteFragmentContainer, mNoteListFragment);</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  77 -            fragmentTransaction.commit();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  78 -        } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  79 -            mNoteListFragment = (NoteListFragment)getFragmentManager().findFragmentById(R.id.noteFragmentContainer);">  79 -            mNoteListFragment = (NoteListFragment)getFragmentManager().findFragmentById(R.id.noteFragmentContainerðŸ”µ</abbr></span>
















<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -        ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -        ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  84 -        ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -        mUndoBarController = new UndoBarController(findViewById(R.id.undobar), this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -        getFragmentManager().addOnBackStackChangedListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  90 -		if( currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAuthentication() ){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -			startLoginActivity();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -		currentApp.getSimperium().setAuthenticationListener(this);</span>




<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  95 -        if (Intent.ACTION_SEND.equals(getIntent().getAction())) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  96 -            // Check share action</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  97 -            Intent intent = getIntent();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  98 -            String text = intent.getStringExtra(Intent.EXTRA_TEXT);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  99 -            String title = intent.getStringExtra(Intent.EXTRA_SUBJECT);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 100 -            if (text != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 101 -                Note note = mNotesBucket.newObject();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 102 -                note.setContent(text);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 103 -                note.save();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 104 -                onNoteSelected(note);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 105 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 106 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 107 -	}</span>










<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 108 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 109 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 110 -    protected void onResume() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 111 -        super.onResume();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 112 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 113 -        mNotesBucket.addOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 114 -        mNotesBucket.addOnSaveObjectListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 115 -        mNotesBucket.addOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -        configureActionBar();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 118 -        invalidateOptionsMenu();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 119 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 120 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -    protected void onPause(){</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 123 -        super.onPause();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 124 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -        mNotesBucket.removeOnNetworkChangeListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 126 -        mNotesBucket.removeOnSaveObjectListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 127 -        mNotesBucket.removeOnDeleteObjectListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 128 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 129 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 130 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 131 -    // received a change from the network, refresh the list and the editor</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 132 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 133 -    public void onChange(Bucket&lt;Note&gt; bucket, Bucket.ChangeType type, String key){</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 134 -        final boolean resetEditor = mCurrentNote != null &amp;&amp; mCurrentNote.getSimperiumKey().equals(key);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 135 -        runOnUiThread(new Runnable(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 136 -            @Override public void run(){</span>



<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 137 -                mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 138 -                if (!resetEditor) return;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 139 -                if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 140 -                    mNoteEditorFragment.refreshContent();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 141 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 142 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 143 -        });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 144 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 145 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 146 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 147 -    public void onSaveObject(Bucket&lt;Note&gt; bucket, Note object){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 148 -        runOnUiThread(new Runnable(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 149 -            @Override public void run(){</span>




<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 150 -                mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 151 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 152 -        });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 153 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 154 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 155 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 156 -    public void onDeleteObject(Bucket&lt;Note&gt; bucket, Note object){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -        runOnUiThread(new Runnable(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 158 -            @Override public void run(){</span>




<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 159 -                mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 160 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 161 -        });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 162 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 163 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 164 -    public boolean isTwoPane() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 165 -        return mTwoPane;</span>






<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 166 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 168 -    // nbradbury 01-Apr-2013</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 169 -	private NoteListFragment getNoteListFragment() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 170 -		return mNoteListFragment;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 171 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 172 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 173 -    private NoteEditorFragment getNoteEditorFragment() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 174 -        return ((NoteEditorFragment) getFragmentManager().findFragmentById(R.id.noteEditorFragment));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 175 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 176 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 177 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 178 -	public boolean onCreateOptionsMenu(Menu menu) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 179 -		super.onCreateOptionsMenu(menu);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 180 -		MenuInflater inflater = getMenuInflater();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 181 -		inflater.inflate(R.menu.notes_list, menu);</span>









<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 182 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 183 -        mSearchMenuItem = menu.findItem(R.id.menu_search);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 184 -        mSearchView = (SearchView) mSearchMenuItem.getActionView();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 185 -        mSearchView.setOnQueryTextListener(new SearchView.OnQueryTextListener( ) {</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 186 -            @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 187 -            public boolean onQueryTextChange(String newText) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 188 -                if (newText != null &amp;&amp; mSearchMenuItem.isActionViewExpanded())</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 189 -                    getNoteListFragment().searchNotes(newText);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 190 -                return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 191 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 192 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 193 -            @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 194 -            public boolean onQueryTextSubmit(String queryText) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 195 -                if (queryText != null)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 196 -                    getNoteListFragment().searchNotes(queryText);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 197 -                return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 198 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 199 -        });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 200 -        mSearchMenuItem.setOnActionExpandListener(new MenuItem.OnActionExpandListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 201 -            @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 202 -            public boolean onMenuItemActionExpand(MenuItem menuItem) {</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 203 -                return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 204 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 205 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 206 -            @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 207 -            public boolean onMenuItemActionCollapse(MenuItem menuItem) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 208 -                // Show all notes again</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 209 -                getNoteListFragment().clearSearch();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 210 -                return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 211 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 212 -        });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 213 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 214 -        FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 215 -        if (fm.getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 216 -            getActionBar().setDisplayHomeAsUpEnabled(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 217 -            menu.findItem(R.id.menu_create_note).setVisible(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 218 -            menu.findItem(R.id.menu_search).setVisible(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 219 -            menu.findItem(R.id.menu_preferences).setVisible(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 220 -            menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 221 -            menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 222 -            if (mCurrentNote != null &amp;&amp; mCurrentNote.isDeleted())</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 223 -                menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 224 -            menu.findItem(R.id.menu_edit_tags).setVisible(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 225 -            menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 226 -        } else if (mTwoPane) {</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 227 -            getActionBar().setDisplayHomeAsUpEnabled(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 228 -            getActionBar().setHomeButtonEnabled(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 229 -            menu.findItem(R.id.menu_create_note).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 230 -            menu.findItem(R.id.menu_search).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 231 -            menu.findItem(R.id.menu_preferences).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 232 -            menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 233 -            menu.findItem(R.id.menu_delete).setVisible(true);</span>







<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 234 -            menu.findItem(R.id.menu_edit_tags).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 235 -            menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 236 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 237 -        } else  {</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 238 -            getActionBar().setDisplayHomeAsUpEnabled(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 239 -            getActionBar().setHomeButtonEnabled(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 240 -            menu.findItem(R.id.menu_create_note).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 241 -            menu.findItem(R.id.menu_search).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 242 -            menu.findItem(R.id.menu_preferences).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 243 -            menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 244 -            menu.findItem(R.id.menu_delete).setVisible(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 245 -            menu.findItem(R.id.menu_edit_tags).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 246 -            menu.findItem(R.id.menu_empty_trash).setVisible(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 247 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 248 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 249 -        // Are we looking at the trash? Adjust menu accordingly.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 250 -        if (getActionBar().getSelectedNavigationIndex() == TRASH_SELECTED_ID) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 251 -            menu.findItem(R.id.menu_empty_trash).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 252 -            menu.findItem(R.id.menu_create_note).setVisible(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 253 -            menu.findItem(R.id.menu_search).setVisible(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 254 -            menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 255 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 256 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 257 -		return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 258 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 259 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 260 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 261 -	public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 262 -		switch (item.getItemId()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 263 -		case R.id.menu_preferences :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 264 -			// nbradbury - use startActivityForResult so onActivityResult can detect when user returns from preferences</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 265 -			Intent i = new Intent(this, PreferencesActivity.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 266 -			startActivityForResult(i, Simplenote.INTENT_PREFERENCES);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 267 -			return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 268 -        case R.id.menu_edit_tags :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 269 -            Intent editTagsIntent = new Intent(this, TagsListActivity.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 270 -            startActivity(editTagsIntent);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 271 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 272 -		case R.id.menu_create_note :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 273 -			getNoteListFragment().addNote();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 274 -			return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 275 -        case R.id.menu_share:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 276 -            if (mCurrentNote != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 277 -                Intent shareIntent = new Intent(android.content.Intent.ACTION_SEND);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 278 -                shareIntent.setType(&quot;text/plain&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 279 -                shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, mCurrentNote.getContent());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 280 -                startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.share_note)));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 281 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 282 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 283 -        case R.id.menu_delete:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 284 -            if (mNoteEditorFragment != null) {</span>



















<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 285 -                if (mCurrentNote != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 286 -                    mCurrentNote.setDeleted(!mCurrentNote.isDeleted());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 287 -                    mCurrentNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 288 -                    mCurrentNote.save();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 289 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 290 -                    if (mCurrentNote.isDeleted()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 291 -                        mUndoBarController.setDeletedNote(mCurrentNote);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 292 -                        mUndoBarController.showUndoBar(false, getString(R.string.note_deleted), null);</span>


















<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 293 -                    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 294 -                }</span>


























<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 295 -                popNoteDetail();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 296 -                NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 297 -                if (fragment!=null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 298 -                    fragment.getPrefs();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 299 -                    fragment.refreshList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 300 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 301 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 302 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 303 -        case R.id.menu_empty_trash:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 304 -            AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 305 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 306 -            alert.setTitle(R.string.empty_trash);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 307 -            alert.setMessage(R.string.confirm_empty_trash);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 308 -            alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 309 -                public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 310 -                    new emptyTrashTask().execute();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 311 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 312 -            });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 313 -            alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 314 -                public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 315 -                    // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 316 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 317 -            });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 318 -            alert.show();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 319 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 320 -        case android.R.id.home:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 321 -            popNoteDetail();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 322 -            invalidateOptionsMenu();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 323 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 324 -		default :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 325 -			return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 326 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 327 -	}</span>






<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 328 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 329 -    protected void popNoteDetail() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 330 -        mCurrentNote = null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 331 -        FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 332 -        NoteEditorFragment f = (NoteEditorFragment) fm.findFragmentById(R.id.note_editor);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 333 -        if (f == null) {</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 334 -            try {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 335 -                fm.popBackStack();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 336 -            } catch (Exception e) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 337 -                e.printStackTrace();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 338 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 339 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 340 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 341 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 342 -	/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 343 -	 * Callback method from {@link NoteListFragment.Callbacks} indicating that</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 344 -	 * the item with the given ID was selected.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 345 -	 */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 346 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 347 -	public void onNoteSelected(Note note) {</span>






<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 348 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 349 -        if (mSearchMenuItem != null)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 350 -            mSearchMenuItem.collapseActionView();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 351 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 352 -        mCurrentNote = note;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 353 -		String noteKey = note == null ? &quot;none&quot; : note.getSimperiumKey();</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 354 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 355 -        FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 356 -        NoteEditorFragment f = getNoteEditorFragment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 357 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 358 -        if (f == null || !f.isInLayout()) {</span>


<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 359 -            ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 360 -            ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 361 -            ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 362 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 363 -            // Create editor fragment</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 364 -            Bundle arguments = new Bundle();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 365 -            arguments.putString(NoteEditorFragment.ARG_ITEM_ID, noteKey);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 366 -            f = new NoteEditorFragment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 367 -            f.setArguments(arguments);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 368 -            mNoteEditorFragment = f;</span>


<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 369 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 370 -            // Add editor fragment to stack</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 371 -            FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 372 -            ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_and_fade, R.animator.slide_out);"> 372 -            ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_and_fade,ðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 373 -            ft.replace(R.id.noteFragmentContainer, f);</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 374 -            ft.addToBackStack(null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 375 -            ft.commit();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 376 -            fm.executePendingTransactions();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 377 -        } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 378 -            f.setNote(note);</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 379 -            getNoteListFragment().setNoteSelected(note);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 380 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 381 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 382 -        invalidateOptionsMenu();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 383 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 384 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 385 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 386 -	public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 387 -		// TODO Auto-generated method stub</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 388 -		return false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 389 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 390 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 391 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 392 -	public void onAuthenticationStatusChange(User.AuthenticationStatus status){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 393 -		if ( status == User.AuthenticationStatus.NOT_AUTHENTICATED ) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 394 -			startLoginActivity();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 395 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 396 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 397 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 398 -	public void startLoginActivity(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 399 -		Intent loginIntent = new Intent(this, LoginActivity.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 400 -		startActivityForResult(loginIntent, Simperium.SIGNUP_SIGNIN_REQUEST);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 401 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 402 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 403 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 404 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 405 -	protected void onActivityResult(int requestCode, int resultCode, Intent data) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 406 -		super.onActivityResult(requestCode, resultCode, data);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 407 -		switch (requestCode) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 408 -		case Simperium.SIGNUP_SIGNIN_REQUEST :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 409 -			if (resultCode == RESULT_CANCELED)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 410 -				 finish();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 411 -			break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 412 -		case Simplenote.INTENT_PREFERENCES :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 413 -			// nbradbury - refresh note list when user returns from preferences (in case they changed anything)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 414 -			NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 415 -			if (fragment!=null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 416 -				fragment.getPrefs();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 417 -				fragment.refreshList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 418 -			}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 419 -			break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 420 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 421 -	}</span>







































<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 422 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 423 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 424 -    public void onUndo(Parcelable p) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 425 -        if (mUndoBarController != null &amp;&amp; mUndoBarController.getDeletedNote() != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 426 -            Note deletedNote = mUndoBarController.getDeletedNote();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 427 -            if (deletedNote != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 428 -                deletedNote.setDeleted(false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 429 -                deletedNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 430 -                deletedNote.save();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 431 -                NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 432 -                if (fragment!=null) {</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 433 -                    fragment.getPrefs();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 434 -                    fragment.refreshList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 435 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 436 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 437 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 438 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 439 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 440 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 441 -    public void onBackStackChanged() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 442 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 443 -        configureActionBar();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 444 -        invalidateOptionsMenu();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 445 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 446 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 447 -    /**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 448 -     * If a note is changed that is being displayed in the NoteEditorFragment, update its content</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 449 -     * @param note</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 450 -     */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 451 -    public void onNoteChanged(Note note) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 452 -        if (mCurrentNote != null &amp;&amp; mNoteEditorFragment != null &amp;&amp; mNoteEditorFragment.isVisible()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 453 -            if (note.getSimperiumKey().equals(mCurrentNote.getSimperiumKey())) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 454 -                if (note.isDeleted())</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 455 -                    popNoteDetail();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 456 -                else</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 457 -                    mNoteEditorFragment.setNote(note);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 458 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 459 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 460 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 461 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 462 -    private void configureActionBar() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 463 -        if (getFragmentManager().getBackStackEntryCount() &gt; 0) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 464 -            ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 465 -            ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 466 -            ab.setDisplayShowTitleEnabled(true);</span>




<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 467 -        } else {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 468 -            ActionBar ab = getActionBar();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 469 -            ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 470 -            ab.setDisplayShowTitleEnabled(false);</span>




<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 471 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 472 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 473 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 474 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 475 -    public void onConfigurationChanged(Configuration newConfig) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 476 -        super.onConfigurationChanged(newConfig);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 477 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 478 -        // If we are on a tablet, we will restart the activity to adjust the layout accordingly</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 479 -        if ((getBaseContext().getResources().getConfiguration().screenLayout</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 480 -                &amp; Configuration.SCREENLAYOUT_SIZE_MASK)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 481 -                &gt;= Configuration.SCREENLAYOUT_SIZE_LARGE) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 482 -            finish();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 483 -            startActivity(getIntent());</span>





































<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 484 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 485 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 486 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 487 -    private class emptyTrashTask extends AsyncTask&lt;Void, Void, Void&gt; {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 488 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 489 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 490 -        protected Void doInBackground(Void... voids) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 491 -            Simplenote application = (Simplenote) getApplication();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 492 -            Bucket&lt;Note&gt; noteBucket = application.getNotesBucket();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 493 -            Query&lt;Note&gt; query = Note.allDeleted(noteBucket);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 494 -            Bucket.ObjectCursor c = query.execute();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 495 -            while (c.moveToNext()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 496 -                c.getObject().delete();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 497 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 498 -            return null;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 499 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 500 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 501 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 502 -}</span></pre></td>
                            <td><pre>   1  package com.automattic.simplenote;
   2  
   3  import android.app.ActionBar;
   4  import android.app.Activity;
   5  import android.app.AlertDialog;
   6  import android.app.FragmentManager;
   7  import android.app.FragmentTransaction;
   8  import android.content.DialogInterface;
   9  import android.content.Intent;
  10  import android.content.res.Configuration;
  11  import android.os.AsyncTask;
  12  import android.os.Bundle;
  13  import android.os.Parcelable;
  14  import android.view.Menu;
  15  import android.view.MenuInflater;
  16  import android.view.MenuItem;
  17  import android.widget.SearchView;
  18  
  19  import com.automattic.simplenote.models.Note;
  20  import com.automattic.simplenote.utils.UndoBarController;
  21  import com.simperium.Simperium;
  22  import com.simperium.client.Bucket;
  23  import com.simperium.client.LoginActivity;
  24  import com.simperium.client.Query;
  25  import com.simperium.client.User;
  26  
  27  import java.util.Calendar;
  28  
  29  /**
  30   * An activity representing a list of Notes.
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  31 - * &lt;p&gt;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  32 + * &lt;p/&gt;</span>
  33   * The activity makes heavy use of fragments. The list of items is a
  34   * {@link NoteListFragment} and the item details (if present) is a
  35   * {@link NoteEditorFragment}.
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 - * &lt;p&gt;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  37 + * &lt;p/&gt;</span>
  38   * This activity also implements the required {@link NoteListFragment.Callbacks}
  39   * interface to listen for item selections.
  40   */
  41  public class NotesActivity extends Activity implements
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 -		NoteListFragment.Callbacks, ActionBar.OnNavigationListener,</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  43 +        NoteListFragment.Callbacks, ActionBar.OnNavigationListener,</span>
  44          User.AuthenticationListener, UndoBarController.UndoListener,
  45          FragmentManager.OnBackStackChangedListener, Bucket.Listener&lt;Note&gt; {
  46  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -	/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -	 * Whether or not the activity is in two-pane mode, i.e. running on a tablet</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -	 * device.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  50 -	 */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -	private boolean mTwoPane;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  52 +    private boolean mIsLargeScreen, mIsLandscape;</span>
  53      private UndoBarController mUndoBarController;
  54      private SearchView mSearchView;
  55      private MenuItem mSearchMenuItem;
  56      private NoteListFragment mNoteListFragment;
  57      private NoteEditorFragment mNoteEditorFragment;
  58      private Note mCurrentNote;
  59      private Bucket&lt;Note&gt; mNotesBucket;
  60      private int TRASH_SELECTED_ID = 1;
  61  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  62 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -	protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -		super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  65 +    public static String TAG_NOTE_LIST = &quot;noteList&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  66 +    public static String TAG_NOTE_EDITOR = &quot;noteEditor&quot;;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  67 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  68 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  69 +    protected void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  70 +        super.onCreate(savedInstanceState);</span>
  71          Simplenote currentApp = (Simplenote) getApplication();
  72          mNotesBucket = currentApp.getNotesBucket();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -		setContentView(R.layout.activity_notes);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -		int orientation = getResources().getConfiguration().orientation;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  76 -		if (getNoteEditorFragment() != null &amp;&amp; orientation == Configuration.ORIENTATION_LANDSCAPE ) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  77 -			mTwoPane = true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  78 -			// In two-pane mode, list items should be given the</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  79 -			// &#x27;activated&#x27; state when touched.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -            mNoteListFragment = ((NoteListFragment) getFragmentManager().findFragmentById(R.id.note_list));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -            mNoteListFragment.setActivateOnItemClick(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -            mNoteEditorFragment = getNoteEditorFragment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -		} else if (savedInstanceState == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  84 +        setContentView(R.layout.activity_notes);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  85 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  86 +        if (savedInstanceState == null) {</span>
  87              mNoteListFragment = new NoteListFragment();
  88              FragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -            fragmentTransaction.add(R.id.noteFragmentContainer, mNoteListFragment);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  90 +            fragmentTransaction.add(R.id.noteFragmentContainer, mNoteListFragment, TAG_NOTE_LIST);</span>
  91              fragmentTransaction.commit();
  92          } else {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  93 -            mNoteListFragment = (NoteListFragment)getFragmentManager().findFragmentById(R.id.noteFragmentContainer);">  93 -            mNoteListFragment = (NoteListFragment)getFragmentManager().findFragmentById(R.id.noteFragmentContainerðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  94 +            mNoteListFragment = (NoteListFragment) getFragmentManager().findFragmentByTag(TAG_NOTE_LIST);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  95 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +        Configuration config = getBaseContext().getResources().getConfiguration();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +        if ((config.screenLayout</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +                &amp; Configuration.SCREENLAYOUT_SIZE_MASK)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +                &gt;= Configuration.SCREENLAYOUT_SIZE_LARGE) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +            mIsLargeScreen = true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 104 +            if (getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR) != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 105 +                mNoteEditorFragment = (NoteEditorFragment) getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR);"> 105 +                mNoteEditorFragment = (NoteEditorFragment) getFragmentManager().findFragmentByTag(TAG_NOTE_EDITOR)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +            } else if (config.orientation == Configuration.ORIENTATION_LANDSCAPE) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +                mIsLandscape = true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +                addEditorFragment();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +            }</span>
 110          }
 111  
 112          ActionBar ab = getActionBar();
 113          ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);
 114          ab.setDisplayShowTitleEnabled(false);
 115  
 116          mUndoBarController = new UndoBarController(findViewById(R.id.undobar), this);
 117  
 118          getFragmentManager().addOnBackStackChangedListener(this);
 119  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 120 -		if( currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAuthentication() ){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -			startLoginActivity();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 123 -		currentApp.getSimperium().setAuthenticationListener(this);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 124 +        if (currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAuthentication()) {"> 124 +        if (currentApp.getSimperium().getUser() == null || currentApp.getSimperium().getUser().needsAuthenticationðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +            startLoginActivity();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +        currentApp.getSimperium().setAuthenticationListener(this);</span>
 128  
 129          if (Intent.ACTION_SEND.equals(getIntent().getAction())) {
 130              // Check share action
 131              Intent intent = getIntent();
 132              String text = intent.getStringExtra(Intent.EXTRA_TEXT);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 133 -            String title = intent.getStringExtra(Intent.EXTRA_SUBJECT);</span>
 134              if (text != null) {
 135                  Note note = mNotesBucket.newObject();
 136                  note.setContent(text);
 137                  note.save();
 138                  onNoteSelected(note);
 139              }
 140          }
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 141 -	}</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 142 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 143 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 144 +    private void addEditorFragment() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +        FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +        FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 147 +        mNoteEditorFragment = new NoteEditorFragment();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 148 +        ft.add(R.id.noteFragmentContainer, mNoteEditorFragment, TAG_NOTE_EDITOR);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 149 +        ft.commit();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +        fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +    }</span>
 152  
 153      @Override
 154      protected void onResume() {
 155          super.onResume();
 156  
 157          mNotesBucket.addOnNetworkChangeListener(this);
 158          mNotesBucket.addOnSaveObjectListener(this);
 159          mNotesBucket.addOnDeleteObjectListener(this);
 160  
 161          configureActionBar();
 162          invalidateOptionsMenu();
 163      }
 164  
 165      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 166 -    protected void onPause(){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +    protected void onPause() {</span>
 168          super.onPause();
 169  
 170          mNotesBucket.removeOnNetworkChangeListener(this);
 171          mNotesBucket.removeOnSaveObjectListener(this);
 172          mNotesBucket.removeOnDeleteObjectListener(this);
 173  
 174      }
 175  
 176      // received a change from the network, refresh the list and the editor
 177      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 178 -    public void onChange(Bucket&lt;Note&gt; bucket, Bucket.ChangeType type, String key){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +    public void onChange(Bucket&lt;Note&gt; bucket, Bucket.ChangeType type, String key) {</span>
 180          final boolean resetEditor = mCurrentNote != null &amp;&amp; mCurrentNote.getSimperiumKey().equals(key);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 181 -        runOnUiThread(new Runnable(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 182 -            @Override public void run(){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 183 +        runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 184 +            @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +            public void run() {</span>
 186                  mNoteListFragment.refreshList();
 187                  if (!resetEditor) return;
 188                  if (mNoteEditorFragment != null) {
 189                      mNoteEditorFragment.refreshContent();
 190                  }
 191              }
 192          });
 193      }
 194  
 195      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 196 -    public void onSaveObject(Bucket&lt;Note&gt; bucket, Note object){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 197 -        runOnUiThread(new Runnable(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 198 -            @Override public void run(){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +    public void onSaveObject(Bucket&lt;Note&gt; bucket, Note object) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +        runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 201 +            @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 202 +            public void run() {</span>
 203                  mNoteListFragment.refreshList();
 204              }
 205          });
 206      }
 207  
 208      @Override
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 209 -    public void onDeleteObject(Bucket&lt;Note&gt; bucket, Note object){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 210 -        runOnUiThread(new Runnable(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 211 -            @Override public void run(){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +    public void onDeleteObject(Bucket&lt;Note&gt; bucket, Note object) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +        runOnUiThread(new Runnable() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +            @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +            public void run() {</span>
 216                  mNoteListFragment.refreshList();
 217              }
 218          });
 219      }
 220  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 221 -    public boolean isTwoPane() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 222 -        return mTwoPane;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 223 +    public boolean isLargeScreen() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 224 +        return mIsLargeScreen;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 225 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 226 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 227 +    public boolean isLargeScreenLandscape() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 228 +        return mIsLargeScreen &amp;&amp; mIsLandscape;</span>
 229      }
 230  
 231      // nbradbury 01-Apr-2013
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 232 -	private NoteListFragment getNoteListFragment() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 233 -		return mNoteListFragment;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 234 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 235 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 236 -    private NoteEditorFragment getNoteEditorFragment() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 237 -        return ((NoteEditorFragment) getFragmentManager().findFragmentById(R.id.noteEditorFragment));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 238 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 239 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 240 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 241 -	public boolean onCreateOptionsMenu(Menu menu) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 242 -		super.onCreateOptionsMenu(menu);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 243 -		MenuInflater inflater = getMenuInflater();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 244 -		inflater.inflate(R.menu.notes_list, menu);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 245 +    private NoteListFragment getNoteListFragment() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 246 +        return mNoteListFragment;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 247 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 248 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 249 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 250 +    public boolean onCreateOptionsMenu(Menu menu) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 251 +        super.onCreateOptionsMenu(menu);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 252 +        MenuInflater inflater = getMenuInflater();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 253 +        inflater.inflate(R.menu.notes_list, menu);</span>
 254  
 255          mSearchMenuItem = menu.findItem(R.id.menu_search);
 256          mSearchView = (SearchView) mSearchMenuItem.getActionView();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 257 -        mSearchView.setOnQueryTextListener(new SearchView.OnQueryTextListener( ) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 258 +        mSearchView.setOnQueryTextListener(new SearchView.OnQueryTextListener() {</span>
 259              @Override
 260              public boolean onQueryTextChange(String newText) {
 261                  if (newText != null &amp;&amp; mSearchMenuItem.isActionViewExpanded())
 262                      getNoteListFragment().searchNotes(newText);
 263                  return true;
 264              }
 265  
 266              @Override
 267              public boolean onQueryTextSubmit(String queryText) {
 268                  if (queryText != null)
 269                      getNoteListFragment().searchNotes(queryText);
 270                  return true;
 271              }
 272          });
 273          mSearchMenuItem.setOnActionExpandListener(new MenuItem.OnActionExpandListener() {
 274              @Override
 275              public boolean onMenuItemActionExpand(MenuItem menuItem) {
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 276 +                showDetailPlaceholder();</span>
 277                  return true;
 278              }
 279  
 280              @Override
 281              public boolean onMenuItemActionCollapse(MenuItem menuItem) {
 282                  // Show all notes again
 283                  getNoteListFragment().clearSearch();
 284                  return true;
 285              }
 286          });
 287  
 288          FragmentManager fm = getFragmentManager();
 289          if (fm.getBackStackEntryCount() &gt; 0) {
 290              getActionBar().setDisplayHomeAsUpEnabled(true);
 291              menu.findItem(R.id.menu_create_note).setVisible(false);
 292              menu.findItem(R.id.menu_search).setVisible(false);
 293              menu.findItem(R.id.menu_preferences).setVisible(false);
 294              menu.findItem(R.id.menu_share).setVisible(true);
 295              menu.findItem(R.id.menu_delete).setVisible(true);
 296              if (mCurrentNote != null &amp;&amp; mCurrentNote.isDeleted())
 297                  menu.findItem(R.id.menu_delete).setTitle(R.string.undelete);
 298              menu.findItem(R.id.menu_edit_tags).setVisible(false);
 299              menu.findItem(R.id.menu_empty_trash).setVisible(false);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 300 -        } else if (mTwoPane) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 301 +        } else if (isLargeScreenLandscape()) {</span>
 302              getActionBar().setDisplayHomeAsUpEnabled(false);
 303              getActionBar().setHomeButtonEnabled(false);
 304              menu.findItem(R.id.menu_create_note).setVisible(true);
 305              menu.findItem(R.id.menu_search).setVisible(true);
 306              menu.findItem(R.id.menu_preferences).setVisible(true);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 307 -            menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 308 -            menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 309 +            if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 310 +                menu.findItem(R.id.menu_share).setVisible(true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 311 +                menu.findItem(R.id.menu_delete).setVisible(true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 312 +            } else {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 313 +                menu.findItem(R.id.menu_share).setVisible(false);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 314 +                menu.findItem(R.id.menu_delete).setVisible(false);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 315 +            }</span>
 316              menu.findItem(R.id.menu_edit_tags).setVisible(true);
 317              menu.findItem(R.id.menu_empty_trash).setVisible(false);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 318 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 319 -        } else  {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 320 +        } else {</span>
 321              getActionBar().setDisplayHomeAsUpEnabled(false);
 322              getActionBar().setHomeButtonEnabled(false);
 323              menu.findItem(R.id.menu_create_note).setVisible(true);
 324              menu.findItem(R.id.menu_search).setVisible(true);
 325              menu.findItem(R.id.menu_preferences).setVisible(true);
 326              menu.findItem(R.id.menu_share).setVisible(false);
 327              menu.findItem(R.id.menu_delete).setVisible(false);
 328              menu.findItem(R.id.menu_edit_tags).setVisible(true);
 329              menu.findItem(R.id.menu_empty_trash).setVisible(false);
 330          }
 331  
 332          // Are we looking at the trash? Adjust menu accordingly.
 333          if (getActionBar().getSelectedNavigationIndex() == TRASH_SELECTED_ID) {
 334              menu.findItem(R.id.menu_empty_trash).setVisible(true);
 335              menu.findItem(R.id.menu_create_note).setVisible(false);
 336              menu.findItem(R.id.menu_search).setVisible(false);
 337              menu.findItem(R.id.menu_share).setVisible(false);
 338          }
 339  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 340 -		return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 341 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 342 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 343 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 344 -	public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 345 -		switch (item.getItemId()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 346 -		case R.id.menu_preferences :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 347 -			// nbradbury - use startActivityForResult so onActivityResult can detect when user returns from preferences</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 348 -			Intent i = new Intent(this, PreferencesActivity.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 349 -			startActivityForResult(i, Simplenote.INTENT_PREFERENCES);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 350 -			return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 351 -        case R.id.menu_edit_tags :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 352 -            Intent editTagsIntent = new Intent(this, TagsListActivity.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 353 -            startActivity(editTagsIntent);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 354 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 355 -		case R.id.menu_create_note :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 356 -			getNoteListFragment().addNote();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 357 -			return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 358 -        case R.id.menu_share:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 359 -            if (mCurrentNote != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 360 -                Intent shareIntent = new Intent(android.content.Intent.ACTION_SEND);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 361 -                shareIntent.setType(&quot;text/plain&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 362 -                shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, mCurrentNote.getContent());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 363 -                startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.share_note)));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 364 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 365 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 366 -        case R.id.menu_delete:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 367 -            if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 368 +        return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 369 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 370 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 371 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 372 +    public boolean onOptionsItemSelected(MenuItem item) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 373 +        switch (item.getItemId()) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 374 +            case R.id.menu_preferences:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 375 +                // nbradbury - use startActivityForResult so onActivityResult can detect when user returns from preferences"> 375 +                // nbradbury - use startActivityForResult so onActivityResult can detect when user returns from prðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 376 +                Intent i = new Intent(this, PreferencesActivity.class);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 377 +                startActivityForResult(i, Simplenote.INTENT_PREFERENCES);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 378 +                return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 379 +            case R.id.menu_edit_tags:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 380 +                Intent editTagsIntent = new Intent(this, TagsListActivity.class);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 381 +                startActivity(editTagsIntent);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 382 +                return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 383 +            case R.id.menu_create_note:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 384 +                getNoteListFragment().addNote();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 385 +                return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 386 +            case R.id.menu_share:</span>
 387                  if (mCurrentNote != null) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 388 -                    mCurrentNote.setDeleted(!mCurrentNote.isDeleted());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 389 -                    mCurrentNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 390 -                    mCurrentNote.save();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 391 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 392 -                    if (mCurrentNote.isDeleted()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 393 -                        mUndoBarController.setDeletedNote(mCurrentNote);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 394 -                        mUndoBarController.showUndoBar(false, getString(R.string.note_deleted), null);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 395 +                    Intent shareIntent = new Intent(android.content.Intent.ACTION_SEND);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 396 +                    shareIntent.setType(&quot;text/plain&quot;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 397 +                    shareIntent.putExtra(android.content.Intent.EXTRA_TEXT, mCurrentNote.getContent());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 398 +                    startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.share_note)));"> 398 +                    startActivity(Intent.createChooser(shareIntent, getResources().getString(R.string.share_note))ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 399 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 400 +                return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 401 +            case R.id.menu_delete:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 402 +                if (mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 403 +                    if (mCurrentNote != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 404 +                        mCurrentNote.setDeleted(!mCurrentNote.isDeleted());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 405 +                        mCurrentNote.setModificationDate(Calendar.getInstance());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 406 +                        mCurrentNote.save();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 407 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 408 +                        if (mCurrentNote.isDeleted()) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 409 +                            mUndoBarController.setDeletedNote(mCurrentNote);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 410 +                            mUndoBarController.showUndoBar(false, getString(R.string.note_deleted), null);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 411 +                        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 412 +                        showDetailPlaceholder();</span>
 413                      }
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 414 -                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 415 +                    popNoteDetail();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 416 +                    NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 417 +                    if (fragment != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 418 +                        fragment.getPrefs();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 419 +                        fragment.refreshList();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 420 +                    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 421 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 422 +                return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 423 +            case R.id.menu_empty_trash:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 424 +                AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 425 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 426 +                alert.setTitle(R.string.empty_trash);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 427 +                alert.setMessage(R.string.confirm_empty_trash);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 428 +                alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 429 +                    public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 430 +                        new emptyTrashTask().execute();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 431 +                    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 432 +                });</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 433 +                alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 434 +                    public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 435 +                        // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 436 +                    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 437 +                });</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 438 +                alert.show();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 439 +                return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 440 +            case android.R.id.home:</span>
 441                  popNoteDetail();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 442 -                NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 443 -                if (fragment!=null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 444 -                    fragment.getPrefs();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 445 -                    fragment.refreshList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 446 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 447 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 448 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 449 -        case R.id.menu_empty_trash:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 450 -            AlertDialog.Builder alert = new AlertDialog.Builder(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 451 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 452 -            alert.setTitle(R.string.empty_trash);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 453 -            alert.setMessage(R.string.confirm_empty_trash);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 454 -            alert.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 455 -                public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 456 -                    new emptyTrashTask().execute();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 457 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 458 -            });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 459 -            alert.setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 460 -                public void onClick(DialogInterface dialog, int whichButton) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 461 -                    // Do nothing, just closing the dialog</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 462 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 463 -            });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 464 -            alert.show();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 465 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 466 -        case android.R.id.home:</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 467 -            popNoteDetail();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 468 -            invalidateOptionsMenu();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 469 -            return true;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 470 -		default :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 471 -			return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 472 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 473 -	}</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 474 +                invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 475 +                return true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 476 +            default:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 477 +                return super.onOptionsItemSelected(item);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 478 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 479 +    }</span>
 480  
 481      protected void popNoteDetail() {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 482 -        mCurrentNote = null;</span>
 483          FragmentManager fm = getFragmentManager();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 484 -        NoteEditorFragment f = (NoteEditorFragment) fm.findFragmentById(R.id.note_editor);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 485 -        if (f == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 486 +        if (fm.getBackStackEntryCount() &gt; 0) {</span>
 487              try {
 488                  fm.popBackStack();
 489              } catch (Exception e) {
 490                  e.printStackTrace();
 491              }
 492          }
 493      }
 494  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 495 -	/**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 496 -	 * Callback method from {@link NoteListFragment.Callbacks} indicating that</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 497 -	 * the item with the given ID was selected.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 498 -	 */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 499 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 500 -	public void onNoteSelected(Note note) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 501 +    /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 502 +     * Callback method from {@link NoteListFragment.Callbacks} indicating that</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 503 +     * the item with the given ID was selected.</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 504 +     */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 505 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 506 +    public void onNoteSelected(Note note) {</span>
 507  
 508          if (mSearchMenuItem != null)
 509              mSearchMenuItem.collapseActionView();
 510  
 511          mCurrentNote = note;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 512 -		String noteKey = note == null ? &quot;none&quot; : note.getSimperiumKey();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 513 +        String noteKey = note == null ? &quot;none&quot; : note.getSimperiumKey();</span>
 514  
 515          FragmentManager fm = getFragmentManager();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 516 -        NoteEditorFragment f = getNoteEditorFragment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 517 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 518 -        if (f == null || !f.isInLayout()) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 519 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 520 +        if (!isLargeScreenLandscape()) {</span>
 521              ActionBar ab = getActionBar();
 522              ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);
 523              ab.setDisplayShowTitleEnabled(true);
 524  
 525              // Create editor fragment
 526              Bundle arguments = new Bundle();
 527              arguments.putString(NoteEditorFragment.ARG_ITEM_ID, noteKey);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 528 -            f = new NoteEditorFragment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 529 -            f.setArguments(arguments);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 530 -            mNoteEditorFragment = f;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 531 +            mNoteEditorFragment = new NoteEditorFragment();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 532 +            mNoteEditorFragment.setArguments(arguments);</span>
 533  
 534              // Add editor fragment to stack
 535              FragmentTransaction ft = fm.beginTransaction();
<abbr title=" 536              ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_and_fade, R.animator.slide_out);"> 536              ft.setCustomAnimations(R.animator.slide_in, R.animator.zoom_in_and_fade, R.animator.zoom_out_and_fade,ðŸ”µ</abbr>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 537 -            ft.replace(R.id.noteFragmentContainer, f);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 538 +            ft.replace(R.id.noteFragmentContainer, mNoteEditorFragment);</span>
 539              ft.addToBackStack(null);
 540              ft.commit();
 541              fm.executePendingTransactions();
 542          } else {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 543 -            f.setNote(note);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 544 +            mNoteEditorFragment.setNote(note);</span>
 545              getNoteListFragment().setNoteSelected(note);
 546          }
 547  
 548          invalidateOptionsMenu();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 549 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 550 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 551 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 552 -	public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 553 -		// TODO Auto-generated method stub</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 554 -		return false;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 555 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 556 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 557 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 558 -	public void onAuthenticationStatusChange(User.AuthenticationStatus status){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 559 -		if ( status == User.AuthenticationStatus.NOT_AUTHENTICATED ) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 560 -			startLoginActivity();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 561 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 562 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 563 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 564 -	public void startLoginActivity(){</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 565 -		Intent loginIntent = new Intent(this, LoginActivity.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 566 -		startActivityForResult(loginIntent, Simperium.SIGNUP_SIGNIN_REQUEST);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 567 -	}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 568 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 569 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 570 -	@Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 571 -	protected void onActivityResult(int requestCode, int resultCode, Intent data) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 572 -		super.onActivityResult(requestCode, resultCode, data);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 573 -		switch (requestCode) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 574 -		case Simperium.SIGNUP_SIGNIN_REQUEST :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 575 -			if (resultCode == RESULT_CANCELED)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 576 -				 finish();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 577 -			break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 578 -		case Simplenote.INTENT_PREFERENCES :</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 579 -			// nbradbury - refresh note list when user returns from preferences (in case they changed anything)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 580 -			NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 581 -			if (fragment!=null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 582 -				fragment.getPrefs();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 583 -				fragment.refreshList();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 584 -			}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 585 -			break;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 586 -		}</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 587 -	}</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 588 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 589 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 590 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 591 +    public boolean onNavigationItemSelected(int itemPosition, long itemId) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 592 +        // TODO Auto-generated method stub</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 593 +        return false;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 594 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 595 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 596 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 597 +    public void onAuthenticationStatusChange(User.AuthenticationStatus status) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 598 +        if (status == User.AuthenticationStatus.NOT_AUTHENTICATED) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 599 +            startLoginActivity();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 600 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 601 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 602 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 603 +    public void startLoginActivity() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 604 +        Intent loginIntent = new Intent(this, LoginActivity.class);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 605 +        startActivityForResult(loginIntent, Simperium.SIGNUP_SIGNIN_REQUEST);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 606 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 607 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 608 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 609 +    @Override</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 610 +    protected void onActivityResult(int requestCode, int resultCode, Intent data) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 611 +        super.onActivityResult(requestCode, resultCode, data);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 612 +        switch (requestCode) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 613 +            case Simperium.SIGNUP_SIGNIN_REQUEST:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 614 +                if (resultCode == RESULT_CANCELED)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 615 +                    finish();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 616 +                break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 617 +            case Simplenote.INTENT_PREFERENCES:</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 618 +                // nbradbury - refresh note list when user returns from preferences (in case they changed anything)"> 618 +                // nbradbury - refresh note list when user returns from preferences (in case they changed anythingðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 619 +                NoteListFragment fragment = getNoteListFragment();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 620 +                if (fragment != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 621 +                    fragment.getPrefs();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 622 +                    fragment.refreshList();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 623 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 624 +                break;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 625 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 626 +    }</span>
 627  
 628      @Override
 629      public void onUndo(Parcelable p) {
 630          if (mUndoBarController != null &amp;&amp; mUndoBarController.getDeletedNote() != null) {
 631              Note deletedNote = mUndoBarController.getDeletedNote();
 632              if (deletedNote != null) {
 633                  deletedNote.setDeleted(false);
 634                  deletedNote.setModificationDate(Calendar.getInstance());
 635                  deletedNote.save();
 636                  NoteListFragment fragment = getNoteListFragment();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 637 -                if (fragment!=null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 638 +                if (fragment != null) {</span>
 639                      fragment.getPrefs();
 640                      fragment.refreshList();
 641                  }
 642              }
 643          }
 644      }
 645  
 646      @Override
 647      public void onBackStackChanged() {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 648 -</span>
 649          configureActionBar();
 650          invalidateOptionsMenu();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 651 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 652 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 653 -    /**</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 654 -     * If a note is changed that is being displayed in the NoteEditorFragment, update its content</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 655 -     * @param note</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 656 -     */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 657 -    public void onNoteChanged(Note note) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 658 -        if (mCurrentNote != null &amp;&amp; mNoteEditorFragment != null &amp;&amp; mNoteEditorFragment.isVisible()) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 659 -            if (note.getSimperiumKey().equals(mCurrentNote.getSimperiumKey())) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 660 -                if (note.isDeleted())</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 661 -                    popNoteDetail();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 662 -                else</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 663 -                    mNoteEditorFragment.setNote(note);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 664 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 665 -        }</span>
 666      }
 667  
 668      private void configureActionBar() {
 669          if (getFragmentManager().getBackStackEntryCount() &gt; 0) {
 670              ActionBar ab = getActionBar();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 671 -            ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 672 -            ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 673 +            if (ab != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 674 +                ab.setNavigationMode(ActionBar.NAVIGATION_MODE_STANDARD);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 675 +                ab.setDisplayShowTitleEnabled(true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 676 +            }</span>
 677          } else {
 678              ActionBar ab = getActionBar();
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 679 -            ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 680 -            ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 681 +            if (ab != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 682 +                ab.setNavigationMode(ActionBar.NAVIGATION_MODE_LIST);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 683 +                ab.setDisplayShowTitleEnabled(false);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 684 +            }</span>
 685          }
 686      }
 687  
 688      @Override
 689      public void onConfigurationChanged(Configuration newConfig) {
 690          super.onConfigurationChanged(newConfig);
 691  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 692 -        // If we are on a tablet, we will restart the activity to adjust the layout accordingly</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 693 -        if ((getBaseContext().getResources().getConfiguration().screenLayout</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 694 -                &amp; Configuration.SCREENLAYOUT_SIZE_MASK)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 695 -                &gt;= Configuration.SCREENLAYOUT_SIZE_LARGE) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 696 -            finish();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 697 -            startActivity(getIntent());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 698 +        if (mIsLargeScreen) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 699 +            if (newConfig.orientation == Configuration.ORIENTATION_LANDSCAPE) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 700 +                // Add the editor fragment</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 701 +                mIsLandscape = true;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 702 +                popNoteDetail();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 703 +                addEditorFragment();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 704 +                if (mNoteListFragment != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 705 +                    mNoteListFragment.setActivateOnItemClick(true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 706 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 707 +                // Select the current note on a tablet</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 708 +                if (mCurrentNote != null)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 709 +                    onNoteSelected(mCurrentNote);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 710 +                invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"><abbr title=" 711 +            } else if (newConfig.orientation == Configuration.ORIENTATION_PORTRAIT &amp;&amp; mNoteEditorFragment != null) {"> 711 +            } else if (newConfig.orientation == Configuration.ORIENTATION_PORTRAIT &amp;&amp; mNoteEditorFragment != null)ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 712 +                // Remove the editor fragment when rotating back to portrait</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 713 +                mIsLandscape = false;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 714 +                mCurrentNote = null;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 715 +                if (mNoteListFragment != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 716 +                    mNoteListFragment.setActivateOnItemClick(false);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 717 +                    mNoteListFragment.refreshList();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 718 +                }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 719 +                FragmentManager fm = getFragmentManager();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 720 +                FragmentTransaction ft = fm.beginTransaction();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 721 +                ft.remove(mNoteEditorFragment);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 722 +                mNoteEditorFragment = null;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 723 +                ft.commit();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 724 +                fm.executePendingTransactions();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 725 +                invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 726 +            }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 727 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 728 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 729 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 730 +    public void showDetailPlaceholder() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 731 +        if (isLargeScreenLandscape() &amp;&amp; mNoteEditorFragment != null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 732 +            mCurrentNote = null;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 733 +            invalidateOptionsMenu();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 734 +            mNoteEditorFragment.setPlaceholderVisible(true);</span>
 735          }
 736      }
 737  
 738      private class emptyTrashTask extends AsyncTask&lt;Void, Void, Void&gt; {
 739  
 740          @Override
 741          protected Void doInBackground(Void... voids) {
 742              Simplenote application = (Simplenote) getApplication();
 743              Bucket&lt;Note&gt; noteBucket = application.getNotesBucket();
 744              Query&lt;Note&gt; query = Note.allDeleted(noteBucket);
 745              Bucket.ObjectCursor c = query.execute();
 746              while (c.moveToNext()) {
 747                  c.getObject().delete();
 748              }
 749              return null;
 750          }
 751      }
 752  
 753  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            