<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>32</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    32
                    <a href="31.html">prev</a>
                    <a href="33.html">next</a>
                    <a href="32_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_1469ca1ceaae9c691eee7790de89a3ee1f571403_Aria/src/main/java/com/arialyy/aria/core/download/DNormalConfigHandler.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;1469ca1ceaae9c691eee7790de89a3ee1f571403:Aria/src/main/java/com/arialyy/aria/core/download/DNormalConfigHandler.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;1469ca1ceaae9c691eee7790de89a3ee1f571403^1:Aria/src/main/java/com/arialyy/aria/core/download/DNormalConfigHandler.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;1469ca1ceaae9c691eee7790de89a3ee1f571403^2:Aria/src/main/java/com/arialyy/aria/core/download/DNormalConfigHandler.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;39a43c836d3309cbbf82de6d51309fe71fc25292:Aria/src/main/java/com/arialyy/aria/core/download/DNormalConfigHandler.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj]], subset: [[bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="1987357580077471394" onmouseenter="enter('1987357580077471394');" onmouseout="out('1987357580077471394');" style="">  16 package com.arialyy.aria.core.download;                                                                  </span>
<span  style="">  17                                                                                                          </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  18 import android.text.TextUtils;                                                                           </span>
<span class="-5436107826461583981" onmouseenter="enter('-5436107826461583981');" onmouseout="out('-5436107826461583981');" style="">  19 import com.arialyy.aria.core.common.RecordHandler;                                                       </span>
<span class="-6718284849408348377" onmouseenter="enter('-6718284849408348377');" onmouseout="out('-6718284849408348377');" style="">  20 import com.arialyy.aria.core.inf.ITargetHandler;                                                         </span>
<span class="-5823694385311893910" onmouseenter="enter('-5823694385311893910');" onmouseout="out('-5823694385311893910');" style="">  21 import com.arialyy.aria.core.inf.IConfigHandler;                                                         </span>
<span class="-1066657515660882744" onmouseenter="enter('-1066657515660882744');" onmouseout="out('-1066657515660882744');" style="">  22 import com.arialyy.aria.core.inf.ITaskWrapper;                                                           </span>
<span class="-5215055405907005508" onmouseenter="enter('-5215055405907005508');" onmouseout="out('-5215055405907005508');" style="">  23 import com.arialyy.aria.core.manager.TaskWrapperManager;                                                 </span>
<span class="1325372506799583582" onmouseenter="enter('1325372506799583582');" onmouseout="out('1325372506799583582');" style="">  24 import com.arialyy.aria.core.queue.DownloadTaskQueue;                                                    </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="">  25 import com.arialyy.aria.orm.DbEntity;                                                                    </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  26 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="">  27 import com.arialyy.aria.util.CheckUtil;                                                                  </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  28 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  29 import java.io.File;                                                                                     </span>
<span  style="">  30                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  31 /**                                                                                                      </span>
<span class="7597099774466160207" onmouseenter="enter('7597099774466160207');" onmouseout="out('7597099774466160207');" style="">  32  * Created by AriaL on 2019/4/5.                                                                         </span>
<span class="3422522262515451071" onmouseenter="enter('3422522262515451071');" onmouseout="out('3422522262515451071');" style="">  33  * 普通下载任务通用功能处理                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  34  */                                                                                                      </span>
<span class="2742237136458932806" onmouseenter="enter('2742237136458932806');" onmouseout="out('2742237136458932806');" style="">  35 class DNormalConfigHandler&lt;TARGET extends AbsDTarget&gt; implements IConfigHandler {                        </span>
<span class="-7372503279915444591" onmouseenter="enter('-7372503279915444591');" onmouseout="out('-7372503279915444591');" style="">  36   private final String TAG = &quot;DNormalDelegate&quot;;                                                          </span>
<span class="-7151375780097547664" onmouseenter="enter('-7151375780097547664');" onmouseout="out('-7151375780097547664');" style="">  37   private DownloadEntity mEntity;                                                                        </span>
<span  style="">  38                                                                                                          </span>
<span class="-3489765475635404017" onmouseenter="enter('-3489765475635404017');" onmouseout="out('-3489765475635404017');" style="">  39   private TARGET mTarget;                                                                                </span>
<span class="2647968472095192659" onmouseenter="enter('2647968472095192659');" onmouseout="out('2647968472095192659');" style="">  40   private String mNewUrl;                                                                                </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  41   /**                                                                                                    </span>
<span class="6485233792679084311" onmouseenter="enter('6485233792679084311');" onmouseout="out('6485233792679084311');" style="">  42    * 设置的文件保存路径的临时变量                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  43    */                                                                                                    </span>
<span class="-5089493777035932819" onmouseenter="enter('-5089493777035932819');" onmouseout="out('-5089493777035932819');" style="">  44   private String mTempFilePath;                                                                          </span>
<span  style="">  45                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  46   /**                                                                                                    </span>
<span class="195428192144817990" onmouseenter="enter('195428192144817990');" onmouseout="out('195428192144817990');" style="">  47    * {@code true}强制下载，不考虑文件路径是否被占用                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  48    */                                                                                                    </span>
<span class="-4358061151799660356" onmouseenter="enter('-4358061151799660356');" onmouseout="out('-4358061151799660356');" style="">  49   private boolean forceDownload = false;                                                                 </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50   /**                                                                                                    </span>
<span class="6373136269286593797" onmouseenter="enter('6373136269286593797');" onmouseout="out('6373136269286593797');" style="">  51    * 资源地址                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52    */                                                                                                    </span>
<span class="-4666459667448884810" onmouseenter="enter('-4666459667448884810');" onmouseout="out('-4666459667448884810');" style="">  53   private String mUrl;                                                                                   </span>
<span  style="">  54                                                                                                          </span>
<span class="2604798818932390268" onmouseenter="enter('2604798818932390268');" onmouseout="out('2604798818932390268');" style="">  55   DNormalConfigHandler(TARGET target, String url, String targetName) {                                   </span>
<span class="2322551504984416874" onmouseenter="enter('2322551504984416874');" onmouseout="out('2322551504984416874');" style="">  56     this.mTarget = target;                                                                               </span>
<span class="-1928045164341053889" onmouseenter="enter('-1928045164341053889');" onmouseout="out('-1928045164341053889');" style="">  57     initTarget(url, targetName);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  58   }                                                                                                      </span>
<span  style="">  59                                                                                                          </span>
<span class="7357043619638252702" onmouseenter="enter('7357043619638252702');" onmouseout="out('7357043619638252702');" style="">  60   private void initTarget(String url, String targetName) {                                               </span>
<span class="-7814926717258655490" onmouseenter="enter('-7814926717258655490');" onmouseout="out('-7814926717258655490');" style="">  61     DTaskWrapper taskWrapper =                                                                           </span>
<span class="8017401012004002052" onmouseenter="enter('8017401012004002052');" onmouseout="out('8017401012004002052');" style="">  62         TaskWrapperManager.getInstance().getHttpTaskWrapper(DTaskWrapper.class, url);                    </span>
<span class="-170355754520114419" onmouseenter="enter('-170355754520114419');" onmouseout="out('-170355754520114419');" style="">  63     mEntity = taskWrapper.getEntity();                                                                   </span>
<span  style="">  64                                                                                                          </span>
<span class="1562715920388719156" onmouseenter="enter('1562715920388719156');" onmouseout="out('1562715920388719156');" style="">  65     mUrl = url;                                                                                          </span>
<span class="-5254143723305914900" onmouseenter="enter('-5254143723305914900');" onmouseout="out('-5254143723305914900');" style="">  66     mTarget.setTargetName(targetName);                                                                   </span>
<span class="-4561194400435442390" onmouseenter="enter('-4561194400435442390');" onmouseout="out('-4561194400435442390');" style="">  67     mTarget.setTaskWrapper(taskWrapper);                                                                 </span>
<span class="-5413073826946610003" onmouseenter="enter('-5413073826946610003');" onmouseout="out('-5413073826946610003');" style="">  68     if (mEntity != null) {                                                                               </span>
<span class="-2536879354012732317" onmouseenter="enter('-2536879354012732317');" onmouseout="out('-2536879354012732317');" style="">  69       mTempFilePath = mEntity.getDownloadPath();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  71   }                                                                                                      </span>
<span  style="">  72                                                                                                          </span>
<span class="-5838768387595209871" onmouseenter="enter('-5838768387595209871');" onmouseout="out('-5838768387595209871');" style="">  73   TARGET updateUrl(String newUrl) {                                                                      </span>
<span class="-5368255699338505910" onmouseenter="enter('-5368255699338505910');" onmouseout="out('-5368255699338505910');" style="">  74     if (TextUtils.isEmpty(newUrl)) {                                                                     </span>
<span class="2522835170679629804" onmouseenter="enter('2522835170679629804');" onmouseout="out('2522835170679629804');" style="">  75       ALog.e(TAG, &quot;url更新失败，newUrl为null&quot;);                                                                </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  76       return mTarget;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77     }                                                                                                    </span>
<span class="8228776452656032178" onmouseenter="enter('8228776452656032178');" onmouseout="out('8228776452656032178');" style="">  78     if (mUrl.equals(newUrl)) {                                                                           </span>
<span class="-7719663091563319527" onmouseenter="enter('-7719663091563319527');" onmouseout="out('-7719663091563319527');" style="">  79       ALog.e(TAG, &quot;url更新失败，新的下载url和旧的url一致&quot;);                                                            </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  80       return mTarget;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81     }                                                                                                    </span>
<span class="6519280323062656940" onmouseenter="enter('6519280323062656940');" onmouseout="out('6519280323062656940');" style="">  82     mNewUrl = newUrl;                                                                                    </span>
<span class="8606773977048106405" onmouseenter="enter('8606773977048106405');" onmouseout="out('8606773977048106405');" style="">  83     mTarget.getTaskWrapper().setRefreshInfo(true);                                                       </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  84     return mTarget;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85   }                                                                                                      </span>
<span  style="">  86                                                                                                          </span>
<span class="3925984219716663695" onmouseenter="enter('3925984219716663695');" onmouseout="out('3925984219716663695');" style="">  87   @Override public DownloadEntity getEntity() {                                                          </span>
<span class="3197424121678592902" onmouseenter="enter('3197424121678592902');" onmouseout="out('3197424121678592902');" style="">  88     return mTarget.getEntity();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89   }                                                                                                      </span>
<span  style="">  90                                                                                                          </span>
<span class="1075165609880937393" onmouseenter="enter('1075165609880937393');" onmouseout="out('1075165609880937393');" style="">  91   @Override public boolean taskExists() {                                                                </span>
<span class="-5863139567803442221" onmouseenter="enter('-5863139567803442221');" onmouseout="out('-5863139567803442221');" style="">  92     return DbEntity.checkDataExist(DownloadEntity.class, &quot;url=?&quot;, mUrl);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93   }                                                                                                      </span>
<span  style="">  94                                                                                                          </span>
<span class="-2237798856776801835" onmouseenter="enter('-2237798856776801835');" onmouseout="out('-2237798856776801835');" style="">  95   @Override public boolean isRunning() {                                                                 </span>
<span class="-8503785353792972956" onmouseenter="enter('-8503785353792972956');" onmouseout="out('-8503785353792972956');" style="">  96     DownloadTask task = DownloadTaskQueue.getInstance().getTask(mEntity.getKey());                       </span>
<span class="8820906724240250180" onmouseenter="enter('8820906724240250180');" onmouseout="out('8820906724240250180');" style="">  97     return task != null &amp;&amp; task.isRunning();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98   }                                                                                                      </span>
<span  style="">  99                                                                                                          </span>
<span class="-8488247163298459201" onmouseenter="enter('-8488247163298459201');" onmouseout="out('-8488247163298459201');" style=""> 100   @Override public boolean checkEntity() {                                                               </span>
<span class="-4755455099353720689" onmouseenter="enter('-4755455099353720689');" onmouseout="out('-4755455099353720689');" style=""> 101     boolean b = checkUrl() &amp;&amp; checkFilePath();                                                           </span>
<span class="-2738921756999881711" onmouseenter="enter('-2738921756999881711');" onmouseout="out('-2738921756999881711');" style=""> 102     if (b) {                                                                                             </span>
<span class="4960404293197380702" onmouseenter="enter('4960404293197380702');" onmouseout="out('4960404293197380702');" style=""> 103       mEntity.save();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104     }                                                                                                    </span>
<span class="1146953079077988653" onmouseenter="enter('1146953079077988653');" onmouseout="out('1146953079077988653');" style=""> 105     if (mTarget.getTaskWrapper().getRequestType() == ITaskWrapper.M3U8_FILE                              </span>
<span class="3955310445710168480" onmouseenter="enter('3955310445710168480');" onmouseout="out('3955310445710168480');" style=""> 106         &amp;&amp; mEntity.getFileSize() == 0) {                                                                 </span>
<span class="6288741116764239163" onmouseenter="enter('6288741116764239163');" onmouseout="out('6288741116764239163');" style=""> 107       ALog.e(TAG, &quot;由于m3u8协议的特殊性质，你需要设置文件长度才能获取到正确的下载进度百分比。设置方法：asM3U8().setFileSize(xxx)&quot;);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108     }                                                                                                    </span>
<span class="936248907371687111" onmouseenter="enter('936248907371687111');" onmouseout="out('936248907371687111');" style=""> 109     return b;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110   }                                                                                                      </span>
<span  style=""> 111                                                                                                          </span>
<span class="2315226245822525054" onmouseenter="enter('2315226245822525054');" onmouseout="out('2315226245822525054');" style=""> 112   @Override public boolean checkFilePath() {                                                             </span>
<span class="-4113555342808554142" onmouseenter="enter('-4113555342808554142');" onmouseout="out('-4113555342808554142');" style=""> 113     String filePath = mTempFilePath;                                                                     </span>
<span class="-6994367488724183364" onmouseenter="enter('-6994367488724183364');" onmouseout="out('-6994367488724183364');" style=""> 114     if (TextUtils.isEmpty(filePath)) {                                                                   </span>
<span class="1987302035889598125" onmouseenter="enter('1987302035889598125');" onmouseout="out('1987302035889598125');" style=""> 115       ALog.e(TAG, &quot;下载失败，文件保存路径为null&quot;);                                                                   </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 116       return false;                                                                                      </span>
<span class="-1271117581964116578" onmouseenter="enter('-1271117581964116578');" onmouseout="out('-1271117581964116578');" style=""> 117     } else if (!filePath.startsWith(&quot;/&quot;)) {                                                              </span>
<span class="557040637554213161" onmouseenter="enter('557040637554213161');" onmouseout="out('557040637554213161');" style=""> 118       ALog.e(TAG, String.format(&quot;下载失败，文件保存路径【%s】错误&quot;, filePath));                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 119       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120     }                                                                                                    </span>
<span class="-5372495718115618479" onmouseenter="enter('-5372495718115618479');" onmouseout="out('-5372495718115618479');" style=""> 121     File file = new File(filePath);                                                                      </span>
<span class="5597017681458557475" onmouseenter="enter('5597017681458557475');" onmouseout="out('5597017681458557475');" style=""> 122     if (file.isDirectory()) {                                                                            </span>
<span class="-8716383513248807425" onmouseenter="enter('-8716383513248807425');" onmouseout="out('-8716383513248807425');" style=""> 123       if (mTarget.getTargetType() == ITargetHandler.D_HTTP) {                                            </span>
<span class="-7418838447060081867" onmouseenter="enter('-7418838447060081867');" onmouseout="out('-7418838447060081867');" style=""> 124         ALog.e(TAG,                                                                                      </span>
<span class="-4949808999024829762" onmouseenter="enter('-4949808999024829762');" onmouseout="out('-4949808999024829762');" style=""> 125             String.format(&quot;下载失败，保存路径【%s】不能为文件夹，路径需要是完整的文件路径，如：/mnt/sdcard/game.zip&quot;, filePath));         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 126         return false;                                                                                    </span>
<span class="8212045059945516931" onmouseenter="enter('8212045059945516931');" onmouseout="out('8212045059945516931');" style=""> 127       } else if (mTarget.getTargetType() == ITargetHandler.D_FTP) {                                      </span>
<span class="-5967191989776548956" onmouseenter="enter('-5967191989776548956');" onmouseout="out('-5967191989776548956');" style=""> 128         filePath += mEntity.getFileName();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129       }                                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 130     } else {                                                                                             </span>
<span class="-2693990311935632905" onmouseenter="enter('-2693990311935632905');" onmouseout="out('-2693990311935632905');" style=""> 131       // http文件名设置                                                                                       </span>
<span class="3813164140265311506" onmouseenter="enter('3813164140265311506');" onmouseout="out('3813164140265311506');" style=""> 132       if (TextUtils.isEmpty(mEntity.getFileName())) {                                                    </span>
<span class="-7403226259664797230" onmouseenter="enter('-7403226259664797230');" onmouseout="out('-7403226259664797230');" style=""> 133         mEntity.setFileName(file.getName());                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135     }                                                                                                    </span>
<span  style=""> 136                                                                                                          </span>
<span class="7046651474144336438" onmouseenter="enter('7046651474144336438');" onmouseout="out('7046651474144336438');" style=""> 137     //设置文件保存路径，如果新文件路径和旧文件路径不同，则修改路径                                                                     </span>
<span class="-6183616590478680880" onmouseenter="enter('-6183616590478680880');" onmouseout="out('-6183616590478680880');" style=""> 138     if (!filePath.equals(mEntity.getFilePath())) {                                                       </span>
<span class="-6159259354933661527" onmouseenter="enter('-6159259354933661527');" onmouseout="out('-6159259354933661527');" style=""> 139       // 检查路径冲突                                                                                          </span>
<span class="-5013370222743809449" onmouseenter="enter('-5013370222743809449');" onmouseout="out('-5013370222743809449');" style=""> 140       if (DbEntity.checkDataExist(DownloadEntity.class, &quot;downloadPath=?&quot;, filePath)) {                   </span>
<span class="-8973098192989046635" onmouseenter="enter('-8973098192989046635');" onmouseout="out('-8973098192989046635');" style=""> 141         if (!forceDownload) {                                                                            </span>
<span class="-3314950676687962234" onmouseenter="enter('-3314950676687962234');" onmouseout="out('-3314950676687962234');" style=""> 142           ALog.e(TAG, String.format(&quot;下载失败，保存路径【%s】已经被其它任务占用，请设置其它保存路径&quot;, filePath));                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 143           return false;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 144         } else {                                                                                         </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style=""> 145 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-8473780373304024264" onmouseenter="enter('-8473780373304024264');" onmouseout="out('-8473780373304024264');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 146           ALog.w(TAG, String.format(&quot;保存路径【%s】已经被其它任务占用，当前任务将覆盖该路径的文件&quot;, filePath));                       </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style=""> 147 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="3383431197806422731" onmouseenter="enter('3383431197806422731');" onmouseout="out('3383431197806422731');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148           CommonUtil.delTaskRecord(filePath, 1);                                                         </span>
<span class="9015032310080894565" onmouseenter="enter('9015032310080894565');" onmouseout="out('9015032310080894565');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149           mTarget.setTaskWrapper(                                                                        </span>
<span class="-4218059376366094834" onmouseenter="enter('-4218059376366094834');" onmouseout="out('-4218059376366094834');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150               TaskWrapperManager.getInstance()                                                           </span>
<span class="3760515178664551150" onmouseenter="enter('3760515178664551150');" onmouseout="out('3760515178664551150');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151                   .getHttpTaskWrapper(DTaskWrapper.class, mUrl));                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153       }                                                                                                  </span>
<span class="8188086071101431655" onmouseenter="enter('8188086071101431655');" onmouseout="out('8188086071101431655');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154       File oldFile = new File(mEntity.getDownloadPath());                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 155 =======                                                                                                  </span>
<span class="-206658163419639453" onmouseenter="enter('-206658163419639453');" onmouseout="out('-206658163419639453');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156           ALog.w(TAG, &quot;保存路径【&quot; + filePath + &quot;】已经被其它任务占用，当前任务将覆盖该路径的文件&quot;);                                  </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style=""> 157 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="7589218718991287215" onmouseenter="enter('7589218718991287215');" onmouseout="out('7589218718991287215');" style=""> 158           CommonUtil.delTaskRecord(filePath, RecordHandler.TYPE_DOWNLOAD);                               </span>
<span class="9015032310080894565" onmouseenter="enter('9015032310080894565');" onmouseout="out('9015032310080894565');" style=""> 159           mTarget.setTaskWrapper(                                                                        </span>
<span class="-4218059376366094834" onmouseenter="enter('-4218059376366094834');" onmouseout="out('-4218059376366094834');" style=""> 160               TaskWrapperManager.getInstance()                                                           </span>
<span class="3760515178664551150" onmouseenter="enter('3760515178664551150');" onmouseout="out('3760515178664551150');" style=""> 161                   .getHttpTaskWrapper(DTaskWrapper.class, mUrl));                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163       }                                                                                                  </span>
<span class="8188086071101431655" onmouseenter="enter('8188086071101431655');" onmouseout="out('8188086071101431655');" style=""> 164       File oldFile = new File(mEntity.getDownloadPath());                                                </span>
<span class="6616899398988523664" onmouseenter="enter('6616899398988523664');" onmouseout="out('6616899398988523664');" style=""> 165       File newFile = new File(filePath);                                                                 </span>
<span class="378286578219875436" onmouseenter="enter('378286578219875436');" onmouseout="out('378286578219875436');" style=""> 166       mEntity.setFilePath(filePath);                                                                     </span>
<span class="-4241403741477214391" onmouseenter="enter('-4241403741477214391');" onmouseout="out('-4241403741477214391');" style=""> 167       mEntity.setFileName(newFile.getName());                                                            </span>
<span class="7124105241097814126" onmouseenter="enter('7124105241097814126');" onmouseout="out('7124105241097814126');" style=""> 168       // 如过使用Content-Disposition中的文件名，将不会执行重命名工作                                                         </span>
<span class="-4631271115819406630" onmouseenter="enter('-4631271115819406630');" onmouseout="out('-4631271115819406630');" style=""> 169       if (mTarget.getTaskWrapper().asHttp().isUseServerFileName()) {                                     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 170         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171       }                                                                                                  </span>
<span class="-8664365027300439044" onmouseenter="enter('-8664365027300439044');" onmouseout="out('-8664365027300439044');" style=""> 172       if (oldFile.exists()) {                                                                            </span>
<span class="-9109224338502104344" onmouseenter="enter('-9109224338502104344');" onmouseout="out('-9109224338502104344');" style=""> 173         // 处理普通任务的重命名                                                                                    </span>
<span class="8842642762873802608" onmouseenter="enter('8842642762873802608');" onmouseout="out('8842642762873802608');" style=""> 174         CommonUtil.modifyTaskRecord(oldFile.getPath(), newFile.getPath());                               </span>
<span class="-1145532542364013010" onmouseenter="enter('-1145532542364013010');" onmouseout="out('-1145532542364013010');" style=""> 175         ALog.i(TAG, String.format(&quot;将任务重命名为：%s&quot;, newFile.getName()));                                     </span>
<span class="-6831818809327823926" onmouseenter="enter('-6831818809327823926');" onmouseout="out('-6831818809327823926');" style=""> 176       } else if (CommonUtil.blockTaskExists(oldFile.getPath())) {                                        </span>
<span class="-8977472813847143391" onmouseenter="enter('-8977472813847143391');" onmouseout="out('-8977472813847143391');" style=""> 177         // 处理分块任务的重命名                                                                                    </span>
<span class="8842642762873802608" onmouseenter="enter('8842642762873802608');" onmouseout="out('8842642762873802608');" style=""> 178         CommonUtil.modifyTaskRecord(oldFile.getPath(), newFile.getPath());                               </span>
<span class="-5498388326427379103" onmouseenter="enter('-5498388326427379103');" onmouseout="out('-5498388326427379103');" style=""> 179         ALog.i(TAG, String.format(&quot;将分块任务重命名为：%s&quot;, newFile.getName()));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 182     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183   }                                                                                                      </span>
<span  style=""> 184                                                                                                          </span>
<span class="1095370405184132274" onmouseenter="enter('1095370405184132274');" onmouseout="out('1095370405184132274');" style=""> 185   @Override public boolean checkUrl() {                                                                  </span>
<span class="-9182647005430820691" onmouseenter="enter('-9182647005430820691');" onmouseout="out('-9182647005430820691');" style=""> 186     final String url = mEntity.getUrl();                                                                 </span>
<span class="-5295066653448859718" onmouseenter="enter('-5295066653448859718');" onmouseout="out('-5295066653448859718');" style=""> 187     if (TextUtils.isEmpty(url)) {                                                                        </span>
<span class="-7527183944737711639" onmouseenter="enter('-7527183944737711639');" onmouseout="out('-7527183944737711639');" style=""> 188       ALog.e(TAG, &quot;下载失败，url为null&quot;);                                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 189       return false;                                                                                      </span>
<span class="2564503102818611052" onmouseenter="enter('2564503102818611052');" onmouseout="out('2564503102818611052');" style=""> 190     } else if (!CheckUtil.checkUrlNotThrow(url)) {                                                       </span>
<span class="-5966032732048138672" onmouseenter="enter('-5966032732048138672');" onmouseout="out('-5966032732048138672');" style=""> 191       ALog.e(TAG, &quot;下载失败，url【&quot; + url + &quot;】错误&quot;);                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 192       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193     }                                                                                                    </span>
<span class="-2484573064810891496" onmouseenter="enter('-2484573064810891496');" onmouseout="out('-2484573064810891496');" style=""> 194     int index = url.indexOf(&quot;://&quot;);                                                                      </span>
<span class="8271637489381568226" onmouseenter="enter('8271637489381568226');" onmouseout="out('8271637489381568226');" style=""> 195     if (index == -1) {                                                                                   </span>
<span class="-7978673376412591020" onmouseenter="enter('-7978673376412591020');" onmouseout="out('-7978673376412591020');" style=""> 196       ALog.e(TAG, &quot;下载失败，url【&quot; + url + &quot;】不合法&quot;);                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 197       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198     }                                                                                                    </span>
<span class="-4096355108037590089" onmouseenter="enter('-4096355108037590089');" onmouseout="out('-4096355108037590089');" style=""> 199     if (!TextUtils.isEmpty(mNewUrl)) {                                                                   </span>
<span class="-947626375768951452" onmouseenter="enter('-947626375768951452');" onmouseout="out('-947626375768951452');" style=""> 200       mEntity.setUrl(mNewUrl);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 202     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203   }                                                                                                      </span>
<span  style=""> 204                                                                                                          </span>
<span class="9080430511956105708" onmouseenter="enter('9080430511956105708');" onmouseout="out('9080430511956105708');" style=""> 205   void setForceDownload(boolean forceDownload) {                                                         </span>
<span class="-4055237448265976267" onmouseenter="enter('-4055237448265976267');" onmouseout="out('-4055237448265976267');" style=""> 206     this.forceDownload = forceDownload;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207   }                                                                                                      </span>
<span  style=""> 208                                                                                                          </span>
<span class="-5102073700561919125" onmouseenter="enter('-5102073700561919125');" onmouseout="out('-5102073700561919125');" style=""> 209   void setUrl(String url) {                                                                              </span>
<span class="6125552069257613507" onmouseenter="enter('6125552069257613507');" onmouseout="out('6125552069257613507');" style=""> 210     this.mUrl = url;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 211   }                                                                                                      </span>
<span  style=""> 212                                                                                                          </span>
<span class="-7069907651445876169" onmouseenter="enter('-7069907651445876169');" onmouseout="out('-7069907651445876169');" style=""> 213   String getUrl() {                                                                                      </span>
<span class="-466968703615862041" onmouseenter="enter('-466968703615862041');" onmouseout="out('-466968703615862041');" style=""> 214     return mUrl;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 215   }                                                                                                      </span>
<span  style=""> 216                                                                                                          </span>
<span class="-4100688759878726932" onmouseenter="enter('-4100688759878726932');" onmouseout="out('-4100688759878726932');" style=""> 217   void setTempFilePath(String mTempFilePath) {                                                           </span>
<span class="4672554542879215190" onmouseenter="enter('4672554542879215190');" onmouseout="out('4672554542879215190');" style=""> 218     this.mTempFilePath = mTempFilePath;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="1987357580077471394" onmouseenter="enter('1987357580077471394');" onmouseout="out('1987357580077471394');" style="">  16 package com.arialyy.aria.core.download;                                                                  </span>
<span  style="">  17                                                                                                          </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  18 import android.text.TextUtils;                                                                           </span>
<span class="-5436107826461583981" onmouseenter="enter('-5436107826461583981');" onmouseout="out('-5436107826461583981');" style="">  19 import com.arialyy.aria.core.common.RecordHandler;                                                       </span>
<span class="-6718284849408348377" onmouseenter="enter('-6718284849408348377');" onmouseout="out('-6718284849408348377');" style="">  20 import com.arialyy.aria.core.inf.ITargetHandler;                                                         </span>
<span class="-5823694385311893910" onmouseenter="enter('-5823694385311893910');" onmouseout="out('-5823694385311893910');" style="">  21 import com.arialyy.aria.core.inf.IConfigHandler;                                                         </span>
<span class="-1066657515660882744" onmouseenter="enter('-1066657515660882744');" onmouseout="out('-1066657515660882744');" style="">  22 import com.arialyy.aria.core.inf.ITaskWrapper;                                                           </span>
<span class="-5215055405907005508" onmouseenter="enter('-5215055405907005508');" onmouseout="out('-5215055405907005508');" style="">  23 import com.arialyy.aria.core.manager.TaskWrapperManager;                                                 </span>
<span class="1325372506799583582" onmouseenter="enter('1325372506799583582');" onmouseout="out('1325372506799583582');" style="">  24 import com.arialyy.aria.core.queue.DownloadTaskQueue;                                                    </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="">  25 import com.arialyy.aria.orm.DbEntity;                                                                    </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  26 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="">  27 import com.arialyy.aria.util.CheckUtil;                                                                  </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  28 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  29 import java.io.File;                                                                                     </span>
<span  style="">  30                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  31 /**                                                                                                      </span>
<span class="7597099774466160207" onmouseenter="enter('7597099774466160207');" onmouseout="out('7597099774466160207');" style="">  32  * Created by AriaL on 2019/4/5.                                                                         </span>
<span class="3422522262515451071" onmouseenter="enter('3422522262515451071');" onmouseout="out('3422522262515451071');" style="">  33  * 普通下载任务通用功能处理                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  34  */                                                                                                      </span>
<span  style="">  35                                                                                                          </span>
<span  style="">  36                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  37 /**                                                                                                      </span>
<span class="7597099774466160207" onmouseenter="enter('7597099774466160207');" onmouseout="out('7597099774466160207');" style="">  38  * Created by AriaL on 2019/4/5.                                                                         </span>
<span class="3422522262515451071" onmouseenter="enter('3422522262515451071');" onmouseout="out('3422522262515451071');" style="">  39  * 普通下载任务通用功能处理                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  40  */                                                                                                      </span>
<span class="2742237136458932806" onmouseenter="enter('2742237136458932806');" onmouseout="out('2742237136458932806');" style="">  41 class DNormalConfigHandler&lt;TARGET extends AbsDTarget&gt; implements IConfigHandler {                        </span>
<span class="-7372503279915444591" onmouseenter="enter('-7372503279915444591');" onmouseout="out('-7372503279915444591');" style="">  42   private final String TAG = &quot;DNormalDelegate&quot;;                                                          </span>
<span class="-7151375780097547664" onmouseenter="enter('-7151375780097547664');" onmouseout="out('-7151375780097547664');" style="">  43   private DownloadEntity mEntity;                                                                        </span>
<span  style="">  44                                                                                                          </span>
<span class="-3489765475635404017" onmouseenter="enter('-3489765475635404017');" onmouseout="out('-3489765475635404017');" style="">  45   private TARGET mTarget;                                                                                </span>
<span class="2647968472095192659" onmouseenter="enter('2647968472095192659');" onmouseout="out('2647968472095192659');" style="">  46   private String mNewUrl;                                                                                </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  47   /**                                                                                                    </span>
<span class="6485233792679084311" onmouseenter="enter('6485233792679084311');" onmouseout="out('6485233792679084311');" style="">  48    * 设置的文件保存路径的临时变量                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  49    */                                                                                                    </span>
<span class="-5089493777035932819" onmouseenter="enter('-5089493777035932819');" onmouseout="out('-5089493777035932819');" style="">  50   private String mTempFilePath;                                                                          </span>
<span  style="">  51                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  52   /**                                                                                                    </span>
<span class="195428192144817990" onmouseenter="enter('195428192144817990');" onmouseout="out('195428192144817990');" style="">  53    * {@code true}强制下载，不考虑文件路径是否被占用                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  54    */                                                                                                    </span>
<span class="-4358061151799660356" onmouseenter="enter('-4358061151799660356');" onmouseout="out('-4358061151799660356');" style="">  55   private boolean forceDownload = false;                                                                 </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  56   /**                                                                                                    </span>
<span class="6373136269286593797" onmouseenter="enter('6373136269286593797');" onmouseout="out('6373136269286593797');" style="">  57    * 资源地址                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  58    */                                                                                                    </span>
<span class="-4666459667448884810" onmouseenter="enter('-4666459667448884810');" onmouseout="out('-4666459667448884810');" style="">  59   private String mUrl;                                                                                   </span>
<span  style="">  60                                                                                                          </span>
<span class="2604798818932390268" onmouseenter="enter('2604798818932390268');" onmouseout="out('2604798818932390268');" style="">  61   DNormalConfigHandler(TARGET target, String url, String targetName) {                                   </span>
<span class="2322551504984416874" onmouseenter="enter('2322551504984416874');" onmouseout="out('2322551504984416874');" style="">  62     this.mTarget = target;                                                                               </span>
<span class="-1928045164341053889" onmouseenter="enter('-1928045164341053889');" onmouseout="out('-1928045164341053889');" style="">  63     initTarget(url, targetName);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  64   }                                                                                                      </span>
<span  style="">  65                                                                                                          </span>
<span class="7357043619638252702" onmouseenter="enter('7357043619638252702');" onmouseout="out('7357043619638252702');" style="">  66   private void initTarget(String url, String targetName) {                                               </span>
<span class="-7814926717258655490" onmouseenter="enter('-7814926717258655490');" onmouseout="out('-7814926717258655490');" style="">  67     DTaskWrapper taskWrapper =                                                                           </span>
<span class="8017401012004002052" onmouseenter="enter('8017401012004002052');" onmouseout="out('8017401012004002052');" style="">  68         TaskWrapperManager.getInstance().getHttpTaskWrapper(DTaskWrapper.class, url);                    </span>
<span class="-170355754520114419" onmouseenter="enter('-170355754520114419');" onmouseout="out('-170355754520114419');" style="">  69     mEntity = taskWrapper.getEntity();                                                                   </span>
<span  style="">  70                                                                                                          </span>
<span class="1562715920388719156" onmouseenter="enter('1562715920388719156');" onmouseout="out('1562715920388719156');" style="">  71     mUrl = url;                                                                                          </span>
<span class="-5254143723305914900" onmouseenter="enter('-5254143723305914900');" onmouseout="out('-5254143723305914900');" style="">  72     mTarget.setTargetName(targetName);                                                                   </span>
<span class="-4561194400435442390" onmouseenter="enter('-4561194400435442390');" onmouseout="out('-4561194400435442390');" style="">  73     mTarget.setTaskWrapper(taskWrapper);                                                                 </span>
<span class="-5413073826946610003" onmouseenter="enter('-5413073826946610003');" onmouseout="out('-5413073826946610003');" style="">  74     if (mEntity != null) {                                                                               </span>
<span class="-2536879354012732317" onmouseenter="enter('-2536879354012732317');" onmouseout="out('-2536879354012732317');" style="">  75       mTempFilePath = mEntity.getDownloadPath();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77   }                                                                                                      </span>
<span  style="">  78                                                                                                          </span>
<span class="-5838768387595209871" onmouseenter="enter('-5838768387595209871');" onmouseout="out('-5838768387595209871');" style="">  79   TARGET updateUrl(String newUrl) {                                                                      </span>
<span class="-5368255699338505910" onmouseenter="enter('-5368255699338505910');" onmouseout="out('-5368255699338505910');" style="">  80     if (TextUtils.isEmpty(newUrl)) {                                                                     </span>
<span class="2522835170679629804" onmouseenter="enter('2522835170679629804');" onmouseout="out('2522835170679629804');" style="">  81       ALog.e(TAG, &quot;url更新失败，newUrl为null&quot;);                                                                </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  82       return mTarget;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83     }                                                                                                    </span>
<span class="8228776452656032178" onmouseenter="enter('8228776452656032178');" onmouseout="out('8228776452656032178');" style="">  84     if (mUrl.equals(newUrl)) {                                                                           </span>
<span class="-7719663091563319527" onmouseenter="enter('-7719663091563319527');" onmouseout="out('-7719663091563319527');" style="">  85       ALog.e(TAG, &quot;url更新失败，新的下载url和旧的url一致&quot;);                                                            </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  86       return mTarget;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  87     }                                                                                                    </span>
<span class="6519280323062656940" onmouseenter="enter('6519280323062656940');" onmouseout="out('6519280323062656940');" style="">  88     mNewUrl = newUrl;                                                                                    </span>
<span class="8606773977048106405" onmouseenter="enter('8606773977048106405');" onmouseout="out('8606773977048106405');" style="">  89     mTarget.getTaskWrapper().setRefreshInfo(true);                                                       </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  90     return mTarget;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  91   }                                                                                                      </span>
<span  style="">  92                                                                                                          </span>
<span class="3925984219716663695" onmouseenter="enter('3925984219716663695');" onmouseout="out('3925984219716663695');" style="">  93   @Override public DownloadEntity getEntity() {                                                          </span>
<span class="3197424121678592902" onmouseenter="enter('3197424121678592902');" onmouseout="out('3197424121678592902');" style="">  94     return mTarget.getEntity();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  95   }                                                                                                      </span>
<span  style="">  96                                                                                                          </span>
<span class="1075165609880937393" onmouseenter="enter('1075165609880937393');" onmouseout="out('1075165609880937393');" style="">  97   @Override public boolean taskExists() {                                                                </span>
<span class="-5863139567803442221" onmouseenter="enter('-5863139567803442221');" onmouseout="out('-5863139567803442221');" style="">  98     return DbEntity.checkDataExist(DownloadEntity.class, &quot;url=?&quot;, mUrl);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  99   }                                                                                                      </span>
<span  style=""> 100                                                                                                          </span>
<span class="-2237798856776801835" onmouseenter="enter('-2237798856776801835');" onmouseout="out('-2237798856776801835');" style=""> 101   @Override public boolean isRunning() {                                                                 </span>
<span class="-8503785353792972956" onmouseenter="enter('-8503785353792972956');" onmouseout="out('-8503785353792972956');" style=""> 102     DownloadTask task = DownloadTaskQueue.getInstance().getTask(mEntity.getKey());                       </span>
<span class="8820906724240250180" onmouseenter="enter('8820906724240250180');" onmouseout="out('8820906724240250180');" style=""> 103     return task != null &amp;&amp; task.isRunning();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104   }                                                                                                      </span>
<span  style=""> 105                                                                                                          </span>
<span class="-8488247163298459201" onmouseenter="enter('-8488247163298459201');" onmouseout="out('-8488247163298459201');" style=""> 106   @Override public boolean checkEntity() {                                                               </span>
<span class="-4755455099353720689" onmouseenter="enter('-4755455099353720689');" onmouseout="out('-4755455099353720689');" style=""> 107     boolean b = checkUrl() &amp;&amp; checkFilePath();                                                           </span>
<span class="-2738921756999881711" onmouseenter="enter('-2738921756999881711');" onmouseout="out('-2738921756999881711');" style=""> 108     if (b) {                                                                                             </span>
<span class="4960404293197380702" onmouseenter="enter('4960404293197380702');" onmouseout="out('4960404293197380702');" style=""> 109       mEntity.save();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110     }                                                                                                    </span>
<span class="1146953079077988653" onmouseenter="enter('1146953079077988653');" onmouseout="out('1146953079077988653');" style=""> 111     if (mTarget.getTaskWrapper().getRequestType() == ITaskWrapper.M3U8_FILE                              </span>
<span class="3955310445710168480" onmouseenter="enter('3955310445710168480');" onmouseout="out('3955310445710168480');" style=""> 112         &amp;&amp; mEntity.getFileSize() == 0) {                                                                 </span>
<span class="6288741116764239163" onmouseenter="enter('6288741116764239163');" onmouseout="out('6288741116764239163');" style=""> 113       ALog.e(TAG, &quot;由于m3u8协议的特殊性质，你需要设置文件长度才能获取到正确的下载进度百分比。设置方法：asM3U8().setFileSize(xxx)&quot;);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 114     }                                                                                                    </span>
<span class="936248907371687111" onmouseenter="enter('936248907371687111');" onmouseout="out('936248907371687111');" style=""> 115     return b;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 116   }                                                                                                      </span>
<span  style=""> 117                                                                                                          </span>
<span class="2315226245822525054" onmouseenter="enter('2315226245822525054');" onmouseout="out('2315226245822525054');" style=""> 118   @Override public boolean checkFilePath() {                                                             </span>
<span class="-4113555342808554142" onmouseenter="enter('-4113555342808554142');" onmouseout="out('-4113555342808554142');" style=""> 119     String filePath = mTempFilePath;                                                                     </span>
<span class="-6994367488724183364" onmouseenter="enter('-6994367488724183364');" onmouseout="out('-6994367488724183364');" style=""> 120     if (TextUtils.isEmpty(filePath)) {                                                                   </span>
<span class="1987302035889598125" onmouseenter="enter('1987302035889598125');" onmouseout="out('1987302035889598125');" style=""> 121       ALog.e(TAG, &quot;下载失败，文件保存路径为null&quot;);                                                                   </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 122       return false;                                                                                      </span>
<span class="-1271117581964116578" onmouseenter="enter('-1271117581964116578');" onmouseout="out('-1271117581964116578');" style=""> 123     } else if (!filePath.startsWith(&quot;/&quot;)) {                                                              </span>
<span class="557040637554213161" onmouseenter="enter('557040637554213161');" onmouseout="out('557040637554213161');" style=""> 124       ALog.e(TAG, String.format(&quot;下载失败，文件保存路径【%s】错误&quot;, filePath));                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 125       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126     }                                                                                                    </span>
<span class="-5372495718115618479" onmouseenter="enter('-5372495718115618479');" onmouseout="out('-5372495718115618479');" style=""> 127     File file = new File(filePath);                                                                      </span>
<span class="5597017681458557475" onmouseenter="enter('5597017681458557475');" onmouseout="out('5597017681458557475');" style=""> 128     if (file.isDirectory()) {                                                                            </span>
<span class="-8716383513248807425" onmouseenter="enter('-8716383513248807425');" onmouseout="out('-8716383513248807425');" style=""> 129       if (mTarget.getTargetType() == ITargetHandler.D_HTTP) {                                            </span>
<span class="-7418838447060081867" onmouseenter="enter('-7418838447060081867');" onmouseout="out('-7418838447060081867');" style=""> 130         ALog.e(TAG,                                                                                      </span>
<span class="-4949808999024829762" onmouseenter="enter('-4949808999024829762');" onmouseout="out('-4949808999024829762');" style=""> 131             String.format(&quot;下载失败，保存路径【%s】不能为文件夹，路径需要是完整的文件路径，如：/mnt/sdcard/game.zip&quot;, filePath));         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 132         return false;                                                                                    </span>
<span class="8212045059945516931" onmouseenter="enter('8212045059945516931');" onmouseout="out('8212045059945516931');" style=""> 133       } else if (mTarget.getTargetType() == ITargetHandler.D_FTP) {                                      </span>
<span class="-5967191989776548956" onmouseenter="enter('-5967191989776548956');" onmouseout="out('-5967191989776548956');" style=""> 134         filePath += mEntity.getFileName();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135       }                                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 136     } else {                                                                                             </span>
<span class="-2693990311935632905" onmouseenter="enter('-2693990311935632905');" onmouseout="out('-2693990311935632905');" style=""> 137       // http文件名设置                                                                                       </span>
<span class="3813164140265311506" onmouseenter="enter('3813164140265311506');" onmouseout="out('3813164140265311506');" style=""> 138       if (TextUtils.isEmpty(mEntity.getFileName())) {                                                    </span>
<span class="-7403226259664797230" onmouseenter="enter('-7403226259664797230');" onmouseout="out('-7403226259664797230');" style=""> 139         mEntity.setFileName(file.getName());                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141     }                                                                                                    </span>
<span  style=""> 142                                                                                                          </span>
<span class="7046651474144336438" onmouseenter="enter('7046651474144336438');" onmouseout="out('7046651474144336438');" style=""> 143     //设置文件保存路径，如果新文件路径和旧文件路径不同，则修改路径                                                                     </span>
<span class="-6183616590478680880" onmouseenter="enter('-6183616590478680880');" onmouseout="out('-6183616590478680880');" style=""> 144     if (!filePath.equals(mEntity.getFilePath())) {                                                       </span>
<span class="-6159259354933661527" onmouseenter="enter('-6159259354933661527');" onmouseout="out('-6159259354933661527');" style=""> 145       // 检查路径冲突                                                                                          </span>
<span class="-5013370222743809449" onmouseenter="enter('-5013370222743809449');" onmouseout="out('-5013370222743809449');" style=""> 146       if (DbEntity.checkDataExist(DownloadEntity.class, &quot;downloadPath=?&quot;, filePath)) {                   </span>
<span class="-8973098192989046635" onmouseenter="enter('-8973098192989046635');" onmouseout="out('-8973098192989046635');" style=""> 147         if (!forceDownload) {                                                                            </span>
<span class="-3314950676687962234" onmouseenter="enter('-3314950676687962234');" onmouseout="out('-3314950676687962234');" style=""> 148           ALog.e(TAG, String.format(&quot;下载失败，保存路径【%s】已经被其它任务占用，请设置其它保存路径&quot;, filePath));                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 149           return false;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 150         } else {                                                                                         </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style=""> 151 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-8473780373304024264" onmouseenter="enter('-8473780373304024264');" onmouseout="out('-8473780373304024264');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0"> 152           ALog.w(TAG, String.format(&quot;保存路径【%s】已经被其它任务占用，当前任务将覆盖该路径的文件&quot;, filePath));                       </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style=""> 153 ||||||| BASE                                                                                             </span>
<span class="-206658163419639453" onmouseenter="enter('-206658163419639453');" onmouseout="out('-206658163419639453');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154           ALog.w(TAG, &quot;保存路径【&quot; + filePath + &quot;】已经被其它任务占用，当前任务将覆盖该路径的文件&quot;);                                  </span>
<span class="3383431197806422731" onmouseenter="enter('3383431197806422731');" onmouseout="out('3383431197806422731');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155           CommonUtil.delTaskRecord(filePath, 1);                                                         </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style=""> 156 =======                                                                                                  </span>
<span class="-206658163419639453" onmouseenter="enter('-206658163419639453');" onmouseout="out('-206658163419639453');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157           ALog.w(TAG, &quot;保存路径【&quot; + filePath + &quot;】已经被其它任务占用，当前任务将覆盖该路径的文件&quot;);                                  </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style=""> 158 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="7589218718991287215" onmouseenter="enter('7589218718991287215');" onmouseout="out('7589218718991287215');" style=""> 159           CommonUtil.delTaskRecord(filePath, RecordHandler.TYPE_DOWNLOAD);                               </span>
<span class="9015032310080894565" onmouseenter="enter('9015032310080894565');" onmouseout="out('9015032310080894565');" style=""> 160           mTarget.setTaskWrapper(                                                                        </span>
<span class="-4218059376366094834" onmouseenter="enter('-4218059376366094834');" onmouseout="out('-4218059376366094834');" style=""> 161               TaskWrapperManager.getInstance()                                                           </span>
<span class="3760515178664551150" onmouseenter="enter('3760515178664551150');" onmouseout="out('3760515178664551150');" style=""> 162                   .getHttpTaskWrapper(DTaskWrapper.class, mUrl));                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164       }                                                                                                  </span>
<span class="8188086071101431655" onmouseenter="enter('8188086071101431655');" onmouseout="out('8188086071101431655');" style=""> 165       File oldFile = new File(mEntity.getDownloadPath());                                                </span>
<span class="6616899398988523664" onmouseenter="enter('6616899398988523664');" onmouseout="out('6616899398988523664');" style=""> 166       File newFile = new File(filePath);                                                                 </span>
<span class="378286578219875436" onmouseenter="enter('378286578219875436');" onmouseout="out('378286578219875436');" style=""> 167       mEntity.setFilePath(filePath);                                                                     </span>
<span class="-4241403741477214391" onmouseenter="enter('-4241403741477214391');" onmouseout="out('-4241403741477214391');" style=""> 168       mEntity.setFileName(newFile.getName());                                                            </span>
<span class="7124105241097814126" onmouseenter="enter('7124105241097814126');" onmouseout="out('7124105241097814126');" style=""> 169       // 如过使用Content-Disposition中的文件名，将不会执行重命名工作                                                         </span>
<span class="-4631271115819406630" onmouseenter="enter('-4631271115819406630');" onmouseout="out('-4631271115819406630');" style=""> 170       if (mTarget.getTaskWrapper().asHttp().isUseServerFileName()) {                                     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 171         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 172       }                                                                                                  </span>
<span class="-8664365027300439044" onmouseenter="enter('-8664365027300439044');" onmouseout="out('-8664365027300439044');" style=""> 173       if (oldFile.exists()) {                                                                            </span>
<span class="-9109224338502104344" onmouseenter="enter('-9109224338502104344');" onmouseout="out('-9109224338502104344');" style=""> 174         // 处理普通任务的重命名                                                                                    </span>
<span class="8842642762873802608" onmouseenter="enter('8842642762873802608');" onmouseout="out('8842642762873802608');" style=""> 175         CommonUtil.modifyTaskRecord(oldFile.getPath(), newFile.getPath());                               </span>
<span class="-1145532542364013010" onmouseenter="enter('-1145532542364013010');" onmouseout="out('-1145532542364013010');" style=""> 176         ALog.i(TAG, String.format(&quot;将任务重命名为：%s&quot;, newFile.getName()));                                     </span>
<span class="-6831818809327823926" onmouseenter="enter('-6831818809327823926');" onmouseout="out('-6831818809327823926');" style=""> 177       } else if (CommonUtil.blockTaskExists(oldFile.getPath())) {                                        </span>
<span class="-8977472813847143391" onmouseenter="enter('-8977472813847143391');" onmouseout="out('-8977472813847143391');" style=""> 178         // 处理分块任务的重命名                                                                                    </span>
<span class="8842642762873802608" onmouseenter="enter('8842642762873802608');" onmouseout="out('8842642762873802608');" style=""> 179         CommonUtil.modifyTaskRecord(oldFile.getPath(), newFile.getPath());                               </span>
<span class="-5498388326427379103" onmouseenter="enter('-5498388326427379103');" onmouseout="out('-5498388326427379103');" style=""> 180         ALog.i(TAG, String.format(&quot;将分块任务重命名为：%s&quot;, newFile.getName()));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 183     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 184   }                                                                                                      </span>
<span  style=""> 185                                                                                                          </span>
<span class="1095370405184132274" onmouseenter="enter('1095370405184132274');" onmouseout="out('1095370405184132274');" style=""> 186   @Override public boolean checkUrl() {                                                                  </span>
<span class="-9182647005430820691" onmouseenter="enter('-9182647005430820691');" onmouseout="out('-9182647005430820691');" style=""> 187     final String url = mEntity.getUrl();                                                                 </span>
<span class="-5295066653448859718" onmouseenter="enter('-5295066653448859718');" onmouseout="out('-5295066653448859718');" style=""> 188     if (TextUtils.isEmpty(url)) {                                                                        </span>
<span class="-7527183944737711639" onmouseenter="enter('-7527183944737711639');" onmouseout="out('-7527183944737711639');" style=""> 189       ALog.e(TAG, &quot;下载失败，url为null&quot;);                                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 190       return false;                                                                                      </span>
<span class="2564503102818611052" onmouseenter="enter('2564503102818611052');" onmouseout="out('2564503102818611052');" style=""> 191     } else if (!CheckUtil.checkUrlNotThrow(url)) {                                                       </span>
<span class="-5966032732048138672" onmouseenter="enter('-5966032732048138672');" onmouseout="out('-5966032732048138672');" style=""> 192       ALog.e(TAG, &quot;下载失败，url【&quot; + url + &quot;】错误&quot;);                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 193       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 194     }                                                                                                    </span>
<span class="-2484573064810891496" onmouseenter="enter('-2484573064810891496');" onmouseout="out('-2484573064810891496');" style=""> 195     int index = url.indexOf(&quot;://&quot;);                                                                      </span>
<span class="8271637489381568226" onmouseenter="enter('8271637489381568226');" onmouseout="out('8271637489381568226');" style=""> 196     if (index == -1) {                                                                                   </span>
<span class="-7978673376412591020" onmouseenter="enter('-7978673376412591020');" onmouseout="out('-7978673376412591020');" style=""> 197       ALog.e(TAG, &quot;下载失败，url【&quot; + url + &quot;】不合法&quot;);                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 198       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199     }                                                                                                    </span>
<span class="-4096355108037590089" onmouseenter="enter('-4096355108037590089');" onmouseout="out('-4096355108037590089');" style=""> 200     if (!TextUtils.isEmpty(mNewUrl)) {                                                                   </span>
<span class="-947626375768951452" onmouseenter="enter('-947626375768951452');" onmouseout="out('-947626375768951452');" style=""> 201       mEntity.setUrl(mNewUrl);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 203     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204   }                                                                                                      </span>
<span  style=""> 205                                                                                                          </span>
<span class="9080430511956105708" onmouseenter="enter('9080430511956105708');" onmouseout="out('9080430511956105708');" style=""> 206   void setForceDownload(boolean forceDownload) {                                                         </span>
<span class="-4055237448265976267" onmouseenter="enter('-4055237448265976267');" onmouseout="out('-4055237448265976267');" style=""> 207     this.forceDownload = forceDownload;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208   }                                                                                                      </span>
<span  style=""> 209                                                                                                          </span>
<span class="-5102073700561919125" onmouseenter="enter('-5102073700561919125');" onmouseout="out('-5102073700561919125');" style=""> 210   void setUrl(String url) {                                                                              </span>
<span class="6125552069257613507" onmouseenter="enter('6125552069257613507');" onmouseout="out('6125552069257613507');" style=""> 211     this.mUrl = url;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 212   }                                                                                                      </span>
<span  style=""> 213                                                                                                          </span>
<span class="-7069907651445876169" onmouseenter="enter('-7069907651445876169');" onmouseout="out('-7069907651445876169');" style=""> 214   String getUrl() {                                                                                      </span>
<span class="-466968703615862041" onmouseenter="enter('-466968703615862041');" onmouseout="out('-466968703615862041');" style=""> 215     return mUrl;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216   }                                                                                                      </span>
<span  style=""> 217                                                                                                          </span>
<span class="-4100688759878726932" onmouseenter="enter('-4100688759878726932');" onmouseout="out('-4100688759878726932');" style=""> 218   void setTempFilePath(String mTempFilePath) {                                                           </span>
<span class="4672554542879215190" onmouseenter="enter('4672554542879215190');" onmouseout="out('4672554542879215190');" style=""> 219     this.mTempFilePath = mTempFilePath;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 220   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 221 }                                                                                                        </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1 /*                                                                                                       </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                           </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3  *                                                                                                       </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                       </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5  * you may not use this file except in compliance with the License.                                      </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6  * You may obtain a copy of the License at                                                               </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7  *                                                                                                       </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8  *      http://www.apache.org/licenses/LICENSE-2.0                                                       </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9  *                                                                                                       </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10  * Unless required by applicable law or agreed to in writing, software                                   </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                     </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                              </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13  * See the License for the specific language governing permissions and                                   </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14  * limitations under the License.                                                                        </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15  */                                                                                                      </span>
<span class="1987357580077471394" onmouseenter="enter('1987357580077471394');" onmouseout="out('1987357580077471394');" style="">  16 package com.arialyy.aria.core.download;                                                                  </span>
<span  style="">  17                                                                                                          </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  18 import android.text.TextUtils;                                                                           </span>
<span class="-5436107826461583981" onmouseenter="enter('-5436107826461583981');" onmouseout="out('-5436107826461583981');" style="">  19 import com.arialyy.aria.core.common.RecordHandler;                                                       </span>
<span class="-5823694385311893910" onmouseenter="enter('-5823694385311893910');" onmouseout="out('-5823694385311893910');" style="">  20 import com.arialyy.aria.core.inf.IConfigHandler;                                                         </span>
<span class="-6718284849408348377" onmouseenter="enter('-6718284849408348377');" onmouseout="out('-6718284849408348377');" style="">  21 import com.arialyy.aria.core.inf.ITargetHandler;                                                         </span>
<span class="-1066657515660882744" onmouseenter="enter('-1066657515660882744');" onmouseout="out('-1066657515660882744');" style="">  22 import com.arialyy.aria.core.inf.ITaskWrapper;                                                           </span>
<span class="-5215055405907005508" onmouseenter="enter('-5215055405907005508');" onmouseout="out('-5215055405907005508');" style="">  23 import com.arialyy.aria.core.manager.TaskWrapperManager;                                                 </span>
<span class="1325372506799583582" onmouseenter="enter('1325372506799583582');" onmouseout="out('1325372506799583582');" style="">  24 import com.arialyy.aria.core.queue.DownloadTaskQueue;                                                    </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="">  25 import com.arialyy.aria.orm.DbEntity;                                                                    </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  26 import com.arialyy.aria.util.ALog;                                                                       </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="">  27 import com.arialyy.aria.util.CheckUtil;                                                                  </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  28 import com.arialyy.aria.util.CommonUtil;                                                                 </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  29 import java.io.File;                                                                                     </span>
<span  style="">  30                                                                                                          </span>
<span  style="">  31                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  32 /**                                                                                                      </span>
<span class="7597099774466160207" onmouseenter="enter('7597099774466160207');" onmouseout="out('7597099774466160207');" style="">  33  * Created by AriaL on 2019/4/5.                                                                         </span>
<span class="3422522262515451071" onmouseenter="enter('3422522262515451071');" onmouseout="out('3422522262515451071');" style="">  34  * 普通下载任务通用功能处理                                                                                          </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  35  */                                                                                                      </span>
<span class="2742237136458932806" onmouseenter="enter('2742237136458932806');" onmouseout="out('2742237136458932806');" style="">  36 class DNormalConfigHandler&lt;TARGET extends AbsDTarget&gt; implements IConfigHandler {                        </span>
<span class="-7372503279915444591" onmouseenter="enter('-7372503279915444591');" onmouseout="out('-7372503279915444591');" style="">  37   private final String TAG = &quot;DNormalDelegate&quot;;                                                          </span>
<span  style="">  38                                                                                                          </span>
<span class="-7151375780097547664" onmouseenter="enter('-7151375780097547664');" onmouseout="out('-7151375780097547664');" style="">  39   private DownloadEntity mEntity;                                                                        </span>
<span  style="">  40                                                                                                          </span>
<span class="-3489765475635404017" onmouseenter="enter('-3489765475635404017');" onmouseout="out('-3489765475635404017');" style="">  41   private TARGET mTarget;                                                                                </span>
<span  style="">  42                                                                                                          </span>
<span class="2647968472095192659" onmouseenter="enter('2647968472095192659');" onmouseout="out('2647968472095192659');" style="">  43   private String mNewUrl;                                                                                </span>
<span  style="">  44                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  45   /**                                                                                                    </span>
<span class="6485233792679084311" onmouseenter="enter('6485233792679084311');" onmouseout="out('6485233792679084311');" style="">  46    * 设置的文件保存路径的临时变量                                                                                      </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  47    */                                                                                                    </span>
<span class="-5089493777035932819" onmouseenter="enter('-5089493777035932819');" onmouseout="out('-5089493777035932819');" style="">  48   private String mTempFilePath;                                                                          </span>
<span  style="">  49                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50   /**                                                                                                    </span>
<span class="195428192144817990" onmouseenter="enter('195428192144817990');" onmouseout="out('195428192144817990');" style="">  51    * {@code true}强制下载，不考虑文件路径是否被占用                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52    */                                                                                                    </span>
<span class="-4358061151799660356" onmouseenter="enter('-4358061151799660356');" onmouseout="out('-4358061151799660356');" style="">  53   private boolean forceDownload = false;                                                                 </span>
<span  style="">  54                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55   /**                                                                                                    </span>
<span class="6373136269286593797" onmouseenter="enter('6373136269286593797');" onmouseout="out('6373136269286593797');" style="">  56    * 资源地址                                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  57    */                                                                                                    </span>
<span class="-4666459667448884810" onmouseenter="enter('-4666459667448884810');" onmouseout="out('-4666459667448884810');" style="">  58   private String mUrl;                                                                                   </span>
<span  style="">  59                                                                                                          </span>
<span class="2604798818932390268" onmouseenter="enter('2604798818932390268');" onmouseout="out('2604798818932390268');" style="">  60   DNormalConfigHandler(TARGET target, String url, String targetName) {                                   </span>
<span class="2322551504984416874" onmouseenter="enter('2322551504984416874');" onmouseout="out('2322551504984416874');" style="">  61     this.mTarget = target;                                                                               </span>
<span class="-1928045164341053889" onmouseenter="enter('-1928045164341053889');" onmouseout="out('-1928045164341053889');" style="">  62     initTarget(url, targetName);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  63   }                                                                                                      </span>
<span  style="">  64                                                                                                          </span>
<span class="7357043619638252702" onmouseenter="enter('7357043619638252702');" onmouseout="out('7357043619638252702');" style="">  65   private void initTarget(String url, String targetName) {                                               </span>
<span class="-7814926717258655490" onmouseenter="enter('-7814926717258655490');" onmouseout="out('-7814926717258655490');" style="">  66     DTaskWrapper taskWrapper =                                                                           </span>
<span class="8017401012004002052" onmouseenter="enter('8017401012004002052');" onmouseout="out('8017401012004002052');" style="">  67         TaskWrapperManager.getInstance().getHttpTaskWrapper(DTaskWrapper.class, url);                    </span>
<span class="-170355754520114419" onmouseenter="enter('-170355754520114419');" onmouseout="out('-170355754520114419');" style="">  68     mEntity = taskWrapper.getEntity();                                                                   </span>
<span  style="">  69                                                                                                          </span>
<span class="1562715920388719156" onmouseenter="enter('1562715920388719156');" onmouseout="out('1562715920388719156');" style="">  70     mUrl = url;                                                                                          </span>
<span class="-5254143723305914900" onmouseenter="enter('-5254143723305914900');" onmouseout="out('-5254143723305914900');" style="">  71     mTarget.setTargetName(targetName);                                                                   </span>
<span class="-4561194400435442390" onmouseenter="enter('-4561194400435442390');" onmouseout="out('-4561194400435442390');" style="">  72     mTarget.setTaskWrapper(taskWrapper);                                                                 </span>
<span class="-5413073826946610003" onmouseenter="enter('-5413073826946610003');" onmouseout="out('-5413073826946610003');" style="">  73     if (mEntity != null) {                                                                               </span>
<span class="-2536879354012732317" onmouseenter="enter('-2536879354012732317');" onmouseout="out('-2536879354012732317');" style="">  74       mTempFilePath = mEntity.getDownloadPath();                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  75     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76   }                                                                                                      </span>
<span  style="">  77                                                                                                          </span>
<span class="-5838768387595209871" onmouseenter="enter('-5838768387595209871');" onmouseout="out('-5838768387595209871');" style="">  78   TARGET updateUrl(String newUrl) {                                                                      </span>
<span class="-5368255699338505910" onmouseenter="enter('-5368255699338505910');" onmouseout="out('-5368255699338505910');" style="">  79     if (TextUtils.isEmpty(newUrl)) {                                                                     </span>
<span class="2522835170679629804" onmouseenter="enter('2522835170679629804');" onmouseout="out('2522835170679629804');" style="">  80       ALog.e(TAG, &quot;url更新失败，newUrl为null&quot;);                                                                </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  81       return mTarget;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82     }                                                                                                    </span>
<span class="8228776452656032178" onmouseenter="enter('8228776452656032178');" onmouseout="out('8228776452656032178');" style="">  83     if (mUrl.equals(newUrl)) {                                                                           </span>
<span class="-7719663091563319527" onmouseenter="enter('-7719663091563319527');" onmouseout="out('-7719663091563319527');" style="">  84       ALog.e(TAG, &quot;url更新失败，新的下载url和旧的url一致&quot;);                                                            </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  85       return mTarget;                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86     }                                                                                                    </span>
<span class="6519280323062656940" onmouseenter="enter('6519280323062656940');" onmouseout="out('6519280323062656940');" style="">  87     mNewUrl = newUrl;                                                                                    </span>
<span class="8606773977048106405" onmouseenter="enter('8606773977048106405');" onmouseout="out('8606773977048106405');" style="">  88     mTarget.getTaskWrapper().setRefreshInfo(true);                                                       </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  89     return mTarget;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  90   }                                                                                                      </span>
<span  style="">  91                                                                                                          </span>
<span class="3925984219716663695" onmouseenter="enter('3925984219716663695');" onmouseout="out('3925984219716663695');" style="">  92   @Override public DownloadEntity getEntity() {                                                          </span>
<span class="3197424121678592902" onmouseenter="enter('3197424121678592902');" onmouseout="out('3197424121678592902');" style="">  93     return mTarget.getEntity();                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94   }                                                                                                      </span>
<span  style="">  95                                                                                                          </span>
<span class="1075165609880937393" onmouseenter="enter('1075165609880937393');" onmouseout="out('1075165609880937393');" style="">  96   @Override public boolean taskExists() {                                                                </span>
<span class="-5863139567803442221" onmouseenter="enter('-5863139567803442221');" onmouseout="out('-5863139567803442221');" style="">  97     return DbEntity.checkDataExist(DownloadEntity.class, &quot;url=?&quot;, mUrl);                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98   }                                                                                                      </span>
<span  style="">  99                                                                                                          </span>
<span class="-2237798856776801835" onmouseenter="enter('-2237798856776801835');" onmouseout="out('-2237798856776801835');" style=""> 100   @Override public boolean isRunning() {                                                                 </span>
<span class="-8503785353792972956" onmouseenter="enter('-8503785353792972956');" onmouseout="out('-8503785353792972956');" style=""> 101     DownloadTask task = DownloadTaskQueue.getInstance().getTask(mEntity.getKey());                       </span>
<span class="8820906724240250180" onmouseenter="enter('8820906724240250180');" onmouseout="out('8820906724240250180');" style=""> 102     return task != null &amp;&amp; task.isRunning();                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103   }                                                                                                      </span>
<span  style=""> 104                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 105   @Override                                                                                              </span>
<span class="-7855887945328952066" onmouseenter="enter('-7855887945328952066');" onmouseout="out('-7855887945328952066');" style=""> 106   public boolean checkEntity() {                                                                         </span>
<span class="-4755455099353720689" onmouseenter="enter('-4755455099353720689');" onmouseout="out('-4755455099353720689');" style=""> 107     boolean b = checkUrl() &amp;&amp; checkFilePath();                                                           </span>
<span class="-2738921756999881711" onmouseenter="enter('-2738921756999881711');" onmouseout="out('-2738921756999881711');" style=""> 108     if (b) {                                                                                             </span>
<span class="4960404293197380702" onmouseenter="enter('4960404293197380702');" onmouseout="out('4960404293197380702');" style=""> 109       mEntity.save();                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110     }                                                                                                    </span>
<span class="4830837168229672631" onmouseenter="enter('4830837168229672631');" onmouseout="out('4830837168229672631');" style=""><abbr title=" 111     if ((mTarget.getTaskWrapper().getRequestType() == ITaskWrapper.M3U8_FILE) &amp;&amp; (mEntity.getFileSize() == 0)) {"> 111     if ((mTarget.getTaskWrapper().getRequestType() == ITaskWrapper.M3U8_FILE) &amp;&amp; (mEntity.getFileSize() =🔵</abbr></span>
<span class="6288741116764239163" onmouseenter="enter('6288741116764239163');" onmouseout="out('6288741116764239163');" style=""> 112       ALog.e(TAG, &quot;由于m3u8协议的特殊性质，你需要设置文件长度才能获取到正确的下载进度百分比。设置方法：asM3U8().setFileSize(xxx)&quot;);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113     }                                                                                                    </span>
<span class="936248907371687111" onmouseenter="enter('936248907371687111');" onmouseout="out('936248907371687111');" style=""> 114     return b;                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115   }                                                                                                      </span>
<span  style=""> 116                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 117   @Override                                                                                              </span>
<span class="6834857536148785244" onmouseenter="enter('6834857536148785244');" onmouseout="out('6834857536148785244');" style=""> 118   public boolean checkFilePath() {                                                                       </span>
<span class="-4113555342808554142" onmouseenter="enter('-4113555342808554142');" onmouseout="out('-4113555342808554142');" style=""> 119     String filePath = mTempFilePath;                                                                     </span>
<span class="-6994367488724183364" onmouseenter="enter('-6994367488724183364');" onmouseout="out('-6994367488724183364');" style=""> 120     if (TextUtils.isEmpty(filePath)) {                                                                   </span>
<span class="1987302035889598125" onmouseenter="enter('1987302035889598125');" onmouseout="out('1987302035889598125');" style=""> 121       ALog.e(TAG, &quot;下载失败，文件保存路径为null&quot;);                                                                   </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 122       return false;                                                                                      </span>
<span class="-1271117581964116578" onmouseenter="enter('-1271117581964116578');" onmouseout="out('-1271117581964116578');" style=""> 123     } else if (!filePath.startsWith(&quot;/&quot;)) {                                                              </span>
<span class="557040637554213161" onmouseenter="enter('557040637554213161');" onmouseout="out('557040637554213161');" style=""> 124       ALog.e(TAG, String.format(&quot;下载失败，文件保存路径【%s】错误&quot;, filePath));                                         </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 125       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126     }                                                                                                    </span>
<span class="-5372495718115618479" onmouseenter="enter('-5372495718115618479');" onmouseout="out('-5372495718115618479');" style=""> 127     File file = new File(filePath);                                                                      </span>
<span class="5597017681458557475" onmouseenter="enter('5597017681458557475');" onmouseout="out('5597017681458557475');" style=""> 128     if (file.isDirectory()) {                                                                            </span>
<span class="-8716383513248807425" onmouseenter="enter('-8716383513248807425');" onmouseout="out('-8716383513248807425');" style=""> 129       if (mTarget.getTargetType() == ITargetHandler.D_HTTP) {                                            </span>
<span class="5590507710401793766" onmouseenter="enter('5590507710401793766');" onmouseout="out('5590507710401793766');" style=""> 130         ALog.e(TAG, String.format(&quot;下载失败，保存路径【%s】不能为文件夹，路径需要是完整的文件路径，如：/mnt/sdcard/game.zip&quot;, filePath)); </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 131         return false;                                                                                    </span>
<span class="8212045059945516931" onmouseenter="enter('8212045059945516931');" onmouseout="out('8212045059945516931');" style=""> 132       } else if (mTarget.getTargetType() == ITargetHandler.D_FTP) {                                      </span>
<span class="-5967191989776548956" onmouseenter="enter('-5967191989776548956');" onmouseout="out('-5967191989776548956');" style=""> 133         filePath += mEntity.getFileName();                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 134       }                                                                                                  </span>
<span class="5432397652010137378" onmouseenter="enter('5432397652010137378');" onmouseout="out('5432397652010137378');" style=""> 135     } else // http文件名设置                                                                                  </span>
<span class="3813164140265311506" onmouseenter="enter('3813164140265311506');" onmouseout="out('3813164140265311506');" style=""> 136     if (TextUtils.isEmpty(mEntity.getFileName())) {                                                      </span>
<span class="-7403226259664797230" onmouseenter="enter('-7403226259664797230');" onmouseout="out('-7403226259664797230');" style=""> 137       mEntity.setFileName(file.getName());                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138     }                                                                                                    </span>
<span class="7046651474144336438" onmouseenter="enter('7046651474144336438');" onmouseout="out('7046651474144336438');" style=""> 139     //设置文件保存路径，如果新文件路径和旧文件路径不同，则修改路径                                                                     </span>
<span class="-6183616590478680880" onmouseenter="enter('-6183616590478680880');" onmouseout="out('-6183616590478680880');" style=""> 140     if (!filePath.equals(mEntity.getFilePath())) {                                                       </span>
<span class="-6159259354933661527" onmouseenter="enter('-6159259354933661527');" onmouseout="out('-6159259354933661527');" style=""> 141       // 检查路径冲突                                                                                          </span>
<span class="-5013370222743809449" onmouseenter="enter('-5013370222743809449');" onmouseout="out('-5013370222743809449');" style=""> 142       if (DbEntity.checkDataExist(DownloadEntity.class, &quot;downloadPath=?&quot;, filePath)) {                   </span>
<span class="-8973098192989046635" onmouseenter="enter('-8973098192989046635');" onmouseout="out('-8973098192989046635');" style=""> 143         if (!forceDownload) {                                                                            </span>
<span class="-3314950676687962234" onmouseenter="enter('-3314950676687962234');" onmouseout="out('-3314950676687962234');" style=""> 144           ALog.e(TAG, String.format(&quot;下载失败，保存路径【%s】已经被其它任务占用，请设置其它保存路径&quot;, filePath));                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 145           return false;                                                                                  </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 146         } else {                                                                                         </span>
<span class="-8473780373304024264" onmouseenter="enter('-8473780373304024264');" onmouseout="out('-8473780373304024264');" style=""> 147           ALog.w(TAG, String.format(&quot;保存路径【%s】已经被其它任务占用，当前任务将覆盖该路径的文件&quot;, filePath));                       </span>
<span class="7589218718991287215" onmouseenter="enter('7589218718991287215');" onmouseout="out('7589218718991287215');" style=""> 148           CommonUtil.delTaskRecord(filePath, RecordHandler.TYPE_DOWNLOAD);                               </span>
<span class="-3448110138331728341" onmouseenter="enter('-3448110138331728341');" onmouseout="out('-3448110138331728341');" style=""><abbr title=" 149           mTarget.setTaskWrapper(TaskWrapperManager.getInstance().getHttpTaskWrapper(DTaskWrapper.class, mUrl));"> 149           mTarget.setTaskWrapper(TaskWrapperManager.getInstance().getHttpTaskWrapper(DTaskWrapper.class, 🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 150         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 151       }                                                                                                  </span>
<span class="8188086071101431655" onmouseenter="enter('8188086071101431655');" onmouseout="out('8188086071101431655');" style=""> 152       File oldFile = new File(mEntity.getDownloadPath());                                                </span>
<span class="6616899398988523664" onmouseenter="enter('6616899398988523664');" onmouseout="out('6616899398988523664');" style=""> 153       File newFile = new File(filePath);                                                                 </span>
<span class="378286578219875436" onmouseenter="enter('378286578219875436');" onmouseout="out('378286578219875436');" style=""> 154       mEntity.setFilePath(filePath);                                                                     </span>
<span class="-4241403741477214391" onmouseenter="enter('-4241403741477214391');" onmouseout="out('-4241403741477214391');" style=""> 155       mEntity.setFileName(newFile.getName());                                                            </span>
<span class="7124105241097814126" onmouseenter="enter('7124105241097814126');" onmouseout="out('7124105241097814126');" style=""> 156       // 如过使用Content-Disposition中的文件名，将不会执行重命名工作                                                         </span>
<span class="-4631271115819406630" onmouseenter="enter('-4631271115819406630');" onmouseout="out('-4631271115819406630');" style=""> 157       if (mTarget.getTaskWrapper().asHttp().isUseServerFileName()) {                                     </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 158         return true;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 159       }                                                                                                  </span>
<span class="-8664365027300439044" onmouseenter="enter('-8664365027300439044');" onmouseout="out('-8664365027300439044');" style=""> 160       if (oldFile.exists()) {                                                                            </span>
<span class="-9109224338502104344" onmouseenter="enter('-9109224338502104344');" onmouseout="out('-9109224338502104344');" style=""> 161         // 处理普通任务的重命名                                                                                    </span>
<span class="8842642762873802608" onmouseenter="enter('8842642762873802608');" onmouseout="out('8842642762873802608');" style=""> 162         CommonUtil.modifyTaskRecord(oldFile.getPath(), newFile.getPath());                               </span>
<span class="-1145532542364013010" onmouseenter="enter('-1145532542364013010');" onmouseout="out('-1145532542364013010');" style=""> 163         ALog.i(TAG, String.format(&quot;将任务重命名为：%s&quot;, newFile.getName()));                                     </span>
<span class="-6831818809327823926" onmouseenter="enter('-6831818809327823926');" onmouseout="out('-6831818809327823926');" style=""> 164       } else if (CommonUtil.blockTaskExists(oldFile.getPath())) {                                        </span>
<span class="-8977472813847143391" onmouseenter="enter('-8977472813847143391');" onmouseout="out('-8977472813847143391');" style=""> 165         // 处理分块任务的重命名                                                                                    </span>
<span class="8842642762873802608" onmouseenter="enter('8842642762873802608');" onmouseout="out('8842642762873802608');" style=""> 166         CommonUtil.modifyTaskRecord(oldFile.getPath(), newFile.getPath());                               </span>
<span class="-5498388326427379103" onmouseenter="enter('-5498388326427379103');" onmouseout="out('-5498388326427379103');" style=""> 167         ALog.i(TAG, String.format(&quot;将分块任务重命名为：%s&quot;, newFile.getName()));                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168       }                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 170     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171   }                                                                                                      </span>
<span  style=""> 172                                                                                                          </span>
<span class="1095370405184132274" onmouseenter="enter('1095370405184132274');" onmouseout="out('1095370405184132274');" style=""> 173   @Override public boolean checkUrl() {                                                                  </span>
<span class="-9182647005430820691" onmouseenter="enter('-9182647005430820691');" onmouseout="out('-9182647005430820691');" style=""> 174     final String url = mEntity.getUrl();                                                                 </span>
<span class="-5295066653448859718" onmouseenter="enter('-5295066653448859718');" onmouseout="out('-5295066653448859718');" style=""> 175     if (TextUtils.isEmpty(url)) {                                                                        </span>
<span class="-7527183944737711639" onmouseenter="enter('-7527183944737711639');" onmouseout="out('-7527183944737711639');" style=""> 176       ALog.e(TAG, &quot;下载失败，url为null&quot;);                                                                      </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 177       return false;                                                                                      </span>
<span class="2564503102818611052" onmouseenter="enter('2564503102818611052');" onmouseout="out('2564503102818611052');" style=""> 178     } else if (!CheckUtil.checkUrlNotThrow(url)) {                                                       </span>
<span class="-5966032732048138672" onmouseenter="enter('-5966032732048138672');" onmouseout="out('-5966032732048138672');" style=""> 179       ALog.e(TAG, &quot;下载失败，url【&quot; + url + &quot;】错误&quot;);                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 180       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181     }                                                                                                    </span>
<span class="-2484573064810891496" onmouseenter="enter('-2484573064810891496');" onmouseout="out('-2484573064810891496');" style=""> 182     int index = url.indexOf(&quot;://&quot;);                                                                      </span>
<span class="8271637489381568226" onmouseenter="enter('8271637489381568226');" onmouseout="out('8271637489381568226');" style=""> 183     if (index == -1) {                                                                                   </span>
<span class="-7978673376412591020" onmouseenter="enter('-7978673376412591020');" onmouseout="out('-7978673376412591020');" style=""> 184       ALog.e(TAG, &quot;下载失败，url【&quot; + url + &quot;】不合法&quot;);                                                           </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 185       return false;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186     }                                                                                                    </span>
<span class="-4096355108037590089" onmouseenter="enter('-4096355108037590089');" onmouseout="out('-4096355108037590089');" style=""> 187     if (!TextUtils.isEmpty(mNewUrl)) {                                                                   </span>
<span class="-947626375768951452" onmouseenter="enter('-947626375768951452');" onmouseout="out('-947626375768951452');" style=""> 188       mEntity.setUrl(mNewUrl);                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 189     }                                                                                                    </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 190     return true;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191   }                                                                                                      </span>
<span  style=""> 192                                                                                                          </span>
<span class="9080430511956105708" onmouseenter="enter('9080430511956105708');" onmouseout="out('9080430511956105708');" style=""> 193   void setForceDownload(boolean forceDownload) {                                                         </span>
<span class="-4055237448265976267" onmouseenter="enter('-4055237448265976267');" onmouseout="out('-4055237448265976267');" style=""> 194     this.forceDownload = forceDownload;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195   }                                                                                                      </span>
<span  style=""> 196                                                                                                          </span>
<span class="-5102073700561919125" onmouseenter="enter('-5102073700561919125');" onmouseout="out('-5102073700561919125');" style=""> 197   void setUrl(String url) {                                                                              </span>
<span class="6125552069257613507" onmouseenter="enter('6125552069257613507');" onmouseout="out('6125552069257613507');" style=""> 198     this.mUrl = url;                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199   }                                                                                                      </span>
<span  style=""> 200                                                                                                          </span>
<span class="-7069907651445876169" onmouseenter="enter('-7069907651445876169');" onmouseout="out('-7069907651445876169');" style=""> 201   String getUrl() {                                                                                      </span>
<span class="-466968703615862041" onmouseenter="enter('-466968703615862041');" onmouseout="out('-466968703615862041');" style=""> 202     return mUrl;                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203   }                                                                                                      </span>
<span  style=""> 204                                                                                                          </span>
<span class="-4100688759878726932" onmouseenter="enter('-4100688759878726932');" onmouseout="out('-4100688759878726932');" style=""> 205   void setTempFilePath(String mTempFilePath) {                                                           </span>
<span class="4672554542879215190" onmouseenter="enter('4672554542879215190');" onmouseout="out('4672554542879215190');" style=""> 206     this.mTempFilePath = mTempFilePath;                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207   }                                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208 }                                                                                                        </span>











</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="1987357580077471394" onmouseenter="enter('1987357580077471394');" onmouseout="out('1987357580077471394');" style="">  16  package com.arialyy.aria.core.download;                                                                           </span>
<span  style="">  17                                                                                                                    </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  18  import android.text.TextUtils;                                                                                    </span>
<span class="-5436107826461583981" onmouseenter="enter('-5436107826461583981');" onmouseout="out('-5436107826461583981');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  19 +import com.arialyy.aria.core.common.RecordHandler;                                                                </span>
<span class="-6718284849408348377" onmouseenter="enter('-6718284849408348377');" onmouseout="out('-6718284849408348377');" style="">  20  import com.arialyy.aria.core.inf.ITargetHandler;                                                                  </span>
<span class="-5823694385311893910" onmouseenter="enter('-5823694385311893910');" onmouseout="out('-5823694385311893910');" style="">  21  import com.arialyy.aria.core.inf.IConfigHandler;                                                                  </span>
<span class="-1066657515660882744" onmouseenter="enter('-1066657515660882744');" onmouseout="out('-1066657515660882744');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  22 +import com.arialyy.aria.core.inf.ITaskWrapper;                                                                    </span>
<span class="-5215055405907005508" onmouseenter="enter('-5215055405907005508');" onmouseout="out('-5215055405907005508');" style="">  23  import com.arialyy.aria.core.manager.TaskWrapperManager;                                                          </span>
<span class="1325372506799583582" onmouseenter="enter('1325372506799583582');" onmouseout="out('1325372506799583582');" style="">  24  import com.arialyy.aria.core.queue.DownloadTaskQueue;                                                             </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="">  25  import com.arialyy.aria.orm.DbEntity;                                                                             </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  26  import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="">  27  import com.arialyy.aria.util.CheckUtil;                                                                           </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  28  import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  29  import java.io.File;                                                                                              </span>
<span  style="">  30                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  31  /**                                                                                                               </span>
<span class="7597099774466160207" onmouseenter="enter('7597099774466160207');" onmouseout="out('7597099774466160207');" style="">  32   * Created by AriaL on 2019/4/5.                                                                                  </span>
<span class="3422522262515451071" onmouseenter="enter('3422522262515451071');" onmouseout="out('3422522262515451071');" style="">  33   * 普通下载任务通用功能处理                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  34   */                                                                                                               </span>
<span class="2742237136458932806" onmouseenter="enter('2742237136458932806');" onmouseout="out('2742237136458932806');" style="">  35  class DNormalConfigHandler&lt;TARGET extends AbsDTarget&gt; implements IConfigHandler {                                 </span>
<span class="-7372503279915444591" onmouseenter="enter('-7372503279915444591');" onmouseout="out('-7372503279915444591');" style="">  36    private final String TAG = &quot;DNormalDelegate&quot;;                                                                   </span>
<span class="-7151375780097547664" onmouseenter="enter('-7151375780097547664');" onmouseout="out('-7151375780097547664');" style="">  37    private DownloadEntity mEntity;                                                                                 </span>
<span  style="">  38                                                                                                                    </span>
<span class="-3489765475635404017" onmouseenter="enter('-3489765475635404017');" onmouseout="out('-3489765475635404017');" style="">  39    private TARGET mTarget;                                                                                         </span>
<span class="2647968472095192659" onmouseenter="enter('2647968472095192659');" onmouseout="out('2647968472095192659');" style="">  40    private String mNewUrl;                                                                                         </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  41    /**                                                                                                             </span>
<span class="6485233792679084311" onmouseenter="enter('6485233792679084311');" onmouseout="out('6485233792679084311');" style="">  42     * 设置的文件保存路径的临时变量                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  43     */                                                                                                             </span>
<span class="-5089493777035932819" onmouseenter="enter('-5089493777035932819');" onmouseout="out('-5089493777035932819');" style="">  44    private String mTempFilePath;                                                                                   </span>
<span  style="">  45                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  46    /**                                                                                                             </span>
<span class="195428192144817990" onmouseenter="enter('195428192144817990');" onmouseout="out('195428192144817990');" style="">  47     * {@code true}强制下载，不考虑文件路径是否被占用                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  48     */                                                                                                             </span>
<span class="-4358061151799660356" onmouseenter="enter('-4358061151799660356');" onmouseout="out('-4358061151799660356');" style="">  49    private boolean forceDownload = false;                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  50    /**                                                                                                             </span>
<span class="6373136269286593797" onmouseenter="enter('6373136269286593797');" onmouseout="out('6373136269286593797');" style="">  51     * 资源地址                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  52     */                                                                                                             </span>
<span class="-4666459667448884810" onmouseenter="enter('-4666459667448884810');" onmouseout="out('-4666459667448884810');" style="">  53    private String mUrl;                                                                                            </span>
<span  style="">  54                                                                                                                    </span>
<span class="2604798818932390268" onmouseenter="enter('2604798818932390268');" onmouseout="out('2604798818932390268');" style="">  55    DNormalConfigHandler(TARGET target, String url, String targetName) {                                            </span>
<span class="2322551504984416874" onmouseenter="enter('2322551504984416874');" onmouseout="out('2322551504984416874');" style="">  56      this.mTarget = target;                                                                                        </span>
<span class="-1928045164341053889" onmouseenter="enter('-1928045164341053889');" onmouseout="out('-1928045164341053889');" style="">  57      initTarget(url, targetName);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  58    }                                                                                                               </span>
<span  style="">  59                                                                                                                    </span>
<span class="7357043619638252702" onmouseenter="enter('7357043619638252702');" onmouseout="out('7357043619638252702');" style="">  60    private void initTarget(String url, String targetName) {                                                        </span>
<span class="-7814926717258655490" onmouseenter="enter('-7814926717258655490');" onmouseout="out('-7814926717258655490');" style="">  61      DTaskWrapper taskWrapper =                                                                                    </span>
<span class="8017401012004002052" onmouseenter="enter('8017401012004002052');" onmouseout="out('8017401012004002052');" style="">  62          TaskWrapperManager.getInstance().getHttpTaskWrapper(DTaskWrapper.class, url);                             </span>
<span class="-170355754520114419" onmouseenter="enter('-170355754520114419');" onmouseout="out('-170355754520114419');" style="">  63      mEntity = taskWrapper.getEntity();                                                                            </span>
<span  style="">  64                                                                                                                    </span>
<span class="1562715920388719156" onmouseenter="enter('1562715920388719156');" onmouseout="out('1562715920388719156');" style="">  65      mUrl = url;                                                                                                   </span>
<span class="-5254143723305914900" onmouseenter="enter('-5254143723305914900');" onmouseout="out('-5254143723305914900');" style="">  66      mTarget.setTargetName(targetName);                                                                            </span>
<span class="-4561194400435442390" onmouseenter="enter('-4561194400435442390');" onmouseout="out('-4561194400435442390');" style="">  67      mTarget.setTaskWrapper(taskWrapper);                                                                          </span>
<span class="-5413073826946610003" onmouseenter="enter('-5413073826946610003');" onmouseout="out('-5413073826946610003');" style="">  68      if (mEntity != null) {                                                                                        </span>
<span class="-2536879354012732317" onmouseenter="enter('-2536879354012732317');" onmouseout="out('-2536879354012732317');" style="">  69        mTempFilePath = mEntity.getDownloadPath();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  71    }                                                                                                               </span>
<span  style="">  72                                                                                                                    </span>
<span class="-5838768387595209871" onmouseenter="enter('-5838768387595209871');" onmouseout="out('-5838768387595209871');" style="">  73    TARGET updateUrl(String newUrl) {                                                                               </span>
<span class="-5368255699338505910" onmouseenter="enter('-5368255699338505910');" onmouseout="out('-5368255699338505910');" style="">  74      if (TextUtils.isEmpty(newUrl)) {                                                                              </span>
<span class="2522835170679629804" onmouseenter="enter('2522835170679629804');" onmouseout="out('2522835170679629804');" style="">  75        ALog.e(TAG, &quot;url更新失败，newUrl为null&quot;);                                                                         </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  76        return mTarget;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  77      }                                                                                                             </span>
<span class="8228776452656032178" onmouseenter="enter('8228776452656032178');" onmouseout="out('8228776452656032178');" style="">  78      if (mUrl.equals(newUrl)) {                                                                                    </span>
<span class="-7719663091563319527" onmouseenter="enter('-7719663091563319527');" onmouseout="out('-7719663091563319527');" style="">  79        ALog.e(TAG, &quot;url更新失败，新的下载url和旧的url一致&quot;);                                                                     </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  80        return mTarget;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  81      }                                                                                                             </span>
<span class="6519280323062656940" onmouseenter="enter('6519280323062656940');" onmouseout="out('6519280323062656940');" style="">  82      mNewUrl = newUrl;                                                                                             </span>
<span class="8606773977048106405" onmouseenter="enter('8606773977048106405');" onmouseout="out('8606773977048106405');" style="">  83      mTarget.getTaskWrapper().setRefreshInfo(true);                                                                </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  84      return mTarget;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85    }                                                                                                               </span>
<span  style="">  86                                                                                                                    </span>
<span class="3925984219716663695" onmouseenter="enter('3925984219716663695');" onmouseout="out('3925984219716663695');" style="">  87    @Override public DownloadEntity getEntity() {                                                                   </span>
<span class="3197424121678592902" onmouseenter="enter('3197424121678592902');" onmouseout="out('3197424121678592902');" style="">  88      return mTarget.getEntity();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  89    }                                                                                                               </span>
<span  style="">  90                                                                                                                    </span>
<span class="1075165609880937393" onmouseenter="enter('1075165609880937393');" onmouseout="out('1075165609880937393');" style="">  91    @Override public boolean taskExists() {                                                                         </span>
<span class="-5863139567803442221" onmouseenter="enter('-5863139567803442221');" onmouseout="out('-5863139567803442221');" style="">  92      return DbEntity.checkDataExist(DownloadEntity.class, &quot;url=?&quot;, mUrl);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93    }                                                                                                               </span>
<span  style="">  94                                                                                                                    </span>
<span class="-2237798856776801835" onmouseenter="enter('-2237798856776801835');" onmouseout="out('-2237798856776801835');" style="">  95    @Override public boolean isRunning() {                                                                          </span>
<span class="-8503785353792972956" onmouseenter="enter('-8503785353792972956');" onmouseout="out('-8503785353792972956');" style="">  96      DownloadTask task = DownloadTaskQueue.getInstance().getTask(mEntity.getKey());                                </span>
<span class="8820906724240250180" onmouseenter="enter('8820906724240250180');" onmouseout="out('8820906724240250180');" style="">  97      return task != null &amp;&amp; task.isRunning();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  98    }                                                                                                               </span>
<span  style="">  99                                                                                                                    </span>
<span class="-8488247163298459201" onmouseenter="enter('-8488247163298459201');" onmouseout="out('-8488247163298459201');" style=""> 100    @Override public boolean checkEntity() {                                                                        </span>
<span class="-4755455099353720689" onmouseenter="enter('-4755455099353720689');" onmouseout="out('-4755455099353720689');" style=""> 101      boolean b = checkUrl() &amp;&amp; checkFilePath();                                                                    </span>
<span class="-2738921756999881711" onmouseenter="enter('-2738921756999881711');" onmouseout="out('-2738921756999881711');" style=""> 102      if (b) {                                                                                                      </span>
<span class="4960404293197380702" onmouseenter="enter('4960404293197380702');" onmouseout="out('4960404293197380702');" style=""> 103        mEntity.save();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104      }                                                                                                             </span>
<span class="1146953079077988653" onmouseenter="enter('1146953079077988653');" onmouseout="out('1146953079077988653');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +    if (mTarget.getTaskWrapper().getRequestType() == ITaskWrapper.M3U8_FILE                                       </span>
<span class="3955310445710168480" onmouseenter="enter('3955310445710168480');" onmouseout="out('3955310445710168480');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +        &amp;&amp; mEntity.getFileSize() == 0) {                                                                          </span>
<span class="6288741116764239163" onmouseenter="enter('6288741116764239163');" onmouseout="out('6288741116764239163');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +      ALog.e(TAG, &quot;由于m3u8协议的特殊性质，你需要设置文件长度才能获取到正确的下载进度百分比。设置方法：asM3U8().setFileSize(xxx)&quot;);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +    }                                                                                                             </span>
<span class="936248907371687111" onmouseenter="enter('936248907371687111');" onmouseout="out('936248907371687111');" style=""> 109      return b;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 110    }                                                                                                               </span>
<span  style=""> 111                                                                                                                    </span>
<span class="2315226245822525054" onmouseenter="enter('2315226245822525054');" onmouseout="out('2315226245822525054');" style=""> 112    @Override public boolean checkFilePath() {                                                                      </span>
<span class="-4113555342808554142" onmouseenter="enter('-4113555342808554142');" onmouseout="out('-4113555342808554142');" style=""> 113      String filePath = mTempFilePath;                                                                              </span>
<span class="-6994367488724183364" onmouseenter="enter('-6994367488724183364');" onmouseout="out('-6994367488724183364');" style=""> 114      if (TextUtils.isEmpty(filePath)) {                                                                            </span>
<span class="1987302035889598125" onmouseenter="enter('1987302035889598125');" onmouseout="out('1987302035889598125');" style=""> 115        ALog.e(TAG, &quot;下载失败，文件保存路径为null&quot;);                                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 116        return false;                                                                                               </span>
<span class="-1271117581964116578" onmouseenter="enter('-1271117581964116578');" onmouseout="out('-1271117581964116578');" style=""> 117      } else if (!filePath.startsWith(&quot;/&quot;)) {                                                                       </span>
<span class="-1230450179749446938" onmouseenter="enter('-1230450179749446938');" onmouseout="out('-1230450179749446938');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 118 -      ALog.e(TAG, &quot;下载失败，文件保存路径【&quot; + filePath + &quot;】错误&quot;);                                                             </span>
<span class="557040637554213161" onmouseenter="enter('557040637554213161');" onmouseout="out('557040637554213161');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +      ALog.e(TAG, String.format(&quot;下载失败，文件保存路径【%s】错误&quot;, filePath));                                                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 120        return false;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 121      }                                                                                                             </span>
<span class="-5372495718115618479" onmouseenter="enter('-5372495718115618479');" onmouseout="out('-5372495718115618479');" style=""> 122      File file = new File(filePath);                                                                               </span>
<span class="5597017681458557475" onmouseenter="enter('5597017681458557475');" onmouseout="out('5597017681458557475');" style=""> 123      if (file.isDirectory()) {                                                                                     </span>
<span class="-8716383513248807425" onmouseenter="enter('-8716383513248807425');" onmouseout="out('-8716383513248807425');" style=""> 124        if (mTarget.getTargetType() == ITargetHandler.D_HTTP) {                                                     </span>
<span class="106652253878347292" onmouseenter="enter('106652253878347292');" onmouseout="out('106652253878347292');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 125 -        ALog.e(TAG, &quot;下载失败，保存路径【&quot; + filePath + &quot;】不能为文件夹，路径需要是完整的文件路径，如：/mnt/sdcard/game.zip&quot;);                     </span>
<span class="-7418838447060081867" onmouseenter="enter('-7418838447060081867');" onmouseout="out('-7418838447060081867');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +        ALog.e(TAG,                                                                                               </span>
<span class="-4949808999024829762" onmouseenter="enter('-4949808999024829762');" onmouseout="out('-4949808999024829762');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +            String.format(&quot;下载失败，保存路径【%s】不能为文件夹，路径需要是完整的文件路径，如：/mnt/sdcard/game.zip&quot;, filePath));                  </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 128          return false;                                                                                             </span>
<span class="8212045059945516931" onmouseenter="enter('8212045059945516931');" onmouseout="out('8212045059945516931');" style=""> 129        } else if (mTarget.getTargetType() == ITargetHandler.D_FTP) {                                               </span>
<span class="-5967191989776548956" onmouseenter="enter('-5967191989776548956');" onmouseout="out('-5967191989776548956');" style=""> 130          filePath += mEntity.getFileName();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 131        }                                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 132      } else {                                                                                                      </span>
<span class="-2693990311935632905" onmouseenter="enter('-2693990311935632905');" onmouseout="out('-2693990311935632905');" style=""> 133        // http文件名设置                                                                                                </span>
<span class="3813164140265311506" onmouseenter="enter('3813164140265311506');" onmouseout="out('3813164140265311506');" style=""> 134        if (TextUtils.isEmpty(mEntity.getFileName())) {                                                             </span>
<span class="-7403226259664797230" onmouseenter="enter('-7403226259664797230');" onmouseout="out('-7403226259664797230');" style=""> 135          mEntity.setFileName(file.getName());                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137      }                                                                                                             </span>
<span  style=""> 138                                                                                                                    </span>
<span class="7046651474144336438" onmouseenter="enter('7046651474144336438');" onmouseout="out('7046651474144336438');" style=""> 139      //设置文件保存路径，如果新文件路径和旧文件路径不同，则修改路径                                                                              </span>
<span class="-6183616590478680880" onmouseenter="enter('-6183616590478680880');" onmouseout="out('-6183616590478680880');" style=""> 140      if (!filePath.equals(mEntity.getFilePath())) {                                                                </span>
<span class="-6159259354933661527" onmouseenter="enter('-6159259354933661527');" onmouseout="out('-6159259354933661527');" style=""> 141        // 检查路径冲突                                                                                                   </span>
<span class="-5013370222743809449" onmouseenter="enter('-5013370222743809449');" onmouseout="out('-5013370222743809449');" style=""> 142        if (DbEntity.checkDataExist(DownloadEntity.class, &quot;downloadPath=?&quot;, filePath)) {                            </span>
<span class="-8973098192989046635" onmouseenter="enter('-8973098192989046635');" onmouseout="out('-8973098192989046635');" style=""> 143          if (!forceDownload) {                                                                                     </span>
<span class="-5552926368161798169" onmouseenter="enter('-5552926368161798169');" onmouseout="out('-5552926368161798169');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 144 -          ALog.e(TAG, &quot;下载失败，保存路径【&quot; + filePath + &quot;】已经被其它任务占用，请设置其它保存路径&quot;);                                          </span>
<span class="-3314950676687962234" onmouseenter="enter('-3314950676687962234');" onmouseout="out('-3314950676687962234');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +          ALog.e(TAG, String.format(&quot;下载失败，保存路径【%s】已经被其它任务占用，请设置其它保存路径&quot;, filePath));                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 146            return false;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 147          } else {                                                                                                  </span>
<span class="-206658163419639453" onmouseenter="enter('-206658163419639453');" onmouseout="out('-206658163419639453');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 148 -          ALog.w(TAG, &quot;保存路径【&quot; + filePath + &quot;】已经被其它任务占用，当前任务将覆盖该路径的文件&quot;);                                           </span>
<span class="3383431197806422731" onmouseenter="enter('3383431197806422731');" onmouseout="out('3383431197806422731');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 149 -          CommonUtil.delTaskRecord(filePath, 1);                                                                  </span>
<span class="-8473780373304024264" onmouseenter="enter('-8473780373304024264');" onmouseout="out('-8473780373304024264');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +          ALog.w(TAG, String.format(&quot;保存路径【%s】已经被其它任务占用，当前任务将覆盖该路径的文件&quot;, filePath));                                </span>
<span class="7589218718991287215" onmouseenter="enter('7589218718991287215');" onmouseout="out('7589218718991287215');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 151 +          CommonUtil.delTaskRecord(filePath, RecordHandler.TYPE_DOWNLOAD);                                        </span>
<span class="9015032310080894565" onmouseenter="enter('9015032310080894565');" onmouseout="out('9015032310080894565');" style=""> 152            mTarget.setTaskWrapper(                                                                                 </span>
<span class="-4218059376366094834" onmouseenter="enter('-4218059376366094834');" onmouseout="out('-4218059376366094834');" style=""> 153                TaskWrapperManager.getInstance()                                                                    </span>
<span class="3760515178664551150" onmouseenter="enter('3760515178664551150');" onmouseout="out('3760515178664551150');" style=""> 154                    .getHttpTaskWrapper(DTaskWrapper.class, mUrl));                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 156        }                                                                                                           </span>
<span class="8188086071101431655" onmouseenter="enter('8188086071101431655');" onmouseout="out('8188086071101431655');" style=""> 157        File oldFile = new File(mEntity.getDownloadPath());                                                         </span>
<span class="6616899398988523664" onmouseenter="enter('6616899398988523664');" onmouseout="out('6616899398988523664');" style=""> 158        File newFile = new File(filePath);                                                                          </span>
<span class="1624039691912577056" onmouseenter="enter('1624039691912577056');" onmouseout="out('1624039691912577056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 159 -      mEntity.setDownloadPath(filePath);                                                                          </span>
<span class="378286578219875436" onmouseenter="enter('378286578219875436');" onmouseout="out('378286578219875436');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +      mEntity.setFilePath(filePath);                                                                              </span>
<span class="-4241403741477214391" onmouseenter="enter('-4241403741477214391');" onmouseout="out('-4241403741477214391');" style=""> 161        mEntity.setFileName(newFile.getName());                                                                     </span>
<span class="7124105241097814126" onmouseenter="enter('7124105241097814126');" onmouseout="out('7124105241097814126');" style=""> 162        // 如过使用Content-Disposition中的文件名，将不会执行重命名工作                                                                  </span>
<span class="-4631271115819406630" onmouseenter="enter('-4631271115819406630');" onmouseout="out('-4631271115819406630');" style=""> 163        if (mTarget.getTaskWrapper().asHttp().isUseServerFileName()) {                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 164          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165        }                                                                                                           </span>
<span class="-8664365027300439044" onmouseenter="enter('-8664365027300439044');" onmouseout="out('-8664365027300439044');" style=""> 166        if (oldFile.exists()) {                                                                                     </span>
<span class="-9109224338502104344" onmouseenter="enter('-9109224338502104344');" onmouseout="out('-9109224338502104344');" style=""> 167          // 处理普通任务的重命名                                                                                             </span>
<span class="8842642762873802608" onmouseenter="enter('8842642762873802608');" onmouseout="out('8842642762873802608');" style=""> 168          CommonUtil.modifyTaskRecord(oldFile.getPath(), newFile.getPath());                                        </span>
<span class="-1145532542364013010" onmouseenter="enter('-1145532542364013010');" onmouseout="out('-1145532542364013010');" style=""> 169          ALog.i(TAG, String.format(&quot;将任务重命名为：%s&quot;, newFile.getName()));                                              </span>
<span class="-6831818809327823926" onmouseenter="enter('-6831818809327823926');" onmouseout="out('-6831818809327823926');" style=""> 170        } else if (CommonUtil.blockTaskExists(oldFile.getPath())) {                                                 </span>
<span class="-8977472813847143391" onmouseenter="enter('-8977472813847143391');" onmouseout="out('-8977472813847143391');" style=""> 171          // 处理分块任务的重命名                                                                                             </span>
<span class="8842642762873802608" onmouseenter="enter('8842642762873802608');" onmouseout="out('8842642762873802608');" style=""> 172          CommonUtil.modifyTaskRecord(oldFile.getPath(), newFile.getPath());                                        </span>
<span class="-5498388326427379103" onmouseenter="enter('-5498388326427379103');" onmouseout="out('-5498388326427379103');" style=""> 173          ALog.i(TAG, String.format(&quot;将分块任务重命名为：%s&quot;, newFile.getName()));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175      }                                                                                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 176      return true;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177    }                                                                                                               </span>
<span  style=""> 178                                                                                                                    </span>
<span class="1095370405184132274" onmouseenter="enter('1095370405184132274');" onmouseout="out('1095370405184132274');" style=""> 179    @Override public boolean checkUrl() {                                                                           </span>
<span class="-9182647005430820691" onmouseenter="enter('-9182647005430820691');" onmouseout="out('-9182647005430820691');" style=""> 180      final String url = mEntity.getUrl();                                                                          </span>
<span class="-5295066653448859718" onmouseenter="enter('-5295066653448859718');" onmouseout="out('-5295066653448859718');" style=""> 181      if (TextUtils.isEmpty(url)) {                                                                                 </span>
<span class="-7527183944737711639" onmouseenter="enter('-7527183944737711639');" onmouseout="out('-7527183944737711639');" style=""> 182        ALog.e(TAG, &quot;下载失败，url为null&quot;);                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 183        return false;                                                                                               </span>
<span class="2564503102818611052" onmouseenter="enter('2564503102818611052');" onmouseout="out('2564503102818611052');" style=""> 184      } else if (!CheckUtil.checkUrlNotThrow(url)) {                                                                </span>
<span class="-5966032732048138672" onmouseenter="enter('-5966032732048138672');" onmouseout="out('-5966032732048138672');" style=""> 185        ALog.e(TAG, &quot;下载失败，url【&quot; + url + &quot;】错误&quot;);                                                                     </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 186        return false;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187      }                                                                                                             </span>
<span class="-2484573064810891496" onmouseenter="enter('-2484573064810891496');" onmouseout="out('-2484573064810891496');" style=""> 188      int index = url.indexOf(&quot;://&quot;);                                                                               </span>
<span class="8271637489381568226" onmouseenter="enter('8271637489381568226');" onmouseout="out('8271637489381568226');" style=""> 189      if (index == -1) {                                                                                            </span>
<span class="-7978673376412591020" onmouseenter="enter('-7978673376412591020');" onmouseout="out('-7978673376412591020');" style=""> 190        ALog.e(TAG, &quot;下载失败，url【&quot; + url + &quot;】不合法&quot;);                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 191        return false;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192      }                                                                                                             </span>
<span class="-4096355108037590089" onmouseenter="enter('-4096355108037590089');" onmouseout="out('-4096355108037590089');" style=""> 193      if (!TextUtils.isEmpty(mNewUrl)) {                                                                            </span>
<span class="-947626375768951452" onmouseenter="enter('-947626375768951452');" onmouseout="out('-947626375768951452');" style=""> 194        mEntity.setUrl(mNewUrl);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195      }                                                                                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 196      return true;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197    }                                                                                                               </span>
<span  style=""> 198                                                                                                                    </span>
<span class="9080430511956105708" onmouseenter="enter('9080430511956105708');" onmouseout="out('9080430511956105708');" style=""> 199    void setForceDownload(boolean forceDownload) {                                                                  </span>
<span class="-4055237448265976267" onmouseenter="enter('-4055237448265976267');" onmouseout="out('-4055237448265976267');" style=""> 200      this.forceDownload = forceDownload;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201    }                                                                                                               </span>
<span  style=""> 202                                                                                                                    </span>
<span class="-5102073700561919125" onmouseenter="enter('-5102073700561919125');" onmouseout="out('-5102073700561919125');" style=""> 203    void setUrl(String url) {                                                                                       </span>
<span class="6125552069257613507" onmouseenter="enter('6125552069257613507');" onmouseout="out('6125552069257613507');" style=""> 204      this.mUrl = url;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 205    }                                                                                                               </span>
<span  style=""> 206                                                                                                                    </span>
<span class="-7069907651445876169" onmouseenter="enter('-7069907651445876169');" onmouseout="out('-7069907651445876169');" style=""> 207    String getUrl() {                                                                                               </span>
<span class="-466968703615862041" onmouseenter="enter('-466968703615862041');" onmouseout="out('-466968703615862041');" style=""> 208      return mUrl;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209    }                                                                                                               </span>
<span  style=""> 210                                                                                                                    </span>
<span class="-4100688759878726932" onmouseenter="enter('-4100688759878726932');" onmouseout="out('-4100688759878726932');" style=""> 211    void setTempFilePath(String mTempFilePath) {                                                                    </span>
<span class="4672554542879215190" onmouseenter="enter('4672554542879215190');" onmouseout="out('4672554542879215190');" style=""> 212      this.mTempFilePath = mTempFilePath;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 214  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="4534359625031764666" onmouseenter="enter('4534359625031764666');" onmouseout="out('4534359625031764666');" style="">   1  /*                                                                                                                </span>
<span class="-4176855950178531235" onmouseenter="enter('-4176855950178531235');" onmouseout="out('-4176855950178531235');" style="">   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)                                                    </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   3   *                                                                                                                </span>
<span class="-7144700690364548245" onmouseenter="enter('-7144700690364548245');" onmouseout="out('-7144700690364548245');" style="">   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);                                                </span>
<span class="-6614298523444173250" onmouseenter="enter('-6614298523444173250');" onmouseout="out('-6614298523444173250');" style="">   5   * you may not use this file except in compliance with the License.                                               </span>
<span class="-4753901504248728101" onmouseenter="enter('-4753901504248728101');" onmouseout="out('-4753901504248728101');" style="">   6   * You may obtain a copy of the License at                                                                        </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   7   *                                                                                                                </span>
<span class="-763207030729826407" onmouseenter="enter('-763207030729826407');" onmouseout="out('-763207030729826407');" style="">   8   *      http://www.apache.org/licenses/LICENSE-2.0                                                                </span>
<span class="329605257831645060" onmouseenter="enter('329605257831645060');" onmouseout="out('329605257831645060');" style="">   9   *                                                                                                                </span>
<span class="2557607632756179983" onmouseenter="enter('2557607632756179983');" onmouseout="out('2557607632756179983');" style="">  10   * Unless required by applicable law or agreed to in writing, software                                            </span>
<span class="-9189129105512731955" onmouseenter="enter('-9189129105512731955');" onmouseout="out('-9189129105512731955');" style="">  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,                                              </span>
<span class="5781161717946418340" onmouseenter="enter('5781161717946418340');" onmouseout="out('5781161717946418340');" style="">  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                       </span>
<span class="1761562277992059393" onmouseenter="enter('1761562277992059393');" onmouseout="out('1761562277992059393');" style="">  13   * See the License for the specific language governing permissions and                                            </span>
<span class="7217408601297779962" onmouseenter="enter('7217408601297779962');" onmouseout="out('7217408601297779962');" style="">  14   * limitations under the License.                                                                                 </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  15   */                                                                                                               </span>
<span class="1987357580077471394" onmouseenter="enter('1987357580077471394');" onmouseout="out('1987357580077471394');" style="">  16  package com.arialyy.aria.core.download;                                                                           </span>
<span  style="">  17                                                                                                                    </span>
<span class="3727887607099278716" onmouseenter="enter('3727887607099278716');" onmouseout="out('3727887607099278716');" style="">  18  import android.text.TextUtils;                                                                                    </span>
<span class="-5436107826461583981" onmouseenter="enter('-5436107826461583981');" onmouseout="out('-5436107826461583981');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  19 +import com.arialyy.aria.core.common.RecordHandler;                                                                </span>
<span class="-6718284849408348377" onmouseenter="enter('-6718284849408348377');" onmouseout="out('-6718284849408348377');" style="">  20  import com.arialyy.aria.core.inf.ITargetHandler;                                                                  </span>
<span class="-5823694385311893910" onmouseenter="enter('-5823694385311893910');" onmouseout="out('-5823694385311893910');" style="">  21  import com.arialyy.aria.core.inf.IConfigHandler;                                                                  </span>

<span class="-5215055405907005508" onmouseenter="enter('-5215055405907005508');" onmouseout="out('-5215055405907005508');" style="">  22  import com.arialyy.aria.core.manager.TaskWrapperManager;                                                          </span>
<span class="1325372506799583582" onmouseenter="enter('1325372506799583582');" onmouseout="out('1325372506799583582');" style="">  23  import com.arialyy.aria.core.queue.DownloadTaskQueue;                                                             </span>
<span class="-4499301116755301031" onmouseenter="enter('-4499301116755301031');" onmouseout="out('-4499301116755301031');" style="">  24  import com.arialyy.aria.orm.DbEntity;                                                                             </span>
<span class="-3586495952513455611" onmouseenter="enter('-3586495952513455611');" onmouseout="out('-3586495952513455611');" style="">  25  import com.arialyy.aria.util.ALog;                                                                                </span>
<span class="-8921020518339919076" onmouseenter="enter('-8921020518339919076');" onmouseout="out('-8921020518339919076');" style="">  26  import com.arialyy.aria.util.CheckUtil;                                                                           </span>
<span class="-3106139894727218967" onmouseenter="enter('-3106139894727218967');" onmouseout="out('-3106139894727218967');" style="">  27  import com.arialyy.aria.util.CommonUtil;                                                                          </span>
<span class="-3926401431737521278" onmouseenter="enter('-3926401431737521278');" onmouseout="out('-3926401431737521278');" style="">  28  import java.io.File;                                                                                              </span>
<span  style="">  29                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  30  /**                                                                                                               </span>
<span class="7597099774466160207" onmouseenter="enter('7597099774466160207');" onmouseout="out('7597099774466160207');" style="">  31   * Created by AriaL on 2019/4/5.                                                                                  </span>
<span class="3422522262515451071" onmouseenter="enter('3422522262515451071');" onmouseout="out('3422522262515451071');" style="">  32   * 普通下载任务通用功能处理                                                                                                   </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  33   */                                                                                                               </span>
<span class="2742237136458932806" onmouseenter="enter('2742237136458932806');" onmouseout="out('2742237136458932806');" style="">  34  class DNormalConfigHandler&lt;TARGET extends AbsDTarget&gt; implements IConfigHandler {                                 </span>
<span class="-7372503279915444591" onmouseenter="enter('-7372503279915444591');" onmouseout="out('-7372503279915444591');" style="">  35    private final String TAG = &quot;DNormalDelegate&quot;;                                                                   </span>
<span class="-7151375780097547664" onmouseenter="enter('-7151375780097547664');" onmouseout="out('-7151375780097547664');" style="">  36    private DownloadEntity mEntity;                                                                                 </span>
<span  style="">  37                                                                                                                    </span>
<span class="-3489765475635404017" onmouseenter="enter('-3489765475635404017');" onmouseout="out('-3489765475635404017');" style="">  38    private TARGET mTarget;                                                                                         </span>
<span class="2647968472095192659" onmouseenter="enter('2647968472095192659');" onmouseout="out('2647968472095192659');" style="">  39    private String mNewUrl;                                                                                         </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  40    /**                                                                                                             </span>
<span class="6485233792679084311" onmouseenter="enter('6485233792679084311');" onmouseout="out('6485233792679084311');" style="">  41     * 设置的文件保存路径的临时变量                                                                                               </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  42     */                                                                                                             </span>
<span class="-5089493777035932819" onmouseenter="enter('-5089493777035932819');" onmouseout="out('-5089493777035932819');" style="">  43    private String mTempFilePath;                                                                                   </span>
<span  style="">  44                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  45    /**                                                                                                             </span>
<span class="195428192144817990" onmouseenter="enter('195428192144817990');" onmouseout="out('195428192144817990');" style="">  46     * {@code true}强制下载，不考虑文件路径是否被占用                                                                                </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  47     */                                                                                                             </span>
<span class="-4358061151799660356" onmouseenter="enter('-4358061151799660356');" onmouseout="out('-4358061151799660356');" style="">  48    private boolean forceDownload = false;                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  49    /**                                                                                                             </span>
<span class="6373136269286593797" onmouseenter="enter('6373136269286593797');" onmouseout="out('6373136269286593797');" style="">  50     * 资源地址                                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  51     */                                                                                                             </span>
<span class="-4666459667448884810" onmouseenter="enter('-4666459667448884810');" onmouseout="out('-4666459667448884810');" style="">  52    private String mUrl;                                                                                            </span>
<span  style="">  53                                                                                                                    </span>
<span class="2604798818932390268" onmouseenter="enter('2604798818932390268');" onmouseout="out('2604798818932390268');" style="">  54    DNormalConfigHandler(TARGET target, String url, String targetName) {                                            </span>
<span class="2322551504984416874" onmouseenter="enter('2322551504984416874');" onmouseout="out('2322551504984416874');" style="">  55      this.mTarget = target;                                                                                        </span>
<span class="-1928045164341053889" onmouseenter="enter('-1928045164341053889');" onmouseout="out('-1928045164341053889');" style="">  56      initTarget(url, targetName);                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  57    }                                                                                                               </span>
<span  style="">  58                                                                                                                    </span>
<span class="7357043619638252702" onmouseenter="enter('7357043619638252702');" onmouseout="out('7357043619638252702');" style="">  59    private void initTarget(String url, String targetName) {                                                        </span>
<span class="-7814926717258655490" onmouseenter="enter('-7814926717258655490');" onmouseout="out('-7814926717258655490');" style="">  60      DTaskWrapper taskWrapper =                                                                                    </span>
<span class="8017401012004002052" onmouseenter="enter('8017401012004002052');" onmouseout="out('8017401012004002052');" style="">  61          TaskWrapperManager.getInstance().getHttpTaskWrapper(DTaskWrapper.class, url);                             </span>
<span class="-170355754520114419" onmouseenter="enter('-170355754520114419');" onmouseout="out('-170355754520114419');" style="">  62      mEntity = taskWrapper.getEntity();                                                                            </span>
<span  style="">  63                                                                                                                    </span>
<span class="1562715920388719156" onmouseenter="enter('1562715920388719156');" onmouseout="out('1562715920388719156');" style="">  64      mUrl = url;                                                                                                   </span>
<span class="-5254143723305914900" onmouseenter="enter('-5254143723305914900');" onmouseout="out('-5254143723305914900');" style="">  65      mTarget.setTargetName(targetName);                                                                            </span>
<span class="-4561194400435442390" onmouseenter="enter('-4561194400435442390');" onmouseout="out('-4561194400435442390');" style="">  66      mTarget.setTaskWrapper(taskWrapper);                                                                          </span>
<span class="-5413073826946610003" onmouseenter="enter('-5413073826946610003');" onmouseout="out('-5413073826946610003');" style="">  67      if (mEntity != null) {                                                                                        </span>
<span class="-2536879354012732317" onmouseenter="enter('-2536879354012732317');" onmouseout="out('-2536879354012732317');" style="">  68        mTempFilePath = mEntity.getDownloadPath();                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  70    }                                                                                                               </span>
<span  style="">  71                                                                                                                    </span>
<span class="-5838768387595209871" onmouseenter="enter('-5838768387595209871');" onmouseout="out('-5838768387595209871');" style="">  72    TARGET updateUrl(String newUrl) {                                                                               </span>
<span class="-5368255699338505910" onmouseenter="enter('-5368255699338505910');" onmouseout="out('-5368255699338505910');" style="">  73      if (TextUtils.isEmpty(newUrl)) {                                                                              </span>
<span class="2522835170679629804" onmouseenter="enter('2522835170679629804');" onmouseout="out('2522835170679629804');" style="">  74        ALog.e(TAG, &quot;url更新失败，newUrl为null&quot;);                                                                         </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  75        return mTarget;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76      }                                                                                                             </span>
<span class="8228776452656032178" onmouseenter="enter('8228776452656032178');" onmouseout="out('8228776452656032178');" style="">  77      if (mUrl.equals(newUrl)) {                                                                                    </span>
<span class="-7719663091563319527" onmouseenter="enter('-7719663091563319527');" onmouseout="out('-7719663091563319527');" style="">  78        ALog.e(TAG, &quot;url更新失败，新的下载url和旧的url一致&quot;);                                                                     </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  79        return mTarget;                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  80      }                                                                                                             </span>
<span class="6519280323062656940" onmouseenter="enter('6519280323062656940');" onmouseout="out('6519280323062656940');" style="">  81      mNewUrl = newUrl;                                                                                             </span>
<span class="8606773977048106405" onmouseenter="enter('8606773977048106405');" onmouseout="out('8606773977048106405');" style="">  82      mTarget.getTaskWrapper().setRefreshInfo(true);                                                                </span>
<span class="6624217147076297325" onmouseenter="enter('6624217147076297325');" onmouseout="out('6624217147076297325');" style="">  83      return mTarget;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  84    }                                                                                                               </span>
<span  style="">  85                                                                                                                    </span>
<span class="3925984219716663695" onmouseenter="enter('3925984219716663695');" onmouseout="out('3925984219716663695');" style="">  86    @Override public DownloadEntity getEntity() {                                                                   </span>
<span class="3197424121678592902" onmouseenter="enter('3197424121678592902');" onmouseout="out('3197424121678592902');" style="">  87      return mTarget.getEntity();                                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  88    }                                                                                                               </span>
<span  style="">  89                                                                                                                    </span>
<span class="1075165609880937393" onmouseenter="enter('1075165609880937393');" onmouseout="out('1075165609880937393');" style="">  90    @Override public boolean taskExists() {                                                                         </span>
<span class="-5863139567803442221" onmouseenter="enter('-5863139567803442221');" onmouseout="out('-5863139567803442221');" style="">  91      return DbEntity.checkDataExist(DownloadEntity.class, &quot;url=?&quot;, mUrl);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92    }                                                                                                               </span>
<span  style="">  93                                                                                                                    </span>
<span class="-2237798856776801835" onmouseenter="enter('-2237798856776801835');" onmouseout="out('-2237798856776801835');" style="">  94    @Override public boolean isRunning() {                                                                          </span>
<span class="-8503785353792972956" onmouseenter="enter('-8503785353792972956');" onmouseout="out('-8503785353792972956');" style="">  95      DownloadTask task = DownloadTaskQueue.getInstance().getTask(mEntity.getKey());                                </span>
<span class="8820906724240250180" onmouseenter="enter('8820906724240250180');" onmouseout="out('8820906724240250180');" style="">  96      return task != null &amp;&amp; task.isRunning();                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97    }                                                                                                               </span>
<span  style="">  98                                                                                                                    </span>
<span class="-8488247163298459201" onmouseenter="enter('-8488247163298459201');" onmouseout="out('-8488247163298459201');" style="">  99    @Override public boolean checkEntity() {                                                                        </span>
<span class="-4755455099353720689" onmouseenter="enter('-4755455099353720689');" onmouseout="out('-4755455099353720689');" style=""> 100      boolean b = checkUrl() &amp;&amp; checkFilePath();                                                                    </span>
<span class="-2738921756999881711" onmouseenter="enter('-2738921756999881711');" onmouseout="out('-2738921756999881711');" style=""> 101      if (b) {                                                                                                      </span>
<span class="4960404293197380702" onmouseenter="enter('4960404293197380702');" onmouseout="out('4960404293197380702');" style=""> 102        mEntity.save();                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 103      }                                                                                                             </span>




<span class="936248907371687111" onmouseenter="enter('936248907371687111');" onmouseout="out('936248907371687111');" style=""> 104      return b;                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105    }                                                                                                               </span>
<span  style=""> 106                                                                                                                    </span>
<span class="2315226245822525054" onmouseenter="enter('2315226245822525054');" onmouseout="out('2315226245822525054');" style=""> 107    @Override public boolean checkFilePath() {                                                                      </span>
<span class="-4113555342808554142" onmouseenter="enter('-4113555342808554142');" onmouseout="out('-4113555342808554142');" style=""> 108      String filePath = mTempFilePath;                                                                              </span>
<span class="-6994367488724183364" onmouseenter="enter('-6994367488724183364');" onmouseout="out('-6994367488724183364');" style=""> 109      if (TextUtils.isEmpty(filePath)) {                                                                            </span>
<span class="1987302035889598125" onmouseenter="enter('1987302035889598125');" onmouseout="out('1987302035889598125');" style=""> 110        ALog.e(TAG, &quot;下载失败，文件保存路径为null&quot;);                                                                            </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 111        return false;                                                                                               </span>
<span class="-1271117581964116578" onmouseenter="enter('-1271117581964116578');" onmouseout="out('-1271117581964116578');" style=""> 112      } else if (!filePath.startsWith(&quot;/&quot;)) {                                                                       </span>
<span class="-1230450179749446938" onmouseenter="enter('-1230450179749446938');" onmouseout="out('-1230450179749446938');" style=""> 113        ALog.e(TAG, &quot;下载失败，文件保存路径【&quot; + filePath + &quot;】错误&quot;);                                                             </span>

<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 114        return false;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115      }                                                                                                             </span>
<span class="-5372495718115618479" onmouseenter="enter('-5372495718115618479');" onmouseout="out('-5372495718115618479');" style=""> 116      File file = new File(filePath);                                                                               </span>
<span class="5597017681458557475" onmouseenter="enter('5597017681458557475');" onmouseout="out('5597017681458557475');" style=""> 117      if (file.isDirectory()) {                                                                                     </span>
<span class="-8716383513248807425" onmouseenter="enter('-8716383513248807425');" onmouseout="out('-8716383513248807425');" style=""> 118        if (mTarget.getTargetType() == ITargetHandler.D_HTTP) {                                                     </span>
<span class="106652253878347292" onmouseenter="enter('106652253878347292');" onmouseout="out('106652253878347292');" style=""> 119          ALog.e(TAG, &quot;下载失败，保存路径【&quot; + filePath + &quot;】不能为文件夹，路径需要是完整的文件路径，如：/mnt/sdcard/game.zip&quot;);                     </span>


<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 120          return false;                                                                                             </span>
<span class="8212045059945516931" onmouseenter="enter('8212045059945516931');" onmouseout="out('8212045059945516931');" style=""> 121        } else if (mTarget.getTargetType() == ITargetHandler.D_FTP) {                                               </span>
<span class="-5967191989776548956" onmouseenter="enter('-5967191989776548956');" onmouseout="out('-5967191989776548956');" style=""> 122          filePath += mEntity.getFileName();                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 123        }                                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 124      } else {                                                                                                      </span>
<span class="-2693990311935632905" onmouseenter="enter('-2693990311935632905');" onmouseout="out('-2693990311935632905');" style=""> 125        // http文件名设置                                                                                                </span>
<span class="3813164140265311506" onmouseenter="enter('3813164140265311506');" onmouseout="out('3813164140265311506');" style=""> 126        if (TextUtils.isEmpty(mEntity.getFileName())) {                                                             </span>
<span class="-7403226259664797230" onmouseenter="enter('-7403226259664797230');" onmouseout="out('-7403226259664797230');" style=""> 127          mEntity.setFileName(file.getName());                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 128        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129      }                                                                                                             </span>
<span  style=""> 130                                                                                                                    </span>
<span class="7046651474144336438" onmouseenter="enter('7046651474144336438');" onmouseout="out('7046651474144336438');" style=""> 131      //设置文件保存路径，如果新文件路径和旧文件路径不同，则修改路径                                                                              </span>
<span class="-6183616590478680880" onmouseenter="enter('-6183616590478680880');" onmouseout="out('-6183616590478680880');" style=""> 132      if (!filePath.equals(mEntity.getFilePath())) {                                                                </span>
<span class="-6159259354933661527" onmouseenter="enter('-6159259354933661527');" onmouseout="out('-6159259354933661527');" style=""> 133        // 检查路径冲突                                                                                                   </span>
<span class="-5013370222743809449" onmouseenter="enter('-5013370222743809449');" onmouseout="out('-5013370222743809449');" style=""> 134        if (DbEntity.checkDataExist(DownloadEntity.class, &quot;downloadPath=?&quot;, filePath)) {                            </span>
<span class="-8973098192989046635" onmouseenter="enter('-8973098192989046635');" onmouseout="out('-8973098192989046635');" style=""> 135          if (!forceDownload) {                                                                                     </span>
<span class="-5552926368161798169" onmouseenter="enter('-5552926368161798169');" onmouseout="out('-5552926368161798169');" style=""> 136            ALog.e(TAG, &quot;下载失败，保存路径【&quot; + filePath + &quot;】已经被其它任务占用，请设置其它保存路径&quot;);                                          </span>

<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 137            return false;                                                                                           </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 138          } else {                                                                                                  </span>
<span class="-206658163419639453" onmouseenter="enter('-206658163419639453');" onmouseout="out('-206658163419639453');" style=""> 139            ALog.w(TAG, &quot;保存路径【&quot; + filePath + &quot;】已经被其它任务占用，当前任务将覆盖该路径的文件&quot;);                                           </span>
<span class="3383431197806422731" onmouseenter="enter('3383431197806422731');" onmouseout="out('3383431197806422731');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 140 -          CommonUtil.delTaskRecord(filePath, 1);                                                                  </span>
<span class="7589218718991287215" onmouseenter="enter('7589218718991287215');" onmouseout="out('7589218718991287215');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 141 +          CommonUtil.delTaskRecord(filePath, RecordHandler.TYPE_DOWNLOAD);                                        </span>

<span class="9015032310080894565" onmouseenter="enter('9015032310080894565');" onmouseout="out('9015032310080894565');" style=""> 142            mTarget.setTaskWrapper(                                                                                 </span>
<span class="-4218059376366094834" onmouseenter="enter('-4218059376366094834');" onmouseout="out('-4218059376366094834');" style=""> 143                TaskWrapperManager.getInstance()                                                                    </span>
<span class="3760515178664551150" onmouseenter="enter('3760515178664551150');" onmouseout="out('3760515178664551150');" style=""> 144                    .getHttpTaskWrapper(DTaskWrapper.class, mUrl));                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 145          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146        }                                                                                                           </span>
<span class="8188086071101431655" onmouseenter="enter('8188086071101431655');" onmouseout="out('8188086071101431655');" style=""> 147        File oldFile = new File(mEntity.getDownloadPath());                                                         </span>
<span class="6616899398988523664" onmouseenter="enter('6616899398988523664');" onmouseout="out('6616899398988523664');" style=""> 148        File newFile = new File(filePath);                                                                          </span>
<span class="1624039691912577056" onmouseenter="enter('1624039691912577056');" onmouseout="out('1624039691912577056');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 149 -      mEntity.setDownloadPath(filePath);                                                                          </span>
<span class="378286578219875436" onmouseenter="enter('378286578219875436');" onmouseout="out('378286578219875436');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 150 +      mEntity.setFilePath(filePath);                                                                              </span>
<span class="-4241403741477214391" onmouseenter="enter('-4241403741477214391');" onmouseout="out('-4241403741477214391');" style=""> 151        mEntity.setFileName(newFile.getName());                                                                     </span>
<span class="7124105241097814126" onmouseenter="enter('7124105241097814126');" onmouseout="out('7124105241097814126');" style=""> 152        // 如过使用Content-Disposition中的文件名，将不会执行重命名工作                                                                  </span>
<span class="-4631271115819406630" onmouseenter="enter('-4631271115819406630');" onmouseout="out('-4631271115819406630');" style=""> 153        if (mTarget.getTaskWrapper().asHttp().isUseServerFileName()) {                                              </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 154          return true;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155        }                                                                                                           </span>
<span class="-8664365027300439044" onmouseenter="enter('-8664365027300439044');" onmouseout="out('-8664365027300439044');" style=""> 156        if (oldFile.exists()) {                                                                                     </span>
<span class="-9109224338502104344" onmouseenter="enter('-9109224338502104344');" onmouseout="out('-9109224338502104344');" style=""> 157          // 处理普通任务的重命名                                                                                             </span>
<span class="8842642762873802608" onmouseenter="enter('8842642762873802608');" onmouseout="out('8842642762873802608');" style=""> 158          CommonUtil.modifyTaskRecord(oldFile.getPath(), newFile.getPath());                                        </span>
<span class="-1145532542364013010" onmouseenter="enter('-1145532542364013010');" onmouseout="out('-1145532542364013010');" style=""> 159          ALog.i(TAG, String.format(&quot;将任务重命名为：%s&quot;, newFile.getName()));                                              </span>
<span class="-6831818809327823926" onmouseenter="enter('-6831818809327823926');" onmouseout="out('-6831818809327823926');" style=""> 160        } else if (CommonUtil.blockTaskExists(oldFile.getPath())) {                                                 </span>
<span class="-8977472813847143391" onmouseenter="enter('-8977472813847143391');" onmouseout="out('-8977472813847143391');" style=""> 161          // 处理分块任务的重命名                                                                                             </span>
<span class="8842642762873802608" onmouseenter="enter('8842642762873802608');" onmouseout="out('8842642762873802608');" style=""> 162          CommonUtil.modifyTaskRecord(oldFile.getPath(), newFile.getPath());                                        </span>
<span class="-5498388326427379103" onmouseenter="enter('-5498388326427379103');" onmouseout="out('-5498388326427379103');" style=""> 163          ALog.i(TAG, String.format(&quot;将分块任务重命名为：%s&quot;, newFile.getName()));                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164        }                                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165      }                                                                                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 166      return true;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167    }                                                                                                               </span>
<span  style=""> 168                                                                                                                    </span>
<span class="1095370405184132274" onmouseenter="enter('1095370405184132274');" onmouseout="out('1095370405184132274');" style=""> 169    @Override public boolean checkUrl() {                                                                           </span>
<span class="-9182647005430820691" onmouseenter="enter('-9182647005430820691');" onmouseout="out('-9182647005430820691');" style=""> 170      final String url = mEntity.getUrl();                                                                          </span>
<span class="-5295066653448859718" onmouseenter="enter('-5295066653448859718');" onmouseout="out('-5295066653448859718');" style=""> 171      if (TextUtils.isEmpty(url)) {                                                                                 </span>
<span class="-7527183944737711639" onmouseenter="enter('-7527183944737711639');" onmouseout="out('-7527183944737711639');" style=""> 172        ALog.e(TAG, &quot;下载失败，url为null&quot;);                                                                               </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 173        return false;                                                                                               </span>
<span class="2564503102818611052" onmouseenter="enter('2564503102818611052');" onmouseout="out('2564503102818611052');" style=""> 174      } else if (!CheckUtil.checkUrlNotThrow(url)) {                                                                </span>
<span class="-5966032732048138672" onmouseenter="enter('-5966032732048138672');" onmouseout="out('-5966032732048138672');" style=""> 175        ALog.e(TAG, &quot;下载失败，url【&quot; + url + &quot;】错误&quot;);                                                                     </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 176        return false;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 177      }                                                                                                             </span>
<span class="-2484573064810891496" onmouseenter="enter('-2484573064810891496');" onmouseout="out('-2484573064810891496');" style=""> 178      int index = url.indexOf(&quot;://&quot;);                                                                               </span>
<span class="8271637489381568226" onmouseenter="enter('8271637489381568226');" onmouseout="out('8271637489381568226');" style=""> 179      if (index == -1) {                                                                                            </span>
<span class="-7978673376412591020" onmouseenter="enter('-7978673376412591020');" onmouseout="out('-7978673376412591020');" style=""> 180        ALog.e(TAG, &quot;下载失败，url【&quot; + url + &quot;】不合法&quot;);                                                                    </span>
<span class="-5432226360745882584" onmouseenter="enter('-5432226360745882584');" onmouseout="out('-5432226360745882584');" style=""> 181        return false;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182      }                                                                                                             </span>
<span class="-4096355108037590089" onmouseenter="enter('-4096355108037590089');" onmouseout="out('-4096355108037590089');" style=""> 183      if (!TextUtils.isEmpty(mNewUrl)) {                                                                            </span>
<span class="-947626375768951452" onmouseenter="enter('-947626375768951452');" onmouseout="out('-947626375768951452');" style=""> 184        mEntity.setUrl(mNewUrl);                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185      }                                                                                                             </span>
<span class="-3118901906653197100" onmouseenter="enter('-3118901906653197100');" onmouseout="out('-3118901906653197100');" style=""> 186      return true;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187    }                                                                                                               </span>
<span  style=""> 188                                                                                                                    </span>
<span class="9080430511956105708" onmouseenter="enter('9080430511956105708');" onmouseout="out('9080430511956105708');" style=""> 189    void setForceDownload(boolean forceDownload) {                                                                  </span>
<span class="-4055237448265976267" onmouseenter="enter('-4055237448265976267');" onmouseout="out('-4055237448265976267');" style=""> 190      this.forceDownload = forceDownload;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191    }                                                                                                               </span>
<span  style=""> 192                                                                                                                    </span>
<span class="-5102073700561919125" onmouseenter="enter('-5102073700561919125');" onmouseout="out('-5102073700561919125');" style=""> 193    void setUrl(String url) {                                                                                       </span>
<span class="6125552069257613507" onmouseenter="enter('6125552069257613507');" onmouseout="out('6125552069257613507');" style=""> 194      this.mUrl = url;                                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195    }                                                                                                               </span>
<span  style=""> 196                                                                                                                    </span>
<span class="-7069907651445876169" onmouseenter="enter('-7069907651445876169');" onmouseout="out('-7069907651445876169');" style=""> 197    String getUrl() {                                                                                               </span>
<span class="-466968703615862041" onmouseenter="enter('-466968703615862041');" onmouseout="out('-466968703615862041');" style=""> 198      return mUrl;                                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 199    }                                                                                                               </span>
<span  style=""> 200                                                                                                                    </span>
<span class="-4100688759878726932" onmouseenter="enter('-4100688759878726932');" onmouseout="out('-4100688759878726932');" style=""> 201    void setTempFilePath(String mTempFilePath) {                                                                    </span>
<span class="4672554542879215190" onmouseenter="enter('4672554542879215190');" onmouseout="out('4672554542879215190');" style=""> 202      this.mTempFilePath = mTempFilePath;                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203    }                                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            