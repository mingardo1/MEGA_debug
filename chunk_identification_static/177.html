<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>177</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    177
                    <a href="176.html">prev</a>
                    <a href="178.html">next</a>
                    <a href="177_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Automattic/simplenote-android_5eb3a37806aabd04cbc57608c29632bf2011950e_Simplenote/src/main/java/com/automattic/simplenote/NoteWidgetConfigureActivity.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;5eb3a37806aabd04cbc57608c29632bf2011950e:Simplenote/src/main/java/com/automattic/simplenote/NoteWidgetConfigureActivity.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;5eb3a37806aabd04cbc57608c29632bf2011950e^1:Simplenote/src/main/java/com/automattic/simplenote/NoteWidgetConfigureActivity.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;5eb3a37806aabd04cbc57608c29632bf2011950e^2:Simplenote/src/main/java/com/automattic/simplenote/NoteWidgetConfigureActivity.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;3f2cd60452f84fbccd3ff0f3788e7a9d51cd9eac:Simplenote/src/main/java/com/automattic/simplenote/NoteWidgetConfigureActivity.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[sbj]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
   2 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import android.annotation.SuppressLint;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import android.app.PendingIntent;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 import android.appwidget.AppWidgetManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import android.content.Intent;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import android.content.SharedPreferences;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 import android.view.ContextThemeWrapper;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 import android.widget.RemoteViews;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import android.widget.Toast;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import androidx.appcompat.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import androidx.appcompat.app.AppCompatActivity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import androidx.preference.PreferenceManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import com.automattic.simplenote.analytics.AnalyticsTracker;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import com.automattic.simplenote.utils.PrefUtils;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import com.simperium.Simperium;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import com.simperium.client.User;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import static com.automattic.simplenote.NoteWidget.KEY_WIDGET_CLICK;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 import static com.automattic.simplenote.analytics.AnalyticsTracker.CATEGORY_WIDGET;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  39 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED;">  39 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_NOT_FOUND_TAPPEDðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 public class NoteWidgetConfigureActivity extends AppCompatActivity {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42     private AppWidgetManager mWidgetManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43     private NotesCursorAdapter mNotesAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44     private RemoteViews mRemoteViews;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45     private Simplenote mApplication;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46     private int mAppWidgetId = AppWidgetManager.INVALID_APPWIDGET_ID;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48     public NoteWidgetConfigureActivity() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49         super();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53     public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56         // Set the result to CANCELED.  This will cause the widget host to cancel</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57         // out of the widget placement if the user presses the back button.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58         setResult(RESULT_CANCELED);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60         setContentView(R.layout.note_widget_configure);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62         // Verify user authentication.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63         mApplication = (Simplenote) getApplicationContext();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64         Simperium simperium = mApplication.getSimperium();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65         User user = simperium.getUser();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67         if (user.getStatus().equals(User.Status.NOT_AUTHORIZED)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  68             Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONG).show();">  68             Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69             finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72         // Get widget information</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73         mWidgetManager = AppWidgetManager.getInstance(NoteWidgetConfigureActivity.this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74         mRemoteViews = new RemoteViews(getPackageName(), R.layout.note_widget);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75         Intent intent = getIntent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76         Bundle extras = intent.getExtras();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78         if (extras != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  79             mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APPWIDGET_ID);">  79             mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82         if (mAppWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83             finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84             return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87         showDialog();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89         if (intent.hasExtra(KEY_WIDGET_CLICK) &amp;&amp; intent.getExtras() != null &amp;&amp;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90             intent.getExtras().getSerializable(KEY_WIDGET_CLICK) == NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91             AnalyticsTracker.track(</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92                 NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93                 CATEGORY_WIDGET,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94                 &quot;note_widget_note_not_found_tapped&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95             );</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99     private void showDialog() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100         Bucket&lt;Note&gt; mNotesBucket = mApplication.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101         Query&lt;Note&gt; query = Note.all(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102         query.include(Note.TITLE_INDEX_NAME, Note.CONTENT_PREVIEW_INDEX_NAME);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103         PrefUtils.sortNoteQuery(query, NoteWidgetConfigureActivity.this, true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104         ObjectCursor&lt;Note&gt; cursor = query.execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 106         Context context = new ContextThemeWrapper(NoteWidgetConfigureActivity.this, R.style.Theme_Transparent);"> 106         Context context = new ContextThemeWrapper(NoteWidgetConfigureActivity.this, R.style.Theme_TranspaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107         AlertDialog.Builder builder = new AlertDialog.Builder(context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         @SuppressLint(&quot;InflateParams&quot;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 109         final View layout = LayoutInflater.from(context).inflate(R.layout.note_widget_configure_list, null);"> 109         final View layout = LayoutInflater.from(context).inflate(R.layout.note_widget_configure_list, nulðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110         final ListView list = layout.findViewById(R.id.list);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111         mNotesAdapter = new NotesCursorAdapter(NoteWidgetConfigureActivity.this, cursor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112         list.setAdapter(mNotesAdapter);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114         builder.setView(layout)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115             .setTitle(R.string.select_note)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116             .setOnDismissListener(</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117                 new DialogInterface.OnDismissListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118                     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119                     public void onDismiss(DialogInterface dialog) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120                         finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123             )</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124             .setNegativeButton(android.R.string.cancel,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125                 new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126                     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127                     public void onClick(DialogInterface dialog, int which) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128                         finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131             )</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132             .show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135     private class NotesCursorAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136         private final ObjectCursor&lt;Note&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138         private NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; cursor) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139             super(context, cursor, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144         public View newView(Context context, Cursor cursor, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145             return LayoutInflater.from(context).inflate(R.layout.note_list_row, parent, false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149         public Note getItem(int position) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155         public void bindView(View view, final Context context, final Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156             view.setTag(cursor.getPosition());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157             TextView titleTextView = view.findViewById(R.id.note_title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158             TextView contentTextView = view.findViewById(R.id.note_content);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159             String title = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160             String snippet = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162             if (cursor.getColumnIndex(Note.TITLE_INDEX_NAME) &gt; -1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163                 title =  cursor.getString(cursor.getColumnIndex(Note.TITLE_INDEX_NAME));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166             if (cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME) &gt; -1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167                 snippet =  cursor.getString(cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170             // Populate fields with extracted properties</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171             titleTextView.setText(title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172             contentTextView.setText(snippet);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174             view.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175                 @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176                 public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177                     // Get the selected note</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178                     Note note = mNotesAdapter.getItem((int)view.getTag());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180                     // Store link between note and widget in SharedPreferences</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 181                     SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(context);"> 181                     SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(contextðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 182                     preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getSimperiumKey()).apply();"> 182                     preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184                     // Prepare bundle for NoteEditorActivity</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185                     Bundle arguments = new Bundle();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186                     arguments.putString(NoteEditorFragment.ARG_ITEM_ID, note.getSimperiumKey());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 187                     arguments.putBoolean(NoteEditorFragment.ARG_MARKDOWN_ENABLED, note.isMarkdownEnabled());"> 187                     arguments.putBoolean(NoteEditorFragment.ARG_MARKDOWN_ENABLED, note.isMarkdownEnabled(ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189                     // Create intent to navigate to selected note on widget click</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190                     Intent intent = new Intent(context, NoteEditorActivity.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191                     intent.putExtras(arguments);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192                     intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 193                     PendingIntent pendingIntent = PendingIntent.getActivity(context, mAppWidgetId, intent, 0);"> 193                     PendingIntent pendingIntent = PendingIntent.getActivity(context, mAppWidgetId, intentðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195                     // Remove title from content</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196                     String title = note.getTitle();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197                     String contentWithoutTitle = note.getContent().replace(title, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198                     int indexOfNewline = contentWithoutTitle.indexOf(&quot;\n&quot;) + 1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 199                     String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.length() ? indexOfNewline : 0);"> 199                     String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.lðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201                     // Set widget content</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202                     mRemoteViews.setOnClickPendingIntent(R.id.widget_layout, pendingIntent);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203                     mRemoteViews.setTextViewText(R.id.widget_text, title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 204                     mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_title_light, context.getTheme()));"> 204                     mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_titlðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205                     mRemoteViews.setTextViewText(R.id.widget_text_title, title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 206                     mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.color.text_title_light, context.getTheme()));"> 206                     mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.cðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207                     mRemoteViews.setTextViewText(R.id.widget_text_content, content);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208                     mWidgetManager.updateAppWidget(mAppWidgetId, mRemoteViews);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210                     // Set the result as successful</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211                     Intent resultValue = new Intent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212                     resultValue.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, mAppWidgetId);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213                     setResult(RESULT_OK, resultValue);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214                     finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219 }</span>
 220 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223 import android.annotation.SuppressLint;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224 import android.app.PendingIntent;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225 import android.appwidget.AppWidgetManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228 import android.content.Intent;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229 import android.content.SharedPreferences;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232 import android.view.ContextThemeWrapper;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238 import android.widget.RemoteViews;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240 import android.widget.Toast;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242 import androidx.appcompat.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243 import androidx.appcompat.app.AppCompatActivity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244 import androidx.preference.PreferenceManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246 import com.automattic.simplenote.analytics.AnalyticsTracker;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248 import com.automattic.simplenote.utils.PrefUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249 import com.simperium.Simperium;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253 import com.simperium.client.User;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255 import static com.automattic.simplenote.NoteWidget.KEY_WIDGET_CLICK;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256 import static com.automattic.simplenote.analytics.AnalyticsTracker.CATEGORY_WIDGET;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 257 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED;"> 257 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_NOT_FOUND_TAPPEDðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_TAPPED;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260 public class NoteWidgetConfigureActivity extends AppCompatActivity {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261     private AppWidgetManager mWidgetManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262     private NotesCursorAdapter mNotesAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263     private RemoteViews mRemoteViews;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264     private Simplenote mApplication;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265     private int mAppWidgetId = AppWidgetManager.INVALID_APPWIDGET_ID;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267     public NoteWidgetConfigureActivity() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268         super();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272     public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275         // Set the result to CANCELED.  This will cause the widget host to cancel</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276         // out of the widget placement if the user presses the back button.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277         setResult(RESULT_CANCELED);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279         setContentView(R.layout.note_widget_configure);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281         // Verify user authentication.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282         mApplication = (Simplenote) getApplicationContext();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283         Simperium simperium = mApplication.getSimperium();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284         User user = simperium.getUser();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286         if (user.getStatus().equals(User.Status.NOT_AUTHORIZED)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 287             Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONG).show();"> 287             Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288             finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291         // Get widget information</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292         mWidgetManager = AppWidgetManager.getInstance(NoteWidgetConfigureActivity.this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293         mRemoteViews = new RemoteViews(getPackageName(), R.layout.note_widget);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294         Intent intent = getIntent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295         Bundle extras = intent.getExtras();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297         if (extras != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 298             mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APPWIDGET_ID);"> 298             mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301         if (mAppWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302             finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 303             return;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306         showDialog();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308         if (intent.hasExtra(KEY_WIDGET_CLICK) &amp;&amp; intent.getExtras() != null &amp;&amp;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309             intent.getExtras().getSerializable(KEY_WIDGET_CLICK) == NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310             AnalyticsTracker.track(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311                 NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312                 CATEGORY_WIDGET,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313                 &quot;note_widget_note_not_found_tapped&quot;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314             );</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318     private void showDialog() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 319         Bucket&lt;Note&gt; mNotesBucket = mApplication.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320         Query&lt;Note&gt; query = Note.all(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 321         query.include(Note.TITLE_INDEX_NAME, Note.CONTENT_PREVIEW_INDEX_NAME);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 322         PrefUtils.sortNoteQuery(query, NoteWidgetConfigureActivity.this, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 323         ObjectCursor&lt;Note&gt; cursor = query.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 324 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 325         Context context = new ContextThemeWrapper(NoteWidgetConfigureActivity.this, R.style.Theme_Transparent);"> 325         Context context = new ContextThemeWrapper(NoteWidgetConfigureActivity.this, R.style.Theme_TranspaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 326         AlertDialog.Builder builder = new AlertDialog.Builder(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 327         @SuppressLint(&quot;InflateParams&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 328         final View layout = LayoutInflater.from(context).inflate(R.layout.note_widget_configure_list, null);"> 328         final View layout = LayoutInflater.from(context).inflate(R.layout.note_widget_configure_list, nulðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 329         final ListView list = layout.findViewById(R.id.list);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 330         mNotesAdapter = new NotesCursorAdapter(NoteWidgetConfigureActivity.this, cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 331         list.setAdapter(mNotesAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 332 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 333         builder.setView(layout)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 334             .setTitle(R.string.select_note)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 335             .setOnDismissListener(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 336                 new DialogInterface.OnDismissListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 337                     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 338                     public void onDismiss(DialogInterface dialog) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 339                         finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 340                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 341                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 342             )</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 343             .setNegativeButton(android.R.string.cancel,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 344                 new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 345                     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 346                     public void onClick(DialogInterface dialog, int which) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 347                         finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 348                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 349                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 350             )</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 351             .show();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 352     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354     private class NotesCursorAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355         private final ObjectCursor&lt;Note&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357         private NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358             super(context, cursor, 0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363         public View newView(Context context, Cursor cursor, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364             return LayoutInflater.from(context).inflate(R.layout.note_list_row, parent, false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368         public Note getItem(int position) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374         public void bindView(View view, final Context context, final Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375             view.setTag(cursor.getPosition());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376             TextView titleTextView = view.findViewById(R.id.note_title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377             TextView contentTextView = view.findViewById(R.id.note_content);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378             String title = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379             String snippet = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381             if (cursor.getColumnIndex(Note.TITLE_INDEX_NAME) &gt; -1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382                 title =  cursor.getString(cursor.getColumnIndex(Note.TITLE_INDEX_NAME));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385             if (cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME) &gt; -1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386                 snippet =  cursor.getString(cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389             // Populate fields with extracted properties</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390             titleTextView.setText(title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391             contentTextView.setText(snippet);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393             view.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394                 @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395                 public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 396                     // Get the selected note</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 397                     Note note = mNotesAdapter.getItem((int)view.getTag());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399                     // Store link between note and widget in SharedPreferences</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 400                     SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(context);"> 400                     SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(contextðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 401                     preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getSimperiumKey()).apply();"> 401                     preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403                     // Prepare bundle for NoteEditorActivity</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404                     Bundle arguments = new Bundle();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405                     arguments.putBoolean(NoteEditorFragment.ARG_IS_FROM_WIDGET, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406                     arguments.putString(NoteEditorFragment.ARG_ITEM_ID, note.getSimperiumKey());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 407                     arguments.putBoolean(NoteEditorFragment.ARG_MARKDOWN_ENABLED, note.isMarkdownEnabled());"> 407                     arguments.putBoolean(NoteEditorFragment.ARG_MARKDOWN_ENABLED, note.isMarkdownEnabled(ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 408                     arguments.putBoolean(NoteEditorFragment.ARG_PREVIEW_ENABLED, note.isPreviewEnabled());"> 408                     arguments.putBoolean(NoteEditorFragment.ARG_PREVIEW_ENABLED, note.isPreviewEnabled())ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410                     // Create intent to navigate to selected note on widget click</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411                     Intent intent = new Intent(context, NoteEditorActivity.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412                     intent.putExtras(arguments);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413                     intent.putExtra(KEY_WIDGET_CLICK, NOTE_WIDGET_NOTE_TAPPED);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414                     intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 415                     PendingIntent pendingIntent = PendingIntent.getActivity(context, mAppWidgetId, intent, 0);"> 415                     PendingIntent pendingIntent = PendingIntent.getActivity(context, mAppWidgetId, intentðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417                     // Remove title from content</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418                     String title = note.getTitle();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419                     String contentWithoutTitle = note.getContent().replace(title, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420                     int indexOfNewline = contentWithoutTitle.indexOf(&quot;\n&quot;) + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 421                     String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.length() ? indexOfNewline : 0);"> 421                     String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.lðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423                     // Set widget content</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424                     mRemoteViews.setOnClickPendingIntent(R.id.widget_layout, pendingIntent);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425                     mRemoteViews.setTextViewText(R.id.widget_text, title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 426                     mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_title_light, context.getTheme()));"> 426                     mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_titlðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427                     mRemoteViews.setTextViewText(R.id.widget_text_title, title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 428                     mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.color.text_title_light, context.getTheme()));"> 428                     mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.cðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429                     mRemoteViews.setTextViewText(R.id.widget_text_content, content);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430                     mWidgetManager.updateAppWidget(mAppWidgetId, mRemoteViews);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432                     // Set the result as successful</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433                     Intent resultValue = new Intent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434                     resultValue.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, mAppWidgetId);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435                     setResult(RESULT_OK, resultValue);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436                     finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438             });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441 }</span>
 442 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import android.annotation.SuppressLint;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import android.app.PendingIntent;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 import android.appwidget.AppWidgetManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import android.content.Intent;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import android.content.SharedPreferences;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 import android.view.ContextThemeWrapper;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 import android.widget.RemoteViews;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import android.widget.Toast;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 import androidx.appcompat.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  25 import androidx.appcompat.app.AppCompatActivity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 import androidx.preference.PreferenceManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 import com.automattic.simplenote.analytics.AnalyticsTracker;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30 import com.automattic.simplenote.utils.PrefUtils;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31 import com.simperium.Simperium;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35 import com.simperium.client.User;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37 import static com.automattic.simplenote.NoteWidget.KEY_WIDGET_CLICK;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38 import static com.automattic.simplenote.analytics.AnalyticsTracker.CATEGORY_WIDGET;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  39 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED;">  39 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_NOT_FOUND_TAPPEDðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41 public class NoteWidgetConfigureActivity extends AppCompatActivity {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42     private AppWidgetManager mWidgetManager;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43     private NotesCursorAdapter mNotesAdapter;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44     private RemoteViews mRemoteViews;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45     private Simplenote mApplication;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46     private int mAppWidgetId = AppWidgetManager.INVALID_APPWIDGET_ID;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48     public NoteWidgetConfigureActivity() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49         super();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53     public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  54         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56         // Set the result to CANCELED.  This will cause the widget host to cancel</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57         // out of the widget placement if the user presses the back button.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58         setResult(RESULT_CANCELED);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60         setContentView(R.layout.note_widget_configure);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62         // Verify user authentication.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63         mApplication = (Simplenote) getApplicationContext();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64         Simperium simperium = mApplication.getSimperium();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65         User user = simperium.getUser();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67         if (user.getStatus().equals(User.Status.NOT_AUTHORIZED)) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  68             Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONG).show();">  68             Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69             finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72         // Get widget information</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73         mWidgetManager = AppWidgetManager.getInstance(NoteWidgetConfigureActivity.this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74         mRemoteViews = new RemoteViews(getPackageName(), R.layout.note_widget);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75         Intent intent = getIntent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76         Bundle extras = intent.getExtras();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78         if (extras != null) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  79             mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APPWIDGET_ID);">  79             mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82         if (mAppWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83             finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84             return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87         showDialog();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89         if (intent.hasExtra(KEY_WIDGET_CLICK) &amp;&amp; intent.getExtras() != null &amp;&amp;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90             intent.getExtras().getSerializable(KEY_WIDGET_CLICK) == NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91             AnalyticsTracker.track(</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92                 NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93                 CATEGORY_WIDGET,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94                 &quot;note_widget_note_not_found_tapped&quot;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95             );</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99     private void showDialog() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100         Bucket&lt;Note&gt; mNotesBucket = mApplication.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101         Query&lt;Note&gt; query = Note.all(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102         query.include(Note.TITLE_INDEX_NAME, Note.CONTENT_PREVIEW_INDEX_NAME);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 103         PrefUtils.sortNoteQuery(query, NoteWidgetConfigureActivity.this, true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104         ObjectCursor&lt;Note&gt; cursor = query.execute();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 106         Context context = new ContextThemeWrapper(NoteWidgetConfigureActivity.this, R.style.Theme_Transparent);"> 106         Context context = new ContextThemeWrapper(NoteWidgetConfigureActivity.this, R.style.Theme_TranspaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107         AlertDialog.Builder builder = new AlertDialog.Builder(context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108         @SuppressLint(&quot;InflateParams&quot;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 109         final View layout = LayoutInflater.from(context).inflate(R.layout.note_widget_configure_list, null);"> 109         final View layout = LayoutInflater.from(context).inflate(R.layout.note_widget_configure_list, nulðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 110         final ListView list = layout.findViewById(R.id.list);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111         mNotesAdapter = new NotesCursorAdapter(NoteWidgetConfigureActivity.this, cursor);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112         list.setAdapter(mNotesAdapter);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114         builder.setView(layout)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115             .setTitle(R.string.select_note)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116             .setOnDismissListener(</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117                 new DialogInterface.OnDismissListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118                     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119                     public void onDismiss(DialogInterface dialog) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 120                         finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 122                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123             )</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124             .setNegativeButton(android.R.string.cancel,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125                 new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126                     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127                     public void onClick(DialogInterface dialog, int which) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128                         finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129                     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131             )</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132             .show();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135     private class NotesCursorAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136         private final ObjectCursor&lt;Note&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138         private NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; cursor) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139             super(context, cursor, 0);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 141         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 142 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 143         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 144         public View newView(Context context, Cursor cursor, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 145             return LayoutInflater.from(context).inflate(R.layout.note_list_row, parent, false);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 146         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 147 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 148         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 149         public Note getItem(int position) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 150             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 151             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 152         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 153 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 154         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 155         public void bindView(View view, final Context context, final Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 156             view.setTag(cursor.getPosition());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 157             TextView titleTextView = view.findViewById(R.id.note_title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 158             TextView contentTextView = view.findViewById(R.id.note_content);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 159             String title = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 160             String snippet = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 161 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 162             if (cursor.getColumnIndex(Note.TITLE_INDEX_NAME) &gt; -1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 163                 title =  cursor.getString(cursor.getColumnIndex(Note.TITLE_INDEX_NAME));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 164             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 165 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 166             if (cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME) &gt; -1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 167                 snippet =  cursor.getString(cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME));</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 168             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 169 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 170             // Populate fields with extracted properties</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 171             titleTextView.setText(title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 172             contentTextView.setText(snippet);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 173 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 174             view.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 175                 @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 176                 public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 177                     // Get the selected note</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 178                     Note note = mNotesAdapter.getItem((int)view.getTag());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 179 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 180                     // Store link between note and widget in SharedPreferences</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 181                     SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(context);"> 181                     SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(contextðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 182                     preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getSimperiumKey()).apply();"> 182                     preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 183 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 184                     // Prepare bundle for NoteEditorActivity</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 185                     Bundle arguments = new Bundle();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 186                     arguments.putString(NoteEditorFragment.ARG_ITEM_ID, note.getSimperiumKey());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 187                     arguments.putBoolean(NoteEditorFragment.ARG_MARKDOWN_ENABLED, note.isMarkdownEnabled());"> 187                     arguments.putBoolean(NoteEditorFragment.ARG_MARKDOWN_ENABLED, note.isMarkdownEnabled(ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 188 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 189                     // Create intent to navigate to selected note on widget click</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 190                     Intent intent = new Intent(context, NoteEditorActivity.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 191                     intent.putExtras(arguments);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 192                     intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 193                     PendingIntent pendingIntent = PendingIntent.getActivity(context, mAppWidgetId, intent, 0);"> 193                     PendingIntent pendingIntent = PendingIntent.getActivity(context, mAppWidgetId, intentðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 194 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 195                     // Remove title from content</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 196                     String title = note.getTitle();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 197                     String contentWithoutTitle = note.getContent().replace(title, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 198                     int indexOfNewline = contentWithoutTitle.indexOf(&quot;\n&quot;) + 1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 199                     String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.length() ? indexOfNewline : 0);"> 199                     String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.lðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 200 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 201                     // Set widget content</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 202                     mRemoteViews.setOnClickPendingIntent(R.id.widget_layout, pendingIntent);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 203                     mRemoteViews.setTextViewText(R.id.widget_text, title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 204                     mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_title_light, context.getTheme()));"> 204                     mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_titlðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 205                     mRemoteViews.setTextViewText(R.id.widget_text_title, title);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 206                     mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.color.text_title_light, context.getTheme()));"> 206                     mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.cðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 207                     mRemoteViews.setTextViewText(R.id.widget_text_content, content);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 208                     mWidgetManager.updateAppWidget(mAppWidgetId, mRemoteViews);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 209 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 210                     // Set the result as successful</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 211                     Intent resultValue = new Intent();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 212                     resultValue.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, mAppWidgetId);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 213                     setResult(RESULT_OK, resultValue);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 214                     finish();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 215                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 216             });</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 217         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 218     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 219 }</span>
 220 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223 import android.annotation.SuppressLint;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224 import android.app.PendingIntent;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225 import android.appwidget.AppWidgetManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228 import android.content.Intent;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229 import android.content.SharedPreferences;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232 import android.view.ContextThemeWrapper;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238 import android.widget.RemoteViews;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240 import android.widget.Toast;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242 import androidx.appcompat.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243 import androidx.appcompat.app.AppCompatActivity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244 import androidx.preference.PreferenceManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246 import com.automattic.simplenote.analytics.AnalyticsTracker;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248 import com.automattic.simplenote.utils.PrefUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249 import com.simperium.Simperium;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253 import com.simperium.client.User;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255 import static com.automattic.simplenote.NoteWidget.KEY_WIDGET_CLICK;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256 import static com.automattic.simplenote.analytics.AnalyticsTracker.CATEGORY_WIDGET;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 257 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED;"> 257 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_NOT_FOUND_TAPPEDðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_TAPPED;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 259 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260 public class NoteWidgetConfigureActivity extends AppCompatActivity {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261     private AppWidgetManager mWidgetManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262     private NotesCursorAdapter mNotesAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263     private RemoteViews mRemoteViews;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264     private Simplenote mApplication;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265     private int mAppWidgetId = AppWidgetManager.INVALID_APPWIDGET_ID;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 266 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267     public NoteWidgetConfigureActivity() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268         super();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272     public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275         // Set the result to CANCELED.  This will cause the widget host to cancel</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 276         // out of the widget placement if the user presses the back button.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277         setResult(RESULT_CANCELED);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 278 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279         setContentView(R.layout.note_widget_configure);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281         // Verify user authentication.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282         mApplication = (Simplenote) getApplicationContext();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283         Simperium simperium = mApplication.getSimperium();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284         User user = simperium.getUser();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286         if (user.getStatus().equals(User.Status.NOT_AUTHORIZED)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 287             Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONG).show();"> 287             Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288             finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291         // Get widget information</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292         mWidgetManager = AppWidgetManager.getInstance(NoteWidgetConfigureActivity.this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293         mRemoteViews = new RemoteViews(getPackageName(), R.layout.note_widget);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294         Intent intent = getIntent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295         Bundle extras = intent.getExtras();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 296 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 297         if (extras != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 298             mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APPWIDGET_ID);"> 298             mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 299         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 300 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 301         if (mAppWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 302             finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 303             return;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 304         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 305 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 306         showDialog();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 307 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 308         if (intent.hasExtra(KEY_WIDGET_CLICK) &amp;&amp; intent.getExtras() != null &amp;&amp;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 309             intent.getExtras().getSerializable(KEY_WIDGET_CLICK) == NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 310             AnalyticsTracker.track(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 311                 NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 312                 CATEGORY_WIDGET,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 313                 &quot;note_widget_note_not_found_tapped&quot;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 314             );</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 315         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 316     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 317 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 318     private void showDialog() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 319         Bucket&lt;Note&gt; mNotesBucket = mApplication.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 320         Query&lt;Note&gt; query = Note.all(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 321         query.include(Note.TITLE_INDEX_NAME, Note.CONTENT_PREVIEW_INDEX_NAME);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 322         PrefUtils.sortNoteQuery(query, NoteWidgetConfigureActivity.this, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 323         ObjectCursor&lt;Note&gt; cursor = query.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 324 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 325         Context context = new ContextThemeWrapper(NoteWidgetConfigureActivity.this, R.style.Theme_Transparent);"> 325         Context context = new ContextThemeWrapper(NoteWidgetConfigureActivity.this, R.style.Theme_TranspaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 326         AlertDialog.Builder builder = new AlertDialog.Builder(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 327         @SuppressLint(&quot;InflateParams&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 328         final View layout = LayoutInflater.from(context).inflate(R.layout.note_widget_configure_list, null);"> 328         final View layout = LayoutInflater.from(context).inflate(R.layout.note_widget_configure_list, nulðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 329         final ListView list = layout.findViewById(R.id.list);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 330         mNotesAdapter = new NotesCursorAdapter(NoteWidgetConfigureActivity.this, cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 331         list.setAdapter(mNotesAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 332 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 333         builder.setView(layout)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 334             .setTitle(R.string.select_note)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 335             .setOnDismissListener(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 336                 new DialogInterface.OnDismissListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 337                     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 338                     public void onDismiss(DialogInterface dialog) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 339                         finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 340                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 341                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 342             )</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 343             .setNegativeButton(android.R.string.cancel,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 344                 new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 345                     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 346                     public void onClick(DialogInterface dialog, int which) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 347                         finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 348                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 349                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 350             )</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 351             .show();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 352     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 353 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 354     private class NotesCursorAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 355         private final ObjectCursor&lt;Note&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 356 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 357         private NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 358             super(context, cursor, 0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 359             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 360         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 361 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 362         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 363         public View newView(Context context, Cursor cursor, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 364             return LayoutInflater.from(context).inflate(R.layout.note_list_row, parent, false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 365         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 366 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 367         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 368         public Note getItem(int position) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 369             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 370             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 371         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 372 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 373         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 374         public void bindView(View view, final Context context, final Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 375             view.setTag(cursor.getPosition());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 376             TextView titleTextView = view.findViewById(R.id.note_title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 377             TextView contentTextView = view.findViewById(R.id.note_content);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 378             String title = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 379             String snippet = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 380 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 381             if (cursor.getColumnIndex(Note.TITLE_INDEX_NAME) &gt; -1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 382                 title =  cursor.getString(cursor.getColumnIndex(Note.TITLE_INDEX_NAME));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 383             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 384 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 385             if (cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME) &gt; -1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 386                 snippet =  cursor.getString(cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 387             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 388 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 389             // Populate fields with extracted properties</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 390             titleTextView.setText(title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 391             contentTextView.setText(snippet);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 392 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 393             view.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 394                 @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 395                 public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 396                     // Get the selected note</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 397                     Note note = mNotesAdapter.getItem((int)view.getTag());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 398 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 399                     // Store link between note and widget in SharedPreferences</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 400                     SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(context);"> 400                     SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(contextðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 401                     preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getSimperiumKey()).apply();"> 401                     preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 402 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 403                     // Prepare bundle for NoteEditorActivity</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 404                     Bundle arguments = new Bundle();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 405                     arguments.putBoolean(NoteEditorFragment.ARG_IS_FROM_WIDGET, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 406                     arguments.putString(NoteEditorFragment.ARG_ITEM_ID, note.getSimperiumKey());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 407                     arguments.putBoolean(NoteEditorFragment.ARG_MARKDOWN_ENABLED, note.isMarkdownEnabled());"> 407                     arguments.putBoolean(NoteEditorFragment.ARG_MARKDOWN_ENABLED, note.isMarkdownEnabled(ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 408                     arguments.putBoolean(NoteEditorFragment.ARG_PREVIEW_ENABLED, note.isPreviewEnabled());"> 408                     arguments.putBoolean(NoteEditorFragment.ARG_PREVIEW_ENABLED, note.isPreviewEnabled())ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 409 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 410                     // Create intent to navigate to selected note on widget click</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 411                     Intent intent = new Intent(context, NoteEditorActivity.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 412                     intent.putExtras(arguments);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 413                     intent.putExtra(KEY_WIDGET_CLICK, NOTE_WIDGET_NOTE_TAPPED);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 414                     intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 415                     PendingIntent pendingIntent = PendingIntent.getActivity(context, mAppWidgetId, intent, 0);"> 415                     PendingIntent pendingIntent = PendingIntent.getActivity(context, mAppWidgetId, intentðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 416 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 417                     // Remove title from content</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 418                     String title = note.getTitle();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 419                     String contentWithoutTitle = note.getContent().replace(title, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 420                     int indexOfNewline = contentWithoutTitle.indexOf(&quot;\n&quot;) + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 421                     String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.length() ? indexOfNewline : 0);"> 421                     String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.lðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 422 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 423                     // Set widget content</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 424                     mRemoteViews.setOnClickPendingIntent(R.id.widget_layout, pendingIntent);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 425                     mRemoteViews.setTextViewText(R.id.widget_text, title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 426                     mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_title_light, context.getTheme()));"> 426                     mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_titlðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 427                     mRemoteViews.setTextViewText(R.id.widget_text_title, title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 428                     mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.color.text_title_light, context.getTheme()));"> 428                     mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.cðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 429                     mRemoteViews.setTextViewText(R.id.widget_text_content, content);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 430                     mWidgetManager.updateAppWidget(mAppWidgetId, mRemoteViews);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 431 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 432                     // Set the result as successful</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 433                     Intent resultValue = new Intent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 434                     resultValue.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, mAppWidgetId);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 435                     setResult(RESULT_OK, resultValue);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 436                     finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 437                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 438             });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 439         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 440     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 441 }</span>
 442 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
   4 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   5 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   6 package com.automattic.simplenote;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   7 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   8 import android.annotation.SuppressLint;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   9 import android.app.PendingIntent;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  10 import android.appwidget.AppWidgetManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  11 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  12 import android.content.DialogInterface;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  13 import android.content.Intent;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  14 import android.content.SharedPreferences;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  15 import android.database.Cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  16 import android.os.Bundle;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  17 import android.view.ContextThemeWrapper;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  18 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  19 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  20 import android.view.ViewGroup;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  21 import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  22 import android.widget.ListView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23 import android.widget.RemoteViews;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  24 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  25 import android.widget.Toast;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  26 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  27 import androidx.appcompat.app.AlertDialog;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  28 import androidx.appcompat.app.AppCompatActivity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  29 import androidx.preference.PreferenceManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  30 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  31 import com.automattic.simplenote.analytics.AnalyticsTracker;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  32 import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  33 import com.automattic.simplenote.utils.PrefUtils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  34 import com.simperium.Simperium;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  35 import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36 import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37 import com.simperium.client.Query;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38 import com.simperium.client.User;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  39 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  40 import static com.automattic.simplenote.NoteWidget.KEY_WIDGET_CLICK;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  41 import static com.automattic.simplenote.analytics.AnalyticsTracker.CATEGORY_WIDGET;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  42 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED;">  42 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_NOT_FOUND_TAPPEDðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  43 import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_TAPPED;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  44 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  45 public class NoteWidgetConfigureActivity extends AppCompatActivity {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  46     private AppWidgetManager mWidgetManager;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  47     private NotesCursorAdapter mNotesAdapter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  48     private RemoteViews mRemoteViews;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  49     private Simplenote mApplication;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50     private int mAppWidgetId = AppWidgetManager.INVALID_APPWIDGET_ID;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52     public NoteWidgetConfigureActivity() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53         super();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  55 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  56     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57     public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58         super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60         // Set the result to CANCELED.  This will cause the widget host to cancel</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61         // out of the widget placement if the user presses the back button.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62         setResult(RESULT_CANCELED);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64         setContentView(R.layout.note_widget_configure);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66         // Verify user authentication.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67         mApplication = (Simplenote) getApplicationContext();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68         Simperium simperium = mApplication.getSimperium();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69         User user = simperium.getUser();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  70 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71         if (user.getStatus().equals(User.Status.NOT_AUTHORIZED)) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  72             Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONG).show();">  72             Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73             finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76         // Get widget information</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77         mWidgetManager = AppWidgetManager.getInstance(NoteWidgetConfigureActivity.this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78         mRemoteViews = new RemoteViews(getPackageName(), R.layout.note_widget);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79         Intent intent = getIntent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  80         Bundle extras = intent.getExtras();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82         if (extras != null) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  83             mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APPWIDGET_ID);">  83             mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86         if (mAppWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87             finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88             return;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91         showDialog();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93         if (intent.hasExtra(KEY_WIDGET_CLICK) &amp;&amp; intent.getExtras() != null &amp;&amp;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94             intent.getExtras().getSerializable(KEY_WIDGET_CLICK) == NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95             AnalyticsTracker.track(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96                 NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97                 CATEGORY_WIDGET,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98                 &quot;note_widget_note_not_found_tapped&quot;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99             );</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103     private void showDialog() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104         Bucket&lt;Note&gt; mNotesBucket = mApplication.getNotesBucket();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105         Query&lt;Note&gt; query = Note.all(mNotesBucket);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106         query.include(Note.TITLE_INDEX_NAME, Note.CONTENT_PREVIEW_INDEX_NAME);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107         PrefUtils.sortNoteQuery(query, NoteWidgetConfigureActivity.this, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108         ObjectCursor&lt;Note&gt; cursor = query.execute();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 110         Context context = new ContextThemeWrapper(NoteWidgetConfigureActivity.this, R.style.Theme_Transparent);"> 110         Context context = new ContextThemeWrapper(NoteWidgetConfigureActivity.this, R.style.Theme_TranspaðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111         AlertDialog.Builder builder = new AlertDialog.Builder(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112         @SuppressLint(&quot;InflateParams&quot;)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 113         final View layout = LayoutInflater.from(context).inflate(R.layout.note_widget_configure_list, null);"> 113         final View layout = LayoutInflater.from(context).inflate(R.layout.note_widget_configure_list, nulðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114         final ListView list = layout.findViewById(R.id.list);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115         mNotesAdapter = new NotesCursorAdapter(NoteWidgetConfigureActivity.this, cursor);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116         list.setAdapter(mNotesAdapter);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118         builder.setView(layout)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119             .setTitle(R.string.select_note)</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120             .setOnDismissListener(</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121                 new DialogInterface.OnDismissListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122                     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 123                     public void onDismiss(DialogInterface dialog) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124                         finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127             )</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128             .setNegativeButton(android.R.string.cancel,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129                 new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 130                     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131                     public void onClick(DialogInterface dialog, int which) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132                         finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133                     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135             )</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136             .show();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139     private class NotesCursorAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 140         private final ObjectCursor&lt;Note&gt; mCursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142         private NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143             super(context, cursor, 0);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144             mCursor = cursor;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148         public View newView(Context context, Cursor cursor, ViewGroup parent) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149             return LayoutInflater.from(context).inflate(R.layout.note_list_row, parent, false);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153         public Note getItem(int position) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154             mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155             return mCursor.getObject();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159         public void bindView(View view, final Context context, final Cursor cursor) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160             view.setTag(cursor.getPosition());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161             TextView titleTextView = view.findViewById(R.id.note_title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162             TextView contentTextView = view.findViewById(R.id.note_content);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163             String title = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164             String snippet = &quot;&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166             if (cursor.getColumnIndex(Note.TITLE_INDEX_NAME) &gt; -1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 167                 title =  cursor.getString(cursor.getColumnIndex(Note.TITLE_INDEX_NAME));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170             if (cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME) &gt; -1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171                 snippet =  cursor.getString(cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME));</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174             // Populate fields with extracted properties</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175             titleTextView.setText(title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176             contentTextView.setText(snippet);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178             view.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179                 @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180                 public void onClick(View view) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181                     // Get the selected note</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182                     Note note = mNotesAdapter.getItem((int)view.getTag());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184                     // Store link between note and widget in SharedPreferences</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 185                     SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(context);"> 185                     SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(contextðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 186                     preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getSimperiumKey()).apply();"> 186                     preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188                     // Prepare bundle for NoteEditorActivity</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189                     Bundle arguments = new Bundle();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190                     arguments.putBoolean(NoteEditorFragment.ARG_IS_FROM_WIDGET, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191                     arguments.putString(NoteEditorFragment.ARG_ITEM_ID, note.getSimperiumKey());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 192                     arguments.putBoolean(NoteEditorFragment.ARG_MARKDOWN_ENABLED, note.isMarkdownEnabled());"> 192                     arguments.putBoolean(NoteEditorFragment.ARG_MARKDOWN_ENABLED, note.isMarkdownEnabled(ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 193                     arguments.putBoolean(NoteEditorFragment.ARG_PREVIEW_ENABLED, note.isPreviewEnabled());"> 193                     arguments.putBoolean(NoteEditorFragment.ARG_PREVIEW_ENABLED, note.isPreviewEnabled())ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195                     // Create intent to navigate to selected note on widget click</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196                     Intent intent = new Intent(context, NoteEditorActivity.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197                     intent.putExtras(arguments);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198                     intent.putExtra(KEY_WIDGET_CLICK, NOTE_WIDGET_NOTE_TAPPED);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199                     intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 200                     PendingIntent pendingIntent = PendingIntent.getActivity(context, mAppWidgetId, intent, 0);"> 200                     PendingIntent pendingIntent = PendingIntent.getActivity(context, mAppWidgetId, intentðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202                     // Remove title from content</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203                     String title = note.getTitle();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204                     String contentWithoutTitle = note.getContent().replace(title, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205                     int indexOfNewline = contentWithoutTitle.indexOf(&quot;\n&quot;) + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 206                     String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.length() ? indexOfNewline : 0);"> 206                     String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.lðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208                     // Set widget content</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209                     mRemoteViews.setOnClickPendingIntent(R.id.widget_layout, pendingIntent);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210                     mRemoteViews.setTextViewText(R.id.widget_text, title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 211                     mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_title_light, context.getTheme()));"> 211                     mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_titlðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212                     mRemoteViews.setTextViewText(R.id.widget_text_title, title);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 213                     mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.color.text_title_light, context.getTheme()));"> 213                     mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.cðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214                     mRemoteViews.setTextViewText(R.id.widget_text_content, content);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215                     mWidgetManager.updateAppWidget(mAppWidgetId, mRemoteViews);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217                     // Set the result as successful</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218                     Intent resultValue = new Intent();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219                     resultValue.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, mAppWidgetId);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220                     setResult(RESULT_OK, resultValue);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221                     finish();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223             });</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226 }</span>
 227 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   1 -package com.automattic.simplenote;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   2 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   3 -import android.annotation.SuppressLint;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   4 -import android.app.PendingIntent;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   5 -import android.appwidget.AppWidgetManager;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   6 -import android.content.Context;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   7 -import android.content.DialogInterface;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   8 -import android.content.Intent;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   9 -import android.content.SharedPreferences;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  10 -import android.database.Cursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  11 -import android.os.Bundle;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  12 -import android.view.ContextThemeWrapper;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  13 -import android.view.LayoutInflater;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  14 -import android.view.View;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  15 -import android.view.ViewGroup;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  16 -import android.widget.CursorAdapter;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  17 -import android.widget.ListView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  18 -import android.widget.RemoteViews;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -import android.widget.TextView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -import android.widget.Toast;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -import androidx.appcompat.app.AlertDialog;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -import androidx.appcompat.app.AppCompatActivity;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -import androidx.preference.PreferenceManager;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  26 -import com.automattic.simplenote.analytics.AnalyticsTracker;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -import com.automattic.simplenote.models.Note;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  28 -import com.automattic.simplenote.utils.PrefUtils;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -import com.simperium.Simperium;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 -import com.simperium.client.Bucket;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  31 -import com.simperium.client.Bucket.ObjectCursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 -import com.simperium.client.Query;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -import com.simperium.client.User;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  35 -import static com.automattic.simplenote.NoteWidget.KEY_WIDGET_CLICK;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 -import static com.automattic.simplenote.analytics.AnalyticsTracker.CATEGORY_WIDGET;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  37 -import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  38 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  39 -public class NoteWidgetConfigureActivity extends AppCompatActivity {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 -    private AppWidgetManager mWidgetManager;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 -    private NotesCursorAdapter mNotesAdapter;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 -    private RemoteViews mRemoteViews;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 -    private Simplenote mApplication;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 -    private int mAppWidgetId = AppWidgetManager.INVALID_APPWIDGET_ID;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -    public NoteWidgetConfigureActivity() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -        super();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  50 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -    public void onCreate(Bundle savedInstanceState) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  52 -        super.onCreate(savedInstanceState);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  53 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -        // Set the result to CANCELED.  This will cause the widget host to cancel</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -        // out of the widget placement if the user presses the back button.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -        setResult(RESULT_CANCELED);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -        setContentView(R.layout.note_widget_configure);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -        // Verify user authentication.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  61 -        mApplication = (Simplenote) getApplicationContext();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  62 -        Simperium simperium = mApplication.getSimperium();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -        User user = simperium.getUser();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -        if (user.getStatus().equals(User.Status.NOT_AUTHORIZED)) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  66 -            Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONG).show();">  66 -            Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONG).show()ðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  67 -            finish();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  68 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  69 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  70 -        // Get widget information</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  71 -        mWidgetManager = AppWidgetManager.getInstance(NoteWidgetConfigureActivity.this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  72 -        mRemoteViews = new RemoteViews(getPackageName(), R.layout.note_widget);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -        Intent intent = getIntent();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -        Bundle extras = intent.getExtras();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  76 -        if (extras != null) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title="  77 -            mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APPWIDGET_ID);">  77 -            mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APPWIDGET_IðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  78 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  79 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -        if (mAppWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -            finish();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -            return;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  84 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -        showDialog();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -        if (intent.hasExtra(KEY_WIDGET_CLICK) &amp;&amp; intent.getExtras() != null &amp;&amp;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -            intent.getExtras().getSerializable(KEY_WIDGET_CLICK) == NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -            AnalyticsTracker.track(</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  90 -                NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -                CATEGORY_WIDGET,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -                &quot;note_widget_note_not_found_tapped&quot;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -            );</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  95 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  96 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  97 -    private void showDialog() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  98 -        Bucket&lt;Note&gt; mNotesBucket = mApplication.getNotesBucket();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  99 -        Query&lt;Note&gt; query = Note.all(mNotesBucket);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 100 -        query.include(Note.TITLE_INDEX_NAME, Note.CONTENT_PREVIEW_INDEX_NAME);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 101 -        PrefUtils.sortNoteQuery(query, NoteWidgetConfigureActivity.this, true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 102 -        ObjectCursor&lt;Note&gt; cursor = query.execute();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 103 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 104 -        Context context = new ContextThemeWrapper(NoteWidgetConfigureActivity.this, R.style.Theme_Transparent);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 105 -        AlertDialog.Builder builder = new AlertDialog.Builder(context);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 106 -        @SuppressLint(&quot;InflateParams&quot;)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 107 -        final View layout = LayoutInflater.from(context).inflate(R.layout.note_widget_configure_list, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 108 -        final ListView list = layout.findViewById(R.id.list);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 109 -        mNotesAdapter = new NotesCursorAdapter(NoteWidgetConfigureActivity.this, cursor);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 110 -        list.setAdapter(mNotesAdapter);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 111 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 112 -        builder.setView(layout)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 113 -            .setTitle(R.string.select_note)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 114 -            .setOnDismissListener(</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 115 -                new DialogInterface.OnDismissListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -                    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -                    public void onDismiss(DialogInterface dialog) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 118 -                        finish();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 119 -                    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 120 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -            )</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -            .setNegativeButton(android.R.string.cancel,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 123 -                new DialogInterface.OnClickListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 124 -                    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -                    public void onClick(DialogInterface dialog, int which) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 126 -                        finish();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 127 -                    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 128 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 129 -            )</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 130 -            .show();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 131 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 132 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 133 -    private class NotesCursorAdapter extends CursorAdapter {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 134 -        private final ObjectCursor&lt;Note&gt; mCursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 135 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 136 -        private NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; cursor) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 137 -            super(context, cursor, 0);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 138 -            mCursor = cursor;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 139 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 140 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 141 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 142 -        public View newView(Context context, Cursor cursor, ViewGroup parent) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 143 -            return LayoutInflater.from(context).inflate(R.layout.note_list_row, parent, false);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 144 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 145 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 146 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 147 -        public Note getItem(int position) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 148 -            mCursor.moveToPosition(position);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 149 -            return mCursor.getObject();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 150 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 151 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 152 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 153 -        public void bindView(View view, final Context context, final Cursor cursor) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 154 -            view.setTag(cursor.getPosition());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 155 -            TextView titleTextView = view.findViewById(R.id.note_title);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 156 -            TextView contentTextView = view.findViewById(R.id.note_content);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 157 -            String title = &quot;&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 158 -            String snippet = &quot;&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 159 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 160 -            if (cursor.getColumnIndex(Note.TITLE_INDEX_NAME) &gt; -1) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 161 -                title =  cursor.getString(cursor.getColumnIndex(Note.TITLE_INDEX_NAME));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 162 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 163 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 164 -            if (cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME) &gt; -1) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 165 -                snippet =  cursor.getString(cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 166 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 167 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 168 -            // Populate fields with extracted properties</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 169 -            titleTextView.setText(title);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 170 -            contentTextView.setText(snippet);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 171 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 172 -            view.setOnClickListener(new View.OnClickListener() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 173 -                @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 174 -                public void onClick(View view) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 175 -                    // Get the selected note</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 176 -                    Note note = mNotesAdapter.getItem((int)view.getTag());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 177 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 178 -                    // Store link between note and widget in SharedPreferences</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 179 -                    SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(context);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 180 -                    preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getSimperiumKey()).apply();"> 180 -                    preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getSimperiumðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 181 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 182 -                    // Prepare bundle for NoteEditorActivity</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 183 -                    Bundle arguments = new Bundle();</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 184 -                    arguments.putString(NoteEditorFragment.ARG_ITEM_ID, note.getSimperiumKey());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 185 -                    arguments.putBoolean(NoteEditorFragment.ARG_MARKDOWN_ENABLED, note.isMarkdownEnabled());</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 186 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 187 -                    // Create intent to navigate to selected note on widget click</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 188 -                    Intent intent = new Intent(context, NoteEditorActivity.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 189 -                    intent.putExtras(arguments);</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 190 -                    intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 191 -                    PendingIntent pendingIntent = PendingIntent.getActivity(context, mAppWidgetId, intent, 0);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 192 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 193 -                    // Remove title from content</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 194 -                    String title = note.getTitle();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 195 -                    String contentWithoutTitle = note.getContent().replace(title, &quot;&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 196 -                    int indexOfNewline = contentWithoutTitle.indexOf(&quot;\n&quot;) + 1;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 197 -                    String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.length() ? indexOfNewline : 0);"> 197 -                    String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.length() ?ðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 198 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 199 -                    // Set widget content</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 200 -                    mRemoteViews.setOnClickPendingIntent(R.id.widget_layout, pendingIntent);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 201 -                    mRemoteViews.setTextViewText(R.id.widget_text, title);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 202 -                    mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_title_light, context.getTheme()));"> 202 -                    mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_title_light, ðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 203 -                    mRemoteViews.setTextViewText(R.id.widget_text_title, title);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 204 -                    mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.color.text_title_light, context.getTheme()));"> 204 -                    mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.color.textðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 205 -                    mRemoteViews.setTextViewText(R.id.widget_text_content, content);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 206 -                    mWidgetManager.updateAppWidget(mAppWidgetId, mRemoteViews);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 207 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 208 -                    // Set the result as successful</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 209 -                    Intent resultValue = new Intent();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 210 -                    resultValue.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, mAppWidgetId);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 211 -                    setResult(RESULT_OK, resultValue);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 212 -                    finish();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 213 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 214 -            });</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 215 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 216 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 217 -}</span></pre></td>
                            <td><pre>   1  package com.automattic.simplenote;
   2  
   3  import android.annotation.SuppressLint;
   4  import android.app.PendingIntent;
   5  import android.appwidget.AppWidgetManager;
   6  import android.content.Context;
   7  import android.content.DialogInterface;
   8  import android.content.Intent;
   9  import android.content.SharedPreferences;
  10  import android.database.Cursor;
  11  import android.os.Bundle;
  12  import android.view.ContextThemeWrapper;
  13  import android.view.LayoutInflater;
  14  import android.view.View;
  15  import android.view.ViewGroup;
  16  import android.widget.CursorAdapter;
  17  import android.widget.ListView;
  18  import android.widget.RemoteViews;
  19  import android.widget.TextView;
  20  import android.widget.Toast;
  21  
  22  import androidx.appcompat.app.AlertDialog;
  23  import androidx.appcompat.app.AppCompatActivity;
  24  import androidx.preference.PreferenceManager;
  25  
  26  import com.automattic.simplenote.analytics.AnalyticsTracker;
  27  import com.automattic.simplenote.models.Note;
  28  import com.automattic.simplenote.utils.PrefUtils;
  29  import com.simperium.Simperium;
  30  import com.simperium.client.Bucket;
  31  import com.simperium.client.Bucket.ObjectCursor;
  32  import com.simperium.client.Query;
  33  import com.simperium.client.User;
  34  
  35  import static com.automattic.simplenote.NoteWidget.KEY_WIDGET_CLICK;
  36  import static com.automattic.simplenote.analytics.AnalyticsTracker.CATEGORY_WIDGET;
  37  import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  38 +import static com.automattic.simplenote.analytics.AnalyticsTracker.Stat.NOTE_WIDGET_NOTE_TAPPED;</span>
  39  
  40  public class NoteWidgetConfigureActivity extends AppCompatActivity {
  41      private AppWidgetManager mWidgetManager;
  42      private NotesCursorAdapter mNotesAdapter;
  43      private RemoteViews mRemoteViews;
  44      private Simplenote mApplication;
  45      private int mAppWidgetId = AppWidgetManager.INVALID_APPWIDGET_ID;
  46  
  47      public NoteWidgetConfigureActivity() {
  48          super();
  49      }
  50  
  51      @Override
  52      public void onCreate(Bundle savedInstanceState) {
  53          super.onCreate(savedInstanceState);
  54  
  55          // Set the result to CANCELED.  This will cause the widget host to cancel
  56          // out of the widget placement if the user presses the back button.
  57          setResult(RESULT_CANCELED);
  58  
  59          setContentView(R.layout.note_widget_configure);
  60  
  61          // Verify user authentication.
  62          mApplication = (Simplenote) getApplicationContext();
  63          Simperium simperium = mApplication.getSimperium();
  64          User user = simperium.getUser();
  65  
  66          if (user.getStatus().equals(User.Status.NOT_AUTHORIZED)) {
<abbr title="  67              Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONG).show();">  67              Toast.makeText(NoteWidgetConfigureActivity.this, R.string.log_in_add_widget, Toast.LENGTH_LONG).show()ðŸ”µ</abbr>
  68              finish();
  69          }
  70  
  71          // Get widget information
  72          mWidgetManager = AppWidgetManager.getInstance(NoteWidgetConfigureActivity.this);
  73          mRemoteViews = new RemoteViews(getPackageName(), R.layout.note_widget);
  74          Intent intent = getIntent();
  75          Bundle extras = intent.getExtras();
  76  
  77          if (extras != null) {
<abbr title="  78              mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APPWIDGET_ID);">  78              mAppWidgetId = extras.getInt(AppWidgetManager.EXTRA_APPWIDGET_ID, AppWidgetManager.INVALID_APPWIDGET_IðŸ”µ</abbr>
  79          }
  80  
  81          if (mAppWidgetId == AppWidgetManager.INVALID_APPWIDGET_ID) {
  82              finish();
  83              return;
  84          }
  85  
  86          showDialog();
  87  
  88          if (intent.hasExtra(KEY_WIDGET_CLICK) &amp;&amp; intent.getExtras() != null &amp;&amp;
  89              intent.getExtras().getSerializable(KEY_WIDGET_CLICK) == NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED) {
  90              AnalyticsTracker.track(
  91                  NOTE_WIDGET_NOTE_NOT_FOUND_TAPPED,
  92                  CATEGORY_WIDGET,
  93                  &quot;note_widget_note_not_found_tapped&quot;
  94              );
  95          }
  96      }
  97  
  98      private void showDialog() {
  99          Bucket&lt;Note&gt; mNotesBucket = mApplication.getNotesBucket();
 100          Query&lt;Note&gt; query = Note.all(mNotesBucket);
 101          query.include(Note.TITLE_INDEX_NAME, Note.CONTENT_PREVIEW_INDEX_NAME);
 102          PrefUtils.sortNoteQuery(query, NoteWidgetConfigureActivity.this, true);
 103          ObjectCursor&lt;Note&gt; cursor = query.execute();
 104  
 105          Context context = new ContextThemeWrapper(NoteWidgetConfigureActivity.this, R.style.Theme_Transparent);
 106          AlertDialog.Builder builder = new AlertDialog.Builder(context);
 107          @SuppressLint(&quot;InflateParams&quot;)
 108          final View layout = LayoutInflater.from(context).inflate(R.layout.note_widget_configure_list, null);
 109          final ListView list = layout.findViewById(R.id.list);
 110          mNotesAdapter = new NotesCursorAdapter(NoteWidgetConfigureActivity.this, cursor);
 111          list.setAdapter(mNotesAdapter);
 112  
 113          builder.setView(layout)
 114              .setTitle(R.string.select_note)
 115              .setOnDismissListener(
 116                  new DialogInterface.OnDismissListener() {
 117                      @Override
 118                      public void onDismiss(DialogInterface dialog) {
 119                          finish();
 120                      }
 121                  }
 122              )
 123              .setNegativeButton(android.R.string.cancel,
 124                  new DialogInterface.OnClickListener() {
 125                      @Override
 126                      public void onClick(DialogInterface dialog, int which) {
 127                          finish();
 128                      }
 129                  }
 130              )
 131              .show();
 132      }
 133  
 134      private class NotesCursorAdapter extends CursorAdapter {
 135          private final ObjectCursor&lt;Note&gt; mCursor;
 136  
 137          private NotesCursorAdapter(Context context, ObjectCursor&lt;Note&gt; cursor) {
 138              super(context, cursor, 0);
 139              mCursor = cursor;
 140          }
 141  
 142          @Override
 143          public View newView(Context context, Cursor cursor, ViewGroup parent) {
 144              return LayoutInflater.from(context).inflate(R.layout.note_list_row, parent, false);
 145          }
 146  
 147          @Override
 148          public Note getItem(int position) {
 149              mCursor.moveToPosition(position);
 150              return mCursor.getObject();
 151          }
 152  
 153          @Override
 154          public void bindView(View view, final Context context, final Cursor cursor) {
 155              view.setTag(cursor.getPosition());
 156              TextView titleTextView = view.findViewById(R.id.note_title);
 157              TextView contentTextView = view.findViewById(R.id.note_content);
 158              String title = &quot;&quot;;
 159              String snippet = &quot;&quot;;
 160  
 161              if (cursor.getColumnIndex(Note.TITLE_INDEX_NAME) &gt; -1) {
 162                  title =  cursor.getString(cursor.getColumnIndex(Note.TITLE_INDEX_NAME));
 163              }
 164  
 165              if (cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME) &gt; -1) {
 166                  snippet =  cursor.getString(cursor.getColumnIndex(Note.CONTENT_PREVIEW_INDEX_NAME));
 167              }
 168  
 169              // Populate fields with extracted properties
 170              titleTextView.setText(title);
 171              contentTextView.setText(snippet);
 172  
 173              view.setOnClickListener(new View.OnClickListener() {
 174                  @Override
 175                  public void onClick(View view) {
 176                      // Get the selected note
 177                      Note note = mNotesAdapter.getItem((int)view.getTag());
 178  
 179                      // Store link between note and widget in SharedPreferences
 180                      SharedPreferences preferences = PreferenceManager.getDefaultSharedPreferences(context);
<abbr title=" 181                      preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getSimperiumKey()).apply();"> 181                      preferences.edit().putString(PrefUtils.PREF_NOTE_WIDGET_NOTE + mAppWidgetId, note.getSimperiumðŸ”µ</abbr>
 182  
 183                      // Prepare bundle for NoteEditorActivity
 184                      Bundle arguments = new Bundle();
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +                    arguments.putBoolean(NoteEditorFragment.ARG_IS_FROM_WIDGET, true);</span>
 186                      arguments.putString(NoteEditorFragment.ARG_ITEM_ID, note.getSimperiumKey());
 187                      arguments.putBoolean(NoteEditorFragment.ARG_MARKDOWN_ENABLED, note.isMarkdownEnabled());
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +                    arguments.putBoolean(NoteEditorFragment.ARG_PREVIEW_ENABLED, note.isPreviewEnabled());</span>
 189  
 190                      // Create intent to navigate to selected note on widget click
 191                      Intent intent = new Intent(context, NoteEditorActivity.class);
 192                      intent.putExtras(arguments);
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +                    intent.putExtra(KEY_WIDGET_CLICK, NOTE_WIDGET_NOTE_TAPPED);</span>
 194                      intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);
 195                      PendingIntent pendingIntent = PendingIntent.getActivity(context, mAppWidgetId, intent, 0);
 196  
 197                      // Remove title from content
 198                      String title = note.getTitle();
 199                      String contentWithoutTitle = note.getContent().replace(title, &quot;&quot;);
 200                      int indexOfNewline = contentWithoutTitle.indexOf(&quot;\n&quot;) + 1;
<abbr title=" 201                      String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.length() ? indexOfNewline : 0);"> 201                      String content = contentWithoutTitle.substring(indexOfNewline &lt; contentWithoutTitle.length() ?ðŸ”µ</abbr>
 202  
 203                      // Set widget content
 204                      mRemoteViews.setOnClickPendingIntent(R.id.widget_layout, pendingIntent);
 205                      mRemoteViews.setTextViewText(R.id.widget_text, title);
<abbr title=" 206                      mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_title_light, context.getTheme()));"> 206                      mRemoteViews.setTextColor(R.id.widget_text, getResources().getColor(R.color.text_title_light, ðŸ”µ</abbr>
 207                      mRemoteViews.setTextViewText(R.id.widget_text_title, title);
<abbr title=" 208                      mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.color.text_title_light, context.getTheme()));"> 208                      mRemoteViews.setTextColor(R.id.widget_text_title, context.getResources().getColor(R.color.textðŸ”µ</abbr>
 209                      mRemoteViews.setTextViewText(R.id.widget_text_content, content);
 210                      mWidgetManager.updateAppWidget(mAppWidgetId, mRemoteViews);
 211  
 212                      // Set the result as successful
 213                      Intent resultValue = new Intent();
 214                      resultValue.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, mAppWidgetId);
 215                      setResult(RESULT_OK, resultValue);
 216                      finish();
 217                  }
 218              });
 219          }
 220      }
 221  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            