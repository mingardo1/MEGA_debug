<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>246</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    246
                    <a href="245.html">prev</a>
                    <a href="247.html">next</a>
                    <a href="246_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    Automattic/simplenote-android_6780311d33539eb86c4007a7d1993f6f1467a837_src/com/automattic/simplenote/utils/TagsMultiAutoCompleteTextView.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837:src/com/automattic/simplenote/utils/TagsMultiAutoCompleteTextView.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837^1:src/com/automattic/simplenote/utils/TagsMultiAutoCompleteTextView.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;6780311d33539eb86c4007a7d1993f6f1467a837^2:src/com/automattic/simplenote/utils/TagsMultiAutoCompleteTextView.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\Automattic\simplenote-android show &quot;20279c862696f156d42fbdab7ae10281f312fb27:src/com/automattic/simplenote/utils/TagsMultiAutoCompleteTextView.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[sbj]], subset: [[sbj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
   2 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote.utils;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 import android.graphics.Bitmap;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import android.graphics.Canvas;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import android.graphics.drawable.BitmapDrawable;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import android.text.Editable;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import android.text.Spannable;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 import android.text.SpannableStringBuilder;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import android.text.TextWatcher;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 import android.text.style.ImageSpan;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import android.util.AttributeSet;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 import android.widget.AdapterView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 import android.widget.AdapterView.OnItemClickListener;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 import android.widget.MultiAutoCompleteTextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import com.automattic.simplenote.R;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  25 public class TagsMultiAutoCompleteTextView extends MultiAutoCompleteTextView implements OnItemClickListener {">  25 public class TagsMultiAutoCompleteTextView extends MultiAutoCompleteTextView implements OnItemClickListenðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27     private final String TAG = &quot;TagsMultiAutoCompleteTextView&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30     public TagsMultiAutoCompleteTextView(Context context) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31         super(context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32         init(context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36     public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37         super(context, attrs);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38         init(context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42     public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43                                          int defStyle) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44         super(context, attrs, defStyle);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45         init(context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48     /* set listeners for item click and text change */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49     public void init(Context context) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50         setOnItemClickListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51         addTextChangedListener(textWatcher);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  54     /*TextWatcher, If user types any tag name and presses space then following code will regenerate chips */">  54     /*TextWatcher, If user types any tag name and presses space then following code will regenerate chipsðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55     private TextWatcher textWatcher = new TextWatcher() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58         public void onTextChanged(CharSequence s, int start, int before, int count) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60             // If we reach an image span, let&#x27;s remove it as well as the tag text behind it.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61             if (before == 1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62                 SpannableStringBuilder ssb = new SpannableStringBuilder(s);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63                 ImageSpan[] imageSpans = ssb.getSpans(start, start, ImageSpan.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64                 if (imageSpans.length &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65                     ImageSpan tagImageSpan = imageSpans[0];</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66                     int tagStart = ssb.getSpanStart(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67                     int tagEnd = ssb.getSpanEnd(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68                     ssb.removeSpan(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69                     ssb.replace(tagStart, tagEnd, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70                     setText(ssb);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71                     setSelection(ssb.length());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72                     return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77             if (count &gt;= 1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78                 if (s.charAt(start) == &#x27; &#x27;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79                     setChips(); // generate chips</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84         public void beforeTextChanged(CharSequence s, int start, int count, int after) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88         public void afterTextChanged(Editable s) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90     };</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92     /*This function has whole logic for chips generate*/</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93     public void setChips() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94         if (getText().toString().contains(&quot; &quot;)) // check space in string</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95         {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96             SpannableStringBuilder ssb = new SpannableStringBuilder(getText());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97             // split string with space</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98             String tags[] = getText().toString().trim().split(&quot; &quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99             int x = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100             // Loop will generate ImageSpan for every tag separated by spaces</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101             for (String tag : tags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102                 // Inflate tags_textview layout</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 103                 LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SERVICE);"> 103                 LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104                 TextView textView = (TextView) lf.inflate(R.layout.tags_textview, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105                 textView.setText(tag); // set text</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106                 // Capture bitmap of generated textview</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107                 int spec = MeasureSpec.makeMeasureSpec(0, MeasureSpec.UNSPECIFIED);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108                 textView.measure(spec, spec);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109                 textView.layout(0, 0, textView.getMeasuredWidth(), textView.getMeasuredHeight());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 110                 Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_8888);"> 110                 Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.AðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111                 Canvas canvas = new Canvas(b);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112                 canvas.translate(-textView.getScrollX(), -textView.getScrollY());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113                 textView.draw(canvas);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114                 textView.setDrawingCacheEnabled(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115                 Bitmap cacheBmp = textView.getDrawingCache();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116                 Bitmap viewBmp = cacheBmp.copy(Bitmap.Config.ARGB_8888, true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117                 textView.destroyDrawingCache();  // destory drawable</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118                 // Create bitmap drawable for imagespan</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119                 BitmapDrawable bmpDrawable = new BitmapDrawable(getContext().getResources(), viewBmp);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 120                 bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeight());"> 120                 bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeigðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121                 // Create and set imagespan</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 122                 ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);"> 122                 ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123                 x = x + tag.length() + 1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125             // set chips span</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126             if (!getText().toString().trim().equals(&quot;&quot;))</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127                 setText(ssb);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128             // move cursor to last</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129             setSelection(getText().length());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136     public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137         setChips(); // call generate chips when user select any item from auto complete</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140 }</span>
 141 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142 package com.automattic.simplenote.utils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146 import android.graphics.Bitmap;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147 import android.graphics.Canvas;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148 import android.graphics.drawable.BitmapDrawable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149 import android.text.Editable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150 import android.text.Spannable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151 import android.text.SpannableStringBuilder;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152 import android.text.TextWatcher;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153 import android.text.style.ImageSpan;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154 import android.text.TextUtils.SimpleStringSplitter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155 import android.util.AttributeSet;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158 import android.widget.AdapterView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159 import android.widget.AdapterView.OnItemClickListener;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160 import android.widget.MultiAutoCompleteTextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163 import com.automattic.simplenote.R;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 167 public class TagsMultiAutoCompleteTextView extends MultiAutoCompleteTextView implements OnItemClickListener {"> 167 public class TagsMultiAutoCompleteTextView extends MultiAutoCompleteTextView implements OnItemClickListenðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169     public interface OnTagAddedListener {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170         public void onTagsChanged(String tagString);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173     private final String TAG = &quot;TagsMultiAutoCompleteTextView&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175     private OnTagAddedListener mTagsChangedListener;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178     public TagsMultiAutoCompleteTextView(Context context) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179         super(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180         init(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184     public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185         super(context, attrs);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186         init(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190     public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191                                          int defStyle) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192         super(context, attrs, defStyle);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193         init(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196     public void setOnTagAddedListener(OnTagAddedListener listener){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197         mTagsChangedListener = listener;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200     /* set listeners for item click and text change */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201     public void init(Context context) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202         setOnItemClickListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203         addTextChangedListener(textWatcher);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 206     /*TextWatcher, If user types any tag name and presses space then following code will regenerate chips */"> 206     /*TextWatcher, If user types any tag name and presses space then following code will regenerate chipsðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207     private TextWatcher textWatcher = new TextWatcher() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210         public void onTextChanged(CharSequence s, int start, int before, int count) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211             // If we reach an image span, let&#x27;s remove it as well as the tag text behind it.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212             if (before == 1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213                 SpannableStringBuilder ssb = new SpannableStringBuilder(s);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214                 ImageSpan[] imageSpans = ssb.getSpans(start, start, ImageSpan.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215                 if (imageSpans.length &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216                     ImageSpan tagImageSpan = imageSpans[0];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217                     int tagStart = ssb.getSpanStart(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218                     int tagEnd = ssb.getSpanEnd(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219                     ssb.removeSpan(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220                     ssb.replace(tagStart, tagEnd, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221                     notifyTagsChanged(ssb.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222                     return;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226             if (count &gt;= 1 &amp;&amp; s.charAt(start) == &#x27; &#x27;) notifyTagsChanged();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227             </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231         public void beforeTextChanged(CharSequence s, int start, int count, int after) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235         public void afterTextChanged(Editable s) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237     };</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239     public void notifyTagsChanged(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240         notifyTagsChanged(getText().toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243     public void notifyTagsChanged(String tagString){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244         if(mTagsChangedListener != null){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245             mTagsChangedListener.onTagsChanged(tagString);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249     /*This function has whole logic for chips generate*/</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250     public void setChips(CharSequence text){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251         // split string with space</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252         SimpleStringSplitter tags = new SimpleStringSplitter(&#x27; &#x27;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253         tags.setString(text.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254         SpannableStringBuilder ssb = new SpannableStringBuilder(text);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255         int x = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256         // Loop will generate ImageSpan for every tag separated by spaces</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257         for (String tag : tags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258             // Inflate tags_textview layout</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 259             LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SERVICE);"> 259             LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260             TextView textView = (TextView) lf.inflate(R.layout.tags_textview, null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261             textView.setText(tag); // set text</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262             // Capture bitmap of generated textview</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263             int spec = MeasureSpec.makeMeasureSpec(0, MeasureSpec.UNSPECIFIED);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264             textView.measure(spec, spec);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265             textView.layout(0, 0, textView.getMeasuredWidth(), textView.getMeasuredHeight());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 266             Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_8888);"> 266             Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267             Canvas canvas = new Canvas(b);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268             canvas.translate(-textView.getScrollX(), -textView.getScrollY());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269             textView.draw(canvas);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270             textView.setDrawingCacheEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271             Bitmap cacheBmp = textView.getDrawingCache();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272             Bitmap viewBmp = cacheBmp.copy(Bitmap.Config.ARGB_8888, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273             textView.destroyDrawingCache();  // destory drawable</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274             // Create bitmap drawable for imagespan</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275             BitmapDrawable bmpDrawable = new BitmapDrawable(getContext().getResources(), viewBmp);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 276             bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeight());"> 276             bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeight()ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277             // Create and set imagespan            </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 278             ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);"> 278             ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279             x = x + tag.length() + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281         if (ssb.length() &gt; 0) ssb.append(&#x27; &#x27;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282         // set chips span</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283         setText(ssb);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284         //if (!getText().toString().trim().equals(&quot;&quot;))</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285         // move cursor to last</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286         setSelection(getText().length());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291     public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292         notifyTagsChanged();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295 }</span>
 296 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   3 package com.automattic.simplenote.utils;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   4 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   5 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   6 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   7 import android.graphics.Bitmap;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   8 import android.graphics.Canvas;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">   9 import android.graphics.drawable.BitmapDrawable;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  10 import android.text.Editable;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  11 import android.text.Spannable;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  12 import android.text.SpannableStringBuilder;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  13 import android.text.TextWatcher;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  14 import android.text.style.ImageSpan;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  15 import android.util.AttributeSet;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  16 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  17 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  18 import android.widget.AdapterView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  19 import android.widget.AdapterView.OnItemClickListener;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  20 import android.widget.MultiAutoCompleteTextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  21 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  23 import com.automattic.simplenote.R;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  24 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  25 public class TagsMultiAutoCompleteTextView extends MultiAutoCompleteTextView implements OnItemClickListener {">  25 public class TagsMultiAutoCompleteTextView extends MultiAutoCompleteTextView implements OnItemClickListenðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  26 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  27     private final String TAG = &quot;TagsMultiAutoCompleteTextView&quot;;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  28 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  29     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  30     public TagsMultiAutoCompleteTextView(Context context) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  31         super(context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  32         init(context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  33     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  34 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  35     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  36     public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  37         super(context, attrs);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  38         init(context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  39     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  40 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  41     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  42     public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs,</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  43                                          int defStyle) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  44         super(context, attrs, defStyle);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  45         init(context);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  46     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  47 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  48     /* set listeners for item click and text change */</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  49     public void init(Context context) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  50         setOnItemClickListener(this);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  51         addTextChangedListener(textWatcher);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  52     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  53 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  54     /*TextWatcher, If user types any tag name and presses space then following code will regenerate chips */">  54     /*TextWatcher, If user types any tag name and presses space then following code will regenerate chipsðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  55     private TextWatcher textWatcher = new TextWatcher() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  56 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  57         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  58         public void onTextChanged(CharSequence s, int start, int before, int count) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  59 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  60             // If we reach an image span, let&#x27;s remove it as well as the tag text behind it.</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  61             if (before == 1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  62                 SpannableStringBuilder ssb = new SpannableStringBuilder(s);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  63                 ImageSpan[] imageSpans = ssb.getSpans(start, start, ImageSpan.class);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  64                 if (imageSpans.length &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  65                     ImageSpan tagImageSpan = imageSpans[0];</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  66                     int tagStart = ssb.getSpanStart(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  67                     int tagEnd = ssb.getSpanEnd(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  68                     ssb.removeSpan(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  69                     ssb.replace(tagStart, tagEnd, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  70                     setText(ssb);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  71                     setSelection(ssb.length());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  72                     return;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  73                 }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  74             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  75 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  76 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  77             if (count &gt;= 1) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  78                 if (s.charAt(start) == &#x27; &#x27;)</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79                     setChips(); // generate chips</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  80             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84         public void beforeTextChanged(CharSequence s, int start, int count, int after) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  86 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  87         @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  88         public void afterTextChanged(Editable s) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  89         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  90     };</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  91 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  92     /*This function has whole logic for chips generate*/</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  93     public void setChips() {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  94         if (getText().toString().contains(&quot; &quot;)) // check space in string</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  95         {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  96             SpannableStringBuilder ssb = new SpannableStringBuilder(getText());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  97             // split string with space</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  98             String tags[] = getText().toString().trim().split(&quot; &quot;);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  99             int x = 0;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 100             // Loop will generate ImageSpan for every tag separated by spaces</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 101             for (String tag : tags) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 102                 // Inflate tags_textview layout</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 103                 LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SERVICE);"> 103                 LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 104                 TextView textView = (TextView) lf.inflate(R.layout.tags_textview, null);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 105                 textView.setText(tag); // set text</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 106                 // Capture bitmap of generated textview</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 107                 int spec = MeasureSpec.makeMeasureSpec(0, MeasureSpec.UNSPECIFIED);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 108                 textView.measure(spec, spec);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 109                 textView.layout(0, 0, textView.getMeasuredWidth(), textView.getMeasuredHeight());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 110                 Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_8888);"> 110                 Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.AðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 111                 Canvas canvas = new Canvas(b);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 112                 canvas.translate(-textView.getScrollX(), -textView.getScrollY());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 113                 textView.draw(canvas);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 114                 textView.setDrawingCacheEnabled(true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 115                 Bitmap cacheBmp = textView.getDrawingCache();</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 116                 Bitmap viewBmp = cacheBmp.copy(Bitmap.Config.ARGB_8888, true);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 117                 textView.destroyDrawingCache();  // destory drawable</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 118                 // Create bitmap drawable for imagespan</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 119                 BitmapDrawable bmpDrawable = new BitmapDrawable(getContext().getResources(), viewBmp);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 120                 bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeight());"> 120                 bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeigðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 121                 // Create and set imagespan</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title=" 122                 ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);"> 122                 ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 123                 x = x + tag.length() + 1;</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 124             }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 125             // set chips span</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 126             if (!getText().toString().trim().equals(&quot;&quot;))</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 127                 setText(ssb);</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 128             // move cursor to last</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 129             setSelection(getText().length());</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 130         }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 131 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 132 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 133     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 134 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 135     @Override</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 136     public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 137         setChips(); // call generate chips when user select any item from auto complete</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 138     }</span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 139 </span>
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"> 140 }</span>
 141 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 142 package com.automattic.simplenote.utils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146 import android.graphics.Bitmap;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147 import android.graphics.Canvas;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148 import android.graphics.drawable.BitmapDrawable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149 import android.text.Editable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150 import android.text.Spannable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151 import android.text.SpannableStringBuilder;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152 import android.text.TextWatcher;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153 import android.text.style.ImageSpan;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154 import android.text.TextUtils.SimpleStringSplitter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155 import android.util.AttributeSet;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158 import android.widget.AdapterView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159 import android.widget.AdapterView.OnItemClickListener;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 160 import android.widget.MultiAutoCompleteTextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 161 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 162 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 163 import com.automattic.simplenote.R;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 164 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 165 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 166 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 167 public class TagsMultiAutoCompleteTextView extends MultiAutoCompleteTextView implements OnItemClickListener {"> 167 public class TagsMultiAutoCompleteTextView extends MultiAutoCompleteTextView implements OnItemClickListenðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 168 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 169     public interface OnTagAddedListener {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 170         public void onTagsChanged(String tagString);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 171     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 172 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 173     private final String TAG = &quot;TagsMultiAutoCompleteTextView&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 174 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 175     private OnTagAddedListener mTagsChangedListener;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 176 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 177     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 178     public TagsMultiAutoCompleteTextView(Context context) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 179         super(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 180         init(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 181     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 182 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 183     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 184     public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 185         super(context, attrs);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 186         init(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 187     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 188 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 189     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 190     public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 191                                          int defStyle) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 192         super(context, attrs, defStyle);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 193         init(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 194     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 195 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 196     public void setOnTagAddedListener(OnTagAddedListener listener){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 197         mTagsChangedListener = listener;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 198     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 199 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 200     /* set listeners for item click and text change */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 201     public void init(Context context) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 202         setOnItemClickListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 203         addTextChangedListener(textWatcher);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 204     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 205 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 206     /*TextWatcher, If user types any tag name and presses space then following code will regenerate chips */"> 206     /*TextWatcher, If user types any tag name and presses space then following code will regenerate chipsðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 207     private TextWatcher textWatcher = new TextWatcher() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 208 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 209         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 210         public void onTextChanged(CharSequence s, int start, int before, int count) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 211             // If we reach an image span, let&#x27;s remove it as well as the tag text behind it.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 212             if (before == 1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 213                 SpannableStringBuilder ssb = new SpannableStringBuilder(s);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 214                 ImageSpan[] imageSpans = ssb.getSpans(start, start, ImageSpan.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 215                 if (imageSpans.length &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 216                     ImageSpan tagImageSpan = imageSpans[0];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 217                     int tagStart = ssb.getSpanStart(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 218                     int tagEnd = ssb.getSpanEnd(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 219                     ssb.removeSpan(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 220                     ssb.replace(tagStart, tagEnd, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 221                     notifyTagsChanged(ssb.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 222                     return;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 223                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 224             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 225 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 226             if (count &gt;= 1 &amp;&amp; s.charAt(start) == &#x27; &#x27;) notifyTagsChanged();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 227 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 228         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 229 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 230         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 231         public void beforeTextChanged(CharSequence s, int start, int count, int after) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 232         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 233 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 234         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 235         public void afterTextChanged(Editable s) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 236         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 237     };</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 238 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 239     public void notifyTagsChanged(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 240         notifyTagsChanged(getText().toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 241     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 242 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 243     public void notifyTagsChanged(String tagString){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 244         if(mTagsChangedListener != null){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 245             mTagsChangedListener.onTagsChanged(tagString);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 246         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 247     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 248 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 249     /*This function has whole logic for chips generate*/</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 250     public void setChips(CharSequence text){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 251         // split string with space</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 252         SimpleStringSplitter tags = new SimpleStringSplitter(&#x27; &#x27;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 253         tags.setString(text.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 254         SpannableStringBuilder ssb = new SpannableStringBuilder(text);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 255         int x = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 256         // Loop will generate ImageSpan for every tag separated by spaces</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 257         for (String tag : tags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 258             // Inflate tags_textview layout</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 259             LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SERVICE);"> 259             LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 260             TextView textView = (TextView) lf.inflate(R.layout.tags_textview, null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 261             textView.setText(tag); // set text</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 262             // Capture bitmap of generated textview</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 263             int spec = MeasureSpec.makeMeasureSpec(0, MeasureSpec.UNSPECIFIED);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 264             textView.measure(spec, spec);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 265             textView.layout(0, 0, textView.getMeasuredWidth(), textView.getMeasuredHeight());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 266             Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_8888);"> 266             Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 267             Canvas canvas = new Canvas(b);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 268             canvas.translate(-textView.getScrollX(), -textView.getScrollY());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 269             textView.draw(canvas);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 270             textView.setDrawingCacheEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 271             Bitmap cacheBmp = textView.getDrawingCache();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 272             Bitmap viewBmp = cacheBmp.copy(Bitmap.Config.ARGB_8888, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 273             textView.destroyDrawingCache();  // destory drawable</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 274             // Create bitmap drawable for imagespan</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 275             BitmapDrawable bmpDrawable = new BitmapDrawable(getContext().getResources(), viewBmp);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 276             bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeight());"> 276             bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeight()ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 277             // Create and set imagespan</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 278             ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);"> 278             ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 279             x = x + tag.length() + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 280         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 281         if (ssb.length() &gt; 0) ssb.append(&#x27; &#x27;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 282         // set chips span</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 283         setText(ssb);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 284         //if (!getText().toString().trim().equals(&quot;&quot;))</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 285         // move cursor to last</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 286         setSelection(getText().length());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 287 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 288     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 289 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 290     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 291     public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 292         notifyTagsChanged();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 293     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 294 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 295 }</span>
 296 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS</pre></td>
                            <td><pre>   1 &lt;&lt;&lt;&lt;&lt;&lt;&lt; LEFT
   2 ||||||| BASE
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwohrp23k5b6vdk93d3r*/">   3 /*d94z9sk0k4hf9j3ijd - note the base isn&#x27;t actually empty, spork simply doesn&#x27;t generate a base - gd930kwðŸ”µ</abbr></span>
   4 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   5 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   6 package com.automattic.simplenote.utils;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   7 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   8 import android.app.Activity;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">   9 import android.content.Context;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  10 import android.graphics.Bitmap;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  11 import android.graphics.Canvas;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  12 import android.graphics.drawable.BitmapDrawable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  13 import android.text.Editable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  14 import android.text.Spannable;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  15 import android.text.SpannableStringBuilder;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  16 import android.text.TextWatcher;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  17 import android.text.style.ImageSpan;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  18 import android.text.TextUtils.SimpleStringSplitter;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  19 import android.util.AttributeSet;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  20 import android.view.LayoutInflater;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  21 import android.view.View;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  22 import android.widget.AdapterView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  23 import android.widget.AdapterView.OnItemClickListener;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  24 import android.widget.MultiAutoCompleteTextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  25 import android.widget.TextView;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  26 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  27 import com.automattic.simplenote.R;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  28 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  29 import java.util.List;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  30 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  31 public class TagsMultiAutoCompleteTextView extends MultiAutoCompleteTextView implements OnItemClickListener {">  31 public class TagsMultiAutoCompleteTextView extends MultiAutoCompleteTextView implements OnItemClickListenðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  32 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  33     public interface OnTagAddedListener {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  34         public void onTagsChanged(String tagString);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  35     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  36 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  37     private final String TAG = &quot;TagsMultiAutoCompleteTextView&quot;;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  38 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  39     private OnTagAddedListener mTagsChangedListener;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  40 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  41     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  42     public TagsMultiAutoCompleteTextView(Context context) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  43         super(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  44         init(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  45     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  46 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  47     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  48     public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  49         super(context, attrs);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  50         init(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  51     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  52 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  53     /* Constructor */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  54     public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs,</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  55                                          int defStyle) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  56         super(context, attrs, defStyle);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  57         init(context);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  58     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  59 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  60     public void setOnTagAddedListener(OnTagAddedListener listener){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  61         mTagsChangedListener = listener;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  62     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  63 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  64     /* set listeners for item click and text change */</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  65     public void init(Context context) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  66         setOnItemClickListener(this);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  67         addTextChangedListener(textWatcher);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  68     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  69 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  70     /*TextWatcher, If user types any tag name and presses space then following code will regenerate chips */">  70     /*TextWatcher, If user types any tag name and presses space then following code will regenerate chipsðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  71     private TextWatcher textWatcher = new TextWatcher() {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  72 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  73         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  74         public void onTextChanged(CharSequence s, int start, int before, int count) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  75             // If we reach an image span, let&#x27;s remove it as well as the tag text behind it.</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  76             if (before == 1) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  77                 SpannableStringBuilder ssb = new SpannableStringBuilder(s);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  78                 ImageSpan[] imageSpans = ssb.getSpans(start, start, ImageSpan.class);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  79                 if (imageSpans.length &gt; 0) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  80                     ImageSpan tagImageSpan = imageSpans[0];</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  81                     int tagStart = ssb.getSpanStart(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  82                     int tagEnd = ssb.getSpanEnd(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  83                     ssb.removeSpan(tagImageSpan);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  84                     ssb.replace(tagStart, tagEnd, &quot;&quot;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  85                     notifyTagsChanged(ssb.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  86                     return;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  87                 }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88             }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  89 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90             if (count &gt;= 1 &amp;&amp; s.charAt(start) == &#x27; &#x27;) notifyTagsChanged();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  92         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  95         public void beforeTextChanged(CharSequence s, int start, int count, int after) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  96         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  97 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  98         @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  99         public void afterTextChanged(Editable s) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 100         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 101     };</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 102 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 103     public void notifyTagsChanged(){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 104         notifyTagsChanged(getText().toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 105     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 106 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 107     public void notifyTagsChanged(String tagString){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 108         if(mTagsChangedListener != null){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 109             mTagsChangedListener.onTagsChanged(tagString);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 110         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 111     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 112 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 113     /*This function has whole logic for chips generate*/</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 114     public void setChips(CharSequence text){</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 115         // split string with space</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 116         SimpleStringSplitter tags = new SimpleStringSplitter(&#x27; &#x27;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 117         tags.setString(text.toString());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 118         SpannableStringBuilder ssb = new SpannableStringBuilder(text);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 119         int x = 0;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 120         // Loop will generate ImageSpan for every tag separated by spaces</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 121         for (String tag : tags) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 122             // Inflate tags_textview layout</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 123             LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SERVICE);"> 123             LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 124             TextView textView = (TextView) lf.inflate(R.layout.tags_textview, null);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 125             textView.setText(tag); // set text</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 126             // Capture bitmap of generated textview</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 127             int spec = MeasureSpec.makeMeasureSpec(0, MeasureSpec.UNSPECIFIED);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 128             textView.measure(spec, spec);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 129             textView.layout(0, 0, textView.getMeasuredWidth(), textView.getMeasuredHeight());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 130             Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_8888);"> 130             Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 131             Canvas canvas = new Canvas(b);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 132             canvas.translate(-textView.getScrollX(), -textView.getScrollY());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 133             textView.draw(canvas);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 134             textView.setDrawingCacheEnabled(true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 135             Bitmap cacheBmp = textView.getDrawingCache();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 136             Bitmap viewBmp = cacheBmp.copy(Bitmap.Config.ARGB_8888, true);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 137             textView.destroyDrawingCache();  // destory drawable</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 138             // Create bitmap drawable for imagespan</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 139             BitmapDrawable bmpDrawable = new BitmapDrawable(getContext().getResources(), viewBmp);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 140             bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeight());"> 140             bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeight()ðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 141             // Create and set imagespan</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title=" 142             ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);"> 142             ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIðŸ”µ</abbr></span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 143             x = x + tag.length() + 1;</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 144         }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 145         if (ssb.length() &gt; 0) ssb.append(&#x27; &#x27;);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 146         // set chips span</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 147         setText(ssb);</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 148         //if (!getText().toString().trim().equals(&quot;&quot;))</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 149         // move cursor to last</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 150         setSelection(getText().length());</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 151 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 152     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 153 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 154     @Override</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 155     public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 156         notifyTagsChanged();</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 157     }</span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 158 </span>
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0"> 159 }</span>
 160 &gt;&gt;&gt;&gt;&gt;&gt;&gt; RIGHT
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   1 -package com.automattic.simplenote.utils;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   2 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   3 -import android.app.Activity;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   4 -import android.content.Context;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   5 -import android.graphics.Bitmap;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   6 -import android.graphics.Canvas;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   7 -import android.graphics.drawable.BitmapDrawable;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   8 -import android.text.Editable;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">   9 -import android.text.Spannable;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  10 -import android.text.SpannableStringBuilder;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  11 -import android.text.TextWatcher;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  12 -import android.text.style.ImageSpan;</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  13 -import android.util.AttributeSet;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  14 -import android.view.LayoutInflater;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  15 -import android.view.View;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  16 -import android.widget.AdapterView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  17 -import android.widget.AdapterView.OnItemClickListener;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  18 -import android.widget.MultiAutoCompleteTextView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  19 -import android.widget.TextView;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  21 -import com.automattic.simplenote.R;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  22 -</span>


<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  23 -public class TagsMultiAutoCompleteTextView extends MultiAutoCompleteTextView implements OnItemClickListener {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -</span>




<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -    private final String TAG = &quot;TagsMultiAutoCompleteTextView&quot;;</span>


<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  26 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  27 -    /* Constructor */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  28 -    public TagsMultiAutoCompleteTextView(Context context) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  29 -        super(context);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  30 -        init(context);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  31 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  32 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -    /* Constructor */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  34 -    public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  35 -        super(context, attrs);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  36 -        init(context);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  37 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  38 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  39 -    /* Constructor */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  40 -    public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs,</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 -                                         int defStyle) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 -        super(context, attrs, defStyle);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 -        init(context);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  45 -</span>




<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  46 -    /* set listeners for item click and text change */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  47 -    public void init(Context context) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  48 -        setOnItemClickListener(this);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  49 -        addTextChangedListener(textWatcher);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  50 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  51 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  52 -    /*TextWatcher, If user types any tag name and presses space then following code will regenerate chips */</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  53 -    private TextWatcher textWatcher = new TextWatcher() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  54 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  55 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  56 -        public void onTextChanged(CharSequence s, int start, int before, int count) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  57 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  58 -            // If we reach an image span, let&#x27;s remove it as well as the tag text behind it.</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  59 -            if (before == 1) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  60 -                SpannableStringBuilder ssb = new SpannableStringBuilder(s);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  61 -                ImageSpan[] imageSpans = ssb.getSpans(start, start, ImageSpan.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  62 -                if (imageSpans.length &gt; 0) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  63 -                    ImageSpan tagImageSpan = imageSpans[0];</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  64 -                    int tagStart = ssb.getSpanStart(tagImageSpan);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  65 -                    int tagEnd = ssb.getSpanEnd(tagImageSpan);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  66 -                    ssb.removeSpan(tagImageSpan);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  67 -                    ssb.replace(tagStart, tagEnd, &quot;&quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  68 -                    setText(ssb);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  69 -                    setSelection(ssb.length());</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  70 -                    return;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  71 -                }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  72 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  73 -</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  74 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  75 -            if (count &gt;= 1) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  76 -                if (s.charAt(start) == &#x27; &#x27;)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  77 -                    setChips(); // generate chips</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  78 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  79 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  80 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -        public void beforeTextChanged(CharSequence s, int start, int count, int after) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  83 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  84 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -        @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -        public void afterTextChanged(Editable s) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  88 -    };</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  89 -</span>










<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  90 -    /*This function has whole logic for chips generate*/</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -    public void setChips() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -        if (getText().toString().contains(&quot; &quot;)) // check space in string</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -        {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -            SpannableStringBuilder ssb = new SpannableStringBuilder(getText());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  95 -            // split string with space</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  96 -            String tags[] = getText().toString().trim().split(&quot; &quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  97 -            int x = 0;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  98 -            // Loop will generate ImageSpan for every tag separated by spaces</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  99 -            for (String tag : tags) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 100 -                // Inflate tags_textview layout</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 101 -                LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SERVICE);"> 101 -                LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SERVICðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 102 -                TextView textView = (TextView) lf.inflate(R.layout.tags_textview, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 103 -                textView.setText(tag); // set text</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 104 -                // Capture bitmap of generated textview</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 105 -                int spec = MeasureSpec.makeMeasureSpec(0, MeasureSpec.UNSPECIFIED);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 106 -                textView.measure(spec, spec);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 107 -                textView.layout(0, 0, textView.getMeasuredWidth(), textView.getMeasuredHeight());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 108 -                Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_8888);"> 108 -                Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_8888)ðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 109 -                Canvas canvas = new Canvas(b);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 110 -                canvas.translate(-textView.getScrollX(), -textView.getScrollY());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 111 -                textView.draw(canvas);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 112 -                textView.setDrawingCacheEnabled(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 113 -                Bitmap cacheBmp = textView.getDrawingCache();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 114 -                Bitmap viewBmp = cacheBmp.copy(Bitmap.Config.ARGB_8888, true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 115 -                textView.destroyDrawingCache();  // destory drawable</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -                // Create bitmap drawable for imagespan</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -                BitmapDrawable bmpDrawable = new BitmapDrawable(getContext().getResources(), viewBmp);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 118 -                bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeight());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 119 -                // Create and set imagespan</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 120 -                ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -                x = x + tag.length() + 1;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 123 -            // set chips span</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 124 -            if (!getText().toString().trim().equals(&quot;&quot;))</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -                setText(ssb);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 126 -            // move cursor to last</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 127 -            setSelection(getText().length());</span>






























<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 128 -        }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 129 -</span>






<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 130 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 131 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 132 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 133 -    @Override</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 134 -    public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 135 -        setChips(); // call generate chips when user select any item from auto complete</span>

<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 136 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 137 -</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 138 -}</span></pre></td>
                            <td><pre>   1  package com.automattic.simplenote.utils;
   2  
   3  import android.app.Activity;
   4  import android.content.Context;
   5  import android.graphics.Bitmap;
   6  import android.graphics.Canvas;
   7  import android.graphics.drawable.BitmapDrawable;
   8  import android.text.Editable;
   9  import android.text.Spannable;
  10  import android.text.SpannableStringBuilder;
  11  import android.text.TextWatcher;
  12  import android.text.style.ImageSpan;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  13 +import android.text.TextUtils.SimpleStringSplitter;</span>
  14  import android.util.AttributeSet;
  15  import android.view.LayoutInflater;
  16  import android.view.View;
  17  import android.widget.AdapterView;
  18  import android.widget.AdapterView.OnItemClickListener;
  19  import android.widget.MultiAutoCompleteTextView;
  20  import android.widget.TextView;
  21  
  22  import com.automattic.simplenote.R;
  23  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  24 +import java.util.List;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  25 +</span>
  26  public class TagsMultiAutoCompleteTextView extends MultiAutoCompleteTextView implements OnItemClickListener {
  27  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  28 +    public interface OnTagAddedListener {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  29 +        public void onTagsChanged(String tagString);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  30 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  31 +</span>
  32      private final String TAG = &quot;TagsMultiAutoCompleteTextView&quot;;
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  33 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  34 +    private OnTagAddedListener mTagsChangedListener;</span>
  35  
  36      /* Constructor */
  37      public TagsMultiAutoCompleteTextView(Context context) {
  38          super(context);
  39          init(context);
  40      }
  41  
  42      /* Constructor */
  43      public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs) {
  44          super(context, attrs);
  45          init(context);
  46      }
  47  
  48      /* Constructor */
  49      public TagsMultiAutoCompleteTextView(Context context, AttributeSet attrs,
  50                                           int defStyle) {
  51          super(context, attrs, defStyle);
  52          init(context);
  53      }
  54  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  55 +    public void setOnTagAddedListener(OnTagAddedListener listener){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  56 +        mTagsChangedListener = listener;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  57 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  58 +</span>
  59      /* set listeners for item click and text change */
  60      public void init(Context context) {
  61          setOnItemClickListener(this);
  62          addTextChangedListener(textWatcher);
  63      }
  64  
  65      /*TextWatcher, If user types any tag name and presses space then following code will regenerate chips */
  66      private TextWatcher textWatcher = new TextWatcher() {
  67  
  68          @Override
  69          public void onTextChanged(CharSequence s, int start, int before, int count) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  70 -</span>
  71              // If we reach an image span, let&#x27;s remove it as well as the tag text behind it.
  72              if (before == 1) {
  73                  SpannableStringBuilder ssb = new SpannableStringBuilder(s);
  74                  ImageSpan[] imageSpans = ssb.getSpans(start, start, ImageSpan.class);
  75                  if (imageSpans.length &gt; 0) {
  76                      ImageSpan tagImageSpan = imageSpans[0];
  77                      int tagStart = ssb.getSpanStart(tagImageSpan);
  78                      int tagEnd = ssb.getSpanEnd(tagImageSpan);
  79                      ssb.removeSpan(tagImageSpan);
  80                      ssb.replace(tagStart, tagEnd, &quot;&quot;);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  81 -                    setText(ssb);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  82 -                    setSelection(ssb.length());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +                    notifyTagsChanged(ssb.toString());</span>
  84                      return;
  85                  }
  86              }
  87  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +            if (count &gt;= 1 &amp;&amp; s.charAt(start) == &#x27; &#x27;) notifyTagsChanged();</span>
  89  
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  90 -            if (count &gt;= 1) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -                if (s.charAt(start) == &#x27; &#x27;)</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -                    setChips(); // generate chips</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -            }</span>
  94          }
  95  
  96          @Override
  97          public void beforeTextChanged(CharSequence s, int start, int count, int after) {
  98          }
  99  
 100          @Override
 101          public void afterTextChanged(Editable s) {
 102          }
 103      };
 104  
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 105 +    public void notifyTagsChanged(){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 106 +        notifyTagsChanged(getText().toString());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 107 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 108 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 109 +    public void notifyTagsChanged(String tagString){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 110 +        if(mTagsChangedListener != null){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 111 +            mTagsChangedListener.onTagsChanged(tagString);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 112 +        }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 113 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 114 +</span>
 115      /*This function has whole logic for chips generate*/
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 116 -    public void setChips() {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 117 -        if (getText().toString().contains(&quot; &quot;)) // check space in string</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 118 -        {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 119 -            SpannableStringBuilder ssb = new SpannableStringBuilder(getText());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 120 -            // split string with space</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 121 -            String tags[] = getText().toString().trim().split(&quot; &quot;);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 122 -            int x = 0;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 123 -            // Loop will generate ImageSpan for every tag separated by spaces</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 124 -            for (String tag : tags) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 125 -                // Inflate tags_textview layout</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 126 -                LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SERVICE);"> 126 -                LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SERVICðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 127 -                TextView textView = (TextView) lf.inflate(R.layout.tags_textview, null);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 128 -                textView.setText(tag); // set text</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 129 -                // Capture bitmap of generated textview</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 130 -                int spec = MeasureSpec.makeMeasureSpec(0, MeasureSpec.UNSPECIFIED);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 131 -                textView.measure(spec, spec);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 132 -                textView.layout(0, 0, textView.getMeasuredWidth(), textView.getMeasuredHeight());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"><abbr title=" 133 -                Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_8888);"> 133 -                Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_8888)ðŸ”µ</abbr></span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 134 -                Canvas canvas = new Canvas(b);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 135 -                canvas.translate(-textView.getScrollX(), -textView.getScrollY());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 136 -                textView.draw(canvas);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 137 -                textView.setDrawingCacheEnabled(true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 138 -                Bitmap cacheBmp = textView.getDrawingCache();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 139 -                Bitmap viewBmp = cacheBmp.copy(Bitmap.Config.ARGB_8888, true);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 140 -                textView.destroyDrawingCache();  // destory drawable</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 141 -                // Create bitmap drawable for imagespan</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 142 -                BitmapDrawable bmpDrawable = new BitmapDrawable(getContext().getResources(), viewBmp);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 143 -                bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeight());</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 144 -                // Create and set imagespan</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 145 -                ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 146 -                x = x + tag.length() + 1;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 147 -            }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 148 -            // set chips span</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 149 -            if (!getText().toString().trim().equals(&quot;&quot;))</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 150 -                setText(ssb);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 151 -            // move cursor to last</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 152 -            setSelection(getText().length());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 153 +    public void setChips(CharSequence text){</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 154 +        // split string with space</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 155 +        SimpleStringSplitter tags = new SimpleStringSplitter(&#x27; &#x27;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 156 +        tags.setString(text.toString());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 157 +        SpannableStringBuilder ssb = new SpannableStringBuilder(text);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 158 +        int x = 0;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 159 +        // Loop will generate ImageSpan for every tag separated by spaces</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 160 +        for (String tag : tags) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 161 +            // Inflate tags_textview layout</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 162 +            LayoutInflater lf = (LayoutInflater) getContext().getSystemService(Activity.LAYOUT_INFLATER_SERVICE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 163 +            TextView textView = (TextView) lf.inflate(R.layout.tags_textview, null);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 164 +            textView.setText(tag); // set text</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 165 +            // Capture bitmap of generated textview</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 166 +            int spec = MeasureSpec.makeMeasureSpec(0, MeasureSpec.UNSPECIFIED);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 167 +            textView.measure(spec, spec);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 168 +            textView.layout(0, 0, textView.getMeasuredWidth(), textView.getMeasuredHeight());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 169 +            Bitmap b = Bitmap.createBitmap(textView.getWidth(), textView.getHeight(), Bitmap.Config.ARGB_8888);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 170 +            Canvas canvas = new Canvas(b);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 171 +            canvas.translate(-textView.getScrollX(), -textView.getScrollY());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 172 +            textView.draw(canvas);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 173 +            textView.setDrawingCacheEnabled(true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 174 +            Bitmap cacheBmp = textView.getDrawingCache();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +            Bitmap viewBmp = cacheBmp.copy(Bitmap.Config.ARGB_8888, true);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +            textView.destroyDrawingCache();  // destory drawable</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +            // Create bitmap drawable for imagespan</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +            BitmapDrawable bmpDrawable = new BitmapDrawable(getContext().getResources(), viewBmp);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 179 +            bmpDrawable.setBounds(0, 0, bmpDrawable.getIntrinsicWidth(), bmpDrawable.getIntrinsicHeight());</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 180 +            // Create and set imagespan</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 181 +            ssb.setSpan(new ImageSpan(bmpDrawable), x, x + tag.length(), Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 182 +            x = x + tag.length() + 1;</span>
 183          }
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 184 -</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 185 +        if (ssb.length() &gt; 0) ssb.append(&#x27; &#x27;);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 186 +        // set chips span</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 187 +        setText(ssb);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 188 +        //if (!getText().toString().trim().equals(&quot;&quot;))</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 189 +        // move cursor to last</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +        setSelection(getText().length());</span>
 191  
 192      }
 193  
 194      @Override
 195      public void onItemClick(AdapterView&lt;?&gt; parent, View view, int position, long id) {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 196 -        setChips(); // call generate chips when user select any item from auto complete</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 197 +        notifyTagsChanged();</span>
 198      }
 199  
 200  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            