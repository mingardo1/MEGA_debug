<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>29</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        abbr {
                          /* Here is the delay */
                          transition-delay:0s;
                        }
                    </style>
              </head>
              <body>
                <span style="height: 4vh">
                    29
                    <a href="28.html">prev</a>
                    <a href="30.html">next</a>
                    <a href="29_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    AriaLyy/Aria_ce886921a652b2ea1ded6e36a0748360e01c007f_Aria/src/main/java/com/arialyy/aria/core/download/DownloadReceiver.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;ce886921a652b2ea1ded6e36a0748360e01c007f:Aria/src/main/java/com/arialyy/aria/core/download/DownloadReceiver.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;ce886921a652b2ea1ded6e36a0748360e01c007f^1:Aria/src/main/java/com/arialyy/aria/core/download/DownloadReceiver.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;ce886921a652b2ea1ded6e36a0748360e01c007f^2:Aria/src/main/java/com/arialyy/aria/core/download/DownloadReceiver.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\AriaLyy\Aria show &quot;84ce7e06974326b39f68f3f23fd64570bcdb9bdc:Aria/src/main/java/com/arialyy/aria/core/download/DownloadReceiver.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[b]], subset: [[b]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.aria.core.download;
  17 
  18 import android.support.annotation.NonNull;
  19 import com.arialyy.aria.core.AriaManager;
  20 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours
  21 ||||||| GitAnalyzerPlus_base
<span style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  22 import com.arialyy.aria.core.inf.ICmd;</span>
  23 =======
<span style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  24 import com.arialyy.aria.core.inf.AbsReceiver;</span>
  25 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs
  26 import com.arialyy.aria.core.inf.IEntity;
  27 import com.arialyy.aria.core.inf.IReceiver;
  28 import com.arialyy.aria.core.command.normal.NormalCmdFactory;
  29 import com.arialyy.aria.core.scheduler.DownloadSchedulers;
  30 import com.arialyy.aria.core.scheduler.ISchedulerListener;
  31 import com.arialyy.aria.orm.DbEntity;
  32 import com.arialyy.aria.util.CheckUtil;
  33 import com.arialyy.aria.util.CommonUtil;
  34 import java.io.File;
  35 import java.util.List;
  36 import java.util.Set;
  37 
  38 /**
  39  * Created by lyy on 2016/12/5.
  40  * ä¸‹è½½åŠŸèƒ½æ¥æ”¶å™¨
  41  */
  42 public class DownloadReceiver extends AbsReceiver&lt;DownloadEntity&gt; {
  43   private final String TAG = &quot;DownloadReceiver&quot;;
  44   public ISchedulerListener&lt;DownloadTask&gt; listener;
  45 
  46   /**
  47    * è®¾ç½®æœ€å¤§ä¸‹è½½é€Ÿåº¦ï¼Œå•ä½ï¼škb
  48    * è¯¥æ–¹æ³•ä¸ºå®éªŒæ€§åŠŸèƒ½ï¼Œæ¸…ä¸è¦è½»æ˜“åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚
  49    *
  50    * @param maxSpeed ä¸º0è¡¨ç¤ºä¸é™é€Ÿ
  51    */
  52   @Deprecated public void setMaxSpeed(double maxSpeed) {
  53     AriaManager.getInstance(AriaManager.APP).getDownloadConfig().setMsxSpeed(maxSpeed);
  54   }
  55 
  56   /**
  57    * {@link #load(String)}ï¼Œè¯·ä½¿ç”¨è¯¥æ–¹æ³•
  58    */
  59   @Deprecated public DownloadTarget load(DownloadEntity entity) {
  60     return new DownloadTarget(entity, targetName);
  61   }
  62 
  63   /**
  64    * åŠ è½½ä¸‹è½½åœ°å€
  65    */
  66   public DownloadTarget load(@NonNull String downloadUrl) {
  67     CheckUtil.checkDownloadUrl(downloadUrl);
  68     DownloadEntity entity =
  69         DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl);
  70     if (entity == null) {
  71       entity = new DownloadEntity();
  72     }
  73     File file = new File(entity.getDownloadPath());
  74     if (!file.exists()) {
  75       entity.setState(IEntity.STATE_WAIT);
  76     }
  77     entity.setDownloadUrl(downloadUrl);
  78     return new DownloadTarget(entity, targetName);
  79   }
  80 
  81   /**
  82    * åŠ è½½ä¸‹è½½åœ°å€ï¼Œå¦‚æœä»»åŠ¡ç»„çš„ä¸­çš„ä¸‹è½½åœ°å€æ”¹å˜äº†ï¼Œåˆ™ä»»åŠ¡ä»æ–°çš„ä¸€ä¸ªä»»åŠ¡ç»„
  83    */
  84   public DownloadGroupTarget load(List&lt;String&gt; urls) {
  85     CheckUtil.checkDownloadUrls(urls);
  86     DownloadGroupEntity entity =
  87         DbEntity.findData(DownloadGroupEntity.class, &quot;urlHash=?&quot;, CommonUtil.getMd5Code(urls));
  88 
  89     if (entity == null) {
  90       entity = new DownloadGroupEntity();
  91     }
  92     return new DownloadGroupTarget(entity, targetName, urls);
  93   }
  94 
  95   /**
  96    * å°†å½“å‰ç±»æ³¨å†Œåˆ°Aria
  97    */
  98   public DownloadReceiver register() {
  99     DownloadSchedulers.getInstance().register(obj);
 100     return this;
 101   }
 102 
 103   /**
 104    * å–æ¶ˆæ³¨å†Œ
 105    */
 106   @Override public void unRegister() {
 107     DownloadSchedulers.getInstance().unRegister(obj);
 108   }
 109 
 110   /**
 111    * æ·»åŠ è°ƒåº¦å™¨å›è°ƒ
 112    *
 113    * @see #register()
 114    */
 115   @Deprecated public DownloadReceiver addSchedulerListener(
 116       ISchedulerListener&lt;DownloadTask&gt; listener) {
 117     this.listener = listener;
 118     DownloadSchedulers.getInstance().addSchedulerListener(targetName, listener);
 119     return this;
 120   }
 121 
 122   /**
 123    * ç§»é™¤å›è°ƒ
 124    *
 125    * @see #unRegister()
 126    */
 127   @Deprecated @Override public void removeSchedulerListener() {
 128     if (listener != null) {
 129       DownloadSchedulers.getInstance().removeSchedulerListener(targetName, listener);
 130     }
 131   }
 132 
 133   @Override public void destroy() {
 134     targetName = null;
 135     listener = null;
 136   }
 137 
 138   /**
 139    * é€šè¿‡ä¸‹è½½é“¾æ¥è·å–ä¸‹è½½å®ä½“
 140    */
 141   public DownloadEntity getDownloadEntity(String downloadUrl) {
 142     CheckUtil.checkDownloadUrl(downloadUrl);
 143     return DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl);
 144   }
 145 
 146   /**
 147    * ä¸‹è½½ä»»åŠ¡æ˜¯å¦å­˜åœ¨
 148    */
 149   @Override public boolean taskExists(String downloadUrl) {
 150     return DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl) != null;
 151   }
 152 
 153   @Override public List&lt;DownloadEntity&gt; getTaskList() {
 154     return DownloadEntity.findAllData(DownloadEntity.class);
 155   }
 156 
 157   /**
 158    * åœæ­¢æ‰€æœ‰æ­£åœ¨ä¸‹è½½çš„ä»»åŠ¡ï¼Œå¹¶æ¸…ç©ºç­‰å¾…é˜Ÿåˆ—ã€‚
 159    */
 160   @Override public void stopAllTask() {
 161     AriaManager.getInstance(AriaManager.APP)
 162         .setCmd(NormalCmdFactory.getInstance()
 163             .createCmd(targetName, new DownloadTaskEntity(), NormalCmdFactory.TASK_STOP_ALL))
 164         .exe();
 165   }
 166 
 167   /**
 168    * æ¢å¤æ‰€æœ‰æ­£åœ¨ä¸‹è½½çš„ä»»åŠ¡
 169    * 1.å¦‚æœæ‰§è¡Œé˜Ÿåˆ—æ²¡æœ‰æ»¡ï¼Œåˆ™å¼€å§‹ä¸‹è½½ä»»åŠ¡ï¼Œç›´åˆ°æ‰§è¡Œé˜Ÿåˆ—æ»¡
 170    * 2.å¦‚æœé˜Ÿåˆ—æ‰§è¡Œé˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œåˆ™å°†æ‰€æœ‰ä»»åŠ¡æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­
 171    */
 172   public void resumeAllTask() {
 173     AriaManager.getInstance(AriaManager.APP)
 174         .setCmd(NormalCmdFactory.getInstance()
 175             .createCmd(targetName, new DownloadTaskEntity(), NormalCmdFactory.TASK_RESUME_ALL))
 176         .exe();
 177   }
 178 
 179   /**
 180    * åˆ é™¤æ‰€æœ‰ä»»åŠ¡
 181    *
 182    * @param removeFile {@code true} åˆ é™¤å·²ç»ä¸‹è½½å®Œæˆçš„ä»»åŠ¡ï¼Œä¸ä»…åˆ é™¤ä¸‹è½½è®°å½•ï¼Œè¿˜ä¼šåˆ é™¤å·²ç»ä¸‹è½½å®Œæˆçš„æ–‡ä»¶ï¼Œ{@code false}
 183    * å¦‚æœæ–‡ä»¶å·²ç»ä¸‹è½½å®Œæˆï¼Œåªåˆ é™¤ä¸‹è½½è®°å½•
 184    */
 185   @Override public void removeAllTask(boolean removeFile) {
 186     final AriaManager ariaManager = AriaManager.getInstance(AriaManager.APP);
 187     AriaManager.getInstance(AriaManager.APP)
 188         .setCmd(CommonUtil.createCmd(targetName, new DownloadTaskEntity(),
 189             NormalCmdFactory.TASK_CANCEL_ALL))
 190         .exe();
 191 
 192     Set&lt;String&gt; keys = ariaManager.getReceiver().keySet();
 193     for (String key : keys) {
 194       IReceiver receiver = ariaManager.getReceiver().get(key);
 195       receiver.removeSchedulerListener();
 196       receiver.unRegister();
 197       ariaManager.getReceiver().remove(key);
 198     }
 199   }
 200 }</pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.aria.core.download;
  17 
  18 import android.support.annotation.NonNull;
  19 import com.arialyy.aria.core.AriaManager;
  20 import com.arialyy.aria.core.inf.AbsReceiver;
  21 import com.arialyy.aria.core.inf.IEntity;
  22 import com.arialyy.aria.core.inf.IReceiver;
  23 import com.arialyy.aria.core.command.normal.NormalCmdFactory;
  24 import com.arialyy.aria.core.scheduler.DownloadSchedulers;
  25 import com.arialyy.aria.core.scheduler.ISchedulerListener;
  26 import com.arialyy.aria.orm.DbEntity;
  27 import com.arialyy.aria.util.CheckUtil;
  28 import com.arialyy.aria.util.CommonUtil;
  29 import java.io.File;
  30 import java.util.List;
  31 import java.util.Set;
  32 
  33 /**
  34  * Created by lyy on 2016/12/5.
  35  * ä¸‹è½½åŠŸèƒ½æ¥æ”¶å™¨
  36  */
  37 public class DownloadReceiver extends AbsReceiver&lt;DownloadEntity&gt; {
  38   private final String TAG = &quot;DownloadReceiver&quot;;
  39   public ISchedulerListener&lt;DownloadTask&gt; listener;
  40 
  41   /**
  42    * è®¾ç½®æœ€å¤§ä¸‹è½½é€Ÿåº¦ï¼Œå•ä½ï¼škb
  43    * è¯¥æ–¹æ³•ä¸ºå®éªŒæ€§åŠŸèƒ½ï¼Œæ¸…ä¸è¦è½»æ˜“åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚
  44    *
  45    * @param maxSpeed ä¸º0è¡¨ç¤ºä¸é™é€Ÿ
  46    */
  47   @Deprecated public void setMaxSpeed(double maxSpeed) {
  48     AriaManager.getInstance(AriaManager.APP).getDownloadConfig().setMsxSpeed(maxSpeed);
  49   }
  50 
  51   /**
  52    * {@link #load(String)}ï¼Œè¯·ä½¿ç”¨è¯¥æ–¹æ³•
  53    */
  54   @Deprecated public DownloadTarget load(DownloadEntity entity) {
  55     return new DownloadTarget(entity, targetName);
  56   }
  57 
  58   /**
  59    * åŠ è½½ä¸‹è½½åœ°å€
  60    */
  61   public DownloadTarget load(@NonNull String downloadUrl) {
  62     CheckUtil.checkDownloadUrl(downloadUrl);
  63     DownloadEntity entity =
  64         DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl);
  65     if (entity == null) {
  66       entity = new DownloadEntity();
  67     }
  68     File file = new File(entity.getDownloadPath());
  69     if (!file.exists()) {
  70       entity.setState(IEntity.STATE_WAIT);
  71     }
  72     entity.setDownloadUrl(downloadUrl);
  73     return new DownloadTarget(entity, targetName);
  74   }
  75 
  76   /**
  77    * åŠ è½½ä¸‹è½½åœ°å€ï¼Œå¦‚æœä»»åŠ¡ç»„çš„ä¸­çš„ä¸‹è½½åœ°å€æ”¹å˜äº†ï¼Œåˆ™ä»»åŠ¡ä»æ–°çš„ä¸€ä¸ªä»»åŠ¡ç»„
  78    */
  79   public DownloadGroupTarget load(List&lt;String&gt; urls) {
  80     CheckUtil.checkDownloadUrls(urls);
  81     DownloadGroupEntity entity =
  82         DbEntity.findData(DownloadGroupEntity.class, &quot;urlHash=?&quot;, CommonUtil.getMd5Code(urls));
  83 
  84     if (entity == null) {
  85       entity = new DownloadGroupEntity();
  86     }
  87     return new DownloadGroupTarget(entity, targetName, urls);
  88   }
  89 
  90   /**
  91    * å°†å½“å‰ç±»æ³¨å†Œåˆ°Aria
  92    */
  93   public DownloadReceiver register() {
  94     DownloadSchedulers.getInstance().register(obj);
  95     return this;
  96   }
  97 
  98   /**
  99    * å–æ¶ˆæ³¨å†Œ
 100    */
 101   @Override public void unRegister() {
 102     DownloadSchedulers.getInstance().unRegister(obj);
 103   }
 104 
 105   /**
 106    * æ·»åŠ è°ƒåº¦å™¨å›è°ƒ
 107    *
 108    * @see #register()
 109    */
 110   @Deprecated public DownloadReceiver addSchedulerListener(
 111       ISchedulerListener&lt;DownloadTask&gt; listener) {
 112     this.listener = listener;
 113     DownloadSchedulers.getInstance().addSchedulerListener(targetName, listener);
 114     return this;
 115   }
 116 
 117   /**
 118    * ç§»é™¤å›è°ƒ
 119    *
 120    * @see #unRegister()
 121    */
 122   @Deprecated @Override public void removeSchedulerListener() {
 123     if (listener != null) {
 124       DownloadSchedulers.getInstance().removeSchedulerListener(targetName, listener);
 125     }
 126   }
 127 
 128   @Override public void destroy() {
 129     targetName = null;
 130     listener = null;
 131   }
 132 
 133   /**
 134    * é€šè¿‡ä¸‹è½½é“¾æ¥è·å–ä¸‹è½½å®ä½“
 135    */
 136   public DownloadEntity getDownloadEntity(String downloadUrl) {
 137     CheckUtil.checkDownloadUrl(downloadUrl);
 138     return DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl);
 139   }
 140 
 141   /**
 142    * ä¸‹è½½ä»»åŠ¡æ˜¯å¦å­˜åœ¨
 143    */
 144   @Override public boolean taskExists(String downloadUrl) {
 145     return DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl) != null;
 146   }
 147 
 148   @Override public List&lt;DownloadEntity&gt; getTaskList() {
 149     return DownloadEntity.findAllData(DownloadEntity.class);
 150   }
 151 
 152   /**
 153    * åœæ­¢æ‰€æœ‰æ­£åœ¨ä¸‹è½½çš„ä»»åŠ¡ï¼Œå¹¶æ¸…ç©ºç­‰å¾…é˜Ÿåˆ—ã€‚
 154    */
 155   @Override public void stopAllTask() {
 156     AriaManager.getInstance(AriaManager.APP)
 157         .setCmd(NormalCmdFactory.getInstance()
 158             .createCmd(targetName, new DownloadTaskEntity(), NormalCmdFactory.TASK_STOP_ALL))
 159         .exe();
 160   }
 161 
 162   /**
 163    * æ¢å¤æ‰€æœ‰æ­£åœ¨ä¸‹è½½çš„ä»»åŠ¡
 164    * 1.å¦‚æœæ‰§è¡Œé˜Ÿåˆ—æ²¡æœ‰æ»¡ï¼Œåˆ™å¼€å§‹ä¸‹è½½ä»»åŠ¡ï¼Œç›´åˆ°æ‰§è¡Œé˜Ÿåˆ—æ»¡
 165    * 2.å¦‚æœé˜Ÿåˆ—æ‰§è¡Œé˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œåˆ™å°†æ‰€æœ‰ä»»åŠ¡æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­
 166    */
 167   public void resumeAllTask() {
 168     AriaManager.getInstance(AriaManager.APP)
 169         .setCmd(NormalCmdFactory.getInstance()
 170             .createCmd(targetName, new DownloadTaskEntity(), NormalCmdFactory.TASK_RESUME_ALL))
 171         .exe();
 172   }
 173 
 174   /**
 175    * åˆ é™¤æ‰€æœ‰ä»»åŠ¡
 176    *
 177    * @param removeFile {@code true} åˆ é™¤å·²ç»ä¸‹è½½å®Œæˆçš„ä»»åŠ¡ï¼Œä¸ä»…åˆ é™¤ä¸‹è½½è®°å½•ï¼Œè¿˜ä¼šåˆ é™¤å·²ç»ä¸‹è½½å®Œæˆçš„æ–‡ä»¶ï¼Œ{@code false}
 178    * å¦‚æœæ–‡ä»¶å·²ç»ä¸‹è½½å®Œæˆï¼Œåªåˆ é™¤ä¸‹è½½è®°å½•
 179    */
 180   @Override public void removeAllTask(boolean removeFile) {
 181     final AriaManager ariaManager = AriaManager.getInstance(AriaManager.APP);
 182     AriaManager.getInstance(AriaManager.APP)
 183         .setCmd(CommonUtil.createCmd(targetName, new DownloadTaskEntity(),
 184             NormalCmdFactory.TASK_CANCEL_ALL))
 185         .exe();
 186 
 187     Set&lt;String&gt; keys = ariaManager.getReceiver().keySet();
 188     for (String key : keys) {
 189       IReceiver receiver = ariaManager.getReceiver().get(key);
 190       receiver.removeSchedulerListener();
 191       receiver.unRegister();
 192       ariaManager.getReceiver().remove(key);
 193     }
 194   }
 195 }
 
 
 
 </pre></td>
                            <td><pre>   1 /*
   2  * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3  *
   4  * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5  * you may not use this file except in compliance with the License.
   6  * You may obtain a copy of the License at
   7  *
   8  *      http://www.apache.org/licenses/LICENSE-2.0
   9  *
  10  * Unless required by applicable law or agreed to in writing, software
  11  * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13  * See the License for the specific language governing permissions and
  14  * limitations under the License.
  15  */
  16 package com.arialyy.aria.core.download;
  17 
  18 import android.support.annotation.NonNull;
  19 import com.arialyy.aria.core.AriaManager;
  20 import com.arialyy.aria.core.command.normal.NormalCmdFactory;
  21 import com.arialyy.aria.core.inf.AbsReceiver;
  22 import com.arialyy.aria.core.inf.IEntity;
  23 import com.arialyy.aria.core.inf.IReceiver;
  24 import com.arialyy.aria.core.scheduler.DownloadSchedulers;
  25 import com.arialyy.aria.core.scheduler.ISchedulerListener;
  26 import com.arialyy.aria.orm.DbEntity;
  27 import com.arialyy.aria.util.CheckUtil;
  28 import com.arialyy.aria.util.CommonUtil;
  29 import java.io.File;
  30 import java.util.List;
  31 import java.util.Set;
  32 
  33 
  34 /**
  35  * Created by lyy on 2016/12/5.
  36  * ä¸‹è½½åŠŸèƒ½æ¥æ”¶å™¨
  37  */
  38 public class DownloadReceiver extends AbsReceiver&lt;DownloadEntity&gt; {
  39   private final String TAG = &quot;DownloadReceiver&quot;;
  40 
  41   public ISchedulerListener&lt;DownloadTask&gt; listener;
  42 
  43   /**
  44    * è®¾ç½®æœ€å¤§ä¸‹è½½é€Ÿåº¦ï¼Œå•ä½ï¼škb
  45    * è¯¥æ–¹æ³•ä¸ºå®éªŒæ€§åŠŸèƒ½ï¼Œæ¸…ä¸è¦è½»æ˜“åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚
  46    *
  47    * @param maxSpeed ä¸º0è¡¨ç¤ºä¸é™é€Ÿ
  48    */
  49   @Deprecated public void setMaxSpeed(double maxSpeed) {
  50     AriaManager.getInstance(AriaManager.APP).getDownloadConfig().setMsxSpeed(maxSpeed);
  51   }
  52 
  53   /**
  54    * {@link #load(String)}ï¼Œè¯·ä½¿ç”¨è¯¥æ–¹æ³•
  55    */
  56   @Deprecated
  57   public DownloadTarget load(DownloadEntity entity) {
  58     return new DownloadTarget(entity, targetName);
  59   }
  60 
  61   /**
  62    * åŠ è½½ä¸‹è½½åœ°å€
  63    */
  64   public DownloadTarget load(@NonNull
  65   String downloadUrl) {
  66     CheckUtil.checkDownloadUrl(downloadUrl);
  67     DownloadEntity entity = DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl);
  68     if (entity == null) {
  69       entity = new DownloadEntity();
  70     }
  71     File file = new File(entity.getDownloadPath());
  72     if (!file.exists()) {
  73       entity.setState(IEntity.STATE_WAIT);
  74     }
  75     entity.setDownloadUrl(downloadUrl);
  76     return new DownloadTarget(entity, targetName);
  77   }
  78 
  79   /**
  80    * åŠ è½½ä¸‹è½½åœ°å€ï¼Œå¦‚æœä»»åŠ¡ç»„çš„ä¸­çš„ä¸‹è½½åœ°å€æ”¹å˜äº†ï¼Œåˆ™ä»»åŠ¡ä»æ–°çš„ä¸€ä¸ªä»»åŠ¡ç»„
  81    */
  82   public DownloadGroupTarget load(List&lt;String&gt; urls) {
  83     CheckUtil.checkDownloadUrls(urls);
  84     DownloadGroupEntity entity =
  85         DbEntity.findData(DownloadGroupEntity.class, &quot;urlHash=?&quot;, CommonUtil.getMd5Code(urls));
  86 
  87     if (entity == null) {
  88       entity = new DownloadGroupEntity();
  89     }
  90     return new DownloadGroupTarget(entity, targetName, urls);
  91   }
  92 
  93   /**
  94    * å°†å½“å‰ç±»æ³¨å†Œåˆ°Aria
  95    */
  96   public DownloadReceiver register() {
  97     DownloadSchedulers.getInstance().register(obj);
  98     return this;
  99   }
 100 
 101   /**
 102    * å–æ¶ˆæ³¨å†Œ
 103    */
 104   @Override
 105   public void unRegister() {
 106     DownloadSchedulers.getInstance().unRegister(obj);
 107   }
 108 
 109   /**
 110    * æ·»åŠ è°ƒåº¦å™¨å›è°ƒ
 111    *
 112    * @see #register()
 113    */
 114   @Deprecated
 115   public DownloadReceiver addSchedulerListener(ISchedulerListener&lt;DownloadTask&gt; listener) {
 116     this.listener = listener;
 117     DownloadSchedulers.getInstance().addSchedulerListener(targetName, listener);
 118     return this;
 119   }
 120 
 121   /**
 122    * ç§»é™¤å›è°ƒ
 123    *
 124    * @see #unRegister()
 125    */
 126   @Deprecated
 127   @Override
 128   public void removeSchedulerListener() {
 129     if (listener != null) {
 130       DownloadSchedulers.getInstance().removeSchedulerListener(targetName, listener);
 131     }
 132   }
 133 
 134   @Override
 135   public void destroy() {
 136     targetName = null;
 137     listener = null;
 138   }
 139 
 140   /**
 141    * é€šè¿‡ä¸‹è½½é“¾æ¥è·å–ä¸‹è½½å®ä½“
 142    */
 143   public DownloadEntity getDownloadEntity(String downloadUrl) {
 144     CheckUtil.checkDownloadUrl(downloadUrl);
 145     return DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl);
 146   }
 147 
 148   /**
 149    * ä¸‹è½½ä»»åŠ¡æ˜¯å¦å­˜åœ¨
 150    */
 151   @Override public boolean taskExists(String downloadUrl) {
 152     return DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl) != null;
 153   }
 154 
 155   @Override public List&lt;DownloadEntity&gt; getTaskList() {
 156     return DownloadEntity.findAllData(DownloadEntity.class);
 157   }
 158 
 159   /**
 160    * åœæ­¢æ‰€æœ‰æ­£åœ¨ä¸‹è½½çš„ä»»åŠ¡ï¼Œå¹¶æ¸…ç©ºç­‰å¾…é˜Ÿåˆ—ã€‚
 161    */
 162   @Override
 163   public void stopAllTask() {
<abbr title=" 164     AriaManager.getInstance(AriaManager.APP).setCmd(NormalCmdFactory.getInstance().createCmd(targetName, new DownloadTaskEntity(), NormalCmdFactory.TASK_STOP_ALL)).exe();"> 164     AriaManager.getInstance(AriaManager.APP).setCmd(NormalCmdFactory.getInstance().createCmd(targetName, ğŸ”µ</abbr>
 165   }
 166 
 167   /**
 168    * æ¢å¤æ‰€æœ‰æ­£åœ¨ä¸‹è½½çš„ä»»åŠ¡
 169    * 1.å¦‚æœæ‰§è¡Œé˜Ÿåˆ—æ²¡æœ‰æ»¡ï¼Œåˆ™å¼€å§‹ä¸‹è½½ä»»åŠ¡ï¼Œç›´åˆ°æ‰§è¡Œé˜Ÿåˆ—æ»¡
 170    * 2.å¦‚æœé˜Ÿåˆ—æ‰§è¡Œé˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œåˆ™å°†æ‰€æœ‰ä»»åŠ¡æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­
 171    */
 172   public void resumeAllTask() {
<abbr title=" 173     AriaManager.getInstance(AriaManager.APP).setCmd(NormalCmdFactory.getInstance().createCmd(targetName, new DownloadTaskEntity(), NormalCmdFactory.TASK_RESUME_ALL)).exe();"> 173     AriaManager.getInstance(AriaManager.APP).setCmd(NormalCmdFactory.getInstance().createCmd(targetName, ğŸ”µ</abbr>
 174   }
 175 
 176   /**
 177    * åˆ é™¤æ‰€æœ‰ä»»åŠ¡
 178    *
 179    * @param removeFile
 180    * 		{@code true} åˆ é™¤å·²ç»ä¸‹è½½å®Œæˆçš„ä»»åŠ¡ï¼Œä¸ä»…åˆ é™¤ä¸‹è½½è®°å½•ï¼Œè¿˜ä¼šåˆ é™¤å·²ç»ä¸‹è½½å®Œæˆçš„æ–‡ä»¶ï¼Œ{@code false}
 181    * 		å¦‚æœæ–‡ä»¶å·²ç»ä¸‹è½½å®Œæˆï¼Œåªåˆ é™¤ä¸‹è½½è®°å½•
 182    */
 183   @Override
 184   public void removeAllTask(boolean removeFile) {
 185     final AriaManager ariaManager = AriaManager.getInstance(AriaManager.APP);
<abbr title=" 186     AriaManager.getInstance(AriaManager.APP).setCmd(CommonUtil.createCmd(targetName, new DownloadTaskEntity(), NormalCmdFactory.TASK_CANCEL_ALL)).exe();"> 186     AriaManager.getInstance(AriaManager.APP).setCmd(CommonUtil.createCmd(targetName, new DownloadTaskEntiğŸ”µ</abbr>
 187     Set&lt;String&gt; keys = ariaManager.getReceiver().keySet();
 188     for (String key : keys) {
 189       IReceiver receiver = ariaManager.getReceiver().get(key);
 190       receiver.removeSchedulerListener();
 191       receiver.unRegister();
 192       ariaManager.getReceiver().remove(key);
 193     }
 194   }
 195 }
 
 
 
 </pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  package com.arialyy.aria.core.download;
  17  
  18  import android.support.annotation.NonNull;
  19  import com.arialyy.aria.core.AriaManager;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -import com.arialyy.aria.core.inf.ICmd;</span>

  21  import com.arialyy.aria.core.inf.IEntity;
  22  import com.arialyy.aria.core.inf.IReceiver;
  23  import com.arialyy.aria.core.command.CmdFactory;
  24  import com.arialyy.aria.core.command.AbsCmd;

  25  import com.arialyy.aria.core.scheduler.DownloadSchedulers;
  26  import com.arialyy.aria.core.scheduler.ISchedulerListener;
  27  import com.arialyy.aria.orm.DbEntity;
  28  import com.arialyy.aria.util.CheckUtil;
  29  import com.arialyy.aria.util.CommonUtil;
  30  import java.io.File;
  31  import java.util.ArrayList;
  32  import java.util.List;
  33  import java.util.Set;
  34  
  35  /**
  36   * Created by lyy on 2016/12/5.
  37   * ä¸‹è½½åŠŸèƒ½æ¥æ”¶å™¨
  38   */
  39  public class DownloadReceiver implements IReceiver&lt;DownloadEntity&gt; {
  40    private static final String TAG = &quot;DownloadReceiver&quot;;
  41    public String targetName;
  42    public Object obj;


  43    public ISchedulerListener&lt;DownloadTask&gt; listener;
  44  
  45    /**
  46     * è®¾ç½®æœ€å¤§ä¸‹è½½é€Ÿåº¦ï¼Œå•ä½ï¼škb
  47     * è¯¥æ–¹æ³•ä¸ºå®éªŒæ€§åŠŸèƒ½ï¼Œæ¸…ä¸è¦è½»æ˜“åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚
  48     *
  49     * @param maxSpeed ä¸º0è¡¨ç¤ºä¸é™é€Ÿ
  50     */
  51    @Deprecated public void setMaxSpeed(double maxSpeed) {
  52      AriaManager.getInstance(AriaManager.APP).getDownloadConfig().setMsxSpeed(maxSpeed);
  53    }
  54  
  55    /**
  56     * {@link #load(String)}ï¼Œè¯·ä½¿ç”¨è¯¥æ–¹æ³•
  57     */
  58    @Deprecated public DownloadTarget load(DownloadEntity entity) {
  59      return new DownloadTarget(entity, targetName);
  60    }
  61  
  62    /**
  63     * åŠ è½½ä¸‹è½½åœ°å€
  64     */
  65    public DownloadTarget load(@NonNull String downloadUrl) {
  66      CheckUtil.checkDownloadUrl(downloadUrl);
  67      DownloadEntity entity =
  68          DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl);
  69      if (entity == null) {
  70        entity = new DownloadEntity();
  71      }
  72      File file = new File(entity.getDownloadPath());
  73      if (!file.exists()) {
  74        entity.setState(IEntity.STATE_WAIT);
  75      }
  76      entity.setDownloadUrl(downloadUrl);
  77      return new DownloadTarget(entity, targetName);
  78    }
  79  
  80    /**
  81     * æ·»åŠ è°ƒåº¦å™¨å›è°ƒ
  82     *
  83     * @see #register()

  84     */
  85    @Deprecated public DownloadReceiver addSchedulerListener(
  86        ISchedulerListener&lt;DownloadTask&gt; listener) {
  87      this.listener = listener;
  88      DownloadSchedulers.getInstance().addSchedulerListener(targetName, listener);
  89      return this;









  90    }
  91  
  92    /**
  93     * å°†å½“å‰ç±»æ³¨å†Œåˆ°Aria
  94     */
  95    public DownloadReceiver register() {
  96      DownloadSchedulers.getInstance().register(obj);
  97      return this;
  98    }
  99  
 100    /**
 101     * å–æ¶ˆæ³¨å†Œ
 102     */
 103    @Override public void unRegister() {
 104      DownloadSchedulers.getInstance().unRegister(obj);












 105    }
 106  
 107    /**
 108     * ç§»é™¤å›è°ƒ
 109     *
 110     * @see #unRegister()
 111     */
 112    @Deprecated @Override public void removeSchedulerListener() {
 113      if (listener != null) {
 114        DownloadSchedulers.getInstance().removeSchedulerListener(targetName, listener);
 115      }
 116    }
 117  
 118    @Override public void destroy() {
 119      targetName = null;
 120      listener = null;
 121    }
 122  
 123    /**
 124     * é€šè¿‡ä¸‹è½½é“¾æ¥è·å–ä¸‹è½½å®ä½“
 125     */
 126    public DownloadEntity getDownloadEntity(String downloadUrl) {
 127      CheckUtil.checkDownloadUrl(downloadUrl);
 128      return DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl);
 129    }
 130  
 131    /**
 132     * ä¸‹è½½ä»»åŠ¡æ˜¯å¦å­˜åœ¨
 133     */
 134    @Override public boolean taskExists(String downloadUrl) {
 135      return DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl) != null;
 136    }
 137  
 138    @Override public List&lt;DownloadEntity&gt; getTaskList() {
 139      return DownloadEntity.findAllData(DownloadEntity.class);
 140    }
 141  
 142    /**
 143     * åœæ­¢æ‰€æœ‰æ­£åœ¨ä¸‹è½½çš„ä»»åŠ¡ï¼Œå¹¶æ¸…ç©ºç­‰å¾…é˜Ÿåˆ—ã€‚
 144     */
 145    @Override public void stopAllTask() {
 146      final AriaManager ariaManager = AriaManager.getInstance(AriaManager.APP);
 147      ariaManager.setCmd(CmdFactory.getInstance()
 148          .createCmd(targetName, new DownloadTaskEntity(), CmdFactory.TASK_STOP_ALL)).exe();




 149    }
 150  
 151    /**
 152     * æ¢å¤æ‰€æœ‰æ­£åœ¨ä¸‹è½½çš„ä»»åŠ¡
 153     * 1.å¦‚æœæ‰§è¡Œé˜Ÿåˆ—æ²¡æœ‰æ»¡ï¼Œåˆ™å¼€å§‹ä¸‹è½½ä»»åŠ¡ï¼Œç›´åˆ°æ‰§è¡Œé˜Ÿåˆ—æ»¡
 154     * 2.å¦‚æœé˜Ÿåˆ—æ‰§è¡Œé˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œåˆ™å°†æ‰€æœ‰ä»»åŠ¡æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­
 155     */
 156    public void resumeAllTask() {
 157      final AriaManager ariaManager = AriaManager.getInstance(AriaManager.APP);
 158      ariaManager.setCmd(CmdFactory.getInstance()
 159          .createCmd(targetName, new DownloadTaskEntity(), CmdFactory.TASK_RESUME_ALL)).exe();




 160    }
 161  
 162    /**
 163     * åˆ é™¤æ‰€æœ‰ä»»åŠ¡



 164     */
 165    @Override public void removeAllTask() {

 166      final AriaManager ariaManager = AriaManager.getInstance(AriaManager.APP);
 167      List&lt;DownloadEntity&gt; allEntity = DbEntity.findAllData(DownloadEntity.class);
 168      List&lt;AbsCmd&gt; cancelCmds = new ArrayList&lt;&gt;();
 169      for (DownloadEntity entity : allEntity) {
 170        cancelCmds.add(
 171            CommonUtil.createCmd(targetName, new DownloadTaskEntity(entity), CmdFactory.TASK_CANCEL));
 172      }
 173      ariaManager.setCmds(cancelCmds).exe();





 174      Set&lt;String&gt; keys = ariaManager.getReceiver().keySet();
 175      for (String key : keys) {
 176        IReceiver receiver = ariaManager.getReceiver().get(key);
 177        receiver.removeSchedulerListener();
 178        receiver.unRegister();
 179        ariaManager.getReceiver().remove(key);
 180      }
 181    }
 182  }</pre></td>
                            <td><pre>   1  /*
   2   * Copyright (C) 2016 AriaLyy(https://github.com/AriaLyy/Aria)
   3   *
   4   * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   5   * you may not use this file except in compliance with the License.
   6   * You may obtain a copy of the License at
   7   *
   8   *      http://www.apache.org/licenses/LICENSE-2.0
   9   *
  10   * Unless required by applicable law or agreed to in writing, software
  11   * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  12   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  13   * See the License for the specific language governing permissions and
  14   * limitations under the License.
  15   */
  16  package com.arialyy.aria.core.download;
  17  
  18  import android.support.annotation.NonNull;
  19  import com.arialyy.aria.core.AriaManager;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  20 -import com.arialyy.aria.core.inf.ICmd;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  21 +import com.arialyy.aria.core.inf.AbsReceiver;</span>
  22  import com.arialyy.aria.core.inf.IEntity;
  23  import com.arialyy.aria.core.inf.IReceiver;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  24 -import com.arialyy.aria.core.command.CmdFactory;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  25 -import com.arialyy.aria.core.command.AbsCmd;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  26 +import com.arialyy.aria.core.command.normal.NormalCmdFactory;</span>
  27  import com.arialyy.aria.core.scheduler.DownloadSchedulers;
  28  import com.arialyy.aria.core.scheduler.ISchedulerListener;
  29  import com.arialyy.aria.orm.DbEntity;
  30  import com.arialyy.aria.util.CheckUtil;
  31  import com.arialyy.aria.util.CommonUtil;
  32  import java.io.File;
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  33 -import java.util.ArrayList;</span>
  34  import java.util.List;
  35  import java.util.Set;
  36  
  37  /**
  38   * Created by lyy on 2016/12/5.
  39   * ä¸‹è½½åŠŸèƒ½æ¥æ”¶å™¨
  40   */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  41 -public class DownloadReceiver implements IReceiver&lt;DownloadEntity&gt; {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  42 -  private static final String TAG = &quot;DownloadReceiver&quot;;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  43 -  public String targetName;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  44 -  public Object obj;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  45 +public class DownloadReceiver extends AbsReceiver&lt;DownloadEntity&gt; {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  46 +  private final String TAG = &quot;DownloadReceiver&quot;;</span>
  47    public ISchedulerListener&lt;DownloadTask&gt; listener;
  48  
  49    /**
  50     * è®¾ç½®æœ€å¤§ä¸‹è½½é€Ÿåº¦ï¼Œå•ä½ï¼škb
  51     * è¯¥æ–¹æ³•ä¸ºå®éªŒæ€§åŠŸèƒ½ï¼Œæ¸…ä¸è¦è½»æ˜“åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚
  52     *
  53     * @param maxSpeed ä¸º0è¡¨ç¤ºä¸é™é€Ÿ
  54     */
  55    @Deprecated public void setMaxSpeed(double maxSpeed) {
  56      AriaManager.getInstance(AriaManager.APP).getDownloadConfig().setMsxSpeed(maxSpeed);
  57    }
  58  
  59    /**
  60     * {@link #load(String)}ï¼Œè¯·ä½¿ç”¨è¯¥æ–¹æ³•
  61     */
  62    @Deprecated public DownloadTarget load(DownloadEntity entity) {
  63      return new DownloadTarget(entity, targetName);
  64    }
  65  
  66    /**
  67     * åŠ è½½ä¸‹è½½åœ°å€
  68     */
  69    public DownloadTarget load(@NonNull String downloadUrl) {
  70      CheckUtil.checkDownloadUrl(downloadUrl);
  71      DownloadEntity entity =
  72          DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl);
  73      if (entity == null) {
  74        entity = new DownloadEntity();
  75      }
  76      File file = new File(entity.getDownloadPath());
  77      if (!file.exists()) {
  78        entity.setState(IEntity.STATE_WAIT);
  79      }
  80      entity.setDownloadUrl(downloadUrl);
  81      return new DownloadTarget(entity, targetName);
  82    }
  83  
  84    /**
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  85 -   * æ·»åŠ è°ƒåº¦å™¨å›è°ƒ</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  86 -   *</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  87 -   * @see #register()</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  88 +   * åŠ è½½ä¸‹è½½åœ°å€ï¼Œå¦‚æœä»»åŠ¡ç»„çš„ä¸­çš„ä¸‹è½½åœ°å€æ”¹å˜äº†ï¼Œåˆ™ä»»åŠ¡ä»æ–°çš„ä¸€ä¸ªä»»åŠ¡ç»„</span>
  89     */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  90 -  @Deprecated public DownloadReceiver addSchedulerListener(</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  91 -      ISchedulerListener&lt;DownloadTask&gt; listener) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  92 -    this.listener = listener;</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  93 -    DownloadSchedulers.getInstance().addSchedulerListener(targetName, listener);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0">  94 -    return this;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  95 +  public DownloadGroupTarget load(List&lt;String&gt; urls) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  96 +    CheckUtil.checkDownloadUrls(urls);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  97 +    DownloadGroupEntity entity =</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  98 +        DbEntity.findData(DownloadGroupEntity.class, &quot;urlHash=?&quot;, CommonUtil.getMd5Code(urls));</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  99 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 100 +    if (entity == null) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 101 +      entity = new DownloadGroupEntity();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 102 +    }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 103 +    return new DownloadGroupTarget(entity, targetName, urls);</span>
 104    }
 105  
 106    /**
 107     * å°†å½“å‰ç±»æ³¨å†Œåˆ°Aria
 108     */
 109    public DownloadReceiver register() {
 110      DownloadSchedulers.getInstance().register(obj);
 111      return this;
 112    }
 113  
 114    /**
 115     * å–æ¶ˆæ³¨å†Œ
 116     */
 117    @Override public void unRegister() {
 118      DownloadSchedulers.getInstance().unRegister(obj);
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 119 +  }</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 121 +  /**</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 122 +   * æ·»åŠ è°ƒåº¦å™¨å›è°ƒ</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 123 +   *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +   * @see #register()</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 125 +   */</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 126 +  @Deprecated public DownloadReceiver addSchedulerListener(</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 127 +      ISchedulerListener&lt;DownloadTask&gt; listener) {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 128 +    this.listener = listener;</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 129 +    DownloadSchedulers.getInstance().addSchedulerListener(targetName, listener);</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 130 +    return this;</span>
 131    }
 132  
 133    /**
 134     * ç§»é™¤å›è°ƒ
 135     *
 136     * @see #unRegister()
 137     */
 138    @Deprecated @Override public void removeSchedulerListener() {
 139      if (listener != null) {
 140        DownloadSchedulers.getInstance().removeSchedulerListener(targetName, listener);
 141      }
 142    }
 143  
 144    @Override public void destroy() {
 145      targetName = null;
 146      listener = null;
 147    }
 148  
 149    /**
 150     * é€šè¿‡ä¸‹è½½é“¾æ¥è·å–ä¸‹è½½å®ä½“
 151     */
 152    public DownloadEntity getDownloadEntity(String downloadUrl) {
 153      CheckUtil.checkDownloadUrl(downloadUrl);
 154      return DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl);
 155    }
 156  
 157    /**
 158     * ä¸‹è½½ä»»åŠ¡æ˜¯å¦å­˜åœ¨
 159     */
 160    @Override public boolean taskExists(String downloadUrl) {
 161      return DownloadEntity.findData(DownloadEntity.class, &quot;downloadUrl=?&quot;, downloadUrl) != null;
 162    }
 163  
 164    @Override public List&lt;DownloadEntity&gt; getTaskList() {
 165      return DownloadEntity.findAllData(DownloadEntity.class);
 166    }
 167  
 168    /**
 169     * åœæ­¢æ‰€æœ‰æ­£åœ¨ä¸‹è½½çš„ä»»åŠ¡ï¼Œå¹¶æ¸…ç©ºç­‰å¾…é˜Ÿåˆ—ã€‚
 170     */
 171    @Override public void stopAllTask() {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 172 -    final AriaManager ariaManager = AriaManager.getInstance(AriaManager.APP);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 173 -    ariaManager.setCmd(CmdFactory.getInstance()</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 174 -        .createCmd(targetName, new DownloadTaskEntity(), CmdFactory.TASK_STOP_ALL)).exe();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 175 +    AriaManager.getInstance(AriaManager.APP)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 176 +        .setCmd(NormalCmdFactory.getInstance()</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 177 +            .createCmd(targetName, new DownloadTaskEntity(), NormalCmdFactory.TASK_STOP_ALL))</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 178 +        .exe();</span>
 179    }
 180  
 181    /**
 182     * æ¢å¤æ‰€æœ‰æ­£åœ¨ä¸‹è½½çš„ä»»åŠ¡
 183     * 1.å¦‚æœæ‰§è¡Œé˜Ÿåˆ—æ²¡æœ‰æ»¡ï¼Œåˆ™å¼€å§‹ä¸‹è½½ä»»åŠ¡ï¼Œç›´åˆ°æ‰§è¡Œé˜Ÿåˆ—æ»¡
 184     * 2.å¦‚æœé˜Ÿåˆ—æ‰§è¡Œé˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œåˆ™å°†æ‰€æœ‰ä»»åŠ¡æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­
 185     */
 186    public void resumeAllTask() {
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 187 -    final AriaManager ariaManager = AriaManager.getInstance(AriaManager.APP);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 188 -    ariaManager.setCmd(CmdFactory.getInstance()</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 189 -        .createCmd(targetName, new DownloadTaskEntity(), CmdFactory.TASK_RESUME_ALL)).exe();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 190 +    AriaManager.getInstance(AriaManager.APP)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 191 +        .setCmd(NormalCmdFactory.getInstance()</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 192 +            .createCmd(targetName, new DownloadTaskEntity(), NormalCmdFactory.TASK_RESUME_ALL))</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 193 +        .exe();</span>
 194    }
 195  
 196    /**
 197     * åˆ é™¤æ‰€æœ‰ä»»åŠ¡
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 198 +   *</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 199 +   * @param removeFile {@code true} åˆ é™¤å·²ç»ä¸‹è½½å®Œæˆçš„ä»»åŠ¡ï¼Œä¸ä»…åˆ é™¤ä¸‹è½½è®°å½•ï¼Œè¿˜ä¼šåˆ é™¤å·²ç»ä¸‹è½½å®Œæˆçš„æ–‡ä»¶ï¼Œ{@code false}</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 200 +   * å¦‚æœæ–‡ä»¶å·²ç»ä¸‹è½½å®Œæˆï¼Œåªåˆ é™¤ä¸‹è½½è®°å½•</span>
 201     */
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 202 -  @Override public void removeAllTask() {</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 203 +  @Override public void removeAllTask(boolean removeFile) {</span>
 204      final AriaManager ariaManager = AriaManager.getInstance(AriaManager.APP);
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 205 -    List&lt;DownloadEntity&gt; allEntity = DbEntity.findAllData(DownloadEntity.class);</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 206 -    List&lt;AbsCmd&gt; cancelCmds = new ArrayList&lt;&gt;();</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 207 -    for (DownloadEntity entity : allEntity) {</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 208 -      cancelCmds.add(</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 209 -          CommonUtil.createCmd(targetName, new DownloadTaskEntity(entity), CmdFactory.TASK_CANCEL));</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 210 -    }</span>
<span style="background-color: rgba(255, 0, 0, 0.2);; margin: 0"> 211 -    ariaManager.setCmds(cancelCmds).exe();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 212 +    AriaManager.getInstance(AriaManager.APP)</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 213 +        .setCmd(CommonUtil.createCmd(targetName, new DownloadTaskEntity(),</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 214 +            NormalCmdFactory.TASK_CANCEL_ALL))</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 215 +        .exe();</span>
<span style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 216 +</span>
 217      Set&lt;String&gt; keys = ariaManager.getReceiver().keySet();
 218      for (String key : keys) {
 219        IReceiver receiver = ariaManager.getReceiver().get(key);
 220        receiver.removeSchedulerListener();
 221        receiver.unRegister();
 222        ariaManager.getReceiver().remove(key);
 223      }
 224    }
 225  }</pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            