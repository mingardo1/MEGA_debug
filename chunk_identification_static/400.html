<!DOCTYPE html>
    <html lang="en">
              <head>
                <meta charset="utf-8">
                <title>400</title>
                    <style>
                        #top {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        #bottom {
                            height: 48vh;
                            overflow-y: auto;
                        }
                        .highlighted {
                            background-color: rgba(177, 82, 227, 0.85) !important;
                        }
                    </style>
                    <script>
                        function enter(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.add('highlighted');
                            }
                        }
                        function out(c) {
                            const lines = document.getElementsByClassName(c);
                            for (let i = 0; i < lines.length; i++) {
                               lines.item(i).classList.remove('highlighted');
                            }
                        }
                    </script>
              </head>
              <body>
                <span style="height: 4vh">
                    400
                    <a href="399.html">prev</a>
                    <a href="401.html">next</a>
                    <a href="400_chunks.html">chunks</a>
                    <a href="index.html">index</a>
                    DTStack/flinkStreamSQL_5553ee5c6410a412ab4ed61d9499805adee8995a_kudu/kudu-side/kudu-all-side/src/main/java/com/dtstack/flink/sql/side/kudu/KuduAllReqRow.java
                    <textarea rows=1 onclick='navigator.clipboard.writeText(this.value)'>cd C:\studies\se\mega\git-analyzer-plus\notebooks\debug
del /Q *
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;5553ee5c6410a412ab4ed61d9499805adee8995a:kudu/kudu-side/kudu-all-side/src/main/java/com/dtstack/flink/sql/side/kudu/KuduAllReqRow.java&quot; &gt; committed.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;5553ee5c6410a412ab4ed61d9499805adee8995a^1:kudu/kudu-side/kudu-all-side/src/main/java/com/dtstack/flink/sql/side/kudu/KuduAllReqRow.java&quot; &gt; ours.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;5553ee5c6410a412ab4ed61d9499805adee8995a^2:kudu/kudu-side/kudu-all-side/src/main/java/com/dtstack/flink/sql/side/kudu/KuduAllReqRow.java&quot; &gt; theirs.java
git -C C:\studies\se\mega\project-dirs\projects_Java_desc-stars-1000\DTStack\flinkStreamSQL show &quot;e0a10435dcb243a911c0405daebc6aa667d5119d:kudu/kudu-side/kudu-all-side/src/main/java/com/dtstack/flink/sql/side/kudu/KuduAllReqRow.java&quot; &gt; base.java
copy ours.java 1ours.java
copy ours.java 2ours.java
copy theirs.java 1theirs.java
copy theirs.java 2theirs.java
copy base.java 1base.java
copy base.java 2base.java
&quot;C:\Program Files\Java\jdk1.8.0_241\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\jFSTMerge\build\libs\jFSTMerge-all.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\1theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\jfstmerge.java --show-base
&quot;C:\Program Files\Eclipse Adoptium\jdk-17.0.11.9-hotspot\bin\java.exe&quot; -Dfile.encoding=UTF-8 -jar &quot;C:\studies\se\spork\target\spork-0.5.0-SNAPSHOT.jar&quot; C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2ours.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2base.java C:\studies\se\mega\git-analyzer-plus\notebooks\debug\2theirs.java -o C:\studies\se\mega\git-analyzer-plus\notebooks\debug\spork.java
del /Q 1*.java
del /Q 2*.java
del /Q jfstmerge.java.merge
</textarea>
                    {strict: [[bj]], subset: [[bj]]}
                </span>
                <div id="top">

                    <table>
                        <tr>
                            <th>line based (standard git)</th>
                            <th>jfstmerge</th>
                            <th>spork</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-8840953368027741170" onmouseenter="enter('-8840953368027741170');" onmouseout="out('-8840953368027741170');" style="">   1 package com.dtstack.flink.sql.side.kudu;                                                                 </span>
<span  style="">   2                                                                                                          </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">   3 import com.dtstack.flink.sql.side.BaseAllReqRow;                                                         </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">   4 import com.dtstack.flink.sql.side.FieldInfo;                                                             </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">   5 import com.dtstack.flink.sql.side.JoinInfo;                                                              </span>
<span class="1614892075588798997" onmouseenter="enter('1614892075588798997');" onmouseout="out('1614892075588798997');" style="">   6 import com.dtstack.flink.sql.side.PredicateInfo;                                                         </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">   7 import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                 </span>
<span class="5710642889135375263" onmouseenter="enter('5710642889135375263');" onmouseout="out('5710642889135375263');" style="">   8 import com.dtstack.flink.sql.side.kudu.table.KuduSideTableInfo;                                          </span>
<span class="1164335795537447661" onmouseenter="enter('1164335795537447661');" onmouseout="out('1164335795537447661');" style="">   9 import com.dtstack.flink.sql.side.kudu.utils.KuduUtil;                                                   </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="">  10 import com.dtstack.flink.sql.util.RowDataComplete;                                                       </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  11 import com.google.common.base.Preconditions;                                                             </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  12 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  13 import com.google.common.collect.Maps;                                                                   </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  14 import org.apache.calcite.sql.JoinType;                                                                  </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  15 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  16 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  17 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  18 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  19 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  20 import org.apache.flink.types.Row;                                                                       </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  21 import org.apache.flink.util.Collector;                                                                  </span>
<span class="1631232015531818624" onmouseenter="enter('1631232015531818624');" onmouseout="out('1631232015531818624');" style="">  22 import org.apache.kudu.ColumnSchema;                                                                     </span>
<span class="-1755042893780385624" onmouseenter="enter('-1755042893780385624');" onmouseout="out('-1755042893780385624');" style="">  23 import org.apache.kudu.Schema;                                                                           </span>
<span class="2263873766708549976" onmouseenter="enter('2263873766708549976');" onmouseout="out('2263873766708549976');" style="">  24 import org.apache.kudu.client.KuduClient;                                                                </span>
<span class="1860194643195428903" onmouseenter="enter('1860194643195428903');" onmouseout="out('1860194643195428903');" style="">  25 import org.apache.kudu.client.KuduException;                                                             </span>
<span class="128288131530978478" onmouseenter="enter('128288131530978478');" onmouseout="out('128288131530978478');" style="">  26 import org.apache.kudu.client.KuduPredicate;                                                             </span>
<span class="-8538417097591974568" onmouseenter="enter('-8538417097591974568');" onmouseout="out('-8538417097591974568');" style="">  27 import org.apache.kudu.client.KuduScanner;                                                               </span>
<span class="-342692776902705676" onmouseenter="enter('-342692776902705676');" onmouseout="out('-342692776902705676');" style="">  28 import org.apache.kudu.client.KuduTable;                                                                 </span>
<span class="629701943397612117" onmouseenter="enter('629701943397612117');" onmouseout="out('629701943397612117');" style="">  29 import org.apache.kudu.client.PartialRow;                                                                </span>
<span class="-6157621177665621032" onmouseenter="enter('-6157621177665621032');" onmouseout="out('-6157621177665621032');" style="">  30 import org.apache.kudu.client.RowResult;                                                                 </span>
<span class="-1845673204769190809" onmouseenter="enter('-1845673204769190809');" onmouseout="out('-1845673204769190809');" style="">  31 import org.apache.kudu.client.RowResultIterator;                                                         </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  32 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  33 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  34                                                                                                          </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  35 import java.sql.SQLException;                                                                            </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  36 import java.util.Arrays;                                                                                 </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  37 import java.util.Calendar;                                                                               </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  38 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  39 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  40 import java.util.Map;                                                                                    </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  41 import java.util.concurrent.atomic.AtomicReference;                                                      </span>
<span  style="">  42                                                                                                          </span>
<span class="1178418458023894230" onmouseenter="enter('1178418458023894230');" onmouseout="out('1178418458023894230');" style="">  43 public class KuduAllReqRow extends BaseAllReqRow {                                                       </span>
<span  style="">  44                                                                                                          </span>
<span class="2664279006928748303" onmouseenter="enter('2664279006928748303');" onmouseout="out('2664279006928748303');" style="">  45     private static final long serialVersionUID = 6051774809356082219L;                                   </span>
<span  style="">  46                                                                                                          </span>
<span class="-7779246735798526406" onmouseenter="enter('-7779246735798526406');" onmouseout="out('-7779246735798526406');" style="">  47     private static final Logger LOG = LoggerFactory.getLogger(KuduAllReqRow.class);                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  48     /**                                                                                                  </span>
<span class="-8285284077529796986" onmouseenter="enter('-8285284077529796986');" onmouseout="out('-8285284077529796986');" style="">  49      * 获取连接的尝试次数                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  50      */                                                                                                  </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  51     private static final int CONN_RETRY_NUM = 3;                                                         </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  52     /**                                                                                                  </span>
<span class="4062789252244833512" onmouseenter="enter('4062789252244833512');" onmouseout="out('4062789252244833512');" style="">  53      * 缓存条数                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  54      */                                                                                                  </span>
<span class="1004470848600586149" onmouseenter="enter('1004470848600586149');" onmouseout="out('1004470848600586149');" style="">  55     private static final Long FETCH_SIZE = 1000L;                                                        </span>
<span  style="">  56                                                                                                          </span>
<span class="-2539961354521398263" onmouseenter="enter('-2539961354521398263');" onmouseout="out('-2539961354521398263');" style="">  57     private KuduClient client;                                                                           </span>
<span  style="">  58                                                                                                          </span>
<span class="1317689277640300307" onmouseenter="enter('1317689277640300307');" onmouseout="out('1317689277640300307');" style="">  59     private KuduTable table;                                                                             </span>
<span  style="">  60                                                                                                          </span>
<span  style="">  61                                                                                                          </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  62     private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();  </span>
<span  style="">  63                                                                                                          </span>
<span class="6616997293382437533" onmouseenter="enter('6616997293382437533');" onmouseout="out('6616997293382437533');" style=""><abbr title="  64     public KuduAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  64     public KuduAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, Ab🔵</abbr></span>
<span class="8698115236286713015" onmouseenter="enter('8698115236286713015');" onmouseout="out('8698115236286713015');" style="">  65         super(new KuduAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  66     }                                                                                                    </span>
<span  style="">  67                                                                                                          </span>
<span  style="">  68                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  69     @Override                                                                                            </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="">  70     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="">  71         Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                 </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="">  72         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="">  73         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="">  74             Object obj = input.getField(entry.getValue());                                               </span>
<span class="-4667942192763773056" onmouseenter="enter('-4667942192763773056');" onmouseout="out('-4667942192763773056');" style="">  75 &lt;&lt;&lt;&lt;&lt;&lt;&lt; GitAnalyzerPlus_ours                                                                             </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76             obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                    </span>
<span class="6741223626729319096" onmouseenter="enter('6741223626729319096');" onmouseout="out('6741223626729319096');" style="">  77 ||||||| GitAnalyzerPlus_base                                                                             </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  78             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());">  78             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  80             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long.">  80             //Type information for indicating event or processing time. However, it behaves like a regula🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82                 obj = ((Timestamp) obj).getTime();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83             }                                                                                            </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85         }                                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  86 =======                                                                                                  </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  87             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());">  87             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  89             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long.">  89             //Type information for indicating event or processing time. However, it behaves like a regula🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91                 //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                            </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  92                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());">  92                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime())🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94                                                                                                          </span>
<span class="-1382546150375666264" onmouseenter="enter('-1382546150375666264');" onmouseout="out('-1382546150375666264');" style="">  95 &gt;&gt;&gt;&gt;&gt;&gt;&gt; GitAnalyzerPlus_theirs                                                                           </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="">  96             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97         }                                                                                                </span>
<span  style="">  98                                                                                                          </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="">  99         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style=""> 100             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 101                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 102             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style=""> 103                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105         }                                                                                                </span>
<span  style=""> 106                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 107         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108     }                                                                                                    </span>
<span  style=""> 109                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 110     @Override                                                                                            </span>
<span class="-5452513235343270061" onmouseenter="enter('-5452513235343270061');" onmouseout="out('-5452513235343270061');" style=""> 111     protected void initCache() throws SQLException {                                                     </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 112         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 113         cacheRef.set(newCache);                                                                          </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 114         loadData(newCache);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115     }                                                                                                    </span>
<span  style=""> 116                                                                                                          </span>
<span  style=""> 117                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 118     @Override                                                                                            </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 119     protected void reloadCache() {                                                                       </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 120         //reload cacheRef and replace to old cacheRef                                                    </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 121         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 122         loadData(newCache);                                                                              </span>
<span  style=""> 123                                                                                                          </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 124         cacheRef.set(newCache);                                                                          </span>
<span class="-5375691814117803209" onmouseenter="enter('-5375691814117803209');" onmouseout="out('-5375691814117803209');" style=""> 125         LOG.info(&quot;----- kudu all cacheRef reload end:{}&quot;, Calendar.getInstance());                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126     }                                                                                                    </span>
<span  style=""> 127                                                                                                          </span>
<span  style=""> 128                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 129     @Override                                                                                            </span>
<span class="6843933761729718422" onmouseenter="enter('6843933761729718422');" onmouseout="out('6843933761729718422');" style=""> 130     public void flatMap(Row input, Collector&lt;BaseRow&gt; out) throws Exception {                            </span>
<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style=""> 131         List&lt;Object&gt; inputParams = Lists.newArrayList();                                                 </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style=""> 132         for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                        </span>
<span class="7582033886787525124" onmouseenter="enter('7582033886787525124');" onmouseout="out('7582033886787525124');" style=""> 133             Object equalObj = input.getField(conValIndex);                                               </span>
<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style=""> 134             if (equalObj == null) {                                                                      </span>
<span class="2802501092059214558" onmouseenter="enter('2802501092059214558');" onmouseout="out('2802501092059214558');" style=""> 135                 out.collect(null);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136             }                                                                                            </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style=""> 137             inputParams.add(equalObj);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138         }                                                                                                </span>
<span  style=""> 139                                                                                                          </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style=""> 140         String key = buildKey(inputParams);                                                              </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style=""> 141         List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                   </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style=""> 142         if (CollectionUtils.isEmpty(cacheList)) {                                                        </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style=""> 143             if (sideInfo.getJoinType() == JoinType.LEFT) {                                               </span>
<span class="-3752240759126097062" onmouseenter="enter('-3752240759126097062');" onmouseout="out('-3752240759126097062');" style=""> 144                 Row row = fillData(input, null);                                                         </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 145                 RowDataComplete.collectRow(out, row);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146             }                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 147             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148         }                                                                                                </span>
<span  style=""> 149                                                                                                          </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style=""> 150         for (Map&lt;String, Object&gt; one : cacheList) {                                                      </span>
<span class="-6006003971782103198" onmouseenter="enter('-6006003971782103198');" onmouseout="out('-6006003971782103198');" style=""> 151             Row row = fillData(input, one);                                                              </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 152             RowDataComplete.collectRow(out, row);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span class="961081247603323125" onmouseenter="enter('961081247603323125');" onmouseout="out('961081247603323125');" style=""> 156     private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {                             </span>
<span class="-5525344973390349168" onmouseenter="enter('-5525344973390349168');" onmouseout="out('-5525344973390349168');" style=""> 157         KuduSideTableInfo tableInfo = (KuduSideTableInfo) sideInfo.getSideTableInfo();                   </span>
<span class="4539652565484830811" onmouseenter="enter('4539652565484830811');" onmouseout="out('4539652565484830811');" style=""> 158         KuduScanner scanner = null;                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 159         try {                                                                                            </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 160             for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 161                 try {                                                                                    </span>
<span class="3825928320653477879" onmouseenter="enter('3825928320653477879');" onmouseout="out('3825928320653477879');" style=""> 162                     scanner = getConn(tableInfo);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 163                     break;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 164                 } catch (Exception e) {                                                                  </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 165                     if (i == CONN_RETRY_NUM - 1) {                                                       </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 166                         throw new RuntimeException(&quot;&quot;, e);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167                     }                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 168                     try {                                                                                </span>
<span class="7214047305831580892" onmouseenter="enter('7214047305831580892');" onmouseout="out('7214047305831580892');" style=""><abbr title=" 169                         String connInfo = &quot;kuduMasters:&quot; + tableInfo.getKuduMasters() + &quot;;tableName:&quot; + tableInfo.getTableName();"> 169                         String connInfo = &quot;kuduMasters:&quot; + tableInfo.getKuduMasters() + &quot;;tableName:&quot; + t🔵</abbr></span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 170                         LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);   </span>
<span class="-9127531774365832010" onmouseenter="enter('-9127531774365832010');" onmouseout="out('-9127531774365832010');" style=""> 171                         Thread.sleep(5 * 1000);                                                          </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 172                     } catch (InterruptedException e1) {                                                  </span>
<span class="4631440746187069452" onmouseenter="enter('4631440746187069452');" onmouseout="out('4631440746187069452');" style=""> 173                         LOG.error(&quot;&quot;,e1);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176             }                                                                                            </span>
<span class="475138084615438717" onmouseenter="enter('475138084615438717');" onmouseout="out('475138084615438717');" style=""> 177             //load data from table                                                                       </span>
<span class="3354690258641098597" onmouseenter="enter('3354690258641098597');" onmouseout="out('3354690258641098597');" style=""> 178             assert scanner != null;                                                                      </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 179             String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);            </span>
<span  style=""> 180                                                                                                          </span>
<span  style=""> 181                                                                                                          </span>
<span class="-7401034569209000676" onmouseenter="enter('-7401034569209000676');" onmouseout="out('-7401034569209000676');" style=""> 182             while (scanner.hasMoreRows()) {                                                              </span>
<span class="-490557585705256586" onmouseenter="enter('-490557585705256586');" onmouseout="out('-490557585705256586');" style=""> 183                 RowResultIterator results = scanner.nextRows();                                          </span>
<span class="5642997248258560969" onmouseenter="enter('5642997248258560969');" onmouseout="out('5642997248258560969');" style=""> 184                 while (results.hasNext()) {                                                              </span>
<span class="7206031536241251649" onmouseenter="enter('7206031536241251649');" onmouseout="out('7206031536241251649');" style=""> 185                     RowResult result = results.next();                                                   </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 186                     Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                      </span>
<span class="696829081573399723" onmouseenter="enter('696829081573399723');" onmouseout="out('696829081573399723');" style=""> 187                     for (String sideFieldName1 : sideFieldNames) {                                       </span>
<span class="5422300911827801712" onmouseenter="enter('5422300911827801712');" onmouseout="out('5422300911827801712');" style=""> 188                         String sideFieldName = sideFieldName1.trim();                                    </span>
<span class="-7396994512053753949" onmouseenter="enter('-7396994512053753949');" onmouseout="out('-7396994512053753949');" style=""> 189                         ColumnSchema columnSchema = table.getSchema().getColumn(sideFieldName);          </span>
<span class="-1551001954350423389" onmouseenter="enter('-1551001954350423389');" onmouseout="out('-1551001954350423389');" style=""> 190                         if (null != columnSchema) {                                                      </span>
<span class="-9080618923968214410" onmouseenter="enter('-9080618923968214410');" onmouseout="out('-9080618923968214410');" style=""> 191                             KuduUtil.setMapValue(columnSchema.getType(), oneRow, sideFieldName, result); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193                     }                                                                                    </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 194                     String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                    </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""><abbr title=" 195                     List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList());"> 195                     List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newA🔵</abbr></span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 196                     list.add(oneRow);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198             }                                                                                            </span>
<span  style=""> 199                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 200         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 201             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 202         } finally {                                                                                      </span>
<span class="8423512920007061689" onmouseenter="enter('8423512920007061689');" onmouseout="out('8423512920007061689');" style=""> 203             if (null != scanner) {                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 204                 try {                                                                                    </span>
<span class="-8777054502423170477" onmouseenter="enter('-8777054502423170477');" onmouseout="out('-8777054502423170477');" style=""> 205                     scanner.close();                                                                     </span>
<span class="-5126831610509859200" onmouseenter="enter('-5126831610509859200');" onmouseout="out('-5126831610509859200');" style=""> 206                 } catch (KuduException e) {                                                              </span>
<span class="6470662301361356472" onmouseenter="enter('6470662301361356472');" onmouseout="out('6470662301361356472');" style=""> 207                     LOG.error(&quot;Error while closing scanner.&quot;, e);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210         }                                                                                                </span>
<span  style=""> 211                                                                                                          </span>
<span  style=""> 212                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213     }                                                                                                    </span>
<span  style=""> 214                                                                                                          </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 215     private String buildKey(List&lt;Object&gt; equalValList) {                                                 </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 216         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 217         for (Object equalVal : equalValList) {                                                           </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 218             sb.append(equalVal).append(&quot;_&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219         }                                                                                                </span>
<span  style=""> 220                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 221         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222     }                                                                                                    </span>
<span  style=""> 223                                                                                                          </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 224     private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                      </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 225         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 226         for (String equalField : equalFieldList) {                                                       </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 227             sb.append(val.get(equalField)).append(&quot;_&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 229         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230     }                                                                                                    </span>
<span  style=""> 231                                                                                                          </span>
<span class="-1110060986504237489" onmouseenter="enter('-1110060986504237489');" onmouseout="out('-1110060986504237489');" style=""> 232     private KuduScanner getConn(KuduSideTableInfo tableInfo) {                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 233         try {                                                                                            </span>
<span class="5852398308261929617" onmouseenter="enter('5852398308261929617');" onmouseout="out('5852398308261929617');" style=""> 234             if (client == null) {                                                                        </span>
<span class="6663968999840548385" onmouseenter="enter('6663968999840548385');" onmouseout="out('6663968999840548385');" style=""> 235                 String kuduMasters = tableInfo.getKuduMasters();                                         </span>
<span class="-557099550710151869" onmouseenter="enter('-557099550710151869');" onmouseout="out('-557099550710151869');" style=""> 236                 String tableName = tableInfo.getTableName();                                             </span>
<span class="9112523977520204345" onmouseenter="enter('9112523977520204345');" onmouseout="out('9112523977520204345');" style=""> 237                 Integer workerCount = tableInfo.getWorkerCount();                                        </span>
<span class="6969473062611895" onmouseenter="enter('6969473062611895');" onmouseout="out('6969473062611895');" style=""> 238                 Integer defaultSocketReadTimeoutMs = tableInfo.getDefaultSocketReadTimeoutMs();          </span>
<span class="-1083775279901428778" onmouseenter="enter('-1083775279901428778');" onmouseout="out('-1083775279901428778');" style=""> 239                 Integer defaultOperationTimeoutMs = tableInfo.getDefaultOperationTimeoutMs();            </span>
<span  style=""> 240                                                                                                          </span>
<span class="-6052455991030570635" onmouseenter="enter('-6052455991030570635');" onmouseout="out('-6052455991030570635');" style=""> 241                 Preconditions.checkNotNull(kuduMasters, &quot;kuduMasters could not be null&quot;);                </span>
<span  style=""> 242                                                                                                          </span>
<span class="6323058657488852255" onmouseenter="enter('6323058657488852255');" onmouseout="out('6323058657488852255');" style=""><abbr title=" 243                 KuduClient.KuduClientBuilder kuduClientBuilder = new KuduClient.KuduClientBuilder(kuduMasters);"> 243                 KuduClient.KuduClientBuilder kuduClientBuilder = new KuduClient.KuduClientBuilder(kuduMas🔵</abbr></span>
<span class="-8227759523178082238" onmouseenter="enter('-8227759523178082238');" onmouseout="out('-8227759523178082238');" style=""> 244                 if (null != workerCount) {                                                               </span>
<span class="7330416389256434067" onmouseenter="enter('7330416389256434067');" onmouseout="out('7330416389256434067');" style=""> 245                     kuduClientBuilder.workerCount(workerCount);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246                 }                                                                                        </span>
<span  style=""> 247                                                                                                          </span>
<span class="-2397215110746175709" onmouseenter="enter('-2397215110746175709');" onmouseout="out('-2397215110746175709');" style=""> 248                 if (null != defaultOperationTimeoutMs) {                                                 </span>
<span class="2898164840518299373" onmouseenter="enter('2898164840518299373');" onmouseout="out('2898164840518299373');" style=""> 249                     kuduClientBuilder.defaultOperationTimeoutMs(defaultOperationTimeoutMs);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250                 }                                                                                        </span>
<span class="4908267423182375675" onmouseenter="enter('4908267423182375675');" onmouseout="out('4908267423182375675');" style=""> 251                 client = kuduClientBuilder.build();                                                      </span>
<span  style=""> 252                                                                                                          </span>
<span class="5439625390486835368" onmouseenter="enter('5439625390486835368');" onmouseout="out('5439625390486835368');" style=""> 253                 if (!client.tableExists(tableName)) {                                                    </span>
<span class="4123299035781055923" onmouseenter="enter('4123299035781055923');" onmouseout="out('4123299035781055923');" style=""> 254                     throw new IllegalArgumentException(&quot;Table Open Failed , please check table exists&quot;); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255                 }                                                                                        </span>
<span class="-2001660784391926307" onmouseenter="enter('-2001660784391926307');" onmouseout="out('-2001660784391926307');" style=""> 256                 table = client.openTable(tableName);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257             }                                                                                            </span>
<span class="6789989036272871448" onmouseenter="enter('6789989036272871448');" onmouseout="out('6789989036272871448');" style=""> 258             Schema schema = table.getSchema();                                                           </span>
<span class="4608914853005352034" onmouseenter="enter('4608914853005352034');" onmouseout="out('4608914853005352034');" style=""> 259             KuduScanner.KuduScannerBuilder tokenBuilder = client.newScannerBuilder(table);               </span>
<span class="-4750737985114959418" onmouseenter="enter('-4750737985114959418');" onmouseout="out('-4750737985114959418');" style=""> 260             return buildScanner(tokenBuilder, schema, tableInfo);                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 261         } catch (Exception e) {                                                                          </span>
<span class="-2537427276397986072" onmouseenter="enter('-2537427276397986072');" onmouseout="out('-2537427276397986072');" style=""> 262             LOG.error(&quot;connect kudu is error:&quot; + e.getMessage());                                        </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 263             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265     }                                                                                                    </span>
<span  style=""> 266                                                                                                          </span>
<span  style=""> 267                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 268     /**                                                                                                  </span>
<span class="-1458033306623281405" onmouseenter="enter('-1458033306623281405');" onmouseout="out('-1458033306623281405');" style=""> 269      * @param builder   创建AsyncKuduScanner对象                                                             </span>
<span class="2461494225329490181" onmouseenter="enter('2461494225329490181');" onmouseout="out('2461494225329490181');" style=""> 270      * @param schema    kudu中表约束                                                                         </span>
<span class="-2064584549205697250" onmouseenter="enter('-2064584549205697250');" onmouseout="out('-2064584549205697250');" style=""> 271      * @param tableInfo AsyncKuduScanner的配置信息                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 272      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 273      */                                                                                                  </span>
<span class="2867837401631125856" onmouseenter="enter('2867837401631125856');" onmouseout="out('2867837401631125856');" style=""><abbr title=" 274     private KuduScanner buildScanner(KuduScanner.KuduScannerBuilder builder, Schema schema, KuduSideTableInfo tableInfo) {"> 274     private KuduScanner buildScanner(KuduScanner.KuduScannerBuilder builder, Schema schema, KuduSideTable🔵</abbr></span>
<span class="8886111092133146967" onmouseenter="enter('8886111092133146967');" onmouseout="out('8886111092133146967');" style=""> 275         Integer batchSizeBytes = tableInfo.getBatchSizeBytes();                                          </span>
<span class="7808553397779189452" onmouseenter="enter('7808553397779189452');" onmouseout="out('7808553397779189452');" style=""> 276         Long limitNum = tableInfo.getLimitNum();                                                         </span>
<span class="-3208642476437503495" onmouseenter="enter('-3208642476437503495');" onmouseout="out('-3208642476437503495');" style=""> 277         Boolean isFaultTolerant = tableInfo.getFaultTolerant();                                          </span>
<span class="-8526639943056837274" onmouseenter="enter('-8526639943056837274');" onmouseout="out('-8526639943056837274');" style=""> 278         //查询需要的字段                                                                                        </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 279         String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                </span>
<span class="8148679338456729713" onmouseenter="enter('8148679338456729713');" onmouseout="out('8148679338456729713');" style=""> 280         //主键过滤条件 主键最小值                                                                                   </span>
<span class="774304746758482808" onmouseenter="enter('774304746758482808');" onmouseout="out('774304746758482808');" style=""> 281         String lowerBoundPrimaryKey = tableInfo.getLowerBoundPrimaryKey();                               </span>
<span class="-4956716841620057294" onmouseenter="enter('-4956716841620057294');" onmouseout="out('-4956716841620057294');" style=""> 282         //主键过滤条件 主键最大值                                                                                   </span>
<span class="-7517771237746601096" onmouseenter="enter('-7517771237746601096');" onmouseout="out('-7517771237746601096');" style=""> 283         String upperBoundPrimaryKey = tableInfo.getUpperBoundPrimaryKey();                               </span>
<span class="-3636378559400202691" onmouseenter="enter('-3636378559400202691');" onmouseout="out('-3636378559400202691');" style=""> 284         //主键字段                                                                                           </span>
<span class="5200352787312582461" onmouseenter="enter('5200352787312582461');" onmouseout="out('5200352787312582461');" style=""> 285         String primaryKeys = tableInfo.getPrimaryKey();                                                  </span>
<span class="-8080913465496496419" onmouseenter="enter('-8080913465496496419');" onmouseout="out('-8080913465496496419');" style=""> 286         if (null == limitNum || limitNum &lt;= 0) {                                                         </span>
<span class="-4868625127437582675" onmouseenter="enter('-4868625127437582675');" onmouseout="out('-4868625127437582675');" style=""> 287             builder.limit(FETCH_SIZE);                                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 288         } else {                                                                                         </span>
<span class="4444562149069843980" onmouseenter="enter('4444562149069843980');" onmouseout="out('4444562149069843980');" style=""> 289             builder.limit(limitNum);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290         }                                                                                                </span>
<span class="-5740110908714073879" onmouseenter="enter('-5740110908714073879');" onmouseout="out('-5740110908714073879');" style=""> 291         if (null != batchSizeBytes) {                                                                    </span>
<span class="732524166722318272" onmouseenter="enter('732524166722318272');" onmouseout="out('732524166722318272');" style=""> 292             builder.batchSizeBytes(batchSizeBytes);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293         }                                                                                                </span>
<span class="-8680730272034558637" onmouseenter="enter('-8680730272034558637');" onmouseout="out('-8680730272034558637');" style=""> 294         if (null != isFaultTolerant) {                                                                   </span>
<span class="-2751626226784684126" onmouseenter="enter('-2751626226784684126');" onmouseout="out('-2751626226784684126');" style=""> 295             builder.setFaultTolerant(isFaultTolerant);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296         }                                                                                                </span>
<span class="-5863912479223093982" onmouseenter="enter('-5863912479223093982');" onmouseout="out('-5863912479223093982');" style=""> 297         //  填充谓词信息                                                                                       </span>
<span class="-8839623202504591157" onmouseenter="enter('-8839623202504591157');" onmouseout="out('-8839623202504591157');" style=""> 298         List&lt;PredicateInfo&gt; predicateInfoes = sideInfo.getSideTableInfo().getPredicateInfoes();          </span>
<span class="1131384255148676390" onmouseenter="enter('1131384255148676390');" onmouseout="out('1131384255148676390');" style=""> 299         if (predicateInfoes.size() &gt; 0) {                                                                </span>
<span class="7087000648291367893" onmouseenter="enter('7087000648291367893');" onmouseout="out('7087000648291367893');" style=""> 300             predicateInfoes.stream().map(info -&gt; {                                                       </span>
<span class="-3754680470381432050" onmouseenter="enter('-3754680470381432050');" onmouseout="out('-3754680470381432050');" style=""> 301                 KuduPredicate kuduPredicate = KuduUtil.buildKuduPredicate(schema, info);                 </span>
<span class="8493928812165156395" onmouseenter="enter('8493928812165156395');" onmouseout="out('8493928812165156395');" style=""> 302                 if (null != kuduPredicate) {                                                             </span>
<span class="-7750601395793408087" onmouseenter="enter('-7750601395793408087');" onmouseout="out('-7750601395793408087');" style=""> 303                     builder.addPredicate(kuduPredicate);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304                 }                                                                                        </span>
<span class="-3556780733195614200" onmouseenter="enter('-3556780733195614200');" onmouseout="out('-3556780733195614200');" style=""> 305                 return info;                                                                             </span>
<span class="3075434854107094892" onmouseenter="enter('3075434854107094892');" onmouseout="out('3075434854107094892');" style=""> 306             }).count();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307         }                                                                                                </span>
<span  style=""> 308                                                                                                          </span>
<span class="5058160594792466993" onmouseenter="enter('5058160594792466993');" onmouseout="out('5058160594792466993');" style=""> 309         if (null != lowerBoundPrimaryKey &amp;&amp; null != upperBoundPrimaryKey &amp;&amp; null != primaryKeys) {       </span>
<span class="5137789214991290203" onmouseenter="enter('5137789214991290203');" onmouseout="out('5137789214991290203');" style=""> 310             List&lt;ColumnSchema&gt; columnSchemas = schema.getPrimaryKeyColumns();                            </span>
<span class="-9153585758974253186" onmouseenter="enter('-9153585758974253186');" onmouseout="out('-9153585758974253186');" style=""> 311             Map&lt;String, Integer&gt; columnName = new HashMap&lt;String, Integer&gt;(columnSchemas.size());        </span>
<span class="-8501863997026521914" onmouseenter="enter('-8501863997026521914');" onmouseout="out('-8501863997026521914');" style=""> 312             for (int i = 0; i &lt; columnSchemas.size(); i++) {                                             </span>
<span class="5688298920213282235" onmouseenter="enter('5688298920213282235');" onmouseout="out('5688298920213282235');" style=""> 313                 columnName.put(columnSchemas.get(i).getName(), i);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314             }                                                                                            </span>
<span class="9190792110333311829" onmouseenter="enter('9190792110333311829');" onmouseout="out('9190792110333311829');" style=""> 315             String[] primaryKey = splitString(primaryKeys);                                              </span>
<span class="8892393707780373743" onmouseenter="enter('8892393707780373743');" onmouseout="out('8892393707780373743');" style=""> 316             String[] lowerBounds = splitString(lowerBoundPrimaryKey);                                    </span>
<span class="-609605915884017391" onmouseenter="enter('-609605915884017391');" onmouseout="out('-609605915884017391');" style=""> 317             String[] upperBounds = splitString(upperBoundPrimaryKey);                                    </span>
<span class="4494391771595015869" onmouseenter="enter('4494391771595015869');" onmouseout="out('4494391771595015869');" style=""> 318             PartialRow lowerPartialRow = schema.newPartialRow();                                         </span>
<span class="8816033343726193199" onmouseenter="enter('8816033343726193199');" onmouseout="out('8816033343726193199');" style=""> 319             PartialRow upperPartialRow = schema.newPartialRow();                                         </span>
<span class="-8968328790125117730" onmouseenter="enter('-8968328790125117730');" onmouseout="out('-8968328790125117730');" style=""> 320             for (int i = 0; i &lt; primaryKey.length; i++) {                                                </span>
<span class="-7469830342865795482" onmouseenter="enter('-7469830342865795482');" onmouseout="out('-7469830342865795482');" style=""> 321                 Integer index = columnName.get(primaryKey[i]);                                           </span>
<span class="9077186300921558226" onmouseenter="enter('9077186300921558226');" onmouseout="out('9077186300921558226');" style=""><abbr title=" 322                 KuduUtil.primaryKeyRange(lowerPartialRow, columnSchemas.get(index).getType(), primaryKey[i], lowerBounds[i]);"> 322                 KuduUtil.primaryKeyRange(lowerPartialRow, columnSchemas.get(index).getType(), primaryKey[🔵</abbr></span>
<span class="1719939722143080272" onmouseenter="enter('1719939722143080272');" onmouseout="out('1719939722143080272');" style=""><abbr title=" 323                 KuduUtil.primaryKeyRange(upperPartialRow, columnSchemas.get(index).getType(), primaryKey[i], upperBounds[i]);"> 323                 KuduUtil.primaryKeyRange(upperPartialRow, columnSchemas.get(index).getType(), primaryKey[🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324             }                                                                                            </span>
<span class="-4326832194787526924" onmouseenter="enter('-4326832194787526924');" onmouseout="out('-4326832194787526924');" style=""> 325             builder.lowerBound(lowerPartialRow);                                                         </span>
<span class="-1145836739913025748" onmouseenter="enter('-1145836739913025748');" onmouseout="out('-1145836739913025748');" style=""> 326             builder.exclusiveUpperBound(upperPartialRow);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327         }                                                                                                </span>
<span class="6330664272177173056" onmouseenter="enter('6330664272177173056');" onmouseout="out('6330664272177173056');" style=""> 328         List&lt;String&gt; projectColumns = Arrays.asList(sideFieldNames);                                     </span>
<span class="5674897199079825382" onmouseenter="enter('5674897199079825382');" onmouseout="out('5674897199079825382');" style=""> 329         return builder.setProjectedColumnNames(projectColumns).build();                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330     }                                                                                                    </span>
<span  style=""> 331                                                                                                          </span>
<span class="7272585370217888157" onmouseenter="enter('7272585370217888157');" onmouseout="out('7272585370217888157');" style=""> 332     private String[] splitString(String data) {                                                          </span>
<span class="6835810800556100983" onmouseenter="enter('6835810800556100983');" onmouseout="out('6835810800556100983');" style=""> 333         return StringUtils.split(data, &quot;,&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334     }                                                                                                    </span>
<span  style=""> 335                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 336     @Override                                                                                            </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 337     public void close() throws Exception {                                                               </span>
<span class="-8885801519389600338" onmouseenter="enter('-8885801519389600338');" onmouseout="out('-8885801519389600338');" style=""> 338         //公用一个client  如果每次刷新间隔时间较长可以每次获取一个                                                               </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 339         super.close();                                                                                   </span>
<span class="5794975028458899729" onmouseenter="enter('5794975028458899729');" onmouseout="out('5794975028458899729');" style=""> 340         if (null != client) {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 341             try {                                                                                        </span>
<span class="2670944726041732440" onmouseenter="enter('2670944726041732440');" onmouseout="out('2670944726041732440');" style=""> 342                 client.close();                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 343             } catch (Exception e) {                                                                      </span>
<span class="7169708839653618971" onmouseenter="enter('7169708839653618971');" onmouseout="out('7169708839653618971');" style=""> 344                 LOG.error(&quot;Error while closing client.&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 346         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348 }                                                                                                        </span></pre></td>
                            <td><pre><span class="-8840953368027741170" onmouseenter="enter('-8840953368027741170');" onmouseout="out('-8840953368027741170');" style="">   1 package com.dtstack.flink.sql.side.kudu;                                                                 </span>
<span  style="">   2                                                                                                          </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">   3 import com.dtstack.flink.sql.side.BaseAllReqRow;                                                         </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">   4 import com.dtstack.flink.sql.side.FieldInfo;                                                             </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">   5 import com.dtstack.flink.sql.side.JoinInfo;                                                              </span>
<span class="1614892075588798997" onmouseenter="enter('1614892075588798997');" onmouseout="out('1614892075588798997');" style="">   6 import com.dtstack.flink.sql.side.PredicateInfo;                                                         </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">   7 import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                 </span>
<span class="5710642889135375263" onmouseenter="enter('5710642889135375263');" onmouseout="out('5710642889135375263');" style="">   8 import com.dtstack.flink.sql.side.kudu.table.KuduSideTableInfo;                                          </span>
<span class="1164335795537447661" onmouseenter="enter('1164335795537447661');" onmouseout="out('1164335795537447661');" style="">   9 import com.dtstack.flink.sql.side.kudu.utils.KuduUtil;                                                   </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="">  10 import com.dtstack.flink.sql.util.RowDataComplete;                                                       </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  11 import com.google.common.base.Preconditions;                                                             </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  12 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  13 import com.google.common.collect.Maps;                                                                   </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  14 import org.apache.calcite.sql.JoinType;                                                                  </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  15 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  16 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  17 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  18 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  19 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  20 import org.apache.flink.types.Row;                                                                       </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  21 import org.apache.flink.util.Collector;                                                                  </span>
<span class="1631232015531818624" onmouseenter="enter('1631232015531818624');" onmouseout="out('1631232015531818624');" style="">  22 import org.apache.kudu.ColumnSchema;                                                                     </span>
<span class="-1755042893780385624" onmouseenter="enter('-1755042893780385624');" onmouseout="out('-1755042893780385624');" style="">  23 import org.apache.kudu.Schema;                                                                           </span>
<span class="2263873766708549976" onmouseenter="enter('2263873766708549976');" onmouseout="out('2263873766708549976');" style="">  24 import org.apache.kudu.client.KuduClient;                                                                </span>
<span class="1860194643195428903" onmouseenter="enter('1860194643195428903');" onmouseout="out('1860194643195428903');" style="">  25 import org.apache.kudu.client.KuduException;                                                             </span>
<span class="128288131530978478" onmouseenter="enter('128288131530978478');" onmouseout="out('128288131530978478');" style="">  26 import org.apache.kudu.client.KuduPredicate;                                                             </span>
<span class="-8538417097591974568" onmouseenter="enter('-8538417097591974568');" onmouseout="out('-8538417097591974568');" style="">  27 import org.apache.kudu.client.KuduScanner;                                                               </span>
<span class="-342692776902705676" onmouseenter="enter('-342692776902705676');" onmouseout="out('-342692776902705676');" style="">  28 import org.apache.kudu.client.KuduTable;                                                                 </span>
<span class="629701943397612117" onmouseenter="enter('629701943397612117');" onmouseout="out('629701943397612117');" style="">  29 import org.apache.kudu.client.PartialRow;                                                                </span>
<span class="-6157621177665621032" onmouseenter="enter('-6157621177665621032');" onmouseout="out('-6157621177665621032');" style="">  30 import org.apache.kudu.client.RowResult;                                                                 </span>
<span class="-1845673204769190809" onmouseenter="enter('-1845673204769190809');" onmouseout="out('-1845673204769190809');" style="">  31 import org.apache.kudu.client.RowResultIterator;                                                         </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  32 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  33 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  34                                                                                                          </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  35 import java.sql.SQLException;                                                                            </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  36 import java.util.Arrays;                                                                                 </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  37 import java.util.Calendar;                                                                               </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  38 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  39 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  40 import java.util.Map;                                                                                    </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  41 import java.util.concurrent.atomic.AtomicReference;                                                      </span>
<span  style="">  42                                                                                                          </span>
<span class="1178418458023894230" onmouseenter="enter('1178418458023894230');" onmouseout="out('1178418458023894230');" style="">  43 public class KuduAllReqRow extends BaseAllReqRow {                                                       </span>
<span  style="">  44                                                                                                          </span>
<span class="2664279006928748303" onmouseenter="enter('2664279006928748303');" onmouseout="out('2664279006928748303');" style="">  45     private static final long serialVersionUID = 6051774809356082219L;                                   </span>
<span  style="">  46                                                                                                          </span>
<span class="-7779246735798526406" onmouseenter="enter('-7779246735798526406');" onmouseout="out('-7779246735798526406');" style="">  47     private static final Logger LOG = LoggerFactory.getLogger(KuduAllReqRow.class);                      </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  48     /**                                                                                                  </span>
<span class="-8285284077529796986" onmouseenter="enter('-8285284077529796986');" onmouseout="out('-8285284077529796986');" style="">  49      * 获取连接的尝试次数                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  50      */                                                                                                  </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  51     private static final int CONN_RETRY_NUM = 3;                                                         </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  52     /**                                                                                                  </span>
<span class="4062789252244833512" onmouseenter="enter('4062789252244833512');" onmouseout="out('4062789252244833512');" style="">  53      * 缓存条数                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  54      */                                                                                                  </span>
<span class="1004470848600586149" onmouseenter="enter('1004470848600586149');" onmouseout="out('1004470848600586149');" style="">  55     private static final Long FETCH_SIZE = 1000L;                                                        </span>
<span  style="">  56                                                                                                          </span>
<span class="-2539961354521398263" onmouseenter="enter('-2539961354521398263');" onmouseout="out('-2539961354521398263');" style="">  57     private KuduClient client;                                                                           </span>
<span  style="">  58                                                                                                          </span>
<span class="1317689277640300307" onmouseenter="enter('1317689277640300307');" onmouseout="out('1317689277640300307');" style="">  59     private KuduTable table;                                                                             </span>
<span  style="">  60                                                                                                          </span>
<span  style="">  61                                                                                                          </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  62     private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();  </span>
<span  style="">  63                                                                                                          </span>
<span class="6616997293382437533" onmouseenter="enter('6616997293382437533');" onmouseout="out('6616997293382437533');" style=""><abbr title="  64     public KuduAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  64     public KuduAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, Ab🔵</abbr></span>
<span class="8698115236286713015" onmouseenter="enter('8698115236286713015');" onmouseout="out('8698115236286713015');" style="">  65         super(new KuduAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  66     }                                                                                                    </span>
<span  style="">  67                                                                                                          </span>
<span  style="">  68                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  69     @Override                                                                                            </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="">  70     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="">  71         Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                 </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="">  72         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="">  73         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="">  74             Object obj = input.getField(entry.getValue());                                               </span>
<span class="7598536375028459133" onmouseenter="enter('7598536375028459133');" onmouseout="out('7598536375028459133');" style="">  75 &lt;&lt;&lt;&lt;&lt;&lt;&lt; MINE                                                                                             </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="background-color: rgba(255, 167, 0, 0.24); margin: 0">  76             obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                    </span>
<span class="7991106586064342212" onmouseenter="enter('7991106586064342212');" onmouseout="out('7991106586064342212');" style="">  77 ||||||| BASE                                                                                             </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  78             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());">  78             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  79                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0"><abbr title="  80             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long.">  80             //Type information for indicating event or processing time. However, it behaves like a regula🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  81             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  82                 obj = ((Timestamp) obj).getTime();                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  83             }                                                                                            </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  84             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 0, 0.15); margin: 0">  85         }                                                                                                </span>
<span class="3796057323931724632" onmouseenter="enter('3796057323931724632');" onmouseout="out('3796057323931724632');" style="">  86 =======                                                                                                  </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  87             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());">  87             boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRo🔵</abbr></span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  88                                                                                                          </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  89             //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long.">  89             //Type information for indicating event or processing time. However, it behaves like a regula🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  90             if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                   </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  91                 //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                            </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0"><abbr title="  92                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());">  92                 obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime())🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  93             }                                                                                            </span>
<span  style="background-color: rgba(0, 0, 255, 0.24); margin: 0">  94                                                                                                          </span>
<span class="-5027112130205478640" onmouseenter="enter('-5027112130205478640');" onmouseout="out('-5027112130205478640');" style="">  95 &gt;&gt;&gt;&gt;&gt;&gt;&gt; YOURS                                                                                            </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="">  96             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97         }                                                                                                </span>
<span  style="">  98                                                                                                          </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="">  99         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style=""> 100             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style=""> 101                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 102             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style=""> 103                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 105         }                                                                                                </span>
<span  style=""> 106                                                                                                          </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style=""> 107         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 108     }                                                                                                    </span>
<span  style=""> 109                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 110     @Override                                                                                            </span>
<span class="-5452513235343270061" onmouseenter="enter('-5452513235343270061');" onmouseout="out('-5452513235343270061');" style=""> 111     protected void initCache() throws SQLException {                                                     </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 112         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 113         cacheRef.set(newCache);                                                                          </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 114         loadData(newCache);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115     }                                                                                                    </span>
<span  style=""> 116                                                                                                          </span>
<span  style=""> 117                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 118     @Override                                                                                            </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 119     protected void reloadCache() {                                                                       </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 120         //reload cacheRef and replace to old cacheRef                                                    </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 121         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 122         loadData(newCache);                                                                              </span>
<span  style=""> 123                                                                                                          </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 124         cacheRef.set(newCache);                                                                          </span>
<span class="-5375691814117803209" onmouseenter="enter('-5375691814117803209');" onmouseout="out('-5375691814117803209');" style=""> 125         LOG.info(&quot;----- kudu all cacheRef reload end:{}&quot;, Calendar.getInstance());                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126     }                                                                                                    </span>
<span  style=""> 127                                                                                                          </span>
<span  style=""> 128                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 129     @Override                                                                                            </span>
<span class="6843933761729718422" onmouseenter="enter('6843933761729718422');" onmouseout="out('6843933761729718422');" style=""> 130     public void flatMap(Row input, Collector&lt;BaseRow&gt; out) throws Exception {                            </span>
<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style=""> 131         List&lt;Object&gt; inputParams = Lists.newArrayList();                                                 </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style=""> 132         for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                        </span>
<span class="7582033886787525124" onmouseenter="enter('7582033886787525124');" onmouseout="out('7582033886787525124');" style=""> 133             Object equalObj = input.getField(conValIndex);                                               </span>
<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style=""> 134             if (equalObj == null) {                                                                      </span>
<span class="2802501092059214558" onmouseenter="enter('2802501092059214558');" onmouseout="out('2802501092059214558');" style=""> 135                 out.collect(null);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 136             }                                                                                            </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style=""> 137             inputParams.add(equalObj);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 138         }                                                                                                </span>
<span  style=""> 139                                                                                                          </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style=""> 140         String key = buildKey(inputParams);                                                              </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style=""> 141         List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                   </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style=""> 142         if (CollectionUtils.isEmpty(cacheList)) {                                                        </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style=""> 143             if (sideInfo.getJoinType() == JoinType.LEFT) {                                               </span>
<span class="-3752240759126097062" onmouseenter="enter('-3752240759126097062');" onmouseout="out('-3752240759126097062');" style=""> 144                 Row row = fillData(input, null);                                                         </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 145                 RowDataComplete.collectRow(out, row);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 146             }                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 147             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148         }                                                                                                </span>
<span  style=""> 149                                                                                                          </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style=""> 150         for (Map&lt;String, Object&gt; one : cacheList) {                                                      </span>
<span class="-6006003971782103198" onmouseenter="enter('-6006003971782103198');" onmouseout="out('-6006003971782103198');" style=""> 151             Row row = fillData(input, one);                                                              </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 152             RowDataComplete.collectRow(out, row);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 153         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 154     }                                                                                                    </span>
<span  style=""> 155                                                                                                          </span>
<span class="961081247603323125" onmouseenter="enter('961081247603323125');" onmouseout="out('961081247603323125');" style=""> 156     private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {                             </span>
<span class="-5525344973390349168" onmouseenter="enter('-5525344973390349168');" onmouseout="out('-5525344973390349168');" style=""> 157         KuduSideTableInfo tableInfo = (KuduSideTableInfo) sideInfo.getSideTableInfo();                   </span>
<span class="4539652565484830811" onmouseenter="enter('4539652565484830811');" onmouseout="out('4539652565484830811');" style=""> 158         KuduScanner scanner = null;                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 159         try {                                                                                            </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 160             for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 161                 try {                                                                                    </span>
<span class="3825928320653477879" onmouseenter="enter('3825928320653477879');" onmouseout="out('3825928320653477879');" style=""> 162                     scanner = getConn(tableInfo);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 163                     break;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 164                 } catch (Exception e) {                                                                  </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 165                     if (i == CONN_RETRY_NUM - 1) {                                                       </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 166                         throw new RuntimeException(&quot;&quot;, e);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 167                     }                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 168                     try {                                                                                </span>
<span class="7214047305831580892" onmouseenter="enter('7214047305831580892');" onmouseout="out('7214047305831580892');" style=""><abbr title=" 169                         String connInfo = &quot;kuduMasters:&quot; + tableInfo.getKuduMasters() + &quot;;tableName:&quot; + tableInfo.getTableName();"> 169                         String connInfo = &quot;kuduMasters:&quot; + tableInfo.getKuduMasters() + &quot;;tableName:&quot; + t🔵</abbr></span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 170                         LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);   </span>
<span class="-9127531774365832010" onmouseenter="enter('-9127531774365832010');" onmouseout="out('-9127531774365832010');" style=""> 171                         Thread.sleep(5 * 1000);                                                          </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 172                     } catch (InterruptedException e1) {                                                  </span>
<span class="4631440746187069452" onmouseenter="enter('4631440746187069452');" onmouseout="out('4631440746187069452');" style=""> 173                         LOG.error(&quot;&quot;,e1);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 174                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 175                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 176             }                                                                                            </span>
<span class="475138084615438717" onmouseenter="enter('475138084615438717');" onmouseout="out('475138084615438717');" style=""> 177             //load data from table                                                                       </span>
<span class="3354690258641098597" onmouseenter="enter('3354690258641098597');" onmouseout="out('3354690258641098597');" style=""> 178             assert scanner != null;                                                                      </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 179             String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);            </span>
<span  style=""> 180                                                                                                          </span>
<span  style=""> 181                                                                                                          </span>
<span class="-7401034569209000676" onmouseenter="enter('-7401034569209000676');" onmouseout="out('-7401034569209000676');" style=""> 182             while (scanner.hasMoreRows()) {                                                              </span>
<span class="-490557585705256586" onmouseenter="enter('-490557585705256586');" onmouseout="out('-490557585705256586');" style=""> 183                 RowResultIterator results = scanner.nextRows();                                          </span>
<span class="5642997248258560969" onmouseenter="enter('5642997248258560969');" onmouseout="out('5642997248258560969');" style=""> 184                 while (results.hasNext()) {                                                              </span>
<span class="7206031536241251649" onmouseenter="enter('7206031536241251649');" onmouseout="out('7206031536241251649');" style=""> 185                     RowResult result = results.next();                                                   </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 186                     Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                      </span>
<span class="696829081573399723" onmouseenter="enter('696829081573399723');" onmouseout="out('696829081573399723');" style=""> 187                     for (String sideFieldName1 : sideFieldNames) {                                       </span>
<span class="5422300911827801712" onmouseenter="enter('5422300911827801712');" onmouseout="out('5422300911827801712');" style=""> 188                         String sideFieldName = sideFieldName1.trim();                                    </span>
<span class="-7396994512053753949" onmouseenter="enter('-7396994512053753949');" onmouseout="out('-7396994512053753949');" style=""> 189                         ColumnSchema columnSchema = table.getSchema().getColumn(sideFieldName);          </span>
<span class="-1551001954350423389" onmouseenter="enter('-1551001954350423389');" onmouseout="out('-1551001954350423389');" style=""> 190                         if (null != columnSchema) {                                                      </span>
<span class="-9080618923968214410" onmouseenter="enter('-9080618923968214410');" onmouseout="out('-9080618923968214410');" style=""> 191                             KuduUtil.setMapValue(columnSchema.getType(), oneRow, sideFieldName, result); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 193                     }                                                                                    </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 194                     String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                    </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""><abbr title=" 195                     List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList());"> 195                     List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newA🔵</abbr></span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 196                     list.add(oneRow);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198             }                                                                                            </span>
<span  style=""> 199                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 200         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 201             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 202         } finally {                                                                                      </span>
<span class="8423512920007061689" onmouseenter="enter('8423512920007061689');" onmouseout="out('8423512920007061689');" style=""> 203             if (null != scanner) {                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 204                 try {                                                                                    </span>
<span class="-8777054502423170477" onmouseenter="enter('-8777054502423170477');" onmouseout="out('-8777054502423170477');" style=""> 205                     scanner.close();                                                                     </span>
<span class="-5126831610509859200" onmouseenter="enter('-5126831610509859200');" onmouseout="out('-5126831610509859200');" style=""> 206                 } catch (KuduException e) {                                                              </span>
<span class="6470662301361356472" onmouseenter="enter('6470662301361356472');" onmouseout="out('6470662301361356472');" style=""> 207                     LOG.error(&quot;Error while closing scanner.&quot;, e);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 208                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 209             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210         }                                                                                                </span>
<span  style=""> 211                                                                                                          </span>
<span  style=""> 212                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213     }                                                                                                    </span>
<span  style=""> 214                                                                                                          </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 215     private String buildKey(List&lt;Object&gt; equalValList) {                                                 </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 216         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 217         for (Object equalVal : equalValList) {                                                           </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 218             sb.append(equalVal).append(&quot;_&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219         }                                                                                                </span>
<span  style=""> 220                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 221         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222     }                                                                                                    </span>
<span  style=""> 223                                                                                                          </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 224     private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                      </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 225         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 226         for (String equalField : equalFieldList) {                                                       </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 227             sb.append(val.get(equalField)).append(&quot;_&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 229         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230     }                                                                                                    </span>
<span  style=""> 231                                                                                                          </span>
<span class="-1110060986504237489" onmouseenter="enter('-1110060986504237489');" onmouseout="out('-1110060986504237489');" style=""> 232     private KuduScanner getConn(KuduSideTableInfo tableInfo) {                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 233         try {                                                                                            </span>
<span class="5852398308261929617" onmouseenter="enter('5852398308261929617');" onmouseout="out('5852398308261929617');" style=""> 234             if (client == null) {                                                                        </span>
<span class="6663968999840548385" onmouseenter="enter('6663968999840548385');" onmouseout="out('6663968999840548385');" style=""> 235                 String kuduMasters = tableInfo.getKuduMasters();                                         </span>
<span class="-557099550710151869" onmouseenter="enter('-557099550710151869');" onmouseout="out('-557099550710151869');" style=""> 236                 String tableName = tableInfo.getTableName();                                             </span>
<span class="9112523977520204345" onmouseenter="enter('9112523977520204345');" onmouseout="out('9112523977520204345');" style=""> 237                 Integer workerCount = tableInfo.getWorkerCount();                                        </span>
<span class="6969473062611895" onmouseenter="enter('6969473062611895');" onmouseout="out('6969473062611895');" style=""> 238                 Integer defaultSocketReadTimeoutMs = tableInfo.getDefaultSocketReadTimeoutMs();          </span>
<span class="-1083775279901428778" onmouseenter="enter('-1083775279901428778');" onmouseout="out('-1083775279901428778');" style=""> 239                 Integer defaultOperationTimeoutMs = tableInfo.getDefaultOperationTimeoutMs();            </span>
<span  style=""> 240                                                                                                          </span>
<span class="-6052455991030570635" onmouseenter="enter('-6052455991030570635');" onmouseout="out('-6052455991030570635');" style=""> 241                 Preconditions.checkNotNull(kuduMasters, &quot;kuduMasters could not be null&quot;);                </span>
<span  style=""> 242                                                                                                          </span>
<span class="6323058657488852255" onmouseenter="enter('6323058657488852255');" onmouseout="out('6323058657488852255');" style=""><abbr title=" 243                 KuduClient.KuduClientBuilder kuduClientBuilder = new KuduClient.KuduClientBuilder(kuduMasters);"> 243                 KuduClient.KuduClientBuilder kuduClientBuilder = new KuduClient.KuduClientBuilder(kuduMas🔵</abbr></span>
<span class="-8227759523178082238" onmouseenter="enter('-8227759523178082238');" onmouseout="out('-8227759523178082238');" style=""> 244                 if (null != workerCount) {                                                               </span>
<span class="7330416389256434067" onmouseenter="enter('7330416389256434067');" onmouseout="out('7330416389256434067');" style=""> 245                     kuduClientBuilder.workerCount(workerCount);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 246                 }                                                                                        </span>
<span  style=""> 247                                                                                                          </span>
<span class="-2397215110746175709" onmouseenter="enter('-2397215110746175709');" onmouseout="out('-2397215110746175709');" style=""> 248                 if (null != defaultOperationTimeoutMs) {                                                 </span>
<span class="2898164840518299373" onmouseenter="enter('2898164840518299373');" onmouseout="out('2898164840518299373');" style=""> 249                     kuduClientBuilder.defaultOperationTimeoutMs(defaultOperationTimeoutMs);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 250                 }                                                                                        </span>
<span class="4908267423182375675" onmouseenter="enter('4908267423182375675');" onmouseout="out('4908267423182375675');" style=""> 251                 client = kuduClientBuilder.build();                                                      </span>
<span  style=""> 252                                                                                                          </span>
<span class="5439625390486835368" onmouseenter="enter('5439625390486835368');" onmouseout="out('5439625390486835368');" style=""> 253                 if (!client.tableExists(tableName)) {                                                    </span>
<span class="4123299035781055923" onmouseenter="enter('4123299035781055923');" onmouseout="out('4123299035781055923');" style=""> 254                     throw new IllegalArgumentException(&quot;Table Open Failed , please check table exists&quot;); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 255                 }                                                                                        </span>
<span class="-2001660784391926307" onmouseenter="enter('-2001660784391926307');" onmouseout="out('-2001660784391926307');" style=""> 256                 table = client.openTable(tableName);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 257             }                                                                                            </span>
<span class="6789989036272871448" onmouseenter="enter('6789989036272871448');" onmouseout="out('6789989036272871448');" style=""> 258             Schema schema = table.getSchema();                                                           </span>
<span class="4608914853005352034" onmouseenter="enter('4608914853005352034');" onmouseout="out('4608914853005352034');" style=""> 259             KuduScanner.KuduScannerBuilder tokenBuilder = client.newScannerBuilder(table);               </span>
<span class="-4750737985114959418" onmouseenter="enter('-4750737985114959418');" onmouseout="out('-4750737985114959418');" style=""> 260             return buildScanner(tokenBuilder, schema, tableInfo);                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 261         } catch (Exception e) {                                                                          </span>
<span class="-2537427276397986072" onmouseenter="enter('-2537427276397986072');" onmouseout="out('-2537427276397986072');" style=""> 262             LOG.error(&quot;connect kudu is error:&quot; + e.getMessage());                                        </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 263             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 264         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265     }                                                                                                    </span>
<span  style=""> 266                                                                                                          </span>
<span  style=""> 267                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 268     /**                                                                                                  </span>
<span class="-1458033306623281405" onmouseenter="enter('-1458033306623281405');" onmouseout="out('-1458033306623281405');" style=""> 269      * @param builder   创建AsyncKuduScanner对象                                                             </span>
<span class="2461494225329490181" onmouseenter="enter('2461494225329490181');" onmouseout="out('2461494225329490181');" style=""> 270      * @param schema    kudu中表约束                                                                         </span>
<span class="-2064584549205697250" onmouseenter="enter('-2064584549205697250');" onmouseout="out('-2064584549205697250');" style=""> 271      * @param tableInfo AsyncKuduScanner的配置信息                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 272      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 273      */                                                                                                  </span>
<span class="2867837401631125856" onmouseenter="enter('2867837401631125856');" onmouseout="out('2867837401631125856');" style=""><abbr title=" 274     private KuduScanner buildScanner(KuduScanner.KuduScannerBuilder builder, Schema schema, KuduSideTableInfo tableInfo) {"> 274     private KuduScanner buildScanner(KuduScanner.KuduScannerBuilder builder, Schema schema, KuduSideTable🔵</abbr></span>
<span class="8886111092133146967" onmouseenter="enter('8886111092133146967');" onmouseout="out('8886111092133146967');" style=""> 275         Integer batchSizeBytes = tableInfo.getBatchSizeBytes();                                          </span>
<span class="7808553397779189452" onmouseenter="enter('7808553397779189452');" onmouseout="out('7808553397779189452');" style=""> 276         Long limitNum = tableInfo.getLimitNum();                                                         </span>
<span class="-3208642476437503495" onmouseenter="enter('-3208642476437503495');" onmouseout="out('-3208642476437503495');" style=""> 277         Boolean isFaultTolerant = tableInfo.getFaultTolerant();                                          </span>
<span class="-8526639943056837274" onmouseenter="enter('-8526639943056837274');" onmouseout="out('-8526639943056837274');" style=""> 278         //查询需要的字段                                                                                        </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 279         String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                </span>
<span class="8148679338456729713" onmouseenter="enter('8148679338456729713');" onmouseout="out('8148679338456729713');" style=""> 280         //主键过滤条件 主键最小值                                                                                   </span>
<span class="774304746758482808" onmouseenter="enter('774304746758482808');" onmouseout="out('774304746758482808');" style=""> 281         String lowerBoundPrimaryKey = tableInfo.getLowerBoundPrimaryKey();                               </span>
<span class="-4956716841620057294" onmouseenter="enter('-4956716841620057294');" onmouseout="out('-4956716841620057294');" style=""> 282         //主键过滤条件 主键最大值                                                                                   </span>
<span class="-7517771237746601096" onmouseenter="enter('-7517771237746601096');" onmouseout="out('-7517771237746601096');" style=""> 283         String upperBoundPrimaryKey = tableInfo.getUpperBoundPrimaryKey();                               </span>
<span class="-3636378559400202691" onmouseenter="enter('-3636378559400202691');" onmouseout="out('-3636378559400202691');" style=""> 284         //主键字段                                                                                           </span>
<span class="5200352787312582461" onmouseenter="enter('5200352787312582461');" onmouseout="out('5200352787312582461');" style=""> 285         String primaryKeys = tableInfo.getPrimaryKey();                                                  </span>
<span class="-8080913465496496419" onmouseenter="enter('-8080913465496496419');" onmouseout="out('-8080913465496496419');" style=""> 286         if (null == limitNum || limitNum &lt;= 0) {                                                         </span>
<span class="-4868625127437582675" onmouseenter="enter('-4868625127437582675');" onmouseout="out('-4868625127437582675');" style=""> 287             builder.limit(FETCH_SIZE);                                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 288         } else {                                                                                         </span>
<span class="4444562149069843980" onmouseenter="enter('4444562149069843980');" onmouseout="out('4444562149069843980');" style=""> 289             builder.limit(limitNum);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290         }                                                                                                </span>
<span class="-5740110908714073879" onmouseenter="enter('-5740110908714073879');" onmouseout="out('-5740110908714073879');" style=""> 291         if (null != batchSizeBytes) {                                                                    </span>
<span class="732524166722318272" onmouseenter="enter('732524166722318272');" onmouseout="out('732524166722318272');" style=""> 292             builder.batchSizeBytes(batchSizeBytes);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 293         }                                                                                                </span>
<span class="-8680730272034558637" onmouseenter="enter('-8680730272034558637');" onmouseout="out('-8680730272034558637');" style=""> 294         if (null != isFaultTolerant) {                                                                   </span>
<span class="-2751626226784684126" onmouseenter="enter('-2751626226784684126');" onmouseout="out('-2751626226784684126');" style=""> 295             builder.setFaultTolerant(isFaultTolerant);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296         }                                                                                                </span>
<span class="-5863912479223093982" onmouseenter="enter('-5863912479223093982');" onmouseout="out('-5863912479223093982');" style=""> 297         //  填充谓词信息                                                                                       </span>
<span class="-8839623202504591157" onmouseenter="enter('-8839623202504591157');" onmouseout="out('-8839623202504591157');" style=""> 298         List&lt;PredicateInfo&gt; predicateInfoes = sideInfo.getSideTableInfo().getPredicateInfoes();          </span>
<span class="1131384255148676390" onmouseenter="enter('1131384255148676390');" onmouseout="out('1131384255148676390');" style=""> 299         if (predicateInfoes.size() &gt; 0) {                                                                </span>
<span class="7087000648291367893" onmouseenter="enter('7087000648291367893');" onmouseout="out('7087000648291367893');" style=""> 300             predicateInfoes.stream().map(info -&gt; {                                                       </span>
<span class="-3754680470381432050" onmouseenter="enter('-3754680470381432050');" onmouseout="out('-3754680470381432050');" style=""> 301                 KuduPredicate kuduPredicate = KuduUtil.buildKuduPredicate(schema, info);                 </span>
<span class="8493928812165156395" onmouseenter="enter('8493928812165156395');" onmouseout="out('8493928812165156395');" style=""> 302                 if (null != kuduPredicate) {                                                             </span>
<span class="-7750601395793408087" onmouseenter="enter('-7750601395793408087');" onmouseout="out('-7750601395793408087');" style=""> 303                     builder.addPredicate(kuduPredicate);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 304                 }                                                                                        </span>
<span class="-3556780733195614200" onmouseenter="enter('-3556780733195614200');" onmouseout="out('-3556780733195614200');" style=""> 305                 return info;                                                                             </span>
<span class="3075434854107094892" onmouseenter="enter('3075434854107094892');" onmouseout="out('3075434854107094892');" style=""> 306             }).count();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 307         }                                                                                                </span>
<span  style=""> 308                                                                                                          </span>
<span class="5058160594792466993" onmouseenter="enter('5058160594792466993');" onmouseout="out('5058160594792466993');" style=""> 309         if (null != lowerBoundPrimaryKey &amp;&amp; null != upperBoundPrimaryKey &amp;&amp; null != primaryKeys) {       </span>
<span class="5137789214991290203" onmouseenter="enter('5137789214991290203');" onmouseout="out('5137789214991290203');" style=""> 310             List&lt;ColumnSchema&gt; columnSchemas = schema.getPrimaryKeyColumns();                            </span>
<span class="-9153585758974253186" onmouseenter="enter('-9153585758974253186');" onmouseout="out('-9153585758974253186');" style=""> 311             Map&lt;String, Integer&gt; columnName = new HashMap&lt;String, Integer&gt;(columnSchemas.size());        </span>
<span class="-8501863997026521914" onmouseenter="enter('-8501863997026521914');" onmouseout="out('-8501863997026521914');" style=""> 312             for (int i = 0; i &lt; columnSchemas.size(); i++) {                                             </span>
<span class="5688298920213282235" onmouseenter="enter('5688298920213282235');" onmouseout="out('5688298920213282235');" style=""> 313                 columnName.put(columnSchemas.get(i).getName(), i);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 314             }                                                                                            </span>
<span class="9190792110333311829" onmouseenter="enter('9190792110333311829');" onmouseout="out('9190792110333311829');" style=""> 315             String[] primaryKey = splitString(primaryKeys);                                              </span>
<span class="8892393707780373743" onmouseenter="enter('8892393707780373743');" onmouseout="out('8892393707780373743');" style=""> 316             String[] lowerBounds = splitString(lowerBoundPrimaryKey);                                    </span>
<span class="-609605915884017391" onmouseenter="enter('-609605915884017391');" onmouseout="out('-609605915884017391');" style=""> 317             String[] upperBounds = splitString(upperBoundPrimaryKey);                                    </span>
<span class="4494391771595015869" onmouseenter="enter('4494391771595015869');" onmouseout="out('4494391771595015869');" style=""> 318             PartialRow lowerPartialRow = schema.newPartialRow();                                         </span>
<span class="8816033343726193199" onmouseenter="enter('8816033343726193199');" onmouseout="out('8816033343726193199');" style=""> 319             PartialRow upperPartialRow = schema.newPartialRow();                                         </span>
<span class="-8968328790125117730" onmouseenter="enter('-8968328790125117730');" onmouseout="out('-8968328790125117730');" style=""> 320             for (int i = 0; i &lt; primaryKey.length; i++) {                                                </span>
<span class="-7469830342865795482" onmouseenter="enter('-7469830342865795482');" onmouseout="out('-7469830342865795482');" style=""> 321                 Integer index = columnName.get(primaryKey[i]);                                           </span>
<span class="9077186300921558226" onmouseenter="enter('9077186300921558226');" onmouseout="out('9077186300921558226');" style=""><abbr title=" 322                 KuduUtil.primaryKeyRange(lowerPartialRow, columnSchemas.get(index).getType(), primaryKey[i], lowerBounds[i]);"> 322                 KuduUtil.primaryKeyRange(lowerPartialRow, columnSchemas.get(index).getType(), primaryKey[🔵</abbr></span>
<span class="1719939722143080272" onmouseenter="enter('1719939722143080272');" onmouseout="out('1719939722143080272');" style=""><abbr title=" 323                 KuduUtil.primaryKeyRange(upperPartialRow, columnSchemas.get(index).getType(), primaryKey[i], upperBounds[i]);"> 323                 KuduUtil.primaryKeyRange(upperPartialRow, columnSchemas.get(index).getType(), primaryKey[🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324             }                                                                                            </span>
<span class="-4326832194787526924" onmouseenter="enter('-4326832194787526924');" onmouseout="out('-4326832194787526924');" style=""> 325             builder.lowerBound(lowerPartialRow);                                                         </span>
<span class="-1145836739913025748" onmouseenter="enter('-1145836739913025748');" onmouseout="out('-1145836739913025748');" style=""> 326             builder.exclusiveUpperBound(upperPartialRow);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 327         }                                                                                                </span>
<span class="6330664272177173056" onmouseenter="enter('6330664272177173056');" onmouseout="out('6330664272177173056');" style=""> 328         List&lt;String&gt; projectColumns = Arrays.asList(sideFieldNames);                                     </span>
<span class="5674897199079825382" onmouseenter="enter('5674897199079825382');" onmouseout="out('5674897199079825382');" style=""> 329         return builder.setProjectedColumnNames(projectColumns).build();                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 330     }                                                                                                    </span>
<span  style=""> 331                                                                                                          </span>
<span class="7272585370217888157" onmouseenter="enter('7272585370217888157');" onmouseout="out('7272585370217888157');" style=""> 332     private String[] splitString(String data) {                                                          </span>
<span class="6835810800556100983" onmouseenter="enter('6835810800556100983');" onmouseout="out('6835810800556100983');" style=""> 333         return StringUtils.split(data, &quot;,&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334     }                                                                                                    </span>
<span  style=""> 335                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 336     @Override                                                                                            </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 337     public void close() throws Exception {                                                               </span>
<span class="-8885801519389600338" onmouseenter="enter('-8885801519389600338');" onmouseout="out('-8885801519389600338');" style=""> 338         //公用一个client  如果每次刷新间隔时间较长可以每次获取一个                                                               </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 339         super.close();                                                                                   </span>
<span class="5794975028458899729" onmouseenter="enter('5794975028458899729');" onmouseout="out('5794975028458899729');" style=""> 340         if (null != client) {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 341             try {                                                                                        </span>
<span class="2670944726041732440" onmouseenter="enter('2670944726041732440');" onmouseout="out('2670944726041732440');" style=""> 342                 client.close();                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 343             } catch (Exception e) {                                                                      </span>
<span class="7169708839653618971" onmouseenter="enter('7169708839653618971');" onmouseout="out('7169708839653618971');" style=""> 344                 LOG.error(&quot;Error while closing client.&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 345             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 346         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 347     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 348 }                                                                                                        </span></pre></td>
                            <td><pre><span class="-8840953368027741170" onmouseenter="enter('-8840953368027741170');" onmouseout="out('-8840953368027741170');" style="">   1 package com.dtstack.flink.sql.side.kudu;                                                                 </span>
<span  style="">   2                                                                                                          </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">   3 import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                 </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">   4 import com.dtstack.flink.sql.side.BaseAllReqRow;                                                         </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">   5 import com.dtstack.flink.sql.side.FieldInfo;                                                             </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">   6 import com.dtstack.flink.sql.side.JoinInfo;                                                              </span>
<span class="1614892075588798997" onmouseenter="enter('1614892075588798997');" onmouseout="out('1614892075588798997');" style="">   7 import com.dtstack.flink.sql.side.PredicateInfo;                                                         </span>
<span class="5710642889135375263" onmouseenter="enter('5710642889135375263');" onmouseout="out('5710642889135375263');" style="">   8 import com.dtstack.flink.sql.side.kudu.table.KuduSideTableInfo;                                          </span>
<span class="1164335795537447661" onmouseenter="enter('1164335795537447661');" onmouseout="out('1164335795537447661');" style="">   9 import com.dtstack.flink.sql.side.kudu.utils.KuduUtil;                                                   </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="">  10 import com.dtstack.flink.sql.util.RowDataComplete;                                                       </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  11 import com.google.common.base.Preconditions;                                                             </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  12 import com.google.common.collect.Lists;                                                                  </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  13 import com.google.common.collect.Maps;                                                                   </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  14 import java.sql.SQLException;                                                                            </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  15 import java.util.Arrays;                                                                                 </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  16 import java.util.Calendar;                                                                               </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  17 import java.util.HashMap;                                                                                </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  18 import java.util.List;                                                                                   </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  19 import java.util.Map;                                                                                    </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  20 import java.util.concurrent.atomic.AtomicReference;                                                      </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  21 import org.apache.calcite.sql.JoinType;                                                                  </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  22 import org.apache.commons.collections.CollectionUtils;                                                   </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  23 import org.apache.commons.lang3.StringUtils;                                                             </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="">  24 import org.apache.flink.api.java.tuple.Tuple2;                                                           </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  25 import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                  </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="">  26 import org.apache.flink.table.dataformat.BaseRow;                                                        </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  27 import org.apache.flink.types.Row;                                                                       </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  28 import org.apache.flink.util.Collector;                                                                  </span>
<span class="1631232015531818624" onmouseenter="enter('1631232015531818624');" onmouseout="out('1631232015531818624');" style="">  29 import org.apache.kudu.ColumnSchema;                                                                     </span>
<span class="-1755042893780385624" onmouseenter="enter('-1755042893780385624');" onmouseout="out('-1755042893780385624');" style="">  30 import org.apache.kudu.Schema;                                                                           </span>
<span class="2263873766708549976" onmouseenter="enter('2263873766708549976');" onmouseout="out('2263873766708549976');" style="">  31 import org.apache.kudu.client.KuduClient;                                                                </span>
<span class="1860194643195428903" onmouseenter="enter('1860194643195428903');" onmouseout="out('1860194643195428903');" style="">  32 import org.apache.kudu.client.KuduException;                                                             </span>
<span class="128288131530978478" onmouseenter="enter('128288131530978478');" onmouseout="out('128288131530978478');" style="">  33 import org.apache.kudu.client.KuduPredicate;                                                             </span>
<span class="-8538417097591974568" onmouseenter="enter('-8538417097591974568');" onmouseout="out('-8538417097591974568');" style="">  34 import org.apache.kudu.client.KuduScanner;                                                               </span>
<span class="-342692776902705676" onmouseenter="enter('-342692776902705676');" onmouseout="out('-342692776902705676');" style="">  35 import org.apache.kudu.client.KuduTable;                                                                 </span>
<span class="629701943397612117" onmouseenter="enter('629701943397612117');" onmouseout="out('629701943397612117');" style="">  36 import org.apache.kudu.client.PartialRow;                                                                </span>
<span class="-6157621177665621032" onmouseenter="enter('-6157621177665621032');" onmouseout="out('-6157621177665621032');" style="">  37 import org.apache.kudu.client.RowResult;                                                                 </span>
<span class="-1845673204769190809" onmouseenter="enter('-1845673204769190809');" onmouseout="out('-1845673204769190809');" style="">  38 import org.apache.kudu.client.RowResultIterator;                                                         </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  39 import org.slf4j.Logger;                                                                                 </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  40 import org.slf4j.LoggerFactory;                                                                          </span>
<span  style="">  41                                                                                                          </span>
<span  style="">  42                                                                                                          </span>
<span class="1178418458023894230" onmouseenter="enter('1178418458023894230');" onmouseout="out('1178418458023894230');" style="">  43 public class KuduAllReqRow extends BaseAllReqRow {                                                       </span>
<span class="2664279006928748303" onmouseenter="enter('2664279006928748303');" onmouseout="out('2664279006928748303');" style="">  44     private static final long serialVersionUID = 6051774809356082219L;                                   </span>
<span  style="">  45                                                                                                          </span>
<span class="-7779246735798526406" onmouseenter="enter('-7779246735798526406');" onmouseout="out('-7779246735798526406');" style="">  46     private static final Logger LOG = LoggerFactory.getLogger(KuduAllReqRow.class);                      </span>
<span  style="">  47                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  48     /**                                                                                                  </span>
<span class="-8285284077529796986" onmouseenter="enter('-8285284077529796986');" onmouseout="out('-8285284077529796986');" style="">  49      * 获取连接的尝试次数                                                                                         </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  50      */                                                                                                  </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  51     private static final int CONN_RETRY_NUM = 3;                                                         </span>
<span  style="">  52                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  53     /**                                                                                                  </span>
<span class="4062789252244833512" onmouseenter="enter('4062789252244833512');" onmouseout="out('4062789252244833512');" style="">  54      * 缓存条数                                                                                              </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  55      */                                                                                                  </span>
<span class="1004470848600586149" onmouseenter="enter('1004470848600586149');" onmouseout="out('1004470848600586149');" style="">  56     private static final Long FETCH_SIZE = 1000L;                                                        </span>
<span  style="">  57                                                                                                          </span>
<span class="-2539961354521398263" onmouseenter="enter('-2539961354521398263');" onmouseout="out('-2539961354521398263');" style="">  58     private KuduClient client;                                                                           </span>
<span  style="">  59                                                                                                          </span>
<span class="1317689277640300307" onmouseenter="enter('1317689277640300307');" onmouseout="out('1317689277640300307');" style="">  60     private KuduTable table;                                                                             </span>
<span  style="">  61                                                                                                          </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  62     private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();  </span>
<span  style="">  63                                                                                                          </span>
<span class="6616997293382437533" onmouseenter="enter('6616997293382437533');" onmouseout="out('6616997293382437533');" style=""><abbr title="  64     public KuduAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  64     public KuduAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, Ab🔵</abbr></span>
<span class="8698115236286713015" onmouseenter="enter('8698115236286713015');" onmouseout="out('8698115236286713015');" style="">  65         super(new KuduAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  66     }                                                                                                    </span>
<span  style="">  67                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  68     @Override                                                                                            </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="">  69     public Row fillData(Row input, Object sideInput) {                                                   </span>
<span class="2926391945845903809" onmouseenter="enter('2926391945845903809');" onmouseout="out('2926391945845903809');" style="">  70         Map&lt;String, Object&gt; cacheInfo = ((Map&lt;String, Object&gt;) (sideInput));                             </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="">  71         Row row = new Row(sideInfo.getOutFieldInfoList().size());                                        </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="">  72         for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="">  73             Object obj = input.getField(entry.getValue());                                               </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="">  74             obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                    </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="">  75             row.setField(entry.getKey(), obj);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  76         }                                                                                                </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="">  77         for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {           </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style="">  78             if (cacheInfo == null) {                                                                     </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style="">  79                 row.setField(entry.getKey(), null);                                                      </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  80             } else {                                                                                     </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style="">  81                 row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  82             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  83         }                                                                                                </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style="">  84         return row;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  85     }                                                                                                    </span>
<span  style="">  86                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  87     @Override                                                                                            </span>
<span class="-5452513235343270061" onmouseenter="enter('-5452513235343270061');" onmouseout="out('-5452513235343270061');" style="">  88     protected void initCache() throws SQLException {                                                     </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style="">  89         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style="">  90         cacheRef.set(newCache);                                                                          </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style="">  91         loadData(newCache);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  92     }                                                                                                    </span>
<span  style="">  93                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  94     @Override                                                                                            </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style="">  95     protected void reloadCache() {                                                                       </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style="">  96         //reload cacheRef and replace to old cacheRef                                                    </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style="">  97         Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                       </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style="">  98         loadData(newCache);                                                                              </span>
<span  style="">  99                                                                                                          </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 100         cacheRef.set(newCache);                                                                          </span>
<span class="-5375691814117803209" onmouseenter="enter('-5375691814117803209');" onmouseout="out('-5375691814117803209');" style=""> 101         LOG.info(&quot;----- kudu all cacheRef reload end:{}&quot;, Calendar.getInstance());                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 102     }                                                                                                    </span>
<span  style=""> 103                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 104     @Override                                                                                            </span>
<span class="6843933761729718422" onmouseenter="enter('6843933761729718422');" onmouseout="out('6843933761729718422');" style=""> 105     public void flatMap(Row input, Collector&lt;BaseRow&gt; out) throws Exception {                            </span>
<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style=""> 106         List&lt;Object&gt; inputParams = Lists.newArrayList();                                                 </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style=""> 107         for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                        </span>
<span class="7582033886787525124" onmouseenter="enter('7582033886787525124');" onmouseout="out('7582033886787525124');" style=""> 108             Object equalObj = input.getField(conValIndex);                                               </span>
<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style=""> 109             if (equalObj == null) {                                                                      </span>
<span class="2802501092059214558" onmouseenter="enter('2802501092059214558');" onmouseout="out('2802501092059214558');" style=""> 110                 out.collect(null);                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 111             }                                                                                            </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style=""> 112             inputParams.add(equalObj);                                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 113         }                                                                                                </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style=""> 114         String key = buildKey(inputParams);                                                              </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style=""> 115         List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                   </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style=""> 116         if (CollectionUtils.isEmpty(cacheList)) {                                                        </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style=""> 117             if (sideInfo.getJoinType() == JoinType.LEFT) {                                               </span>
<span class="-3752240759126097062" onmouseenter="enter('-3752240759126097062');" onmouseout="out('-3752240759126097062');" style=""> 118                 Row row = fillData(input, null);                                                         </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 119                 RowDataComplete.collectRow(out, row);                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 120             }                                                                                            </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 121             return;                                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 122         }                                                                                                </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style=""> 123         for (Map&lt;String, Object&gt; one : cacheList) {                                                      </span>
<span class="-6006003971782103198" onmouseenter="enter('-6006003971782103198');" onmouseout="out('-6006003971782103198');" style=""> 124             Row row = fillData(input, one);                                                              </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style=""> 125             RowDataComplete.collectRow(out, row);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 126         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127     }                                                                                                    </span>
<span  style=""> 128                                                                                                          </span>
<span class="961081247603323125" onmouseenter="enter('961081247603323125');" onmouseout="out('961081247603323125');" style=""> 129     private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {                             </span>
<span class="-5525344973390349168" onmouseenter="enter('-5525344973390349168');" onmouseout="out('-5525344973390349168');" style=""> 130         KuduSideTableInfo tableInfo = (KuduSideTableInfo) sideInfo.getSideTableInfo();                   </span>
<span class="4539652565484830811" onmouseenter="enter('4539652565484830811');" onmouseout="out('4539652565484830811');" style=""> 131         KuduScanner scanner = null;                                                                      </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 132         try {                                                                                            </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 133             for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                   </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 134                 try {                                                                                    </span>
<span class="3825928320653477879" onmouseenter="enter('3825928320653477879');" onmouseout="out('3825928320653477879');" style=""> 135                     scanner = getConn(tableInfo);                                                        </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 136                     break;                                                                               </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 137                 } catch (Exception e) {                                                                  </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 138                     if (i == CONN_RETRY_NUM - 1) {                                                       </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 139                         throw new RuntimeException(&quot;&quot;, e);                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 140                     }                                                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 141                     try {                                                                                </span>
<span class="7214047305831580892" onmouseenter="enter('7214047305831580892');" onmouseout="out('7214047305831580892');" style=""><abbr title=" 142                         String connInfo = &quot;kuduMasters:&quot; + tableInfo.getKuduMasters() + &quot;;tableName:&quot; + tableInfo.getTableName();"> 142                         String connInfo = &quot;kuduMasters:&quot; + tableInfo.getKuduMasters() + &quot;;tableName:&quot; + t🔵</abbr></span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 143                         LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);   </span>
<span class="-9127531774365832010" onmouseenter="enter('-9127531774365832010');" onmouseout="out('-9127531774365832010');" style=""> 144                         Thread.sleep(5 * 1000);                                                          </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 145                     } catch (InterruptedException e1) {                                                  </span>
<span class="4631440746187069452" onmouseenter="enter('4631440746187069452');" onmouseout="out('4631440746187069452');" style=""> 146                         LOG.error(&quot;&quot;,e1);                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147                     }                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 149             }                                                                                            </span>
<span class="475138084615438717" onmouseenter="enter('475138084615438717');" onmouseout="out('475138084615438717');" style=""> 150             //load data from table                                                                       </span>
<span class="3354690258641098597" onmouseenter="enter('3354690258641098597');" onmouseout="out('3354690258641098597');" style=""> 151             assert scanner != null;                                                                      </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 152             String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);            </span>
<span  style=""> 153                                                                                                          </span>
<span  style=""> 154                                                                                                          </span>
<span class="-7401034569209000676" onmouseenter="enter('-7401034569209000676');" onmouseout="out('-7401034569209000676');" style=""> 155             while (scanner.hasMoreRows()) {                                                              </span>
<span class="-490557585705256586" onmouseenter="enter('-490557585705256586');" onmouseout="out('-490557585705256586');" style=""> 156                 RowResultIterator results = scanner.nextRows();                                          </span>
<span class="5642997248258560969" onmouseenter="enter('5642997248258560969');" onmouseout="out('5642997248258560969');" style=""> 157                 while (results.hasNext()) {                                                              </span>
<span class="7206031536241251649" onmouseenter="enter('7206031536241251649');" onmouseout="out('7206031536241251649');" style=""> 158                     RowResult result = results.next();                                                   </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 159                     Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                      </span>
<span class="696829081573399723" onmouseenter="enter('696829081573399723');" onmouseout="out('696829081573399723');" style=""> 160                     for (String sideFieldName1 : sideFieldNames) {                                       </span>
<span class="5422300911827801712" onmouseenter="enter('5422300911827801712');" onmouseout="out('5422300911827801712');" style=""> 161                         String sideFieldName = sideFieldName1.trim();                                    </span>
<span class="-7396994512053753949" onmouseenter="enter('-7396994512053753949');" onmouseout="out('-7396994512053753949');" style=""> 162                         ColumnSchema columnSchema = table.getSchema().getColumn(sideFieldName);          </span>
<span class="-1551001954350423389" onmouseenter="enter('-1551001954350423389');" onmouseout="out('-1551001954350423389');" style=""> 163                         if (null != columnSchema) {                                                      </span>
<span class="-9080618923968214410" onmouseenter="enter('-9080618923968214410');" onmouseout="out('-9080618923968214410');" style=""> 164                             KuduUtil.setMapValue(columnSchema.getType(), oneRow, sideFieldName, result); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 165                         }                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 166                     }                                                                                    </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 167                     String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                    </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""><abbr title=" 168                     List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList());"> 168                     List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newA🔵</abbr></span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 169                     list.add(oneRow);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 171             }                                                                                            </span>
<span  style=""> 172                                                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 173         } catch (Exception e) {                                                                          </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 174             LOG.error(&quot;&quot;, e);                                                                            </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 175         } finally {                                                                                      </span>
<span class="8423512920007061689" onmouseenter="enter('8423512920007061689');" onmouseout="out('8423512920007061689');" style=""> 176             if (null != scanner) {                                                                       </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 177                 try {                                                                                    </span>
<span class="-8777054502423170477" onmouseenter="enter('-8777054502423170477');" onmouseout="out('-8777054502423170477');" style=""> 178                     scanner.close();                                                                     </span>
<span class="-5126831610509859200" onmouseenter="enter('-5126831610509859200');" onmouseout="out('-5126831610509859200');" style=""> 179                 } catch (KuduException e) {                                                              </span>
<span class="6470662301361356472" onmouseenter="enter('6470662301361356472');" onmouseout="out('6470662301361356472');" style=""> 180                     LOG.error(&quot;Error while closing scanner.&quot;, e);                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181                 }                                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 182             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 183         }                                                                                                </span>
<span  style=""> 184                                                                                                          </span>
<span  style=""> 185                                                                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186     }                                                                                                    </span>
<span  style=""> 187                                                                                                          </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 188     private String buildKey(List&lt;Object&gt; equalValList) {                                                 </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 189         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 190         for (Object equalVal : equalValList) {                                                           </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 191             sb.append(equalVal).append(&quot;_&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192         }                                                                                                </span>
<span  style=""> 193                                                                                                          </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 194         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 195     }                                                                                                    </span>
<span  style=""> 196                                                                                                          </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 197     private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                      </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 198         StringBuilder sb = new StringBuilder(&quot;&quot;);                                                        </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 199         for (String equalField : equalFieldList) {                                                       </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 200             sb.append(val.get(equalField)).append(&quot;_&quot;);                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201         }                                                                                                </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 202         return sb.toString();                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203     }                                                                                                    </span>
<span  style=""> 204                                                                                                          </span>
<span class="-1110060986504237489" onmouseenter="enter('-1110060986504237489');" onmouseout="out('-1110060986504237489');" style=""> 205     private KuduScanner getConn(KuduSideTableInfo tableInfo) {                                           </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 206         try {                                                                                            </span>
<span class="5852398308261929617" onmouseenter="enter('5852398308261929617');" onmouseout="out('5852398308261929617');" style=""> 207             if (client == null) {                                                                        </span>
<span class="6663968999840548385" onmouseenter="enter('6663968999840548385');" onmouseout="out('6663968999840548385');" style=""> 208                 String kuduMasters = tableInfo.getKuduMasters();                                         </span>
<span class="-557099550710151869" onmouseenter="enter('-557099550710151869');" onmouseout="out('-557099550710151869');" style=""> 209                 String tableName = tableInfo.getTableName();                                             </span>
<span class="9112523977520204345" onmouseenter="enter('9112523977520204345');" onmouseout="out('9112523977520204345');" style=""> 210                 Integer workerCount = tableInfo.getWorkerCount();                                        </span>
<span class="6969473062611895" onmouseenter="enter('6969473062611895');" onmouseout="out('6969473062611895');" style=""> 211                 Integer defaultSocketReadTimeoutMs = tableInfo.getDefaultSocketReadTimeoutMs();          </span>
<span class="-1083775279901428778" onmouseenter="enter('-1083775279901428778');" onmouseout="out('-1083775279901428778');" style=""> 212                 Integer defaultOperationTimeoutMs = tableInfo.getDefaultOperationTimeoutMs();            </span>
<span  style=""> 213                                                                                                          </span>
<span class="-6052455991030570635" onmouseenter="enter('-6052455991030570635');" onmouseout="out('-6052455991030570635');" style=""> 214                 Preconditions.checkNotNull(kuduMasters, &quot;kuduMasters could not be null&quot;);                </span>
<span  style=""> 215                                                                                                          </span>
<span class="6323058657488852255" onmouseenter="enter('6323058657488852255');" onmouseout="out('6323058657488852255');" style=""><abbr title=" 216                 KuduClient.KuduClientBuilder kuduClientBuilder = new KuduClient.KuduClientBuilder(kuduMasters);"> 216                 KuduClient.KuduClientBuilder kuduClientBuilder = new KuduClient.KuduClientBuilder(kuduMas🔵</abbr></span>
<span class="-8227759523178082238" onmouseenter="enter('-8227759523178082238');" onmouseout="out('-8227759523178082238');" style=""> 217                 if (null != workerCount) {                                                               </span>
<span class="7330416389256434067" onmouseenter="enter('7330416389256434067');" onmouseout="out('7330416389256434067');" style=""> 218                     kuduClientBuilder.workerCount(workerCount);                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 219                 }                                                                                        </span>
<span  style=""> 220                                                                                                          </span>
<span class="-2397215110746175709" onmouseenter="enter('-2397215110746175709');" onmouseout="out('-2397215110746175709');" style=""> 221                 if (null != defaultOperationTimeoutMs) {                                                 </span>
<span class="2898164840518299373" onmouseenter="enter('2898164840518299373');" onmouseout="out('2898164840518299373');" style=""> 222                     kuduClientBuilder.defaultOperationTimeoutMs(defaultOperationTimeoutMs);              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 223                 }                                                                                        </span>
<span class="4908267423182375675" onmouseenter="enter('4908267423182375675');" onmouseout="out('4908267423182375675');" style=""> 224                 client = kuduClientBuilder.build();                                                      </span>
<span  style=""> 225                                                                                                          </span>
<span class="5439625390486835368" onmouseenter="enter('5439625390486835368');" onmouseout="out('5439625390486835368');" style=""> 226                 if (!client.tableExists(tableName)) {                                                    </span>
<span class="4123299035781055923" onmouseenter="enter('4123299035781055923');" onmouseout="out('4123299035781055923');" style=""> 227                     throw new IllegalArgumentException(&quot;Table Open Failed , please check table exists&quot;); </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 228                 }                                                                                        </span>
<span class="-2001660784391926307" onmouseenter="enter('-2001660784391926307');" onmouseout="out('-2001660784391926307');" style=""> 229                 table = client.openTable(tableName);                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 230             }                                                                                            </span>
<span class="6789989036272871448" onmouseenter="enter('6789989036272871448');" onmouseout="out('6789989036272871448');" style=""> 231             Schema schema = table.getSchema();                                                           </span>
<span class="4608914853005352034" onmouseenter="enter('4608914853005352034');" onmouseout="out('4608914853005352034');" style=""> 232             KuduScanner.KuduScannerBuilder tokenBuilder = client.newScannerBuilder(table);               </span>
<span class="-4750737985114959418" onmouseenter="enter('-4750737985114959418');" onmouseout="out('-4750737985114959418');" style=""> 233             return buildScanner(tokenBuilder, schema, tableInfo);                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 234         } catch (Exception e) {                                                                          </span>
<span class="-2537427276397986072" onmouseenter="enter('-2537427276397986072');" onmouseout="out('-2537427276397986072');" style=""> 235             LOG.error(&quot;connect kudu is error:&quot; + e.getMessage());                                        </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 236             throw new RuntimeException(e);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 237         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238     }                                                                                                    </span>
<span  style=""> 239                                                                                                          </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 240     /**                                                                                                  </span>
<span class="-1458033306623281405" onmouseenter="enter('-1458033306623281405');" onmouseout="out('-1458033306623281405');" style=""> 241      * @param builder   创建AsyncKuduScanner对象                                                             </span>
<span class="2461494225329490181" onmouseenter="enter('2461494225329490181');" onmouseout="out('2461494225329490181');" style=""> 242      * @param schema    kudu中表约束                                                                         </span>
<span class="-2064584549205697250" onmouseenter="enter('-2064584549205697250');" onmouseout="out('-2064584549205697250');" style=""> 243      * @param tableInfo AsyncKuduScanner的配置信息                                                            </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 244      * @return                                                                                           </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 245      */                                                                                                  </span>
<span class="2867837401631125856" onmouseenter="enter('2867837401631125856');" onmouseout="out('2867837401631125856');" style=""><abbr title=" 246     private KuduScanner buildScanner(KuduScanner.KuduScannerBuilder builder, Schema schema, KuduSideTableInfo tableInfo) {"> 246     private KuduScanner buildScanner(KuduScanner.KuduScannerBuilder builder, Schema schema, KuduSideTable🔵</abbr></span>
<span class="8886111092133146967" onmouseenter="enter('8886111092133146967');" onmouseout="out('8886111092133146967');" style=""> 247         Integer batchSizeBytes = tableInfo.getBatchSizeBytes();                                          </span>
<span class="7808553397779189452" onmouseenter="enter('7808553397779189452');" onmouseout="out('7808553397779189452');" style=""> 248         Long limitNum = tableInfo.getLimitNum();                                                         </span>
<span class="-3208642476437503495" onmouseenter="enter('-3208642476437503495');" onmouseout="out('-3208642476437503495');" style=""> 249         Boolean isFaultTolerant = tableInfo.getFaultTolerant();                                          </span>
<span class="-8526639943056837274" onmouseenter="enter('-8526639943056837274');" onmouseout="out('-8526639943056837274');" style=""> 250         //查询需要的字段                                                                                        </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 251         String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                </span>
<span class="8148679338456729713" onmouseenter="enter('8148679338456729713');" onmouseout="out('8148679338456729713');" style=""> 252         //主键过滤条件 主键最小值                                                                                   </span>
<span class="774304746758482808" onmouseenter="enter('774304746758482808');" onmouseout="out('774304746758482808');" style=""> 253         String lowerBoundPrimaryKey = tableInfo.getLowerBoundPrimaryKey();                               </span>
<span class="-4956716841620057294" onmouseenter="enter('-4956716841620057294');" onmouseout="out('-4956716841620057294');" style=""> 254         //主键过滤条件 主键最大值                                                                                   </span>
<span class="-7517771237746601096" onmouseenter="enter('-7517771237746601096');" onmouseout="out('-7517771237746601096');" style=""> 255         String upperBoundPrimaryKey = tableInfo.getUpperBoundPrimaryKey();                               </span>
<span class="-3636378559400202691" onmouseenter="enter('-3636378559400202691');" onmouseout="out('-3636378559400202691');" style=""> 256         //主键字段                                                                                           </span>
<span class="5200352787312582461" onmouseenter="enter('5200352787312582461');" onmouseout="out('5200352787312582461');" style=""> 257         String primaryKeys = tableInfo.getPrimaryKey();                                                  </span>
<span class="-8080913465496496419" onmouseenter="enter('-8080913465496496419');" onmouseout="out('-8080913465496496419');" style=""> 258         if (null == limitNum || limitNum &lt;= 0) {                                                         </span>
<span class="-4868625127437582675" onmouseenter="enter('-4868625127437582675');" onmouseout="out('-4868625127437582675');" style=""> 259             builder.limit(FETCH_SIZE);                                                                   </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 260         } else {                                                                                         </span>
<span class="4444562149069843980" onmouseenter="enter('4444562149069843980');" onmouseout="out('4444562149069843980');" style=""> 261             builder.limit(limitNum);                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 262         }                                                                                                </span>
<span class="-5740110908714073879" onmouseenter="enter('-5740110908714073879');" onmouseout="out('-5740110908714073879');" style=""> 263         if (null != batchSizeBytes) {                                                                    </span>
<span class="732524166722318272" onmouseenter="enter('732524166722318272');" onmouseout="out('732524166722318272');" style=""> 264             builder.batchSizeBytes(batchSizeBytes);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 265         }                                                                                                </span>
<span class="-8680730272034558637" onmouseenter="enter('-8680730272034558637');" onmouseout="out('-8680730272034558637');" style=""> 266         if (null != isFaultTolerant) {                                                                   </span>
<span class="-2751626226784684126" onmouseenter="enter('-2751626226784684126');" onmouseout="out('-2751626226784684126');" style=""> 267             builder.setFaultTolerant(isFaultTolerant);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 268         }                                                                                                </span>
<span class="-5863912479223093982" onmouseenter="enter('-5863912479223093982');" onmouseout="out('-5863912479223093982');" style=""> 269         //  填充谓词信息                                                                                       </span>
<span class="-8839623202504591157" onmouseenter="enter('-8839623202504591157');" onmouseout="out('-8839623202504591157');" style=""> 270         List&lt;PredicateInfo&gt; predicateInfoes = sideInfo.getSideTableInfo().getPredicateInfoes();          </span>
<span class="1131384255148676390" onmouseenter="enter('1131384255148676390');" onmouseout="out('1131384255148676390');" style=""> 271         if (predicateInfoes.size() &gt; 0) {                                                                </span>
<span class="7087000648291367893" onmouseenter="enter('7087000648291367893');" onmouseout="out('7087000648291367893');" style=""> 272             predicateInfoes.stream().map(info -&gt; {                                                       </span>
<span class="-3754680470381432050" onmouseenter="enter('-3754680470381432050');" onmouseout="out('-3754680470381432050');" style=""> 273                 KuduPredicate kuduPredicate = KuduUtil.buildKuduPredicate(schema, info);                 </span>
<span class="8493928812165156395" onmouseenter="enter('8493928812165156395');" onmouseout="out('8493928812165156395');" style=""> 274                 if (null != kuduPredicate) {                                                             </span>
<span class="-7750601395793408087" onmouseenter="enter('-7750601395793408087');" onmouseout="out('-7750601395793408087');" style=""> 275                     builder.addPredicate(kuduPredicate);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 276                 }                                                                                        </span>
<span class="-3556780733195614200" onmouseenter="enter('-3556780733195614200');" onmouseout="out('-3556780733195614200');" style=""> 277                 return info;                                                                             </span>
<span class="3075434854107094892" onmouseenter="enter('3075434854107094892');" onmouseout="out('3075434854107094892');" style=""> 278             }).count();                                                                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 279         }                                                                                                </span>
<span  style=""> 280                                                                                                          </span>
<span class="5058160594792466993" onmouseenter="enter('5058160594792466993');" onmouseout="out('5058160594792466993');" style=""> 281         if (null != lowerBoundPrimaryKey &amp;&amp; null != upperBoundPrimaryKey &amp;&amp; null != primaryKeys) {       </span>
<span class="5137789214991290203" onmouseenter="enter('5137789214991290203');" onmouseout="out('5137789214991290203');" style=""> 282             List&lt;ColumnSchema&gt; columnSchemas = schema.getPrimaryKeyColumns();                            </span>
<span class="-9153585758974253186" onmouseenter="enter('-9153585758974253186');" onmouseout="out('-9153585758974253186');" style=""> 283             Map&lt;String, Integer&gt; columnName = new HashMap&lt;String, Integer&gt;(columnSchemas.size());        </span>
<span class="-8501863997026521914" onmouseenter="enter('-8501863997026521914');" onmouseout="out('-8501863997026521914');" style=""> 284             for (int i = 0; i &lt; columnSchemas.size(); i++) {                                             </span>
<span class="5688298920213282235" onmouseenter="enter('5688298920213282235');" onmouseout="out('5688298920213282235');" style=""> 285                 columnName.put(columnSchemas.get(i).getName(), i);                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 286             }                                                                                            </span>
<span class="9190792110333311829" onmouseenter="enter('9190792110333311829');" onmouseout="out('9190792110333311829');" style=""> 287             String[] primaryKey = splitString(primaryKeys);                                              </span>
<span class="8892393707780373743" onmouseenter="enter('8892393707780373743');" onmouseout="out('8892393707780373743');" style=""> 288             String[] lowerBounds = splitString(lowerBoundPrimaryKey);                                    </span>
<span class="-609605915884017391" onmouseenter="enter('-609605915884017391');" onmouseout="out('-609605915884017391');" style=""> 289             String[] upperBounds = splitString(upperBoundPrimaryKey);                                    </span>
<span class="4494391771595015869" onmouseenter="enter('4494391771595015869');" onmouseout="out('4494391771595015869');" style=""> 290             PartialRow lowerPartialRow = schema.newPartialRow();                                         </span>
<span class="8816033343726193199" onmouseenter="enter('8816033343726193199');" onmouseout="out('8816033343726193199');" style=""> 291             PartialRow upperPartialRow = schema.newPartialRow();                                         </span>
<span class="-8968328790125117730" onmouseenter="enter('-8968328790125117730');" onmouseout="out('-8968328790125117730');" style=""> 292             for (int i = 0; i &lt; primaryKey.length; i++) {                                                </span>
<span class="-7469830342865795482" onmouseenter="enter('-7469830342865795482');" onmouseout="out('-7469830342865795482');" style=""> 293                 Integer index = columnName.get(primaryKey[i]);                                           </span>
<span class="9077186300921558226" onmouseenter="enter('9077186300921558226');" onmouseout="out('9077186300921558226');" style=""><abbr title=" 294                 KuduUtil.primaryKeyRange(lowerPartialRow, columnSchemas.get(index).getType(), primaryKey[i], lowerBounds[i]);"> 294                 KuduUtil.primaryKeyRange(lowerPartialRow, columnSchemas.get(index).getType(), primaryKey[🔵</abbr></span>
<span class="1719939722143080272" onmouseenter="enter('1719939722143080272');" onmouseout="out('1719939722143080272');" style=""><abbr title=" 295                 KuduUtil.primaryKeyRange(upperPartialRow, columnSchemas.get(index).getType(), primaryKey[i], upperBounds[i]);"> 295                 KuduUtil.primaryKeyRange(upperPartialRow, columnSchemas.get(index).getType(), primaryKey[🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 296             }                                                                                            </span>
<span class="-4326832194787526924" onmouseenter="enter('-4326832194787526924');" onmouseout="out('-4326832194787526924');" style=""> 297             builder.lowerBound(lowerPartialRow);                                                         </span>
<span class="-1145836739913025748" onmouseenter="enter('-1145836739913025748');" onmouseout="out('-1145836739913025748');" style=""> 298             builder.exclusiveUpperBound(upperPartialRow);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 299         }                                                                                                </span>
<span class="6330664272177173056" onmouseenter="enter('6330664272177173056');" onmouseout="out('6330664272177173056');" style=""> 300         List&lt;String&gt; projectColumns = Arrays.asList(sideFieldNames);                                     </span>
<span class="5674897199079825382" onmouseenter="enter('5674897199079825382');" onmouseout="out('5674897199079825382');" style=""> 301         return builder.setProjectedColumnNames(projectColumns).build();                                  </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302     }                                                                                                    </span>
<span  style=""> 303                                                                                                          </span>
<span class="7272585370217888157" onmouseenter="enter('7272585370217888157');" onmouseout="out('7272585370217888157');" style=""> 304     private String[] splitString(String data) {                                                          </span>
<span class="6835810800556100983" onmouseenter="enter('6835810800556100983');" onmouseout="out('6835810800556100983');" style=""> 305         return StringUtils.split(data, &quot;,&quot;);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 306     }                                                                                                    </span>
<span  style=""> 307                                                                                                          </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 308     @Override                                                                                            </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 309     public void close() throws Exception {                                                               </span>
<span class="-8885801519389600338" onmouseenter="enter('-8885801519389600338');" onmouseout="out('-8885801519389600338');" style=""> 310         //公用一个client  如果每次刷新间隔时间较长可以每次获取一个                                                               </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 311         super.close();                                                                                   </span>
<span class="5794975028458899729" onmouseenter="enter('5794975028458899729');" onmouseout="out('5794975028458899729');" style=""> 312         if (null != client) {                                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 313             try {                                                                                        </span>
<span class="2670944726041732440" onmouseenter="enter('2670944726041732440');" onmouseout="out('2670944726041732440');" style=""> 314                 client.close();                                                                          </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 315             } catch (Exception e) {                                                                      </span>
<span class="7169708839653618971" onmouseenter="enter('7169708839653618971');" onmouseout="out('7169708839653618971');" style=""> 316                 LOG.error(&quot;Error while closing client.&quot;, e);                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 317             }                                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318         }                                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 319     }                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 320 }                                                                                                        </span>


























</pre></td>
                        </tr>
                    </table>
                </div>
                <div id="bottom">
                    <table style="margin:auto">
                        <tr>
                            <th>ours vs. base</th>
                            <th>theirs vs. base</th>
                        </tr>
                        <tr>
                            <td><pre><span class="-8840953368027741170" onmouseenter="enter('-8840953368027741170');" onmouseout="out('-8840953368027741170');" style="">   1  package com.dtstack.flink.sql.side.kudu;                                                                          </span>
<span  style="">   2                                                                                                                    </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">   3  import com.dtstack.flink.sql.side.BaseAllReqRow;                                                                  </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">   4  import com.dtstack.flink.sql.side.FieldInfo;                                                                      </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">   5  import com.dtstack.flink.sql.side.JoinInfo;                                                                       </span>
<span class="1614892075588798997" onmouseenter="enter('1614892075588798997');" onmouseout="out('1614892075588798997');" style="">   6  import com.dtstack.flink.sql.side.PredicateInfo;                                                                  </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">   7  import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                          </span>
<span class="5710642889135375263" onmouseenter="enter('5710642889135375263');" onmouseout="out('5710642889135375263');" style="">   8  import com.dtstack.flink.sql.side.kudu.table.KuduSideTableInfo;                                                   </span>
<span class="1164335795537447661" onmouseenter="enter('1164335795537447661');" onmouseout="out('1164335795537447661');" style="">   9  import com.dtstack.flink.sql.side.kudu.utils.KuduUtil;                                                            </span>
<span class="-3551762499494176757" onmouseenter="enter('-3551762499494176757');" onmouseout="out('-3551762499494176757');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  10 +import com.dtstack.flink.sql.util.RowDataComplete;                                                                </span>
<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  11  import com.google.common.base.Preconditions;                                                                      </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  12  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  13  import com.google.common.collect.Maps;                                                                            </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  14  import org.apache.calcite.sql.JoinType;                                                                           </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  15  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  16  import org.apache.commons.lang3.StringUtils;                                                                      </span>
<span class="3718762954377501633" onmouseenter="enter('3718762954377501633');" onmouseout="out('3718762954377501633');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  17 +import org.apache.flink.api.java.tuple.Tuple2;                                                                    </span>
<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  18  import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="3883198981410010526" onmouseenter="enter('3883198981410010526');" onmouseout="out('3883198981410010526');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  19 -import org.apache.flink.table.runtime.types.CRow;                                                                 </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  20 -import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>
<span class="-8515482078367964881" onmouseenter="enter('-8515482078367964881');" onmouseout="out('-8515482078367964881');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  21 +import org.apache.flink.table.dataformat.BaseRow;                                                                 </span>
<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  22  import org.apache.flink.types.Row;                                                                                </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  23  import org.apache.flink.util.Collector;                                                                           </span>
<span class="1631232015531818624" onmouseenter="enter('1631232015531818624');" onmouseout="out('1631232015531818624');" style="">  24  import org.apache.kudu.ColumnSchema;                                                                              </span>
<span class="-1755042893780385624" onmouseenter="enter('-1755042893780385624');" onmouseout="out('-1755042893780385624');" style="">  25  import org.apache.kudu.Schema;                                                                                    </span>
<span class="2263873766708549976" onmouseenter="enter('2263873766708549976');" onmouseout="out('2263873766708549976');" style="">  26  import org.apache.kudu.client.KuduClient;                                                                         </span>
<span class="1860194643195428903" onmouseenter="enter('1860194643195428903');" onmouseout="out('1860194643195428903');" style="">  27  import org.apache.kudu.client.KuduException;                                                                      </span>
<span class="128288131530978478" onmouseenter="enter('128288131530978478');" onmouseout="out('128288131530978478');" style="">  28  import org.apache.kudu.client.KuduPredicate;                                                                      </span>
<span class="-8538417097591974568" onmouseenter="enter('-8538417097591974568');" onmouseout="out('-8538417097591974568');" style="">  29  import org.apache.kudu.client.KuduScanner;                                                                        </span>
<span class="-342692776902705676" onmouseenter="enter('-342692776902705676');" onmouseout="out('-342692776902705676');" style="">  30  import org.apache.kudu.client.KuduTable;                                                                          </span>
<span class="629701943397612117" onmouseenter="enter('629701943397612117');" onmouseout="out('629701943397612117');" style="">  31  import org.apache.kudu.client.PartialRow;                                                                         </span>
<span class="-6157621177665621032" onmouseenter="enter('-6157621177665621032');" onmouseout="out('-6157621177665621032');" style="">  32  import org.apache.kudu.client.RowResult;                                                                          </span>
<span class="-1845673204769190809" onmouseenter="enter('-1845673204769190809');" onmouseout="out('-1845673204769190809');" style="">  33  import org.apache.kudu.client.RowResultIterator;                                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  34  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  35  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  36                                                                                                                    </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  37  import java.sql.SQLException;                                                                                     </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  38 -import java.sql.Timestamp;                                                                                        </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  39  import java.util.Arrays;                                                                                          </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  40  import java.util.Calendar;                                                                                        </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  41  import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  42  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  43  import java.util.Map;                                                                                             </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  44  import java.util.concurrent.atomic.AtomicReference;                                                               </span>
<span  style="">  45                                                                                                                    </span>
<span class="1178418458023894230" onmouseenter="enter('1178418458023894230');" onmouseout="out('1178418458023894230');" style="">  46  public class KuduAllReqRow extends BaseAllReqRow {                                                                </span>
<span  style="">  47                                                                                                                    </span>
<span class="2664279006928748303" onmouseenter="enter('2664279006928748303');" onmouseout="out('2664279006928748303');" style="">  48      private static final long serialVersionUID = 6051774809356082219L;                                            </span>
<span  style="">  49                                                                                                                    </span>
<span class="-7779246735798526406" onmouseenter="enter('-7779246735798526406');" onmouseout="out('-7779246735798526406');" style="">  50      private static final Logger LOG = LoggerFactory.getLogger(KuduAllReqRow.class);                               </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  51      /**                                                                                                           </span>
<span class="-8285284077529796986" onmouseenter="enter('-8285284077529796986');" onmouseout="out('-8285284077529796986');" style="">  52       * 获取连接的尝试次数                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  53       */                                                                                                           </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  54      private static final int CONN_RETRY_NUM = 3;                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  55      /**                                                                                                           </span>
<span class="4062789252244833512" onmouseenter="enter('4062789252244833512');" onmouseout="out('4062789252244833512');" style="">  56       * 缓存条数                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  57       */                                                                                                           </span>
<span class="1004470848600586149" onmouseenter="enter('1004470848600586149');" onmouseout="out('1004470848600586149');" style="">  58      private static final Long FETCH_SIZE = 1000L;                                                                 </span>
<span  style="">  59                                                                                                                    </span>
<span class="-2539961354521398263" onmouseenter="enter('-2539961354521398263');" onmouseout="out('-2539961354521398263');" style="">  60      private KuduClient client;                                                                                    </span>
<span  style="">  61                                                                                                                    </span>
<span class="1317689277640300307" onmouseenter="enter('1317689277640300307');" onmouseout="out('1317689277640300307');" style="">  62      private KuduTable table;                                                                                      </span>
<span  style="">  63                                                                                                                    </span>
<span  style="">  64                                                                                                                    </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  65      private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();           </span>
<span  style="">  66                                                                                                                    </span>
<span class="6616997293382437533" onmouseenter="enter('6616997293382437533');" onmouseout="out('6616997293382437533');" style=""><abbr title="  67      public KuduAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  67      public KuduAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSid🔵</abbr></span>
<span class="8698115236286713015" onmouseenter="enter('8698115236286713015');" onmouseout="out('8698115236286713015');" style="">  68          super(new KuduAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  69      }                                                                                                             </span>
<span  style="">  70                                                                                                                    </span>
<span  style="">  71                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  72      @Override                                                                                                     </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="">  73      public Row fillData(Row input, Object sideInput) {                                                            </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="">  74          Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                          </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="">  75          Row row = new Row(sideInfo.getOutFieldInfoList().size());                                                 </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="">  76          for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                         </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="">  77              Object obj = input.getField(entry.getValue());                                                        </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  78 -            boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());">  78 -            boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo🔵</abbr></span>
<span  style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  79 -                                                                                                                  </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"><abbr title="  80 -            //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long.">  80 -            //Type information for indicating event or processing time. However, it behaves like a regular SQL tim🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  81 -            if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                            </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  82 -                obj = ((Timestamp) obj).getTime();                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  83 -            }                                                                                                     </span>
<span class="-7569211455899402285" onmouseenter="enter('-7569211455899402285');" onmouseout="out('-7569211455899402285');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  84 +            obj = convertTimeIndictorTypeInfo(entry.getValue(), obj);                                             </span>



<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="">  85              row.setField(entry.getKey(), obj);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86          }                                                                                                         </span>
<span  style="">  87                                                                                                                    </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="">  88          for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {                    </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style="">  89              if (cacheInfo == null) {                                                                              </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style="">  90                  row.setField(entry.getKey(), null);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  91              } else {                                                                                              </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style="">  92                  row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94          }                                                                                                         </span>
<span  style="">  95                                                                                                                    </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style="">  96          return row;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97      }                                                                                                             </span>
<span  style="">  98                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  99      @Override                                                                                                     </span>
<span class="-5452513235343270061" onmouseenter="enter('-5452513235343270061');" onmouseout="out('-5452513235343270061');" style=""> 100      protected void initCache() throws SQLException {                                                              </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 101          Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                                </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 102          cacheRef.set(newCache);                                                                                   </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 103          loadData(newCache);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104      }                                                                                                             </span>
<span  style=""> 105                                                                                                                    </span>
<span  style=""> 106                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 107      @Override                                                                                                     </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 108      protected void reloadCache() {                                                                                </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 109          //reload cacheRef and replace to old cacheRef                                                             </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 110          Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                                </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 111          loadData(newCache);                                                                                       </span>
<span  style=""> 112                                                                                                                    </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 113          cacheRef.set(newCache);                                                                                   </span>
<span class="-5375691814117803209" onmouseenter="enter('-5375691814117803209');" onmouseout="out('-5375691814117803209');" style=""> 114          LOG.info(&quot;----- kudu all cacheRef reload end:{}&quot;, Calendar.getInstance());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115      }                                                                                                             </span>
<span  style=""> 116                                                                                                                    </span>
<span  style=""> 117                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 118      @Override                                                                                                     </span>
<span class="2657010695143174651" onmouseenter="enter('2657010695143174651');" onmouseout="out('2657010695143174651');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 119 -    public void flatMap(CRow input, Collector&lt;CRow&gt; out) throws Exception {                                       </span>
<span class="6843933761729718422" onmouseenter="enter('6843933761729718422');" onmouseout="out('6843933761729718422');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 120 +    public void flatMap(Row input, Collector&lt;BaseRow&gt; out) throws Exception {                                     </span>
<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style=""> 121          List&lt;Object&gt; inputParams = Lists.newArrayList();                                                          </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style=""> 122          for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                                 </span>
<span class="-1571322702847153161" onmouseenter="enter('-1571322702847153161');" onmouseout="out('-1571322702847153161');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 123 -            Object equalObj = input.row().getField(conValIndex);                                                  </span>
<span class="7582033886787525124" onmouseenter="enter('7582033886787525124');" onmouseout="out('7582033886787525124');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 124 +            Object equalObj = input.getField(conValIndex);                                                        </span>
<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style=""> 125              if (equalObj == null) {                                                                               </span>
<span class="2802501092059214558" onmouseenter="enter('2802501092059214558');" onmouseout="out('2802501092059214558');" style=""> 126                  out.collect(null);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127              }                                                                                                     </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style=""> 128              inputParams.add(equalObj);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 129          }                                                                                                         </span>
<span  style=""> 130                                                                                                                    </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style=""> 131          String key = buildKey(inputParams);                                                                       </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style=""> 132          List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                            </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style=""> 133          if (CollectionUtils.isEmpty(cacheList)) {                                                                 </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style=""> 134              if (sideInfo.getJoinType() == JoinType.LEFT) {                                                        </span>
<span class="5500326757636101813" onmouseenter="enter('5500326757636101813');" onmouseout="out('5500326757636101813');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 135 -                Row row = fillData(input.row(), null);                                                            </span>
<span class="-1652121101976271273" onmouseenter="enter('-1652121101976271273');" onmouseout="out('-1652121101976271273');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 136 -                out.collect(new CRow(row, input.change()));                                                       </span>
<span class="-3752240759126097062" onmouseenter="enter('-3752240759126097062');" onmouseout="out('-3752240759126097062');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 137 +                Row row = fillData(input, null);                                                                  </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 138 +                RowDataComplete.collectRow(out, row);                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 139              }                                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 140              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141          }                                                                                                         </span>
<span  style=""> 142                                                                                                                    </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style=""> 143          for (Map&lt;String, Object&gt; one : cacheList) {                                                               </span>
<span class="-1129401162237110043" onmouseenter="enter('-1129401162237110043');" onmouseout="out('-1129401162237110043');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0"> 144 -            out.collect(new CRow(fillData(input.row(), one), input.change()));                                    </span>
<span class="-6006003971782103198" onmouseenter="enter('-6006003971782103198');" onmouseout="out('-6006003971782103198');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 145 +            Row row = fillData(input, one);                                                                       </span>
<span class="-7906969292003116947" onmouseenter="enter('-7906969292003116947');" onmouseout="out('-7906969292003116947');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0"> 146 +            RowDataComplete.collectRow(out, row);                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 147          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 148      }                                                                                                             </span>
<span  style=""> 149                                                                                                                    </span>
<span class="961081247603323125" onmouseenter="enter('961081247603323125');" onmouseout="out('961081247603323125');" style=""> 150      private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {                                      </span>
<span class="-5525344973390349168" onmouseenter="enter('-5525344973390349168');" onmouseout="out('-5525344973390349168');" style=""> 151          KuduSideTableInfo tableInfo = (KuduSideTableInfo) sideInfo.getSideTableInfo();                            </span>
<span class="4539652565484830811" onmouseenter="enter('4539652565484830811');" onmouseout="out('4539652565484830811');" style=""> 152          KuduScanner scanner = null;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 153          try {                                                                                                     </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 154              for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 155                  try {                                                                                             </span>
<span class="3825928320653477879" onmouseenter="enter('3825928320653477879');" onmouseout="out('3825928320653477879');" style=""> 156                      scanner = getConn(tableInfo);                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 157                      break;                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 158                  } catch (Exception e) {                                                                           </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 159                      if (i == CONN_RETRY_NUM - 1) {                                                                </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 160                          throw new RuntimeException(&quot;&quot;, e);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 161                      }                                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 162                      try {                                                                                         </span>
<span class="7214047305831580892" onmouseenter="enter('7214047305831580892');" onmouseout="out('7214047305831580892');" style=""><abbr title=" 163                          String connInfo = &quot;kuduMasters:&quot; + tableInfo.getKuduMasters() + &quot;;tableName:&quot; + tableInfo.getTableName();"> 163                          String connInfo = &quot;kuduMasters:&quot; + tableInfo.getKuduMasters() + &quot;;tableName:&quot; + tableInfo.🔵</abbr></span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 164                          LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);            </span>
<span class="-9127531774365832010" onmouseenter="enter('-9127531774365832010');" onmouseout="out('-9127531774365832010');" style=""> 165                          Thread.sleep(5 * 1000);                                                                   </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 166                      } catch (InterruptedException e1) {                                                           </span>
<span class="4631440746187069452" onmouseenter="enter('4631440746187069452');" onmouseout="out('4631440746187069452');" style=""> 167                          LOG.error(&quot;&quot;,e1);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 168                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 169                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 170              }                                                                                                     </span>
<span class="475138084615438717" onmouseenter="enter('475138084615438717');" onmouseout="out('475138084615438717');" style=""> 171              //load data from table                                                                                </span>
<span class="3354690258641098597" onmouseenter="enter('3354690258641098597');" onmouseout="out('3354690258641098597');" style=""> 172              assert scanner != null;                                                                               </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 173              String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                     </span>
<span  style=""> 174                                                                                                                    </span>
<span  style=""> 175                                                                                                                    </span>
<span class="-7401034569209000676" onmouseenter="enter('-7401034569209000676');" onmouseout="out('-7401034569209000676');" style=""> 176              while (scanner.hasMoreRows()) {                                                                       </span>
<span class="-490557585705256586" onmouseenter="enter('-490557585705256586');" onmouseout="out('-490557585705256586');" style=""> 177                  RowResultIterator results = scanner.nextRows();                                                   </span>
<span class="5642997248258560969" onmouseenter="enter('5642997248258560969');" onmouseout="out('5642997248258560969');" style=""> 178                  while (results.hasNext()) {                                                                       </span>
<span class="7206031536241251649" onmouseenter="enter('7206031536241251649');" onmouseout="out('7206031536241251649');" style=""> 179                      RowResult result = results.next();                                                            </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 180                      Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                               </span>
<span class="696829081573399723" onmouseenter="enter('696829081573399723');" onmouseout="out('696829081573399723');" style=""> 181                      for (String sideFieldName1 : sideFieldNames) {                                                </span>
<span class="5422300911827801712" onmouseenter="enter('5422300911827801712');" onmouseout="out('5422300911827801712');" style=""> 182                          String sideFieldName = sideFieldName1.trim();                                             </span>
<span class="-7396994512053753949" onmouseenter="enter('-7396994512053753949');" onmouseout="out('-7396994512053753949');" style=""> 183                          ColumnSchema columnSchema = table.getSchema().getColumn(sideFieldName);                   </span>
<span class="-1551001954350423389" onmouseenter="enter('-1551001954350423389');" onmouseout="out('-1551001954350423389');" style=""> 184                          if (null != columnSchema) {                                                               </span>
<span class="-9080618923968214410" onmouseenter="enter('-9080618923968214410');" onmouseout="out('-9080618923968214410');" style=""> 185                              KuduUtil.setMapValue(columnSchema.getType(), oneRow, sideFieldName, result);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 187                      }                                                                                             </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 188                      String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                             </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""><abbr title=" 189                      List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList());"> 189                      List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList(🔵</abbr></span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 190                      list.add(oneRow);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 191                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 192              }                                                                                                     </span>
<span  style=""> 193                                                                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 194          } catch (Exception e) {                                                                                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 195              LOG.error(&quot;&quot;, e);                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 196          } finally {                                                                                               </span>
<span class="8423512920007061689" onmouseenter="enter('8423512920007061689');" onmouseout="out('8423512920007061689');" style=""> 197              if (null != scanner) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 198                  try {                                                                                             </span>
<span class="-8777054502423170477" onmouseenter="enter('-8777054502423170477');" onmouseout="out('-8777054502423170477');" style=""> 199                      scanner.close();                                                                              </span>
<span class="-5126831610509859200" onmouseenter="enter('-5126831610509859200');" onmouseout="out('-5126831610509859200');" style=""> 200                  } catch (KuduException e) {                                                                       </span>
<span class="6470662301361356472" onmouseenter="enter('6470662301361356472');" onmouseout="out('6470662301361356472');" style=""> 201                      LOG.error(&quot;Error while closing scanner.&quot;, e);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 202                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 203              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 204          }                                                                                                         </span>
<span  style=""> 205                                                                                                                    </span>
<span  style=""> 206                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207      }                                                                                                             </span>
<span  style=""> 208                                                                                                                    </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 209      private String buildKey(List&lt;Object&gt; equalValList) {                                                          </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 210          StringBuilder sb = new StringBuilder(&quot;&quot;);                                                                 </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 211          for (Object equalVal : equalValList) {                                                                    </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 212              sb.append(equalVal).append(&quot;_&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 213          }                                                                                                         </span>
<span  style=""> 214                                                                                                                    </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 215          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216      }                                                                                                             </span>
<span  style=""> 217                                                                                                                    </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 218      private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                               </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 219          StringBuilder sb = new StringBuilder(&quot;&quot;);                                                                 </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 220          for (String equalField : equalFieldList) {                                                                </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 221              sb.append(val.get(equalField)).append(&quot;_&quot;);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 222          }                                                                                                         </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 223          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 224      }                                                                                                             </span>
<span  style=""> 225                                                                                                                    </span>
<span class="-1110060986504237489" onmouseenter="enter('-1110060986504237489');" onmouseout="out('-1110060986504237489');" style=""> 226      private KuduScanner getConn(KuduSideTableInfo tableInfo) {                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 227          try {                                                                                                     </span>
<span class="5852398308261929617" onmouseenter="enter('5852398308261929617');" onmouseout="out('5852398308261929617');" style=""> 228              if (client == null) {                                                                                 </span>
<span class="6663968999840548385" onmouseenter="enter('6663968999840548385');" onmouseout="out('6663968999840548385');" style=""> 229                  String kuduMasters = tableInfo.getKuduMasters();                                                  </span>
<span class="-557099550710151869" onmouseenter="enter('-557099550710151869');" onmouseout="out('-557099550710151869');" style=""> 230                  String tableName = tableInfo.getTableName();                                                      </span>
<span class="9112523977520204345" onmouseenter="enter('9112523977520204345');" onmouseout="out('9112523977520204345');" style=""> 231                  Integer workerCount = tableInfo.getWorkerCount();                                                 </span>
<span class="6969473062611895" onmouseenter="enter('6969473062611895');" onmouseout="out('6969473062611895');" style=""> 232                  Integer defaultSocketReadTimeoutMs = tableInfo.getDefaultSocketReadTimeoutMs();                   </span>
<span class="-1083775279901428778" onmouseenter="enter('-1083775279901428778');" onmouseout="out('-1083775279901428778');" style=""> 233                  Integer defaultOperationTimeoutMs = tableInfo.getDefaultOperationTimeoutMs();                     </span>
<span  style=""> 234                                                                                                                    </span>
<span class="-6052455991030570635" onmouseenter="enter('-6052455991030570635');" onmouseout="out('-6052455991030570635');" style=""> 235                  Preconditions.checkNotNull(kuduMasters, &quot;kuduMasters could not be null&quot;);                         </span>
<span  style=""> 236                                                                                                                    </span>
<span class="6323058657488852255" onmouseenter="enter('6323058657488852255');" onmouseout="out('6323058657488852255');" style=""> 237                  KuduClient.KuduClientBuilder kuduClientBuilder = new KuduClient.KuduClientBuilder(kuduMasters);   </span>
<span class="-8227759523178082238" onmouseenter="enter('-8227759523178082238');" onmouseout="out('-8227759523178082238');" style=""> 238                  if (null != workerCount) {                                                                        </span>
<span class="7330416389256434067" onmouseenter="enter('7330416389256434067');" onmouseout="out('7330416389256434067');" style=""> 239                      kuduClientBuilder.workerCount(workerCount);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 240                  }                                                                                                 </span>
<span  style=""> 241                                                                                                                    </span>
<span class="-2397215110746175709" onmouseenter="enter('-2397215110746175709');" onmouseout="out('-2397215110746175709');" style=""> 242                  if (null != defaultOperationTimeoutMs) {                                                          </span>
<span class="2898164840518299373" onmouseenter="enter('2898164840518299373');" onmouseout="out('2898164840518299373');" style=""> 243                      kuduClientBuilder.defaultOperationTimeoutMs(defaultOperationTimeoutMs);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 244                  }                                                                                                 </span>
<span class="4908267423182375675" onmouseenter="enter('4908267423182375675');" onmouseout="out('4908267423182375675');" style=""> 245                  client = kuduClientBuilder.build();                                                               </span>
<span  style=""> 246                                                                                                                    </span>
<span class="5439625390486835368" onmouseenter="enter('5439625390486835368');" onmouseout="out('5439625390486835368');" style=""> 247                  if (!client.tableExists(tableName)) {                                                             </span>
<span class="4123299035781055923" onmouseenter="enter('4123299035781055923');" onmouseout="out('4123299035781055923');" style=""> 248                      throw new IllegalArgumentException(&quot;Table Open Failed , please check table exists&quot;);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 249                  }                                                                                                 </span>
<span class="-2001660784391926307" onmouseenter="enter('-2001660784391926307');" onmouseout="out('-2001660784391926307');" style=""> 250                  table = client.openTable(tableName);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 251              }                                                                                                     </span>
<span class="6789989036272871448" onmouseenter="enter('6789989036272871448');" onmouseout="out('6789989036272871448');" style=""> 252              Schema schema = table.getSchema();                                                                    </span>
<span class="4608914853005352034" onmouseenter="enter('4608914853005352034');" onmouseout="out('4608914853005352034');" style=""> 253              KuduScanner.KuduScannerBuilder tokenBuilder = client.newScannerBuilder(table);                        </span>
<span class="-4750737985114959418" onmouseenter="enter('-4750737985114959418');" onmouseout="out('-4750737985114959418');" style=""> 254              return buildScanner(tokenBuilder, schema, tableInfo);                                                 </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 255          } catch (Exception e) {                                                                                   </span>
<span class="-2537427276397986072" onmouseenter="enter('-2537427276397986072');" onmouseout="out('-2537427276397986072');" style=""> 256              LOG.error(&quot;connect kudu is error:&quot; + e.getMessage());                                                 </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 257              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 258          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 259      }                                                                                                             </span>
<span  style=""> 260                                                                                                                    </span>
<span  style=""> 261                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 262      /**                                                                                                           </span>
<span class="-1458033306623281405" onmouseenter="enter('-1458033306623281405');" onmouseout="out('-1458033306623281405');" style=""> 263       * @param builder   创建AsyncKuduScanner对象                                                                      </span>
<span class="2461494225329490181" onmouseenter="enter('2461494225329490181');" onmouseout="out('2461494225329490181');" style=""> 264       * @param schema    kudu中表约束                                                                                  </span>
<span class="-2064584549205697250" onmouseenter="enter('-2064584549205697250');" onmouseout="out('-2064584549205697250');" style=""> 265       * @param tableInfo AsyncKuduScanner的配置信息                                                                     </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 266       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 267       */                                                                                                           </span>
<span class="2867837401631125856" onmouseenter="enter('2867837401631125856');" onmouseout="out('2867837401631125856');" style=""><abbr title=" 268      private KuduScanner buildScanner(KuduScanner.KuduScannerBuilder builder, Schema schema, KuduSideTableInfo tableInfo) {"> 268      private KuduScanner buildScanner(KuduScanner.KuduScannerBuilder builder, Schema schema, KuduSideTableInfo tabl🔵</abbr></span>
<span class="8886111092133146967" onmouseenter="enter('8886111092133146967');" onmouseout="out('8886111092133146967');" style=""> 269          Integer batchSizeBytes = tableInfo.getBatchSizeBytes();                                                   </span>
<span class="7808553397779189452" onmouseenter="enter('7808553397779189452');" onmouseout="out('7808553397779189452');" style=""> 270          Long limitNum = tableInfo.getLimitNum();                                                                  </span>
<span class="-3208642476437503495" onmouseenter="enter('-3208642476437503495');" onmouseout="out('-3208642476437503495');" style=""> 271          Boolean isFaultTolerant = tableInfo.getFaultTolerant();                                                   </span>
<span class="-8526639943056837274" onmouseenter="enter('-8526639943056837274');" onmouseout="out('-8526639943056837274');" style=""> 272          //查询需要的字段                                                                                                 </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 273          String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                         </span>
<span class="8148679338456729713" onmouseenter="enter('8148679338456729713');" onmouseout="out('8148679338456729713');" style=""> 274          //主键过滤条件 主键最小值                                                                                            </span>
<span class="774304746758482808" onmouseenter="enter('774304746758482808');" onmouseout="out('774304746758482808');" style=""> 275          String lowerBoundPrimaryKey = tableInfo.getLowerBoundPrimaryKey();                                        </span>
<span class="-4956716841620057294" onmouseenter="enter('-4956716841620057294');" onmouseout="out('-4956716841620057294');" style=""> 276          //主键过滤条件 主键最大值                                                                                            </span>
<span class="-7517771237746601096" onmouseenter="enter('-7517771237746601096');" onmouseout="out('-7517771237746601096');" style=""> 277          String upperBoundPrimaryKey = tableInfo.getUpperBoundPrimaryKey();                                        </span>
<span class="-3636378559400202691" onmouseenter="enter('-3636378559400202691');" onmouseout="out('-3636378559400202691');" style=""> 278          //主键字段                                                                                                    </span>
<span class="5200352787312582461" onmouseenter="enter('5200352787312582461');" onmouseout="out('5200352787312582461');" style=""> 279          String primaryKeys = tableInfo.getPrimaryKey();                                                           </span>
<span class="-8080913465496496419" onmouseenter="enter('-8080913465496496419');" onmouseout="out('-8080913465496496419');" style=""> 280          if (null == limitNum || limitNum &lt;= 0) {                                                                  </span>
<span class="-4868625127437582675" onmouseenter="enter('-4868625127437582675');" onmouseout="out('-4868625127437582675');" style=""> 281              builder.limit(FETCH_SIZE);                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 282          } else {                                                                                                  </span>
<span class="4444562149069843980" onmouseenter="enter('4444562149069843980');" onmouseout="out('4444562149069843980');" style=""> 283              builder.limit(limitNum);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284          }                                                                                                         </span>
<span class="-5740110908714073879" onmouseenter="enter('-5740110908714073879');" onmouseout="out('-5740110908714073879');" style=""> 285          if (null != batchSizeBytes) {                                                                             </span>
<span class="732524166722318272" onmouseenter="enter('732524166722318272');" onmouseout="out('732524166722318272');" style=""> 286              builder.batchSizeBytes(batchSizeBytes);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 287          }                                                                                                         </span>
<span class="-8680730272034558637" onmouseenter="enter('-8680730272034558637');" onmouseout="out('-8680730272034558637');" style=""> 288          if (null != isFaultTolerant) {                                                                            </span>
<span class="-2751626226784684126" onmouseenter="enter('-2751626226784684126');" onmouseout="out('-2751626226784684126');" style=""> 289              builder.setFaultTolerant(isFaultTolerant);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 290          }                                                                                                         </span>
<span class="-5863912479223093982" onmouseenter="enter('-5863912479223093982');" onmouseout="out('-5863912479223093982');" style=""> 291          //  填充谓词信息                                                                                                </span>
<span class="-8839623202504591157" onmouseenter="enter('-8839623202504591157');" onmouseout="out('-8839623202504591157');" style=""> 292          List&lt;PredicateInfo&gt; predicateInfoes = sideInfo.getSideTableInfo().getPredicateInfoes();                   </span>
<span class="1131384255148676390" onmouseenter="enter('1131384255148676390');" onmouseout="out('1131384255148676390');" style=""> 293          if (predicateInfoes.size() &gt; 0) {                                                                         </span>
<span class="7087000648291367893" onmouseenter="enter('7087000648291367893');" onmouseout="out('7087000648291367893');" style=""> 294              predicateInfoes.stream().map(info -&gt; {                                                                </span>
<span class="-3754680470381432050" onmouseenter="enter('-3754680470381432050');" onmouseout="out('-3754680470381432050');" style=""> 295                  KuduPredicate kuduPredicate = KuduUtil.buildKuduPredicate(schema, info);                          </span>
<span class="8493928812165156395" onmouseenter="enter('8493928812165156395');" onmouseout="out('8493928812165156395');" style=""> 296                  if (null != kuduPredicate) {                                                                      </span>
<span class="-7750601395793408087" onmouseenter="enter('-7750601395793408087');" onmouseout="out('-7750601395793408087');" style=""> 297                      builder.addPredicate(kuduPredicate);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 298                  }                                                                                                 </span>
<span class="-3556780733195614200" onmouseenter="enter('-3556780733195614200');" onmouseout="out('-3556780733195614200');" style=""> 299                  return info;                                                                                      </span>
<span class="3075434854107094892" onmouseenter="enter('3075434854107094892');" onmouseout="out('3075434854107094892');" style=""> 300              }).count();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 301          }                                                                                                         </span>
<span  style=""> 302                                                                                                                    </span>
<span class="5058160594792466993" onmouseenter="enter('5058160594792466993');" onmouseout="out('5058160594792466993');" style=""> 303          if (null != lowerBoundPrimaryKey &amp;&amp; null != upperBoundPrimaryKey &amp;&amp; null != primaryKeys) {                </span>
<span class="5137789214991290203" onmouseenter="enter('5137789214991290203');" onmouseout="out('5137789214991290203');" style=""> 304              List&lt;ColumnSchema&gt; columnSchemas = schema.getPrimaryKeyColumns();                                     </span>
<span class="-9153585758974253186" onmouseenter="enter('-9153585758974253186');" onmouseout="out('-9153585758974253186');" style=""> 305              Map&lt;String, Integer&gt; columnName = new HashMap&lt;String, Integer&gt;(columnSchemas.size());                 </span>
<span class="-8501863997026521914" onmouseenter="enter('-8501863997026521914');" onmouseout="out('-8501863997026521914');" style=""> 306              for (int i = 0; i &lt; columnSchemas.size(); i++) {                                                      </span>
<span class="5688298920213282235" onmouseenter="enter('5688298920213282235');" onmouseout="out('5688298920213282235');" style=""> 307                  columnName.put(columnSchemas.get(i).getName(), i);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 308              }                                                                                                     </span>
<span class="9190792110333311829" onmouseenter="enter('9190792110333311829');" onmouseout="out('9190792110333311829');" style=""> 309              String[] primaryKey = splitString(primaryKeys);                                                       </span>
<span class="8892393707780373743" onmouseenter="enter('8892393707780373743');" onmouseout="out('8892393707780373743');" style=""> 310              String[] lowerBounds = splitString(lowerBoundPrimaryKey);                                             </span>
<span class="-609605915884017391" onmouseenter="enter('-609605915884017391');" onmouseout="out('-609605915884017391');" style=""> 311              String[] upperBounds = splitString(upperBoundPrimaryKey);                                             </span>
<span class="4494391771595015869" onmouseenter="enter('4494391771595015869');" onmouseout="out('4494391771595015869');" style=""> 312              PartialRow lowerPartialRow = schema.newPartialRow();                                                  </span>
<span class="8816033343726193199" onmouseenter="enter('8816033343726193199');" onmouseout="out('8816033343726193199');" style=""> 313              PartialRow upperPartialRow = schema.newPartialRow();                                                  </span>
<span class="-8968328790125117730" onmouseenter="enter('-8968328790125117730');" onmouseout="out('-8968328790125117730');" style=""> 314              for (int i = 0; i &lt; primaryKey.length; i++) {                                                         </span>
<span class="-7469830342865795482" onmouseenter="enter('-7469830342865795482');" onmouseout="out('-7469830342865795482');" style=""> 315                  Integer index = columnName.get(primaryKey[i]);                                                    </span>
<span class="9077186300921558226" onmouseenter="enter('9077186300921558226');" onmouseout="out('9077186300921558226');" style=""><abbr title=" 316                  KuduUtil.primaryKeyRange(lowerPartialRow, columnSchemas.get(index).getType(), primaryKey[i], lowerBounds[i]);"> 316                  KuduUtil.primaryKeyRange(lowerPartialRow, columnSchemas.get(index).getType(), primaryKey[i], lower🔵</abbr></span>
<span class="1719939722143080272" onmouseenter="enter('1719939722143080272');" onmouseout="out('1719939722143080272');" style=""><abbr title=" 317                  KuduUtil.primaryKeyRange(upperPartialRow, columnSchemas.get(index).getType(), primaryKey[i], upperBounds[i]);"> 317                  KuduUtil.primaryKeyRange(upperPartialRow, columnSchemas.get(index).getType(), primaryKey[i], upper🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318              }                                                                                                     </span>
<span class="-4326832194787526924" onmouseenter="enter('-4326832194787526924');" onmouseout="out('-4326832194787526924');" style=""> 319              builder.lowerBound(lowerPartialRow);                                                                  </span>
<span class="-1145836739913025748" onmouseenter="enter('-1145836739913025748');" onmouseout="out('-1145836739913025748');" style=""> 320              builder.exclusiveUpperBound(upperPartialRow);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 321          }                                                                                                         </span>
<span class="6330664272177173056" onmouseenter="enter('6330664272177173056');" onmouseout="out('6330664272177173056');" style=""> 322          List&lt;String&gt; projectColumns = Arrays.asList(sideFieldNames);                                              </span>
<span class="5674897199079825382" onmouseenter="enter('5674897199079825382');" onmouseout="out('5674897199079825382');" style=""> 323          return builder.setProjectedColumnNames(projectColumns).build();                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 324      }                                                                                                             </span>
<span  style=""> 325                                                                                                                    </span>
<span class="7272585370217888157" onmouseenter="enter('7272585370217888157');" onmouseout="out('7272585370217888157');" style=""> 326      private String[] splitString(String data) {                                                                   </span>
<span class="6835810800556100983" onmouseenter="enter('6835810800556100983');" onmouseout="out('6835810800556100983');" style=""> 327          return StringUtils.split(data, &quot;,&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 328      }                                                                                                             </span>
<span  style=""> 329                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 330      @Override                                                                                                     </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 331      public void close() throws Exception {                                                                        </span>
<span class="-8885801519389600338" onmouseenter="enter('-8885801519389600338');" onmouseout="out('-8885801519389600338');" style=""> 332          //公用一个client  如果每次刷新间隔时间较长可以每次获取一个                                                                        </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 333          super.close();                                                                                            </span>
<span class="5794975028458899729" onmouseenter="enter('5794975028458899729');" onmouseout="out('5794975028458899729');" style=""> 334          if (null != client) {                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 335              try {                                                                                                 </span>
<span class="2670944726041732440" onmouseenter="enter('2670944726041732440');" onmouseout="out('2670944726041732440');" style=""> 336                  client.close();                                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 337              } catch (Exception e) {                                                                               </span>
<span class="7169708839653618971" onmouseenter="enter('7169708839653618971');" onmouseout="out('7169708839653618971');" style=""> 338                  LOG.error(&quot;Error while closing client.&quot;, e);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 339              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 340          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 341      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 342  }                                                                                                                 </span></pre></td>
                            <td><pre><span class="-8840953368027741170" onmouseenter="enter('-8840953368027741170');" onmouseout="out('-8840953368027741170');" style="">   1  package com.dtstack.flink.sql.side.kudu;                                                                          </span>
<span  style="">   2                                                                                                                    </span>
<span class="-3234447159222354960" onmouseenter="enter('-3234447159222354960');" onmouseout="out('-3234447159222354960');" style="">   3  import com.dtstack.flink.sql.side.BaseAllReqRow;                                                                  </span>
<span class="-5905762190260359492" onmouseenter="enter('-5905762190260359492');" onmouseout="out('-5905762190260359492');" style="">   4  import com.dtstack.flink.sql.side.FieldInfo;                                                                      </span>
<span class="4308167670354000439" onmouseenter="enter('4308167670354000439');" onmouseout="out('4308167670354000439');" style="">   5  import com.dtstack.flink.sql.side.JoinInfo;                                                                       </span>
<span class="1614892075588798997" onmouseenter="enter('1614892075588798997');" onmouseout="out('1614892075588798997');" style="">   6  import com.dtstack.flink.sql.side.PredicateInfo;                                                                  </span>
<span class="-5430766829085710530" onmouseenter="enter('-5430766829085710530');" onmouseout="out('-5430766829085710530');" style="">   7  import com.dtstack.flink.sql.side.AbstractSideTableInfo;                                                          </span>
<span class="5710642889135375263" onmouseenter="enter('5710642889135375263');" onmouseout="out('5710642889135375263');" style="">   8  import com.dtstack.flink.sql.side.kudu.table.KuduSideTableInfo;                                                   </span>
<span class="1164335795537447661" onmouseenter="enter('1164335795537447661');" onmouseout="out('1164335795537447661');" style="">   9  import com.dtstack.flink.sql.side.kudu.utils.KuduUtil;                                                            </span>

<span class="2669046595140278855" onmouseenter="enter('2669046595140278855');" onmouseout="out('2669046595140278855');" style="">  10  import com.google.common.base.Preconditions;                                                                      </span>
<span class="5160316076043229327" onmouseenter="enter('5160316076043229327');" onmouseout="out('5160316076043229327');" style="">  11  import com.google.common.collect.Lists;                                                                           </span>
<span class="-4819102165053109383" onmouseenter="enter('-4819102165053109383');" onmouseout="out('-4819102165053109383');" style="">  12  import com.google.common.collect.Maps;                                                                            </span>
<span class="8584998077480306668" onmouseenter="enter('8584998077480306668');" onmouseout="out('8584998077480306668');" style="">  13  import org.apache.calcite.sql.JoinType;                                                                           </span>
<span class="8596464405353709537" onmouseenter="enter('8596464405353709537');" onmouseout="out('8596464405353709537');" style="">  14  import org.apache.commons.collections.CollectionUtils;                                                            </span>
<span class="-8105670274694144339" onmouseenter="enter('-8105670274694144339');" onmouseout="out('-8105670274694144339');" style="">  15  import org.apache.commons.lang3.StringUtils;                                                                      </span>

<span class="7106985530640289051" onmouseenter="enter('7106985530640289051');" onmouseout="out('7106985530640289051');" style="">  16  import org.apache.flink.api.java.typeutils.RowTypeInfo;                                                           </span>
<span class="3883198981410010526" onmouseenter="enter('3883198981410010526');" onmouseout="out('3883198981410010526');" style="">  17  import org.apache.flink.table.runtime.types.CRow;                                                                 </span>
<span class="7274147440675030535" onmouseenter="enter('7274147440675030535');" onmouseout="out('7274147440675030535');" style="">  18  import org.apache.flink.table.typeutils.TimeIndicatorTypeInfo;                                                    </span>

<span class="2962496049409651976" onmouseenter="enter('2962496049409651976');" onmouseout="out('2962496049409651976');" style="">  19  import org.apache.flink.types.Row;                                                                                </span>
<span class="1346044542033208814" onmouseenter="enter('1346044542033208814');" onmouseout="out('1346044542033208814');" style="">  20  import org.apache.flink.util.Collector;                                                                           </span>
<span class="1631232015531818624" onmouseenter="enter('1631232015531818624');" onmouseout="out('1631232015531818624');" style="">  21  import org.apache.kudu.ColumnSchema;                                                                              </span>
<span class="-1755042893780385624" onmouseenter="enter('-1755042893780385624');" onmouseout="out('-1755042893780385624');" style="">  22  import org.apache.kudu.Schema;                                                                                    </span>
<span class="2263873766708549976" onmouseenter="enter('2263873766708549976');" onmouseout="out('2263873766708549976');" style="">  23  import org.apache.kudu.client.KuduClient;                                                                         </span>
<span class="1860194643195428903" onmouseenter="enter('1860194643195428903');" onmouseout="out('1860194643195428903');" style="">  24  import org.apache.kudu.client.KuduException;                                                                      </span>
<span class="128288131530978478" onmouseenter="enter('128288131530978478');" onmouseout="out('128288131530978478');" style="">  25  import org.apache.kudu.client.KuduPredicate;                                                                      </span>
<span class="-8538417097591974568" onmouseenter="enter('-8538417097591974568');" onmouseout="out('-8538417097591974568');" style="">  26  import org.apache.kudu.client.KuduScanner;                                                                        </span>
<span class="-342692776902705676" onmouseenter="enter('-342692776902705676');" onmouseout="out('-342692776902705676');" style="">  27  import org.apache.kudu.client.KuduTable;                                                                          </span>
<span class="629701943397612117" onmouseenter="enter('629701943397612117');" onmouseout="out('629701943397612117');" style="">  28  import org.apache.kudu.client.PartialRow;                                                                         </span>
<span class="-6157621177665621032" onmouseenter="enter('-6157621177665621032');" onmouseout="out('-6157621177665621032');" style="">  29  import org.apache.kudu.client.RowResult;                                                                          </span>
<span class="-1845673204769190809" onmouseenter="enter('-1845673204769190809');" onmouseout="out('-1845673204769190809');" style="">  30  import org.apache.kudu.client.RowResultIterator;                                                                  </span>
<span class="9072327285961251154" onmouseenter="enter('9072327285961251154');" onmouseout="out('9072327285961251154');" style="">  31  import org.slf4j.Logger;                                                                                          </span>
<span class="697043352225962606" onmouseenter="enter('697043352225962606');" onmouseout="out('697043352225962606');" style="">  32  import org.slf4j.LoggerFactory;                                                                                   </span>
<span  style="">  33                                                                                                                    </span>
<span class="-515559982825150111" onmouseenter="enter('-515559982825150111');" onmouseout="out('-515559982825150111');" style="">  34  import java.sql.SQLException;                                                                                     </span>
<span class="-8993555010225969077" onmouseenter="enter('-8993555010225969077');" onmouseout="out('-8993555010225969077');" style="">  35  import java.sql.Timestamp;                                                                                        </span>
<span class="-28465676010609596" onmouseenter="enter('-28465676010609596');" onmouseout="out('-28465676010609596');" style="">  36  import java.util.Arrays;                                                                                          </span>
<span class="1562735530241225598" onmouseenter="enter('1562735530241225598');" onmouseout="out('1562735530241225598');" style="">  37  import java.util.Calendar;                                                                                        </span>
<span class="4169599896190320038" onmouseenter="enter('4169599896190320038');" onmouseout="out('4169599896190320038');" style="">  38  import java.util.HashMap;                                                                                         </span>
<span class="-1786020958497218848" onmouseenter="enter('-1786020958497218848');" onmouseout="out('-1786020958497218848');" style="">  39  import java.util.List;                                                                                            </span>
<span class="6618655971923850695" onmouseenter="enter('6618655971923850695');" onmouseout="out('6618655971923850695');" style="">  40  import java.util.Map;                                                                                             </span>
<span class="1679953027169218497" onmouseenter="enter('1679953027169218497');" onmouseout="out('1679953027169218497');" style="">  41  import java.util.concurrent.atomic.AtomicReference;                                                               </span>
<span  style="">  42                                                                                                                    </span>
<span class="1178418458023894230" onmouseenter="enter('1178418458023894230');" onmouseout="out('1178418458023894230');" style="">  43  public class KuduAllReqRow extends BaseAllReqRow {                                                                </span>
<span  style="">  44                                                                                                                    </span>
<span class="2664279006928748303" onmouseenter="enter('2664279006928748303');" onmouseout="out('2664279006928748303');" style="">  45      private static final long serialVersionUID = 6051774809356082219L;                                            </span>
<span  style="">  46                                                                                                                    </span>
<span class="-7779246735798526406" onmouseenter="enter('-7779246735798526406');" onmouseout="out('-7779246735798526406');" style="">  47      private static final Logger LOG = LoggerFactory.getLogger(KuduAllReqRow.class);                               </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  48      /**                                                                                                           </span>
<span class="-8285284077529796986" onmouseenter="enter('-8285284077529796986');" onmouseout="out('-8285284077529796986');" style="">  49       * 获取连接的尝试次数                                                                                                  </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  50       */                                                                                                           </span>
<span class="-1089202172816726338" onmouseenter="enter('-1089202172816726338');" onmouseout="out('-1089202172816726338');" style="">  51      private static final int CONN_RETRY_NUM = 3;                                                                  </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style="">  52      /**                                                                                                           </span>
<span class="4062789252244833512" onmouseenter="enter('4062789252244833512');" onmouseout="out('4062789252244833512');" style="">  53       * 缓存条数                                                                                                       </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style="">  54       */                                                                                                           </span>
<span class="1004470848600586149" onmouseenter="enter('1004470848600586149');" onmouseout="out('1004470848600586149');" style="">  55      private static final Long FETCH_SIZE = 1000L;                                                                 </span>
<span  style="">  56                                                                                                                    </span>
<span class="-2539961354521398263" onmouseenter="enter('-2539961354521398263');" onmouseout="out('-2539961354521398263');" style="">  57      private KuduClient client;                                                                                    </span>
<span  style="">  58                                                                                                                    </span>
<span class="1317689277640300307" onmouseenter="enter('1317689277640300307');" onmouseout="out('1317689277640300307');" style="">  59      private KuduTable table;                                                                                      </span>
<span  style="">  60                                                                                                                    </span>
<span  style="">  61                                                                                                                    </span>
<span class="-7577472535122019185" onmouseenter="enter('-7577472535122019185');" onmouseout="out('-7577472535122019185');" style="">  62      private AtomicReference&lt;Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt;&gt; cacheRef = new AtomicReference&lt;&gt;();           </span>
<span  style="">  63                                                                                                                    </span>
<span class="6616997293382437533" onmouseenter="enter('6616997293382437533');" onmouseout="out('6616997293382437533');" style=""><abbr title="  64      public KuduAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSideTableInfo sideTableInfo) {">  64      public KuduAllReqRow(RowTypeInfo rowTypeInfo, JoinInfo joinInfo, List&lt;FieldInfo&gt; outFieldInfoList, AbstractSid🔵</abbr></span>
<span class="8698115236286713015" onmouseenter="enter('8698115236286713015');" onmouseout="out('8698115236286713015');" style="">  65          super(new KuduAllSideInfo(rowTypeInfo, joinInfo, outFieldInfoList, sideTableInfo));                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  66      }                                                                                                             </span>
<span  style="">  67                                                                                                                    </span>
<span  style="">  68                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  69      @Override                                                                                                     </span>
<span class="-1458639347103910534" onmouseenter="enter('-1458639347103910534');" onmouseout="out('-1458639347103910534');" style="">  70      public Row fillData(Row input, Object sideInput) {                                                            </span>
<span class="7096347511226230072" onmouseenter="enter('7096347511226230072');" onmouseout="out('7096347511226230072');" style="">  71          Map&lt;String, Object&gt; cacheInfo = (Map&lt;String, Object&gt;) sideInput;                                          </span>
<span class="-1702812097453380901" onmouseenter="enter('-1702812097453380901');" onmouseout="out('-1702812097453380901');" style="">  72          Row row = new Row(sideInfo.getOutFieldInfoList().size());                                                 </span>
<span class="-8193044176423310947" onmouseenter="enter('-8193044176423310947');" onmouseout="out('-8193044176423310947');" style="">  73          for (Map.Entry&lt;Integer, Integer&gt; entry : sideInfo.getInFieldIndex().entrySet()) {                         </span>
<span class="-7924116429603597548" onmouseenter="enter('-7924116429603597548');" onmouseout="out('-7924116429603597548');" style="">  74              Object obj = input.getField(entry.getValue());                                                        </span>
<span class="1294569248385804264" onmouseenter="enter('1294569248385804264');" onmouseout="out('1294569248385804264');" style=""><abbr title="  75              boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo().getTypeAt(entry.getValue()).getClass());">  75              boolean isTimeIndicatorTypeInfo = TimeIndicatorTypeInfo.class.isAssignableFrom(sideInfo.getRowTypeInfo🔵</abbr></span>
<span  style="">  76                                                                                                                    </span>
<span class="-3282491156107731631" onmouseenter="enter('-3282491156107731631');" onmouseout="out('-3282491156107731631');" style=""><abbr title="  77              //Type information for indicating event or processing time. However, it behaves like a regular SQL timestamp but is serialized as Long.">  77              //Type information for indicating event or processing time. However, it behaves like a regular SQL tim🔵</abbr></span>
<span class="-1760550867550091637" onmouseenter="enter('-1760550867550091637');" onmouseout="out('-1760550867550091637');" style="">  78              if (obj instanceof Timestamp &amp;&amp; isTimeIndicatorTypeInfo) {                                            </span>
<span class="-7982351818108202915" onmouseenter="enter('-7982351818108202915');" onmouseout="out('-7982351818108202915');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  79 -                obj = ((Timestamp) obj).getTime();                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(255, 0, 0, 0.2); margin: 0">  80 -            }                                                                                                     </span>
<span class="7026776415410804970" onmouseenter="enter('7026776415410804970');" onmouseout="out('7026776415410804970');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  81 +                //去除上一层OutputRowtimeProcessFunction 调用时区导致的影响                                                     </span>
<span class="3124996113274784768" onmouseenter="enter('3124996113274784768');" onmouseout="out('3124996113274784768');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  82 +                obj = ((Timestamp) obj).getTime() + (long)LOCAL_TZ.getOffset(((Timestamp) obj).getTime());        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  83 +            }                                                                                                     </span>
<span  style="background-color: rgba(0, 255, 0, 0.2); margin: 0">  84 +                                                                                                                  </span>
<span class="1088133213948185292" onmouseenter="enter('1088133213948185292');" onmouseout="out('1088133213948185292');" style="">  85              row.setField(entry.getKey(), obj);                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  86          }                                                                                                         </span>
<span  style="">  87                                                                                                                    </span>
<span class="-4063777341066712786" onmouseenter="enter('-4063777341066712786');" onmouseout="out('-4063777341066712786');" style="">  88          for (Map.Entry&lt;Integer, String&gt; entry : sideInfo.getSideFieldNameIndex().entrySet()) {                    </span>
<span class="-7181958017753483377" onmouseenter="enter('-7181958017753483377');" onmouseout="out('-7181958017753483377');" style="">  89              if (cacheInfo == null) {                                                                              </span>
<span class="5616946410045751481" onmouseenter="enter('5616946410045751481');" onmouseout="out('5616946410045751481');" style="">  90                  row.setField(entry.getKey(), null);                                                               </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style="">  91              } else {                                                                                              </span>
<span class="-6152510067760557074" onmouseenter="enter('-6152510067760557074');" onmouseout="out('-6152510067760557074');" style="">  92                  row.setField(entry.getKey(), cacheInfo.get(entry.getValue()));                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  93              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  94          }                                                                                                         </span>
<span  style="">  95                                                                                                                    </span>
<span class="-5244399426660521116" onmouseenter="enter('-5244399426660521116');" onmouseout="out('-5244399426660521116');" style="">  96          return row;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style="">  97      }                                                                                                             </span>
<span  style="">  98                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style="">  99      @Override                                                                                                     </span>
<span class="-5452513235343270061" onmouseenter="enter('-5452513235343270061');" onmouseout="out('-5452513235343270061');" style=""> 100      protected void initCache() throws SQLException {                                                              </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 101          Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                                </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 102          cacheRef.set(newCache);                                                                                   </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 103          loadData(newCache);                                                                                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 104      }                                                                                                             </span>
<span  style=""> 105                                                                                                                    </span>
<span  style=""> 106                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 107      @Override                                                                                                     </span>
<span class="-4105217794988998851" onmouseenter="enter('-4105217794988998851');" onmouseout="out('-4105217794988998851');" style=""> 108      protected void reloadCache() {                                                                                </span>
<span class="-8133637885610908316" onmouseenter="enter('-8133637885610908316');" onmouseout="out('-8133637885610908316');" style=""> 109          //reload cacheRef and replace to old cacheRef                                                             </span>
<span class="-5807107642820157805" onmouseenter="enter('-5807107642820157805');" onmouseout="out('-5807107642820157805');" style=""> 110          Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; newCache = Maps.newConcurrentMap();                                </span>
<span class="4058495330924526863" onmouseenter="enter('4058495330924526863');" onmouseout="out('4058495330924526863');" style=""> 111          loadData(newCache);                                                                                       </span>
<span  style=""> 112                                                                                                                    </span>
<span class="3251986844773875910" onmouseenter="enter('3251986844773875910');" onmouseout="out('3251986844773875910');" style=""> 113          cacheRef.set(newCache);                                                                                   </span>
<span class="-5375691814117803209" onmouseenter="enter('-5375691814117803209');" onmouseout="out('-5375691814117803209');" style=""> 114          LOG.info(&quot;----- kudu all cacheRef reload end:{}&quot;, Calendar.getInstance());                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 115      }                                                                                                             </span>
<span  style=""> 116                                                                                                                    </span>
<span  style=""> 117                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 118      @Override                                                                                                     </span>
<span class="2657010695143174651" onmouseenter="enter('2657010695143174651');" onmouseout="out('2657010695143174651');" style=""> 119      public void flatMap(CRow input, Collector&lt;CRow&gt; out) throws Exception {                                       </span>

<span class="1294520002002775526" onmouseenter="enter('1294520002002775526');" onmouseout="out('1294520002002775526');" style=""> 120          List&lt;Object&gt; inputParams = Lists.newArrayList();                                                          </span>
<span class="1792900147144305199" onmouseenter="enter('1792900147144305199');" onmouseout="out('1792900147144305199');" style=""> 121          for (Integer conValIndex : sideInfo.getEqualValIndex()) {                                                 </span>
<span class="-1571322702847153161" onmouseenter="enter('-1571322702847153161');" onmouseout="out('-1571322702847153161');" style=""> 122              Object equalObj = input.row().getField(conValIndex);                                                  </span>

<span class="5023013325339684340" onmouseenter="enter('5023013325339684340');" onmouseout="out('5023013325339684340');" style=""> 123              if (equalObj == null) {                                                                               </span>
<span class="2802501092059214558" onmouseenter="enter('2802501092059214558');" onmouseout="out('2802501092059214558');" style=""> 124                  out.collect(null);                                                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 125              }                                                                                                     </span>
<span class="5224882790029280870" onmouseenter="enter('5224882790029280870');" onmouseout="out('5224882790029280870');" style=""> 126              inputParams.add(equalObj);                                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 127          }                                                                                                         </span>
<span  style=""> 128                                                                                                                    </span>
<span class="-2047511138147401943" onmouseenter="enter('-2047511138147401943');" onmouseout="out('-2047511138147401943');" style=""> 129          String key = buildKey(inputParams);                                                                       </span>
<span class="-5594938501780727951" onmouseenter="enter('-5594938501780727951');" onmouseout="out('-5594938501780727951');" style=""> 130          List&lt;Map&lt;String, Object&gt;&gt; cacheList = cacheRef.get().get(key);                                            </span>
<span class="1459545416677641120" onmouseenter="enter('1459545416677641120');" onmouseout="out('1459545416677641120');" style=""> 131          if (CollectionUtils.isEmpty(cacheList)) {                                                                 </span>
<span class="3012505652182075436" onmouseenter="enter('3012505652182075436');" onmouseout="out('3012505652182075436');" style=""> 132              if (sideInfo.getJoinType() == JoinType.LEFT) {                                                        </span>
<span class="5500326757636101813" onmouseenter="enter('5500326757636101813');" onmouseout="out('5500326757636101813');" style=""> 133                  Row row = fillData(input.row(), null);                                                            </span>
<span class="-1652121101976271273" onmouseenter="enter('-1652121101976271273');" onmouseout="out('-1652121101976271273');" style=""> 134                  out.collect(new CRow(row, input.change()));                                                       </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 135              }                                                                                                     </span>
<span class="4043029072030362567" onmouseenter="enter('4043029072030362567');" onmouseout="out('4043029072030362567');" style=""> 136              return;                                                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 137          }                                                                                                         </span>
<span  style=""> 138                                                                                                                    </span>
<span class="3059596256951780520" onmouseenter="enter('3059596256951780520');" onmouseout="out('3059596256951780520');" style=""> 139          for (Map&lt;String, Object&gt; one : cacheList) {                                                               </span>
<span class="-1129401162237110043" onmouseenter="enter('-1129401162237110043');" onmouseout="out('-1129401162237110043');" style=""> 140              out.collect(new CRow(fillData(input.row(), one), input.change()));                                    </span>


<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 141          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 142      }                                                                                                             </span>
<span  style=""> 143                                                                                                                    </span>
<span class="961081247603323125" onmouseenter="enter('961081247603323125');" onmouseout="out('961081247603323125');" style=""> 144      private void loadData(Map&lt;String, List&lt;Map&lt;String, Object&gt;&gt;&gt; tmpCache) {                                      </span>
<span class="-5525344973390349168" onmouseenter="enter('-5525344973390349168');" onmouseout="out('-5525344973390349168');" style=""> 145          KuduSideTableInfo tableInfo = (KuduSideTableInfo) sideInfo.getSideTableInfo();                            </span>
<span class="4539652565484830811" onmouseenter="enter('4539652565484830811');" onmouseout="out('4539652565484830811');" style=""> 146          KuduScanner scanner = null;                                                                               </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 147          try {                                                                                                     </span>
<span class="-6421499674522058067" onmouseenter="enter('-6421499674522058067');" onmouseout="out('-6421499674522058067');" style=""> 148              for (int i = 0; i &lt; CONN_RETRY_NUM; i++) {                                                            </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 149                  try {                                                                                             </span>
<span class="3825928320653477879" onmouseenter="enter('3825928320653477879');" onmouseout="out('3825928320653477879');" style=""> 150                      scanner = getConn(tableInfo);                                                                 </span>
<span class="-7917104194997868056" onmouseenter="enter('-7917104194997868056');" onmouseout="out('-7917104194997868056');" style=""> 151                      break;                                                                                        </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 152                  } catch (Exception e) {                                                                           </span>
<span class="4323779701240883116" onmouseenter="enter('4323779701240883116');" onmouseout="out('4323779701240883116');" style=""> 153                      if (i == CONN_RETRY_NUM - 1) {                                                                </span>
<span class="-8002263274894148732" onmouseenter="enter('-8002263274894148732');" onmouseout="out('-8002263274894148732');" style=""> 154                          throw new RuntimeException(&quot;&quot;, e);                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 155                      }                                                                                             </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 156                      try {                                                                                         </span>
<span class="7214047305831580892" onmouseenter="enter('7214047305831580892');" onmouseout="out('7214047305831580892');" style=""><abbr title=" 157                          String connInfo = &quot;kuduMasters:&quot; + tableInfo.getKuduMasters() + &quot;;tableName:&quot; + tableInfo.getTableName();"> 157                          String connInfo = &quot;kuduMasters:&quot; + tableInfo.getKuduMasters() + &quot;;tableName:&quot; + tableInfo.🔵</abbr></span>
<span class="1909118789648291760" onmouseenter="enter('1909118789648291760');" onmouseout="out('1909118789648291760');" style=""> 158                          LOG.warn(&quot;get conn fail, wait for 5 sec and try again, connInfo:&quot; + connInfo);            </span>
<span class="-9127531774365832010" onmouseenter="enter('-9127531774365832010');" onmouseout="out('-9127531774365832010');" style=""> 159                          Thread.sleep(5 * 1000);                                                                   </span>
<span class="840155112142835670" onmouseenter="enter('840155112142835670');" onmouseout="out('840155112142835670');" style=""> 160                      } catch (InterruptedException e1) {                                                           </span>
<span class="4631440746187069452" onmouseenter="enter('4631440746187069452');" onmouseout="out('4631440746187069452');" style=""> 161                          LOG.error(&quot;&quot;,e1);                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 162                      }                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 163                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 164              }                                                                                                     </span>
<span class="475138084615438717" onmouseenter="enter('475138084615438717');" onmouseout="out('475138084615438717');" style=""> 165              //load data from table                                                                                </span>
<span class="3354690258641098597" onmouseenter="enter('3354690258641098597');" onmouseout="out('3354690258641098597');" style=""> 166              assert scanner != null;                                                                               </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 167              String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                     </span>
<span  style=""> 168                                                                                                                    </span>
<span  style=""> 169                                                                                                                    </span>
<span class="-7401034569209000676" onmouseenter="enter('-7401034569209000676');" onmouseout="out('-7401034569209000676');" style=""> 170              while (scanner.hasMoreRows()) {                                                                       </span>
<span class="-490557585705256586" onmouseenter="enter('-490557585705256586');" onmouseout="out('-490557585705256586');" style=""> 171                  RowResultIterator results = scanner.nextRows();                                                   </span>
<span class="5642997248258560969" onmouseenter="enter('5642997248258560969');" onmouseout="out('5642997248258560969');" style=""> 172                  while (results.hasNext()) {                                                                       </span>
<span class="7206031536241251649" onmouseenter="enter('7206031536241251649');" onmouseout="out('7206031536241251649');" style=""> 173                      RowResult result = results.next();                                                            </span>
<span class="-7707387193564908050" onmouseenter="enter('-7707387193564908050');" onmouseout="out('-7707387193564908050');" style=""> 174                      Map&lt;String, Object&gt; oneRow = Maps.newHashMap();                                               </span>
<span class="696829081573399723" onmouseenter="enter('696829081573399723');" onmouseout="out('696829081573399723');" style=""> 175                      for (String sideFieldName1 : sideFieldNames) {                                                </span>
<span class="5422300911827801712" onmouseenter="enter('5422300911827801712');" onmouseout="out('5422300911827801712');" style=""> 176                          String sideFieldName = sideFieldName1.trim();                                             </span>
<span class="-7396994512053753949" onmouseenter="enter('-7396994512053753949');" onmouseout="out('-7396994512053753949');" style=""> 177                          ColumnSchema columnSchema = table.getSchema().getColumn(sideFieldName);                   </span>
<span class="-1551001954350423389" onmouseenter="enter('-1551001954350423389');" onmouseout="out('-1551001954350423389');" style=""> 178                          if (null != columnSchema) {                                                               </span>
<span class="-9080618923968214410" onmouseenter="enter('-9080618923968214410');" onmouseout="out('-9080618923968214410');" style=""> 179                              KuduUtil.setMapValue(columnSchema.getType(), oneRow, sideFieldName, result);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 180                          }                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 181                      }                                                                                             </span>
<span class="2229266708609725904" onmouseenter="enter('2229266708609725904');" onmouseout="out('2229266708609725904');" style=""> 182                      String cacheKey = buildKey(oneRow, sideInfo.getEqualFieldList());                             </span>
<span class="-5352076517603594778" onmouseenter="enter('-5352076517603594778');" onmouseout="out('-5352076517603594778');" style=""><abbr title=" 183                      List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList());"> 183                      List&lt;Map&lt;String, Object&gt;&gt; list = tmpCache.computeIfAbsent(cacheKey, key -&gt; Lists.newArrayList(🔵</abbr></span>
<span class="6640987884852458310" onmouseenter="enter('6640987884852458310');" onmouseout="out('6640987884852458310');" style=""> 184                      list.add(oneRow);                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 185                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 186              }                                                                                                     </span>
<span  style=""> 187                                                                                                                    </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 188          } catch (Exception e) {                                                                                   </span>
<span class="5662170612738471238" onmouseenter="enter('5662170612738471238');" onmouseout="out('5662170612738471238');" style=""> 189              LOG.error(&quot;&quot;, e);                                                                                     </span>
<span class="9062373144943479618" onmouseenter="enter('9062373144943479618');" onmouseout="out('9062373144943479618');" style=""> 190          } finally {                                                                                               </span>
<span class="8423512920007061689" onmouseenter="enter('8423512920007061689');" onmouseout="out('8423512920007061689');" style=""> 191              if (null != scanner) {                                                                                </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 192                  try {                                                                                             </span>
<span class="-8777054502423170477" onmouseenter="enter('-8777054502423170477');" onmouseout="out('-8777054502423170477');" style=""> 193                      scanner.close();                                                                              </span>
<span class="-5126831610509859200" onmouseenter="enter('-5126831610509859200');" onmouseout="out('-5126831610509859200');" style=""> 194                  } catch (KuduException e) {                                                                       </span>
<span class="6470662301361356472" onmouseenter="enter('6470662301361356472');" onmouseout="out('6470662301361356472');" style=""> 195                      LOG.error(&quot;Error while closing scanner.&quot;, e);                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 196                  }                                                                                                 </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 197              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 198          }                                                                                                         </span>
<span  style=""> 199                                                                                                                    </span>
<span  style=""> 200                                                                                                                    </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 201      }                                                                                                             </span>
<span  style=""> 202                                                                                                                    </span>
<span class="8922654517528381506" onmouseenter="enter('8922654517528381506');" onmouseout="out('8922654517528381506');" style=""> 203      private String buildKey(List&lt;Object&gt; equalValList) {                                                          </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 204          StringBuilder sb = new StringBuilder(&quot;&quot;);                                                                 </span>
<span class="2530437358054322638" onmouseenter="enter('2530437358054322638');" onmouseout="out('2530437358054322638');" style=""> 205          for (Object equalVal : equalValList) {                                                                    </span>
<span class="659090455522059309" onmouseenter="enter('659090455522059309');" onmouseout="out('659090455522059309');" style=""> 206              sb.append(equalVal).append(&quot;_&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 207          }                                                                                                         </span>
<span  style=""> 208                                                                                                                    </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 209          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 210      }                                                                                                             </span>
<span  style=""> 211                                                                                                                    </span>
<span class="-9025630716435315673" onmouseenter="enter('-9025630716435315673');" onmouseout="out('-9025630716435315673');" style=""> 212      private String buildKey(Map&lt;String, Object&gt; val, List&lt;String&gt; equalFieldList) {                               </span>
<span class="-6010126763505063494" onmouseenter="enter('-6010126763505063494');" onmouseout="out('-6010126763505063494');" style=""> 213          StringBuilder sb = new StringBuilder(&quot;&quot;);                                                                 </span>
<span class="-118957583027419766" onmouseenter="enter('-118957583027419766');" onmouseout="out('-118957583027419766');" style=""> 214          for (String equalField : equalFieldList) {                                                                </span>
<span class="7828107956340988069" onmouseenter="enter('7828107956340988069');" onmouseout="out('7828107956340988069');" style=""> 215              sb.append(val.get(equalField)).append(&quot;_&quot;);                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 216          }                                                                                                         </span>
<span class="-6276773404435993532" onmouseenter="enter('-6276773404435993532');" onmouseout="out('-6276773404435993532');" style=""> 217          return sb.toString();                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 218      }                                                                                                             </span>
<span  style=""> 219                                                                                                                    </span>
<span class="-1110060986504237489" onmouseenter="enter('-1110060986504237489');" onmouseout="out('-1110060986504237489');" style=""> 220      private KuduScanner getConn(KuduSideTableInfo tableInfo) {                                                    </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 221          try {                                                                                                     </span>
<span class="5852398308261929617" onmouseenter="enter('5852398308261929617');" onmouseout="out('5852398308261929617');" style=""> 222              if (client == null) {                                                                                 </span>
<span class="6663968999840548385" onmouseenter="enter('6663968999840548385');" onmouseout="out('6663968999840548385');" style=""> 223                  String kuduMasters = tableInfo.getKuduMasters();                                                  </span>
<span class="-557099550710151869" onmouseenter="enter('-557099550710151869');" onmouseout="out('-557099550710151869');" style=""> 224                  String tableName = tableInfo.getTableName();                                                      </span>
<span class="9112523977520204345" onmouseenter="enter('9112523977520204345');" onmouseout="out('9112523977520204345');" style=""> 225                  Integer workerCount = tableInfo.getWorkerCount();                                                 </span>
<span class="6969473062611895" onmouseenter="enter('6969473062611895');" onmouseout="out('6969473062611895');" style=""> 226                  Integer defaultSocketReadTimeoutMs = tableInfo.getDefaultSocketReadTimeoutMs();                   </span>
<span class="-1083775279901428778" onmouseenter="enter('-1083775279901428778');" onmouseout="out('-1083775279901428778');" style=""> 227                  Integer defaultOperationTimeoutMs = tableInfo.getDefaultOperationTimeoutMs();                     </span>
<span  style=""> 228                                                                                                                    </span>
<span class="-6052455991030570635" onmouseenter="enter('-6052455991030570635');" onmouseout="out('-6052455991030570635');" style=""> 229                  Preconditions.checkNotNull(kuduMasters, &quot;kuduMasters could not be null&quot;);                         </span>
<span  style=""> 230                                                                                                                    </span>
<span class="6323058657488852255" onmouseenter="enter('6323058657488852255');" onmouseout="out('6323058657488852255');" style=""> 231                  KuduClient.KuduClientBuilder kuduClientBuilder = new KuduClient.KuduClientBuilder(kuduMasters);   </span>
<span class="-8227759523178082238" onmouseenter="enter('-8227759523178082238');" onmouseout="out('-8227759523178082238');" style=""> 232                  if (null != workerCount) {                                                                        </span>
<span class="7330416389256434067" onmouseenter="enter('7330416389256434067');" onmouseout="out('7330416389256434067');" style=""> 233                      kuduClientBuilder.workerCount(workerCount);                                                   </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 234                  }                                                                                                 </span>
<span  style=""> 235                                                                                                                    </span>
<span class="-2397215110746175709" onmouseenter="enter('-2397215110746175709');" onmouseout="out('-2397215110746175709');" style=""> 236                  if (null != defaultOperationTimeoutMs) {                                                          </span>
<span class="2898164840518299373" onmouseenter="enter('2898164840518299373');" onmouseout="out('2898164840518299373');" style=""> 237                      kuduClientBuilder.defaultOperationTimeoutMs(defaultOperationTimeoutMs);                       </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 238                  }                                                                                                 </span>
<span class="4908267423182375675" onmouseenter="enter('4908267423182375675');" onmouseout="out('4908267423182375675');" style=""> 239                  client = kuduClientBuilder.build();                                                               </span>
<span  style=""> 240                                                                                                                    </span>
<span class="5439625390486835368" onmouseenter="enter('5439625390486835368');" onmouseout="out('5439625390486835368');" style=""> 241                  if (!client.tableExists(tableName)) {                                                             </span>
<span class="4123299035781055923" onmouseenter="enter('4123299035781055923');" onmouseout="out('4123299035781055923');" style=""> 242                      throw new IllegalArgumentException(&quot;Table Open Failed , please check table exists&quot;);          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 243                  }                                                                                                 </span>
<span class="-2001660784391926307" onmouseenter="enter('-2001660784391926307');" onmouseout="out('-2001660784391926307');" style=""> 244                  table = client.openTable(tableName);                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 245              }                                                                                                     </span>
<span class="6789989036272871448" onmouseenter="enter('6789989036272871448');" onmouseout="out('6789989036272871448');" style=""> 246              Schema schema = table.getSchema();                                                                    </span>
<span class="4608914853005352034" onmouseenter="enter('4608914853005352034');" onmouseout="out('4608914853005352034');" style=""> 247              KuduScanner.KuduScannerBuilder tokenBuilder = client.newScannerBuilder(table);                        </span>
<span class="-4750737985114959418" onmouseenter="enter('-4750737985114959418');" onmouseout="out('-4750737985114959418');" style=""> 248              return buildScanner(tokenBuilder, schema, tableInfo);                                                 </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 249          } catch (Exception e) {                                                                                   </span>
<span class="-2537427276397986072" onmouseenter="enter('-2537427276397986072');" onmouseout="out('-2537427276397986072');" style=""> 250              LOG.error(&quot;connect kudu is error:&quot; + e.getMessage());                                                 </span>
<span class="5897285764286536997" onmouseenter="enter('5897285764286536997');" onmouseout="out('5897285764286536997');" style=""> 251              throw new RuntimeException(e);                                                                        </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 252          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 253      }                                                                                                             </span>
<span  style=""> 254                                                                                                                    </span>
<span  style=""> 255                                                                                                                    </span>
<span class="1188357178855945174" onmouseenter="enter('1188357178855945174');" onmouseout="out('1188357178855945174');" style=""> 256      /**                                                                                                           </span>
<span class="-1458033306623281405" onmouseenter="enter('-1458033306623281405');" onmouseout="out('-1458033306623281405');" style=""> 257       * @param builder   创建AsyncKuduScanner对象                                                                      </span>
<span class="2461494225329490181" onmouseenter="enter('2461494225329490181');" onmouseout="out('2461494225329490181');" style=""> 258       * @param schema    kudu中表约束                                                                                  </span>
<span class="-2064584549205697250" onmouseenter="enter('-2064584549205697250');" onmouseout="out('-2064584549205697250');" style=""> 259       * @param tableInfo AsyncKuduScanner的配置信息                                                                     </span>
<span class="-9165797340485297481" onmouseenter="enter('-9165797340485297481');" onmouseout="out('-9165797340485297481');" style=""> 260       * @return                                                                                                    </span>
<span class="-3478703399357275674" onmouseenter="enter('-3478703399357275674');" onmouseout="out('-3478703399357275674');" style=""> 261       */                                                                                                           </span>
<span class="2867837401631125856" onmouseenter="enter('2867837401631125856');" onmouseout="out('2867837401631125856');" style=""><abbr title=" 262      private KuduScanner buildScanner(KuduScanner.KuduScannerBuilder builder, Schema schema, KuduSideTableInfo tableInfo) {"> 262      private KuduScanner buildScanner(KuduScanner.KuduScannerBuilder builder, Schema schema, KuduSideTableInfo tabl🔵</abbr></span>
<span class="8886111092133146967" onmouseenter="enter('8886111092133146967');" onmouseout="out('8886111092133146967');" style=""> 263          Integer batchSizeBytes = tableInfo.getBatchSizeBytes();                                                   </span>
<span class="7808553397779189452" onmouseenter="enter('7808553397779189452');" onmouseout="out('7808553397779189452');" style=""> 264          Long limitNum = tableInfo.getLimitNum();                                                                  </span>
<span class="-3208642476437503495" onmouseenter="enter('-3208642476437503495');" onmouseout="out('-3208642476437503495');" style=""> 265          Boolean isFaultTolerant = tableInfo.getFaultTolerant();                                                   </span>
<span class="-8526639943056837274" onmouseenter="enter('-8526639943056837274');" onmouseout="out('-8526639943056837274');" style=""> 266          //查询需要的字段                                                                                                 </span>
<span class="2090107689800818740" onmouseenter="enter('2090107689800818740');" onmouseout="out('2090107689800818740');" style=""> 267          String[] sideFieldNames = StringUtils.split(sideInfo.getSideSelectFields(), &quot;,&quot;);                         </span>
<span class="8148679338456729713" onmouseenter="enter('8148679338456729713');" onmouseout="out('8148679338456729713');" style=""> 268          //主键过滤条件 主键最小值                                                                                            </span>
<span class="774304746758482808" onmouseenter="enter('774304746758482808');" onmouseout="out('774304746758482808');" style=""> 269          String lowerBoundPrimaryKey = tableInfo.getLowerBoundPrimaryKey();                                        </span>
<span class="-4956716841620057294" onmouseenter="enter('-4956716841620057294');" onmouseout="out('-4956716841620057294');" style=""> 270          //主键过滤条件 主键最大值                                                                                            </span>
<span class="-7517771237746601096" onmouseenter="enter('-7517771237746601096');" onmouseout="out('-7517771237746601096');" style=""> 271          String upperBoundPrimaryKey = tableInfo.getUpperBoundPrimaryKey();                                        </span>
<span class="-3636378559400202691" onmouseenter="enter('-3636378559400202691');" onmouseout="out('-3636378559400202691');" style=""> 272          //主键字段                                                                                                    </span>
<span class="5200352787312582461" onmouseenter="enter('5200352787312582461');" onmouseout="out('5200352787312582461');" style=""> 273          String primaryKeys = tableInfo.getPrimaryKey();                                                           </span>
<span class="-8080913465496496419" onmouseenter="enter('-8080913465496496419');" onmouseout="out('-8080913465496496419');" style=""> 274          if (null == limitNum || limitNum &lt;= 0) {                                                                  </span>
<span class="-4868625127437582675" onmouseenter="enter('-4868625127437582675');" onmouseout="out('-4868625127437582675');" style=""> 275              builder.limit(FETCH_SIZE);                                                                            </span>
<span class="-6023928394739582014" onmouseenter="enter('-6023928394739582014');" onmouseout="out('-6023928394739582014');" style=""> 276          } else {                                                                                                  </span>
<span class="4444562149069843980" onmouseenter="enter('4444562149069843980');" onmouseout="out('4444562149069843980');" style=""> 277              builder.limit(limitNum);                                                                              </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 278          }                                                                                                         </span>
<span class="-5740110908714073879" onmouseenter="enter('-5740110908714073879');" onmouseout="out('-5740110908714073879');" style=""> 279          if (null != batchSizeBytes) {                                                                             </span>
<span class="732524166722318272" onmouseenter="enter('732524166722318272');" onmouseout="out('732524166722318272');" style=""> 280              builder.batchSizeBytes(batchSizeBytes);                                                               </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 281          }                                                                                                         </span>
<span class="-8680730272034558637" onmouseenter="enter('-8680730272034558637');" onmouseout="out('-8680730272034558637');" style=""> 282          if (null != isFaultTolerant) {                                                                            </span>
<span class="-2751626226784684126" onmouseenter="enter('-2751626226784684126');" onmouseout="out('-2751626226784684126');" style=""> 283              builder.setFaultTolerant(isFaultTolerant);                                                            </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 284          }                                                                                                         </span>
<span class="-5863912479223093982" onmouseenter="enter('-5863912479223093982');" onmouseout="out('-5863912479223093982');" style=""> 285          //  填充谓词信息                                                                                                </span>
<span class="-8839623202504591157" onmouseenter="enter('-8839623202504591157');" onmouseout="out('-8839623202504591157');" style=""> 286          List&lt;PredicateInfo&gt; predicateInfoes = sideInfo.getSideTableInfo().getPredicateInfoes();                   </span>
<span class="1131384255148676390" onmouseenter="enter('1131384255148676390');" onmouseout="out('1131384255148676390');" style=""> 287          if (predicateInfoes.size() &gt; 0) {                                                                         </span>
<span class="7087000648291367893" onmouseenter="enter('7087000648291367893');" onmouseout="out('7087000648291367893');" style=""> 288              predicateInfoes.stream().map(info -&gt; {                                                                </span>
<span class="-3754680470381432050" onmouseenter="enter('-3754680470381432050');" onmouseout="out('-3754680470381432050');" style=""> 289                  KuduPredicate kuduPredicate = KuduUtil.buildKuduPredicate(schema, info);                          </span>
<span class="8493928812165156395" onmouseenter="enter('8493928812165156395');" onmouseout="out('8493928812165156395');" style=""> 290                  if (null != kuduPredicate) {                                                                      </span>
<span class="-7750601395793408087" onmouseenter="enter('-7750601395793408087');" onmouseout="out('-7750601395793408087');" style=""> 291                      builder.addPredicate(kuduPredicate);                                                          </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 292                  }                                                                                                 </span>
<span class="-3556780733195614200" onmouseenter="enter('-3556780733195614200');" onmouseout="out('-3556780733195614200');" style=""> 293                  return info;                                                                                      </span>
<span class="3075434854107094892" onmouseenter="enter('3075434854107094892');" onmouseout="out('3075434854107094892');" style=""> 294              }).count();                                                                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 295          }                                                                                                         </span>
<span  style=""> 296                                                                                                                    </span>
<span class="5058160594792466993" onmouseenter="enter('5058160594792466993');" onmouseout="out('5058160594792466993');" style=""> 297          if (null != lowerBoundPrimaryKey &amp;&amp; null != upperBoundPrimaryKey &amp;&amp; null != primaryKeys) {                </span>
<span class="5137789214991290203" onmouseenter="enter('5137789214991290203');" onmouseout="out('5137789214991290203');" style=""> 298              List&lt;ColumnSchema&gt; columnSchemas = schema.getPrimaryKeyColumns();                                     </span>
<span class="-9153585758974253186" onmouseenter="enter('-9153585758974253186');" onmouseout="out('-9153585758974253186');" style=""> 299              Map&lt;String, Integer&gt; columnName = new HashMap&lt;String, Integer&gt;(columnSchemas.size());                 </span>
<span class="-8501863997026521914" onmouseenter="enter('-8501863997026521914');" onmouseout="out('-8501863997026521914');" style=""> 300              for (int i = 0; i &lt; columnSchemas.size(); i++) {                                                      </span>
<span class="5688298920213282235" onmouseenter="enter('5688298920213282235');" onmouseout="out('5688298920213282235');" style=""> 301                  columnName.put(columnSchemas.get(i).getName(), i);                                                </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 302              }                                                                                                     </span>
<span class="9190792110333311829" onmouseenter="enter('9190792110333311829');" onmouseout="out('9190792110333311829');" style=""> 303              String[] primaryKey = splitString(primaryKeys);                                                       </span>
<span class="8892393707780373743" onmouseenter="enter('8892393707780373743');" onmouseout="out('8892393707780373743');" style=""> 304              String[] lowerBounds = splitString(lowerBoundPrimaryKey);                                             </span>
<span class="-609605915884017391" onmouseenter="enter('-609605915884017391');" onmouseout="out('-609605915884017391');" style=""> 305              String[] upperBounds = splitString(upperBoundPrimaryKey);                                             </span>
<span class="4494391771595015869" onmouseenter="enter('4494391771595015869');" onmouseout="out('4494391771595015869');" style=""> 306              PartialRow lowerPartialRow = schema.newPartialRow();                                                  </span>
<span class="8816033343726193199" onmouseenter="enter('8816033343726193199');" onmouseout="out('8816033343726193199');" style=""> 307              PartialRow upperPartialRow = schema.newPartialRow();                                                  </span>
<span class="-8968328790125117730" onmouseenter="enter('-8968328790125117730');" onmouseout="out('-8968328790125117730');" style=""> 308              for (int i = 0; i &lt; primaryKey.length; i++) {                                                         </span>
<span class="-7469830342865795482" onmouseenter="enter('-7469830342865795482');" onmouseout="out('-7469830342865795482');" style=""> 309                  Integer index = columnName.get(primaryKey[i]);                                                    </span>
<span class="9077186300921558226" onmouseenter="enter('9077186300921558226');" onmouseout="out('9077186300921558226');" style=""><abbr title=" 310                  KuduUtil.primaryKeyRange(lowerPartialRow, columnSchemas.get(index).getType(), primaryKey[i], lowerBounds[i]);"> 310                  KuduUtil.primaryKeyRange(lowerPartialRow, columnSchemas.get(index).getType(), primaryKey[i], lower🔵</abbr></span>
<span class="1719939722143080272" onmouseenter="enter('1719939722143080272');" onmouseout="out('1719939722143080272');" style=""><abbr title=" 311                  KuduUtil.primaryKeyRange(upperPartialRow, columnSchemas.get(index).getType(), primaryKey[i], upperBounds[i]);"> 311                  KuduUtil.primaryKeyRange(upperPartialRow, columnSchemas.get(index).getType(), primaryKey[i], upper🔵</abbr></span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 312              }                                                                                                     </span>
<span class="-4326832194787526924" onmouseenter="enter('-4326832194787526924');" onmouseout="out('-4326832194787526924');" style=""> 313              builder.lowerBound(lowerPartialRow);                                                                  </span>
<span class="-1145836739913025748" onmouseenter="enter('-1145836739913025748');" onmouseout="out('-1145836739913025748');" style=""> 314              builder.exclusiveUpperBound(upperPartialRow);                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 315          }                                                                                                         </span>
<span class="6330664272177173056" onmouseenter="enter('6330664272177173056');" onmouseout="out('6330664272177173056');" style=""> 316          List&lt;String&gt; projectColumns = Arrays.asList(sideFieldNames);                                              </span>
<span class="5674897199079825382" onmouseenter="enter('5674897199079825382');" onmouseout="out('5674897199079825382');" style=""> 317          return builder.setProjectedColumnNames(projectColumns).build();                                           </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 318      }                                                                                                             </span>
<span  style=""> 319                                                                                                                    </span>
<span class="7272585370217888157" onmouseenter="enter('7272585370217888157');" onmouseout="out('7272585370217888157');" style=""> 320      private String[] splitString(String data) {                                                                   </span>
<span class="6835810800556100983" onmouseenter="enter('6835810800556100983');" onmouseout="out('6835810800556100983');" style=""> 321          return StringUtils.split(data, &quot;,&quot;);                                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 322      }                                                                                                             </span>
<span  style=""> 323                                                                                                                    </span>
<span class="5563255192340639251" onmouseenter="enter('5563255192340639251');" onmouseout="out('5563255192340639251');" style=""> 324      @Override                                                                                                     </span>
<span class="3412323497574912500" onmouseenter="enter('3412323497574912500');" onmouseout="out('3412323497574912500');" style=""> 325      public void close() throws Exception {                                                                        </span>
<span class="-8885801519389600338" onmouseenter="enter('-8885801519389600338');" onmouseout="out('-8885801519389600338');" style=""> 326          //公用一个client  如果每次刷新间隔时间较长可以每次获取一个                                                                        </span>
<span class="-2219391834669832598" onmouseenter="enter('-2219391834669832598');" onmouseout="out('-2219391834669832598');" style=""> 327          super.close();                                                                                            </span>
<span class="5794975028458899729" onmouseenter="enter('5794975028458899729');" onmouseout="out('5794975028458899729');" style=""> 328          if (null != client) {                                                                                     </span>
<span class="-2989978199866728989" onmouseenter="enter('-2989978199866728989');" onmouseout="out('-2989978199866728989');" style=""> 329              try {                                                                                                 </span>
<span class="2670944726041732440" onmouseenter="enter('2670944726041732440');" onmouseout="out('2670944726041732440');" style=""> 330                  client.close();                                                                                   </span>
<span class="2627011698774241688" onmouseenter="enter('2627011698774241688');" onmouseout="out('2627011698774241688');" style=""> 331              } catch (Exception e) {                                                                               </span>
<span class="7169708839653618971" onmouseenter="enter('7169708839653618971');" onmouseout="out('7169708839653618971');" style=""> 332                  LOG.error(&quot;Error while closing client.&quot;, e);                                                      </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 333              }                                                                                                     </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 334          }                                                                                                         </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 335      }                                                                                                             </span>
<span class="-1659227874853751674" onmouseenter="enter('-1659227874853751674');" onmouseout="out('-1659227874853751674');" style=""> 336  }                                                                                                                 </span></pre></td>
                        </tr>
                    </table>
                </div>
              </body>
            </html>
            